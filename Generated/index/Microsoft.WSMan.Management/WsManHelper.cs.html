<!DOCTYPE html>
<html><head><title>WsManHelper.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(1141);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.WSMan.Management/WsManHelper.cs" target="_top">WsManHelper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.WSMan.Management" target="_top">src\Microsoft.WSMan.Management\Microsoft.WSMan.Management.csproj</a> (Microsoft.WSMan.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Provider</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Resources</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">WSMan</span>.<span class="i n">Management</span>
{
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1054:UriParametersShouldNotBeStrings&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;0#&quot;</span>)]
    <b>internal class</b> <a id="40dbcbafdcf163ba" href="R/40dbcbafdcf163ba.html" target="n" data-glyph="2,0" class="t t">WSManHelper</a>
    {
        <span class="c">// regular expressions</span>
        <b>private const string</b> <a id="7b6978bd415e0164" href="R/7b6978bd415e0164.html" target="n" data-glyph="10,1" class="i field">PTRN_URI_LAST</a> = <span class="s">@&quot;([a-z_][-a-z0-9._]*)$&quot;</span>;
        <b>private const string</b> <a id="8439346ca414cbe7" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">PTRN_OPT</a> = <span class="s">@&quot;^-([a-z]+):(.*)&quot;</span>;
        <b>private const string</b> <a id="a55dc7da7ab07f8f" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">PTRN_HASH_TOK</a> = <span class="s">@&quot;\s*([\w:]+)\s*=\s*(\$null|&quot;&quot;([^&quot;&quot;]*)&quot;&quot;)\s*&quot;</span>;
 
        <span class="c">// schemas</span>
        <b>private const string</b> <a id="d7fdef6a73d3d342" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">URI_IPMI</a> = <span class="s">@&quot;http://schemas.dmtf.org/wbem/wscim/1/cim-schema&quot;</span>;
        <b>private const string</b> <a id="d8c8ce47b3319a9e" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">URI_WMI</a> = <span class="s">@&quot;http://schemas.microsoft.com/wbem/wsman/1/wmi&quot;</span>;
        <b>private const string</b> <a id="494025843943ef98" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">NS_IPMI</a> = <span class="s">@&quot;http://schemas.dmtf.org/wbem/wscim/1/cim-schema&quot;</span>;
        <b>private const string</b> <a id="0b4d29508dec9875" href="R/0b4d29508dec9875.html" target="n" data-glyph="10,1" class="i field">NS_CIMBASE</a> = <span class="s">@&quot;http://schemas.dmtf.org/wbem/wsman/1/base&quot;</span>;
        <b>private const string</b> <a id="ffac95309f3fd935" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">NS_WSMANL</a> = <span class="s">@&quot;http://schemas.microsoft.com&quot;</span>;
        <b>private const string</b> <a id="ecdff762f120b642" href="R/ecdff762f120b642.html" target="n" data-glyph="10,1" class="i field">NS_XSI</a> = <span class="s">@&quot;xmlns:xsi=&quot;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&quot;&quot;</span>;
        <b>private const string</b> <a id="78799a61a36d7df6" href="R/78799a61a36d7df6.html" target="n" data-glyph="10,1" class="i field">ATTR_NIL</a> = <span class="s">@&quot;xsi:nil=&quot;&quot;true&quot;&quot;&quot;</span>;
        <b>private const string</b> <a id="045d813b3e1d3e74" href="R/045d813b3e1d3e74.html" target="n" data-glyph="10,1" class="i field">ATTR_NIL_NAME</a> = <span class="s">@&quot;xsi:nil&quot;</span>;
        <b>private const string</b> <a id="4a0dcdaecaa857a4" href="R/4a0dcdaecaa857a4.html" target="n" data-glyph="10,1" class="i field">NS_XSI_URI</a> = <span class="s">@&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>;
        <b>private const string</b> <a id="266723fa4706068c" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">ALIAS_XPATH</a> = <span class="s">@&quot;xpath&quot;</span>;
        <b>private const string</b> <a id="4c0534598b6ae4f0" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">URI_XPATH_DIALECT</a> = <span class="s">@&quot;http://www.w3.org/TR/1999/REC-xpath-19991116&quot;</span>;
 
        <span class="c">// credSSP strings</span>
        <b>internal string</b> <a id="0ae68a01d4a238ac" href="R/0ae68a01d4a238ac.html" target="n" data-glyph="44,1" class="i field">CredSSP_RUri</a> = <span class="s">&quot;winrm/config/client/auth&quot;</span>;
        <b>internal string</b> <a id="8480764075270ad0" href="R/8480764075270ad0.html" target="n" data-glyph="44,1" class="i field">CredSSP_XMLNmsp</a> = <span class="s">&quot;http://schemas.microsoft.com/wbem/wsman/1/config/client/auth&quot;</span>;
        <b>internal string</b> <a id="1ded268510e0343b" href="R/1ded268510e0343b.html" target="n" data-glyph="44,1" class="i field">CredSSP_SNode</a> = <span class="s">&quot;/cfg:Auth/cfg:CredSSP&quot;</span>;
        <b>internal string</b> <a id="d90c8c76e5ae0b86" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">Client_uri</a> = <span class="s">&quot;winrm/config/client&quot;</span>;
        <b>internal string</b> <a id="7c24727a0b9e49a4" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">urlprefix_node</a> = <span class="s">&quot;/cfg:Client/cfg:URLPrefix&quot;</span>;
        <b>internal string</b> <a id="91918fd3b76df83b" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">Client_XMLNmsp</a> = <span class="s">&quot;http://schemas.microsoft.com/wbem/wsman/1/config/client&quot;</span>;
 
        <b>internal string</b> <a id="7e540baae1be7f8d" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">Service_Uri</a> = <span class="s">&quot;winrm/config/service&quot;</span>;
        <b>internal string</b> <a id="fb72faea7f06d7f3" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">Service_UrlPrefix_Node</a> = <span class="s">&quot;/cfg:Service/cfg:URLPrefix&quot;</span>;
        <b>internal string</b> <a id="ab642266a5fe693b" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">Service_XMLNmsp</a> = <span class="s">&quot;http://schemas.microsoft.com/wbem/wsman/1/config/service&quot;</span>;
        <b>internal string</b> <a id="67582351ba642a33" href="R/67582351ba642a33.html" target="n" data-glyph="44,1" class="i field">Service_CredSSP_Uri</a> = <span class="s">&quot;winrm/config/service/auth&quot;</span>;
        <b>internal string</b> <a id="94c0c1fa99ff5e61" href="R/94c0c1fa99ff5e61.html" target="n" data-glyph="44,1" class="i field">Service_CredSSP_XMLNmsp</a> = <span class="s">&quot;http://schemas.microsoft.com/wbem/wsman/1/config/service/auth&quot;</span>;
 
        <span class="c">// gpo registry path and keys</span>
        <b>internal string</b> <a id="ad0d2c6a7becf011" href="R/ad0d2c6a7becf011.html" target="n" data-glyph="44,1" class="i field">Registry_Path_Credentials_Delegation</a> = <span class="s">@&quot;SOFTWARE\Policies\Microsoft\Windows&quot;</span>;
        <b>internal string</b> <a id="32b89c752cb4fd5f" href="R/32b89c752cb4fd5f.html" target="n" data-glyph="44,1" class="i field">Key_Allow_Fresh_Credentials</a> = <span class="s">&quot;AllowFreshCredentials&quot;</span>;
        <b>internal string</b> <a id="70aa42b1dca21740" href="R/70aa42b1dca21740.html" target="n" data-glyph="44,1" class="i field">Key_Concatenate_Defaults_AllowFresh</a> = <span class="s">&quot;ConcatenateDefaults_AllowFresh&quot;</span>;
        <b>internal string</b> <a id="3cd00bcf1fb3af95" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">Delegate</a> = <span class="s">&quot;delegate&quot;</span>;
        <b>internal string</b> <a id="82c10748a5bcc571" href="R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">keyAllowcredssp</a> = <span class="s">&quot;AllowCredSSP&quot;</span>;
 
        <span class="c">// &#39;Constants for MS-XML</span>
        <b>private const string</b> <a id="2baeeac50cb349dd" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">NODE_ATTRIBUTE</a> = <span class="s">&quot;2&quot;</span>;
        <b>private const int</b> <a id="0df0f9fc663dc277" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">NODE_TEXT</a> = 3;
 
        <span class="c">// strings for dialects</span>
        <b>internal string</b> <a id="053ec5d04bec9ba3" href="R/053ec5d04bec9ba3.html" target="n" data-glyph="44,1" class="i field">ALIAS_WQL</a> = <span class="s">@&quot;wql&quot;</span>;
        <b>internal string</b> <a id="8acf6519c578b798" href="R/8acf6519c578b798.html" target="n" data-glyph="44,1" class="i field">ALIAS_ASSOCIATION</a> = <span class="s">@&quot;association&quot;</span>;
        <b>internal string</b> <a id="7d812aedd232ec12" href="R/7d812aedd232ec12.html" target="n" data-glyph="44,1" class="i field">ALIAS_SELECTOR</a> = <span class="s">@&quot;selector&quot;</span>;
        <b>internal string</b> <a id="1469140f964b815c" href="R/1469140f964b815c.html" target="n" data-glyph="44,1" class="i field">URI_WQL_DIALECT</a> = <span class="s">@&quot;http://schemas.microsoft.com/wbem/wsman/1/WQL&quot;</span>;
        <b>internal string</b> <a id="c30c4c5e83aad66b" href="R/c30c4c5e83aad66b.html" target="n" data-glyph="44,1" class="i field">URI_SELECTOR_DIALECT</a> = <span class="s">@&quot;http://schemas.dmtf.org/wbem/wsman/1/wsman/SelectorFilter&quot;</span>;
        <b>internal string</b> <a id="c226a500c814138b" href="R/c226a500c814138b.html" target="n" data-glyph="44,1" class="i field">URI_ASSOCIATION_DIALECT</a> = <span class="s">@&quot; http://schemas.dmtf.org/wbem/wsman/1/cimbinding/associationFilter&quot;</span>;
 
        <span class="c">// string for operation</span>
        <b>internal string</b> <a id="83a20760bb0c912e" href="R/83a20760bb0c912e.html" target="n" data-glyph="44,1" class="i field">WSManOp</a> = <b>null</b>;
 
        <b>private readonly</b> <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <a id="ef1b91ca63230ac1" href="R/ef1b91ca63230ac1.html" target="n" data-glyph="46,1" class="i field">cmdletname</a>;
        <b>private readonly</b> <a href="/System.Management.Automation/A.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <a id="0758e080b619461a" href="R/0758e080b619461a.html" target="n" data-glyph="46,1" class="i field">_provider</a>;
 
        <b>private</b> <span class="i">FileStream</span> <a id="41afc7734fd65d39" href="R/41afc7734fd65d39.html" target="n" data-glyph="46,1" class="i field">_fs</a>;
        <b>private</b> <span class="i">StreamReader</span> <a id="0e5390cc2770767f" href="R/0e5390cc2770767f.html" target="n" data-glyph="46,1" class="i field">_sr</a>;
 
        <b>private static readonly</b> <span class="i">ResourceManager</span> <a id="59cd1ce9c643a9d0" href="R/59cd1ce9c643a9d0.html" target="n" data-glyph="46,1" class="i field">_resourceMgr</a> = <b>new</b> <span class="i">ResourceManager</span>(<span class="s">&quot;Microsoft.WSMan.Management.resources.WsManResources&quot;</span>, <b>typeof</b>(<a href="#40dbcbafdcf163ba" class="t t">WSManHelper</a>).<span class="i">GetTypeInfo</span>().<span class="i">Assembly</span>);
 
        <span class="c">//</span>
        <span class="c">//</span>
        <span class="c">// Below class is just a static container which would release sessions in case this DLL is unloaded.</span>
        <b>internal class</b> <a id="9e95d7492598ce77" href="R/9e95d7492598ce77.html" target="n" data-glyph="2,1" class="t t"><span id="04f010adcd98d4dc">Sessions</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Dictionary object to store the connection.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal static readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <a id="87b2182a1f9722d0" href="R/87b2182a1f9722d0.html" target="n" data-glyph="44,2" class="i field">SessionObjCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt;();
 
            ~<a id="b5ed6b49c3e3e752" href="R/../../0000000000.html" target="n" data-glyph="75,2" class="t method">Sessions</a>()
            {
                <a href="#c4782251221c7f4d" class="i method">ReleaseSessions</a>();
            }
        }
 
        <b>internal static readonly</b> <a href="#9e95d7492598ce77" class="t t">Sessions</a> <a id="2a23b1e8c34cc740" href="R/2a23b1e8c34cc740.html" target="n" data-glyph="44,1" class="i field">AutoSession</a> = <b>new</b> <span class="t">Sessions</span>();
        <span class="c">//</span>
        <span class="c">//</span>
        <span class="c">//</span>
 
        <b>internal static void</b> <a id="c4782251221c7f4d" href="R/c4782251221c7f4d.html" target="n" data-glyph="74,1" class="i method">ReleaseSessions</a>()
        {
            <b>lock</b> (<a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>)
            {
                <b>object</b> <span id="r0 rd" class="r0 r">sessionobj</span>;
                <b>foreach</b> (<b>string</b> <span id="r1 rd" class="r1 r">key</span> <b>in</b> <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">Keys</span>)
                {
                    <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">TryGetValue</span>(<span class="r1 r">key</span>, <b>out</b> <span class="r0 r">sessionobj</span>);
                    <b>try</b>
                    {
                        <span class="i">Marshal</span>.<span class="i">ReleaseComObject</span>(<span class="r0 r">sessionobj</span>);
                    }
                    <b>catch</b> (<span class="i">ArgumentException</span>)
                    {
                        <span class="c">// Somehow the object was a null reference. Ignore the error</span>
                    }
 
                    <span class="r0 r">sessionobj</span> = <b>null</b>;
                }
 
                <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">Clear</span>();
            }
        }
 
        <b>internal</b> <a id="fe9af43430a42abf" href="R/fe9af43430a42abf.html" target="n" data-glyph="74,1" class="t constructor">WSManHelper</a>()
        {
        }
 
        <b>internal</b> <a id="09f36afec28954d1" href="R/09f36afec28954d1.html" target="n" data-glyph="74,1" class="t constructor">WSManHelper</a>(<a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r2 rd" class="r2 r">cmdlet</span>)
        {
            <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a> = <span class="r2 r">cmdlet</span>;
        }
 
        <b>internal</b> <a id="f47802d3ea48265e" href="R/f47802d3ea48265e.html" target="n" data-glyph="74,1" class="t constructor">WSManHelper</a>(<a href="/System.Management.Automation/A.html#7d31476313596b0b" class="t t">NavigationCmdletProvider</a> <span id="r3 rd" class="r3 r">provider</span>)
        {
            <a href="#0758e080b619461a" class="i field">_provider</a> = <span class="r3 r">provider</span>;
        }
 
        <b>internal static void</b> <a id="e53fd23e593153ef" href="R/e53fd23e593153ef.html" target="n" data-glyph="74,1" class="i method">ThrowIfNotAdministrator</a>()
        {
            <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>.<span class="i">WindowsIdentity</span> <span id="r4 rd" class="r4 r">currentIdentity</span> = <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>.<span class="i">WindowsIdentity</span>.<span class="i">GetCurrent</span>();
            <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>.<span class="i">WindowsPrincipal</span> <span id="r5 rd" class="r5 r">principal</span> = <b>new</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>.<span class="i">WindowsPrincipal</span>(<span class="r4 r">currentIdentity</span>);
            <b>if</b> (!<span class="r5 r">principal</span>.<span class="i">IsInRole</span>(<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>.<span class="i">WindowsBuiltInRole</span>.<span class="i">Administrator</span>))
            {
                <b>string</b> <span id="r6 rd" class="r6 r">message</span> = <a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;ErrorElevationNeeded&quot;</span>);
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r6 r">message</span>);
            }
        }
 
        <b>internal string</b> <a id="f76b4b9703d327db" href="R/f76b4b9703d327db.html" target="n" data-glyph="74,1" class="i method">GetResourceMsgFromResourcetext</a>(<b>string</b> <span id="r7 rd" class="r7 r">rscname</span>)
        {
            <b>return</b> <a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="r7 r">rscname</span>);
        }
 
        <b>internal static string</b> <a id="541702e1c2bde51f" href="R/541702e1c2bde51f.html" target="n" data-glyph="74,1" class="i method">FormatResourceMsgFromResourcetextS</a>(<b>string</b> <span id="r8 rd" class="r8 r">rscname</span>,
            <b>params object</b>[] <span id="r9 rd" class="r9 r">args</span>)
        {
            <b>return</b> <a href="#726b0401ed295d7f" class="i method">FormatResourceMsgFromResourcetextS</a>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>, <span class="r8 r">rscname</span>, <span class="r9 r">args</span>);
        }
 
        <b>internal string</b> <a id="b1de34a08cdcd008" href="R/b1de34a08cdcd008.html" target="n" data-glyph="74,1" class="i method">FormatResourceMsgFromResourcetext</a>(<b>string</b> <span id="r10 rd" class="r10 r">resourceName</span>,
            <b>params object</b>[] <span id="r11 rd" class="r11 r">args</span>)
        {
            <b>return</b> <a href="#726b0401ed295d7f" class="i method">FormatResourceMsgFromResourcetextS</a>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>, <span class="r10 r">resourceName</span>, <span class="r11 r">args</span>);
        }
 
        <b>private static string</b> <a id="726b0401ed295d7f" href="R/726b0401ed295d7f.html" target="n" data-glyph="76,1" class="i method">FormatResourceMsgFromResourcetextS</a>(
            <span class="i">ResourceManager</span> <span id="r12 rd" class="r12 r">resourceManager</span>,
            <b>string</b> <span id="r13 rd" class="r13 r">resourceName</span>,
            <b>object</b>[] <span id="r14 rd" class="r14 r">args</span>)
        {
            <b>if</b> (<span class="r12 r">resourceManager</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r12 r">resourceManager</span>));
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r13 r">resourceName</span>))
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r13 r">resourceName</span>));
            }
 
            <b>string</b> <span id="r15 rd" class="r15 r">template</span> = <span class="r12 r">resourceManager</span>.<span class="i">GetString</span>(<span class="r13 r">resourceName</span>);
 
            <b>string</b> <span id="r16 rd" class="r16 r">result</span> = <b>null</b>;
            <b>if</b> (<span class="r15 r">template</span> != <b>null</b>)
            {
                <span class="r16 r">result</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                    <span class="r15 r">template</span>, <span class="r14 r">args</span>);
            }
 
            <b>return</b> <span class="r16 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a session to dictionary.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Connection string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Session object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="7c05e56b4a7334de" href="R/7c05e56b4a7334de.html" target="n" data-glyph="74,1" class="i method">AddtoDictionary</a>(<b>string</b> <span id="r17 rd" class="r17 r">key</span>, <b>object</b> <span id="r18 rd" class="r18 r">value</span>)
        {
            <span class="r17 r">key</span> = <span class="r17 r">key</span>.<span class="i">ToLowerInvariant</span>();
            <b>lock</b> (<a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>)
            {
                <b>if</b> (!<a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">ContainsKey</span>(<span class="r17 r">key</span>))
                {
                    <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">Add</span>(<span class="r17 r">key</span>, <span class="r18 r">value</span>);
                }
                <b>else</b>
                {
                    <b>object</b> <span id="r19 rd" class="r19 r">objsession</span> = <b>null</b>;
                    <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">TryGetValue</span>(<span class="r17 r">key</span>, <b>out</b> <span class="r19 r">objsession</span>);
                    <b>try</b>
                    {
                        <span class="i">Marshal</span>.<span class="i">ReleaseComObject</span>(<span class="r19 r">objsession</span>);
                    }
                    <b>catch</b> (<span class="i">ArgumentException</span>)
                    {
                        <span class="c">// Somehow the object was a null reference. Ignore the error</span>
                    }
 
                    <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">Remove</span>(<span class="r17 r">key</span>);
                    <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">Add</span>(<span class="r17 r">key</span>, <span class="r18 r">value</span>);
                }
            }
        }
 
        <b>internal object</b> <a id="e37737891fff2883" href="R/e37737891fff2883.html" target="n" data-glyph="74,1" class="i method">RemoveFromDictionary</a>(<b>string</b> <span id="r20 rd" class="r20 r">computer</span>)
        {
            <b>object</b> <span id="r21 rd" class="r21 r">objsession</span> = <b>null</b>;
            <span class="r20 r">computer</span> = <span class="r20 r">computer</span>.<span class="i">ToLowerInvariant</span>();
            <b>lock</b> (<a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>)
            {
                <b>if</b> (<a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">ContainsKey</span>(<span class="r20 r">computer</span>))
                {
                    <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">TryGetValue</span>(<span class="r20 r">computer</span>, <b>out</b> <span class="r21 r">objsession</span>);
                    <b>try</b>
                    {
                        <span class="i">Marshal</span>.<span class="i">ReleaseComObject</span>(<span class="r21 r">objsession</span>);
                    }
                    <b>catch</b> (<span class="i">ArgumentException</span>)
                    {
                        <span class="c">// Somehow the object was a null reference. Ignore the error</span>
                    }
 
                    <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">Remove</span>(<span class="r20 r">computer</span>);
                }
            }
 
            <b>return</b> <span class="r21 r">objsession</span>;
        }
 
        <b>internal static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <a id="2b29be8459e983a7" href="R/2b29be8459e983a7.html" target="n" data-glyph="74,1" class="i method">GetSessionObjCache</a>()
        {
            <b>try</b>
            {
                <b>lock</b> (<a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>)
                {
                    <b>if</b> (!<a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">ContainsKey</span>(<span class="s">&quot;localhost&quot;</span>))
                    {
                        <a href="Interop.cs.html#3aa0212e531a5219" class="t t">IWSManEx</a> <span id="r22 rd" class="r22 r">wsmanObject</span> = (<a href="Interop.cs.html#3aa0212e531a5219" class="t t">IWSManEx</a>)<b>new</b> <span class="t">WSManClass</span>();
                        <a href="Interop.cs.html#9141d9ac4bfab2f3" class="t t">IWSManSession</a> <span id="r23 rd" class="r23 r">SessionObj</span> = (<a href="Interop.cs.html#9141d9ac4bfab2f3" class="t t">IWSManSession</a>)<span class="r22 r">wsmanObject</span>.<a href="Interop.cs.html#345bb344eefe3b4d" class="i method">CreateSession</a>(<b>null</b>, 0, <b>null</b>);
                        <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>.<span class="i">Add</span>(<span class="s">&quot;localhost&quot;</span>, <span class="r23 r">SessionObj</span>);
                    }
                }
            }
            <b>catch</b> (<span class="i">IOException</span>)
            {
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>)
            {
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">UnauthorizedAccessException</span>)
            {
            }
            <b>catch</b> (<span class="i">COMException</span>)
            {
            }
 
            <b>return</b> <a href="#9e95d7492598ce77" class="t t">Sessions</a>.<a href="#87b2182a1f9722d0" class="i field">SessionObjCache</a>;
        }
 
        <b>internal string</b> <a id="aa93c350039de0ce" href="R/aa93c350039de0ce.html" target="n" data-glyph="74,1" class="i method">GetRootNodeName</a>(<b>string</b> <span id="r24 rd" class="r24 r">operation</span>, <b>string</b> <span id="r25 rd" class="r25 r">resourceUri</span>, <b>string</b> <span id="r26 rd" class="r26 r">actionStr</span>)
        {
            <b>string</b> <span id="r27 rd" class="r27 r">resultStr</span> = <b>null</b>, <span id="r28 rd" class="r28 r">sfx</span> = <b>null</b>;
            <b>if</b> (<span class="r25 r">resourceUri</span> != <b>null</b>)
            {
                <span class="r27 r">resultStr</span> = <span class="r25 r">resourceUri</span>;
                <span class="r27 r">resultStr</span> = <a href="#40610cbef8e97b15" class="i method">StripParams</a>(<span class="r27 r">resultStr</span>);
 
                <span class="i">Regex</span> <span id="r29 rd" class="r29 r">regexpr</span> = <b>new</b> <span class="i">Regex</span>(<a href="#7b6978bd415e0164" class="i field">PTRN_URI_LAST</a>, <span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>);
                <span class="i">MatchCollection</span> <span id="r30 rd" class="r30 r">matches</span> = <span class="r29 r">regexpr</span>.<span class="i">Matches</span>(<span class="r27 r">resultStr</span>);
                <b>if</b> (<span class="r30 r">matches</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>if</b> (<span class="r24 r">operation</span>.<span class="i">Equals</span>(<span class="s">&quot;invoke&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r28 r">sfx</span> = <span class="s">&quot;_INPUT&quot;</span>;
                        <span class="r27 r">resultStr</span> = <b>string</b>.<span class="i">Concat</span>(<span class="r26 r">actionStr</span>, <span class="r28 r">sfx</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r27 r">resultStr</span> = <span class="r30 r">matches</span>[0].<span class="i">ToString</span>();
                    }
                }
                <b>else</b>
                {
                    <span class="c">// error</span>
                }
            }
 
            <b>return</b> <span class="r27 r">resultStr</span>;
        }
 
        <b>internal string</b> <a id="40610cbef8e97b15" href="R/40610cbef8e97b15.html" target="n" data-glyph="74,1" class="i method">StripParams</a>(<b>string</b> <span id="r31 rd" class="r31 r">uri</span>)
        {
            <b>int</b> <span id="r32 rd" class="r32 r">pos</span> = <span class="r31 r">uri</span>.<span class="i">IndexOf</span>(<span class="s">&#39;?&#39;</span>);
            <b>if</b> (<span class="r32 r">pos</span> &gt; 0)
                <b>return</b> <span class="r31 r">uri</span>.<span class="i">Substring</span>(<span class="r32 r">pos</span>, <span class="r31 r">uri</span>.<span class="i">Length</span> - <span class="r32 r">pos</span>);
            <b>else</b>
                <b>return</b> <span class="r31 r">uri</span>;
        }
 
        <b>internal string</b> <a id="ddfbeecf02144192" href="R/ddfbeecf02144192.html" target="n" data-glyph="74,1" class="i method">ReadFile</a>(<b>string</b> <span id="r33 rd" class="r33 r">path</span>)
        {
            <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r33 r">path</span>))
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<a href="#f76b4b9703d327db" class="i method">GetResourceMsgFromResourcetext</a>(<span class="s">&quot;InvalidFileName&quot;</span>));
            }
 
            <b>string</b> <span id="r34 rd" class="r34 r">strOut</span> = <b>null</b>;
            <b>try</b>
            {
                <a href="#41afc7734fd65d39" class="i field">_fs</a> = <b>new</b> <span class="i">FileStream</span>(<span class="r33 r">path</span>, <span class="i">FileMode</span>.<span class="i">Open</span>, <span class="i">FileAccess</span>.<span class="i">Read</span>);
                <span class="c">// create stream Reader</span>
                <a href="#0e5390cc2770767f" class="i field">_sr</a> = <b>new</b> <span class="i">StreamReader</span>(<a href="#41afc7734fd65d39" class="i field">_fs</a>);
                <span class="r34 r">strOut</span> = <a href="#0e5390cc2770767f" class="i field">_sr</a>.<span class="i">ReadToEnd</span>();
            }
            <b>catch</b> (<span class="i">ArgumentNullException</span> <span id="r35 rd" class="r35 r">e</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r36 rd" class="r36 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r35 r">e</span>, <span class="s">&quot;ArgumentNullException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>);
                <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a>.<span class="i">ThrowTerminatingError</span>(<span class="r36 r">er</span>);
            }
            <b>catch</b> (<span class="i">UnauthorizedAccessException</span> <span id="r37 rd" class="r37 r">e</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r38 rd" class="r38 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r37 r">e</span>, <span class="s">&quot;UnauthorizedAccessException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>);
                <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a>.<span class="i">ThrowTerminatingError</span>(<span class="r38 r">er</span>);
            }
            <b>catch</b> (<span class="i">FileNotFoundException</span> <span id="r39 rd" class="r39 r">e</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r40 rd" class="r40 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r39 r">e</span>, <span class="s">&quot;FileNotFoundException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <b>null</b>);
                <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a>.<span class="i">ThrowTerminatingError</span>(<span class="r40 r">er</span>);
            }
            <b>catch</b> (<span class="i">DirectoryNotFoundException</span> <span id="r41 rd" class="r41 r">e</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r42 rd" class="r42 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r41 r">e</span>, <span class="s">&quot;DirectoryNotFoundException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <b>null</b>);
                <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a>.<span class="i">ThrowTerminatingError</span>(<span class="r42 r">er</span>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r43 rd" class="r43 r">e</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r44 rd" class="r44 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r43 r">e</span>, <span class="s">&quot;SecurityException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#f13302898d557be4" class="i field">SecurityError</a>, <b>null</b>);
                <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a>.<span class="i">ThrowTerminatingError</span>(<span class="r44 r">er</span>);
            }
            <b>finally</b>
            {
                <b>if</b> (<a href="#0e5390cc2770767f" class="i field">_sr</a> != <b>null</b>)
                {
                    <span class="c">// _sr.Close();</span>
                    <a href="#0e5390cc2770767f" class="i field">_sr</a>.<span class="i">Dispose</span>();
                }
 
                <b>if</b> (<a href="#41afc7734fd65d39" class="i field">_fs</a> != <b>null</b>)
                {
                    <span class="c">// _fs.Close();</span>
                    <a href="#41afc7734fd65d39" class="i field">_fs</a>.<span class="i">Dispose</span>();
                }
            }
 
            <b>return</b> <span class="r34 r">strOut</span>;
        }
 
        <b>internal string</b> <a id="b13fdb391f52b5a3" href="R/b13fdb391f52b5a3.html" target="n" data-glyph="74,1" class="i method">ProcessInput</a>(<a href="Interop.cs.html#3aa0212e531a5219" class="t t">IWSManEx</a> <span id="r45 rd" class="r45 r">wsman</span>, <b>string</b> <span id="r46 rd" class="r46 r">filepath</span>, <b>string</b> <span id="r47 rd" class="r47 r">operation</span>, <b>string</b> <span id="r48 rd" class="r48 r">root</span>, <span class="i">Hashtable</span> <span id="r49 rd" class="r49 r">valueset</span>, <a href="Interop.cs.html#7e09d5780a7d0f62" class="t t">IWSManResourceLocator</a> <span id="r50 rd" class="r50 r">resourceUri</span>, <a href="Interop.cs.html#9141d9ac4bfab2f3" class="t t">IWSManSession</a> <span id="r51 rd" class="r51 r">sessionObj</span>)
        {
            <b>string</b> <span id="r52 rd" class="r52 r">resultString</span> = <b>null</b>;
 
            <span class="c">// if file path is given</span>
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r46 r">filepath</span>) &amp;&amp; <span class="r49 r">valueset</span> == <b>null</b>)
            {
                <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r46 r">filepath</span>))
                {
                    <b>throw</b> <b>new</b> <span class="i">FileNotFoundException</span>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;InvalidFileName&quot;</span>));
                }
 
                <span class="r52 r">resultString</span> = <a href="#ddfbeecf02144192" class="i method">ReadFile</a>(<span class="r46 r">filepath</span>);
                <b>return</b> <span class="r52 r">resultString</span>;
            }
 
            <b>switch</b> (<span class="r47 r">operation</span>)
            {
                <b>case</b> <span class="s">&quot;new&quot;</span>:
                <b>case</b> <span class="s">&quot;invoke&quot;</span>:
 
                    <b>string</b> <span id="r53 rd" class="r53 r">parameters</span> = <b>null</b>, <span id="r54 rd" class="r54 r">nilns</span> = <b>null</b>;
                    <b>string</b> <span id="r55 rd" class="r55 r">xmlns</span> = <a href="#eb08732ebd6759fc" class="i method">GetXmlNs</a>(<span class="r50 r">resourceUri</span>.<a href="Interop.cs.html#8892f6eb879fff0d" class="i property">ResourceUri</a>);
 
                    <span class="c">// if valueset is given, i.e hashtable</span>
                    <b>if</b> (<span class="r49 r">valueset</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r56 rd" class="r56 r">entry</span> <b>in</b> <span class="r49 r">valueset</span>)
                        {
                            <span class="r53 r">parameters</span> = <span class="r53 r">parameters</span> + <span class="s">&quot;&lt;p:&quot;</span> + <span class="r56 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>();
                            <b>if</b> (<span class="r56 r">entry</span>.<span class="i">Value</span>.<span class="i">ToString</span>() == <b>null</b>)
                            {
                                <span class="r53 r">parameters</span> = <span class="r53 r">parameters</span> + <span class="s">&quot; &quot;</span> + <a href="#78799a61a36d7df6" class="i field">ATTR_NIL</a>;
                                <span class="r54 r">nilns</span> = <span class="s">&quot; &quot;</span> + <a href="#ecdff762f120b642" class="i field">NS_XSI</a>;
                            }
 
                            <span class="r53 r">parameters</span> = <span class="r53 r">parameters</span> + <span class="s">&quot;&gt;&quot;</span> + <span class="r56 r">entry</span>.<span class="i">Value</span>.<span class="i">ToString</span>() + <span class="s">&quot;&lt;/p:&quot;</span> + <span class="r56 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>() + <span class="s">&quot;&gt;&quot;</span>;
                        }
                    }
 
                    <span class="r52 r">resultString</span> = <span class="s">&quot;&lt;p:&quot;</span> + <span class="r48 r">root</span> + <span class="s">&quot; &quot;</span> + <span class="r55 r">xmlns</span> + <span class="r54 r">nilns</span> + <span class="s">&quot;&gt;&quot;</span> + <span class="r53 r">parameters</span> + <span class="s">&quot;&lt;/p:&quot;</span> + <span class="r48 r">root</span> + <span class="s">&quot;&gt;&quot;</span>;
 
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;set&quot;</span>:
 
                    <b>string</b> <span id="r57 rd" class="r57 r">getResult</span> = <span class="r51 r">sessionObj</span>.<a href="Interop.cs.html#8322aafdaa3fcc2e" class="i method">Get</a>(<span class="r50 r">resourceUri</span>, 0);
                    <span class="i">XmlDocument</span> <span id="r58 rd" class="r58 r">xmlfile</span> = <b>new</b> <span class="i">XmlDocument</span>();
                    <span class="r58 r">xmlfile</span>.<span class="i">LoadXml</span>(<span class="r57 r">getResult</span>);
 
                    <b>string</b> <span id="r59 rd" class="r59 r">xpathString</span> = <b>null</b>;
                    <b>if</b> (<span class="r49 r">valueset</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r60 rd" class="r60 r">entry</span> <b>in</b> <span class="r49 r">valueset</span>)
                        {
                            <span class="r59 r">xpathString</span> = <span class="s">@&quot;/*/*[local-name()=&quot;&quot;&quot;</span> + <span class="r60 r">entry</span>.<span class="i">Key</span> + <span class="s">@&quot;&quot;&quot;]&quot;</span>;
                            <b>if</b> (<span class="r60 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>().<span class="i">Equals</span>(<span class="s">&quot;location&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <span class="c">// &#39;Ignore cim:Location</span>
                                <span class="r59 r">xpathString</span> = <span class="s">@&quot;/*/*[local-name()=&quot;&quot;&quot;</span> + <span class="r60 r">entry</span>.<span class="i">Key</span> + <span class="s">@&quot;&quot;&quot; and namespace-uri() != &quot;&quot;&quot;</span> + <a href="#0b4d29508dec9875" class="i field">NS_CIMBASE</a> + <span class="s">@&quot;&quot;&quot;]&quot;</span>;
                            }
 
                            <span class="i">XmlNodeList</span> <span id="r61 rd" class="r61 r">nodes</span> = <span class="r58 r">xmlfile</span>.<span class="i">SelectNodes</span>(<span class="r59 r">xpathString</span>);
                            <b>if</b> (<span class="r61 r">nodes</span>.<span class="i">Count</span> == 0)
                            {
                                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoResourceMatch&quot;</span>));
                            }
                            <b>else</b> <b>if</b> (<span class="r61 r">nodes</span>.<span class="i">Count</span> &gt; 1)
                            {
                                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;MultipleResourceMatch&quot;</span>));
                            }
                            <b>else</b>
                            {
                                <span class="i">XmlNode</span> <span id="r62 rd" class="r62 r">node</span> = <span class="r61 r">nodes</span>[0];
                                <b>if</b> (<span class="r62 r">node</span>.<span class="i">HasChildNodes</span>)
                                {
                                    <b>if</b> (<span class="r62 r">node</span>.<span class="i">ChildNodes</span>.<span class="i">Count</span> &gt; 1)
                                    {
                                        <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NOAttributeMatch&quot;</span>));
                                    }
                                    <b>else</b>
                                    {
                                        <span class="i">XmlNode</span> <span id="r63 rd" class="r63 r">tmpNode</span> = <span class="r62 r">node</span>.<span class="i">ChildNodes</span>[0]; <span class="c">//.Item[0];</span>
                                        <b>if</b> (!<span class="r63 r">tmpNode</span>.<span class="i">NodeType</span>.<span class="i">ToString</span>().<span class="i">Equals</span>(<span class="s">&quot;text&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                        {
                                            <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NOAttributeMatch&quot;</span>));
                                        }
                                    }
                                }
 
                                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r60 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>()))
                                {
                                    <span class="c">// XmlNode newnode = xmlfile.CreateNode(XmlNodeType.Attribute, ATTR_NIL_NAME, NS_XSI_URI);</span>
                                    <span class="i">XmlAttribute</span> <span id="r64 rd" class="r64 r">newnode</span> = <span class="r58 r">xmlfile</span>.<span class="i">CreateAttribute</span>(<b>nameof</b>(<span class="i">XmlNodeType</span>.<span class="i">Attribute</span>), <a href="#045d813b3e1d3e74" class="i field">ATTR_NIL_NAME</a>, <a href="#4a0dcdaecaa857a4" class="i field">NS_XSI_URI</a>);
                                    <span class="r64 r">newnode</span>.<span class="i">Value</span> = <span class="s">&quot;true&quot;</span>;
                                    <span class="r62 r">node</span>.<span class="i">Attributes</span>.<span class="i">Append</span>(<span class="r64 r">newnode</span>);
                                    <span class="c">// (newnode.Attributes.Item(0).FirstChild   );</span>
                                    <span class="r62 r">node</span>.<span class="i">Value</span> = <b>string</b>.<span class="i">Empty</span>;
                                }
                                <b>else</b>
                                {
                                    <span class="r62 r">node</span>.<span class="i">Attributes</span>.<span class="i">RemoveNamedItem</span>(<a href="#045d813b3e1d3e74" class="i field">ATTR_NIL_NAME</a>);
                                    <span class="r62 r">node</span>.<span class="i">InnerText</span> = <span class="r60 r">entry</span>.<span class="i">Value</span>.<span class="i">ToString</span>();
                                }
                            }
                        }
                    }
 
                    <span class="r52 r">resultString</span> = <span class="r58 r">xmlfile</span>.<span class="i">OuterXml</span>;
                    <b>break</b>;
            }
 
            <b>return</b> <span class="r52 r">resultString</span>;
        }
 
        <b>internal string</b> <a id="eb08732ebd6759fc" href="R/eb08732ebd6759fc.html" target="n" data-glyph="74,1" class="i method">GetXmlNs</a>(<b>string</b> <span id="r65 rd" class="r65 r">resUri</span>)
        {
            <b>return</b> (<span class="s">@&quot;xmlns:p=&quot;&quot;&quot;</span> + <a href="#40610cbef8e97b15" class="i method">StripParams</a>(<span class="r65 r">resUri</span>) + <span class="s">@&quot;&quot;&quot;&quot;</span>);
        }
 
        <b>internal</b> <span class="i">XmlNode</span> <a id="a7bac5b0cd6694e4" href="R/a7bac5b0cd6694e4.html" target="n" data-glyph="74,1" class="i method">GetXmlNode</a>(<b>string</b> <span id="r66 rd" class="r66 r">xmlString</span>, <b>string</b> <span id="r67 rd" class="r67 r">xpathpattern</span>, <b>string</b> <span id="r68 rd" class="r68 r">xmlnamespace</span>)
        {
            <span class="i">XmlNode</span> <span id="r69 rd" class="r69 r">node</span> = <b>null</b>;
            <span class="i">XmlDocument</span> <span id="r70 rd" class="r70 r">xDoc</span> = <b>new</b> <span class="i">XmlDocument</span>();
            <span class="r70 r">xDoc</span>.<span class="i">LoadXml</span>(<span class="r66 r">xmlString</span>);
            <span class="i">XmlNamespaceManager</span> <span id="r71 rd" class="r71 r">nsmgr</span> = <b>new</b> <span class="i">XmlNamespaceManager</span>(<span class="r70 r">xDoc</span>.<span class="i">NameTable</span>);
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r68 r">xmlnamespace</span>))
            {
                <span class="r71 r">nsmgr</span>.<span class="i">AddNamespace</span>(<span class="s">&quot;cfg&quot;</span>, <span class="r68 r">xmlnamespace</span>);
            }
 
            <span class="r69 r">node</span> = <span class="r70 r">xDoc</span>.<span class="i">SelectSingleNode</span>(<span class="r67 r">xpathpattern</span>, <span class="r71 r">nsmgr</span>);
            <b>return</b> <span class="r69 r">node</span>;
        }
 
        <b>internal string</b> <a id="f6d1a48cb95ecd54" href="R/f6d1a48cb95ecd54.html" target="n" data-glyph="74,1" class="i method">CreateConnectionString</a>(<span class="i">Uri</span> <span id="r72 rd" class="r72 r">ConnUri</span>, <b>int</b> <span id="r73 rd" class="r73 r">port</span>, <b>string</b> <span id="r74 rd" class="r74 r">computername</span>, <b>string</b> <span id="r75 rd" class="r75 r">applicationname</span>)
        {
            <b>string</b> <span id="r76 rd" class="r76 r">ConnectionString</span> = <b>null</b>;
            <b>if</b> (<span class="r72 r">ConnUri</span> != <b>null</b>)
            {
                <span class="r76 r">ConnectionString</span> = <span class="r72 r">ConnUri</span>.<span class="i">OriginalString</span>;
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r74 r">computername</span> == <b>null</b> &amp;&amp; (<span class="r73 r">port</span> != 0 || <span class="r75 r">applicationname</span> != <b>null</b>))
                {
                    <span class="c">// the user didn&#39;t give us a computer name but he gave a port and/or application name;</span>
                    <span class="c">// in this case we need to have a computer name, to form the connection string;</span>
                    <span class="c">// assume localhost</span>
                    <span class="r74 r">computername</span> = <span class="s">&quot;localhost&quot;</span>;
                }
 
                <span class="r76 r">ConnectionString</span> = <span class="r74 r">computername</span>;
                <b>if</b> (<span class="r73 r">port</span> != 0)
                {
                    <span class="r76 r">ConnectionString</span> = <span class="r76 r">ConnectionString</span> + <span class="s">&quot;:&quot;</span> + <span class="r73 r">port</span>;
                }
 
                <b>if</b> (<span class="r75 r">applicationname</span> != <b>null</b>)
                {
                    <span class="r76 r">ConnectionString</span> = <span class="r76 r">ConnectionString</span> + <span class="s">&quot;/&quot;</span> + <span class="r75 r">applicationname</span>;
                }
            }
 
            <b>return</b> <span class="r76 r">ConnectionString</span>;
        }
 
        <b>internal</b> <a href="Interop.cs.html#7e09d5780a7d0f62" class="t t">IWSManResourceLocator</a> <a id="e0946b5fc0c058d5" href="R/e0946b5fc0c058d5.html" target="n" data-glyph="74,1" class="i method">InitializeResourceLocator</a>(<span class="i">Hashtable</span> <span id="r77 rd" class="r77 r">optionset</span>, <span class="i">Hashtable</span> <span id="r78 rd" class="r78 r">selectorset</span>, <b>string</b> <span id="r79 rd" class="r79 r">fragment</span>, <span class="i">Uri</span> <span id="r80 rd" class="r80 r">dialect</span>, <a href="Interop.cs.html#3aa0212e531a5219" class="t t">IWSManEx</a> <span id="r81 rd" class="r81 r">wsmanObj</span>, <span class="i">Uri</span> <span id="r82 rd" class="r82 r">resourceuri</span>)
        {
            <b>string</b> <span id="r83 rd" class="r83 r">resource</span> = <b>null</b>;
            <b>if</b> (<span class="r82 r">resourceuri</span> != <b>null</b>)
            {
                <span class="r83 r">resource</span> = <span class="r82 r">resourceuri</span>.<span class="i">ToString</span>();
            }
 
            <b>if</b> (<span class="r78 r">selectorset</span> != <b>null</b>)
            {
                <span class="r83 r">resource</span> += <span class="s">&quot;?&quot;</span>;
                <b>int</b> <span id="r84 rd" class="r84 r">i</span> = 0;
                <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r85 rd" class="r85 r">entry</span> <b>in</b> <span class="r78 r">selectorset</span>)
                {
                    <span class="r84 r">i</span>++;
                    <span class="r83 r">resource</span> = <span class="r83 r">resource</span> + <span class="r85 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>() + <span class="s">&quot;=&quot;</span> + <span class="r85 r">entry</span>.<span class="i">Value</span>.<span class="i">ToString</span>();
                    <b>if</b> (<span class="r84 r">i</span> &lt; <span class="r78 r">selectorset</span>.<span class="i">Count</span>)
                        <span class="r83 r">resource</span> += <span class="s">&quot;+&quot;</span>;
                }
            }
 
            <a href="Interop.cs.html#7e09d5780a7d0f62" class="t t">IWSManResourceLocator</a> <span id="r86 rd" class="r86 r">m_resource</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r86 r">m_resource</span> = (<a href="Interop.cs.html#7e09d5780a7d0f62" class="t t">IWSManResourceLocator</a>)<span class="r81 r">wsmanObj</span>.<a href="Interop.cs.html#c8799157c6fce8b7" class="i method">CreateResourceLocator</a>(<span class="r83 r">resource</span>);
 
                <b>if</b> (<span class="r77 r">optionset</span> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r87 rd" class="r87 r">entry</span> <b>in</b> <span class="r77 r">optionset</span>)
                    {
                        <b>if</b> (<span class="r87 r">entry</span>.<span class="i">Value</span>.<span class="i">ToString</span>() == <b>null</b>)
                        {
                            <span class="r86 r">m_resource</span>.<span class="i">AddOption</span>(<span class="r87 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <b>null</b>, 1);
                        }
                        <b>else</b>
                        {
                            <span class="r86 r">m_resource</span>.<span class="i">AddOption</span>(<span class="r87 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="r87 r">entry</span>.<span class="i">Value</span>, 1);
                        }
                    }
                }
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r79 r">fragment</span>))
                {
                    <span class="r86 r">m_resource</span>.<a href="Interop.cs.html#ddea013bf45bd8d7" class="i property">FragmentPath</a> = <span class="r79 r">fragment</span>;
                }
 
                <b>if</b> (<span class="r80 r">dialect</span> != <b>null</b>)
                {
                    <span class="r86 r">m_resource</span>.<a href="Interop.cs.html#fd982abee642ac5a" class="i property">FragmentDialect</a> = <span class="r80 r">dialect</span>.<span class="i">ToString</span>();
                }
            }
            <b>catch</b> (<span class="i">COMException</span> <span id="r88 rd" class="r88 r">ex</span>)
            {
                <span class="i">AssertError</span>(<span class="r88 r">ex</span>.<span class="i">Message</span>, <b>false</b>, <b>null</b>);
            }
 
            <b>return</b> <span class="r86 r">m_resource</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Used to resolve authentication from the parameters chosen by the user.</span>
        <span class="c">///</span><span class="c"> User has the following options:</span>
        <span class="c">///</span><span class="c"> 1. AuthMechanism + Credential</span>
        <span class="c">///</span><span class="c"> 2. CertificateThumbPrint</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> All the above are mutually exclusive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is ambiguity as specified above.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="865e482b1cd629c3" href="R/865e482b1cd629c3.html" target="n" data-glyph="74,1" class="i method">ValidateSpecifiedAuthentication</a>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a> <span id="r89 rd" class="r89 r">authentication</span>, <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a> <span id="r90 rd" class="r90 r">credential</span>, <b>string</b> <span id="r91 rd" class="r91 r">certificateThumbprint</span>)
        {
            <b>if</b> ((<span class="r90 r">credential</span> != <b>null</b>) &amp;&amp; (<span class="r91 r">certificateThumbprint</span> != <b>null</b>))
            {
                <b>string</b> <span id="r92 rd" class="r92 r">message</span> = <a href="#541702e1c2bde51f" class="i method">FormatResourceMsgFromResourcetextS</a>(
                    <span class="s">&quot;AmbiguosAuthentication&quot;</span>,
                        <span class="s">&quot;CertificateThumbPrint&quot;</span>, <span class="s">&quot;credential&quot;</span>);
 
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r92 r">message</span>);
            }
 
            <b>if</b> ((<span class="r89 r">authentication</span> != <a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#f40f6f246e68877b" class="i field">Default</a>) &amp;&amp;
                (<span class="r89 r">authentication</span> != <a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#f3e9557f901d3a36" class="i field">ClientCertificate</a>) &amp;&amp;
                (<span class="r91 r">certificateThumbprint</span> != <b>null</b>))
            {
                <b>string</b> <span id="r93 rd" class="r93 r">message</span> = <span class="i">FormatResourceMsgFromResourcetextS</span>(
                    <span class="s">&quot;AmbiguosAuthentication&quot;</span>,
                        <span class="s">&quot;CertificateThumbPrint&quot;</span>, <span class="r89 r">authentication</span>.<span class="i">ToString</span>());
 
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r93 r">message</span>);
            }
        }
 
        <b>internal</b> <a href="Interop.cs.html#9141d9ac4bfab2f3" class="t t">IWSManSession</a> <a id="33c6c03a0959c643" href="R/33c6c03a0959c643.html" target="n" data-glyph="74,1" class="i method">CreateSessionObject</a>(<a href="Interop.cs.html#3aa0212e531a5219" class="t t">IWSManEx</a> <span id="r94 rd" class="r94 r">wsmanObject</span>, <a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a> <span id="r95 rd" class="r95 r">authentication</span>, <a href="/Microsoft.WSMan.Runtime/A.html#0ae1495c5b1dc50e" class="t t">SessionOption</a> <span id="r96 rd" class="r96 r">sessionoption</span>, <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a> <span id="r97 rd" class="r97 r">credential</span>, <b>string</b> <span id="r98 rd" class="r98 r">connectionString</span>, <b>string</b> <span id="r99 rd" class="r99 r">certificateThumbprint</span>, <b>bool</b> <span id="r100 rd" class="r100 r">usessl</span>)
        {
            <a href="#865e482b1cd629c3" class="i method">ValidateSpecifiedAuthentication</a>(<span class="r95 r">authentication</span>, <span class="r97 r">credential</span>, <span class="r99 r">certificateThumbprint</span>);
 
            <span class="c">////if authentication is given</span>
            <b>int</b> <span id="r101 rd" class="r101 r">sessionFlags</span> = 0;
 
            <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">ToString</span>() != <b>null</b>)
            {
                <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#5d203867b06a1741" class="i field">None</a>))
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#bc6879c412f9a2a1" class="i field">WSManFlagUseNoAuthentication</a>;
                }
 
                <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#b5a6c6ab5214c078" class="i field">Basic</a>))
                {
                    <span class="r101 r">sessionFlags</span> = <span class="r101 r">sessionFlags</span> | (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#a4a9f6cac7f24bf9" class="i field">WSManFlagUseBasic</a> | (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#051afc60314ae6a7" class="i field">WSManFlagCredUserNamePassword</a>;
                }
 
                <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#d5a22bd23eb85630" class="i field">Negotiate</a>))
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#4cc06d541651eecf" class="i field">WSManFlagUseNegotiate</a>;
                }
 
                <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#7198fb004c53bfd3" class="i field">Kerberos</a>))
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#c36a3268499fb8f5" class="i field">WSManFlagUseKerberos</a>;
                }
 
                <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#230d839ed93e13d1" class="i field">Digest</a>))
                {
                    <span class="r101 r">sessionFlags</span> = <span class="r101 r">sessionFlags</span> | (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#993c9242e4e2f72b" class="i field">WSManFlagUseDigest</a> | (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#051afc60314ae6a7" class="i field">WSManFlagCredUserNamePassword</a>;
                }
 
                <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#82d5f54fbf584a64" class="i field">Credssp</a>))
                {
                    <span class="r101 r">sessionFlags</span> = <span class="r101 r">sessionFlags</span> | (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#fe3c95f6e794fc4d" class="i field">WSManFlagUseCredSsp</a> | (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#051afc60314ae6a7" class="i field">WSManFlagCredUserNamePassword</a>;
                }
 
                <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#f3e9557f901d3a36" class="i field">ClientCertificate</a>))
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#0e6771936ce88ccd" class="i field">WSManFlagUseClientCertificate</a>;
                }
            }
 
            <a href="Interop.cs.html#bfd1f0b7a9c656f5" class="t t">IWSManConnectionOptionsEx2</a> <span id="r102 rd" class="r102 r">connObject</span> = (<a href="Interop.cs.html#bfd1f0b7a9c656f5" class="t t">IWSManConnectionOptionsEx2</a>)<span class="r94 r">wsmanObject</span>.<a href="Interop.cs.html#4690065ae315edda" class="i method">CreateConnectionOptions</a>();
            <b>if</b> (<span class="r97 r">credential</span> != <b>null</b>)
            {
                <span class="c">// connObject = (IWSManConnectionOptionsEx2)wsmanObject.CreateConnectionOptions();</span>
                <span class="i n">System</span>.<span class="i">Net</span>.<span class="i">NetworkCredential</span> <span id="r103 rd" class="r103 r">nwCredential</span> = <b>new</b> <span class="i n">System</span>.<span class="i">Net</span>.<span class="i">NetworkCredential</span>();
                <b>if</b> (<span class="r97 r">credential</span>.<a href="/System.Management.Automation/A.html#3fca673651eaeaff" class="i property">UserName</a> != <b>null</b>)
                {
                    <span class="r103 r">nwCredential</span> = <span class="r97 r">credential</span>.<span class="i">GetNetworkCredential</span>();
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r103 r">nwCredential</span>.<span class="i">Domain</span>))
                    {
                        <b>if</b> (<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#230d839ed93e13d1" class="i field">Digest</a>) || <span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#b5a6c6ab5214c078" class="i field">Basic</a>))
                        {
                            <span class="r102 r">connObject</span>.<a href="Interop.cs.html#59e5fd12d2a6bbac" class="i property">UserName</a> = <span class="r103 r">nwCredential</span>.<span class="i">UserName</span>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// just wanted to not use null domain, empty is actually fine</span>
                            <span class="r102 r">connObject</span>.<a href="Interop.cs.html#59e5fd12d2a6bbac" class="i property">UserName</a> = <span class="s">&quot;\\&quot;</span> + <span class="r103 r">nwCredential</span>.<span class="i">UserName</span>;
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r102 r">connObject</span>.<a href="Interop.cs.html#59e5fd12d2a6bbac" class="i property">UserName</a> = <span class="r103 r">nwCredential</span>.<span class="i">Domain</span> + <span class="s">&quot;\\&quot;</span> + <span class="r103 r">nwCredential</span>.<span class="i">UserName</span>;
                    }
 
                    <span class="r102 r">connObject</span>.<a href="Interop.cs.html#7cdb18e2a7fe2aea" class="i property">Password</a> = <span class="r103 r">nwCredential</span>.<span class="i">Password</span>;
                    <b>if</b> (!<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#82d5f54fbf584a64" class="i field">Credssp</a>) || !<span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#230d839ed93e13d1" class="i field">Digest</a>) || <span class="r95 r">authentication</span>.<span class="i">Equals</span>(<a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a>.<a href="Interop.cs.html#b5a6c6ab5214c078" class="i field">Basic</a>))
                    {
                        <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#051afc60314ae6a7" class="i field">WSManFlagCredUserNamePassword</a>;
                    }
                }
            }
 
            <b>if</b> (<span class="r99 r">certificateThumbprint</span> != <b>null</b>)
            {
                <span class="r102 r">connObject</span>.<a href="Interop.cs.html#fa076da81ad19f40" class="i property">CertificateThumbprint</a> = <span class="r99 r">certificateThumbprint</span>;
                <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#0e6771936ce88ccd" class="i field">WSManFlagUseClientCertificate</a>;
            }
 
            <b>if</b> (<span class="r96 r">sessionoption</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#a21e2e7d8ffbee34" class="i property">ProxyAuthentication</a> != 0)
                {
                    <b>int</b> <span id="r104 rd" class="r104 r">ProxyAccessflags</span> = 0;
                    <b>int</b> <span id="r105 rd" class="r105 r">ProxyAuthenticationFlags</span> = 0;
                    <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#91b7fe33c1a95a13" class="i property">ProxyAccessType</a>.<span class="i">Equals</span>(<a href="/Microsoft.WSMan.Runtime/A.html#ccfe55a5dd86b101" class="t t">ProxyAccessType</a>.<a href="/Microsoft.WSMan.Runtime/A.html#9235d261d051d71a" class="i field">ProxyIEConfig</a>))
                    {
                        <span class="r104 r">ProxyAccessflags</span> = <span class="r102 r">connObject</span>.<a href="Interop.cs.html#2630976534ca7b46" class="i method">ProxyIEConfig</a>();
                    }
                    <b>else</b> <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#91b7fe33c1a95a13" class="i property">ProxyAccessType</a>.<span class="i">Equals</span>(<a href="/Microsoft.WSMan.Runtime/A.html#ccfe55a5dd86b101" class="t t">ProxyAccessType</a>.<a href="/Microsoft.WSMan.Runtime/A.html#396231107b4d8473" class="i field">ProxyAutoDetect</a>))
                    {
                        <span class="r104 r">ProxyAccessflags</span> = <span class="r102 r">connObject</span>.<a href="Interop.cs.html#91746c54c6591536" class="i method">ProxyAutoDetect</a>();
                    }
                    <b>else</b> <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#91b7fe33c1a95a13" class="i property">ProxyAccessType</a>.<span class="i">Equals</span>(<a href="/Microsoft.WSMan.Runtime/A.html#ccfe55a5dd86b101" class="t t">ProxyAccessType</a>.<a href="/Microsoft.WSMan.Runtime/A.html#89cdb511f20e3915" class="i field">ProxyNoProxyServer</a>))
                    {
                        <span class="r104 r">ProxyAccessflags</span> = <span class="r102 r">connObject</span>.<a href="Interop.cs.html#0187491598d428c2" class="i method">ProxyNoProxyServer</a>();
                    }
                    <b>else</b> <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#91b7fe33c1a95a13" class="i property">ProxyAccessType</a>.<span class="i">Equals</span>(<a href="/Microsoft.WSMan.Runtime/A.html#ccfe55a5dd86b101" class="t t">ProxyAccessType</a>.<a href="/Microsoft.WSMan.Runtime/A.html#067d9d4a441918c3" class="i field">ProxyWinHttpConfig</a>))
                    {
                        <span class="r104 r">ProxyAccessflags</span> = <span class="r102 r">connObject</span>.<a href="Interop.cs.html#525831f9c5b607a8" class="i method">ProxyWinHttpConfig</a>();
                    }
 
                    <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#a21e2e7d8ffbee34" class="i property">ProxyAuthentication</a>.<span class="i">Equals</span>(<a href="/Microsoft.WSMan.Runtime/A.html#bb97a98ae04e7225" class="t t">ProxyAuthentication</a>.<a href="/Microsoft.WSMan.Runtime/A.html#7979cdb9d4284510" class="i field">Basic</a>))
                    {
                        <span class="r105 r">ProxyAuthenticationFlags</span> = <span class="r102 r">connObject</span>.<a href="Interop.cs.html#3def4b44b01a246c" class="i method">ProxyAuthenticationUseBasic</a>();
                    }
                    <b>else</b> <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#a21e2e7d8ffbee34" class="i property">ProxyAuthentication</a>.<span class="i">Equals</span>(<a href="/Microsoft.WSMan.Runtime/A.html#bb97a98ae04e7225" class="t t">ProxyAuthentication</a>.<a href="/Microsoft.WSMan.Runtime/A.html#b39b83fa2244c141" class="i field">Negotiate</a>))
                    {
                        <span class="r105 r">ProxyAuthenticationFlags</span> = <span class="r102 r">connObject</span>.<a href="Interop.cs.html#76f40a95f1e3ccf8" class="i method">ProxyAuthenticationUseNegotiate</a>();
                    }
                    <b>else</b> <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#a21e2e7d8ffbee34" class="i property">ProxyAuthentication</a>.<span class="i">Equals</span>(<a href="/Microsoft.WSMan.Runtime/A.html#bb97a98ae04e7225" class="t t">ProxyAuthentication</a>.<a href="/Microsoft.WSMan.Runtime/A.html#f7377c012e21828b" class="i field">Digest</a>))
                    {
                        <span class="r105 r">ProxyAuthenticationFlags</span> = <span class="r102 r">connObject</span>.<a href="Interop.cs.html#8c50e210e990c295" class="i method">ProxyAuthenticationUseDigest</a>();
                    }
 
                    <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#8f4b0ee577ff821e" class="i property">ProxyCredential</a> != <b>null</b>)
                    {
                        <b>try</b>
                        {
                            <span class="r102 r">connObject</span>.<span class="i">SetProxy</span>(<span class="r104 r">ProxyAccessflags</span>, <span class="r105 r">ProxyAuthenticationFlags</span>, <span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#8f4b0ee577ff821e" class="i property">ProxyCredential</a>.<span class="i">UserName</span>, <span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#8f4b0ee577ff821e" class="i property">ProxyCredential</a>.<span class="i">Password</span>);
                        }
                        <b>catch</b> (<span class="i">Exception</span> <span id="r106 rd" class="r106 r">ex</span>)
                        {
                            <span class="i">AssertError</span>(<span class="r106 r">ex</span>.<span class="i">Message</span>, <b>false</b>, <b>null</b>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r102 r">connObject</span>.<a href="Interop.cs.html#bf49c089ad385c4b" class="i method">SetProxy</a>((<b>int</b>)<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#91b7fe33c1a95a13" class="i property">ProxyAccessType</a>, (<b>int</b>)<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#a21e2e7d8ffbee34" class="i property">ProxyAuthentication</a>, <b>null</b>, <b>null</b>);
                    }
                }
 
                <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#0ebdc9694308b378" class="i property">SkipCACheck</a>)
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#723f9aabe241a417" class="i field">WSManFlagSkipCACheck</a>;
                }
 
                <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#5fd97eb963365868" class="i property">SkipCNCheck</a>)
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#0fee699009368d63" class="i field">WSManFlagSkipCNCheck</a>;
                }
 
                <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#bb532bd2443e5dbe" class="i property">SPNPort</a> &gt; 0)
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#aa02f9f62198a742" class="i field">WSManFlagEnableSpnServerPort</a>;
                }
 
                <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#0ab9418058fb27ab" class="i property">UseUtf16</a>)
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#5f8e32c8158a72af" class="i field">WSManFlagUtf16</a>;
                }
                <b>else</b>
                {
                    <span class="c">// If UseUtf16 is false, then default Encoding is Utf8</span>
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#4c4e9b887a5ba5b1" class="i field">WSManFlagUtf8</a>;
                }
 
                <b>if</b> (!<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#c2f8d8ec6c2f18c4" class="i property">UseEncryption</a>)
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#75338c04d1522589" class="i field">WSManFlagNoEncryption</a>;
                }
 
                <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#f98901bb45ee9e2e" class="i property">SkipRevocationCheck</a>)
                {
                    <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#f4c176876b25fcea" class="i field">WSManFlagSkipRevocationCheck</a>;
                }
            }
            <b>else</b>
            {
                <span class="c">// If SessionOption is null then, default Encoding is Utf8</span>
                <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#4c4e9b887a5ba5b1" class="i field">WSManFlagUtf8</a>;
            }
 
            <b>if</b> (<span class="r100 r">usessl</span>)
            {
                <span class="r101 r">sessionFlags</span> |= (<b>int</b>)<a href="Interop.cs.html#3cb6095a010a7d5f" class="t t">WSManSessionFlags</a>.<a href="Interop.cs.html#ab77ad38cca41ba1" class="i field">WSManFlagUseSsl</a>;
            }
 
            <a href="Interop.cs.html#9141d9ac4bfab2f3" class="t t">IWSManSession</a> <span id="r107 rd" class="r107 r">m_SessionObj</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r107 r">m_SessionObj</span> = (<a href="Interop.cs.html#9141d9ac4bfab2f3" class="t t">IWSManSession</a>)<span class="r94 r">wsmanObject</span>.<a href="Interop.cs.html#345bb344eefe3b4d" class="i method">CreateSession</a>(<span class="r98 r">connectionString</span>, <span class="r101 r">sessionFlags</span>, <span class="r102 r">connObject</span>);
                <b>if</b> (<span class="r96 r">sessionoption</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#f97c9b84f2bb8c57" class="i property">OperationTimeout</a> &gt; 0)
                    {
                        <span class="r107 r">m_SessionObj</span>.<a href="Interop.cs.html#6b8116a8ac7c9716" class="i property">Timeout</a> = <span class="r96 r">sessionoption</span>.<a href="/Microsoft.WSMan.Runtime/A.html#f97c9b84f2bb8c57" class="i property">OperationTimeout</a>;
                    }
                }
            }
            <b>catch</b> (<span class="i">COMException</span> <span id="r108 rd" class="r108 r">ex</span>)
            {
                <span class="i">AssertError</span>(<span class="r108 r">ex</span>.<span class="i">Message</span>, <b>false</b>, <b>null</b>);
            }
 
            <b>return</b> <span class="r107 r">m_SessionObj</span>;
        }
 
        <b>internal void</b> <a id="433651e64d8d5f3a" href="R/433651e64d8d5f3a.html" target="n" data-glyph="74,1" class="i method">CleanUp</a>()
        {
            <b>if</b> (<a href="#0e5390cc2770767f" class="i field">_sr</a> != <b>null</b>)
            {
                <a href="#0e5390cc2770767f" class="i field">_sr</a>.<span class="i">Dispose</span>();
                <a href="#0e5390cc2770767f" class="i field">_sr</a> = <b>null</b>;
            }
 
            <b>if</b> (<a href="#41afc7734fd65d39" class="i field">_fs</a> != <b>null</b>)
            {
                <a href="#41afc7734fd65d39" class="i field">_fs</a>.<span class="i">Dispose</span>();
                <a href="#41afc7734fd65d39" class="i field">_fs</a> = <b>null</b>;
            }
        }
 
        <b>internal string</b> <a id="45a32e7613e7eee5" href="R/45a32e7613e7eee5.html" target="n" data-glyph="74,1" class="i method">GetFilterString</a>(<span class="i">Hashtable</span> <span id="r109 rd" class="r109 r">seletorset</span>)
        {
            <span class="i">StringBuilder</span> <span id="r110 rd" class="r110 r">filter</span> = <b>new</b> <span class="i">StringBuilder</span>();
            <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r111 rd" class="r111 r">entry</span> <b>in</b> <span class="r109 r">seletorset</span>)
            {
                <b>if</b> (<span class="r111 r">entry</span>.<span class="i">Key</span> != <b>null</b> &amp;&amp; <span class="r111 r">entry</span>.<span class="i">Value</span> != <b>null</b>)
                {
                    <span class="r110 r">filter</span>.<span class="i">Append</span>(<span class="r111 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>());
                    <span class="r110 r">filter</span>.<span class="i">Append</span>(<span class="s">&#39;=&#39;</span>);
                    <span class="r110 r">filter</span>.<span class="i">Append</span>(<span class="r111 r">entry</span>.<span class="i">Value</span>.<span class="i">ToString</span>());
                    <span class="r110 r">filter</span>.<span class="i">Append</span>(<span class="s">&#39;+&#39;</span>);
                }
            }
 
            <span class="r110 r">filter</span>.<span class="i">Remove</span>(<span class="r110 r">filter</span>.<span class="i">ToString</span>().<span class="i">Length</span> - 1, 1);
            <b>return</b> <span class="r110 r">filter</span>.<span class="i">ToString</span>();
        }
 
        <b>internal void</b> <a id="92f70e98e0874aef" href="R/92f70e98e0874aef.html" target="n" data-glyph="74,1" class="i method">AssertError</a>(<b>string</b> <span id="r112 rd" class="r112 r">ErrorMessage</span>, <b>bool</b> <span id="r113 rd" class="r113 r">IsWSManError</span>, <b>object</b> <span id="r114 rd" class="r114 r">targetobject</span>)
        {
            <b>if</b> (<span class="r113 r">IsWSManError</span>)
            {
                <span class="i">XmlDocument</span> <span id="r115 rd" class="r115 r">ErrorDoc</span> = <b>new</b> <span class="i">XmlDocument</span>();
                <span class="r115 r">ErrorDoc</span>.<span class="i">LoadXml</span>(<span class="r112 r">ErrorMessage</span>);
                <span class="i">InvalidOperationException</span> <span id="r116 rd" class="r116 r">ex</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r115 r">ErrorDoc</span>.<span class="i">OuterXml</span>);
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r117 rd" class="r117 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r116 r">ex</span>, <span class="s">&quot;WsManError&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r114 r">targetobject</span>);
                <b>if</b> (<a href="#ef1b91ca63230ac1" class="i field">cmdletname</a> != <b>null</b>)
                {
                    <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a>.<span class="i">ThrowTerminatingError</span>(<span class="r117 r">er</span>);
                }
                <b>else</b>
                {
                    <a href="#0758e080b619461a" class="i field">_provider</a>.<span class="i">ThrowTerminatingError</span>(<span class="r117 r">er</span>);
                }
            }
            <b>else</b>
            {
                <span class="i">InvalidOperationException</span> <span id="r118 rd" class="r118 r">ex</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r112 r">ErrorMessage</span>);
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r119 rd" class="r119 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r118 r">ex</span>, <span class="s">&quot;WsManError&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r114 r">targetobject</span>);
                <b>if</b> (<a href="#ef1b91ca63230ac1" class="i field">cmdletname</a> != <b>null</b>)
                {
                    <a href="#ef1b91ca63230ac1" class="i field">cmdletname</a>.<span class="i">ThrowTerminatingError</span>(<span class="r119 r">er</span>);
                }
                <b>else</b>
                {
                    <a href="#0758e080b619461a" class="i field">_provider</a>.<span class="i">ThrowTerminatingError</span>(<span class="r119 r">er</span>);
                }
            }
        }
 
        <b>internal string</b> <a id="55aa9f7ea5c86e48" href="R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetURIWithFilter</a>(<b>string</b> <span id="r120 rd" class="r120 r">uri</span>, <b>string</b> <span id="r121 rd" class="r121 r">filter</span>, <span class="i">Hashtable</span> <span id="r122 rd" class="r122 r">selectorset</span>, <b>string</b> <span id="r123 rd" class="r123 r">operation</span>)
        {
            <span class="i">StringBuilder</span> <span id="r124 rd" class="r124 r">sburi</span> = <b>new</b> <span class="i">StringBuilder</span>();
            <span class="r124 r">sburi</span>.<span class="i">Append</span>(<span class="r120 r">uri</span>);
            <span class="r124 r">sburi</span>.<span class="i">Append</span>(<span class="s">&#39;?&#39;</span>);
 
            <b>if</b> (<span class="r123 r">operation</span>.<span class="i">Equals</span>(<span class="s">&quot;remove&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r124 r">sburi</span>.<span class="i">Append</span>(<a href="#45a32e7613e7eee5" class="i method">GetFilterString</a>(<span class="r122 r">selectorset</span>));
                <b>if</b> (<span class="r124 r">sburi</span>.<span class="i">ToString</span>().<span class="i">EndsWith</span>(<span class="s">&#39;?&#39;</span>))
                {
                    <span class="r124 r">sburi</span>.<span class="i">Remove</span>(<span class="r124 r">sburi</span>.<span class="i">Length</span> - 1, 1);
                }
            }
 
            <b>return</b> <span class="r124 r">sburi</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method is used by Connect-WsMan Cmdlet and New-Item of WsMan Provider to create connection to WsMan.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">ParameterSetName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">connectionuri</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r127 r">port</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r128 r">computername</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r129 r">applicationname</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r130 r">usessl</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r131 r">authentication</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r132 r">sessionoption</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r133 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r134 r">certificateThumbprint</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="f58307aa4d32e17e" href="R/f58307aa4d32e17e.html" target="n" data-glyph="74,1" class="i method">CreateWsManConnection</a>(<b>string</b> <span id="r125 rd" class="r125 r">ParameterSetName</span>, <span class="i">Uri</span> <span id="r126 rd" class="r126 r">connectionuri</span>, <b>int</b> <span id="r127 rd" class="r127 r">port</span>, <b>string</b> <span id="r128 rd" class="r128 r">computername</span>, <b>string</b> <span id="r129 rd" class="r129 r">applicationname</span>, <b>bool</b> <span id="r130 rd" class="r130 r">usessl</span>, <a href="Interop.cs.html#8c52f9e63ca21bfc" class="t t">AuthenticationMechanism</a> <span id="r131 rd" class="r131 r">authentication</span>, <a href="/Microsoft.WSMan.Runtime/A.html#0ae1495c5b1dc50e" class="t t">SessionOption</a> <span id="r132 rd" class="r132 r">sessionoption</span>, <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a> <span id="r133 rd" class="r133 r">credential</span>, <b>string</b> <span id="r134 rd" class="r134 r">certificateThumbprint</span>)
        {
            <a href="Interop.cs.html#3aa0212e531a5219" class="t t">IWSManEx</a> <span id="r135 rd" class="r135 r">m_wsmanObject</span> = (<a href="Interop.cs.html#3aa0212e531a5219" class="t t">IWSManEx</a>)<b>new</b> <span class="t">WSManClass</span>();
            <b>try</b>
            {
                <b>string</b> <span id="r136 rd" class="r136 r">connectionStr</span> = <a href="#f6d1a48cb95ecd54" class="i method">CreateConnectionString</a>(<span class="r126 r">connectionuri</span>, <span class="r127 r">port</span>, <span class="r128 r">computername</span>, <span class="r129 r">applicationname</span>);
                <b>if</b> (<span class="r126 r">connectionuri</span> != <b>null</b>)
                {
                    <span class="c">// in the format http(s)://server[:port/applicationname]</span>
                    <b>string</b>[] <span id="r137 rd" class="r137 r">constrsplit</span> = <span class="r136 r">connectionStr</span>.<span class="i">Split</span>(<span class="s">&quot;:&quot;</span> + <span class="r127 r">port</span> + <span class="s">&quot;/&quot;</span> + <span class="r129 r">applicationname</span>, <span class="i">StringSplitOptions</span>.<span class="i">None</span>);
                    <b>string</b>[] <span id="r138 rd" class="r138 r">constrsplit1</span> = <span class="r137 r">constrsplit</span>[0].<span class="i">Split</span>(<span class="s">&quot;//&quot;</span>, <span class="i">StringSplitOptions</span>.<span class="i">None</span>);
                    <span class="r128 r">computername</span> = <span class="r138 r">constrsplit1</span>[1].<span class="i">Trim</span>();
                }
 
                <a href="Interop.cs.html#9141d9ac4bfab2f3" class="t t">IWSManSession</a> <span id="r139 rd" class="r139 r">m_session</span> = <a href="#33c6c03a0959c643" class="i method">CreateSessionObject</a>(<span class="r135 r">m_wsmanObject</span>, <span class="r131 r">authentication</span>, <span class="r132 r">sessionoption</span>, <span class="r133 r">credential</span>, <span class="r136 r">connectionStr</span>, <span class="r134 r">certificateThumbprint</span>, <span class="r130 r">usessl</span>);
                <span class="r139 r">m_session</span>.<a href="Interop.cs.html#b816be17c9704db6" class="i method">Identify</a>(0);
                <b>string</b> <span id="r140 rd" class="r140 r">key</span> = <span class="r128 r">computername</span> ?? <span class="s">&quot;localhost&quot;</span>;
 
                <a href="#7c05e56b4a7334de" class="i method">AddtoDictionary</a>(<span class="r140 r">key</span>, <span class="r139 r">m_session</span>);
            }
            <b>catch</b> (<span class="i">IndexOutOfRangeException</span>)
            {
                <span class="i">AssertError</span>(<a href="#59cd1ce9c643a9d0" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NotProperURI&quot;</span>), <b>false</b>, <span class="r126 r">connectionuri</span>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r141 rd" class="r141 r">ex</span>)
            {
                <span class="i">AssertError</span>(<span class="r141 r">ex</span>.<span class="i">Message</span>, <b>false</b>, <span class="r128 r">computername</span>);
            }
            <b>finally</b>
            {
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r135 r">m_wsmanObject</span>.<a href="Interop.cs.html#adbb246bea676e48" class="i property">Error</a>))
                {
                    <a href="#92f70e98e0874aef" class="i method">AssertError</a>(<span class="r135 r">m_wsmanObject</span>.<a href="Interop.cs.html#adbb246bea676e48" class="i property">Error</a>, <b>true</b>, <span class="r128 r">computername</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies all the registry keys are set as expected. In case of failure .. try ecery second for 60 seconds before returning false.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r142 r">AllowFreshCredentialsValueShouldBePresent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if trying to Enable CredSSP.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r143 r">DelegateComputer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Names of the delegate computer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r144 r">applicationname</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of the application.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if valid.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="2f5c09e5dbc405e8" href="R/2f5c09e5dbc405e8.html" target="n" data-glyph="74,1" class="i method">ValidateCreadSSPRegistryRetry</a>(<b>bool</b> <span id="r142 rd" class="r142 r">AllowFreshCredentialsValueShouldBePresent</span>, <b>string</b>[] <span id="r143 rd" class="r143 r">DelegateComputer</span>, <b>string</b> <span id="r144 rd" class="r144 r">applicationname</span>)
        {
            <b>for</b> (<b>int</b> <span id="r145 rd" class="r145 r">i</span> = 0; <span class="r145 r">i</span> &lt; 60; <span class="r145 r">i</span>++)
            {
                <b>if</b> (!<a href="#3be8b8d1b1a60277" class="i method">ValidateCredSSPRegistry</a>(<span class="r142 r">AllowFreshCredentialsValueShouldBePresent</span>, <span class="r143 r">DelegateComputer</span>, <span class="r144 r">applicationname</span>))
                {
                    <span class="i">Thread</span>.<span class="i">Sleep</span>(1000);
                }
                <b>else</b>
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal bool</b> <a id="3be8b8d1b1a60277" href="R/3be8b8d1b1a60277.html" target="n" data-glyph="74,1" class="i method">ValidateCredSSPRegistry</a>(<b>bool</b> <span id="r146 rd" class="r146 r">AllowFreshCredentialsValueShouldBePresent</span>, <b>string</b>[] <span id="r147 rd" class="r147 r">DelegateComputer</span>, <b>string</b> <span id="r148 rd" class="r148 r">applicationname</span>)
        {
            <span class="i n">System</span>.<span class="i">IntPtr</span> <span id="r149 rd" class="r149 r">NakedGPOCriticalSection</span> = <a href="Interop.cs.html#4ec4633f43aef9c1" class="t t">GpoNativeApi</a>.<a href="Interop.cs.html#5ee249a997d9d251" class="i method">EnterCriticalPolicySection</a>(<b>true</b>);
 
            <b>try</b>
            {
                <span class="i">RegistryKey</span> <span id="r150 rd" class="r150 r">rGPOLocalMachineKey</span> = <span class="i">Registry</span>.<span class="i">LocalMachine</span>.<span class="i">OpenSubKey</span>(
                    <a href="#ad0d2c6a7becf011" class="i field">Registry_Path_Credentials_Delegation</a> + <span class="s">@&quot;\CredentialsDelegation&quot;</span>,
                    <span class="i">RegistryKeyPermissionCheck</span>.<span class="i">ReadWriteSubTree</span>,
                    <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">AccessControl</span>.<span class="i">RegistryRights</span>.<span class="i">FullControl</span>);
 
                <b>if</b> (<span class="r150 r">rGPOLocalMachineKey</span> != <b>null</b>)
                {
                    <span class="r150 r">rGPOLocalMachineKey</span> = <span class="r150 r">rGPOLocalMachineKey</span>.<span class="i">OpenSubKey</span>(
                        <a href="#32b89c752cb4fd5f" class="i field">Key_Allow_Fresh_Credentials</a>,
                        <span class="i">RegistryKeyPermissionCheck</span>.<span class="i">ReadWriteSubTree</span>,
                        <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">AccessControl</span>.<span class="i">RegistryRights</span>.<span class="i">FullControl</span>);
                    <b>if</b> (<span class="r150 r">rGPOLocalMachineKey</span> == <b>null</b>)
                    {
                        <b>return</b> !<span class="r146 r">AllowFreshCredentialsValueShouldBePresent</span>;
                    }
 
                    <b>string</b>[] <span id="r151 rd" class="r151 r">valuenames</span> = <span class="r150 r">rGPOLocalMachineKey</span>.<span class="i">GetValueNames</span>();
                    <b>if</b> (<span class="r151 r">valuenames</span>.<span class="i">Length</span> == 0)
                    {
                        <b>return</b> !<span class="r146 r">AllowFreshCredentialsValueShouldBePresent</span>;
                    }
 
                    <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r152 rd" class="r152 r">RegValues</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                    <b>foreach</b> (<b>string</b> <span id="r153 rd" class="r153 r">value</span> <b>in</b> <span class="r151 r">valuenames</span>)
                    {
                        <b>object</b> <span id="r154 rd" class="r154 r">keyvalue</span> = <span class="r150 r">rGPOLocalMachineKey</span>.<span class="i">GetValue</span>(<span class="r153 r">value</span>);
 
                        <b>if</b> (<span class="r154 r">keyvalue</span> != <b>null</b> &amp;&amp; <span class="r154 r">keyvalue</span>.<span class="i">ToString</span>().<span class="i">StartsWith</span>(<span class="r148 r">applicationname</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>if</b> (!<span class="r146 r">AllowFreshCredentialsValueShouldBePresent</span>)
                            {
                                <span class="c">// If calling Disable-CredSSP .. no value should start with &quot;applicationName&quot; regardless of the computer.</span>
                                <b>return</b> <b>false</b>;
                            }
 
                            <span class="r152 r">RegValues</span>.<span class="i">Add</span>(<span class="r154 r">keyvalue</span>.<span class="i">ToString</span>());
                        }
                    }
 
                    <b>if</b> (<span class="r146 r">AllowFreshCredentialsValueShouldBePresent</span>)
                    {
                        <span class="c">// For all the keys that starts with &quot;applicationName&quot; make sure the delegated computer is listed.</span>
                        <b>foreach</b> (<b>string</b> <span id="r155 rd" class="r155 r">comp</span> <b>in</b> <span class="r147 r">DelegateComputer</span>)
                        {
                            <b>if</b> (!<span class="r152 r">RegValues</span>.<span class="i">Contains</span>(<span class="r148 r">applicationname</span> + <span class="s">&quot;/&quot;</span> + <span class="r155 r">comp</span>))
                            {
                                <b>return</b> <b>false</b>;
                            }
                        }
                    }
                }
            }
            <b>finally</b>
            {
                <b>bool</b> <span id="r156 rd" class="r156 r">GPOReleaseCriticalSection</span> = <a href="Interop.cs.html#4ec4633f43aef9c1" class="t t">GpoNativeApi</a>.<a href="Interop.cs.html#c11a374d9211e521" class="i method">LeaveCriticalPolicySection</a>(<span class="r149 r">NakedGPOCriticalSection</span>);
            }
 
            <b>return</b> <b>true</b>;
        }
    }
 
    <b>internal static class</b> <a id="01aa2805e4ea892b" href="R/01aa2805e4ea892b.html" target="n" data-glyph="2,0" class="t t">WSManResourceLoader</a>
    {
        <b>internal static void</b> <a id="3c3f6ed7ca9e18d5" href="R/3c3f6ed7ca9e18d5.html" target="n" data-glyph="74,1" class="i method">LoadResourceData</a>()
        {
            <b>try</b>
            {
                <b>string</b> <span id="r157 rd" class="r157 r">filepath</span> = <span class="i n">System</span>.<span class="i">Environment</span>.<span class="i">ExpandEnvironmentVariables</span>(<span class="s">&quot;%Windir%&quot;</span>) + <span class="s">&quot;\\System32\\Winrm\\&quot;</span> +
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">CORECLR</span>
                    <span class="s">&quot;0409&quot;</span> <span class="c">/* TODO: don&#39;t assume it is always English on CSS? */</span>
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">                    string.Concat(&quot;0&quot;, string.Format(CultureInfo.CurrentCulture, &quot;{0:x2}&quot;, checked((uint)CultureInfo.CurrentUICulture.LCID)))
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                    + <span class="s">&quot;\\&quot;</span> + <span class="s">&quot;winrm.ini&quot;</span>;
                <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r157 r">filepath</span>))
                {
                    <span class="i">FileStream</span> <span id="r158 rd" class="r158 r">_fs</span> = <b>new</b> <span class="i">FileStream</span>(<span class="r157 r">filepath</span>, <span class="i">FileMode</span>.<span class="i">Open</span>, <span class="i">FileAccess</span>.<span class="i">Read</span>);
                    <span class="i">StreamReader</span> <span id="r159 rd" class="r159 r">_sr</span> = <b>new</b> <span class="i">StreamReader</span>(<span class="r158 r">_fs</span>);
                    <b>while</b> (!<span class="r159 r">_sr</span>.<span class="i">EndOfStream</span>)
                    {
                        <b>string</b> <span id="r160 rd" class="r160 r">Line</span> = <span class="r159 r">_sr</span>.<span class="i">ReadLine</span>();
                        <b>if</b> (<span class="r160 r">Line</span>.<span class="i">Contains</span>(<span class="s">&#39;=&#39;</span>))
                        {
                            <b>string</b>[] <span id="r161 rd" class="r161 r">arr</span> = <span class="r160 r">Line</span>.<span class="i">Split</span>(<span class="s">&#39;=&#39;</span>, <span class="i">count</span>: 2);
                            <b>if</b> (!<a href="#daa028dbfbca8391" class="i field">ResourceValueCache</a>.<span class="i">ContainsKey</span>(<span class="r161 r">arr</span>[0].<span class="i">Trim</span>()))
                            {
                                <b>string</b> <span id="r162 rd" class="r162 r">value</span> = <span class="r161 r">arr</span>[1].<span class="i">Trim</span>(<span class="s">&#39;&quot;&#39;</span>);
                                <a href="#daa028dbfbca8391" class="i field">ResourceValueCache</a>.<span class="i">Add</span>(<span class="r161 r">arr</span>[0].<span class="i">Trim</span>(), <span class="r162 r">value</span>.<span class="i">Trim</span>());
                            }
                        }
                    }
                }
            }
            <b>catch</b> (<span class="i">IOException</span>)
            {
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the resource value from WinRm.ini</span>
        <span class="c">///</span><span class="c"> from %windir%\system32\winrm\[Hexadecimal Language Folder]\winrm.ini.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r163 r">Key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="7d30168020c68dac" href="R/7d30168020c68dac.html" target="n" data-glyph="74,1" class="i method">GetResourceString</a>(<b>string</b> <span id="r163 rd" class="r163 r">Key</span>)
        {
            <span class="c">// Checks whether resource values already loaded and loads.</span>
            <b>if</b> (<a href="#daa028dbfbca8391" class="i field">ResourceValueCache</a>.<span class="i">Count</span> == 0)
            {
                <a href="#3c3f6ed7ca9e18d5" class="i method">LoadResourceData</a>();
            }
 
            <b>string</b> <span id="r164 rd" class="r164 r">value</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<a href="#daa028dbfbca8391" class="i field">ResourceValueCache</a>.<span class="i">ContainsKey</span>(<span class="r163 r">Key</span>.<span class="i">Trim</span>()))
            {
                <a href="#daa028dbfbca8391" class="i field">ResourceValueCache</a>.<span class="i">TryGetValue</span>(<span class="r163 r">Key</span>.<span class="i">Trim</span>(), <b>out</b> <span class="r164 r">value</span>);
            }
 
            <b>return</b> <span class="r164 r">value</span>.<span class="i">Trim</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <a id="daa028dbfbca8391" href="R/daa028dbfbca8391.html" target="n" data-glyph="46,1" class="i field">ResourceValueCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt;();
    }
}
</pre></td></tr></table></div></body></html>
