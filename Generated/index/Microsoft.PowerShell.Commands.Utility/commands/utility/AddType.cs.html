<!DOCTYPE html>
<html><head><title>AddType.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1353);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility/commands/utility/AddType.cs" target="_top">commands\utility\AddType.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility" target="_top">src\Microsoft.PowerShell.Commands.Utility\Microsoft.PowerShell.Commands.Utility.csproj</a> (Microsoft.PowerShell.Commands.Utility)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Immutable</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">Loader</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">CodeAnalysis</span>.<span class="i">CSharp</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">CodeAnalysis</span>.<span class="i">Emit</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">CodeAnalysis</span>.<span class="i">Text</span>;
<b>using</b> <span class="i">PathType</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Languages supported for code generation.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="7b09fcb6545b9de2" href="../../R/7b09fcb6545b9de2.html" target="n" data-glyph="18,0" class="t t"><span id="97a1ec6de12eefb0">Language</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The C# programming language.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="861f69c42c8ab9f4" href="../../R/861f69c42c8ab9f4.html" target="n" data-glyph="24,1" class="i field">CSharp</a>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Types supported for the OutputAssembly parameter.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="32f6e2ab478a8f4d" href="../../R/32f6e2ab478a8f4d.html" target="n" data-glyph="18,0" class="t t"><span id="cda45f3ac92a691f">OutputAssemblyType</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A Dynamically linked library (DLL).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="ee055ed0b21601d1" href="../../R/ee055ed0b21601d1.html" target="n" data-glyph="24,1" class="i field">Library</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An executable application that targets the console subsystem.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="1c08fb844ee9d397" href="../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">ConsoleApplication</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An executable application that targets the graphical subsystem.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="14bd2ea7b1016a32" href="../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">WindowsApplication</a>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Adds a new type to the Application Domain.</span>
    <span class="c">///</span><span class="c"> This version is based on CodeAnalysis (Roslyn).</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="/System.Management.Automation/A.html#d056c4b8c99405e5" class="t t">VerbsCommon</a>.<a href="/System.Management.Automation/A.html#ae1744bf7bfad73f" class="i field">Add</a>, <span class="s">&quot;Type&quot;</span>, <span class="i">DefaultParameterSetName</span> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096601&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">Type</span>))]
    <b>public sealed class</b> <a id="2173d1cbdf56709b" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="c9d4d73bf3742b36">AddTypeCommand</span></a> : <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The source code of this generated type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public string</b> <a id="7dfd1e90551cd97a" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">TypeDefinition</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ca43838b8b085158" class="i field">_sourceCode</a>;
            }
 
            <b>set</b>
            {
                <a href="#ca43838b8b085158" class="i field">_sourceCode</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the type (class) used for auto-generated types.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public string</b> <a id="029c0ecdb03b3ca8" href="../../R/029c0ecdb03b3ca8.html" target="n" data-glyph="102,1" class="i property">Name</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The source code of this generated method / member.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 1, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        <b>public string</b>[] <a id="09dd532cd928b232" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">MemberDefinition</a>
        {
            <b>get</b>
            {
                <b>return</b> <b>new</b> <b>string</b>[] { <a href="#ca43838b8b085158" class="i field">_sourceCode</a> };
            }
 
            <b>set</b>
            {
                <a href="#ca43838b8b085158" class="i field">_sourceCode</a> = <b>string</b>.<span class="i">Empty</span>;
 
                <b>if</b> (<b>value</b> != <b>null</b>)
                {
                    <a href="#ca43838b8b085158" class="i field">_sourceCode</a> = <b>string</b>.<span class="i">Join</span>(<span class="s">&quot;\n&quot;</span>, <b>value</b>);
                }
            }
        }
 
        <b>private string</b> <a id="ca43838b8b085158" href="../../R/ca43838b8b085158.html" target="n" data-glyph="46,1" class="i field">_sourceCode</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The namespace used for the auto-generated type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">AllowNull</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;NS&quot;</span>)]
        <b>public string</b> <a id="7a017bc8282e0570" href="../../R/7a017bc8282e0570.html" target="n" data-glyph="102,1" class="i property">Namespace</a> { <b>get</b>; <b>set</b>; } = <span class="s">&quot;Microsoft.PowerShell.Commands.AddType.AutoGeneratedTypes&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any using statements required by the auto-generated type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">ValidateNotNull</span>()]
        [<span class="i">Alias</span>(<span class="s">&quot;Using&quot;</span>)]
        <b>public string</b>[] <a id="9c8fadd3895c3f19" href="../../R/9c8fadd3895c3f19.html" target="n" data-glyph="102,1" class="i property">UsingNamespace</a> { <b>get</b>; <b>set</b>; } = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the source code or DLL to load.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2720514c5e27f84f" class="i field">FromPathParameterSetName</a>)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public string</b>[] <a id="34c85dc0402ea26a" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Path</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#8495a39e1a36be96" class="i field">_paths</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <a href="#8495a39e1a36be96" class="i field">_paths</a> = <b>null</b>;
                    <b>return</b>;
                }
 
                <b>string</b>[] <span id="r0 rd" class="r0 r">pathValue</span> = <b>value</b>;
 
                <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r1 rd" class="r1 r">resolvedPaths</span> = <b>new</b>();
 
                <span class="c">// Verify that the paths are resolved and valid</span>
                <b>foreach</b> (<b>string</b> <span id="r2 rd" class="r2 r">path</span> <b>in</b> <span class="r0 r">pathValue</span>)
                {
                    <span class="c">// Try to resolve the path</span>
                    <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r3 rd" class="r3 r">newPaths</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<span class="i">GetResolvedProviderPathFromPSPath</span>(<span class="r2 r">path</span>, <b>out</b> <a href="/System.Management.Automation/A.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <b>_</b>);
 
                    <span class="c">// If it didn&#39;t resolve, add the original back</span>
                    <span class="c">// for a better error message.</span>
                    <b>if</b> (<span class="r3 r">newPaths</span>.<span class="i">Count</span> == 0)
                    {
                        <span class="r1 r">resolvedPaths</span>.<span class="i">Add</span>(<span class="r2 r">path</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r1 r">resolvedPaths</span>.<span class="i">AddRange</span>(<span class="r3 r">newPaths</span>);
                    }
                }
 
                <a href="#74074695a307bb8f" class="i method">ProcessPaths</a>(<span class="r1 r">resolvedPaths</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The literal path to the source code or DLL to load.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#33416e799cc5358e" class="i field">FromLiteralPathParameterSetName</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;PSPath&quot;</span>, <span class="s">&quot;LP&quot;</span>)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public string</b>[] <a id="3dedc4c63f09a5af" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">LiteralPath</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#8495a39e1a36be96" class="i field">_paths</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <a href="#8495a39e1a36be96" class="i field">_paths</a> = <b>null</b>;
                    <b>return</b>;
                }
 
                <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r4 rd" class="r4 r">resolvedPaths</span> = <b>new</b>();
                <b>foreach</b> (<b>string</b> <span id="r5 rd" class="r5 r">path</span> <b>in</b> <b>value</b>)
                {
                    <b>string</b> <span id="r6 rd" class="r6 r">literalPath</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<span class="i">GetUnresolvedProviderPathFromPSPath</span>(<span class="r5 r">path</span>);
                    <span class="r4 r">resolvedPaths</span>.<span class="i">Add</span>(<span class="r6 r">literalPath</span>);
                }
 
                <a href="#74074695a307bb8f" class="i method">ProcessPaths</a>(<span class="r4 r">resolvedPaths</span>);
            }
        }
 
        <b>private void</b> <a id="74074695a307bb8f" href="../../R/74074695a307bb8f.html" target="n" data-glyph="76,1" class="i method">ProcessPaths</a>(<span class="i">List</span>&lt;<b>string</b>&gt; <span id="r7 rd" class="r7 r">resolvedPaths</span>)
        {
            <span class="c">// Validate file extensions.</span>
            <span class="c">// Make sure we don&#39;t mix source files from different languages (if we support any other languages in future).</span>
            <b>string</b> <span id="r8 rd" class="r8 r">activeExtension</span> = <b>null</b>;
            <b>foreach</b> (<b>string</b> <span id="r9 rd" class="r9 r">path</span> <b>in</b> <span class="r7 r">resolvedPaths</span>)
            {
                <b>string</b> <span id="r10 rd" class="r10 r">currentExtension</span> = <span class="i">PathType</span>.<span class="i">GetExtension</span>(<span class="r9 r">path</span>).<span class="i">ToUpperInvariant</span>();
 
                <b>switch</b> (<span class="r10 r">currentExtension</span>)
                {
                    <b>case</b> <span class="s">&quot;.CS&quot;</span>:
                        <a href="#dbe8c59442c7cb6f" class="i property">Language</a> = <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>;
                        <b>break</b>;
 
                    <b>case</b> <span class="s">&quot;.DLL&quot;</span>:
                        <a href="#a4e08177403ac557" class="i field">_loadAssembly</a> = <b>true</b>;
                        <b>break</b>;
 
                    <span class="c">// Throw an error if it is an unrecognized extension</span>
                    <b>default</b>:
                        <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r11 rd" class="r11 r">errorRecord</span> = <b>new</b>(
                            <b>new</b> <span class="i">Exception</span>(
                                <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">AddTypeStrings</span>.<span class="i">FileExtensionNotSupported</span>, <span class="r10 r">currentExtension</span>)),
                            <span class="s">&quot;EXTENSION_NOT_SUPPORTED&quot;</span>,
                            <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                            <span class="r10 r">currentExtension</span>);
 
                        <span class="i">ThrowTerminatingError</span>(<span class="r11 r">errorRecord</span>);
                        <b>break</b>;
                }
 
                <b>if</b> (<span class="r8 r">activeExtension</span> == <b>null</b>)
                {
                    <span class="r8 r">activeExtension</span> = <span class="r10 r">currentExtension</span>;
                }
                <b>else</b> <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r8 r">activeExtension</span>, <span class="r10 r">currentExtension</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="c">// All files must have the same extension otherwise throw.</span>
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r12 rd" class="r12 r">errorRecord</span> = <b>new</b>(
                        <b>new</b> <span class="i">Exception</span>(
                            <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">AddTypeStrings</span>.<span class="i">MultipleExtensionsNotSupported</span>)),
                        <span class="s">&quot;MULTIPLE_EXTENSION_NOT_SUPPORTED&quot;</span>,
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                        <span class="r10 r">currentExtension</span>);
 
                    <span class="i">ThrowTerminatingError</span>(<span class="r12 r">errorRecord</span>);
                }
            }
 
            <a href="#8495a39e1a36be96" class="i field">_paths</a> = <span class="r7 r">resolvedPaths</span>.<span class="i">ToArray</span>();
        }
 
        <b>private string</b>[] <a id="8495a39e1a36be96" href="../../R/8495a39e1a36be96.html" target="n" data-glyph="46,1" class="i field">_paths</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the assembly to load.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#9d0051f8a3a41503" class="i field">FromAssemblyNameParameterSetName</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;AN&quot;</span>)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public string</b>[] <a id="59e167449870d22c" href="../../R/59e167449870d22c.html" target="n" data-glyph="102,1" class="i property">AssemblyName</a> { <b>get</b>; <b>set</b>; }
 
        <b>private bool</b> <a id="a4e08177403ac557" href="../../R/a4e08177403ac557.html" target="n" data-glyph="46,1" class="i field">_loadAssembly</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The language used to compile the source code.</span>
        <span class="c">///</span><span class="c"> Default is C#.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        <b>public</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a> <a id="dbe8c59442c7cb6f" href="../../R/dbe8c59442c7cb6f.html" target="n" data-glyph="102,1" class="i property">Language</a> { <b>get</b>; <b>set</b>; } = <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Any reference DLLs to use in the compilation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2720514c5e27f84f" class="i field">FromPathParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#33416e799cc5358e" class="i field">FromLiteralPathParameterSetName</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;RA&quot;</span>)]
        <b>public string</b>[] <a id="b9a2e7559e42f39c" href="../../R/b9a2e7559e42f39c.html" target="n" data-glyph="102,1" class="i property">ReferencedAssemblies</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#eb51352c6453700a" class="i field">_referencedAssemblies</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> != <b>null</b>) { <a href="#eb51352c6453700a" class="i field">_referencedAssemblies</a> = <b>value</b>; }
            }
        }
 
        <b>private string</b>[] <a id="eb51352c6453700a" href="../../R/eb51352c6453700a.html" target="n" data-glyph="46,1" class="i field">_referencedAssemblies</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path to the output assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2720514c5e27f84f" class="i field">FromPathParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#33416e799cc5358e" class="i field">FromLiteralPathParameterSetName</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;OA&quot;</span>)]
        <b>public string</b> <a id="f92ad5bcd86ced15" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">OutputAssembly</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>;
            }
 
            <b>set</b>
            {
                <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a> = <b>value</b>;
 
                <b>if</b> (<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a> != <b>null</b>)
                {
                    <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a> = <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>.<span class="i">Trim</span>();
 
                    <span class="c">// Try to resolve the path</span>
                    <a href="/System.Management.Automation/A.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r13 rd" class="r13 r">provider</span> = <b>null</b>;
                    <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r14 rd" class="r14 r">newPaths</span> = <b>new</b>();
 
                    <b>try</b>
                    {
                        <span class="r14 r">newPaths</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<span class="i">GetResolvedProviderPathFromPSPath</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>, <b>out</b> <span class="r13 r">provider</span>);
                    }
                    <span class="c">// Ignore the ItemNotFound -- we handle it.</span>
                    <b>catch</b> (<a href="/System.Management.Automation/A.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a>) { }
 
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r15 rd" class="r15 r">errorRecord</span> = <b>new</b>(
                        <b>new</b> <span class="i">Exception</span>(
                            <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">AddTypeStrings</span>.<span class="i">OutputAssemblyDidNotResolve</span>, <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>)),
                        <span class="s">&quot;INVALID_OUTPUT_ASSEMBLY&quot;</span>,
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                        <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>);
 
                    <span class="c">// If it resolved to a non-standard provider,</span>
                    <span class="c">// generate an error.</span>
                    <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="s">&quot;FileSystem&quot;</span>, <span class="r13 r">provider</span>.<a href="/System.Management.Automation/A.html#2837d805ea30ef5c" class="i property">Name</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="i">ThrowTerminatingError</span>(<span class="r15 r">errorRecord</span>);
                        <b>return</b>;
                    }
 
                    <span class="c">// If it resolved to more than one path,</span>
                    <span class="c">// generate an error.</span>
                    <b>if</b> (<span class="r14 r">newPaths</span>.<span class="i">Count</span> &gt; 1)
                    {
                        <span class="i">ThrowTerminatingError</span>(<span class="r15 r">errorRecord</span>);
                        <b>return</b>;
                    }
                    <span class="c">// It didn&#39;t resolve to any files. They may</span>
                    <span class="c">// want to create the file.</span>
                    <b>else</b> <b>if</b> (<span class="r14 r">newPaths</span>.<span class="i">Count</span> == 0)
                    {
                        <span class="c">// We can&#39;t create one with wildcard characters</span>
                        <b>if</b> (<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>))
                        {
                            <span class="i">ThrowTerminatingError</span>(<span class="r15 r">errorRecord</span>);
                        }
                        <span class="c">// Create the file</span>
                        <b>else</b>
                        {
                            <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<span class="i">GetUnresolvedProviderPathFromPSPath</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>);
                        }
                    }
                    <span class="c">// It resolved to a single file</span>
                    <b>else</b>
                    {
                        <a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a> = <span class="r14 r">newPaths</span>[0];
                    }
                }
            }
        }
 
        <b>private string</b> <a id="3e3a00602dc7b81d" href="../../R/3e3a00602dc7b81d.html" target="n" data-glyph="46,1" class="i field">_outputAssembly</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output type of the assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2720514c5e27f84f" class="i field">FromPathParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#33416e799cc5358e" class="i field">FromLiteralPathParameterSetName</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;OT&quot;</span>)]
        <b>public</b> <a href="#32f6e2ab478a8f4d" class="t t">OutputAssemblyType</a> <a id="6abeb26cc10ca21f" href="../../R/6abeb26cc10ca21f.html" target="n" data-glyph="102,1" class="i property">OutputType</a> { <b>get</b>; <b>set</b>; } = <a href="#32f6e2ab478a8f4d" class="t t">OutputAssemblyType</a>.<a href="#ee055ed0b21601d1" class="i field">Library</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flag to pass the resulting types along.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>()]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="470642f88494cc64" href="../../R/470642f88494cc64.html" target="n" data-glyph="102,1" class="i property">PassThru</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flag to ignore warnings during compilation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2720514c5e27f84f" class="i field">FromPathParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#33416e799cc5358e" class="i field">FromLiteralPathParameterSetName</a>)]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="cd915c35d4c8bc23" href="../../R/cd915c35d4c8bc23.html" target="n" data-glyph="102,1" class="i property">IgnoreWarnings</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Roslyn command line parameters.</span>
        <span class="c">///</span><span class="c"> https://github.com/dotnet/roslyn/blob/master/docs/compilers/CSharp/CommandLine.md</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Parser options:</span>
        <span class="c">///</span><span class="c">     langversion:string - language version from:</span>
        <span class="c">///</span><span class="c">                                 [enum]::GetNames([Microsoft.CodeAnalysis.CSharp.LanguageVersion])</span>
        <span class="c">///</span><span class="c">     define:symbol list - preprocessor symbols:</span>
        <span class="c">///</span><span class="c">                                 /define:UNIX,DEBUG      - CSharp</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Compilation options:</span>
        <span class="c">///</span><span class="c">     optimize{+|-}            - optimization level</span>
        <span class="c">///</span><span class="c">     parallel{+|-}            - concurrent build</span>
        <span class="c">///</span><span class="c">     warnaserror{+|-}         - report warnings to errors</span>
        <span class="c">///</span><span class="c">     warnaserror{+|-}:strings - report specific warnings to errors</span>
        <span class="c">///</span><span class="c">     warn:number              - warning level (0-4) for CSharp</span>
        <span class="c">///</span><span class="c">     nowarn                   - disable all warnings</span>
        <span class="c">///</span><span class="c">     nowarn:strings           - disable a list of individual warnings</span>
        <span class="c">///</span><span class="c">     usings:strings           - &#39;;&#39;-delimited usings for CSharp</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Emit options:</span>
        <span class="c">///</span><span class="c">     platform:string          - limit which platforms this code can run on; must be x86, x64, Itanium, arm, AnyCPU32BitPreferred or anycpu (default)</span>
        <span class="c">///</span><span class="c">     delaysign{+|-}           - delay-sign the assembly using only the public portion of the strong name key</span>
        <span class="c">///</span><span class="c">     keyfile:file             - specifies a strong name key file</span>
        <span class="c">///</span><span class="c">     keycontainer:string      - specifies a strong name key container</span>
        <span class="c">///</span><span class="c">     highentropyva{+|-}       - enable high-entropy ASLR.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#2720514c5e27f84f" class="i field">FromPathParameterSetName</a>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#33416e799cc5358e" class="i field">FromLiteralPathParameterSetName</a>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b>[] <a id="a51f53bf922f7a3d" href="../../R/a51f53bf922f7a3d.html" target="n" data-glyph="102,1" class="i property">CompilerOptions</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> GererateSource
 
        <b>private string</b> <a id="84c47faf87a23f3f" href="../../R/84c47faf87a23f3f.html" target="n" data-glyph="76,1" class="i method">GenerateTypeSource</a>(<b>string</b> <span id="r16 rd" class="r16 r">typeNamespace</span>, <b>string</b> <span id="r17 rd" class="r17 r">typeName</span>, <b>string</b> <span id="r18 rd" class="r18 r">sourceCodeText</span>, <a href="#7b09fcb6545b9de2" class="t t">Language</a> <span id="r19 rd" class="r19 r">language</span>)
        {
            <b>string</b> <span id="r20 rd" class="r20 r">usingSource</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#b49294279246121e" class="i method">GetUsingTemplate</a>(<span class="r19 r">language</span>), <a href="#33c1b7471af9b7d6" class="i method">GetUsingSet</a>(<span class="r19 r">language</span>));
 
            <b>string</b> <span id="r21 rd" class="r21 r">typeSource</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#f13aacee30ce2097" class="i method">GetMethodTemplate</a>(<span class="r19 r">language</span>), <span class="r17 r">typeName</span>, <span class="r18 r">sourceCodeText</span>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r16 r">typeNamespace</span>))
            {
                <b>return</b> <span class="r20 r">usingSource</span> + <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#6ab7f082aae20ae0" class="i method">GetNamespaceTemplate</a>(<span class="r19 r">language</span>), <span class="r16 r">typeNamespace</span>, <span class="r21 r">typeSource</span>);
            }
            <b>else</b>
            {
                <b>return</b> <span class="r20 r">usingSource</span> + <span class="r21 r">typeSource</span>;
            }
        }
 
        <span class="c">// Get the -FromMember template for a given language</span>
        <b>private static string</b> <a id="f13aacee30ce2097" href="../../R/f13aacee30ce2097.html" target="n" data-glyph="76,1" class="i method">GetMethodTemplate</a>(<a href="#7b09fcb6545b9de2" class="t t">Language</a> <span id="r22 rd" class="r22 r">language</span>)
        {
            <b>switch</b> (<span class="r22 r">language</span>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <b>return</b>
                        <span class="s">&quot;    public class {0}\n&quot;</span> +
                        <span class="s">&quot;    {{\n&quot;</span> +
                        <span class="s">&quot;    {1}\n&quot;</span> +
                        <span class="s">&quot;    }}\n&quot;</span>;
            }
 
            <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
        }
 
        <span class="c">// Get the -FromMember namespace template for a given language</span>
        <b>private static string</b> <a id="6ab7f082aae20ae0" href="../../R/6ab7f082aae20ae0.html" target="n" data-glyph="76,1" class="i method">GetNamespaceTemplate</a>(<a href="#7b09fcb6545b9de2" class="t t">Language</a> <span id="r23 rd" class="r23 r">language</span>)
        {
            <b>switch</b> (<span class="r23 r">language</span>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <b>return</b>
                        <span class="s">&quot;namespace {0}\n&quot;</span> +
                        <span class="s">&quot;{{\n&quot;</span> +
                        <span class="s">&quot;{1}\n&quot;</span> +
                        <span class="s">&quot;}}\n&quot;</span>;
            }
 
            <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
        }
 
        <span class="c">// Get the -FromMember namespace template for a given language</span>
        <b>private static string</b> <a id="b49294279246121e" href="../../R/b49294279246121e.html" target="n" data-glyph="76,1" class="i method">GetUsingTemplate</a>(<a href="#7b09fcb6545b9de2" class="t t">Language</a> <span id="r24 rd" class="r24 r">language</span>)
        {
            <b>switch</b> (<span class="r24 r">language</span>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <b>return</b>
                        <span class="s">&quot;using System;\n&quot;</span> +
                        <span class="s">&quot;using System.Runtime.InteropServices;\n&quot;</span> +
                        <span class="s">&quot;{0}&quot;</span> +
                        <span class="s">&quot;\n&quot;</span>;
            }
 
            <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
        }
 
        <span class="c">// Generate the code for the using statements</span>
        <b>private string</b> <a id="33c1b7471af9b7d6" href="../../R/33c1b7471af9b7d6.html" target="n" data-glyph="76,1" class="i method">GetUsingSet</a>(<a href="#7b09fcb6545b9de2" class="t t">Language</a> <span id="r25 rd" class="r25 r">language</span>)
        {
            <span class="i">StringBuilder</span> <span id="r26 rd" class="r26 r">usingNamespaceSet</span> = <b>new</b>();
 
            <b>switch</b> (<span class="r25 r">language</span>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <b>foreach</b> (<b>string</b> <span id="r27 rd" class="r27 r">namespaceValue</span> <b>in</b> <a href="#9c8fadd3895c3f19" class="i property">UsingNamespace</a>)
                    {
                        <span class="r26 r">usingNamespaceSet</span>.<span class="i">Append</span>(<span class="s">&quot;using &quot;</span> + <span class="r27 r">namespaceValue</span> + <span class="s">&quot;;\n&quot;</span>);
                    }
 
                    <b>break</b>;
 
                <b>default</b>:
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
            }
 
            <b>return</b> <span class="r26 r">usingNamespaceSet</span>.<span class="i">ToString</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> GererateSource
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Prevent code compilation in ConstrainedLanguage mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="641188c8f3d99865" href="../../R/641188c8f3d99865.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <span class="c">// Prevent code compilation in ConstrainedLanguage mode</span>
            <b>if</b> (<a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#f2800307140e1fec" class="i property">LanguageMode</a> == <a href="/System.Management.Automation/A.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="/System.Management.Automation/A.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                        <b>new</b> <span class="t">PSNotSupportedException</span>(<span class="i">AddTypeStrings</span>.<span class="i">CannotDefineNewType</span>),
                        <b>nameof</b>(<span class="i">AddTypeStrings</span>.<span class="i">CannotDefineNewType</span>),
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#26ba13af79d30a75" class="i field">PermissionDenied</a>,
                        <span class="i">targetObject</span>: <b>null</b>));
            }
 
            <span class="c">// &#39;ConsoleApplication&#39; and &#39;WindowsApplication&#39; types are currently not working in .NET Core</span>
            <b>if</b> (<a href="#6abeb26cc10ca21f" class="i property">OutputType</a> != <a href="#32f6e2ab478a8f4d" class="t t">OutputAssemblyType</a>.<a href="#ee055ed0b21601d1" class="i field">Library</a>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                        <b>new</b> <span class="t">PSNotSupportedException</span>(<span class="i">AddTypeStrings</span>.<span class="i">AssemblyTypeNotSupported</span>),
                        <b>nameof</b>(<span class="i">AddTypeStrings</span>.<span class="i">AssemblyTypeNotSupported</span>),
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#8088845be39ec60c" class="i field">NotImplemented</a>,
                        <span class="i">targetObject</span>: <a href="#6abeb26cc10ca21f" class="i property">OutputType</a>));
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generate and load the type(s).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="369e9e2529ce79ee" href="../../R/369e9e2529ce79ee.html" target="n" data-glyph="75,1" class="i method">EndProcessing</a>()
        {
            <span class="c">// Generate an error if they&#39;ve specified an output</span>
            <span class="c">// assembly type without an output assembly</span>
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>) &amp;&amp; <a href="#2173d1cbdf56709b" class="k">this</a>.<a href="/System.Management.Automation/A.html#92387ec2f33e4d8f" class="i property">MyInvocation</a>.<a href="/System.Management.Automation/A.html#1927782a0117ff76" class="i property">BoundParameters</a>.<span class="i">ContainsKey</span>(<b>nameof</b>(<a href="#6abeb26cc10ca21f" class="i property">OutputType</a>)))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r28 rd" class="r28 r">errorRecord</span> = <b>new</b>(
                    <b>new</b> <span class="i">Exception</span>(
                        <b>string</b>.<span class="i">Format</span>(
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                            <span class="i">AddTypeStrings</span>.<span class="i">OutputTypeRequiresOutputAssembly</span>)),
                    <span class="s">&quot;OUTPUTTYPE_REQUIRES_ASSEMBLY&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                    <a href="#6abeb26cc10ca21f" class="i property">OutputType</a>);
 
                <span class="i">ThrowTerminatingError</span>(<span class="r28 r">errorRecord</span>);
                <b>return</b>;
            }
 
            <b>if</b> (<a href="#a4e08177403ac557" class="i field">_loadAssembly</a>)
            {
                <span class="c">// File extension is &quot;.DLL&quot; (ParameterSetName = FromPathParameterSetName or FromLiteralPathParameterSetName).</span>
                <span class="i">LoadAssemblies</span>(<a href="#8495a39e1a36be96" class="i field">_paths</a>);
            }
            <b>else</b> <b>if</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a> == <a href="#9d0051f8a3a41503" class="i field">FromAssemblyNameParameterSetName</a>)
            {
                <span class="i">LoadAssemblies</span>(<a href="#59e167449870d22c" class="i property">AssemblyName</a>);
            }
            <b>else</b>
            {
                <span class="c">// Process a source code from files or strings.</span>
                <a href="#292ef8332b5cf6ca" class="i method">SourceCodeProcessing</a>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> LoadAssembly
 
        <span class="c">// We now ship .NET Core&#39;s reference assemblies with PowerShell, so that Add-Type can work</span>
        <span class="c">// in a predictable way and won&#39;t be broken when we move to newer version of .NET Core.</span>
        <span class="c">// The reference assemblies are located at &#39;$PSHOME\ref&#39; for pwsh.</span>
        <span class="c">//</span>
        <span class="c">// For applications that host PowerShell, the &#39;ref&#39; folder will be deployed to the &#39;publish&#39;</span>
        <span class="c">// folder, not where &#39;System.Management.Automation.dll&#39; is located. So here we should use</span>
        <span class="c">// the entry assembly&#39;s location to construct the path to the &#39;ref&#39; folder.</span>
        <span class="c">// For pwsh, the entry assembly is &#39;pwsh.dll&#39;, so the entry assembly&#39;s location is still</span>
        <span class="c">// $PSHOME.</span>
        <span class="c">// However, &#39;Assembly.GetEntryAssembly()&#39; returns null when the managed code is called from</span>
        <span class="c">// unmanaged code (PowerShell WSMan remoting scenario), so in that case, we continue to use</span>
        <span class="c">// the location of &#39;System.Management.Automation.dll&#39;.</span>
        <b>private static readonly string</b> <a id="7679701df49595ba" href="../../R/7679701df49595ba.html" target="n" data-glyph="46,1" class="i field">s_netcoreAppRefFolder</a> = <span class="i">PathType</span>.<span class="i">Combine</span>(
            <span class="i">PathType</span>.<span class="i">GetDirectoryName</span>(
                (<span class="i">Assembly</span>.<span class="i">GetEntryAssembly</span>() ?? <b>typeof</b>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>).<span class="i">Assembly</span>).<span class="i">Location</span>),
            <span class="s">&quot;ref&quot;</span>);
 
        <span class="c">// Path to the folder where .NET Core runtime assemblies are located.</span>
        <b>private static readonly string</b> <a id="f81aa11f59a66f31" href="../../R/f81aa11f59a66f31.html" target="n" data-glyph="46,1" class="i field">s_frameworkFolder</a> = <span class="i">PathType</span>.<span class="i">GetDirectoryName</span>(<b>typeof</b>(<b>object</b>).<span class="i">Assembly</span>.<span class="i">Location</span>);
 
        <span class="c">// These assemblies are always automatically added to ReferencedAssemblies.</span>
        <b>private static readonly</b> <span class="i">Lazy</span>&lt;<span class="i">PortableExecutableReference</span>[]&gt; <a id="148e5e122fde8ffc" href="../../R/148e5e122fde8ffc.html" target="n" data-glyph="46,1" class="i field">s_autoReferencedAssemblies</a> = <b>new</b>(<span class="i">InitAutoIncludedRefAssemblies</span>);
 
        <span class="c">// A HashSet of assembly names to be ignored if they are specified in &#39;-ReferencedAssemblies&#39;</span>
        <b>private static readonly</b> <span class="i">Lazy</span>&lt;<span class="i">HashSet</span>&lt;<b>string</b>&gt;&gt; <a id="5a7e4b65327c5d34" href="../../R/5a7e4b65327c5d34.html" target="n" data-glyph="46,1" class="i field">s_refAssemblyNamesToIgnore</a> = <b>new</b>(<span class="i">InitRefAssemblyNamesToIgnore</span>);
 
        <span class="c">// These assemblies are used, when ReferencedAssemblies parameter is not specified.</span>
        <b>private static readonly</b> <span class="i">Lazy</span>&lt;<span class="i">IEnumerable</span>&lt;<span class="i">PortableExecutableReference</span>&gt;&gt; <a id="e60d956ebd87347f" href="../../R/e60d956ebd87347f.html" target="n" data-glyph="46,1" class="i field">s_defaultAssemblies</a> = <b>new</b>(<span class="i">InitDefaultRefAssemblies</span>);
 
        <b>private bool</b> <a id="4b302ca790ae9f0f" href="../../R/4b302ca790ae9f0f.html" target="n" data-glyph="106,1" class="i property">InMemory</a> { <b>get</b> { <b>return</b> <b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>); } }
 
        <span class="c">// These dictionaries prevent reloading already loaded and unchanged code.</span>
        <span class="c">// We don&#39;t worry about unbounded growing of the cache because in .Net Core 2.0 we can not unload assemblies.</span>
        <span class="c">// TODO: review if we will be able to unload assemblies after migrating to .Net Core 2.1.</span>
        <b>private static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="4c8372043ca5deae" href="../../R/4c8372043ca5deae.html" target="n" data-glyph="46,1" class="i field">s_sourceTypesCache</a> = <b>new</b>();
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<b>int</b>, <span class="i">Assembly</span>&gt; <a id="a66d3cef8a8ac8a8" href="../../R/a66d3cef8a8ac8a8.html" target="n" data-glyph="46,1" class="i field">s_sourceAssemblyCache</a> = <b>new</b>();
 
        <b>private static readonly string</b> <a id="3676b85d82309418" href="../../R/3676b85d82309418.html" target="n" data-glyph="46,1" class="i field">s_defaultSdkDirectory</a> = <span class="i">Utils</span>.<span class="i">DefaultPowerShellAppBase</span>;
 
        <b>private const</b> <span class="i">ReportDiagnostic</span> <a id="027fa262852d62c4" href="../../R/027fa262852d62c4.html" target="n" data-glyph="10,1" class="i field">defaultDiagnosticOption</a> = <span class="i">ReportDiagnostic</span>.<span class="i">Error</span>;
 
        <b>private static readonly string</b>[] <a id="fe4463a830a2529b" href="../../R/fe4463a830a2529b.html" target="n" data-glyph="46,1" class="i field">s_writeInformationTags</a> = <b>new</b> <b>string</b>[] { <span class="s">&quot;PSHOST&quot;</span> };
        <b>private int</b> <a id="862c75afd4e67b6a" href="../../R/862c75afd4e67b6a.html" target="n" data-glyph="46,1" class="i field">_syntaxTreesHash</a>;
 
        <b>private const string</b> <a id="04b3be4068735355" href="../../R/04b3be4068735355.html" target="n" data-glyph="10,1" class="i field">FromMemberParameterSetName</a> = <span class="s">&quot;FromMember&quot;</span>;
        <b>private const string</b> <a id="2f30e18b8d7adc71" href="../../R/2f30e18b8d7adc71.html" target="n" data-glyph="10,1" class="i field">FromSourceParameterSetName</a> = <span class="s">&quot;FromSource&quot;</span>;
        <b>private const string</b> <a id="2720514c5e27f84f" href="../../R/2720514c5e27f84f.html" target="n" data-glyph="10,1" class="i field">FromPathParameterSetName</a> = <span class="s">&quot;FromPath&quot;</span>;
        <b>private const string</b> <a id="33416e799cc5358e" href="../../R/33416e799cc5358e.html" target="n" data-glyph="10,1" class="i field">FromLiteralPathParameterSetName</a> = <span class="s">&quot;FromLiteralPath&quot;</span>;
        <b>private const string</b> <a id="9d0051f8a3a41503" href="../../R/9d0051f8a3a41503.html" target="n" data-glyph="10,1" class="i field">FromAssemblyNameParameterSetName</a> = <span class="s">&quot;FromAssemblyName&quot;</span>;
 
        <b>private void</b> <a id="8d2e1987d081b90e" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">LoadAssemblies</a>(<span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r29 rd" class="r29 r">assemblies</span>)
        {
            <b>foreach</b> (<b>string</b> <span id="r30 rd" class="r30 r">assemblyName</span> <b>in</b> <span class="r29 r">assemblies</span>)
            {
                <span class="c">// CoreCLR doesn&#39;t allow re-load TPA assemblies with different API (i.e. we load them by name and now want to load by path).</span>
                <span class="c">// LoadAssemblyHelper helps us avoid re-loading them, if they already loaded.</span>
                <span class="i">Assembly</span> <span id="r31 rd" class="r31 r">assembly</span> = <a href="#802e7bf63fd0d0af" class="i method">LoadAssemblyHelper</a>(<span class="r30 r">assemblyName</span>) ?? <span class="i">Assembly</span>.<span class="i">LoadFrom</span>(<a href="#bc4ae945c363fa98" class="i method">ResolveAssemblyName</a>(<span class="r30 r">assemblyName</span>, <b>false</b>));
 
                <b>if</b> (<a href="#470642f88494cc64" class="i property">PassThru</a>)
                {
                    <a href="#40c7c33e74310ad9" class="i method">WriteTypes</a>(<span class="r31 r">assembly</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize the list of reference assemblies that will be used when &#39;-ReferencedAssemblies&#39; is not specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">IEnumerable</span>&lt;<span class="i">PortableExecutableReference</span>&gt; <a id="0a2a5508f1a77fe8" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InitDefaultRefAssemblies</a>()
        {
            <span class="c">// Define number of reference assemblies distributed with PowerShell.</span>
            <b>const int</b> <span id="r32 rd" class="r32 r">maxPowershellRefAssemblies</span> = 160;
 
            <b>const int</b> <span id="r33 rd" class="r33 r">capacity</span> = <span class="r32 r">maxPowershellRefAssemblies</span> + 1;
            <b>var</b> <span id="r34 rd" class="r34 r">defaultRefAssemblies</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">PortableExecutableReference</span>&gt;(<span class="r33 r">capacity</span>);
 
            <b>foreach</b> (<b>string</b> <span id="r35 rd" class="r35 r">file</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<a href="#7679701df49595ba" class="i field">s_netcoreAppRefFolder</a>, <span class="s">&quot;*.dll&quot;</span>, <span class="i">SearchOption</span>.<span class="i">TopDirectoryOnly</span>))
            {
                <span class="r34 r">defaultRefAssemblies</span>.<span class="i">Add</span>(<span class="i">MetadataReference</span>.<span class="i">CreateFromFile</span>(<span class="r35 r">file</span>));
            }
 
            <span class="c">// Add System.Management.Automation.dll</span>
            <span class="r34 r">defaultRefAssemblies</span>.<span class="i">Add</span>(<span class="i">MetadataReference</span>.<span class="i">CreateFromFile</span>(<b>typeof</b>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>).<span class="i">Assembly</span>.<span class="i">Location</span>));
 
            <span class="c">// We want to avoid reallocating the internal array, so we assert if the list capacity has increased.</span>
            <span class="i">Diagnostics</span>.<span class="i">Assert</span>(
                <span class="r34 r">defaultRefAssemblies</span>.<span class="i">Capacity</span> &lt;= <span class="r33 r">capacity</span>,
                <span class="s">$&quot;</span><span class="s">defaultRefAssemblies was resized because of insufficient initial capacity! A capacity of </span>{<span class="r34 r">defaultRefAssemblies</span>.<span class="i">Count</span>}<span class="s"> is required.</span><span class="s">&quot;</span>);
 
            <b>return</b> <span class="r34 r">defaultRefAssemblies</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize the set of assembly names that should be ignored when they are specified in &#39;-ReferencedAssemblies&#39;.</span>
        <span class="c">///</span><span class="c">   - System.Private.CoreLib.ni.dll - the runtime dll that contains most core/primitive types</span>
        <span class="c">///</span><span class="c">   - System.Private.Uri.dll - the runtime dll that contains &#39;System.Uri&#39; and related types</span>
        <span class="c">///</span><span class="c"> Referencing these runtime dlls may cause ambiguous type identity or other issues.</span>
        <span class="c">///</span><span class="c">   - System.Runtime.dll - the corresponding reference dll will be automatically included</span>
        <span class="c">///</span><span class="c">   - System.Runtime.InteropServices.dll - the corresponding reference dll will be automatically included.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="b14932a8323b58a7" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InitRefAssemblyNamesToIgnore</a>()
        {
            <b>return</b> <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>) {
                <span class="i">PathType</span>.<span class="i">GetFileName</span>(<b>typeof</b>(<b>object</b>).<span class="i">Assembly</span>.<span class="i">Location</span>),
                <span class="i">PathType</span>.<span class="i">GetFileName</span>(<b>typeof</b>(<span class="i">Uri</span>).<span class="i">Assembly</span>.<span class="i">Location</span>),
                <span class="i">PathType</span>.<span class="i">GetFileName</span>(<span class="i">GetReferenceAssemblyPathBasedOnType</span>(<b>typeof</b>(<b>object</b>))),
                <span class="i">PathType</span>.<span class="i">GetFileName</span>(<span class="i">GetReferenceAssemblyPathBasedOnType</span>(<b>typeof</b>(<span class="i">SecureString</span>)))
            };
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize the list of reference assemblies that will be automatically added when &#39;-ReferencedAssemblies&#39; is specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">PortableExecutableReference</span>[] <a id="81f6f256d1242cae" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InitAutoIncludedRefAssemblies</a>()
        {
            <b>return</b> <b>new</b> <span class="i">PortableExecutableReference</span>[] {
                <span class="i">MetadataReference</span>.<span class="i">CreateFromFile</span>(<span class="i">GetReferenceAssemblyPathBasedOnType</span>(<b>typeof</b>(<b>object</b>))),
                <span class="i">MetadataReference</span>.<span class="i">CreateFromFile</span>(<span class="i">GetReferenceAssemblyPathBasedOnType</span>(<b>typeof</b>(<span class="i">SecureString</span>)))
            };
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the path of reference assembly where the type is declared.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="0412bd59d614a767" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetReferenceAssemblyPathBasedOnType</a>(<span class="i">Type</span> <span id="r36 rd" class="r36 r">type</span>)
        {
            <b>string</b> <span id="r37 rd" class="r37 r">refAsmFileName</span> = <span class="i">PathType</span>.<span class="i">GetFileName</span>(<span class="i">ClrFacade</span>.<span class="i">GetAssemblies</span>(<span class="r36 r">type</span>.<span class="i">FullName</span>).<span class="i">First</span>().<span class="i">Location</span>);
            <b>return</b> <span class="i">PathType</span>.<span class="i">Combine</span>(<a href="#7679701df49595ba" class="i field">s_netcoreAppRefFolder</a>, <span class="r37 r">refAsmFileName</span>);
        }
 
        <b>private string</b> <a id="bc4ae945c363fa98" href="../../R/bc4ae945c363fa98.html" target="n" data-glyph="76,1" class="i method">ResolveAssemblyName</a>(<b>string</b> <span id="r38 rd" class="r38 r">assembly</span>, <b>bool</b> <span id="r39 rd" class="r39 r">isForReferenceAssembly</span>)
        {
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r40 rd" class="r40 r">errorRecord</span>;
 
            <span class="c">// if it&#39;s a path, resolve it</span>
            <b>if</b> (<span class="r38 r">assembly</span>.<span class="i">Contains</span>(<span class="i">PathType</span>.<span class="i">DirectorySeparatorChar</span>) || <span class="r38 r">assembly</span>.<span class="i">Contains</span>(<span class="i">PathType</span>.<span class="i">AltDirectorySeparatorChar</span>))
            {
                <b>if</b> (<span class="i">PathType</span>.<span class="i">IsPathRooted</span>(<span class="r38 r">assembly</span>))
                {
                    <b>return</b> <span class="r38 r">assembly</span>;
                }
                <b>else</b>
                {
                    <b>var</b> <span id="r41 rd" class="r41 r">paths</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<span class="i">GetResolvedPSPathFromPSPath</span>(<span class="r38 r">assembly</span>);
                    <b>if</b> (<span class="r41 r">paths</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>return</b> <span class="r41 r">paths</span>[0].<span class="i">Path</span>;
                    }
                    <b>else</b>
                    {
                        <span class="r40 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                            <b>new</b> <span class="i">Exception</span>(
                                <b>string</b>.<span class="i">Format</span>(<span class="i">ParserStrings</span>.<span class="i">ErrorLoadingAssembly</span>, <span class="r38 r">assembly</span>)),
                            <span class="s">&quot;ErrorLoadingAssembly&quot;</span>,
                            <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                            <span class="r38 r">assembly</span>);
 
                        <span class="i">ThrowTerminatingError</span>(<span class="r40 r">errorRecord</span>);
                        <b>return</b> <b>null</b>;
                    }
                }
            }
 
            <b>string</b> <span id="r42 rd" class="r42 r">refAssemblyDll</span> = <span class="r38 r">assembly</span>;
            <b>if</b> (!<span class="r38 r">assembly</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.dll&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// It could be a short assembly name or a full assembly name, but we</span>
                <span class="c">// always want the short name to find the corresponding assembly file.</span>
                <b>var</b> <span id="r43 rd" class="r43 r">assemblyName</span> = <b>new</b> <span class="i">AssemblyName</span>(<span class="r38 r">assembly</span>);
                <span class="r42 r">refAssemblyDll</span> = <span class="r43 r">assemblyName</span>.<span class="i">Name</span> + <span class="s">&quot;.dll&quot;</span>;
            }
 
            <span class="c">// We look up in reference/framework only when it&#39;s for resolving reference assemblies.</span>
            <span class="c">// In case of &#39;Add-Type -AssemblyName&#39; scenario, we don&#39;t attempt to resolve against framework assemblies because</span>
            <span class="c">//   1. Explicitly loading a framework assembly usually is not necessary in PowerShell 6+.</span>
            <span class="c">//   2. A user should use assembly name instead of path if they want to explicitly load a framework assembly.</span>
            <b>if</b> (<span class="r39 r">isForReferenceAssembly</span>)
            {
                <span class="c">// If it&#39;s for resolving a reference assembly, then we look in NetCoreApp ref assemblies first</span>
                <b>string</b> <span id="r44 rd" class="r44 r">netcoreAppRefPath</span> = <span class="i">PathType</span>.<span class="i">Combine</span>(<a href="#7679701df49595ba" class="i field">s_netcoreAppRefFolder</a>, <span class="r42 r">refAssemblyDll</span>);
                <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r44 r">netcoreAppRefPath</span>))
                {
                    <b>return</b> <span class="r44 r">netcoreAppRefPath</span>;
                }
 
                <span class="c">// Look up the assembly in the framework folder. This may happen when assembly is not part of</span>
                <span class="c">// NetCoreApp, but comes from an additional package, such as &#39;Json.Net&#39;.</span>
                <b>string</b> <span id="r45 rd" class="r45 r">frameworkPossiblePath</span> = <span class="i">PathType</span>.<span class="i">Combine</span>(<a href="#f81aa11f59a66f31" class="i field">s_frameworkFolder</a>, <span class="r42 r">refAssemblyDll</span>);
                <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r45 r">frameworkPossiblePath</span>))
                {
                    <b>return</b> <span class="r45 r">frameworkPossiblePath</span>;
                }
 
                <span class="c">// The assembly name may point to a third-party assembly that is already loaded at run time.</span>
                <b>if</b> (!<span class="r38 r">assembly</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.dll&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="i">Assembly</span> <span id="r46 rd" class="r46 r">result</span> = <a href="#802e7bf63fd0d0af" class="i method">LoadAssemblyHelper</a>(<span class="r38 r">assembly</span>);
                    <b>if</b> (<span class="r46 r">result</span> != <b>null</b>)
                    {
                        <b>return</b> <span class="r46 r">result</span>.<span class="i">Location</span>;
                    }
                }
            }
 
            <span class="c">// Look up the assembly in the current folder</span>
            <b>var</b> <span id="r47 rd" class="r47 r">resolvedPaths</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<span class="i">GetResolvedPSPathFromPSPath</span>(<span class="r42 r">refAssemblyDll</span>);
 
            <b>if</b> (<span class="r47 r">resolvedPaths</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>string</b> <span id="r48 rd" class="r48 r">currentFolderPath</span> = <span class="r47 r">resolvedPaths</span>[0].<span class="i">Path</span>;
                <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r48 r">currentFolderPath</span>))
                {
                    <b>return</b> <span class="r48 r">currentFolderPath</span>;
                }
            }
 
            <span class="r40 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                <b>new</b> <span class="i">Exception</span>(
                    <b>string</b>.<span class="i">Format</span>(<span class="i">ParserStrings</span>.<span class="i">ErrorLoadingAssembly</span>, <span class="r38 r">assembly</span>)),
                <span class="s">&quot;ErrorLoadingAssembly&quot;</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                <span class="r38 r">assembly</span>);
 
            <span class="i">ThrowTerminatingError</span>(<span class="r40 r">errorRecord</span>);
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">// LoadWithPartialName is deprecated, so we have to write the closest approximation possible.</span>
        <span class="c">// However, this does give us a massive usability improvement, as users can just say</span>
        <span class="c">// Add-Type -AssemblyName Forms (instead of System.Windows.Forms)</span>
        <span class="c">// This is just long, not unmaintainable.</span>
        <b>private static</b> <span class="i">Assembly</span> <a id="802e7bf63fd0d0af" href="../../R/802e7bf63fd0d0af.html" target="n" data-glyph="76,1" class="i method">LoadAssemblyHelper</a>(<b>string</b> <span id="r49 rd" class="r49 r">assemblyName</span>)
        {
            <span class="i">Assembly</span> <span id="r50 rd" class="r50 r">loadedAssembly</span> = <b>null</b>;
 
            <span class="c">// First try by strong name</span>
            <b>try</b>
            {
                <span class="r50 r">loadedAssembly</span> = <span class="i">Assembly</span>.<span class="i">Load</span>(<b>new</b> <span class="i">AssemblyName</span>(<span class="r49 r">assemblyName</span>));
            }
            <span class="c">// Generates a FileNotFoundException if you can&#39;t load the strong type.</span>
            <span class="c">// So we&#39;ll try from the short name.</span>
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">FileNotFoundException</span>) { }
            <span class="c">// File load exception can happen, when we trying to load from the incorrect assembly name</span>
            <span class="c">// or file corrupted.</span>
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">FileLoadException</span>) { }
 
            <b>return</b> <span class="r50 r">loadedAssembly</span>;
        }
 
        <b>private</b> <span class="i">IEnumerable</span>&lt;<span class="i">PortableExecutableReference</span>&gt; <a id="e71998e691025def" href="../../R/e71998e691025def.html" target="n" data-glyph="76,1" class="i method">GetPortableExecutableReferences</a>()
        {
            <b>if</b> (<a href="#b9a2e7559e42f39c" class="i property">ReferencedAssemblies</a>.<span class="i">Length</span> &gt; 0)
            {
                <b>var</b> <span id="r51 rd" class="r51 r">tempReferences</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">PortableExecutableReference</span>&gt;(<a href="#148e5e122fde8ffc" class="i field">s_autoReferencedAssemblies</a>.<span class="i">Value</span>);
                <b>foreach</b> (<b>string</b> <span id="r52 rd" class="r52 r">assembly</span> <b>in</b> <a href="#b9a2e7559e42f39c" class="i property">ReferencedAssemblies</a>)
                {
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r52 r">assembly</span>)) { <b>continue</b>; }
 
                    <b>string</b> <span id="r53 rd" class="r53 r">resolvedAssemblyPath</span> = <a href="#bc4ae945c363fa98" class="i method">ResolveAssemblyName</a>(<span class="r52 r">assembly</span>, <b>true</b>);
 
                    <span class="c">// Ignore some specified reference assemblies</span>
                    <b>string</b> <span id="r54 rd" class="r54 r">fileName</span> = <span class="i">PathType</span>.<span class="i">GetFileName</span>(<span class="r53 r">resolvedAssemblyPath</span>);
                    <b>if</b> (<a href="#5a7e4b65327c5d34" class="i field">s_refAssemblyNamesToIgnore</a>.<span class="i">Value</span>.<span class="i">Contains</span>(<span class="r54 r">fileName</span>))
                    {
                        <span class="i">WriteVerbose</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">AddTypeStrings</span>.<span class="i">ReferenceAssemblyIgnored</span>, <span class="r53 r">resolvedAssemblyPath</span>));
                        <b>continue</b>;
                    }
 
                    <span class="r51 r">tempReferences</span>.<span class="i">Add</span>(<span class="i">MetadataReference</span>.<span class="i">CreateFromFile</span>(<span class="r53 r">resolvedAssemblyPath</span>));
                }
 
                <b>return</b> <span class="r51 r">tempReferences</span>;
            }
            <b>else</b>
            {
                <b>return</b> <a href="#e60d956ebd87347f" class="i field">s_defaultAssemblies</a>.<span class="i">Value</span>;
            }
        }
 
        <b>private void</b> <a id="40c7c33e74310ad9" href="../../R/40c7c33e74310ad9.html" target="n" data-glyph="76,1" class="i method">WriteTypes</a>(<span class="i">Assembly</span> <span id="r55 rd" class="r55 r">assembly</span>)
        {
            <span class="i">WriteObject</span>(<span class="r55 r">assembly</span>.<span class="i">GetTypes</span>(), <b>true</b>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> LoadAssembly
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> SourceCodeProcessing
 
        <b>private static</b> <span class="i">OutputKind</span> <a id="5e66a39e95c7c494" href="../../R/5e66a39e95c7c494.html" target="n" data-glyph="76,1" class="i method">OutputAssemblyTypeToOutputKind</a>(<a href="#32f6e2ab478a8f4d" class="t t">OutputAssemblyType</a> <span id="r56 rd" class="r56 r">outputType</span>)
        {
            <b>switch</b> (<span class="r56 r">outputType</span>)
            {
                <b>case</b> <a href="#32f6e2ab478a8f4d" class="t t">OutputAssemblyType</a>.<a href="#ee055ed0b21601d1" class="i field">Library</a>:
                    <b>return</b> <span class="i">OutputKind</span>.<span class="i">DynamicallyLinkedLibrary</span>;
 
                <b>default</b>:
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
            }
        }
 
        <b>private</b> <span class="i">CommandLineArguments</span> <a id="7dcd7bab14cf0c2e" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ParseCompilerOption</a>(<span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r57 rd" class="r57 r">args</span>)
        {
            <b>string</b> <span id="r58 rd" class="r58 r">sdkDirectory</span> = <a href="#3676b85d82309418" class="i field">s_defaultSdkDirectory</a>;
            <b>string</b> <span id="r59 rd" class="r59 r">baseDirectory</span> = <a href="#2173d1cbdf56709b" class="k">this</a>.<a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="/System.Management.Automation/A.html#91ffa5f8fc6b1308" class="i property">CurrentLocation</a>.<a href="/System.Management.Automation/A.html#de00cd47bf0cf721" class="i property">Path</a>;
 
            <b>switch</b> (<a href="#dbe8c59442c7cb6f" class="i property">Language</a>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <b>return</b> <span class="i">CSharpCommandLineParser</span>.<span class="i">Default</span>.<span class="i">Parse</span>(<span class="r57 r">args</span>, <span class="r59 r">baseDirectory</span>, <span class="r58 r">sdkDirectory</span>);
 
                <b>default</b>:
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
            }
        }
 
        <b>private</b> <span class="i">SyntaxTree</span> <a id="3b953a10a241ed7d" href="../../R/3b953a10a241ed7d.html" target="n" data-glyph="76,1" class="i method">ParseSourceText</a>(<span class="i">SourceText</span> <span id="r60 rd" class="r60 r">sourceText</span>, <span class="i">ParseOptions</span> <span id="r61 rd" class="r61 r">parseOptions</span>, <b>string</b> <span id="r62 rd" class="r62 r">path</span> = <span class="s">&quot;&quot;</span>)
        {
            <b>switch</b> (<a href="#dbe8c59442c7cb6f" class="i property">Language</a>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <b>return</b> <span class="i">CSharpSyntaxTree</span>.<span class="i">ParseText</span>(<span class="r60 r">sourceText</span>, (<span class="i">CSharpParseOptions</span>)<span class="r61 r">parseOptions</span>, <span class="r62 r">path</span>);
 
                <b>default</b>:
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
            }
        }
 
        <b>private</b> <span class="i">CompilationOptions</span> <a id="48a38831a8f09d5e" href="../../R/48a38831a8f09d5e.html" target="n" data-glyph="76,1" class="i method">GetDefaultCompilationOptions</a>()
        {
            <b>switch</b> (<a href="#dbe8c59442c7cb6f" class="i property">Language</a>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <b>return</b> <b>new</b> <span class="i">CSharpCompilationOptions</span>(<a href="#5e66a39e95c7c494" class="i method">OutputAssemblyTypeToOutputKind</a>(<a href="#6abeb26cc10ca21f" class="i property">OutputType</a>));
 
                <b>default</b>:
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
            }
        }
 
        <b>private bool</b> <a id="62a94ebb9cbdaa49" href="../../R/62a94ebb9cbdaa49.html" target="n" data-glyph="76,1" class="i method">isSourceCodeUpdated</a>(<span class="i">List</span>&lt;<span class="i">SyntaxTree</span>&gt; <span id="r63 rd" class="r63 r">syntaxTrees</span>, <b>out</b> <span class="i">Assembly</span> <span id="r64 rd" class="r64 r">assembly</span>)
        {
            <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<span class="r63 r">syntaxTrees</span>.<span class="i">Count</span> != 0, <span class="s">&quot;syntaxTrees should contains a source code.&quot;</span>);
 
            <a href="#862c75afd4e67b6a" class="i field">_syntaxTreesHash</a> = <span class="i">SyntaxTreeArrayGetHashCode</span>(<span class="r63 r">syntaxTrees</span>);
 
            <b>if</b> (<a href="#a66d3cef8a8ac8a8" class="i field">s_sourceAssemblyCache</a>.<span class="i">TryGetValue</span>(<a href="#862c75afd4e67b6a" class="i field">_syntaxTreesHash</a>, <b>out</b> <span class="i">Assembly</span> <span id="r65 rd" class="r65 r">hashedAssembly</span>))
            {
                <span class="r64 r">assembly</span> = <span class="r65 r">hashedAssembly</span>;
                <b>return</b> <b>false</b>;
            }
            <b>else</b>
            {
                <span class="r64 r">assembly</span> = <b>null</b>;
                <b>return</b> <b>true</b>;
            }
        }
 
        <b>private void</b> <a id="292ef8332b5cf6ca" href="../../R/292ef8332b5cf6ca.html" target="n" data-glyph="76,1" class="i method">SourceCodeProcessing</a>()
        {
            <span class="i">ParseOptions</span> <span id="r66 rd" class="r66 r">parseOptions</span> = <b>null</b>;
            <span class="i">CompilationOptions</span> <span id="r67 rd" class="r67 r">compilationOptions</span> = <b>null</b>;
            <span class="i">EmitOptions</span> <span id="r68 rd" class="r68 r">emitOptions</span> = <b>null</b>;
 
            <b>if</b> (<a href="#a51f53bf922f7a3d" class="i property">CompilerOptions</a> != <b>null</b>)
            {
                <b>var</b> <span id="r69 rd" class="r69 r">arguments</span> = <span class="i">ParseCompilerOption</span>(<a href="#a51f53bf922f7a3d" class="i property">CompilerOptions</a>);
 
                <span class="i">HandleCompilerErrors</span>(<span class="r69 r">arguments</span>.<span class="i">Errors</span>);
 
                <span class="r66 r">parseOptions</span> = <span class="r69 r">arguments</span>.<span class="i">ParseOptions</span>;
                <span class="r67 r">compilationOptions</span> = <span class="r69 r">arguments</span>.<span class="i">CompilationOptions</span>.<span class="i">WithOutputKind</span>(<a href="#5e66a39e95c7c494" class="i method">OutputAssemblyTypeToOutputKind</a>(<a href="#6abeb26cc10ca21f" class="i property">OutputType</a>));
                <span class="r68 r">emitOptions</span> = <span class="r69 r">arguments</span>.<span class="i">EmitOptions</span>;
            }
            <b>else</b>
            {
                <span class="r66 r">parseOptions</span> = <span class="i">CSharpParseOptions</span>.<span class="i">Default</span>.<span class="i">WithLanguageVersion</span>(<span class="i">LanguageVersion</span>.<span class="i">Latest</span>);
                <span class="r67 r">compilationOptions</span> = <a href="#48a38831a8f09d5e" class="i method">GetDefaultCompilationOptions</a>();
            }
 
            <b>if</b> (!<a href="#cd915c35d4c8bc23" class="i property">IgnoreWarnings</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
            {
                <span class="r67 r">compilationOptions</span> = <span class="r67 r">compilationOptions</span>.<span class="i">WithGeneralDiagnosticOption</span>(<a href="#027fa262852d62c4" class="i field">defaultDiagnosticOption</a>);
            }
 
            <span class="i">SourceText</span> <span id="r70 rd" class="r70 r">sourceText</span>;
            <span class="i">List</span>&lt;<span class="i">SyntaxTree</span>&gt; <span id="r71 rd" class="r71 r">syntaxTrees</span> = <b>new</b>();
 
            <b>switch</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>)
            {
                <b>case</b> <a href="#2720514c5e27f84f" class="i field">FromPathParameterSetName</a>:
                <b>case</b> <a href="#33416e799cc5358e" class="i field">FromLiteralPathParameterSetName</a>:
                    <b>foreach</b> (<b>string</b> <span id="r72 rd" class="r72 r">filePath</span> <b>in</b> <a href="#8495a39e1a36be96" class="i field">_paths</a>)
                    {
                        <b>using</b> (<b>var</b> <span id="r73 rd" class="r73 r">sourceFile</span> = <b>new</b> <span class="i">FileStream</span>(<span class="r72 r">filePath</span>, <span class="i">FileMode</span>.<span class="i">Open</span>, <span class="i">FileAccess</span>.<span class="i">Read</span>, <span class="i">FileShare</span>.<span class="i">Read</span>))
                        {
                            <span class="r70 r">sourceText</span> = <span class="i">SourceText</span>.<span class="i">From</span>(<span class="r73 r">sourceFile</span>);
                            <span class="r71 r">syntaxTrees</span>.<span class="i">Add</span>(<a href="#3b953a10a241ed7d" class="i method">ParseSourceText</a>(<span class="r70 r">sourceText</span>, <span class="r66 r">parseOptions</span>, <span class="r62 r">path</span>: <span class="r72 r">filePath</span>));
                        }
                    }
 
                    <b>break</b>;
                <b>case</b> <a href="#04b3be4068735355" class="i field">FromMemberParameterSetName</a>:
                    <a href="#ca43838b8b085158" class="i field">_sourceCode</a> = <a href="#84c47faf87a23f3f" class="i method">GenerateTypeSource</a>(<a href="#7a017bc8282e0570" class="i property">Namespace</a>, <a href="#029c0ecdb03b3ca8" class="i property">Name</a>, <a href="#ca43838b8b085158" class="i field">_sourceCode</a>, <a href="#dbe8c59442c7cb6f" class="i property">Language</a>);
 
                    <span class="r70 r">sourceText</span> = <span class="i">SourceText</span>.<span class="i">From</span>(<a href="#ca43838b8b085158" class="i field">_sourceCode</a>);
                    <span class="r71 r">syntaxTrees</span>.<span class="i">Add</span>(<a href="#3b953a10a241ed7d" class="i method">ParseSourceText</a>(<span class="r70 r">sourceText</span>, <span class="r66 r">parseOptions</span>));
                    <b>break</b>;
                <b>case</b> <a href="#2f30e18b8d7adc71" class="i field">FromSourceParameterSetName</a>:
                    <span class="r70 r">sourceText</span> = <span class="i">SourceText</span>.<span class="i">From</span>(<a href="#ca43838b8b085158" class="i field">_sourceCode</a>);
                    <span class="r71 r">syntaxTrees</span>.<span class="i">Add</span>(<a href="#3b953a10a241ed7d" class="i method">ParseSourceText</a>(<span class="r70 r">sourceText</span>, <span class="r66 r">parseOptions</span>));
                    <b>break</b>;
                <b>default</b>:
                    <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;Invalid parameter set: {0}&quot;</span>, <a href="#2173d1cbdf56709b" class="k">this</a>.<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>);
                    <b>break</b>;
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>) &amp;&amp; !<a href="#470642f88494cc64" class="i property">PassThru</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
            {
                <a href="#17c317f64f34dfa8" class="i method">CompileToAssembly</a>(<span class="r71 r">syntaxTrees</span>, <span class="r67 r">compilationOptions</span>, <span class="r68 r">emitOptions</span>);
            }
            <b>else</b>
            {
                <span class="c">// if the source code was already compiled and loaded and not changed</span>
                <span class="c">// we get the assembly from the cache.</span>
                <b>if</b> (<a href="#62a94ebb9cbdaa49" class="i method">isSourceCodeUpdated</a>(<span class="r71 r">syntaxTrees</span>, <b>out</b> <span class="i">Assembly</span> <span id="r74 rd" class="r74 r">assembly</span>))
                {
                    <a href="#17c317f64f34dfa8" class="i method">CompileToAssembly</a>(<span class="r71 r">syntaxTrees</span>, <span class="r67 r">compilationOptions</span>, <span class="r68 r">emitOptions</span>);
                }
                <b>else</b>
                {
                    <span class="i">WriteVerbose</span>(<span class="i">AddTypeStrings</span>.<span class="i">AlreadyCompiledandLoaded</span>);
 
                    <b>if</b> (<a href="#470642f88494cc64" class="i property">PassThru</a>)
                    {
                        <a href="#40c7c33e74310ad9" class="i method">WriteTypes</a>(<span class="r74 r">assembly</span>);
                    }
                }
            }
        }
 
        <b>private void</b> <a id="17c317f64f34dfa8" href="../../R/17c317f64f34dfa8.html" target="n" data-glyph="76,1" class="i method">CompileToAssembly</a>(<span class="i">List</span>&lt;<span class="i">SyntaxTree</span>&gt; <span id="r75 rd" class="r75 r">syntaxTrees</span>, <span class="i">CompilationOptions</span> <span id="r76 rd" class="r76 r">compilationOptions</span>, <span class="i">EmitOptions</span> <span id="r77 rd" class="r77 r">emitOptions</span>)
        {
            <span class="i">IEnumerable</span>&lt;<span class="i">PortableExecutableReference</span>&gt; <span id="r78 rd" class="r78 r">references</span> = <a href="#e71998e691025def" class="i method">GetPortableExecutableReferences</a>();
            <span class="i">Compilation</span> <span id="r79 rd" class="r79 r">compilation</span> = <b>null</b>;
 
            <b>switch</b> (<a href="#dbe8c59442c7cb6f" class="i property">Language</a>)
            {
                <b>case</b> <a href="#7b09fcb6545b9de2" class="t t">Language</a>.<a href="#861f69c42c8ab9f4" class="i field">CSharp</a>:
                    <span class="r79 r">compilation</span> = <span class="i">CSharpCompilation</span>.<span class="i">Create</span>(
                        <span class="i">PathType</span>.<span class="i">GetRandomFileName</span>(),
                        <span class="i">syntaxTrees</span>: <span class="r75 r">syntaxTrees</span>,
                        <span class="i">references</span>: <span class="r78 r">references</span>,
                        <span class="i">options</span>: (<span class="i">CSharpCompilationOptions</span>)<span class="r76 r">compilationOptions</span>);
                    <b>break</b>;
 
                <b>default</b>:
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>();
            }
 
            <a href="#585f88dc147a65a8" class="i method">DoEmitAndLoadAssembly</a>(<span class="r79 r">compilation</span>, <span class="r77 r">emitOptions</span>);
        }
 
        <b>private void</b> <a id="90a55f090c0d1fee" href="../../R/90a55f090c0d1fee.html" target="n" data-glyph="76,1" class="i method">CheckDuplicateTypes</a>(<span class="i">Compilation</span> <span id="r80 rd" class="r80 r">compilation</span>, <b>out</b> <span class="i">ConcurrentBag</span>&lt;<b>string</b>&gt; <span id="r81 rd" class="r81 r">newTypes</span>)
        {
            <a href="#582d573d4afbf283" class="t t">AllNamedTypeSymbolsVisitor</a> <span id="r82 rd" class="r82 r">visitor</span> = <b>new</b>();
            <span class="r82 r">visitor</span>.<span class="i">Visit</span>(<span class="r80 r">compilation</span>.<span class="i">Assembly</span>.<span class="i">GlobalNamespace</span>);
 
            <b>foreach</b> (<b>var</b> <span id="r83 rd" class="r83 r">symbolName</span> <b>in</b> <span class="r82 r">visitor</span>.<a href="#238445d102a4560d" class="i field">DuplicateSymbols</a>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r84 rd" class="r84 r">errorRecord</span> = <b>new</b>(
                    <b>new</b> <span class="i">Exception</span>(
                        <b>string</b>.<span class="i">Format</span>(<span class="i">AddTypeStrings</span>.<span class="i">TypeAlreadyExists</span>, <span class="r83 r">symbolName</span>)),
                    <span class="s">&quot;TYPE_ALREADY_EXISTS&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                    <span class="r83 r">symbolName</span>);
                <span class="i">WriteError</span>(<span class="r84 r">errorRecord</span>);
            }
 
            <b>if</b> (!<span class="r82 r">visitor</span>.<a href="#238445d102a4560d" class="i field">DuplicateSymbols</a>.<span class="i">IsEmpty</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r85 rd" class="r85 r">errorRecord</span> = <b>new</b>(
                    <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">AddTypeStrings</span>.<span class="i">CompilerErrors</span>),
                    <span class="s">&quot;COMPILER_ERRORS&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                    <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r85 r">errorRecord</span>);
            }
 
            <span class="r81 r">newTypes</span> = <span class="r82 r">visitor</span>.<a href="#6c8a606af200d29f" class="i field">UniqueSymbols</a>;
 
            <b>return</b>;
        }
 
        <span class="c">// Visit symbols in all namespaces and collect duplicates.</span>
        <b>private sealed class</b> <a id="582d573d4afbf283" href="../../R/582d573d4afbf283.html" target="n" data-glyph="4,1" class="t t"><span id="04dbdf3cb1539f47">AllNamedTypeSymbolsVisitor</span></a> : <span class="i">SymbolVisitor</span>
        {
            <b>public readonly</b> <span class="i">ConcurrentBag</span>&lt;<b>string</b>&gt; <a id="238445d102a4560d" href="../../R/238445d102a4560d.html" target="n" data-glyph="42,2" class="i field">DuplicateSymbols</a> = <b>new</b>();
            <b>public readonly</b> <span class="i">ConcurrentBag</span>&lt;<b>string</b>&gt; <a id="6c8a606af200d29f" href="../../R/6c8a606af200d29f.html" target="n" data-glyph="42,2" class="i field">UniqueSymbols</a> = <b>new</b>();
 
            <b>public override void</b> <a id="2f51bfefe6679aa3" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">VisitNamespace</a>(<span class="i">INamespaceSymbol</span> <span id="r86 rd" class="r86 r">symbol</span>)
            {
                <span class="c">// Main cycle.</span>
                <span class="c">// For large files we could use symbol.GetMembers().AsParallel().ForAll(s =&gt; s.Accept(this));</span>
                <b>foreach</b> (<b>var</b> <span id="r87 rd" class="r87 r">member</span> <b>in</b> <span class="r86 r">symbol</span>.<span class="i">GetMembers</span>())
                {
                    <span class="r87 r">member</span>.<span class="i">Accept</span>(<a href="#582d573d4afbf283" class="k">this</a>);
                }
            }
 
            <b>public override void</b> <a id="6017a24bd5753f58" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">VisitNamedType</a>(<span class="i">INamedTypeSymbol</span> <span id="r88 rd" class="r88 r">symbol</span>)
            {
                <span class="c">// It is namespace-fully-qualified name</span>
                <b>var</b> <span id="r89 rd" class="r89 r">symbolFullName</span> = <span class="r88 r">symbol</span>.<span class="i">ToString</span>();
 
                <b>if</b> (<a href="#4c8372043ca5deae" class="i field">s_sourceTypesCache</a>.<span class="i">TryGetValue</span>(<span class="r89 r">symbolFullName</span>, <b>out _</b>))
                {
                    <a href="#238445d102a4560d" class="i field">DuplicateSymbols</a>.<span class="i">Add</span>(<span class="r89 r">symbolFullName</span>);
                }
                <b>else</b>
                {
                    <a href="#6c8a606af200d29f" class="i field">UniqueSymbols</a>.<span class="i">Add</span>(<span class="r89 r">symbolFullName</span>);
                }
            }
        }
 
        <b>private static void</b> <a id="c9292615abd1f8ab" href="../../R/c9292615abd1f8ab.html" target="n" data-glyph="76,1" class="i method">CacheNewTypes</a>(<span class="i">ConcurrentBag</span>&lt;<b>string</b>&gt; <span id="r90 rd" class="r90 r">newTypes</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r91 rd" class="r91 r">typeName</span> <b>in</b> <span class="r90 r">newTypes</span>)
            {
                <a href="#4c8372043ca5deae" class="i field">s_sourceTypesCache</a>.<span class="i">Add</span>(<span class="r91 r">typeName</span>);
            }
        }
 
        <b>private void</b> <a id="9dbde197fa29e69d" href="../../R/9dbde197fa29e69d.html" target="n" data-glyph="76,1" class="i method">CacheAssembly</a>(<span class="i">Assembly</span> <span id="r92 rd" class="r92 r">assembly</span>)
        {
            <a href="#a66d3cef8a8ac8a8" class="i field">s_sourceAssemblyCache</a>.<span class="i">Add</span>(<a href="#862c75afd4e67b6a" class="i field">_syntaxTreesHash</a>, <span class="r92 r">assembly</span>);
        }
 
        <b>private void</b> <a id="585f88dc147a65a8" href="../../R/585f88dc147a65a8.html" target="n" data-glyph="76,1" class="i method">DoEmitAndLoadAssembly</a>(<span class="i">Compilation</span> <span id="r93 rd" class="r93 r">compilation</span>, <span class="i">EmitOptions</span> <span id="r94 rd" class="r94 r">emitOptions</span>)
        {
            <span class="i">EmitResult</span> <span id="r95 rd" class="r95 r">emitResult</span>;
 
            <a href="#90a55f090c0d1fee" class="i method">CheckDuplicateTypes</a>(<span class="r93 r">compilation</span>, <b>out</b> <span class="i">ConcurrentBag</span>&lt;<b>string</b>&gt; <span id="r96 rd" class="r96 r">newTypes</span>);
 
            <b>if</b> (<a href="#4b302ca790ae9f0f" class="i property">InMemory</a>)
            {
                <b>using</b> (<b>var</b> <span id="r97 rd" class="r97 r">ms</span> = <b>new</b> <span class="i">MemoryStream</span>())
                {
                    <span class="r95 r">emitResult</span> = <span class="r93 r">compilation</span>.<span class="i">Emit</span>(<span class="i">peStream</span>: <span class="r97 r">ms</span>, <span class="i">options</span>: <span class="r94 r">emitOptions</span>);
 
                    <span class="i">HandleCompilerErrors</span>(<span class="r95 r">emitResult</span>.<span class="i">Diagnostics</span>);
 
                    <b>if</b> (<span class="r95 r">emitResult</span>.<span class="i">Success</span>)
                    {
                        <span class="c">// TODO:  We could use Assembly.LoadFromStream() in future.</span>
                        <span class="c">// See https://github.com/dotnet/corefx/issues/26994</span>
                        <span class="r97 r">ms</span>.<span class="i">Seek</span>(0, <span class="i">SeekOrigin</span>.<span class="i">Begin</span>);
                        <span class="i">Assembly</span> <span id="r98 rd" class="r98 r">assembly</span> = <span class="i">AssemblyLoadContext</span>.<span class="i">Default</span>.<span class="i">LoadFromStream</span>(<span class="r97 r">ms</span>);
 
                        <a href="#c9292615abd1f8ab" class="i method">CacheNewTypes</a>(<span class="r96 r">newTypes</span>);
                        <a href="#9dbde197fa29e69d" class="i method">CacheAssembly</a>(<span class="r98 r">assembly</span>);
 
                        <b>if</b> (<a href="#470642f88494cc64" class="i property">PassThru</a>)
                        {
                            <a href="#40c7c33e74310ad9" class="i method">WriteTypes</a>(<span class="r98 r">assembly</span>);
                        }
                    }
                }
            }
            <b>else</b>
            {
                <b>using</b> (<b>var</b> <span id="r99 rd" class="r99 r">fs</span> = <b>new</b> <span class="i">FileStream</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>, <span class="i">FileMode</span>.<span class="i">CreateNew</span>, <span class="i">FileAccess</span>.<span class="i">ReadWrite</span>, <span class="i">FileShare</span>.<span class="i">None</span>))
                {
                    <span class="r95 r">emitResult</span> = <span class="r93 r">compilation</span>.<span class="i">Emit</span>(<span class="i">peStream</span>: <span class="r99 r">fs</span>, <span class="i">options</span>: <span class="r94 r">emitOptions</span>);
                }
 
                <span class="i">HandleCompilerErrors</span>(<span class="r95 r">emitResult</span>.<span class="i">Diagnostics</span>);
 
                <b>if</b> (<span class="r95 r">emitResult</span>.<span class="i">Success</span> &amp;&amp; <a href="#470642f88494cc64" class="i property">PassThru</a>)
                {
                    <span class="i">Assembly</span> <span id="r100 rd" class="r100 r">assembly</span> = <span class="i">Assembly</span>.<span class="i">LoadFrom</span>(<a href="#3e3a00602dc7b81d" class="i field">_outputAssembly</a>);
 
                    <a href="#c9292615abd1f8ab" class="i method">CacheNewTypes</a>(<span class="r96 r">newTypes</span>);
                    <a href="#9dbde197fa29e69d" class="i method">CacheAssembly</a>(<span class="r100 r">assembly</span>);
 
                    <a href="#40c7c33e74310ad9" class="i method">WriteTypes</a>(<span class="r100 r">assembly</span>);
                }
            }
        }
 
        <b>private void</b> <a id="8ac8dbecd0d595fb" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleCompilerErrors</a>(<span class="i">ImmutableArray</span>&lt;<span class="i">Diagnostic</span>&gt; <span id="r101 rd" class="r101 r">compilerDiagnostics</span>)
        {
            <b>if</b> (<span class="r101 r">compilerDiagnostics</span>.<span class="i">Length</span> &gt; 0)
            {
                <b>bool</b> <span id="r102 rd" class="r102 r">IsError</span> = <b>false</b>;
 
                <b>foreach</b> (<b>var</b> <span id="r103 rd" class="r103 r">diagnisticRecord</span> <b>in</b> <span class="r101 r">compilerDiagnostics</span>)
                {
                    <span class="c">// We shouldn&#39;t specify input and output files in CompilerOptions parameter</span>
                    <span class="c">// so suppress errors from Roslyn default command line parser:</span>
                    <span class="c">//      CS1562: Outputs without source must have the /out option specified</span>
                    <span class="c">//      CS2008: No inputs specified</span>
                    <span class="c">//      BC2008: No inputs specified</span>
                    <span class="c">//</span>
                    <span class="c">// On emit phase some warnings (like CS8019/BS50001) don&#39;t suppressed</span>
                    <span class="c">// and present in diagnostic report with DefaultSeverity equal to Hidden</span>
                    <span class="c">// so we skip them explicitly here too.</span>
                    <b>if</b> (<span class="r103 r">diagnisticRecord</span>.<span class="i">IsSuppressed</span> || <span class="r103 r">diagnisticRecord</span>.<span class="i">DefaultSeverity</span> == <span class="i">DiagnosticSeverity</span>.<span class="i">Hidden</span> ||
                        <b>string</b>.<span class="i">Equals</span>(<span class="r103 r">diagnisticRecord</span>.<span class="i">Id</span>, <span class="s">&quot;CS2008&quot;</span>, <span class="i">StringComparison</span>.<span class="i">InvariantCulture</span>) ||
                        <b>string</b>.<span class="i">Equals</span>(<span class="r103 r">diagnisticRecord</span>.<span class="i">Id</span>, <span class="s">&quot;CS1562&quot;</span>, <span class="i">StringComparison</span>.<span class="i">InvariantCulture</span>) ||
                        <b>string</b>.<span class="i">Equals</span>(<span class="r103 r">diagnisticRecord</span>.<span class="i">Id</span>, <span class="s">&quot;BC2008&quot;</span>, <span class="i">StringComparison</span>.<span class="i">InvariantCulture</span>))
                    {
                        <b>continue</b>;
                    }
 
                    <b>if</b> (!<span class="r102 r">IsError</span>)
                    {
                        <span class="r102 r">IsError</span> = <span class="r103 r">diagnisticRecord</span>.<span class="i">Severity</span> == <span class="i">DiagnosticSeverity</span>.<span class="i">Error</span> ||
                                 (<span class="r103 r">diagnisticRecord</span>.<span class="i">IsWarningAsError</span> &amp;&amp; <span class="r103 r">diagnisticRecord</span>.<span class="i">Severity</span> == <span class="i">DiagnosticSeverity</span>.<span class="i">Warning</span>);
                    }
 
                    <b>string</b> <span id="r104 rd" class="r104 r">errorText</span> = <span class="i">BuildErrorMessage</span>(<span class="r103 r">diagnisticRecord</span>);
 
                    <b>if</b> (<span class="r103 r">diagnisticRecord</span>.<span class="i">Severity</span> == <span class="i">DiagnosticSeverity</span>.<span class="i">Warning</span>)
                    {
                        <span class="i">WriteWarning</span>(<span class="r104 r">errorText</span>);
                    }
                    <b>else</b> <b>if</b> (<span class="r103 r">diagnisticRecord</span>.<span class="i">Severity</span> == <span class="i">DiagnosticSeverity</span>.<span class="i">Info</span>)
                    {
                        <span class="i">WriteInformation</span>(<span class="r104 r">errorText</span>, <a href="#fe4463a830a2529b" class="i field">s_writeInformationTags</a>);
                    }
                    <b>else</b>
                    {
                        <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r105 rd" class="r105 r">errorRecord</span> = <b>new</b>(
                            <b>new</b> <span class="i">Exception</span>(<span class="r104 r">errorText</span>),
                            <span class="s">&quot;SOURCE_CODE_ERROR&quot;</span>,
                            <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                            <span class="r103 r">diagnisticRecord</span>);
 
                        <span class="i">WriteError</span>(<span class="r105 r">errorRecord</span>);
                    }
                }
 
                <b>if</b> (<span class="r102 r">IsError</span>)
                {
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r106 rd" class="r106 r">errorRecord</span> = <b>new</b>(
                        <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">AddTypeStrings</span>.<span class="i">CompilerErrors</span>),
                        <span class="s">&quot;COMPILER_ERRORS&quot;</span>,
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                        <b>null</b>);
                    <span class="i">ThrowTerminatingError</span>(<span class="r106 r">errorRecord</span>);
                }
            }
        }
 
        <b>private static string</b> <a id="91be833b2de191bb" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BuildErrorMessage</a>(<span class="i">Diagnostic</span> <span id="r107 rd" class="r107 r">diagnisticRecord</span>)
        {
            <b>var</b> <span id="r108 rd" class="r108 r">location</span> = <span class="r107 r">diagnisticRecord</span>.<span class="i">Location</span>;
 
            <b>if</b> (<span class="r108 r">location</span>.<span class="i">SourceTree</span> == <b>null</b>)
            {
                <span class="c">// For some error types (linker?) we don&#39;t have related source code.</span>
                <b>return</b> <span class="r107 r">diagnisticRecord</span>.<span class="i">ToString</span>();
            }
            <b>else</b>
            {
                <b>var</b> <span id="r109 rd" class="r109 r">text</span> = <span class="r108 r">location</span>.<span class="i">SourceTree</span>.<span class="i">GetText</span>();
                <b>var</b> <span id="r110 rd" class="r110 r">textLines</span> = <span class="r109 r">text</span>.<span class="i">Lines</span>;
 
                <b>var</b> <span id="r111 rd" class="r111 r">lineSpan</span> = <span class="r108 r">location</span>.<span class="i">GetLineSpan</span>(); <span class="c">// FileLinePositionSpan type.</span>
                <b>var</b> <span id="r112 rd" class="r112 r">errorLineNumber</span> = <span class="r111 r">lineSpan</span>.<span class="i">StartLinePosition</span>.<span class="i">Line</span>;
 
                <span class="c">// This is typical Roslyn diagnostic message which contains</span>
                <span class="c">// a message number, a source context and an error position.</span>
                <b>var</b> <span id="r113 rd" class="r113 r">diagnisticMessage</span> = <span class="r107 r">diagnisticRecord</span>.<span class="i">ToString</span>();
                <b>var</b> <span id="r114 rd" class="r114 r">errorLineString</span> = <span class="r110 r">textLines</span>[<span class="r112 r">errorLineNumber</span>].<span class="i">ToString</span>();
                <b>var</b> <span id="r115 rd" class="r115 r">errorPosition</span> = <span class="r111 r">lineSpan</span>.<span class="i">StartLinePosition</span>.<span class="i">Character</span>;
 
                <span class="i">StringBuilder</span> <span id="r116 rd" class="r116 r">sb</span> = <b>new</b>(<span class="r113 r">diagnisticMessage</span>.<span class="i">Length</span> + <span class="r114 r">errorLineString</span>.<span class="i">Length</span> * 2 + 4);
 
                <span class="r116 r">sb</span>.<span class="i">AppendLine</span>(<span class="r113 r">diagnisticMessage</span>);
                <span class="r116 r">sb</span>.<span class="i">AppendLine</span>(<span class="r114 r">errorLineString</span>);
 
                <b>for</b> (<b>var</b> <span id="r117 rd" class="r117 r">i</span> = 0; <span class="r117 r">i</span> &lt; <span class="r114 r">errorLineString</span>.<span class="i">Length</span>; <span class="r117 r">i</span>++)
                {
                    <b>if</b> (!<b>char</b>.<span class="i">IsWhiteSpace</span>(<span class="r114 r">errorLineString</span>[<span class="r117 r">i</span>]))
                    {
                        <span class="c">// We copy white chars from the source string.</span>
                        <span class="r116 r">sb</span>.<span class="i">Append</span>(<span class="r114 r">errorLineString</span>, 0, <span class="r117 r">i</span>);
                        <span class="c">// then pad up to the error position.</span>
                        <span class="r116 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39; &#39;</span>, <span class="i">Math</span>.<span class="i">Max</span>(0, <span class="r115 r">errorPosition</span> - <span class="r117 r">i</span>));
                        <span class="c">// then put &quot;^&quot; into the error position.</span>
                        <span class="r116 r">sb</span>.<span class="i">AppendLine</span>(<span class="s">&quot;^&quot;</span>);
                        <b>break</b>;
                    }
                }
 
                <b>return</b> <span class="r116 r">sb</span>.<span class="i">ToString</span>();
            }
        }
 
        <b>private static int</b> <a id="bd7463515339258b" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SyntaxTreeArrayGetHashCode</a>(<span class="i">IEnumerable</span>&lt;<span class="i">SyntaxTree</span>&gt; <span id="r118 rd" class="r118 r">sts</span>)
        {
            <span class="c">// We use our extension method EnumerableExtensions.SequenceGetHashCode&lt;T&gt;().</span>
            <span class="i">List</span>&lt;<b>int</b>&gt; <span id="r119 rd" class="r119 r">stHashes</span> = <b>new</b>();
            <b>foreach</b> (<b>var</b> <span id="r120 rd" class="r120 r">st</span> <b>in</b> <span class="r118 r">sts</span>)
            {
                <span class="r119 r">stHashes</span>.<span class="i">Add</span>(<span class="i">SyntaxTreeGetHashCode</span>(<span class="r120 r">st</span>));
            }
 
            <b>return</b> <span class="r119 r">stHashes</span>.<span class="i">SequenceGetHashCode</span>&lt;<b>int</b>&gt;();
        }
 
        <b>private static int</b> <a id="ce9dfe67740e4f53" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SyntaxTreeGetHashCode</a>(<span class="i">SyntaxTree</span> <span id="r121 rd" class="r121 r">st</span>)
        {
            <b>int</b> <span id="r122 rd" class="r122 r">hash</span>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r121 r">st</span>.<span class="i">FilePath</span>))
            {
                <span class="c">// If the file name does not exist, the source text is set by the user using parameters.</span>
                <span class="c">// In this case, we assume that the source text is of a small size and we can re-allocate by ToString().</span>
                <span class="r122 r">hash</span> = <span class="r121 r">st</span>.<span class="i">ToString</span>().<span class="i">GetHashCode</span>();
            }
            <b>else</b>
            {
                <span class="c">// If the file was modified, the write time stamp was also modified</span>
                <span class="c">// so we do not need to calculate the entire file hash.</span>
                <b>var</b> <span id="r123 rd" class="r123 r">updateTime</span> = <span class="i">File</span>.<span class="i">GetLastWriteTimeUtc</span>(<span class="r121 r">st</span>.<span class="i">FilePath</span>);
                <span class="r122 r">hash</span> = <span class="i">Utils</span>.<span class="i">CombineHashCodes</span>(<span class="r121 r">st</span>.<span class="i">FilePath</span>.<span class="i">GetHashCode</span>(), <span class="r123 r">updateTime</span>.<span class="i">GetHashCode</span>());
            }
 
            <b>return</b> <span class="r122 r">hash</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> SourceCodeProcessing
    }
}
</pre></td></tr></table></div></body></html>
