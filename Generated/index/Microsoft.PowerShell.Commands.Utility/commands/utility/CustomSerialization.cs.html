<!DOCTYPE html>
<html><head><title>CustomSerialization.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1139);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility/commands/utility/CustomSerialization.cs" target="_top">commands\utility\CustomSerialization.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility" target="_top">src\Microsoft.PowerShell.Commands.Utility\Microsoft.PowerShell.Commands.Utility.csproj</a> (Microsoft.PowerShell.Commands.Utility)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>using</b> <span class="i">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class provides functionality for serializing a PSObject.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="298d9c2eeba29ec2" href="../../R/298d9c2eeba29ec2.html" target="n" data-glyph="2,0" class="t t">CustomSerialization</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> constructor
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Depth of serialization.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly int</b> <a id="088f669b1bbaa559" href="../../R/088f669b1bbaa559.html" target="n" data-glyph="46,1" class="i field">_depth</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> XmlWriter to be used for writing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i">XmlWriter</span> <a id="2e5f8e9c89d4b993" href="../../R/2e5f8e9c89d4b993.html" target="n" data-glyph="46,1" class="i field">_writer</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Whether type information should be included in the xml.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly bool</b> <a id="934f83e01881b0c0" href="../../R/934f83e01881b0c0.html" target="n" data-glyph="46,1" class="i field">_notypeinformation</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> CustomerSerializer used for formatting the output for _writer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="#9b35c1284a72d046" class="t t">CustomInternalSerializer</a> <a id="b12ae1a54e22bfee" href="../../R/b12ae1a54e22bfee.html" target="n" data-glyph="46,1" class="i field">_serializer</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#298d9c2eeba29ec2" class="t t">CustomSerialization</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">writer</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> writer to be used for serialization.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">notypeinformation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> should the type information to be shown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> depth to be used for serialization. If this value is specified,</span>
        <span class="c">///</span><span class="c"> depth from types.xml is not used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="45582229d47642da" href="../../R/45582229d47642da.html" target="n" data-glyph="74,1" class="t constructor">CustomSerialization</a>(<span class="i">XmlWriter</span> <span id="r0 rd" class="r0 r">writer</span>, <b>bool</b> <span id="r1 rd" class="r1 r">notypeinformation</span>, <b>int</b> <span id="r2 rd" class="r2 r">depth</span>)
        {
            <b>if</b> (<span class="r0 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r0 r">writer</span>));
            }
 
            <b>if</b> (<span class="r2 r">depth</span> &lt; 1)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r0 r">writer</span>), <span class="i">Serialization</span>.<span class="i">DepthOfOneRequired</span>);
            }
 
            <a href="#088f669b1bbaa559" class="i field">_depth</a> = <span class="r2 r">depth</span>;
            <a href="#2e5f8e9c89d4b993" class="i field">_writer</a> = <span class="r0 r">writer</span>;
            <a href="#934f83e01881b0c0" class="i field">_notypeinformation</a> = <span class="r1 r">notypeinformation</span>;
            <a href="#b12ae1a54e22bfee" class="i field">_serializer</a> = <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default depth of serialization.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static int</b> <a id="d2b0ca3e00b32f83" href="../../R/d2b0ca3e00b32f83.html" target="n" data-glyph="102,1" class="i property">MshDefaultSerializationDepth</a> { <b>get</b>; } = 1;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#298d9c2eeba29ec2" class="t t">CustomSerialization</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">writer</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> writer to be used for serialization.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">notypeinformation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> should the type information to be shown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="e1f94130b54eac5c" href="../../R/e1f94130b54eac5c.html" target="n" data-glyph="74,1" class="t constructor">CustomSerialization</a>(<span class="i">XmlWriter</span> <span id="r3 rd" class="r3 r">writer</span>, <b>bool</b> <span id="r4 rd" class="r4 r">notypeinformation</span>)
            : <a href="#45582229d47642da" class="k">this</a>(<span class="r3 r">writer</span>, <span class="r4 r">notypeinformation</span>, <a href="#d2b0ca3e00b32f83" class="i property">MshDefaultSerializationDepth</a>)
        {
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> constructor
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> public methods
 
        <b>private bool</b> <a id="32b7cbd475964334" href="../../R/32b7cbd475964334.html" target="n" data-glyph="46,1" class="i field">_firstCall</a> = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes passed in object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object to be serialized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="6af152546daa81c4" href="../../R/6af152546daa81c4.html" target="n" data-glyph="74,1" class="i method">Serialize</a>(<b>object</b> <span id="r5 rd" class="r5 r">source</span>)
        {
            <span class="c">// Write the root element tag before writing first object.</span>
            <b>if</b> (<a href="#32b7cbd475964334" class="i field">_firstCall</a>)
            {
                <a href="#32b7cbd475964334" class="i field">_firstCall</a> = <b>false</b>;
                <a href="#5d9ded7e546aee49" class="i method">Start</a>();
            }
 
            <a href="#b12ae1a54e22bfee" class="i field">_serializer</a> = <b>new</b> <a href="#a62f1c6eac3d5e20" class="t constructor">CustomInternalSerializer</a>
                               (
                                   <a href="#2e5f8e9c89d4b993" class="i field">_writer</a>,
                                   <a href="#934f83e01881b0c0" class="i field">_notypeinformation</a>,
                                   <b>true</b>
                                );
            <a href="#b12ae1a54e22bfee" class="i field">_serializer</a>.<a href="#3d628c484daf9c9d" class="i method">WriteOneObject</a>(<span class="r5 r">source</span>, <b>null</b>, <a href="#088f669b1bbaa559" class="i field">_depth</a>);
            <a href="#b12ae1a54e22bfee" class="i field">_serializer</a> = <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes passed in object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object to be serialized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="906b63fec2e2ae30" href="../../R/906b63fec2e2ae30.html" target="n" data-glyph="74,1" class="i method">SerializeAsStream</a>(<b>object</b> <span id="r6 rd" class="r6 r">source</span>)
        {
            <a href="#b12ae1a54e22bfee" class="i field">_serializer</a> = <b>new</b> <a href="#a62f1c6eac3d5e20" class="t constructor">CustomInternalSerializer</a>
                               (
                                   <a href="#2e5f8e9c89d4b993" class="i field">_writer</a>,
                                   <a href="#934f83e01881b0c0" class="i field">_notypeinformation</a>,
                                   <b>true</b>
                                );
            <a href="#b12ae1a54e22bfee" class="i field">_serializer</a>.<a href="#3d628c484daf9c9d" class="i method">WriteOneObject</a>(<span class="r6 r">source</span>, <b>null</b>, <a href="#088f669b1bbaa559" class="i field">_depth</a>);
            <a href="#b12ae1a54e22bfee" class="i field">_serializer</a> = <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes the start of root element.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="5d9ded7e546aee49" href="../../R/5d9ded7e546aee49.html" target="n" data-glyph="76,1" class="i method">Start</a>()
        {
            <a href="#9b35c1284a72d046" class="t t">CustomInternalSerializer</a>.<a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#2e5f8e9c89d4b993" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#25d12366caf1bfe9" class="i field">RootElementTag</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Write the end of root element.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="bbbd27ced4c2a363" href="../../R/bbbd27ced4c2a363.html" target="n" data-glyph="74,1" class="i method">Done</a>()
        {
            <b>if</b> (<a href="#32b7cbd475964334" class="i field">_firstCall</a>)
            {
                <a href="#32b7cbd475964334" class="i field">_firstCall</a> = <b>false</b>;
                <a href="#5d9ded7e546aee49" class="i method">Start</a>();
            }
 
            <a href="#2e5f8e9c89d4b993" class="i field">_writer</a>.<span class="i">WriteEndElement</span>();
            <a href="#2e5f8e9c89d4b993" class="i field">_writer</a>.<span class="i">Flush</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flush the writer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="9da76a03690e2d3e" href="../../R/9da76a03690e2d3e.html" target="n" data-glyph="74,1" class="i method">DoneAsStream</a>()
        {
            <a href="#2e5f8e9c89d4b993" class="i field">_writer</a>.<span class="i">Flush</span>();
        }
 
        <b>internal void</b> <a id="03ae41b7a7632e46" href="../../R/03ae41b7a7632e46.html" target="n" data-glyph="74,1" class="i method">Stop</a>()
        {
            <a href="#9b35c1284a72d046" class="t t">CustomInternalSerializer</a> <span id="r7 rd" class="r7 r">serializer</span> = <a href="#b12ae1a54e22bfee" class="i field">_serializer</a>;
            <b>if</b> (<span class="r7 r">serializer</span> != <b>null</b>)
            {
                <span class="r7 r">serializer</span>.<a href="#e2e7bab785bbbc65" class="i method">Stop</a>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This internal helper class provides methods for serializing mshObject.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b>
    <a id="9b35c1284a72d046" href="../../R/9b35c1284a72d046.html" target="n" data-glyph="2,0" class="t t">CustomInternalSerializer</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> constructor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Xml writer to be used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i">XmlWriter</span> <a id="a5c25a74d3427084" href="../../R/a5c25a74d3427084.html" target="n" data-glyph="46,1" class="i field">_writer</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check first call for every pipeline object to write Object tag else property tag.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="45f80c4bbdf72b0a" href="../../R/45f80c4bbdf72b0a.html" target="n" data-glyph="46,1" class="i field">_firstcall</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Should the type information to be shown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly bool</b> <a id="9fbf8d4a396e81c1" href="../../R/9fbf8d4a396e81c1.html" target="n" data-glyph="46,1" class="i field">_notypeinformation</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check object call.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="afba90fde43c0fc9" href="../../R/afba90fde43c0fc9.html" target="n" data-glyph="46,1" class="i field">_firstobjectcall</a> = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9b35c1284a72d046" class="t t">CustomInternalSerializer</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">writer</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Xml writer to be used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">notypeinformation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Xml writer to be used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">isfirstcallforObject</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check first call for every pipeline object to write Object tag else property tag.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="a62f1c6eac3d5e20" href="../../R/a62f1c6eac3d5e20.html" target="n" data-glyph="74,1" class="t constructor">CustomInternalSerializer</a>(<span class="i">XmlWriter</span> <span id="r8 rd" class="r8 r">writer</span>, <b>bool</b> <span id="r9 rd" class="r9 r">notypeinformation</span>, <b>bool</b> <span id="r10 rd" class="r10 r">isfirstcallforObject</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r8 r">writer</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <a href="#a5c25a74d3427084" class="i field">_writer</a> = <span class="r8 r">writer</span>;
            <a href="#9fbf8d4a396e81c1" class="i field">_notypeinformation</a> = <span class="r9 r">notypeinformation</span>;
            <a href="#45f80c4bbdf72b0a" class="i field">_firstcall</a> = <span class="r10 r">isfirstcallforObject</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Stopping
 
        <b>private bool</b> <a id="96a15ab1deada6b6" href="../../R/96a15ab1deada6b6.html" target="n" data-glyph="46,1" class="i field">_isStopping</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called from a separate thread will stop the serialization process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="e2e7bab785bbbc65" href="../../R/e2e7bab785bbbc65.html" target="n" data-glyph="74,1" class="i method">Stop</a>()
        {
            <a href="#96a15ab1deada6b6" class="i field">_isStopping</a> = <b>true</b>;
        }
 
        <b>private void</b> <a id="51735124771fec1a" href="../../R/51735124771fec1a.html" target="n" data-glyph="76,1" class="i method">CheckIfStopping</a>()
        {
            <b>if</b> (<a href="#96a15ab1deada6b6" class="i field">_isStopping</a>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">Serialization</span>.<span class="i">Stopping</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Stopping
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This writes one object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> source to be serialized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">property</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> name of property. If null, name attribute is not written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> depth to which this object should be serialized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="3d628c484daf9c9d" href="../../R/3d628c484daf9c9d.html" target="n" data-glyph="74,1" class="i method">WriteOneObject</a>(<b>object</b> <span id="r11 rd" class="r11 r">source</span>, <b>string</b> <span id="r12 rd" class="r12 r">property</span>, <b>int</b> <span id="r13 rd" class="r13 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r13 r">depth</span> &gt;= 0, <span class="s">&quot;depth should always be greater or equal to zero&quot;</span>);
 
            <a href="#51735124771fec1a" class="i method">CheckIfStopping</a>();
 
            <b>if</b> (<span class="r11 r">source</span> == <b>null</b>)
            {
                <a href="#0aa3551035dfdf69" class="i method">WriteNull</a>(<span class="r12 r">property</span>);
                <b>return</b>;
            }
 
            <b>if</b> (<a href="#b3d7bc3e2192f250" class="i method">HandlePrimitiveKnownType</a>(<span class="r11 r">source</span>, <span class="r12 r">property</span>))
            {
                <b>return</b>;
            }
 
            <b>if</b> (<a href="#28b59fff725e5fc9" class="i method">HandlePrimitiveKnownTypePSObject</a>(<span class="r11 r">source</span>, <span class="r12 r">property</span>, <span class="r13 r">depth</span>))
            {
                <b>return</b>;
            }
 
            <span class="c">// Note: We donot use containers in depth calculation. i.e even if the</span>
            <span class="c">// current depth is zero, we serialize the container. All contained items will</span>
            <span class="c">// get serialized with depth zero.</span>
            <b>if</b> (<a href="#3a241ce6d917a8f4" class="i method">HandleKnownContainerTypes</a>(<span class="r11 r">source</span>, <span class="r12 r">property</span>, <span class="r13 r">depth</span>))
            {
                <b>return</b>;
            }
 
            <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r14 rd" class="r14 r">mshSource</span> = <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">AsPSObject</span>(<span class="r11 r">source</span>);
            <span class="c">// If depth is zero, complex type should be serialized as string.</span>
            <b>if</b> (<span class="r13 r">depth</span> == 0 || <a href="#c228d67e8954a71f" class="i method">SerializeAsString</a>(<span class="r14 r">mshSource</span>))
            {
                <a href="#e926286ab41c4e86" class="i method">HandlePSObjectAsString</a>(<span class="r14 r">mshSource</span>, <span class="r12 r">property</span>, <span class="r13 r">depth</span>);
                <b>return</b>;
            }
 
            <a href="#97d0c7e88308a69c" class="i method">HandleComplexTypePSObject</a>(<span class="r14 r">mshSource</span>, <span class="r12 r">property</span>, <span class="r13 r">depth</span>);
            <b>return</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes Primitive Known Types.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if source is handled, else false.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="b3d7bc3e2192f250" href="../../R/b3d7bc3e2192f250.html" target="n" data-glyph="76,1" class="i method">HandlePrimitiveKnownType</a>(<b>object</b> <span id="r15 rd" class="r15 r">source</span>, <b>string</b> <span id="r16 rd" class="r16 r">property</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r15 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <span class="c">// Check if source is of primitive known type</span>
            <span class="i">TypeSerializationInfo</span> <span id="r17 rd" class="r17 r">pktInfo</span> = <span class="i">KnownTypes</span>.<span class="i">GetTypeSerializationInfo</span>(<span class="r15 r">source</span>.<span class="i">GetType</span>());
            <b>if</b> (<span class="r17 r">pktInfo</span> != <b>null</b>)
            {
                <a href="#e7c55f023fc62773" class="i method">WriteOnePrimitiveKnownType</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <span class="r16 r">property</span>, <span class="r15 r">source</span>, <span class="r17 r">pktInfo</span>);
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes PSObject whose base objects are of primitive known type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">property</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true if source is handled, else false.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="28b59fff725e5fc9" href="../../R/28b59fff725e5fc9.html" target="n" data-glyph="76,1" class="i method">HandlePrimitiveKnownTypePSObject</a>(<b>object</b> <span id="r18 rd" class="r18 r">source</span>, <b>string</b> <span id="r19 rd" class="r19 r">property</span>, <b>int</b> <span id="r20 rd" class="r20 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r18 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <b>bool</b> <span id="r21 rd" class="r21 r">sourceHandled</span> = <b>false</b>;
            <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r22 rd" class="r22 r">moSource</span> = <span class="r18 r">source</span> <b>as</b> <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r22 r">moSource</span> != <b>null</b> &amp;&amp; !<span class="r22 r">moSource</span>.<span class="i">ImmediateBaseObjectIsEmpty</span>)
            {
                <span class="c">// Check if baseObject is primitive known type</span>
                <b>object</b> <span id="r23 rd" class="r23 r">baseObject</span> = <span class="r22 r">moSource</span>.<a href="/System.Management.Automation/A.html#d4170653add67c11" class="i property">ImmediateBaseObject</a>;
                <span class="i">TypeSerializationInfo</span> <span id="r24 rd" class="r24 r">pktInfo</span> = <span class="i">KnownTypes</span>.<span class="i">GetTypeSerializationInfo</span>(<span class="r23 r">baseObject</span>.<span class="i">GetType</span>());
                <b>if</b> (<span class="r24 r">pktInfo</span> != <b>null</b>)
                {
                    <a href="#e7c55f023fc62773" class="i method">WriteOnePrimitiveKnownType</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <span class="r19 r">property</span>, <span class="r23 r">baseObject</span>, <span class="r24 r">pktInfo</span>);
                    <span class="r21 r">sourceHandled</span> = <b>true</b>;
                }
            }
 
            <b>return</b> <span class="r21 r">sourceHandled</span>;
        }
 
        <b>private bool</b> <a id="3a241ce6d917a8f4" href="../../R/3a241ce6d917a8f4.html" target="n" data-glyph="76,1" class="i method">HandleKnownContainerTypes</a>(<b>object</b> <span id="r25 rd" class="r25 r">source</span>, <b>string</b> <span id="r26 rd" class="r26 r">property</span>, <b>int</b> <span id="r27 rd" class="r27 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r25 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <span class="i">ContainerType</span> <span id="r28 rd" class="r28 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">None</span>;
            <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r29 rd" class="r29 r">mshSource</span> = <span class="r25 r">source</span> <b>as</b> <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <span class="i">IEnumerable</span> <span id="r30 rd" class="r30 r">enumerable</span> = <b>null</b>;
            <span class="i">IDictionary</span> <span id="r31 rd" class="r31 r">dictionary</span> = <b>null</b>;
 
            <span class="c">// If passed in object is PSObject with no baseobject, return false.</span>
            <b>if</b> (<span class="r29 r">mshSource</span> != <b>null</b> &amp;&amp; <span class="r29 r">mshSource</span>.<span class="i">ImmediateBaseObjectIsEmpty</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// Check if source (or baseobject in mshSource) is known container type</span>
            <a href="#d4225a1551be74f0" class="i method">GetKnownContainerTypeInfo</a>(<span class="r29 r">mshSource</span> != <b>null</b> ? <span class="r29 r">mshSource</span>.<a href="/System.Management.Automation/A.html#d4170653add67c11" class="i property">ImmediateBaseObject</a> : <span class="r25 r">source</span>, <b>out</b> <span class="r28 r">ct</span>,
                                      <b>out</b> <span class="r31 r">dictionary</span>, <b>out</b> <span class="r30 r">enumerable</span>);
 
            <b>if</b> (<span class="r28 r">ct</span> == <span class="i">ContainerType</span>.<span class="i">None</span>)
                <b>return</b> <b>false</b>;
 
            <span class="i">WriteStartOfPSObject</span>(<span class="r29 r">mshSource</span> ?? <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">AsPSObject</span>(<span class="r25 r">source</span>), <span class="r26 r">property</span>, <b>true</b>);
            <b>switch</b> (<span class="r28 r">ct</span>)
            {
                <b>case</b> <span class="i">ContainerType</span>.<span class="i">Dictionary</span>:
                    {
                        <a href="#1c433cc1d73347fc" class="i method">WriteDictionary</a>(<span class="r31 r">dictionary</span>, <span class="r27 r">depth</span>);
                    }
 
                    <b>break</b>;
                <b>case</b> <span class="i">ContainerType</span>.<span class="i">Stack</span>:
                <b>case</b> <span class="i">ContainerType</span>.<span class="i">Queue</span>:
                <b>case</b> <span class="i">ContainerType</span>.<span class="i">List</span>:
                <b>case</b> <span class="i">ContainerType</span>.<span class="i">Enumerable</span>:
                    {
                        <a href="#69b8c92e32b7b669" class="i method">WriteEnumerable</a>(<span class="r30 r">enumerable</span>, <span class="r27 r">depth</span>);
                    }
 
                    <b>break</b>;
                <b>default</b>:
                    {
                        <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;All containers should be handled in the switch&quot;</span>);
                    }
 
                    <b>break</b>;
            }
 
            <span class="c">// An object which is original enumerable becomes an PSObject</span>
            <span class="c">// with arraylist on deserialization. So on roundtrip it will show up</span>
            <span class="c">// as List.</span>
            <span class="c">// We serialize properties of enumerable and on deserialization mark the object</span>
            <span class="c">// as Deserialized. So if object is marked deserialized, we should write properties.</span>
            <span class="c">// Note: we do not serialize the properties of IEnumerable if depth is zero.</span>
            <b>if</b> (<span class="r27 r">depth</span> != 0 &amp;&amp; (<span class="r28 r">ct</span> == <span class="i">ContainerType</span>.<span class="i">Enumerable</span> || (<span class="r29 r">mshSource</span> != <b>null</b> &amp;&amp; <span class="r29 r">mshSource</span>.<span class="i">IsDeserialized</span>)))
            {
                <span class="c">// Note:Depth is the depth for serialization of baseObject.</span>
                <span class="c">// Depth for serialization of each property is one less.</span>
                <a href="#b8fb69eb7bd95074" class="i method">WritePSObjectProperties</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">AsPSObject</span>(<span class="r25 r">source</span>), <span class="r27 r">depth</span>);
            }
 
            <span class="c">// If source is PSObject, serialize notes</span>
            <b>if</b> (<span class="r29 r">mshSource</span> != <b>null</b>)
            {
                <span class="c">// Serialize instanceMembers</span>
                <a href="/System.Management.Automation/A.html#7dc9937a68c9af8c" class="t t">PSMemberInfoCollection</a>&lt;<a href="/System.Management.Automation/A.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt; <span id="r32 rd" class="r32 r">instanceMembers</span> = <span class="r29 r">mshSource</span>.<span class="i">InstanceMembers</span>;
                <b>if</b> (<span class="r32 r">instanceMembers</span> != <b>null</b>)
                {
                    <a href="#aefa40b9747d6476" class="i method">WriteMemberInfoCollection</a>(<span class="r32 r">instanceMembers</span>, <span class="r27 r">depth</span>, <b>true</b>);
                }
            }
 
            <a href="#a5c25a74d3427084" class="i field">_writer</a>.<span class="i">WriteEndElement</span>();
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if source is known container type and returns appropriate information.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">ct</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">dictionary</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">enumerable</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="d4225a1551be74f0" href="../../R/d4225a1551be74f0.html" target="n" data-glyph="76,1" class="i method">GetKnownContainerTypeInfo</a>(
            <b>object</b> <span id="r33 rd" class="r33 r">source</span>, <b>out</b> <span class="i">ContainerType</span> <span id="r34 rd" class="r34 r">ct</span>, <b>out</b> <span class="i">IDictionary</span> <span id="r35 rd" class="r35 r">dictionary</span>, <b>out</b> <span class="i">IEnumerable</span> <span id="r36 rd" class="r36 r">enumerable</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r33 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">None</span>;
            <span class="r35 r">dictionary</span> = <b>null</b>;
            <span class="r36 r">enumerable</span> = <b>null</b>;
 
            <span class="r35 r">dictionary</span> = <span class="r33 r">source</span> <b>as</b> <span class="i">IDictionary</span>;
            <b>if</b> (<span class="r35 r">dictionary</span> != <b>null</b>)
            {
                <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">Dictionary</span>;
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r33 r">source</span> <b>is</b> <span class="i">Stack</span>)
            {
                <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">Stack</span>;
                <span class="r36 r">enumerable</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r33 r">source</span>);
                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r36 r">enumerable</span> != <b>null</b>, <span class="s">&quot;Stack is enumerable&quot;</span>);
            }
            <b>else</b> <b>if</b> (<span class="r33 r">source</span> <b>is</b> <span class="i">Queue</span>)
            {
                <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">Queue</span>;
                <span class="r36 r">enumerable</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r33 r">source</span>);
                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r36 r">enumerable</span> != <b>null</b>, <span class="s">&quot;Queue is enumerable&quot;</span>);
            }
            <b>else</b> <b>if</b> (<span class="r33 r">source</span> <b>is</b> <span class="i">IList</span>)
            {
                <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">List</span>;
                <span class="r36 r">enumerable</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r33 r">source</span>);
                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r36 r">enumerable</span> != <b>null</b>, <span class="s">&quot;IList is enumerable&quot;</span>);
            }
            <b>else</b>
            {
                <span class="i">Type</span> <span id="r37 rd" class="r37 r">gt</span> = <span class="r33 r">source</span>.<span class="i">GetType</span>();
                <b>if</b> (<span class="r37 r">gt</span>.<span class="i">GetTypeInfo</span>().<span class="i">IsGenericType</span>)
                {
                    <b>if</b> (<span class="i">DerivesFromGenericType</span>(<span class="r37 r">gt</span>, <b>typeof</b>(<span class="i">Stack</span>&lt;&gt;)))
                    {
                        <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">Stack</span>;
                        <span class="r36 r">enumerable</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r33 r">source</span>);
                        <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r36 r">enumerable</span> != <b>null</b>, <span class="s">&quot;Stack is enumerable&quot;</span>);
                    }
                    <b>else</b> <b>if</b> (<span class="i">DerivesFromGenericType</span>(<span class="r37 r">gt</span>, <b>typeof</b>(<span class="i">Queue</span>&lt;&gt;)))
                    {
                        <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">Queue</span>;
                        <span class="r36 r">enumerable</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r33 r">source</span>);
                        <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r36 r">enumerable</span> != <b>null</b>, <span class="s">&quot;Queue is enumerable&quot;</span>);
                    }
                    <b>else</b> <b>if</b> (<span class="i">DerivesFromGenericType</span>(<span class="r37 r">gt</span>, <b>typeof</b>(<span class="i">List</span>&lt;&gt;)))
                    {
                        <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">List</span>;
                        <span class="r36 r">enumerable</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r33 r">source</span>);
                        <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r36 r">enumerable</span> != <b>null</b>, <span class="s">&quot;Queue is enumerable&quot;</span>);
                    }
                }
            }
 
            <span class="c">// Check if type is IEnumerable</span>
            <b>if</b> (<span class="r34 r">ct</span> == <span class="i">ContainerType</span>.<span class="i">None</span>)
            {
                <span class="r36 r">enumerable</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r33 r">source</span>);
                <b>if</b> (<span class="r36 r">enumerable</span> != <b>null</b>)
                {
                    <span class="r34 r">ct</span> = <span class="i">ContainerType</span>.<span class="i">Enumerable</span>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if derived is of type baseType or a type derived from baseType.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">derived</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">baseType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="0d822ff173d84c49" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">DerivesFromGenericType</a>(<span class="i">Type</span> <span id="r38 rd" class="r38 r">derived</span>, <span class="i">Type</span> <span id="r39 rd" class="r39 r">baseType</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r38 r">derived</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r39 r">baseType</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
            <b>while</b> (<span class="r38 r">derived</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r38 r">derived</span>.<span class="i">GetTypeInfo</span>().<span class="i">IsGenericType</span>)
                    <span class="r38 r">derived</span> = <span class="r38 r">derived</span>.<span class="i">GetGenericTypeDefinition</span>();
 
                <b>if</b> (<span class="r38 r">derived</span> == <span class="r39 r">baseType</span>)
                {
                    <b>return</b> <b>true</b>;
                }
 
                <span class="r38 r">derived</span> = <span class="r38 r">derived</span>.<span class="i">GetTypeInfo</span>().<span class="i">BaseType</span>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Write PSObject
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes an PSObject whose baseobject is of primitive type.</span>
        <span class="c">///</span><span class="c"> and which has notes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Source from which notes are written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">primitive</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> primitive object which is written as base object. In most cases it</span>
        <span class="c">///</span><span class="c"> is same source.ImmediateBaseObject. When PSObject is serialized as string,</span>
        <span class="c">///</span><span class="c"> it can be different. </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#e926286ab41c4e86" class="i method">HandlePSObjectAsString</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> for more info.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">pktInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> TypeSerializationInfo for the primitive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">property</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="b6f95aa356d0fc27" href="../../R/b6f95aa356d0fc27.html" target="n" data-glyph="76,1" class="i method">WritePrimitiveTypePSObjectWithNotes</a>(
            <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r40 rd" class="r40 r">source</span>,
            <b>object</b> <span id="r41 rd" class="r41 r">primitive</span>,
            <span class="i">TypeSerializationInfo</span> <span id="r42 rd" class="r42 r">pktInfo</span>,
            <b>string</b> <span id="r43 rd" class="r43 r">property</span>,
            <b>int</b> <span id="r44 rd" class="r44 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r40 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <span class="c">// Write start of PSObject. Since baseobject is primitive known</span>
            <span class="c">// type, we do not need TypeName information.</span>
            <a href="#28c2d0fd0007254b" class="i method">WriteStartOfPSObject</a>(<span class="r40 r">source</span>, <span class="r43 r">property</span>, <span class="r40 r">source</span>.<span class="i">ToStringFromDeserialization</span> != <b>null</b>);
 
            <b>if</b> (<span class="r42 r">pktInfo</span> != <b>null</b>)
            {
                <a href="#e7c55f023fc62773" class="i method">WriteOnePrimitiveKnownType</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <b>null</b>, <span class="r41 r">primitive</span>, <span class="r42 r">pktInfo</span>);
            }
 
            <span class="c">// Serialize instanceMembers</span>
            <a href="/System.Management.Automation/A.html#7dc9937a68c9af8c" class="t t">PSMemberInfoCollection</a>&lt;<a href="/System.Management.Automation/A.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt; <span id="r45 rd" class="r45 r">instanceMembers</span> = <span class="r40 r">source</span>.<span class="i">InstanceMembers</span>;
            <b>if</b> (<span class="r45 r">instanceMembers</span> != <b>null</b>)
            {
                <a href="#aefa40b9747d6476" class="i method">WriteMemberInfoCollection</a>(<span class="r45 r">instanceMembers</span>, <span class="r44 r">depth</span>, <b>true</b>);
            }
 
            <a href="#a5c25a74d3427084" class="i field">_writer</a>.<span class="i">WriteEndElement</span>();
        }
 
        <b>private void</b> <a id="97d0c7e88308a69c" href="../../R/97d0c7e88308a69c.html" target="n" data-glyph="76,1" class="i method">HandleComplexTypePSObject</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r46 rd" class="r46 r">source</span>, <b>string</b> <span id="r47 rd" class="r47 r">property</span>, <b>int</b> <span id="r48 rd" class="r48 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r46 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <a href="#28c2d0fd0007254b" class="i method">WriteStartOfPSObject</a>(<span class="r46 r">source</span>, <span class="r47 r">property</span>, <b>true</b>);
 
            <span class="c">// Figure out what kind of object we are dealing with</span>
            <b>bool</b> <span id="r49 rd" class="r49 r">isEnum</span> = <b>false</b>;
            <b>bool</b> <span id="r50 rd" class="r50 r">isPSObject</span> = <b>false</b>;
 
            <b>if</b> (!<span class="r46 r">source</span>.<span class="i">ImmediateBaseObjectIsEmpty</span>)
            {
                <span class="r49 r">isEnum</span> = <span class="r46 r">source</span>.<a href="/System.Management.Automation/A.html#d4170653add67c11" class="i property">ImmediateBaseObject</a> <b>is</b> <span class="i">Enum</span>;
                <span class="r50 r">isPSObject</span> = <span class="r46 r">source</span>.<a href="/System.Management.Automation/A.html#d4170653add67c11" class="i property">ImmediateBaseObject</a> <b>is</b> <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            }
 
            <b>if</b> (<span class="r49 r">isEnum</span>)
            {
                <b>object</b> <span id="r51 rd" class="r51 r">baseObject</span> = <span class="r46 r">source</span>.<a href="/System.Management.Automation/A.html#d4170653add67c11" class="i property">ImmediateBaseObject</a>;
                <b>foreach</b> (<a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r52 rd" class="r52 r">prop</span> <b>in</b> <span class="r46 r">source</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>)
                {
                    <span class="i">WriteOneObject</span>(<span class="i n">System</span>.<span class="i">Convert</span>.<span class="i">ChangeType</span>(<span class="r51 r">baseObject</span>, <span class="i">Enum</span>.<span class="i">GetUnderlyingType</span>(<span class="r51 r">baseObject</span>.<span class="i">GetType</span>()), <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>), <span class="r52 r">prop</span>.<a href="/System.Management.Automation/A.html#02d8236d3d236301" class="i property">Name</a>, <span class="r48 r">depth</span>);
                }
            }
            <b>else</b> <b>if</b> (<span class="r50 r">isPSObject</span>)
            {
                <b>if</b> (<a href="#afba90fde43c0fc9" class="i field">_firstobjectcall</a>)
                {
                    <a href="#afba90fde43c0fc9" class="i field">_firstobjectcall</a> = <b>false</b>;
                    <a href="#b8fb69eb7bd95074" class="i method">WritePSObjectProperties</a>(<span class="r46 r">source</span>, <span class="r48 r">depth</span>);
                }
                <b>else</b>
                {
                    <a href="#3d628c484daf9c9d" class="i method">WriteOneObject</a>(<span class="r46 r">source</span>.<a href="/System.Management.Automation/A.html#d4170653add67c11" class="i property">ImmediateBaseObject</a>, <b>null</b>, <span class="r48 r">depth</span>);
                }
            }
            <b>else</b>
            {
                <a href="#b8fb69eb7bd95074" class="i method">WritePSObjectProperties</a>(<span class="r46 r">source</span>, <span class="r48 r">depth</span>);
            }
 
            <a href="#a5c25a74d3427084" class="i field">_writer</a>.<span class="i">WriteEndElement</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes start element, attributes and typeNames for PSObject.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">mshObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">property</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">writeTNH</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if true, TypeName information is written, else not.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="28c2d0fd0007254b" href="../../R/28c2d0fd0007254b.html" target="n" data-glyph="76,1" class="i method">WriteStartOfPSObject</a>(
            <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r53 rd" class="r53 r">mshObject</span>,
            <b>string</b> <span id="r54 rd" class="r54 r">property</span>,
            <b>bool</b> <span id="r55 rd" class="r55 r">writeTNH</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r53 r">mshObject</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <b>if</b> (<span class="r54 r">property</span> != <b>null</b>)
            {
                <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
                <a href="#610d42ba476f46e9" class="i method">WriteAttribute</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#2d7ded3db5b56951" class="i field">NameAttribute</a>, <span class="r54 r">property</span>);
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#45f80c4bbdf72b0a" class="i field">_firstcall</a>)
                {
                    <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#d262a96a86cd86c9" class="i field">PSObjectTag</a>);
                    <a href="#45f80c4bbdf72b0a" class="i field">_firstcall</a> = <b>false</b>;
                }
                <b>else</b>
                {
                    <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
                }
            }
 
            <b>object</b> <span id="r56 rd" class="r56 r">baseObject</span> = <span class="r53 r">mshObject</span>.<a href="/System.Management.Automation/A.html#d854d13536b70a12" class="i property">BaseObject</a>;
            <b>if</b> (!<a href="#9fbf8d4a396e81c1" class="i field">_notypeinformation</a>)
                <span class="i">WriteAttribute</span>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#a69e07555a488a59" class="i field">TypeAttribute</a>, <span class="r56 r">baseObject</span>.<span class="i">GetType</span>().<span class="i">ToString</span>());
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> membersets
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns true if PSObject has notes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="ea98903d6b034227" href="../../R/ea98903d6b034227.html" target="n" data-glyph="76,1" class="i method">PSObjectHasNotes</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r57 rd" class="r57 r">source</span>)
        {
            <b>if</b> (<span class="r57 r">source</span>.<span class="i">InstanceMembers</span> != <b>null</b> &amp;&amp; <span class="r57 r">source</span>.<span class="i">InstanceMembers</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serialize member set. This method serializes without writing.</span>
        <span class="c">///</span><span class="c"> enclosing tags and attributes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">me</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Enumerable containing members</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">writeEnclosingMemberSetElementTag</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if this is true, write an enclosing &quot;</span><span class="c">&lt;</span><span class="c">memberset</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">memberset</span><span class="c">&gt;</span><span class="c">&quot; tag.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private void</b> <a id="aefa40b9747d6476" href="../../R/aefa40b9747d6476.html" target="n" data-glyph="76,1" class="i method">WriteMemberInfoCollection</a>(
            <a href="/System.Management.Automation/A.html#7dc9937a68c9af8c" class="t t">PSMemberInfoCollection</a>&lt;<a href="/System.Management.Automation/A.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt; <span id="r58 rd" class="r58 r">me</span>, <b>int</b> <span id="r59 rd" class="r59 r">depth</span>, <b>bool</b> <span id="r60 rd" class="r60 r">writeEnclosingMemberSetElementTag</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r58 r">me</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r61 rd" class="r61 r">info</span> <b>in</b> <span class="r58 r">me</span>)
            {
                <b>if</b> (!<span class="r61 r">info</span>.<span class="i">ShouldSerialize</span>)
                {
                    <b>continue</b>;
                }
 
                <b>if</b> (!(<span class="r61 r">info</span> <b>is</b> <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r62 rd" class="r62 r">property</span>))
                {
                    <b>continue</b>;
                }
 
                <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
                <a href="#610d42ba476f46e9" class="i method">WriteAttribute</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#2d7ded3db5b56951" class="i field">NameAttribute</a>, <span class="r61 r">info</span>.<a href="/System.Management.Automation/A.html#02d8236d3d236301" class="i property">Name</a>);
                <b>if</b> (!<a href="#9fbf8d4a396e81c1" class="i field">_notypeinformation</a>)
                    <span class="i">WriteAttribute</span>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#a69e07555a488a59" class="i field">TypeAttribute</a>, <span class="r61 r">info</span>.<span class="i">GetType</span>().<span class="i">ToString</span>());
                <a href="#a5c25a74d3427084" class="i field">_writer</a>.<span class="i">WriteString</span>(<span class="r62 r">property</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>.<span class="i">ToString</span>());
                <a href="#a5c25a74d3427084" class="i field">_writer</a>.<span class="i">WriteEndElement</span>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> membersets
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes properties of PSObject.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="b8fb69eb7bd95074" href="../../R/b8fb69eb7bd95074.html" target="n" data-glyph="76,1" class="i method">WritePSObjectProperties</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r63 rd" class="r63 r">source</span>, <b>int</b> <span id="r64 rd" class="r64 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r63 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the information&quot;</span>);
 
            <span class="r64 r">depth</span> = <a href="#28427666131f1a0d" class="i method">GetDepthOfSerialization</a>(<span class="r63 r">source</span>, <span class="r64 r">depth</span>);
 
            <span class="c">// Depth available for each property is one less</span>
            --<span class="r64 r">depth</span>;
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r64 r">depth</span> &gt;= 0, <span class="s">&quot;depth should be greater or equal to zero&quot;</span>);
            <b>if</b> (<span class="r63 r">source</span>.<span class="i">GetSerializationMethod</span>(<b>null</b>) == <span class="i">SerializationMethod</span>.<span class="i">SpecificProperties</span>)
            {
                <span class="i">PSMemberInfoInternalCollection</span>&lt;<a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>&gt; <span id="r65 rd" class="r65 r">specificProperties</span> = <b>new</b>();
                <b>foreach</b> (<b>string</b> <span id="r66 rd" class="r66 r">propertyName</span> <b>in</b> <span class="r63 r">source</span>.<span class="i">GetSpecificPropertiesToSerialize</span>(<b>null</b>))
                {
                    <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r67 rd" class="r67 r">property</span> = <span class="r63 r">source</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>[<span class="r66 r">propertyName</span>];
                    <b>if</b> (<span class="r67 r">property</span> != <b>null</b>)
                    {
                        <span class="r65 r">specificProperties</span>.<span class="i">Add</span>(<span class="r67 r">property</span>);
                    }
                }
 
                <a href="#4bfbca84ff29e6ef" class="i method">SerializeProperties</a>(<span class="r65 r">specificProperties</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>, <span class="r64 r">depth</span>);
                <b>return</b>;
            }
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r68 rd" class="r68 r">prop</span> <b>in</b> <span class="r63 r">source</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>)
            {
                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r68 r">prop</span> != <b>null</b>, <span class="s">&quot;propertyCollection should only have member of type PSProperty&quot;</span>);
                <b>object</b> <span id="r69 rd" class="r69 r">value</span> = <a href="/System.Management.Automation/A.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="/System.Management.Automation/A.html#1cf7e193da582896" class="i property">Value</a>;
                <span class="c">// PSObject throws GetValueException if it cannot</span>
                <span class="c">// get value for a property.</span>
                <b>try</b>
                {
                    <span class="r69 r">value</span> = <span class="r68 r">prop</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>;
                }
                <b>catch</b> (<a href="/System.Management.Automation/A.html#396f7c7b826437d7" class="t t">GetValueException</a>)
                {
                    <a href="#729137eecd29dbf4" class="i method">WritePropertyWithNullValue</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <span class="r68 r">prop</span>, <span class="r64 r">depth</span>);
                    <b>continue</b>;
                }
                <span class="c">// Write the property</span>
                <b>if</b> (<span class="r69 r">value</span> == <b>null</b>)
                {
                    <a href="#729137eecd29dbf4" class="i method">WritePropertyWithNullValue</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <span class="r68 r">prop</span>, <span class="r64 r">depth</span>);
                }
                <b>else</b>
                {
                    <a href="#3d628c484daf9c9d" class="i method">WriteOneObject</a>(<span class="r69 r">value</span>, <span class="r68 r">prop</span>.<a href="/System.Management.Automation/A.html#02d8236d3d236301" class="i property">Name</a>, <span class="r64 r">depth</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes properties from collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">propertyCollection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Collection of properties to serialize.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r71 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name for enclosing element tag.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Depth to which each property should be serialized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="4bfbca84ff29e6ef" href="../../R/4bfbca84ff29e6ef.html" target="n" data-glyph="76,1" class="i method">SerializeProperties</a>(
            <span class="i">PSMemberInfoInternalCollection</span>&lt;<a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>&gt; <span id="r70 rd" class="r70 r">propertyCollection</span>, <b>string</b> <span id="r71 rd" class="r71 r">name</span>, <b>int</b> <span id="r72 rd" class="r72 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r70 r">propertyCollection</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
            <b>if</b> (<span class="r70 r">propertyCollection</span>.<span class="i">Count</span> == 0)
                <b>return</b>;
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r73 rd" class="r73 r">info</span> <b>in</b> <span class="r70 r">propertyCollection</span>)
            {
                <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r74 rd" class="r74 r">prop</span> = <span class="r73 r">info</span> <b>as</b> <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>;
 
                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r74 r">prop</span> != <b>null</b>, <span class="s">&quot;propertyCollection should only have member of type PSProperty&quot;</span>);
 
                <b>object</b> <span id="r75 rd" class="r75 r">value</span> = <a href="/System.Management.Automation/A.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="/System.Management.Automation/A.html#1cf7e193da582896" class="i property">Value</a>;
                <span class="c">// PSObject throws GetValueException if it cannot</span>
                <span class="c">// get value for a property.</span>
                <b>try</b>
                {
                    <span class="r75 r">value</span> = <span class="r74 r">prop</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>;
                }
                <b>catch</b> (<a href="/System.Management.Automation/A.html#396f7c7b826437d7" class="t t">GetValueException</a>)
                {
                    <b>continue</b>;
                }
                <span class="c">// Write the property</span>
                <a href="#3d628c484daf9c9d" class="i method">WriteOneObject</a>(<span class="r75 r">value</span>, <span class="r74 r">prop</span>.<a href="/System.Management.Automation/A.html#02d8236d3d236301" class="i property">Name</a>, <span class="r72 r">depth</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> base properties
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> WritePSObject
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> enumerable and dictionary
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes IEnumerable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">enumerable</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Enumerable which is serialized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="69b8c92e32b7b669" href="../../R/69b8c92e32b7b669.html" target="n" data-glyph="76,1" class="i method">WriteEnumerable</a>(<span class="i">IEnumerable</span> <span id="r76 rd" class="r76 r">enumerable</span>, <b>int</b> <span id="r77 rd" class="r77 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r76 r">enumerable</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <span class="i">IEnumerator</span> <span id="r78 rd" class="r78 r">enumerator</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r78 r">enumerator</span> = <span class="r76 r">enumerable</span>.<span class="i">GetEnumerator</span>();
                <span class="r78 r">enumerator</span>.<span class="i">Reset</span>();
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="r78 r">enumerator</span> = <b>null</b>;
            }
 
            <span class="c">// AD has incorrect implementation of IEnumerable where they returned null</span>
            <span class="c">// for GetEnumerator instead of empty enumerator</span>
            <b>if</b> (<span class="r78 r">enumerator</span> != <b>null</b>)
            {
                <b>while</b> (<b>true</b>)
                {
                    <b>object</b> <span id="r79 rd" class="r79 r">item</span> = <b>null</b>;
                    <b>try</b>
                    {
                        <b>if</b> (!<span class="r78 r">enumerator</span>.<span class="i">MoveNext</span>())
                        {
                            <b>break</b>;
                        }
                        <b>else</b>
                        {
                            <span class="r79 r">item</span> = <span class="r78 r">enumerator</span>.<span class="i">Current</span>;
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                        <b>break</b>;
                    }
 
                    <a href="#3d628c484daf9c9d" class="i method">WriteOneObject</a>(<span class="r79 r">item</span>, <b>null</b>, <span class="r77 r">depth</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes IDictionary.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">dictionary</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Dictionary which is serialized.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="1c433cc1d73347fc" href="../../R/1c433cc1d73347fc.html" target="n" data-glyph="76,1" class="i method">WriteDictionary</a>(<span class="i">IDictionary</span> <span id="r80 rd" class="r80 r">dictionary</span>, <b>int</b> <span id="r81 rd" class="r81 r">depth</span>)
        {
            <span class="i">IDictionaryEnumerator</span> <span id="r82 rd" class="r82 r">dictionaryEnum</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r82 r">dictionaryEnum</span> = (<span class="i">IDictionaryEnumerator</span>)<span class="r80 r">dictionary</span>.<span class="i">GetEnumerator</span>();
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <b>if</b> (<span class="r82 r">dictionaryEnum</span> != <b>null</b>)
            {
                <b>while</b> (<span class="r82 r">dictionaryEnum</span>.<span class="i">MoveNext</span>())
                {
                    <span class="c">// Write Key</span>
                    <span class="i">WriteOneObject</span>(<span class="r82 r">dictionaryEnum</span>.<span class="i">Key</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#2cb91711d3837e85" class="i field">DictionaryKey</a>, <span class="r81 r">depth</span>);
                    <span class="c">// Write Value</span>
                    <span class="i">WriteOneObject</span>(<span class="r82 r">dictionaryEnum</span>.<span class="i">Value</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#3765ebe789e3c921" class="i field">DictionaryValue</a>, <span class="r81 r">depth</span>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> enumerable and dictionary
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> serialize as string
 
        <b>private void</b> <a id="e926286ab41c4e86" href="../../R/e926286ab41c4e86.html" target="n" data-glyph="76,1" class="i method">HandlePSObjectAsString</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r83 rd" class="r83 r">source</span>, <b>string</b> <span id="r84 rd" class="r84 r">property</span>, <b>int</b> <span id="r85 rd" class="r85 r">depth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r83 r">source</span> != <b>null</b>, <span class="s">&quot;caller should validate the information&quot;</span>);
 
            <b>bool</b> <span id="r86 rd" class="r86 r">hasNotes</span> = <a href="#ea98903d6b034227" class="i method">PSObjectHasNotes</a>(<span class="r83 r">source</span>);
            <b>string</b> <span id="r87 rd" class="r87 r">value</span> = <a href="#003857fc1d200983" class="i method">GetStringFromPSObject</a>(<span class="r83 r">source</span>);
 
            <b>if</b> (<span class="r87 r">value</span> != <b>null</b>)
            {
                <span class="i">TypeSerializationInfo</span> <span id="r88 rd" class="r88 r">pktInfo</span> = <span class="i">KnownTypes</span>.<span class="i">GetTypeSerializationInfo</span>(<span class="r87 r">value</span>.<span class="i">GetType</span>());
                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r88 r">pktInfo</span> != <b>null</b>, <span class="s">&quot;TypeSerializationInfo should be present for string&quot;</span>);
                <b>if</b> (<span class="r86 r">hasNotes</span>)
                {
                    <a href="#b6f95aa356d0fc27" class="i method">WritePrimitiveTypePSObjectWithNotes</a>(<span class="r83 r">source</span>, <span class="r87 r">value</span>, <span class="r88 r">pktInfo</span>, <span class="r84 r">property</span>, <span class="r85 r">depth</span>);
                }
                <b>else</b>
                {
                    <a href="#e7c55f023fc62773" class="i method">WriteOnePrimitiveKnownType</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <span class="r84 r">property</span>, <span class="r83 r">source</span>.<a href="/System.Management.Automation/A.html#d854d13536b70a12" class="i property">BaseObject</a>, <span class="r88 r">pktInfo</span>);
                }
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r86 r">hasNotes</span>)
                {
                    <a href="#b6f95aa356d0fc27" class="i method">WritePrimitiveTypePSObjectWithNotes</a>(<span class="r83 r">source</span>, <b>null</b>, <b>null</b>, <span class="r84 r">property</span>, <span class="r85 r">depth</span>);
                }
                <b>else</b>
                {
                    <a href="#0aa3551035dfdf69" class="i method">WriteNull</a>(<span class="r84 r">property</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the string from PSObject using the information from</span>
        <span class="c">///</span><span class="c"> types.ps1xml. This string is used for serializing the PSObject.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r89 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PSObject to be converted to string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> string value to use for serializing this PSObject.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="003857fc1d200983" href="../../R/003857fc1d200983.html" target="n" data-glyph="76,1" class="i method">GetStringFromPSObject</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r89 rd" class="r89 r">source</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r89 r">source</span> != <b>null</b>, <span class="s">&quot;caller should have validated the information&quot;</span>);
 
            <span class="c">// check if we have a well known string serialization source</span>
            <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r90 rd" class="r90 r">serializationProperty</span> = <span class="r89 r">source</span>.<span class="i">GetStringSerializationSource</span>(<b>null</b>);
            <b>string</b> <span id="r91 rd" class="r91 r">result</span> = <b>null</b>;
            <b>if</b> (<span class="r90 r">serializationProperty</span> != <b>null</b>)
            {
                <b>object</b> <span id="r92 rd" class="r92 r">val</span> = <span class="r90 r">serializationProperty</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>;
                <b>if</b> (<span class="r92 r">val</span> != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <span class="c">// if we have a string serialization value, return it</span>
                        <span class="r91 r">result</span> = <span class="r92 r">val</span>.<span class="i">ToString</span>();
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                    }
                }
            }
            <b>else</b>
            {
                <b>try</b>
                {
                    <span class="c">// fall back value</span>
                    <span class="r91 r">result</span> = <span class="r89 r">source</span>.<span class="i">ToString</span>();
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                }
            }
 
            <b>return</b> <span class="r91 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reads the information the PSObject</span>
        <span class="c">///</span><span class="c"> and returns true if this object should be serialized as string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PSObject to be serialized.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the object needs to be serialized as a string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="c228d67e8954a71f" href="../../R/c228d67e8954a71f.html" target="n" data-glyph="76,1" class="i method">SerializeAsString</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r93 rd" class="r93 r">source</span>)
        {
            <b>return</b> <span class="r93 r">source</span>.<span class="i">GetSerializationMethod</span>(<b>null</b>) == <span class="i">SerializationMethod</span>.<span class="i">String</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> serialize as string
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Compute the serialization depth for an PSObject instance subtree.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PSObject whose serialization depth has to be computed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">depth</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Current depth.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static int</b> <a id="28427666131f1a0d" href="../../R/28427666131f1a0d.html" target="n" data-glyph="76,1" class="i method">GetDepthOfSerialization</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r94 rd" class="r94 r">source</span>, <b>int</b> <span id="r95 rd" class="r95 r">depth</span>)
        {
            <b>if</b> (<span class="r94 r">source</span> == <b>null</b>)
                <b>return</b> <span class="r95 r">depth</span>;
 
            <span class="c">// get the depth from the PSObject</span>
            <span class="c">// NOTE: we assume that the depth out of the PSObject is &gt; 0</span>
            <span class="c">// else we consider it not set in types.ps1xml</span>
            <b>int</b> <span id="r96 rd" class="r96 r">objectLevelDepth</span> = <span class="r94 r">source</span>.<span class="i">GetSerializationDepth</span>(<b>null</b>);
            <b>if</b> (<span class="r96 r">objectLevelDepth</span> &lt;= 0)
            {
                <span class="c">// no override at the type level</span>
                <b>return</b> <span class="r95 r">depth</span>;
            }
 
            <b>return</b> <span class="r96 r">objectLevelDepth</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">property</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="0aa3551035dfdf69" href="../../R/0aa3551035dfdf69.html" target="n" data-glyph="76,1" class="i method">WriteNull</a>(<b>string</b> <span id="r97 rd" class="r97 r">property</span>)
        {
            <b>if</b> (<span class="r97 r">property</span> != <b>null</b>)
            {
                <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
                <a href="#610d42ba476f46e9" class="i method">WriteAttribute</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#2d7ded3db5b56951" class="i field">NameAttribute</a>, <span class="r97 r">property</span>);
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#45f80c4bbdf72b0a" class="i field">_firstcall</a>)
                {
                    <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#d262a96a86cd86c9" class="i field">PSObjectTag</a>);
                    <a href="#45f80c4bbdf72b0a" class="i field">_firstcall</a> = <b>false</b>;
                }
                <b>else</b>
                {
                    <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<a href="#a5c25a74d3427084" class="i field">_writer</a>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
                }
            }
 
            <a href="#a5c25a74d3427084" class="i field">_writer</a>.<span class="i">WriteEndElement</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> known type serialization
 
        <b>private void</b> <a id="729137eecd29dbf4" href="../../R/729137eecd29dbf4.html" target="n" data-glyph="76,1" class="i method">WritePropertyWithNullValue</a>(
            <span class="i">XmlWriter</span> <span id="r98 rd" class="r98 r">writer</span>, <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r99 rd" class="r99 r">source</span>, <b>int</b> <span id="r100 rd" class="r100 r">depth</span>)
        {
            <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<span class="r98 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
            <a href="#610d42ba476f46e9" class="i method">WriteAttribute</a>(<span class="r98 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#2d7ded3db5b56951" class="i field">NameAttribute</a>, ((<a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>)<span class="r99 r">source</span>).<a href="/System.Management.Automation/A.html#02d8236d3d236301" class="i property">Name</a>);
            <b>if</b> (!<a href="#9fbf8d4a396e81c1" class="i field">_notypeinformation</a>)
                <a href="#610d42ba476f46e9" class="i method">WriteAttribute</a>(<span class="r98 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#a69e07555a488a59" class="i field">TypeAttribute</a>, ((<a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>)<span class="r99 r">source</span>).<a href="/System.Management.Automation/A.html#af662506826a4d3d" class="i property">TypeNameOfValue</a>);
            <span class="r98 r">writer</span>.<span class="i">WriteEndElement</span>();
        }
 
        <b>private void</b> <a id="d642e9969567a002" href="../../R/d642e9969567a002.html" target="n" data-glyph="76,1" class="i method">WriteObjectString</a>(
            <span class="i">XmlWriter</span> <span id="r101 rd" class="r101 r">writer</span>, <b>string</b> <span id="r102 rd" class="r102 r">property</span>, <b>object</b> <span id="r103 rd" class="r103 r">source</span>, <span class="i">TypeSerializationInfo</span> <span id="r104 rd" class="r104 r">entry</span>)
        {
            <b>if</b> (<span class="r102 r">property</span> != <b>null</b>)
            {
                <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<span class="r101 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
                <a href="#610d42ba476f46e9" class="i method">WriteAttribute</a>(<span class="r101 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#2d7ded3db5b56951" class="i field">NameAttribute</a>, <span class="r102 r">property</span>);
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#45f80c4bbdf72b0a" class="i field">_firstcall</a>)
                {
                    <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<span class="r101 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#d262a96a86cd86c9" class="i field">PSObjectTag</a>);
                    <a href="#45f80c4bbdf72b0a" class="i field">_firstcall</a> = <b>false</b>;
                }
                <b>else</b>
                {
                    <a href="#fe00fea51b809679" class="i method">WriteStartElement</a>(<span class="r101 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#0e1b9a7552bea6e4" class="i field">Properties</a>);
                }
            }
 
            <b>if</b> (!<a href="#9fbf8d4a396e81c1" class="i field">_notypeinformation</a>)
                <span class="i">WriteAttribute</span>(<span class="r101 r">writer</span>, <a href="CustomSerializationStrings.cs.html#349256909fd6272d" class="t t">CustomSerializationStrings</a>.<a href="CustomSerializationStrings.cs.html#a69e07555a488a59" class="i field">TypeAttribute</a>, <span class="r103 r">source</span>.<span class="i">GetType</span>().<span class="i">ToString</span>());
 
            <span class="r101 r">writer</span>.<span class="i">WriteString</span>(<span class="r103 r">source</span>.<span class="i">ToString</span>());
            <span class="r101 r">writer</span>.<span class="i">WriteEndElement</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes an item or property in Monad namespace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">writer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The XmlWriter stream to which the object is serialized.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">property</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of property. Pass null for item.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Object to be written.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">entry</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Serialization information about source.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="e7c55f023fc62773" href="../../R/e7c55f023fc62773.html" target="n" data-glyph="76,1" class="i method">WriteOnePrimitiveKnownType</a>(
            <span class="i">XmlWriter</span> <span id="r105 rd" class="r105 r">writer</span>, <b>string</b> <span id="r106 rd" class="r106 r">property</span>, <b>object</b> <span id="r107 rd" class="r107 r">source</span>, <span class="i">TypeSerializationInfo</span> <span id="r108 rd" class="r108 r">entry</span>)
        {
            <a href="#d642e9969567a002" class="i method">WriteObjectString</a>(<span class="r105 r">writer</span>, <span class="r106 r">property</span>, <span class="r107 r">source</span>, <span class="r108 r">entry</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> known type serialization
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> misc
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes start element in Monad namespace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">writer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">elementTag</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Tag of element.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="fe00fea51b809679" href="../../R/fe00fea51b809679.html" target="n" data-glyph="74,1" class="i method">WriteStartElement</a>(<span class="i">XmlWriter</span> <span id="r109 rd" class="r109 r">writer</span>, <b>string</b> <span id="r110 rd" class="r110 r">elementTag</span>)
        {
            <span class="r109 r">writer</span>.<span class="i">WriteStartElement</span>(<span class="r110 r">elementTag</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes attribute in monad namespace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">writer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of attribute.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Value of attribute.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="610d42ba476f46e9" href="../../R/610d42ba476f46e9.html" target="n" data-glyph="74,1" class="i method">WriteAttribute</a>(<span class="i">XmlWriter</span> <span id="r111 rd" class="r111 r">writer</span>, <b>string</b> <span id="r112 rd" class="r112 r">name</span>, <b>string</b> <span id="r113 rd" class="r113 r">value</span>)
        {
            <span class="r111 r">writer</span>.<span class="i">WriteAttributeString</span>(<span class="r112 r">name</span>, <span class="r113 r">value</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> misc
    }
}
</pre></td></tr></table></div></body></html>
