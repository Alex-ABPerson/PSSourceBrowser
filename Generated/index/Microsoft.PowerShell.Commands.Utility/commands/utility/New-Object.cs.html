<!DOCTYPE html>
<html><head><title>New-Object.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(531);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility/commands/utility/New-Object.cs" target="_top">commands\utility\New-Object.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility" target="_top">src\Microsoft.PowerShell.Commands.Utility\Microsoft.PowerShell.Commands.Utility.csproj</a> (Microsoft.PowerShell.Commands.Utility)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">region</span> Using directives
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Security</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
<b>using</b> <span class="i">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i">Diagnostics</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Create a new .net object</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="/System.Management.Automation/A.html#d056c4b8c99405e5" class="t t">VerbsCommon</a>.<a href="/System.Management.Automation/A.html#275f319554270c33" class="i field">New</a>, <span class="s">&quot;Object&quot;</span>, <span class="i">DefaultParameterSetName</span> = <a href="#90ab53f5d5a89dac" class="i field">netSetName</a>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096620&quot;</span>)]
    <b>public sealed class</b> <a id="1d8cccd56184edbd" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="b2a6653b2036129d">NewObjectCommand</span></a> : <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c"> the number</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#90ab53f5d5a89dac" class="i field">netSetName</a>, <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public string</b> <a id="8bcf543abf5254c0" href="../../R/8bcf543abf5254c0.html" target="n" data-glyph="102,1" class="i property">TypeName</a> { <b>get</b>; <b>set</b>; }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <b>private</b> <span class="i">Guid</span> <a id="186eb3195fb3b8c1" href="../../R/186eb3195fb3b8c1.html" target="n" data-glyph="46,1" class="i field">_comObjectClsId</a> = <span class="i">Guid</span>.<span class="i">Empty</span>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ProgID of the Com object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;Com&quot;</span>, <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public string</b> <a id="ae54bf854c7079c3" href="../../R/ae54bf854c7079c3.html" target="n" data-glyph="102,1" class="i property">ComObject</a> { <b>get</b>; <b>set</b>; }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parameters for the constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#90ab53f5d5a89dac" class="i field">netSetName</a>, <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>false</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 1)]
        [<span class="i">ValidateTrustedData</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;Args&quot;</span>)]
        <b>public object</b>[] <a id="10b81ee4ad1b1bf9" href="../../R/10b81ee4ad1b1bf9.html" target="n" data-glyph="102,1" class="i property">ArgumentList</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if we should have an error when Com objects will use an interop assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;Com&quot;</span>)]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="4cb0c7cf9203dea7" href="../../R/4cb0c7cf9203dea7.html" target="n" data-glyph="102,1" class="i property">Strict</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">// Updated from Hashtable to IDictionary to support the work around ordered hashtables.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the properties to be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateTrustedData</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>)]
        <b>public</b> <span class="i">IDictionary</span> <a id="cff501de8b0bbd3b" href="../../R/cff501de8b0bbd3b.html" target="n" data-glyph="102,1" class="i property">Property</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private
        <b>private object</b> <a id="1b370bc21b1dc26b" href="../../R/1b370bc21b1dc26b.html" target="n" data-glyph="76,1" class="i method">CallConstructor</a>(<span class="i">Type</span> <span id="r0 rd" class="r0 r">type</span>, <span class="i">ConstructorInfo</span>[] <span id="r1 rd" class="r1 r">constructors</span>, <b>object</b>[] <span id="r2 rd" class="r2 r">args</span>)
        {
            <b>object</b> <span id="r3 rd" class="r3 r">result</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r3 r">result</span> = <span class="i">DotNetAdapter</span>.<span class="i">ConstructorInvokeDotNet</span>(<span class="r0 r">type</span>, <span class="r1 r">constructors</span>, <span class="r2 r">args</span>);
            }
            <b>catch</b> (<a href="/System.Management.Automation/A.html#4961d7a0f93a8280" class="t t">MethodException</a> <span id="r4 rd" class="r4 r">e</span>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r4 r">e</span>,
                    <span class="s">&quot;ConstructorInvokedThrowException&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
            }
            <span class="c">// let other exceptions propagate</span>
            <b>return</b> <span class="r3 r">result</span>;
        }
 
        <b>private void</b> <a id="c0f614439e2c3989" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateMemberNotFoundError</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r5 rd" class="r5 r">pso</span>, <span class="i">DictionaryEntry</span> <span id="r6 rd" class="r6 r">property</span>, <span class="i">Type</span> <span id="r7 rd" class="r7 r">resultType</span>)
        {
            <b>string</b> <span id="r8 rd" class="r8 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">NewObjectStrings</span>.<span class="i">MemberNotFound</span>, <b>null</b>, <span class="r6 r">property</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <a href="#37f80428bd40f524" class="i method">ParameterSet2ResourceString</a>(<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>));
 
            <span class="i">ThrowTerminatingError</span>(
                <b>new</b> <span class="t">ErrorRecord</span>(
                    <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r8 r">message</span>),
                    <span class="s">&quot;InvalidOperationException&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                    <b>null</b>));
        }
 
        <b>private void</b> <a id="44a34cb11ca2dd30" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateMemberSetValueError</a>(<a href="/System.Management.Automation/A.html#8f44bde8a24c50c0" class="t t">SetValueException</a> <span id="r9 rd" class="r9 r">e</span>)
        {
            <span class="i">Exception</span> <span id="r10 rd" class="r10 r">ex</span> = <b>new</b>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">NewObjectStrings</span>.<span class="i">InvalidValue</span>, <span class="r9 r">e</span>));
            <span class="i">ThrowTerminatingError</span>(
                <b>new</b> <span class="t">ErrorRecord</span>(<span class="r10 r">ex</span>, <span class="s">&quot;SetValueException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#c855a7c43559f12f" class="i field">InvalidData</a>, <b>null</b>));
        }
 
        <b>private static string</b> <a id="37f80428bd40f524" href="../../R/37f80428bd40f524.html" target="n" data-glyph="76,1" class="i method">ParameterSet2ResourceString</a>(<b>string</b> <span id="r11 rd" class="r11 r">parameterSet</span>)
        {
            <b>if</b> (<span class="r11 r">parameterSet</span>.<span class="i">Equals</span>(<a href="#90ab53f5d5a89dac" class="i field">netSetName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <span class="s">&quot;.NET&quot;</span>;
            }
            <b>else</b> <b>if</b> (<span class="r11 r">parameterSet</span>.<span class="i">Equals</span>(<span class="s">&quot;Com&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <span class="s">&quot;COM&quot;</span>;
            }
            <b>else</b>
            {
                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;Should never get here - unknown parameter set&quot;</span>);
                <b>return</b> <span class="r11 r">parameterSet</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> private
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c"> Create the object </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="9109b6cba67f5976" href="../../R/9109b6cba67f5976.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <span class="i">Type</span> <span id="r12 rd" class="r12 r">type</span> = <b>null</b>;
            <a href="/System.Management.Automation/A.html#581bd9b947689819" class="t t">PSArgumentException</a> <span id="r13 rd" class="r13 r">mshArgE</span> = <b>null</b>;
 
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>, <a href="#90ab53f5d5a89dac" class="i field">netSetName</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
            {
                <b>object</b> <span id="r14 rd" class="r14 r">_newObject</span> = <b>null</b>;
                <b>try</b>
                {
                    <span class="r12 r">type</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<a href="#8bcf543abf5254c0" class="i property">TypeName</a>, <b>typeof</b>(<span class="i">Type</span>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) <b>as</b> <span class="i">Type</span>;
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r15 rd" class="r15 r">e</span>)
                {
                    <span class="c">// these complications in Exception handling are aim to make error messages better.</span>
                    <b>if</b> (<span class="r15 r">e</span> <b>is</b> <span class="i">InvalidCastException</span> || <span class="r15 r">e</span> <b>is</b> <span class="i">ArgumentException</span>)
                    {
                        <b>if</b> (<span class="r15 r">e</span>.<span class="i">InnerException</span> != <b>null</b> &amp;&amp; <span class="r15 r">e</span>.<span class="i">InnerException</span> <b>is</b> <span class="i">TypeResolver</span>.<span class="i">AmbiguousTypeException</span>)
                        {
                            <span class="i">ThrowTerminatingError</span>(
                                <b>new</b> <span class="t">ErrorRecord</span>(
                                    <span class="r15 r">e</span>,
                                    <span class="s">&quot;AmbiguousTypeReference&quot;</span>,
                                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#d213d05331eaaec6" class="i field">InvalidType</a>,
                                    <span class="i">targetObject</span>: <b>null</b>));
                        }
 
                        <span class="r13 r">mshArgE</span> = <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(
                            <span class="s">&quot;TypeName&quot;</span>,
                            <span class="i">NewObjectStrings</span>.<span class="i">TypeNotFound</span>,
                            <a href="#8bcf543abf5254c0" class="i property">TypeName</a>);
 
                        <span class="i">ThrowTerminatingError</span>(
                            <b>new</b> <span class="t">ErrorRecord</span>(
                                <span class="r13 r">mshArgE</span>,
                                <span class="s">&quot;TypeNotFound&quot;</span>,
                                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#d213d05331eaaec6" class="i field">InvalidType</a>,
                                <span class="i">targetObject</span>: <b>null</b>));
                    }
 
                    <b>throw</b>;
                }
 
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<span class="r12 r">type</span> != <b>null</b>, <span class="s">&quot;LanguagePrimitives.TryConvertTo failed but returned true&quot;</span>);
 
                <b>if</b> (<span class="r12 r">type</span>.<span class="i">IsByRefLike</span>)
                {
                    <span class="i">ThrowTerminatingError</span>(
                        <b>new</b> <span class="t">ErrorRecord</span>(
                            <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">NewObjectStrings</span>.<span class="i">CannotInstantiateBoxedByRefLikeType</span>,
                                <span class="r12 r">type</span>),
                            <b>nameof</b>(<span class="i">NewObjectStrings</span>.<span class="i">CannotInstantiateBoxedByRefLikeType</span>),
                            <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                            <span class="i">targetObject</span>: <b>null</b>));
                }
 
                <b>if</b> (<span class="i">Context</span>.<span class="i">LanguageMode</span> == <a href="/System.Management.Automation/A.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="/System.Management.Automation/A.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>)
                {
                    <b>if</b> (!<span class="i">CoreTypes</span>.<span class="i">Contains</span>(<span class="r12 r">type</span>))
                    {
                        <span class="i">ThrowTerminatingError</span>(
                            <b>new</b> <span class="t">ErrorRecord</span>(
                                <b>new</b> <span class="t">PSNotSupportedException</span>(<span class="i">NewObjectStrings</span>.<span class="i">CannotCreateTypeConstrainedLanguage</span>), <span class="s">&quot;CannotCreateTypeConstrainedLanguage&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>));
                    }
                }
 
                <b>switch</b> (<span class="i">Context</span>.<span class="i">LanguageMode</span>)
                {
                    <b>case</b> <a href="/System.Management.Automation/A.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="/System.Management.Automation/A.html#a659f53717c16b4b" class="i field">NoLanguage</a>:
                    <b>case</b> <a href="/System.Management.Automation/A.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="/System.Management.Automation/A.html#ea8105287b8c6b25" class="i field">RestrictedLanguage</a>:
                        <b>if</b> (<a href="/System.Management.Automation/A.html#6b51558a7a8cde26" class="t t">SystemPolicy</a>.<a href="/System.Management.Automation/A.html#2c0da8883146dab2" class="i method">GetSystemLockdownPolicy</a>() == <a href="/System.Management.Automation/A.html#9f0915f7b351778e" class="t t">SystemEnforcementMode</a>.<a href="/System.Management.Automation/A.html#5d74206001d0b817" class="i field">Enforce</a>
                            &amp;&amp; !<span class="i">CoreTypes</span>.<span class="i">Contains</span>(<span class="r12 r">type</span>))
                        {
                            <span class="i">ThrowTerminatingError</span>(
                                <b>new</b> <span class="t">ErrorRecord</span>(
                                    <b>new</b> <span class="t">PSNotSupportedException</span>(
                                        <b>string</b>.<span class="i">Format</span>(<span class="i">NewObjectStrings</span>.<span class="i">CannotCreateTypeLanguageMode</span>, <span class="i">Context</span>.<span class="i">LanguageMode</span>.<span class="i">ToString</span>())),
                                    <b>nameof</b>(<span class="i">NewObjectStrings</span>.<span class="i">CannotCreateTypeLanguageMode</span>),
                                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#26ba13af79d30a75" class="i field">PermissionDenied</a>,
                                    <span class="i">targetObject</span>: <b>null</b>));
                        }
 
                    <b>break</b>;
                }
 
                <span class="c">// WinRT does not support creating instances of attribute &amp; delegate WinRT types.</span>
                <b>if</b> (<span class="i">WinRTHelper</span>.<span class="i">IsWinRTType</span>(<span class="r12 r">type</span>) &amp;&amp; ((<b>typeof</b>(<span class="i n">System</span>.<span class="i">Attribute</span>)).<span class="i">IsAssignableFrom</span>(<span class="r12 r">type</span>) || (<b>typeof</b>(<span class="i n">System</span>.<span class="i">Delegate</span>)).<span class="i">IsAssignableFrom</span>(<span class="r12 r">type</span>)))
                {
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">NewObjectStrings</span>.<span class="i">CannotInstantiateWinRTType</span>),
                        <span class="s">&quot;CannotInstantiateWinRTType&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
                }
 
                <b>if</b> (<a href="#10b81ee4ad1b1bf9" class="i property">ArgumentList</a> == <b>null</b> || <a href="#10b81ee4ad1b1bf9" class="i property">ArgumentList</a>.<span class="i">Length</span> == 0)
                {
                    <span class="i">ConstructorInfo</span> <span id="r16 rd" class="r16 r">ci</span> = <span class="r12 r">type</span>.<span class="i">GetConstructor</span>(<span class="i">Type</span>.<span class="i">EmptyTypes</span>);
                    <b>if</b> (<span class="r16 r">ci</span> != <b>null</b> &amp;&amp; <span class="r16 r">ci</span>.<span class="i">IsPublic</span>)
                    {
                        <span class="r14 r">_newObject</span> = <span class="i">CallConstructor</span>(<span class="r12 r">type</span>, <b>new</b> <span class="i">ConstructorInfo</span>[] { <span class="r16 r">ci</span> }, <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;());
                        <b>if</b> (<span class="r14 r">_newObject</span> != <b>null</b> &amp;&amp; <a href="#cff501de8b0bbd3b" class="i property">Property</a> != <b>null</b>)
                        {
                            <span class="c">// The method invocation is disabled for &quot;Hashtable to Object conversion&quot; (Win8:649519), but we need to keep it enabled for New-Object for compatibility to PSv2</span>
                            <span class="r14 r">_newObject</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">SetObjectProperties</span>(<span class="r14 r">_newObject</span>, <a href="#cff501de8b0bbd3b" class="i property">Property</a>, <span class="r12 r">type</span>, <span class="i">CreateMemberNotFoundError</span>, <span class="i">CreateMemberSetValueError</span>, <span class="i">enableMethodCall</span>: <b>true</b>);
                        }
 
                        <span class="i">WriteObject</span>(<span class="r14 r">_newObject</span>);
                        <b>return</b>;
                    }
                    <b>else</b> <b>if</b> (<span class="r12 r">type</span>.<span class="i">IsValueType</span>)
                    {
                        <span class="c">// This is for default parameterless struct ctor which is not returned by</span>
                        <span class="c">// Type.GetConstructor(System.Type.EmptyTypes).</span>
                        <b>try</b>
                        {
                            <span class="r14 r">_newObject</span> = <span class="i">Activator</span>.<span class="i">CreateInstance</span>(<span class="r12 r">type</span>);
                            <b>if</b> (<span class="r14 r">_newObject</span> != <b>null</b> &amp;&amp; <a href="#cff501de8b0bbd3b" class="i property">Property</a> != <b>null</b>)
                            {
                                <span class="c">// Win8:649519</span>
                                <span class="r14 r">_newObject</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">SetObjectProperties</span>(<span class="r14 r">_newObject</span>, <a href="#cff501de8b0bbd3b" class="i property">Property</a>, <span class="r12 r">type</span>, <span class="i">CreateMemberNotFoundError</span>, <span class="i">CreateMemberSetValueError</span>, <span class="i">enableMethodCall</span>: <b>true</b>);
                            }
                        }
                        <b>catch</b> (<span class="i">TargetInvocationException</span> <span id="r17 rd" class="r17 r">e</span>)
                        {
                            <span class="i">ThrowTerminatingError</span>(
                                <b>new</b> <span class="t">ErrorRecord</span>(
                                <span class="r17 r">e</span>.<span class="i">InnerException</span> ?? <span class="r17 r">e</span>,
                                <span class="s">&quot;ConstructorCalledThrowException&quot;</span>,
                                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
                        }
 
                        <span class="i">WriteObject</span>(<span class="r14 r">_newObject</span>);
                        <b>return</b>;
                    }
                }
                <b>else</b>
                {
                    <span class="i">ConstructorInfo</span>[] <span id="r18 rd" class="r18 r">ctorInfos</span> = <span class="r12 r">type</span>.<span class="i">GetConstructors</span>();
 
                    <b>if</b> (<span class="r18 r">ctorInfos</span>.<span class="i">Length</span> != 0)
                    {
                        <span class="r14 r">_newObject</span> = <a href="#1b370bc21b1dc26b" class="i method">CallConstructor</a>(<span class="r12 r">type</span>, <span class="r18 r">ctorInfos</span>, <a href="#10b81ee4ad1b1bf9" class="i property">ArgumentList</a>);
                        <b>if</b> (<span class="r14 r">_newObject</span> != <b>null</b> &amp;&amp; <a href="#cff501de8b0bbd3b" class="i property">Property</a> != <b>null</b>)
                        {
                            <span class="c">// Win8:649519</span>
                            <span class="r14 r">_newObject</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">SetObjectProperties</span>(<span class="r14 r">_newObject</span>, <a href="#cff501de8b0bbd3b" class="i property">Property</a>, <span class="r12 r">type</span>, <span class="i">CreateMemberNotFoundError</span>, <span class="i">CreateMemberSetValueError</span>, <span class="i">enableMethodCall</span>: <b>true</b>);
                        }
 
                        <span class="i">WriteObject</span>(<span class="r14 r">_newObject</span>);
                        <b>return</b>;
                    }
                }
 
                <span class="r13 r">mshArgE</span> = <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(
                    <span class="s">&quot;TypeName&quot;</span>, <span class="i">NewObjectStrings</span>.<span class="i">CannotFindAppropriateCtor</span>, <a href="#8bcf543abf5254c0" class="i property">TypeName</a>);
                <span class="i">ThrowTerminatingError</span>(
                  <b>new</b> <span class="t">ErrorRecord</span>(
                      <span class="r13 r">mshArgE</span>,
                     <span class="s">&quot;CannotFindAppropriateCtor&quot;</span>,
                     <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <b>null</b>));
            }
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <b>else</b> <span class="c">// Parameterset -Com</span>
            {
                <b>int</b> <span id="r19 rd" class="r19 r">result</span> = <a href="#b4b7b990ec643e74" class="t t">NewObjectNativeMethods</a>.<a href="#63bd5510b5ace6fa" class="i method">CLSIDFromProgID</a>(<a href="#ae54bf854c7079c3" class="i property">ComObject</a>, <b>out</b> <a href="#186eb3195fb3b8c1" class="i field">_comObjectClsId</a>);
 
                <span class="c">// If we&#39;re in ConstrainedLanguage, do additional restrictions</span>
                <b>if</b> (<span class="i">Context</span>.<span class="i">LanguageMode</span> == <a href="/System.Management.Automation/A.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="/System.Management.Automation/A.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>)
                {
                    <b>bool</b> <span id="r20 rd" class="r20 r">isAllowed</span> = <b>false</b>;
 
                    <span class="c">// If it&#39;s a system-wide lockdown, we may allow additional COM types</span>
                    <b>if</b> (<a href="/System.Management.Automation/A.html#6b51558a7a8cde26" class="t t">SystemPolicy</a>.<a href="/System.Management.Automation/A.html#2c0da8883146dab2" class="i method">GetSystemLockdownPolicy</a>() == <a href="/System.Management.Automation/A.html#9f0915f7b351778e" class="t t">SystemEnforcementMode</a>.<a href="/System.Management.Automation/A.html#5d74206001d0b817" class="i field">Enforce</a>)
                    {
                        <b>if</b> ((<span class="r19 r">result</span> &gt;= 0) &amp;&amp;
                            <a href="/System.Management.Automation/A.html#6b51558a7a8cde26" class="t t">SystemPolicy</a>.<span class="i">IsClassInApprovedList</span>(<a href="#186eb3195fb3b8c1" class="i field">_comObjectClsId</a>))
                        {
                            <span class="r20 r">isAllowed</span> = <b>true</b>;
                        }
                    }
 
                    <b>if</b> (!<span class="r20 r">isAllowed</span>)
                    {
                        <span class="i">ThrowTerminatingError</span>(
                            <b>new</b> <span class="t">ErrorRecord</span>(
                                <b>new</b> <span class="t">PSNotSupportedException</span>(<span class="i">NewObjectStrings</span>.<span class="i">CannotCreateTypeConstrainedLanguage</span>), <span class="s">&quot;CannotCreateComTypeConstrainedLanguage&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>));
                        <b>return</b>;
                    }
                }
 
                <b>object</b> <span id="r21 rd" class="r21 r">comObject</span> = <a href="#f4e78187f13a9f54" class="i method">CreateComObject</a>();
                <b>string</b> <span id="r22 rd" class="r22 r">comObjectTypeName</span> = <span class="r21 r">comObject</span>.<span class="i">GetType</span>().<span class="i">FullName</span>;
                <b>if</b> (!<span class="r22 r">comObjectTypeName</span>.<span class="i">Equals</span>(<span class="s">&quot;System.__ComObject&quot;</span>))
                {
                    <span class="r13 r">mshArgE</span> = <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(
                        <span class="s">&quot;TypeName&quot;</span>, <span class="i">NewObjectStrings</span>.<span class="i">ComInteropLoaded</span>, <span class="r22 r">comObjectTypeName</span>);
                    <span class="i">WriteVerbose</span>(<span class="r13 r">mshArgE</span>.<a href="/System.Management.Automation/A.html#47635c6f566a2b45" class="i property">Message</a>);
                    <b>if</b> (<a href="#4cb0c7cf9203dea7" class="i property">Strict</a>)
                    {
                        <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(
                          <span class="r13 r">mshArgE</span>,
                         <span class="s">&quot;ComInteropLoaded&quot;</span>,
                         <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r21 r">comObject</span>));
                    }
                }
 
                <b>if</b> (<span class="r21 r">comObject</span> != <b>null</b> &amp;&amp; <a href="#cff501de8b0bbd3b" class="i property">Property</a> != <b>null</b>)
                {
                    <span class="c">// Win8:649519</span>
                    <span class="r21 r">comObject</span> = <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">SetObjectProperties</span>(<span class="r21 r">comObject</span>, <a href="#cff501de8b0bbd3b" class="i property">Property</a>, <span class="r12 r">type</span>, <span class="i">CreateMemberNotFoundError</span>, <span class="i">CreateMemberSetValueError</span>, <span class="i">enableMethodCall</span>: <b>true</b>);
                }
 
                <span class="i">WriteObject</span>(<span class="r21 r">comObject</span>);
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Com
 
        <b>private object</b> <a id="802111b6024a0e43" href="../../R/802111b6024a0e43.html" target="n" data-glyph="76,1" class="i method">SafeCreateInstance</a>(<span class="i">Type</span> <span id="r23 rd" class="r23 r">t</span>)
        {
            <b>object</b> <span id="r24 rd" class="r24 r">result</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r24 r">result</span> = <span class="i">Activator</span>.<span class="i">CreateInstance</span>(<span class="r23 r">t</span>);
            }
            <span class="c">// Does not catch InvalidComObjectException because ComObject is obtained from GetTypeFromProgID</span>
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r25 rd" class="r25 r">e</span>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r25 r">e</span>,
                    <span class="s">&quot;CannotNewNonRuntimeType&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
            }
            <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r26 rd" class="r26 r">e</span>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r26 r">e</span>,
                    <span class="s">&quot;CannotNewTypeBuilderTypedReferenceArgIteratorRuntimeArgumentHandle&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
            }
            <b>catch</b> (<span class="i">MethodAccessException</span> <span id="r27 rd" class="r27 r">e</span>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r27 r">e</span>,
                    <span class="s">&quot;CtorAccessDenied&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>));
            }
            <b>catch</b> (<span class="i">MissingMethodException</span> <span id="r28 rd" class="r28 r">e</span>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r28 r">e</span>,
                    <span class="s">&quot;NoPublicCtorMatch&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
            }
            <b>catch</b> (<span class="i">MemberAccessException</span> <span id="r29 rd" class="r29 r">e</span>)
            {
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r29 r">e</span>,
                    <span class="s">&quot;CannotCreateAbstractClass&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>));
            }
            <b>catch</b> (<span class="i">COMException</span> <span id="r30 rd" class="r30 r">e</span>)
            {
                <b>if</b> (<span class="r30 r">e</span>.<span class="i">HResult</span> == <a href="#976a69c62e0d92f7" class="i field">RPC_E_CHANGED_MODE</a>)
                {
                    <b>throw</b>;
                }
 
                <span class="i">ThrowTerminatingError</span>(
                    <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r30 r">e</span>,
                    <span class="s">&quot;NoCOMClassIdentified&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <b>null</b>));
            }
 
            <b>return</b> <span class="r24 r">result</span>;
        }
 
        <b>private sealed class</b> <a id="4e2653a7d52e0e03" href="../../R/4e2653a7d52e0e03.html" target="n" data-glyph="4,1" class="t t"><span id="fa4df6b10141f716">ComCreateInfo</span></a>
        {
            <b>public object</b> <a id="4cb2ba52243c5d7a" href="../../R/4cb2ba52243c5d7a.html" target="n" data-glyph="42,2" class="i field">objectCreated</a>;
            <b>public bool</b> <a id="f14d1f2efcf4e56a" href="../../R/f14d1f2efcf4e56a.html" target="n" data-glyph="42,2" class="i field">success</a>;
            <b>public</b> <span class="i">Exception</span> <a id="d73724bfe7775846" href="../../R/d73724bfe7775846.html" target="n" data-glyph="42,2" class="i field">e</a>;
        }
 
        <b>private</b> <a href="#4e2653a7d52e0e03" class="t t">ComCreateInfo</a> <a id="f459a47a34f6cf49" href="../../R/f459a47a34f6cf49.html" target="n" data-glyph="46,1" class="i field">createInfo</a>;
 
        <b>private void</b> <a id="c768c231977c32c6" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">STAComCreateThreadProc</a>(<b>object</b> <span id="r31 rd" class="r31 r">createstruct</span>)
        {
            <a href="#4e2653a7d52e0e03" class="t t">ComCreateInfo</a> <span id="r32 rd" class="r32 r">info</span> = (<a href="#4e2653a7d52e0e03" class="t t">ComCreateInfo</a>)<span class="r31 r">createstruct</span>;
            <b>try</b>
            {
                <span class="i">Type</span> <span id="r33 rd" class="r33 r">type</span> = <span class="i">Type</span>.<span class="i">GetTypeFromCLSID</span>(<a href="#186eb3195fb3b8c1" class="i field">_comObjectClsId</a>);
                <b>if</b> (<span class="r33 r">type</span> == <b>null</b>)
                {
                    <a href="/System.Management.Automation/A.html#581bd9b947689819" class="t t">PSArgumentException</a> <span id="r34 rd" class="r34 r">mshArgE</span> = <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(
                        <span class="s">&quot;ComObject&quot;</span>,
                        <span class="i">NewObjectStrings</span>.<span class="i">CannotLoadComObjectType</span>,
                        <a href="#ae54bf854c7079c3" class="i property">ComObject</a>);
 
                    <span class="r32 r">info</span>.<a href="#d73724bfe7775846" class="i field">e</a> = <span class="r34 r">mshArgE</span>;
                    <span class="r32 r">info</span>.<a href="#f14d1f2efcf4e56a" class="i field">success</a> = <b>false</b>;
                    <b>return</b>;
                }
 
                <span class="r32 r">info</span>.<a href="#4cb2ba52243c5d7a" class="i field">objectCreated</a> = <a href="#802111b6024a0e43" class="i method">SafeCreateInstance</a>(<span class="r33 r">type</span>);
                <span class="r32 r">info</span>.<a href="#f14d1f2efcf4e56a" class="i field">success</a> = <b>true</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r35 rd" class="r35 r">e</span>)
            {
                <span class="r32 r">info</span>.<a href="#d73724bfe7775846" class="i field">e</a> = <span class="r35 r">e</span>;
                <span class="r32 r">info</span>.<a href="#f14d1f2efcf4e56a" class="i field">success</a> = <b>false</b>;
            }
        }
 
        <b>private object</b> <a id="f4e78187f13a9f54" href="../../R/f4e78187f13a9f54.html" target="n" data-glyph="76,1" class="i method">CreateComObject</a>()
        {
            <b>try</b>
            {
                <span class="i">Type</span> <span id="r36 rd" class="r36 r">type</span> = <span class="i">Marshal</span>.<span class="i">GetTypeFromCLSID</span>(<a href="#186eb3195fb3b8c1" class="i field">_comObjectClsId</a>);
                <b>if</b> (<span class="r36 r">type</span> == <b>null</b>)
                {
                    <a href="/System.Management.Automation/A.html#581bd9b947689819" class="t t">PSArgumentException</a> <span id="r37 rd" class="r37 r">mshArgE</span> = <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(
                        <span class="s">&quot;ComObject&quot;</span>,
                        <span class="i">NewObjectStrings</span>.<span class="i">CannotLoadComObjectType</span>,
                        <a href="#ae54bf854c7079c3" class="i property">ComObject</a>);
 
                    <span class="i">ThrowTerminatingError</span>(
                        <b>new</b> <span class="t">ErrorRecord</span>(
                            <span class="r37 r">mshArgE</span>,
                            <span class="s">&quot;CannotLoadComObjectType&quot;</span>,
                            <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#d213d05331eaaec6" class="i field">InvalidType</a>,
                            <span class="i">targetObject</span>: <b>null</b>));
                }
 
                <b>return</b> <a href="#802111b6024a0e43" class="i method">SafeCreateInstance</a>(<span class="r36 r">type</span>);
            }
            <b>catch</b> (<span class="i">COMException</span> <span id="r38 rd" class="r38 r">e</span>)
            {
                <span class="c">// Check Error Code to see if Error is because of Com apartment Mismatch.</span>
                <b>if</b> (<span class="r38 r">e</span>.<span class="i">HResult</span> == <a href="#976a69c62e0d92f7" class="i field">RPC_E_CHANGED_MODE</a>)
                {
                    <a href="#f459a47a34f6cf49" class="i field">createInfo</a> = <b>new</b> <span class="t">ComCreateInfo</span>();
 
                    <span class="i">Thread</span> <span id="r39 rd" class="r39 r">thread</span> = <b>new</b>(<b>new</b> <span class="i">ParameterizedThreadStart</span>(<span class="i">STAComCreateThreadProc</span>));
                    <span class="r39 r">thread</span>.<span class="i">SetApartmentState</span>(<span class="i">ApartmentState</span>.<span class="i">STA</span>);
                    <span class="r39 r">thread</span>.<span class="i">Start</span>(<a href="#f459a47a34f6cf49" class="i field">createInfo</a>);
 
                    <span class="r39 r">thread</span>.<span class="i">Join</span>();
 
                    <b>if</b> (<a href="#f459a47a34f6cf49" class="i field">createInfo</a>.<a href="#f14d1f2efcf4e56a" class="i field">success</a>)
                    {
                        <b>return</b> <a href="#f459a47a34f6cf49" class="i field">createInfo</a>.<a href="#4cb2ba52243c5d7a" class="i field">objectCreated</a>;
                    }
 
                    <span class="i">ThrowTerminatingError</span>(
                             <b>new</b> <span class="t">ErrorRecord</span>(<a href="#f459a47a34f6cf49" class="i field">createInfo</a>.<a href="#d73724bfe7775846" class="i field">e</a>, <span class="s">&quot;NoCOMClassIdentified&quot;</span>,
                                                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <b>null</b>));
                }
                <b>else</b>
                {
                    <span class="i">ThrowTerminatingError</span>(
                        <b>new</b> <span class="t">ErrorRecord</span>(
                        <span class="r38 r">e</span>,
                        <span class="s">&quot;NoCOMClassIdentified&quot;</span>,
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <b>null</b>));
                }
 
                <b>return</b> <b>null</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Com
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">// HResult code &#39;-2147417850&#39; - Cannot change thread mode after it is set.</span>
        <b>private const int</b> <a id="976a69c62e0d92f7" href="../../R/976a69c62e0d92f7.html" target="n" data-glyph="10,1" class="i field">RPC_E_CHANGED_MODE</a> = <b>unchecked</b>((<b>int</b>)0x80010106);
        <b>private const string</b> <a id="90ab53f5d5a89dac" href="../../R/90ab53f5d5a89dac.html" target="n" data-glyph="10,1" class="i field">netSetName</a> = <span class="s">&quot;Net&quot;</span>;
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Native methods for dealing with COM objects.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="b4b7b990ec643e74" href="../../R/b4b7b990ec643e74.html" target="n" data-glyph="2,0" class="t t">NewObjectNativeMethods</a>
    {
        <span class="c">///</span><span class="c"> Return Type: HRESULT-&gt;LONG-&gt;int</span>
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CLSIDFromProgIDDllName</span>)]
        <b>internal static extern int</b> <a id="63bd5510b5ace6fa" href="../../R/63bd5510b5ace6fa.html" target="n" data-glyph="74,1" class="i method">CLSIDFromProgID</a>([<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r40 rd" class="r40 r">lpszProgID</span>, <b>out</b> <span class="i">Guid</span> <span id="r41 rd" class="r41 r">pclsid</span>);
    }
}
</pre></td></tr></table></div></body></html>
