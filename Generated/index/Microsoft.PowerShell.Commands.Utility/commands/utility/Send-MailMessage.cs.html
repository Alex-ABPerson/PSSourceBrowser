<!DOCTYPE html>
<html><head><title>Send-MailMessage.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(404);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility/commands/utility/Send-MailMessage.cs" target="_top">commands\utility\Send-MailMessage.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility" target="_top">src\Microsoft.PowerShell.Commands.Utility\Microsoft.PowerShell.Commands.Utility.csproj</a> (Microsoft.PowerShell.Commands.Utility)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Net</span>.<span class="i">Mail</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> SendMailMessage
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Implementation for the Send-MailMessage command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Obsolete</span>(<span class="s">&quot;This cmdlet does not guarantee secure connections to SMTP servers. While there is no immediate replacement available in PowerShell, we recommend you do not use Send-MailMessage at this time. See https://aka.ms/SendMailMessage for more information.&quot;</span>)]
    [<span class="i">Cmdlet</span>(<a href="/System.Management.Automation/A.html#4b3c39661547d6b5" class="t t">VerbsCommunications</a>.<a href="/System.Management.Automation/A.html#ed9d3f5345aa7ccf" class="i field">Send</a>, <span class="s">&quot;MailMessage&quot;</span>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097115&quot;</span>)]
    <b>public sealed class</b> <a id="f7f8abd852ae04bf" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="c7e0428d7a6e8025">SendMailMessage</span></a> : <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Command Line Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the files names to be attached to the email.</span>
        <span class="c">///</span><span class="c"> If the filename specified can not be found, then the relevant error</span>
        <span class="c">///</span><span class="c"> message should be thrown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;PsPath&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="2f2158871dacff49" href="../../R/2f2158871dacff49.html" target="n" data-glyph="102,1" class="i property">Attachments</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the address collection that contains the</span>
        <span class="c">///</span><span class="c"> blind carbon copy (BCC) recipients for the e-mail message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="f633fa1c5673cbc4" href="../../R/f633fa1c5673cbc4.html" target="n" data-glyph="102,1" class="i property">Bcc</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the body (content) of the message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 2, <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="b01db9d9603e854e" href="../../R/b01db9d9603e854e.html" target="n" data-glyph="102,1" class="i property">Body</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the value indicating whether the mail message body is in Html.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;BAH&quot;</span>)]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="f58ae8fa9be58591" href="../../R/f58ae8fa9be58591.html" target="n" data-glyph="102,1" class="i property">BodyAsHtml</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the encoding used for the content of the body and also the subject.</span>
        <span class="c">///</span><span class="c"> This is set to ASCII to ensure there are no problems with any email server.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;BE&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">ArgumentEncodingCompletionsAttribute</span>]
        [<span class="i">ArgumentToEncodingTransformationAttribute</span>]
        <b>public</b> <span class="i">Encoding</span> <a id="a23c254177ecaa7c" href="../../R/a23c254177ecaa7c.html" target="n" data-glyph="102,1" class="i property">Encoding</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3e7be16fcd1dee0c" class="i field">_encoding</a>;
            }
 
            <b>set</b>
            {
                <span class="i">EncodingConversion</span>.<span class="i">WarnIfObsolete</span>(<a href="#f7f8abd852ae04bf" class="k">this</a>, <b>value</b>);
                <a href="#3e7be16fcd1dee0c" class="i field">_encoding</a> = <b>value</b>;
            }
        }
 
        <b>private</b> <span class="i">Encoding</span> <a id="3e7be16fcd1dee0c" href="../../R/3e7be16fcd1dee0c.html" target="n" data-glyph="46,1" class="i field">_encoding</a> = <a href="#a23c254177ecaa7c" class="i property">Encoding</a>.<span class="i">ASCII</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the address collection that contains the</span>
        <span class="c">///</span><span class="c"> carbon copy (CC) recipients for the e-mail message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Naming&quot;</span>, <span class="s">&quot;CA1709:IdentifiersShouldBeCasedCorrectly&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;Cc&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="09a35a8ce1d8b7e1" href="../../R/09a35a8ce1d8b7e1.html" target="n" data-glyph="102,1" class="i property">Cc</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the delivery notifications options for the e-mail message. The various</span>
        <span class="c">///</span><span class="c"> options available for this parameter are None, OnSuccess, OnFailure, Delay and Never.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;DNO&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <span class="i">DeliveryNotificationOptions</span> <a id="b0b9ab15eaad08d9" href="../../R/b0b9ab15eaad08d9.html" target="n" data-glyph="102,1" class="i property">DeliveryNotificationOption</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the from address for this e-mail message. The default value for</span>
        <span class="c">///</span><span class="c"> this parameter is the email address of the currently logged on user.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="db3ccf3dc87b0a3b" href="../../R/db3ccf3dc87b0a3b.html" target="n" data-glyph="102,1" class="i property">From</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the name of the Host used to send the email. This host name will be assigned</span>
        <span class="c">///</span><span class="c"> to the Powershell variable PSEmailServer, if this host can not reached an appropriate error.</span>
        <span class="c">///</span><span class="c"> message will be displayed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 3, <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ComputerName&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="23de2d6c07289576" href="../../R/23de2d6c07289576.html" target="n" data-glyph="102,1" class="i property">SmtpServer</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the priority of the email message. The valid values for this are Normal, High and Low.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <span class="i">MailPriority</span> <a id="06a6114cb6cc88b1" href="../../R/06a6114cb6cc88b1.html" target="n" data-glyph="102,1" class="i property">Priority</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Reply-To field for this e-mail message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        <b>public string</b>[] <a id="ced3753957e54c77" href="../../R/ced3753957e54c77.html" target="n" data-glyph="102,1" class="i property">ReplyTo</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the subject of the email message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>false</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 1, <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;sub&quot;</span>)]
        <b>public string</b> <a id="d12648193f068ab7" href="../../R/d12648193f068ab7.html" target="n" data-glyph="102,1" class="i property">Subject</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the To address for this e-mail message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="08498e2a131e1c31" href="../../R/08498e2a131e1c31.html" target="n" data-glyph="102,1" class="i property">To</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the credential for this e-mail message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">Credential</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a> <a id="9483d37f06bb9620" href="../../R/9483d37f06bb9620.html" target="n" data-glyph="102,1" class="i property">Credential</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets if Secured layer is required or not.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="1d304364c0390753" href="../../R/1d304364c0390753.html" target="n" data-glyph="102,1" class="i property">UseSsl</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Port to be used on the server. </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#23de2d6c07289576" class="i property">SmtpServer</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Value must be greater than zero.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        [<span class="i">ValidateRange</span>(0, <b>int</b>.<span class="i">MaxValue</span>)]
        <b>public int</b> <a id="589cc55e8eff7b8e" href="../../R/589cc55e8eff7b8e.html" target="n" data-glyph="102,1" class="i property">Port</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private variables and methods
 
        <span class="c">// Instantiate a new instance of MailMessage</span>
        <b>private readonly</b> <span class="i">MailMessage</span> <a id="2c7e4d6102453c0c" href="../../R/2c7e4d6102453c0c.html" target="n" data-glyph="46,1" class="i field">_mMailMessage</a> = <b>new</b>();
 
        <b>private</b> <span class="i">SmtpClient</span> <a id="d0434ea58d221db7" href="../../R/d0434ea58d221db7.html" target="n" data-glyph="46,1" class="i field">_mSmtpClient</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add the input addresses which are either string or hashtable to the MailMessage.</span>
        <span class="c">///</span><span class="c"> It returns true if the from parameter has more than one value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">address</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">param</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="879cb8aac1b7989d" href="../../R/879cb8aac1b7989d.html" target="n" data-glyph="76,1" class="i method">AddAddressesToMailMessage</a>(<b>object</b> <span id="r0 rd" class="r0 r">address</span>, <b>string</b> <span id="r1 rd" class="r1 r">param</span>)
        {
            <b>string</b>[] <span id="r2 rd" class="r2 r">objEmailAddresses</span> = <span class="r0 r">address</span> <b>as string</b>[];
            <b>foreach</b> (<b>string</b> <span id="r3 rd" class="r3 r">strEmailAddress</span> <b>in</b> <span class="r2 r">objEmailAddresses</span>)
            {
                <b>try</b>
                {
                    <b>switch</b> (<span class="r1 r">param</span>)
                    {
                        <b>case</b> <span class="s">&quot;to&quot;</span>:
                            {
                                <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">To</span>.<span class="i">Add</span>(<b>new</b> <span class="i">MailAddress</span>(<span class="r3 r">strEmailAddress</span>));
                                <b>break</b>;
                            }
                        <b>case</b> <span class="s">&quot;cc&quot;</span>:
                            {
                                <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">CC</span>.<span class="i">Add</span>(<b>new</b> <span class="i">MailAddress</span>(<span class="r3 r">strEmailAddress</span>));
                                <b>break</b>;
                            }
                        <b>case</b> <span class="s">&quot;bcc&quot;</span>:
                            {
                                <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">Bcc</span>.<span class="i">Add</span>(<b>new</b> <span class="i">MailAddress</span>(<span class="r3 r">strEmailAddress</span>));
                                <b>break</b>;
                            }
                        <b>case</b> <span class="s">&quot;replyTo&quot;</span>:
                            {
                                <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">ReplyToList</span>.<span class="i">Add</span>(<b>new</b> <span class="i">MailAddress</span>(<span class="r3 r">strEmailAddress</span>));
                                <b>break</b>;
                            }
                    }
                }
                <b>catch</b> (<span class="i">FormatException</span> <span id="r4 rd" class="r4 r">e</span>)
                {
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r5 rd" class="r5 r">er</span> = <b>new</b>(<span class="r4 r">e</span>, <span class="s">&quot;FormatException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#d213d05331eaaec6" class="i field">InvalidType</a>, <b>null</b>);
                    <span class="i">WriteError</span>(<span class="r5 r">er</span>);
                    <b>continue</b>;
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> BeginProcessing override.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="89ba01acac92eff3" href="../../R/89ba01acac92eff3.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <b>try</b>
            {
                <span class="c">// Set the sender address of the mail message</span>
                <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">From</span> = <b>new</b> <span class="i">MailAddress</span>(<a href="#db3ccf3dc87b0a3b" class="i property">From</a>);
            }
            <b>catch</b> (<span class="i">FormatException</span> <span id="r6 rd" class="r6 r">e</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r7 rd" class="r7 r">er</span> = <b>new</b>(<span class="r6 r">e</span>, <span class="s">&quot;FormatException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#d213d05331eaaec6" class="i field">InvalidType</a>, <a href="#db3ccf3dc87b0a3b" class="i property">From</a>);
                <span class="i">ThrowTerminatingError</span>(<span class="r7 r">er</span>);
            }
 
            <span class="c">// Set the recipient address of the mail message</span>
            <a href="#879cb8aac1b7989d" class="i method">AddAddressesToMailMessage</a>(<a href="#08498e2a131e1c31" class="i property">To</a>, <span class="s">&quot;to&quot;</span>);
 
            <span class="c">// Set the BCC address of the mail message</span>
            <b>if</b> (<a href="#f633fa1c5673cbc4" class="i property">Bcc</a> != <b>null</b>)
            {
                <a href="#879cb8aac1b7989d" class="i method">AddAddressesToMailMessage</a>(<a href="#f633fa1c5673cbc4" class="i property">Bcc</a>, <span class="s">&quot;bcc&quot;</span>);
            }
 
            <span class="c">// Set the CC address of the mail message</span>
            <b>if</b> (<a href="#09a35a8ce1d8b7e1" class="i property">Cc</a> != <b>null</b>)
            {
                <a href="#879cb8aac1b7989d" class="i method">AddAddressesToMailMessage</a>(<a href="#09a35a8ce1d8b7e1" class="i property">Cc</a>, <span class="s">&quot;cc&quot;</span>);
            }
 
            <span class="c">// Set the Reply-To address of the mail message</span>
            <b>if</b> (<a href="#ced3753957e54c77" class="i property">ReplyTo</a> != <b>null</b>)
            {
                <a href="#879cb8aac1b7989d" class="i method">AddAddressesToMailMessage</a>(<a href="#ced3753957e54c77" class="i property">ReplyTo</a>, <span class="s">&quot;replyTo&quot;</span>);
            }
 
            <span class="c">// Set the delivery notification</span>
            <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">DeliveryNotificationOptions</span> = <a href="#b0b9ab15eaad08d9" class="i property">DeliveryNotificationOption</a>;
 
            <span class="c">// Set the subject of the mail message</span>
            <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">Subject</span> = <a href="#d12648193f068ab7" class="i property">Subject</a>;
 
            <span class="c">// Set the body of the mail message</span>
            <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">Body</span> = <a href="#b01db9d9603e854e" class="i property">Body</a>;
 
            <span class="c">// Set the subject and body encoding</span>
            <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">SubjectEncoding</span> = <a href="#a23c254177ecaa7c" class="i property">Encoding</a>;
            <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">BodyEncoding</span> = <a href="#a23c254177ecaa7c" class="i property">Encoding</a>;
 
            <span class="c">// Set the format of the mail message body as HTML</span>
            <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">IsBodyHtml</span> = <a href="#f58ae8fa9be58591" class="i property">BodyAsHtml</a>;
 
            <span class="c">// Set the priority of the mail message to normal</span>
            <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">Priority</span> = <a href="#06a6114cb6cc88b1" class="i property">Priority</a>;
 
            <span class="c">// Get the PowerShell environment variable</span>
            <span class="c">// globalEmailServer might be null if it is deleted by: PS&gt; del variable:PSEmailServer</span>
            <a href="/System.Management.Automation/A.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r8 rd" class="r8 r">globalEmailServer</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<span class="i">Internal</span>.<span class="i">GetVariable</span>(<span class="i">SpecialVariables</span>.<span class="i">PSEmailServer</span>);
 
            <b>if</b> (<a href="#23de2d6c07289576" class="i property">SmtpServer</a> == <b>null</b> &amp;&amp; <span class="r8 r">globalEmailServer</span> != <b>null</b>)
            {
                <a href="#23de2d6c07289576" class="i property">SmtpServer</a> = <span class="i">Convert</span>.<span class="i">ToString</span>(<span class="r8 r">globalEmailServer</span>.<a href="/System.Management.Automation/A.html#8b1105722178c660" class="i property">Value</a>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#23de2d6c07289576" class="i property">SmtpServer</a>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r9 rd" class="r9 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">SendMailMessageStrings</span>.<span class="i">HostNameValue</span>), <b>null</b>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>);
                <a href="#f7f8abd852ae04bf" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<span class="r9 r">er</span>);
            }
 
            <b>if</b> (<a href="#589cc55e8eff7b8e" class="i property">Port</a> == 0)
            {
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a> = <b>new</b> <span class="i">SmtpClient</span>(<a href="#23de2d6c07289576" class="i property">SmtpServer</a>);
            }
            <b>else</b>
            {
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a> = <b>new</b> <span class="i">SmtpClient</span>(<a href="#23de2d6c07289576" class="i property">SmtpServer</a>, <a href="#589cc55e8eff7b8e" class="i property">Port</a>);
            }
 
            <b>if</b> (<a href="#1d304364c0390753" class="i property">UseSsl</a>)
            {
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>.<span class="i">EnableSsl</span> = <b>true</b>;
            }
 
            <b>if</b> (<a href="#9483d37f06bb9620" class="i property">Credential</a> != <b>null</b>)
            {
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>.<span class="i">UseDefaultCredentials</span> = <b>false</b>;
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>.<span class="i">Credentials</span> = <a href="#9483d37f06bb9620" class="i property">Credential</a>.<span class="i">GetNetworkCredential</span>();
            }
            <b>else</b> <b>if</b> (!<a href="#1d304364c0390753" class="i property">UseSsl</a>)
            {
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>.<span class="i">UseDefaultCredentials</span> = <b>true</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ProcessRecord override.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="d64f9588ba0e8b53" href="../../R/d64f9588ba0e8b53.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <span class="c">// Add the attachments</span>
            <b>if</b> (<a href="#2f2158871dacff49" class="i property">Attachments</a> != <b>null</b>)
            {
                <b>string</b> <span id="r10 rd" class="r10 r">filepath</span> = <b>string</b>.<span class="i">Empty</span>;
                <b>foreach</b> (<b>string</b> <span id="r11 rd" class="r11 r">attachFile</span> <b>in</b> <a href="#2f2158871dacff49" class="i property">Attachments</a>)
                {
                    <b>try</b>
                    {
                        <span class="r10 r">filepath</span> = <span class="i">PathUtils</span>.<span class="i">ResolveFilePath</span>(<span class="r11 r">attachFile</span>, <a href="#f7f8abd852ae04bf" class="k">this</a>);
                    }
                    <b>catch</b> (<a href="/System.Management.Automation/A.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r12 rd" class="r12 r">e</span>)
                    {
                        <span class="c">// NOTE: This will throw</span>
                        <span class="i">PathUtils</span>.<span class="i">ReportFileOpenFailure</span>(<a href="#f7f8abd852ae04bf" class="k">this</a>, <span class="r10 r">filepath</span>, <span class="r12 r">e</span>);
                    }
 
                    <span class="i">Attachment</span> <span id="r13 rd" class="r13 r">mailAttachment</span> = <b>new</b>(<span class="r10 r">filepath</span>);
                    <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">Attachments</span>.<span class="i">Add</span>(<span class="r13 r">mailAttachment</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> EndProcessing override.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="a764a60da72711ce" href="../../R/a764a60da72711ce.html" target="n" data-glyph="75,1" class="i method">EndProcessing</a>()
        {
            <b>try</b>
            {
                <span class="c">// Send the mail message</span>
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>.<span class="i">Send</span>(<a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>);
            }
            <b>catch</b> (<span class="i">SmtpFailedRecipientsException</span> <span id="r14 rd" class="r14 r">ex</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r15 rd" class="r15 r">er</span> = <b>new</b>(<span class="r14 r">ex</span>, <span class="s">&quot;SmtpFailedRecipientsException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>);
                <span class="i">WriteError</span>(<span class="r15 r">er</span>);
            }
            <b>catch</b> (<span class="i">SmtpException</span> <span id="r16 rd" class="r16 r">ex</span>)
            {
                <b>if</b> (<span class="r16 r">ex</span>.<span class="i">InnerException</span> != <b>null</b>)
                {
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r17 rd" class="r17 r">er</span> = <b>new</b>(<b>new</b> <span class="i">SmtpException</span>(<span class="r16 r">ex</span>.<span class="i">InnerException</span>.<span class="i">Message</span>), <span class="s">&quot;SmtpException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>);
                    <span class="i">WriteError</span>(<span class="r17 r">er</span>);
                }
                <b>else</b>
                {
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r18 rd" class="r18 r">er</span> = <b>new</b>(<span class="r16 r">ex</span>, <span class="s">&quot;SmtpException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>);
                    <span class="i">WriteError</span>(<span class="r18 r">er</span>);
                }
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r19 rd" class="r19 r">ex</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r20 rd" class="r20 r">er</span> = <b>new</b>(<span class="r19 r">ex</span>, <span class="s">&quot;InvalidOperationException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>);
                <span class="i">WriteError</span>(<span class="r20 r">er</span>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Authentication</span>.<span class="i">AuthenticationException</span> <span id="r21 rd" class="r21 r">ex</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r22 rd" class="r22 r">er</span> = <b>new</b>(<span class="r21 r">ex</span>, <span class="s">&quot;AuthenticationException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>);
                <span class="i">WriteError</span>(<span class="r22 r">er</span>);
            }
            <b>finally</b>
            {
                <a href="#d0434ea58d221db7" class="i field">_mSmtpClient</a>.<span class="i">Dispose</span>();
 
                <span class="c">// If we don&#39;t dispose the attachments, the sender can&#39;t modify or use the files sent.</span>
                <a href="#2c7e4d6102453c0c" class="i field">_mMailMessage</a>.<span class="i">Attachments</span>.<span class="i">Dispose</span>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
}
</pre></td></tr></table></div></body></html>
