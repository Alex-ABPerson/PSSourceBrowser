<!DOCTYPE html>
<html><head><title>ImplicitRemotingCommands.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(3150);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility/commands/utility/ImplicitRemotingCommands.cs" target="_top">commands\utility\ImplicitRemotingCommands.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility" target="_top">src\Microsoft.PowerShell.Commands.Utility\Microsoft.PowerShell.Commands.Utility.csproj</a> (Microsoft.PowerShell.Commands.Utility)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Cryptography</span>.<span class="i">X509Certificates</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>using</b> <span class="i">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <b>using</b> <span class="t">PowerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a>;
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements Export-PSSession cmdlet.</span>
    <span class="c">///</span><span class="c"> Spec: TBD.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="/System.Management.Automation/A.html#ced47428947bccb7" class="t t">VerbsData</a>.<a href="/System.Management.Automation/A.html#b9aa6c12c628301b" class="i field">Export</a>, <span class="s">&quot;PSSession&quot;</span>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096604&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">FileInfo</span>))]
    <b>public sealed class</b> <a id="c70edc97a57d061b" href="../../R/c70edc97a57d061b.html" target="n" data-glyph="0,0" class="t t"><span id="35ea19770c212bb5">ExportPSSessionCommand</span></a> : <a href="#416ee3a25470f4b8" class="t t">ImplicitRemotingCommandBase</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Version of the script generator used (by this Export-PSSession cmdlet) to generate psm1 and psd1 files.</span>
        <span class="c">///</span><span class="c"> Generated script checks this version to see if it needs to be regenerated.  There are 2 situations where this is needed</span>
        <span class="c">///</span><span class="c"> 1. the script needs to be regenerated because a bug fix made previous versions incompatible with the rest of the system (i.e. with ObjectModelWrapper).</span>
        <span class="c">///</span><span class="c"> 2. ths script needs to be regenerated because a security vulnerability was found inside generated code (there is no way to service generated code, but we can service the dll that reports the version that the generated script checks against).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">Version</span> <a id="874b29ad489ea122" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">VersionOfScriptGenerator</a> { <b>get</b> { <b>return</b> <a href="#7d6c598f11254b64" class="t t">ImplicitRemotingCodeGenerator</a>.<a href="#81a2e72527d4cf19" class="i field">VersionOfScriptWriter</a>; } }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Mandatory file name to write to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 1)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;PSPath&quot;</span>, <span class="s">&quot;ModuleName&quot;</span>)]
        <b>public string</b> <a id="21fbe05dcb88aa28" href="../../R/21fbe05dcb88aa28.html" target="n" data-glyph="102,1" class="i property">OutputModule</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Property that sets force parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="f4b08bc2493f671b" href="../../R/f4b08bc2493f671b.html" target="n" data-glyph="102,1" class="i property">Force</a>
        {
            <b>get</b>
            {
                <b>return</b> <b>new</b> <span class="t">SwitchParameter</span>(<a href="#795e5bc461c85dcb" class="i field">_force</a>);
            }
 
            <b>set</b>
            {
                <a href="#795e5bc461c85dcb" class="i field">_force</a> = <b>value</b>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>;
            }
        }
 
        <b>private bool</b> <a id="795e5bc461c85dcb" href="../../R/795e5bc461c85dcb.html" target="n" data-glyph="46,1" class="i field">_force</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encoding optional flag.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ArgumentToEncodingTransformationAttribute</span>()]
        [<span class="i">ArgumentEncodingCompletionsAttribute</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <span class="i">Encoding</span> <a id="086c6cccaa68340b" href="../../R/086c6cccaa68340b.html" target="n" data-glyph="102,1" class="i property">Encoding</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a843277a498d687c" class="i field">_encoding</a>;
            }
 
            <b>set</b>
            {
                <span class="i">EncodingConversion</span>.<span class="i">WarnIfObsolete</span>(<a href="#c70edc97a57d061b" class="k">this</a>, <b>value</b>);
                <a href="#a843277a498d687c" class="i field">_encoding</a> = <b>value</b>;
            }
        }
 
        <b>private</b> <span class="i">Encoding</span> <a id="a843277a498d687c" href="../../R/a843277a498d687c.html" target="n" data-glyph="46,1" class="i field">_encoding</a> = <span class="i">ClrFacade</span>.<span class="i">GetDefaultEncoding</span>();
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Implementation
 
        <b>private const string</b> <a id="4860e92006f750e6" href="../../R/4860e92006f750e6.html" target="n" data-glyph="10,1" class="i field">getChildItemScript</a> = <span class="s">@&quot;
                param($path)
                Get-ChildItem -LiteralPath $path
            &quot;</span>;
 
        <b>private const string</b> <a id="542497bd4ecf4321" href="../../R/542497bd4ecf4321.html" target="n" data-glyph="10,1" class="i field">copyItemScript</a> = <span class="s">@&quot;
                param($sourcePath, $destinationPath)
                Copy-Item -Recurse $sourcePath\\* -Destination $destinationPath\\
                Remove-item $sourcePath -Recurse -Force
            &quot;</span>;
 
        <b>private void</b> <a id="1aa91dbefc1609b0" href="../../R/1aa91dbefc1609b0.html" target="n" data-glyph="76,1" class="i method">DisplayDirectory</a>(<span class="i">List</span>&lt;<b>string</b>&gt; <span id="r0 rd" class="r0 r">generatedFiles</span>)
        {
            <a href="/System.Management.Automation/A.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r1 rd" class="r1 r">script</span> = <a href="#c70edc97a57d061b" class="k">this</a>.<span class="i">Context</span>.<span class="i">Engine</span>.<span class="i">ParseScriptBlock</span>(<a href="#4860e92006f750e6" class="i field">getChildItemScript</a>, <b>false</b>);
            <span class="i">Collection</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r2 rd" class="r2 r">results</span> = <span class="r1 r">script</span>.<span class="i">Invoke</span>(<b>new</b> <b>object</b>[] { <span class="r0 r">generatedFiles</span>.<span class="i">ToArray</span>() });
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r3 rd" class="r3 r">o</span> <b>in</b> <span class="r2 r">results</span>)
            {
                <a href="#c70edc97a57d061b" class="k">this</a>.<span class="i">WriteObject</span>(<span class="r3 r">o</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs initialization of cmdlet execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="94cc7252100dba9a" href="../../R/94cc7252100dba9a.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <span class="c">// Module and FullyQualifiedModule should not be specified at the same time.</span>
            <span class="c">// Throw out terminating error if this is the case.</span>
            <b>if</b> (<a href="#3f9c47f7d5c8deb1" class="i field">IsModuleSpecified</a> &amp;&amp; <a href="#0ae38c7b738bd78d" class="i field">IsFullyQualifiedModuleSpecified</a>)
            {
                <b>string</b> <span id="r4 rd" class="r4 r">errMsg</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">SessionStateStrings</span>.<span class="i">GetContent_TailAndHeadCannotCoexist</span>, <b>nameof</b>(<a href="#f7751d4990752d74" class="i property">Module</a>), <b>nameof</b>(<a href="#00d1812e0cc1a13e" class="i property">FullyQualifiedModule</a>));
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r5 rd" class="r5 r">error</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r4 r">errMsg</span>), <span class="s">&quot;ModuleAndFullyQualifiedModuleCannotBeSpecifiedTogether&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r5 r">error</span>);
            }
 
            <span class="i">DirectoryInfo</span> <span id="r6 rd" class="r6 r">directory</span> = <span class="i">PathUtils</span>.<span class="i">CreateModuleDirectory</span>(<a href="#c70edc97a57d061b" class="k">this</a>, <a href="#c70edc97a57d061b" class="k">this</a>.<a href="#21fbe05dcb88aa28" class="i property">OutputModule</a>, <a href="#c70edc97a57d061b" class="k">this</a>.<a href="#f4b08bc2493f671b" class="i property">Force</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>);
 
            <span class="c">// Creating a temporary directory where files will be created.</span>
            <span class="c">// Then, copy the files from this location to the location specified in OutputModule</span>
            <span class="c">// We are doing this since temporary locations in user directory are more secure.</span>
            <span class="i">DirectoryInfo</span> <span id="r7 rd" class="r7 r">tempDirectory</span> = <span class="i">PathUtils</span>.<span class="i">CreateTemporaryDirectory</span>();
 
            <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r8 rd" class="r8 r">alias2resolvedCommandName</span>;
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r9 rd" class="r9 r">listOfCommandMetadata</span> = <a href="#c70edc97a57d061b" class="k">this</a>.<a href="#bb4406572a38338d" class="i method">GetRemoteCommandMetadata</a>(<b>out</b> <span class="r8 r">alias2resolvedCommandName</span>);
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <span id="r10 rd" class="r10 r">listOfFormatData</span> = <a href="#c70edc97a57d061b" class="k">this</a>.<a href="#97ccd0535f2260b9" class="i method">GetRemoteFormatData</a>();
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r11 rd" class="r11 r">generatedFiles</span> = <span class="i">GenerateProxyModule</span>(
                <span class="r7 r">tempDirectory</span>,
                <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r6 r">directory</span>.<span class="i">FullName</span>),
                <a href="#086c6cccaa68340b" class="i property">Encoding</a>,
                <a href="#795e5bc461c85dcb" class="i field">_force</a>,
                <span class="r9 r">listOfCommandMetadata</span>,
                <span class="r8 r">alias2resolvedCommandName</span>,
                <span class="r10 r">listOfFormatData</span>
                );
 
            <a href="/System.Management.Automation/A.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r12 rd" class="r12 r">script</span> = <a href="#c70edc97a57d061b" class="k">this</a>.<span class="i">Context</span>.<span class="i">Engine</span>.<span class="i">ParseScriptBlock</span>(<a href="#542497bd4ecf4321" class="i field">copyItemScript</a>, <b>false</b>);
            <span class="r12 r">script</span>.<span class="i">Invoke</span>(<b>new</b> <b>object</b>[] { <span class="r7 r">tempDirectory</span>, <span class="r6 r">directory</span> });
 
            <a href="#c70edc97a57d061b" class="k">this</a>.<a href="#1aa91dbefc1609b0" class="i method">DisplayDirectory</a>(<b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt; { <span class="r6 r">directory</span>.<span class="i">FullName</span> });
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Methods
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements Import-PSSession cmdlet.</span>
    <span class="c">///</span><span class="c"> Spec: http://cmdletdesigner/SpecViewer/Default.aspx?Project=PowerShell</span><span class="c">&amp;amp;</span><span class="c">Cmdlet=Import-Command .</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="/System.Management.Automation/A.html#ced47428947bccb7" class="t t">VerbsData</a>.<a href="/System.Management.Automation/A.html#7307de9a00fd0115" class="i field">Import</a>, <span class="s">&quot;PSSession&quot;</span>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096712&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="/System.Management.Automation/A.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>))]
    <b>public sealed class</b> <a id="7f4a5af07b17c790" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="16eb2f715efd5be6">ImportPSSessionCommand</span></a> : <a href="#416ee3a25470f4b8" class="t t">ImplicitRemotingCommandBase</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Hooking runspace closed event into module cleanup
 
        <b>private const string</b> <a id="d5b2996357751ad1" href="../../R/d5b2996357751ad1.html" target="n" data-glyph="10,1" class="i field">runspaceStateChangedScript</a> = <span class="s">@&quot;&amp; {
            if (&#39;Closed&#39; -eq $eventArgs.RunspaceStateInfo.State)
            {
                $sourceIdentifier = [system.management.automation.wildcardpattern]::Escape($eventSubscriber.SourceIdentifier)
                Unregister-Event -SourceIdentifier $sourceIdentifier -Force -ErrorAction SilentlyContinue
 
                $moduleInfo = $event.MessageData
                Remove-Module -ModuleInfo $moduleInfo -Force -ErrorAction SilentlyContinue
 
                Remove-Item -LiteralPath $moduleInfo.ModuleBase -Recurse -Force -ErrorAction SilentlyContinue
                $moduleInfo = $null
            }
}
            &quot;</span>;
 
        <b>private const string</b> <a id="4dbd7a4c8b0d9fb9" href="../../R/4dbd7a4c8b0d9fb9.html" target="n" data-glyph="10,1" class="i field">unregisterEventCleanUpScript</a> = <span class="s">@&quot;
            $sourceIdentifier = [system.management.automation.wildcardpattern]::Escape($eventSubscriber.SourceIdentifier)
            Unregister-Event -SourceIdentifier $sourceIdentifier -Force -ErrorAction SilentlyContinue
 
            if ($null -ne $previousScript)
            {
                &amp; $previousScript $args
            }
            &quot;</span>;
 
        <b>private void</b> <a id="77598c8b2e97a475" href="../../R/77598c8b2e97a475.html" target="n" data-glyph="76,1" class="i method">RegisterModuleCleanUp</a>(<a href="/System.Management.Automation/A.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r13 rd" class="r13 r">moduleInfo</span>)
        {
            <b>if</b> (<span class="r13 r">moduleInfo</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r13 r">moduleInfo</span>));
            }
 
            <span class="c">// Note: we are using this.Context.Events to make sure that the event handler</span>
            <span class="c">//       is executing on the pipeline thread (for thread-safety)</span>
 
            <b>string</b> <span id="r14 rd" class="r14 r">sourceIdentifier</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">EventSourceIdentifier</span>, <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#3db47a8aa30f9ffc" class="i property">Session</a>.<a href="/System.Management.Automation/A.html#efd181c61ecd05ff" class="i property">InstanceId</a>, <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#baa7ba1919ae28d7" class="i property">ModuleGuid</a>);
            <a href="/System.Management.Automation/A.html#b185773a8f107fac" class="t t">PSEventSubscriber</a> <span id="r15 rd" class="r15 r">eventSubscriber</span> = <a href="#7f4a5af07b17c790" class="k">this</a>.<span class="i">Context</span>.<span class="i">Events</span>.<span class="i">SubscribeEvent</span>(
                <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#3db47a8aa30f9ffc" class="i property">Session</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>,
                <span class="s">&quot;StateChanged&quot;</span>,
                <span class="r14 r">sourceIdentifier</span>,
                <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">AsPSObject</span>(<span class="r13 r">moduleInfo</span>),
                <a href="#7f4a5af07b17c790" class="k">this</a>.<span class="i">Context</span>.<span class="i">Engine</span>.<span class="i">ParseScriptBlock</span>(<a href="#d5b2996357751ad1" class="i field">runspaceStateChangedScript</a>, <b>false</b>),
                <b>true</b>, <b>false</b>);
 
            <span class="c">//</span>
            <span class="c">// hook into moduleInfo.OnRemove to remove the handler when the module goes away</span>
            <span class="c">//</span>
 
            <a href="/System.Management.Automation/A.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r16 rd" class="r16 r">newScript</span> = <a href="#7f4a5af07b17c790" class="k">this</a>.<span class="i">Context</span>.<span class="i">Engine</span>.<span class="i">ParseScriptBlock</span>(<a href="#4dbd7a4c8b0d9fb9" class="i field">unregisterEventCleanUpScript</a>, <b>false</b>);
            <span class="r16 r">newScript</span> = <span class="r16 r">newScript</span>.<a href="/System.Management.Automation/A.html#6f3bdb602b7bca08" class="i method">GetNewClosure</a>(); <span class="c">// create a separate scope for variables set below</span>
            <span class="r16 r">newScript</span>.<a href="/System.Management.Automation/A.html#da67b7d69aadb962" class="i property">Module</a>.<a href="/System.Management.Automation/A.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#0198da5eba13cb75" class="i property">PSVariable</a>.<span class="i">Set</span>(<span class="s">&quot;eventSubscriber&quot;</span>, <span class="r15 r">eventSubscriber</span>);
            <span class="r16 r">newScript</span>.<a href="/System.Management.Automation/A.html#da67b7d69aadb962" class="i property">Module</a>.<a href="/System.Management.Automation/A.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#0198da5eba13cb75" class="i property">PSVariable</a>.<span class="i">Set</span>(<span class="s">&quot;previousScript&quot;</span>, <span class="r13 r">moduleInfo</span>.<a href="/System.Management.Automation/A.html#a91c0dfe9b197014" class="i property">OnRemove</a>);
 
            <span class="r13 r">moduleInfo</span>.<span class="i">OnRemove</span> = <span class="r16 r">newScript</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Creating and importing the module
 
        <b>private const string</b> <a id="5d1d4b3eb6309f5f" href="../../R/5d1d4b3eb6309f5f.html" target="n" data-glyph="10,1" class="i field">importModuleScript</a> = <span class="s">@&quot;
                param($name, $session, $prefix, $disableNameChecking)
                Import-Module -Name $name -Alias * -Function * -Prefix $prefix -DisableNameChecking:$disableNameChecking -PassThru -ArgumentList @($session)
            &quot;</span>;
 
        <b>private</b> <a href="/System.Management.Automation/A.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="9c426c4ec917d44b" href="../../R/9c426c4ec917d44b.html" target="n" data-glyph="76,1" class="i method">CreateModule</a>(<b>string</b> <span id="r17 rd" class="r17 r">manifestFile</span>)
        {
            <a href="/System.Management.Automation/A.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r18 rd" class="r18 r">script</span> = <a href="#7f4a5af07b17c790" class="k">this</a>.<span class="i">Context</span>.<span class="i">Engine</span>.<span class="i">ParseScriptBlock</span>(<a href="#5d1d4b3eb6309f5f" class="i field">importModuleScript</a>, <b>false</b>);
            <span class="i">Collection</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r19 rd" class="r19 r">results</span> = <span class="r18 r">script</span>.<span class="i">Invoke</span>(<span class="r17 r">manifestFile</span>, <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#3db47a8aa30f9ffc" class="i property">Session</a>, <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#f0ad562e4561be82" class="i property">Prefix</a>, <a href="#eb31297066757ff0" class="i field">_disableNameChecking</a>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r19 r">results</span> != <b>null</b>, <span class="s">&quot;Import-Module should always succeed&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r19 r">results</span>.<span class="i">Count</span> == 1, <span class="s">&quot;Import-Module should always succeed&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r19 r">results</span>[0].<span class="i">BaseObject</span> <b>is</b> <a href="/System.Management.Automation/A.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>, <span class="s">&quot;Import-Module should always succeed&quot;</span>);
            <b>return</b> (<a href="/System.Management.Automation/A.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>)(<span class="r19 r">results</span>[0].<span class="i">BaseObject</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Extra parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specified a prefix used to modify names of imported commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <b>new</b> <b>string</b> <a id="f0ad562e4561be82" href="../../R/f0ad562e4561be82.html" target="n" data-glyph="102,1" class="i property">Prefix</a>
        {
            <b>get</b> { <b>return</b> <a href="#416ee3a25470f4b8" class="k">base</a>.<a href="#462fa02ea06c9815" class="i property">Prefix</a>; }
 
            <b>set</b> { <a href="#416ee3a25470f4b8" class="k">base</a>.<a href="#462fa02ea06c9815" class="i property">Prefix</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Disable warnings on cmdlet and function names that have non-standard verbs</span>
        <span class="c">///</span><span class="c"> or non-standard characters in the noun.</span>
        <span class="c">///</span><span class="c"> Also disable security related checks against command and parameter names.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="60c281f97aeb5adc" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">DisableNameChecking</a>
        {
            <b>get</b> { <b>return</b> <a href="#eb31297066757ff0" class="i field">_disableNameChecking</a>; }
 
            <b>set</b> { <a href="#eb31297066757ff0" class="i field">_disableNameChecking</a> = <b>value</b>; }
        }
 
        <b>private bool</b> <a id="eb31297066757ff0" href="../../R/eb31297066757ff0.html" target="n" data-glyph="46,1" class="i field">_disableNameChecking</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs initialization of cmdlet execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="b3f2f08cd4ab93ed" href="../../R/b3f2f08cd4ab93ed.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <span class="c">// Module and FullyQualifiedModule should not be specified at the same time.</span>
            <span class="c">// Throw out terminating error if this is the case.</span>
            <b>if</b> (<a href="#3f9c47f7d5c8deb1" class="i field">IsModuleSpecified</a> &amp;&amp; <a href="#0ae38c7b738bd78d" class="i field">IsFullyQualifiedModuleSpecified</a>)
            {
                <b>string</b> <span id="r20 rd" class="r20 r">errMsg</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">SessionStateStrings</span>.<span class="i">GetContent_TailAndHeadCannotCoexist</span>, <b>nameof</b>(<a href="#f7751d4990752d74" class="i property">Module</a>), <b>nameof</b>(<a href="#00d1812e0cc1a13e" class="i property">FullyQualifiedModule</a>));
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r21 rd" class="r21 r">error</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r20 r">errMsg</span>), <span class="s">&quot;ModuleAndFullyQualifiedModuleCannotBeSpecifiedTogether&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r21 r">error</span>);
            }
 
            <span class="i">DirectoryInfo</span> <span id="r22 rd" class="r22 r">moduleDirectory</span> = <span class="i">PathUtils</span>.<span class="i">CreateTemporaryDirectory</span>();
 
            <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r23 rd" class="r23 r">alias2resolvedCommandName</span>;
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r24 rd" class="r24 r">listOfCommandMetadata</span> = <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#bb4406572a38338d" class="i method">GetRemoteCommandMetadata</a>(<b>out</b> <span class="r23 r">alias2resolvedCommandName</span>);
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <span id="r25 rd" class="r25 r">listOfFormatData</span> = <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#97ccd0535f2260b9" class="i method">GetRemoteFormatData</a>();
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r26 rd" class="r26 r">generatedFiles</span> = <a href="#7f4a5af07b17c790" class="k">this</a>.<span class="i">GenerateProxyModule</span>(
                <span class="r22 r">moduleDirectory</span>,
                <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r22 r">moduleDirectory</span>.<span class="i">FullName</span>),
                <span class="i">Encoding</span>.<span class="i">Unicode</span>,
                <b>false</b>,
                <span class="r24 r">listOfCommandMetadata</span>,
                <span class="r23 r">alias2resolvedCommandName</span>,
                <span class="r25 r">listOfFormatData</span>);
 
            <b>string</b> <span id="r27 rd" class="r27 r">manifestFile</span> = <b>null</b>;
            <b>foreach</b> (<b>string</b> <span id="r28 rd" class="r28 r">file</span> <b>in</b> <span class="r26 r">generatedFiles</span>)
            {
                <b>if</b> (<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r28 r">file</span>).<span class="i">Equals</span>(<span class="s">&quot;.psd1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r27 r">manifestFile</span> = <span class="r28 r">file</span>;
                }
            }
 
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r27 r">manifestFile</span> != <b>null</b>, <span class="s">&quot;A psd1 file should always be generated&quot;</span>);
 
            <a href="/System.Management.Automation/A.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r29 rd" class="r29 r">moduleInfo</span> = <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#9c426c4ec917d44b" class="i method">CreateModule</a>(<span class="r27 r">manifestFile</span>);
            <a href="#7f4a5af07b17c790" class="k">this</a>.<a href="#77598c8b2e97a475" class="i method">RegisterModuleCleanUp</a>(<span class="r29 r">moduleInfo</span>);
 
            <a href="#7f4a5af07b17c790" class="k">this</a>.<span class="i">WriteObject</span>(<span class="r29 r">moduleInfo</span>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Base class for implicit remoting cmdlets.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="416ee3a25470f4b8" href="../../R/416ee3a25470f4b8.html" target="n" data-glyph="0,0" class="t t">ImplicitRemotingCommandBase</a> : <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <b>internal const string</b> <a id="b5c73badf9af43ef" href="../../R/b5c73badf9af43ef.html" target="n" data-glyph="8,1" class="i field">ImplicitRemotingKey</a> = <span class="s">&quot;ImplicitRemoting&quot;</span>;
        <b>internal const string</b> <a id="7ff047c0491b6198" href="../../R/7ff047c0491b6198.html" target="n" data-glyph="8,1" class="i field">ImplicitRemotingHashKey</a> = <span class="s">&quot;Hash&quot;</span>;
        <b>internal const string</b> <a id="2a9d78f2a46bcda3" href="../../R/2a9d78f2a46bcda3.html" target="n" data-glyph="8,1" class="i field">ImplicitRemotingCommandsToSkipKey</a> = <span class="s">&quot;CommandsToSkip&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor
 
        <b>internal</b> <a id="ffd45a227bbe9b02" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">ImplicitRemotingCommandBase</a>()
        {
            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#2ec56ff8dcd84705" class="i property">CommandName</a> = <b>new</b> <b>string</b>[] { <span class="s">&quot;*&quot;</span> };
            <a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> = <b>false</b>;
 
            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#83643e9fc15c5b13" class="i property">FormatTypeName</a> = <b>new</b> <b>string</b>[] { <span class="s">&quot;*&quot;</span> };
            <a href="#890efb0ea2650cf4" class="i field">_formatTypeNamesSpecified</a> = <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Common cmdlet parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> related to Get-Command
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the path(s) or name(s) of the commands to retrieve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 2)]
        [<span class="i">Alias</span>(<span class="s">&quot;Name&quot;</span>)]
        <b>public string</b>[] <a id="2ec56ff8dcd84705" href="../../R/2ec56ff8dcd84705.html" target="n" data-glyph="102,1" class="i property">CommandName</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ac0c01708dbf46bb" class="i field">_commandNameParameter</a>;
            }
 
            <b>set</b>
            {
                <a href="#ac0c01708dbf46bb" class="i field">_commandNameParameter</a> = <b>value</b>;
                <a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> = <b>true</b>;
                <a href="#c4fd3502fcb60902" class="i field">_commandNamePatterns</a> = <span class="i">SessionStateUtilities</span>.<span class="i">CreateWildcardsFromStrings</span>(
                    <a href="#ac0c01708dbf46bb" class="i field">_commandNameParameter</a>,
                    <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a> | <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
            }
        }
 
        <b>private string</b>[] <a id="ac0c01708dbf46bb" href="../../R/ac0c01708dbf46bb.html" target="n" data-glyph="46,1" class="i field">_commandNameParameter</a>;
        <b>private</b> <span class="i">Collection</span>&lt;<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="c4fd3502fcb60902" href="../../R/c4fd3502fcb60902.html" target="n" data-glyph="46,1" class="i field">_commandNamePatterns</a>; <span class="c">// initialized to default value in the constructor</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Allows shadowing and/or overwriting of existing local/client commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="568e8e3cfbfa5c1e" href="../../R/568e8e3cfbfa5c1e.html" target="n" data-glyph="102,1" class="i property">AllowClobber</a> { <b>get</b>; <b>set</b>; } = <b>new</b> <span class="t">SwitchParameter</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parameter that all additional arguments get bound to. These arguments are used</span>
        <span class="c">///</span><span class="c"> when retrieving dynamic parameters from cmdlets that support them.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">AllowNull</span>]
        [<span class="i">AllowEmptyCollection</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;Args&quot;</span>)]
        <b>public object</b>[] <a id="745f25d912daca68" href="../../R/745f25d912daca68.html" target="n" data-glyph="102,1" class="i property">ArgumentList</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#982740c9b56e5169" class="i field">_commandArgs</a>;
            }
 
            <b>set</b>
            {
                <a href="#982740c9b56e5169" class="i field">_commandArgs</a> = <b>value</b>;
                <a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private object</b>[] <a id="982740c9b56e5169" href="../../R/982740c9b56e5169.html" target="n" data-glyph="46,1" class="i field">_commandArgs</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the type of the command to get.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;Type&quot;</span>)]
        <b>public</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <a id="dc75288bd287a6f0" href="../../R/dc75288bd287a6f0.html" target="n" data-glyph="102,1" class="i property">CommandType</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#7802606de0ece7da" class="i field">_commandType</a>;
            }
 
            <b>set</b>
            {
                <a href="#7802606de0ece7da" class="i field">_commandType</a> = <b>value</b>;
                <a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <a id="7802606de0ece7da" href="../../R/7802606de0ece7da.html" target="n" data-glyph="46,1" class="i field">_commandType</a> = <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#d7f466cfbbd45cdb" class="i field">All</a> &amp; (~(<a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#f4fc4c6de9082bc5" class="i field">Application</a> | <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#8324208f5ee6d431" class="i field">Script</a> | <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#5baa5da2219b134a" class="i field">ExternalScript</a>));
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the PSSnapin parameter to the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;PSSnapin&quot;</span>)]
        [<span class="i">ValidateNotNull</span>]
        <b>public string</b>[] <a id="f7751d4990752d74" href="../../R/f7751d4990752d74.html" target="n" data-glyph="102,1" class="i property">Module</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a3dfb75145a1e101" class="i field">_PSSnapins</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                {
                    <b>value</b> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
                }
 
                <a href="#a3dfb75145a1e101" class="i field">_PSSnapins</a> = <b>value</b>;
                <a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> = <b>true</b>;
                <a href="#3f9c47f7d5c8deb1" class="i field">IsModuleSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private string</b>[] <a id="a3dfb75145a1e101" href="../../R/a3dfb75145a1e101.html" target="n" data-glyph="46,1" class="i field">_PSSnapins</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
        <b>internal bool</b> <a id="3f9c47f7d5c8deb1" href="../../R/3f9c47f7d5c8deb1.html" target="n" data-glyph="44,1" class="i field">IsModuleSpecified</a> = <b>false</b>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the FullyQualifiedModule parameter to the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNull</span>]
        <b>public</b> <a href="/System.Management.Automation/A.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <a id="00d1812e0cc1a13e" href="../../R/00d1812e0cc1a13e.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedModule</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#9578c866c4ce64c6" class="i field">_moduleSpecifications</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> != <b>null</b>)
                {
                    <a href="#9578c866c4ce64c6" class="i field">_moduleSpecifications</a> = <b>value</b>;
                }
 
                <a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> = <b>true</b>;
                <a href="#0ae38c7b738bd78d" class="i field">IsFullyQualifiedModuleSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <a id="9578c866c4ce64c6" href="../../R/9578c866c4ce64c6.html" target="n" data-glyph="46,1" class="i field">_moduleSpecifications</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<a href="/System.Management.Automation/A.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;();
        <b>internal bool</b> <a id="0ae38c7b738bd78d" href="../../R/0ae38c7b738bd78d.html" target="n" data-glyph="44,1" class="i field">IsFullyQualifiedModuleSpecified</a> = <b>false</b>;
 
        <b>private bool</b> <a id="a60602403415eace" href="../../R/a60602403415eace.html" target="n" data-glyph="46,1" class="i field">_commandParameterSpecified</a>; <span class="c">// initialized to default value in the constructor</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> related to Get-Command
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> related to F&amp;O
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the types for which we should get formatting and output data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 3)]
        <b>public string</b>[] <a id="83643e9fc15c5b13" href="../../R/83643e9fc15c5b13.html" target="n" data-glyph="102,1" class="i property">FormatTypeName</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ddc02b578be66919" class="i field">_formatTypeNameParameter</a>;
            }
 
            <b>set</b>
            {
                <a href="#ddc02b578be66919" class="i field">_formatTypeNameParameter</a> = <b>value</b>;
                <a href="#890efb0ea2650cf4" class="i field">_formatTypeNamesSpecified</a> = <b>true</b>;
                <a href="#1d3f89f10905f48a" class="i field">_formatTypeNamePatterns</a> = <span class="i">SessionStateUtilities</span>.<span class="i">CreateWildcardsFromStrings</span>(
                    <a href="#ddc02b578be66919" class="i field">_formatTypeNameParameter</a>,
                    <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a> | <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
            }
        }
 
        <b>private string</b>[] <a id="ddc02b578be66919" href="../../R/ddc02b578be66919.html" target="n" data-glyph="46,1" class="i field">_formatTypeNameParameter</a>; <span class="c">// initialized to default value in the constructor</span>
        <b>private</b> <span class="i">Collection</span>&lt;<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="1d3f89f10905f48a" href="../../R/1d3f89f10905f48a.html" target="n" data-glyph="46,1" class="i field">_formatTypeNamePatterns</a>;
        <b>private bool</b> <a id="890efb0ea2650cf4" href="../../R/890efb0ea2650cf4.html" target="n" data-glyph="46,1" class="i field">_formatTypeNamesSpecified</a>; <span class="c">// initialized to default value in the constructor</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Related to modules
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specified a prefix used to modify names of imported commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="462fa02ea06c9815" href="../../R/462fa02ea06c9815.html" target="n" data-glyph="104,1" class="i property">Prefix</a> { <b>get</b>; <b>set</b>; } = <b>string</b>.<span class="i">Empty</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the certificate with which to sign the format file and psm1 file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">X509Certificate2</span> <a id="b3fe48098d80bbca" href="../../R/b3fe48098d80bbca.html" target="n" data-glyph="102,1" class="i property">Certificate</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PSSession object describing the remote runspace</span>
        <span class="c">///</span><span class="c"> using which the specified cmdlet operation will be performed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">ValidateNotNull</span>]
        <b>public</b> <a href="/System.Management.Automation/A.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <a id="3db47a8aa30f9ffc" href="../../R/3db47a8aa30f9ffc.html" target="n" data-glyph="102,1" class="i property">Session</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Localized errors and messages
 
        <b>internal</b> <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <a id="b6aabf7a596b996e" href="../../R/b6aabf7a596b996e.html" target="n" data-glyph="74,1" class="i method">GetErrorDetails</a>(<b>string</b> <span id="r30 rd" class="r30 r">errorId</span>, <b>params object</b>[] <span id="r31 rd" class="r31 r">args</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r30 r">errorId</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r30 r">errorId</span>));
            }
 
            <b>return</b> <b>new</b> <span class="t">ErrorDetails</span>(
                <b>typeof</b>(<a href="#416ee3a25470f4b8" class="t t">ImplicitRemotingCommandBase</a>).<span class="i">GetTypeInfo</span>().<span class="i">Assembly</span>,
                <span class="s">&quot;Microsoft.PowerShell.Commands.Utility.resources.ImplicitRemotingStrings&quot;</span>,
                <span class="r30 r">errorId</span>,
                <span class="r31 r">args</span>);
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="f4cc359695967228" href="../../R/f4cc359695967228.html" target="n" data-glyph="76,1" class="i method">GetErrorNoCommandsImportedBecauseOfSkipping</a>()
        {
            <b>const string</b> <span id="r32 rd" class="r32 r">errorId</span> = <span class="s">&quot;ErrorNoCommandsImportedBecauseOfSkipping&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r33 rd" class="r33 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r32 r">errorId</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r34 rd" class="r34 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">ArgumentException</span>(<span class="r33 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r32 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#f33f25c3453e2e98" class="i field">InvalidResult</a>,
                <b>null</b>);
            <span class="r34 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r33 r">details</span>;
 
            <b>return</b> <span class="r34 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="dd90e6bb37ffc897" href="../../R/dd90e6bb37ffc897.html" target="n" data-glyph="76,1" class="i method">GetErrorMalformedDataFromRemoteCommand</a>(<b>string</b> <span id="r35 rd" class="r35 r">commandName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r35 r">commandName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r35 r">commandName</span>));
            }
 
            <b>const string</b> <span id="r36 rd" class="r36 r">errorId</span> = <span class="s">&quot;ErrorMalformedDataFromRemoteCommand&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r37 rd" class="r37 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r36 r">errorId</span>, <span class="r35 r">commandName</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r38 rd" class="r38 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">ArgumentException</span>(<span class="r37 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r36 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#f33f25c3453e2e98" class="i field">InvalidResult</a>,
                <b>null</b>);
            <span class="r38 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r37 r">details</span>;
 
            <b>return</b> <span class="r38 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="8033be302c8bf483" href="../../R/8033be302c8bf483.html" target="n" data-glyph="76,1" class="i method">GetErrorCommandSkippedBecauseOfShadowing</a>(<b>string</b> <span id="r39 rd" class="r39 r">commandNames</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r39 r">commandNames</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r39 r">commandNames</span>));
            }
 
            <b>const string</b> <span id="r40 rd" class="r40 r">errorId</span> = <span class="s">&quot;ErrorCommandSkippedBecauseOfShadowing&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r41 rd" class="r41 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r40 r">errorId</span>, <span class="r39 r">commandNames</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r42 rd" class="r42 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r41 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r40 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                <b>null</b>);
            <span class="r42 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r41 r">details</span>;
 
            <b>return</b> <span class="r42 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="9021101fe08aa1c7" href="../../R/9021101fe08aa1c7.html" target="n" data-glyph="76,1" class="i method">GetErrorSkippedNonRequestedCommand</a>(<b>string</b> <span id="r43 rd" class="r43 r">commandName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r43 r">commandName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r43 r">commandName</span>));
            }
 
            <b>const string</b> <span id="r44 rd" class="r44 r">errorId</span> = <span class="s">&quot;ErrorSkippedNonRequestedCommand&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r45 rd" class="r45 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r44 r">errorId</span>, <span class="r43 r">commandName</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r46 rd" class="r46 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r45 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r44 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#22cb3b8b80f740be" class="i field">ResourceExists</a>,
                <b>null</b>);
            <span class="r46 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r45 r">details</span>;
 
            <b>return</b> <span class="r46 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="0bc095ab3eab97fe" href="../../R/0bc095ab3eab97fe.html" target="n" data-glyph="76,1" class="i method">GetErrorSkippedNonRequestedTypeDefinition</a>(<b>string</b> <span id="r47 rd" class="r47 r">typeName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r47 r">typeName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r47 r">typeName</span>));
            }
 
            <b>const string</b> <span id="r48 rd" class="r48 r">errorId</span> = <span class="s">&quot;ErrorSkippedNonRequestedTypeDefinition&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r49 rd" class="r49 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r48 r">errorId</span>, <span class="r47 r">typeName</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r50 rd" class="r50 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r49 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r48 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#22cb3b8b80f740be" class="i field">ResourceExists</a>,
                <b>null</b>);
            <span class="r50 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r49 r">details</span>;
 
            <b>return</b> <span class="r50 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="8c5a3cd1fdab86ab" href="../../R/8c5a3cd1fdab86ab.html" target="n" data-glyph="76,1" class="i method">GetErrorSkippedUnsafeCommandName</a>(<b>string</b> <span id="r51 rd" class="r51 r">commandName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r51 r">commandName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r51 r">commandName</span>));
            }
 
            <b>const string</b> <span id="r52 rd" class="r52 r">errorId</span> = <span class="s">&quot;ErrorSkippedUnsafeCommandName&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r53 rd" class="r53 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r52 r">errorId</span>, <span class="r51 r">commandName</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r54 rd" class="r54 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r53 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r52 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                <b>null</b>);
            <span class="r54 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r53 r">details</span>;
 
            <b>return</b> <span class="r54 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="add2d68a499afc63" href="../../R/add2d68a499afc63.html" target="n" data-glyph="76,1" class="i method">GetErrorSkippedUnsafeNameInMetadata</a>(<b>string</b> <span id="r55 rd" class="r55 r">commandName</span>, <b>string</b> <span id="r56 rd" class="r56 r">nameType</span>, <b>string</b> <span id="r57 rd" class="r57 r">name</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r55 r">commandName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r55 r">commandName</span>));
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r56 r">nameType</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r56 r">nameType</span>));
            }
 
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r56 r">nameType</span>.<span class="i">Equals</span>(<span class="s">&quot;Alias&quot;</span>) || <span class="r56 r">nameType</span>.<span class="i">Equals</span>(<span class="s">&quot;ParameterSet&quot;</span>) || <span class="r56 r">nameType</span>.<span class="i">Equals</span>(<span class="s">&quot;Parameter&quot;</span>), <span class="s">&quot;nameType matches resource names&quot;</span>);
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r57 r">name</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r57 r">name</span>));
            }
 
            <b>string</b> <span id="r58 rd" class="r58 r">errorId</span> = <span class="s">&quot;ErrorSkippedUnsafe&quot;</span> + <span class="r56 r">nameType</span> + <span class="s">&quot;Name&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r59 rd" class="r59 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r58 r">errorId</span>, <span class="r55 r">commandName</span>, <span class="r57 r">name</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r60 rd" class="r60 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r59 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r58 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                <b>null</b>);
            <span class="r60 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r59 r">details</span>;
 
            <b>return</b> <span class="r60 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="463c41df975c23d5" href="../../R/463c41df975c23d5.html" target="n" data-glyph="76,1" class="i method">GetErrorFromRemoteCommand</a>(<b>string</b> <span id="r61 rd" class="r61 r">commandName</span>, <a href="/System.Management.Automation/A.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r62 rd" class="r62 r">runtimeException</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r61 r">commandName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r61 r">commandName</span>));
            }
 
            <b>if</b> (<span class="r62 r">runtimeException</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r62 r">runtimeException</span>));
            }
 
            <b>string</b> <span id="r63 rd" class="r63 r">errorId</span>;
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r64 rd" class="r64 r">errorDetails</span>;
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r65 rd" class="r65 r">errorRecord</span>;
 
            <span class="c">//</span>
            <span class="c">// handle recognized types of exceptions first</span>
            <span class="c">//</span>
            <a href="/System.Management.Automation/A.html#d56edc1842249736" class="t t">RemoteException</a> <span id="r66 rd" class="r66 r">remoteException</span> = <span class="r62 r">runtimeException</span> <b>as</b> <a href="/System.Management.Automation/A.html#d56edc1842249736" class="t t">RemoteException</a>;
            <b>if</b> ((<span class="r66 r">remoteException</span> != <b>null</b>) &amp;&amp; (<span class="r66 r">remoteException</span>.<a href="/System.Management.Automation/A.html#68770fe9884c0f08" class="i property">SerializedRemoteException</a> != <b>null</b>))
            {
                <b>if</b> (<span class="i">Deserializer</span>.<span class="i">IsInstanceOfType</span>(<span class="r66 r">remoteException</span>.<a href="/System.Management.Automation/A.html#68770fe9884c0f08" class="i property">SerializedRemoteException</a>, <b>typeof</b>(<a href="/System.Management.Automation/A.html#d61739861b769224" class="t t">CommandNotFoundException</a>)))
                {
                    <span class="r63 r">errorId</span> = <span class="s">&quot;ErrorRequiredRemoteCommandNotFound&quot;</span>;
                    <span class="r64 r">errorDetails</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r63 r">errorId</span>, <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="/System.Management.Automation/A.html#92387ec2f33e4d8f" class="i property">MyInvocation</a>.<a href="/System.Management.Automation/A.html#8edab65bf1913897" class="i property">MyCommand</a>.<a href="/System.Management.Automation/A.html#02e11b521c500195" class="i property">Name</a>);
 
                    <span class="r65 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                        <b>new</b> <span class="t">RuntimeException</span>(<span class="r64 r">errorDetails</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>, <span class="r62 r">runtimeException</span>),
                        <span class="r63 r">errorId</span>,
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>,
                        <b>null</b>);
                    <span class="r65 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r64 r">errorDetails</span>;
 
                    <b>return</b> <span class="r65 r">errorRecord</span>;
                }
            }
 
            <span class="c">//</span>
            <span class="c">// output a generic error message if exception is not recognized</span>
            <span class="c">//</span>
            <span class="r63 r">errorId</span> = <span class="s">&quot;ErrorFromRemoteCommand&quot;</span>;
            <span class="r64 r">errorDetails</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">GetErrorDetails</span>(<span class="r63 r">errorId</span>, <span class="r61 r">commandName</span>, <span class="r62 r">runtimeException</span>.<span class="i">Message</span>);
 
            <span class="r65 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                <b>new</b> <span class="t">RuntimeException</span>(<span class="r64 r">errorDetails</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>, <span class="r62 r">runtimeException</span>),
                <span class="r63 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#f33f25c3453e2e98" class="i field">InvalidResult</a>,
                <b>null</b>);
            <span class="r65 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r64 r">errorDetails</span>;
 
            <b>return</b> <span class="r65 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="84b399698c2dd104" href="../../R/84b399698c2dd104.html" target="n" data-glyph="76,1" class="i method">GetErrorCouldntResolvedAlias</a>(<b>string</b> <span id="r67 rd" class="r67 r">aliasName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r67 r">aliasName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r67 r">aliasName</span>));
            }
 
            <b>const string</b> <span id="r68 rd" class="r68 r">errorId</span> = <span class="s">&quot;ErrorCouldntResolveAlias&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r69 rd" class="r69 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r68 r">errorId</span>, <span class="r67 r">aliasName</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r70 rd" class="r70 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">ArgumentException</span>(<span class="r69 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r68 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#214d0e72bcab7ace" class="i field">OperationTimeout</a>,
                <b>null</b>);
            <span class="r70 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r69 r">details</span>;
 
            <b>return</b> <span class="r70 r">errorRecord</span>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="b6922f7bce1d88fe" href="../../R/b6922f7bce1d88fe.html" target="n" data-glyph="76,1" class="i method">GetErrorNoResultsFromRemoteEnd</a>(<b>string</b> <span id="r71 rd" class="r71 r">commandName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r71 r">commandName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r71 r">commandName</span>));
            }
 
            <b>const string</b> <span id="r72 rd" class="r72 r">errorId</span> = <span class="s">&quot;ErrorNoResultsFromRemoteEnd&quot;</span>;
 
            <a href="/System.Management.Automation/A.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r73 rd" class="r73 r">details</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6aabf7a596b996e" class="i method">GetErrorDetails</a>(<span class="r72 r">errorId</span>, <span class="r71 r">commandName</span>);
 
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r74 rd" class="r74 r">errorRecord</span> = <b>new</b>(
                <b>new</b> <span class="i">ArgumentException</span>(<span class="r73 r">details</span>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>),
                <span class="r72 r">errorId</span>,
                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#f33f25c3453e2e98" class="i field">InvalidResult</a>,
                <b>null</b>);
            <span class="r74 r">errorRecord</span>.<span class="i">ErrorDetails</span> = <span class="r73 r">details</span>;
 
            <b>return</b> <span class="r74 r">errorRecord</span>;
        }
 
        <b>private readonly</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="84caebe129ecd558" href="../../R/84caebe129ecd558.html" target="n" data-glyph="46,1" class="i field">_commandsSkippedBecauseOfShadowing</a> = <b>new</b>();
 
        <b>private void</b> <a id="23b3acaa82693d36" href="../../R/23b3acaa82693d36.html" target="n" data-glyph="76,1" class="i method">ReportSkippedCommands</a>()
        {
            <b>if</b> (<a href="#84caebe129ecd558" class="i field">_commandsSkippedBecauseOfShadowing</a>.<span class="i">Count</span> != 0)
            {
                <b>string</b> <span id="r75 rd" class="r75 r">skippedCommands</span> = <b>string</b>.<span class="i">Join</span>(<span class="s">&quot;, &quot;</span>, <a href="#84caebe129ecd558" class="i field">_commandsSkippedBecauseOfShadowing</a>.<span class="i">ToArray</span>());
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r76 rd" class="r76 r">errorRecord</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#8033be302c8bf483" class="i method">GetErrorCommandSkippedBecauseOfShadowing</a>(<span class="r75 r">skippedCommands</span>);
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteWarning</span>(<span class="r76 r">errorRecord</span>.<a href="/System.Management.Automation/A.html#4e9df045b6372ce0" class="i property">ErrorDetails</a>.<a href="/System.Management.Automation/A.html#589bef4648ccf37a" class="i property">Message</a>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Logic to avoid commands we don&#39;t want to shadow
 
        <b>private bool</b> <a id="68de90b1861ce1d8" href="../../R/68de90b1861ce1d8.html" target="n" data-glyph="76,1" class="i method">IsCommandNameMatchingParameters</a>(<b>string</b> <span id="r77 rd" class="r77 r">commandName</span>)
        {
            <b>if</b> (<span class="i">SessionStateUtilities</span>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r77 r">commandName</span>, <a href="#c4fd3502fcb60902" class="i field">_commandNamePatterns</a>, <b>false</b>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>string</b> <span id="r78 rd" class="r78 r">nameWithoutExtension</span> = <span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r77 r">commandName</span>);
            <b>if</b> (!<span class="r78 r">nameWithoutExtension</span>.<span class="i">Equals</span>(<span class="r77 r">commandName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <span class="i">SessionStateUtilities</span>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r78 r">nameWithoutExtension</span>, <a href="#c4fd3502fcb60902" class="i field">_commandNamePatterns</a>, <b>false</b>);
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <a id="a4b3fbe340937530" href="../../R/a4b3fbe340937530.html" target="n" data-glyph="46,1" class="i field">_existingCommands</a>;
 
        <b>private</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <a id="c33f81536b2f64dd" href="../../R/c33f81536b2f64dd.html" target="n" data-glyph="106,1" class="i property">ExistingCommands</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#a4b3fbe340937530" class="i field">_existingCommands</a> == <b>null</b>)
                {
                    <a href="#a4b3fbe340937530" class="i field">_existingCommands</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                    <span class="i">CommandSearcher</span> <span id="r79 rd" class="r79 r">searcher</span> = <b>new</b>(
                        <span class="s">&quot;*&quot;</span>,
                        <span class="i">SearchResolutionOptions</span>.<span class="i">CommandNameIsPattern</span> | <span class="i">SearchResolutionOptions</span>.<span class="i">ResolveAliasPatterns</span> | <span class="i">SearchResolutionOptions</span>.<span class="i">ResolveFunctionPatterns</span>,
                        <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#d7f466cfbbd45cdb" class="i field">All</a>,
                        <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">Context</span>);
                    <b>foreach</b> (<a href="/System.Management.Automation/A.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r80 rd" class="r80 r">commandInfo</span> <b>in</b> <span class="r79 r">searcher</span>)
                    {
                        <a href="#a4b3fbe340937530" class="i field">_existingCommands</a>[<span class="r80 r">commandInfo</span>.<a href="/System.Management.Automation/A.html#02e11b521c500195" class="i property">Name</a>] = <b>null</b>;
                    }
                }
 
                <b>return</b> <a href="#a4b3fbe340937530" class="i field">_existingCommands</a>;
            }
        }
 
        <b>private bool</b> <a id="58224354215414ac" href="../../R/58224354215414ac.html" target="n" data-glyph="76,1" class="i method">IsShadowingExistingCommands</a>(<b>string</b> <span id="r81 rd" class="r81 r">commandName</span>)
        {
            <span class="r81 r">commandName</span> = <a href="/System.Management.Automation/A.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<span class="i">AddPrefixToCommandName</span>(<span class="r81 r">commandName</span>, <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#462fa02ea06c9815" class="i property">Prefix</a>);
 
            <span class="i">CommandSearcher</span> <span id="r82 rd" class="r82 r">searcher</span> = <b>new</b>(<span class="r81 r">commandName</span>, <span class="i">SearchResolutionOptions</span>.<span class="i">None</span>, <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#d7f466cfbbd45cdb" class="i field">All</a>, <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">Context</span>);
            <b>foreach</b> (<b>string</b> <span id="r83 rd" class="r83 r">expandedCommandName</span> <b>in</b> <span class="r82 r">searcher</span>.<span class="i">ConstructSearchPatternsFromName</span>(<span class="r81 r">commandName</span>))
            {
                <b>if</b> (<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#c33f81536b2f64dd" class="i property">ExistingCommands</a>.<span class="i">ContainsKey</span>(<span class="r83 r">expandedCommandName</span>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns true if command doesn&#39;t shadow OR is in the -AllowShadowing parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">commandName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="1d23f2ecf88448cb" href="../../R/1d23f2ecf88448cb.html" target="n" data-glyph="76,1" class="i method">IsCommandNameAllowedForImport</a>(<b>string</b> <span id="r84 rd" class="r84 r">commandName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r84 r">commandName</span>))
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r84 r">commandName</span>));
            }
 
            <b>if</b> (<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#568e8e3cfbfa5c1e" class="i property">AllowClobber</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<a href="#58224354215414ac" class="i method">IsShadowingExistingCommands</a>(<span class="r84 r">commandName</span>))
            {
                <a href="#84caebe129ecd558" class="i field">_commandsSkippedBecauseOfShadowing</a>.<span class="i">Add</span>(<span class="r84 r">commandName</span>);
                <b>return</b> <b>false</b>;
            }
            <b>else</b>
            {
                <b>return</b> <b>true</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Logic to skip commands the server doesn&#39;t want to import
 
        <b>private</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="0b617c838bb78f7e" href="../../R/0b617c838bb78f7e.html" target="n" data-glyph="106,1" class="i property">CommandSkipListFromServer</a>
        {
            <b>get</b>
            {
                <span class="c">// try to get the list from server&#39;s application private data</span>
                <b>if</b> (<a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a> == <b>null</b>)
                {
                    <b>string</b>[] <span id="r85 rd" class="r85 r">serverDeclaredListOfCommandsToSkip</span>;
                    <b>if</b> (<a href="/System.Management.Automation/A.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a>.<span class="i">TryPathGet</span>(
                            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#3db47a8aa30f9ffc" class="i property">Session</a>.<a href="/System.Management.Automation/A.html#fafd1c05537097a7" class="i property">ApplicationPrivateData</a>,
                            <b>out</b> <span class="r85 r">serverDeclaredListOfCommandsToSkip</span>,
                            <a href="#b5c73badf9af43ef" class="i field">ImplicitRemotingKey</a>,
                            <a href="#2a9d78f2a46bcda3" class="i field">ImplicitRemotingCommandsToSkipKey</a>))
                    {
                        <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                        <b>if</b> (<span class="r85 r">serverDeclaredListOfCommandsToSkip</span> != <b>null</b>)
                        {
                            <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">AddRange</span>(<span class="r85 r">serverDeclaredListOfCommandsToSkip</span>);
                        }
                    }
                }
 
                <span class="c">// fallback to the default list that hardcodes ...</span>
                <b>if</b> (<a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a> == <b>null</b>)
                {
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
                    <span class="c">// ... A) 5 commands used (some required some not) by implicit remoting</span>
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">Add</span>(<span class="s">&quot;Get-Command&quot;</span>);
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">Add</span>(<span class="s">&quot;Get-FormatData&quot;</span>);
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">Add</span>(<span class="s">&quot;Get-Help&quot;</span>);
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">Add</span>(<span class="s">&quot;Select-Object&quot;</span>);
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">Add</span>(<span class="s">&quot;Measure-Object&quot;</span>);
 
                    <span class="c">// ... B) 2 commands required for 1:1 remoting</span>
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">Add</span>(<span class="s">&quot;Exit-PSSession&quot;</span>);
                    <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>.<span class="i">Add</span>(<span class="s">&quot;Out-Default&quot;</span>);
                }
 
                <b>return</b> <a href="#c90df82c90235b7b" class="i field">_commandSkipListFromServer</a>;
            }
        }
 
        <b>private</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="c90df82c90235b7b" href="../../R/c90df82c90235b7b.html" target="n" data-glyph="46,1" class="i field">_commandSkipListFromServer</a>;
 
        <b>private bool</b> <a id="af1296a2c9ddc097" href="../../R/af1296a2c9ddc097.html" target="n" data-glyph="76,1" class="i method">IsCommandSkippedByServerDeclaration</a>(<b>string</b> <span id="r86 rd" class="r86 r">commandName</span>)
        {
            <span class="c">// skipped = commandName is on the CommandSkipListFromServer and is not on the this.CommandName list</span>
            <b>foreach</b> (<b>string</b> <span id="r87 rd" class="r87 r">commandToSkip</span> <b>in</b> <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#0b617c838bb78f7e" class="i property">CommandSkipListFromServer</a>)
            {
                <b>if</b> (<span class="r87 r">commandToSkip</span>.<span class="i">Equals</span>(<span class="r86 r">commandName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>if</b> (<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#2ec56ff8dcd84705" class="i property">CommandName</a> != <b>null</b>)
                    {
                        <b>foreach</b> (<b>string</b> <span id="r88 rd" class="r88 r">commandNameParameter</span> <b>in</b> <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#2ec56ff8dcd84705" class="i property">CommandName</a>)
                        {
                            <b>if</b> (<span class="r86 r">commandName</span>.<span class="i">Equals</span>(<span class="r88 r">commandNameParameter</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <b>return</b> <b>false</b>;
                            }
                        }
                    }
 
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generic rehydration helpers
 
        <b>private</b> <span class="r89 r t">T</span> <a id="63a16d1e367cb11f" href="../../R/63a16d1e367cb11f.html" target="n" data-glyph="76,1" class="i method">ConvertTo</a>&lt;<span id="r89 rd t" class="r89 r t">T</span>&gt;(<b>string</b> <span id="r90 rd" class="r90 r">commandName</span>, <b>object</b> <span id="r91 rd" class="r91 r">value</span>)
        {
            <b>return</b> <a href="#5b381973f02c609c" class="i method">ConvertTo</a>&lt;<span class="r89 r t">T</span>&gt;(<span class="r90 r">commandName</span>, <span class="r91 r">value</span>, <b>false</b>);
        }
 
        <b>private</b> <span class="r92 r t">T</span> <a id="5b381973f02c609c" href="../../R/5b381973f02c609c.html" target="n" data-glyph="76,1" class="i method">ConvertTo</a>&lt;<span id="r92 rd t" class="r92 r t">T</span>&gt;(<b>string</b> <span id="r93 rd" class="r93 r">commandName</span>, <b>object</b> <span id="r94 rd" class="r94 r">value</span>, <b>bool</b> <span id="r95 rd" class="r95 r">nullOk</span>)
        {
            <b>if</b> (<span class="r94 r">value</span> == <b>null</b>)
            {
                <b>if</b> (<span class="r95 r">nullOk</span>)
                {
                    <b>return</b> <b>default</b>(<span class="r92 r t">T</span>);
                }
                <b>else</b>
                {
                    <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#dd90e6bb37ffc897" class="i method">GetErrorMalformedDataFromRemoteCommand</a>(<span class="r93 r">commandName</span>));
                }
            }
 
            <span class="r92 r t">T</span> <span id="r96 rd" class="r96 r">t</span>;
            <b>if</b> (!<a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>&lt;<span class="r92 r t">T</span>&gt;(<span class="r94 r">value</span>, <b>out</b> <span class="r96 r">t</span>))
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#dd90e6bb37ffc897" class="i method">GetErrorMalformedDataFromRemoteCommand</a>(<span class="r93 r">commandName</span>));
            }
 
            <b>return</b> <span class="r96 r">t</span>;
        }
 
        <b>private</b> <span class="r97 r t">T</span> <a id="2750c847a2bff5da" href="../../R/2750c847a2bff5da.html" target="n" data-glyph="76,1" class="i method">GetPropertyValue</a>&lt;<span id="r97 rd t" class="r97 r t">T</span>&gt;(<b>string</b> <span id="r98 rd" class="r98 r">commandName</span>, <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r99 rd" class="r99 r">pso</span>, <b>string</b> <span id="r100 rd" class="r100 r">propertyName</span>)
        {
            <b>return</b> <a href="#51bfbe509976eae0" class="i method">GetPropertyValue</a>&lt;<span class="r97 r t">T</span>&gt;(<span class="r98 r">commandName</span>, <span class="r99 r">pso</span>, <span class="r100 r">propertyName</span>, <b>false</b>);
        }
 
        <b>private</b> <span class="r101 r t">T</span> <a id="51bfbe509976eae0" href="../../R/51bfbe509976eae0.html" target="n" data-glyph="76,1" class="i method">GetPropertyValue</a>&lt;<span id="r101 rd t" class="r101 r t">T</span>&gt;(<b>string</b> <span id="r102 rd" class="r102 r">commandName</span>, <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r103 rd" class="r103 r">pso</span>, <b>string</b> <span id="r104 rd" class="r104 r">propertyName</span>, <b>bool</b> <span id="r105 rd" class="r105 r">nullOk</span>)
        {
            <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r106 rd" class="r106 r">property</span> = <span class="r103 r">pso</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>[<span class="r104 r">propertyName</span>];
            <b>if</b> (<span class="r106 r">property</span> == <b>null</b>)
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#dd90e6bb37ffc897" class="i method">GetErrorMalformedDataFromRemoteCommand</a>(<span class="r102 r">commandName</span>));
            }
 
            <b>return</b> <a href="#5b381973f02c609c" class="i method">ConvertTo</a>&lt;<span class="r101 r t">T</span>&gt;(<span class="r102 r">commandName</span>, <span class="r106 r">property</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>, <span class="r105 r">nullOk</span>);
        }
 
        <b>private</b> <span class="i">List</span>&lt;<span class="r107 r t">T</span>&gt; <a id="8cbe128c556075d9" href="../../R/8cbe128c556075d9.html" target="n" data-glyph="76,1" class="i method">RehydrateList</a>&lt;<span id="r107 rd t" class="r107 r t">T</span>&gt;(<b>string</b> <span id="r108 rd" class="r108 r">commandName</span>, <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r109 rd" class="r109 r">deserializedObject</span>, <b>string</b> <span id="r110 rd" class="r110 r">propertyName</span>, <span class="i">Func</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <span class="r107 r t">T</span>&gt; <span id="r111 rd" class="r111 r">itemRehydrator</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r109 r">deserializedObject</span> != <b>null</b>, <span class="s">&quot;deserializedObject parameter != null&quot;</span>);
 
            <span class="i">List</span>&lt;<span class="r107 r t">T</span>&gt; <span id="r112 rd" class="r112 r">result</span> = <b>null</b>;
            <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r113 rd" class="r113 r">deserializedListProperty</span> = <span class="r109 r">deserializedObject</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>[<span class="r110 r">propertyName</span>];
            <b>if</b> (<span class="r113 r">deserializedListProperty</span> != <b>null</b>)
            {
                <span class="r112 r">result</span> = <a href="#60f748b9a1d3d992" class="i method">RehydrateList</a>&lt;<span class="r107 r t">T</span>&gt;(<span class="r108 r">commandName</span>, <span class="r113 r">deserializedListProperty</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>, <span class="r111 r">itemRehydrator</span>);
            }
 
            <b>return</b> <span class="r112 r">result</span>;
        }
 
        <b>private</b> <span class="i">List</span>&lt;<span class="r114 r t">T</span>&gt; <a id="60f748b9a1d3d992" href="../../R/60f748b9a1d3d992.html" target="n" data-glyph="76,1" class="i method">RehydrateList</a>&lt;<span id="r114 rd t" class="r114 r t">T</span>&gt;(<b>string</b> <span id="r115 rd" class="r115 r">commandName</span>, <b>object</b> <span id="r116 rd" class="r116 r">deserializedList</span>, <span class="i">Func</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <span class="r114 r t">T</span>&gt; <span id="r117 rd" class="r117 r">itemRehydrator</span>)
        {
            <b>if</b> (<span class="r117 r">itemRehydrator</span> == <b>null</b>)
            {
                <span class="r117 r">itemRehydrator</span> = (<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r118 rd" class="r118 r">pso</span>) =&gt; <a href="#63a16d1e367cb11f" class="i method">ConvertTo</a>&lt;<span class="r114 r t">T</span>&gt;(<span class="r115 r">commandName</span>, <span class="r118 r">pso</span>);
            }
 
            <span class="i">List</span>&lt;<span class="r114 r t">T</span>&gt; <span id="r119 rd" class="r119 r">result</span> = <b>null</b>;
 
            <span class="i">ArrayList</span> <span id="r120 rd" class="r120 r">list</span> = <a href="#5b381973f02c609c" class="i method">ConvertTo</a>&lt;<span class="i">ArrayList</span>&gt;(<span class="r115 r">commandName</span>, <span class="r116 r">deserializedList</span>, <b>true</b>);
            <b>if</b> (<span class="r120 r">list</span> != <b>null</b>)
            {
                <span class="r119 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<span class="r114 r t">T</span>&gt;();
                <b>foreach</b> (<b>object</b> <span id="r121 rd" class="r121 r">o</span> <b>in</b> <span class="r120 r">list</span>)
                {
                    <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r122 rd" class="r122 r">deserializedItem</span> = <a href="#63a16d1e367cb11f" class="i method">ConvertTo</a>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r115 r">commandName</span>, <span class="r121 r">o</span>);
                    <span class="r114 r t">T</span> <span id="r123 rd" class="r123 r">item</span> = <span class="r117 r">itemRehydrator</span>(<span class="r122 r">deserializedItem</span>);
                    <span class="r119 r">result</span>.<span class="i">Add</span>(<span class="r123 r">item</span>);
                }
            }
 
            <b>return</b> <span class="r119 r">result</span>;
        }
 
        <b>private</b> <span class="i">Dictionary</span>&lt;<span class="r124 r t">TKey</span>, <span class="r125 r t">TValue</span>&gt; <a id="760d3d40b4a8fbd8" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">RehydrateDictionary</a>&lt;<span id="r124 rd t" class="r124 r t">TKey</span>, <span id="r125 rd t" class="r125 r t">TValue</span>&gt;(
            <b>string</b> <span id="r126 rd" class="r126 r">commandName</span>,
            <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r127 rd" class="r127 r">deserializedObject</span>, 
            <b>string</b> <span id="r128 rd" class="r128 r">propertyName</span>,
            <span class="i">Func</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <span class="r125 r t">TValue</span>&gt; <span id="r129 rd" class="r129 r">valueRehydrator</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r127 r">deserializedObject</span> != <b>null</b>, <span class="s">&quot;deserializedObject parameter != null&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r128 r">propertyName</span>), <span class="s">&quot;propertyName parameter != null&quot;</span>);
 
            <b>if</b> (<span class="r129 r">valueRehydrator</span> == <b>null</b>)
            {
                <span class="r129 r">valueRehydrator</span> = (<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r130 rd" class="r130 r">pso</span>) =&gt; <a href="#63a16d1e367cb11f" class="i method">ConvertTo</a>&lt;<span class="r125 r t">TValue</span>&gt;(<span class="r126 r">commandName</span>, <span class="r130 r">pso</span>);
            }
 
            <span class="i">Dictionary</span>&lt;<span class="r124 r t">TKey</span>, <span class="r125 r t">TValue</span>&gt; <span id="r131 rd" class="r131 r">result</span> = <b>new</b>();
            <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r132 rd" class="r132 r">deserializedDictionaryProperty</span> = <span class="r127 r">deserializedObject</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>[<span class="r128 r">propertyName</span>];
            <b>if</b> (<span class="r132 r">deserializedDictionaryProperty</span> != <b>null</b>)
            {
                <span class="i">Hashtable</span> <span id="r133 rd" class="r133 r">deserializedDictionary</span> = <a href="#5b381973f02c609c" class="i method">ConvertTo</a>&lt;<span class="i">Hashtable</span>&gt;(<span class="r126 r">commandName</span>, <span class="r132 r">deserializedDictionaryProperty</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>, <b>true</b>);
                <b>if</b> (<span class="r133 r">deserializedDictionary</span> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r134 rd" class="r134 r">deserializedItem</span> <b>in</b> <span class="r133 r">deserializedDictionary</span>)
                    {
                        <span class="r124 r t">TKey</span> <span id="r135 rd" class="r135 r">itemKey</span> = <span class="i">ConvertTo</span>&lt;<span class="r124 r t">TKey</span>&gt;(<span class="r126 r">commandName</span>, <span class="r134 r">deserializedItem</span>.<span class="i">Key</span>);
 
                        <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r136 rd" class="r136 r">deserializedItemValue</span> = <span class="i">ConvertTo</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r126 r">commandName</span>, <span class="r134 r">deserializedItem</span>.<span class="i">Value</span>);
                        <span class="r125 r t">TValue</span> <span id="r137 rd" class="r137 r">itemValue</span> = <span class="r129 r">valueRehydrator</span>(<span class="r136 r">deserializedItemValue</span>);
 
                        <span class="r131 r">result</span>.<span class="i">Add</span>(<span class="r135 r">itemKey</span>, <span class="r137 r">itemValue</span>);
                    }
                }
            }
 
            <b>return</b> <span class="r131 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> CommandInfo-specific rehydration helpers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Validates that a name or identifier is safe to use in generated code</span>
        <span class="c">///</span><span class="c"> (i.e. it can&#39;t be used for code injection attacks).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r138 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name to validate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if the name is safe; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="6117da7eb190025c" href="../../R/6117da7eb190025c.html" target="n" data-glyph="76,1" class="i method">IsSafeNameOrIdentifier</a>(<b>string</b> <span id="r138 rd" class="r138 r">name</span>)
        {
            <span class="c">// &#39;.&#39; is needed for stuff like net.exe</span>
            <span class="c">// &#39;:&#39; and &#39;\&#39; are included because they are present in default functions (cd\, C:)</span>
            <span class="c">// \p{Ll}\p{Lu}\p{Lt} =&gt; letter lower/upper/title-case</span>
            <span class="c">// \p{Lo}\p{Nd}\p{Lm} =&gt; letter other, digit, letter modifier</span>
            <span class="c">// we reject names longer than 100 characters</span>
            <b>return</b> !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r138 r">name</span>) &amp;&amp;
                <span class="i">Regex</span>.<span class="i">IsMatch</span>(<span class="r138 r">name</span>, <a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>.<span class="i">isSafeNameOrIdentifierRegex</span>,
                <span class="i">RegexOptions</span>.<span class="i">CultureInvariant</span> | <span class="i">RegexOptions</span>.<span class="i">Singleline</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Validates that a parameter name is safe to use in generated code</span>
        <span class="c">///</span><span class="c"> (i.e. it can&#39;t be used for code injection attacks).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r139 r">parameterName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Parameter name to validate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if the name is safe; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="9531ab5e3f3cce2e" href="../../R/9531ab5e3f3cce2e.html" target="n" data-glyph="76,1" class="i method">IsSafeParameterName</a>(<b>string</b> <span id="r139 rd" class="r139 r">parameterName</span>)
        {
            <b>return</b> <a href="#6117da7eb190025c" class="i method">IsSafeNameOrIdentifier</a>(<span class="r139 r">parameterName</span>) &amp;&amp; !<span class="r139 r">parameterName</span>.<span class="i">Contains</span>(<span class="s">&#39;:&#39;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Validates that a type can be safely used as a type constraint</span>
        <span class="c">///</span><span class="c"> (i.e. it doesn&#39;t introduce any side effects on the client).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r140 r">type</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type to validate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if the type is safe; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="abe0e2907b49db66" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsSafeTypeConstraint</a>(<span class="i">Type</span> <span id="r140 rd" class="r140 r">type</span>)
        {
            <b>if</b> (<span class="r140 r">type</span> == <b>null</b>)
            {
                <b>return</b> <b>true</b>; <span class="c">// no type constraint =&gt; safe</span>
            }
 
            <b>if</b> (<span class="r140 r">type</span>.<span class="i">IsArray</span>)
            {
                <b>return</b> <span class="i">IsSafeTypeConstraint</span>(<span class="r140 r">type</span>.<span class="i">GetElementType</span>());
            }
            <b>else</b> <b>if</b> (<span class="r140 r">type</span>.<span class="i">Equals</span>(<b>typeof</b>(<span class="i">Hashtable</span>)))
            {
                <b>return</b> <b>true</b>;
            }
            <b>else</b> <b>if</b> (<span class="r140 r">type</span>.<span class="i">Equals</span>(<b>typeof</b>(<a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a>)))
            {
                <b>return</b> <b>true</b>;
            }
            <b>else</b> <b>if</b> (<span class="r140 r">type</span>.<span class="i">Equals</span>(<b>typeof</b>(<a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a>)))
            {
                <b>return</b> <b>true</b>;
            }
            <b>else</b> <b>if</b> (<span class="r140 r">type</span>.<span class="i">Equals</span>(<b>typeof</b>(<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecureString</span>)))
            {
                <b>return</b> <b>true</b>;
            }
            <b>else</b> <b>if</b> (<span class="i">KnownTypes</span>.<span class="i">GetTypeSerializationInfo</span>(<span class="r140 r">type</span>) != <b>null</b>)
            {
                <b>return</b> <b>true</b>;
            }
            <b>else</b>
            {
                <b>return</b> <b>false</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Validates that command metadata returned from the (potentially malicious) server is safe.</span>
        <span class="c">///</span><span class="c"> Writes error messages if necessary.  Modifies command metadata to make it safe if necessary.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r141 r">commandMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command metadata to verify.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if the command metadata is safe; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="eef7769c2be65bb8" href="../../R/eef7769c2be65bb8.html" target="n" data-glyph="76,1" class="i method">IsSafeCommandMetadata</a>(<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a> <span id="r141 rd" class="r141 r">commandMetadata</span>)
        {
            <b>if</b> (!<a href="#68de90b1861ce1d8" class="i method">IsCommandNameMatchingParameters</a>(<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>))
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#9021101fe08aa1c7" class="i method">GetErrorSkippedNonRequestedCommand</a>(<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>));
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (!<a href="#6117da7eb190025c" class="i method">IsSafeNameOrIdentifier</a>(<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>))
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#8c5a3cd1fdab86ab" class="i method">GetErrorSkippedUnsafeCommandName</a>(<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>));
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> ((<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8b69ebf363ce4bf7" class="i property">DefaultParameterSetName</a> != <b>null</b>) &amp;&amp;
                !<a href="#6117da7eb190025c" class="i method">IsSafeNameOrIdentifier</a>(<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8b69ebf363ce4bf7" class="i property">DefaultParameterSetName</a>))
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#add2d68a499afc63" class="i method">GetErrorSkippedUnsafeNameInMetadata</a>(
                    <span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>,
                    <span class="s">&quot;ParameterSet&quot;</span>,
                    <span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8b69ebf363ce4bf7" class="i property">DefaultParameterSetName</a>));
                <b>return</b> <b>false</b>;
            }
 
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#45b42f65f7c23c04" class="i property">CommandType</a> == <b>null</b>, <span class="s">&quot;CommandType shouldn&#39;t get rehydrated&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r141 r">commandMetadata</span>.<span class="i">ImplementsDynamicParameters</span>, <span class="s">&quot;Proxies shouldn&#39;t do dynamic parameters&quot;</span>);
 
            <b>if</b> (<span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#3f6c73a7b157f755" class="i property">Parameters</a> != <b>null</b>)
            {
                <b>foreach</b> (<a href="/System.Management.Automation/A.html#8202ce4164ad3758" class="t t">ParameterMetadata</a> <span id="r142 rd" class="r142 r">parameter</span> <b>in</b> <span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#3f6c73a7b157f755" class="i property">Parameters</a>.<span class="i">Values</span>)
                {
                    <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#6e5f6f9087cc2460" class="i property">Attributes</a> == <b>null</b> || <span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#6e5f6f9087cc2460" class="i property">Attributes</a>.<span class="i">Count</span> == 0,
                        <span class="s">&quot;Attributes shouldn&#39;t get rehydrated&quot;</span>);
 
                    <span class="c">// sanitize - remove type constraint that are not allowed</span>
                    <b>if</b> (!<span class="i">IsSafeTypeConstraint</span>(<span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#d2c0f0c200c53478" class="i property">ParameterType</a>))
                    {
                        <span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#d2c0f0c200c53478" class="i property">ParameterType</a> = <b>null</b>;
                    }
 
                    <b>if</b> (!<a href="#9531ab5e3f3cce2e" class="i method">IsSafeParameterName</a>(<span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#12f6ecd22fc50a11" class="i property">Name</a>))
                    {
                        <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#add2d68a499afc63" class="i method">GetErrorSkippedUnsafeNameInMetadata</a>(
                            <span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>,
                            <span class="s">&quot;Parameter&quot;</span>,
                            <span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#12f6ecd22fc50a11" class="i property">Name</a>));
                        <b>return</b> <b>false</b>;
                    }
 
                    <b>if</b> (<span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#d47a3e4024479369" class="i property">Aliases</a> != <b>null</b>)
                    {
                        <b>foreach</b> (<b>string</b> <span id="r143 rd" class="r143 r">alias</span> <b>in</b> <span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#d47a3e4024479369" class="i property">Aliases</a>)
                        {
                            <b>if</b> (!<a href="#6117da7eb190025c" class="i method">IsSafeNameOrIdentifier</a>(<span class="r143 r">alias</span>))
                            {
                                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#add2d68a499afc63" class="i method">GetErrorSkippedUnsafeNameInMetadata</a>(
                                    <span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>,
                                    <span class="s">&quot;Alias&quot;</span>,
                                    <span class="r143 r">alias</span>));
                                <b>return</b> <b>false</b>;
                            }
                        }
                    }
 
                    <b>if</b> (<span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#ddcfa30101fb45a0" class="i property">ParameterSets</a> != <b>null</b>)
                    {
                        <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="/System.Management.Automation/A.html#3ad07bd1eab767d8" class="t t">ParameterSetMetadata</a>&gt; <span id="r144 rd" class="r144 r">setPair</span> <b>in</b> <span class="r142 r">parameter</span>.<a href="/System.Management.Automation/A.html#ddcfa30101fb45a0" class="i property">ParameterSets</a>)
                        {
                            <b>if</b> (!<span class="i">IsSafeNameOrIdentifier</span>(<span class="r144 r">setPair</span>.<span class="i">Key</span>))
                            {
                                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">GetErrorSkippedUnsafeNameInMetadata</span>(
                                    <span class="r141 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>,
                                    <span class="s">&quot;ParameterSet&quot;</span>,
                                    <span class="r144 r">setPair</span>.<span class="i">Key</span>));
                                <b>return</b> <b>false</b>;
                            }
 
                            <a href="/System.Management.Automation/A.html#3ad07bd1eab767d8" class="t t">ParameterSetMetadata</a> <span id="r145 rd" class="r145 r">parameterSet</span> = <span class="r144 r">setPair</span>.<span class="i">Value</span>;
                            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r145 r">parameterSet</span>.<a href="/System.Management.Automation/A.html#b6f97301ed870640" class="i property">HelpMessageBaseName</a>), <span class="s">&quot;HelpMessageBaseName shouldn&#39;t get rehydrated&quot;</span>);
                            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r145 r">parameterSet</span>.<a href="/System.Management.Automation/A.html#d68147e47d55a741" class="i property">HelpMessageResourceId</a>), <span class="s">&quot;HelpMessageResourceId shouldn&#39;t get rehydrated&quot;</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private</b> <span class="i">Type</span> <a id="fd0396918e2325e7" href="../../R/fd0396918e2325e7.html" target="n" data-glyph="76,1" class="i method">RehydrateParameterType</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r146 rd" class="r146 r">deserializedParameterMetadata</span>)
        {
            <b>bool</b> <span id="r147 rd" class="r147 r">switchParameter</span> = <a href="#2750c847a2bff5da" class="i method">GetPropertyValue</a>&lt;<b>bool</b>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r146 r">deserializedParameterMetadata</span>, <span class="s">&quot;SwitchParameter&quot;</span>);
            <b>if</b> (<span class="r147 r">switchParameter</span>)
            {
                <b>return</b> <b>typeof</b>(<a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a>);
            }
            <b>else</b>
            {
                <b>return</b> <b>typeof</b>(<b>object</b>);
            }
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#8202ce4164ad3758" class="t t">ParameterMetadata</a> <a id="7294cc5611ff84f9" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">RehydrateParameterMetadata</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r148 rd" class="r148 r">deserializedParameterMetadata</span>)
        {
            <b>if</b> (<span class="r148 r">deserializedParameterMetadata</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r148 r">deserializedParameterMetadata</span>));
            }
 
            <b>string</b> <span id="r149 rd" class="r149 r">name</span> = <a href="#2750c847a2bff5da" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r148 r">deserializedParameterMetadata</span>, <span class="s">&quot;Name&quot;</span>);
            <b>bool</b> <span id="r150 rd" class="r150 r">isDynamic</span> = <a href="#2750c847a2bff5da" class="i method">GetPropertyValue</a>&lt;<b>bool</b>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r148 r">deserializedParameterMetadata</span>, <span class="s">&quot;IsDynamic&quot;</span>);
 
            <span class="i">Type</span> <span id="r151 rd" class="r151 r">parameterType</span> = <a href="#fd0396918e2325e7" class="i method">RehydrateParameterType</a>(<span class="r148 r">deserializedParameterMetadata</span>);
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r152 rd" class="r152 r">aliases</span> = <a href="#8cbe128c556075d9" class="i method">RehydrateList</a>&lt;<b>string</b>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r148 r">deserializedParameterMetadata</span>, <span class="s">&quot;Aliases&quot;</span>, <b>null</b>);
 
            <a href="/System.Management.Automation/A.html#3ad07bd1eab767d8" class="t t">ParameterSetMetadata</a> <span id="r153 rd" class="r153 r">parameterSetMetadata</span> = <b>new</b>(<b>int</b>.<span class="i">MinValue</span>, 0, <b>null</b>);
            <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="/System.Management.Automation/A.html#3ad07bd1eab767d8" class="t t">ParameterSetMetadata</a>&gt; <span id="r154 rd" class="r154 r">parameterSets</span> = <b>new</b>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <span class="r154 r">parameterSets</span>.<span class="i">Add</span>(<a href="/System.Management.Automation/A.html#3d5ed915c8442ad6" class="t t">ParameterAttribute</a>.<a href="/System.Management.Automation/A.html#5cb6a6d49034b66c" class="i field">AllParameterSets</a>, <span class="r153 r">parameterSetMetadata</span>);
 
            <b>return</b> <b>new</b> <span class="t">ParameterMetadata</span>(
                <span class="r152 r">aliases</span> == <b>null</b> ? <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;() : <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;(<span class="r152 r">aliases</span>),
                <span class="r150 r">isDynamic</span>,
                <span class="r149 r">name</span>,
                <span class="r154 r">parameterSets</span>,
                <span class="r151 r">parameterType</span>);
        }
 
        <b>private static bool</b> <a id="7b2f0088c76eba8f" href="../../R/7b2f0088c76eba8f.html" target="n" data-glyph="76,1" class="i method">IsProxyForCmdlet</a>(<span class="i">Dictionary</span>&lt;<b>string</b>, <a href="/System.Management.Automation/A.html#8202ce4164ad3758" class="t t">ParameterMetadata</a>&gt; <span id="r155 rd" class="r155 r">parameters</span>)
        {
            <span class="c">// we are not sending CmdletBinding/DefaultParameterSet over the wire anymore</span>
            <span class="c">// we need to infer IsProxyForCmdlet from presence of all common parameters</span>
 
            <b>foreach</b> (<b>string</b> <span id="r156 rd" class="r156 r">commonParameterName</span> <b>in</b> <a href="/System.Management.Automation/A.html#b0d421ff1d7581f9" class="t t">Cmdlet</a>.<a href="/System.Management.Automation/A.html#c2e19a049c38e66b" class="i property">CommonParameters</a>)
            {
                <b>if</b> (!<span class="r155 r">parameters</span>.<span class="i">ContainsKey</span>(<span class="r156 r">commonParameterName</span>))
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a> <a id="812a0e7193492110" href="../../R/812a0e7193492110.html" target="n" data-glyph="76,1" class="i method">RehydrateCommandMetadata</a>(<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r157 rd" class="r157 r">deserializedCommandInfo</span>, <b>out string</b> <span id="r158 rd" class="r158 r">resolvedCommandName</span>)
        {
            <b>if</b> (<span class="r157 r">deserializedCommandInfo</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r157 r">deserializedCommandInfo</span>));
            }
 
            <b>string</b> <span id="r159 rd" class="r159 r">name</span> = <a href="#2750c847a2bff5da" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r157 r">deserializedCommandInfo</span>, <span class="s">&quot;Name&quot;</span>);
 
            <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <span id="r160 rd" class="r160 r">commandType</span> = <a href="#2750c847a2bff5da" class="i method">GetPropertyValue</a>&lt;<a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r157 r">deserializedCommandInfo</span>, <span class="s">&quot;CommandType&quot;</span>);
            <b>if</b> (<span class="r160 r">commandType</span> == <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#83aa5e1f88cb9bf5" class="i field">Alias</a>)
            {
                <span class="r158 r">resolvedCommandName</span> = <a href="#51bfbe509976eae0" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r157 r">deserializedCommandInfo</span>, <span class="s">&quot;ResolvedCommandName&quot;</span>, <b>true</b>);
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r158 r">resolvedCommandName</span>))
                {
                    <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#84b399698c2dd104" class="i method">GetErrorCouldntResolvedAlias</a>(<span class="r159 r">name</span>));
                }
            }
            <b>else</b>
            {
                <span class="r158 r">resolvedCommandName</span> = <b>null</b>;
            }
 
            <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="/System.Management.Automation/A.html#8202ce4164ad3758" class="t t">ParameterMetadata</a>&gt; <span id="r161 rd" class="r161 r">parameters</span> = <span class="i">RehydrateDictionary</span>&lt;<b>string</b>, <a href="/System.Management.Automation/A.html#8202ce4164ad3758" class="t t">ParameterMetadata</a>&gt;(<span class="s">&quot;Get-Command&quot;</span>, <span class="r157 r">deserializedCommandInfo</span>, <span class="s">&quot;Parameters&quot;</span>, <span class="i">RehydrateParameterMetadata</span>);
 
            <span class="c">// add client-side AsJob parameter</span>
            <span class="r161 r">parameters</span>.<span class="i">Remove</span>(<span class="s">&quot;AsJob&quot;</span>);
            <a href="/System.Management.Automation/A.html#8202ce4164ad3758" class="t t">ParameterMetadata</a> <span id="r162 rd" class="r162 r">asJobParameter</span> = <b>new</b>(<span class="s">&quot;AsJob&quot;</span>, <b>typeof</b>(<a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a>));
            <span class="r161 r">parameters</span>.<span class="i">Add</span>(<span class="r162 r">asJobParameter</span>.<a href="/System.Management.Automation/A.html#12f6ecd22fc50a11" class="i property">Name</a>, <span class="r162 r">asJobParameter</span>);
 
            <b>return</b> <b>new</b> <span class="t">CommandMetadata</span>(
                                   <span class="i">name</span>: <span class="r159 r">name</span>,
                            <span class="i">commandType</span>: <span class="r160 r">commandType</span>,
                       <span class="i">isProxyForCmdlet</span>: <a href="#7b2f0088c76eba8f" class="i method">IsProxyForCmdlet</a>(<span class="r161 r">parameters</span>),
                <span class="i">defaultParameterSetName</span>: <a href="/System.Management.Automation/A.html#3d5ed915c8442ad6" class="t t">ParameterAttribute</a>.<a href="/System.Management.Automation/A.html#5cb6a6d49034b66c" class="i field">AllParameterSets</a>,
                  <span class="i">supportsShouldProcess</span>: <b>false</b>,
                          <span class="i">confirmImpact</span>: <a href="/System.Management.Automation/A.html#ba94675b57c6d6e9" class="t t">ConfirmImpact</a>.<a href="/System.Management.Automation/A.html#5b2b0bf78675f285" class="i field">None</a>,
                         <span class="i">supportsPaging</span>: <b>false</b>,
                   <span class="i">supportsTransactions</span>: <b>false</b>,
                      <span class="i">positionalBinding</span>: <b>true</b>,
                             <span class="i">parameters</span>: <span class="r161 r">parameters</span>);
        }
 
        <b>private static int</b> <a id="9864e2104c929ca0" href="../../R/9864e2104c929ca0.html" target="n" data-glyph="76,1" class="i method">GetCommandTypePriority</a>(<a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a> <span id="r163 rd" class="r163 r">commandType</span>)
        {
            <b>switch</b> (<span class="r163 r">commandType</span>)
            {
                <b>case</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#83aa5e1f88cb9bf5" class="i field">Alias</a>:
                    <b>return</b> 10;
 
                <span class="c">// there is only one function table</span>
                <b>case</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#7837d2f5f0343c5e" class="i field">Filter</a>:
                <b>case</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#8a4bdbbd93f182bf" class="i field">Function</a>:
                <b>case</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#8324208f5ee6d431" class="i field">Script</a>:
                    <b>return</b> 20;
 
                <b>case</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#e95f2e5deaaf9b93" class="i field">Cmdlet</a>:
                    <b>return</b> 30;
 
                <span class="c">// application/externalScript order depends on remote $env:path variable</span>
                <b>case</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#f4fc4c6de9082bc5" class="i field">Application</a>:
                <b>case</b> <a href="/System.Management.Automation/A.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="/System.Management.Automation/A.html#5baa5da2219b134a" class="i field">ExternalScript</a>:
                    <b>return</b> 40;
 
                <b>default</b>:
                    <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;Unknown value of CommandTypes enumeration&quot;</span>);
                    <b>return</b> 50;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts remote (deserialized) CommandInfo objects into CommandMetadata equivalents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r164 r">name2commandMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Dictionary where rehydrated CommandMetadata are going to be stored.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r165 r">alias2resolvedCommandName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Dictionary mapping alias names to resolved command names.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">remoteCommandInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote (deserialized) CommandInfo object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">CommandMetadata equivalents.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private void</b> <a id="fabe5d73f90d7e57" href="../../R/fabe5d73f90d7e57.html" target="n" data-glyph="76,1" class="i method">AddRemoteCommandMetadata</a>(
            <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r164 rd" class="r164 r">name2commandMetadata</span>,
            <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r165 rd" class="r165 r">alias2resolvedCommandName</span>,
            <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r166 rd" class="r166 r">remoteCommandInfo</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r164 r">name2commandMetadata</span> != <b>null</b>, <span class="s">&quot;name2commandMetadata parameter != null&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r165 r">alias2resolvedCommandName</span> != <b>null</b>, <span class="s">&quot;alias2resolvedCommandName parameter != null&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r166 r">remoteCommandInfo</span> != <b>null</b>, <span class="s">&quot;remoteCommandInfo parameter != null&quot;</span>);
 
            <b>string</b> <span id="r167 rd" class="r167 r">resolvedCommandName</span>;
            <a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a> <span id="r168 rd" class="r168 r">commandMetadata</span> = <a href="#812a0e7193492110" class="i method">RehydrateCommandMetadata</a>(<span class="r166 r">remoteCommandInfo</span>, <b>out</b> <span class="r167 r">resolvedCommandName</span>);
            <b>if</b> (!<a href="#eef7769c2be65bb8" class="i method">IsSafeCommandMetadata</a>(<span class="r168 r">commandMetadata</span>))
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r167 r">resolvedCommandName</span> != <b>null</b> &amp;&amp; !<a href="#6117da7eb190025c" class="i method">IsSafeNameOrIdentifier</a>(<span class="r168 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>))
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#8c5a3cd1fdab86ab" class="i method">GetErrorSkippedUnsafeCommandName</a>(<span class="r167 r">resolvedCommandName</span>));
                <b>return</b>;
            }
 
            <b>if</b> (<a href="#af1296a2c9ddc097" class="i method">IsCommandSkippedByServerDeclaration</a>(<span class="r168 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>))
            {
                <b>return</b>;
            }
 
            <b>if</b> (!<a href="#1d23f2ecf88448cb" class="i method">IsCommandNameAllowedForImport</a>(<span class="r168 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>))
            {
                <b>return</b>;
            }
 
            <a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a> <span id="r169 rd" class="r169 r">previousCommandWithSameName</span>;
            <b>if</b> (<span class="r164 r">name2commandMetadata</span>.<span class="i">TryGetValue</span>(<span class="r168 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>, <b>out</b> <span class="r169 r">previousCommandWithSameName</span>))
            {
                <b>int</b> <span id="r170 rd" class="r170 r">previousCommandPriority</span> = <a href="#9864e2104c929ca0" class="i method">GetCommandTypePriority</a>(<span class="r169 r">previousCommandWithSameName</span>.<span class="i">WrappedCommandType</span>);
                <b>int</b> <span id="r171 rd" class="r171 r">currentCommandPriority</span> = <a href="#9864e2104c929ca0" class="i method">GetCommandTypePriority</a>(<span class="r168 r">commandMetadata</span>.<span class="i">WrappedCommandType</span>);
                <b>if</b> (<span class="r170 r">previousCommandPriority</span> &lt; <span class="r171 r">currentCommandPriority</span>)
                {
                    <b>return</b>;
                }
            }
 
            <b>if</b> (<span class="r167 r">resolvedCommandName</span> != <b>null</b>)
            {
                <span class="r165 r">alias2resolvedCommandName</span>[<span class="r168 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>] = <span class="r167 r">resolvedCommandName</span>;
                <span class="r168 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a> = <span class="r167 r">resolvedCommandName</span>;
            }
 
            <span class="r164 r">name2commandMetadata</span>[<span class="r168 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>] = <span class="r168 r">commandMetadata</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Logic to avoid format data we don&#39;t want to shadow
 
        <b>private bool</b> <a id="85049fb6d8dcf911" href="../../R/85049fb6d8dcf911.html" target="n" data-glyph="76,1" class="i method">IsTypeNameMatchingParameters</a>(<b>string</b> <span id="r172 rd" class="r172 r">name</span>)
        {
            <b>return</b> <span class="i">SessionStateUtilities</span>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r172 r">name</span>, <a href="#1d3f89f10905f48a" class="i field">_formatTypeNamePatterns</a>, <b>false</b>);
        }
 
        <b>private bool</b> <a id="5af031ffc7f5db8c" href="../../R/5af031ffc7f5db8c.html" target="n" data-glyph="76,1" class="i method">IsSafeTypeDefinition</a>(<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a> <span id="r173 rd" class="r173 r">typeDefinition</span>)
        {
            <b>if</b> (!<a href="#85049fb6d8dcf911" class="i method">IsTypeNameMatchingParameters</a>(<span class="r173 r">typeDefinition</span>.<a href="/System.Management.Automation/A.html#b53d31d7e7755c4f" class="i property">TypeName</a>))
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#0bc095ab3eab97fe" class="i method">GetErrorSkippedNonRequestedTypeDefinition</a>(<span class="r173 r">typeDefinition</span>.<a href="/System.Management.Automation/A.html#b53d31d7e7755c4f" class="i property">TypeName</a>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private void</b> <a id="23bc3232bdb65a44" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AddRemoteTypeDefinition</a>(<span class="i">IList</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <span id="r174 rd" class="r174 r">listOfTypeDefinitions</span>, <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r175 rd" class="r175 r">remoteTypeDefinition</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r174 r">listOfTypeDefinitions</span> != <b>null</b>, <span class="s">&quot;listOfTypeDefinitions parameter != null&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r175 r">remoteTypeDefinition</span> != <b>null</b>, <span class="s">&quot;remoteTypeDefinition parameter != null&quot;</span>);
 
            <a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a> <span id="r176 rd" class="r176 r">typeDefinition</span> = <a href="#63a16d1e367cb11f" class="i method">ConvertTo</a>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt;(<span class="s">&quot;Get-FormatData&quot;</span>, <span class="r175 r">remoteTypeDefinition</span>);
            <b>if</b> (!<a href="#5af031ffc7f5db8c" class="i method">IsSafeTypeDefinition</a>(<span class="r176 r">typeDefinition</span>))
            {
                <b>return</b>;
            }
 
            <span class="r174 r">listOfTypeDefinitions</span>.<span class="i">Add</span>(<span class="r176 r">typeDefinition</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helpers for executing remote commands
 
        <b>private bool</b> <a id="4753dfba796fc234" href="../../R/4753dfba796fc234.html" target="n" data-glyph="46,1" class="i field">_assumeMeasureObjectIsAvailable</a> = <b>true</b>;
 
        <b>private int</b> <a id="7be8ff81bfdb154f" href="../../R/7be8ff81bfdb154f.html" target="n" data-glyph="76,1" class="i method">CountRemoteObjects</a>(<a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r177 rd" class="r177 r">powerShell</span>)
        {
            <b>if</b> (!<a href="#4753dfba796fc234" class="i field">_assumeMeasureObjectIsAvailable</a>)
            {
                <b>return</b> -1;
            }
 
            <b>try</b>
            {
                <span class="r177 r">powerShell</span>.<span class="i">AddCommand</span>(<span class="s">&quot;Measure-Object&quot;</span>);
 
                <span class="i">Collection</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r178 rd" class="r178 r">measurements</span>;
                <b>using</b> (<b>new</b> <span class="i">PowerShellStopper</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">Context</span>, <span class="r177 r">powerShell</span>))
                {
                    <span class="r178 r">measurements</span> = <span class="r177 r">powerShell</span>.<span class="i">Invoke</span>();
                }
 
                <b>if</b> ((<span class="r178 r">measurements</span> == <b>null</b>) || (<span class="r178 r">measurements</span>.<span class="i">Count</span> != 1))
                {
                    <a href="#4753dfba796fc234" class="i field">_assumeMeasureObjectIsAvailable</a> = <b>false</b>;
                    <b>return</b> -1;
                }
 
                <a href="/System.Management.Automation/A.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r179 rd" class="r179 r">countProperty</span> = <span class="r178 r">measurements</span>[0].<span class="i">Properties</span>[<span class="s">&quot;Count&quot;</span>];
                <b>if</b> (<span class="r179 r">countProperty</span> == <b>null</b>)
                {
                    <a href="#4753dfba796fc234" class="i field">_assumeMeasureObjectIsAvailable</a> = <b>false</b>;
                    <b>return</b> -1;
                }
 
                <b>int</b> <span id="r180 rd" class="r180 r">count</span>;
                <b>if</b> (<a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>&lt;<b>int</b>&gt;(<span class="r179 r">countProperty</span>.<a href="/System.Management.Automation/A.html#cd3a9989baedf3dd" class="i property">Value</a>, <b>out</b> <span class="r180 r">count</span>))
                {
                    <b>return</b> <span class="r180 r">count</span>;
                }
                <b>else</b>
                {
                    <a href="#4753dfba796fc234" class="i field">_assumeMeasureObjectIsAvailable</a> = <b>false</b>;
                    <b>return</b> -1;
                }
            }
            <b>catch</b> (<a href="/System.Management.Automation/A.html#bd88f263eb295545" class="t t">RuntimeException</a>)
            {
                <span class="c">// just return -1 if remote Measure-Object invocation fails for any reason</span>
                <a href="#4753dfba796fc234" class="i field">_assumeMeasureObjectIsAvailable</a> = <b>false</b>;
                <b>return</b> -1;
            }
        }
 
        <b>internal void</b> <a id="6e4e72269ee51213" href="../../R/6e4e72269ee51213.html" target="n" data-glyph="74,1" class="i method">DuplicatePowerShellStreams</a>(<a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r181 rd" class="r181 r">powerShell</span>)
        {
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r182 rd" class="r182 r">record</span> <b>in</b> <span class="r181 r">powerShell</span>.<a href="/System.Management.Automation/A.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="/System.Management.Automation/A.html#ae04a604c26c6f7d" class="i property">Error</a>.<span class="i">ReadAll</span>())
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteError</span>(<span class="r182 r">record</span>);
            }
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#59cd69dde48b9557" class="t t">WarningRecord</a> <span id="r183 rd" class="r183 r">record</span> <b>in</b> <span class="r181 r">powerShell</span>.<a href="/System.Management.Automation/A.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="/System.Management.Automation/A.html#a0a7066f9b712955" class="i property">Warning</a>.<span class="i">ReadAll</span>())
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteWarning</span>(<span class="r183 r">record</span>.<a href="/System.Management.Automation/A.html#4b46c95702707b8a" class="i property">Message</a>);
            }
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#5d56339940b0040b" class="t t">VerboseRecord</a> <span id="r184 rd" class="r184 r">record</span> <b>in</b> <span class="r181 r">powerShell</span>.<a href="/System.Management.Automation/A.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="/System.Management.Automation/A.html#8e878317a3e80c79" class="i property">Verbose</a>.<span class="i">ReadAll</span>())
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteVerbose</span>(<span class="r184 r">record</span>.<a href="/System.Management.Automation/A.html#4b46c95702707b8a" class="i property">Message</a>);
            }
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#8954d4e40287d3de" class="t t">DebugRecord</a> <span id="r185 rd" class="r185 r">record</span> <b>in</b> <span class="r181 r">powerShell</span>.<a href="/System.Management.Automation/A.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="/System.Management.Automation/A.html#96bfebc26e0f381d" class="i property">Debug</a>.<span class="i">ReadAll</span>())
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteDebug</span>(<span class="r185 r">record</span>.<a href="/System.Management.Automation/A.html#4b46c95702707b8a" class="i property">Message</a>);
            }
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#508a9dbac37ec093" class="t t">InformationRecord</a> <span id="r186 rd" class="r186 r">record</span> <b>in</b> <span class="r181 r">powerShell</span>.<a href="/System.Management.Automation/A.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="/System.Management.Automation/A.html#afec31161428f7a7" class="i property">Information</a>.<span class="i">ReadAll</span>())
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteInformation</span>(<span class="r186 r">record</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Executing remote Get-FormatData (and Get-TypeData in the future?)
 
        <b>private</b> <a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <a id="259df1f9052e42a6" href="../../R/259df1f9052e42a6.html" target="n" data-glyph="76,1" class="i method">BuildPowerShellForGetFormatData</a>()
        {
            <a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r187 rd" class="r187 r">powerShell</span> = <a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="/System.Management.Automation/A.html#40345bc4625ff918" class="i method">Create</a>();
 
            <span class="r187 r">powerShell</span>.<span class="i">AddCommand</span>(<span class="s">&quot;Get-FormatData&quot;</span>);
            <span class="r187 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;TypeName&quot;</span>, <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#83643e9fc15c5b13" class="i property">FormatTypeName</a>);
 
            <span class="c">// For remote PS version 5.1 and greater, we need to include the new -PowerShellVersion parameter</span>
            <span class="i">RemoteRunspace</span> <span id="r188 rd" class="r188 r">remoteRunspace</span> = <a href="#3db47a8aa30f9ffc" class="i property">Session</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a> <b>as</b> <span class="i">RemoteRunspace</span>;
            <b>if</b> ((<span class="r188 r">remoteRunspace</span> != <b>null</b>) &amp;&amp; (<span class="r188 r">remoteRunspace</span>.<span class="i">ServerVersion</span> != <b>null</b>) &amp;&amp;
                (<span class="r188 r">remoteRunspace</span>.<span class="i">ServerVersion</span> &gt;= <b>new</b> <span class="i">Version</span>(5, 1)))
            {
                <span class="r187 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;PowerShellVersion&quot;</span>, <a href="/System.Management.Automation/A.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="/System.Management.Automation/A.html#ad63365ac7690eeb" class="i property">PSVersion</a>);
            }
 
            <span class="r187 r">powerShell</span>.<span class="i">Runspace</span> = <a href="#3db47a8aa30f9ffc" class="i property">Session</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>;
 
            <b>return</b> <span class="r187 r">powerShell</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets CommandMetadata objects from remote runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">(rehydrated) CommandMetadata objects.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <a id="97ccd0535f2260b9" href="../../R/97ccd0535f2260b9.html" target="n" data-glyph="74,1" class="i method">GetRemoteFormatData</a>()
        {
            <b>if</b> ((<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#83643e9fc15c5b13" class="i property">FormatTypeName</a> == <b>null</b>) || (<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#83643e9fc15c5b13" class="i property">FormatTypeName</a>.<span class="i">Length</span> == 0) ||
                (<a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> &amp;&amp; !<a href="#890efb0ea2650cf4" class="i field">_formatTypeNamesSpecified</a>))
            {
                <b>return</b> <b>new</b> <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt;();
            }
 
            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#08a5d510633fad36" class="i method">WriteProgress</a>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ProgressStatusGetFormatDataStart</span>), <b>null</b>, <b>null</b>);
 
            <b>using</b> (<a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r189 rd" class="r189 r">powerShell</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#259df1f9052e42a6" class="i method">BuildPowerShellForGetFormatData</a>())
            {
                <span class="i">IAsyncResult</span> <span id="r190 rd" class="r190 r">asyncResult</span> = <b>null</b>;
                <b>try</b>
                {
                    <b>int</b> <span id="r191 rd" class="r191 r">expectedCount</span> = -1;
                    <b>using</b> (<a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r192 rd" class="r192 r">countingPowerShell</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#259df1f9052e42a6" class="i method">BuildPowerShellForGetFormatData</a>())
                    {
                        <span class="r191 r">expectedCount</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#7be8ff81bfdb154f" class="i method">CountRemoteObjects</a>(<span class="r192 r">countingPowerShell</span>);
                    }
 
                    <span class="c">// invoke</span>
                    <b>using</b> (<b>new</b> <span class="i">PowerShellStopper</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">Context</span>, <span class="r189 r">powerShell</span>))
                    {
                        <span class="i">DateTime</span> <span id="r193 rd" class="r193 r">startTime</span> = <span class="i">DateTime</span>.<span class="i">UtcNow</span>;
 
                        <a href="/System.Management.Automation/A.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r194 rd" class="r194 r">asyncOutput</span> = <b>new</b>();
 
                        <span class="c">// process output and errors as soon as possible</span>
                        <span class="r190 r">asyncResult</span> = <span class="r189 r">powerShell</span>.<span class="i">BeginInvoke</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<b>null</b>, <span class="r194 r">asyncOutput</span>);
                        <b>int</b> <span id="r195 rd" class="r195 r">numberOfReceivedObjects</span> = 0;
                        <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <span id="r196 rd" class="r196 r">result</span> = <b>new</b>();
                        <b>foreach</b> (<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r197 rd" class="r197 r">deserializedFormatData</span> <b>in</b> <span class="r194 r">asyncOutput</span>)
                        {
                            <span class="i">AddRemoteTypeDefinition</span>(<span class="r196 r">result</span>, <span class="r197 r">deserializedFormatData</span>);
                            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#6e4e72269ee51213" class="i method">DuplicatePowerShellStreams</a>(<span class="r189 r">powerShell</span>);
                            <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteProgress</span>(<span class="r193 r">startTime</span>, ++<span class="r195 r">numberOfReceivedObjects</span>, <span class="r191 r">expectedCount</span>, <span class="i">ImplicitRemotingStrings</span>.<span class="i">ProgressStatusGetFormatDataProgress</span>);
                        }
 
                        <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#6e4e72269ee51213" class="i method">DuplicatePowerShellStreams</a>(<span class="r189 r">powerShell</span>);
                        <span class="r189 r">powerShell</span>.<span class="i">EndInvoke</span>(<span class="r190 r">asyncResult</span>);
 
                        <b>if</b> ((<span class="r195 r">numberOfReceivedObjects</span> == 0) &amp;&amp; (<a href="#890efb0ea2650cf4" class="i field">_formatTypeNamesSpecified</a>))
                        {
                            <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6922f7bce1d88fe" class="i method">GetErrorNoResultsFromRemoteEnd</a>(<span class="s">&quot;Get-FormatData&quot;</span>));
                        }
 
                        <b>return</b> <span class="r196 r">result</span>;
                    }
                }
                <b>catch</b> (<a href="/System.Management.Automation/A.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r198 rd" class="r198 r">e</span>)
                {
                    <span class="c">// process terminating errors from remote end</span>
                    <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#463c41df975c23d5" class="i method">GetErrorFromRemoteCommand</a>(<span class="s">&quot;Get-FormatData&quot;</span>, <span class="r198 r">e</span>));
                }
            }
 
            <span class="c">// silencing the compiler with the &quot;return&quot; statement</span>
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;We should never get here&quot;</span>);
            <b>return</b> <b>null</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Executing remote Get-Command
 
        <b>private</b> <a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <a id="cbf7df6cd0fd9195" href="../../R/cbf7df6cd0fd9195.html" target="n" data-glyph="76,1" class="i method">BuildPowerShellForGetCommand</a>()
        {
            <a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r199 rd" class="r199 r">powerShell</span> = <a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="/System.Management.Automation/A.html#40345bc4625ff918" class="i method">Create</a>();
 
            <span class="r199 r">powerShell</span>.<span class="i">AddCommand</span>(<span class="s">&quot;Get-Command&quot;</span>);
            <span class="r199 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;CommandType&quot;</span>, <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#dc75288bd287a6f0" class="i property">CommandType</a>);
            <b>if</b> (<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#2ec56ff8dcd84705" class="i property">CommandName</a> != <b>null</b>)
            {
                <span class="r199 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;Name&quot;</span>, <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#2ec56ff8dcd84705" class="i property">CommandName</a>);
            }
 
            <span class="r199 r">powerShell</span>.<span class="i">AddParameter</span>(<b>nameof</b>(<a href="#f7751d4990752d74" class="i property">Module</a>), <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#f7751d4990752d74" class="i property">Module</a>);
            <b>if</b> (<a href="#0ae38c7b738bd78d" class="i field">IsFullyQualifiedModuleSpecified</a>)
            {
                <span class="r199 r">powerShell</span>.<span class="i">AddParameter</span>(<b>nameof</b>(<a href="#00d1812e0cc1a13e" class="i property">FullyQualifiedModule</a>), <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#00d1812e0cc1a13e" class="i property">FullyQualifiedModule</a>);
            }
 
            <span class="r199 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;ArgumentList&quot;</span>, <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#745f25d912daca68" class="i property">ArgumentList</a>);
 
            <span class="r199 r">powerShell</span>.<span class="i">Runspace</span> = <a href="#3db47a8aa30f9ffc" class="i property">Session</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>;
            <span class="r199 r">powerShell</span>.<span class="i">RemotePowerShell</span>.<span class="i">HostCallReceived</span> += <span class="i">HandleHostCallReceived</span>;
            <b>return</b> <span class="r199 r">powerShell</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r200 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r201 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="d3cbee6ac513117f" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleHostCallReceived</a>(<b>object</b> <span id="r200 rd" class="r200 r">sender</span>, <span class="i">RemoteDataEventArgs</span>&lt;<span class="i">RemoteHostCall</span>&gt; <span id="r201 rd" class="r201 r">eventArgs</span>)
        {
            <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<span class="i n">Internal</span>.<span class="i">ClientRemotePowerShell</span>.<span class="i">ExitHandler</span>(<span class="r200 r">sender</span>, <span class="r201 r">eventArgs</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets CommandMetadata objects from remote runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">(rehydrated) CommandMetadata objects.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <a id="bb4406572a38338d" href="../../R/bb4406572a38338d.html" target="n" data-glyph="74,1" class="i method">GetRemoteCommandMetadata</a>(<b>out</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r202 rd" class="r202 r">alias2resolvedCommandName</span>)
        {
            <b>bool</b> <span id="r203 rd" class="r203 r">isReleaseCandidateBackcompatibilityMode</span> =
                <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#3db47a8aa30f9ffc" class="i property">Session</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<span class="i">GetRemoteProtocolVersion</span>() == <span class="i">RemotingConstants</span>.<span class="i">ProtocolVersionWin7RC</span>;
 
            <span class="r202 r">alias2resolvedCommandName</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <b>if</b> ((<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#2ec56ff8dcd84705" class="i property">CommandName</a> == <b>null</b>) || (<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#2ec56ff8dcd84705" class="i property">CommandName</a>.<span class="i">Length</span> == 0) ||
                (!<a href="#a60602403415eace" class="i field">_commandParameterSpecified</a> &amp;&amp; <a href="#890efb0ea2650cf4" class="i field">_formatTypeNamesSpecified</a>))
            {
                <b>return</b> <b>new</b> <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt;();
            }
 
            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#08a5d510633fad36" class="i method">WriteProgress</a>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ProgressStatusGetCommandStart</span>), <b>null</b>, <b>null</b>);
 
            <b>using</b> (<a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r204 rd" class="r204 r">powerShell</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#cbf7df6cd0fd9195" class="i method">BuildPowerShellForGetCommand</a>())
            {
                <span class="r204 r">powerShell</span>.<span class="i">AddCommand</span>(<span class="s">&quot;Select-Object&quot;</span>);
                <span class="r204 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;Property&quot;</span>, <b>new</b> <b>string</b>[] {
                    <span class="s">&quot;Name&quot;</span>, <span class="s">&quot;CommandType&quot;</span>, <span class="s">&quot;ResolvedCommandName&quot;</span>, <span class="s">&quot;DefaultParameterSet&quot;</span>, <span class="s">&quot;CmdletBinding&quot;</span>, <span class="s">&quot;Parameters&quot;</span>});
                <span class="r204 r">powerShell</span>.<span class="i">IsGetCommandMetadataSpecialPipeline</span> = !<span class="r203 r">isReleaseCandidateBackcompatibilityMode</span>;
 
                <span class="i">IAsyncResult</span> <span id="r205 rd" class="r205 r">asyncResult</span> = <b>null</b>;
                <b>try</b>
                {
                    <b>int</b> <span id="r206 rd" class="r206 r">expectedCount</span> = -1;
                    <b>if</b> (<span class="r203 r">isReleaseCandidateBackcompatibilityMode</span>)
                    {
                        <b>using</b> (<a href="/System.Management.Automation/A.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r207 rd" class="r207 r">countingPowerShell</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#cbf7df6cd0fd9195" class="i method">BuildPowerShellForGetCommand</a>())
                        {
                            <span class="r206 r">expectedCount</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#7be8ff81bfdb154f" class="i method">CountRemoteObjects</a>(<span class="r207 r">countingPowerShell</span>);
                        }
                    }
 
                    <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r208 rd" class="r208 r">name2commandMetadata</span> =
                        <b>new</b>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
                    <span class="c">// invoke</span>
                    <b>using</b> (<b>new</b> <span class="i">PowerShellStopper</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">Context</span>, <span class="r204 r">powerShell</span>))
                    {
                        <span class="i">DateTime</span> <span id="r209 rd" class="r209 r">startTime</span> = <span class="i">DateTime</span>.<span class="i">UtcNow</span>;
 
                        <a href="/System.Management.Automation/A.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r210 rd" class="r210 r">asyncOutput</span> = <b>new</b>();
 
                        <span class="c">// process output and errors as soon as possible</span>
                        <span class="r205 r">asyncResult</span> = <span class="r204 r">powerShell</span>.<span class="i">BeginInvoke</span>&lt;<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<b>null</b>, <span class="r210 r">asyncOutput</span>);
                        <b>int</b> <span id="r211 rd" class="r211 r">numberOfReceivedObjects</span> = 0;
                        <b>foreach</b> (<a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r212 rd" class="r212 r">deserializedCommandInfo</span> <b>in</b> <span class="r210 r">asyncOutput</span>)
                        {
                            <b>if</b> (!<span class="r203 r">isReleaseCandidateBackcompatibilityMode</span> &amp;&amp; <span class="r206 r">expectedCount</span> == -1)
                            {
                                <span class="r206 r">expectedCount</span> = <span class="i">RemotingDecoder</span>.<span class="i">GetPropertyValue</span>&lt;<b>int</b>&gt;(
                                    <span class="r212 r">deserializedCommandInfo</span>,
                                    <span class="i">RemoteDataNameStrings</span>.<span class="i">DiscoveryCount</span>);
 
                                <b>continue</b>;
                            }
 
                            <a href="#fabe5d73f90d7e57" class="i method">AddRemoteCommandMetadata</a>(<span class="r208 r">name2commandMetadata</span>, <span class="r202 r">alias2resolvedCommandName</span>, <span class="r212 r">deserializedCommandInfo</span>);
                            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#6e4e72269ee51213" class="i method">DuplicatePowerShellStreams</a>(<span class="r204 r">powerShell</span>);
                            <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteProgress</span>(<span class="r209 r">startTime</span>, ++<span class="r211 r">numberOfReceivedObjects</span>, <span class="r206 r">expectedCount</span>, <span class="i">ImplicitRemotingStrings</span>.<span class="i">ProgressStatusGetCommandProgress</span>);
                        }
 
                        <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#6e4e72269ee51213" class="i method">DuplicatePowerShellStreams</a>(<span class="r204 r">powerShell</span>);
                        <span class="r204 r">powerShell</span>.<span class="i">EndInvoke</span>(<span class="r205 r">asyncResult</span>);
 
                        <b>if</b> ((<span class="r211 r">numberOfReceivedObjects</span> == 0) &amp;&amp; (<a href="#a60602403415eace" class="i field">_commandParameterSpecified</a>))
                        {
                            <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#b6922f7bce1d88fe" class="i method">GetErrorNoResultsFromRemoteEnd</a>(<span class="s">&quot;Get-Command&quot;</span>));
                        }
 
                        <b>return</b> <b>new</b> <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt;(<span class="r208 r">name2commandMetadata</span>.<span class="i">Values</span>);
                    }
                }
                <b>catch</b> (<a href="/System.Management.Automation/A.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r213 rd" class="r213 r">e</span>)
                {
                    <span class="c">// process terminating errors from remote end</span>
                    <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#463c41df975c23d5" class="i method">GetErrorFromRemoteCommand</a>(<span class="s">&quot;Get-Command&quot;</span>, <span class="r213 r">e</span>));
                }
            }
 
            <span class="c">// silencing the compiler with the &quot;return&quot; statement</span>
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;We should never get here&quot;</span>);
            <b>return</b> <b>null</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Reporting progress
 
        <b>private</b> <span class="i">DateTime</span> <a id="3d732b953a0f7fea" href="../../R/3d732b953a0f7fea.html" target="n" data-glyph="46,1" class="i field">_lastTimeProgressWasWritten</a> = <span class="i">DateTime</span>.<span class="i">UtcNow</span>;
 
        <b>private void</b> <a id="08a5d510633fad36" href="../../R/08a5d510633fad36.html" target="n" data-glyph="76,1" class="i method">WriteProgress</a>(<b>string</b> <span id="r214 rd" class="r214 r">statusDescription</span>, <b>int</b>? <span id="r215 rd" class="r215 r">percentComplete</span>, <b>int</b>? <span id="r216 rd" class="r216 r">secondsRemaining</span>)
        {
            <a href="/System.Management.Automation/A.html#1f168993cf0b800f" class="t t">ProgressRecordType</a> <span id="r217 rd" class="r217 r">recordType</span>;
            <b>if</b> (<span class="r216 r">secondsRemaining</span>.<span class="i">HasValue</span> &amp;&amp; <span class="r216 r">secondsRemaining</span>.<span class="i">Value</span> == 0 &amp;&amp;
                <span class="r215 r">percentComplete</span>.<span class="i">HasValue</span> &amp;&amp; <span class="r215 r">percentComplete</span>.<span class="i">Value</span> == 100)
            {
                <span class="r217 r">recordType</span> = <a href="/System.Management.Automation/A.html#1f168993cf0b800f" class="t t">ProgressRecordType</a>.<a href="/System.Management.Automation/A.html#be29e101fe03f5d0" class="i field">Completed</a>;
            }
            <b>else</b>
            {
                <span class="r217 r">recordType</span> = <a href="/System.Management.Automation/A.html#1f168993cf0b800f" class="t t">ProgressRecordType</a>.<a href="/System.Management.Automation/A.html#b02a1a2b864a452c" class="i field">Processing</a>;
            }
 
            <b>if</b> (<span class="r217 r">recordType</span> == <a href="/System.Management.Automation/A.html#1f168993cf0b800f" class="t t">ProgressRecordType</a>.<a href="/System.Management.Automation/A.html#b02a1a2b864a452c" class="i field">Processing</a>)
            {
                <span class="i">TimeSpan</span> <span id="r218 rd" class="r218 r">timeSinceProgressWasWrittenLast</span> = <span class="i">DateTime</span>.<span class="i">UtcNow</span> - <a href="#3d732b953a0f7fea" class="i field">_lastTimeProgressWasWritten</a>;
                <b>if</b> (<span class="r218 r">timeSinceProgressWasWrittenLast</span> &lt; <span class="i">TimeSpan</span>.<span class="i">FromMilliseconds</span>(200))
                {
                    <b>return</b>;
                }
            }
 
            <a href="#3d732b953a0f7fea" class="i field">_lastTimeProgressWasWritten</a> = <span class="i">DateTime</span>.<span class="i">UtcNow</span>;
 
            <b>string</b> <span id="r219 rd" class="r219 r">activityDescription</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ProgressActivity</span>);
            <a href="/System.Management.Automation/A.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a> <span id="r220 rd" class="r220 r">progressRecord</span> = <b>new</b>(
                1905347799, <span class="c">// unique id for ImplicitRemoting (I just picked a random number)</span>
                <span class="r219 r">activityDescription</span>,
                <span class="r214 r">statusDescription</span>);
 
            <b>if</b> (<span class="r215 r">percentComplete</span>.<span class="i">HasValue</span>)
            {
                <span class="r220 r">progressRecord</span>.<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> = <span class="r215 r">percentComplete</span>.<span class="i">Value</span>;
            }
 
            <b>if</b> (<span class="r216 r">secondsRemaining</span>.<span class="i">HasValue</span>)
            {
                <span class="r220 r">progressRecord</span>.<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a> = <span class="r216 r">secondsRemaining</span>.<span class="i">Value</span>;
            }
 
            <span class="r220 r">progressRecord</span>.<span class="i">RecordType</span> = <span class="r217 r">recordType</span>;
 
            <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">WriteProgress</span>(<span class="r220 r">progressRecord</span>);
        }
 
        <b>private void</b> <a id="74dfccd79b9c27c1" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">WriteProgress</a>(<span class="i">DateTime</span> <span id="r221 rd" class="r221 r">startTime</span>, <b>int</b> <span id="r222 rd" class="r222 r">currentCount</span>, <b>int</b> <span id="r223 rd" class="r223 r">expectedCount</span>, <b>string</b> <span id="r224 rd" class="r224 r">resourceId</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r222 r">currentCount</span> &gt; 0, <span class="s">&quot;Progress shouldn&#39;t be written before 1 result is received&quot;</span>);
 
            <b>string</b> <span id="r225 rd" class="r225 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="r224 r">resourceId</span>, <span class="r222 r">currentCount</span>);
            <b>if</b> (<span class="r223 r">expectedCount</span> &lt;= 0)
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#08a5d510633fad36" class="i method">WriteProgress</a>(<span class="r225 r">message</span>, <b>null</b>, <b>null</b>);
            }
            <b>else</b>
            {
                <b>double</b> <span id="r226 rd" class="r226 r">percentComplete</span> = (<b>double</b>)<span class="r222 r">currentCount</span> / <span class="r223 r">expectedCount</span>;
                <b>int</b>? <span id="r227 rd" class="r227 r">secondsRemaining</span> = <a href="/System.Management.Automation/A.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a>.<span class="i">GetSecondsRemaining</span>(<span class="r221 r">startTime</span>, <span class="r226 r">percentComplete</span>);
 
                <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#08a5d510633fad36" class="i method">WriteProgress</a>(<span class="r225 r">message</span>, (<b>int</b>)(100.0 * <span class="r226 r">percentComplete</span>), <span class="r227 r">secondsRemaining</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating a proxy module
 
        <b>internal</b> <span class="i">Guid</span> <a id="baa7ba1919ae28d7" href="../../R/baa7ba1919ae28d7.html" target="n" data-glyph="104,1" class="i property">ModuleGuid</a> { <b>get</b>; } = <span class="i">Guid</span>.<span class="i">NewGuid</span>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates a proxy module in the given directory.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r228 r">moduleRootDirectory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Base directory for the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r229 r">moduleNamePrefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">FileName prefix for module files.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r230 r">encoding</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Encoding of generated files.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r231 r">force</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether to overwrite files.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r232 r">listOfCommandMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote commands to generate proxies for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">alias2resolvedCommandName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Dictionary mapping alias names to resolved command names.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r234 r">listOfFormatData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote format data to generate format.ps1xml for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Paths to generated files.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="d3652f0af18d53e8" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GenerateProxyModule</a>(
            <span class="i">DirectoryInfo</span> <span id="r228 rd" class="r228 r">moduleRootDirectory</span>,
            <b>string</b> <span id="r229 rd" class="r229 r">moduleNamePrefix</span>,
            <span class="i">Encoding</span> <span id="r230 rd" class="r230 r">encoding</span>,
            <b>bool</b> <span id="r231 rd" class="r231 r">force</span>,
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r232 rd" class="r232 r">listOfCommandMetadata</span>,
            <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r233 rd" class="r233 r">alias2resolvedCommandName</span>,
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <span id="r234 rd" class="r234 r">listOfFormatData</span>)
        {
            <b>if</b> (<a href="#84caebe129ecd558" class="i field">_commandsSkippedBecauseOfShadowing</a>.<span class="i">Count</span> != 0)
            {
                <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#23b3acaa82693d36" class="i method">ReportSkippedCommands</a>();
 
                <b>if</b> (<span class="r232 r">listOfCommandMetadata</span>.<span class="i">Count</span> == 0)
                {
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r235 rd" class="r235 r">error</span> = <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#f4cc359695967228" class="i method">GetErrorNoCommandsImportedBecauseOfSkipping</a>();
                    <a href="#416ee3a25470f4b8" class="k">this</a>.<span class="i">ThrowTerminatingError</span>(<span class="r235 r">error</span>);
                }
            }
 
            <a href="#7d6c598f11254b64" class="t t">ImplicitRemotingCodeGenerator</a> <span id="r236 rd" class="r236 r">codeGenerator</span> = <b>new</b>(
                <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#3db47a8aa30f9ffc" class="i property">Session</a>,
                <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#baa7ba1919ae28d7" class="i property">ModuleGuid</a>,
                <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="/System.Management.Automation/A.html#92387ec2f33e4d8f" class="i property">MyInvocation</a>);
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r237 rd" class="r237 r">generatedFiles</span> = <span class="r236 r">codeGenerator</span>.<a href="#1d8be60aa4fcf654" class="i method">GenerateProxyModule</a>(
                <span class="r228 r">moduleRootDirectory</span>,
                <span class="r229 r">moduleNamePrefix</span>,
                <span class="r230 r">encoding</span>,
                <span class="r231 r">force</span>,
                <span class="r232 r">listOfCommandMetadata</span>,
                <span class="r233 r">alias2resolvedCommandName</span>,
                <span class="r234 r">listOfFormatData</span>,
                <a href="#b3fe48098d80bbca" class="i property">Certificate</a>);
 
            <a href="#416ee3a25470f4b8" class="k">this</a>.<a href="#08a5d510633fad36" class="i method">WriteProgress</a>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ProgressStatusCompleted</span>), 100, 0);
 
            <b>return</b> <span class="r237 r">generatedFiles</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <b>internal class</b> <a id="7d6c598f11254b64" href="../../R/7d6c598f11254b64.html" target="n" data-glyph="2,0" class="t t">ImplicitRemotingCodeGenerator</a>
    {
        <b>internal static readonly</b> <span class="i">Version</span> <a id="81a2e72527d4cf19" href="../../R/81a2e72527d4cf19.html" target="n" data-glyph="44,1" class="i field">VersionOfScriptWriter</a> = <b>new</b>(1, 0);
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor and shared private data
 
        <b>private readonly</b> <a href="/System.Management.Automation/A.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <a id="7a5b2b609441560c" href="../../R/7a5b2b609441560c.html" target="n" data-glyph="46,1" class="i field">_remoteRunspaceInfo</a>;
        <b>private readonly</b> <span class="i">Guid</span> <a id="430a85f4725d3181" href="../../R/430a85f4725d3181.html" target="n" data-glyph="46,1" class="i field">_moduleGuid</a>;
        <b>private readonly</b> <a href="/System.Management.Automation/A.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <a id="53f43141aa724aec" href="../../R/53f43141aa724aec.html" target="n" data-glyph="46,1" class="i field">_invocationInfo</a>;
 
        <b>internal</b> <a id="6163e538ffb784c8" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">ImplicitRemotingCodeGenerator</a>(
            <a href="/System.Management.Automation/A.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r238 rd" class="r238 r">remoteRunspaceInfo</span>,
            <span class="i">Guid</span> <span id="r239 rd" class="r239 r">moduleGuid</span>,
            <a href="/System.Management.Automation/A.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r240 rd" class="r240 r">invocationInfo</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r238 r">remoteRunspaceInfo</span> != <b>null</b>, <span class="s">&quot;Caller should validate remoteRunspaceInfo != null&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r239 r">moduleGuid</span> != <span class="i">Guid</span>.<span class="i">Empty</span>, <span class="s">&quot;Caller should validate moduleGuid is not empty&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r240 r">invocationInfo</span> != <b>null</b>, <span class="s">&quot;Caller should validate invocationInfo != null&quot;</span>);
 
            <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a> = <span class="r238 r">remoteRunspaceInfo</span>;
            <a href="#430a85f4725d3181" class="i field">_moduleGuid</a> = <span class="r239 r">moduleGuid</span>;
            <a href="#53f43141aa724aec" class="i field">_invocationInfo</a> = <span class="r240 r">invocationInfo</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Code generation helpers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a connection URI associated with the remote runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Connection URI associated with the remote runspace.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private string</b> <a id="1b822859951dabf9" href="../../R/1b822859951dabf9.html" target="n" data-glyph="76,1" class="i method">GetConnectionString</a>()
        {
            <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a> <span id="r241 rd" class="r241 r">connectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a>;
            <b>if</b> (<span class="r241 r">connectionInfo</span> != <b>null</b>)
            {
                <b>return</b> <span class="r241 r">connectionInfo</span>.<a href="/System.Management.Automation/A.html#eb73ffdb9b586505" class="i property">ConnectionUri</a>.<span class="i">ToString</span>();
            }
 
            <a href="/System.Management.Automation/A.html#3906a420e89ab01e" class="t t">VMConnectionInfo</a> <span id="r242 rd" class="r242 r">vmConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#3906a420e89ab01e" class="t t">VMConnectionInfo</a>;
            <b>if</b> (<span class="r242 r">vmConnectionInfo</span> != <b>null</b>)
            {
                <b>return</b> <span class="r242 r">vmConnectionInfo</span>.<a href="/System.Management.Automation/A.html#2b06b6861e222ac4" class="i property">ComputerName</a>;
            }
 
            <a href="/System.Management.Automation/A.html#d2be2d5c63c76391" class="t t">ContainerConnectionInfo</a> <span id="r243 rd" class="r243 r">containerConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#d2be2d5c63c76391" class="t t">ContainerConnectionInfo</a>;
            <b>if</b> (<span class="r243 r">containerConnectionInfo</span> != <b>null</b>)
            {
                <b>return</b> <span class="r243 r">containerConnectionInfo</span>.<a href="/System.Management.Automation/A.html#f801a4fbbda7199f" class="i property">ComputerName</a>;
            }
 
            <span class="c">/*
               wsman will also work with something that Uri.IsWellFormedUriString fails on:
               http://[0000:0000:0000:0000:0000:0000:0000:0001]/wsman
            Dbg.Assert(
                Uri.IsWellFormedUriString(connectionString, UriKind.Absolute),
                &quot;GetConnectionString() should return only well formed uri strings&quot;);
             */</span>
            <b>return</b> <b>null</b>;
        }
 
        <b>private static string</b> <a id="d36daa73f52fcfdb" href="../../R/d36daa73f52fcfdb.html" target="n" data-glyph="76,1" class="i method">EscapeFunctionNameForRemoteHelp</a>(<b>string</b> <span id="r244 rd" class="r244 r">name</span>)
        {
            <b>if</b> (<span class="r244 r">name</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r244 r">name</span>));
            }
 
            <span class="i">StringBuilder</span> <span id="r245 rd" class="r245 r">result</span> = <b>new</b>(<span class="r244 r">name</span>.<span class="i">Length</span>);
            <b>foreach</b> (<b>char</b> <span id="r246 rd" class="r246 r">c</span> <b>in</b> <span class="r244 r">name</span>)
            {
                <b>if</b> (!<span class="s">&quot;\&quot;&#39;`$&quot;</span>.<span class="i">Contains</span>(<span class="r246 r">c</span>)
                    &amp;&amp; !<b>char</b>.<span class="i">IsControl</span>(<span class="r246 r">c</span>)
                    &amp;&amp; !<b>char</b>.<span class="i">IsWhiteSpace</span>(<span class="r246 r">c</span>))
                {
                    <span class="r245 r">result</span>.<span class="i">Append</span>(<span class="r246 r">c</span>);
                }
            }
 
            <b>return</b> <span class="r245 r">result</span>.<span class="i">ToString</span>();
        }
 
        <b>private const string</b> <a id="a2d670c744a1f796" href="../../R/a2d670c744a1f796.html" target="n" data-glyph="10,1" class="i field">SectionSeparator</a> = <span class="s">@&quot;
##############################################################################
&quot;</span>;
 
        <b>private static void</b> <a id="4f1f630d87b21f95" href="../../R/4f1f630d87b21f95.html" target="n" data-glyph="76,1" class="i method">GenerateSectionSeparator</a>(<span class="i">TextWriter</span> <span id="r247 rd" class="r247 r">writer</span>)
        {
            <span class="r247 r">writer</span>.<span class="i">Write</span>(<a href="#a2d670c744a1f796" class="i field">SectionSeparator</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating manifest for proxy module
 
        <b>private const string</b> <a id="bfa01ce7ee531944" href="../../R/bfa01ce7ee531944.html" target="n" data-glyph="10,1" class="i field">ManifestTemplate</a> = <span class="s">@&quot;
@{{
    GUID = &#39;{0}&#39;
    Description = &#39;{1}&#39;
    ModuleToProcess = @(&#39;{2}&#39;)
    FormatsToProcess = @(&#39;{3}&#39;)
 
    ModuleVersion = &#39;1.0&#39;
 
    PrivateData = @{{
        ImplicitRemoting = $true
    }}
}}
        &quot;</span>;
 
        <b>private void</b> <a id="bc00a8650eb5f62c" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GenerateManifest</a>(<span class="i">TextWriter</span> <span id="r248 rd" class="r248 r">writer</span>, <b>string</b> <span id="r249 rd" class="r249 r">psm1fileName</span>, <b>string</b> <span id="r250 rd" class="r250 r">formatPs1xmlFileName</span>)
        {
            <b>if</b> (<span class="r248 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r248 r">writer</span>));
            }
 
            <a href="#4b45dbdd255ab550" class="i method">GenerateTopComment</a>(<span class="r248 r">writer</span>);
 
            <span class="r248 r">writer</span>.<span class="i">Write</span>(
                <a href="#bfa01ce7ee531944" class="i field">ManifestTemplate</a>,
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<a href="#430a85f4725d3181" class="i field">_moduleGuid</a>.<span class="i">ToString</span>()),
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ProxyModuleDescription</span>, <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#1b822859951dabf9" class="i method">GetConnectionString</a>())),
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r249 r">psm1fileName</span>)),
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r250 r">formatPs1xmlFileName</span>)));
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating header of a proxy module
 
        <b>private const string</b> <a id="c56c5b7bd235b681" href="../../R/c56c5b7bd235b681.html" target="n" data-glyph="10,1" class="i field">TopCommentTemplate</a> = <span class="s">@&quot;
&lt;#
 # {0}
 # {1}
 # {2}
 # {3}
 #&gt;
        &quot;</span>;
 
        <b>private void</b> <a id="4b45dbdd255ab550" href="../../R/4b45dbdd255ab550.html" target="n" data-glyph="76,1" class="i method">GenerateTopComment</a>(<span class="i">TextWriter</span> <span id="r251 rd" class="r251 r">writer</span>)
        {
            <span class="r251 r">writer</span>.<span class="i">Write</span>(
                <a href="#c56c5b7bd235b681" class="i field">TopCommentTemplate</a>,
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeBlockCommentContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ModuleHeaderTitle</span>)),
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeBlockCommentContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ModuleHeaderDate</span>, <span class="i">DateTime</span>.<span class="i">Now</span>.<span class="i">ToString</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>))),
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeBlockCommentContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ModuleHeaderCommand</span>, <a href="#53f43141aa724aec" class="i field">_invocationInfo</a>.<a href="/System.Management.Automation/A.html#8edab65bf1913897" class="i property">MyCommand</a>.<a href="/System.Management.Automation/A.html#02e11b521c500195" class="i property">Name</a>)),
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeBlockCommentContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ModuleHeaderCommandLine</span>, <a href="#53f43141aa724aec" class="i field">_invocationInfo</a>.<a href="/System.Management.Automation/A.html#d8a2387de19e4425" class="i property">Line</a>)));
        }
 
        <b>private const string</b> <a id="b164cd2c5a0f1f19" href="../../R/b164cd2c5a0f1f19.html" target="n" data-glyph="10,1" class="i field">HeaderTemplate</a> = <span class="s">@&quot;
param(
    &lt;# {0} #&gt;
    [System.Management.Automation.Runspaces.PSSession] $PSSessionOverride,
    [System.Management.Automation.Remoting.PSSessionOption] $PSSessionOptionOverride
)
 
$script:__psImplicitRemoting_versionOfScriptGenerator = {1}
if ($script:__psImplicitRemoting_versionOfScriptGenerator.Major -ne {2})
{{
    throw &#39;{3}&#39;
}}
 
$script:WriteHost = $executionContext.InvokeCommand.GetCommand(&#39;Write-Host&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:WriteWarning = $executionContext.InvokeCommand.GetCommand(&#39;Write-Warning&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:WriteInformation = $executionContext.InvokeCommand.GetCommand(&#39;Write-Information&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:GetPSSession = $executionContext.InvokeCommand.GetCommand(&#39;Get-PSSession&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:NewPSSession = $executionContext.InvokeCommand.GetCommand(&#39;New-PSSession&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:ConnectPSSession = $executionContext.InvokeCommand.GetCommand(&#39;Connect-PSSession&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:NewObject = $executionContext.InvokeCommand.GetCommand(&#39;New-Object&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:RemovePSSession = $executionContext.InvokeCommand.GetCommand(&#39;Remove-PSSession&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:InvokeCommand = $executionContext.InvokeCommand.GetCommand(&#39;Invoke-Command&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:SetItem = $executionContext.InvokeCommand.GetCommand(&#39;Set-Item&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:ImportCliXml = $executionContext.InvokeCommand.GetCommand(&#39;Import-CliXml&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:NewPSSessionOption = $executionContext.InvokeCommand.GetCommand(&#39;New-PSSessionOption&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:JoinPath = $executionContext.InvokeCommand.GetCommand(&#39;Join-Path&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:ExportModuleMember = $executionContext.InvokeCommand.GetCommand(&#39;Export-ModuleMember&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
$script:SetAlias = $executionContext.InvokeCommand.GetCommand(&#39;Set-Alias&#39;, [System.Management.Automation.CommandTypes]::Cmdlet)
 
$script:MyModule = $MyInvocation.MyCommand.ScriptBlock.Module
        &quot;</span>;
 
        <b>private void</b> <a id="cdcb2685b13208f1" href="../../R/cdcb2685b13208f1.html" target="n" data-glyph="76,1" class="i method">GenerateModuleHeader</a>(<span class="i">TextWriter</span> <span id="r252 rd" class="r252 r">writer</span>)
        {
            <b>if</b> (<span class="r252 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r252 r">writer</span>));
            }
 
            <span class="c">// In Win8, we are no longer loading all assemblies by default.</span>
            <span class="c">// So we need to use the fully qualified name when accessing a type in that assembly</span>
            <b>string</b> <span id="r253 rd" class="r253 r">versionOfScriptGenerator</span> = <span class="s">&quot;[&quot;</span> + <b>typeof</b>(<a href="#c70edc97a57d061b" class="t t">ExportPSSessionCommand</a>).<span class="i">AssemblyQualifiedName</span> + <span class="s">&quot;]&quot;</span> + <span class="s">&quot;::VersionOfScriptGenerator&quot;</span>;
            <a href="#4b45dbdd255ab550" class="i method">GenerateTopComment</a>(<span class="r252 r">writer</span>);
            <span class="r252 r">writer</span>.<span class="i">Write</span>(
                <a href="#b164cd2c5a0f1f19" class="i field">HeaderTemplate</a>,
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeBlockCommentContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ModuleHeaderRunspaceOverrideParameter</span>)),
                <span class="r253 r">versionOfScriptGenerator</span>,
                <a href="#7d6c598f11254b64" class="t t">ImplicitRemotingCodeGenerator</a>.<a href="#81a2e72527d4cf19" class="i field">VersionOfScriptWriter</a>,
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<b>string</b>.<span class="i">Format</span>(<b>null</b>, <span class="i">PathUtilsStrings</span>.<span class="i">ExportPSSession_ScriptGeneratorVersionMismatch</span>, <span class="s">&quot;Export-PSSession&quot;</span>)));
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating helper functions of a proxy module
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Write-PSImplicitRemotingMessage
 
        <b>private const string</b> <a id="ac4108113d70524e" href="../../R/ac4108113d70524e.html" target="n" data-glyph="10,1" class="i field">HelperFunctionsWriteMessage</a> = <span class="s">@&quot;
function Write-PSImplicitRemotingMessage
{
    param(
        [Parameter(Mandatory = $true, Position = 0)]
        [string]
        $message)
 
    try { &amp; $script:WriteHost -Object $message -ErrorAction SilentlyContinue } catch { }
}
&quot;</span>;
 
        <b>private static void</b> <a id="d883ec975132b20d" href="../../R/d883ec975132b20d.html" target="n" data-glyph="76,1" class="i method">GenerateHelperFunctionsWriteMessage</a>(<span class="i">TextWriter</span> <span id="r254 rd" class="r254 r">writer</span>)
        {
            <b>if</b> (<span class="r254 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r254 r">writer</span>));
            }
 
            <span class="r254 r">writer</span>.<span class="i">Write</span>(<a href="#ac4108113d70524e" class="i field">HelperFunctionsWriteMessage</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Set-PSImplicitRemotingSession
 
        <b>private const string</b> <a id="90c7801694859c00" href="../../R/90c7801694859c00.html" target="n" data-glyph="10,1" class="i field">HelperFunctionsSetImplicitRunspaceTemplate</a> = <span class="s">@&quot;
$script:PSSession = $null
 
function Get-PSImplicitRemotingModuleName {{ $myInvocation.MyCommand.ScriptBlock.File }}
 
function Set-PSImplicitRemotingSession
{{
    param(
        [Parameter(Mandatory = $true, Position = 0)]
        [AllowNull()]
        [Management.Automation.Runspaces.PSSession]
        $PSSession,
 
        [Parameter(Mandatory = $false, Position = 1)]
        [bool] $createdByModule = $false)
 
    if ($null -ne $PSSession)
    {{
        $script:PSSession = $PSSession
 
        if ($createdByModule -and ($null -ne $script:PSSession))
        {{
            $moduleName = Get-PSImplicitRemotingModuleName
            $script:PSSession.Name = &#39;{0}&#39; -f $moduleName
 
            $oldCleanUpScript = $script:MyModule.OnRemove
            $removePSSessionCommand = $script:RemovePSSession
            $script:MyModule.OnRemove = {{
                &amp; $removePSSessionCommand -Session $PSSession -ErrorAction SilentlyContinue
                if ($oldCleanUpScript)
                {{
                    &amp; $oldCleanUpScript $args
                }}
            }}.GetNewClosure()
        }}
    }}
}}
 
if ($PSSessionOverride) {{ Set-PSImplicitRemotingSession $PSSessionOverride }}
&quot;</span>;
 
        <b>private static void</b> <a id="16b8449748809954" href="../../R/16b8449748809954.html" target="n" data-glyph="76,1" class="i method">GenerateHelperFunctionsSetImplicitRunspace</a>(<span class="i">TextWriter</span> <span id="r255 rd" class="r255 r">writer</span>)
        {
            <b>if</b> (<span class="r255 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r255 r">writer</span>));
            }
 
            <b>string</b> <span id="r256 rd" class="r256 r">runspaceNameTemplate</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ProxyRunspaceNameTemplate</span>);
 
            <span class="r255 r">writer</span>.<span class="i">Write</span>(
                <a href="#90c7801694859c00" class="i field">HelperFunctionsSetImplicitRunspaceTemplate</a>,
                <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r256 r">runspaceNameTemplate</span>));
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Get-PSImplicitRemotingSessionOption
 
        <b>private const string</b> <a id="7742f7926f728b84" href="../../R/7742f7926f728b84.html" target="n" data-glyph="10,1" class="i field">HelperFunctionsGetSessionOptionTemplate</a> = <span class="s">@&quot;
function Get-PSImplicitRemotingSessionOption
{{
    if ($null -ne $PSSessionOptionOverride)
    {{
        return $PSSessionOptionOverride
    }}
    else
    {{
        return $({0})
    }}
}}
&quot;</span>;
 
        <b>private void</b> <a id="505b456c80a80dbc" href="../../R/505b456c80a80dbc.html" target="n" data-glyph="76,1" class="i method">GenerateHelperFunctionsGetSessionOption</a>(<span class="i">TextWriter</span> <span id="r257 rd" class="r257 r">writer</span>)
        {
            <b>if</b> (<span class="r257 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r257 r">writer</span>));
            }
 
            <span class="r257 r">writer</span>.<span class="i">Write</span>(
                <a href="#7742f7926f728b84" class="i field">HelperFunctionsGetSessionOptionTemplate</a>,
                <a href="#59d675766a5d2189" class="i method">GenerateNewPSSessionOption</a>());
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a> <a id="dbcad0421b9afd8b" href="../../R/dbcad0421b9afd8b.html" target="n" data-glyph="76,1" class="i method">GetApplicationArguments</a>()
        {
            <span class="i">RemoteRunspace</span> <span id="r258 rd" class="r258 r">remoteRunspace</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a> <b>as</b> <span class="i">RemoteRunspace</span>;
 
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r258 r">remoteRunspace</span> != <b>null</b>, <span class="s">&quot;PSSessionInfo should refer to a *remote* runspace&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r258 r">remoteRunspace</span>.<span class="i">RunspacePool</span> != <b>null</b>, <span class="s">&quot;All remote runspaces are implemented using a runspace pool&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r258 r">remoteRunspace</span>.<span class="i">RunspacePool</span> != <b>null</b>, <span class="s">&quot;All remote runspace pools have an internal implementation helper&quot;</span>);
 
            <b>return</b> <span class="r258 r">remoteRunspace</span>.<span class="i">RunspacePool</span>.<span class="i">RemoteRunspacePoolInternal</span>.<span class="i">ApplicationArguments</span>;
        }
 
        <b>private string</b> <a id="59d675766a5d2189" href="../../R/59d675766a5d2189.html" target="n" data-glyph="76,1" class="i method">GenerateNewPSSessionOption</a>()
        {
            <span class="i">StringBuilder</span> <span id="r259 rd" class="r259 r">result</span> = <b>new</b>(<span class="s">&quot;&amp; $script:NewPSSessionOption &quot;</span>);
 
            <a href="/System.Management.Automation/A.html#e07ed56a8a1da829" class="t t">RunspaceConnectionInfo</a> <span id="r260 rd" class="r260 r">runspaceConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#e07ed56a8a1da829" class="t t">RunspaceConnectionInfo</a>;
            <b>if</b> (<span class="r260 r">runspaceConnectionInfo</span> != <b>null</b>)
            {
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(<b>null</b>, <span class="s">&quot;-Culture &#39;{0}&#39; &quot;</span>, <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r260 r">runspaceConnectionInfo</span>.<a href="/System.Management.Automation/A.html#237e4765cd52489b" class="i property">Culture</a>.<span class="i">ToString</span>()));
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(<b>null</b>, <span class="s">&quot;-UICulture &#39;{0}&#39; &quot;</span>, <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r260 r">runspaceConnectionInfo</span>.<a href="/System.Management.Automation/A.html#27251d0ea7ef6aba" class="i property">UICulture</a>.<span class="i">ToString</span>()));
 
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(<b>null</b>, <span class="s">&quot;-CancelTimeOut {0} &quot;</span>, <span class="r260 r">runspaceConnectionInfo</span>.<a href="/System.Management.Automation/A.html#b136d8269dabb6c4" class="i property">CancelTimeout</a>);
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(<b>null</b>, <span class="s">&quot;-IdleTimeOut {0} &quot;</span>, <span class="r260 r">runspaceConnectionInfo</span>.<a href="/System.Management.Automation/A.html#0c117c8cb5b1de8b" class="i property">IdleTimeout</a>);
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(<b>null</b>, <span class="s">&quot;-OpenTimeOut {0} &quot;</span>, <span class="r260 r">runspaceConnectionInfo</span>.<a href="/System.Management.Automation/A.html#a0a3c947f4d2fe9e" class="i property">OpenTimeout</a>);
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(<b>null</b>, <span class="s">&quot;-OperationTimeOut {0} &quot;</span>, <span class="r260 r">runspaceConnectionInfo</span>.<a href="/System.Management.Automation/A.html#53cee291a23086f5" class="i property">OperationTimeout</a>);
            }
 
            <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a> <span id="r261 rd" class="r261 r">wsmanConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a>;
            <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span> != <b>null</b>)
            {
                <b>if</b> (!<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#1ec52b9b453e24eb" class="i property">UseCompression</a>) { <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-NoCompression &quot;</span>); }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#14ce6561582cbf9c" class="i property">NoEncryption</a>) { <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-NoEncryption &quot;</span>); }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#c6c54cb9078f2a4c" class="i property">NoMachineProfile</a>) { <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-NoMachineProfile &quot;</span>); }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#9b6f0e89a27da3f2" class="i property">UseUTF16</a>) { <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-UseUTF16 &quot;</span>); }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#1a6db05682add6a0" class="i property">SkipCACheck</a>) { <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-SkipCACheck &quot;</span>); }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#62a5656f8055cfb5" class="i property">SkipCNCheck</a>) { <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-SkipCNCheck &quot;</span>); }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#db5f31fe8eaa8600" class="i property">SkipRevocationCheck</a>) { <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-SkipRevocationCheck &quot;</span>); }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#acb325002c1b0d2a" class="i property">MaximumReceivedDataSizePerCommand</a>.<span class="i">HasValue</span>)
                {
                    <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="s">&quot;-MaximumReceivedDataSizePerCommand {0} &quot;</span>,
                        <span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#acb325002c1b0d2a" class="i property">MaximumReceivedDataSizePerCommand</a>.<span class="i">Value</span>);
                }
 
                <b>if</b> (<span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#72cfe9a0c294ec04" class="i property">MaximumReceivedObjectSize</a>.<span class="i">HasValue</span>)
                {
                    <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="s">&quot;-MaximumReceivedObjectSize {0} &quot;</span>,
                        <span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#72cfe9a0c294ec04" class="i property">MaximumReceivedObjectSize</a>.<span class="i">Value</span>);
                }
 
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="s">&quot;-MaximumRedirection {0} &quot;</span>,
                    <span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#21431be8484ed16e" class="i property">MaximumConnectionRedirectionCount</a>);
 
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="s">&quot;-ProxyAccessType {0} &quot;</span>,
                    <span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#9845f779385f9669" class="i property">ProxyAccessType</a>.<span class="i">ToString</span>());
                <span class="r259 r">result</span>.<span class="i">AppendFormat</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="s">&quot;-ProxyAuthentication {0} &quot;</span>,
                    <span class="r261 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#d95258451cb68b3b" class="i property">ProxyAuthentication</a>.<span class="i">ToString</span>());
                <span class="r259 r">result</span>.<span class="i">Append</span>(<a href="#7d6c598f11254b64" class="k">this</a>.<a href="#b580fd3d89a347a5" class="i method">GenerateProxyCredentialParameter</a>(<span class="r261 r">wsmanConnectionInfo</span>));
            }
 
            <a href="/System.Management.Automation/A.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a> <span id="r262 rd" class="r262 r">applicationArguments</span> = <a href="#dbcad0421b9afd8b" class="i method">GetApplicationArguments</a>();
            <b>if</b> (<span class="r262 r">applicationArguments</span> != <b>null</b>)
            {
                <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;-ApplicationArguments $(&quot;</span>);
                <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;&amp; $script:ImportCliXml -Path $(&quot;</span>);
                <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;&amp; $script:JoinPath -Path $PSScriptRoot -ChildPath ApplicationArguments.xml&quot;</span>);
                <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
                <span class="r259 r">result</span>.<span class="i">Append</span>(<span class="s">&quot;) &quot;</span>);
            }
 
            <b>return</b> <span class="r259 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">// index 0 - dialog title</span>
        <span class="c">// index 1 - dialog body</span>
        <span class="c">// index 2 - user name</span>
        <span class="c">// index 3 - target name (eventually passed to native CredUIPromptForCredentials as pszTargetName)</span>
        <b>private const string</b> <a id="0dbaa1ac860d2fec" href="../../R/0dbaa1ac860d2fec.html" target="n" data-glyph="10,1" class="i field">ProxyCredentialParameterTemplate</a> =
            <span class="s">&quot;-ProxyCredential ( $host.UI.PromptForCredential( &#39;{0}&#39;, &#39;{1}&#39;, &#39;{2}&#39;, &#39;{3}&#39; ) ) &quot;</span>;
 
        <b>private string</b> <a id="b580fd3d89a347a5" href="../../R/b580fd3d89a347a5.html" target="n" data-glyph="76,1" class="i method">GenerateProxyCredentialParameter</a>(<a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a> <span id="r263 rd" class="r263 r">wsmanConnectionInfo</span>)
        {
            <b>if</b> ((<span class="r263 r">wsmanConnectionInfo</span> == <b>null</b>) || (<span class="r263 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#b90c1ed41e87c2ea" class="i property">ProxyCredential</a> == <b>null</b>))
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
            <b>else</b>
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#0dbaa1ac860d2fec" class="i field">ProxyCredentialParameterTemplate</a>,
                    <span class="c">/* 0 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">CredentialRequestTitle</span>)),
                    <span class="c">/* 1 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ProxyCredentialRequestBody</span>, <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#1b822859951dabf9" class="i method">GetConnectionString</a>())),
                    <span class="c">/* 2 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r263 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#b90c1ed41e87c2ea" class="i property">ProxyCredential</a>.<a href="/System.Management.Automation/A.html#3fca673651eaeaff" class="i property">UserName</a>),
                    <span class="c">/* 3 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#4e8388b3861bf08b" class="i property">ComputerName</a> + <span class="s">@&quot;\httpproxy&quot;</span>));
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Get-PSImplicitRemotingSession
 
        <span class="c">// index 0 - remote runspace id</span>
        <span class="c">// index 1 - message template for new runspace</span>
        <span class="c">// index 2 - expression for getting a new runspace</span>
        <span class="c">// index 3 - message when no runspace is available</span>
        <span class="c">// index 4 - implicit remoting hash</span>
        <span class="c">// index 5 - message for mismatched implicit remoting hash</span>
        <span class="c">// index 6 - key for implicit remoting private data</span>
        <span class="c">// index 7 - key for implicit remoting hash</span>
        <b>private const string</b> <a id="dcb4e0df4faf7274" href="../../R/dcb4e0df4faf7274.html" target="n" data-glyph="10,1" class="i field">HelperFunctionsGetImplicitRunspaceTemplate</a> = <span class="s">@&quot;
function Get-PSImplicitRemotingSession
{{
    param(
        [Parameter(Mandatory = $true, Position = 0)]
        [string]
        $commandName
    )
 
    $savedImplicitRemotingHash = &#39;{4}&#39;
 
    if (($null -eq $script:PSSession) -or ($script:PSSession.Runspace.RunspaceStateInfo.State -ne &#39;Opened&#39;))
    {{
        Set-PSImplicitRemotingSession `
            (&amp; $script:GetPSSession `
                -InstanceId {0} `
                -ErrorAction SilentlyContinue )
    }}
 
    if (($null -ne $script:PSSession) -and ($script:PSSession.Runspace.RunspaceStateInfo.State -eq &#39;Disconnected&#39;))
    {{
        # If we are handed a disconnected session, try re-connecting it before creating a new session.
        Set-PSImplicitRemotingSession `
            (&amp; $script:ConnectPSSession `
                -Session $script:PSSession `
                -ErrorAction SilentlyContinue)
    }}
 
    if (($null -eq $script:PSSession) -or ($script:PSSession.Runspace.RunspaceStateInfo.State -ne &#39;Opened&#39;))
    {{
        Write-PSImplicitRemotingMessage (&#39;{1}&#39; -f $commandName)
 
        Set-PSImplicitRemotingSession `
            -CreatedByModule $true `
            -PSSession ( {2} )
 
        if ($savedImplicitRemotingHash -ne &#39;&#39;)
        {{
            $newImplicitRemotingHash = [string]($script:PSSession.ApplicationPrivateData.{6}.{7})
            if ($newImplicitRemotingHash -ne $savedImplicitRemotingHash)
            {{
                &amp; $script:WriteWarning -Message &#39;{5}&#39;
            }}
        }}
 
        {8}
    }}
 
    if (($null -eq $script:PSSession) -or ($script:PSSession.Runspace.RunspaceStateInfo.State -ne &#39;Opened&#39;))
    {{
        throw &#39;{3}&#39;
    }}
 
    return [Management.Automation.Runspaces.PSSession]$script:PSSession
}}
&quot;</span>;
 
        <b>private void</b> <a id="bbd3ca48bb883374" href="../../R/bbd3ca48bb883374.html" target="n" data-glyph="76,1" class="i method">GenerateHelperFunctionsGetImplicitRunspace</a>(<span class="i">TextWriter</span> <span id="r264 rd" class="r264 r">writer</span>)
        {
            <b>if</b> (<span class="r264 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r264 r">writer</span>));
            }
 
            <b>string</b> <span id="r265 rd" class="r265 r">hashString</span>;
            <a href="/System.Management.Automation/A.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a>.<span class="i">TryPathGet</span>(
                <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#fafd1c05537097a7" class="i property">ApplicationPrivateData</a>,
                <b>out</b> <span class="r265 r">hashString</span>,
                <a href="#416ee3a25470f4b8" class="t t">ImplicitRemotingCommandBase</a>.<a href="#b5c73badf9af43ef" class="i field">ImplicitRemotingKey</a>,
                <a href="#416ee3a25470f4b8" class="t t">ImplicitRemotingCommandBase</a>.<a href="#7ff047c0491b6198" class="i field">ImplicitRemotingHashKey</a>);
            <span class="r265 r">hashString</span> ??= <b>string</b>.<span class="i">Empty</span>;
 
            <span class="r264 r">writer</span>.<span class="i">Write</span>(
                <a href="#dcb4e0df4faf7274" class="i field">HelperFunctionsGetImplicitRunspaceTemplate</a>,
                <span class="c">/* 0 */</span> <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#efd181c61ecd05ff" class="i property">InstanceId</a>,
                <span class="c">/* 1 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">CreateNewRunspaceMessageTemplate</span>)),
                <span class="c">/* 2 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#cb4c145eac36362f" class="i method">GenerateNewRunspaceExpression</a>(),
                <span class="c">/* 3 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">ErrorNoRunspaceForThisModule</span>)),
                <span class="c">/* 4 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r265 r">hashString</span>),
                <span class="c">/* 5 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">WarningMismatchedImplicitRemotingHash</span>)),
                <span class="c">/* 6 */</span> <a href="#416ee3a25470f4b8" class="t t">ImplicitRemotingCommandBase</a>.<a href="#b5c73badf9af43ef" class="i field">ImplicitRemotingKey</a>,
                <span class="c">/* 7 */</span> <a href="#416ee3a25470f4b8" class="t t">ImplicitRemotingCommandBase</a>.<a href="#7ff047c0491b6198" class="i field">ImplicitRemotingHashKey</a>,
                <span class="c">/* 8 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#5181b87af26e7799" class="i method">GenerateReimportingOfModules</a>());
        }
 
        <b>private const string</b> <a id="3191eb250c488631" href="../../R/3191eb250c488631.html" target="n" data-glyph="10,1" class="i field">ReimportTemplate</a> = <span class="s">@&quot;
            try {{
                &amp; $script:InvokeCommand -Session $script:PSSession -ScriptBlock {{
                    Get-Module -ListAvailable -Name &#39;{0}&#39; | Import-Module
                }} -ErrorAction SilentlyContinue
            }} catch {{ }}
&quot;</span>;
 
        <b>private string</b> <a id="5181b87af26e7799" href="../../R/5181b87af26e7799.html" target="n" data-glyph="76,1" class="i method">GenerateReimportingOfModules</a>()
        {
            <span class="i">StringBuilder</span> <span id="r266 rd" class="r266 r">result</span> = <b>new</b>();
 
            <b>if</b> (<a href="#53f43141aa724aec" class="i field">_invocationInfo</a>.<a href="/System.Management.Automation/A.html#1927782a0117ff76" class="i property">BoundParameters</a>.<span class="i">ContainsKey</span>(<b>nameof</b>(<span class="i">Module</span>)))
            {
                <b>string</b>[] <span id="r267 rd" class="r267 r">moduleNames</span> = (<b>string</b>[])<a href="#53f43141aa724aec" class="i field">_invocationInfo</a>.<a href="/System.Management.Automation/A.html#1927782a0117ff76" class="i property">BoundParameters</a>[<b>nameof</b>(<span class="i">Module</span>)];
                <b>foreach</b> (<b>string</b> <span id="r268 rd" class="r268 r">moduleName</span> <b>in</b> <span class="r267 r">moduleNames</span>)
                {
                    <span class="r266 r">result</span>.<span class="i">AppendFormat</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <a href="#3191eb250c488631" class="i field">ReimportTemplate</a>,
                        <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r268 r">moduleName</span>));
                }
            }
 
            <b>return</b> <span class="r266 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> New-Runspace expression
 
        <span class="c">// index 0 - connection uri (escaped for inclusion in single quoted string)</span>
        <span class="c">// index 1 - shell name (escaped for inclusion in single quoted string)</span>
        <span class="c">// index 2 - credential (empty string or parameter + value from $host.UI.PromptForCredential)</span>
        <span class="c">// index 3 - certificate thumbprint (empty string or full parameter + value)</span>
        <span class="c">// wsman specific:</span>
        <span class="c">// index 4 - authentication mechanism (empty string of full parameter + value)</span>
        <span class="c">// index 5 - allow redirection</span>
        <b>private const string</b> <a id="a7e50430a0342f53" href="../../R/a7e50430a0342f53.html" target="n" data-glyph="10,1" class="i field">NewRunspaceTemplate</a> = <span class="s">@&quot;
            $(
                &amp; $script:NewPSSession `
                    {0} -ConfigurationName &#39;{1}&#39; `
                    -SessionOption (Get-PSImplicitRemotingSessionOption) `
                    {2} `
                    {3} `
                    {4} `
                    {5} `
            )
&quot;</span>;
 
        <span class="c">// index 0 - &quot;-VMId &lt;vm id&gt;&quot; (VMId is used instead of VMName due to its uniqueness)</span>
        <span class="c">// index 1 - VM credential</span>
        <span class="c">// index 2 - &quot;-ConfigurationName &lt;configuration name&gt;&quot; or empty string</span>
        <b>private const string</b> <a id="4aece521e6c3a7e9" href="../../R/4aece521e6c3a7e9.html" target="n" data-glyph="10,1" class="i field">NewVMRunspaceTemplate</a> = <span class="s">@&quot;
            $(
                &amp; $script:NewPSSession `
                    {0} `
                    {1} `
                    {2} `
            )
&quot;</span>;
 
        <span class="c">// index 0 - &quot;-ContainerId &lt;container id&gt;&quot;</span>
        <span class="c">// index 1 - &quot;-RunAsAdministrator&quot; or empty string</span>
        <span class="c">// index 2 - &quot;-ConfigurationName &lt;configuration name&gt;&quot; or empty string</span>
        <b>private const string</b> <a id="18707d3292983b20" href="../../R/18707d3292983b20.html" target="n" data-glyph="10,1" class="i field">NewContainerRunspaceTemplate</a> = <span class="s">@&quot;
            $(
                &amp; $script:NewPSSession `
                    {0} `
                    {1} `
                    {2} `
            )
&quot;</span>;
 
        <b>private string</b> <a id="cb4c145eac36362f" href="../../R/cb4c145eac36362f.html" target="n" data-glyph="76,1" class="i method">GenerateNewRunspaceExpression</a>()
        {
            <a href="/System.Management.Automation/A.html#3906a420e89ab01e" class="t t">VMConnectionInfo</a> <span id="r269 rd" class="r269 r">vmConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#3906a420e89ab01e" class="t t">VMConnectionInfo</a>;
            <b>if</b> (<span class="r269 r">vmConnectionInfo</span> != <b>null</b>)
            {
                <b>string</b> <span id="r270 rd" class="r270 r">vmConfigurationName</span> = <span class="r269 r">vmConnectionInfo</span>.<a href="/System.Management.Automation/A.html#40e4e88d20abe582" class="i property">ConfigurationName</a>;
                <b>return</b> <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#4aece521e6c3a7e9" class="i field">NewVMRunspaceTemplate</a>,
                    <span class="c">/* 0 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#bf16cfecc678220a" class="i method">GenerateConnectionStringForNewRunspace</a>(),
                    <span class="c">/* 1 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#7a044fda9e6887e3" class="i method">GenerateCredentialParameter</a>(),
                    <span class="c">/* 2 */</span> <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r270 r">vmConfigurationName</span>) ? <b>string</b>.<span class="i">Empty</span> : <b>string</b>.<span class="i">Concat</span>(<span class="s">&quot;-ConfigurationName &quot;</span>, <span class="r270 r">vmConfigurationName</span>));
            }
            <b>else</b>
            {
                <a href="/System.Management.Automation/A.html#d2be2d5c63c76391" class="t t">ContainerConnectionInfo</a> <span id="r271 rd" class="r271 r">containerConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#d2be2d5c63c76391" class="t t">ContainerConnectionInfo</a>;
                <b>if</b> (<span class="r271 r">containerConnectionInfo</span> != <b>null</b>)
                {
                    <b>string</b> <span id="r272 rd" class="r272 r">containerConfigurationName</span> = <span class="r271 r">containerConnectionInfo</span>.<span class="i">ContainerProc</span>.<span class="i">ConfigurationName</span>;
                    <b>return</b> <b>string</b>.<span class="i">Format</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <a href="#18707d3292983b20" class="i field">NewContainerRunspaceTemplate</a>,
                        <span class="c">/* 0 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#bf16cfecc678220a" class="i method">GenerateConnectionStringForNewRunspace</a>(),
                        <span class="c">/* 1 */</span> <span class="r271 r">containerConnectionInfo</span>.<span class="i">ContainerProc</span>.<span class="i">RunAsAdmin</span> ? <span class="s">&quot;-RunAsAdministrator&quot;</span> : <b>string</b>.<span class="i">Empty</span>,
                        <span class="c">/* 2 */</span> <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r272 r">containerConfigurationName</span>) ? <b>string</b>.<span class="i">Empty</span> : <b>string</b>.<span class="i">Concat</span>(<span class="s">&quot;-ConfigurationName &quot;</span>, <span class="r272 r">containerConfigurationName</span>));
                }
                <b>else</b>
                {
                    <b>return</b> <b>string</b>.<span class="i">Format</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <a href="#a7e50430a0342f53" class="i field">NewRunspaceTemplate</a>,
                        <span class="c">/* 0 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#bf16cfecc678220a" class="i method">GenerateConnectionStringForNewRunspace</a>(),
                        <span class="c">/* 1 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#e20acc0fbcf9eecc" class="i property">ConfigurationName</a>),
                        <span class="c">/* 2 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#7a044fda9e6887e3" class="i method">GenerateCredentialParameter</a>(),
                        <span class="c">/* 3 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#07f950d9a054b4e4" class="i method">GenerateCertificateThumbprintParameter</a>(),
                        <span class="c">/* 4 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#8fed63f7409f5e7d" class="i method">GenerateAuthenticationMechanismParameter</a>(),
                        <span class="c">/* 5 */</span> <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#f1cead8a20ae5096" class="i method">GenerateAllowRedirectionParameter</a>());
                }
            }
        }
 
        <b>private const string</b> <a id="a983f2cc693fc237" href="../../R/a983f2cc693fc237.html" target="n" data-glyph="10,1" class="i field">ComputerNameParameterTemplate</a> = <span class="s">@&quot;-ComputerName &#39;{0}&#39; `
                    -ApplicationName &#39;{1}&#39; {2} {3} &quot;</span>;
 
        <b>private const string</b> <a id="a04cc28399ea9e96" href="../../R/a04cc28399ea9e96.html" target="n" data-glyph="10,1" class="i field">VMIdParameterTemplate</a> = <span class="s">@&quot;-VMId &#39;{0}&#39; &quot;</span>;
        <b>private const string</b> <a id="370fe2468fb93618" href="../../R/370fe2468fb93618.html" target="n" data-glyph="10,1" class="i field">ContainerIdParameterTemplate</a> = <span class="s">@&quot;-ContainerId &#39;{0}&#39; &quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is needed to work with Default Port DCR change from WSMan. See BUG</span>
        <span class="c">///</span><span class="c"> 542726. If http/https is specified in the connectionURI and no port is</span>
        <span class="c">///</span><span class="c"> specified then defaults for http/https (80/443) are applied. But WSMan</span>
        <span class="c">///</span><span class="c"> by default listens on 5985/5986. To overcome this, this function</span>
        <span class="c">///</span><span class="c"> creates a -ComputerName parameter set or -ConnectionUri parameter</span>
        <span class="c">///</span><span class="c"> set depending on the situation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private string</b> <a id="bf16cfecc678220a" href="../../R/bf16cfecc678220a.html" target="n" data-glyph="76,1" class="i method">GenerateConnectionStringForNewRunspace</a>()
        {
            <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a> <span id="r273 rd" class="r273 r">connectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a>;
            <b>if</b> (<span class="r273 r">connectionInfo</span> == <b>null</b>)
            {
                <a href="/System.Management.Automation/A.html#3906a420e89ab01e" class="t t">VMConnectionInfo</a> <span id="r274 rd" class="r274 r">vmConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#3906a420e89ab01e" class="t t">VMConnectionInfo</a>;
                <b>if</b> (<span class="r274 r">vmConnectionInfo</span> != <b>null</b>)
                {
                    <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <a href="#a04cc28399ea9e96" class="i field">VMIdParameterTemplate</a>,
                        <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r274 r">vmConnectionInfo</span>.<a href="/System.Management.Automation/A.html#74cd8e4ebf0317df" class="i property">VMGuid</a>.<span class="i">ToString</span>()));
                }
 
                <a href="/System.Management.Automation/A.html#d2be2d5c63c76391" class="t t">ContainerConnectionInfo</a> <span id="r275 rd" class="r275 r">containerConnectionInfo</span> = <a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>as</b> <a href="/System.Management.Automation/A.html#d2be2d5c63c76391" class="t t">ContainerConnectionInfo</a>;
                <b>if</b> (<span class="r275 r">containerConnectionInfo</span> != <b>null</b>)
                {
                    <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <a href="#370fe2468fb93618" class="i field">ContainerIdParameterTemplate</a>,
                        <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r275 r">containerConnectionInfo</span>.<span class="i">ContainerProc</span>.<span class="i">ContainerId</span>));
                }
 
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (<span class="r273 r">connectionInfo</span>.<span class="i">UseDefaultWSManPort</span>)
            {
                <b>bool</b> <span id="r276 rd" class="r276 r">isSSLSpecified</span>;
                <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a>.<span class="i">GetConnectionString</span>(<span class="r273 r">connectionInfo</span>.<a href="/System.Management.Automation/A.html#eb73ffdb9b586505" class="i property">ConnectionUri</a>, <b>out</b> <span class="r276 r">isSSLSpecified</span>);
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#a983f2cc693fc237" class="i field">ComputerNameParameterTemplate</a>,
                    <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r273 r">connectionInfo</span>.<a href="/System.Management.Automation/A.html#74b71e9668d24a47" class="i property">ComputerName</a>),
                    <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r273 r">connectionInfo</span>.<a href="/System.Management.Automation/A.html#0757157b257825db" class="i property">AppName</a>),
                    <span class="r273 r">connectionInfo</span>.<span class="i">UseDefaultWSManPort</span> ?
                        <b>string</b>.<span class="i">Empty</span> :
                        <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                            <span class="s">&quot;-Port {0} &quot;</span>, <span class="r273 r">connectionInfo</span>.<a href="/System.Management.Automation/A.html#1aeb2cc802b3a879" class="i property">Port</a>),
                    <span class="r276 r">isSSLSpecified</span> ? <span class="s">&quot;-useSSL&quot;</span> : <b>string</b>.<span class="i">Empty</span>);
            }
            <b>else</b>
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="s">&quot;-connectionUri &#39;{0}&#39;&quot;</span>,
                    <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<a href="#1b822859951dabf9" class="i method">GetConnectionString</a>()));
            }
        }
 
        <b>private string</b> <a id="f1cead8a20ae5096" href="../../R/f1cead8a20ae5096.html" target="n" data-glyph="76,1" class="i method">GenerateAllowRedirectionParameter</a>()
        {
            <b>if</b> (!(<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>is</b> <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a> <span id="r277 rd" class="r277 r">wsmanConnectionInfo</span>))
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <b>if</b> (<span class="r277 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#21431be8484ed16e" class="i property">MaximumConnectionRedirectionCount</a> != 0)
            {
                <b>return</b> <span class="s">&quot;-AllowRedirection&quot;</span>;
            }
            <b>else</b>
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
        }
 
        <b>private const string</b> <a id="2cb4f7300f63f762" href="../../R/2cb4f7300f63f762.html" target="n" data-glyph="10,1" class="i field">AuthenticationMechanismParameterTemplate</a> = <span class="s">&quot;-Authentication {0}&quot;</span>;
 
        <b>private string</b> <a id="8fed63f7409f5e7d" href="../../R/8fed63f7409f5e7d.html" target="n" data-glyph="76,1" class="i method">GenerateAuthenticationMechanismParameter</a>()
        {
            <span class="c">// comment in newrunspacecommand.cs says that -CertificateThumbprint</span>
            <span class="c">// and AuthenticationMechanism are mutually exclusive</span>
            <b>if</b> (<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a>.<a href="/System.Management.Automation/A.html#849442bb4db4c66e" class="i property">CertificateThumbprint</a> != <b>null</b>)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <b>if</b> (!(<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a> <b>is</b> <a href="/System.Management.Automation/A.html#2d9d176ef419be5a" class="t t">WSManConnectionInfo</a> <span id="r278 rd" class="r278 r">wsmanConnectionInfo</span>))
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <b>return</b> <b>string</b>.<span class="i">Format</span>(
                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <a href="#2cb4f7300f63f762" class="i field">AuthenticationMechanismParameterTemplate</a>,
                <span class="r278 r">wsmanConnectionInfo</span>.<a href="/System.Management.Automation/A.html#e1a2e5b5a5d08c41" class="i property">AuthenticationMechanism</a>.<span class="i">ToString</span>());
        }
 
        <span class="c">// index 0 - dialog title</span>
        <span class="c">// index 1 - dialog body</span>
        <span class="c">// index 2 - user name</span>
        <span class="c">// index 3 - target name (eventually passed to native CredUIPromptForCredentials as pszTargetName)</span>
        <b>private const string</b> <a id="ef9e494ce188961c" href="../../R/ef9e494ce188961c.html" target="n" data-glyph="10,1" class="i field">CredentialParameterTemplate</a> =
            <span class="s">&quot;-Credential ( $host.UI.PromptForCredential( &#39;{0}&#39;, &#39;{1}&#39;, &#39;{2}&#39;, &#39;{3}&#39; ) )&quot;</span>;
 
        <b>private string</b> <a id="7a044fda9e6887e3" href="../../R/7a044fda9e6887e3.html" target="n" data-glyph="76,1" class="i method">GenerateCredentialParameter</a>()
        {
            <b>if</b> (<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a>.<a href="/System.Management.Automation/A.html#a6344cc76011848b" class="i property">Credential</a> == <b>null</b>)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
            <b>else</b>
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#ef9e494ce188961c" class="i field">CredentialParameterTemplate</a>,
                    <span class="c">/* 0 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">CredentialRequestTitle</span>)),
                    <span class="c">/* 1 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">CredentialRequestBody</span>, <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#1b822859951dabf9" class="i method">GetConnectionString</a>())),
                    <span class="c">/* 2 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a>.<a href="/System.Management.Automation/A.html#a6344cc76011848b" class="i property">Credential</a>.<a href="/System.Management.Automation/A.html#3fca673651eaeaff" class="i property">UserName</a>),
                    <span class="c">/* 3 */</span> <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#4e8388b3861bf08b" class="i property">ComputerName</a>));
            }
        }
 
        <b>private const string</b> <a id="7b1f86e399a2fa16" href="../../R/7b1f86e399a2fa16.html" target="n" data-glyph="10,1" class="i field">CertificateThumbprintParameterTemplate</a> = <span class="s">&quot;-CertificateThumbprint &#39;{0}&#39;&quot;</span>;
 
        <b>private string</b> <a id="07f950d9a054b4e4" href="../../R/07f950d9a054b4e4.html" target="n" data-glyph="76,1" class="i method">GenerateCertificateThumbprintParameter</a>()
        {
            <b>if</b> (<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a>.<a href="/System.Management.Automation/A.html#849442bb4db4c66e" class="i property">CertificateThumbprint</a> == <b>null</b>)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
            <b>else</b>
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <a href="#7b1f86e399a2fa16" class="i field">CertificateThumbprintParameterTemplate</a>,
                    <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<a href="#7a5b2b609441560c" class="i field">_remoteRunspaceInfo</a>.<a href="/System.Management.Automation/A.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="/System.Management.Automation/A.html#7ff4c79fcb624bf1" class="i property">ConnectionInfo</a>.<a href="/System.Management.Automation/A.html#849442bb4db4c66e" class="i property">CertificateThumbprint</a>));
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Get-ClientSideParameters
 
        <b>private const string</b> <a id="729b5b7086ed99de" href="../../R/729b5b7086ed99de.html" target="n" data-glyph="10,1" class="i field">HelperFunctionsModifyParameters</a> = <span class="s">@&quot;
function Modify-PSImplicitRemotingParameters
{
    param(
        [Parameter(Mandatory = $true, Position = 0)]
        [hashtable]
        $clientSideParameters,
 
        [Parameter(Mandatory = $true, Position = 1)]
        $PSBoundParameters,
 
        [Parameter(Mandatory = $true, Position = 2)]
        [string]
        $parameterName,
 
        [Parameter()]
        [switch]
        $leaveAsRemoteParameter)
 
    if ($PSBoundParameters.ContainsKey($parameterName))
    {
        $clientSideParameters.Add($parameterName, $PSBoundParameters[$parameterName])
        if (-not $leaveAsRemoteParameter) {
            $null = $PSBoundParameters.Remove($parameterName)
        }
    }
}
 
function Get-PSImplicitRemotingClientSideParameters
{
    param(
        [Parameter(Mandatory = $true, Position = 1)]
        $PSBoundParameters,
 
        [Parameter(Mandatory = $true, Position = 2)]
        $proxyForCmdlet)
 
    $clientSideParameters = @{}
 
    $parametersToLeaveRemote = &#39;ErrorAction&#39;, &#39;WarningAction&#39;, &#39;InformationAction&#39;
 
    Modify-PSImplicitRemotingParameters $clientSideParameters $PSBoundParameters &#39;AsJob&#39;
    if ($proxyForCmdlet)
    {
        foreach($parameter in [System.Management.Automation.Cmdlet]::CommonParameters)
        {
            if($parametersToLeaveRemote -contains $parameter)
            {
                Modify-PSImplicitRemotingParameters $clientSideParameters $PSBoundParameters $parameter -LeaveAsRemoteParameter
            }
            else
            {
                Modify-PSImplicitRemotingParameters $clientSideParameters $PSBoundParameters $parameter
            }
        }
    }
 
    return $clientSideParameters
}
&quot;</span>;
 
        <b>private static void</b> <a id="40f46130ae82a0c0" href="../../R/40f46130ae82a0c0.html" target="n" data-glyph="76,1" class="i method">GenerateHelperFunctionsClientSideParameters</a>(<span class="i">TextWriter</span> <span id="r279 rd" class="r279 r">writer</span>)
        {
            <b>if</b> (<span class="r279 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r279 r">writer</span>));
            }
 
            <span class="r279 r">writer</span>.<span class="i">Write</span>(<a href="#729b5b7086ed99de" class="i field">HelperFunctionsModifyParameters</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>private void</b> <a id="7a1db4b1463a21cb" href="../../R/7a1db4b1463a21cb.html" target="n" data-glyph="76,1" class="i method">GenerateHelperFunctions</a>(<span class="i">TextWriter</span> <span id="r280 rd" class="r280 r">writer</span>)
        {
            <a href="#4f1f630d87b21f95" class="i method">GenerateSectionSeparator</a>(<span class="r280 r">writer</span>);
            <a href="#d883ec975132b20d" class="i method">GenerateHelperFunctionsWriteMessage</a>(<span class="r280 r">writer</span>);
            <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#505b456c80a80dbc" class="i method">GenerateHelperFunctionsGetSessionOption</a>(<span class="r280 r">writer</span>);
            <a href="#16b8449748809954" class="i method">GenerateHelperFunctionsSetImplicitRunspace</a>(<span class="r280 r">writer</span>);
            <a href="#7d6c598f11254b64" class="k">this</a>.<a href="#bbd3ca48bb883374" class="i method">GenerateHelperFunctionsGetImplicitRunspace</a>(<span class="r280 r">writer</span>);
            <a href="#40f46130ae82a0c0" class="i method">GenerateHelperFunctionsClientSideParameters</a>(<span class="r280 r">writer</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating proxy commands
 
        <span class="c">// index 0 - name of the command escaped for inclusion inside a single-quoted string</span>
        <span class="c">// index 1 - name of the command escaped for help comment</span>
        <span class="c">// index 2 - not used</span>
        <span class="c">// index 3 - param declaration</span>
        <span class="c">// index 4 - not used</span>
        <span class="c">// index 5 - remote help category</span>
        <span class="c">// index 6 - process block</span>
        <span class="c">// index 7 - end block</span>
        <span class="c">// index 8 - whether or not this is a proxy for a cmdlet-bound command (i.e. should common parameters get special handling)</span>
        <b>private const string</b> <a id="55949156536e72a7" href="../../R/55949156536e72a7.html" target="n" data-glyph="10,1" class="i field">CommandProxyTemplate</a> = <span class="s">@&quot;
&amp; $script:SetItem &#39;function:script:{0}&#39; `
{{
    param(
    {3})
 
    Begin {{
        try {{
            $positionalArguments = &amp; $script:NewObject collections.arraylist
            foreach ($parameterName in $PSBoundParameters.BoundPositionally)
            {{
                $null = $positionalArguments.Add( $PSBoundParameters[$parameterName] )
                $null = $PSBoundParameters.Remove($parameterName)
            }}
 
            $positionalArguments.AddRange($args)
 
            $clientSideParameters = Get-PSImplicitRemotingClientSideParameters $PSBoundParameters ${8}
 
            $scriptCmd = {{ &amp; $script:InvokeCommand `
                            @clientSideParameters `
                            -HideComputerName `
                            -Session (Get-PSImplicitRemotingSession -CommandName &#39;{0}&#39;) `
                            -Arg (&#39;{0}&#39;, $PSBoundParameters, $positionalArguments) `
                            -Script {{ param($name, $boundParams, $unboundParams) &amp; $name @boundParams @unboundParams }} `
                         }}
 
            $steppablePipeline = $scriptCmd.GetSteppablePipeline($myInvocation.CommandOrigin)
            $steppablePipeline.Begin($myInvocation.ExpectingInput, $ExecutionContext)
        }} catch {{
            throw
        }}
    }}
 
    Process {{ {6} }}
 
    End {{ {7} }}
 
    # .ForwardHelpTargetName {1}
    # .ForwardHelpCategory {5}
    # .RemoteHelpRunspace PSSession
}}
        &quot;</span>;
 
        <b>private static void</b> <a id="306564f4a3692777" href="../../R/306564f4a3692777.html" target="n" data-glyph="76,1" class="i method">GenerateCommandProxy</a>(<span class="i">TextWriter</span> <span id="r281 rd" class="r281 r">writer</span>, <a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a> <span id="r282 rd" class="r282 r">commandMetadata</span>)
        {
            <b>if</b> (<span class="r281 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r281 r">writer</span>));
            }
 
            <b>string</b> <span id="r283 rd" class="r283 r">functionNameForString</span> = <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r282 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>);
            <b>string</b> <span id="r284 rd" class="r284 r">functionNameForHelp</span> = <a href="#d36daa73f52fcfdb" class="i method">EscapeFunctionNameForRemoteHelp</a>(<span class="r282 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>);
            <span class="r281 r">writer</span>.<span class="i">Write</span>(
                <a href="#55949156536e72a7" class="i field">CommandProxyTemplate</a>,
                <span class="c">/* 0 */</span> <span class="r283 r">functionNameForString</span>,
                <span class="c">/* 1 */</span> <span class="r284 r">functionNameForHelp</span>,
                <span class="c">/* 2 */</span> <span class="r282 r">commandMetadata</span>.<span class="i">GetDecl</span>(),
                <span class="c">/* 3 */</span> <span class="r282 r">commandMetadata</span>.<span class="i">GetParamBlock</span>(),
                <span class="c">/* 4 */</span> <b>null</b> <span class="c">/* not used */</span>,
                <span class="c">/* 5 */</span> <span class="r282 r">commandMetadata</span>.<span class="i">WrappedCommandType</span>,
                <span class="c">/* 6 */</span> <a href="/System.Management.Automation/A.html#d53207f43e14c0fe" class="t t">ProxyCommand</a>.<span class="i">GetProcess</span>(<span class="r282 r">commandMetadata</span>),
                <span class="c">/* 7 */</span> <a href="/System.Management.Automation/A.html#d53207f43e14c0fe" class="t t">ProxyCommand</a>.<span class="i">GetEnd</span>(<span class="r282 r">commandMetadata</span>),
                <span class="c">/* 8 */</span> <span class="r282 r">commandMetadata</span>.<span class="i">WrappedAnyCmdlet</span>);
        }
 
        <b>private static void</b> <a id="d5a5fb6fae3cc185" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GenerateCommandProxy</a>(<span class="i">TextWriter</span> <span id="r285 rd" class="r285 r">writer</span>, <span class="i">IEnumerable</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r286 rd" class="r286 r">listOfCommandMetadata</span>)
        {
            <b>if</b> (<span class="r285 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r285 r">writer</span>));
            }
 
            <b>if</b> (<span class="r286 r">listOfCommandMetadata</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r286 r">listOfCommandMetadata</span>));
            }
 
            <a href="#4f1f630d87b21f95" class="i method">GenerateSectionSeparator</a>(<span class="r285 r">writer</span>);
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a> <span id="r287 rd" class="r287 r">commandMetadata</span> <b>in</b> <span class="r286 r">listOfCommandMetadata</span>)
            {
                <a href="#306564f4a3692777" class="i method">GenerateCommandProxy</a>(<span class="r285 r">writer</span>, <span class="r287 r">commandMetadata</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating export declaration of a proxy module
 
        <b>private const string</b> <a id="132f77ac15554bf7" href="../../R/132f77ac15554bf7.html" target="n" data-glyph="10,1" class="i field">ExportFunctionsTemplate</a> = <span class="s">@&quot;
&amp; $script:ExportModuleMember -Function {0}
        &quot;</span>;
 
        <b>private static void</b> <a id="6c9bc88684878200" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GenerateExportDeclaration</a>(<span class="i">TextWriter</span> <span id="r288 rd" class="r288 r">writer</span>, <span class="i">IEnumerable</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r289 rd" class="r289 r">listOfCommandMetadata</span>)
        {
            <b>if</b> (<span class="r288 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r288 r">writer</span>));
            }
 
            <b>if</b> (<span class="r289 r">listOfCommandMetadata</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r289 r">listOfCommandMetadata</span>));
            }
 
            <a href="#4f1f630d87b21f95" class="i method">GenerateSectionSeparator</a>(<span class="r288 r">writer</span>);
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r290 rd" class="r290 r">listOfCommandNames</span> = <a href="#9ea51cd9fc261f37" class="i method">GetListOfCommandNames</a>(<span class="r289 r">listOfCommandMetadata</span>);
            <b>string</b> <span id="r291 rd" class="r291 r">exportString</span> = <span class="i">GenerateArrayString</span>(<span class="r290 r">listOfCommandNames</span>);
            <span class="r288 r">writer</span>.<span class="i">Write</span>(<a href="#132f77ac15554bf7" class="i field">ExportFunctionsTemplate</a>, <span class="r291 r">exportString</span>);
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="9ea51cd9fc261f37" href="../../R/9ea51cd9fc261f37.html" target="n" data-glyph="76,1" class="i method">GetListOfCommandNames</a>(<span class="i">IEnumerable</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r292 rd" class="r292 r">listOfCommandMetadata</span>)
        {
            <b>if</b> (<span class="r292 r">listOfCommandMetadata</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r292 r">listOfCommandMetadata</span>));
            }
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r293 rd" class="r293 r">listOfCommandNames</span> = <b>new</b>();
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a> <span id="r294 rd" class="r294 r">commandMetadata</span> <b>in</b> <span class="r292 r">listOfCommandMetadata</span>)
            {
                <span class="r293 r">listOfCommandNames</span>.<span class="i">Add</span>(<span class="r294 r">commandMetadata</span>.<a href="/System.Management.Automation/A.html#8d0d4ac251b21d59" class="i property">Name</a>);
            }
 
            <b>return</b> <span class="r293 r">listOfCommandNames</span>;
        }
 
        <b>private static string</b> <a id="aee36c6a218f3a9e" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GenerateArrayString</a>(<span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r295 rd" class="r295 r">listOfStrings</span>)
        {
            <b>if</b> (<span class="r295 r">listOfStrings</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r295 r">listOfStrings</span>));
            }
 
            <span class="i">StringBuilder</span> <span id="r296 rd" class="r296 r">arrayString</span> = <b>new</b>();
            <b>foreach</b> (<b>string</b> <span id="r297 rd" class="r297 r">s</span> <b>in</b> <span class="r295 r">listOfStrings</span>)
            {
                <b>if</b> (<span class="r296 r">arrayString</span>.<span class="i">Length</span> != 0)
                {
                    <span class="r296 r">arrayString</span>.<span class="i">Append</span>(<span class="s">&quot;, &quot;</span>);
                }
 
                <span class="r296 r">arrayString</span>.<span class="i">Append</span>(<span class="s">&#39;\&#39;&#39;</span>);
                <span class="r296 r">arrayString</span>.<span class="i">Append</span>(<a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r297 r">s</span>));
                <span class="r296 r">arrayString</span>.<span class="i">Append</span>(<span class="s">&#39;\&#39;&#39;</span>);
            }
 
            <span class="r296 r">arrayString</span>.<span class="i">Insert</span>(0, <span class="s">&quot;@(&quot;</span>);
            <span class="r296 r">arrayString</span>.<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
 
            <b>return</b> <span class="r296 r">arrayString</span>.<span class="i">ToString</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating aliases
 
        <b>private const string</b> <a id="f0e5830ccab7e1a7" href="../../R/f0e5830ccab7e1a7.html" target="n" data-glyph="10,1" class="i field">SetAliasTemplate</a> = <span class="s">@&quot;
&amp; $script:SetAlias -Name &#39;{0}&#39; -Value &#39;{1}&#39; -Force -Scope script
        &quot;</span>;
 
        <b>private const string</b> <a id="77899d7fe927b91a" href="../../R/77899d7fe927b91a.html" target="n" data-glyph="10,1" class="i field">ExportAliasesTemplate</a> = <span class="s">@&quot;
&amp; $script:ExportModuleMember -Alias {0}
        &quot;</span>;
 
        <b>private static void</b> <a id="e0693798941f6250" href="../../R/e0693798941f6250.html" target="n" data-glyph="76,1" class="i method">GenerateAliases</a>(<span class="i">TextWriter</span> <span id="r298 rd" class="r298 r">writer</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r299 rd" class="r299 r">alias2resolvedCommandName</span>)
        {
            <a href="#4f1f630d87b21f95" class="i method">GenerateSectionSeparator</a>(<span class="r298 r">writer</span>);
 
            <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r300 rd" class="r300 r">pair</span> <b>in</b> <span class="r299 r">alias2resolvedCommandName</span>)
            {
                <b>string</b> <span id="r301 rd" class="r301 r">aliasName</span> = <span class="r300 r">pair</span>.<span class="i">Key</span>;
                <b>string</b> <span id="r302 rd" class="r302 r">resolvedCommandName</span> = <span class="r300 r">pair</span>.<span class="i">Value</span>;
 
                <span class="r298 r">writer</span>.<span class="i">Write</span>(
                    <a href="#f0e5830ccab7e1a7" class="i field">SetAliasTemplate</a>,
                    <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r301 r">aliasName</span>),
                    <a href="/System.Management.Automation/A.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<span class="i">EscapeSingleQuotedStringContent</span>(<span class="r302 r">resolvedCommandName</span>));
            }
 
            <b>string</b> <span id="r303 rd" class="r303 r">exportString</span> = <span class="i">GenerateArrayString</span>(<span class="r299 r">alias2resolvedCommandName</span>.<span class="i">Keys</span>);
            <span class="r298 r">writer</span>.<span class="i">Write</span>(<a href="#77899d7fe927b91a" class="i field">ExportAliasesTemplate</a>, <span class="r303 r">exportString</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generating format.ps1xml file
 
        <b>private static void</b> <a id="7fa314d4474a79d1" href="../../R/7fa314d4474a79d1.html" target="n" data-glyph="76,1" class="i method">GenerateFormatFile</a>(<span class="i">TextWriter</span> <span id="r304 rd" class="r304 r">writer</span>, <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <span id="r305 rd" class="r305 r">listOfFormatData</span>)
        {
            <b>if</b> (<span class="r304 r">writer</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r304 r">writer</span>));
            }
 
            <b>if</b> (<span class="r305 r">listOfFormatData</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r305 r">listOfFormatData</span>));
            }
 
            <span class="i">XmlWriterSettings</span> <span id="r306 rd" class="r306 r">settings</span> = <b>new</b>();
            <span class="r306 r">settings</span>.<span class="i">CloseOutput</span> = <b>false</b>;
            <span class="r306 r">settings</span>.<span class="i">ConformanceLevel</span> = <span class="i">ConformanceLevel</span>.<span class="i">Document</span>;
            <span class="r306 r">settings</span>.<span class="i">Encoding</span> = <span class="r304 r">writer</span>.<span class="i">Encoding</span>;
            <span class="r306 r">settings</span>.<span class="i">Indent</span> = <b>true</b>;
            <b>using</b> (<span class="i">XmlWriter</span> <span id="r307 rd" class="r307 r">xmlWriter</span> = <span class="i">XmlWriter</span>.<span class="i">Create</span>(<span class="r304 r">writer</span>, <span class="r306 r">settings</span>))
            {
                <span class="i">FormatXmlWriter</span>.<span class="i">WriteToXml</span>(<span class="r307 r">xmlWriter</span>, <span class="r305 r">listOfFormatData</span>, <b>false</b>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates a proxy module in the given directory.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r308 r">moduleRootDirectory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Base directory for the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r309 r">fileNamePrefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Filename prefix for module files.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r310 r">encoding</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Encoding of generated files.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r311 r">force</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether to overwrite files.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r312 r">listOfCommandMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote commands to generate proxies for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r313 r">alias2resolvedCommandName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Dictionary mapping alias names to resolved command names.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r314 r">listOfFormatData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote format data to generate format.ps1xml for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r315 r">certificate</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Certificate with which to sign the format files.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Path to the created files.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="1d8be60aa4fcf654" href="../../R/1d8be60aa4fcf654.html" target="n" data-glyph="74,1" class="i method">GenerateProxyModule</a>(
            <span class="i">DirectoryInfo</span> <span id="r308 rd" class="r308 r">moduleRootDirectory</span>,
            <b>string</b> <span id="r309 rd" class="r309 r">fileNamePrefix</span>,
            <span class="i">Encoding</span> <span id="r310 rd" class="r310 r">encoding</span>,
            <b>bool</b> <span id="r311 rd" class="r311 r">force</span>,
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt; <span id="r312 rd" class="r312 r">listOfCommandMetadata</span>,
            <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r313 rd" class="r313 r">alias2resolvedCommandName</span>,
            <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt; <span id="r314 rd" class="r314 r">listOfFormatData</span>,
            <span class="i">X509Certificate2</span> <span id="r315 rd" class="r315 r">certificate</span>)
        {
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r316 rd" class="r316 r">result</span> = <b>new</b>();
 
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r308 r">moduleRootDirectory</span> != <b>null</b>, <span class="s">&quot;Caller should validate moduleRootDirectory != null&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r308 r">moduleRootDirectory</span>.<span class="i">FullName</span>), <span class="s">&quot;Caller should validate moduleRootDirectory exists&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r310 r">encoding</span> != <b>null</b>, <span class="s">&quot;Caller should validate encoding != null&quot;</span>);
 
            <b>string</b> <span id="r317 rd" class="r317 r">baseName</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r308 r">moduleRootDirectory</span>.<span class="i">FullName</span>, <span class="r309 r">fileNamePrefix</span>);
            <span class="i">FileMode</span> <span id="r318 rd" class="r318 r">fileMode</span> = <span class="r311 r">force</span> ? <span class="i">FileMode</span>.<span class="i">OpenOrCreate</span> : <span class="i">FileMode</span>.<span class="i">CreateNew</span>;
 
            <span class="r316 r">result</span>.<span class="i">Add</span>(<span class="r317 r">baseName</span> + <span class="s">&quot;.psm1&quot;</span>);
            <span class="i">FileStream</span> <span id="r319 rd" class="r319 r">psm1</span> = <b>new</b>(
                <span class="r317 r">baseName</span> + <span class="s">&quot;.psm1&quot;</span>,
                <span class="r318 r">fileMode</span>,
                <span class="i">FileAccess</span>.<span class="i">Write</span>,
                <span class="i">FileShare</span>.<span class="i">None</span>);
            <b>using</b> (<span class="i">TextWriter</span> <span id="r320 rd" class="r320 r">writer</span> = <b>new</b> <span class="i">StreamWriter</span>(<span class="r319 r">psm1</span>, <span class="r310 r">encoding</span>))
            {
                <b>if</b> (<span class="r312 r">listOfCommandMetadata</span> == <b>null</b>)
                {
                    <span class="r312 r">listOfCommandMetadata</span> = <b>new</b> <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#543f906b9137ce10" class="t t">CommandMetadata</a>&gt;();
                }
 
                <a href="#cdcb2685b13208f1" class="i method">GenerateModuleHeader</a>(<span class="r320 r">writer</span>);
                <a href="#7a1db4b1463a21cb" class="i method">GenerateHelperFunctions</a>(<span class="r320 r">writer</span>);
                <span class="i">GenerateCommandProxy</span>(<span class="r320 r">writer</span>, <span class="r312 r">listOfCommandMetadata</span>);
                <span class="i">GenerateExportDeclaration</span>(<span class="r320 r">writer</span>, <span class="r312 r">listOfCommandMetadata</span>);
                <a href="#e0693798941f6250" class="i method">GenerateAliases</a>(<span class="r320 r">writer</span>, <span class="r313 r">alias2resolvedCommandName</span>);
                <span class="r319 r">psm1</span>.<span class="i">SetLength</span>(<span class="r319 r">psm1</span>.<span class="i">Position</span>);
            }
 
            <span class="r316 r">result</span>.<span class="i">Add</span>(<span class="r317 r">baseName</span> + <span class="s">&quot;.format.ps1xml&quot;</span>);
            <span class="i">FileStream</span> <span id="r321 rd" class="r321 r">formatPs1xml</span> = <b>new</b>(
                <span class="r317 r">baseName</span> + <span class="s">&quot;.format.ps1xml&quot;</span>,
                <span class="r318 r">fileMode</span>,
                <span class="i">FileAccess</span>.<span class="i">Write</span>,
                <span class="i">FileShare</span>.<span class="i">None</span>);
            <b>using</b> (<span class="i">TextWriter</span> <span id="r322 rd" class="r322 r">writer</span> = <b>new</b> <span class="i">StreamWriter</span>(<span class="r321 r">formatPs1xml</span>, <span class="r310 r">encoding</span>))
            {
                <b>if</b> (<span class="r314 r">listOfFormatData</span> == <b>null</b>)
                {
                    <span class="r314 r">listOfFormatData</span> = <b>new</b> <span class="i">List</span>&lt;<a href="/System.Management.Automation/A.html#f507ec3cc270989a" class="t t">ExtendedTypeDefinition</a>&gt;();
                }
 
                <a href="#7fa314d4474a79d1" class="i method">GenerateFormatFile</a>(<span class="r322 r">writer</span>, <span class="r314 r">listOfFormatData</span>);
                <span class="r321 r">formatPs1xml</span>.<span class="i">SetLength</span>(<span class="r321 r">formatPs1xml</span>.<span class="i">Position</span>);
            }
            <span class="c">// Sign psm1 file and format file</span>
            <span class="c">// If certificate is passed, sign the file</span>
            <span class="c">// If certificate is not passed and executionPolicy is set to Restricted/AllSigned, output error</span>
            <span class="c">// Since we will anyway be erroring out during Import-Module, it is better to fail fast</span>
            <a href="/System.Management.Automation/A.html#73c2048fc177fabf" class="t t">ExecutionPolicy</a> <span id="r323 rd" class="r323 r">executionPolicy</span> = <a href="/System.Management.Automation/A.html#5c234bd2337db61c" class="t t">SecuritySupport</a>.<span class="i">GetExecutionPolicy</span>(<span class="i">Utils</span>.<span class="i">DefaultPowerShellShellID</span>);
            <b>if</b> (<span class="r323 r">executionPolicy</span> == <a href="/System.Management.Automation/A.html#73c2048fc177fabf" class="t t">ExecutionPolicy</a>.<a href="/System.Management.Automation/A.html#650065d32fb5aa16" class="i field">Restricted</a> || <span class="r323 r">executionPolicy</span> == <a href="/System.Management.Automation/A.html#73c2048fc177fabf" class="t t">ExecutionPolicy</a>.<a href="/System.Management.Automation/A.html#db1b3edc38853c2e" class="i field">AllSigned</a>)
            {
                <b>if</b> (<span class="r315 r">certificate</span> == <b>null</b>)
                {
                    <b>string</b> <span id="r324 rd" class="r324 r">message</span> = <span class="i">ImplicitRemotingStrings</span>.<span class="i">CertificateNeeded</span>;
                    <b>throw</b> <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="r324 r">message</span>);
                }
                <b>else</b>
                {
                    <b>string</b> <span id="r325 rd" class="r325 r">currentFile</span> = <span class="r317 r">baseName</span> + <span class="s">&quot;.psm1&quot;</span>;
                    <b>try</b>
                    {
                        <span class="i">SignatureHelper</span>.<span class="i">SignFile</span>(<a href="/System.Management.Automation/A.html#1cbd6367fe8ec186" class="t t">SigningOption</a>.<a href="/System.Management.Automation/A.html#df42383a5e5bbe98" class="i field">Default</a>, <span class="r325 r">currentFile</span>, <span class="r315 r">certificate</span>, <b>string</b>.<span class="i">Empty</span>, <b>null</b>);
                        <span class="r325 r">currentFile</span> = <span class="r317 r">baseName</span> + <span class="s">&quot;.format.ps1xml&quot;</span>;
                        <span class="i">SignatureHelper</span>.<span class="i">SignFile</span>(<a href="/System.Management.Automation/A.html#1cbd6367fe8ec186" class="t t">SigningOption</a>.<a href="/System.Management.Automation/A.html#df42383a5e5bbe98" class="i field">Default</a>, <span class="r325 r">currentFile</span>, <span class="r315 r">certificate</span>, <b>string</b>.<span class="i">Empty</span>, <b>null</b>);
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r326 rd" class="r326 r">e</span>)
                    {
                        <b>string</b> <span id="r327 rd" class="r327 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ImplicitRemotingStrings</span>.<span class="i">InvalidSigningOperation</span>, <span class="r325 r">currentFile</span>);
                        <b>throw</b> <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="r327 r">message</span>, <span class="r326 r">e</span>);
                    }
                }
            }
 
            <span class="r316 r">result</span>.<span class="i">Add</span>(<span class="r317 r">baseName</span> + <span class="s">&quot;.psd1&quot;</span>);
            <span class="i">FileInfo</span> <span id="r328 rd" class="r328 r">manifestFile</span> = <b>new</b>(<span class="r317 r">baseName</span> + <span class="s">&quot;.psd1&quot;</span>);
            <span class="i">FileStream</span> <span id="r329 rd" class="r329 r">psd1</span> = <b>new</b>(
                <span class="r328 r">manifestFile</span>.<span class="i">FullName</span>,
                <span class="r318 r">fileMode</span>,
                <span class="i">FileAccess</span>.<span class="i">Write</span>,
                <span class="i">FileShare</span>.<span class="i">None</span>);
            <b>using</b> (<span class="i">TextWriter</span> <span id="r330 rd" class="r330 r">writer</span> = <b>new</b> <span class="i">StreamWriter</span>(<span class="r329 r">psd1</span>, <span class="r310 r">encoding</span>))
            {
                <span class="i">GenerateManifest</span>(<span class="r330 r">writer</span>, <span class="r317 r">baseName</span> + <span class="s">&quot;.psm1&quot;</span>, <span class="r317 r">baseName</span> + <span class="s">&quot;.format.ps1xml&quot;</span>);
                <span class="r329 r">psd1</span>.<span class="i">SetLength</span>(<span class="r329 r">psd1</span>.<span class="i">Position</span>);
            }
 
            <a href="/System.Management.Automation/A.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a> <span id="r331 rd" class="r331 r">applicationArguments</span> = <a href="#dbcad0421b9afd8b" class="i method">GetApplicationArguments</a>();
            <b>if</b> (<span class="r331 r">applicationArguments</span> != <b>null</b>)
            {
                <b>string</b> <span id="r332 rd" class="r332 r">applicationArgumentsFile</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r308 r">moduleRootDirectory</span>.<span class="i">FullName</span>, <span class="s">&quot;ApplicationArguments.xml&quot;</span>);
                <span class="r316 r">result</span>.<span class="i">Add</span>(<span class="r332 r">applicationArgumentsFile</span>);
 
                <b>using</b> (<b>var</b> <span id="r333 rd" class="r333 r">stream</span> = <b>new</b> <span class="i">FileStream</span>(<span class="r332 r">applicationArgumentsFile</span>, <span class="i">FileMode</span>.<span class="i">Create</span>, <span class="i">FileAccess</span>.<span class="i">Write</span>, <span class="i">FileShare</span>.<span class="i">Read</span>))
                <b>using</b> (<b>var</b> <span id="r334 rd" class="r334 r">xmlWriter</span> = <span class="i">XmlWriter</span>.<span class="i">Create</span>(<span class="r333 r">stream</span>))
                {
                    <span class="i">Serializer</span> <span id="r335 rd" class="r335 r">serializer</span> = <b>new</b>(<span class="r334 r">xmlWriter</span>);
                    <span class="r335 r">serializer</span>.<span class="i">Serialize</span>(<span class="r331 r">applicationArguments</span>);
                    <span class="r335 r">serializer</span>.<span class="i">Done</span>();
                }
            }
 
            <b>return</b> <span class="r316 r">result</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
