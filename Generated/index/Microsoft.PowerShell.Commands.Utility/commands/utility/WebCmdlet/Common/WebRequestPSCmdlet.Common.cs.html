<!DOCTYPE html>
<html><head><title>WebRequestPSCmdlet.Common.cs</title><link rel="stylesheet" href="../../../../../styles.css"><script src="../../../../../scripts.js"></script></head>
<body class="cB" onload="i(1964);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility/commands/utility/WebCmdlet/Common/WebRequestPSCmdlet.Common.cs" target="_top">commands\utility\WebCmdlet\Common\WebRequestPSCmdlet.Common.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Utility" target="_top">src\Microsoft.PowerShell.Commands.Utility\Microsoft.PowerShell.Commands.Utility.csproj</a> (Microsoft.PowerShell.Commands.Utility)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Net</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Net</span>.<span class="i">Http</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Net</span>.<span class="i">Http</span>.<span class="i">Headers</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Authentication</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Cryptography</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Cryptography</span>.<span class="i">X509Certificates</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The valid values for the -Authentication parameter for Invoke-RestMethod and Invoke-WebRequest.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="a7ed4703e976eb2d" href="../../../../R/a7ed4703e976eb2d.html" target="n" data-glyph="18,0" class="t t"><span id="3c66b7470063ae6e">WebAuthenticationType</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No authentication. Default.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="ec821ad87e8c3be5" href="../../../../R/ec821ad87e8c3be5.html" target="n" data-glyph="24,1" class="i field">None</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RFC-7617 Basic Authentication. Requires -Credential.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="ee1db936cac29719" href="../../../../R/ee1db936cac29719.html" target="n" data-glyph="24,1" class="i field">Basic</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RFC-6750 OAuth 2.0 Bearer Authentication. Requires -Token.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="3235aead8e846942" href="../../../../R/3235aead8e846942.html" target="n" data-glyph="24,1" class="i field">Bearer</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RFC-6750 OAuth 2.0 Bearer Authentication. Requires -Token.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="b09cda7a7ae2ae6e" href="../../../../R/b09cda7a7ae2ae6e.html" target="n" data-glyph="24,1" class="i field">OAuth</a>,
    }
 
    <span class="c">// WebSslProtocol is used because not all SslProtocols are supported by HttpClientHandler.</span>
    <span class="c">// Also SslProtocols.Default is not the &quot;default&quot; for HttpClientHandler as SslProtocols.Ssl3 is not supported.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The valid values for the -SslProtocol parameter for Invoke-RestMethod and Invoke-WebRequest.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Flags</span>]
    <b>public enum</b> <a id="f2d012967411a823" href="../../../../R/f2d012967411a823.html" target="n" data-glyph="18,0" class="t t"><span id="48d8992b54588c66">WebSslProtocol</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No SSL protocol will be set and the system defaults will be used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="c6b6eb918eaa5189" href="../../../../R/c6b6eb918eaa5189.html" target="n" data-glyph="24,1" class="i field">Default</a> = 0,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies the TLS 1.0 security protocol. The TLS protocol is defined in IETF RFC 2246.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="8bbcf38f119f242b" href="../../../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">Tls</a> = <span class="i">SslProtocols</span>.<span class="i">Tls</span>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies the TLS 1.1 security protocol. The TLS protocol is defined in IETF RFC 4346.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="9df9012f6d4018e1" href="../../../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">Tls11</a> = <span class="i">SslProtocols</span>.<span class="i">Tls11</span>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies the TLS 1.2 security protocol. The TLS protocol is defined in IETF RFC 5246.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="01cae259229be283" href="../../../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">Tls12</a> = <span class="i">SslProtocols</span>.<span class="i">Tls12</span>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies the TLS 1.3 security protocol. The TLS protocol is defined in IETF RFC 8446.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="f61a4620ecef662a" href="../../../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">Tls13</a> = <span class="i">SslProtocols</span>.<span class="i">Tls13</span>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Base class for Invoke-RestMethod and Invoke-WebRequest commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public abstract</b> <a href="../../../../P/662e7ae18a2eef77.html" target="s" class="k">partial</a> <b>class</b> <a id="662e7ae18a2eef77" href="../../../../R/662e7ae18a2eef77.html" target="n" data-glyph="0,0" class="t t"><span id="b1cd30342def4679">WebRequestPSCmdlet</span></a> : <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Virtual Properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> URI
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deprecated. Gets or sets UseBasicParsing. This has no affect on the operation of the Cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#aece56bfac51ced8" class="i property">DontShow</a> = <b>true</b>)]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="ac930a5bc87a0152" href="../../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">UseBasicParsing</a> { <b>get</b>; <b>set</b>; } = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Uri property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public virtual</b> <span class="i">Uri</span> <a id="34135773a270f628" href="../../../../R/34135773a270f628.html" target="n" data-glyph="102,1" class="i property">Uri</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Session
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Session property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="../WebRequestSession.cs.html#3704b0f731c08b06" class="t t">WebRequestSession</a> <a id="90d74702f865f3cb" href="../../../../R/90d74702f865f3cb.html" target="n" data-glyph="102,1" class="i property">WebSession</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the SessionVariable property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;SV&quot;</span>)]
        <b>public virtual string</b> <a id="df5235785002cc5a" href="../../../../R/df5235785002cc5a.html" target="n" data-glyph="102,1" class="i property">SessionVariable</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Authorization and Credentials
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the AllowUnencryptedAuthentication property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="56eebdf9fccddba2" href="../../../../R/56eebdf9fccddba2.html" target="n" data-glyph="102,1" class="i property">AllowUnencryptedAuthentication</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Authentication property used to determine the Authentication method for the web session.</span>
        <span class="c">///</span><span class="c"> Authentication does not work with UseDefaultCredentials.</span>
        <span class="c">///</span><span class="c"> Authentication over unencrypted sessions requires AllowUnencryptedAuthentication.</span>
        <span class="c">///</span><span class="c"> Basic: Requires Credential.</span>
        <span class="c">///</span><span class="c"> OAuth/Bearer: Requires Token.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a> <a id="dee98b2df2a3224d" href="../../../../R/dee98b2df2a3224d.html" target="n" data-glyph="102,1" class="i property">Authentication</a> { <b>get</b>; <b>set</b>; } = <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ec821ad87e8c3be5" class="i field">None</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Credential property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Credential</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a> <a id="cdea11c98869d42b" href="../../../../R/cdea11c98869d42b.html" target="n" data-glyph="102,1" class="i property">Credential</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the UseDefaultCredentials property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="cabc2fd09a41fa7e" href="../../../../R/cabc2fd09a41fa7e.html" target="n" data-glyph="102,1" class="i property">UseDefaultCredentials</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the CertificateThumbprint property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public virtual string</b> <a id="099a766c8c2c47ad" href="../../../../R/099a766c8c2c47ad.html" target="n" data-glyph="102,1" class="i property">CertificateThumbprint</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Certificate property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNull</span>]
        <b>public virtual</b> <span class="i">X509Certificate</span> <a id="fcfae8b3212d0da7" href="../../../../R/fcfae8b3212d0da7.html" target="n" data-glyph="102,1" class="i property">Certificate</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the SkipCertificateCheck property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="cc4b5a872f8fbd0d" href="../../../../R/cc4b5a872f8fbd0d.html" target="n" data-glyph="102,1" class="i property">SkipCertificateCheck</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the TLS/SSL protocol used by the Web Cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="#f2d012967411a823" class="t t">WebSslProtocol</a> <a id="afd0d096dfee9baa" href="../../../../R/afd0d096dfee9baa.html" target="n" data-glyph="102,1" class="i property">SslProtocol</a> { <b>get</b>; <b>set</b>; } = <a href="#f2d012967411a823" class="t t">WebSslProtocol</a>.<a href="#c6b6eb918eaa5189" class="i field">Default</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Token property. Token is required by Authentication OAuth and Bearer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <span class="i">SecureString</span> <a id="92dc548ce9a83f68" href="../../../../R/92dc548ce9a83f68.html" target="n" data-glyph="102,1" class="i property">Token</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Headers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the UserAgent property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual string</b> <a id="e4893011e3eea470" href="../../../../R/e4893011e3eea470.html" target="n" data-glyph="102,1" class="i property">UserAgent</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the DisableKeepAlive property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="d6a2973a23f2ee19" href="../../../../R/d6a2973a23f2ee19.html" target="n" data-glyph="102,1" class="i property">DisableKeepAlive</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the TimeOut property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateRange</span>(0, <b>int</b>.<span class="i">MaxValue</span>)]
        <b>public virtual int</b> <a id="1e179e1f5addad1a" href="../../../../R/1e179e1f5addad1a.html" target="n" data-glyph="102,1" class="i property">TimeoutSec</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Headers property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i n">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>)]
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <span class="i">IDictionary</span> <a id="02461f0adc34eacc" href="../../../../R/02461f0adc34eacc.html" target="n" data-glyph="102,1" class="i property">Headers</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Redirect
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the RedirectMax property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateRange</span>(0, <b>int</b>.<span class="i">MaxValue</span>)]
        <b>public virtual int</b> <a id="85083b06aeada2de" href="../../../../R/85083b06aeada2de.html" target="n" data-glyph="102,1" class="i property">MaximumRedirection</a>
        {
            <b>get</b> { <b>return</b> <a href="#f862595a43787ca0" class="i field">_maximumRedirection</a>; }
 
            <b>set</b> { <a href="#f862595a43787ca0" class="i field">_maximumRedirection</a> = <b>value</b>; }
        }
 
        <b>private int</b> <a id="f862595a43787ca0" href="../../../../R/f862595a43787ca0.html" target="n" data-glyph="46,1" class="i field">_maximumRedirection</a> = -1;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the MaximumRetryCount property, which determines the number of retries of a failed web request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateRange</span>(0, <b>int</b>.<span class="i">MaxValue</span>)]
        <b>public virtual int</b> <a id="72ac66e03a1e484c" href="../../../../R/72ac66e03a1e484c.html" target="n" data-glyph="102,1" class="i property">MaximumRetryCount</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the RetryIntervalSec property, which determines the number seconds between retries.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateRange</span>(1, <b>int</b>.<span class="i">MaxValue</span>)]
        <b>public virtual int</b> <a id="4b390d8f440c1ad8" href="../../../../R/4b390d8f440c1ad8.html" target="n" data-glyph="102,1" class="i property">RetryIntervalSec</a> { <b>get</b>; <b>set</b>; } = 5;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Method
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Method property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;StandardMethod&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;StandardMethodNoProxy&quot;</span>)]
        <b>public virtual</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a> <a id="74e585d369a3c020" href="../../../../R/74e585d369a3c020.html" target="n" data-glyph="102,1" class="i property">Method</a>
        {
            <b>get</b> { <b>return</b> <a href="#3848bda5ca592bdf" class="i field">_method</a>; }
 
            <b>set</b> { <a href="#3848bda5ca592bdf" class="i field">_method</a> = <b>value</b>; }
        }
 
        <b>private</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a> <a id="3848bda5ca592bdf" href="../../../../R/3848bda5ca592bdf.html" target="n" data-glyph="46,1" class="i field">_method</a> = <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#0c73f4381971ee73" class="i field">Default</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the CustomMethod property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;CustomMethod&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;CustomMethodNoProxy&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;CM&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public virtual string</b> <a id="379786a8f95d3483" href="../../../../R/379786a8f95d3483.html" target="n" data-glyph="102,1" class="i property">CustomMethod</a>
        {
            <b>get</b> { <b>return</b> <a href="#3449b06cc41d1511" class="i field">_customMethod</a>; }
 
            <b>set</b> { <a href="#3449b06cc41d1511" class="i field">_customMethod</a> = <b>value</b>; }
        }
 
        <b>private string</b> <a id="3449b06cc41d1511" href="../../../../R/3449b06cc41d1511.html" target="n" data-glyph="46,1" class="i field">_customMethod</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> NoProxy
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the NoProxy property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;CustomMethodNoProxy&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;StandardMethodNoProxy&quot;</span>)]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="5e6d57bcb0168ab9" href="../../../../R/5e6d57bcb0168ab9.html" target="n" data-glyph="102,1" class="i property">NoProxy</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Proxy
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Proxy property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;StandardMethod&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;CustomMethod&quot;</span>)]
        <b>public virtual</b> <span class="i">Uri</span> <a id="bd0c681285dbf3e5" href="../../../../R/bd0c681285dbf3e5.html" target="n" data-glyph="102,1" class="i property">Proxy</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the ProxyCredential property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;StandardMethod&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;CustomMethod&quot;</span>)]
        [<span class="i">Credential</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a> <a id="2b2cd0393520d6a7" href="../../../../R/2b2cd0393520d6a7.html" target="n" data-glyph="102,1" class="i property">ProxyCredential</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the ProxyUseDefaultCredentials property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;StandardMethod&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;CustomMethod&quot;</span>)]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="632e9f1b00f3bc87" href="../../../../R/632e9f1b00f3bc87.html" target="n" data-glyph="102,1" class="i property">ProxyUseDefaultCredentials</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Input
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Body property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>)]
        <b>public virtual object</b> <a id="e02193261ccb98c9" href="../../../../R/e02193261ccb98c9.html" target="n" data-glyph="102,1" class="i property">Body</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dictionary for use with RFC-7578 multipart/form-data submissions.</span>
        <span class="c">///</span><span class="c"> Keys are form fields and their respective values are form values.</span>
        <span class="c">///</span><span class="c"> A value may be a collection of form values or single form value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <span class="i">IDictionary</span> <a id="6d4985fb6371d4a7" href="../../../../R/6d4985fb6371d4a7.html" target="n" data-glyph="102,1" class="i property">Form</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the ContentType property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual string</b> <a id="6d7073c1d428d9b8" href="../../../../R/6d7073c1d428d9b8.html" target="n" data-glyph="102,1" class="i property">ContentType</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the TransferEncoding property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateSet</span>(<span class="s">&quot;chunked&quot;</span>, <span class="s">&quot;compress&quot;</span>, <span class="s">&quot;deflate&quot;</span>, <span class="s">&quot;gzip&quot;</span>, <span class="s">&quot;identity&quot;</span>, <a href="/System.Management.Automation/A.html#90833178fccd6012" class="i property">IgnoreCase</a> = <b>true</b>)]
        <b>public virtual string</b> <a id="7d32088e491407a3" href="../../../../R/7d32088e491407a3.html" target="n" data-glyph="102,1" class="i property">TransferEncoding</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the InFile property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual string</b> <a id="eb31d4a3b9df70c3" href="../../../../R/eb31d4a3b9df70c3.html" target="n" data-glyph="102,1" class="i property">InFile</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Keep the original file path after the resolved provider path is assigned to InFile.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="74d567b0df3669b0" href="../../../../R/74d567b0df3669b0.html" target="n" data-glyph="46,1" class="i field">_originalFilePath</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Output
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the OutFile property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual string</b> <a id="99187f0dc270ed73" href="../../../../R/99187f0dc270ed73.html" target="n" data-glyph="102,1" class="i property">OutFile</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the PassThrough property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="6688de957a81994f" href="../../../../R/6688de957a81994f.html" target="n" data-glyph="102,1" class="i property">PassThru</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resumes downloading a partial or incomplete file. OutFile is required.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="a8d4db7f96323a3d" href="../../../../R/a8d4db7f96323a3d.html" target="n" data-glyph="102,1" class="i property">Resume</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to skip checking HTTP status for error codes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="2456833d43e2bf42" href="../../../../R/2456833d43e2bf42.html" target="n" data-glyph="102,1" class="i property">SkipHttpErrorCheck</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Virtual Properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Virtual Methods
 
        <b>internal virtual void</b> <a id="d22968ae9a3c71af" href="../../../../R/d22968ae9a3c71af.html" target="n" data-glyph="74,1" class="i method">ValidateParameters</a>()
        {
            <span class="c">// sessions</span>
            <b>if</b> ((<a href="#90d74702f865f3cb" class="i property">WebSession</a> != <b>null</b>) &amp;&amp; (<a href="#df5235785002cc5a" class="i property">SessionVariable</a> != <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r0 rd" class="r0 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">SessionConflict</span>,
                                                       <span class="s">&quot;WebCmdletSessionConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r0 r">error</span>);
            }
 
            <span class="c">// Authentication</span>
            <b>if</b> (<a href="#cabc2fd09a41fa7e" class="i property">UseDefaultCredentials</a> &amp;&amp; (<a href="#dee98b2df2a3224d" class="i property">Authentication</a> != <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ec821ad87e8c3be5" class="i field">None</a>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r1 rd" class="r1 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">AuthenticationConflict</span>,
                                                       <span class="s">&quot;WebCmdletAuthenticationConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r1 r">error</span>);
            }
 
            <b>if</b> ((<a href="#dee98b2df2a3224d" class="i property">Authentication</a> != <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ec821ad87e8c3be5" class="i field">None</a>) &amp;&amp; (<a href="#92dc548ce9a83f68" class="i property">Token</a> != <b>null</b>) &amp;&amp; (<a href="#cdea11c98869d42b" class="i property">Credential</a> != <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r2 rd" class="r2 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">AuthenticationTokenConflict</span>,
                                                       <span class="s">&quot;WebCmdletAuthenticationTokenConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r2 r">error</span>);
            }
 
            <b>if</b> ((<a href="#dee98b2df2a3224d" class="i property">Authentication</a> == <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ee1db936cac29719" class="i field">Basic</a>) &amp;&amp; (<a href="#cdea11c98869d42b" class="i property">Credential</a> == <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r3 rd" class="r3 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">AuthenticationCredentialNotSupplied</span>,
                                                       <span class="s">&quot;WebCmdletAuthenticationCredentialNotSuppliedException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r3 r">error</span>);
            }
 
            <b>if</b> ((<a href="#dee98b2df2a3224d" class="i property">Authentication</a> == <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#b09cda7a7ae2ae6e" class="i field">OAuth</a> || <a href="#dee98b2df2a3224d" class="i property">Authentication</a> == <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#3235aead8e846942" class="i field">Bearer</a>) &amp;&amp; (<a href="#92dc548ce9a83f68" class="i property">Token</a> == <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r4 rd" class="r4 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">AuthenticationTokenNotSupplied</span>,
                                                       <span class="s">&quot;WebCmdletAuthenticationTokenNotSuppliedException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r4 r">error</span>);
            }
 
            <b>if</b> (!<a href="#56eebdf9fccddba2" class="i property">AllowUnencryptedAuthentication</a> &amp;&amp; (<a href="#dee98b2df2a3224d" class="i property">Authentication</a> != <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ec821ad87e8c3be5" class="i field">None</a>) &amp;&amp; (<a href="#34135773a270f628" class="i property">Uri</a>.<span class="i">Scheme</span> != <span class="s">&quot;https&quot;</span>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r5 rd" class="r5 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">AllowUnencryptedAuthenticationRequired</span>,
                                                       <span class="s">&quot;WebCmdletAllowUnencryptedAuthenticationRequiredException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r5 r">error</span>);
            }
 
            <b>if</b> (!<a href="#56eebdf9fccddba2" class="i property">AllowUnencryptedAuthentication</a> &amp;&amp; (<a href="#cdea11c98869d42b" class="i property">Credential</a> != <b>null</b> || <a href="#cabc2fd09a41fa7e" class="i property">UseDefaultCredentials</a>) &amp;&amp; (<a href="#34135773a270f628" class="i property">Uri</a>.<span class="i">Scheme</span> != <span class="s">&quot;https&quot;</span>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r6 rd" class="r6 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">AllowUnencryptedAuthenticationRequired</span>,
                                                       <span class="s">&quot;WebCmdletAllowUnencryptedAuthenticationRequiredException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r6 r">error</span>);
            }
 
            <span class="c">// credentials</span>
            <b>if</b> (<a href="#cabc2fd09a41fa7e" class="i property">UseDefaultCredentials</a> &amp;&amp; (<a href="#cdea11c98869d42b" class="i property">Credential</a> != <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r7 rd" class="r7 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">CredentialConflict</span>,
                                                       <span class="s">&quot;WebCmdletCredentialConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r7 r">error</span>);
            }
 
            <span class="c">// Proxy server</span>
            <b>if</b> (<a href="#632e9f1b00f3bc87" class="i property">ProxyUseDefaultCredentials</a> &amp;&amp; (<a href="#2b2cd0393520d6a7" class="i property">ProxyCredential</a> != <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r8 rd" class="r8 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">ProxyCredentialConflict</span>,
                                                       <span class="s">&quot;WebCmdletProxyCredentialConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r8 r">error</span>);
            }
            <b>else</b> <b>if</b> ((<a href="#bd0c681285dbf3e5" class="i property">Proxy</a> == <b>null</b>) &amp;&amp; ((<a href="#2b2cd0393520d6a7" class="i property">ProxyCredential</a> != <b>null</b>) || <a href="#632e9f1b00f3bc87" class="i property">ProxyUseDefaultCredentials</a>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r9 rd" class="r9 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">ProxyUriNotSupplied</span>,
                                                       <span class="s">&quot;WebCmdletProxyUriNotSuppliedException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r9 r">error</span>);
            }
 
            <span class="c">// request body content</span>
            <b>if</b> ((<a href="#e02193261ccb98c9" class="i property">Body</a> != <b>null</b>) &amp;&amp; (<a href="#eb31d4a3b9df70c3" class="i property">InFile</a> != <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r10 rd" class="r10 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">BodyConflict</span>,
                                                       <span class="s">&quot;WebCmdletBodyConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r10 r">error</span>);
            }
 
            <b>if</b> ((<a href="#e02193261ccb98c9" class="i property">Body</a> != <b>null</b>) &amp;&amp; (<a href="#6d4985fb6371d4a7" class="i property">Form</a> != <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r11 rd" class="r11 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">BodyFormConflict</span>,
                                                       <span class="s">&quot;WebCmdletBodyFormConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r11 r">error</span>);
            }
 
            <b>if</b> ((<a href="#eb31d4a3b9df70c3" class="i property">InFile</a> != <b>null</b>) &amp;&amp; (<a href="#6d4985fb6371d4a7" class="i property">Form</a> != <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r12 rd" class="r12 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">FormInFileConflict</span>,
                                                       <span class="s">&quot;WebCmdletFormInFileConflictException&quot;</span>);
                <span class="i">ThrowTerminatingError</span>(<span class="r12 r">error</span>);
            }
 
            <span class="c">// validate InFile path</span>
            <b>if</b> (<a href="#eb31d4a3b9df70c3" class="i property">InFile</a> != <b>null</b>)
            {
                <a href="/System.Management.Automation/A.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r13 rd" class="r13 r">provider</span> = <b>null</b>;
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r14 rd" class="r14 r">errorRecord</span> = <b>null</b>;
 
                <b>try</b>
                {
                    <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r15 rd" class="r15 r">providerPaths</span> = <span class="i">GetResolvedProviderPathFromPSPath</span>(<a href="#eb31d4a3b9df70c3" class="i property">InFile</a>, <b>out</b> <span class="r13 r">provider</span>);
 
                    <b>if</b> (!<span class="r13 r">provider</span>.<a href="/System.Management.Automation/A.html#2837d805ea30ef5c" class="i property">Name</a>.<span class="i">Equals</span>(<a href="/System.Management.Automation/A.html#64a92af39f1cd630" class="t t">FileSystemProvider</a>.<a href="/System.Management.Automation/A.html#10b665caf52d3382" class="i field">ProviderName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r14 r">errorRecord</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">NotFilesystemPath</span>,
                                                         <span class="s">&quot;WebCmdletInFileNotFilesystemPathException&quot;</span>, <a href="#eb31d4a3b9df70c3" class="i property">InFile</a>);
                    }
                    <b>else</b>
                    {
                        <b>if</b> (<span class="r15 r">providerPaths</span>.<span class="i">Count</span> &gt; 1)
                        {
                            <span class="r14 r">errorRecord</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">MultiplePathsResolved</span>,
                                                             <span class="s">&quot;WebCmdletInFileMultiplePathsResolvedException&quot;</span>, <a href="#eb31d4a3b9df70c3" class="i property">InFile</a>);
                        }
                        <b>else</b> <b>if</b> (<span class="r15 r">providerPaths</span>.<span class="i">Count</span> == 0)
                        {
                            <span class="r14 r">errorRecord</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">NoPathResolved</span>,
                                                             <span class="s">&quot;WebCmdletInFileNoPathResolvedException&quot;</span>, <a href="#eb31d4a3b9df70c3" class="i property">InFile</a>);
                        }
                        <b>else</b>
                        {
                            <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r15 r">providerPaths</span>[0]))
                            {
                                <span class="r14 r">errorRecord</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">DirectoryPathSpecified</span>,
                                                                 <span class="s">&quot;WebCmdletInFileNotFilePathException&quot;</span>, <a href="#eb31d4a3b9df70c3" class="i property">InFile</a>);
                            }
 
                            <a href="#74d567b0df3669b0" class="i field">_originalFilePath</a> = <a href="#eb31d4a3b9df70c3" class="i property">InFile</a>;
                            <a href="#eb31d4a3b9df70c3" class="i property">InFile</a> = <span class="r15 r">providerPaths</span>[0];
                        }
                    }
                }
                <b>catch</b> (<a href="/System.Management.Automation/A.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r16 rd" class="r16 r">pathNotFound</span>)
                {
                    <span class="r14 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r16 r">pathNotFound</span>.<a href="/System.Management.Automation/A.html#3efc34ad3d29e212" class="i property">ErrorRecord</a>, <span class="r16 r">pathNotFound</span>);
                }
                <b>catch</b> (<a href="/System.Management.Automation/A.html#a58038dc730da896" class="t t">ProviderNotFoundException</a> <span id="r17 rd" class="r17 r">providerNotFound</span>)
                {
                    <span class="r14 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r17 r">providerNotFound</span>.<a href="/System.Management.Automation/A.html#3efc34ad3d29e212" class="i property">ErrorRecord</a>, <span class="r17 r">providerNotFound</span>);
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="/System.Management.Automation/A.html#09140e6dc875019b" class="t t">DriveNotFoundException</a> <span id="r18 rd" class="r18 r">driveNotFound</span>)
                {
                    <span class="r14 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r18 r">driveNotFound</span>.<a href="/System.Management.Automation/A.html#3efc34ad3d29e212" class="i property">ErrorRecord</a>, <span class="r18 r">driveNotFound</span>);
                }
 
                <b>if</b> (<span class="r14 r">errorRecord</span> != <b>null</b>)
                {
                    <span class="i">ThrowTerminatingError</span>(<span class="r14 r">errorRecord</span>);
                }
            }
 
            <span class="c">// output ??</span>
            <b>if</b> (<a href="#6688de957a81994f" class="i property">PassThru</a> &amp;&amp; (<a href="#99187f0dc270ed73" class="i property">OutFile</a> == <b>null</b>))
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r19 rd" class="r19 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">OutFileMissing</span>,
                                                       <span class="s">&quot;WebCmdletOutFileMissingException&quot;</span>, <b>nameof</b>(<a href="#6688de957a81994f" class="i property">PassThru</a>));
                <span class="i">ThrowTerminatingError</span>(<span class="r19 r">error</span>);
            }
 
            <span class="c">// Resume requires OutFile.</span>
            <b>if</b> (<a href="#a8d4db7f96323a3d" class="i property">Resume</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a> &amp;&amp; <a href="#99187f0dc270ed73" class="i property">OutFile</a> == <b>null</b>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r20 rd" class="r20 r">error</span> = <span class="i">GetValidationError</span>(<span class="i">WebCmdletStrings</span>.<span class="i">OutFileMissing</span>,
                                                       <span class="s">&quot;WebCmdletOutFileMissingException&quot;</span>, <b>nameof</b>(<a href="#a8d4db7f96323a3d" class="i property">Resume</a>));
                <span class="i">ThrowTerminatingError</span>(<span class="r20 r">error</span>);
            }
        }
 
        <b>internal virtual void</b> <a id="ab6900abbb21312d" href="../../../../R/ab6900abbb21312d.html" target="n" data-glyph="74,1" class="i method">PrepareSession</a>()
        {
            <span class="c">// make sure we have a valid WebRequestSession object to work with</span>
            <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a> == <b>null</b>)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a> = <b>new</b> <a href="../WebRequestSession.cs.html#6d38e6cce7c1a59d" class="t constructor">WebRequestSession</a>();
            }
 
            <b>if</b> (<a href="#df5235785002cc5a" class="i property">SessionVariable</a> != <b>null</b>)
            {
                <span class="c">// save the session back to the PS environment if requested</span>
                <a href="/System.Management.Automation/A.html#a66e215a6e6c92d5" class="t t">PSVariableIntrinsics</a> <span id="r21 rd" class="r21 r">vi</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#0198da5eba13cb75" class="i property">PSVariable</a>;
                <span class="r21 r">vi</span>.<span class="i">Set</span>(<a href="#df5235785002cc5a" class="i property">SessionVariable</a>, <a href="#90d74702f865f3cb" class="i property">WebSession</a>);
            }
 
            <span class="c">//</span>
            <span class="c">// handle credentials</span>
            <span class="c">//</span>
            <b>if</b> (<a href="#cdea11c98869d42b" class="i property">Credential</a> != <b>null</b> &amp;&amp; <a href="#dee98b2df2a3224d" class="i property">Authentication</a> == <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ec821ad87e8c3be5" class="i field">None</a>)
            {
                <span class="c">// get the relevant NetworkCredential</span>
                <span class="i">NetworkCredential</span> <span id="r22 rd" class="r22 r">netCred</span> = <a href="#cdea11c98869d42b" class="i property">Credential</a>.<span class="i">GetNetworkCredential</span>();
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#33cb9593a4231bdc" class="i property">Credentials</a> = <span class="r22 r">netCred</span>;
 
                <span class="c">// supplying a credential overrides the UseDefaultCredentials setting</span>
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d0d4d249852eeff1" class="i property">UseDefaultCredentials</a> = <b>false</b>;
            }
            <b>else</b> <b>if</b> ((<a href="#cdea11c98869d42b" class="i property">Credential</a> != <b>null</b> || <a href="#92dc548ce9a83f68" class="i property">Token</a> != <b>null</b>) &amp;&amp; <a href="#dee98b2df2a3224d" class="i property">Authentication</a> != <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ec821ad87e8c3be5" class="i field">None</a>)
            {
                <a href="#4f86050bd3d1da0b" class="i method">ProcessAuthentication</a>();
            }
            <b>else</b> <b>if</b> (<a href="#cabc2fd09a41fa7e" class="i property">UseDefaultCredentials</a>)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d0d4d249852eeff1" class="i property">UseDefaultCredentials</a> = <b>true</b>;
            }
 
            <b>if</b> (<a href="#099a766c8c2c47ad" class="i property">CertificateThumbprint</a> != <b>null</b>)
            {
                <span class="i">X509Store</span> <span id="r23 rd" class="r23 r">store</span> = <b>new</b>(<span class="i">StoreName</span>.<span class="i">My</span>, <span class="i">StoreLocation</span>.<span class="i">CurrentUser</span>);
                <span class="r23 r">store</span>.<span class="i">Open</span>(<span class="i">OpenFlags</span>.<span class="i">ReadOnly</span> | <span class="i">OpenFlags</span>.<span class="i">OpenExistingOnly</span>);
                <span class="i">X509Certificate2Collection</span> <span id="r24 rd" class="r24 r">collection</span> = (<span class="i">X509Certificate2Collection</span>)<span class="r23 r">store</span>.<span class="i">Certificates</span>;
                <span class="i">X509Certificate2Collection</span> <span id="r25 rd" class="r25 r">tbCollection</span> = (<span class="i">X509Certificate2Collection</span>)<span class="r24 r">collection</span>.<span class="i">Find</span>(<span class="i">X509FindType</span>.<span class="i">FindByThumbprint</span>, <a href="#099a766c8c2c47ad" class="i property">CertificateThumbprint</a>, <b>false</b>);
                <b>if</b> (<span class="r25 r">tbCollection</span>.<span class="i">Count</span> == 0)
                {
                    <span class="i">CryptographicException</span> <span id="r26 rd" class="r26 r">ex</span> = <b>new</b>(<span class="i">WebCmdletStrings</span>.<span class="i">ThumbprintNotFound</span>);
                    <b>throw</b> <span class="r26 r">ex</span>;
                }
 
                <b>foreach</b> (<span class="i">X509Certificate2</span> <span id="r27 rd" class="r27 r">tbCert</span> <b>in</b> <span class="r25 r">tbCollection</span>)
                {
                    <span class="i">X509Certificate</span> <span id="r28 rd" class="r28 r">certificate</span> = (<span class="i">X509Certificate</span>)<span class="r27 r">tbCert</span>;
                    <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#081f53675c20c080" class="i method">AddCertificate</a>(<span class="r28 r">certificate</span>);
                }
            }
 
            <b>if</b> (<a href="#fcfae8b3212d0da7" class="i property">Certificate</a> != <b>null</b>)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#081f53675c20c080" class="i method">AddCertificate</a>(<a href="#fcfae8b3212d0da7" class="i property">Certificate</a>);
            }
 
            <span class="c">//</span>
            <span class="c">// handle the user agent</span>
            <span class="c">//</span>
            <b>if</b> (<a href="#e4893011e3eea470" class="i property">UserAgent</a> != <b>null</b>)
            {
                <span class="c">// store the UserAgent string</span>
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#abddd9491f558dcc" class="i property">UserAgent</a> = <a href="#e4893011e3eea470" class="i property">UserAgent</a>;
            }
 
            <b>if</b> (<a href="#bd0c681285dbf3e5" class="i property">Proxy</a> != <b>null</b>)
            {
                <a href="../CoreCLR/WebProxy.cs.html#4472fae7d641ab60" class="t t">WebProxy</a> <span id="r29 rd" class="r29 r">webProxy</span> = <b>new</b>(<a href="#bd0c681285dbf3e5" class="i property">Proxy</a>);
                <span class="r29 r">webProxy</span>.<a href="../CoreCLR/WebProxy.cs.html#e038c5892ac6bb8f" class="i property">BypassProxyOnLocal</a> = <b>false</b>;
                <b>if</b> (<a href="#2b2cd0393520d6a7" class="i property">ProxyCredential</a> != <b>null</b>)
                {
                    <span class="r29 r">webProxy</span>.<a href="../CoreCLR/WebProxy.cs.html#208f83f6306a1c9f" class="i property">Credentials</a> = <a href="#2b2cd0393520d6a7" class="i property">ProxyCredential</a>.<span class="i">GetNetworkCredential</span>();
                }
                <b>else</b> <b>if</b> (<a href="#632e9f1b00f3bc87" class="i property">ProxyUseDefaultCredentials</a>)
                {
                    <span class="c">// If both ProxyCredential and ProxyUseDefaultCredentials are passed,</span>
                    <span class="c">// UseDefaultCredentials will overwrite the supplied credentials.</span>
                    <span class="r29 r">webProxy</span>.<a href="../CoreCLR/WebProxy.cs.html#5c83b6b2783c4493" class="i property">UseDefaultCredentials</a> = <b>true</b>;
                }
 
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#7089e3907f16cab7" class="i property">Proxy</a> = <span class="r29 r">webProxy</span>;
            }
 
            <b>if</b> (<a href="#85083b06aeada2de" class="i property">MaximumRedirection</a> &gt; -1)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d90c2182d8853bf7" class="i property">MaximumRedirection</a> = <a href="#85083b06aeada2de" class="i property">MaximumRedirection</a>;
            }
 
            <span class="c">// store the other supplied headers</span>
            <b>if</b> (<a href="#02461f0adc34eacc" class="i property">Headers</a> != <b>null</b>)
            {
                <b>foreach</b> (<b>string</b> <span id="r30 rd" class="r30 r">key</span> <b>in</b> <a href="#02461f0adc34eacc" class="i property">Headers</a>.<span class="i">Keys</span>)
                {
                    <b>var</b> <span id="r31 rd" class="r31 r">value</span> = <a href="#02461f0adc34eacc" class="i property">Headers</a>[<span class="r30 r">key</span>];
 
                    <span class="c">// null is not valid value for header.</span>
                    <span class="c">// We silently ignore header if value is null.</span>
                    <b>if</b> (<span class="r31 r">value</span> <b>is not null</b>)
                    {
                        <span class="c">// add the header value (or overwrite it if already present)</span>
                        <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>[<span class="r30 r">key</span>] = <span class="r31 r">value</span>.<span class="i">ToString</span>();
                    }
                }
            }
 
            <b>if</b> (<a href="#72ac66e03a1e484c" class="i property">MaximumRetryCount</a> &gt; 0)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#83750dac0986a5e2" class="i property">MaximumRetryCount</a> = <a href="#72ac66e03a1e484c" class="i property">MaximumRetryCount</a>;
 
                <span class="c">// only set retry interval if retry count is set.</span>
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#c112890028cb191b" class="i property">RetryIntervalInSeconds</a> = <a href="#4b390d8f440c1ad8" class="i property">RetryIntervalSec</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Virtual Methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helper Properties
 
        <b>internal string</b> <a id="862b1a7c65f11752" href="../../../../R/862b1a7c65f11752.html" target="n" data-glyph="104,1" class="i property">QualifiedOutFile</a>
        {
            <b>get</b> { <b>return</b> (<a href="#db4adcf58647bbb8" class="i method">QualifyFilePath</a>(<a href="#99187f0dc270ed73" class="i property">OutFile</a>)); }
        }
 
        <b>internal bool</b> <a id="9f22bf862539cda0" href="../../../../R/9f22bf862539cda0.html" target="n" data-glyph="104,1" class="i property">ShouldSaveToOutFile</a>
        {
            <b>get</b> { <b>return</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#99187f0dc270ed73" class="i property">OutFile</a>)); }
        }
 
        <b>internal bool</b> <a id="c1feb55e5689bdb8" href="../../../../R/c1feb55e5689bdb8.html" target="n" data-glyph="104,1" class="i property">ShouldWriteToPipeline</a>
        {
            <b>get</b> { <b>return</b> (!<a href="#9f22bf862539cda0" class="i property">ShouldSaveToOutFile</a> || <a href="#6688de957a81994f" class="i property">PassThru</a>); }
        }
 
        <b>internal bool</b> <a id="72fafa0525bcafad" href="../../../../R/72fafa0525bcafad.html" target="n" data-glyph="104,1" class="i property">ShouldCheckHttpStatus</a>
        {
            <b>get</b> { <b>return</b> !<a href="#2456833d43e2bf42" class="i property">SkipHttpErrorCheck</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines whether writing to a file should Resume and append rather than overwrite.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="ddb44e481166d331" href="../../../../R/ddb44e481166d331.html" target="n" data-glyph="104,1" class="i property">ShouldResume</a>
        {
            <b>get</b> { <b>return</b> (<a href="#a8d4db7f96323a3d" class="i property">Resume</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a> &amp;&amp; <a href="#b6d68d53c18d5b4c" class="i field">_resumeSuccess</a>); }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Helper Properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helper Methods
        <b>private</b> <span class="i">Uri</span> <a id="39bc079b23264dd2" href="../../../../R/39bc079b23264dd2.html" target="n" data-glyph="76,1" class="i method">PrepareUri</a>(<span class="i">Uri</span> <span id="r32 rd" class="r32 r">uri</span>)
        {
            <span class="r32 r">uri</span> = <a href="#81588e2b321e7f93" class="i method">CheckProtocol</a>(<span class="r32 r">uri</span>);
 
            <span class="c">// before creating the web request,</span>
            <span class="c">// preprocess Body if content is a dictionary and method is GET (set as query)</span>
            <span class="i">IDictionary</span> <span id="r33 rd" class="r33 r">bodyAsDictionary</span>;
            <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>&lt;<span class="i">IDictionary</span>&gt;(<a href="#e02193261ccb98c9" class="i property">Body</a>, <b>out</b> <span class="r33 r">bodyAsDictionary</span>);
            <b>if</b> ((<span class="r33 r">bodyAsDictionary</span> != <b>null</b>)
                &amp;&amp; ((<a href="#c41e19d1fd375a47" class="i method">IsStandardMethodSet</a>() &amp;&amp; (<a href="#74e585d369a3c020" class="i property">Method</a> == <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#0c73f4381971ee73" class="i field">Default</a> || <a href="#74e585d369a3c020" class="i property">Method</a> == <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#625226d8de61274c" class="i field">Get</a>))
                     || (<a href="#06e56f6d58759910" class="i method">IsCustomMethodSet</a>() &amp;&amp; <a href="#379786a8f95d3483" class="i property">CustomMethod</a>.<span class="i">ToUpperInvariant</span>() == <span class="s">&quot;GET&quot;</span>)))
            {
                <span class="i">UriBuilder</span> <span id="r34 rd" class="r34 r">uriBuilder</span> = <b>new</b>(<span class="r32 r">uri</span>);
                <b>if</b> (<span class="r34 r">uriBuilder</span>.<span class="i">Query</span> != <b>null</b> &amp;&amp; <span class="r34 r">uriBuilder</span>.<span class="i">Query</span>.<span class="i">Length</span> &gt; 1)
                {
                    <span class="r34 r">uriBuilder</span>.<span class="i">Query</span> = <b>string</b>.<span class="i">Concat</span>(<span class="r34 r">uriBuilder</span>.<span class="i">Query</span>.<span class="i">AsSpan</span>(1), <span class="s">&quot;&amp;&quot;</span>, <a href="#78053927611db49a" class="i method">FormatDictionary</a>(<span class="r33 r">bodyAsDictionary</span>));
                }
                <b>else</b>
                {
                    <span class="r34 r">uriBuilder</span>.<span class="i">Query</span> = <a href="#78053927611db49a" class="i method">FormatDictionary</a>(<span class="r33 r">bodyAsDictionary</span>);
                }
 
                <span class="r32 r">uri</span> = <span class="r34 r">uriBuilder</span>.<span class="i">Uri</span>;
                <span class="c">// set body to null to prevent later FillRequestStream</span>
                <a href="#e02193261ccb98c9" class="i property">Body</a> = <b>null</b>;
            }
 
            <b>return</b> <span class="r32 r">uri</span>;
        }
 
        <b>private static</b> <span class="i">Uri</span> <a id="81588e2b321e7f93" href="../../../../R/81588e2b321e7f93.html" target="n" data-glyph="76,1" class="i method">CheckProtocol</a>(<span class="i">Uri</span> <span id="r35 rd" class="r35 r">uri</span>)
        {
            <b>if</b> (<span class="r35 r">uri</span> == <b>null</b>) { <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r35 r">uri</span>)); }
 
            <b>if</b> (!<span class="r35 r">uri</span>.<span class="i">IsAbsoluteUri</span>)
            {
                <span class="r35 r">uri</span> = <b>new</b> <span class="i">Uri</span>(<span class="s">&quot;http://&quot;</span> + <span class="r35 r">uri</span>.<span class="i">OriginalString</span>);
            }
 
            <b>return</b> (<span class="r35 r">uri</span>);
        }
 
        <b>private string</b> <a id="db4adcf58647bbb8" href="../../../../R/db4adcf58647bbb8.html" target="n" data-glyph="76,1" class="i method">QualifyFilePath</a>(<b>string</b> <span id="r36 rd" class="r36 r">path</span>)
        {
            <b>string</b> <span id="r37 rd" class="r37 r">resolvedFilePath</span> = <span class="i">PathUtils</span>.<span class="i">ResolveFilePath</span>(<span class="i">filePath</span>: <span class="r36 r">path</span>, <span class="i">command</span>: <a href="../../../../P/662e7ae18a2eef77.html#662e7ae18a2eef77" class="k">this</a>, <span class="i">isLiteralPath</span>: <b>true</b>);
            <b>return</b> <span class="r37 r">resolvedFilePath</span>;
        }
 
        <b>private static string</b> <a id="78053927611db49a" href="../../../../R/78053927611db49a.html" target="n" data-glyph="76,1" class="i method">FormatDictionary</a>(<span class="i">IDictionary</span> <span id="r38 rd" class="r38 r">content</span>)
        {
            <b>if</b> (<span class="r38 r">content</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r38 r">content</span>));
 
            <span class="i">StringBuilder</span> <span id="r39 rd" class="r39 r">bodyBuilder</span> = <b>new</b>();
            <b>foreach</b> (<b>string</b> <span id="r40 rd" class="r40 r">key</span> <b>in</b> <span class="r38 r">content</span>.<span class="i">Keys</span>)
            {
                <b>if</b> (<span class="r39 r">bodyBuilder</span>.<span class="i">Length</span> &gt; 0)
                {
                    <span class="r39 r">bodyBuilder</span>.<span class="i">Append</span>(<span class="s">&#39;&amp;&#39;</span>);
                }
 
                <b>object</b> <span id="r41 rd" class="r41 r">value</span> = <span class="r38 r">content</span>[<span class="r40 r">key</span>];
 
                <span class="c">// URLEncode the key and value</span>
                <b>string</b> <span id="r42 rd" class="r42 r">encodedKey</span> = <span class="i">WebUtility</span>.<span class="i">UrlEncode</span>(<span class="r40 r">key</span>);
                <b>string</b> <span id="r43 rd" class="r43 r">encodedValue</span> = <b>string</b>.<span class="i">Empty</span>;
                <b>if</b> (<span class="r41 r">value</span> != <b>null</b>)
                {
                    <span class="r43 r">encodedValue</span> = <span class="i">WebUtility</span>.<span class="i">UrlEncode</span>(<span class="r41 r">value</span>.<span class="i">ToString</span>());
                }
 
                <span class="r39 r">bodyBuilder</span>.<span class="i">AppendFormat</span>(<span class="s">&quot;{0}={1}&quot;</span>, <span class="r42 r">encodedKey</span>, <span class="r43 r">encodedValue</span>);
            }
 
            <b>return</b> <span class="r39 r">bodyBuilder</span>.<span class="i">ToString</span>();
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="22ef430f3928151c" href="../../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetValidationError</a>(<b>string</b> <span id="r44 rd" class="r44 r">msg</span>, <b>string</b> <span id="r45 rd" class="r45 r">errorId</span>)
        {
            <a href="/System.Management.Automation/A.html#3a63a9fcbe2d56df" class="k">var</a> <span id="r46 rd" class="r46 r">ex</span> = <b>new</b> <span class="t">ValidationMetadataException</span>(<span class="r44 r">msg</span>);
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="k">var</a> <span id="r47 rd" class="r47 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r46 r">ex</span>, <span class="r45 r">errorId</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="../../../../P/662e7ae18a2eef77.html#662e7ae18a2eef77" class="k">this</a>);
            <b>return</b> (<span class="r47 r">error</span>);
        }
 
        <b>private</b> <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="98ca5675a7063790" href="../../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetValidationError</a>(<b>string</b> <span id="r48 rd" class="r48 r">msg</span>, <b>string</b> <span id="r49 rd" class="r49 r">errorId</span>, <b>params object</b>[] <span id="r50 rd" class="r50 r">args</span>)
        {
            <span class="r48 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r48 r">msg</span>, <span class="r50 r">args</span>);
            <a href="/System.Management.Automation/A.html#3a63a9fcbe2d56df" class="k">var</a> <span id="r51 rd" class="r51 r">ex</span> = <b>new</b> <span class="t">ValidationMetadataException</span>(<span class="r48 r">msg</span>);
            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="k">var</a> <span id="r52 rd" class="r52 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r51 r">ex</span>, <span class="r49 r">errorId</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="../../../../P/662e7ae18a2eef77.html#662e7ae18a2eef77" class="k">this</a>);
            <b>return</b> (<span class="r52 r">error</span>);
        }
 
        <b>private bool</b> <a id="c41e19d1fd375a47" href="../../../../R/c41e19d1fd375a47.html" target="n" data-glyph="76,1" class="i method">IsStandardMethodSet</a>()
        {
            <b>return</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a> == <span class="s">&quot;StandardMethod&quot;</span> || <a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a> == <span class="s">&quot;StandardMethodNoProxy&quot;</span>);
        }
 
        <b>private bool</b> <a id="06e56f6d58759910" href="../../../../R/06e56f6d58759910.html" target="n" data-glyph="76,1" class="i method">IsCustomMethodSet</a>()
        {
            <b>return</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a> == <span class="s">&quot;CustomMethod&quot;</span> || <a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a> == <span class="s">&quot;CustomMethodNoProxy&quot;</span>);
        }
 
        <b>private string</b> <a id="200e1d1aa0c2013f" href="../../../../R/200e1d1aa0c2013f.html" target="n" data-glyph="76,1" class="i method">GetBasicAuthorizationHeader</a>()
        {
            <b>var</b> <span id="r53 rd" class="r53 r">password</span> = <b>new</b> <span class="i">NetworkCredential</span>(<b>null</b>, <a href="#cdea11c98869d42b" class="i property">Credential</a>.<a href="/System.Management.Automation/A.html#828d5fa008f1755c" class="i property">Password</a>).<span class="i">Password</span>;
            <b>string</b> <span id="r54 rd" class="r54 r">unencoded</span> = <b>string</b>.<span class="i">Format</span>(<span class="s">&quot;{0}:{1}&quot;</span>, <a href="#cdea11c98869d42b" class="i property">Credential</a>.<a href="/System.Management.Automation/A.html#3fca673651eaeaff" class="i property">UserName</a>, <span class="r53 r">password</span>);
            <b>byte</b>[] <span id="r55 rd" class="r55 r">bytes</span> = <span class="i">Encoding</span>.<span class="i">UTF8</span>.<span class="i">GetBytes</span>(<span class="r54 r">unencoded</span>);
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="s">&quot;Basic {0}&quot;</span>, <span class="i">Convert</span>.<span class="i">ToBase64String</span>(<span class="r55 r">bytes</span>));
        }
 
        <b>private string</b> <a id="81352721546a96a8" href="../../../../R/81352721546a96a8.html" target="n" data-glyph="76,1" class="i method">GetBearerAuthorizationHeader</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="s">&quot;Bearer {0}&quot;</span>, <b>new</b> <span class="i">NetworkCredential</span>(<b>string</b>.<span class="i">Empty</span>, <a href="#92dc548ce9a83f68" class="i property">Token</a>).<span class="i">Password</span>);
        }
 
        <b>private void</b> <a id="4f86050bd3d1da0b" href="../../../../R/4f86050bd3d1da0b.html" target="n" data-glyph="76,1" class="i method">ProcessAuthentication</a>()
        {
            <b>if</b> (<a href="#dee98b2df2a3224d" class="i property">Authentication</a> == <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#ee1db936cac29719" class="i field">Basic</a>)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>[<span class="s">&quot;Authorization&quot;</span>] = <a href="#200e1d1aa0c2013f" class="i method">GetBasicAuthorizationHeader</a>();
            }
            <b>else</b> <b>if</b> (<a href="#dee98b2df2a3224d" class="i property">Authentication</a> == <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#3235aead8e846942" class="i field">Bearer</a> || <a href="#dee98b2df2a3224d" class="i property">Authentication</a> == <a href="#a7ed4703e976eb2d" class="t t">WebAuthenticationType</a>.<a href="#b09cda7a7ae2ae6e" class="i field">OAuth</a>)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>[<span class="s">&quot;Authorization&quot;</span>] = <a href="#81352721546a96a8" class="i method">GetBearerAuthorizationHeader</a>();
            }
            <b>else</b>
            {
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <b>string</b>.<span class="i">Format</span>(<span class="s">&quot;Unrecognized Authentication value: {0}&quot;</span>, <a href="#dee98b2df2a3224d" class="i property">Authentication</a>));
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Helper Methods
    }
 
    <span class="c">// TODO: Merge Partials</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Exception class for webcmdlets to enable returning HTTP error response.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public sealed class</b> <a id="b0fd2c5f826397aa" href="../../../../R/b0fd2c5f826397aa.html" target="n" data-glyph="0,0" class="t t">HttpResponseException</a> : <span class="i">HttpRequestException</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#b0fd2c5f826397aa" class="t t">HttpResponseException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r56 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Message for the exception.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">response</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Response from the HTTP server.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="edcc47a0dbc1cf62" href="../../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">HttpResponseException</a>(<b>string</b> <span id="r56 rd" class="r56 r">message</span>, <span class="i">HttpResponseMessage</span> <span id="r57 rd" class="r57 r">response</span>) : <b>base</b>(<span class="r56 r">message</span>)
        {
            <a href="#08e21c3fd76b1bab" class="i property">Response</a> = <span class="r57 r">response</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> HTTP error response.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">HttpResponseMessage</span> <a id="08e21c3fd76b1bab" href="../../../../R/08e21c3fd76b1bab.html" target="n" data-glyph="102,1" class="i property">Response</a> { <b>get</b>; }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Base class for Invoke-RestMethod and Invoke-WebRequest commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public abstract</b> <a href="../../../../P/662e7ae18a2eef77.html" target="s" class="k">partial</a> <b>class</b> <span class="t t">WebRequestPSCmdlet</span> : <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the PreserveAuthorizationOnRedirect property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This property overrides compatibility with web requests on Windows.</span>
        <span class="c">///</span><span class="c"> On FullCLR (WebRequest), authorization headers are stripped during redirect.</span>
        <span class="c">///</span><span class="c"> CoreCLR (HTTPClient) does not have this behavior so web requests that work on</span>
        <span class="c">///</span><span class="c"> PowerShell/FullCLR can fail with PowerShell/CoreCLR.  To provide compatibility,</span>
        <span class="c">///</span><span class="c"> we&#39;ll detect requests with an Authorization header and automatically strip</span>
        <span class="c">///</span><span class="c"> the header when the first redirect occurs. This switch turns off this logic for</span>
        <span class="c">///</span><span class="c"> edge cases where the authorization header needs to be preserved across redirects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="5cd6d61afe1ba597" href="../../../../R/5cd6d61afe1ba597.html" target="n" data-glyph="102,1" class="i property">PreserveAuthorizationOnRedirect</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the SkipHeaderValidation property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This property adds headers to the request&#39;s header collection without validation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="5309431f15542894" href="../../../../R/5309431f15542894.html" target="n" data-glyph="102,1" class="i property">SkipHeaderValidation</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Abstract Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Read the supplied WebResponse object and push the resulting output into the pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">response</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Instance of a WebResponse object to be processed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal abstract void</b> <a id="b9b51b2d6b5d2080" href="../../../../R/b9b51b2d6b5d2080.html" target="n" data-glyph="74,1" class="i method">ProcessResponse</a>(<span class="i">HttpResponseMessage</span> <span id="r58 rd" class="r58 r">response</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Abstract Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cancellation token source.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">CancellationTokenSource</span> <a id="0cceefd1240619f1" href="../../../../R/0cceefd1240619f1.html" target="n" data-glyph="44,1" class="i field">_cancelToken</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parse Rel Links.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="aa5ca097609e5a41" href="../../../../R/aa5ca097609e5a41.html" target="n" data-glyph="44,1" class="i field">_parseRelLink</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Automatically follow Rel Links.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="5c2134156fa5eee2" href="../../../../R/5c2134156fa5eee2.html" target="n" data-glyph="44,1" class="i field">_followRelLink</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Automatically follow Rel Links.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <a id="531b58a467f9130f" href="../../../../R/531b58a467f9130f.html" target="n" data-glyph="44,1" class="i field">_relationLink</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Maximum number of Rel Links to follow.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal int</b> <a id="2c0a1ccaad7bbcdc" href="../../../../R/2c0a1ccaad7bbcdc.html" target="n" data-glyph="44,1" class="i field">_maximumFollowRelLink</a> = <b>int</b>.<span class="i">MaxValue</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The remote endpoint returned a 206 status code indicating successful resume.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="b6d68d53c18d5b4c" href="../../../../R/b6d68d53c18d5b4c.html" target="n" data-glyph="46,1" class="i field">_resumeSuccess</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The current size of the local file being resumed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private long</b> <a id="663f89127ba0774e" href="../../../../R/663f89127ba0774e.html" target="n" data-glyph="46,1" class="i field">_resumeFileSize</a> = 0;
 
        <b>private</b> <span class="i">HttpMethod</span> <a id="97f4c569d76db384" href="../../../../R/97f4c569d76db384.html" target="n" data-glyph="76,1" class="i method">GetHttpMethod</a>(<a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a> <span id="r59 rd" class="r59 r">method</span>)
        {
            <b>switch</b> (<a href="#74e585d369a3c020" class="i property">Method</a>)
            {
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#0c73f4381971ee73" class="i field">Default</a>:
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#625226d8de61274c" class="i field">Get</a>:
                    <b>return</b> <span class="i">HttpMethod</span>.<span class="i">Get</span>;
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#19bf0a38cde8a946" class="i field">Head</a>:
                    <b>return</b> <span class="i">HttpMethod</span>.<span class="i">Head</span>;
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#a2e6da164ee69249" class="i field">Post</a>:
                    <b>return</b> <span class="i">HttpMethod</span>.<span class="i">Post</span>;
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#c2e607e787bbd621" class="i field">Put</a>:
                    <b>return</b> <span class="i">HttpMethod</span>.<span class="i">Put</span>;
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#3c5c553afb771f20" class="i field">Delete</a>:
                    <b>return</b> <span class="i">HttpMethod</span>.<span class="i">Delete</span>;
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#d6181fd643ce308c" class="i field">Trace</a>:
                    <b>return</b> <span class="i">HttpMethod</span>.<span class="i">Trace</span>;
                <b>case</b> <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#3e790d331be5d0c1" class="i field">Options</a>:
                    <b>return</b> <span class="i">HttpMethod</span>.<span class="i">Options</span>;
                <b>default</b>:
                    <span class="c">// Merge and Patch</span>
                    <b>return</b> <b>new</b> <span class="i">HttpMethod</span>(<a href="#74e585d369a3c020" class="i property">Method</a>.<span class="i">ToString</span>().<span class="i">ToUpperInvariant</span>());
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Virtual Methods
 
        <span class="c">// NOTE: Only pass true for handleRedirect if the original request has an authorization header</span>
        <span class="c">// and PreserveAuthorizationOnRedirect is NOT set.</span>
        <b>internal virtual</b> <span class="i">HttpClient</span> <a id="6e2d89ee89769653" href="../../../../R/6e2d89ee89769653.html" target="n" data-glyph="74,1" class="i method">GetHttpClient</a>(<b>bool</b> <span id="r60 rd" class="r60 r">handleRedirect</span>)
        {
            <span class="c">// By default the HttpClientHandler will automatically decompress GZip and Deflate content</span>
            <span class="i">HttpClientHandler</span> <span id="r61 rd" class="r61 r">handler</span> = <b>new</b>();
            <span class="r61 r">handler</span>.<span class="i">CookieContainer</span> = <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9803d93862b5ee89" class="i property">Cookies</a>;
 
            <span class="c">// set the credentials used by this request</span>
            <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d0d4d249852eeff1" class="i property">UseDefaultCredentials</a>)
            {
                <span class="c">// the UseDefaultCredentials flag overrides other supplied credentials</span>
                <span class="r61 r">handler</span>.<span class="i">UseDefaultCredentials</span> = <b>true</b>;
            }
            <b>else</b> <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#33cb9593a4231bdc" class="i property">Credentials</a> != <b>null</b>)
            {
                <span class="r61 r">handler</span>.<span class="i">Credentials</span> = <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#33cb9593a4231bdc" class="i property">Credentials</a>;
            }
 
            <b>if</b> (<a href="#5e6d57bcb0168ab9" class="i property">NoProxy</a>)
            {
                <span class="r61 r">handler</span>.<span class="i">UseProxy</span> = <b>false</b>;
            }
            <b>else</b> <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#7089e3907f16cab7" class="i property">Proxy</a> != <b>null</b>)
            {
                <span class="r61 r">handler</span>.<span class="i">Proxy</span> = <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#7089e3907f16cab7" class="i property">Proxy</a>;
            }
 
            <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#a79b61508ae41723" class="i property">Certificates</a> != <b>null</b>)
            {
                <span class="r61 r">handler</span>.<span class="i">ClientCertificates</span>.<span class="i">AddRange</span>(<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#a79b61508ae41723" class="i property">Certificates</a>);
            }
 
            <b>if</b> (<a href="#cc4b5a872f8fbd0d" class="i property">SkipCertificateCheck</a>)
            {
                <span class="r61 r">handler</span>.<span class="i">ServerCertificateCustomValidationCallback</span> = <span class="i">HttpClientHandler</span>.<span class="i">DangerousAcceptAnyServerCertificateValidator</span>;
                <span class="r61 r">handler</span>.<span class="i">ClientCertificateOptions</span> = <span class="i">ClientCertificateOption</span>.<span class="i">Manual</span>;
            }
 
            <span class="c">// This indicates GetResponse will handle redirects.</span>
            <b>if</b> (<span class="r60 r">handleRedirect</span>)
            {
                <span class="r61 r">handler</span>.<span class="i">AllowAutoRedirect</span> = <b>false</b>;
            }
            <b>else</b> <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d90c2182d8853bf7" class="i property">MaximumRedirection</a> &gt; -1)
            {
                <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d90c2182d8853bf7" class="i property">MaximumRedirection</a> == 0)
                {
                    <span class="r61 r">handler</span>.<span class="i">AllowAutoRedirect</span> = <b>false</b>;
                }
                <b>else</b>
                {
                    <span class="r61 r">handler</span>.<span class="i">MaxAutomaticRedirections</span> = <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d90c2182d8853bf7" class="i property">MaximumRedirection</a>;
                }
            }
 
            <span class="r61 r">handler</span>.<span class="i">SslProtocols</span> = (<span class="i">SslProtocols</span>)<a href="#afd0d096dfee9baa" class="i property">SslProtocol</a>;
 
            <span class="i">HttpClient</span> <span id="r62 rd" class="r62 r">httpClient</span> = <b>new</b>(<span class="r61 r">handler</span>);
 
            <span class="c">// check timeout setting (in seconds instead of milliseconds as in HttpWebRequest)</span>
            <b>if</b> (<a href="#1e179e1f5addad1a" class="i property">TimeoutSec</a> == 0)
            {
                <span class="c">// A zero timeout means infinite</span>
                <span class="r62 r">httpClient</span>.<span class="i">Timeout</span> = <span class="i">TimeSpan</span>.<span class="i">FromMilliseconds</span>(<span class="i">Timeout</span>.<span class="i">Infinite</span>);
            }
            <b>else</b> <b>if</b> (<a href="#1e179e1f5addad1a" class="i property">TimeoutSec</a> &gt; 0)
            {
                <span class="r62 r">httpClient</span>.<span class="i">Timeout</span> = <b>new</b> <span class="i">TimeSpan</span>(0, 0, <a href="#1e179e1f5addad1a" class="i property">TimeoutSec</a>);
            }
 
            <b>return</b> <span class="r62 r">httpClient</span>;
        }
 
        <b>internal virtual</b> <span class="i">HttpRequestMessage</span> <a id="7ab86501a5ea82bc" href="../../../../R/7ab86501a5ea82bc.html" target="n" data-glyph="74,1" class="i method">GetRequest</a>(<span class="i">Uri</span> <span id="r63 rd" class="r63 r">uri</span>)
        {
            <span class="i">Uri</span> <span id="r64 rd" class="r64 r">requestUri</span> = <a href="#39bc079b23264dd2" class="i method">PrepareUri</a>(<span class="r63 r">uri</span>);
            <span class="i">HttpMethod</span> <span id="r65 rd" class="r65 r">httpMethod</span> = <b>null</b>;
 
            <b>switch</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>)
            {
                <b>case</b> <span class="s">&quot;StandardMethodNoProxy&quot;</span>:
                    <b>goto</b> <b>case</b> <span class="s">&quot;StandardMethod&quot;</span>;
                <b>case</b> <span class="s">&quot;StandardMethod&quot;</span>:
                    <span class="c">// set the method if the parameter was provided</span>
                    <span class="r65 r">httpMethod</span> = <a href="#97f4c569d76db384" class="i method">GetHttpMethod</a>(<a href="#74e585d369a3c020" class="i property">Method</a>);
                    <b>break</b>;
                <b>case</b> <span class="s">&quot;CustomMethodNoProxy&quot;</span>:
                    <b>goto</b> <b>case</b> <span class="s">&quot;CustomMethod&quot;</span>;
                <b>case</b> <span class="s">&quot;CustomMethod&quot;</span>:
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#379786a8f95d3483" class="i property">CustomMethod</a>))
                    {
                        <span class="c">// set the method if the parameter was provided</span>
                        <span class="r65 r">httpMethod</span> = <b>new</b> <span class="i">HttpMethod</span>(<a href="#379786a8f95d3483" class="i property">CustomMethod</a>.<span class="i">ToUpperInvariant</span>());
                    }
 
                    <b>break</b>;
            }
 
            <span class="c">// create the base WebRequest object</span>
            <b>var</b> <span id="r66 rd" class="r66 r">request</span> = <b>new</b> <span class="i">HttpRequestMessage</span>(<span class="r65 r">httpMethod</span>, <span class="r64 r">requestUri</span>);
 
            <span class="c">// pull in session data</span>
            <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>.<span class="i">Count</span> &gt; 0)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>.<span class="i">Clear</span>();
                <b>foreach</b> (<b>var</b> <span id="r67 rd" class="r67 r">entry</span> <b>in</b> <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>)
                {
                    <b>if</b> (<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#9428a5105b3c023e" class="i property">ContentHeaders</a>.<span class="i">Contains</span>(<span class="r67 r">entry</span>.<span class="i">Key</span>))
                    {
                        <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>.<span class="i">Add</span>(<span class="r67 r">entry</span>.<span class="i">Key</span>, <span class="r67 r">entry</span>.<span class="i">Value</span>);
                    }
                    <b>else</b>
                    {
                        <b>if</b> (<a href="#5309431f15542894" class="i property">SkipHeaderValidation</a>)
                        {
                            <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">TryAddWithoutValidation</span>(<span class="r67 r">entry</span>.<span class="i">Key</span>, <span class="r67 r">entry</span>.<span class="i">Value</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">Add</span>(<span class="r67 r">entry</span>.<span class="i">Key</span>, <span class="r67 r">entry</span>.<span class="i">Value</span>);
                        }
                    }
                }
            }
 
            <span class="c">// Set &#39;Transfer-Encoding: chunked&#39; if &#39;Transfer-Encoding&#39; is specified</span>
            <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>.<span class="i">ContainsKey</span>(<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#1cf3b5a6e0f3e572" class="i field">TransferEncoding</a>))
            {
                <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">TransferEncodingChunked</span> = <b>true</b>;
            }
 
            <span class="c">// Set &#39;User-Agent&#39; if WebSession.Headers doesn&#39;t already contain it</span>
            <b>string</b> <span id="r68 rd" class="r68 r">userAgent</span> = <b>null</b>;
            <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>.<span class="i">TryGetValue</span>(<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#421a606c3ccaffd0" class="i field">UserAgent</a>, <b>out</b> <span class="r68 r">userAgent</span>))
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#abddd9491f558dcc" class="i property">UserAgent</a> = <span class="r68 r">userAgent</span>;
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#5309431f15542894" class="i property">SkipHeaderValidation</a>)
                {
                    <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">TryAddWithoutValidation</span>(<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#421a606c3ccaffd0" class="i field">UserAgent</a>, <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#abddd9491f558dcc" class="i property">UserAgent</a>);
                }
                <b>else</b>
                {
                    <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">Add</span>(<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#421a606c3ccaffd0" class="i field">UserAgent</a>, <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#abddd9491f558dcc" class="i property">UserAgent</a>);
                }
            }
 
            <span class="c">// Set &#39;Keep-Alive&#39; to false. This means set the Connection to &#39;Close&#39;.</span>
            <b>if</b> (<a href="#d6a2973a23f2ee19" class="i property">DisableKeepAlive</a>)
            {
                <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">Add</span>(<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#a29653707dc94bd2" class="i field">Connection</a>, <span class="s">&quot;Close&quot;</span>);
            }
 
            <span class="c">// Set &#39;Transfer-Encoding&#39;</span>
            <b>if</b> (<a href="#7d32088e491407a3" class="i property">TransferEncoding</a> != <b>null</b>)
            {
                <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">TransferEncodingChunked</span> = <b>true</b>;
                <b>var</b> <span id="r69 rd" class="r69 r">headerValue</span> = <b>new</b> <span class="i">TransferCodingHeaderValue</span>(<a href="#7d32088e491407a3" class="i property">TransferEncoding</a>);
                <b>if</b> (!<span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">TransferEncoding</span>.<span class="i">Contains</span>(<span class="r69 r">headerValue</span>))
                {
                    <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">TransferEncoding</span>.<span class="i">Add</span>(<span class="r69 r">headerValue</span>);
                }
            }
 
            <span class="c">// If the file to resume downloading exists, create the Range request header using the file size.</span>
            <span class="c">// If not, create a Range to request the entire file.</span>
            <b>if</b> (<a href="#a8d4db7f96323a3d" class="i property">Resume</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
            {
                <b>var</b> <span id="r70 rd" class="r70 r">fileInfo</span> = <b>new</b> <span class="i">FileInfo</span>(<a href="#862b1a7c65f11752" class="i property">QualifiedOutFile</a>);
                <b>if</b> (<span class="r70 r">fileInfo</span>.<span class="i">Exists</span>)
                {
                    <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">Range</span> = <b>new</b> <span class="i">RangeHeaderValue</span>(<span class="r70 r">fileInfo</span>.<span class="i">Length</span>, <b>null</b>);
                    <a href="#663f89127ba0774e" class="i field">_resumeFileSize</a> = <span class="r70 r">fileInfo</span>.<span class="i">Length</span>;
                }
                <b>else</b>
                {
                    <span class="r66 r">request</span>.<span class="i">Headers</span>.<span class="i">Range</span> = <b>new</b> <span class="i">RangeHeaderValue</span>(0, <b>null</b>);
                }
            }
 
            <b>return</b> (<span class="r66 r">request</span>);
        }
 
        <b>internal virtual void</b> <a id="ef755da33678a40a" href="../../../../R/ef755da33678a40a.html" target="n" data-glyph="74,1" class="i method">FillRequestStream</a>(<span class="i">HttpRequestMessage</span> <span id="r71 rd" class="r71 r">request</span>)
        {
            <b>if</b> (<span class="r71 r">request</span> == <b>null</b>) { <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r71 r">request</span>)); }
 
            <span class="c">// set the content type</span>
            <b>if</b> (<a href="#6d7073c1d428d9b8" class="i property">ContentType</a> != <b>null</b>)
            {
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>[<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#aef1b5a4814da727" class="i field">ContentType</a>] = <a href="#6d7073c1d428d9b8" class="i property">ContentType</a>;
                <span class="c">// request</span>
            }
            <span class="c">// ContentType == null</span>
            <b>else</b> <b>if</b> (<a href="#74e585d369a3c020" class="i property">Method</a> == <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#a2e6da164ee69249" class="i field">Post</a> || (<a href="#06e56f6d58759910" class="i method">IsCustomMethodSet</a>() &amp;&amp; <a href="#379786a8f95d3483" class="i property">CustomMethod</a>.<span class="i">ToUpperInvariant</span>() == <span class="s">&quot;POST&quot;</span>))
            {
                <span class="c">// Win8:545310 Invoke-WebRequest does not properly set MIME type for POST</span>
                <b>string</b> <span id="r72 rd" class="r72 r">contentType</span> = <b>null</b>;
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>.<span class="i">TryGetValue</span>(<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#aef1b5a4814da727" class="i field">ContentType</a>, <b>out</b> <span class="r72 r">contentType</span>);
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r72 r">contentType</span>))
                {
                    <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>[<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#aef1b5a4814da727" class="i field">ContentType</a>] = <span class="s">&quot;application/x-www-form-urlencoded&quot;</span>;
                }
            }
 
            <b>if</b> (<a href="#6d4985fb6371d4a7" class="i property">Form</a> != <b>null</b>)
            {
                <span class="c">// Content headers will be set by MultipartFormDataContent which will throw unless we clear them first</span>
                <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>.<span class="i">Clear</span>();
 
                <b>var</b> <span id="r73 rd" class="r73 r">formData</span> = <b>new</b> <span class="i">MultipartFormDataContent</span>();
                <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r74 rd" class="r74 r">formEntry</span> <b>in</b> <a href="#6d4985fb6371d4a7" class="i property">Form</a>)
                {
                    <span class="c">// AddMultipartContent will handle PSObject unwrapping, Object type determination and enumerateing top level IEnumerables.</span>
                    <span class="i">AddMultipartContent</span>(<span class="i">fieldName</span>: <span class="r74 r">formEntry</span>.<span class="i">Key</span>, <span class="i">fieldValue</span>: <span class="r74 r">formEntry</span>.<span class="i">Value</span>, <span class="i">formData</span>: <span class="r73 r">formData</span>, <span class="i">enumerate</span>: <b>true</b>);
                }
 
                <a href="#1313ad47654026ff" class="i method">SetRequestContent</a>(<span class="r71 r">request</span>, <span class="r73 r">formData</span>);
            }
            <span class="c">// coerce body into a usable form</span>
            <b>else</b> <b>if</b> (<a href="#e02193261ccb98c9" class="i property">Body</a> != <b>null</b>)
            {
                <b>object</b> <span id="r75 rd" class="r75 r">content</span> = <a href="#e02193261ccb98c9" class="i property">Body</a>;
 
                <span class="c">// make sure we&#39;re using the base object of the body, not the PSObject wrapper</span>
                <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r76 rd" class="r76 r">psBody</span> = <a href="#e02193261ccb98c9" class="i property">Body</a> <b>as</b> <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
                <b>if</b> (<span class="r76 r">psBody</span> != <b>null</b>)
                {
                    <span class="r75 r">content</span> = <span class="r76 r">psBody</span>.<a href="/System.Management.Automation/A.html#d854d13536b70a12" class="i property">BaseObject</a>;
                }
 
                <b>if</b> (<span class="r75 r">content</span> <b>is</b> <a href="../FormObject.cs.html#8506cfa3c0492ef5" class="t t">FormObject</a> <span id="r77 rd" class="r77 r">form</span>)
                {
                    <span class="i">SetRequestContent</span>(<span class="r71 r">request</span>, <span class="r77 r">form</span>.<a href="../FormObject.cs.html#f39ae372417254c8" class="i property">Fields</a>);
                }
                <b>else</b> <b>if</b> (<span class="r75 r">content</span> <b>is</b> <span class="i">IDictionary</span> <span id="r78 rd" class="r78 r">dictionary</span> &amp;&amp; <span class="r71 r">request</span>.<span class="i">Method</span> != <span class="i">HttpMethod</span>.<span class="i">Get</span>)
                {
                    <a href="#d1bc98de629aa2af" class="i method">SetRequestContent</a>(<span class="r71 r">request</span>, <span class="r78 r">dictionary</span>);
                }
                <b>else</b> <b>if</b> (<span class="r75 r">content</span> <b>is</b> <span class="i">XmlNode</span> <span id="r79 rd" class="r79 r">xmlNode</span>)
                {
                    <a href="#a31c19db50789253" class="i method">SetRequestContent</a>(<span class="r71 r">request</span>, <span class="r79 r">xmlNode</span>);
                }
                <b>else</b> <b>if</b> (<span class="r75 r">content</span> <b>is</b> <span class="i">Stream</span> <span id="r80 rd" class="r80 r">stream</span>)
                {
                    <a href="#1a0aa09199ce628e" class="i method">SetRequestContent</a>(<span class="r71 r">request</span>, <span class="r80 r">stream</span>);
                }
                <b>else</b> <b>if</b> (<span class="r75 r">content</span> <b>is byte</b>[] <span id="r81 rd" class="r81 r">bytes</span>)
                {
                    <a href="#21149c1ec5bd7521" class="i method">SetRequestContent</a>(<span class="r71 r">request</span>, <span class="r81 r">bytes</span>);
                }
                <b>else</b> <b>if</b> (<span class="r75 r">content</span> <b>is</b> <span class="i">MultipartFormDataContent</span> <span id="r82 rd" class="r82 r">multipartFormDataContent</span>)
                {
                    <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>.<span class="i">Clear</span>();
                    <a href="#1313ad47654026ff" class="i method">SetRequestContent</a>(<span class="r71 r">request</span>, <span class="r82 r">multipartFormDataContent</span>);
                }
                <b>else</b>
                {
                    <a href="#16657052fa37ea3c" class="i method">SetRequestContent</a>(
                        <span class="r71 r">request</span>,
                        (<b>string</b>)<a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r75 r">content</span>, <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>));
                }
            }
            <b>else</b> <b>if</b> (<a href="#eb31d4a3b9df70c3" class="i property">InFile</a> != <b>null</b>) <span class="c">// copy InFile data</span>
            {
                <b>try</b>
                {
                    <span class="c">// open the input file</span>
                    <span class="i">SetRequestContent</span>(<span class="r71 r">request</span>, <b>new</b> <span class="i">FileStream</span>(<a href="#eb31d4a3b9df70c3" class="i property">InFile</a>, <span class="i">FileMode</span>.<span class="i">Open</span>, <span class="i">FileAccess</span>.<span class="i">Read</span>, <span class="i">FileShare</span>.<span class="i">Read</span>));
                }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span>)
                {
                    <b>string</b> <span id="r83 rd" class="r83 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="i">WebCmdletStrings</span>.<span class="i">AccessDenied</span>,
                                               <a href="#74d567b0df3669b0" class="i field">_originalFilePath</a>);
                    <b>throw</b> <b>new</b> <span class="i">UnauthorizedAccessException</span>(<span class="r83 r">msg</span>);
                }
            }
 
            <span class="c">// Add the content headers</span>
            <b>if</b> (<span class="r71 r">request</span>.<span class="i">Content</span> == <b>null</b>)
            {
                <span class="r71 r">request</span>.<span class="i">Content</span> = <b>new</b> <span class="i">StringContent</span>(<b>string</b>.<span class="i">Empty</span>);
                <span class="r71 r">request</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">Clear</span>();
            }
 
            <b>foreach</b> (<b>var</b> <span id="r84 rd" class="r84 r">entry</span> <b>in</b> <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#9d0cb180dca61a17" class="i property">ContentHeaders</a>)
            {
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r84 r">entry</span>.<span class="i">Value</span>))
                {
                    <b>if</b> (<a href="#5309431f15542894" class="i property">SkipHeaderValidation</a>)
                    {
                        <span class="r71 r">request</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">TryAddWithoutValidation</span>(<span class="r84 r">entry</span>.<span class="i">Key</span>, <span class="r84 r">entry</span>.<span class="i">Value</span>);
                    }
                    <b>else</b>
                    {
                        <b>try</b>
                        {
                            <span class="r71 r">request</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">Add</span>(<span class="r84 r">entry</span>.<span class="i">Key</span>, <span class="r84 r">entry</span>.<span class="i">Value</span>);
                        }
                        <b>catch</b> (<span class="i">FormatException</span> <span id="r85 rd" class="r85 r">ex</span>)
                        {
                            <a href="/System.Management.Automation/A.html#3a63a9fcbe2d56df" class="k">var</a> <span id="r86 rd" class="r86 r">outerEx</span> = <b>new</b> <span class="t">ValidationMetadataException</span>(<span class="i">WebCmdletStrings</span>.<span class="i">ContentTypeException</span>, <span class="r85 r">ex</span>);
                            <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r87 rd" class="r87 r">er</span> = <b>new</b>(<span class="r86 r">outerEx</span>, <span class="s">&quot;WebCmdletContentTypeException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="#6d7073c1d428d9b8" class="i property">ContentType</a>);
                            <span class="i">ThrowTerminatingError</span>(<span class="r87 r">er</span>);
                        }
                    }
                }
            }
        }
 
        <span class="c">// Returns true if the status code is one of the supported redirection codes.</span>
        <b>private static bool</b> <a id="7b21fc34c6e4c262" href="../../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsRedirectCode</a>(<span class="i">HttpStatusCode</span> <span id="r88 rd" class="r88 r">code</span>)
        {
            <b>int</b> <span id="r89 rd" class="r89 r">intCode</span> = (<b>int</b>)<span class="r88 r">code</span>;
            <b>return</b>
            (
                (<span class="r89 r">intCode</span> &gt;= 300 &amp;&amp; <span class="r89 r">intCode</span> &lt; 304)
                ||
                <span class="r89 r">intCode</span> == 307
            );
        }
 
        <span class="c">// Returns true if the status code is a redirection code and the action requires switching from POST to GET on redirection.</span>
        <span class="c">// NOTE: Some of these status codes map to the same underlying value but spelling them out for completeness.</span>
        <b>private static bool</b> <a id="5a141710e628cbf9" href="../../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsRedirectToGet</a>(<span class="i">HttpStatusCode</span> <span id="r90 rd" class="r90 r">code</span>)
        {
            <b>return</b>
            (
                <span class="r90 r">code</span> == <span class="i">HttpStatusCode</span>.<span class="i">Found</span>
                ||
                <span class="r90 r">code</span> == <span class="i">HttpStatusCode</span>.<span class="i">Moved</span>
                ||
                <span class="r90 r">code</span> == <span class="i">HttpStatusCode</span>.<span class="i">Redirect</span>
                ||
                <span class="r90 r">code</span> == <span class="i">HttpStatusCode</span>.<span class="i">RedirectMethod</span>
                ||
                <span class="r90 r">code</span> == <span class="i">HttpStatusCode</span>.<span class="i">SeeOther</span>
                ||
                <span class="r90 r">code</span> == <span class="i">HttpStatusCode</span>.<span class="i">Ambiguous</span>
                ||
                <span class="r90 r">code</span> == <span class="i">HttpStatusCode</span>.<span class="i">MultipleChoices</span>
            );
        }
 
        <b>private bool</b> <a id="9bcfc676f0bc61b9" href="../../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ShouldRetry</a>(<span class="i">HttpStatusCode</span> <span id="r91 rd" class="r91 r">code</span>)
        {
            <b>int</b> <span id="r92 rd" class="r92 r">intCode</span> = (<b>int</b>)<span class="r91 r">code</span>;
 
            <b>if</b> (((<span class="r92 r">intCode</span> == 304) || (<span class="r92 r">intCode</span> &gt;= 400 &amp;&amp; <span class="r92 r">intCode</span> &lt;= 599)) &amp;&amp; <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#83750dac0986a5e2" class="i property">MaximumRetryCount</a> &gt; 0)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal virtual</b> <span class="i">HttpResponseMessage</span> <a id="5d82612c6cc89779" href="../../../../R/5d82612c6cc89779.html" target="n" data-glyph="74,1" class="i method">GetResponse</a>(<span class="i">HttpClient</span> <span id="r93 rd" class="r93 r">client</span>, <span class="i">HttpRequestMessage</span> <span id="r94 rd" class="r94 r">request</span>, <b>bool</b> <span id="r95 rd" class="r95 r">keepAuthorization</span>)
        {
            <b>if</b> (<span class="r93 r">client</span> == <b>null</b>) { <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r93 r">client</span>)); }
 
            <b>if</b> (<span class="r94 r">request</span> == <b>null</b>) { <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r94 r">request</span>)); }
 
            <span class="c">// Add 1 to account for the first request.</span>
            <b>int</b> <span id="r96 rd" class="r96 r">totalRequests</span> = <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#83750dac0986a5e2" class="i property">MaximumRetryCount</a> + 1;
            <span class="i">HttpRequestMessage</span> <span id="r97 rd" class="r97 r">req</span> = <span class="r94 r">request</span>;
            <span class="i">HttpResponseMessage</span> <span id="r98 rd" class="r98 r">response</span> = <b>null</b>;
 
            <b>do</b>
            {
                <span class="c">// Track the current URI being used by various requests and re-requests.</span>
                <b>var</b> <span id="r99 rd" class="r99 r">currentUri</span> = <span class="r97 r">req</span>.<span class="i">RequestUri</span>;
 
                <a href="#0cceefd1240619f1" class="i field">_cancelToken</a> = <b>new</b> <span class="i">CancellationTokenSource</span>();
                <span class="r98 r">response</span> = <span class="r93 r">client</span>.<span class="i">SendAsync</span>(<span class="r97 r">req</span>, <span class="i">HttpCompletionOption</span>.<span class="i">ResponseHeadersRead</span>, <a href="#0cceefd1240619f1" class="i field">_cancelToken</a>.<span class="i">Token</span>).<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
 
                <b>if</b> (<span class="r95 r">keepAuthorization</span> &amp;&amp; <span class="i">IsRedirectCode</span>(<span class="r98 r">response</span>.<span class="i">StatusCode</span>) &amp;&amp; <span class="r98 r">response</span>.<span class="i">Headers</span>.<span class="i">Location</span> != <b>null</b>)
                {
                    <a href="#0cceefd1240619f1" class="i field">_cancelToken</a>.<span class="i">Cancel</span>();
                    <a href="#0cceefd1240619f1" class="i field">_cancelToken</a> = <b>null</b>;
 
                    <span class="c">// if explicit count was provided, reduce it for this redirection.</span>
                    <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d90c2182d8853bf7" class="i property">MaximumRedirection</a> &gt; 0)
                    {
                        <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d90c2182d8853bf7" class="i property">MaximumRedirection</a>--;
                    }
                    <span class="c">// For selected redirects that used POST, GET must be used with the</span>
                    <span class="c">// redirected Location.</span>
                    <span class="c">// Since GET is the default; POST only occurs when -Method POST is used.</span>
                    <b>if</b> (<a href="#74e585d369a3c020" class="i property">Method</a> == <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#a2e6da164ee69249" class="i field">Post</a> &amp;&amp; <span class="i">IsRedirectToGet</span>(<span class="r98 r">response</span>.<span class="i">StatusCode</span>))
                    {
                        <span class="c">// See https://msdn.microsoft.com/library/system.net.httpstatuscode(v=vs.110).aspx</span>
                        <a href="#74e585d369a3c020" class="i property">Method</a> = <a href="../WebRequestMethod.cs.html#15888b144941534b" class="t t">WebRequestMethod</a>.<a href="../WebRequestMethod.cs.html#625226d8de61274c" class="i field">Get</a>;
                    }
 
                    <span class="r99 r">currentUri</span> = <b>new</b> <span class="i">Uri</span>(<span class="r94 r">request</span>.<span class="i">RequestUri</span>, <span class="r98 r">response</span>.<span class="i">Headers</span>.<span class="i">Location</span>);
                    <span class="c">// Continue to handle redirection</span>
                    <b>using</b> (<span class="r93 r">client</span> = <a href="#6e2d89ee89769653" class="i method">GetHttpClient</a>(<span class="r60 r">handleRedirect</span>: <b>true</b>))
                    <b>using</b> (<span class="i">HttpRequestMessage</span> <span id="r100 rd" class="r100 r">redirectRequest</span> = <span class="i">GetRequest</span>(<span class="r99 r">currentUri</span>))
                    {
                        <span class="r98 r">response</span> = <a href="#5d82612c6cc89779" class="i method">GetResponse</a>(<span class="r93 r">client</span>, <span class="r100 r">redirectRequest</span>, <span class="r95 r">keepAuthorization</span>);
                    }
                }
 
                <span class="c">// Request again without the Range header because the server indicated the range was not satisfiable.</span>
                <span class="c">// This happens when the local file is larger than the remote file.</span>
                <span class="c">// If the size of the remote file is the same as the local file, there is nothing to resume.</span>
                <b>if</b> (<a href="#a8d4db7f96323a3d" class="i property">Resume</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a> &amp;&amp;
                    <span class="r98 r">response</span>.<span class="i">StatusCode</span> == <span class="i">HttpStatusCode</span>.<span class="i">RequestedRangeNotSatisfiable</span> &amp;&amp;
                    (<span class="r98 r">response</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">ContentRange</span>.<span class="i">HasLength</span> &amp;&amp;
                    <span class="r98 r">response</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">ContentRange</span>.<span class="i">Length</span> != <a href="#663f89127ba0774e" class="i field">_resumeFileSize</a>))
                {
                    <a href="#0cceefd1240619f1" class="i field">_cancelToken</a>.<span class="i">Cancel</span>();
 
                    <span class="i">WriteVerbose</span>(<span class="i">WebCmdletStrings</span>.<span class="i">WebMethodResumeFailedVerboseMsg</span>);
 
                    <span class="c">// Disable the Resume switch so the subsequent calls to GetResponse() and FillRequestStream()</span>
                    <span class="c">// are treated as a standard -OutFile request. This also disables appending local file.</span>
                    <a href="#a8d4db7f96323a3d" class="i property">Resume</a> = <b>new</b> <span class="t">SwitchParameter</span>(<b>false</b>);
 
                    <b>using</b> (<span class="i">HttpRequestMessage</span> <span id="r101 rd" class="r101 r">requestWithoutRange</span> = <span class="i">GetRequest</span>(<span class="r99 r">currentUri</span>))
                    {
                        <a href="#ef755da33678a40a" class="i method">FillRequestStream</a>(<span class="r101 r">requestWithoutRange</span>);
                        <b>long</b> <span id="r102 rd" class="r102 r">requestContentLength</span> = 0;
                        <b>if</b> (<span class="r101 r">requestWithoutRange</span>.<span class="i">Content</span> != <b>null</b>)
                        {
                            <span class="r102 r">requestContentLength</span> = <span class="r101 r">requestWithoutRange</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>.<span class="i">Value</span>;
                        }
 
                        <b>string</b> <span id="r103 rd" class="r103 r">reqVerboseMsg</span> = <b>string</b>.<span class="i">Format</span>(
                            <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                            <span class="i">WebCmdletStrings</span>.<span class="i">WebMethodInvocationVerboseMsg</span>,
                            <span class="r101 r">requestWithoutRange</span>.<span class="i">Method</span>,
                            <span class="r101 r">requestWithoutRange</span>.<span class="i">RequestUri</span>,
                            <span class="r102 r">requestContentLength</span>);
                        <span class="i">WriteVerbose</span>(<span class="r103 r">reqVerboseMsg</span>);
 
                        <b>return</b> <a href="#5d82612c6cc89779" class="i method">GetResponse</a>(<span class="r93 r">client</span>, <span class="r101 r">requestWithoutRange</span>, <span class="r95 r">keepAuthorization</span>);
                    }
                }
 
                <a href="#b6d68d53c18d5b4c" class="i field">_resumeSuccess</a> = <span class="r98 r">response</span>.<span class="i">StatusCode</span> == <span class="i">HttpStatusCode</span>.<span class="i">PartialContent</span>;
 
                <span class="c">// When MaximumRetryCount is not specified, the totalRequests == 1.</span>
                <b>if</b> (<span class="r96 r">totalRequests</span> &gt; 1 &amp;&amp; <span class="i">ShouldRetry</span>(<span class="r98 r">response</span>.<span class="i">StatusCode</span>))
                {
                    <b>string</b> <span id="r104 rd" class="r104 r">retryMessage</span> = <b>string</b>.<span class="i">Format</span>(
                        <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                        <span class="i">WebCmdletStrings</span>.<span class="i">RetryVerboseMsg</span>,
                        <a href="#4b390d8f440c1ad8" class="i property">RetryIntervalSec</a>,
                        <span class="r98 r">response</span>.<span class="i">StatusCode</span>);
 
                    <span class="i">WriteVerbose</span>(<span class="r104 r">retryMessage</span>);
 
                    <a href="#0cceefd1240619f1" class="i field">_cancelToken</a> = <b>new</b> <span class="i">CancellationTokenSource</span>();
                    <span class="i">Task</span>.<span class="i">Delay</span>(<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#c112890028cb191b" class="i property">RetryIntervalInSeconds</a> * 1000, <a href="#0cceefd1240619f1" class="i field">_cancelToken</a>.<span class="i">Token</span>).<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
                    <a href="#0cceefd1240619f1" class="i field">_cancelToken</a>.<span class="i">Cancel</span>();
                    <a href="#0cceefd1240619f1" class="i field">_cancelToken</a> = <b>null</b>;
 
                    <span class="r97 r">req</span>.<span class="i">Dispose</span>();
                    <span class="r97 r">req</span> = <span class="i">GetRequest</span>(<span class="r99 r">currentUri</span>);
                    <a href="#ef755da33678a40a" class="i method">FillRequestStream</a>(<span class="r97 r">req</span>);
                }
 
                <span class="r96 r">totalRequests</span>--;
            }
            <b>while</b> (<span class="r96 r">totalRequests</span> &gt; 0 &amp;&amp; !<span class="r98 r">response</span>.<span class="i">IsSuccessStatusCode</span>);
 
            <b>return</b> <span class="r98 r">response</span>;
        }
 
        <b>internal virtual void</b> <a id="07758043dc61d3ab" href="../../../../R/07758043dc61d3ab.html" target="n" data-glyph="74,1" class="i method">UpdateSession</a>(<span class="i">HttpResponseMessage</span> <span id="r105 rd" class="r105 r">response</span>)
        {
            <b>if</b> (<span class="r105 r">response</span> == <b>null</b>) { <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r105 r">response</span>)); }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Virtual Methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The main execution method for cmdlets derived from WebRequestPSCmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="f1742bab3732a4ad" href="../../../../R/f1742bab3732a4ad.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>try</b>
            {
                <span class="c">// Set cmdlet context for write progress</span>
                <a href="#d22968ae9a3c71af" class="i method">ValidateParameters</a>();
                <a href="#ab6900abbb21312d" class="i method">PrepareSession</a>();
 
                <span class="c">// if the request contains an authorization header and PreserveAuthorizationOnRedirect is not set,</span>
                <span class="c">// it needs to be stripped on the first redirect.</span>
                <b>bool</b> <span id="r106 rd" class="r106 r">keepAuthorization</span> = <a href="#90d74702f865f3cb" class="i property">WebSession</a> != <b>null</b>
                                          &amp;&amp;
                                          <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a> != <b>null</b>
                                          &amp;&amp;
                                          <a href="#5cd6d61afe1ba597" class="i property">PreserveAuthorizationOnRedirect</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>
                                          &amp;&amp;
                                          <a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#992413537acec567" class="i property">Headers</a>.<span class="i">ContainsKey</span>(<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#e01d9c53e8038f77" class="t t">HttpKnownHeaderNames</a>.<a href="../CoreCLR/HttpKnownHeaderNames.cs.html#01cb2555a9611889" class="i field">Authorization</a>);
 
                <b>using</b> (<span class="i">HttpClient</span> <span id="r107 rd" class="r107 r">client</span> = <a href="#6e2d89ee89769653" class="i method">GetHttpClient</a>(<span class="r106 r">keepAuthorization</span>))
                {
                    <b>int</b> <span id="r108 rd" class="r108 r">followedRelLink</span> = 0;
                    <span class="i">Uri</span> <span id="r109 rd" class="r109 r">uri</span> = <a href="#34135773a270f628" class="i property">Uri</a>;
                    <b>do</b>
                    {
                        <b>if</b> (<span class="r108 r">followedRelLink</span> &gt; 0)
                        {
                            <b>string</b> <span id="r110 rd" class="r110 r">linkVerboseMsg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                                <span class="i">WebCmdletStrings</span>.<span class="i">FollowingRelLinkVerboseMsg</span>,
                                <span class="r109 r">uri</span>.<span class="i">AbsoluteUri</span>);
                            <span class="i">WriteVerbose</span>(<span class="r110 r">linkVerboseMsg</span>);
                        }
 
                        <b>using</b> (<span class="i">HttpRequestMessage</span> <span id="r111 rd" class="r111 r">request</span> = <a href="#7ab86501a5ea82bc" class="i method">GetRequest</a>(<span class="r109 r">uri</span>))
                        {
                            <a href="#ef755da33678a40a" class="i method">FillRequestStream</a>(<span class="r111 r">request</span>);
                            <b>try</b>
                            {
                                <b>long</b> <span id="r112 rd" class="r112 r">requestContentLength</span> = 0;
                                <b>if</b> (<span class="r111 r">request</span>.<span class="i">Content</span> != <b>null</b>)
                                    <span class="r112 r">requestContentLength</span> = <span class="r111 r">request</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>.<span class="i">Value</span>;
 
                                <b>string</b> <span id="r113 rd" class="r113 r">reqVerboseMsg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                                    <span class="i">WebCmdletStrings</span>.<span class="i">WebMethodInvocationVerboseMsg</span>,
                                    <span class="r111 r">request</span>.<span class="i">Method</span>,
                                    <span class="r112 r">requestContentLength</span>);
                                <span class="i">WriteVerbose</span>(<span class="r113 r">reqVerboseMsg</span>);
 
                                <span class="i">HttpResponseMessage</span> <span id="r114 rd" class="r114 r">response</span> = <a href="#5d82612c6cc89779" class="i method">GetResponse</a>(<span class="r107 r">client</span>, <span class="r111 r">request</span>, <span class="r106 r">keepAuthorization</span>);
 
                                <b>string</b> <span id="r115 rd" class="r115 r">contentType</span> = <a href="ContentHelper.Common.cs.html#a2c3d2d23cfdf964" class="t t">ContentHelper</a>.<a href="ContentHelper.Common.cs.html#44e28e8c2b9a8884" class="i method">GetContentType</a>(<span class="r114 r">response</span>);
                                <b>string</b> <span id="r116 rd" class="r116 r">respVerboseMsg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                                    <span class="i">WebCmdletStrings</span>.<span class="i">WebResponseVerboseMsg</span>,
                                    <span class="r114 r">response</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>,
                                    <span class="r115 r">contentType</span>);
                                <span class="i">WriteVerbose</span>(<span class="r116 r">respVerboseMsg</span>);
 
                                <b>bool</b> <span id="r117 rd" class="r117 r">_isSuccess</span> = <span class="r114 r">response</span>.<span class="i">IsSuccessStatusCode</span>;
 
                                <span class="c">// Check if the Resume range was not satisfiable because the file already completed downloading.</span>
                                <span class="c">// This happens when the local file is the same size as the remote file.</span>
                                <b>if</b> (<a href="#a8d4db7f96323a3d" class="i property">Resume</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a> &amp;&amp;
                                    <span class="r114 r">response</span>.<span class="i">StatusCode</span> == <span class="i">HttpStatusCode</span>.<span class="i">RequestedRangeNotSatisfiable</span> &amp;&amp;
                                    <span class="r114 r">response</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">ContentRange</span>.<span class="i">HasLength</span> &amp;&amp;
                                    <span class="r114 r">response</span>.<span class="i">Content</span>.<span class="i">Headers</span>.<span class="i">ContentRange</span>.<span class="i">Length</span> == <a href="#663f89127ba0774e" class="i field">_resumeFileSize</a>)
                                {
                                    <span class="r117 r">_isSuccess</span> = <b>true</b>;
                                    <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">WebCmdletStrings</span>.<span class="i">OutFileWritingSkipped</span>, <a href="#99187f0dc270ed73" class="i property">OutFile</a>));
                                    <span class="c">// Disable writing to the OutFile.</span>
                                    <a href="#99187f0dc270ed73" class="i property">OutFile</a> = <b>null</b>;
                                }
 
                                <b>if</b> (<a href="#72fafa0525bcafad" class="i property">ShouldCheckHttpStatus</a> &amp;&amp; !<span class="r117 r">_isSuccess</span>)
                                {
                                    <b>string</b> <span id="r118 rd" class="r118 r">message</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">WebCmdletStrings</span>.<span class="i">ResponseStatusCodeFailure</span>,
                                        (<b>int</b>)<span class="r114 r">response</span>.<span class="i">StatusCode</span>, <span class="r114 r">response</span>.<span class="i">ReasonPhrase</span>);
                                    <a href="#b0fd2c5f826397aa" class="t t">HttpResponseException</a> <span id="r119 rd" class="r119 r">httpEx</span> = <b>new</b>(<span class="r118 r">message</span>, <span class="r114 r">response</span>);
                                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r120 rd" class="r120 r">er</span> = <b>new</b>(<span class="r119 r">httpEx</span>, <span class="s">&quot;WebCmdletWebResponseException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r111 r">request</span>);
                                    <b>string</b> <span id="r121 rd" class="r121 r">detailMsg</span> = <b>string</b>.<span class="i">Empty</span>;
                                    <span class="i">StreamReader</span> <span id="r122 rd" class="r122 r">reader</span> = <b>null</b>;
                                    <b>try</b>
                                    {
                                        <span class="r122 r">reader</span> = <b>new</b> <span class="i">StreamReader</span>(<a href="../StreamHelper.cs.html#feacf5faafa43405" class="t t">StreamHelper</a>.<a href="../StreamHelper.cs.html#2ba676a5705cd62c" class="i method">GetResponseStream</a>(<span class="r114 r">response</span>));
                                        <span class="c">// remove HTML tags making it easier to read</span>
                                        <span class="r121 r">detailMsg</span> = <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">Regex</span>.<span class="i">Replace</span>(<span class="r122 r">reader</span>.<span class="i">ReadToEnd</span>(), <span class="s">&quot;&lt;[^&gt;]*&gt;&quot;</span>, <b>string</b>.<span class="i">Empty</span>);
                                    }
                                    <b>catch</b> (<span class="i">Exception</span>)
                                    {
                                        <span class="c">// catch all</span>
                                    }
                                    <b>finally</b>
                                    {
                                        <b>if</b> (<span class="r122 r">reader</span> != <b>null</b>)
                                        {
                                            <span class="r122 r">reader</span>.<span class="i">Dispose</span>();
                                        }
                                    }
 
                                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r121 r">detailMsg</span>))
                                    {
                                        <span class="r120 r">er</span>.<span class="i">ErrorDetails</span> = <b>new</b> <span class="t">ErrorDetails</span>(<span class="r121 r">detailMsg</span>);
                                    }
 
                                    <span class="i">ThrowTerminatingError</span>(<span class="r120 r">er</span>);
                                }
 
                                <b>if</b> (<a href="#aa5ca097609e5a41" class="i field">_parseRelLink</a> || <a href="#5c2134156fa5eee2" class="i field">_followRelLink</a>)
                                {
                                    <span class="i">ParseLinkHeader</span>(<span class="r114 r">response</span>, <span class="r109 r">uri</span>);
                                }
 
                                <a href="#b9b51b2d6b5d2080" class="i method">ProcessResponse</a>(<span class="r114 r">response</span>);
                                <a href="#07758043dc61d3ab" class="i method">UpdateSession</a>(<span class="r114 r">response</span>);
 
                                <span class="c">// If we hit our maximum redirection count, generate an error.</span>
                                <span class="c">// Errors with redirection counts of greater than 0 are handled automatically by .NET, but are</span>
                                <span class="c">// impossible to detect programmatically when we hit this limit. By handling this ourselves</span>
                                <span class="c">// (and still writing out the result), users can debug actual HTTP redirect problems.</span>
                                <b>if</b> (<a href="#90d74702f865f3cb" class="i property">WebSession</a>.<a href="../WebRequestSession.cs.html#d90c2182d8853bf7" class="i property">MaximumRedirection</a> == 0) <span class="c">// Indicate &quot;HttpClientHandler.AllowAutoRedirect == false&quot;</span>
                                {
                                    <b>if</b> (<span class="r114 r">response</span>.<span class="i">StatusCode</span> == <span class="i">HttpStatusCode</span>.<span class="i">Found</span> ||
                                        <span class="r114 r">response</span>.<span class="i">StatusCode</span> == <span class="i">HttpStatusCode</span>.<span class="i">Moved</span> ||
                                        <span class="r114 r">response</span>.<span class="i">StatusCode</span> == <span class="i">HttpStatusCode</span>.<span class="i">MovedPermanently</span>)
                                    {
                                        <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r123 rd" class="r123 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(), <span class="s">&quot;MaximumRedirectExceeded&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r111 r">request</span>);
                                        <span class="r123 r">er</span>.<span class="i">ErrorDetails</span> = <b>new</b> <span class="t">ErrorDetails</span>(<span class="i">WebCmdletStrings</span>.<span class="i">MaximumRedirectionCountExceeded</span>);
                                        <span class="i">WriteError</span>(<span class="r123 r">er</span>);
                                    }
                                }
                            }
                            <b>catch</b> (<span class="i">HttpRequestException</span> <span id="r124 rd" class="r124 r">ex</span>)
                            {
                                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r125 rd" class="r125 r">er</span> = <b>new</b>(<span class="r124 r">ex</span>, <span class="s">&quot;WebCmdletWebResponseException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r111 r">request</span>);
                                <b>if</b> (<span class="r124 r">ex</span>.<span class="i">InnerException</span> != <b>null</b>)
                                {
                                    <span class="r125 r">er</span>.<span class="i">ErrorDetails</span> = <b>new</b> <span class="t">ErrorDetails</span>(<span class="r124 r">ex</span>.<span class="i">InnerException</span>.<span class="i">Message</span>);
                                }
 
                                <span class="i">ThrowTerminatingError</span>(<span class="r125 r">er</span>);
                            }
 
                            <b>if</b> (<a href="#5c2134156fa5eee2" class="i field">_followRelLink</a>)
                            {
                                <b>if</b> (!<a href="#531b58a467f9130f" class="i field">_relationLink</a>.<span class="i">ContainsKey</span>(<span class="s">&quot;next&quot;</span>))
                                {
                                    <b>return</b>;
                                }
 
                                <span class="r109 r">uri</span> = <b>new</b> <span class="i">Uri</span>(<a href="#531b58a467f9130f" class="i field">_relationLink</a>[<span class="s">&quot;next&quot;</span>]);
                                <span class="r108 r">followedRelLink</span>++;
                            }
                        }
                    }
                    <b>while</b> (<a href="#5c2134156fa5eee2" class="i field">_followRelLink</a> &amp;&amp; (<span class="r108 r">followedRelLink</span> &lt; <a href="#2c0a1ccaad7bbcdc" class="i field">_maximumFollowRelLink</a>));
                }
            }
            <b>catch</b> (<span class="i">CryptographicException</span> <span id="r126 rd" class="r126 r">ex</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r127 rd" class="r127 r">er</span> = <b>new</b>(<span class="r126 r">ex</span>, <span class="s">&quot;WebCmdletCertificateException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#f13302898d557be4" class="i field">SecurityError</a>, <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r127 r">er</span>);
            }
            <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r128 rd" class="r128 r">ex</span>)
            {
                <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r129 rd" class="r129 r">er</span> = <b>new</b>(<span class="r128 r">ex</span>, <span class="s">&quot;WebCmdletIEDomNotSupportedException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#8088845be39ec60c" class="i field">NotImplemented</a>, <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r129 r">er</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implementing ^C, after start the BeginGetResponse.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="f17409377beba2e1" href="../../../../R/f17409377beba2e1.html" target="n" data-glyph="75,1" class="i method">StopProcessing</a>()
        {
            <b>if</b> (<a href="#0cceefd1240619f1" class="i field">_cancelToken</a> != <b>null</b>)
            {
                <a href="#0cceefd1240619f1" class="i field">_cancelToken</a>.<span class="i">Cancel</span>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helper Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the ContentLength property of the request and writes the specified content to the request&#39;s RequestStream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r130 r">request</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The WebRequest who&#39;s content is to be set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r131 r">content</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A byte array containing the content data.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The number of bytes written to the requests RequestStream (and the new value of the request&#39;s ContentLength property.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Because this function sets the request&#39;s ContentLength property and writes content data into the requests&#39;s stream,</span>
        <span class="c">///</span><span class="c"> it should be called one time maximum on a given request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal long</b> <a id="21149c1ec5bd7521" href="../../../../R/21149c1ec5bd7521.html" target="n" data-glyph="74,1" class="i method">SetRequestContent</a>(<span class="i">HttpRequestMessage</span> <span id="r130 rd" class="r130 r">request</span>, <b>byte</b>[] <span id="r131 rd" class="r131 r">content</span>)
        {
            <b>if</b> (<span class="r130 r">request</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r130 r">request</span>));
            <b>if</b> (<span class="r131 r">content</span> == <b>null</b>)
                <b>return</b> 0;
 
            <b>var</b> <span id="r132 rd" class="r132 r">byteArrayContent</span> = <b>new</b> <span class="i">ByteArrayContent</span>(<span class="r131 r">content</span>);
            <span class="r130 r">request</span>.<span class="i">Content</span> = <span class="r132 r">byteArrayContent</span>;
 
            <b>return</b> <span class="r132 r">byteArrayContent</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>.<span class="i">Value</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the ContentLength property of the request and writes the specified content to the request&#39;s RequestStream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r133 r">request</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The WebRequest who&#39;s content is to be set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r134 r">content</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A String object containing the content data.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The number of bytes written to the requests RequestStream (and the new value of the request&#39;s ContentLength property.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Because this function sets the request&#39;s ContentLength property and writes content data into the requests&#39;s stream,</span>
        <span class="c">///</span><span class="c"> it should be called one time maximum on a given request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal long</b> <a id="16657052fa37ea3c" href="../../../../R/16657052fa37ea3c.html" target="n" data-glyph="74,1" class="i method">SetRequestContent</a>(<span class="i">HttpRequestMessage</span> <span id="r133 rd" class="r133 r">request</span>, <b>string</b> <span id="r134 rd" class="r134 r">content</span>)
        {
            <b>if</b> (<span class="r133 r">request</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r133 r">request</span>));
 
            <b>if</b> (<span class="r134 r">content</span> == <b>null</b>)
                <b>return</b> 0;
 
            <span class="i">Encoding</span> <span id="r135 rd" class="r135 r">encoding</span> = <b>null</b>;
            <b>if</b> (<a href="#6d7073c1d428d9b8" class="i property">ContentType</a> != <b>null</b>)
            {
                <span class="c">// If Content-Type contains the encoding format (as CharSet), use this encoding format</span>
                <span class="c">// to encode the Body of the WebRequest sent to the server. Default Encoding format</span>
                <span class="c">// would be used if Charset is not supplied in the Content-Type property.</span>
                <b>try</b>
                {
                    <b>var</b> <span id="r136 rd" class="r136 r">mediaTypeHeaderValue</span> = <span class="i">MediaTypeHeaderValue</span>.<span class="i">Parse</span>(<a href="#6d7073c1d428d9b8" class="i property">ContentType</a>);
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r136 r">mediaTypeHeaderValue</span>.<span class="i">CharSet</span>))
                    {
                        <span class="r135 r">encoding</span> = <span class="i">Encoding</span>.<span class="i">GetEncoding</span>(<span class="r136 r">mediaTypeHeaderValue</span>.<span class="i">CharSet</span>);
                    }
                }
                <b>catch</b> (<span class="i">FormatException</span> <span id="r137 rd" class="r137 r">ex</span>)
                {
                    <b>if</b> (!<a href="#5309431f15542894" class="i property">SkipHeaderValidation</a>)
                    {
                        <a href="/System.Management.Automation/A.html#3a63a9fcbe2d56df" class="k">var</a> <span id="r138 rd" class="r138 r">outerEx</span> = <b>new</b> <span class="t">ValidationMetadataException</span>(<span class="i">WebCmdletStrings</span>.<span class="i">ContentTypeException</span>, <span class="r137 r">ex</span>);
                        <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r139 rd" class="r139 r">er</span> = <b>new</b>(<span class="r138 r">outerEx</span>, <span class="s">&quot;WebCmdletContentTypeException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="#6d7073c1d428d9b8" class="i property">ContentType</a>);
                        <span class="i">ThrowTerminatingError</span>(<span class="r139 r">er</span>);
                    }
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r140 rd" class="r140 r">ex</span>)
                {
                    <b>if</b> (!<a href="#5309431f15542894" class="i property">SkipHeaderValidation</a>)
                    {
                        <a href="/System.Management.Automation/A.html#3a63a9fcbe2d56df" class="k">var</a> <span id="r141 rd" class="r141 r">outerEx</span> = <b>new</b> <span class="t">ValidationMetadataException</span>(<span class="i">WebCmdletStrings</span>.<span class="i">ContentTypeException</span>, <span class="r140 r">ex</span>);
                        <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r142 rd" class="r142 r">er</span> = <b>new</b>(<span class="r141 r">outerEx</span>, <span class="s">&quot;WebCmdletContentTypeException&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="#6d7073c1d428d9b8" class="i property">ContentType</a>);
                        <span class="i">ThrowTerminatingError</span>(<span class="r142 r">er</span>);
                    }
                }
            }
 
            <b>byte</b>[] <span id="r143 rd" class="r143 r">bytes</span> = <a href="../StreamHelper.cs.html#feacf5faafa43405" class="t t">StreamHelper</a>.<a href="../StreamHelper.cs.html#565725894bb51d96" class="i method">EncodeToBytes</a>(<span class="r134 r">content</span>, <span class="r135 r">encoding</span>);
            <b>var</b> <span id="r144 rd" class="r144 r">byteArrayContent</span> = <b>new</b> <span class="i">ByteArrayContent</span>(<span class="r143 r">bytes</span>);
            <span class="r133 r">request</span>.<span class="i">Content</span> = <span class="r144 r">byteArrayContent</span>;
 
            <b>return</b> <span class="r144 r">byteArrayContent</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>.<span class="i">Value</span>;
        }
 
        <b>internal long</b> <a id="a31c19db50789253" href="../../../../R/a31c19db50789253.html" target="n" data-glyph="74,1" class="i method">SetRequestContent</a>(<span class="i">HttpRequestMessage</span> <span id="r145 rd" class="r145 r">request</span>, <span class="i">XmlNode</span> <span id="r146 rd" class="r146 r">xmlNode</span>)
        {
            <b>if</b> (<span class="r145 r">request</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r145 r">request</span>));
 
            <b>if</b> (<span class="r146 r">xmlNode</span> == <b>null</b>)
                <b>return</b> 0;
 
            <b>byte</b>[] <span id="r147 rd" class="r147 r">bytes</span> = <b>null</b>;
            <span class="i">XmlDocument</span> <span id="r148 rd" class="r148 r">doc</span> = <span class="r146 r">xmlNode</span> <b>as</b> <span class="i">XmlDocument</span>;
            <b>if</b> (<span class="r148 r">doc</span>?.<span class="i">FirstChild</span> <b>is</b> <span class="i">XmlDeclaration</span>)
            {
                <span class="i">XmlDeclaration</span> <span id="r149 rd" class="r149 r">decl</span> = <span class="r148 r">doc</span>.<span class="i">FirstChild</span> <b>as</b> <span class="i">XmlDeclaration</span>;
                <span class="i">Encoding</span> <span id="r150 rd" class="r150 r">encoding</span> = <span class="i">Encoding</span>.<span class="i">GetEncoding</span>(<span class="r149 r">decl</span>.<span class="i">Encoding</span>);
                <span class="r147 r">bytes</span> = <a href="../StreamHelper.cs.html#feacf5faafa43405" class="t t">StreamHelper</a>.<span class="i">EncodeToBytes</span>(<span class="r148 r">doc</span>.<span class="i">OuterXml</span>, <span class="r150 r">encoding</span>);
            }
            <b>else</b>
            {
                <span class="r147 r">bytes</span> = <a href="../StreamHelper.cs.html#feacf5faafa43405" class="t t">StreamHelper</a>.<span class="i">EncodeToBytes</span>(<span class="r146 r">xmlNode</span>.<span class="i">OuterXml</span>);
            }
 
            <b>var</b> <span id="r151 rd" class="r151 r">byteArrayContent</span> = <b>new</b> <span class="i">ByteArrayContent</span>(<span class="r147 r">bytes</span>);
            <span class="r145 r">request</span>.<span class="i">Content</span> = <span class="r151 r">byteArrayContent</span>;
 
            <b>return</b> <span class="r151 r">byteArrayContent</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>.<span class="i">Value</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the ContentLength property of the request and writes the specified content to the request&#39;s RequestStream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r152 r">request</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The WebRequest who&#39;s content is to be set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r153 r">contentStream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A Stream object containing the content data.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The number of bytes written to the requests RequestStream (and the new value of the request&#39;s ContentLength property.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Because this function sets the request&#39;s ContentLength property and writes content data into the requests&#39;s stream,</span>
        <span class="c">///</span><span class="c"> it should be called one time maximum on a given request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal long</b> <a id="1a0aa09199ce628e" href="../../../../R/1a0aa09199ce628e.html" target="n" data-glyph="74,1" class="i method">SetRequestContent</a>(<span class="i">HttpRequestMessage</span> <span id="r152 rd" class="r152 r">request</span>, <span class="i">Stream</span> <span id="r153 rd" class="r153 r">contentStream</span>)
        {
            <b>if</b> (<span class="r152 r">request</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r152 r">request</span>));
            <b>if</b> (<span class="r153 r">contentStream</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r153 r">contentStream</span>));
 
            <b>var</b> <span id="r154 rd" class="r154 r">streamContent</span> = <b>new</b> <span class="i">StreamContent</span>(<span class="r153 r">contentStream</span>);
            <span class="r152 r">request</span>.<span class="i">Content</span> = <span class="r154 r">streamContent</span>;
 
            <b>return</b> <span class="r154 r">streamContent</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>.<span class="i">Value</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the ContentLength property of the request and writes the specified content to the request&#39;s RequestStream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r155 r">request</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The WebRequest who&#39;s content is to be set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r156 r">multipartContent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A MultipartFormDataContent object containing multipart/form-data content.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The number of bytes written to the requests RequestStream (and the new value of the request&#39;s ContentLength property.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Because this function sets the request&#39;s ContentLength property and writes content data into the requests&#39;s stream,</span>
        <span class="c">///</span><span class="c"> it should be called one time maximum on a given request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal long</b> <a id="1313ad47654026ff" href="../../../../R/1313ad47654026ff.html" target="n" data-glyph="74,1" class="i method">SetRequestContent</a>(<span class="i">HttpRequestMessage</span> <span id="r155 rd" class="r155 r">request</span>, <span class="i">MultipartFormDataContent</span> <span id="r156 rd" class="r156 r">multipartContent</span>)
        {
            <b>if</b> (<span class="r155 r">request</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r155 r">request</span>));
            }
 
            <b>if</b> (<span class="r156 r">multipartContent</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r156 r">multipartContent</span>));
            }
 
            <span class="r155 r">request</span>.<span class="i">Content</span> = <span class="r156 r">multipartContent</span>;
 
            <b>return</b> <span class="r156 r">multipartContent</span>.<span class="i">Headers</span>.<span class="i">ContentLength</span>.<span class="i">Value</span>;
        }
 
        <b>internal long</b> <a id="d1bc98de629aa2af" href="../../../../R/d1bc98de629aa2af.html" target="n" data-glyph="74,1" class="i method">SetRequestContent</a>(<span class="i">HttpRequestMessage</span> <span id="r157 rd" class="r157 r">request</span>, <span class="i">IDictionary</span> <span id="r158 rd" class="r158 r">content</span>)
        {
            <b>if</b> (<span class="r157 r">request</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r157 r">request</span>));
            <b>if</b> (<span class="r158 r">content</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r158 r">content</span>));
 
            <b>string</b> <span id="r159 rd" class="r159 r">body</span> = <a href="#78053927611db49a" class="i method">FormatDictionary</a>(<span class="r158 r">content</span>);
            <b>return</b> (<a href="#16657052fa37ea3c" class="i method">SetRequestContent</a>(<span class="r157 r">request</span>, <span class="r159 r">body</span>));
        }
 
        <b>internal void</b> <a id="2b803526e1eec1f9" href="../../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ParseLinkHeader</a>(<span class="i">HttpResponseMessage</span> <span id="r160 rd" class="r160 r">response</span>, <span class="i n">System</span>.<span class="i">Uri</span> <span id="r161 rd" class="r161 r">requestUri</span>)
        {
            <b>if</b> (<a href="#531b58a467f9130f" class="i field">_relationLink</a> == <b>null</b>)
            {
                <span class="c">// Must ignore the case of relation links. See RFC 8288 (https://tools.ietf.org/html/rfc8288)</span>
                <a href="#531b58a467f9130f" class="i field">_relationLink</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            }
            <b>else</b>
            {
                <a href="#531b58a467f9130f" class="i field">_relationLink</a>.<span class="i">Clear</span>();
            }
 
            <span class="c">// we only support the URL in angle brackets and `rel`, other attributes are ignored</span>
            <span class="c">// user can still parse it themselves via the Headers property</span>
            <b>const string</b> <span id="r162 rd" class="r162 r">pattern</span> = <span class="s">&quot;&lt;(?&lt;url&gt;.*?)&gt;;\\s*rel=(?&lt;quoted&gt;\&quot;)?(?&lt;rel&gt;(?(quoted).*?|[^,;]*))(?(quoted)\&quot;)&quot;</span>;
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r163 rd" class="r163 r">links</span>;
            <b>if</b> (<span class="r160 r">response</span>.<span class="i">Headers</span>.<span class="i">TryGetValues</span>(<span class="s">&quot;Link&quot;</span>, <b>out</b> <span class="r163 r">links</span>))
            {
                <b>foreach</b> (<b>string</b> <span id="r164 rd" class="r164 r">linkHeader</span> <b>in</b> <span class="r163 r">links</span>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r165 rd" class="r165 r">link</span> <b>in</b> <span class="r164 r">linkHeader</span>.<span class="i">Split</span>(<span class="s">&#39;,&#39;</span>))
                    {
                        <span class="i">Match</span> <span id="r166 rd" class="r166 r">match</span> = <span class="i">Regex</span>.<span class="i">Match</span>(<span class="r165 r">link</span>, <span class="r162 r">pattern</span>);
                        <b>if</b> (<span class="r166 r">match</span>.<span class="i">Success</span>)
                        {
                            <b>string</b> <span id="r167 rd" class="r167 r">url</span> = <span class="r166 r">match</span>.<span class="i">Groups</span>[<span class="s">&quot;url&quot;</span>].<span class="i">Value</span>;
                            <b>string</b> <span id="r168 rd" class="r168 r">rel</span> = <span class="r166 r">match</span>.<span class="i">Groups</span>[<span class="s">&quot;rel&quot;</span>].<span class="i">Value</span>;
                            <b>if</b> (<span class="r167 r">url</span> != <b>string</b>.<span class="i">Empty</span> &amp;&amp; <span class="r168 r">rel</span> != <b>string</b>.<span class="i">Empty</span> &amp;&amp; !<a href="#531b58a467f9130f" class="i field">_relationLink</a>.<span class="i">ContainsKey</span>(<span class="r168 r">rel</span>))
                            {
                                <span class="i">Uri</span> <span id="r169 rd" class="r169 r">absoluteUri</span> = <b>new</b>(<span class="r161 r">requestUri</span>, <span class="r167 r">url</span>);
                                <a href="#531b58a467f9130f" class="i field">_relationLink</a>.<span class="i">Add</span>(<span class="r168 r">rel</span>, <span class="r169 r">absoluteUri</span>.<span class="i">AbsoluteUri</span>);
                            }
                        }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds content to a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">MultipartFormDataContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. Object type detection is used to determine if the value is string, File, or Collection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r170 r">fieldName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Field Name to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r171 r">fieldValue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Field Value to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r172 r">formData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">MultipartFormDataContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&gt; to update.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r173 r">enumerate</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true, collection types in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r171 r">fieldValue</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> will be enumerated. If false, collections will be treated as single value.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="9e6fab510788babf" href="../../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AddMultipartContent</a>(<b>object</b> <span id="r170 rd" class="r170 r">fieldName</span>, <b>object</b> <span id="r171 rd" class="r171 r">fieldValue</span>, <span class="i">MultipartFormDataContent</span> <span id="r172 rd" class="r172 r">formData</span>, <b>bool</b> <span id="r173 rd" class="r173 r">enumerate</span>)
        {
            <b>if</b> (<span class="r172 r">formData</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r172 r">formData</span>));
            }
 
            <span class="c">// It is possible that the dictionary keys or values are PSObject wrapped depending on how the dictionary is defined and assigned.</span>
            <span class="c">// Before processing the field name and value we need to ensure we are working with the base objects and not the PSObject wrappers.</span>
 
            <span class="c">// Unwrap fieldName PSObjects</span>
            <b>if</b> (<span class="r170 r">fieldName</span> <b>is</b> <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r174 rd" class="r174 r">namePSObject</span>)
            {
                <span class="r170 r">fieldName</span> = <span class="r174 r">namePSObject</span>.<a href="/System.Management.Automation/A.html#d854d13536b70a12" class="i property">BaseObject</a>;
            }
 
            <span class="c">// Unwrap fieldValue PSObjects</span>
            <b>if</b> (<span class="r171 r">fieldValue</span> <b>is</b> <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r175 rd" class="r175 r">valuePSObject</span>)
            {
                <span class="r171 r">fieldValue</span> = <span class="r175 r">valuePSObject</span>.<a href="/System.Management.Automation/A.html#d854d13536b70a12" class="i property">BaseObject</a>;
            }
 
            <span class="c">// Treat a single FileInfo as a FileContent</span>
            <b>if</b> (<span class="r171 r">fieldValue</span> <b>is</b> <span class="i">FileInfo</span> <span id="r176 rd" class="r176 r">file</span>)
            {
                <span class="r172 r">formData</span>.<span class="i">Add</span>(<a href="#c48478c870e214d0" class="i method">GetMultipartFileContent</a>(<span class="r177 r">fieldName</span>: <span class="r170 r">fieldName</span>, <span class="r178 r">file</span>: <span class="r176 r">file</span>));
                <b>return</b>;
            }
 
            <span class="c">// Treat Strings and other single values as a StringContent.</span>
            <span class="c">// If enumeration is false, also treat IEnumerables as StringContents.</span>
            <span class="c">// String implements IEnumerable so the explicit check is required.</span>
            <b>if</b> (!<span class="r173 r">enumerate</span> || <span class="r171 r">fieldValue</span> <b>is string</b> || <span class="r171 r">fieldValue</span> <b>is not</b> <span class="i">IEnumerable</span>)
            {
                <span class="r172 r">formData</span>.<span class="i">Add</span>(<a href="#f58b1af5e20dc753" class="i method">GetMultipartStringContent</a>(<span class="r179 r">fieldName</span>: <span class="r170 r">fieldName</span>, <span class="r180 r">fieldValue</span>: <span class="r171 r">fieldValue</span>));
                <b>return</b>;
            }
 
            <span class="c">// Treat the value as a collection and enumerate it if enumeration is true</span>
            <b>if</b> (<span class="r173 r">enumerate</span> &amp;&amp; <span class="r171 r">fieldValue</span> <b>is</b> <span class="i">IEnumerable</span> <span id="r181 rd" class="r181 r">items</span>)
            {
                <b>foreach</b> (<b>var</b> <span id="r182 rd" class="r182 r">item</span> <b>in</b> <span class="r181 r">items</span>)
                {
                    <span class="c">// Recruse, but do not enumerate the next level. IEnumerables will be treated as single values.</span>
                    <span class="i">AddMultipartContent</span>(<span class="i">fieldName</span>: <span class="r170 r">fieldName</span>, <span class="i">fieldValue</span>: <span class="r182 r">item</span>, <span class="i">formData</span>: <span class="r172 r">formData</span>, <span class="i">enumerate</span>: <b>false</b>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StringContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> from the supplied field name and field value. Uses </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="/System.Management.Automation/A.html#8b9327b10b12742d" class="i method">ConvertTo</a>{<span class="r183 r t">T</span>}(<b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to convert the objects to strings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">fieldName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Field Name to use for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StringContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r180 r">fieldValue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Field Value to use for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StringContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">StringContent</span> <a id="f58b1af5e20dc753" href="../../../../R/f58b1af5e20dc753.html" target="n" data-glyph="76,1" class="i method">GetMultipartStringContent</a>(<b>object</b> <span id="r179 rd" class="r179 r">fieldName</span>, <b>object</b> <span id="r180 rd" class="r180 r">fieldValue</span>)
        {
            <b>var</b> <span id="r184 rd" class="r184 r">contentDisposition</span> = <b>new</b> <span class="i">ContentDispositionHeaderValue</span>(<span class="s">&quot;form-data&quot;</span>);
            <span class="c">// .NET does not enclose field names in quotes, however, modern browsers and curl do.</span>
            <span class="r184 r">contentDisposition</span>.<span class="i">Name</span> = <span class="s">&quot;\&quot;&quot;</span> + <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>&lt;<b>string</b>&gt;(<span class="r179 r">fieldName</span>) + <span class="s">&quot;\&quot;&quot;</span>;
 
            <b>var</b> <span id="r185 rd" class="r185 r">result</span> = <b>new</b> <span class="i">StringContent</span>(<a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>&lt;<b>string</b>&gt;(<span class="r180 r">fieldValue</span>));
            <span class="r185 r">result</span>.<span class="i">Headers</span>.<span class="i">ContentDisposition</span> = <span class="r184 r">contentDisposition</span>;
 
            <b>return</b> <span class="r185 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> from the supplied field name and </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Stream</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. Uses </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="/System.Management.Automation/A.html#8b9327b10b12742d" class="i method">ConvertTo</a>{<span class="r186 r t">T</span>}(<b>object</b>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to convert the fieldname to a string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">fieldName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Field Name to use for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r188 r">stream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Stream</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to use for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">StreamContent</span> <a id="cb1b9db0ecc70e68" href="../../../../R/cb1b9db0ecc70e68.html" target="n" data-glyph="76,1" class="i method">GetMultipartStreamContent</a>(<b>object</b> <span id="r187 rd" class="r187 r">fieldName</span>, <span class="i">Stream</span> <span id="r188 rd" class="r188 r">stream</span>)
        {
            <b>var</b> <span id="r189 rd" class="r189 r">contentDisposition</span> = <b>new</b> <span class="i">ContentDispositionHeaderValue</span>(<span class="s">&quot;form-data&quot;</span>);
            <span class="c">// .NET does not enclose field names in quotes, however, modern browsers and curl do.</span>
            <span class="r189 r">contentDisposition</span>.<span class="i">Name</span> = <span class="s">&quot;\&quot;&quot;</span> + <a href="/System.Management.Automation/A.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>&lt;<b>string</b>&gt;(<span class="r187 r">fieldName</span>) + <span class="s">&quot;\&quot;&quot;</span>;
 
            <b>var</b> <span id="r190 rd" class="r190 r">result</span> = <b>new</b> <span class="i">StreamContent</span>(<span class="r188 r">stream</span>);
            <span class="r190 r">result</span>.<span class="i">Headers</span>.<span class="i">ContentDisposition</span> = <span class="r189 r">contentDisposition</span>;
            <span class="r190 r">result</span>.<span class="i">Headers</span>.<span class="i">ContentType</span> = <b>new</b> <span class="i">MediaTypeHeaderValue</span>(<span class="s">&quot;application/octet-stream&quot;</span>);
 
            <b>return</b> <span class="r190 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> from the supplied field name and file. Calls </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#cb1b9db0ecc70e68" class="i method">GetMultipartStreamContent</a>(<b>object</b>, <span class="i">Stream</span>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to create the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and then sets the file name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">fieldName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Field Name to use for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r178 r">file</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file to use for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamContent</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">StreamContent</span> <a id="c48478c870e214d0" href="../../../../R/c48478c870e214d0.html" target="n" data-glyph="76,1" class="i method">GetMultipartFileContent</a>(<b>object</b> <span id="r177 rd" class="r177 r">fieldName</span>, <span class="i">FileInfo</span> <span id="r178 rd" class="r178 r">file</span>)
        {
            <b>var</b> <span id="r191 rd" class="r191 r">result</span> = <span class="i">GetMultipartStreamContent</span>(<span class="i">fieldName</span>: <span class="r177 r">fieldName</span>, <span class="i">stream</span>: <b>new</b> <span class="i">FileStream</span>(<span class="r178 r">file</span>.<span class="i">FullName</span>, <span class="i">FileMode</span>.<span class="i">Open</span>));
            <span class="c">// .NET does not enclose field names in quotes, however, modern browsers and curl do.</span>
            <span class="r191 r">result</span>.<span class="i">Headers</span>.<span class="i">ContentDisposition</span>.<span class="i">FileName</span> = <span class="s">&quot;\&quot;&quot;</span> + <span class="r178 r">file</span>.<span class="i">Name</span> + <span class="s">&quot;\&quot;&quot;</span>;
 
            <b>return</b> <span class="r191 r">result</span>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Helper Methods
    }
}
</pre></td></tr></table></div></body></html>
