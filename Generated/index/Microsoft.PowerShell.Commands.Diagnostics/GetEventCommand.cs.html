<!DOCTYPE html>
<html><head><title>GetEventCommand.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(2063);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Diagnostics/GetEventCommand.cs" target="_top">GetEventCommand.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Diagnostics" target="_top">src\Microsoft.PowerShell.Commands.Diagnostics\Microsoft.PowerShell.Commands.Diagnostics.csproj</a> (Microsoft.PowerShell.Commands.Diagnostics)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Specialized</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">Eventing</span>.<span class="i">Reader</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Net</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Resources</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
[<b>assembly</b>: <span class="i">CLSCompliant</span>(<b>false</b>)]
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Class that implements the Get-WinEvent cmdlet.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="/System.Management.Automation/A.html#d056c4b8c99405e5" class="t t">VerbsCommon</a>.<a href="/System.Management.Automation/A.html#7ee9f5441476f642" class="i field">Get</a>, <span class="s">&quot;WinEvent&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;GetLogSet&quot;</span>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096581&quot;</span>)]
    <b>public sealed class</b> <a id="565b7fce267e3743" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="6ad967c811edaf85">GetWinEventCommand</span></a> : <a href="/System.Management.Automation/A.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ListLog parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;ListLogSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ListLogParamHelp&quot;</span>)]
        [<span class="i">AllowEmptyCollection</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>,
                            <span class="i">Scope</span> = <span class="s">&quot;member&quot;</span>,
                            <span class="i">Target</span> = <span class="s">&quot;Microsoft.PowerShell.Commands.GetEvent.ListLog&quot;</span>,
                            <span class="i">Justification</span> = <span class="s">&quot;A string[] is required here because that is the type Powershell supports&quot;</span>)]
        <b>public string</b>[] <a id="8d176658c972e7c8" href="R/8d176658c972e7c8.html" target="n" data-glyph="102,1" class="i property">ListLog</a> { <b>get</b>; <b>set</b>; } = { <span class="s">&quot;*&quot;</span> };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> GetLog parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetLogSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;GetLogParamHelp&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>,
                            <span class="i">Scope</span> = <span class="s">&quot;member&quot;</span>,
                            <span class="i">Target</span> = <span class="s">&quot;Microsoft.PowerShell.Commands.GetEvent.LogName&quot;</span>,
                            <span class="i">Justification</span> = <span class="s">&quot;A string[] is required here because that is the type Powershell supports&quot;</span>)]
        <b>public string</b>[] <a id="830f6674ee529c16" href="R/830f6674ee529c16.html" target="n" data-glyph="102,1" class="i property">LogName</a> { <b>get</b>; <b>set</b>; } = { <span class="s">&quot;*&quot;</span> };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ListProvider parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;ListProviderSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ListProviderParamHelp&quot;</span>)]
        [<span class="i">AllowEmptyCollection</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>,
                            <span class="i">Scope</span> = <span class="s">&quot;member&quot;</span>,
                            <span class="i">Target</span> = <span class="s">&quot;Microsoft.PowerShell.Commands.GetEvent.ListProvider&quot;</span>,
                            <span class="i">Justification</span> = <span class="s">&quot;A string[] is required here because that is the type Powershell supports&quot;</span>)]
        <b>public string</b>[] <a id="f57acfda7ac7776b" href="R/f57acfda7ac7776b.html" target="n" data-glyph="102,1" class="i property">ListProvider</a> { <b>get</b>; <b>set</b>; } = { <span class="s">&quot;*&quot;</span> };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ProviderName parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetProviderSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;GetProviderParamHelp&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>,
                            <span class="i">Scope</span> = <span class="s">&quot;member&quot;</span>,
                            <span class="i">Target</span> = <span class="s">&quot;Microsoft.PowerShell.Commands.GetEvent.ProviderName&quot;</span>,
                            <span class="i">Justification</span> = <span class="s">&quot;A string[] is required here because that is the type Powershell supports&quot;</span>)]
        <b>public string</b>[] <a id="5585fd9e595b91f1" href="R/5585fd9e595b91f1.html" target="n" data-glyph="102,1" class="i property">ProviderName</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Path parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;FileSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;PathParamHelp&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;PSPath&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>,
                            <span class="i">Scope</span> = <span class="s">&quot;member&quot;</span>,
                            <span class="i">Target</span> = <span class="s">&quot;Microsoft.PowerShell.Commands.GetEvent.Path&quot;</span>,
                            <span class="i">Justification</span> = <span class="s">&quot;A string[] is required here because that is the type Powershell supports&quot;</span>)]
        <b>public string</b>[] <a id="50b15a4e9a1ebb97" href="R/50b15a4e9a1ebb97.html" target="n" data-glyph="102,1" class="i property">Path</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> MaxEvents parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;FileSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;MaxEventsParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetProviderSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;MaxEventsParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetLogSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;MaxEventsParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;HashQuerySet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;MaxEventsParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;XmlQuerySet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;MaxEventsParamHelp&quot;</span>)]
        [<span class="i">ValidateRange</span>((<b>long</b>)1, <b>long</b>.<span class="i">MaxValue</span>)]
        <b>public long</b> <a id="500223e25ea273ff" href="R/500223e25ea273ff.html" target="n" data-glyph="102,1" class="i property">MaxEvents</a> { <b>get</b>; <b>set</b>; } = -1;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ComputerName parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;ListProviderSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ComputerNameParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetProviderSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ComputerNameParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;ListLogSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ComputerNameParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetLogSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ComputerNameParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;HashQuerySet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ComputerNameParamHelp&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;XmlQuerySet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>,
                <a href="/System.Management.Automation/A.html#92a3ab71e21da3c3" class="i property">HelpMessageResourceId</a> = <span class="s">&quot;ComputerNameParamHelp&quot;</span>)]
        [<span class="i">ValidateNotNull</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;Cn&quot;</span>)]
        <b>public string</b> <a id="6df85e391a946c71" href="R/6df85e391a946c71.html" target="n" data-glyph="102,1" class="i property">ComputerName</a> { <b>get</b>; <b>set</b>; } = <b>string</b>.<span class="i">Empty</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Credential parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;ListProviderSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetProviderSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;ListLogSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetLogSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;HashQuerySet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;XmlQuerySet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;FileSet&quot;</span>)]
        [<span class="i">Credential</span>]
        <b>public</b> <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a> <a id="a544ec5f287586eb" href="R/a544ec5f287586eb.html" target="n" data-glyph="102,1" class="i property">Credential</a> { <b>get</b>; <b>set</b>; } = <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a>.<a href="/System.Management.Automation/A.html#8c5314944c80f8ac" class="i property">Empty</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> FilterXPath parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;FileSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetProviderSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>)]
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetLogSet&quot;</span>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>)]
        [<span class="i">ValidateNotNull</span>]
        <b>public string</b> <a id="9011783579f2dda5" href="R/9011783579f2dda5.html" target="n" data-glyph="102,1" class="i property">FilterXPath</a> { <b>get</b>; <b>set</b>; } = <span class="s">&quot;*&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> FilterXml parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;XmlQuerySet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1059:MembersShouldNotExposeCertainConcreteTypes&quot;</span>,
                            <span class="i">Scope</span> = <span class="s">&quot;member&quot;</span>,
                            <span class="i">Target</span> = <span class="s">&quot;Microsoft.PowerShell.Commands.GetEvent.FilterXml&quot;</span>,
                            <span class="i">Justification</span> = <span class="s">&quot;An XmlDocument is required here because that is the type Powershell supports&quot;</span>)]
        <b>public</b> <span class="i">XmlDocument</span> <a id="96253772721b8a60" href="R/96253772721b8a60.html" target="n" data-glyph="102,1" class="i property">FilterXml</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> FilterHashtable parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
                <a href="/System.Management.Automation/A.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                <a href="/System.Management.Automation/A.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                <a href="/System.Management.Automation/A.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>false</b>,
                <a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;HashQuerySet&quot;</span>,
                <a href="/System.Management.Automation/A.html#2f9601faf9b1be05" class="i property">HelpMessageBaseName</a> = <span class="s">&quot;GetEventResources&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>,
                            <span class="i">Scope</span> = <span class="s">&quot;member&quot;</span>,
                            <span class="i">Target</span> = <span class="s">&quot;Microsoft.PowerShell.Commands.GetEvent.FilterHashtable&quot;</span>,
                            <span class="i">Justification</span> = <span class="s">&quot;A string[] is required here because that is the type Powershell supports&quot;</span>)]
        <b>public</b> <span class="i">Hashtable</span>[] <a id="ee8d9156a8e0178d" href="R/ee8d9156a8e0178d.html" target="n" data-glyph="102,1" class="i property">FilterHashtable</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Force switch.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;ListLogSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetProviderSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetLogSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;HashQuerySet&quot;</span>)]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="ac195df89d16e184" href="R/ac195df89d16e184.html" target="n" data-glyph="102,1" class="i property">Force</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Oldest switch.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;FileSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetProviderSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;GetLogSet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;HashQuerySet&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="/System.Management.Automation/A.html#91bee819daab0925" class="i property">ParameterSetName</a> = <span class="s">&quot;XmlQuerySet&quot;</span>)]
        <b>public</b> <a href="/System.Management.Automation/A.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="064d995b419f74d3" href="R/064d995b419f74d3.html" target="n" data-glyph="102,1" class="i property">Oldest</a>
        {
            <b>get</b> { <b>return</b> <a href="#afb7079330393e9f" class="i field">_oldest</a>; }
 
            <b>set</b> { <a href="#afb7079330393e9f" class="i field">_oldest</a> = <b>value</b>; }
        }
 
        <b>private bool</b> <a id="afb7079330393e9f" href="R/afb7079330393e9f.html" target="n" data-glyph="46,1" class="i field">_oldest</a> = <b>false</b>;
 
        <span class="c">//</span>
        <span class="c">// Query builder constant strings</span>
        <span class="c">//</span>
        <b>private const string</b> <a id="14331f24d8edf0a8" href="R/14331f24d8edf0a8.html" target="n" data-glyph="10,1" class="i field">queryListOpen</a> = <span class="s">&quot;&lt;QueryList&gt;&quot;</span>;
        <b>private const string</b> <a id="4b56200861f0dc08" href="R/4b56200861f0dc08.html" target="n" data-glyph="10,1" class="i field">queryListClose</a> = <span class="s">&quot;&lt;/QueryList&gt;&quot;</span>;
        <b>private const string</b> <a id="175a4e26bb634402" href="R/175a4e26bb634402.html" target="n" data-glyph="10,1" class="i field">queryTemplate</a> = <span class="s">&quot;&lt;Query Id=\&quot;{0}\&quot; Path=\&quot;{1}\&quot;&gt;&lt;Select Path=\&quot;{1}\&quot;&gt;{2}&lt;/Select&gt;&lt;/Query&gt;&quot;</span>;
        <b>private const string</b> <a id="40a2e1a5f048f566" href="R/40a2e1a5f048f566.html" target="n" data-glyph="10,1" class="i field">queryOpenerTemplate</a> = <span class="s">&quot;&lt;Query Id=\&quot;{0}\&quot; Path=\&quot;{1}\&quot;&gt;&lt;Select Path=\&quot;{1}\&quot;&gt;*&quot;</span>;
        <b>private const string</b> <a id="665eebc2d0fd1366" href="R/665eebc2d0fd1366.html" target="n" data-glyph="10,1" class="i field">queryCloser</a> = <span class="s">&quot;&lt;/Query&gt;&quot;</span>;
        <b>private const string</b> <a id="92de1cb1fff26bf8" href="R/92de1cb1fff26bf8.html" target="n" data-glyph="10,1" class="i field">SelectCloser</a> = <span class="s">&quot;&lt;/Select&gt;&quot;</span>;
        <b>private const string</b> <a id="ebfddc35dc6957bc" href="R/ebfddc35dc6957bc.html" target="n" data-glyph="10,1" class="i field">suppressOpener</a> = <span class="s">&quot;&lt;Suppress&gt;*&quot;</span>;
        <b>private const string</b> <a id="163a6a35a3c4669a" href="R/163a6a35a3c4669a.html" target="n" data-glyph="10,1" class="i field">suppressCloser</a> = <span class="s">&quot;&lt;/Suppress&gt;&quot;</span>;
        <b>private const char</b> <a id="04aba2018e9db28c" href="R/04aba2018e9db28c.html" target="n" data-glyph="10,1" class="i field">propOpen</a> = <span class="s">&#39;[&#39;</span>;
        <b>private const char</b> <a id="41cfd5f6cb5dd31e" href="R/41cfd5f6cb5dd31e.html" target="n" data-glyph="10,1" class="i field">propClose</a> = <span class="s">&#39;]&#39;</span>;
        <b>private const string</b> <a id="1f701fab25c264e8" href="R/1f701fab25c264e8.html" target="n" data-glyph="10,1" class="i field">filePrefix</a> = <span class="s">&quot;file://&quot;</span>;
        <b>private const string</b> <a id="49f2d7e7df733a82" href="R/49f2d7e7df733a82.html" target="n" data-glyph="10,1" class="i field">NamedDataTemplate</a> = <span class="s">&quot;((EventData[Data[@Name=&#39;{0}&#39;]=&#39;{1}&#39;]) or (UserData/*/{0}=&#39;{1}&#39;))&quot;</span>;
        <b>private const string</b> <a id="9fc631de1142b7bc" href="R/9fc631de1142b7bc.html" target="n" data-glyph="10,1" class="i field">DataTemplate</a> = <span class="s">&quot;(EventData/Data=&#39;{0}&#39;)&quot;</span>;
        <b>private const string</b> <a id="0df79be703ebb6b6" href="R/0df79be703ebb6b6.html" target="n" data-glyph="10,1" class="i field">SystemTimePeriodTemplate</a> = <span class="s">&quot;(System/TimeCreated[@SystemTime&amp;gt;=&#39;{0}&#39; and @SystemTime&amp;lt;=&#39;{1}&#39;])&quot;</span>;
        <b>private const string</b> <a id="48273561a4dc08e5" href="R/48273561a4dc08e5.html" target="n" data-glyph="10,1" class="i field">SystemTimeStartTemplate</a> = <span class="s">&quot;(System/TimeCreated[@SystemTime&amp;gt;=&#39;{0}&#39;])&quot;</span>;
        <b>private const string</b> <a id="ae5b5e4284f732e0" href="R/ae5b5e4284f732e0.html" target="n" data-glyph="10,1" class="i field">SystemTimeEndTemplate</a> = <span class="s">&quot;(System/TimeCreated[@SystemTime&amp;lt;=&#39;{0}&#39;])&quot;</span>;
        <b>private const string</b> <a id="307294b618d632f2" href="R/307294b618d632f2.html" target="n" data-glyph="10,1" class="i field">SystemLevelTemplate</a> = <span class="s">&quot;(System/Level=&quot;</span>;
        <b>private const string</b> <a id="914222e3d577781b" href="R/914222e3d577781b.html" target="n" data-glyph="10,1" class="i field">SystemEventIDTemplate</a> = <span class="s">&quot;(System/EventID=&quot;</span>;
        <b>private const string</b> <a id="f9638bbc09c6fbd4" href="R/f9638bbc09c6fbd4.html" target="n" data-glyph="10,1" class="i field">SystemSecurityTemplate</a> = <span class="s">&quot;(System/Security[@UserID=&#39;{0}&#39;])&quot;</span>;
        <b>private const string</b> <a id="9c5417bc56229d0e" href="R/9c5417bc56229d0e.html" target="n" data-glyph="10,1" class="i field">SystemKeywordsTemplate</a> = <span class="s">&quot;System[band(Keywords,{0})]&quot;</span>;
 
        <span class="c">//</span>
        <span class="c">// Other private members and constants</span>
        <span class="c">//</span>
        <b>private</b> <span class="i">ResourceManager</span> <a id="d0628791e81b0e0d" href="R/d0628791e81b0e0d.html" target="n" data-glyph="46,1" class="i field">_resourceMgr</a> = <b>null</b>;
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">StringCollection</span>&gt; <a id="25da2b32974228eb" href="R/25da2b32974228eb.html" target="n" data-glyph="46,1" class="i field">_providersByLogMap</a> = <b>new</b>();
 
        <b>private</b> <span class="i">StringCollection</span> <a id="28a44c9685b8fce9" href="R/28a44c9685b8fce9.html" target="n" data-glyph="46,1" class="i field">_logNamesMatchingWildcard</a> = <b>null</b>;
        <b>private readonly</b> <span class="i">StringCollection</span> <a id="43e2c958b27a8860" href="R/43e2c958b27a8860.html" target="n" data-glyph="46,1" class="i field">_resolvedPaths</a> = <b>new</b>();
 
        <b>private readonly</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="2758f5aa75ac52e3" href="R/2758f5aa75ac52e3.html" target="n" data-glyph="46,1" class="i field">_accumulatedLogNames</a> = <b>new</b>();
        <b>private readonly</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="81bc4674e6cb52ee" href="R/81bc4674e6cb52ee.html" target="n" data-glyph="46,1" class="i field">_accumulatedProviderNames</a> = <b>new</b>();
        <b>private readonly</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="6ca337e208e0a57e" href="R/6ca337e208e0a57e.html" target="n" data-glyph="46,1" class="i field">_accumulatedFileNames</a> = <b>new</b>();
 
        <b>private const uint</b> <a id="ece6f9c6ab3c1658" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">MAX_EVENT_BATCH</a> = 100;
 
        <span class="c">//</span>
        <span class="c">// Hashtable query key names</span>
        <span class="c">//</span>
        <b>private const string</b> <a id="ffb34fd74196c5f9" href="R/ffb34fd74196c5f9.html" target="n" data-glyph="10,1" class="i field">hashkey_logname_lc</a> = <span class="s">&quot;logname&quot;</span>;
        <b>private const string</b> <a id="431158b05e5eb10d" href="R/431158b05e5eb10d.html" target="n" data-glyph="10,1" class="i field">hashkey_providername_lc</a> = <span class="s">&quot;providername&quot;</span>;
        <b>private const string</b> <a id="181201922f43f2d9" href="R/181201922f43f2d9.html" target="n" data-glyph="10,1" class="i field">hashkey_path_lc</a> = <span class="s">&quot;path&quot;</span>;
        <b>private const string</b> <a id="bf5a856a2b8a4701" href="R/bf5a856a2b8a4701.html" target="n" data-glyph="10,1" class="i field">hashkey_keywords_lc</a> = <span class="s">&quot;keywords&quot;</span>;
        <b>private const string</b> <a id="ad036d2f8c92790c" href="R/ad036d2f8c92790c.html" target="n" data-glyph="10,1" class="i field">hashkey_id_lc</a> = <span class="s">&quot;id&quot;</span>;
        <b>private const string</b> <a id="eb18c2aa793a3986" href="R/eb18c2aa793a3986.html" target="n" data-glyph="10,1" class="i field">hashkey_level_lc</a> = <span class="s">&quot;level&quot;</span>;
        <b>private const string</b> <a id="162f8f99c08fdb70" href="R/162f8f99c08fdb70.html" target="n" data-glyph="10,1" class="i field">hashkey_starttime_lc</a> = <span class="s">&quot;starttime&quot;</span>;
        <b>private const string</b> <a id="6c5febf79664ca8a" href="R/6c5febf79664ca8a.html" target="n" data-glyph="10,1" class="i field">hashkey_endtime_lc</a> = <span class="s">&quot;endtime&quot;</span>;
        <b>private const string</b> <a id="80e6c61a8ebfb21d" href="R/80e6c61a8ebfb21d.html" target="n" data-glyph="10,1" class="i field">hashkey_userid_lc</a> = <span class="s">&quot;userid&quot;</span>;
        <b>private const string</b> <a id="4cc373408de93d20" href="R/4cc373408de93d20.html" target="n" data-glyph="10,1" class="i field">hashkey_data_lc</a> = <span class="s">&quot;data&quot;</span>;
        <b>private const string</b> <a id="190c457661ad8acd" href="R/190c457661ad8acd.html" target="n" data-glyph="10,1" class="i field">hashkey_supress_lc</a> = <span class="s">&quot;suppresshashfilter&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> BeginProcessing() is invoked once per pipeline: we will load System.Core.dll here.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="5fcd2e063320f1c2" href="R/5fcd2e063320f1c2.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a> = <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<span class="i n">Diagnostics</span>.<span class="i n">Common</span>.<a href="CommonUtils.cs.html#761b138b864114ba" class="t t">CommonUtilities</a>.<a href="CommonUtils.cs.html#12533f7ffa020704" class="i method">GetResourceManager</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> EndProcessing() is invoked once per pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="df2f8f0abc1b6abb" href="R/df2f8f0abc1b6abb.html" target="n" data-glyph="75,1" class="i method">EndProcessing</a>()
        {
            <b>switch</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>)
            {
                <b>case</b> <span class="s">&quot;GetLogSet&quot;</span>:
                    <a href="#98b0b62654618df2" class="i method">ProcessGetLog</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;FileSet&quot;</span>:
                    <a href="#d0278b56e2d76159" class="i method">ProcessFile</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;GetProviderSet&quot;</span>:
                    <a href="#616b86defa8c730a" class="i method">ProcessGetProvider</a>();
                    <b>break</b>;
 
                <b>default</b>:
                    <b>break</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ProcessRecord() override.</span>
        <span class="c">///</span><span class="c"> This is the main entry point for the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="26e3cc7cf16ccf49" href="R/26e3cc7cf16ccf49.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>switch</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>)
            {
                <b>case</b> <span class="s">&quot;ListLogSet&quot;</span>:
                    <a href="#dd6396c782f81769" class="i method">ProcessListLog</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;ListProviderSet&quot;</span>:
                    <a href="#9aaa292e0d1fbb41" class="i method">ProcessListProvider</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;GetLogSet&quot;</span>:
                    <a href="#eda24e6ffa42b2f8" class="i method">AccumulatePipelineLogNames</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;FileSet&quot;</span>:
                    <a href="#c741d4facaa41b56" class="i method">AccumulatePipelineFileNames</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;HashQuerySet&quot;</span>:
                    <a href="#0b2dcc24567630dd" class="i method">ProcessHashQuery</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;GetProviderSet&quot;</span>:
                    <a href="#bd5f08f2936b58f9" class="i method">AccumulatePipelineProviderNames</a>();
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;XmlQuerySet&quot;</span>:
                    <a href="#1311984afad96c20" class="i method">ProcessFilterXml</a>();
                    <b>break</b>;
 
                <b>default</b>:
                    <span class="i">WriteDebug</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;Invalid parameter set name: {0}&quot;</span>, <a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>));
                    <b>break</b>;
            }
        }
 
        <span class="c">//</span>
        <span class="c">// AccumulatePipelineCounters() accumulates log names in the pipeline scenario:</span>
        <span class="c">// we do not want to construct a query until all the log names are supplied.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="eda24e6ffa42b2f8" href="R/eda24e6ffa42b2f8.html" target="n" data-glyph="76,1" class="i method">AccumulatePipelineLogNames</a>()
        {
            <a href="#2758f5aa75ac52e3" class="i field">_accumulatedLogNames</a>.<span class="i">AddRange</span>(<a href="#830f6674ee529c16" class="i property">LogName</a>);
        }
 
        <span class="c">//</span>
        <span class="c">// AccumulatePipelineProviderNames() accumulates provider names in the pipeline scenario:</span>
        <span class="c">// we do not want to construct a query until all the provider names are supplied.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="bd5f08f2936b58f9" href="R/bd5f08f2936b58f9.html" target="n" data-glyph="76,1" class="i method">AccumulatePipelineProviderNames</a>()
        {
            <a href="#81bc4674e6cb52ee" class="i field">_accumulatedProviderNames</a>.<span class="i">AddRange</span>(<a href="#830f6674ee529c16" class="i property">LogName</a>);
        }
 
        <span class="c">//</span>
        <span class="c">// AccumulatePipelineFileNames() accumulates log file paths in the pipeline scenario:</span>
        <span class="c">// we do not want to construct a query until all the file names are supplied.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="c741d4facaa41b56" href="R/c741d4facaa41b56.html" target="n" data-glyph="76,1" class="i method">AccumulatePipelineFileNames</a>()
        {
            <a href="#6ca337e208e0a57e" class="i field">_accumulatedFileNames</a>.<span class="i">AddRange</span>(<a href="#830f6674ee529c16" class="i property">LogName</a>);
        }
 
        <span class="c">//</span>
        <span class="c">// Process GetLog parameter set</span>
        <span class="c">//</span>
        <b>private void</b> <a id="98b0b62654618df2" href="R/98b0b62654618df2.html" target="n" data-glyph="76,1" class="i method">ProcessGetLog</a>()
        {
            <b>using</b> (<span class="i">EventLogSession</span> <span id="r0 rd" class="r0 r">eventLogSession</span> = <a href="#9d9b4a3ccb3725c2" class="i method">CreateSession</a>())
            {
                <span class="i">FindLogNamesMatchingWildcards</span>(<span class="r0 r">eventLogSession</span>, <a href="#2758f5aa75ac52e3" class="i field">_accumulatedLogNames</a>);
                <b>if</b> (<a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>.<span class="i">Count</span> == 0)
                {
                    <b>return</b>;
                }
 
                <span class="i">EventLogQuery</span> <span id="r1 rd" class="r1 r">logQuery</span>;
                <b>if</b> (<a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>.<span class="i">Count</span> &gt; 1)
                {
                    <b>string</b> <span id="r2 rd" class="r2 r">query</span> = <a href="#c8270995659e789a" class="i method">BuildStructuredQuery</a>(<span class="r0 r">eventLogSession</span>);
                    <span class="r1 r">logQuery</span> = <b>new</b> <span class="i">EventLogQuery</span>(<b>null</b>, <span class="i">PathType</span>.<span class="i">LogName</span>, <span class="r2 r">query</span>);
                    <span class="r1 r">logQuery</span>.<span class="i">TolerateQueryErrors</span> = <b>true</b>;
                }
                <b>else</b>
                {
                    <span class="r1 r">logQuery</span> = <b>new</b> <span class="i">EventLogQuery</span>(<a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>[0], <span class="i">PathType</span>.<span class="i">LogName</span>, <a href="#9011783579f2dda5" class="i property">FilterXPath</a>);
                }
 
                <span class="r1 r">logQuery</span>.<span class="i">Session</span> = <span class="r0 r">eventLogSession</span>;
                <span class="r1 r">logQuery</span>.<span class="i">ReverseDirection</span> = !<a href="#afb7079330393e9f" class="i field">_oldest</a>;
 
                <a href="#cfaef292fe881f6b" class="i method">ReadEvents</a>(<span class="r1 r">logQuery</span>);
            }
        }
 
        <span class="c">//</span>
        <span class="c">// Process GetProviderSet parameter set</span>
        <span class="c">//</span>
        <b>private void</b> <a id="616b86defa8c730a" href="R/616b86defa8c730a.html" target="n" data-glyph="76,1" class="i method">ProcessGetProvider</a>()
        {
            <b>using</b> (<span class="i">EventLogSession</span> <span id="r3 rd" class="r3 r">eventLogSession</span> = <a href="#9d9b4a3ccb3725c2" class="i method">CreateSession</a>())
            {
                <span class="i">FindProvidersByLogForWildcardPatterns</span>(<span class="r3 r">eventLogSession</span>, <a href="#5585fd9e595b91f1" class="i property">ProviderName</a>);
 
                <b>if</b> (<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Count</span> == 0)
                {
                    <span class="c">//</span>
                    <span class="c">// Just return: errors already written above for each unmatched provider name pattern.</span>
                    <span class="c">//</span>
                    <b>return</b>;
                }
 
                <span class="i">EventLogQuery</span> <span id="r4 rd" class="r4 r">logQuery</span> = <b>null</b>;
                <b>if</b> (<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Count</span> &gt; 1)
                {
                    <b>string</b> <span id="r5 rd" class="r5 r">query</span> = <a href="#c8270995659e789a" class="i method">BuildStructuredQuery</a>(<span class="r3 r">eventLogSession</span>);
                    <span class="r4 r">logQuery</span> = <b>new</b> <span class="i">EventLogQuery</span>(<b>null</b>, <span class="i">PathType</span>.<span class="i">LogName</span>, <span class="r5 r">query</span>);
                    <span class="r4 r">logQuery</span>.<span class="i">TolerateQueryErrors</span> = <b>true</b>;
                }
                <b>else</b>
                {
                    <span class="c">//</span>
                    <span class="c">// There&#39;s only one key at this point, but we need an enumerator to get to it.</span>
                    <span class="c">//</span>
                    <b>foreach</b> (<b>string</b> <span id="r6 rd" class="r6 r">log</span> <b>in</b> <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Keys</span>)
                    {
                        <span class="r4 r">logQuery</span> = <b>new</b> <span class="i">EventLogQuery</span>(<span class="r6 r">log</span>, <span class="i">PathType</span>.<span class="i">LogName</span>, <span class="i">AddProviderPredicatesToFilter</span>(<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>[<span class="r6 r">log</span>]));
                        <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;Log {0} will be queried&quot;</span>, <span class="r6 r">log</span>));
                    }
                }
 
                <span class="r4 r">logQuery</span>.<span class="i">Session</span> = <span class="r3 r">eventLogSession</span>;
                <span class="r4 r">logQuery</span>.<span class="i">ReverseDirection</span> = !<a href="#afb7079330393e9f" class="i field">_oldest</a>;
 
                <a href="#cfaef292fe881f6b" class="i method">ReadEvents</a>(<span class="r4 r">logQuery</span>);
            }
        }
 
        <span class="c">//</span>
        <span class="c">// Process ListLog parameter set</span>
        <span class="c">//</span>
        <b>private void</b> <a id="dd6396c782f81769" href="R/dd6396c782f81769.html" target="n" data-glyph="76,1" class="i method">ProcessListLog</a>()
        {
            <b>using</b> (<span class="i">EventLogSession</span> <span id="r7 rd" class="r7 r">eventLogSession</span> = <a href="#9d9b4a3ccb3725c2" class="i method">CreateSession</a>())
            {
                <b>foreach</b> (<b>string</b> <span id="r8 rd" class="r8 r">logPattern</span> <b>in</b> <a href="#8d176658c972e7c8" class="i property">ListLog</a>)
                {
                    <b>bool</b> <span id="r9 rd" class="r9 r">bMatchFound</span> = <b>false</b>;
                    <a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r10 rd" class="r10 r">wildLogPattern</span> = <b>new</b>(<span class="r8 r">logPattern</span>, <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                    <b>foreach</b> (<b>string</b> <span id="r11 rd" class="r11 r">logName</span> <b>in</b> <span class="r7 r">eventLogSession</span>.<span class="i">GetLogNames</span>())
                    {
                        <b>if</b> (((!<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r8 r">logPattern</span>))
                            &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="r8 r">logPattern</span>, <span class="r11 r">logName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            ||
                            (<span class="r10 r">wildLogPattern</span>.<span class="i">IsMatch</span>(<span class="r11 r">logName</span>)))
                        {
                            <b>try</b>
                            {
                                <span class="i">EventLogConfiguration</span> <span id="r12 rd" class="r12 r">logObj</span> = <b>new</b>(<span class="r11 r">logName</span>, <span class="r7 r">eventLogSession</span>);
 
                                <span class="c">//</span>
                                <span class="c">// Skip direct channels matching the wildcard unless -Force is present.</span>
                                <span class="c">//</span>
                                <b>if</b> (!<a href="#ac195df89d16e184" class="i property">Force</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a> &amp;&amp;
                                    <a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r8 r">logPattern</span>) &amp;&amp;
                                        (<span class="r12 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Debug</span> ||
                                        <span class="r12 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Analytical</span>))
                                {
                                    <b>continue</b>;
                                }
 
                                <span class="i">EventLogInformation</span> <span id="r13 rd" class="r13 r">logInfoObj</span> = <span class="r7 r">eventLogSession</span>.<span class="i">GetLogInformation</span>(<span class="r11 r">logName</span>, <span class="i">PathType</span>.<span class="i">LogName</span>);
 
                                <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r14 rd" class="r14 r">outputObj</span> = <b>new</b>(<span class="r12 r">logObj</span>);
 
                                <span class="r14 r">outputObj</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<span class="i">Add</span>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="s">&quot;FileSize&quot;</span>, <span class="r13 r">logInfoObj</span>.<span class="i">FileSize</span>));
                                <span class="r14 r">outputObj</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<span class="i">Add</span>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="s">&quot;IsLogFull&quot;</span>, <span class="r13 r">logInfoObj</span>.<span class="i">IsLogFull</span>));
                                <span class="r14 r">outputObj</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<span class="i">Add</span>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="s">&quot;LastAccessTime&quot;</span>, <span class="r13 r">logInfoObj</span>.<span class="i">LastAccessTime</span>));
                                <span class="r14 r">outputObj</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<span class="i">Add</span>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="s">&quot;LastWriteTime&quot;</span>, <span class="r13 r">logInfoObj</span>.<span class="i">LastWriteTime</span>));
                                <span class="r14 r">outputObj</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<span class="i">Add</span>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="s">&quot;OldestRecordNumber&quot;</span>, <span class="r13 r">logInfoObj</span>.<span class="i">OldestRecordNumber</span>));
                                <span class="r14 r">outputObj</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<span class="i">Add</span>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="s">&quot;RecordCount&quot;</span>, <span class="r13 r">logInfoObj</span>.<span class="i">RecordCount</span>));
 
                                <span class="i">WriteObject</span>(<span class="r14 r">outputObj</span>);
                                <span class="r9 r">bMatchFound</span> = <b>true</b>;
                            }
                            <b>catch</b> (<span class="i">Exception</span> <span id="r15 rd" class="r15 r">exc</span>)
                            {
                                <b>string</b> <span id="r16 rd" class="r16 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                                        <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;LogInfoUnavailable&quot;</span>),
                                                        <span class="r11 r">logName</span>, <span class="r15 r">exc</span>.<span class="i">Message</span>);
                                <span class="i">Exception</span> <span id="r17 rd" class="r17 r">outerExc</span> = <b>new</b>(<span class="r16 r">msg</span>, <span class="r15 r">exc</span>);
                                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r17 r">outerExc</span>, <span class="s">&quot;LogInfoUnavailable&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>));
                                <b>continue</b>;
                            }
                        }
                    }
 
                    <b>if</b> (!<span class="r9 r">bMatchFound</span>)
                    {
                        <b>string</b> <span id="r18 rd" class="r18 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoMatchingLogsFound&quot;</span>);
                        <span class="i">Exception</span> <span id="r19 rd" class="r19 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r18 r">msg</span>, <a href="#6df85e391a946c71" class="i property">ComputerName</a>, <span class="r8 r">logPattern</span>));
                        <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r19 r">exc</span>, <span class="s">&quot;NoMatchingLogsFound&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <b>null</b>));
                    }
                }
            }
        }
 
        <span class="c">//</span>
        <span class="c">// Process ListProvider parameter set</span>
        <span class="c">//</span>
        <b>private void</b> <a id="9aaa292e0d1fbb41" href="R/9aaa292e0d1fbb41.html" target="n" data-glyph="76,1" class="i method">ProcessListProvider</a>()
        {
            <b>using</b> (<span class="i">EventLogSession</span> <span id="r20 rd" class="r20 r">eventLogSession</span> = <a href="#9d9b4a3ccb3725c2" class="i method">CreateSession</a>())
            {
                <b>foreach</b> (<b>string</b> <span id="r21 rd" class="r21 r">provPattern</span> <b>in</b> <a href="#f57acfda7ac7776b" class="i property">ListProvider</a>)
                {
                    <b>bool</b> <span id="r22 rd" class="r22 r">bMatchFound</span> = <b>false</b>;
                    <a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r23 rd" class="r23 r">wildProvPattern</span> = <b>new</b>(<span class="r21 r">provPattern</span>, <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                    <b>foreach</b> (<b>string</b> <span id="r24 rd" class="r24 r">provName</span> <b>in</b> <span class="r20 r">eventLogSession</span>.<span class="i">GetProviderNames</span>())
                    {
                        <b>if</b> (((!<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r21 r">provPattern</span>))
                            &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="r21 r">provPattern</span>, <span class="r24 r">provName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            ||
                            (<span class="r23 r">wildProvPattern</span>.<span class="i">IsMatch</span>(<span class="r24 r">provName</span>)))
                        {
                            <b>try</b>
                            {
                                <span class="i">ProviderMetadata</span> <span id="r25 rd" class="r25 r">provObj</span> = <b>new</b>(<span class="r24 r">provName</span>, <span class="r20 r">eventLogSession</span>, <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
                                <span class="i">WriteObject</span>(<span class="r25 r">provObj</span>);
                                <span class="r22 r">bMatchFound</span> = <b>true</b>;
                            }
                            <b>catch</b> (<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">Eventing</span>.<span class="i">Reader</span>.<span class="i">EventLogException</span> <span id="r26 rd" class="r26 r">exc</span>)
                            {
                                <b>string</b> <span id="r27 rd" class="r27 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                                        <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;ProviderMetadataUnavailable&quot;</span>),
                                                        <span class="r24 r">provName</span>, <span class="r26 r">exc</span>.<span class="i">Message</span>);
                                <span class="i">Exception</span> <span id="r28 rd" class="r28 r">outerExc</span> = <b>new</b>(<span class="r27 r">msg</span>, <span class="r26 r">exc</span>);
                                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r28 r">outerExc</span>, <span class="s">&quot;ProviderMetadataUnavailable&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>));
                                <b>continue</b>;
                            }
                        }
                    }
 
                    <b>if</b> (!<span class="r22 r">bMatchFound</span>)
                    {
                        <b>string</b> <span id="r29 rd" class="r29 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoMatchingProvidersFound&quot;</span>),
                                                <a href="#6df85e391a946c71" class="i property">ComputerName</a>, <span class="r21 r">provPattern</span>);
                        <span class="i">Exception</span> <span id="r30 rd" class="r30 r">exc</span> = <b>new</b>(<span class="r29 r">msg</span>);
                        <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r30 r">exc</span>, <span class="s">&quot;NoMatchingProvidersFound&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <b>null</b>));
                    }
                }
            }
        }
 
        <span class="c">//</span>
        <span class="c">// Process FilterXml parameter set</span>
        <span class="c">//</span>
        <b>private void</b> <a id="1311984afad96c20" href="R/1311984afad96c20.html" target="n" data-glyph="76,1" class="i method">ProcessFilterXml</a>()
        {
            <b>using</b> (<span class="i">EventLogSession</span> <span id="r31 rd" class="r31 r">eventLogSession</span> = <a href="#9d9b4a3ccb3725c2" class="i method">CreateSession</a>())
            {
                <b>if</b> (!<a href="#064d995b419f74d3" class="i property">Oldest</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
                {
                    <span class="c">//</span>
                    <span class="c">// Do minimal parsing of xmlQuery to determine if any direct channels or ETL files are in it.</span>
                    <span class="c">//</span>
                    <span class="i">XmlElement</span> <span id="r32 rd" class="r32 r">root</span> = <a href="#96253772721b8a60" class="i property">FilterXml</a>.<span class="i">DocumentElement</span>;
                    <span class="i">XmlNodeList</span> <span id="r33 rd" class="r33 r">queryNodes</span> = <span class="r32 r">root</span>.<span class="i">SelectNodes</span>(<span class="s">&quot;//Query//Select&quot;</span>);
                    <b>foreach</b> (<span class="i">XmlNode</span> <span id="r34 rd" class="r34 r">queryNode</span> <b>in</b> <span class="r33 r">queryNodes</span>)
                    {
                        <span class="i">XmlAttributeCollection</span> <span id="r35 rd" class="r35 r">attribs</span> = <span class="r34 r">queryNode</span>.<span class="i">Attributes</span>;
                        <b>foreach</b> (<span class="i">XmlAttribute</span> <span id="r36 rd" class="r36 r">attrib</span> <b>in</b> <span class="r35 r">attribs</span>)
                        {
                            <b>if</b> (<span class="r36 r">attrib</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;Path&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <b>string</b> <span id="r37 rd" class="r37 r">logName</span> = <span class="r36 r">attrib</span>.<span class="i">Value</span>;
 
                                <b>if</b> (<span class="r37 r">logName</span>.<span class="i">StartsWith</span>(<a href="#1f701fab25c264e8" class="i field">filePrefix</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                {
                                    <a href="#ca40446dd6b2b243" class="i method">TerminateForNonEvtxFileWithoutOldest</a>(<span class="r37 r">logName</span>);
                                }
 
                                <a href="#7399d9391474d9aa" class="i method">ValidateLogName</a>(<span class="r37 r">logName</span>, <span class="r31 r">eventLogSession</span>);
                            }
                        }
                    }
                }
 
                <span class="i">EventLogQuery</span> <span id="r38 rd" class="r38 r">logQuery</span> = <b>new</b>(<b>null</b>, <span class="i">PathType</span>.<span class="i">LogName</span>, <a href="#96253772721b8a60" class="i property">FilterXml</a>.<span class="i">InnerXml</span>);
                <span class="r38 r">logQuery</span>.<span class="i">Session</span> = <span class="r31 r">eventLogSession</span>;
                <span class="r38 r">logQuery</span>.<span class="i">ReverseDirection</span> = !<a href="#afb7079330393e9f" class="i field">_oldest</a>;
 
                <a href="#cfaef292fe881f6b" class="i method">ReadEvents</a>(<span class="r38 r">logQuery</span>);
            }
        }
 
        <span class="c">//</span>
        <span class="c">// Process FileSet parameter set</span>
        <span class="c">//</span>
        <b>private void</b> <a id="d0278b56e2d76159" href="R/d0278b56e2d76159.html" target="n" data-glyph="76,1" class="i method">ProcessFile</a>()
        {
            <b>using</b> (<span class="i">EventLogSession</span> <span id="r39 rd" class="r39 r">eventLogSession</span> = <a href="#9d9b4a3ccb3725c2" class="i method">CreateSession</a>())
            {
                <span class="c">//</span>
                <span class="c">// At this point, _path array contains paths that might have wildcards,</span>
                <span class="c">// environment variables or PS drives. Let&#39;s resolve those.</span>
                <span class="c">//</span>
                <b>for</b> (<b>int</b> <span id="r40 rd" class="r40 r">i</span> = 0; <span class="r40 r">i</span> &lt; <a href="#50b15a4e9a1ebb97" class="i property">Path</a>.<span class="i">Length</span>; <span class="r40 r">i</span>++)
                {
                    <span class="i">StringCollection</span> <span id="r41 rd" class="r41 r">resolvedPaths</span> = <a href="#6a4a570d685f9583" class="i method">ValidateAndResolveFilePath</a>(<a href="#50b15a4e9a1ebb97" class="i property">Path</a>[<span class="r40 r">i</span>]);
                    <b>foreach</b> (<b>string</b> <span id="r42 rd" class="r42 r">resolvedPath</span> <b>in</b> <span class="r41 r">resolvedPaths</span>)
                    {
                        <a href="#43e2c958b27a8860" class="i field">_resolvedPaths</a>.<span class="i">Add</span>(<span class="r42 r">resolvedPath</span>);
                        <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;Found file {0}&quot;</span>, <span class="r42 r">resolvedPath</span>));
                    }
                }
 
                <span class="i">EventLogQuery</span> <span id="r43 rd" class="r43 r">logQuery</span> = <b>null</b>;
                <b>if</b> (<a href="#43e2c958b27a8860" class="i field">_resolvedPaths</a>.<span class="i">Count</span> == 0)
                {
                    <b>return</b>;
                }
                <b>else</b> <b>if</b> (<a href="#43e2c958b27a8860" class="i field">_resolvedPaths</a>.<span class="i">Count</span> &gt; 1)
                {
                    <b>string</b> <span id="r44 rd" class="r44 r">query</span> = <a href="#c8270995659e789a" class="i method">BuildStructuredQuery</a>(<span class="r39 r">eventLogSession</span>);
                    <span class="r43 r">logQuery</span> = <b>new</b> <span class="i">EventLogQuery</span>(<b>null</b>, <span class="i">PathType</span>.<span class="i">FilePath</span>, <span class="r44 r">query</span>);
                    <span class="r43 r">logQuery</span>.<span class="i">TolerateQueryErrors</span> = <b>true</b>;
                }
                <b>else</b>
                {
                    <span class="r43 r">logQuery</span> = <b>new</b> <span class="i">EventLogQuery</span>(<a href="#43e2c958b27a8860" class="i field">_resolvedPaths</a>[0], <span class="i">PathType</span>.<span class="i">FilePath</span>, <a href="#9011783579f2dda5" class="i property">FilterXPath</a>);
                }
 
                <span class="r43 r">logQuery</span>.<span class="i">Session</span> = <span class="r39 r">eventLogSession</span>;
                <span class="r43 r">logQuery</span>.<span class="i">ReverseDirection</span> = !<a href="#afb7079330393e9f" class="i field">_oldest</a>;
 
                <a href="#cfaef292fe881f6b" class="i method">ReadEvents</a>(<span class="r43 r">logQuery</span>);
            }
        }
 
        <span class="c">//</span>
        <span class="c">// Process HashQuerySet parameter set</span>
        <span class="c">//</span>
        <b>private void</b> <a id="0b2dcc24567630dd" href="R/0b2dcc24567630dd.html" target="n" data-glyph="76,1" class="i method">ProcessHashQuery</a>()
        {
            <a href="#3d0cbba1d5412863" class="i method">CheckHashTablesForNullValues</a>();
 
            <b>using</b> (<span class="i">EventLogSession</span> <span id="r45 rd" class="r45 r">eventLogSession</span> = <a href="#9d9b4a3ccb3725c2" class="i method">CreateSession</a>())
            {
                <b>string</b> <span id="r46 rd" class="r46 r">query</span> = <a href="#c8270995659e789a" class="i method">BuildStructuredQuery</a>(<span class="r45 r">eventLogSession</span>);
                <b>if</b> (<span class="r46 r">query</span>.<span class="i">Length</span> == 0)
                {
                    <b>return</b>;
                }
 
                <span class="i">EventLogQuery</span> <span id="r47 rd" class="r47 r">logQuery</span> = <b>new</b>(<b>null</b>, <span class="i">PathType</span>.<span class="i">FilePath</span>, <span class="r46 r">query</span>);
                <span class="r47 r">logQuery</span>.<span class="i">Session</span> = <span class="r45 r">eventLogSession</span>;
                <span class="r47 r">logQuery</span>.<span class="i">TolerateQueryErrors</span> = <b>true</b>;
                <span class="r47 r">logQuery</span>.<span class="i">ReverseDirection</span> = !<a href="#afb7079330393e9f" class="i field">_oldest</a>;
 
                <a href="#cfaef292fe881f6b" class="i method">ReadEvents</a>(<span class="r47 r">logQuery</span>);
            }
        }
 
        <span class="c">//</span>
        <span class="c">// CreateSession creates an EventLogSession connected to a target machine or localhost.</span>
        <span class="c">// If _credential argument is PSCredential.Empty, the session will be created for the current context.</span>
        <span class="c">//</span>
        <b>private</b> <span class="i">EventLogSession</span> <a id="9d9b4a3ccb3725c2" href="R/9d9b4a3ccb3725c2.html" target="n" data-glyph="76,1" class="i method">CreateSession</a>()
        {
            <span class="i">EventLogSession</span> <span id="r48 rd" class="r48 r">eventLogSession</span> = <b>null</b>;
 
            <b>if</b> (<a href="#6df85e391a946c71" class="i property">ComputerName</a> == <b>string</b>.<span class="i">Empty</span>)
            {
                <span class="c">// Set _computerName to &quot;localhost&quot; for future error messages,</span>
                <span class="c">// but do not use it for the connection to avoid RPC overhead.</span>
                <a href="#6df85e391a946c71" class="i property">ComputerName</a> = <span class="s">&quot;localhost&quot;</span>;
 
                <b>if</b> (<a href="#a544ec5f287586eb" class="i property">Credential</a> == <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a>.<a href="/System.Management.Automation/A.html#8c5314944c80f8ac" class="i property">Empty</a>)
                {
                    <b>return</b> <b>new</b> <span class="i">EventLogSession</span>();
                }
            }
            <b>else</b> <b>if</b> (<a href="#a544ec5f287586eb" class="i property">Credential</a> == <a href="/System.Management.Automation/A.html#6245dc122e2f1916" class="t t">PSCredential</a>.<a href="/System.Management.Automation/A.html#8c5314944c80f8ac" class="i property">Empty</a>)
            {
                <b>return</b> <b>new</b> <span class="i">EventLogSession</span>(<a href="#6df85e391a946c71" class="i property">ComputerName</a>);
            }
 
            <span class="c">// If we are here, either both computer name and credential were passed initially,</span>
            <span class="c">// or credential only - we will use it with &quot;localhost&quot;</span>
 
            <span class="i">NetworkCredential</span> <span id="r49 rd" class="r49 r">netCred</span> = (<span class="i">NetworkCredential</span>)<a href="#a544ec5f287586eb" class="i property">Credential</a>;
            <span class="r48 r">eventLogSession</span> = <b>new</b> <span class="i">EventLogSession</span>(<a href="#6df85e391a946c71" class="i property">ComputerName</a>,
                                 <span class="r49 r">netCred</span>.<span class="i">Domain</span>,
                                 <span class="r49 r">netCred</span>.<span class="i">UserName</span>,
                                 <a href="#a544ec5f287586eb" class="i property">Credential</a>.<a href="/System.Management.Automation/A.html#828d5fa008f1755c" class="i property">Password</a>,
                                 <span class="i">SessionAuthentication</span>.<span class="i">Default</span>
                                 );
            <span class="c">//</span>
            <span class="c">// Force the destruction of cached password</span>
            <span class="c">//</span>
            <span class="r49 r">netCred</span>.<span class="i">Password</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <b>return</b> <span class="r48 r">eventLogSession</span>;
        }
 
        <span class="c">//</span>
        <span class="c">// ReadEvents helper.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="cfaef292fe881f6b" href="R/cfaef292fe881f6b.html" target="n" data-glyph="76,1" class="i method">ReadEvents</a>(<span class="i">EventLogQuery</span> <span id="r50 rd" class="r50 r">logQuery</span>)
        {
            <b>using</b> (<span class="i">EventLogReader</span> <span id="r51 rd" class="r51 r">readerObj</span> = <b>new</b>(<span class="r50 r">logQuery</span>))
            {
                <b>long</b> <span id="r52 rd" class="r52 r">numEvents</span> = 0;
                <span class="i">EventRecord</span> <span id="r53 rd" class="r53 r">evtObj</span> = <b>null</b>;
 
                <b>while</b> (<b>true</b>)
                {
                    <b>try</b>
                    {
                        <span class="r53 r">evtObj</span> = <span class="r51 r">readerObj</span>.<span class="i">ReadEvent</span>();
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r54 rd" class="r54 r">exc</span>)
                    {
                        <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r54 r">exc</span>, <span class="r54 r">exc</span>.<span class="i">Message</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>));
                        <b>continue</b>;
                    }
 
                    <b>if</b> (<span class="r53 r">evtObj</span> == <b>null</b>)
                    {
                        <b>break</b>;
                    }
 
                    <b>if</b> (<a href="#500223e25ea273ff" class="i property">MaxEvents</a> != -1 &amp;&amp; <span class="r52 r">numEvents</span> &gt;= <a href="#500223e25ea273ff" class="i property">MaxEvents</a>)
                    {
                        <b>break</b>;
                    }
 
                    <a href="/System.Management.Automation/A.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r55 rd" class="r55 r">outputObj</span> = <b>new</b>(<span class="r53 r">evtObj</span>);
 
                    <b>string</b> <span id="r56 rd" class="r56 r">evtMessage</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoEventMessage&quot;</span>);
                    <b>try</b>
                    {
                        <span class="r56 r">evtMessage</span> = <span class="r53 r">evtObj</span>.<span class="i">FormatDescription</span>();
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r57 rd" class="r57 r">exc</span>)
                    {
                        <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r57 r">exc</span>, <span class="r57 r">exc</span>.<span class="i">Message</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>));
                    }
 
                    <span class="r55 r">outputObj</span>.<a href="/System.Management.Automation/A.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<span class="i">Add</span>(<b>new</b> <span class="t">PSNoteProperty</span>(<span class="s">&quot;Message&quot;</span>, <span class="r56 r">evtMessage</span>));
 
                    <span class="c">//</span>
                    <span class="c">// Enumerate the object one level to get to event payload</span>
                    <span class="c">//</span>
                    <span class="i">WriteObject</span>(<span class="r55 r">outputObj</span>, <b>true</b>);
                    <span class="r52 r">numEvents</span>++;
                }
 
                <b>if</b> (<span class="r52 r">numEvents</span> == 0)
                {
                    <b>string</b> <span id="r58 rd" class="r58 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoMatchingEventsFound&quot;</span>);
                    <span class="i">Exception</span> <span id="r59 rd" class="r59 r">exc</span> = <b>new</b>(<span class="r58 r">msg</span>);
                    <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r59 r">exc</span>, <span class="s">&quot;NoMatchingEventsFound&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <b>null</b>));
                }
            }
        }
 
        <span class="c">//</span>
        <span class="c">// BuildStructuredQuery() builds a structured query from cmdlet arguments.</span>
        <span class="c">//</span>
        <b>private string</b> <a id="c8270995659e789a" href="R/c8270995659e789a.html" target="n" data-glyph="76,1" class="i method">BuildStructuredQuery</a>(<span class="i">EventLogSession</span> <span id="r60 rd" class="r60 r">eventLogSession</span>)
        {
            <span class="i">StringBuilder</span> <span id="r61 rd" class="r61 r">result</span> = <b>new</b>();
 
            <b>switch</b> (<a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>)
            {
                <b>case</b> <span class="s">&quot;ListLogSet&quot;</span>:
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;ListProviderSet&quot;</span>:
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;GetProviderSet&quot;</span>:
                    {
                        <span class="r61 r">result</span>.<span class="i">Append</span>(<a href="#14331f24d8edf0a8" class="i field">queryListOpen</a>);
                        <b>uint</b> <span id="r62 rd" class="r62 r">queryId</span> = 0;
 
                        <b>foreach</b> (<b>string</b> <span id="r63 rd" class="r63 r">log</span> <b>in</b> <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Keys</span>)
                        {
                            <b>string</b> <span id="r64 rd" class="r64 r">providerFilter</span> = <span class="i">AddProviderPredicatesToFilter</span>(<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>[<span class="r63 r">log</span>]);
                            <span class="r61 r">result</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#175a4e26bb634402" class="i field">queryTemplate</a>, <b>new</b> <b>object</b>[] { <span class="r62 r">queryId</span>++, <span class="r63 r">log</span>, <span class="r64 r">providerFilter</span> });
                        }
 
                        <span class="r61 r">result</span>.<span class="i">Append</span>(<a href="#4b56200861f0dc08" class="i field">queryListClose</a>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;GetLogSet&quot;</span>:
                    {
                        <b>const int</b> <span id="r65 rd" class="r65 r">WindowsEventLogAPILimit</span> = 256;
                        <b>if</b> (<a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>.<span class="i">Count</span> &gt; <span class="r65 r">WindowsEventLogAPILimit</span>)
                        {
                            <b>string</b> <span id="r66 rd" class="r66 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;LogCountLimitExceeded&quot;</span>);
                            <span class="i">Exception</span> <span id="r67 rd" class="r67 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r66 r">msg</span>, <a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>.<span class="i">Count</span>, <span class="r65 r">WindowsEventLogAPILimit</span>));
                            <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r67 r">exc</span>, <span class="s">&quot;LogCountLimitExceeded&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#1706f5a396e7e4ad" class="i field">LimitsExceeded</a>, <b>null</b>));
                        }
 
                        <span class="r61 r">result</span>.<span class="i">Append</span>(<a href="#14331f24d8edf0a8" class="i field">queryListOpen</a>);
                        <b>uint</b> <span id="r68 rd" class="r68 r">queryId</span> = 0;
                        <b>foreach</b> (<b>string</b> <span id="r69 rd" class="r69 r">log</span> <b>in</b> <a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>)
                        {
                            <span class="r61 r">result</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#175a4e26bb634402" class="i field">queryTemplate</a>, <b>new</b> <b>object</b>[] { <span class="r68 r">queryId</span>++, <span class="r69 r">log</span>, <a href="#9011783579f2dda5" class="i property">FilterXPath</a> });
                        }
 
                        <span class="r61 r">result</span>.<span class="i">Append</span>(<a href="#4b56200861f0dc08" class="i field">queryListClose</a>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;FileSet&quot;</span>:
                    {
                        <span class="r61 r">result</span>.<span class="i">Append</span>(<a href="#14331f24d8edf0a8" class="i field">queryListOpen</a>);
                        <b>uint</b> <span id="r70 rd" class="r70 r">queryId</span> = 0;
                        <b>foreach</b> (<b>string</b> <span id="r71 rd" class="r71 r">filePath</span> <b>in</b> <a href="#43e2c958b27a8860" class="i field">_resolvedPaths</a>)
                        {
                            <b>string</b> <span id="r72 rd" class="r72 r">properFilePath</span> = <a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r71 r">filePath</span>;
                            <span class="r61 r">result</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#175a4e26bb634402" class="i field">queryTemplate</a>, <b>new</b> <b>object</b>[] { <span class="r70 r">queryId</span>++, <span class="r72 r">properFilePath</span>, <a href="#9011783579f2dda5" class="i property">FilterXPath</a> });
                        }
 
                        <span class="r61 r">result</span>.<span class="i">Append</span>(<a href="#4b56200861f0dc08" class="i field">queryListClose</a>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <span class="s">&quot;HashQuerySet&quot;</span>:
                    <span class="r61 r">result</span>.<span class="i">Append</span>(<a href="#d7f240554bb5ffa4" class="i method">BuildStructuredQueryFromHashTable</a>(<span class="r60 r">eventLogSession</span>));
                    <b>break</b>;
 
                <b>default</b>:
                    <span class="i">WriteDebug</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;Invalid parameter set name: {0}&quot;</span>, <a href="/System.Management.Automation/A.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>));
                    <b>break</b>;
            }
 
            <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;QueryTrace&quot;</span>), <span class="r61 r">result</span>.<span class="i">ToString</span>()));
 
            <b>return</b> <span class="r61 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// BuildXPathFromHashTable() build xpath from hashtable</span>
        <span class="c">//</span>
        <b>private string</b> <a id="de1978cfb1595a19" href="R/de1978cfb1595a19.html" target="n" data-glyph="76,1" class="i method">BuildXPathFromHashTable</a>(<span class="i">Hashtable</span> <span id="r73 rd" class="r73 r">hash</span>)
        {
            <span class="i">StringBuilder</span> <span id="r74 rd" class="r74 r">xpathString</span> = <b>new</b>(<b>string</b>.<span class="i">Empty</span>);
            <b>bool</b> <span id="r75 rd" class="r75 r">bDateTimeHandled</span> = <b>false</b>;
 
            <b>foreach</b> (<b>string</b> <span id="r76 rd" class="r76 r">key</span> <b>in</b> <span class="r73 r">hash</span>.<span class="i">Keys</span>)
            {
                <b>string</b> <span id="r77 rd" class="r77 r">added</span> = <b>string</b>.<span class="i">Empty</span>;
 
                <b>switch</b> (<span class="r76 r">key</span>.<span class="i">ToLowerInvariant</span>())
                {
                    <b>case</b> <a href="#ffb34fd74196c5f9" class="i field">hashkey_logname_lc</a>:
                    <b>case</b> <a href="#181201922f43f2d9" class="i field">hashkey_path_lc</a>:
                    <b>case</b> <a href="#431158b05e5eb10d" class="i field">hashkey_providername_lc</a>:
                        <b>break</b>;
                    <b>case</b> <a href="#ad036d2f8c92790c" class="i field">hashkey_id_lc</a>:
                        <span class="r77 r">added</span> = <span class="i">HandleEventIdHashValue</span>(<span class="r73 r">hash</span>[<span class="r76 r">key</span>]);
                        <b>break</b>;
 
                    <b>case</b> <a href="#eb18c2aa793a3986" class="i field">hashkey_level_lc</a>:
                        <span class="r77 r">added</span> = <span class="i">HandleLevelHashValue</span>(<span class="r73 r">hash</span>[<span class="r76 r">key</span>]);
                        <b>break</b>;
 
                    <b>case</b> <a href="#bf5a856a2b8a4701" class="i field">hashkey_keywords_lc</a>:
                        <span class="r77 r">added</span> = <span class="i">HandleKeywordHashValue</span>(<span class="r73 r">hash</span>[<span class="r76 r">key</span>]);
                        <b>break</b>;
 
                    <b>case</b> <a href="#162f8f99c08fdb70" class="i field">hashkey_starttime_lc</a>:
                        <b>if</b> (<span class="r75 r">bDateTimeHandled</span>)
                        {
                            <b>break</b>;
                        }
 
                        <span class="r77 r">added</span> = <span class="i">HandleStartTimeHashValue</span>(<span class="r73 r">hash</span>[<span class="r76 r">key</span>], <span class="r73 r">hash</span>);
 
                        <span class="r75 r">bDateTimeHandled</span> = <b>true</b>;
                        <b>break</b>;
 
                    <b>case</b> <a href="#6c5febf79664ca8a" class="i field">hashkey_endtime_lc</a>:
                        <b>if</b> (<span class="r75 r">bDateTimeHandled</span>)
                        {
                            <b>break</b>;
                        }
 
                        <span class="r77 r">added</span> = <span class="i">HandleEndTimeHashValue</span>(<span class="r73 r">hash</span>[<span class="r76 r">key</span>], <span class="r73 r">hash</span>);
 
                        <span class="r75 r">bDateTimeHandled</span> = <b>true</b>;
                        <b>break</b>;
 
                    <b>case</b> <a href="#4cc373408de93d20" class="i field">hashkey_data_lc</a>:
                        <span class="r77 r">added</span> = <span class="i">HandleDataHashValue</span>(<span class="r73 r">hash</span>[<span class="r76 r">key</span>]);
                        <b>break</b>;
 
                    <b>case</b> <a href="#80e6c61a8ebfb21d" class="i field">hashkey_userid_lc</a>:
                        <span class="r77 r">added</span> = <span class="i">HandleContextHashValue</span>(<span class="r73 r">hash</span>[<span class="r76 r">key</span>]);
                        <b>break</b>;
 
                    <b>case</b> <a href="#190c457661ad8acd" class="i field">hashkey_supress_lc</a>:
                        <b>break</b>;
                    <b>default</b>:
                        {
                            <span class="c">//</span>
                            <span class="c">// None of the recognized values: this must be a named event data field</span>
                            <span class="c">//</span>
                            <span class="c">// Fix Issue #2327</span>
                            <span class="r77 r">added</span> = <span class="i">HandleNamedDataHashValue</span>(<span class="r76 r">key</span>, <span class="r73 r">hash</span>[<span class="r76 r">key</span>]);
                        }
 
                        <b>break</b>;
                }
 
                <b>if</b> (<span class="r77 r">added</span>.<span class="i">Length</span> &gt; 0)
                {
                    <b>if</b> (<span class="r74 r">xpathString</span>.<span class="i">Length</span> != 0)
                    {
                        <span class="r74 r">xpathString</span>.<span class="i">Append</span>(<span class="s">&quot; and &quot;</span>);
                    }
 
                    <span class="r74 r">xpathString</span>.<span class="i">Append</span>(<span class="r77 r">added</span>);
                }
            }
 
            <b>return</b> <span class="r74 r">xpathString</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// BuildStructuredQueryFromHashTable() helper.</span>
        <span class="c">// Builds a structured query from the hashtable (Selector) argument.</span>
        <span class="c">//</span>
        <b>private string</b> <a id="d7f240554bb5ffa4" href="R/d7f240554bb5ffa4.html" target="n" data-glyph="76,1" class="i method">BuildStructuredQueryFromHashTable</a>(<span class="i">EventLogSession</span> <span id="r78 rd" class="r78 r">eventLogSession</span>)
        {
            <span class="i">StringBuilder</span> <span id="r79 rd" class="r79 r">result</span> = <b>new</b>(<b>string</b>.<span class="i">Empty</span>);
 
            <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#14331f24d8edf0a8" class="i field">queryListOpen</a>);
 
            <b>uint</b> <span id="r80 rd" class="r80 r">queryId</span> = 0;
 
            <b>foreach</b> (<span class="i">Hashtable</span> <span id="r81 rd" class="r81 r">hash</span> <b>in</b> <a href="#ee8d9156a8e0178d" class="i property">FilterHashtable</a>)
            {
                <b>string</b> <span id="r82 rd" class="r82 r">xpathString</span> = <b>string</b>.<span class="i">Empty</span>;
                <b>string</b> <span id="r83 rd" class="r83 r">xpathStringSuppress</span> = <b>string</b>.<span class="i">Empty</span>;
 
                <a href="#6a488bee86b98e3e" class="i method">CheckHashTableForQueryPathPresence</a>(<span class="r81 r">hash</span>);
 
                <span class="c">//</span>
                <span class="c">// Local queriedLogsQueryMap will hold names of logs or files to be queried</span>
                <span class="c">// mapped to the actual query strings being built up.</span>
                <span class="c">//</span>
                <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r84 rd" class="r84 r">queriedLogsQueryMap</span> = <b>new</b>();
 
                <span class="c">//</span>
                <span class="c">// queriedLogsQueryMapSuppress is the same as queriedLogsQueryMap but for &lt;Suppress&gt;</span>
                <span class="c">//</span>
                <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r85 rd" class="r85 r">queriedLogsQueryMapSuppress</span> = <b>new</b>();
 
                <span class="c">//</span>
                <span class="c">// Process log, _path, or provider parameters first</span>
                <span class="c">// to create initial partially-filled query templates.</span>
                <span class="c">// Error out for direct channels unless -oldest is present.</span>
                <span class="c">//</span>
                <span class="c">// Order is important! Process &quot;providername&quot; key after &quot;logname&quot; and &quot;file&quot;.</span>
                <span class="c">//</span>
                <b>if</b> (<span class="r81 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#ffb34fd74196c5f9" class="i field">hashkey_logname_lc</a>))
                {
                    <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r86 rd" class="r86 r">logPatterns</span> = <b>new</b>();
                    <b>if</b> (<span class="r81 r">hash</span>[<a href="#ffb34fd74196c5f9" class="i field">hashkey_logname_lc</a>] <b>is</b> <span class="i">Array</span>)
                    {
                        <b>foreach</b> (<b>object</b> <span id="r87 rd" class="r87 r">elt</span> <b>in</b> (<span class="i">Array</span>)<span class="r81 r">hash</span>[<a href="#ffb34fd74196c5f9" class="i field">hashkey_logname_lc</a>])
                        {
                            <span class="r86 r">logPatterns</span>.<span class="i">Add</span>(<span class="r87 r">elt</span>.<span class="i">ToString</span>());
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r86 r">logPatterns</span>.<span class="i">Add</span>(<span class="r81 r">hash</span>[<a href="#ffb34fd74196c5f9" class="i field">hashkey_logname_lc</a>].<span class="i">ToString</span>());
                    }
 
                    <span class="i">FindLogNamesMatchingWildcards</span>(<span class="r78 r">eventLogSession</span>, <span class="r86 r">logPatterns</span>);
 
                    <b>foreach</b> (<b>string</b> <span id="r88 rd" class="r88 r">logName</span> <b>in</b> <a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>)
                    {
                        <span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Add</span>(<span class="r88 r">logName</span>.<span class="i">ToLowerInvariant</span>(),
                                                <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#40a2e1a5f048f566" class="i field">queryOpenerTemplate</a>, <span class="r80 r">queryId</span>++, <span class="r88 r">logName</span>));
                        <span class="r85 r">queriedLogsQueryMapSuppress</span>.<span class="i">Add</span>(<span class="r88 r">logName</span>.<span class="i">ToLowerInvariant</span>(),
                                                        <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#ebfddc35dc6957bc" class="i field">suppressOpener</a>, <span class="r80 r">queryId</span>++, <span class="r88 r">logName</span>));
                    }
                }
 
                <b>if</b> (<span class="r81 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#181201922f43f2d9" class="i field">hashkey_path_lc</a>))
                {
                    <b>if</b> (<span class="r81 r">hash</span>[<a href="#181201922f43f2d9" class="i field">hashkey_path_lc</a>] <b>is</b> <span class="i">Array</span>)
                    {
                        <b>foreach</b> (<b>object</b> <span id="r89 rd" class="r89 r">elt</span> <b>in</b> (<span class="i">Array</span>)<span class="r81 r">hash</span>[<a href="#181201922f43f2d9" class="i field">hashkey_path_lc</a>])
                        {
                            <span class="i">StringCollection</span> <span id="r90 rd" class="r90 r">resolvedPaths</span> = <span class="i">ValidateAndResolveFilePath</span>(<span class="r89 r">elt</span>.<span class="i">ToString</span>());
                            <b>foreach</b> (<b>string</b> <span id="r91 rd" class="r91 r">resolvedPath</span> <b>in</b> <span class="r90 r">resolvedPaths</span>)
                            {
                                <span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Add</span>(<a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r91 r">resolvedPath</span>.<span class="i">ToLowerInvariant</span>(),
                                                        <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#40a2e1a5f048f566" class="i field">queryOpenerTemplate</a>, <span class="r80 r">queryId</span>++, <a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r91 r">resolvedPath</span>));
                                <span class="r85 r">queriedLogsQueryMapSuppress</span>.<span class="i">Add</span>(<a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r91 r">resolvedPath</span>.<span class="i">ToLowerInvariant</span>(),
                                                                <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#ebfddc35dc6957bc" class="i field">suppressOpener</a>, <span class="r80 r">queryId</span>++, <a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r91 r">resolvedPath</span>));
                            }
                        }
                    }
                    <b>else</b>
                    {
                        <span class="i">StringCollection</span> <span id="r92 rd" class="r92 r">resolvedPaths</span> = <span class="i">ValidateAndResolveFilePath</span>(<span class="r81 r">hash</span>[<a href="#181201922f43f2d9" class="i field">hashkey_path_lc</a>].<span class="i">ToString</span>());
                        <b>foreach</b> (<b>string</b> <span id="r93 rd" class="r93 r">resolvedPath</span> <b>in</b> <span class="r92 r">resolvedPaths</span>)
                        {
                            <span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Add</span>(<a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r93 r">resolvedPath</span>.<span class="i">ToLowerInvariant</span>(),
                                                    <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#40a2e1a5f048f566" class="i field">queryOpenerTemplate</a>, <span class="r80 r">queryId</span>++, <a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r93 r">resolvedPath</span>));
                            <span class="r85 r">queriedLogsQueryMapSuppress</span>.<span class="i">Add</span>(<a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r93 r">resolvedPath</span>.<span class="i">ToLowerInvariant</span>(),
                                                            <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#ebfddc35dc6957bc" class="i field">suppressOpener</a>, <span class="r80 r">queryId</span>++, <a href="#1f701fab25c264e8" class="i field">filePrefix</a> + <span class="r93 r">resolvedPath</span>));
                        }
                    }
                }
 
                <b>if</b> (<span class="r81 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#431158b05e5eb10d" class="i field">hashkey_providername_lc</a>))
                {
                    <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r94 rd" class="r94 r">provPatterns</span> = <b>new</b>();
                    <b>if</b> (<span class="r81 r">hash</span>[<a href="#431158b05e5eb10d" class="i field">hashkey_providername_lc</a>] <b>is</b> <span class="i">Array</span>)
                    {
                        <b>foreach</b> (<b>object</b> <span id="r95 rd" class="r95 r">elt</span> <b>in</b> (<span class="i">Array</span>)<span class="r81 r">hash</span>[<a href="#431158b05e5eb10d" class="i field">hashkey_providername_lc</a>])
                        {
                            <span class="r94 r">provPatterns</span>.<span class="i">Add</span>(<span class="r95 r">elt</span>.<span class="i">ToString</span>());
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r94 r">provPatterns</span>.<span class="i">Add</span>(<span class="r81 r">hash</span>[<a href="#431158b05e5eb10d" class="i field">hashkey_providername_lc</a>].<span class="i">ToString</span>());
                    }
 
                    <span class="i">FindProvidersByLogForWildcardPatterns</span>(<span class="r78 r">eventLogSession</span>, <span class="r94 r">provPatterns</span>);
 
                    <span class="c">//</span>
                    <span class="c">// If &quot;providername&quot; key is used alone, we will construct a query across all of the providers&#39; logs.</span>
                    <span class="c">// Otherwise, we will use the provider names to add predicates to &quot;logname&quot; and &quot;path&quot; queries.</span>
                    <span class="c">//</span>
                    <b>if</b> (!<span class="r81 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#181201922f43f2d9" class="i field">hashkey_path_lc</a>) &amp;&amp; !<span class="r81 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#ffb34fd74196c5f9" class="i field">hashkey_logname_lc</a>))
                    {
                        <b>foreach</b> (<b>string</b> <span id="r96 rd" class="r96 r">keyLogName</span> <b>in</b> <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Keys</span>)
                        {
                            <b>string</b> <span id="r97 rd" class="r97 r">providersPredicate</span> = <span class="i">BuildProvidersPredicate</span>(<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>[<span class="r96 r">keyLogName</span>]);
                            <b>string</b> <span id="r98 rd" class="r98 r">query</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#40a2e1a5f048f566" class="i field">queryOpenerTemplate</a>, <span class="r80 r">queryId</span>++, <span class="r96 r">keyLogName</span>);
                            <span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Add</span>(<span class="r96 r">keyLogName</span>.<span class="i">ToLowerInvariant</span>(),
                                                     <span class="r98 r">query</span> + <span class="s">&quot;[&quot;</span> + <span class="r97 r">providersPredicate</span>);
                            <span class="r85 r">queriedLogsQueryMapSuppress</span>.<span class="i">Add</span>(<span class="r96 r">keyLogName</span>.<span class="i">ToLowerInvariant</span>(),
                                                            <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#ebfddc35dc6957bc" class="i field">suppressOpener</a>, <span class="r80 r">queryId</span>++, <span class="r96 r">keyLogName</span>.<span class="i">ToLowerInvariant</span>()));
                        }
                    }
                    <b>else</b>
                    {
                        <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r99 rd" class="r99 r">keysList</span> = <b>new</b>(<span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Keys</span>);
                        <b>bool</b> <span id="r100 rd" class="r100 r">bRemovedIrrelevantLogs</span> = <b>false</b>;
                        <b>foreach</b> (<b>string</b> <span id="r101 rd" class="r101 r">queriedLog</span> <b>in</b> <span class="r99 r">keysList</span>)
                        {
                            <b>if</b> (<span class="r101 r">queriedLog</span>.<span class="i">StartsWith</span>(<a href="#1f701fab25c264e8" class="i field">filePrefix</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                            {
                                <span class="r84 r">queriedLogsQueryMap</span>[<span class="r101 r">queriedLog</span>] += <span class="s">&quot;[&quot;</span> + <a href="#52c31b35be6cb3b2" class="i method">BuildAllProvidersPredicate</a>();
                            }
                            <b>else</b>
                            {
                                <b>if</b> (<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">ContainsKey</span>(<span class="r101 r">queriedLog</span>))
                                {
                                    <b>string</b> <span id="r102 rd" class="r102 r">providersPredicate</span> = <span class="i">BuildProvidersPredicate</span>(<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>[<span class="r101 r">queriedLog</span>]);
                                    <span class="r84 r">queriedLogsQueryMap</span>[<span class="r101 r">queriedLog</span>] += <span class="s">&quot;[&quot;</span> + <span class="r102 r">providersPredicate</span>;
                                }
                                <b>else</b>
                                {
                                    <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;SpecifiedProvidersDontWriteToLog&quot;</span>), <span class="r101 r">queriedLog</span>));
                                    <span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Remove</span>(<span class="r101 r">queriedLog</span>);
                                    <span class="r85 r">queriedLogsQueryMapSuppress</span>.<span class="i">Remove</span>(<span class="r101 r">queriedLog</span>);
                                    <span class="r100 r">bRemovedIrrelevantLogs</span> = <b>true</b>;
                                }
                            }
                        }
                        <span class="c">//</span>
                        <span class="c">// Write an error if we have removed all the logs as irrelevant</span>
                        <span class="c">//</span>
                        <b>if</b> (<span class="r100 r">bRemovedIrrelevantLogs</span> &amp;&amp; (<span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Count</span> == 0))
                        {
                            <b>string</b> <span id="r103 rd" class="r103 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;LogsAndProvidersDontOverlap&quot;</span>));
                            <span class="i">Exception</span> <span id="r104 rd" class="r104 r">exc</span> = <b>new</b>(<span class="r103 r">msg</span>);
                            <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r104 r">exc</span>, <span class="s">&quot;LogsAndProvidersDontOverlap&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>));
                            <b>continue</b>;
                        }
                    }
                }
 
                <span class="c">//</span>
                <span class="c">// If none of the logs/paths/providers were valid, queriedLogsQueryMap is empty.</span>
                <span class="c">// Simply continue to the next hashtable since all the errors have been written already.</span>
                <span class="c">//</span>
                <b>if</b> (<span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Count</span> == 0)
                {
                    <b>continue</b>;
                }
 
                <span class="c">//</span>
                <span class="c">// At this point queriedLogsQueryMap contains all the query openings: missing the actual XPaths</span>
                <span class="c">// Let&#39;s build xpathString to attach to each query opening.</span>
                <span class="c">//</span>
                <span class="r82 r">xpathString</span> = <a href="#de1978cfb1595a19" class="i method">BuildXPathFromHashTable</a>(<span class="r81 r">hash</span>);
 
                <span class="c">//</span>
                <span class="c">// Build xpath for &lt;Suppress&gt;</span>
                <span class="c">//</span>
                <span class="i">Hashtable</span> <span id="r105 rd" class="r105 r">suppresshash</span> = <span class="r81 r">hash</span>[<a href="#190c457661ad8acd" class="i field">hashkey_supress_lc</a>] <b>as</b> <span class="i">Hashtable</span>;
                <b>if</b> (<span class="r105 r">suppresshash</span> != <b>null</b>)
                {
                    <span class="r83 r">xpathStringSuppress</span> = <a href="#de1978cfb1595a19" class="i method">BuildXPathFromHashTable</a>(<span class="r105 r">suppresshash</span>);
                }
 
                <span class="c">//</span>
                <span class="c">// Complete each query with the XPath.</span>
                <span class="c">// Handle the case where the query opener already has provider predicate(s).</span>
                <span class="c">// Add the queries from queriedLogsQueryMap into the resulting string.</span>
                <span class="c">// Add &lt;Suppress&gt; from queriedLogsQueryMapSuppress into the resulting string.</span>
                <span class="c">//</span>
                <b>foreach</b> (<b>string</b> <span id="r106 rd" class="r106 r">keyLogName</span> <b>in</b> <span class="r84 r">queriedLogsQueryMap</span>.<span class="i">Keys</span>)
                {
                    <span class="c">// For every Log a separate query is</span>
                    <b>string</b> <span id="r107 rd" class="r107 r">query</span> = <span class="r84 r">queriedLogsQueryMap</span>[<span class="r106 r">keyLogName</span>];
                    <span class="r79 r">result</span>.<span class="i">Append</span>(<span class="r107 r">query</span>);
 
                    <b>if</b> (<span class="r107 r">query</span>.<span class="i">EndsWith</span>(<span class="s">&#39;*&#39;</span>))
                    {
                        <span class="c">//</span>
                        <span class="c">// No provider predicate: just add the XPath string</span>
                        <span class="c">//</span>
                        <b>if</b> (<span class="r82 r">xpathString</span>.<span class="i">Length</span> != 0)
                        {
                            <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#04aba2018e9db28c" class="i field">propOpen</a>).<span class="i">Append</span>(<span class="r82 r">xpathString</span>).<span class="i">Append</span>(<a href="#41cfd5f6cb5dd31e" class="i field">propClose</a>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">//</span>
                        <span class="c">// Add xpathString to provider predicates.</span>
                        <span class="c">//</span>
                        <b>if</b> (<span class="r82 r">xpathString</span>.<span class="i">Length</span> != 0)
                        {
                            <span class="r79 r">result</span>.<span class="i">Append</span>(<span class="s">&quot; and &quot;</span>).<span class="i">Append</span>(<span class="r82 r">xpathString</span>);
                        }
 
                        <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#41cfd5f6cb5dd31e" class="i field">propClose</a>);
                    }
 
                    <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#92de1cb1fff26bf8" class="i field">SelectCloser</a>);
 
                    <b>if</b> (<span class="r83 r">xpathStringSuppress</span>.<span class="i">Length</span> != 0)
                    {
                        <span class="c">// Add &lt;Suppress&gt;*xpathStringSuppress&lt;/Suppress&gt; into query</span>
                        <b>string</b> <span id="r108 rd" class="r108 r">suppress</span> = <span class="r85 r">queriedLogsQueryMapSuppress</span>[<span class="r106 r">keyLogName</span>];
                        <span class="r79 r">result</span>.<span class="i">Append</span>(<span class="r108 r">suppress</span>);
                        <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#04aba2018e9db28c" class="i field">propOpen</a>).<span class="i">Append</span>(<span class="r83 r">xpathStringSuppress</span>).<span class="i">Append</span>(<a href="#41cfd5f6cb5dd31e" class="i field">propClose</a>);
                        <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#163a6a35a3c4669a" class="i field">suppressCloser</a>);
                    }
 
                    <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#665eebc2d0fd1366" class="i field">queryCloser</a>);
                }
            }
 
            <span class="r79 r">result</span>.<span class="i">Append</span>(<a href="#4b56200861f0dc08" class="i field">queryListClose</a>);
 
            <b>return</b> <span class="r79 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// HandleEventIdHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns EventId XPath portion as a string.</span>
        <span class="c">//</span>
        <b>private static string</b> <a id="ae11e67f107dfc53" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleEventIdHashValue</a>(<b>object</b> <span id="r109 rd" class="r109 r">value</span>)
        {
            <span class="i">StringBuilder</span> <span id="r110 rd" class="r110 r">ret</span> = <b>new</b>();
            <span class="i">Array</span> <span id="r111 rd" class="r111 r">idsArray</span> = <span class="r109 r">value</span> <b>as</b> <span class="i">Array</span>;
            <b>if</b> (<span class="r111 r">idsArray</span> != <b>null</b>)
            {
                <span class="r110 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;(&#39;</span>);
                <b>for</b> (<b>int</b> <span id="r112 rd" class="r112 r">i</span> = 0; <span class="r112 r">i</span> &lt; <span class="r111 r">idsArray</span>.<span class="i">Length</span>; <span class="r112 r">i</span>++)
                {
                    <span class="r110 r">ret</span>.<span class="i">Append</span>(<a href="#914222e3d577781b" class="i field">SystemEventIDTemplate</a>).<span class="i">Append</span>(<span class="r111 r">idsArray</span>.<span class="i">GetValue</span>(<span class="r112 r">i</span>).<span class="i">ToString</span>()).<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
                    <b>if</b> (<span class="r112 r">i</span> &lt; (<span class="r111 r">idsArray</span>.<span class="i">Length</span> - 1))
                    {
                        <span class="r110 r">ret</span>.<span class="i">Append</span>(<span class="s">&quot; or &quot;</span>);
                    }
                }
 
                <span class="r110 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
            }
            <b>else</b>
            {
                <span class="r110 r">ret</span>.<span class="i">Append</span>(<a href="#914222e3d577781b" class="i field">SystemEventIDTemplate</a>).<span class="i">Append</span>(<span class="r109 r">value</span>).<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
            }
 
            <b>return</b> <span class="r110 r">ret</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// HandleLevelHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns Level XPath portion as a string.</span>
        <span class="c">//</span>
        <b>private static string</b> <a id="3d63a753ec1a29d6" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleLevelHashValue</a>(<b>object</b> <span id="r113 rd" class="r113 r">value</span>)
        {
            <span class="i">StringBuilder</span> <span id="r114 rd" class="r114 r">ret</span> = <b>new</b>();
            <span class="i">Array</span> <span id="r115 rd" class="r115 r">levelsArray</span> = <span class="r113 r">value</span> <b>as</b> <span class="i">Array</span>;
            <b>if</b> (<span class="r115 r">levelsArray</span> != <b>null</b>)
            {
                <span class="r114 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;(&#39;</span>);
                <b>for</b> (<b>int</b> <span id="r116 rd" class="r116 r">i</span> = 0; <span class="r116 r">i</span> &lt; <span class="r115 r">levelsArray</span>.<span class="i">Length</span>; <span class="r116 r">i</span>++)
                {
                    <span class="r114 r">ret</span>.<span class="i">Append</span>(<a href="#307294b618d632f2" class="i field">SystemLevelTemplate</a>).<span class="i">Append</span>(<span class="r115 r">levelsArray</span>.<span class="i">GetValue</span>(<span class="r116 r">i</span>).<span class="i">ToString</span>()).<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
                    <b>if</b> (<span class="r116 r">i</span> &lt; (<span class="r115 r">levelsArray</span>.<span class="i">Length</span> - 1))
                    {
                        <span class="r114 r">ret</span>.<span class="i">Append</span>(<span class="s">&quot; or &quot;</span>);
                    }
                }
 
                <span class="r114 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
            }
            <b>else</b>
            {
                <span class="r114 r">ret</span>.<span class="i">Append</span>(<a href="#307294b618d632f2" class="i field">SystemLevelTemplate</a>).<span class="i">Append</span>(<span class="r113 r">value</span>).<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
            }
 
            <b>return</b> <span class="r114 r">ret</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// HandleKeywordHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns Keyword XPath portion as a string.</span>
        <span class="c">//</span>
        <b>private string</b> <a id="086750d5d53b4236" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleKeywordHashValue</a>(<b>object</b> <span id="r117 rd" class="r117 r">value</span>)
        {
            <b>long</b> <span id="r118 rd" class="r118 r">keywordsMask</span> = 0;
            <b>long</b> <span id="r119 rd" class="r119 r">keywordLong</span> = 0;
 
            <span class="i">Array</span> <span id="r120 rd" class="r120 r">keywordArray</span> = <span class="r117 r">value</span> <b>as</b> <span class="i">Array</span>;
            <b>if</b> (<span class="r120 r">keywordArray</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>object</b> <span id="r121 rd" class="r121 r">keyword</span> <b>in</b> <span class="r120 r">keywordArray</span>)
                {
                    <b>if</b> (<span class="i">KeywordStringToInt64</span>(<span class="r121 r">keyword</span>.<span class="i">ToString</span>(), <b>ref</b> <span class="r119 r">keywordLong</span>))
                    {
                        <span class="r118 r">keywordsMask</span> |= <span class="r119 r">keywordLong</span>;
                    }
                }
            }
            <b>else</b>
            {
                <b>if</b> (!<span class="i">KeywordStringToInt64</span>(<span class="r117 r">value</span>.<span class="i">ToString</span>(), <b>ref</b> <span class="r119 r">keywordLong</span>))
                {
                    <b>return</b> <b>string</b>.<span class="i">Empty</span>;
                }
 
                <span class="r118 r">keywordsMask</span> |= <span class="r119 r">keywordLong</span>;
            }
 
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#9c5417bc56229d0e" class="i field">SystemKeywordsTemplate</a>, <span class="r118 r">keywordsMask</span>);
        }
 
        <span class="c">//</span>
        <span class="c">// HandleContextHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns UserID XPath portion as a string.</span>
        <span class="c">// Handles both SIDs and domain account names.</span>
        <span class="c">// Writes an error and returns an empty string if the SID or account names are not valid.</span>
        <span class="c">//</span>
        <b>private string</b> <a id="4690a1ec1f177151" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleContextHashValue</a>(<b>object</b> <span id="r122 rd" class="r122 r">value</span>)
        {
            <span class="i">SecurityIdentifier</span> <span id="r123 rd" class="r123 r">sidCandidate</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r123 r">sidCandidate</span> = <b>new</b> <span class="i">SecurityIdentifier</span>(<span class="r122 r">value</span>.<span class="i">ToString</span>());
            }
            <b>catch</b> (<span class="i">ArgumentException</span>)
            {
                <span class="i">WriteDebug</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;InvalidSIDFormat&quot;</span>), <span class="r122 r">value</span>));
            }
 
            <b>if</b> (<span class="r123 r">sidCandidate</span> == <b>null</b>)
            {
                <b>try</b>
                {
                    <span class="i">NTAccount</span> <span id="r124 rd" class="r124 r">acct</span> = <b>new</b>(<span class="r122 r">value</span>.<span class="i">ToString</span>());
                    <span class="r123 r">sidCandidate</span> = (<span class="i">SecurityIdentifier</span>)<span class="r124 r">acct</span>.<span class="i">Translate</span>(<b>typeof</b>(<span class="i">SecurityIdentifier</span>));
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r125 rd" class="r125 r">exc</span>)
                {
                    <b>string</b> <span id="r126 rd" class="r126 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;InvalidContext&quot;</span>), <span class="r122 r">value</span>.<span class="i">ToString</span>());
                    <span class="i">Exception</span> <span id="r127 rd" class="r127 r">outerExc</span> = <b>new</b>(<span class="r126 r">msg</span>, <span class="r125 r">exc</span>);
                    <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r127 r">outerExc</span>, <span class="s">&quot;InvalidContext&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>));
                    <b>return</b> <b>string</b>.<span class="i">Empty</span>;
                }
            }
 
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#f9638bbc09c6fbd4" class="i field">SystemSecurityTemplate</a>, <span class="r123 r">sidCandidate</span>.<span class="i">ToString</span>());
        }
 
        <span class="c">//</span>
        <span class="c">// HandleStartTimeHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns TimeCreated XPath portion as a string.</span>
        <span class="c">// NOTE that it also handles the hashtable &quot;endtime&quot; value (if supplied).</span>
        <span class="c">//</span>
        <b>private string</b> <a id="ca39775801107b50" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleStartTimeHashValue</a>(<b>object</b> <span id="r128 rd" class="r128 r">value</span>, <span class="i">Hashtable</span> <span id="r129 rd" class="r129 r">hash</span>)
        {
            <span class="i">StringBuilder</span> <span id="r130 rd" class="r130 r">ret</span> = <b>new</b>();
            <span class="i">DateTime</span> <span id="r131 rd" class="r131 r">startTime</span> = <b>new</b>();
            <b>if</b> (!<span class="i">StringToDateTime</span>(<span class="r128 r">value</span>.<span class="i">ToString</span>(), <b>ref</b> <span class="r131 r">startTime</span>))
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <span class="r131 r">startTime</span> = <span class="r131 r">startTime</span>.<span class="i">ToUniversalTime</span>();
            <b>string</b> <span id="r132 rd" class="r132 r">startTimeFormatted</span> = <span class="r131 r">startTime</span>.<span class="i">ToString</span>(<span class="s">&quot;s&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;.&quot;</span> + <span class="r131 r">startTime</span>.<span class="i">Millisecond</span>.<span class="i">ToString</span>(<span class="s">&quot;d3&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;Z&quot;</span>;
 
            <b>if</b> (<span class="r129 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#6c5febf79664ca8a" class="i field">hashkey_endtime_lc</a>))
            {
                <span class="i">DateTime</span> <span id="r133 rd" class="r133 r">endTime</span> = <b>new</b>();
                <b>if</b> (!<span class="i">StringToDateTime</span>(<span class="r129 r">hash</span>[<a href="#6c5febf79664ca8a" class="i field">hashkey_endtime_lc</a>].<span class="i">ToString</span>(), <b>ref</b> <span class="r133 r">endTime</span>))
                {
                    <b>return</b> <b>string</b>.<span class="i">Empty</span>;
                }
 
                <span class="r133 r">endTime</span> = <span class="r133 r">endTime</span>.<span class="i">ToUniversalTime</span>();
                <b>string</b> <span id="r134 rd" class="r134 r">endTimeFormatted</span> = <span class="r133 r">endTime</span>.<span class="i">ToString</span>(<span class="s">&quot;s&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;.&quot;</span> + <span class="r133 r">endTime</span>.<span class="i">Millisecond</span>.<span class="i">ToString</span>(<span class="s">&quot;d3&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;Z&quot;</span>;
 
                <span class="r130 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                 <a href="#0df79be703ebb6b6" class="i field">SystemTimePeriodTemplate</a>,
                                 <span class="r132 r">startTimeFormatted</span>,
                                 <span class="r134 r">endTimeFormatted</span>);
            }
            <b>else</b>
            {
                <span class="r130 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                 <a href="#48273561a4dc08e5" class="i field">SystemTimeStartTemplate</a>,
                                 <span class="r132 r">startTimeFormatted</span>);
            }
 
            <b>return</b> <span class="r130 r">ret</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// HandleEndTimeHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns TimeCreated XPath portion as a string.</span>
        <span class="c">// NOTE that it also handles the hashtable &quot;starttime&quot; value (if supplied).</span>
        <span class="c">//</span>
        <b>private string</b> <a id="99111c162eb4f13d" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleEndTimeHashValue</a>(<b>object</b> <span id="r135 rd" class="r135 r">value</span>, <span class="i">Hashtable</span> <span id="r136 rd" class="r136 r">hash</span>)
        {
            <span class="i">StringBuilder</span> <span id="r137 rd" class="r137 r">ret</span> = <b>new</b>();
            <span class="i">DateTime</span> <span id="r138 rd" class="r138 r">endTime</span> = <b>new</b>();
            <b>if</b> (!<span class="i">StringToDateTime</span>(<span class="r135 r">value</span>.<span class="i">ToString</span>(), <b>ref</b> <span class="r138 r">endTime</span>))
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <span class="r138 r">endTime</span> = <span class="r138 r">endTime</span>.<span class="i">ToUniversalTime</span>();
            <b>string</b> <span id="r139 rd" class="r139 r">endTimeFormatted</span> = <span class="r138 r">endTime</span>.<span class="i">ToString</span>(<span class="s">&quot;s&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;.&quot;</span>
                                                       + <span class="r138 r">endTime</span>.<span class="i">Millisecond</span>.<span class="i">ToString</span>(<span class="s">&quot;d3&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;Z&quot;</span>;
 
            <b>if</b> (<span class="r136 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#162f8f99c08fdb70" class="i field">hashkey_starttime_lc</a>))
            {
                <span class="i">DateTime</span> <span id="r140 rd" class="r140 r">startTime</span> = <b>new</b>();
                <b>if</b> (!<span class="i">StringToDateTime</span>(<span class="r136 r">hash</span>[<a href="#162f8f99c08fdb70" class="i field">hashkey_starttime_lc</a>].<span class="i">ToString</span>(), <b>ref</b> <span class="r140 r">startTime</span>))
                {
                    <b>return</b> <b>string</b>.<span class="i">Empty</span>;
                }
 
                <span class="r140 r">startTime</span> = <span class="r140 r">startTime</span>.<span class="i">ToUniversalTime</span>();
                <b>string</b> <span id="r141 rd" class="r141 r">startTimeFormatted</span> = <span class="r140 r">startTime</span>.<span class="i">ToString</span>(<span class="s">&quot;s&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;.&quot;</span>
                                                               + <span class="r140 r">startTime</span>.<span class="i">Millisecond</span>.<span class="i">ToString</span>(<span class="s">&quot;d3&quot;</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) + <span class="s">&quot;Z&quot;</span>;
 
                <span class="r137 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                 <a href="#0df79be703ebb6b6" class="i field">SystemTimePeriodTemplate</a>,
                                 <span class="r141 r">startTimeFormatted</span>,
                                 <span class="r139 r">endTimeFormatted</span>);
            }
            <b>else</b>
            {
                <span class="r137 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                 <a href="#ae5b5e4284f732e0" class="i field">SystemTimeEndTemplate</a>,
                                 <span class="r139 r">endTimeFormatted</span>);
            }
 
            <b>return</b> <span class="r137 r">ret</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// HandleDataHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns EventData/Data XPath portion as a string.</span>
        <span class="c">//</span>
        <b>private static string</b> <a id="53458b9f1cc37836" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleDataHashValue</a>(<b>object</b> <span id="r142 rd" class="r142 r">value</span>)
        {
            <span class="i">StringBuilder</span> <span id="r143 rd" class="r143 r">ret</span> = <b>new</b>();
            <span class="i">Array</span> <span id="r144 rd" class="r144 r">dataArray</span> = <span class="r142 r">value</span> <b>as</b> <span class="i">Array</span>;
            <b>if</b> (<span class="r144 r">dataArray</span> != <b>null</b>)
            {
                <span class="r143 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;(&#39;</span>);
                <b>for</b> (<b>int</b> <span id="r145 rd" class="r145 r">i</span> = 0; <span class="r145 r">i</span> &lt; <span class="r144 r">dataArray</span>.<span class="i">Length</span>; <span class="r145 r">i</span>++)
                {
                    <span class="r143 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#9fc631de1142b7bc" class="i field">DataTemplate</a>, <span class="r144 r">dataArray</span>.<span class="i">GetValue</span>(<span class="r145 r">i</span>).<span class="i">ToString</span>());
                    <b>if</b> (<span class="r145 r">i</span> &lt; (<span class="r144 r">dataArray</span>.<span class="i">Length</span> - 1))
                    {
                        <span class="r143 r">ret</span>.<span class="i">Append</span>(<span class="s">&quot; or &quot;</span>);
                    }
                }
 
                <span class="r143 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
            }
            <b>else</b>
            {
                <span class="r143 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#9fc631de1142b7bc" class="i field">DataTemplate</a>, <span class="r142 r">value</span>);
            }
 
            <b>return</b> <span class="r143 r">ret</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// HandleNamedDataHashValue helper for hashtable structured query builder.</span>
        <span class="c">// Constructs and returns named event data field XPath portion as a string.</span>
        <span class="c">// Fix Issue #2327</span>
        <span class="c">//</span>
        <b>private static string</b> <a id="36defea47fc8b718" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleNamedDataHashValue</a>(<b>string</b> <span id="r146 rd" class="r146 r">key</span>, <b>object</b> <span id="r147 rd" class="r147 r">value</span>)
        {
            <span class="i">StringBuilder</span> <span id="r148 rd" class="r148 r">ret</span> = <b>new</b>();
            <span class="i">Array</span> <span id="r149 rd" class="r149 r">dataArray</span> = <span class="r147 r">value</span> <b>as</b> <span class="i">Array</span>;
            <b>if</b> (<span class="r149 r">dataArray</span> != <b>null</b>)
            {
                <span class="r148 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;(&#39;</span>);
                <b>for</b> (<b>int</b> <span id="r150 rd" class="r150 r">i</span> = 0; <span class="r150 r">i</span> &lt; <span class="r149 r">dataArray</span>.<span class="i">Length</span>; <span class="r150 r">i</span>++)
                {
                    <span class="r148 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                         <a href="#49f2d7e7df733a82" class="i field">NamedDataTemplate</a>,
                                         <span class="r146 r">key</span>, <span class="r149 r">dataArray</span>.<span class="i">GetValue</span>(<span class="r150 r">i</span>).<span class="i">ToString</span>());
                    <b>if</b> (<span class="r150 r">i</span> &lt; (<span class="r149 r">dataArray</span>.<span class="i">Length</span> - 1))
                    {
                        <span class="r148 r">ret</span>.<span class="i">Append</span>(<span class="s">&quot; or &quot;</span>);
                    }
                }
 
                <span class="r148 r">ret</span>.<span class="i">Append</span>(<span class="s">&#39;)&#39;</span>);
            }
            <b>else</b>
            {
                <span class="r148 r">ret</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                         <a href="#49f2d7e7df733a82" class="i field">NamedDataTemplate</a>,
                                         <span class="r146 r">key</span>, <span class="r147 r">value</span>);
            }
 
            <b>return</b> <span class="r148 r">ret</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// Helper checking whether at least one of log, _path, provider is specified.</span>
        <span class="c">// It will ThrowTerminatingError in case none of those keys are present.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="6a488bee86b98e3e" href="R/6a488bee86b98e3e.html" target="n" data-glyph="76,1" class="i method">CheckHashTableForQueryPathPresence</a>(<span class="i">Hashtable</span> <span id="r151 rd" class="r151 r">hash</span>)
        {
            <b>bool</b> <span id="r152 rd" class="r152 r">isLogHash</span> = (<span class="r151 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#ffb34fd74196c5f9" class="i field">hashkey_logname_lc</a>));
            <b>bool</b> <span id="r153 rd" class="r153 r">isPathHash</span> = (<span class="r151 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#181201922f43f2d9" class="i field">hashkey_path_lc</a>));
            <b>bool</b> <span id="r154 rd" class="r154 r">isProviderHash</span> = (<span class="r151 r">hash</span>.<span class="i">ContainsKey</span>(<a href="#431158b05e5eb10d" class="i field">hashkey_providername_lc</a>));
 
            <b>if</b> (!<span class="r152 r">isLogHash</span> &amp;&amp; !<span class="r154 r">isProviderHash</span> &amp;&amp; !<span class="r153 r">isPathHash</span>)
            {
                <b>string</b> <span id="r155 rd" class="r155 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;LogProviderOrPathNeeded&quot;</span>);
                <span class="i">Exception</span> <span id="r156 rd" class="r156 r">exc</span> = <b>new</b>(<span class="r155 r">msg</span>);
                <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r156 r">exc</span>, <span class="s">&quot;LogProviderOrPathNeeded&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>));
            }
        }
 
        <span class="c">//</span>
        <span class="c">// TerminateForNonEvtxFileWithoutOldest terminates for .evt and .etl files unless -Oldest is specified.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="ca40446dd6b2b243" href="R/ca40446dd6b2b243.html" target="n" data-glyph="76,1" class="i method">TerminateForNonEvtxFileWithoutOldest</a>(<b>string</b> <span id="r157 rd" class="r157 r">fileName</span>)
        {
            <b>if</b> (!<a href="#064d995b419f74d3" class="i property">Oldest</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
            {
                <b>if</b> (<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r157 r">fileName</span>).<span class="i">Equals</span>(<span class="s">&quot;.etl&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r157 r">fileName</span>).<span class="i">Equals</span>(<span class="s">&quot;.evt&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>string</b> <span id="r158 rd" class="r158 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;SpecifyOldestForEtlEvt&quot;</span>);
                    <span class="i">Exception</span> <span id="r159 rd" class="r159 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r158 r">msg</span>, <span class="r157 r">fileName</span>));
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r159 r">exc</span>, <span class="s">&quot;SpecifyOldestForEtlEvt&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r157 r">fileName</span>));
                }
            }
        }
 
        <span class="c">//</span>
        <span class="c">// ValidateLogName writes an error if logName is not a valid log.</span>
        <span class="c">// It also terminates for direct ETW channels unless -Oldest is specified.</span>
        <span class="c">//</span>
        <b>private bool</b> <a id="7399d9391474d9aa" href="R/7399d9391474d9aa.html" target="n" data-glyph="76,1" class="i method">ValidateLogName</a>(<b>string</b> <span id="r160 rd" class="r160 r">logName</span>, <span class="i">EventLogSession</span> <span id="r161 rd" class="r161 r">eventLogSession</span>)
        {
            <span class="i">EventLogConfiguration</span> <span id="r162 rd" class="r162 r">logObj</span>;
            <b>try</b>
            {
                <span class="r162 r">logObj</span> = <b>new</b> <span class="i">EventLogConfiguration</span>(<span class="r160 r">logName</span>, <span class="r161 r">eventLogSession</span>);
            }
            <b>catch</b> (<span class="i">EventLogNotFoundException</span>)
            {
                <b>string</b> <span id="r163 rd" class="r163 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoMatchingLogsFound&quot;</span>);
                <span class="i">Exception</span> <span id="r164 rd" class="r164 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r163 r">msg</span>, <a href="#6df85e391a946c71" class="i property">ComputerName</a>, <span class="r160 r">logName</span>));
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r164 r">exc</span>, <span class="s">&quot;NoMatchingLogsFound&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r160 r">logName</span>));
                <b>return</b> <b>false</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r165 rd" class="r165 r">exc</span>)
            {
                <b>string</b> <span id="r166 rd" class="r166 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                         <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;LogInfoUnavailable&quot;</span>),
                                         <span class="r160 r">logName</span>, <span class="r165 r">exc</span>.<span class="i">Message</span>);
                <span class="i">Exception</span> <span id="r167 rd" class="r167 r">outerExc</span> = <b>new</b>(<span class="r166 r">msg</span>, <span class="r165 r">exc</span>);
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r167 r">outerExc</span>, <span class="s">&quot;LogInfoUnavailable&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>));
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (!<a href="#064d995b419f74d3" class="i property">Oldest</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
            {
                <b>if</b> (<span class="r162 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Debug</span> || <span class="r162 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Analytical</span>)
                {
                    <b>string</b> <span id="r168 rd" class="r168 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;SpecifyOldestForLog&quot;</span>);
                    <span class="i">Exception</span> <span id="r169 rd" class="r169 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r168 r">msg</span>, <span class="r160 r">logName</span>));
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r169 r">exc</span>, <span class="s">&quot;SpecifyOldestForLog&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r160 r">logName</span>));
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">//</span>
        <span class="c">// KeywordStringToInt64 helper converts a string to Int64.</span>
        <span class="c">// Returns true and keyLong ref if successful.</span>
        <span class="c">// Writes an error and returns false if keyString cannot be converted.</span>
        <span class="c">//</span>
        <b>private bool</b> <a id="ba9356043d07bd54" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">KeywordStringToInt64</a>(<b>string</b> <span id="r170 rd" class="r170 r">keyString</span>, <b>ref long</b> <span id="r171 rd" class="r171 r">keyLong</span>)
        {
            <b>try</b>
            {
                <span class="r171 r">keyLong</span> = <span class="i">Convert</span>.<span class="i">ToInt64</span>(<span class="r170 r">keyString</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r172 rd" class="r172 r">exc</span>)
            {
                <b>string</b> <span id="r173 rd" class="r173 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;KeywordLongExpected&quot;</span>);
                <span class="i">Exception</span> <span id="r174 rd" class="r174 r">outerExc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r173 r">msg</span>, <span class="r170 r">keyString</span>), <span class="r172 r">exc</span>);
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r174 r">outerExc</span>, <span class="s">&quot;KeywordLongExpected&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">//</span>
        <span class="c">// StringToDateTime helper converts a string to DateTime object.</span>
        <span class="c">// Returns true and DateTime ref if successful.</span>
        <span class="c">// Writes an error and returns false if dtString cannot be converted.</span>
        <span class="c">//</span>
        <b>private bool</b> <a id="75b1d29d821d8bc1" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StringToDateTime</a>(<b>string</b> <span id="r175 rd" class="r175 r">dtString</span>, <b>ref</b> <span class="i">DateTime</span> <span id="r176 rd" class="r176 r">dt</span>)
        {
            <b>try</b>
            {
                <span class="r176 r">dt</span> = <span class="i">DateTime</span>.<span class="i">Parse</span>(<span class="r175 r">dtString</span>, <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
            }
            <b>catch</b> (<span class="i">FormatException</span> <span id="r177 rd" class="r177 r">exc</span>)
            {
                <b>string</b> <span id="r178 rd" class="r178 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;DateTimeExpected&quot;</span>);
                <span class="i">Exception</span> <span id="r179 rd" class="r179 r">outerExc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r178 r">msg</span>, <span class="r175 r">dtString</span>), <span class="r177 r">exc</span>);
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r179 r">outerExc</span>, <span class="s">&quot;DateTimeExpected&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <b>null</b>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">//</span>
        <span class="c">// ValidateAndResolveFilePath helper.</span>
        <span class="c">// Returns a string collection of resolved file paths.</span>
        <span class="c">// Writes non-terminating errors for invalid paths</span>
        <span class="c">// and returns an empty collection.</span>
        <span class="c">//</span>
        <b>private</b> <span class="i">StringCollection</span> <a id="6a4a570d685f9583" href="R/6a4a570d685f9583.html" target="n" data-glyph="76,1" class="i method">ValidateAndResolveFilePath</a>(<b>string</b> <span id="r180 rd" class="r180 r">path</span>)
        {
            <span class="i">StringCollection</span> <span id="r181 rd" class="r181 r">retColl</span> = <b>new</b>();
 
            <span class="i">Collection</span>&lt;<a href="/System.Management.Automation/A.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <span id="r182 rd" class="r182 r">resolvedPathSubset</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r182 r">resolvedPathSubset</span> = <a href="/System.Management.Automation/A.html#5078d443148de142" class="i property">SessionState</a>.<a href="/System.Management.Automation/A.html#3390cfbbdcffb036" class="i property">Path</a>.<span class="i">GetResolvedPSPathFromPSPath</span>(<span class="r180 r">path</span>);
            }
            <b>catch</b> (<a href="/System.Management.Automation/A.html#55e79fbd51d0f1cb" class="t t">PSNotSupportedException</a> <span id="r183 rd" class="r183 r">notSupported</span>)
            {
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r183 r">notSupported</span>, <b>string</b>.<span class="i">Empty</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r180 r">path</span>));
                <b>return</b> <span class="r181 r">retColl</span>;
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="/System.Management.Automation/A.html#09140e6dc875019b" class="t t">DriveNotFoundException</a> <span id="r184 rd" class="r184 r">driveNotFound</span>)
            {
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r184 r">driveNotFound</span>, <b>string</b>.<span class="i">Empty</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r180 r">path</span>));
                <b>return</b> <span class="r181 r">retColl</span>;
            }
            <b>catch</b> (<a href="/System.Management.Automation/A.html#a58038dc730da896" class="t t">ProviderNotFoundException</a> <span id="r185 rd" class="r185 r">providerNotFound</span>)
            {
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r185 r">providerNotFound</span>, <b>string</b>.<span class="i">Empty</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r180 r">path</span>));
                <b>return</b> <span class="r181 r">retColl</span>;
            }
            <b>catch</b> (<a href="/System.Management.Automation/A.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a> <span id="r186 rd" class="r186 r">pathNotFound</span>)
            {
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r186 r">pathNotFound</span>, <b>string</b>.<span class="i">Empty</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r180 r">path</span>));
                <b>return</b> <span class="r181 r">retColl</span>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r187 rd" class="r187 r">exc</span>)
            {
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r187 r">exc</span>, <b>string</b>.<span class="i">Empty</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r180 r">path</span>));
                <b>return</b> <span class="r181 r">retColl</span>;
            }
 
            <b>foreach</b> (<a href="/System.Management.Automation/A.html#9504cfb54420cfd7" class="t t">PathInfo</a> <span id="r188 rd" class="r188 r">pi</span> <b>in</b> <span class="r182 r">resolvedPathSubset</span>)
            {
                <span class="c">//</span>
                <span class="c">// Check the provider: only FileSystem provider paths are acceptable.</span>
                <span class="c">//</span>
                <b>if</b> (<span class="r188 r">pi</span>.<a href="/System.Management.Automation/A.html#223c6ebf64760c0d" class="i property">Provider</a>.<a href="/System.Management.Automation/A.html#2837d805ea30ef5c" class="i property">Name</a> != <span class="s">&quot;FileSystem&quot;</span>)
                {
                    <b>string</b> <span id="r189 rd" class="r189 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NotAFileSystemPath&quot;</span>);
                    <span class="i">Exception</span> <span id="r190 rd" class="r190 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r189 r">msg</span>, <span class="r180 r">path</span>));
                    <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r190 r">exc</span>, <span class="s">&quot;NotAFileSystemPath&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r180 r">path</span>));
                    <b>continue</b>;
                }
 
                <span class="c">//</span>
                <span class="c">// Check the extension: only .evt, .evtx, and .etl files are allowed.</span>
                <span class="c">// If the file was specified without wildcards, display an error.</span>
                <span class="c">// Otherwise, skip silently.</span>
                <span class="c">//</span>
                <b>if</b> (!<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r188 r">pi</span>.<a href="/System.Management.Automation/A.html#de00cd47bf0cf721" class="i property">Path</a>).<span class="i">Equals</span>(<span class="s">&quot;.evt&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                    !<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r188 r">pi</span>.<a href="/System.Management.Automation/A.html#de00cd47bf0cf721" class="i property">Path</a>).<span class="i">Equals</span>(<span class="s">&quot;.evtx&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                    !<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r188 r">pi</span>.<a href="/System.Management.Automation/A.html#de00cd47bf0cf721" class="i property">Path</a>).<span class="i">Equals</span>(<span class="s">&quot;.etl&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>if</b> (!<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r180 r">path</span>))
                    {
                        <b>string</b> <span id="r191 rd" class="r191 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NotALogFile&quot;</span>);
                        <span class="i">Exception</span> <span id="r192 rd" class="r192 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r191 r">msg</span>, <span class="r188 r">pi</span>.<a href="/System.Management.Automation/A.html#16e3fcd7f95c1bfc" class="i property">ProviderPath</a>));
                        <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r192 r">exc</span>, <span class="s">&quot;NotALogFile&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r180 r">path</span>));
                    }
 
                    <b>continue</b>;
                }
 
                <a href="#ca40446dd6b2b243" class="i method">TerminateForNonEvtxFileWithoutOldest</a>(<span class="r188 r">pi</span>.<a href="/System.Management.Automation/A.html#16e3fcd7f95c1bfc" class="i property">ProviderPath</a>);
 
                <span class="r181 r">retColl</span>.<span class="i">Add</span>(<span class="r188 r">pi</span>.<a href="/System.Management.Automation/A.html#16e3fcd7f95c1bfc" class="i property">ProviderPath</a>.<span class="i">ToLowerInvariant</span>());
            }
 
            <b>return</b> <span class="r181 r">retColl</span>;
        }
 
        <span class="c">//</span>
        <span class="c">// CheckHashTablesForNullValues() checks all _selector values</span>
        <span class="c">// and writes a terminating error when it encounters a null</span>
        <span class="c">// as a single value or as part of an array.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="3d0cbba1d5412863" href="R/3d0cbba1d5412863.html" target="n" data-glyph="76,1" class="i method">CheckHashTablesForNullValues</a>()
        {
            <b>foreach</b> (<span class="i">Hashtable</span> <span id="r193 rd" class="r193 r">hash</span> <b>in</b> <a href="#ee8d9156a8e0178d" class="i property">FilterHashtable</a>)
            {
                <b>foreach</b> (<b>string</b> <span id="r194 rd" class="r194 r">key</span> <b>in</b> <span class="r193 r">hash</span>.<span class="i">Keys</span>)
                {
                    <b>object</b> <span id="r195 rd" class="r195 r">value</span> = <span class="r193 r">hash</span>[<span class="r194 r">key</span>];
                    <b>if</b> (<span class="r195 r">value</span> == <b>null</b>)
                    {
                        <b>string</b> <span id="r196 rd" class="r196 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NullNotAllowedInHashtable&quot;</span>);
                        <span class="i">Exception</span> <span id="r197 rd" class="r197 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r196 r">msg</span>, <span class="r194 r">key</span>));
                        <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r197 r">exc</span>, <span class="s">&quot;NullNotAllowedInHashtable&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r194 r">key</span>));
                    }
                    <b>else</b>
                    {
                        <span class="i">Array</span> <span id="r198 rd" class="r198 r">eltArray</span> = <span class="r195 r">value</span> <b>as</b> <span class="i">Array</span>;
                        <b>if</b> (<span class="r198 r">eltArray</span> != <b>null</b>)
                        {
                            <b>foreach</b> (<b>object</b> <span id="r199 rd" class="r199 r">elt</span> <b>in</b> <span class="r198 r">eltArray</span>)
                            {
                                <b>if</b> (<span class="r199 r">elt</span> == <b>null</b>)
                                {
                                    <b>string</b> <span id="r200 rd" class="r200 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NullNotAllowedInHashtable&quot;</span>);
                                    <span class="i">Exception</span> <span id="r201 rd" class="r201 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r200 r">msg</span>, <span class="r194 r">key</span>));
                                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r201 r">exc</span>, <span class="s">&quot;NullNotAllowedInHashtable&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r194 r">key</span>));
                                }
                            }
                        }
                    }
                }
            }
        }
 
        <span class="c">//</span>
        <span class="c">// AddProviderPredicatesToFilter() builds an XPath query</span>
        <span class="c">// by adding provider predicates to _filter.</span>
        <span class="c">// Note that this is by no means an XPath expression parser</span>
        <span class="c">// and will may produce garbage if the _filterXPath expression provided by the user is invalid.</span>
        <span class="c">// However, we are relying on the EventLog XPath parser to reject the garbage later on.</span>
        <span class="c">//</span>
        <b>private string</b> <a id="8d5f810e06ada490" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AddProviderPredicatesToFilter</a>(<span class="i">StringCollection</span> <span id="r202 rd" class="r202 r">providers</span>)
        {
            <b>if</b> (<span class="r202 r">providers</span>.<span class="i">Count</span> == 0)
            {
                <b>return</b> <a href="#9011783579f2dda5" class="i property">FilterXPath</a>;
            }
 
            <b>string</b> <span id="r203 rd" class="r203 r">ret</span> = <a href="#9011783579f2dda5" class="i property">FilterXPath</a>;
            <b>string</b> <span id="r204 rd" class="r204 r">predicate</span> = <a href="#0e005f9f3dd41b15" class="i method">BuildProvidersPredicate</a>(<span class="r202 r">providers</span>);
 
            <b>if</b> (<a href="#9011783579f2dda5" class="i property">FilterXPath</a>.<span class="i">Equals</span>(<span class="s">&quot;*&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r203 r">ret</span> += <span class="s">&quot;[&quot;</span> + <span class="r204 r">predicate</span> + <span class="s">&quot;]&quot;</span>;
            }
            <b>else</b>
            {
                <span class="c">//</span>
                <span class="c">// Extend the XPath provided in the _filter</span>
                <span class="c">//</span>
                <b>int</b> <span id="r205 rd" class="r205 r">lastPredClose</span> = <a href="#9011783579f2dda5" class="i property">FilterXPath</a>.<span class="i">LastIndexOf</span>(<span class="s">&#39;]&#39;</span>);
                <b>if</b> (<span class="r205 r">lastPredClose</span> == -1)
                {
                    <span class="r203 r">ret</span> += <span class="s">&quot;[&quot;</span> + <span class="r204 r">predicate</span> + <span class="s">&quot;]&quot;</span>;
                }
                <b>else</b>
                {
                    <span class="r203 r">ret</span> = <span class="r203 r">ret</span>.<span class="i">Insert</span>(<span class="r205 r">lastPredClose</span>, <span class="s">&quot; and &quot;</span> + <span class="r204 r">predicate</span>);
                }
            }
 
            <b>return</b> <span class="r203 r">ret</span>;
        }
 
        <span class="c">//</span>
        <span class="c">// BuildProvidersPredicate() builds a predicate expression like:</span>
        <span class="c">// &quot;System/Provider[@Name=&#39;a&#39; or @Name=&#39;b&#39;]&quot;</span>
        <span class="c">// for all provider names specified in the &quot;providers&quot; argument.</span>
        <span class="c">//</span>
        <b>private static string</b> <a id="0e005f9f3dd41b15" href="R/0e005f9f3dd41b15.html" target="n" data-glyph="76,1" class="i method">BuildProvidersPredicate</a>(<span class="i">StringCollection</span> <span id="r206 rd" class="r206 r">providers</span>)
        {
            <b>if</b> (<span class="r206 r">providers</span>.<span class="i">Count</span> == 0)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <span class="i">StringBuilder</span> <span id="r207 rd" class="r207 r">predicate</span> = <b>new</b>(<span class="s">&quot;System/Provider[&quot;</span>);
            <b>for</b> (<b>int</b> <span id="r208 rd" class="r208 r">i</span> = 0; <span class="r208 r">i</span> &lt; <span class="r206 r">providers</span>.<span class="i">Count</span>; <span class="r208 r">i</span>++)
            {
                <span class="r207 r">predicate</span>.<span class="i">Append</span>(<span class="s">&quot;@Name=&#39;&quot;</span>).<span class="i">Append</span>(<span class="r206 r">providers</span>[<span class="r208 r">i</span>]).<span class="i">Append</span>(<span class="s">&#39;\&#39;&#39;</span>);
                <b>if</b> (<span class="r208 r">i</span> &lt; (<span class="r206 r">providers</span>.<span class="i">Count</span> - 1))
                {
                    <span class="r207 r">predicate</span>.<span class="i">Append</span>(<span class="s">&quot; or &quot;</span>);
                }
            }
 
            <span class="r207 r">predicate</span>.<span class="i">Append</span>(<span class="s">&#39;]&#39;</span>);
 
            <b>return</b> <span class="r207 r">predicate</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// BuildAllProvidersPredicate() builds a predicate expression like:</span>
        <span class="c">// &quot;System/Provider[@Name=&#39;a&#39; or @Name=&#39;b&#39;]&quot;</span>
        <span class="c">// for all unique provider names specified in _providersByLogMap.</span>
        <span class="c">// Eliminates duplicates, too, since the same provider can</span>
        <span class="c">// be writing to several different logs.</span>
        <span class="c">//</span>
        <b>private string</b> <a id="52c31b35be6cb3b2" href="R/52c31b35be6cb3b2.html" target="n" data-glyph="76,1" class="i method">BuildAllProvidersPredicate</a>()
        {
            <b>if</b> (<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Count</span> == 0)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <span class="i">StringBuilder</span> <span id="r209 rd" class="r209 r">predicate</span> = <b>new</b>(<span class="s">&quot;System/Provider[&quot;</span>);
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r210 rd" class="r210 r">uniqueProviderNames</span> = <b>new</b>();
 
            <b>foreach</b> (<b>string</b> <span id="r211 rd" class="r211 r">logKey</span> <b>in</b> <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Keys</span>)
            {
                <b>for</b> (<b>int</b> <span id="r212 rd" class="r212 r">i</span> = 0; <span class="r212 r">i</span> &lt; <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>[<span class="r211 r">logKey</span>].<span class="i">Count</span>; <span class="r212 r">i</span>++)
                {
                    <b>string</b> <span id="r213 rd" class="r213 r">lowerCaseProviderName</span> = <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>[<span class="r211 r">logKey</span>][<span class="r212 r">i</span>].<span class="i">ToLowerInvariant</span>();
                    <b>if</b> (!<span class="r210 r">uniqueProviderNames</span>.<span class="i">Contains</span>(<span class="r213 r">lowerCaseProviderName</span>))
                    {
                        <span class="r210 r">uniqueProviderNames</span>.<span class="i">Add</span>(<span class="r213 r">lowerCaseProviderName</span>);
                    }
                }
            }
 
            <b>for</b> (<b>int</b> <span id="r214 rd" class="r214 r">i</span> = 0; <span class="r214 r">i</span> &lt; <span class="r210 r">uniqueProviderNames</span>.<span class="i">Count</span>; <span class="r214 r">i</span>++)
            {
                <span class="r209 r">predicate</span>.<span class="i">Append</span>(<span class="s">&quot;@Name=&#39;&quot;</span>).<span class="i">Append</span>(<span class="r210 r">uniqueProviderNames</span>[<span class="r214 r">i</span>]).<span class="i">Append</span>(<span class="s">&#39;\&#39;&#39;</span>);
                <b>if</b> (<span class="r214 r">i</span> &lt; <span class="r210 r">uniqueProviderNames</span>.<span class="i">Count</span> - 1)
                {
                    <span class="r209 r">predicate</span>.<span class="i">Append</span>(<span class="s">&quot; or &quot;</span>);
                }
            }
 
            <span class="r209 r">predicate</span>.<span class="i">Append</span>(<span class="s">&#39;]&#39;</span>);
 
            <b>return</b> <span class="r209 r">predicate</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">//</span>
        <span class="c">// AddLogsForProviderToInternalMap helper.</span>
        <span class="c">// Retrieves log names to which _providerName writes.</span>
        <span class="c">// NOTE: there are many misconfigured providers in the system.</span>
        <span class="c">// We therefore catch EventLogException exceptions and write them out as non-terminating errors.</span>
        <span class="c">// The results are added to _providersByLogMap dictionary.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="9e56aa860f54d1b6" href="R/9e56aa860f54d1b6.html" target="n" data-glyph="76,1" class="i method">AddLogsForProviderToInternalMap</a>(<span class="i">EventLogSession</span> <span id="r215 rd" class="r215 r">eventLogSession</span>, <b>string</b> <span id="r216 rd" class="r216 r">providerName</span>)
        {
            <b>try</b>
            {
                <span class="i">ProviderMetadata</span> <span id="r217 rd" class="r217 r">providerMetadata</span> = <b>new</b>(<span class="r216 r">providerName</span>, <span class="r215 r">eventLogSession</span>, <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
 
                <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">IEnumerable</span> <span id="r218 rd" class="r218 r">logLinks</span> = <span class="r217 r">providerMetadata</span>.<span class="i">LogLinks</span>;
 
                <b>foreach</b> (<span class="i">EventLogLink</span> <span id="r219 rd" class="r219 r">logLink</span> <b>in</b> <span class="r218 r">logLinks</span>)
                {
                    <b>if</b> (!<a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">ContainsKey</span>(<span class="r219 r">logLink</span>.<span class="i">LogName</span>.<span class="i">ToLowerInvariant</span>()))
                    {
                        <span class="c">//</span>
                        <span class="c">// Skip direct ETW channels unless -force is present.</span>
                        <span class="c">// Error out for direct channels unless -oldest is present.</span>
                        <span class="c">//</span>
                        <span class="i">EventLogConfiguration</span> <span id="r220 rd" class="r220 r">logObj</span> = <b>new</b>(<span class="r219 r">logLink</span>.<span class="i">LogName</span>, <span class="r215 r">eventLogSession</span>);
                        <b>if</b> (<span class="r220 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Debug</span> || <span class="r220 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Analytical</span>)
                        {
                            <b>if</b> (!<a href="#ac195df89d16e184" class="i property">Force</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
                            {
                                <b>continue</b>;
                            }
 
                            <span class="i">ValidateLogName</span>(<span class="r219 r">logLink</span>.<span class="i">LogName</span>, <span class="r215 r">eventLogSession</span>);
                        }
 
                        <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;ProviderLogLink&quot;</span>), <span class="r216 r">providerName</span>, <span class="r219 r">logLink</span>.<span class="i">LogName</span>));
 
                        <span class="i">StringCollection</span> <span id="r221 rd" class="r221 r">provColl</span> = <b>new</b>();
                        <span class="r221 r">provColl</span>.<span class="i">Add</span>(<span class="r216 r">providerName</span>.<span class="i">ToLowerInvariant</span>());
 
                        <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Add</span>(<span class="r219 r">logLink</span>.<span class="i">LogName</span>.<span class="i">ToLowerInvariant</span>(), <span class="r221 r">provColl</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">//</span>
                        <span class="c">// Log is there: add provider, if needed</span>
                        <span class="c">//</span>
                        <span class="i">StringCollection</span> <span id="r222 rd" class="r222 r">coll</span> = <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>[<span class="r219 r">logLink</span>.<span class="i">LogName</span>.<span class="i">ToLowerInvariant</span>()];
 
                        <b>if</b> (!<span class="r222 r">coll</span>.<span class="i">Contains</span>(<span class="r216 r">providerName</span>.<span class="i">ToLowerInvariant</span>()))
                        {
                            <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;ProviderLogLink&quot;</span>), <span class="r216 r">providerName</span>, <span class="r219 r">logLink</span>.<span class="i">LogName</span>));
 
                            <span class="r222 r">coll</span>.<span class="i">Add</span>(<span class="r216 r">providerName</span>.<span class="i">ToLowerInvariant</span>());
                        }
                    }
                }
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">Eventing</span>.<span class="i">Reader</span>.<span class="i">EventLogException</span> <span id="r223 rd" class="r223 r">exc</span>)
            {
                <b>string</b> <span id="r224 rd" class="r224 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                           <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;ProviderMetadataUnavailable&quot;</span>),
                                           <span class="r216 r">providerName</span>, <span class="r223 r">exc</span>.<span class="i">Message</span>);
                <span class="i">Exception</span> <span id="r225 rd" class="r225 r">outerExc</span> = <b>new</b>(<span class="r224 r">msg</span>, <span class="r223 r">exc</span>);
                <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r225 r">outerExc</span>, <span class="s">&quot;ProviderMetadataUnavailable&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>));
                <b>return</b>;
            }
        }
 
        <span class="c">//</span>
        <span class="c">// FindLogNamesMatchingWildcards helper.</span>
        <span class="c">// Finds all logs whose names match wildcard patterns in the &#39;logPatterns&#39; argument.</span>
        <span class="c">// For each non-matched pattern, a non-terminating error is written.</span>
        <span class="c">// The results are added to _logNamesMatchingWildcard array.</span>
        <span class="c">//</span>
        <b>private void</b> <a id="08410df22c70ce04" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FindLogNamesMatchingWildcards</a>(<span class="i">EventLogSession</span> <span id="r226 rd" class="r226 r">eventLogSession</span>, <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r227 rd" class="r227 r">logPatterns</span>)
        {
            <b>if</b> (<a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a> == <b>null</b>)
            {
                <a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a> = <b>new</b> <span class="i">StringCollection</span>();
            }
            <b>else</b>
            {
                <a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>.<span class="i">Clear</span>();
            }
 
            <b>foreach</b> (<b>string</b> <span id="r228 rd" class="r228 r">logPattern</span> <b>in</b> <span class="r227 r">logPatterns</span>)
            {
                <b>bool</b> <span id="r229 rd" class="r229 r">bMatched</span> = <b>false</b>;
                <a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r230 rd" class="r230 r">wildLogPattern</span> = <b>new</b>(<span class="r228 r">logPattern</span>, <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <b>foreach</b> (<b>string</b> <span id="r231 rd" class="r231 r">actualLogName</span> <b>in</b> <span class="r226 r">eventLogSession</span>.<span class="i">GetLogNames</span>())
                {
                    <b>if</b> (((!<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r228 r">logPattern</span>))
                        &amp;&amp; (<span class="r228 r">logPattern</span>.<span class="i">Equals</span>(<span class="r231 r">actualLogName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                        ||
                        (<span class="r230 r">wildLogPattern</span>.<span class="i">IsMatch</span>(<span class="r231 r">actualLogName</span>)))
                    {
                        <span class="c">//</span>
                        <span class="c">// Skip direct ETW channels matching wildcards unless -force is present.</span>
                        <span class="c">// Error out for direct channels unless -oldest is present.</span>
                        <span class="c">//</span>
                        <span class="i">EventLogConfiguration</span> <span id="r232 rd" class="r232 r">logObj</span>;
                        <b>try</b>
                        {
                            <span class="r232 r">logObj</span> = <b>new</b> <span class="i">EventLogConfiguration</span>(<span class="r231 r">actualLogName</span>, <span class="r226 r">eventLogSession</span>);
                        }
                        <b>catch</b> (<span class="i">Exception</span> <span id="r233 rd" class="r233 r">exc</span>)
                        {
                            <b>string</b> <span id="r234 rd" class="r234 r">msg</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                                     <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;LogInfoUnavailable&quot;</span>),
                                                     <span class="r231 r">actualLogName</span>, <span class="r233 r">exc</span>.<span class="i">Message</span>);
                            <span class="i">Exception</span> <span id="r235 rd" class="r235 r">outerExc</span> = <b>new</b>(<span class="r234 r">msg</span>, <span class="r233 r">exc</span>);
                            <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r235 r">outerExc</span>, <span class="s">&quot;LogInfoUnavailable&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>));
                            <b>continue</b>;
                        }
 
                        <b>if</b> (<span class="r232 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Debug</span> || <span class="r232 r">logObj</span>.<span class="i">LogType</span> == <span class="i">EventLogType</span>.<span class="i">Analytical</span>)
                        {
                            <b>if</b> (<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r228 r">logPattern</span>) &amp;&amp; !<a href="#ac195df89d16e184" class="i property">Force</a>.<a href="/System.Management.Automation/A.html#e9c777a85700d3da" class="i property">IsPresent</a>)
                            {
                                <b>continue</b>;
                            }
 
                            <a href="#7399d9391474d9aa" class="i method">ValidateLogName</a>(<span class="r231 r">actualLogName</span>, <span class="r226 r">eventLogSession</span>);
                        }
 
                        <b>if</b> (!<a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>.<span class="i">Contains</span>(<span class="r231 r">actualLogName</span>.<span class="i">ToLowerInvariant</span>()))
                        {
                            <a href="#28a44c9685b8fce9" class="i field">_logNamesMatchingWildcard</a>.<span class="i">Add</span>(<span class="r231 r">actualLogName</span>.<span class="i">ToLowerInvariant</span>());
                        }
 
                        <span class="r229 r">bMatched</span> = <b>true</b>;
                    }
                }
 
                <b>if</b> (!<span class="r229 r">bMatched</span>)
                {
                    <b>string</b> <span id="r236 rd" class="r236 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoMatchingLogsFound&quot;</span>);
                    <span class="i">Exception</span> <span id="r237 rd" class="r237 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r236 r">msg</span>, <a href="#6df85e391a946c71" class="i property">ComputerName</a>, <span class="r228 r">logPattern</span>));
                    <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r237 r">exc</span>, <span class="s">&quot;NoMatchingLogsFound&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r228 r">logPattern</span>));
                }
            }
        }
 
        <span class="c">//</span>
        <span class="c">// FindProvidersByLogForWildcardPatterns helper.</span>
        <span class="c">// Finds all providers whose names match wildcard patterns in &#39;providerPatterns&#39; argument.</span>
        <span class="c">// For each non-matched pattern, a non-terminating error is written.</span>
        <span class="c">// The results are added to _providersByLogMap dictionary (keyed by log names to which these providers write).</span>
        <span class="c">//</span>
        <b>private void</b> <a id="6b449624b39a7681" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FindProvidersByLogForWildcardPatterns</a>(<span class="i">EventLogSession</span> <span id="r238 rd" class="r238 r">eventLogSession</span>, <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r239 rd" class="r239 r">providerPatterns</span>)
        {
            <a href="#25da2b32974228eb" class="i field">_providersByLogMap</a>.<span class="i">Clear</span>();
 
            <b>foreach</b> (<b>string</b> <span id="r240 rd" class="r240 r">provPattern</span> <b>in</b> <span class="r239 r">providerPatterns</span>)
            {
                <b>bool</b> <span id="r241 rd" class="r241 r">bMatched</span> = <b>false</b>;
                <a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r242 rd" class="r242 r">wildProvPattern</span> = <b>new</b>(<span class="r240 r">provPattern</span>, <a href="/System.Management.Automation/A.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="/System.Management.Automation/A.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
 
                <b>foreach</b> (<b>string</b> <span id="r243 rd" class="r243 r">provName</span> <b>in</b> <span class="r238 r">eventLogSession</span>.<span class="i">GetProviderNames</span>())
                {
                    <b>if</b> (((!<a href="/System.Management.Automation/A.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r240 r">provPattern</span>))
                      &amp;&amp; (<span class="r240 r">provPattern</span>.<span class="i">Equals</span>(<span class="r243 r">provName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                      ||
                      (<span class="r242 r">wildProvPattern</span>.<span class="i">IsMatch</span>(<span class="r243 r">provName</span>)))
                    {
                        <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;Found matching provider: {0}&quot;</span>, <span class="r243 r">provName</span>));
                        <a href="#9e56aa860f54d1b6" class="i method">AddLogsForProviderToInternalMap</a>(<span class="r238 r">eventLogSession</span>, <span class="r243 r">provName</span>);
                        <span class="r241 r">bMatched</span> = <b>true</b>;
                    }
                }
 
                <b>if</b> (!<span class="r241 r">bMatched</span>)
                {
                    <b>string</b> <span id="r244 rd" class="r244 r">msg</span> = <a href="#d0628791e81b0e0d" class="i field">_resourceMgr</a>.<span class="i">GetString</span>(<span class="s">&quot;NoMatchingProvidersFound&quot;</span>);
                    <span class="i">Exception</span> <span id="r245 rd" class="r245 r">exc</span> = <b>new</b>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="r244 r">msg</span>, <a href="#6df85e391a946c71" class="i property">ComputerName</a>, <span class="r240 r">provPattern</span>));
                    <span class="i">WriteError</span>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r245 r">exc</span>, <span class="s">&quot;NoMatchingProvidersFound&quot;</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r240 r">provPattern</span>));
                }
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
