<!DOCTYPE html>
<html><head><title>SessionBasedWrapper.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(702);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/cimSupport/cmdletization/SessionBasedWrapper.cs" target="_top">cimSupport\cmdletization\SessionBasedWrapper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Cmdletization</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provides common code for processing session-based object models.  The common code</span>
    <span class="c">///</span><span class="c"> Session, ThrottleLimit, AsJob parameters and delegates creation of jobs to derived classes.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r t">TObjectInstance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type that represents instances of objects from the wrapped object model</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r t">TSession</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type representing remote sessions</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1005:AvoidExcessiveParametersOnGenericTypes&quot;</span>)]
    <b>public abstract class</b> <a id="931739e72bdca1ce" href="../../R/931739e72bdca1ce.html" target="n" data-glyph="0,0" class="t t">SessionBasedCmdletAdapter</a>&lt;<span id="r0 rd t" class="r0 r t">TObjectInstance</span>, <span id="r1 rd t" class="r1 r t">TSession</span>&gt; : <span class="i">CmdletAdapter</span>&lt;<span class="r0 r t">TObjectInstance</span>&gt;, <span class="i">IDisposable</span>
        <b>where</b> <span class="r0 r t">TObjectInstance</span> : <b>class
        where</b> <span class="r1 r t">TSession</span> : <b>class</b>
    {
        <b>internal</b> <a id="5855022b561d70ea" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">SessionBasedCmdletAdapter</a>()
        {
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constants
 
        <b>private const string</b> <a id="d7d55de981c34969" href="../../R/d7d55de981c34969.html" target="n" data-glyph="10,1" class="i field">CIMJobType</a> = <span class="s">&quot;CimJob&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable Members
 
        <b>private bool</b> <a id="e53e9540824dd777" href="../../R/e53e9540824dd777.html" target="n" data-glyph="46,1" class="i field">_disposed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Releases resources associated with this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="8dca999a6a1efbdc" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#5d054a786c99740c" class="i method">Dispose</a>(<b>true</b>);
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#931739e72bdca1ce" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Releases resources associated with this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="5d054a786c99740c" href="../../R/5d054a786c99740c.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r2 rd" class="r2 r">disposing</span>)
        {
            <b>if</b> (!<a href="#e53e9540824dd777" class="i field">_disposed</a>)
            {
                <b>if</b> (<span class="r2 r">disposing</span>)
                {
                    <b>if</b> (<a href="#e79a40b7348ffe20" class="i field">_parentJob</a> != <b>null</b>)
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">Dispose</span>();
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a> = <b>null</b>;
                    }
                }
 
                <a href="#e53e9540824dd777" class="i field">_disposed</a> = <b>true</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Common parameters (AsJob, ThrottleLimit, Session)
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Session to operate on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>protected</b> <span class="r1 r t">TSession</span>[] <a id="e15532283f92444f" href="../../R/e15532283f92444f.html" target="n" data-glyph="105,1" class="i property">Session</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ceb85ab618bf1ad8" class="i field">_session</a> ??= <b>new</b> <span class="r1 r t">TSession</span>[] { <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#79104cde67188cb3" class="i property">DefaultSession</a> };
            }
 
            <b>set</b>
            {
                <a href="#ceb85ab618bf1ad8" class="i field">_session</a> = <b>value</b> ?? <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<b>value</b>));
                <a href="#162565cb2dad08c7" class="i field">_sessionWasSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <span class="r1 r t">TSession</span>[] <a id="ceb85ab618bf1ad8" href="../../R/ceb85ab618bf1ad8.html" target="n" data-glyph="46,1" class="i field">_session</a>;
        <b>private bool</b> <a id="162565cb2dad08c7" href="../../R/162565cb2dad08c7.html" target="n" data-glyph="46,1" class="i field">_sessionWasSpecified</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Whether to wrap and emit the whole operation as a background job.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="a35ad7153de9990b" href="../../R/a35ad7153de9990b.html" target="n" data-glyph="102,1" class="i property">AsJob</a>
        {
            <b>get</b> { <b>return</b> <a href="#cfe9c6d4df08badf" class="i field">_asJob</a>; }
 
            <b>set</b> { <a href="#cfe9c6d4df08badf" class="i field">_asJob</a> = <b>value</b>; }
        }
 
        <b>private bool</b> <a id="cfe9c6d4df08badf" href="../../R/cfe9c6d4df08badf.html" target="n" data-glyph="46,1" class="i field">_asJob</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Maximum number of remote connections that can remain active at any given time.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public virtual int</b> <a id="c2452c411dd5ed22" href="../../R/c2452c411dd5ed22.html" target="n" data-glyph="102,1" class="i property">ThrottleLimit</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Common CIM-related parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Abstract methods to be overridden in derived classes
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Job</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object that performs a query against the wrapped object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote session to query.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">query</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Query parameters.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method shouldn&#39;t do any processing or interact with the remote session.</span>
        <span class="c">///</span><span class="c"> Doing so will interfere with ThrottleLimit functionality.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Job</span>.<span class="i">WriteObject</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> (and other methods returning job results) will block to support throttling and flow-control.</span>
        <span class="c">///</span><span class="c"> Implementations of Job instance returned from this method should make sure that implementation-specific flow-control mechanism pauses further processing,</span>
        <span class="c">///</span><span class="c"> until calls from </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Job</span>.<span class="i">WriteObject</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> (and other methods returning job results) return.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal abstract</b> <span class="i">StartableJob</span> <a id="0c2e8794e45c5314" href="../../R/0c2e8794e45c5314.html" target="n" data-glyph="74,1" class="i method">CreateQueryJob</a>(<span class="r1 r t">TSession</span> <span id="r3 rd" class="r3 r">session</span>, <span class="i">QueryBuilder</span> <span id="r4 rd" class="r4 r">query</span>);
 
        <b>private</b> <span class="i">StartableJob</span> <a id="89d7335c82773176" href="../../R/89d7335c82773176.html" target="n" data-glyph="76,1" class="i method">DoCreateQueryJob</a>(<span class="r1 r t">TSession</span> <span id="r5 rd" class="r5 r">sessionForJob</span>, <span class="i">QueryBuilder</span> <span id="r6 rd" class="r6 r">query</span>, <span class="i">Action</span>&lt;<span class="r1 r t">TSession</span>, <span class="r0 r t">TObjectInstance</span>&gt; <span id="r7 rd" class="r7 r">actionAgainstResults</span>)
        {
            <span class="i">StartableJob</span> <span id="r8 rd" class="r8 r">queryJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#0c2e8794e45c5314" class="i method">CreateQueryJob</a>(<span class="r5 r">sessionForJob</span>, <span class="r6 r">query</span>);
 
            <b>if</b> (<span class="r8 r">queryJob</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r7 r">actionAgainstResults</span> != <b>null</b>)
                {
                    <span class="r8 r">queryJob</span>.<span class="i">SuppressOutputForwarding</span> = <b>true</b>;
                }
 
                <b>bool</b> <span id="r9 rd" class="r9 r">discardNonPipelineResults</span> = (<span class="r7 r">actionAgainstResults</span> != <b>null</b>) || !<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>;
                <span class="i">HandleJobOutput</span>(
                    <span class="r8 r">queryJob</span>,
                    <span class="r5 r">sessionForJob</span>,
                    <span class="r9 r">discardNonPipelineResults</span>,
                    <span class="r7 r">actionAgainstResults</span> == <b>null</b>
                        ? (<span class="i">Action</span>&lt;<span class="i">PSObject</span>&gt;)<b>null</b>
                        : ((<span class="i">PSObject</span> <span id="r10 rd" class="r10 r">pso</span>) =&gt;
                        {
                            <span class="r0 r t">var</span> <span id="r11 rd" class="r11 r">objectInstance</span> =
                                (<span class="r0 r t">TObjectInstance</span>)<span class="i">LanguagePrimitives</span>.<span class="i">ConvertTo</span>(
                                    <span class="r10 r">pso</span>,
                                    <b>typeof</b>(<span class="r0 r t">TObjectInstance</span>),
                                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                            <span class="r7 r">actionAgainstResults</span>(<span class="r5 r">sessionForJob</span>, <span class="r11 r">objectInstance</span>);
                        }));
            }
 
            <b>return</b> <span class="r8 r">queryJob</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Job</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object that invokes an instance method in the wrapped object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote session to invoke the method in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">objectInstance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object on which to invoke the method.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">methodInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Method invocation details.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">passThru</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if successful method invocations should emit downstream the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">objectInstance</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> being operated on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method shouldn&#39;t do any processing or interact with the remote session.</span>
        <span class="c">///</span><span class="c"> Doing so will interfere with ThrottleLimit functionality.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Job</span>.<span class="i">WriteObject</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> (and other methods returning job results) will block to support throttling and flow-control.</span>
        <span class="c">///</span><span class="c"> Implementations of Job instance returned from this method should make sure that implementation-specific flow-control mechanism pauses further processing,</span>
        <span class="c">///</span><span class="c"> until calls from </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Job</span>.<span class="i">WriteObject</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> (and other methods returning job results) return.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal abstract</b> <span class="i">StartableJob</span> <a id="e2b3cc462d051e31" href="../../R/e2b3cc462d051e31.html" target="n" data-glyph="74,1" class="i method">CreateInstanceMethodInvocationJob</a>(<span class="r1 r t">TSession</span> <span id="r12 rd" class="r12 r">session</span>, <span class="r0 r t">TObjectInstance</span> <span id="r13 rd" class="r13 r">objectInstance</span>, <span class="i">MethodInvocationInfo</span> <span id="r14 rd" class="r14 r">methodInvocationInfo</span>, <b>bool</b> <span id="r15 rd" class="r15 r">passThru</span>);
 
        <b>private</b> <span class="i">StartableJob</span> <a id="6347f510a09d7a14" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">DoCreateInstanceMethodInvocationJob</a>(<span class="r1 r t">TSession</span> <span id="r16 rd" class="r16 r">sessionForJob</span>, <span class="r0 r t">TObjectInstance</span> <span id="r17 rd" class="r17 r">objectInstance</span>, <span class="i">MethodInvocationInfo</span> <span id="r18 rd" class="r18 r">methodInvocationInfo</span>, <b>bool</b> <span id="r19 rd" class="r19 r">passThru</span>, <b>bool</b> <span id="r20 rd" class="r20 r">asJob</span>)
        {
            <span class="i">StartableJob</span> <span id="r21 rd" class="r21 r">methodInvocationJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#e2b3cc462d051e31" class="i method">CreateInstanceMethodInvocationJob</a>(<span class="r16 r">sessionForJob</span>, <span class="r17 r">objectInstance</span>, <span class="r18 r">methodInvocationInfo</span>, <span class="r19 r">passThru</span>);
 
            <b>if</b> (<span class="r21 r">methodInvocationJob</span> != <b>null</b>)
            {
                <b>bool</b> <span id="r22 rd" class="r22 r">discardNonPipelineResults</span> = !<span class="r20 r">asJob</span>;
                <span class="i">HandleJobOutput</span>(
                    <span class="r21 r">methodInvocationJob</span>,
                    <span class="r16 r">sessionForJob</span>,
                    <span class="r22 r">discardNonPipelineResults</span>,
                    <span class="i">outputAction</span>: <b>null</b>);
            }
 
            <b>return</b> <span class="r21 r">methodInvocationJob</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Job</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object that invokes a static method in the wrapped object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote session to invoke the method in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">methodInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Method invocation details.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method shouldn&#39;t do any processing or interact with the remote session.</span>
        <span class="c">///</span><span class="c"> Doing so will interfere with ThrottleLimit functionality.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Job</span>.<span class="i">WriteObject</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> (and other methods returning job results) will block to support throttling and flow-control.</span>
        <span class="c">///</span><span class="c"> Implementations of Job instance returned from this method should make sure that implementation-specific flow-control mechanism pauses further processing,</span>
        <span class="c">///</span><span class="c"> until calls from </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Job</span>.<span class="i">WriteObject</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> (and other methods returning job results) return.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal abstract</b> <span class="i">StartableJob</span> <a id="f03aa48718e5f33b" href="../../R/f03aa48718e5f33b.html" target="n" data-glyph="74,1" class="i method">CreateStaticMethodInvocationJob</a>(<span class="r1 r t">TSession</span> <span id="r23 rd" class="r23 r">session</span>, <span class="i">MethodInvocationInfo</span> <span id="r24 rd" class="r24 r">methodInvocationInfo</span>);
 
        <b>private</b> <span class="i">StartableJob</span> <a id="a0a1834d2d8bd53b" href="../../R/a0a1834d2d8bd53b.html" target="n" data-glyph="76,1" class="i method">DoCreateStaticMethodInvocationJob</a>(<span class="r1 r t">TSession</span> <span id="r25 rd" class="r25 r">sessionForJob</span>, <span class="i">MethodInvocationInfo</span> <span id="r26 rd" class="r26 r">methodInvocationInfo</span>)
        {
            <span class="i">StartableJob</span> <span id="r27 rd" class="r27 r">methodInvocationJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#f03aa48718e5f33b" class="i method">CreateStaticMethodInvocationJob</a>(<span class="r25 r">sessionForJob</span>, <span class="r26 r">methodInvocationInfo</span>);
 
            <b>if</b> (<span class="r27 r">methodInvocationJob</span> != <b>null</b>)
            {
                <b>bool</b> <span id="r28 rd" class="r28 r">discardNonPipelineResults</span> = !<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>;
                <span class="i">HandleJobOutput</span>(
                    <span class="r27 r">methodInvocationJob</span>,
                    <span class="r25 r">sessionForJob</span>,
                    <span class="r28 r">discardNonPipelineResults</span>,
                    <span class="i">outputAction</span>: <b>null</b>);
            }
 
            <b>return</b> <span class="r27 r">methodInvocationJob</span>;
        }
 
        <b>private static void</b> <a id="8b7d1da45c0ab798" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleJobOutput</a>(<span class="i">Job</span> <span id="r29 rd" class="r29 r">job</span>, <span class="r1 r t">TSession</span> <span id="r30 rd" class="r30 r">sessionForJob</span>, <b>bool</b> <span id="r31 rd" class="r31 r">discardNonPipelineResults</span>, <span class="i">Action</span>&lt;<span class="i">PSObject</span>&gt; <span id="r32 rd" class="r32 r">outputAction</span>)
        {
            <span class="i">Action</span>&lt;<span class="i">PSObject</span>&gt; <span id="r33 rd" class="r33 r">processOutput</span> =
                    (<span class="i">PSObject</span> <span id="r34 rd" class="r34 r">pso</span>) =&gt;
                    {
                        <b>if</b> (<span class="r34 r">pso</span> == <b>null</b>)
                        {
                            <b>return</b>;
                        }
 
                        <span class="r32 r">outputAction</span>?.<span class="i">Invoke</span>(<span class="r34 r">pso</span>);
                    };
 
            <span class="r29 r">job</span>.<span class="i">Output</span>.<span class="i">DataAdded</span> +=
                    (<b>object</b> <span id="r35 rd" class="r35 r">sender</span>, <span class="i">DataAddedEventArgs</span> <span id="r36 rd" class="r36 r">eventArgs</span>) =&gt;
                    {
                        <b>var</b> <span id="r37 rd" class="r37 r">dataCollection</span> = (<span class="i">PSDataCollection</span>&lt;<span class="i">PSObject</span>&gt;)<span class="r35 r">sender</span>;
 
                        <b>if</b> (<span class="r31 r">discardNonPipelineResults</span>)
                        {
                            <b>foreach</b> (<span class="i">PSObject</span> <span id="r38 rd" class="r38 r">pso</span> <b>in</b> <span class="r37 r">dataCollection</span>.<span class="i">ReadAll</span>())
                            {
                                <span class="c">// TODO/FIXME - need to make sure that the dataCollection will be throttled</span>
                                <span class="c">// (i.e. it won&#39;t accept more items - it will block in Add method)</span>
                                <span class="c">// until this processOutput call completes</span>
                                <span class="r33 r">processOutput</span>(<span class="r38 r">pso</span>);
                            }
                        }
                        <b>else</b>
                        {
                            <span class="i">PSObject</span> <span id="r39 rd" class="r39 r">pso</span> = <span class="r37 r">dataCollection</span>[<span class="r36 r">eventArgs</span>.<span class="i">Index</span>];
                            <span class="r33 r">processOutput</span>(<span class="r39 r">pso</span>);
                        }
                    };
 
            <b>if</b> (<span class="r31 r">discardNonPipelineResults</span>)
            {
                <a href="#31868a3ef66029d8" class="i method">DiscardJobOutputs</a>(<span class="r29 r">job</span>, <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#43e694c07a5f128a" class="i field">NonPipelineResults</a> &amp; (~<a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#5a498989a254fb4f" class="i field">Output</a>));
            }
        }
 
        <b>internal virtual</b> <span class="r1 r t">TSession</span> <a id="f6371f9b27f7443d" href="../../R/f6371f9b27f7443d.html" target="n" data-glyph="74,1" class="i method">GetSessionOfOriginFromInstance</a>(<span class="r0 r t">TObjectInstance</span> <span id="r40 rd" class="r40 r">instance</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns default sessions to use when the user doesn&#39;t specify the -Session cmdlet parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Default sessions to use when the user doesn&#39;t specify the -Session cmdlet parameter.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected abstract</b> <span class="r1 r t">TSession</span> <a id="79104cde67188cb3" href="../../R/79104cde67188cb3.html" target="n" data-glyph="105,1" class="i property">DefaultSession</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A new job name to use for the parent job that handles throttling of the child jobs that actually perform querying and method invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract string</b> <a id="3075a5ab2f2f98c5" href="../../R/3075a5ab2f2f98c5.html" target="n" data-glyph="75,1" class="i method">GenerateParentJobName</a>();
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helper methods
 
        <b>private static void</b> <a id="69af37f7327eeb74" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">DiscardJobOutputs</a>&lt;<span id="r41 rd t" class="r41 r t">T</span>&gt;(<span class="i">PSDataCollection</span>&lt;<span class="r41 r t">T</span>&gt; <span id="r42 rd" class="r42 r">psDataCollection</span>)
        {
            <span class="r42 r">psDataCollection</span>.<span class="i">DataAdded</span> +=
                    (<b>object</b> <span id="r43 rd" class="r43 r">sender</span>, <span class="i">DataAddedEventArgs</span> <span id="r44 rd" class="r44 r">e</span>) =&gt;
                    {
                        <b>var</b> <span id="r45 rd" class="r45 r">localDataCollection</span> = (<span class="i">PSDataCollection</span>&lt;<span class="r41 r t">T</span>&gt;)<span class="r43 r">sender</span>;
                        <span class="r45 r">localDataCollection</span>.<span class="i">Clear</span>();
                    };
        }
 
        [<span class="i">Flags</span>]
        <b>private enum</b> <a id="a10c9882fdc9756c" href="../../R/a10c9882fdc9756c.html" target="n" data-glyph="22,1" class="t t"><span id="36b87689d79e9d56">JobOutputs</span></a>
        {
            <a id="5a498989a254fb4f" href="../../R/5a498989a254fb4f.html" target="n" data-glyph="24,2" class="i field">Output</a> = 0x1,
            <a id="dbc4be571ac39b4b" href="../../R/dbc4be571ac39b4b.html" target="n" data-glyph="24,2" class="i field">Error</a> = 0x2,
            <a id="eca51500417aad5e" href="../../R/eca51500417aad5e.html" target="n" data-glyph="24,2" class="i field">Warning</a> = 0x4,
            <a id="0a082d6cb7585c82" href="../../R/0a082d6cb7585c82.html" target="n" data-glyph="24,2" class="i field">Verbose</a> = 0x8,
            <a id="49c1f1e40f1d026a" href="../../R/49c1f1e40f1d026a.html" target="n" data-glyph="24,2" class="i field">Debug</a> = 0x10,
            <a id="e4aa8968303648e0" href="../../R/e4aa8968303648e0.html" target="n" data-glyph="24,2" class="i field">Progress</a> = 0x20,
            <a id="627ffc4b60ffb7a7" href="../../R/627ffc4b60ffb7a7.html" target="n" data-glyph="24,2" class="i field">Results</a> = 0x40,
 
            <a id="43e694c07a5f128a" href="../../R/43e694c07a5f128a.html" target="n" data-glyph="24,2" class="i field">NonPipelineResults</a> = <a href="#5a498989a254fb4f" class="i field">Output</a> | <a href="#dbc4be571ac39b4b" class="i field">Error</a> | <a href="#eca51500417aad5e" class="i field">Warning</a> | <a href="#0a082d6cb7585c82" class="i field">Verbose</a> | <a href="#49c1f1e40f1d026a" class="i field">Debug</a> | <a href="#e4aa8968303648e0" class="i field">Progress</a>,
            <a id="502310a9340665bb" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">PipelineResults</a> = <a href="#627ffc4b60ffb7a7" class="i field">Results</a>,
        }
 
        <b>private static void</b> <a id="31868a3ef66029d8" href="../../R/31868a3ef66029d8.html" target="n" data-glyph="76,1" class="i method">DiscardJobOutputs</a>(<span class="i">Job</span> <span id="r46 rd" class="r46 r">job</span>, <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a> <span id="r47 rd" class="r47 r">jobOutputsToDiscard</span>)
        {
            <b>if</b> ((<span class="r47 r">jobOutputsToDiscard</span> &amp; <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#5a498989a254fb4f" class="i field">Output</a>) == <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#5a498989a254fb4f" class="i field">Output</a>)
            {
                <span class="i">DiscardJobOutputs</span>(<span class="r46 r">job</span>.<span class="i">Output</span>);
            }
 
            <b>if</b> ((<span class="r47 r">jobOutputsToDiscard</span> &amp; <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#dbc4be571ac39b4b" class="i field">Error</a>) == <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#dbc4be571ac39b4b" class="i field">Error</a>)
            {
                <span class="i">DiscardJobOutputs</span>(<span class="r46 r">job</span>.<span class="i">Error</span>);
            }
 
            <b>if</b> ((<span class="r47 r">jobOutputsToDiscard</span> &amp; <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#eca51500417aad5e" class="i field">Warning</a>) == <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#eca51500417aad5e" class="i field">Warning</a>)
            {
                <span class="i">DiscardJobOutputs</span>(<span class="r46 r">job</span>.<span class="i">Warning</span>);
            }
 
            <b>if</b> ((<span class="r47 r">jobOutputsToDiscard</span> &amp; <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#0a082d6cb7585c82" class="i field">Verbose</a>) == <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#0a082d6cb7585c82" class="i field">Verbose</a>)
            {
                <span class="i">DiscardJobOutputs</span>(<span class="r46 r">job</span>.<span class="i">Verbose</span>);
            }
 
            <b>if</b> ((<span class="r47 r">jobOutputsToDiscard</span> &amp; <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#49c1f1e40f1d026a" class="i field">Debug</a>) == <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#49c1f1e40f1d026a" class="i field">Debug</a>)
            {
                <span class="i">DiscardJobOutputs</span>(<span class="r46 r">job</span>.<span class="i">Debug</span>);
            }
 
            <b>if</b> ((<span class="r47 r">jobOutputsToDiscard</span> &amp; <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#e4aa8968303648e0" class="i field">Progress</a>) == <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#e4aa8968303648e0" class="i field">Progress</a>)
            {
                <span class="i">DiscardJobOutputs</span>(<span class="r46 r">job</span>.<span class="i">Progress</span>);
            }
 
            <b>if</b> ((<span class="r47 r">jobOutputsToDiscard</span> &amp; <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#627ffc4b60ffb7a7" class="i field">Results</a>) == <a href="#a10c9882fdc9756c" class="t t">JobOutputs</a>.<a href="#627ffc4b60ffb7a7" class="i field">Results</a>)
            {
                <span class="i">DiscardJobOutputs</span>(<span class="r46 r">job</span>.<span class="i">Results</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Helper methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Implementation of ObjectModelWrapper functionality
 
        <b>private</b> <span class="i">ThrottlingJob</span> <a id="e79a40b7348ffe20" href="../../R/e79a40b7348ffe20.html" target="n" data-glyph="46,1" class="i field">_parentJob</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Queries for object instances in the object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">query</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Query parameters.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A lazy evaluated collection of object instances.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="ee45930cd34cb6e3" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ProcessRecord</a>(<span class="i">QueryBuilder</span> <span id="r48 rd" class="r48 r">query</span>)
        {
            <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">DisableFlowControlForPendingCmdletActionsQueue</span>();
            <b>foreach</b> (<span class="r1 r t">TSession</span> <span id="r49 rd" class="r49 r">sessionForJob</span> <b>in</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#ffd09df8fe1b5d4f" class="i method">GetSessionsToActAgainst</a>(<span class="r48 r">query</span>))
            {
                <span class="i">StartableJob</span> <span id="r50 rd" class="r50 r">childJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#89d7335c82773176" class="i method">DoCreateQueryJob</a>(<span class="r49 r">sessionForJob</span>, <span class="r48 r">query</span>, <span class="r7 r">actionAgainstResults</span>: <b>null</b>);
                <b>if</b> (<span class="r50 r">childJob</span> != <b>null</b>)
                {
                    <b>if</b> (!<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>)
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobAndPotentiallyBlock</span>(<a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>, <span class="r50 r">childJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">None</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobWithoutBlocking</span>(<span class="r50 r">childJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">None</span>);
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Queries for instance and invokes an instance method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">query</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Query parameters.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">methodInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Method invocation details.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">passThru</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if successful method invocations should emit downstream the object instance being operated on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="7c61cff65d3adfb5" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ProcessRecord</a>(<span class="i">QueryBuilder</span> <span id="r51 rd" class="r51 r">query</span>, <span class="i">MethodInvocationInfo</span> <span id="r52 rd" class="r52 r">methodInvocationInfo</span>, <b>bool</b> <span id="r53 rd" class="r53 r">passThru</span>)
        {
            <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">DisableFlowControlForPendingJobsQueue</span>();
 
            <span class="i">ThrottlingJob</span> <span id="r54 rd" class="r54 r">closureOverParentJob</span> = <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>;
            <span class="i">SwitchParameter</span> <span id="r55 rd" class="r55 r">closureOverAsJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>;
 
            <b>foreach</b> (<span class="r1 r t">TSession</span> <span id="r56 rd" class="r56 r">sessionForJob</span> <b>in</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#ffd09df8fe1b5d4f" class="i method">GetSessionsToActAgainst</a>(<span class="r51 r">query</span>))
            {
                <span class="i">StartableJob</span> <span id="r57 rd" class="r57 r">queryJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">DoCreateQueryJob</span>(
                    <span class="r56 r">sessionForJob</span>,
                    <span class="r51 r">query</span>,
                    (<span class="r1 r t">TSession</span> <span id="r58 rd" class="r58 r">sessionForMethodInvocationJob</span>, <span class="r0 r t">TObjectInstance</span> <span id="r59 rd" class="r59 r">objectInstance</span>) =&gt;
                    {
                        <span class="i">StartableJob</span> <span id="r60 rd" class="r60 r">methodInvocationJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">DoCreateInstanceMethodInvocationJob</span>(
                            <span class="r58 r">sessionForMethodInvocationJob</span>,
                            <span class="r59 r">objectInstance</span>,
                            <span class="r52 r">methodInvocationInfo</span>,
                            <span class="r53 r">passThru</span>,
                            <span class="r55 r">closureOverAsJob</span>.<span class="i">IsPresent</span>);
 
                        <b>if</b> (<span class="r60 r">methodInvocationJob</span> != <b>null</b>)
                        {
                            <span class="r54 r">closureOverParentJob</span>.<span class="i">AddChildJobAndPotentiallyBlock</span>(<span class="r60 r">methodInvocationJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">None</span>);
                        }
                    });
 
                <b>if</b> (<span class="r57 r">queryJob</span> != <b>null</b>)
                {
                    <b>if</b> (!<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>)
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobAndPotentiallyBlock</span>(<a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>, <span class="r57 r">queryJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">CreatesChildJobs</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobWithoutBlocking</span>(<span class="r57 r">queryJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">CreatesChildJobs</span>);
                    }
                }
            }
        }
 
        <b>private</b> <span class="i">IEnumerable</span>&lt;<span class="r1 r t">TSession</span>&gt; <a id="b980550d733c045b" href="../../R/b980550d733c045b.html" target="n" data-glyph="76,1" class="i method">GetSessionsToActAgainst</a>(<span class="r0 r t">TObjectInstance</span> <span id="r61 rd" class="r61 r">objectInstance</span>)
        {
            <b>if</b> (<a href="#162565cb2dad08c7" class="i field">_sessionWasSpecified</a>)
            {
                <b>return</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#e15532283f92444f" class="i property">Session</a>;
            }
 
            <span class="r1 r t">TSession</span> <span id="r62 rd" class="r62 r">associatedSession</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#f6371f9b27f7443d" class="i method">GetSessionOfOriginFromInstance</a>(<span class="r61 r">objectInstance</span>);
            <b>if</b> (<span class="r62 r">associatedSession</span> != <b>null</b>)
            {
                <b>return</b> <b>new</b>[] { <span class="r62 r">associatedSession</span> };
            }
 
            <b>return</b> <b>new</b>[] { <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#366109e450398631" class="i method">GetImpliedSession</a>() };
        }
 
        <b>private</b> <span class="r1 r t">TSession</span> <a id="65cfd8029ebdcb54" href="../../R/65cfd8029ebdcb54.html" target="n" data-glyph="76,1" class="i method">GetSessionAssociatedWithPipelineObject</a>()
        {
            <b>object</b> <span id="r63 rd" class="r63 r">inputVariableValue</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">Context</span>.<span class="i">GetVariableValue</span>(<span class="i">SpecialVariables</span>.<span class="i">InputVarPath</span>, <b>null</b>);
            <b>if</b> (<span class="r63 r">inputVariableValue</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="i">IEnumerable</span> <span id="r64 rd" class="r64 r">inputEnumerable</span> = <span class="i">LanguagePrimitives</span>.<span class="i">GetEnumerable</span>(<span class="r63 r">inputVariableValue</span>);
            <b>if</b> (<span class="r64 r">inputEnumerable</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r65 rd" class="r65 r">inputCollection</span> = <span class="r64 r">inputEnumerable</span>.<span class="i">Cast</span>&lt;<b>object</b>&gt;().<span class="i">ToList</span>();
            <b>if</b> (<span class="r65 r">inputCollection</span>.<span class="i">Count</span> != 1)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="r0 r t">TObjectInstance</span> <span id="r66 rd" class="r66 r">inputInstance</span>;
            <b>if</b> (!<span class="i">LanguagePrimitives</span>.<span class="i">TryConvertTo</span>(<span class="r65 r">inputCollection</span>[0], <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <b>out</b> <span class="r66 r">inputInstance</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="r1 r t">TSession</span> <span id="r67 rd" class="r67 r">associatedSession</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#f6371f9b27f7443d" class="i method">GetSessionOfOriginFromInstance</a>(<span class="r66 r">inputInstance</span>);
            <b>return</b> <span class="r67 r">associatedSession</span>;
        }
 
        <b>private</b> <span class="i">IEnumerable</span>&lt;<span class="r1 r t">TSession</span>&gt; <a id="ffd09df8fe1b5d4f" href="../../R/ffd09df8fe1b5d4f.html" target="n" data-glyph="76,1" class="i method">GetSessionsToActAgainst</a>(<span class="i">QueryBuilder</span> <span id="r68 rd" class="r68 r">queryBuilder</span>)
        {
            <b>if</b> (<a href="#162565cb2dad08c7" class="i field">_sessionWasSpecified</a>)
            {
                <b>return</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#e15532283f92444f" class="i property">Session</a>;
            }
 
            <a href="#55650633cb9532ae" class="k">var</a> <span id="r69 rd" class="r69 r">sessionBoundQueryBuilder</span> = <span class="r68 r">queryBuilder</span> <b>as</b> <a href="#55650633cb9532ae" class="t t">ISessionBoundQueryBuilder</a>&lt;<span class="r1 r t">TSession</span>&gt;;
            <b>if</b> (<span class="r69 r">sessionBoundQueryBuilder</span> != <b>null</b>)
            {
                <span class="r1 r t">TSession</span> <span id="r70 rd" class="r70 r">sessionOfTheQueryBuilder</span> = <span class="r69 r">sessionBoundQueryBuilder</span>.<a href="#75abd0f48cf27c83" class="i method">GetTargetSession</a>();
                <b>if</b> (<span class="r70 r">sessionOfTheQueryBuilder</span> != <b>null</b>)
                {
                    <b>return</b> <b>new</b>[] { <span class="r70 r">sessionOfTheQueryBuilder</span> };
                }
            }
 
            <span class="r1 r t">TSession</span> <span id="r71 rd" class="r71 r">sessionAssociatedWithPipelineObject</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#65cfd8029ebdcb54" class="i method">GetSessionAssociatedWithPipelineObject</a>();
            <b>if</b> (<span class="r71 r">sessionAssociatedWithPipelineObject</span> != <b>null</b>)
            {
                <b>return</b> <b>new</b>[] { <span class="r71 r">sessionAssociatedWithPipelineObject</span> };
            }
 
            <b>return</b> <b>new</b>[] { <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#366109e450398631" class="i method">GetImpliedSession</a>() };
        }
 
        <b>private</b> <span class="i">IEnumerable</span>&lt;<span class="r1 r t">TSession</span>&gt; <a id="0124f4f9577cbaa1" href="../../R/0124f4f9577cbaa1.html" target="n" data-glyph="76,1" class="i method">GetSessionsToActAgainst</a>(<span class="i">MethodInvocationInfo</span> <span id="r72 rd" class="r72 r">methodInvocationInfo</span>)
        {
            <b>if</b> (<a href="#162565cb2dad08c7" class="i field">_sessionWasSpecified</a>)
            {
                <b>return</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#e15532283f92444f" class="i property">Session</a>;
            }
 
            <b>var</b> <span id="r73 rd" class="r73 r">associatedSessions</span> = <b>new</b> <span class="i">HashSet</span>&lt;<span class="r1 r t">TSession</span>&gt;();
            <b>foreach</b> (<span class="r0 r t">TObjectInstance</span> <span id="r74 rd" class="r74 r">objectInstance</span> <b>in</b> <span class="r72 r">methodInvocationInfo</span>.<span class="i">GetArgumentsOfType</span>&lt;<span class="r0 r t">TObjectInstance</span>&gt;())
            {
                <span class="r1 r t">TSession</span> <span id="r75 rd" class="r75 r">associatedSession</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#f6371f9b27f7443d" class="i method">GetSessionOfOriginFromInstance</a>(<span class="r74 r">objectInstance</span>);
                <b>if</b> (<span class="r75 r">associatedSession</span> != <b>null</b>)
                {
                    <span class="r73 r">associatedSessions</span>.<span class="i">Add</span>(<span class="r75 r">associatedSession</span>);
                }
            }
 
            <b>if</b> (<span class="r73 r">associatedSessions</span>.<span class="i">Count</span> == 1)
            {
                <b>return</b> <span class="r73 r">associatedSessions</span>;
            }
 
            <span class="r1 r t">TSession</span> <span id="r76 rd" class="r76 r">sessionAssociatedWithPipelineObject</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#65cfd8029ebdcb54" class="i method">GetSessionAssociatedWithPipelineObject</a>();
            <b>if</b> (<span class="r76 r">sessionAssociatedWithPipelineObject</span> != <b>null</b>)
            {
                <b>return</b> <b>new</b>[] { <span class="r76 r">sessionAssociatedWithPipelineObject</span> };
            }
 
            <b>return</b> <b>new</b>[] { <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#366109e450398631" class="i method">GetImpliedSession</a>() };
        }
 
        <b>internal</b> <span class="i">PSModuleInfo</span> <a id="489bd4dce181fb79" href="../../R/489bd4dce181fb79.html" target="n" data-glyph="104,1" class="i property">PSModuleInfo</a>
        {
            <b>get</b>
            {
                <b>var</b> <span id="r77 rd" class="r77 r">scriptCommandInfo</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">CommandInfo</span> <b>as</b> <span class="i">IScriptCommandInfo</span>;
                <b>return</b> <span class="r77 r">scriptCommandInfo</span>.<span class="i">ScriptBlock</span>.<span class="i">Module</span>;
            }
        }
 
        <b>private</b> <span class="r1 r t">TSession</span> <a id="366109e450398631" href="../../R/366109e450398631.html" target="n" data-glyph="76,1" class="i method">GetImpliedSession</a>()
        {
            <span class="r1 r t">TSession</span> <span id="r78 rd" class="r78 r">sessionFromImportModule</span>;
            <span class="c">// When being called from a CIM activity, this will be invoked as</span>
            <span class="c">// a function so there will be no module info</span>
            <b>if</b> (<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#489bd4dce181fb79" class="i property">PSModuleInfo</a> != <b>null</b>)
            {
                <b>if</b> (<span class="i">PSPrimitiveDictionary</span>.<span class="i">TryPathGet</span>(
                        <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#489bd4dce181fb79" class="i property">PSModuleInfo</a>.<span class="i">PrivateData</span> <b>as</b> <span class="i">IDictionary</span>,
                        <b>out</b> <span class="r78 r">sessionFromImportModule</span>,
                        <span class="i">ScriptWriter</span>.<span class="i">PrivateDataKey_CmdletsOverObjects</span>,
                        <span class="i">ScriptWriter</span>.<span class="i">PrivateDataKey_DefaultSession</span>))
                {
                    <b>return</b> <span class="r78 r">sessionFromImportModule</span>;
                }
            }
 
            <b>return</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#79104cde67188cb3" class="i property">DefaultSession</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invokes an instance method in the object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">objectInstance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object on which to invoke the method.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">methodInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Method invocation details.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">passThru</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if successful method invocations should emit downstream the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">objectInstance</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> being operated on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="1c257dfaf0031360" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ProcessRecord</a>(<span class="r0 r t">TObjectInstance</span> <span id="r79 rd" class="r79 r">objectInstance</span>, <span class="i">MethodInvocationInfo</span> <span id="r80 rd" class="r80 r">methodInvocationInfo</span>, <b>bool</b> <span id="r81 rd" class="r81 r">passThru</span>)
        {
            <b>if</b> (<span class="r79 r">objectInstance</span> == <b>null</b>) <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r79 r">objectInstance</span>));
            <b>if</b> (<span class="r80 r">methodInvocationInfo</span> == <b>null</b>) <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r80 r">methodInvocationInfo</span>));
 
            <b>foreach</b> (<span class="r1 r t">TSession</span> <span id="r82 rd" class="r82 r">sessionForJob</span> <b>in</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#b980550d733c045b" class="i method">GetSessionsToActAgainst</a>(<span class="r79 r">objectInstance</span>))
            {
                <span class="i">StartableJob</span> <span id="r83 rd" class="r83 r">childJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">DoCreateInstanceMethodInvocationJob</span>(<span class="r82 r">sessionForJob</span>, <span class="r79 r">objectInstance</span>, <span class="r80 r">methodInvocationInfo</span>, <span class="r81 r">passThru</span>, <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>);
                <b>if</b> (<span class="r83 r">childJob</span> != <b>null</b>)
                {
                    <b>if</b> (!<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>)
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobAndPotentiallyBlock</span>(<a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>, <span class="r83 r">childJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">None</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobWithoutBlocking</span>(<span class="r83 r">childJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">None</span>);
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invokes a static method in the object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">methodInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Method invocation details.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="29a8cb7e27a26787" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ProcessRecord</a>(<span class="i">MethodInvocationInfo</span> <span id="r84 rd" class="r84 r">methodInvocationInfo</span>)
        {
            <b>if</b> (<span class="r84 r">methodInvocationInfo</span> == <b>null</b>) <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r84 r">methodInvocationInfo</span>));
 
            <b>foreach</b> (<span class="r1 r t">TSession</span> <span id="r85 rd" class="r85 r">sessionForJob</span> <b>in</b> <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#0124f4f9577cbaa1" class="i method">GetSessionsToActAgainst</a>(<span class="r84 r">methodInvocationInfo</span>))
            {
                <span class="i">StartableJob</span> <span id="r86 rd" class="r86 r">childJob</span> = <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a0a1834d2d8bd53b" class="i method">DoCreateStaticMethodInvocationJob</a>(<span class="r85 r">sessionForJob</span>, <span class="r84 r">methodInvocationInfo</span>);
                <b>if</b> (<span class="r86 r">childJob</span> != <b>null</b>)
                {
                    <b>if</b> (!<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>)
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobAndPotentiallyBlock</span>(<a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>, <span class="r86 r">childJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">None</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">AddChildJobWithoutBlocking</span>(<span class="r86 r">childJob</span>, <span class="i">ThrottlingJob</span>.<span class="i">ChildJobFlags</span>.<span class="i">None</span>);
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs initialization of cmdlet execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="09e3efec47e85955" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">BeginProcessing</a>()
        {
            <b>if</b> (<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>)
            {
                <span class="i">MshCommandRuntime</span> <span id="r87 rd" class="r87 r">commandRuntime</span> = (<span class="i">MshCommandRuntime</span>)<a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">CommandRuntime</span>; <span class="c">// PSCmdlet.CommandRuntime is always MshCommandRuntime</span>
                <b>string</b> <span id="r88 rd" class="r88 r">conflictingParameter</span> = <b>null</b>;
                <b>if</b> (<span class="r87 r">commandRuntime</span>.<span class="i">WhatIf</span>.<span class="i">IsPresent</span>)
                {
                    <span class="r88 r">conflictingParameter</span> = <span class="s">&quot;WhatIf&quot;</span>;
                }
                <b>else</b> <b>if</b> (<span class="r87 r">commandRuntime</span>.<span class="i">Confirm</span>.<span class="i">IsPresent</span>)
                {
                    <span class="r88 r">conflictingParameter</span> = <span class="s">&quot;Confirm&quot;</span>;
                }
 
                <b>if</b> (<span class="r88 r">conflictingParameter</span> != <b>null</b>)
                {
                    <b>string</b> <span id="r89 rd" class="r89 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="i">CmdletizationResources</span>.<span class="i">SessionBasedWrapper_ShouldProcessVsJobConflict</span>,
                        <span class="r88 r">conflictingParameter</span>);
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r89 r">errorMessage</span>);
                }
            }
 
            <a href="#e79a40b7348ffe20" class="i field">_parentJob</a> = <b>new</b> <span class="i">ThrottlingJob</span>(
                <span class="i">command</span>: <span class="i">Job</span>.<span class="i">GetCommandTextFromInvocationInfo</span>(<a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">MyInvocation</span>),
                <span class="i">jobName</span>: <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#3075a5ab2f2f98c5" class="i method">GenerateParentJobName</a>(),
                <span class="i">jobTypeName</span>: <a href="#d7d55de981c34969" class="i field">CIMJobType</a>,
                <span class="i">maximumConcurrentChildJobs</span>: <a href="#931739e72bdca1ce" class="k">this</a>.<a href="#c2452c411dd5ed22" class="i property">ThrottleLimit</a>,
                <span class="i">cmdletMode</span>: !<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs cleanup after cmdlet execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="5fd7a74538fdada7" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">EndProcessing</a>()
        {
            <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">EndOfChildJobs</span>();
            <b>if</b> (<a href="#931739e72bdca1ce" class="k">this</a>.<a href="#a35ad7153de9990b" class="i property">AsJob</a>.<span class="i">IsPresent</span>)
            {
                <a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">WriteObject</span>(<a href="#e79a40b7348ffe20" class="i field">_parentJob</a>);
                <a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">JobRepository</span>.<span class="i">Add</span>(<a href="#e79a40b7348ffe20" class="i field">_parentJob</a>);
                <a href="#e79a40b7348ffe20" class="i field">_parentJob</a> = <b>null</b>; <span class="c">// this class doesn&#39;t own parentJob after it has been emitted to the outside world</span>
            }
            <b>else</b>
            {
                <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">ForwardAllResultsToCmdlet</span>(<a href="#931739e72bdca1ce" class="k">this</a>.<span class="i">Cmdlet</span>);
                <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>.<span class="i">Finished</span>.<span class="i">WaitOne</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stops the parent job when called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="0761ca89e3a2d923" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">StopProcessing</a>()
        {
            <span class="i">Job</span> <span id="r90 rd" class="r90 r">jobToStop</span> = <a href="#e79a40b7348ffe20" class="i field">_parentJob</a>;
            <b>if</b> (<span class="r90 r">jobToStop</span> != <b>null</b>)
            {
                <span class="r90 r">jobToStop</span>.<span class="i">StopJob</span>();
            }
 
            <b>base</b>.<span class="i">StopProcessing</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <b>internal interface</b> <a id="55650633cb9532ae" href="../../R/55650633cb9532ae.html" target="n" data-glyph="50,0" class="t t">ISessionBoundQueryBuilder</a>&lt;<b>out</b> <span id="r91 rd t" class="r91 r t">TSession</span>&gt;
    {
        <span class="r91 r t">TSession</span> <a id="75abd0f48cf27c83" href="../../R/75abd0f48cf27c83.html" target="n" data-glyph="72,1" class="i method">GetTargetSession</a>();
    }
}
</pre></td></tr></table></div></body></html>
