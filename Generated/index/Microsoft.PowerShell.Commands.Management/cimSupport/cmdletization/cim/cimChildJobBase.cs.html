<!DOCTYPE html>
<html><head><title>cimChildJobBase.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(1093);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/cimSupport/cmdletization/cim/cimChildJobBase.cs" target="_top">cimSupport\cmdletization\cim\cimChildJobBase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Internal</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Remoting</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Remoting</span>.<span class="i">Internal</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Options</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Cim</span>;
 
<b>using</b> <span class="i">Dbg</span> = <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Cmdletization</span>.<span class="i n">Cim</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Base class for all child jobs that wrap CIM operations.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal abstract class</b> <a id="ce791a9f3445312b" href="../../../R/ce791a9f3445312b.html" target="n" data-glyph="2,0" class="t t">CimChildJobBase</a>&lt;<span id="r0 rd t" class="r0 r t">T</span>&gt; :
        <span class="i">StartableJob</span>,
        <span class="i">IObserver</span>&lt;<span class="r0 r t">T</span>&gt;
    {
        <b>private static long</b> <a id="f94b0c3589eead7b" href="../../../R/f94b0c3589eead7b.html" target="n" data-glyph="46,1" class="i field">s_globalJobNumberCounter</a>;
        <b>private readonly long</b> <a id="46ad1fc0a1edc11b" href="../../../R/46ad1fc0a1edc11b.html" target="n" data-glyph="46,1" class="i field">_myJobNumber</a> = <span class="i">Interlocked</span>.<span class="i">Increment</span>(<b>ref</b> <a href="#f94b0c3589eead7b" class="i field">s_globalJobNumberCounter</a>);
 
        <b>private const string</b> <a id="20b9f366dfaf7b3a" href="../../../R/20b9f366dfaf7b3a.html" target="n" data-glyph="10,1" class="i field">CIMJobType</a> = <span class="s">&quot;CimJob&quot;</span>;
 
        <b>internal</b> <a href="cimJobContext.cs.html#8739c35db0e1a6ca" class="t t">CimJobContext</a> <a id="e0407cd9a723429a" href="../../../R/e0407cd9a723429a.html" target="n" data-glyph="104,1" class="i property">JobContext</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a55ec793fddec342" class="i field">_jobContext</a>;
            }
        }
 
        <b>private readonly</b> <a href="cimJobContext.cs.html#8739c35db0e1a6ca" class="t t">CimJobContext</a> <a id="a55ec793fddec342" href="../../../R/a55ec793fddec342.html" target="n" data-glyph="46,1" class="i field">_jobContext</a>;
 
        <b>internal</b> <a id="8236dd1b8bf11ffb" href="../../../R/8236dd1b8bf11ffb.html" target="n" data-glyph="74,1" class="t constructor">CimChildJobBase</a>(<a href="cimJobContext.cs.html#8739c35db0e1a6ca" class="t t">CimJobContext</a> <span id="r1 rd" class="r1 r">jobContext</span>)
            : <b>base</b>(<span class="i">Job</span>.<span class="i">GetCommandTextFromInvocationInfo</span>(<span class="r1 r">jobContext</span>.<a href="cimJobContext.cs.html#33605f3ca7413312" class="i property">CmdletInvocationInfo</a>), <span class="s">&quot; &quot;</span> <span class="c">/* temporary name - reset below */</span>)
        {
            <a href="#a55ec793fddec342" class="i field">_jobContext</a> = <span class="r1 r">jobContext</span>;
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">PSJobTypeName</span> = <a href="#20b9f366dfaf7b3a" class="i field">CIMJobType</a>;
 
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">Name</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">GetType</span>().<span class="i">Name</span> + <a href="#46ad1fc0a1edc11b" class="i field">_myJobNumber</a>.<span class="i">ToString</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
            <span class="i">UsesResultsCollection</span> = <b>true</b>;
 
            <b>lock</b> (<a href="#596d93930ce4d7b2" class="i field">s_globalRandom</a>)
            {
                <a href="#0e00df5a124229fc" class="i field">_random</a> = <b>new</b> <span class="i">Random</span>(<a href="#596d93930ce4d7b2" class="i field">s_globalRandom</a>.<span class="i">Next</span>());
            }
 
            <a href="#f8c50e31c5fb6be7" class="i field">_jobSpecificCustomOptions</a> = <b>new</b> <span class="i">Lazy</span>&lt;<a href="cimOperationOptionsHelper.cs.html#91e3203f276040c6" class="t t">CimCustomOptionsDictionary</a>&gt;(<a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">CalculateJobSpecificCustomOptions</span>);
        }
 
        <b>private readonly</b> <a href="cimConverter.cs.html#437d822c62e693b7" class="t t">CimSensitiveValueConverter</a> <a id="df1329494175a5dc" href="../../../R/df1329494175a5dc.html" target="n" data-glyph="46,1" class="i field">_cimSensitiveValueConverter</a> = <b>new</b>();
 
        <b>internal</b> <a href="cimConverter.cs.html#437d822c62e693b7" class="t t">CimSensitiveValueConverter</a> <a id="fae9146855fcda4f" href="../../../R/fae9146855fcda4f.html" target="n" data-glyph="104,1" class="i property">CimSensitiveValueConverter</a> { <b>get</b> { <b>return</b> <a href="#df1329494175a5dc" class="i field">_cimSensitiveValueConverter</a>; } }
 
        <b>internal abstract</b> <span class="i">IObservable</span>&lt;<span class="r0 r t">T</span>&gt; <a id="877469ca99a24fcb" href="../../../R/877469ca99a24fcb.html" target="n" data-glyph="74,1" class="i method">GetCimOperation</a>();
 
        <b>public abstract void</b> <a id="a47265f05bd84c67" href="../../../R/a47265f05bd84c67.html" target="n" data-glyph="72,1" class="i method">OnNext</a>(<span class="r0 r t">T</span> <span id="r2 rd" class="r2 r">item</span>);
 
        <span class="c">// copied from sdpublic\sdk\inc\wsmerror.h</span>
        <b>private enum</b> <a id="28228963f7691659" href="../../../R/28228963f7691659.html" target="n" data-glyph="22,1" class="t t"><span id="5cab78d45159696d">WsManErrorCode</span></a> : <b>uint</b>
        {
            <a id="ca37bf37e65a473e" href="../../../R/ca37bf37e65a473e.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_SHELLS</a> = 0x803381A5,
            <a id="a503f8c22c0594a7" href="../../../R/a503f8c22c0594a7.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_OPERATIONS</a> = 0x803381A6,
            <a id="90fa489e60095dc8" href="../../../R/90fa489e60095dc8.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_USER</a> = 0x803381A7,
            <a id="158e48be3aba5147" href="../../../R/158e48be3aba5147.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_SYSTEM</a> = 0x803381A8,
            <a id="4a010318a78200ae" href="../../../R/4a010318a78200ae.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_SHELLUSERS</a> = 0x803381AB,
            <a id="d4c4c76c112ea625" href="../../../R/d4c4c76c112ea625.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_SHELLS_PPQ</a> = 0x803381E4,
            <a id="0d69a50a2fa603c4" href="../../../R/0d69a50a2fa603c4.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_USERS_PPQ</a> = 0x803381E5,
            <a id="8e1318738d0555c4" href="../../../R/8e1318738d0555c4.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_PLUGINSHELLS_PPQ</a> = 0x803381E6,
            <a id="ec260a9bf24699c6" href="../../../R/ec260a9bf24699c6.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_PLUGINOPERATIONS_PPQ</a> = 0x803381E7,
            <a id="d0f131f57f62ae14" href="../../../R/d0f131f57f62ae14.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_OPERATIONS_USER_PPQ</a> = 0x803381E8,
            <a id="25c92c0f56ce11a8" href="../../../R/25c92c0f56ce11a8.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MAX_COMMANDS_PER_SHELL_PPQ</a> = 0x803381E9,
            <a id="e2752eaeb40887e2" href="../../../R/e2752eaeb40887e2.html" target="n" data-glyph="24,2" class="i field">ERROR_WSMAN_QUOTA_MIN_REQUIREMENT_NOT_AVAILABLE_PPQ</a> = 0x803381EA,
        }
 
        <b>private static bool</b> <a id="29d7b90ae86085c6" href="../../../R/29d7b90ae86085c6.html" target="n" data-glyph="76,1" class="i method">IsWsManQuotaReached</a>(<span class="i">Exception</span> <span id="r3 rd" class="r3 r">exception</span>)
        {
            <b>if</b> (!(<span class="r3 r">exception</span> <b>is</b> <span class="i">CimException</span> <span id="r4 rd" class="r4 r">cimException</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<span class="r4 r">cimException</span>.<span class="i">NativeErrorCode</span> != <span class="i">NativeErrorCode</span>.<span class="i">ServerLimitsExceeded</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="i">CimInstance</span> <span id="r5 rd" class="r5 r">cimError</span> = <span class="r4 r">cimException</span>.<span class="i">ErrorData</span>;
            <b>if</b> (<span class="r5 r">cimError</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="i">CimProperty</span> <span id="r6 rd" class="r6 r">errorCodeProperty</span> = <span class="r5 r">cimError</span>.<span class="i">CimInstanceProperties</span>[<span class="s">&quot;error_Code&quot;</span>];
            <b>if</b> (<span class="r6 r">errorCodeProperty</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<span class="r6 r">errorCodeProperty</span>.<span class="i">CimType</span> != <span class="i">CimType</span>.<span class="i">UInt32</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <a href="#28228963f7691659" class="t t">WsManErrorCode</a> <span id="r7 rd" class="r7 r">wsManErrorCode</span> = (<a href="#28228963f7691659" class="t t">WsManErrorCode</a>)(<b>uint</b>)(<span class="r6 r">errorCodeProperty</span>.<span class="i">Value</span>);
            <b>switch</b> (<span class="r7 r">wsManErrorCode</span>) <span class="c">// error codes that should result in sleep-and-retry are based on an email from Ryan</span>
            {
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#ca37bf37e65a473e" class="i field">ERROR_WSMAN_QUOTA_MAX_SHELLS</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#a503f8c22c0594a7" class="i field">ERROR_WSMAN_QUOTA_MAX_OPERATIONS</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#90fa489e60095dc8" class="i field">ERROR_WSMAN_QUOTA_USER</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#158e48be3aba5147" class="i field">ERROR_WSMAN_QUOTA_SYSTEM</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#4a010318a78200ae" class="i field">ERROR_WSMAN_QUOTA_MAX_SHELLUSERS</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#d4c4c76c112ea625" class="i field">ERROR_WSMAN_QUOTA_MAX_SHELLS_PPQ</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#0d69a50a2fa603c4" class="i field">ERROR_WSMAN_QUOTA_MAX_USERS_PPQ</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#8e1318738d0555c4" class="i field">ERROR_WSMAN_QUOTA_MAX_PLUGINSHELLS_PPQ</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#ec260a9bf24699c6" class="i field">ERROR_WSMAN_QUOTA_MAX_PLUGINOPERATIONS_PPQ</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#d0f131f57f62ae14" class="i field">ERROR_WSMAN_QUOTA_MAX_OPERATIONS_USER_PPQ</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#25c92c0f56ce11a8" class="i field">ERROR_WSMAN_QUOTA_MAX_COMMANDS_PER_SHELL_PPQ</a>:
                <b>case</b> <a href="#28228963f7691659" class="t t">WsManErrorCode</a>.<a href="#e2752eaeb40887e2" class="i field">ERROR_WSMAN_QUOTA_MIN_REQUIREMENT_NOT_AVAILABLE_PPQ</a>:
                    <b>return</b> <b>true</b>;
 
                <b>default</b>:
                    <b>return</b> <b>false</b>;
            }
        }
 
        <b>public virtual void</b> <a id="9acdb758a6ce86cb" href="../../../R/9acdb758a6ce86cb.html" target="n" data-glyph="72,1" class="i method">OnError</a>(<span class="i">Exception</span> <span id="r8 rd" class="r8 r">exception</span>)
        {
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                    <b>delegate</b>
                    {
                        <b>if</b> (<a href="#29d7b90ae86085c6" class="i method">IsWsManQuotaReached</a>(<span class="r8 r">exception</span>))
                        {
                            <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#4f6e824e53600216" class="i method">SleepAndRetry</a>();
                            <b>return</b>;
                        }
 
                        <a href="CimJobException.cs.html#c2c8afcb7779a576" class="k">var</a> <span id="r9 rd" class="r9 r">cje</span> = <a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a>.<a href="CimJobException.cs.html#6aa8a66a9606d31d" class="i method">CreateFromAnyException</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#efec0a82aca28305" class="i method">GetDescription</a>(), <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>, <span class="r8 r">exception</span>);
                        <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ReportJobFailure</span>(<span class="r9 r">cje</span>);
                    });
        }
 
        <b>public virtual void</b> <a id="ade0d693edb3af42" href="../../../R/ade0d693edb3af42.html" target="n" data-glyph="72,1" class="i method">OnCompleted</a>()
        {
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                    <b>delegate</b>
                    {
                        <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Completed</span>, <b>null</b>);
                    });
        }
 
        <b>private static readonly</b> <span class="i">Random</span> <a id="596d93930ce4d7b2" href="../../../R/596d93930ce4d7b2.html" target="n" data-glyph="46,1" class="i field">s_globalRandom</a> = <b>new</b>();
        <b>private readonly</b> <span class="i">Random</span> <a id="0e00df5a124229fc" href="../../../R/0e00df5a124229fc.html" target="n" data-glyph="46,1" class="i field">_random</a>;
        <b>private int</b> <a id="e529917ef6c9bd56" href="../../../R/e529917ef6c9bd56.html" target="n" data-glyph="46,1" class="i field">_sleepAndRetryDelayRangeMs</a> = 1000;
        <b>private int</b> <a id="2d801e41dbf1e9b6" href="../../../R/2d801e41dbf1e9b6.html" target="n" data-glyph="46,1" class="i field">_sleepAndRetryExtraDelayMs</a> = 0;
 
        <b>private const int</b> <a id="932119b9783ba46e" href="../../../R/932119b9783ba46e.html" target="n" data-glyph="10,1" class="i field">MaxRetryDelayMs</a> = 15 * 1000;
        <b>private const int</b> <a id="a65164980b0975b1" href="../../../R/a65164980b0975b1.html" target="n" data-glyph="10,1" class="i field">MinRetryDelayMs</a> = 100;
 
        <b>private</b> <span class="i">Timer</span> <a id="52a4cca0046f04ec" href="../../../R/52a4cca0046f04ec.html" target="n" data-glyph="46,1" class="i field">_sleepAndRetryTimer</a>;
 
        <b>private void</b> <a id="eedef46568005e81" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SleepAndRetry_OnWakeup</a>(<b>object</b> <span id="r10 rd" class="r10 r">state</span>)
        {
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                    <b>delegate</b>
                    {
                        <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
                        {
                            <b>if</b> (<a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a> != <b>null</b>)
                            {
                                <a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a>.<span class="i">Dispose</span>();
                                <a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a> = <b>null</b>;
                            }
 
                            <b>if</b> (<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a>)
                            {
                                <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Stopped</span>, <b>null</b>);
                                <b>return</b>;
                            }
                        }
 
                        <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#a16d7637517f7937" class="i method">StartJob</a>();
                    });
        }
 
        <b>private void</b> <a id="4f6e824e53600216" href="../../../R/4f6e824e53600216.html" target="n" data-glyph="76,1" class="i method">SleepAndRetry</a>()
        {
            <b>int</b> <span id="r11 rd" class="r11 r">tmpRandomDelay</span> = <a href="#0e00df5a124229fc" class="i field">_random</a>.<span class="i">Next</span>(0, <a href="#e529917ef6c9bd56" class="i field">_sleepAndRetryDelayRangeMs</a>);
            <b>int</b> <span id="r12 rd" class="r12 r">delay</span> = <a href="#a65164980b0975b1" class="i field">MinRetryDelayMs</a> + <a href="#2d801e41dbf1e9b6" class="i field">_sleepAndRetryExtraDelayMs</a> + <span class="r11 r">tmpRandomDelay</span>;
            <a href="#2d801e41dbf1e9b6" class="i field">_sleepAndRetryExtraDelayMs</a> = <a href="#e529917ef6c9bd56" class="i field">_sleepAndRetryDelayRangeMs</a> - <span class="r11 r">tmpRandomDelay</span>;
            <b>if</b> (<a href="#e529917ef6c9bd56" class="i field">_sleepAndRetryDelayRangeMs</a> &lt; <a href="#932119b9783ba46e" class="i field">MaxRetryDelayMs</a>)
            {
                <a href="#e529917ef6c9bd56" class="i field">_sleepAndRetryDelayRangeMs</a> *= 2;
            }
 
            <b>string</b> <span id="r13 rd" class="r13 r">verboseMessage</span> = <b>string</b>.<span class="i">Format</span>(
                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="i">CmdletizationResources</span>.<span class="i">CimJob_SleepAndRetryVerboseMessage</span>,
                <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#33605f3ca7413312" class="i property">CmdletInvocationInfo</a>.<span class="i">InvocationName</span>,
                <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>.<span class="i">ComputerName</span> ?? <span class="s">&quot;localhost&quot;</span>,
                <span class="r12 r">delay</span> / 1000.0);
            <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#cfab0de33ac8b94c" class="i method">WriteVerbose</a>(<span class="r13 r">verboseMessage</span>);
 
            <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
            {
                <b>if</b> (<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a>)
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Stopped</span>, <b>null</b>);
                }
                <b>else</b>
                {
                    <span class="i">Dbg</span>.<span class="i">Assert</span>(<a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a> == <b>null</b>, <span class="s">&quot;There should be only 1 active _sleepAndRetryTimer&quot;</span>);
                    <a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a> = <b>new</b> <span class="i">Timer</span>(
                        <span class="i">state</span>: <b>null</b>,
                        <span class="i">dueTime</span>: <span class="r12 r">delay</span>,
                        <span class="i">period</span>: <span class="i">Timeout</span>.<span class="i">Infinite</span>,
                        <span class="i">callback</span>: <span class="i">SleepAndRetry_OnWakeup</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicates a location where this job is running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override string</b> <a id="4a9594897342b841" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Location</a>
        {
            <b>get</b>
            {
                <span class="c">// this.JobContext is set in the constructor of CimChildJobBase,</span>
                <span class="c">// but the constructor of Job wants to access Location property</span>
                <span class="c">// before CimChildJobBase is fully initialized</span>
                <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a> == <b>null</b>)
                {
                    <b>return</b> <b>null</b>;
                }
 
                <b>string</b> <span id="r14 rd" class="r14 r">location</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>.<span class="i">ComputerName</span> ?? <span class="i">Environment</span>.<span class="i">MachineName</span>;
                <b>return</b> <span class="r14 r">location</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Status message associated with the Job.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override string</b> <a id="6984c0e894a368aa" href="../../../R/6984c0e894a368aa.html" target="n" data-glyph="102,1" class="i property">StatusMessage</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">JobStateInfo</span>.<span class="i">State</span>.<span class="i">ToString</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicates if job has more data available.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override bool</b> <a id="6dc5b383f6bfb56c" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">HasMoreData</a>
        {
            <b>get</b>
            {
                <b>return</b> (<span class="i">Results</span>.<span class="i">IsOpen</span> || <span class="i">Results</span>.<span class="i">Count</span> &gt; 0);
            }
        }
 
        <b>internal void</b> <a id="9c5c4fca81790e16" href="../../../R/9c5c4fca81790e16.html" target="n" data-glyph="74,1" class="i method">WriteVerboseStartOfCimOperation</a>()
        {
            <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#e858e19d81c459b8" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#9fb13c7074587b1e" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#d2a2c60719f8686f" class="i property">ClientSideWriteVerbose</a>)
            {
                <b>string</b> <span id="r15 rd" class="r15 r">verboseMessage</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                    <span class="i">CmdletizationResources</span>.<span class="i">CimJob_VerboseExecutionMessage</span>,
                    <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#efec0a82aca28305" class="i method">GetDescription</a>());
                <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#cfab0de33ac8b94c" class="i method">WriteVerbose</a>(<span class="r15 r">verboseMessage</span>);
            }
        }
 
        <b>internal override void</b> <a id="a16d7637517f7937" href="../../../R/a16d7637517f7937.html" target="n" data-glyph="74,1" class="i method">StartJob</a>()
        {
            <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
            {
                <b>if</b> (<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a>)
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Stopped</span>, <b>null</b>);
                    <b>return</b>;
                }
 
                <span class="i">Dbg</span>.<span class="i">Assert</span>(!<a href="#dff71d42c84245b7" class="i field">_alreadyReachedCompletedState</a>, <span class="s">&quot;Job shouldn&#39;t reach completed state, before ThrottlingJob has a chance to register for job-completed/failed events&quot;</span>);
 
                <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a> <span id="r16 rd" class="r16 r">tracker</span> = <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a>.<a href="TerminatingErrorTracker.cs.html#f621e583b378992b" class="i method">GetTracker</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#33605f3ca7413312" class="i property">CmdletInvocationInfo</a>);
                <b>if</b> (<span class="r16 r">tracker</span>.<a href="TerminatingErrorTracker.cs.html#3440dc4e92814b5e" class="i method">IsSessionTerminated</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>))
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Failed</span>, <b>new</b> <span class="i">OperationCanceledException</span>());
                    <b>return</b>;
                }
 
                <b>if</b> (!<a href="#8a41b086bed8b6ed" class="i field">_jobWasStarted</a>)
                {
                    <a href="#8a41b086bed8b6ed" class="i field">_jobWasStarted</a> = <b>true</b>;
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetJobState</span>(<span class="i">JobState</span>.<span class="i">Running</span>);
                }
            }
 
            <span class="c">// This invocation can block (i.e. by calling Job.ShouldProcess) and wait for pipeline thread to unblock it</span>
            <span class="c">// Therefore we have to do the invocation outside of the pipeline thread.</span>
            <span class="i">ThreadPool</span>.<span class="i">QueueUserWorkItem</span>(<b>delegate</b>
            {
                <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(<b>delegate</b>
                {
                    <span class="i">IObservable</span>&lt;<span class="r0 r t">T</span>&gt; <span id="r17 rd" class="r17 r">observable</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#877469ca99a24fcb" class="i method">GetCimOperation</a>();
                    <b>if</b> (<span class="r17 r">observable</span> != <b>null</b>)
                    {
                        <span class="r17 r">observable</span>.<span class="i">Subscribe</span>(<a href="#ce791a9f3445312b" class="k">this</a>);
                    }
                });
            });
        }
 
        <b>internal string</b> <a id="efec0a82aca28305" href="../../../R/efec0a82aca28305.html" target="n" data-glyph="74,1" class="i method">GetDescription</a>()
        {
            <b>try</b>
            {
                <b>return</b> <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#424d07f05ecb2795" class="i property">Description</a>;
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <b>return</b> <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#5364ca306cff6d2b" class="i property">FailSafeDescription</a>;
            }
        }
 
        <b>internal abstract string</b> <a id="424d07f05ecb2795" href="../../../R/424d07f05ecb2795.html" target="n" data-glyph="104,1" class="i property">Description</a> { <b>get</b>; }
 
        <b>internal abstract string</b> <a id="5364ca306cff6d2b" href="../../../R/5364ca306cff6d2b.html" target="n" data-glyph="104,1" class="i property">FailSafeDescription</a> { <b>get</b>; }
 
        <b>internal void</b> <a id="d5f119d560f2d6dd" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ExceptionSafeWrapper</a>(<span class="i">Action</span> <span id="r18 rd" class="r18 r">action</span>)
        {
            <b>try</b>
            {
                <b>try</b>
                {
                    <span class="i">Dbg</span>.<span class="i">Assert</span>(<span class="r18 r">action</span> != <b>null</b>, <span class="s">&quot;Caller should verify action != null&quot;</span>);
                    <span class="r18 r">action</span>();
                }
                <b>catch</b> (<a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a> <span id="r19 rd" class="r19 r">e</span>)
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ReportJobFailure</span>(<span class="r19 r">e</span>);
                }
                <b>catch</b> (<span class="i">PSInvalidCastException</span> <span id="r20 rd" class="r20 r">e</span>)
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ReportJobFailure</span>(<span class="r20 r">e</span>);
                }
                <b>catch</b> (<span class="i">CimException</span> <span id="r21 rd" class="r21 r">e</span>)
                {
                    <a href="CimJobException.cs.html#c2c8afcb7779a576" class="k">var</a> <span id="r22 rd" class="r22 r">cje</span> = <a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a>.<a href="CimJobException.cs.html#edc0eef038f0840d" class="i method">CreateFromCimException</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#efec0a82aca28305" class="i method">GetDescription</a>(), <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>, <span class="r21 r">e</span>);
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ReportJobFailure</span>(<span class="r22 r">cje</span>);
                }
                <b>catch</b> (<span class="i">PSInvalidOperationException</span>)
                {
                    <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
                    {
                        <b>bool</b> <span id="r23 rd" class="r23 r">everythingIsOk</span> = <b>false</b>;
                        <b>if</b> (<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a>)
                        {
                            <span class="r23 r">everythingIsOk</span> = <b>true</b>;
                        }
 
                        <b>if</b> (<a href="#dff71d42c84245b7" class="i field">_alreadyReachedCompletedState</a> &amp;&amp; <a href="#9495b46347935dd1" class="i field">_jobHadErrors</a>)
                        {
                            <span class="r23 r">everythingIsOk</span> = <b>true</b>;
                        }
 
                        <b>if</b> (!<span class="r23 r">everythingIsOk</span>)
                        {
                            <span class="i">Dbg</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;PSInvalidOperationException should only happen in certain job states&quot;</span>);
                            <b>throw</b>;
                        }
                    }
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r24 rd" class="r24 r">e</span>)
            {
                <a href="CimJobException.cs.html#c2c8afcb7779a576" class="k">var</a> <span id="r25 rd" class="r25 r">cje</span> = <a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a>.<a href="CimJobException.cs.html#6aa8a66a9606d31d" class="i method">CreateFromAnyException</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#efec0a82aca28305" class="i method">GetDescription</a>(), <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>, <span class="r24 r">e</span>);
                <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ReportJobFailure</span>(<span class="r25 r">cje</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Operation options
 
        <b>internal virtual string</b> <a id="fddf7a06fea575ff" href="../../../R/fddf7a06fea575ff.html" target="n" data-glyph="74,1" class="i method">GetProviderVersionExpectedByJob</a>()
        {
            <b>return</b> <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#e858e19d81c459b8" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#9fb13c7074587b1e" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#0c5219f9b4aa0185" class="i property">CmdletizationClassVersion</a>;
        }
 
        <b>internal</b> <span class="i">CimOperationOptions</span> <a id="a1809c7b58b66b79" href="../../../R/a1809c7b58b66b79.html" target="n" data-glyph="74,1" class="i method">CreateOperationOptions</a>()
        {
            <b>var</b> <span id="r26 rd" class="r26 r">operationOptions</span> = <b>new</b> <span class="i">CimOperationOptions</span>(<span class="i">mustUnderstand</span>: <b>false</b>)
            {
                <span class="i">CancellationToken</span> = <a href="#c5e9d7d1a44a7168" class="i field">_cancellationTokenSource</a>.<span class="i">Token</span>,
                <span class="i">WriteProgress</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">WriteProgressCallback</span>,
                <span class="i">WriteMessage</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">WriteMessageCallback</span>,
                <span class="i">WriteError</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">WriteErrorCallback</span>,
                <span class="i">PromptUser</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">PromptUserCallback</span>,
            };
 
            <span class="r26 r">operationOptions</span>.<span class="i">SetOption</span>(<span class="s">&quot;__MI_OPERATIONOPTIONS_IMPROVEDPERF_STREAMING&quot;</span>, 1);
 
            <span class="r26 r">operationOptions</span>.<span class="i">Flags</span> |= <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#e858e19d81c459b8" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#9fb13c7074587b1e" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#3e562a9abb2bc9f6" class="i property">SchemaConformanceLevel</a>;
 
            <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#e858e19d81c459b8" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#9fb13c7074587b1e" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#b6b065accb7204c8" class="i property">ResourceUri</a> != <b>null</b>)
            {
                <span class="r26 r">operationOptions</span>.<span class="i">ResourceUri</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#e858e19d81c459b8" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#9fb13c7074587b1e" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#b6b065accb7204c8" class="i property">ResourceUri</a>;
            }
 
            <b>if</b> ((
                  (<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#374e1001e8e8872b" class="i property">WarningActionPreference</a> == <span class="i">ActionPreference</span>.<span class="i">SilentlyContinue</span>) ||
                  (<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#374e1001e8e8872b" class="i property">WarningActionPreference</a> == <span class="i">ActionPreference</span>.<span class="i">Ignore</span>)
                ) &amp;&amp; (!<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#4bb7e64a9db6d3bf" class="i property">IsRunningInBackground</a>))
            {
                <span class="r26 r">operationOptions</span>.<span class="i">DisableChannel</span>((<b>uint</b>)<a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#b845caf9bac4c916" class="i field">Warning</a>);
            }
            <b>else</b>
            {
                <span class="r26 r">operationOptions</span>.<span class="i">EnableChannel</span>((<b>uint</b>)<a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#b845caf9bac4c916" class="i field">Warning</a>);
            }
 
            <b>if</b> ((
                  (<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#86c3cc5b69921d02" class="i property">VerboseActionPreference</a> == <span class="i">ActionPreference</span>.<span class="i">SilentlyContinue</span>) ||
                  (<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#86c3cc5b69921d02" class="i property">VerboseActionPreference</a> == <span class="i">ActionPreference</span>.<span class="i">Ignore</span>)
                ) &amp;&amp; (!<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#4bb7e64a9db6d3bf" class="i property">IsRunningInBackground</a>))
            {
                <span class="r26 r">operationOptions</span>.<span class="i">DisableChannel</span>((<b>uint</b>)<a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#12b97cd226aad274" class="i field">Verbose</a>);
            }
            <b>else</b>
            {
                <span class="r26 r">operationOptions</span>.<span class="i">EnableChannel</span>((<b>uint</b>)<a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#12b97cd226aad274" class="i field">Verbose</a>);
            }
 
            <b>if</b> ((
                  (<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#5a7e4e1d51e31ee8" class="i property">DebugActionPreference</a> == <span class="i">ActionPreference</span>.<span class="i">SilentlyContinue</span>) ||
                  (<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#5a7e4e1d51e31ee8" class="i property">DebugActionPreference</a> == <span class="i">ActionPreference</span>.<span class="i">Ignore</span>)
                ) &amp;&amp; (!<a href="#a55ec793fddec342" class="i field">_jobContext</a>.<a href="cimJobContext.cs.html#4bb7e64a9db6d3bf" class="i property">IsRunningInBackground</a>))
            {
                <span class="r26 r">operationOptions</span>.<span class="i">DisableChannel</span>((<b>uint</b>)<a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#795591a6ea44572d" class="i field">Debug</a>);
            }
            <b>else</b>
            {
                <span class="r26 r">operationOptions</span>.<span class="i">EnableChannel</span>((<b>uint</b>)<a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#795591a6ea44572d" class="i field">Debug</a>);
            }
 
            <b>switch</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#97029d0486e2308d" class="i property">ShouldProcessOptimization</a>)
            {
                <b>case</b> <span class="i">MshCommandRuntime</span>.<span class="i">ShouldProcessPossibleOptimization</span>.<span class="i">AutoNo_CanCallShouldProcessAsynchronously</span>:
                    <span class="r26 r">operationOptions</span>.<span class="i">SetPromptUserRegularMode</span>(<span class="i">CimCallbackMode</span>.<span class="i">Report</span>, <span class="i">automaticConfirmation</span>: <b>false</b>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">MshCommandRuntime</span>.<span class="i">ShouldProcessPossibleOptimization</span>.<span class="i">AutoYes_CanCallShouldProcessAsynchronously</span>:
                    <span class="r26 r">operationOptions</span>.<span class="i">SetPromptUserRegularMode</span>(<span class="i">CimCallbackMode</span>.<span class="i">Report</span>, <span class="i">automaticConfirmation</span>: <b>true</b>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">MshCommandRuntime</span>.<span class="i">ShouldProcessPossibleOptimization</span>.<span class="i">AutoYes_CanSkipShouldProcessCall</span>:
                    <span class="r26 r">operationOptions</span>.<span class="i">SetPromptUserRegularMode</span>(<span class="i">CimCallbackMode</span>.<span class="i">Ignore</span>, <span class="i">automaticConfirmation</span>: <b>true</b>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">MshCommandRuntime</span>.<span class="i">ShouldProcessPossibleOptimization</span>.<span class="i">NoOptimizationPossible</span>:
                <b>default</b>:
                    <span class="r26 r">operationOptions</span>.<span class="i">PromptUserMode</span> = <span class="i">CimCallbackMode</span>.<span class="i">Inquire</span>;
                    <b>break</b>;
            }
 
            <b>switch</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#84140335edeb4f8e" class="i property">ErrorActionPreference</a>)
            {
                <b>case</b> <span class="i">ActionPreference</span>.<span class="i">Continue</span>:
                <b>case</b> <span class="i">ActionPreference</span>.<span class="i">SilentlyContinue</span>:
                <b>case</b> <span class="i">ActionPreference</span>.<span class="i">Ignore</span>:
                    <span class="r26 r">operationOptions</span>.<span class="i">WriteErrorMode</span> = <span class="i">CimCallbackMode</span>.<span class="i">Report</span>;
                    <b>break</b>;
 
                <b>case</b> <span class="i">ActionPreference</span>.<span class="i">Stop</span>:
                <b>case</b> <span class="i">ActionPreference</span>.<span class="i">Inquire</span>:
                <b>default</b>:
                    <span class="r26 r">operationOptions</span>.<span class="i">WriteErrorMode</span> = <span class="i">CimCallbackMode</span>.<span class="i">Inquire</span>;
                    <b>break</b>;
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#fddf7a06fea575ff" class="i method">GetProviderVersionExpectedByJob</a>()))
            {
                <a href="cimOperationOptionsHelper.cs.html#c81f4fd16d7e5925" class="t t">CimOperationOptionsHelper</a>.<a href="cimOperationOptionsHelper.cs.html#8d97b25fe0769392" class="i method">SetCustomOption</a>(
                    <span class="r26 r">operationOptions</span>,
                    <span class="s">&quot;MI_OPERATIONOPTIONS_PROVIDERVERSION&quot;</span>,
                    <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#fddf7a06fea575ff" class="i method">GetProviderVersionExpectedByJob</a>(),
                    <a href="#fae9146855fcda4f" class="i property">CimSensitiveValueConverter</a>);
            }
 
            <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#390961b5de879ea5" class="i property">CmdletizationModuleVersion</a> != <b>null</b>)
            {
                <a href="cimOperationOptionsHelper.cs.html#c81f4fd16d7e5925" class="t t">CimOperationOptionsHelper</a>.<span class="i">SetCustomOption</span>(
                    <span class="r26 r">operationOptions</span>,
                    <span class="s">&quot;MI_OPERATIONOPTIONS_POWERSHELL_MODULEVERSION&quot;</span>,
                    <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#390961b5de879ea5" class="i property">CmdletizationModuleVersion</a>,
                    <a href="#fae9146855fcda4f" class="i property">CimSensitiveValueConverter</a>);
            }
 
            <a href="cimOperationOptionsHelper.cs.html#c81f4fd16d7e5925" class="t t">CimOperationOptionsHelper</a>.<span class="i">SetCustomOption</span>(
                <span class="r26 r">operationOptions</span>,
                <span class="s">&quot;MI_OPERATIONOPTIONS_POWERSHELL_CMDLETNAME&quot;</span>,
                <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#33605f3ca7413312" class="i property">CmdletInvocationInfo</a>.<span class="i">MyCommand</span>.<span class="i">Name</span>,
                <a href="#fae9146855fcda4f" class="i property">CimSensitiveValueConverter</a>);
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>.<span class="i">ComputerName</span>))
            {
                <a href="cimOperationOptionsHelper.cs.html#c81f4fd16d7e5925" class="t t">CimOperationOptionsHelper</a>.<span class="i">SetCustomOption</span>(
                    <span class="r26 r">operationOptions</span>,
                    <span class="s">&quot;MI_OPERATIONOPTIONS_POWERSHELL_COMPUTERNAME&quot;</span>,
                    <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>.<span class="i">ComputerName</span>,
                    <a href="#fae9146855fcda4f" class="i property">CimSensitiveValueConverter</a>);
            }
 
            <a href="cimOperationOptionsHelper.cs.html#91e3203f276040c6" class="t t">CimCustomOptionsDictionary</a> <span id="r27 rd" class="r27 r">jobSpecificCustomOptions</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#9fc9cdd2400bb3ec" class="i method">GetJobSpecificCustomOptions</a>();
            <b>if</b> (<span class="r27 r">jobSpecificCustomOptions</span> != <b>null</b>)
            {
                <span class="r27 r">jobSpecificCustomOptions</span>.<a href="cimOperationOptionsHelper.cs.html#55ece7f8fe8c7a6a" class="i method">Apply</a>(<span class="r26 r">operationOptions</span>, <a href="#fae9146855fcda4f" class="i property">CimSensitiveValueConverter</a>);
            }
 
            <b>return</b> <span class="r26 r">operationOptions</span>;
        }
 
        <b>private readonly</b> <span class="i">Lazy</span>&lt;<a href="cimOperationOptionsHelper.cs.html#91e3203f276040c6" class="t t">CimCustomOptionsDictionary</a>&gt; <a id="f8c50e31c5fb6be7" href="../../../R/f8c50e31c5fb6be7.html" target="n" data-glyph="46,1" class="i field">_jobSpecificCustomOptions</a>;
 
        <b>internal abstract</b> <a href="cimOperationOptionsHelper.cs.html#91e3203f276040c6" class="t t">CimCustomOptionsDictionary</a> <a id="36c9c23ff6710b8c" href="../../../R/36c9c23ff6710b8c.html" target="n" data-glyph="74,1" class="i method">CalculateJobSpecificCustomOptions</a>();
 
        <b>private</b> <a href="cimOperationOptionsHelper.cs.html#91e3203f276040c6" class="t t">CimCustomOptionsDictionary</a> <a id="9fc9cdd2400bb3ec" href="../../../R/9fc9cdd2400bb3ec.html" target="n" data-glyph="76,1" class="i method">GetJobSpecificCustomOptions</a>()
        {
            <b>return</b> <a href="#f8c50e31c5fb6be7" class="i field">_jobSpecificCustomOptions</a>.<span class="i">Value</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Controlling job state
 
        <b>private readonly</b> <span class="i">CancellationTokenSource</span> <a id="c5e9d7d1a44a7168" href="../../../R/c5e9d7d1a44a7168.html" target="n" data-glyph="46,1" class="i field">_cancellationTokenSource</a> = <b>new</b>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stops this job.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="177d10f6c36135e4" href="../../../R/177d10f6c36135e4.html" target="n" data-glyph="72,1" class="i method">StopJob</a>()
        {
            <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
            {
                <b>if</b> (<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a> || <a href="#dff71d42c84245b7" class="i field">_alreadyReachedCompletedState</a>)
                {
                    <b>return</b>;
                }
 
                <a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a> = <b>true</b>;
 
                <b>if</b> (!<a href="#8a41b086bed8b6ed" class="i field">_jobWasStarted</a>)
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Stopped</span>, <b>null</b>);
                }
                <b>else</b> <b>if</b> (<a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a> != <b>null</b>)
                {
                    <a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a>.<span class="i">Dispose</span>();
                    <a href="#52a4cca0046f04ec" class="i field">_sleepAndRetryTimer</a> = <b>null</b>;
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Stopped</span>, <b>null</b>);
                }
                <b>else</b>
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetJobState</span>(<span class="i">JobState</span>.<span class="i">Stopping</span>);
                }
            }
 
            <a href="#c5e9d7d1a44a7168" class="i field">_cancellationTokenSource</a>.<span class="i">Cancel</span>();
        }
 
        <b>private readonly object</b> <a id="192fe17149c28655" href="../../../R/192fe17149c28655.html" target="n" data-glyph="46,1" class="i field">_jobStateLock</a> = <b>new</b>();
        <b>private bool</b> <a id="9495b46347935dd1" href="../../../R/9495b46347935dd1.html" target="n" data-glyph="46,1" class="i field">_jobHadErrors</a>;
        <b>private bool</b> <a id="8a41b086bed8b6ed" href="../../../R/8a41b086bed8b6ed.html" target="n" data-glyph="46,1" class="i field">_jobWasStarted</a>;
        <b>private bool</b> <a id="0e3b502ec82b82b8" href="../../../R/0e3b502ec82b82b8.html" target="n" data-glyph="46,1" class="i field">_jobWasStopped</a>;
        <b>private bool</b> <a id="dff71d42c84245b7" href="../../../R/dff71d42c84245b7.html" target="n" data-glyph="46,1" class="i field">_alreadyReachedCompletedState</a>;
 
        <b>internal bool</b> <a id="050c546f5906f68d" href="../../../R/050c546f5906f68d.html" target="n" data-glyph="104,1" class="i property">JobHadErrors</a>
        {
            <b>get</b>
            {
                <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
                {
                    <b>return</b> <a href="#9495b46347935dd1" class="i field">_jobHadErrors</a>;
                }
            }
        }
 
        <b>internal void</b> <a id="521f8e81b59507c7" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ReportJobFailure</a>(<span class="i">IContainsErrorRecord</span> <span id="r28 rd" class="r28 r">exception</span>)
        {
            <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a> <span id="r29 rd" class="r29 r">terminatingErrorTracker</span> = <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a>.<a href="TerminatingErrorTracker.cs.html#f621e583b378992b" class="i method">GetTracker</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#33605f3ca7413312" class="i property">CmdletInvocationInfo</a>);
 
            <b>bool</b> <span id="r30 rd" class="r30 r">sessionWasAlreadyTerminated</span> = <b>false</b>;
            <b>bool</b> <span id="r31 rd" class="r31 r">isThisTerminatingError</span> = <b>false</b>;
            <span class="i">Exception</span> <span id="r32 rd" class="r32 r">brokenSessionException</span> = <b>null</b>;
            <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
            {
                <b>if</b> (!<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a>)
                {
                    <span class="r32 r">brokenSessionException</span> = <span class="r29 r">terminatingErrorTracker</span>.<a href="TerminatingErrorTracker.cs.html#22d02057d4cecd8d" class="i method">GetExceptionIfBrokenSession</a>(
                        <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>,
                        <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#e858e19d81c459b8" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#9fb13c7074587b1e" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#9aa7dc15f09e4e8a" class="i property">SkipTestConnection</a>,
                        <b>out</b> <span class="r30 r">sessionWasAlreadyTerminated</span>);
                }
            }
 
            <b>if</b> (<span class="r32 r">brokenSessionException</span> != <b>null</b>)
            {
                <b>string</b> <span id="r33 rd" class="r33 r">brokenSessionMessage</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">CmdletizationResources</span>.<span class="i">CimJob_BrokenSession</span>,
                    <span class="r32 r">brokenSessionException</span>.<span class="i">Message</span>);
                <span class="r28 r">exception</span> = <a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a>.<span class="i">CreateWithFullControl</span>(
                    <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>,
                    <span class="r33 r">brokenSessionMessage</span>,
                    <span class="s">&quot;CimJob_BrokenCimSession&quot;</span>,
                    <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                    <span class="r32 r">brokenSessionException</span>);
                <span class="r31 r">isThisTerminatingError</span> = <b>true</b>;
            }
            <b>else</b>
            {
                <a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a> <span id="r34 rd" class="r34 r">cje</span> = <span class="r28 r">exception</span> <b>as</b> <a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a>;
                <b>if</b> ((<span class="r34 r">cje</span> != <b>null</b>) &amp;&amp; (<span class="r34 r">cje</span>.<a href="CimJobException.cs.html#68356edbd0f426b6" class="i property">IsTerminatingError</a>))
                {
                    <span class="r29 r">terminatingErrorTracker</span>.<a href="TerminatingErrorTracker.cs.html#9e2ae9e449c2b99d" class="i method">MarkSessionAsTerminated</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>, <b>out</b> <span class="r30 r">sessionWasAlreadyTerminated</span>);
                    <span class="r31 r">isThisTerminatingError</span> = <b>true</b>;
                }
            }
 
            <b>bool</b> <span id="r35 rd" class="r35 r">writeError</span> = !<span class="r30 r">sessionWasAlreadyTerminated</span>;
            <b>if</b> (<span class="r35 r">writeError</span>)
            {
                <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
                {
                    <b>if</b> (<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a>)
                    {
                        <span class="r35 r">writeError</span> = <b>false</b>;
                    }
                }
            }
 
            <span class="i">ErrorRecord</span> <span id="r36 rd" class="r36 r">errorRecord</span> = <span class="r28 r">exception</span>.<span class="i">ErrorRecord</span>;
            <span class="r36 r">errorRecord</span>.<span class="i">SetInvocationInfo</span>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#33605f3ca7413312" class="i property">CmdletInvocationInfo</a>);
            <span class="r36 r">errorRecord</span>.<span class="i">PreserveInvocationInfoOnce</span> = <b>true</b>;
 
            <b>if</b> (<span class="r35 r">writeError</span>)
            {
                <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
                {
                    <b>if</b> (!<a href="#dff71d42c84245b7" class="i field">_alreadyReachedCompletedState</a>)
                    {
                        <b>if</b> (<span class="r31 r">isThisTerminatingError</span>)
                        {
                            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">Error</span>.<span class="i">Add</span>(<span class="r36 r">errorRecord</span>);
                            <span class="i">CmdletMethodInvoker</span>&lt;<b>bool</b>&gt; <span id="r37 rd" class="r37 r">methodInvoker</span> = <span class="r29 r">terminatingErrorTracker</span>.<a href="TerminatingErrorTracker.cs.html#3df537e146e80e8e" class="i method">GetErrorReportingDelegate</a>(<span class="r36 r">errorRecord</span>);
                            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">Results</span>.<span class="i">Add</span>(<b>new</b> <span class="i">PSStreamObject</span>(<span class="i">PSStreamObjectType</span>.<span class="i">ShouldMethod</span>, <span class="r37 r">methodInvoker</span>));
                        }
                        <b>else</b>
                        {
                            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">WriteError</span>(<span class="r36 r">errorRecord</span>);
                        }
                    }
                }
            }
 
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetCompletedJobState</span>(<span class="i">JobState</span>.<span class="i">Failed</span>, <span class="r36 r">errorRecord</span>.<span class="i">Exception</span>);
        }
 
        <b>internal override void</b> <a id="5213e236d431a966" href="../../../R/5213e236d431a966.html" target="n" data-glyph="74,1" class="i method">WriteWarning</a>(<b>string</b> <span id="r38 rd" class="r38 r">message</span>)
        {
            <span class="r38 r">message</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f2bc7a2cf386cb46" class="i method">PrependComputerNameToMessage</a>(<span class="r38 r">message</span>);
            <b>base</b>.<span class="i">WriteWarning</span>(<span class="r38 r">message</span>);
        }
 
        <b>internal override void</b> <a id="cfab0de33ac8b94c" href="../../../R/cfab0de33ac8b94c.html" target="n" data-glyph="74,1" class="i method">WriteVerbose</a>(<b>string</b> <span id="r39 rd" class="r39 r">message</span>)
        {
            <span class="r39 r">message</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f2bc7a2cf386cb46" class="i method">PrependComputerNameToMessage</a>(<span class="r39 r">message</span>);
            <b>base</b>.<span class="i">WriteVerbose</span>(<span class="r39 r">message</span>);
        }
 
        <b>internal override void</b> <a id="6d60826308ea15b5" href="../../../R/6d60826308ea15b5.html" target="n" data-glyph="74,1" class="i method">WriteDebug</a>(<b>string</b> <span id="r40 rd" class="r40 r">message</span>)
        {
            <span class="r40 r">message</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f2bc7a2cf386cb46" class="i method">PrependComputerNameToMessage</a>(<span class="r40 r">message</span>);
            <b>base</b>.<span class="i">WriteDebug</span>(<span class="r40 r">message</span>);
        }
 
        <b>internal void</b> <a id="b71747c544d28514" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetCompletedJobState</a>(<span class="i">JobState</span> <span id="r41 rd" class="r41 r">state</span>, <span class="i">Exception</span> <span id="r42 rd" class="r42 r">reason</span>)
        {
            <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
            {
                <b>if</b> (<a href="#dff71d42c84245b7" class="i field">_alreadyReachedCompletedState</a>)
                {
                    <b>return</b>;
                }
 
                <a href="#dff71d42c84245b7" class="i field">_alreadyReachedCompletedState</a> = <b>true</b>;
 
                <b>if</b> ((<span class="r41 r">state</span> == <span class="i">JobState</span>.<span class="i">Failed</span>) || (<span class="r42 r">reason</span> != <b>null</b>))
                {
                    <a href="#9495b46347935dd1" class="i field">_jobHadErrors</a> = <b>true</b>;
                }
 
                <b>if</b> (<a href="#0e3b502ec82b82b8" class="i field">_jobWasStopped</a>)
                {
                    <span class="r41 r">state</span> = <span class="i">JobState</span>.<span class="i">Stopped</span>;
                }
                <b>else</b> <b>if</b> (<a href="#9495b46347935dd1" class="i field">_jobHadErrors</a>)
                {
                    <span class="r41 r">state</span> = <span class="i">JobState</span>.<span class="i">Failed</span>;
                }
            }
 
            <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#5a1bf8868187a44a" class="i method">FinishProgressReporting</a>();
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">SetJobState</span>(<span class="r41 r">state</span>, <span class="r42 r">reason</span>);
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">CloseAllStreams</span>();
            <a href="#c5e9d7d1a44a7168" class="i field">_cancellationTokenSource</a>.<span class="i">Cancel</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Support for progress reporting
 
        <b>private readonly</b> <span class="i">ConcurrentDictionary</span>&lt;<b>int</b>, <span class="i">ProgressRecord</span>&gt; <a id="bef9e61d8ec04072" href="../../../R/bef9e61d8ec04072.html" target="n" data-glyph="46,1" class="i field">_activityIdToLastProgressRecord</a> = <b>new</b>();
 
        <b>internal override void</b> <a id="5ff5a4b6fe3cc7c4" href="../../../R/5ff5a4b6fe3cc7c4.html" target="n" data-glyph="74,1" class="i method">WriteProgress</a>(<span class="i">ProgressRecord</span> <span id="r43 rd" class="r43 r">progressRecord</span>)
        {
            <span class="r43 r">progressRecord</span>.<span class="i">Activity</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<span class="i">PrependComputerNameToMessage</span>(<span class="r43 r">progressRecord</span>.<span class="i">Activity</span>);
 
            <a href="#bef9e61d8ec04072" class="i field">_activityIdToLastProgressRecord</a>.<span class="i">AddOrUpdate</span>(
                <span class="r43 r">progressRecord</span>.<span class="i">ActivityId</span>,
                <span class="r43 r">progressRecord</span>,
                (<span id="r44 rd" class="r44 r">activityId</span>, <span id="r45 rd" class="r45 r">oldProgressRecord</span>) =&gt; <span class="r43 r">progressRecord</span>);
 
            <b>base</b>.<span class="i">WriteProgress</span>(<span class="r43 r">progressRecord</span>);
        }
 
        <b>internal void</b> <a id="5a1bf8868187a44a" href="../../../R/5a1bf8868187a44a.html" target="n" data-glyph="74,1" class="i method">FinishProgressReporting</a>()
        {
            <b>foreach</b> (<span class="i">ProgressRecord</span> <span id="r46 rd" class="r46 r">lastProgressRecord</span> <b>in</b> <a href="#bef9e61d8ec04072" class="i field">_activityIdToLastProgressRecord</a>.<span class="i">Values</span>)
            {
                <b>if</b> (<span class="r46 r">lastProgressRecord</span>.<span class="i">RecordType</span> != <span class="i">ProgressRecordType</span>.<span class="i">Completed</span>)
                {
                    <b>var</b> <span id="r47 rd" class="r47 r">newProgressRecord</span> = <b>new</b> <span class="i">ProgressRecord</span>(<span class="r46 r">lastProgressRecord</span>.<span class="i">ActivityId</span>, <span class="r46 r">lastProgressRecord</span>.<span class="i">Activity</span>, <span class="r46 r">lastProgressRecord</span>.<span class="i">StatusDescription</span>);
                    <span class="r47 r">newProgressRecord</span>.<span class="i">RecordType</span> = <span class="i">ProgressRecordType</span>.<span class="i">Completed</span>;
                    <span class="r47 r">newProgressRecord</span>.<span class="i">PercentComplete</span> = 100;
                    <span class="r47 r">newProgressRecord</span>.<span class="i">SecondsRemaining</span> = 0;
                    <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#5ff5a4b6fe3cc7c4" class="i method">WriteProgress</a>(<span class="r47 r">newProgressRecord</span>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Handling extended semantics callbacks
 
        <b>private void</b> <a id="ca4441f23575aa60" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">WriteProgressCallback</a>(<b>string</b> <span id="r48 rd" class="r48 r">activity</span>, <b>string</b> <span id="r49 rd" class="r49 r">currentOperation</span>, <b>string</b> <span id="r50 rd" class="r50 r">statusDescription</span>, <b>uint</b> <span id="r51 rd" class="r51 r">percentageCompleted</span>, <b>uint</b> <span id="r52 rd" class="r52 r">secondsRemaining</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r48 r">activity</span>))
            {
                <span class="r48 r">activity</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#efec0a82aca28305" class="i method">GetDescription</a>();
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r50 r">statusDescription</span>))
            {
                <span class="r50 r">statusDescription</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#6984c0e894a368aa" class="i property">StatusMessage</a>;
            }
 
            <b>int</b> <span id="r53 rd" class="r53 r">signedSecondsRemaining</span>;
            <b>if</b> (<span class="r52 r">secondsRemaining</span> == <b>uint</b>.<span class="i">MaxValue</span>)
            {
                <span class="r53 r">signedSecondsRemaining</span> = -1;
            }
            <b>else</b> <b>if</b> (<span class="r52 r">secondsRemaining</span> &lt;= <b>int</b>.<span class="i">MaxValue</span>)
            {
                <span class="r53 r">signedSecondsRemaining</span> = (<b>int</b>)<span class="r52 r">secondsRemaining</span>;
            }
            <b>else</b>
            {
                <span class="r53 r">signedSecondsRemaining</span> = <b>int</b>.<span class="i">MaxValue</span>;
            }
 
            <b>int</b> <span id="r54 rd" class="r54 r">signedPercentageComplete</span>;
            <b>if</b> (<span class="r51 r">percentageCompleted</span> == <b>uint</b>.<span class="i">MaxValue</span>)
            {
                <span class="r54 r">signedPercentageComplete</span> = -1;
            }
            <b>else</b> <b>if</b> (<span class="r51 r">percentageCompleted</span> &lt;= 100)
            {
                <span class="r54 r">signedPercentageComplete</span> = (<b>int</b>)<span class="r51 r">percentageCompleted</span>;
            }
            <b>else</b>
            {
                <span class="r54 r">signedPercentageComplete</span> = 100;
            }
 
            <b>var</b> <span id="r55 rd" class="r55 r">progressRecord</span> = <b>new</b> <span class="i">ProgressRecord</span>(<b>unchecked</b>((<b>int</b>)(<a href="#46ad1fc0a1edc11b" class="i field">_myJobNumber</a> % <b>int</b>.<span class="i">MaxValue</span>)), <span class="r48 r">activity</span>, <span class="r50 r">statusDescription</span>)
            {
                <span class="i">CurrentOperation</span> = <span class="r49 r">currentOperation</span>,
                <span class="i">PercentComplete</span> = <span class="r54 r">signedPercentageComplete</span>,
                <span class="i">SecondsRemaining</span> = <span class="r53 r">signedSecondsRemaining</span>,
                <span class="i">RecordType</span> = <span class="i">ProgressRecordType</span>.<span class="i">Processing</span>,
            };
 
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                    <b>delegate</b>
                    {
                        <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#5ff5a4b6fe3cc7c4" class="i method">WriteProgress</a>(<span class="r55 r">progressRecord</span>);
                    });
        }
 
        <b>private enum</b> <a id="04f1f45a8db18b70" href="../../../R/04f1f45a8db18b70.html" target="n" data-glyph="22,1" class="t t"><span id="9d617ac58520263f">MessageChannel</span></a>
        {
            <a id="b845caf9bac4c916" href="../../../R/b845caf9bac4c916.html" target="n" data-glyph="24,2" class="i field">Warning</a> = 0,
            <a id="12b97cd226aad274" href="../../../R/12b97cd226aad274.html" target="n" data-glyph="24,2" class="i field">Verbose</a> = 1,
            <a id="795591a6ea44572d" href="../../../R/795591a6ea44572d.html" target="n" data-glyph="24,2" class="i field">Debug</a> = 2,
        }
 
        <b>private void</b> <a id="045703ff7614a4f3" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">WriteMessageCallback</a>(<b>uint</b> <span id="r56 rd" class="r56 r">channel</span>, <b>string</b> <span id="r57 rd" class="r57 r">message</span>)
        {
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                    <b>delegate</b>
                    {
                        <b>switch</b> ((<a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>)<span class="r56 r">channel</span>)
                        {
                            <b>case</b> <a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#b845caf9bac4c916" class="i field">Warning</a>:
                                <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#5213e236d431a966" class="i method">WriteWarning</a>(<span class="r57 r">message</span>);
                                <b>break</b>;
 
                            <b>case</b> <a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#12b97cd226aad274" class="i field">Verbose</a>:
                                <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#cfab0de33ac8b94c" class="i method">WriteVerbose</a>(<span class="r57 r">message</span>);
                                <b>break</b>;
 
                            <b>case</b> <a href="#04f1f45a8db18b70" class="t t">MessageChannel</a>.<a href="#795591a6ea44572d" class="i field">Debug</a>:
                                <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#6d60826308ea15b5" class="i method">WriteDebug</a>(<span class="r57 r">message</span>);
                                <b>break</b>;
 
                            <b>default</b>:
                                <span class="i">Dbg</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;We shouldn&#39;t get messages in channels that we didn&#39;t register for&quot;</span>);
                                <b>break</b>;
                        }
                    });
        }
 
        <b>private</b> <span class="i">CimResponseType</span> <a id="cacc6fc0b0edbc15" href="../../../R/cacc6fc0b0edbc15.html" target="n" data-glyph="76,1" class="i method">BlockingWriteError</a>(<span class="i">ErrorRecord</span> <span id="r58 rd" class="r58 r">errorRecord</span>)
        {
            <span class="i">Exception</span> <span id="r59 rd" class="r59 r">exceptionThrownOnCmdletThread</span> = <b>null</b>;
            <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                    <b>delegate</b>
                    {
                        <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">WriteError</span>(<span class="r58 r">errorRecord</span>, <b>out</b> <span class="r59 r">exceptionThrownOnCmdletThread</span>);
                    });
 
            <b>return</b> (<span class="r59 r">exceptionThrownOnCmdletThread</span> != <b>null</b>)
                       ? <span class="i">CimResponseType</span>.<span class="i">NoToAll</span>
                       : <span class="i">CimResponseType</span>.<span class="i">Yes</span>;
        }
 
        <b>private</b> <span class="i">CimResponseType</span> <a id="d692a9beb8569b8e" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">WriteErrorCallback</a>(<span class="i">CimInstance</span> <span id="r60 rd" class="r60 r">cimError</span>)
        {
            <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
            {
                <a href="#9495b46347935dd1" class="i field">_jobHadErrors</a> = <b>true</b>;
            }
 
            <b>var</b> <span id="r61 rd" class="r61 r">cimException</span> = <b>new</b> <span class="i">CimException</span>(<span class="r60 r">cimError</span>);
            <a href="CimJobException.cs.html#c2c8afcb7779a576" class="k">var</a> <span id="r62 rd" class="r62 r">jobException</span> = <a href="CimJobException.cs.html#c2c8afcb7779a576" class="t t">CimJobException</a>.<a href="CimJobException.cs.html#edc0eef038f0840d" class="i method">CreateFromCimException</a>(<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#efec0a82aca28305" class="i method">GetDescription</a>(), <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>, <span class="r61 r">cimException</span>);
            <b>var</b> <span id="r63 rd" class="r63 r">errorRecord</span> = <span class="r62 r">jobException</span>.<a href="CimJobException.cs.html#a2782b9122065aed" class="i property">ErrorRecord</a>;
 
            <b>switch</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#84140335edeb4f8e" class="i property">ErrorActionPreference</a>)
            {
                <b>case</b> <span class="i">ActionPreference</span>.<span class="i">Stop</span>:
                <b>case</b> <span class="i">ActionPreference</span>.<span class="i">Inquire</span>:
                    <b>return</b> <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#cacc6fc0b0edbc15" class="i method">BlockingWriteError</a>(<span class="r63 r">errorRecord</span>);
 
                <b>default</b>:
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">WriteError</span>(<span class="r63 r">errorRecord</span>);
                    <b>return</b> <span class="i">CimResponseType</span>.<span class="i">Yes</span>;
            }
        }
 
        <b>private bool</b> <a id="9f7249eed591704d" href="../../../R/9f7249eed591704d.html" target="n" data-glyph="46,1" class="i field">_userWasPromptedForContinuationOfProcessing</a>;
        <b>private bool</b> <a id="d37f307918acd1da" href="../../../R/d37f307918acd1da.html" target="n" data-glyph="46,1" class="i field">_userRespondedYesToAtLeastOneShouldProcess</a>;
 
        <b>internal bool</b> <a id="8b7c73640570ee10" href="../../../R/8b7c73640570ee10.html" target="n" data-glyph="104,1" class="i property">DidUserSuppressTheOperation</a>
        {
            <b>get</b>
            {
                <b>bool</b> <span id="r64 rd" class="r64 r">didUserSuppressTheOperation</span> = <a href="#9f7249eed591704d" class="i field">_userWasPromptedForContinuationOfProcessing</a> &amp;&amp; (!<a href="#d37f307918acd1da" class="i field">_userRespondedYesToAtLeastOneShouldProcess</a>);
                <b>return</b> <span class="r64 r">didUserSuppressTheOperation</span>;
            }
        }
 
        <b>internal</b> <span class="i">CimResponseType</span> <a id="d7e36b4aea94695f" href="../../../R/d7e36b4aea94695f.html" target="n" data-glyph="74,1" class="i method">ShouldProcess</a>(<b>string</b> <span id="r65 rd" class="r65 r">target</span>, <b>string</b> <span id="r66 rd" class="r66 r">action</span>)
        {
            <b>string</b> <span id="r67 rd" class="r67 r">verboseDescription</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">CommandBaseStrings</span>.<span class="i">ShouldProcessMessage</span>,
                <span class="r66 r">action</span>,
                <span class="r65 r">target</span>,
                <b>null</b>);
 
            <b>return</b> <a href="#a6cab5e8d57b2325" class="i method">ShouldProcess</a>(<span class="r67 r">verboseDescription</span>, <b>null</b>, <b>null</b>);
        }
 
        <b>internal</b> <span class="i">CimResponseType</span> <a id="a6cab5e8d57b2325" href="../../../R/a6cab5e8d57b2325.html" target="n" data-glyph="74,1" class="i method">ShouldProcess</a>(
            <b>string</b> <span id="r68 rd" class="r68 r">verboseDescription</span>,
            <b>string</b> <span id="r69 rd" class="r69 r">verboseWarning</span>,
            <b>string</b> <span id="r70 rd" class="r70 r">caption</span>)
        {
            <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#4bb7e64a9db6d3bf" class="i property">IsRunningInBackground</a>)
            {
                <b>return</b> <span class="i">CimResponseType</span>.<span class="i">YesToAll</span>;
            }
 
            <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#97029d0486e2308d" class="i property">ShouldProcessOptimization</a> == <span class="i">MshCommandRuntime</span>.<span class="i">ShouldProcessPossibleOptimization</span>.<span class="i">AutoNo_CanCallShouldProcessAsynchronously</span>)
            {
                <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">NonblockingShouldProcess</span>(<span class="r68 r">verboseDescription</span>, <span class="r69 r">verboseWarning</span>, <span class="r70 r">caption</span>);
                <b>return</b> <span class="i">CimResponseType</span>.<span class="i">No</span>;
            }
 
            <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#97029d0486e2308d" class="i property">ShouldProcessOptimization</a> == <span class="i">MshCommandRuntime</span>.<span class="i">ShouldProcessPossibleOptimization</span>.<span class="i">AutoYes_CanCallShouldProcessAsynchronously</span>)
            {
                <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">NonblockingShouldProcess</span>(<span class="r68 r">verboseDescription</span>, <span class="r69 r">verboseWarning</span>, <span class="r70 r">caption</span>);
                <b>return</b> <span class="i">CimResponseType</span>.<span class="i">Yes</span>;
            }
 
            <span class="i">Dbg</span>.<span class="i">Assert</span>(
                (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#97029d0486e2308d" class="i property">ShouldProcessOptimization</a> != <span class="i">MshCommandRuntime</span>.<span class="i">ShouldProcessPossibleOptimization</span>.<span class="i">AutoYes_CanSkipShouldProcessCall</span>) ||
                (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#e858e19d81c459b8" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#9fb13c7074587b1e" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#5d7b6be62c47e28d" class="i property">ClientSideShouldProcess</a>),
                <span class="s">&quot;MI layer should not call us when AutoYes_CanSkipShouldProcessCall optimization is in effect&quot;</span>);
            <span class="i">Exception</span> <span id="r71 rd" class="r71 r">exceptionThrownOnCmdletThread</span>;
            <span class="i">ShouldProcessReason</span> <span id="r72 rd" class="r72 r">shouldProcessReason</span>;
            <b>bool</b> <span id="r73 rd" class="r73 r">shouldProcessResponse</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ShouldProcess</span>(<span class="r68 r">verboseDescription</span>, <span class="r69 r">verboseWarning</span>, <span class="r70 r">caption</span>, <b>out</b> <span class="r72 r">shouldProcessReason</span>, <b>out</b> <span class="r71 r">exceptionThrownOnCmdletThread</span>);
            <b>if</b> (<span class="r71 r">exceptionThrownOnCmdletThread</span> != <b>null</b>)
            {
                <b>return</b> <span class="i">CimResponseType</span>.<span class="i">NoToAll</span>;
            }
            <b>else</b> <b>if</b> (<span class="r73 r">shouldProcessResponse</span>)
            {
                <b>return</b> <span class="i">CimResponseType</span>.<span class="i">Yes</span>;
            }
            <b>else</b>
            {
                <b>return</b> <span class="i">CimResponseType</span>.<span class="i">No</span>;
            }
        }
 
        <b>private</b> <span class="i">CimResponseType</span> <a id="088da2d871c5d424" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">PromptUserCallback</a>(<b>string</b> <span id="r74 rd" class="r74 r">message</span>, <span class="i">CimPromptType</span> <span id="r75 rd" class="r75 r">promptType</span>)
        {
            <span class="r74 r">message</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f2bc7a2cf386cb46" class="i method">PrependComputerNameToMessage</a>(<span class="r74 r">message</span>);
 
            <span class="i">Exception</span> <span id="r76 rd" class="r76 r">exceptionThrownOnCmdletThread</span> = <b>null</b>;
            <span class="i">CimResponseType</span> <span id="r77 rd" class="r77 r">result</span> = <span class="i">CimResponseType</span>.<span class="i">No</span>;
 
            <a href="#9f7249eed591704d" class="i field">_userWasPromptedForContinuationOfProcessing</a> = <b>true</b>;
            <b>switch</b> (<span class="r75 r">promptType</span>)
            {
                <b>case</b> <span class="i">CimPromptType</span>.<span class="i">Critical</span>:
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                            <b>delegate</b>
                            {
                                <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ShouldContinue</span>(<span class="r74 r">message</span>, <b>null</b>, <b>out</b> <span class="r76 r">exceptionThrownOnCmdletThread</span>))
                                {
                                    <span class="r77 r">result</span> = <span class="i">CimResponseType</span>.<span class="i">Yes</span>;
                                }
                                <b>else</b>
                                {
                                    <span class="r77 r">result</span> = <span class="i">CimResponseType</span>.<span class="i">No</span>;
                                }
                            });
                    <b>break</b>;
 
                <b>case</b> <span class="i">CimPromptType</span>.<span class="i">Normal</span>:
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">ExceptionSafeWrapper</span>(
                            <b>delegate</b>
                            {
                                <span class="r77 r">result</span> = <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#a6cab5e8d57b2325" class="i method">ShouldProcess</a>(<span class="r74 r">message</span>, <b>null</b>, <b>null</b>);
                            });
                    <b>break</b>;
 
                <b>default</b>:
                    <span class="i">Dbg</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;Unrecognized CimPromptType&quot;</span>);
                    <b>break</b>;
            }
 
            <b>if</b> (<span class="r76 r">exceptionThrownOnCmdletThread</span> != <b>null</b>)
            {
                <span class="r77 r">result</span> = <span class="i">CimResponseType</span>.<span class="i">NoToAll</span>;
            }
 
            <b>if</b> ((<span class="r77 r">result</span> == <span class="i">CimResponseType</span>.<span class="i">Yes</span>) || (<span class="r77 r">result</span> == <span class="i">CimResponseType</span>.<span class="i">YesToAll</span>))
            {
                <a href="#d37f307918acd1da" class="i field">_userRespondedYesToAtLeastOneShouldProcess</a> = <b>true</b>;
            }
 
            <b>return</b> <span class="r77 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>internal static bool</b> <a id="6cc3a8ce2e0e19dd" href="../../../R/6cc3a8ce2e0e19dd.html" target="n" data-glyph="74,1" class="i method">IsShowComputerNameMarkerPresent</a>(<span class="i">CimInstance</span> <span id="r78 rd" class="r78 r">cimInstance</span>)
        {
            <span class="i">PSObject</span> <span id="r79 rd" class="r79 r">pso</span> = <span class="i">PSObject</span>.<span class="i">AsPSObject</span>(<span class="r78 r">cimInstance</span>);
            <b>if</b> (!(<span class="r79 r">pso</span>.<span class="i">InstanceMembers</span>[<span class="i">RemotingConstants</span>.<span class="i">ShowComputerNameNoteProperty</span>] <b>is</b> <span class="i">PSPropertyInfo</span> <span id="r80 rd" class="r80 r">psShowComputerNameProperty</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>.<span class="i">Equals</span>(<span class="r80 r">psShowComputerNameProperty</span>.<span class="i">Value</span>);
        }
 
        <b>internal static void</b> <a id="fb32ca8f4af714c9" href="../../../R/fb32ca8f4af714c9.html" target="n" data-glyph="74,1" class="i method">AddShowComputerNameMarker</a>(<span class="i">PSObject</span> <span id="r81 rd" class="r81 r">pso</span>)
        {
            <span class="i">PSPropertyInfo</span> <span id="r82 rd" class="r82 r">psShowComputerNameProperty</span> = <span class="r81 r">pso</span>.<span class="i">InstanceMembers</span>[<span class="i">RemotingConstants</span>.<span class="i">ShowComputerNameNoteProperty</span>] <b>as</b> <span class="i">PSPropertyInfo</span>;
            <b>if</b> (<span class="r82 r">psShowComputerNameProperty</span> != <b>null</b>)
            {
                <span class="r82 r">psShowComputerNameProperty</span>.<span class="i">Value</span> = <b>true</b>;
            }
            <b>else</b>
            {
                <span class="r82 r">psShowComputerNameProperty</span> = <b>new</b> <span class="i">PSNoteProperty</span>(<span class="i">RemotingConstants</span>.<span class="i">ShowComputerNameNoteProperty</span>, <b>true</b>);
                <span class="r81 r">pso</span>.<span class="i">InstanceMembers</span>.<span class="i">Add</span>(<span class="r82 r">psShowComputerNameProperty</span>);
            }
        }
 
        <b>internal override void</b> <a id="f972043aa7ba8cce" href="../../../R/f972043aa7ba8cce.html" target="n" data-glyph="74,1" class="i method">WriteObject</a>(<b>object</b> <span id="r83 rd" class="r83 r">outputObject</span>)
        {
            <span class="i">CimInstance</span> <span id="r84 rd" class="r84 r">cimInstance</span> = <b>null</b>;
            <span class="i">PSObject</span> <span id="r85 rd" class="r85 r">pso</span> = <b>null</b>;
            <b>if</b> (<span class="r83 r">outputObject</span> <b>is</b> <span class="i">PSObject</span>)
            {
                <span class="r85 r">pso</span> = <span class="i">PSObject</span>.<span class="i">AsPSObject</span>(<span class="r83 r">outputObject</span>);
                <span class="r84 r">cimInstance</span> = <span class="r85 r">pso</span>.<span class="i">BaseObject</span> <b>as</b> <span class="i">CimInstance</span>;
            }
            <b>else</b>
            {
                <span class="r84 r">cimInstance</span> = <span class="r83 r">outputObject</span> <b>as</b> <span class="i">CimInstance</span>;
            }
 
            <b>if</b> (<span class="r84 r">cimInstance</span> != <b>null</b>)
            {
                <a href="cimWrapper.cs.html#c2d7e2b732221aa6" class="t t">CimCmdletAdapter</a>.<a href="cimWrapper.cs.html#c3bc4e5ac03a57f9" class="i method">AssociateSessionOfOriginWithInstance</a>(<span class="r84 r">cimInstance</span>, <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>);
                <a href="cimOperationOptionsHelper.cs.html#91e3203f276040c6" class="t t">CimCustomOptionsDictionary</a>.<a href="cimOperationOptionsHelper.cs.html#11e09e57de5c2634" class="i method">AssociateCimInstanceWithCustomOptions</a>(<span class="r84 r">cimInstance</span>, <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#9fc9cdd2400bb3ec" class="i method">GetJobSpecificCustomOptions</a>());
            }
 
            <b>if</b> (<a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#7c2648c275f1ae06" class="i property">ShowComputerName</a>)
            {
                <b>if</b> (<span class="r85 r">pso</span> == <b>null</b>)
                {
                    <span class="r85 r">pso</span> = <span class="i">PSObject</span>.<span class="i">AsPSObject</span>(<span class="r83 r">outputObject</span>);
                }
 
                <a href="#fb32ca8f4af714c9" class="i method">AddShowComputerNameMarker</a>(<span class="r85 r">pso</span>);
                <b>if</b> (<span class="r84 r">cimInstance</span> == <b>null</b>)
                {
                    <span class="r85 r">pso</span>.<span class="i">Properties</span>.<span class="i">Add</span>(<b>new</b> <span class="i">PSNoteProperty</span>(<span class="i">RemotingConstants</span>.<span class="i">ComputerNameNoteProperty</span>, <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#e0407cd9a723429a" class="i property">JobContext</a>.<a href="cimJobContext.cs.html#f7b7d2d30e71c2ba" class="i property">Session</a>.<span class="i">ComputerName</span>));
                }
            }
 
            <b>base</b>.<span class="i">WriteObject</span>(<span class="r83 r">outputObject</span>);
        }
 
        <b>protected override void</b> <a id="fe060b6d6c6ea47f" href="../../../R/fe060b6d6c6ea47f.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r86 rd" class="r86 r">disposing</span>)
        {
            <b>if</b> (<span class="r86 r">disposing</span>)
            {
                <b>bool</b> <span id="r87 rd" class="r87 r">isCompleted</span>;
                <b>lock</b> (<a href="#192fe17149c28655" class="i field">_jobStateLock</a>)
                {
                    <span class="r87 r">isCompleted</span> = <a href="#dff71d42c84245b7" class="i field">_alreadyReachedCompletedState</a>;
                }
 
                <b>if</b> (!<span class="r87 r">isCompleted</span>)
                {
                    <a href="#ce791a9f3445312b" class="k">this</a>.<a href="#177d10f6c36135e4" class="i method">StopJob</a>();
                    <a href="#ce791a9f3445312b" class="k">this</a>.<span class="i">Finished</span>.<span class="i">WaitOne</span>();
                }
 
                <a href="#df1329494175a5dc" class="i field">_cimSensitiveValueConverter</a>.<a href="cimConverter.cs.html#aeaa31449017b246" class="i method">Dispose</a>();
                <a href="#c5e9d7d1a44a7168" class="i field">_cancellationTokenSource</a>.<span class="i">Dispose</span>();
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
