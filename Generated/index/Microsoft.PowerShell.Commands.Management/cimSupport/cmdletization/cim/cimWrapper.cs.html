<!DOCTYPE html>
<html><head><title>cimWrapper.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(414);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/cimSupport/cmdletization/cim/cimWrapper.cs" target="_top">cimSupport\cmdletization\cim\cimWrapper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
 
<b>using</b> <span class="i">Dbg</span> = <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Cmdletization</span>.<span class="i n">Cim</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> CIM-specific ObjectModelWrapper.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public sealed class</b> <a id="c2d7e2b732221aa6" href="../../../R/c2d7e2b732221aa6.html" target="n" data-glyph="0,0" class="t t"><span id="4e874187d20bcfc9">CimCmdletAdapter</span></a> :
        <a href="../SessionBasedWrapper.cs.html#931739e72bdca1ce" class="t t">SessionBasedCmdletAdapter</a>&lt;<span class="i">CimInstance</span>, <span class="i">CimSession</span>&gt;,
        <span class="i">IDynamicParameters</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Special method and parameter names
 
        <b>internal const string</b> <a id="e08a16c0506887ed" href="../../../R/e08a16c0506887ed.html" target="n" data-glyph="8,1" class="i field">CreateInstance_MethodName</a> = <span class="s">&quot;cim:CreateInstance&quot;</span>;
        <b>internal const string</b> <a id="4d37254c537fa178" href="../../../R/4d37254c537fa178.html" target="n" data-glyph="8,1" class="i field">ModifyInstance_MethodName</a> = <span class="s">&quot;cim:ModifyInstance&quot;</span>;
        <b>internal const string</b> <a id="e34eda217ea952ca" href="../../../R/e34eda217ea952ca.html" target="n" data-glyph="8,1" class="i field">DeleteInstance_MethodName</a> = <span class="s">&quot;cim:DeleteInstance&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Changing Session parameter to CimSession
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> CimSession to operate on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;Session&quot;</span>)]
        <b>public</b> <span class="i">CimSession</span>[] <a id="0adce7c8b409fed7" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">CimSession</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="../SessionBasedWrapper.cs.html#931739e72bdca1ce" class="k">base</a>.<a href="../SessionBasedWrapper.cs.html#e15532283f92444f" class="i property">Session</a>;
            }
 
            <b>set</b>
            {
                <a href="../SessionBasedWrapper.cs.html#931739e72bdca1ce" class="k">base</a>.<a href="../SessionBasedWrapper.cs.html#e15532283f92444f" class="i property">Session</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Maximum number of remote connections that can remain active at any given time.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public override int</b> <a id="577b3eb566438668" href="../../../R/577b3eb566438668.html" target="n" data-glyph="102,1" class="i property">ThrottleLimit</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#2ff5e390c95d65e0" class="i field">_throttleLimitIsSetExplicitly</a>)
                {
                    <b>return</b> <a href="../SessionBasedWrapper.cs.html#931739e72bdca1ce" class="k">base</a>.<a href="../SessionBasedWrapper.cs.html#c2452c411dd5ed22" class="i property">ThrottleLimit</a>;
                }
 
                <b>return</b> <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#cb4259b45326b0ea" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#a86746974dc293f2" class="i property">DefaultThrottleLimit</a>;
            }
 
            <b>set</b>
            {
                <a href="../SessionBasedWrapper.cs.html#931739e72bdca1ce" class="k">base</a>.<a href="../SessionBasedWrapper.cs.html#c2452c411dd5ed22" class="i property">ThrottleLimit</a> = <b>value</b>;
                <a href="#2ff5e390c95d65e0" class="i field">_throttleLimitIsSetExplicitly</a> = <b>true</b>;
            }
        }
 
        <b>private bool</b> <a id="2ff5e390c95d65e0" href="../../../R/2ff5e390c95d65e0.html" target="n" data-glyph="46,1" class="i field">_throttleLimitIsSetExplicitly</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ObjectModelWrapper overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a query builder for CIM OM.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Query builder for CIM OM.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">QueryBuilder</span> <a id="315255faa979c30b" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetQueryBuilder</a>()
        {
            <b>return</b> <b>new</b> <a href="cimQuery.cs.html#6b5144de448a60b3" class="t constructor">CimQuery</a>();
        }
 
        <b>internal</b> <a href="cimCmdletInvocationContext.cs.html#1be328a775ef3c01" class="t t">CimCmdletInvocationContext</a> <a id="6309bba92c9811b4" href="../../../R/6309bba92c9811b4.html" target="n" data-glyph="104,1" class="i property">CmdletInvocationContext</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a7e2094eac0ab9a9" class="i field">_cmdletInvocationContext</a> ??= <b>new</b> <span class="t">CimCmdletInvocationContext</span>(
                    <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#cb4259b45326b0ea" class="i property">CmdletDefinitionContext</a>,
                    <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">Cmdlet</span>,
                    <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#74f3762c71b7b14b" class="i method">GetDynamicNamespace</a>());
            }
        }
 
        <b>private</b> <a href="cimCmdletInvocationContext.cs.html#1be328a775ef3c01" class="t t">CimCmdletInvocationContext</a> <a id="a7e2094eac0ab9a9" href="../../../R/a7e2094eac0ab9a9.html" target="n" data-glyph="46,1" class="i field">_cmdletInvocationContext</a>;
 
        <b>internal</b> <a href="cimCmdletDefinitionContext.cs.html#21c5021939caa757" class="t t">CimCmdletDefinitionContext</a> <a id="cb4259b45326b0ea" href="../../../R/cb4259b45326b0ea.html" target="n" data-glyph="104,1" class="i property">CmdletDefinitionContext</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#fdae82a019f97a36" class="i field">_cmdletDefinitionContext</a> == <b>null</b>)
                {
                    <a href="#fdae82a019f97a36" class="i field">_cmdletDefinitionContext</a> = <b>new</b> <span class="t">CimCmdletDefinitionContext</span>(
                            <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">ClassName</span>,
                            <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">ClassVersion</span>,
                            <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">ModuleVersion</span>,
                            <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">CommandInfo</span>.<span class="i">CommandMetadata</span>.<span class="i">SupportsShouldProcess</span>,
                            <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">PrivateData</span>);
                }
 
                <b>return</b> <a href="#fdae82a019f97a36" class="i field">_cmdletDefinitionContext</a>;
            }
        }
 
        <b>private</b> <a href="cimCmdletDefinitionContext.cs.html#21c5021939caa757" class="t t">CimCmdletDefinitionContext</a> <a id="fdae82a019f97a36" href="../../../R/fdae82a019f97a36.html" target="n" data-glyph="46,1" class="i field">_cmdletDefinitionContext</a>;
 
        <b>internal</b> <span class="i">InvocationInfo</span> <a id="6765f93a965e1a0f" href="../../../R/6765f93a965e1a0f.html" target="n" data-glyph="104,1" class="i property">CmdletInvocationInfo</a>
        {
            <b>get</b> { <b>return</b> <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6309bba92c9811b4" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#f1276d14a6715d43" class="i property">CmdletInvocationInfo</a>; }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ObjectModelWrapper overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> SessionBasedCmdletAdapter overrides
 
        <b>private static long</b> <a id="153050e7356ff7d1" href="../../../R/153050e7356ff7d1.html" target="n" data-glyph="46,1" class="i field">s_jobNumber</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a new job name to use for the parent job that handles throttling of the child jobs that actually perform querying and method invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Job name.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected override string</b> <a id="b01a1a24ddafcf29" href="../../../R/b01a1a24ddafcf29.html" target="n" data-glyph="75,1" class="i method">GenerateParentJobName</a>()
        {
            <b>return</b> <span class="s">&quot;CimJob&quot;</span> + <span class="i">Interlocked</span>.<span class="i">Increment</span>(<b>ref</b> <a href="#c2d7e2b732221aa6" class="t t">CimCmdletAdapter</a>.<a href="#153050e7356ff7d1" class="i field">s_jobNumber</a>).<span class="i">ToString</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns default sessions to use when the user doesn&#39;t specify the -Session cmdlet parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Default sessions to use when the user doesn&#39;t specify the -Session cmdlet parameter.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected override</b> <span class="i">CimSession</span> <a id="dc01420a34f93a94" href="../../../R/dc01420a34f93a94.html" target="n" data-glyph="105,1" class="i property">DefaultSession</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6309bba92c9811b4" class="i property">CmdletInvocationContext</a>.<a href="cimCmdletInvocationContext.cs.html#86c80fe5e2a782d8" class="i method">GetDefaultCimSession</a>();
            }
        }
 
        <b>private</b> <a href="cimJobContext.cs.html#8739c35db0e1a6ca" class="t t">CimJobContext</a> <a id="a202481cbd43b75a" href="../../../R/a202481cbd43b75a.html" target="n" data-glyph="76,1" class="i method">CreateJobContext</a>(<span class="i">CimSession</span> <span id="r0 rd" class="r0 r">session</span>, <b>object</b> <span id="r1 rd" class="r1 r">targetObject</span>)
        {
            <b>return</b> <b>new</b> <a href="cimJobContext.cs.html#cd0f4c3e8e40791a" class="t constructor">CimJobContext</a>(
                <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6309bba92c9811b4" class="i property">CmdletInvocationContext</a>,
                <span class="r0 r">session</span>,
                <span class="r1 r">targetObject</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Job</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object that performs a query against the wrapped object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote session to query.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">baseQuery</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Query parameters.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Job</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object that performs a query against the wrapped object model.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal override</b> <span class="i">StartableJob</span> <a id="f43a860d989e4c9a" href="../../../R/f43a860d989e4c9a.html" target="n" data-glyph="74,1" class="i method">CreateQueryJob</a>(<span class="i">CimSession</span> <span id="r2 rd" class="r2 r">session</span>, <span class="i">QueryBuilder</span> <span id="r3 rd" class="r3 r">baseQuery</span>)
        {
            <b>if</b> (!(<span class="r3 r">baseQuery</span> <b>is</b> <a href="cimQuery.cs.html#c1cbd1632740222c" class="t t">CimQuery</a> <span id="r4 rd" class="r4 r">query</span>))
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r3 r">baseQuery</span>));
            }
 
            <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a> <span id="r5 rd" class="r5 r">tracker</span> = <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a>.<a href="TerminatingErrorTracker.cs.html#9bfee74b23b5c8d7" class="i method">GetTracker</a>(<a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6765f93a965e1a0f" class="i property">CmdletInvocationInfo</a>, <span class="r6 r">isStaticCmdlet</span>: <b>false</b>);
            <b>if</b> (<span class="r5 r">tracker</span>.<a href="TerminatingErrorTracker.cs.html#3440dc4e92814b5e" class="i method">IsSessionTerminated</a>(<span class="r2 r">session</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (!<a href="#cd8d6f0353c4b3c9" class="i method">IsSupportedSession</a>(<span class="r2 r">session</span>, <span class="r5 r">tracker</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="cimJobContext.cs.html#8739c35db0e1a6ca" class="t t">CimJobContext</a> <span id="r7 rd" class="r7 r">jobContext</span> = <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#a202481cbd43b75a" class="i method">CreateJobContext</a>(<span class="r2 r">session</span>, <span class="r1 r">targetObject</span>: <b>null</b>);
            <span class="i">StartableJob</span> <span id="r8 rd" class="r8 r">queryJob</span> = <span class="r4 r">query</span>.<a href="cimQuery.cs.html#2bc5b74a0b84d19c" class="i method">GetQueryJob</a>(<span class="r7 r">jobContext</span>);
 
            <b>return</b> <span class="r8 r">queryJob</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Job</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object that invokes an instance method in the wrapped object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote session to invoke the method in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">objectInstance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object on which to invoke the method.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">methodInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Method invocation details.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">passThru</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if successful method invocations should emit downstream the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">objectInstance</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> being operated on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal override</b> <span class="i">StartableJob</span> <a id="81770f235fe952b4" href="../../../R/81770f235fe952b4.html" target="n" data-glyph="74,1" class="i method">CreateInstanceMethodInvocationJob</a>(<span class="i">CimSession</span> <span id="r9 rd" class="r9 r">session</span>, <span class="i">CimInstance</span> <span id="r10 rd" class="r10 r">objectInstance</span>, <span class="i">MethodInvocationInfo</span> <span id="r11 rd" class="r11 r">methodInvocationInfo</span>, <b>bool</b> <span id="r12 rd" class="r12 r">passThru</span>)
        {
            <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a> <span id="r13 rd" class="r13 r">tracker</span> = <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a>.<a href="TerminatingErrorTracker.cs.html#9bfee74b23b5c8d7" class="i method">GetTracker</a>(<a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6765f93a965e1a0f" class="i property">CmdletInvocationInfo</a>, <span class="r6 r">isStaticCmdlet</span>: <b>false</b>);
            <b>if</b> (<span class="r13 r">tracker</span>.<a href="TerminatingErrorTracker.cs.html#3440dc4e92814b5e" class="i method">IsSessionTerminated</a>(<span class="r9 r">session</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (!<a href="#cd8d6f0353c4b3c9" class="i method">IsSupportedSession</a>(<span class="r9 r">session</span>, <span class="r13 r">tracker</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="cimJobContext.cs.html#8739c35db0e1a6ca" class="t t">CimJobContext</a> <span id="r14 rd" class="r14 r">jobContext</span> = <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">CreateJobContext</span>(<span class="r9 r">session</span>, <span class="r10 r">objectInstance</span>);
 
            <span class="i">Dbg</span>.<span class="i">Assert</span>(<span class="r10 r">objectInstance</span> != <b>null</b>, <span class="s">&quot;Caller should verify objectInstance != null&quot;</span>);
 
            <span class="i">StartableJob</span> <span id="r15 rd" class="r15 r">result</span>;
            <b>if</b> (<span class="r11 r">methodInvocationInfo</span>.<span class="i">MethodName</span>.<span class="i">Equals</span>(<a href="#c2d7e2b732221aa6" class="t t">CimCmdletAdapter</a>.<a href="#e34eda217ea952ca" class="i field">DeleteInstance_MethodName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r15 r">result</span> = <b>new</b> <a href="DeleteInstanceJob.cs.html#4eb399d9d43c722d" class="t constructor">DeleteInstanceJob</a>(
                    <span class="r14 r">jobContext</span>,
                    <span class="r12 r">passThru</span>,
                    <span class="r10 r">objectInstance</span>,
                    <span class="r11 r">methodInvocationInfo</span>);
            }
            <b>else</b> <b>if</b> (<span class="r11 r">methodInvocationInfo</span>.<span class="i">MethodName</span>.<span class="i">Equals</span>(<a href="#c2d7e2b732221aa6" class="t t">CimCmdletAdapter</a>.<a href="#4d37254c537fa178" class="i field">ModifyInstance_MethodName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r15 r">result</span> = <b>new</b> <a href="ModifyInstanceJob.cs.html#734e7e71c8a34acb" class="t constructor">ModifyInstanceJob</a>(
                    <span class="r14 r">jobContext</span>,
                    <span class="r12 r">passThru</span>,
                    <span class="r10 r">objectInstance</span>,
                    <span class="r11 r">methodInvocationInfo</span>);
            }
            <b>else</b>
            {
                <span class="r15 r">result</span> = <b>new</b> <a href="InstanceMethodInvocationJob.cs.html#34c99f253e200976" class="t constructor">InstanceMethodInvocationJob</a>(
                    <span class="r14 r">jobContext</span>,
                    <span class="r12 r">passThru</span>,
                    <span class="r10 r">objectInstance</span>,
                    <span class="r11 r">methodInvocationInfo</span>);
            }
 
            <b>return</b> <span class="r15 r">result</span>;
        }
 
        <b>private bool</b> <a id="cd8d6f0353c4b3c9" href="../../../R/cd8d6f0353c4b3c9.html" target="n" data-glyph="76,1" class="i method">IsSupportedSession</a>(<span class="i">CimSession</span> <span id="r16 rd" class="r16 r">cimSession</span>, <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a> <span id="r17 rd" class="r17 r">terminatingErrorTracker</span>)
        {
            <b>bool</b> <span id="r18 rd" class="r18 r">confirmSwitchSpecified</span> = <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6765f93a965e1a0f" class="i property">CmdletInvocationInfo</a>.<span class="i">BoundParameters</span>.<span class="i">ContainsKey</span>(<span class="s">&quot;Confirm&quot;</span>);
            <b>bool</b> <span id="r19 rd" class="r19 r">whatIfSwitchSpecified</span> = <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6765f93a965e1a0f" class="i property">CmdletInvocationInfo</a>.<span class="i">BoundParameters</span>.<span class="i">ContainsKey</span>(<span class="s">&quot;WhatIf&quot;</span>);
            <b>if</b> (<span class="r18 r">confirmSwitchSpecified</span> || <span class="r19 r">whatIfSwitchSpecified</span>)
            {
                <b>if</b> (<span class="r16 r">cimSession</span>.<span class="i">ComputerName</span> != <b>null</b> &amp;&amp; (!<span class="r16 r">cimSession</span>.<span class="i">ComputerName</span>.<span class="i">Equals</span>(<span class="s">&quot;localhost&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <span class="i">PSPropertyInfo</span> <span id="r20 rd" class="r20 r">protocolProperty</span> = <span class="i">PSObject</span>.<span class="i">AsPSObject</span>(<span class="r16 r">cimSession</span>).<span class="i">Properties</span>[<span class="s">&quot;Protocol&quot;</span>];
                    <b>if</b> ((<span class="r20 r">protocolProperty</span> != <b>null</b>) &amp;&amp;
                        (<span class="r20 r">protocolProperty</span>.<span class="i">Value</span> != <b>null</b>) &amp;&amp;
                        (<span class="r20 r">protocolProperty</span>.<span class="i">Value</span>.<span class="i">ToString</span>().<span class="i">Equals</span>(<span class="s">&quot;DCOM&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                    {
                        <b>bool</b> <span id="r21 rd" class="r21 r">sessionWasAlreadyTerminated</span>;
                        <span class="r17 r">terminatingErrorTracker</span>.<a href="TerminatingErrorTracker.cs.html#9e2ae9e449c2b99d" class="i method">MarkSessionAsTerminated</a>(<span class="r16 r">cimSession</span>, <b>out</b> <span class="r21 r">sessionWasAlreadyTerminated</span>);
                        <b>if</b> (!<span class="r21 r">sessionWasAlreadyTerminated</span>)
                        {
                            <b>string</b> <span id="r22 rd" class="r22 r">nameOfUnsupportedSwitch</span>;
                            <b>if</b> (<span class="r18 r">confirmSwitchSpecified</span>)
                            {
                                <span class="r22 r">nameOfUnsupportedSwitch</span> = <span class="s">&quot;-Confirm&quot;</span>;
                            }
                            <b>else</b>
                            {
                                <span class="i">Dbg</span>.<span class="i">Assert</span>(<span class="r19 r">whatIfSwitchSpecified</span>, <span class="s">&quot;Confirm and WhatIf are the only detected settings&quot;</span>);
                                <span class="r22 r">nameOfUnsupportedSwitch</span> = <span class="s">&quot;-WhatIf&quot;</span>;
                            }
 
                            <b>string</b> <span id="r23 rd" class="r23 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                <span class="i">CmdletizationResources</span>.<span class="i">CimCmdletAdapter_RemoteDcomDoesntSupportExtendedSemantics</span>,
                                <span class="r16 r">cimSession</span>.<span class="i">ComputerName</span>,
                                <span class="r22 r">nameOfUnsupportedSwitch</span>);
                            <span class="i">Exception</span> <span id="r24 rd" class="r24 r">exception</span> = <b>new</b> <span class="i">NotSupportedException</span>(<span class="r23 r">errorMessage</span>);
                            <span class="i">ErrorRecord</span> <span id="r25 rd" class="r25 r">errorRecord</span> = <b>new</b>(
                                <span class="r24 r">exception</span>,
                                <span class="s">&quot;NoExtendedSemanticsSupportInRemoteDcomProtocol&quot;</span>,
                                <span class="i">ErrorCategory</span>.<span class="i">NotImplemented</span>,
                                <span class="r16 r">cimSession</span>);
                            <a href="#c2d7e2b732221aa6" class="k">this</a>.<span class="i">Cmdlet</span>.<span class="i">WriteError</span>(<span class="r25 r">errorRecord</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Job</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object that invokes a static method</span>
        <span class="c">///</span><span class="c"> (of the class named by </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Cmdletization</span>.<span class="i">CmdletAdapter</span>&amp;lt;<span class="r26 r t">TObjectInstance</span>&amp;gt;.<span class="i">ClassName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">)</span>
        <span class="c">///</span><span class="c"> in the wrapped object model.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote session to invoke the method in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">methodInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Method invocation details.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override</b> <span class="i">StartableJob</span> <a id="66174c7a59c233b4" href="../../../R/66174c7a59c233b4.html" target="n" data-glyph="74,1" class="i method">CreateStaticMethodInvocationJob</a>(<span class="i">CimSession</span> <span id="r27 rd" class="r27 r">session</span>, <span class="i">MethodInvocationInfo</span> <span id="r28 rd" class="r28 r">methodInvocationInfo</span>)
        {
            <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a> <span id="r29 rd" class="r29 r">tracker</span> = <a href="TerminatingErrorTracker.cs.html#983f50216bcbdeb5" class="t t">TerminatingErrorTracker</a>.<a href="TerminatingErrorTracker.cs.html#9bfee74b23b5c8d7" class="i method">GetTracker</a>(<a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#6765f93a965e1a0f" class="i property">CmdletInvocationInfo</a>, <span class="r6 r">isStaticCmdlet</span>: <b>true</b>);
            <b>if</b> (<span class="r29 r">tracker</span>.<a href="TerminatingErrorTracker.cs.html#3440dc4e92814b5e" class="i method">IsSessionTerminated</a>(<span class="r27 r">session</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (!<a href="#cd8d6f0353c4b3c9" class="i method">IsSupportedSession</a>(<span class="r27 r">session</span>, <span class="r29 r">tracker</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="cimJobContext.cs.html#8739c35db0e1a6ca" class="t t">CimJobContext</a> <span id="r30 rd" class="r30 r">jobContext</span> = <a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#a202481cbd43b75a" class="i method">CreateJobContext</a>(<span class="r27 r">session</span>, <span class="r1 r">targetObject</span>: <b>null</b>);
 
            <span class="i">StartableJob</span> <span id="r31 rd" class="r31 r">result</span>;
            <b>if</b> (<span class="r28 r">methodInvocationInfo</span>.<span class="i">MethodName</span>.<span class="i">Equals</span>(<a href="#c2d7e2b732221aa6" class="t t">CimCmdletAdapter</a>.<a href="#e08a16c0506887ed" class="i field">CreateInstance_MethodName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r31 r">result</span> = <b>new</b> <a href="CreateInstanceJob.cs.html#3352f340d84eb124" class="t constructor">CreateInstanceJob</a>(
                    <span class="r30 r">jobContext</span>,
                    <span class="r28 r">methodInvocationInfo</span>);
            }
            <b>else</b>
            {
                <span class="r31 r">result</span> = <b>new</b> <a href="StaticMethodInvocationJob.cs.html#03fa01cfda09006a" class="t constructor">StaticMethodInvocationJob</a>(
                    <span class="r30 r">jobContext</span>,
                    <span class="r28 r">methodInvocationInfo</span>);
            }
 
            <b>return</b> <span class="r31 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> SessionBasedCmdletAdapter overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Session affinity management
 
        <b>private static readonly</b> <span class="i">ConditionalWeakTable</span>&lt;<span class="i">CimInstance</span>, <span class="i">CimSession</span>&gt; <a id="dc9717219a4e7066" href="../../../R/dc9717219a4e7066.html" target="n" data-glyph="46,1" class="i field">s_cimInstanceToSessionOfOrigin</a> = <b>new</b>();
 
        <b>internal static void</b> <a id="c3bc4e5ac03a57f9" href="../../../R/c3bc4e5ac03a57f9.html" target="n" data-glyph="74,1" class="i method">AssociateSessionOfOriginWithInstance</a>(<span class="i">CimInstance</span> <span id="r32 rd" class="r32 r">cimInstance</span>, <span class="i">CimSession</span> <span id="r33 rd" class="r33 r">sessionOfOrigin</span>)
        {
            <span class="c">// GetValue adds value to the table, if the key is not present in the table</span>
            <a href="#dc9717219a4e7066" class="i field">s_cimInstanceToSessionOfOrigin</a>.<span class="i">GetValue</span>(<span class="r32 r">cimInstance</span>, <span id="r34 rd" class="r34 r">_</span> =&gt; <span class="r33 r">sessionOfOrigin</span>);
        }
 
        <b>internal static</b> <span class="i">CimSession</span> <a id="35130beb0294c0ac" href="../../../R/35130beb0294c0ac.html" target="n" data-glyph="74,1" class="i method">GetSessionOfOriginFromCimInstance</a>(<span class="i">CimInstance</span> <span id="r35 rd" class="r35 r">instance</span>)
        {
            <span class="i">CimSession</span> <span id="r36 rd" class="r36 r">result</span> = <b>null</b>;
            <b>if</b> (<span class="r35 r">instance</span> != <b>null</b>)
            {
                <a href="#dc9717219a4e7066" class="i field">s_cimInstanceToSessionOfOrigin</a>.<span class="i">TryGetValue</span>(<span class="r35 r">instance</span>, <b>out</b> <span class="r36 r">result</span>);
            }
 
            <b>return</b> <span class="r36 r">result</span>;
        }
 
        <b>internal override</b> <span class="i">CimSession</span> <a id="b29678a89e5f6fe8" href="../../../R/b29678a89e5f6fe8.html" target="n" data-glyph="74,1" class="i method">GetSessionOfOriginFromInstance</a>(<span class="i">CimInstance</span> <span id="r37 rd" class="r37 r">instance</span>)
        {
            <b>return</b> <a href="#35130beb0294c0ac" class="i method">GetSessionOfOriginFromCimInstance</a>(<span class="r37 r">instance</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Handling of dynamic parameters
 
        <b>private</b> <span class="i">RuntimeDefinedParameterDictionary</span> <a id="434d79df83b3cb61" href="../../../R/434d79df83b3cb61.html" target="n" data-glyph="46,1" class="i field">_dynamicParameters</a>;
 
        <b>private const string</b> <a id="b007fabb724b4352" href="../../../R/b007fabb724b4352.html" target="n" data-glyph="10,1" class="i field">CimNamespaceParameter</a> = <span class="s">&quot;CimNamespace&quot;</span>;
 
        <b>private string</b> <a id="74f3762c71b7b14b" href="../../../R/74f3762c71b7b14b.html" target="n" data-glyph="76,1" class="i method">GetDynamicNamespace</a>()
        {
            <b>if</b> (<a href="#434d79df83b3cb61" class="i field">_dynamicParameters</a> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="i">RuntimeDefinedParameter</span> <span id="r38 rd" class="r38 r">runtimeParameter</span>;
            <b>if</b> (!<a href="#434d79df83b3cb61" class="i field">_dynamicParameters</a>.<span class="i">TryGetValue</span>(<a href="#b007fabb724b4352" class="i field">CimNamespaceParameter</a>, <b>out</b> <span class="r38 r">runtimeParameter</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r38 r">runtimeParameter</span>.<span class="i">Value</span> <b>as string</b>;
        }
 
        <b>object</b> <span class="i">IDynamicParameters</span>.<a id="de28a886197e53dc" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetDynamicParameters</a>()
        {
            <b>if</b> (<a href="#434d79df83b3cb61" class="i field">_dynamicParameters</a> == <b>null</b>)
            {
                <a href="#434d79df83b3cb61" class="i field">_dynamicParameters</a> = <b>new</b> <span class="i">RuntimeDefinedParameterDictionary</span>();
 
                <b>if</b> (<a href="#c2d7e2b732221aa6" class="k">this</a>.<a href="#cb4259b45326b0ea" class="i property">CmdletDefinitionContext</a>.<a href="cimCmdletDefinitionContext.cs.html#92ecaf0b61005e92" class="i property">ExposeCimNamespaceParameter</a>)
                {
                    <span class="i">Collection</span>&lt;<span class="i">Attribute</span>&gt; <span id="r39 rd" class="r39 r">namespaceAttributes</span> = <b>new</b>();
                    <span class="r39 r">namespaceAttributes</span>.<span class="i">Add</span>(<b>new</b> <span class="i">ValidateNotNullOrEmptyAttribute</span>());
                    <span class="r39 r">namespaceAttributes</span>.<span class="i">Add</span>(<b>new</b> <span class="i">ParameterAttribute</span>());
                    <span class="i">RuntimeDefinedParameter</span> <span id="r40 rd" class="r40 r">namespaceRuntimeParameter</span> = <b>new</b>(
                        <a href="#b007fabb724b4352" class="i field">CimNamespaceParameter</a>,
                        <b>typeof</b>(<b>string</b>),
                        <span class="r39 r">namespaceAttributes</span>);
                    <a href="#434d79df83b3cb61" class="i field">_dynamicParameters</a>.<span class="i">Add</span>(<a href="#b007fabb724b4352" class="i field">CimNamespaceParameter</a>, <span class="r40 r">namespaceRuntimeParameter</span>);
                }
            }
 
            <b>return</b> <a href="#434d79df83b3cb61" class="i field">_dynamicParameters</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
