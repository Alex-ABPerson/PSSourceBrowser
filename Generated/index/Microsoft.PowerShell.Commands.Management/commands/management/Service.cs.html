<!DOCTYPE html>
<html><head><title>Service.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(2983);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/commands/management/Service.cs" target="_top">commands\management\Service.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span> <span class="c">// Not built on Unix</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">ComponentModel</span>; <span class="c">// Win32Exception</span>
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Internal</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>; <span class="c">// Marshal, DllImport</span>
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">Serialization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Security</span>.<span class="i">AccessControl</span>;
<b>using</b> <span class="i">System</span>.<span class="i">ServiceProcess</span>;
<b>using</b> <span class="i">Dbg</span> = <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Diagnostics</span>;
<b>using</b> <span class="i">DWORD</span> = <span class="i">System</span>.<span class="i">UInt32</span>;
<b>using</b> <span class="i">NakedWin32Handle</span> = <span class="i">System</span>.<span class="i">IntPtr</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ServiceBaseCommand
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the base for service commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public abstract class</b> <a id="057be076428c3adc" href="../../R/057be076428c3adc.html" target="n" data-glyph="0,0" class="t t"><span id="135e411b844233b8">ServiceBaseCommand</span></a> : <span class="i">Cmdlet</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Confirm that the operation should proceed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">service</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service object to be acted on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if operation should continue, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="d74e872d88d6d9d5" href="../../R/d74e872d88d6d9d5.html" target="n" data-glyph="75,1" class="i method">ShouldProcessServiceOperation</a>(<span class="i">ServiceController</span> <span id="r0 rd" class="r0 r">service</span>)
        {
            <b>return</b> <span class="i">ShouldProcessServiceOperation</span>(
                <span class="r0 r">service</span>.<span class="i">DisplayName</span>,
                <span class="r0 r">service</span>.<span class="i">ServiceName</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Confirm that the operation should proceed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">displayName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Display name of service to be acted on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">serviceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service name of service to be acted on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if operation should continue, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="a96ac3ad0a81b181" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ShouldProcessServiceOperation</a>(
            <b>string</b> <span id="r1 rd" class="r1 r">displayName</span>, <b>string</b> <span id="r2 rd" class="r2 r">serviceName</span>)
        {
            <b>string</b> <span id="r3 rd" class="r3 r">name</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ServiceResources</span>.<span class="i">ServiceNameForConfirmation</span>,
                <span class="r1 r">displayName</span>,
                <span class="r2 r">serviceName</span>);
 
            <b>return</b> <span class="i">ShouldProcess</span>(<span class="r3 r">name</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes a non-terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">service</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">errorId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">errorMessage</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">category</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="d879ff155b5e0084" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">WriteNonTerminatingError</a>(
            <span class="i">ServiceController</span> <span id="r4 rd" class="r4 r">service</span>,
            <span class="i">Exception</span> <span id="r5 rd" class="r5 r">innerException</span>,
            <b>string</b> <span id="r6 rd" class="r6 r">errorId</span>,
            <b>string</b> <span id="r7 rd" class="r7 r">errorMessage</span>,
            <span class="i">ErrorCategory</span> <span id="r8 rd" class="r8 r">category</span>)
        {
            <span class="i">WriteNonTerminatingError</span>(
                <span class="r4 r">service</span>.<span class="i">ServiceName</span>,
                <span class="r4 r">service</span>.<span class="i">DisplayName</span>,
                <span class="r4 r">service</span>,
                <span class="r5 r">innerException</span>,
                <span class="r6 r">errorId</span>,
                <span class="r7 r">errorMessage</span>,
                <span class="r8 r">category</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes a non-terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">serviceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">displayName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">targetObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">errorId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">errorMessage</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">category</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="41ea0f86faaef60e" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">WriteNonTerminatingError</a>(
            <b>string</b> <span id="r9 rd" class="r9 r">serviceName</span>,
            <b>string</b> <span id="r10 rd" class="r10 r">displayName</span>,
            <b>object</b> <span id="r11 rd" class="r11 r">targetObject</span>,
            <span class="i">Exception</span> <span id="r12 rd" class="r12 r">innerException</span>,
            <b>string</b> <span id="r13 rd" class="r13 r">errorId</span>,
            <b>string</b> <span id="r14 rd" class="r14 r">errorMessage</span>,
            <span class="i">ErrorCategory</span> <span id="r15 rd" class="r15 r">category</span>)
        {
            <b>string</b> <span id="r16 rd" class="r16 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="r14 r">errorMessage</span>,
                <span class="r9 r">serviceName</span>,
                <span class="r10 r">displayName</span>,
                (<span class="r12 r">innerException</span> == <b>null</b>) ? <b>string</b>.<span class="i">Empty</span> : <span class="r12 r">innerException</span>.<span class="i">Message</span>);
 
            <a href="#44aed4e263278c73" class="k">var</a> <span id="r17 rd" class="r17 r">exception</span> = <b>new</b> <a href="#cd90e14aa335aaa8" class="t constructor">ServiceCommandException</a>(<span class="r16 r">message</span>, <span class="r12 r">innerException</span>);
            <span class="r17 r">exception</span>.<a href="#98b08c8e9e8123ef" class="i property">ServiceName</a> = <span class="r9 r">serviceName</span>;
 
            <span class="i">WriteError</span>(<b>new</b> <span class="i">ErrorRecord</span>(<span class="r17 r">exception</span>, <span class="r13 r">errorId</span>, <span class="r15 r">category</span>, <span class="r11 r">targetObject</span>));
        }
 
        <b>internal void</b> <a id="b9bc4a850c3897aa" href="../../R/b9bc4a850c3897aa.html" target="n" data-glyph="74,1" class="i method">SetServiceSecurityDescriptor</a>(
            <span class="i">ServiceController</span> <span id="r18 rd" class="r18 r">service</span>,
            <b>string</b> <span id="r19 rd" class="r19 r">securityDescriptorSddl</span>,
            <span class="i">NakedWin32Handle</span> <span id="r20 rd" class="r20 r">hService</span>)
        {
            <b>var</b> <span id="r21 rd" class="r21 r">rawSecurityDescriptor</span> = <b>new</b> <span class="i">RawSecurityDescriptor</span>(<span class="r19 r">securityDescriptorSddl</span>);
            <span class="i">RawAcl</span> <span id="r22 rd" class="r22 r">rawDiscretionaryAcl</span> = <span class="r21 r">rawSecurityDescriptor</span>.<span class="i">DiscretionaryAcl</span>;
            <b>var</b> <span id="r23 rd" class="r23 r">discretionaryAcl</span> = <b>new</b> <span class="i">DiscretionaryAcl</span>(<b>false</b>, <b>false</b>, <span class="r22 r">rawDiscretionaryAcl</span>);
 
            <b>byte</b>[] <span id="r24 rd" class="r24 r">rawDacl</span> = <b>new</b> <b>byte</b>[<span class="r23 r">discretionaryAcl</span>.<span class="i">BinaryLength</span>];
            <span class="r23 r">discretionaryAcl</span>.<span class="i">GetBinaryForm</span>(<span class="r24 r">rawDacl</span>, 0);
            <span class="r21 r">rawSecurityDescriptor</span>.<span class="i">DiscretionaryAcl</span> = <b>new</b> <span class="i">RawAcl</span>(<span class="r24 r">rawDacl</span>, 0);
            <b>byte</b>[] <span id="r25 rd" class="r25 r">securityDescriptorByte</span> = <b>new</b> <b>byte</b>[<span class="r21 r">rawSecurityDescriptor</span>.<span class="i">BinaryLength</span>];
            <span class="r21 r">rawSecurityDescriptor</span>.<span class="i">GetBinaryForm</span>(<span class="r25 r">securityDescriptorByte</span>, 0);
 
            <b>bool</b> <span id="r26 rd" class="r26 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">SetServiceObjectSecurity</span>(
                <span class="r20 r">hService</span>,
                <span class="i">SecurityInfos</span>.<span class="i">DiscretionaryAcl</span>,
                <span class="r25 r">securityDescriptorByte</span>);
 
            <b>if</b> (!<span class="r26 r">status</span>)
            {
                <b>int</b> <span id="r27 rd" class="r27 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                <span class="i">Win32Exception</span> <span id="r28 rd" class="r28 r">exception</span> = <b>new</b>(<span class="r27 r">lastError</span>);
                <b>bool</b> <span id="r29 rd" class="r29 r">accessDenied</span> = <span class="r28 r">exception</span>.<span class="i">NativeErrorCode</span> == <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#92b769997e7da9e5" class="i field">ERROR_ACCESS_DENIED</a>;
                <span class="i">WriteNonTerminatingError</span>(
                    <span class="r18 r">service</span>,
                    <span class="r28 r">exception</span>,
                    <b>nameof</b>(<span class="i">ServiceResources</span>.<span class="i">CouldNotSetServiceSecurityDescriptorSddl</span>),
                    <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ServiceResources</span>.<span class="i">CouldNotSetServiceSecurityDescriptorSddl</span>, <span class="r18 r">service</span>.<span class="i">ServiceName</span>, <span class="r28 r">exception</span>.<span class="i">Message</span>),
                    <span class="r29 r">accessDenied</span> ? <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span> : <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ServiceBaseCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> MultipleServiceCommandBase
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the base for service commands which can</span>
    <span class="c">///</span><span class="c"> operate on multiple services.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public abstract class</b> <a id="91bb2f677096cd68" href="../../R/91bb2f677096cd68.html" target="n" data-glyph="0,0" class="t t"><span id="59795776c0756248">MultipleServiceCommandBase</span></a> : <a href="#057be076428c3adc" class="t t">ServiceBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The various process selection modes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal enum</b> <a id="bae6babcf88f8d58" href="../../R/bae6babcf88f8d58.html" target="n" data-glyph="20,1" class="t t"><span id="57d85df6863a4ba7">SelectionMode</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select all services.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="612654f4c29289ed" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">Default</a> = 0,
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select services matching the supplied names.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="b796cd202a571141" href="../../R/b796cd202a571141.html" target="n" data-glyph="24,2" class="i field">DisplayName</a> = 1,
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select services based on pipeline input.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="f88bb91f2423c984" href="../../R/f88bb91f2423c984.html" target="n" data-glyph="24,2" class="i field">InputObject</a> = 2,
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select services by Service name.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="542eeb216034a42b" href="../../R/542eeb216034a42b.html" target="n" data-glyph="24,2" class="i field">ServiceName</a> = 3
        }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Holds the selection mode setting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a> <a id="0eb6d68c940f9bf0" href="../../R/0eb6d68c940f9bf0.html" target="n" data-glyph="44,1" class="i field">selectionMode</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ServiceName parameter is declared in subclasses,</span>
        <span class="c">///</span><span class="c"> since it is optional for GetService and mandatory otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b>[] <a id="2831c97d8bff6ec6" href="../../R/2831c97d8bff6ec6.html" target="n" data-glyph="44,1" class="i field">serviceNames</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets/sets an array of display names for services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;DisplayName&quot;</span>, <span class="i">Mandatory</span> = <b>true</b>)]
        <b>public string</b>[] <a id="a862990125ec214d" href="../../R/a862990125ec214d.html" target="n" data-glyph="102,1" class="i property">DisplayName</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5fe0b6d166206968" class="i field">displayNames</a>;
            }
 
            <b>set</b>
            {
                <a href="#5fe0b6d166206968" class="i field">displayNames</a> = <b>value</b>;
                <a href="#0eb6d68c940f9bf0" class="i field">selectionMode</a> = <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a>.<a href="#b796cd202a571141" class="i field">DisplayName</a>;
            }
        }
 
        <b>internal string</b>[] <a id="5fe0b6d166206968" href="../../R/5fe0b6d166206968.html" target="n" data-glyph="44,1" class="i field">displayNames</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Lets you include particular services.  Services not matching</span>
        <span class="c">///</span><span class="c"> one of these (if specified) are excluded.</span>
        <span class="c">///</span><span class="c"> These are interpreted as either ServiceNames or DisplayNames</span>
        <span class="c">///</span><span class="c"> according to the parameter set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b>[] <a id="8717969742de40b9" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Include</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2b687a2acc191006" class="i field">include</a>;
            }
 
            <b>set</b>
            {
                <a href="#2b687a2acc191006" class="i field">include</a> = <b>value</b>;
            }
        }
 
        <b>internal string</b>[] <a id="2b687a2acc191006" href="../../R/2b687a2acc191006.html" target="n" data-glyph="44,1" class="i field">include</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Lets you exclude particular services.  Services matching</span>
        <span class="c">///</span><span class="c"> one of these (if specified) are excluded.</span>
        <span class="c">///</span><span class="c"> These are interpreted as either ServiceNames or DisplayNames</span>
        <span class="c">///</span><span class="c"> according to the parameter set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b>[] <a id="a3d10bc01dc51a47" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Exclude</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#d99662abfe322e43" class="i field">exclude</a>;
            }
 
            <b>set</b>
            {
                <a href="#d99662abfe322e43" class="i field">exclude</a> = <b>value</b>;
            }
        }
 
        <b>internal string</b>[] <a id="d99662abfe322e43" href="../../R/d99662abfe322e43.html" target="n" data-glyph="44,1" class="i field">exclude</a> = <b>null</b>;
 
        <span class="c">// 1054295-2004/12/01-JonN This also works around 1054295.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the input is a stream of [collections of]</span>
        <span class="c">///</span><span class="c"> ServiceController objects, we bypass the ServiceName and</span>
        <span class="c">///</span><span class="c"> DisplayName parameters and read the ServiceControllers</span>
        <span class="c">///</span><span class="c"> directly.  This allows us to deal with services which</span>
        <span class="c">///</span><span class="c"> have wildcard characters in their name (servicename or</span>
        <span class="c">///</span><span class="c"> displayname).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">ServiceController objects</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public</b> <span class="i">ServiceController</span>[] <a id="f3d105948c20cf0a" href="../../R/f3d105948c20cf0a.html" target="n" data-glyph="102,1" class="i property">InputObject</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#011476a877ed2f0e" class="i field">_inputObject</a>;
            }
 
            <b>set</b>
            {
                <a href="#011476a877ed2f0e" class="i field">_inputObject</a> = <b>value</b>;
                <a href="#0eb6d68c940f9bf0" class="i field">selectionMode</a> = <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a>.<a href="#f88bb91f2423c984" class="i field">InputObject</a>;
            }
        }
 
        <b>private</b> <span class="i">ServiceController</span>[] <a id="011476a877ed2f0e" href="../../R/011476a877ed2f0e.html" target="n" data-glyph="46,1" class="i field">_inputObject</a> = <b>null</b>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets an array of all services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ServiceController</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> components that represents all the service resources.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> MSDN does not document the list of exceptions,</span>
        <span class="c">///</span><span class="c"> but it is reasonable to expect that SecurityException is</span>
        <span class="c">///</span><span class="c"> among them.  Errors here will terminate the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">ServiceController</span>[] <a id="4be27ecb994e030b" href="../../R/4be27ecb994e030b.html" target="n" data-glyph="104,1" class="i property">AllServices</a> =&gt; <a href="#cb3b9bfa9a66542b" class="i field">_allServices</a> ??= <span class="i">ServiceController</span>.<span class="i">GetServices</span>();
 
        <b>private</b> <span class="i">ServiceController</span>[] <a id="cb3b9bfa9a66542b" href="../../R/cb3b9bfa9a66542b.html" target="n" data-glyph="46,1" class="i field">_allServices</a>;
 
        <b>internal</b> <span class="i">ServiceController</span> <a id="4943e4b81cdca852" href="../../R/4943e4b81cdca852.html" target="n" data-glyph="74,1" class="i method">GetOneService</a>(<b>string</b> <span id="r30 rd" class="r30 r">nameOfService</span>)
        {
            <span class="i">Dbg</span>.<span class="i">Assert</span>(!<span class="i">WildcardPattern</span>.<span class="i">ContainsWildcardCharacters</span>(<span class="r30 r">nameOfService</span>), <span class="s">&quot;Caller should verify that nameOfService doesn&#39;t contain wildcard characters&quot;</span>);
 
            <b>try</b>
            {
                <b>var</b> <span id="r31 rd" class="r31 r">sc</span> = <b>new</b> <span class="i">ServiceController</span>(<span class="r30 r">nameOfService</span>);
                <span class="c">// This will throw if the service doesn&#39;t exist</span>
                <b>var</b> <span id="r32 rd" class="r32 r">unused</span> = <span class="r31 r">sc</span>.<span class="i">Status</span>;
 
                <span class="c">// No exception, then this is an existing, valid service. Return it.</span>
                <b>return</b> <span class="r31 r">sc</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>) { }
            <b>catch</b> (<span class="i">ArgumentException</span>) { }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve the list of all services matching the ServiceName,</span>
        <span class="c">///</span><span class="c"> DisplayName, Include and Exclude parameters, sorted by ServiceName.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <a id="90b9f72d3dc23081" href="../../R/90b9f72d3dc23081.html" target="n" data-glyph="74,1" class="i method">MatchingServices</a>()
        {
            <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r33 rd" class="r33 r">matchingServices</span>;
            <b>switch</b> (<a href="#0eb6d68c940f9bf0" class="i field">selectionMode</a>)
            {
                <b>case</b> <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a>.<a href="#b796cd202a571141" class="i field">DisplayName</a>:
                    <span class="r33 r">matchingServices</span> = <a href="#e22bd516abbd5841" class="i method">MatchingServicesByDisplayName</a>();
                    <b>break</b>;
                <b>case</b> <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a>.<a href="#f88bb91f2423c984" class="i field">InputObject</a>:
                    <span class="r33 r">matchingServices</span> = <a href="#cfa38f061643184b" class="i method">MatchingServicesByInput</a>();
                    <b>break</b>;
                <b>default</b>:
                    <span class="r33 r">matchingServices</span> = <a href="#38cd72db5b0c2e10" class="i method">MatchingServicesByServiceName</a>();
                    <b>break</b>;
            }
            <span class="c">// 2004/12/16 Note that the services will be sorted</span>
            <span class="c">//  before being stopped.  JimTru confirms that this is OK.</span>
            <span class="r33 r">matchingServices</span>.<span class="i">Sort</span>(<span class="i">ServiceComparison</span>);
            <b>return</b> <span class="r33 r">matchingServices</span>;
        }
 
        <span class="c">// sort by servicename</span>
        <b>private static int</b> <a id="d1d4879bfc8a5d6a" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ServiceComparison</a>(<span class="i">ServiceController</span> <span id="r34 rd" class="r34 r">x</span>, <span class="i">ServiceController</span> <span id="r35 rd" class="r35 r">y</span>)
        {
            <b>return</b> <b>string</b>.<span class="i">Compare</span>(<span class="r34 r">x</span>.<span class="i">ServiceName</span>, <span class="r35 r">y</span>.<span class="i">ServiceName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the list of all services matching the ServiceName,</span>
        <span class="c">///</span><span class="c"> Include and Exclude parameters.</span>
        <span class="c">///</span><span class="c"> Generates a non-terminating error for each specified</span>
        <span class="c">///</span><span class="c"> service name which is not found even though it contains</span>
        <span class="c">///</span><span class="c"> no wildcards.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> We do not use the ServiceController(string serviceName)</span>
        <span class="c">///</span><span class="c"> constructor variant, since the resultant</span>
        <span class="c">///</span><span class="c"> ServiceController.ServiceName is the provided serviceName</span>
        <span class="c">///</span><span class="c"> even when that differs from the real ServiceName by case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <a id="38cd72db5b0c2e10" href="../../R/38cd72db5b0c2e10.html" target="n" data-glyph="76,1" class="i method">MatchingServicesByServiceName</a>()
        {
            <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r36 rd" class="r36 r">matchingServices</span> = <b>new</b>();
 
            <b>if</b> (<a href="#2831c97d8bff6ec6" class="i field">serviceNames</a> == <b>null</b>)
            {
                <b>foreach</b> (<span class="i">ServiceController</span> <span id="r37 rd" class="r37 r">service</span> <b>in</b> <a href="#4be27ecb994e030b" class="i property">AllServices</a>)
                {
                    <a href="#98a6ec778d00596d" class="i method">IncludeExcludeAdd</a>(<span class="r36 r">matchingServices</span>, <span class="r37 r">service</span>, <b>false</b>);
                }
 
                <b>return</b> <span class="r36 r">matchingServices</span>;
            }
 
            <b>foreach</b> (<b>string</b> <span id="r38 rd" class="r38 r">pattern</span> <b>in</b> <a href="#2831c97d8bff6ec6" class="i field">serviceNames</a>)
            {
                <b>bool</b> <span id="r39 rd" class="r39 r">found</span> = <b>false</b>;
 
                <b>if</b> (<span class="i">WildcardPattern</span>.<span class="i">ContainsWildcardCharacters</span>(<span class="r38 r">pattern</span>))
                {
                    <span class="i">WildcardPattern</span> <span id="r40 rd" class="r40 r">wildcard</span> = <span class="i">WildcardPattern</span>.<span class="i">Get</span>(<span class="r38 r">pattern</span>, <span class="i">WildcardOptions</span>.<span class="i">IgnoreCase</span>);
                    <b>foreach</b> (<span class="i">ServiceController</span> <span id="r41 rd" class="r41 r">service</span> <b>in</b> <a href="#4be27ecb994e030b" class="i property">AllServices</a>)
                    {
                        <b>if</b> (!<span class="r40 r">wildcard</span>.<span class="i">IsMatch</span>(<span class="r41 r">service</span>.<span class="i">ServiceName</span>))
                            <b>continue</b>;
                        <span class="r39 r">found</span> = <b>true</b>;
                        <a href="#98a6ec778d00596d" class="i method">IncludeExcludeAdd</a>(<span class="r36 r">matchingServices</span>, <span class="r41 r">service</span>, <b>true</b>);
                    }
                }
                <b>else</b>
                {
                    <span class="i">ServiceController</span> <span id="r42 rd" class="r42 r">service</span> = <a href="#4943e4b81cdca852" class="i method">GetOneService</a>(<span class="r38 r">pattern</span>);
                    <b>if</b> (<span class="r42 r">service</span> != <b>null</b>)
                    {
                        <span class="r39 r">found</span> = <b>true</b>;
                        <a href="#98a6ec778d00596d" class="i method">IncludeExcludeAdd</a>(<span class="r36 r">matchingServices</span>, <span class="r42 r">service</span>, <b>true</b>);
                    }
                }
 
                <b>if</b> (!<span class="r39 r">found</span> &amp;&amp; !<span class="i">WildcardPattern</span>.<span class="i">ContainsWildcardCharacters</span>(<span class="r38 r">pattern</span>))
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r38 r">pattern</span>,
                        <b>string</b>.<span class="i">Empty</span>,
                        <span class="r38 r">pattern</span>,
                        <b>null</b>,
                        <span class="s">&quot;NoServiceFoundForGivenName&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">NoServiceFoundForGivenName</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>);
                }
            }
 
            <b>return</b> <span class="r36 r">matchingServices</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the list of all services matching the DisplayName,</span>
        <span class="c">///</span><span class="c"> Include and Exclude parameters.</span>
        <span class="c">///</span><span class="c"> Generates a non-terminating error for each specified</span>
        <span class="c">///</span><span class="c"> display name which is not found even though it contains</span>
        <span class="c">///</span><span class="c"> no wildcards.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <a id="e22bd516abbd5841" href="../../R/e22bd516abbd5841.html" target="n" data-glyph="76,1" class="i method">MatchingServicesByDisplayName</a>()
        {
            <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r43 rd" class="r43 r">matchingServices</span> = <b>new</b>();
            <b>if</b> (<a href="#a862990125ec214d" class="i property">DisplayName</a> == <b>null</b>)
            {
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;null DisplayName&quot;</span>);
                <b>throw</b> <span class="i">PSTraceSource</span>.<span class="i">NewInvalidOperationException</span>();
            }
 
            <b>foreach</b> (<b>string</b> <span id="r44 rd" class="r44 r">pattern</span> <b>in</b> <a href="#a862990125ec214d" class="i property">DisplayName</a>)
            {
                <span class="i">WildcardPattern</span> <span id="r45 rd" class="r45 r">wildcard</span> =
                    <span class="i">WildcardPattern</span>.<span class="i">Get</span>(<span class="r44 r">pattern</span>, <span class="i">WildcardOptions</span>.<span class="i">IgnoreCase</span>);
                <b>bool</b> <span id="r46 rd" class="r46 r">found</span> = <b>false</b>;
                <b>foreach</b> (<span class="i">ServiceController</span> <span id="r47 rd" class="r47 r">service</span> <b>in</b> <a href="#4be27ecb994e030b" class="i property">AllServices</a>)
                {
                    <b>if</b> (!<span class="r45 r">wildcard</span>.<span class="i">IsMatch</span>(<span class="r47 r">service</span>.<span class="i">DisplayName</span>))
                        <b>continue</b>;
                    <span class="r46 r">found</span> = <b>true</b>;
                    <a href="#98a6ec778d00596d" class="i method">IncludeExcludeAdd</a>(<span class="r43 r">matchingServices</span>, <span class="r47 r">service</span>, <b>true</b>);
                }
 
                <b>if</b> (!<span class="r46 r">found</span> &amp;&amp; !<span class="i">WildcardPattern</span>.<span class="i">ContainsWildcardCharacters</span>(<span class="r44 r">pattern</span>))
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <b>string</b>.<span class="i">Empty</span>,
                        <span class="r44 r">pattern</span>,
                        <span class="r44 r">pattern</span>,
                        <b>null</b>,
                        <span class="s">&quot;NoServiceFoundForGivenDisplayName&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">NoServiceFoundForGivenDisplayName</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>);
                }
            }
 
            <b>return</b> <span class="r43 r">matchingServices</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the list of all services matching the InputObject,</span>
        <span class="c">///</span><span class="c"> Include and Exclude parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <a id="cfa38f061643184b" href="../../R/cfa38f061643184b.html" target="n" data-glyph="76,1" class="i method">MatchingServicesByInput</a>()
        {
            <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r48 rd" class="r48 r">matchingServices</span> = <b>new</b>();
            <b>if</b> (<a href="#f3d105948c20cf0a" class="i property">InputObject</a> == <b>null</b>)
            {
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;null InputObject&quot;</span>);
                <b>throw</b> <span class="i">PSTraceSource</span>.<span class="i">NewInvalidOperationException</span>();
            }
 
            <b>foreach</b> (<span class="i">ServiceController</span> <span id="r49 rd" class="r49 r">service</span> <b>in</b> <a href="#f3d105948c20cf0a" class="i property">InputObject</a>)
            {
                <span class="r49 r">service</span>.<span class="i">Refresh</span>();
                <a href="#98a6ec778d00596d" class="i method">IncludeExcludeAdd</a>(<span class="r48 r">matchingServices</span>, <span class="r49 r">service</span>, <b>false</b>);
            }
 
            <b>return</b> <span class="r48 r">matchingServices</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">service</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">list</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> but only if it passes the Include and Exclude filters (if present)</span>
        <span class="c">///</span><span class="c"> and (if </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">checkDuplicates</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">) if it is not</span>
        <span class="c">///</span><span class="c"> already on  </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">list</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">list</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">List of services.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">service</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service to add to list.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">checkDuplicates</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Check list for duplicates.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="98a6ec778d00596d" href="../../R/98a6ec778d00596d.html" target="n" data-glyph="76,1" class="i method">IncludeExcludeAdd</a>(
            <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r51 rd" class="r51 r">list</span>,
            <span class="i">ServiceController</span> <span id="r50 rd" class="r50 r">service</span>,
            <b>bool</b> <span id="r52 rd" class="r52 r">checkDuplicates</span>)
        {
            <b>if</b> (<a href="#2b687a2acc191006" class="i field">include</a> != <b>null</b> &amp;&amp; !<a href="#c457d147fa035729" class="i method">Matches</a>(<span class="r50 r">service</span>, <a href="#2b687a2acc191006" class="i field">include</a>))
                <b>return</b>;
            <b>if</b> (<a href="#d99662abfe322e43" class="i field">exclude</a> != <b>null</b> &amp;&amp; <a href="#c457d147fa035729" class="i method">Matches</a>(<span class="r50 r">service</span>, <a href="#d99662abfe322e43" class="i field">exclude</a>))
                <b>return</b>;
            <b>if</b> (<span class="r52 r">checkDuplicates</span>)
            {
                <b>foreach</b> (<span class="i">ServiceController</span> <span id="r53 rd" class="r53 r">sc</span> <b>in</b> <span class="r51 r">list</span>)
                {
                    <b>if</b> (<span class="r53 r">sc</span>.<span class="i">ServiceName</span> == <span class="r50 r">service</span>.<span class="i">ServiceName</span> &amp;&amp;
                        <span class="r53 r">sc</span>.<span class="i">MachineName</span> == <span class="r50 r">service</span>.<span class="i">MachineName</span>)
                    {
                        <b>return</b>;
                    }
                }
            }
 
            <span class="r51 r">list</span>.<span class="i">Add</span>(<span class="r50 r">service</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check whether </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">service</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> matches the list of</span>
        <span class="c">///</span><span class="c"> patterns in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">matchList</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">service</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">matchList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="c457d147fa035729" href="../../R/c457d147fa035729.html" target="n" data-glyph="76,1" class="i method">Matches</a>(<span class="i">ServiceController</span> <span id="r54 rd" class="r54 r">service</span>, <b>string</b>[] <span id="r55 rd" class="r55 r">matchList</span>)
        {
            <b>if</b> (<span class="r55 r">matchList</span> == <b>null</b>)
                <b>throw</b> <span class="i">PSTraceSource</span>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r55 r">matchList</span>));
            <b>string</b> <span id="r56 rd" class="r56 r">serviceID</span> = (<a href="#0eb6d68c940f9bf0" class="i field">selectionMode</a> == <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a>.<a href="#b796cd202a571141" class="i field">DisplayName</a>)
                                ? <span class="r54 r">service</span>.<span class="i">DisplayName</span>
                                : <span class="r54 r">service</span>.<span class="i">ServiceName</span>;
            <b>foreach</b> (<b>string</b> <span id="r57 rd" class="r57 r">pattern</span> <b>in</b> <span class="r55 r">matchList</span>)
            {
                <span class="i">WildcardPattern</span> <span id="r58 rd" class="r58 r">wildcard</span> = <span class="i">WildcardPattern</span>.<span class="i">Get</span>(<span class="r57 r">pattern</span>, <span class="i">WildcardOptions</span>.<span class="i">IgnoreCase</span>);
                <b>if</b> (<span class="r58 r">wildcard</span>.<span class="i">IsMatch</span>(<span class="r56 r">serviceID</span>))
                    <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal
 
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> MultipleServiceCommandBase
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> GetServiceCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the get-service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsCommon</span>.<span class="i">Get</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Default&quot;</span>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096496&quot;</span>, <span class="i">RemotingCapability</span> = <span class="i">RemotingCapability</span>.<span class="i">SupportedByCommand</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public sealed class</b> <a id="15878888fc2bb341" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="6d5648252c3657ea">GetServiceCommand</span></a> : <a href="#91bb2f677096cd68" class="t t">MultipleServiceCommandBase</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets/sets an array of service names.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ServiceName parameter is declared in subclasses,</span>
        <span class="c">///</span><span class="c"> since it is optional for GetService and mandatory otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>()]
        [<span class="i">Alias</span>(<span class="s">&quot;ServiceName&quot;</span>)]
        <b>public string</b>[] <a id="4372c2a8653b0ee0" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2831c97d8bff6ec6" class="i field">serviceNames</a>;
            }
 
            <b>set</b>
            {
                <a href="#2831c97d8bff6ec6" class="i field">serviceNames</a> = <b>value</b>;
                <a href="#0eb6d68c940f9bf0" class="i field">selectionMode</a> = <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a>.<a href="#542eeb216034a42b" class="i field">ServiceName</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This returns the DependentServices of the specified service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;DS&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="1458136c476dd9b7" href="../../R/1458136c476dd9b7.html" target="n" data-glyph="102,1" class="i property">DependentServices</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This returns the ServicesDependedOn of the specified service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;SDO&quot;</span>, <span class="s">&quot;ServicesDependedOn&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="e7c60a7be2e5c748" href="../../R/e7c60a7be2e5c748.html" target="n" data-glyph="102,1" class="i property">RequiredServices</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Write the service objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="de45b45a49d14417" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">ServiceController</span> <span id="r59 rd" class="r59 r">service</span> <b>in</b> <a href="#90b9f72d3dc23081" class="i method">MatchingServices</a>())
            {
                <b>if</b> (!<a href="#1458136c476dd9b7" class="i property">DependentServices</a>.<span class="i">IsPresent</span> &amp;&amp; !<a href="#e7c60a7be2e5c748" class="i property">RequiredServices</a>.<span class="i">IsPresent</span>)
                {
                    <span class="i">WriteObject</span>(<a href="#af447dac04e339d7" class="i method">AddProperties</a>(<span class="r59 r">service</span>));
                }
                <b>else</b>
                {
                    <b>if</b> (<a href="#1458136c476dd9b7" class="i property">DependentServices</a>.<span class="i">IsPresent</span>)
                    {
                        <b>foreach</b> (<span class="i">ServiceController</span> <span id="r60 rd" class="r60 r">dependantserv</span> <b>in</b> <span class="r59 r">service</span>.<span class="i">DependentServices</span>)
                        {
                            <span class="i">WriteObject</span>(<span class="r60 r">dependantserv</span>);
                        }
                    }
 
                    <b>if</b> (<a href="#e7c60a7be2e5c748" class="i property">RequiredServices</a>.<span class="i">IsPresent</span>)
                    {
                        <b>foreach</b> (<span class="i">ServiceController</span> <span id="r61 rd" class="r61 r">servicedependedon</span> <b>in</b> <span class="r59 r">service</span>.<span class="i">ServicesDependedOn</span>)
                        {
                            <span class="i">WriteObject</span>(<span class="r61 r">servicedependedon</span>);
                        }
                    }
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds UserName, Description, BinaryPathName, DelayedAutoStart and StartupType to a ServiceController object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">service</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">ServiceController as PSObject with UserName, Description and StartupType added.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">PSObject</span> <a id="af447dac04e339d7" href="../../R/af447dac04e339d7.html" target="n" data-glyph="76,1" class="i method">AddProperties</a>(<span class="i">ServiceController</span> <span id="r62 rd" class="r62 r">service</span>)
        {
            <span class="i">NakedWin32Handle</span> <span id="r63 rd" class="r63 r">hScManager</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="i">NakedWin32Handle</span> <span id="r64 rd" class="r64 r">hService</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <b>int</b> <span id="r65 rd" class="r65 r">lastError</span> = 0;
            <span class="i">PSObject</span> <span id="r66 rd" class="r66 r">serviceAsPSObj</span> = <span class="i">PSObject</span>.<span class="i">AsPSObject</span>(<span class="r62 r">service</span>);
            <b>try</b>
            {
                <span class="r63 r">hScManager</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">OpenSCManagerW</span>(
                    <span class="i">lpMachineName</span>: <span class="r62 r">service</span>.<span class="i">MachineName</span>,
                    <span class="i">lpDatabaseName</span>: <b>null</b>,
                    <span class="i">dwDesiredAccess</span>: <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#cf1f86e8f9eac5f7" class="i field">SC_MANAGER_CONNECT</a>
                );
                <b>if</b> (<span class="r63 r">hScManager</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="r65 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                    <span class="i">Win32Exception</span> <span id="r67 rd" class="r67 r">exception</span> = <b>new</b>(<span class="r65 r">lastError</span>);
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r62 r">service</span>,
                        <span class="r67 r">exception</span>,
                        <span class="s">&quot;FailToOpenServiceControlManager&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">FailToOpenServiceControlManager</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                }
 
                <span class="r64 r">hService</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">OpenServiceW</span>(
                    <span class="r63 r">hScManager</span>,
                    <span class="r62 r">service</span>.<span class="i">ServiceName</span>,
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#7c7a1ea429d0023f" class="i field">SERVICE_QUERY_CONFIG</a>
                );
                <b>if</b> (<span class="r64 r">hService</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="r65 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                    <span class="i">Win32Exception</span> <span id="r68 rd" class="r68 r">exception</span> = <b>new</b>(<span class="r65 r">lastError</span>);
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r62 r">service</span>,
                        <span class="r68 r">exception</span>,
                        <span class="s">&quot;CouldNotGetServiceInfo&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotGetServiceInfo</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                }
 
                <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#2bc1098513f803dc" class="t t">SERVICE_DESCRIPTIONW</a> <span id="r69 rd" class="r69 r">description</span> = <b>new</b>();
                <b>bool</b> <span id="r70 rd" class="r70 r">querySuccessful</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#08f44942f5e802fd" class="i method">QueryServiceConfig2</a>&lt;<a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#2bc1098513f803dc" class="t t">SERVICE_DESCRIPTIONW</a>&gt;(<span class="r64 r">hService</span>, <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#751c9d4dde3dfee0" class="i field">SERVICE_CONFIG_DESCRIPTION</a>, <b>out</b> <span class="r69 r">description</span>);
 
                <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b5b0e1e4dd1950a7" class="t t">SERVICE_DELAYED_AUTO_START_INFO</a> <span id="r71 rd" class="r71 r">autostartInfo</span> = <b>new</b>();
                <span class="r70 r">querySuccessful</span> = <span class="r70 r">querySuccessful</span> &amp;&amp; <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#08f44942f5e802fd" class="i method">QueryServiceConfig2</a>&lt;<a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b5b0e1e4dd1950a7" class="t t">SERVICE_DELAYED_AUTO_START_INFO</a>&gt;(<span class="r64 r">hService</span>, <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#2ce69483ff46c549" class="i field">SERVICE_CONFIG_DELAYED_AUTO_START_INFO</a>, <b>out</b> <span class="r71 r">autostartInfo</span>);
 
                <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b356145bb2f724c7" class="t t">QUERY_SERVICE_CONFIG</a> <span id="r72 rd" class="r72 r">serviceInfo</span> = <b>new</b>();
                <span class="r70 r">querySuccessful</span> = <span class="r70 r">querySuccessful</span> &amp;&amp; <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#90f99ef4595f1804" class="i method">QueryServiceConfig</a>(<span class="r64 r">hService</span>, <b>out</b> <span class="r72 r">serviceInfo</span>);
 
                <b>if</b> (!<span class="r70 r">querySuccessful</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="i">service</span>: <span class="r62 r">service</span>,
                        <span class="i">innerException</span>: <b>null</b>,
                        <span class="i">errorId</span>: <span class="s">&quot;CouldNotGetServiceInfo&quot;</span>,
                        <span class="i">errorMessage</span>: <span class="i">ServiceResources</span>.<span class="i">CouldNotGetServiceInfo</span>,
                        <span class="i">category</span>: <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>
                        );
                }
 
                <span class="i">PSProperty</span> <span id="r73 rd" class="r73 r">noteProperty</span> = <b>new</b>(<span class="s">&quot;UserName&quot;</span>, <span class="r72 r">serviceInfo</span>.<a href="#246e55e03fee905e" class="i field">lpServiceStartName</a>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">Properties</span>.<span class="i">Add</span>(<span class="r73 r">noteProperty</span>, <b>true</b>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">TypeNames</span>.<span class="i">Insert</span>(0, <span class="s">&quot;System.Service.ServiceController#UserName&quot;</span>);
 
                <span class="r73 r">noteProperty</span> = <b>new</b> <span class="i">PSProperty</span>(<span class="s">&quot;Description&quot;</span>, <span class="r69 r">description</span>.<a href="#c52c6d443408a75f" class="i field">lpDescription</a>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">Properties</span>.<span class="i">Add</span>(<span class="r73 r">noteProperty</span>, <b>true</b>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">TypeNames</span>.<span class="i">Insert</span>(0, <span class="s">&quot;System.Service.ServiceController#Description&quot;</span>);
 
                <span class="r73 r">noteProperty</span> = <b>new</b> <span class="i">PSProperty</span>(<span class="s">&quot;DelayedAutoStart&quot;</span>, <span class="r71 r">autostartInfo</span>.<a href="#b1bd34dde2957ded" class="i field">fDelayedAutostart</a>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">Properties</span>.<span class="i">Add</span>(<span class="r73 r">noteProperty</span>, <b>true</b>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">TypeNames</span>.<span class="i">Insert</span>(0, <span class="s">&quot;System.Service.ServiceController#DelayedAutoStart&quot;</span>);
 
                <span class="r73 r">noteProperty</span> = <b>new</b> <span class="i">PSProperty</span>(<span class="s">&quot;BinaryPathName&quot;</span>, <span class="r72 r">serviceInfo</span>.<a href="#f8c9f4583b705728" class="i field">lpBinaryPathName</a>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">Properties</span>.<span class="i">Add</span>(<span class="r73 r">noteProperty</span>, <b>true</b>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">TypeNames</span>.<span class="i">Insert</span>(0, <span class="s">&quot;System.Service.ServiceController#BinaryPathName&quot;</span>);
 
                <span class="r73 r">noteProperty</span> = <b>new</b> <span class="i">PSProperty</span>(<span class="s">&quot;StartupType&quot;</span>, <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">GetServiceStartupType</span>(<span class="r62 r">service</span>.<span class="i">StartType</span>, <span class="r71 r">autostartInfo</span>.<a href="#b1bd34dde2957ded" class="i field">fDelayedAutostart</a>));
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">Properties</span>.<span class="i">Add</span>(<span class="r73 r">noteProperty</span>, <b>true</b>);
                <span class="r66 r">serviceAsPSObj</span>.<span class="i">TypeNames</span>.<span class="i">Insert</span>(0, <span class="s">&quot;System.Service.ServiceController#StartupType&quot;</span>);
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r64 r">hService</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <b>bool</b> <span id="r74 rd" class="r74 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r64 r">hService</span>);
                    <b>if</b> (!<span class="r74 r">succeeded</span>)
                    {
                        <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<span class="r65 r">lastError</span> != 0, <span class="s">&quot;ErrorCode not success&quot;</span>);
                    }
                }
 
                <b>if</b> (<span class="r63 r">hScManager</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <b>bool</b> <span id="r75 rd" class="r75 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r63 r">hScManager</span>);
                    <b>if</b> (!<span class="r75 r">succeeded</span>)
                    {
                        <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<span class="r65 r">lastError</span> != 0, <span class="s">&quot;ErrorCode not success&quot;</span>);
                    }
                }
            }
 
            <b>return</b> <span class="r66 r">serviceAsPSObj</span>;
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> GetServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ServiceOperationBaseCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the base for service commands which actually</span>
    <span class="c">///</span><span class="c"> act on the service(s).</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public abstract class</b> <a id="e7306fe585e82503" href="../../R/e7306fe585e82503.html" target="n" data-glyph="0,0" class="t t"><span id="8236902c6ab6eb4c">ServiceOperationBaseCommand</span></a> : <a href="#91bb2f677096cd68" class="t t">MultipleServiceCommandBase</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets/sets an array of service names.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ServiceName parameter is declared in subclasses,</span>
        <span class="c">///</span><span class="c"> since it is optional for GetService and mandatory otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>, <span class="i">Mandatory</span> = <b>true</b>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ServiceName&quot;</span>)]
        <b>public string</b>[] <a id="77a99a028c5df91f" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2831c97d8bff6ec6" class="i field">serviceNames</a>;
            }
 
            <b>set</b>
            {
                <a href="#2831c97d8bff6ec6" class="i field">serviceNames</a> = <b>value</b>;
                <a href="#0eb6d68c940f9bf0" class="i field">selectionMode</a> = <a href="#bae6babcf88f8d58" class="t t">SelectionMode</a>.<a href="#542eeb216034a42b" class="i field">ServiceName</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Service controller objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public</b> <b>new</b> <span class="i">ServiceController</span>[] <a id="81221ad02857ce01" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">InputObject</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#91bb2f677096cd68" class="k">base</a>.<a href="#f3d105948c20cf0a" class="i property">InputObject</a>;
            }
 
            <b>set</b>
            {
                <a href="#91bb2f677096cd68" class="k">base</a>.<a href="#f3d105948c20cf0a" class="i property">InputObject</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies whether to write the objects successfully operated upon</span>
        <span class="c">///</span><span class="c"> to the success stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="7b09cbd97b74f47b" href="../../R/7b09cbd97b74f47b.html" target="n" data-glyph="102,1" class="i property">PassThru</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Waits forever for the service to reach the desired status, but</span>
        <span class="c">///</span><span class="c"> writes a string to WriteWarning every 2 seconds.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">serviceController</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service on which to operate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">targetStatus</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Desired status.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">pendingStatus</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the expected status while the operation is incomplete.</span>
        <span class="c">///</span><span class="c"> If the service is in some other state, this means that the</span>
        <span class="c">///</span><span class="c"> operation failed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">resourceIdPending</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> resourceId for a string to be written to verbose stream</span>
        <span class="c">///</span><span class="c"> every 2 seconds</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">errorId</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> errorId for a nonterminating error if operation fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">  </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">errorMessage</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> errorMessage for a nonterminating error if operation fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if action succeeded.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">PipelineStoppedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> WriteWarning will throw this if the pipeline has been stopped.</span>
        <span class="c">///</span><span class="c"> This means that the delay between hitting CTRL-C and stopping</span>
        <span class="c">///</span><span class="c"> the cmdlet should be 2 seconds at most.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="14f23a8f1132b19d" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">DoWaitForStatus</a>(
            <span class="i">ServiceController</span> <span id="r76 rd" class="r76 r">serviceController</span>,
            <span class="i">ServiceControllerStatus</span> <span id="r77 rd" class="r77 r">targetStatus</span>,
            <span class="i">ServiceControllerStatus</span> <span id="r78 rd" class="r78 r">pendingStatus</span>,
            <b>string</b> <span id="r79 rd" class="r79 r">resourceIdPending</span>,
            <b>string</b> <span id="r80 rd" class="r80 r">errorId</span>,
            <b>string</b> <span id="r81 rd" class="r81 r">errorMessage</span>)
        {
            <b>while</b> (<b>true</b>)
            {
                <b>try</b>
                {
                    <span class="c">// ServiceController.Start will return before the service is actually started</span>
                    <span class="c">// This API will wait forever</span>
                    <span class="r76 r">serviceController</span>.<span class="i">WaitForStatus</span>(
                        <span class="r77 r">targetStatus</span>,
                        <b>new</b> <span class="i">TimeSpan</span>(20000000) <span class="c">// 2 seconds</span>
                        );
                    <b>return</b> <b>true</b>; <span class="c">// service reached target status</span>
                }
                <b>catch</b> (<span class="i">System</span>.<span class="i">ServiceProcess</span>.<span class="i">TimeoutException</span>) <span class="c">// still waiting</span>
                {
                    <b>if</b> (<span class="r76 r">serviceController</span>.<span class="i">Status</span> != <span class="r78 r">pendingStatus</span>
                        <span class="c">// NTRAID#Windows Out Of Band Releases-919945-2005/09/27-JonN</span>
                        <span class="c">// Close window where service could complete at</span>
                        <span class="c">// just the wrong time</span>
                        &amp;&amp; <span class="r76 r">serviceController</span>.<span class="i">Status</span> != <span class="r77 r">targetStatus</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r76 r">serviceController</span>, <b>null</b>,
                                                 <span class="r80 r">errorId</span>,
                                                 <span class="r81 r">errorMessage</span>,
                                                 <span class="i">ErrorCategory</span>.<span class="i">OpenError</span>);
                        <b>return</b> <b>false</b>;
                    }
 
                    <b>string</b> <span id="r82 rd" class="r82 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="r79 r">resourceIdPending</span>,
                        <span class="r76 r">serviceController</span>.<span class="i">ServiceName</span>,
                        <span class="r76 r">serviceController</span>.<span class="i">DisplayName</span>
                        );
                    <span class="c">// will throw PipelineStoppedException if user hit CTRL-C</span>
                    <span class="i">WriteWarning</span>(<span class="r82 r">message</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This will start the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">serviceController</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service to start.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True iff the service was started.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="588751cf782445d4" href="../../R/588751cf782445d4.html" target="n" data-glyph="74,1" class="i method">DoStartService</a>(<span class="i">ServiceController</span> <span id="r83 rd" class="r83 r">serviceController</span>)
        {
            <span class="i">Exception</span> <span id="r84 rd" class="r84 r">exception</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r83 r">serviceController</span>.<span class="i">Start</span>();
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r85 rd" class="r85 r">e</span>)
            {
                <b>if</b> (<span class="r85 r">e</span>.<span class="i">NativeErrorCode</span> != <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#6697684b555eb3ff" class="i field">ERROR_SERVICE_ALREADY_RUNNING</a>)
                    <span class="r84 r">exception</span> = <span class="r85 r">e</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r86 rd" class="r86 r">e</span>)
            {
                <span class="i">Win32Exception</span> <span id="r87 rd" class="r87 r">eInner</span> = <span class="r86 r">e</span>.<span class="i">InnerException</span> <b>as</b> <span class="i">Win32Exception</span>;
                <b>if</b> (<span class="r87 r">eInner</span> == <b>null</b>
                    || <span class="r87 r">eInner</span>.<span class="i">NativeErrorCode</span> != <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#6697684b555eb3ff" class="i field">ERROR_SERVICE_ALREADY_RUNNING</a>)
                {
                    <span class="r84 r">exception</span> = <span class="r86 r">e</span>;
                }
            }
 
            <b>if</b> (<span class="r84 r">exception</span> != <b>null</b>)
            {
                <span class="c">// This service refused to accept the start command,</span>
                <span class="c">// so write a non-terminating error.</span>
                <span class="i">WriteNonTerminatingError</span>(<span class="r83 r">serviceController</span>,
                    <span class="r84 r">exception</span>,
                    <span class="s">&quot;CouldNotStartService&quot;</span>,
                    <span class="i">ServiceResources</span>.<span class="i">CouldNotStartService</span>,
                    <span class="i">ErrorCategory</span>.<span class="i">OpenError</span>);
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// ServiceController.Start will return</span>
            <span class="c">// before the service is actually started.</span>
            <b>if</b> (!<span class="i">DoWaitForStatus</span>(
                <span class="r83 r">serviceController</span>,
                <span class="i">ServiceControllerStatus</span>.<span class="i">Running</span>,
                <span class="i">ServiceControllerStatus</span>.<span class="i">StartPending</span>,
                <span class="i">ServiceResources</span>.<span class="i">StartingService</span>,
                <span class="s">&quot;StartServiceFailed&quot;</span>,
                <span class="i">ServiceResources</span>.<span class="i">StartServiceFailed</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This will stop the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r88 r">serviceController</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service to stop.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r89 r">force</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Stop dependent services.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r90 r">waitForServiceToStop</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True iff the service was stopped.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <a id="072c0c62b8a290be" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">DoStopService</a>(<span class="i">ServiceController</span> <span id="r88 rd" class="r88 r">serviceController</span>, <b>bool</b> <span id="r89 rd" class="r89 r">force</span>, <b>bool</b> <span id="r90 rd" class="r90 r">waitForServiceToStop</span>)
        {
            <span class="c">// Ignore ServiceController.CanStop.  CanStop will be set false</span>
            <span class="c">// if the service is not running, but this is not an error.</span>
 
            <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r91 rd" class="r91 r">stoppedServices</span> = <b>new</b>();
            <span class="i">ServiceController</span>[] <span id="r92 rd" class="r92 r">dependentServices</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="r92 r">dependentServices</span> = <span class="r88 r">serviceController</span>.<span class="i">DependentServices</span>;
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r93 rd" class="r93 r">e</span>)
            {
                <span class="i">WriteNonTerminatingError</span>(<span class="r88 r">serviceController</span>, <span class="r93 r">e</span>,
                    <span class="s">&quot;CouldNotAccessDependentServices&quot;</span>,
                    <span class="i">ServiceResources</span>.<span class="i">CouldNotAccessDependentServices</span>,
                    <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r94 rd" class="r94 r">e</span>)
            {
                <span class="i">WriteNonTerminatingError</span>(<span class="r88 r">serviceController</span>, <span class="r94 r">e</span>,
                    <span class="s">&quot;CouldNotAccessDependentServices&quot;</span>,
                    <span class="i">ServiceResources</span>.<span class="i">CouldNotAccessDependentServices</span>,
                    <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
            }
 
            <b>if</b> (!<span class="r89 r">force</span>)
            {
                <b>if</b> ((<span class="r92 r">dependentServices</span> != <b>null</b>)
                    &amp;&amp; (<span class="r92 r">dependentServices</span>.<span class="i">Length</span> &gt; 0))
                {
                    <span class="c">// Check if all dependent services are stopped</span>
                    <b>if</b> (!<a href="#1221213da951e133" class="i method">HaveAllDependentServicesStopped</a>(<span class="r92 r">dependentServices</span>))
                    {
                        <span class="c">// This service has dependent services</span>
                        <span class="c">//  and the force flag is not specified.</span>
                        <span class="c">//  Add a non-critical error for it.</span>
                        <span class="i">WriteNonTerminatingError</span>(<span class="r88 r">serviceController</span>,
                        <b>null</b>,
                        <span class="s">&quot;ServiceHasDependentServices&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">ServiceHasDependentServices</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
 
                        <b>return</b> <span class="r91 r">stoppedServices</span>;
                    }
                }
            }
 
            <b>if</b> (<span class="r92 r">dependentServices</span> != <b>null</b>)
            {
                <b>foreach</b> (<span class="i">ServiceController</span> <span id="r95 rd" class="r95 r">service</span> <b>in</b> <span class="r92 r">dependentServices</span>)
                {
                    <b>if</b> ((<span class="r95 r">service</span>.<span class="i">Status</span> == <span class="i">ServiceControllerStatus</span>.<span class="i">Running</span> ||
                        <span class="r95 r">service</span>.<span class="i">Status</span> == <span class="i">ServiceControllerStatus</span>.<span class="i">StartPending</span>) &amp;&amp;
                        <span class="r95 r">service</span>.<span class="i">CanStop</span>)
                    {
                        <span class="r91 r">stoppedServices</span>.<span class="i">Add</span>(<span class="r95 r">service</span>);
                    }
                }
            }
 
            <span class="i">Exception</span> <span id="r96 rd" class="r96 r">exception</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r88 r">serviceController</span>.<span class="i">Stop</span>();
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r97 rd" class="r97 r">e</span>)
            {
                <b>if</b> (<span class="r97 r">e</span>.<span class="i">NativeErrorCode</span> != <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#77719ea4b336f8e0" class="i field">ERROR_SERVICE_NOT_ACTIVE</a>)
                    <span class="r96 r">exception</span> = <span class="r97 r">e</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r98 rd" class="r98 r">e</span>)
            {
                <span class="i">Win32Exception</span> <span id="r99 rd" class="r99 r">eInner</span> =
                    <span class="r98 r">e</span>.<span class="i">InnerException</span> <b>as</b> <span class="i">Win32Exception</span>;
                <b>if</b> (<span class="r99 r">eInner</span> == <b>null</b>
                    || <span class="r99 r">eInner</span>.<span class="i">NativeErrorCode</span> != <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#77719ea4b336f8e0" class="i field">ERROR_SERVICE_NOT_ACTIVE</a>)
                {
                    <span class="r96 r">exception</span> = <span class="r98 r">e</span>;
                }
            }
 
            <b>if</b> (<span class="r96 r">exception</span> != <b>null</b>)
            {
                <span class="c">// This service refused to accept the stop command,</span>
                <span class="c">// so write a non-terminating error.</span>
                <span class="i">WriteNonTerminatingError</span>(<span class="r88 r">serviceController</span>,
                    <span class="r96 r">exception</span>,
                    <span class="s">&quot;CouldNotStopService&quot;</span>,
                    <span class="i">ServiceResources</span>.<span class="i">CouldNotStopService</span>,
                    <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                <a href="#c509735cfa091826" class="i method">RemoveNotStoppedServices</a>(<span class="r91 r">stoppedServices</span>);
                <b>return</b> <span class="r91 r">stoppedServices</span>;
            }
 
            <span class="c">// ServiceController.Stop will return</span>
            <span class="c">//  before the service is actually stopped.</span>
            <b>if</b> (<span class="r90 r">waitForServiceToStop</span>)
            {
                <b>if</b> (!<span class="i">DoWaitForStatus</span>(
                    <span class="r88 r">serviceController</span>,
                    <span class="i">ServiceControllerStatus</span>.<span class="i">Stopped</span>,
                    <span class="i">ServiceControllerStatus</span>.<span class="i">StopPending</span>,
                    <span class="i">ServiceResources</span>.<span class="i">StoppingService</span>,
                    <span class="s">&quot;StopServiceFailed&quot;</span>,
                    <span class="i">ServiceResources</span>.<span class="i">StopServiceFailed</span>))
                {
                    <a href="#c509735cfa091826" class="i method">RemoveNotStoppedServices</a>(<span class="r91 r">stoppedServices</span>);
                    <b>return</b> <span class="r91 r">stoppedServices</span>;
                }
            }
 
            <a href="#c509735cfa091826" class="i method">RemoveNotStoppedServices</a>(<span class="r91 r">stoppedServices</span>);
            <b>if</b> ((<span class="r88 r">serviceController</span>.<span class="i">Status</span>.<span class="i">Equals</span>(<span class="i">ServiceControllerStatus</span>.<span class="i">Stopped</span>)) || (<span class="r88 r">serviceController</span>.<span class="i">Status</span>.<span class="i">Equals</span>(<span class="i">ServiceControllerStatus</span>.<span class="i">StopPending</span>)))
            {
                <span class="r91 r">stoppedServices</span>.<span class="i">Add</span>(<span class="r88 r">serviceController</span>);
            }
 
            <b>return</b> <span class="r91 r">stoppedServices</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if all dependent services are stopped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">dependentServices</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if all dependent services are stopped</span>
        <span class="c">///</span><span class="c"> False if not all dependent services are stopped</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="1221213da951e133" href="../../R/1221213da951e133.html" target="n" data-glyph="76,1" class="i method">HaveAllDependentServicesStopped</a>(<span class="i">ServiceController</span>[] <span id="r100 rd" class="r100 r">dependentServices</span>)
        {
            <b>return</b> <span class="i">Array</span>.<span class="i">TrueForAll</span>(<span class="r100 r">dependentServices</span>, <b>static</b> <span id="r101 rd" class="r101 r">service</span> =&gt; <span class="r101 r">service</span>.<span class="i">Status</span> == <span class="i">ServiceControllerStatus</span>.<span class="i">Stopped</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This removes all services that are not stopped from a list of services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">services</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A list of services.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="c509735cfa091826" href="../../R/c509735cfa091826.html" target="n" data-glyph="74,1" class="i method">RemoveNotStoppedServices</a>(<span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r102 rd" class="r102 r">services</span>)
        {
            <span class="c">// You shall not modify a collection during enumeration.</span>
            <span class="r102 r">services</span>.<span class="i">RemoveAll</span>(<span id="r103 rd" class="r103 r">service</span> =&gt;
                <span class="r103 r">service</span>.<span class="i">Status</span> != <span class="i">ServiceControllerStatus</span>.<span class="i">Stopped</span> &amp;&amp;
                <span class="r103 r">service</span>.<span class="i">Status</span> != <span class="i">ServiceControllerStatus</span>.<span class="i">StopPending</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This will pause the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">serviceController</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service to pause.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True iff the service was paused.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="5a28e36868635dad" href="../../R/5a28e36868635dad.html" target="n" data-glyph="74,1" class="i method">DoPauseService</a>(<span class="i">ServiceController</span> <span id="r104 rd" class="r104 r">serviceController</span>)
        {
            <span class="i">Exception</span> <span id="r105 rd" class="r105 r">exception</span> = <b>null</b>;
            <b>bool</b> <span id="r106 rd" class="r106 r">serviceNotRunning</span> = <b>false</b>;
            <b>try</b>
            {
                <span class="r104 r">serviceController</span>.<span class="i">Pause</span>();
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r107 rd" class="r107 r">e</span>)
            {
                <b>if</b> (<span class="r107 r">e</span>.<span class="i">NativeErrorCode</span> == <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#77719ea4b336f8e0" class="i field">ERROR_SERVICE_NOT_ACTIVE</a>)
                {
                    <span class="r106 r">serviceNotRunning</span> = <b>true</b>;
                }
 
                <span class="r105 r">exception</span> = <span class="r107 r">e</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r108 rd" class="r108 r">e</span>)
            {
                <span class="i">Win32Exception</span> <span id="r109 rd" class="r109 r">eInner</span> = <span class="r108 r">e</span>.<span class="i">InnerException</span> <b>as</b> <span class="i">Win32Exception</span>;
                <b>if</b> (<span class="r109 r">eInner</span> != <b>null</b>
                    &amp;&amp; <span class="r109 r">eInner</span>.<span class="i">NativeErrorCode</span> == <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#77719ea4b336f8e0" class="i field">ERROR_SERVICE_NOT_ACTIVE</a>)
                {
                    <span class="r106 r">serviceNotRunning</span> = <b>true</b>;
                }
 
                <span class="r105 r">exception</span> = <span class="r108 r">e</span>;
            }
 
            <b>if</b> (<span class="r105 r">exception</span> != <b>null</b>)
            {
                <span class="c">// This service refused to accept the pause command,</span>
                <span class="c">// so write a non-terminating error.</span>
                <b>string</b> <span id="r110 rd" class="r110 r">resourceIdAndErrorId</span> = <span class="i">ServiceResources</span>.<span class="i">CouldNotSuspendService</span>;
                <b>if</b> (<span class="r106 r">serviceNotRunning</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r104 r">serviceController</span>,
                        <span class="r105 r">exception</span>,
                        <span class="s">&quot;CouldNotSuspendServiceNotRunning&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotSuspendServiceNotRunning</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                }
                <b>else</b> <b>if</b> (!<span class="r104 r">serviceController</span>.<span class="i">CanPauseAndContinue</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r104 r">serviceController</span>,
                        <span class="r105 r">exception</span>,
                        <span class="s">&quot;CouldNotSuspendServiceNotSupported&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotSuspendServiceNotSupported</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                }
 
                <span class="i">WriteNonTerminatingError</span>(<span class="r104 r">serviceController</span>,
                    <span class="r105 r">exception</span>,
                    <span class="s">&quot;CouldNotSuspendService&quot;</span>,
                    <span class="i">ServiceResources</span>.<span class="i">CouldNotSuspendService</span>,
                    <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
 
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// ServiceController.Pause will return</span>
            <span class="c">// before the service is actually paused.</span>
            <b>if</b> (!<span class="i">DoWaitForStatus</span>(
                <span class="r104 r">serviceController</span>,
                <span class="i">ServiceControllerStatus</span>.<span class="i">Paused</span>,
                <span class="i">ServiceControllerStatus</span>.<span class="i">PausePending</span>,
                <span class="i">ServiceResources</span>.<span class="i">SuspendingService</span>,
                <span class="s">&quot;SuspendServiceFailed&quot;</span>,
                <span class="i">ServiceResources</span>.<span class="i">SuspendServiceFailed</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This will resume the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">serviceController</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Service to resume.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True iff the service was resumed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="dd595913dbfb0f9c" href="../../R/dd595913dbfb0f9c.html" target="n" data-glyph="74,1" class="i method">DoResumeService</a>(<span class="i">ServiceController</span> <span id="r111 rd" class="r111 r">serviceController</span>)
        {
            <span class="i">Exception</span> <span id="r112 rd" class="r112 r">exception</span> = <b>null</b>;
            <b>bool</b> <span id="r113 rd" class="r113 r">serviceNotRunning</span> = <b>false</b>;
            <b>try</b>
            {
                <span class="r111 r">serviceController</span>.<span class="i">Continue</span>();
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r114 rd" class="r114 r">e</span>)
            {
                <b>if</b> (<span class="r114 r">e</span>.<span class="i">NativeErrorCode</span> == <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#77719ea4b336f8e0" class="i field">ERROR_SERVICE_NOT_ACTIVE</a>)
                {
                    <span class="r113 r">serviceNotRunning</span> = <b>true</b>;
                }
 
                <span class="r112 r">exception</span> = <span class="r114 r">e</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r115 rd" class="r115 r">e</span>)
            {
                <span class="i">Win32Exception</span> <span id="r116 rd" class="r116 r">eInner</span> = <span class="r115 r">e</span>.<span class="i">InnerException</span> <b>as</b> <span class="i">Win32Exception</span>;
                <b>if</b> (<span class="r116 r">eInner</span> != <b>null</b>
                    &amp;&amp; <span class="r116 r">eInner</span>.<span class="i">NativeErrorCode</span> == <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#77719ea4b336f8e0" class="i field">ERROR_SERVICE_NOT_ACTIVE</a>)
                {
                    <span class="r113 r">serviceNotRunning</span> = <b>true</b>;
                }
 
                <span class="r112 r">exception</span> = <span class="r115 r">e</span>;
            }
 
            <b>if</b> (<span class="r112 r">exception</span> != <b>null</b>)
            {
                <span class="c">// This service refused to accept the continue command,</span>
                <span class="c">// so write a non-terminating error.</span>
                <b>if</b> (<span class="r113 r">serviceNotRunning</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r111 r">serviceController</span>,
                        <span class="r112 r">exception</span>,
                        <span class="s">&quot;CouldNotResumeServiceNotRunning&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotResumeServiceNotRunning</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                }
                <b>else</b> <b>if</b> (!<span class="r111 r">serviceController</span>.<span class="i">CanPauseAndContinue</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r111 r">serviceController</span>,
                        <span class="r112 r">exception</span>,
                        <span class="s">&quot;CouldNotResumeServiceNotSupported&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotResumeServiceNotSupported</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                }
 
                <span class="i">WriteNonTerminatingError</span>(<span class="r111 r">serviceController</span>,
                    <span class="r112 r">exception</span>,
                    <span class="s">&quot;CouldNotResumeService&quot;</span>,
                    <span class="i">ServiceResources</span>.<span class="i">CouldNotResumeService</span>,
                    <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
 
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// ServiceController.Continue will return</span>
            <span class="c">// before the service is actually continued.</span>
            <b>if</b> (!<span class="i">DoWaitForStatus</span>(
                <span class="r111 r">serviceController</span>,
                <span class="i">ServiceControllerStatus</span>.<span class="i">Running</span>,
                <span class="i">ServiceControllerStatus</span>.<span class="i">ContinuePending</span>,
                <span class="i">ServiceResources</span>.<span class="i">ResumingService</span>,
                <span class="s">&quot;ResumeServiceFailed&quot;</span>,
                <span class="i">ServiceResources</span>.<span class="i">ResumeServiceFailed</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ServiceOperationBaseCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> StopServiceCommand
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the stop-service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Note that the services will be sorted before being stopped.</span>
    <span class="c">///</span><span class="c"> PM confirms that this is OK.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Stop</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097052&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public sealed class</b> <a id="4ad007bd08ccaa7f" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="7285c1d77baa4e01">StopServiceCommand</span></a> : <a href="#e7306fe585e82503" class="t t">ServiceOperationBaseCommand</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies whether to force a service to stop</span>
        <span class="c">///</span><span class="c"> even if it has dependent services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="ec11a62f3b785915" href="../../R/ec11a62f3b785915.html" target="n" data-glyph="102,1" class="i property">Force</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies whether to wait for a service to reach the stopped state before returning.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="23ab7f93e20623fc" href="../../R/23ab7f93e20623fc.html" target="n" data-glyph="102,1" class="i property">NoWait</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the services.</span>
        <span class="c">///</span><span class="c"> It is a non-terminating error if -Force is not specified and</span>
        <span class="c">///</span><span class="c">  the service has dependent services, whether or not they</span>
        <span class="c">///</span><span class="c">  are running.</span>
        <span class="c">///</span><span class="c"> It is a non-terminating error if the service stop operation fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="03da8c0081a6981c" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">ServiceController</span> <span id="r117 rd" class="r117 r">serviceController</span> <b>in</b> <a href="#90b9f72d3dc23081" class="i method">MatchingServices</a>())
            {
                <span class="c">// confirm the operation first</span>
                <span class="c">// this is always false if WhatIf is set</span>
                <b>if</b> (!<a href="#d74e872d88d6d9d5" class="i method">ShouldProcessServiceOperation</a>(<span class="r117 r">serviceController</span>))
                {
                    <b>continue</b>;
                }
 
                <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r118 rd" class="r118 r">stoppedServices</span> = <span class="i">DoStopService</span>(<span class="r117 r">serviceController</span>, <a href="#ec11a62f3b785915" class="i property">Force</a>, !<a href="#23ab7f93e20623fc" class="i property">NoWait</a>);
 
                <b>if</b> (<a href="#7b09cbd97b74f47b" class="i property">PassThru</a> &amp;&amp; <span class="r118 r">stoppedServices</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>foreach</b> (<span class="i">ServiceController</span> <span id="r119 rd" class="r119 r">service</span> <b>in</b> <span class="r118 r">stoppedServices</span>)
                    {
                        <span class="i">WriteObject</span>(<span class="r119 r">service</span>);
                    }
                }
            }
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> StopServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> StartServiceCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the start-service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Start</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097051&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public sealed class</b> <a id="feca9bd1bdaa7865" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="49c2655445a8ca3f">StartServiceCommand</span></a> : <a href="#e7306fe585e82503" class="t t">ServiceOperationBaseCommand</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start the services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="9dde6c175a07ea53" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">ServiceController</span> <span id="r120 rd" class="r120 r">serviceController</span> <b>in</b> <a href="#90b9f72d3dc23081" class="i method">MatchingServices</a>())
            {
                <span class="c">// confirm the operation first</span>
                <span class="c">// this is always false if WhatIf is set</span>
                <b>if</b> (!<a href="#d74e872d88d6d9d5" class="i method">ShouldProcessServiceOperation</a>(<span class="r120 r">serviceController</span>))
                {
                    <b>continue</b>;
                }
 
                <b>if</b> (<a href="#588751cf782445d4" class="i method">DoStartService</a>(<span class="r120 r">serviceController</span>))
                {
                    <b>if</b> (<a href="#7b09cbd97b74f47b" class="i property">PassThru</a>)
                        <span class="i">WriteObject</span>(<span class="r120 r">serviceController</span>);
                }
            }
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> StartServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> SuspendServiceCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the suspend-service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Suspend</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097053&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public sealed class</b> <a id="427eaf7718cf402b" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="2223d8dc855428af">SuspendServiceCommand</span></a> : <a href="#e7306fe585e82503" class="t t">ServiceOperationBaseCommand</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start the services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="d7f3d4038d7b2338" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">ServiceController</span> <span id="r121 rd" class="r121 r">serviceController</span> <b>in</b> <a href="#90b9f72d3dc23081" class="i method">MatchingServices</a>())
            {
                <span class="c">// confirm the operation first</span>
                <span class="c">// this is always false if WhatIf is set</span>
                <b>if</b> (!<a href="#d74e872d88d6d9d5" class="i method">ShouldProcessServiceOperation</a>(<span class="r121 r">serviceController</span>))
                {
                    <b>continue</b>;
                }
 
                <b>if</b> (<a href="#5a28e36868635dad" class="i method">DoPauseService</a>(<span class="r121 r">serviceController</span>))
                {
                    <b>if</b> (<a href="#7b09cbd97b74f47b" class="i property">PassThru</a>)
                        <span class="i">WriteObject</span>(<span class="r121 r">serviceController</span>);
                }
            }
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> SuspendServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ResumeServiceCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the resume-service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Resume</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097150&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public sealed class</b> <a id="99a6ecac286e1230" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="3bfd950a43dc1708">ResumeServiceCommand</span></a> : <a href="#e7306fe585e82503" class="t t">ServiceOperationBaseCommand</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start the services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="ecee0c35bf9678c7" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">ServiceController</span> <span id="r122 rd" class="r122 r">serviceController</span> <b>in</b> <a href="#90b9f72d3dc23081" class="i method">MatchingServices</a>())
            {
                <span class="c">// confirm the operation first</span>
                <span class="c">// this is always false if WhatIf is set</span>
                <b>if</b> (!<a href="#d74e872d88d6d9d5" class="i method">ShouldProcessServiceOperation</a>(<span class="r122 r">serviceController</span>))
                {
                    <b>continue</b>;
                }
 
                <b>if</b> (<a href="#dd595913dbfb0f9c" class="i method">DoResumeService</a>(<span class="r122 r">serviceController</span>))
                {
                    <b>if</b> (<a href="#7b09cbd97b74f47b" class="i property">PassThru</a>)
                        <span class="i">WriteObject</span>(<span class="r122 r">serviceController</span>);
                }
            }
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ResumeServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> RestartServiceCommand
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the restart-service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Restart</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097059&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public sealed class</b> <a id="2812ca32c475c52e" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="01f8bd9d392e5a40">RestartServiceCommand</span></a> : <a href="#e7306fe585e82503" class="t t">ServiceOperationBaseCommand</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies whether to force a service to stop</span>
        <span class="c">///</span><span class="c"> even if it has dependent services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="98970378ba67f936" href="../../R/98970378ba67f936.html" target="n" data-glyph="102,1" class="i property">Force</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop and restart the services.</span>
        <span class="c">///</span><span class="c"> It is a non-terminating error if the service is running,</span>
        <span class="c">///</span><span class="c">  -Force is not specified and the service has dependent services,</span>
        <span class="c">///</span><span class="c">  whether or not the dependent services are running.</span>
        <span class="c">///</span><span class="c"> It is a non-terminating error if the service stop operation fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="4ae2322f2ede5c30" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">ServiceController</span> <span id="r123 rd" class="r123 r">serviceController</span> <b>in</b> <a href="#90b9f72d3dc23081" class="i method">MatchingServices</a>())
            {
                <span class="c">// confirm the operation first</span>
                <span class="c">// this is always false if WhatIf is set</span>
                <b>if</b> (!<a href="#d74e872d88d6d9d5" class="i method">ShouldProcessServiceOperation</a>(<span class="r123 r">serviceController</span>))
                {
                    <b>continue</b>;
                }
 
                <span class="c">// Set the NoWait parameter to false since we are not adding this switch to this cmdlet.</span>
                <span class="i">List</span>&lt;<span class="i">ServiceController</span>&gt; <span id="r124 rd" class="r124 r">stoppedServices</span> = <span class="i">DoStopService</span>(<span class="r123 r">serviceController</span>, <a href="#98970378ba67f936" class="i property">Force</a>, <b>true</b>);
 
                <b>if</b> (<span class="r124 r">stoppedServices</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>foreach</b> (<span class="i">ServiceController</span> <span id="r125 rd" class="r125 r">service</span> <b>in</b> <span class="r124 r">stoppedServices</span>)
                    {
                        <b>if</b> (<a href="#588751cf782445d4" class="i method">DoStartService</a>(<span class="r125 r">service</span>))
                        {
                            <b>if</b> (<a href="#7b09cbd97b74f47b" class="i property">PassThru</a>)
                                <span class="i">WriteObject</span>(<span class="r125 r">service</span>);
                        }
                    }
                }
            }
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> RestartServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> SetServiceCommand
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the set-service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsCommon</span>.<span class="i">Set</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Name&quot;</span>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097148&quot;</span>, <span class="i">RemotingCapability</span> = <span class="i">RemotingCapability</span>.<span class="i">SupportedByCommand</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public class</b> <a id="481f731d0180967c" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="9deebd77465c4435">SetServiceCommand</span></a> : <a href="#e7306fe585e82503" class="t t">ServiceOperationBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Service name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;Name&quot;</span>, <span class="i">Position</span> = 0, <span class="i">ValueFromPipeline</span> = <b>true</b>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ServiceName&quot;</span>, <span class="s">&quot;SN&quot;</span>)]
        <b>public</b> <b>new</b> <b>string</b> <a id="96e45d7ebcc64d3d" href="../../R/96e45d7ebcc64d3d.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#fed1272f2524f3a7" class="i field">serviceName</a>;
            }
 
            <b>set</b>
            {
                <a href="#fed1272f2524f3a7" class="i field">serviceName</a> = <b>value</b>;
            }
        }
 
        <b>internal string</b> <a id="fed1272f2524f3a7" href="../../R/fed1272f2524f3a7.html" target="n" data-glyph="44,1" class="i field">serviceName</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following is the definition of the input parameter &quot;InputObject&quot;.</span>
        <span class="c">///</span><span class="c"> Specifies a ServiceController object that represents the service to change.</span>
        <span class="c">///</span><span class="c"> Enter a variable that contains the objects or type a command or expression</span>
        <span class="c">///</span><span class="c"> that gets the objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">Position</span> = 0, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        <b>public</b> <b>new</b> <span class="i">ServiceController</span> <a id="c7032f024aea926f" href="../../R/c7032f024aea926f.html" target="n" data-glyph="102,1" class="i property">InputObject</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following is the definition of the input parameter &quot;DisplayName&quot;.</span>
        <span class="c">///</span><span class="c"> Specifies a new display name for the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;DN&quot;</span>)]
        <b>public</b> <b>new</b> <b>string</b> <a id="123719da6ffc88f9" href="../../R/123719da6ffc88f9.html" target="n" data-glyph="102,1" class="i property">DisplayName</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4d41e0e7d565828c" class="i field">displayName</a>;
            }
 
            <b>set</b>
            {
                <a href="#4d41e0e7d565828c" class="i field">displayName</a> = <b>value</b>;
            }
        }
 
        <b>internal string</b> <a id="4d41e0e7d565828c" href="../../R/4d41e0e7d565828c.html" target="n" data-glyph="44,1" class="i field">displayName</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Account under which the service should run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Credential</span>()]
        <b>public</b> <span class="i">PSCredential</span> <a id="03e4e62957c81bb6" href="../../R/03e4e62957c81bb6.html" target="n" data-glyph="102,1" class="i property">Credential</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following is the definition of the input parameter &quot;Description&quot;.</span>
        <span class="c">///</span><span class="c"> Specifies a new description for the service.</span>
        <span class="c">///</span><span class="c"> The service description appears in Services in Computer Management.</span>
        <span class="c">///</span><span class="c"> Description is not a property of the ServiceController object that</span>
        <span class="c">///</span><span class="c"> Get-Service retrieve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="6188ab79c27c41e8" href="../../R/6188ab79c27c41e8.html" target="n" data-glyph="102,1" class="i property">Description</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#33683626c4e5f0bc" class="i field">description</a>;
            }
 
            <b>set</b>
            {
                <a href="#33683626c4e5f0bc" class="i field">description</a> = <b>value</b>;
            }
        }
 
        <b>internal string</b> <a id="33683626c4e5f0bc" href="../../R/33683626c4e5f0bc.html" target="n" data-glyph="44,1" class="i field">description</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following is the definition of the input parameter &quot;StartupType&quot;.</span>
        <span class="c">///</span><span class="c"> &quot;Set-Service -StartType&quot; sets ServiceController.InputObject.StartType.</span>
        <span class="c">///</span><span class="c"> Changes the starting mode of the service. Valid values for StartupType are:</span>
        <span class="c">///</span><span class="c"> -- Automatic: Start when the system starts.</span>
        <span class="c">///</span><span class="c"> -- Manual   : Starts only when started by a user or program.</span>
        <span class="c">///</span><span class="c"> -- Disabled : Can.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;StartMode&quot;</span>, <span class="s">&quot;SM&quot;</span>, <span class="s">&quot;ST&quot;</span>, <span class="s">&quot;StartType&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a> <a id="d397a87c00b2530a" href="../../R/d397a87c00b2530a.html" target="n" data-glyph="102,1" class="i property">StartupType</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#b21237e11ba4c1f2" class="i field">startupType</a>;
            }
 
            <b>set</b>
            {
                <a href="#b21237e11ba4c1f2" class="i field">startupType</a> = <b>value</b>;
            }
        }
 
        <span class="c">// We set the initial value to an invalid value so that we can</span>
        <span class="c">// distinguish when this is and is not set.</span>
        <b>internal</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a> <a id="b21237e11ba4c1f2" href="../../R/b21237e11ba4c1f2.html" target="n" data-glyph="44,1" class="i field">startupType</a> = <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#386403234ca2e535" class="i field">InvalidValue</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the SecurityDescriptorSddl of the service using a SDDL string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;sd&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="c39eef4603017e55" href="../../R/c39eef4603017e55.html" target="n" data-glyph="102,1" class="i property">SecurityDescriptorSddl</a>
        {
            <b>get</b>;
            <b>set</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following is the definition of the input parameter &quot;Status&quot;.</span>
        <span class="c">///</span><span class="c"> This specifies what state the service should be in (e.g. Running, Stopped,</span>
        <span class="c">///</span><span class="c"> Paused).  If it is already in that state, do nothing.  If it is not, do the</span>
        <span class="c">///</span><span class="c"> appropriate action to bring about the desired result (start/stop/suspend the</span>
        <span class="c">///</span><span class="c"> service) and issue an error if this cannot be achieved.</span>
        <span class="c">///</span><span class="c">  Status can be Paused ,  Running and Stopped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateSetAttribute</span>(<b>new</b> <b>string</b>[] { <span class="s">&quot;Running&quot;</span>, <span class="s">&quot;Stopped&quot;</span>, <span class="s">&quot;Paused&quot;</span> })]
        <b>public string</b> <a id="cbb08e7ad1cc7449" href="../../R/cbb08e7ad1cc7449.html" target="n" data-glyph="102,1" class="i property">Status</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#cfe8ff0df0e828e3" class="i field">serviceStatus</a>;
            }
 
            <b>set</b>
            {
                <a href="#cfe8ff0df0e828e3" class="i field">serviceStatus</a> = <b>value</b>;
            }
        }
 
        <b>internal string</b> <a id="cfe8ff0df0e828e3" href="../../R/cfe8ff0df0e828e3.html" target="n" data-glyph="44,1" class="i field">serviceStatus</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following is the definition of the input parameter &quot;Force&quot;.</span>
        <span class="c">///</span><span class="c"> This parameter is useful only when parameter &quot;Stop&quot; is enabled.</span>
        <span class="c">///</span><span class="c"> If &quot;Force&quot; is enabled, it will also stop the dependent services.</span>
        <span class="c">///</span><span class="c"> If not, it will send an error when this service has dependent ones.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="6cd56e378a1020ab" href="../../R/6cd56e378a1020ab.html" target="n" data-glyph="102,1" class="i property">Force</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is not a parameter for this cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">// This has been shadowed from base class and removed parameter tag to fix gcm &quot;Set-Service&quot; -syntax</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public</b> <b>new</b> <b>string</b>[] <a id="05ef629aca874f0f" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Include</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#d70a34ba4fee387c" class="i field">include</a>;
            }
 
            <b>set</b>
            {
                <a href="#d70a34ba4fee387c" class="i field">include</a> = <b>null</b>;
            }
        }
 
        <b>internal</b> <b>new</b> <b>string</b>[] <a id="d70a34ba4fee387c" href="../../R/d70a34ba4fee387c.html" target="n" data-glyph="44,1" class="i field">include</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is not a parameter for this cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">// This has been shadowed from base class and removed parameter tag to fix gcm &quot;Set-Service&quot; -syntax</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public</b> <b>new</b> <b>string</b>[] <a id="b8194aafba320b3e" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Exclude</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#bac5f5878bff4b3b" class="i field">exclude</a>;
            }
 
            <b>set</b>
            {
                <a href="#bac5f5878bff4b3b" class="i field">exclude</a> = <b>null</b>;
            }
        }
 
        <b>internal</b> <b>new</b> <b>string</b>[] <a id="bac5f5878bff4b3b" href="../../R/bac5f5878bff4b3b.html" target="n" data-glyph="44,1" class="i field">exclude</a> = <b>null</b>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">ArchitectureSensitive</span>]
        <b>protected override void</b> <a id="2f5624ab67fea61d" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <span class="i">ServiceController</span> <span id="r126 rd" class="r126 r">service</span> = <b>null</b>;
            <span class="i">IntPtr</span> <span id="r127 rd" class="r127 r">password</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <b>bool</b> <span id="r128 rd" class="r128 r">objServiceShouldBeDisposed</span> = <b>false</b>;
 
            <b>try</b>
            {
                <b>if</b> (<a href="#c7032f024aea926f" class="i property">InputObject</a> != <b>null</b>)
                {
                    <span class="r126 r">service</span> = <a href="#c7032f024aea926f" class="i property">InputObject</a>;
                    <a href="#96e45d7ebcc64d3d" class="i property">Name</a> = <span class="r126 r">service</span>.<span class="i">ServiceName</span>;
                    <span class="r128 r">objServiceShouldBeDisposed</span> = <b>false</b>;
                }
                <b>else</b>
                {
                    <span class="r126 r">service</span> = <b>new</b> <span class="i">ServiceController</span>(<a href="#fed1272f2524f3a7" class="i field">serviceName</a>);
                    <span class="r128 r">objServiceShouldBeDisposed</span> = <b>true</b>;
                }
 
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#96e45d7ebcc64d3d" class="i property">Name</a>), <span class="s">&quot;null ServiceName&quot;</span>);
 
                <span class="c">// &quot;new ServiceController&quot; will succeed even if</span>
                <span class="c">// there is no such service.  This checks whether</span>
                <span class="c">// the service actually exists.</span>
                <b>string</b> <span id="r129 rd" class="r129 r">unusedByDesign</span> = <span class="r126 r">service</span>.<span class="i">DisplayName</span>;
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r130 rd" class="r130 r">ex</span>)
            {
                <span class="c">// cannot use WriteNonterminatingError as service is null</span>
                <span class="i">ErrorRecord</span> <span id="r131 rd" class="r131 r">er</span> = <b>new</b>(<span class="r130 r">ex</span>, <span class="s">&quot;ArgumentException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>, <a href="#96e45d7ebcc64d3d" class="i property">Name</a>);
                <span class="i">WriteError</span>(<span class="r131 r">er</span>);
                <b>return</b>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r132 rd" class="r132 r">ex</span>)
            {
                <span class="c">// cannot use WriteNonterminatingError as service is null</span>
                <span class="i">ErrorRecord</span> <span id="r133 rd" class="r133 r">er</span> = <b>new</b>(<span class="r132 r">ex</span>, <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>, <a href="#96e45d7ebcc64d3d" class="i property">Name</a>);
                <span class="i">WriteError</span>(<span class="r133 r">er</span>);
                <b>return</b>;
            }
 
            <b>try</b> <span class="c">// In finally we ensure dispose, if object not pipelined.</span>
            {
                <span class="c">// confirm the operation first</span>
                <span class="c">// this is always false if WhatIf is set</span>
                <b>if</b> (!<a href="#d74e872d88d6d9d5" class="i method">ShouldProcessServiceOperation</a>(<span class="r126 r">service</span>))
                {
                    <b>return</b>;
                }
 
                <span class="i">NakedWin32Handle</span> <span id="r134 rd" class="r134 r">hScManager</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <span class="i">NakedWin32Handle</span> <span id="r135 rd" class="r135 r">hService</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <span class="i">IntPtr</span> <span id="r136 rd" class="r136 r">delayedAutoStartInfoBuffer</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <b>try</b>
                {
                    <span class="r134 r">hScManager</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">OpenSCManagerW</span>(
                        <b>string</b>.<span class="i">Empty</span>,
                        <b>null</b>,
                        <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#cf1f86e8f9eac5f7" class="i field">SC_MANAGER_CONNECT</a>
                        );
 
                    <b>if</b> (<span class="r134 r">hScManager</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>int</b> <span id="r137 rd" class="r137 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r138 rd" class="r138 r">exception</span> = <b>new</b>(<span class="r137 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r126 r">service</span>,
                            <span class="r138 r">exception</span>,
                            <span class="s">&quot;FailToOpenServiceControlManager&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">FailToOpenServiceControlManager</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        <b>return</b>;
                    }
 
                    <span class="r135 r">hService</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">OpenServiceW</span>(
                        <span class="r134 r">hScManager</span>,
                        <a href="#96e45d7ebcc64d3d" class="i property">Name</a>,
                        <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#542d7644d4c59fd9" class="i field">SERVICE_CHANGE_CONFIG</a> | <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b6141de8201c6dbb" class="i field">WRITE_DAC</a> | <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#5c0fe13e1d62165b" class="i field">WRITE_OWNER</a>
                        );
 
                    <b>if</b> (<span class="r135 r">hService</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>int</b> <span id="r139 rd" class="r139 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r140 rd" class="r140 r">exception</span> = <b>new</b>(<span class="r139 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r126 r">service</span>,
                            <span class="r140 r">exception</span>,
                            <span class="s">&quot;CouldNotSetService&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotSetService</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        <b>return</b>;
                    }
                    <span class="c">// Modify startup type or display name or credential</span>
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#123719da6ffc88f9" class="i property">DisplayName</a>)
                        || <a href="#d397a87c00b2530a" class="i property">StartupType</a> != <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#386403234ca2e535" class="i field">InvalidValue</a> || <a href="#03e4e62957c81bb6" class="i property">Credential</a> != <b>null</b>)
                    {
                        <span class="i">DWORD</span> <span id="r141 rd" class="r141 r">dwStartType</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b58d133597cd5d07" class="i field">SERVICE_NO_CHANGE</a>;
                        <b>if</b> (!<a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#67fff2228f3f3f88" class="i method">TryGetNativeStartupType</a>(<a href="#d397a87c00b2530a" class="i property">StartupType</a>, <b>out</b> <span class="r141 r">dwStartType</span>))
                        {
                            <span class="i">WriteNonTerminatingError</span>(<a href="#d397a87c00b2530a" class="i property">StartupType</a>.<span class="i">ToString</span>(), <span class="s">&quot;Set-Service&quot;</span>, <a href="#96e45d7ebcc64d3d" class="i property">Name</a>,
                                <b>new</b> <span class="i">ArgumentException</span>(), <span class="s">&quot;CouldNotSetService&quot;</span>,
                                <span class="i">ServiceResources</span>.<span class="i">UnsupportedStartupType</span>,
                                <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>);
                            <b>return</b>;
                        }
 
                        <b>string</b> <span id="r142 rd" class="r142 r">username</span> = <b>null</b>;
                        <b>if</b> (<a href="#03e4e62957c81bb6" class="i property">Credential</a> != <b>null</b>)
                        {
                            <span class="r142 r">username</span> = <a href="#03e4e62957c81bb6" class="i property">Credential</a>.<span class="i">UserName</span>;
                            <span class="r127 r">password</span> = <span class="i">Marshal</span>.<span class="i">SecureStringToCoTaskMemUnicode</span>(<a href="#03e4e62957c81bb6" class="i property">Credential</a>.<span class="i">Password</span>);
                        }
 
                        <b>bool</b> <span id="r143 rd" class="r143 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">ChangeServiceConfigW</span>(
                            <span class="r135 r">hService</span>,
                            <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b58d133597cd5d07" class="i field">SERVICE_NO_CHANGE</a>,
                            <span class="r141 r">dwStartType</span>,
                            <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b58d133597cd5d07" class="i field">SERVICE_NO_CHANGE</a>,
                            <b>null</b>,
                            <b>null</b>,
                            <span class="i">IntPtr</span>.<span class="i">Zero</span>,
                            <b>null</b>,
                            <span class="r142 r">username</span>,
                            <span class="r127 r">password</span>,
                            <a href="#123719da6ffc88f9" class="i property">DisplayName</a>
                            );
                        <b>if</b> (!<span class="r143 r">succeeded</span>)
                        {
                            <b>int</b> <span id="r144 rd" class="r144 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <span class="i">Win32Exception</span> <span id="r145 rd" class="r145 r">exception</span> = <b>new</b>(<span class="r144 r">lastError</span>);
                            <span class="i">WriteNonTerminatingError</span>(
                                <span class="r126 r">service</span>,
                                <span class="r145 r">exception</span>,
                                <span class="s">&quot;CouldNotSetService&quot;</span>,
                                <span class="i">ServiceResources</span>.<span class="i">CouldNotSetService</span>,
                                <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                            <b>return</b>;
                        }
                    }
 
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#2bc1098513f803dc" class="t t">SERVICE_DESCRIPTIONW</a> <span id="r146 rd" class="r146 r">sd</span> = <b>new</b>();
                    <span class="r146 r">sd</span>.<a href="#c52c6d443408a75f" class="i field">lpDescription</a> = <a href="#6188ab79c27c41e8" class="i property">Description</a>;
                    <b>int</b> <span id="r147 rd" class="r147 r">size</span> = <span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r146 r">sd</span>);
                    <span class="i">IntPtr</span> <span id="r148 rd" class="r148 r">buffer</span> = <span class="i">Marshal</span>.<span class="i">AllocCoTaskMem</span>(<span class="r147 r">size</span>);
                    <span class="i">Marshal</span>.<span class="i">StructureToPtr</span>(<span class="r146 r">sd</span>, <span class="r148 r">buffer</span>, <b>false</b>);
 
                    <b>bool</b> <span id="r149 rd" class="r149 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#1db68b9dcdfc65a0" class="i method">ChangeServiceConfig2W</a>(
                        <span class="r135 r">hService</span>,
                        <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#751c9d4dde3dfee0" class="i field">SERVICE_CONFIG_DESCRIPTION</a>,
                        <span class="r148 r">buffer</span>);
 
                    <b>if</b> (!<span class="r149 r">status</span>)
                    {
                        <b>int</b> <span id="r150 rd" class="r150 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r151 rd" class="r151 r">exception</span> = <b>new</b>(<span class="r150 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r126 r">service</span>,
                            <span class="r151 r">exception</span>,
                            <span class="s">&quot;CouldNotSetServiceDescription&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotSetServiceDescription</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
 
                    <span class="c">// Set the delayed auto start</span>
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b5b0e1e4dd1950a7" class="t t">SERVICE_DELAYED_AUTO_START_INFO</a> <span id="r152 rd" class="r152 r">ds</span> = <b>new</b>();
                    <span class="r152 r">ds</span>.<a href="#b1bd34dde2957ded" class="i field">fDelayedAutostart</a> = <a href="#d397a87c00b2530a" class="i property">StartupType</a> == <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#b343bfbc1cf66a3a" class="i field">AutomaticDelayedStart</a>;
                    <span class="r147 r">size</span> = <span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r152 r">ds</span>);
                    <span class="r136 r">delayedAutoStartInfoBuffer</span> = <span class="i">Marshal</span>.<span class="i">AllocCoTaskMem</span>(<span class="r147 r">size</span>);
                    <span class="i">Marshal</span>.<span class="i">StructureToPtr</span>(<span class="r152 r">ds</span>, <span class="r136 r">delayedAutoStartInfoBuffer</span>, <b>false</b>);
 
                    <span class="r149 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#1db68b9dcdfc65a0" class="i method">ChangeServiceConfig2W</a>(
                        <span class="r135 r">hService</span>,
                        <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#2ce69483ff46c549" class="i field">SERVICE_CONFIG_DELAYED_AUTO_START_INFO</a>,
                        <span class="r136 r">delayedAutoStartInfoBuffer</span>);
 
                    <b>if</b> (!<span class="r149 r">status</span>)
                    {
                        <b>int</b> <span id="r153 rd" class="r153 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r154 rd" class="r154 r">exception</span> = <b>new</b>(<span class="r153 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <a href="#96e45d7ebcc64d3d" class="i property">Name</a>,
                            <a href="#123719da6ffc88f9" class="i property">DisplayName</a>,
                            <a href="#96e45d7ebcc64d3d" class="i property">Name</a>,
                            <span class="r154 r">exception</span>,
                            <span class="s">&quot;CouldNotSetServiceDelayedAutoStart&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotSetServiceDelayedAutoStart</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
 
                    <span class="c">// Handle the &#39;-Status&#39; parameter</span>
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#cbb08e7ad1cc7449" class="i property">Status</a>))
                    {
                        <b>if</b> (<a href="#cbb08e7ad1cc7449" class="i property">Status</a>.<span class="i">Equals</span>(<span class="s">&quot;Running&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>if</b> (!<span class="r126 r">service</span>.<span class="i">Status</span>.<span class="i">Equals</span>(<span class="i">ServiceControllerStatus</span>.<span class="i">Running</span>))
                            {
                                <b>if</b> (<span class="r126 r">service</span>.<span class="i">Status</span>.<span class="i">Equals</span>(<span class="i">ServiceControllerStatus</span>.<span class="i">Paused</span>))
                                    <span class="c">// resume service</span>
                                    <a href="#dd595913dbfb0f9c" class="i method">DoResumeService</a>(<span class="r126 r">service</span>);
                                <b>else</b>
                                    <span class="c">// start service</span>
                                    <a href="#588751cf782445d4" class="i method">DoStartService</a>(<span class="r126 r">service</span>);
                            }
                        }
                        <b>else</b> <b>if</b> (<a href="#cbb08e7ad1cc7449" class="i property">Status</a>.<span class="i">Equals</span>(<span class="s">&quot;Stopped&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>if</b> (!<span class="r126 r">service</span>.<span class="i">Status</span>.<span class="i">Equals</span>(<span class="i">ServiceControllerStatus</span>.<span class="i">Stopped</span>))
                            {
                                <span class="c">// Check for the dependent services as set-service dont have force parameter</span>
                                <span class="i">ServiceController</span>[] <span id="r155 rd" class="r155 r">dependentServices</span> = <span class="r126 r">service</span>.<span class="i">DependentServices</span>;
 
                                <b>if</b> ((!<a href="#6cd56e378a1020ab" class="i property">Force</a>) &amp;&amp; (<span class="r155 r">dependentServices</span> != <b>null</b>) &amp;&amp; (<span class="r155 r">dependentServices</span>.<span class="i">Length</span> &gt; 0))
                                {
                                    <span class="i">WriteNonTerminatingError</span>(<span class="r126 r">service</span>, <b>null</b>, <span class="s">&quot;ServiceHasDependentServicesNoForce&quot;</span>, <span class="i">ServiceResources</span>.<span class="i">ServiceHasDependentServicesNoForce</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
                                    <b>return</b>;
                                }
 
                                <span class="c">// Stop service, pass &#39;true&#39; to the force parameter as we have already checked for the dependent services.</span>
                                <span class="i">DoStopService</span>(<span class="r126 r">service</span>, <a href="#6cd56e378a1020ab" class="i property">Force</a>, <span class="i">waitForServiceToStop</span>: <b>true</b>);
                            }
                        }
                        <b>else</b> <b>if</b> (<a href="#cbb08e7ad1cc7449" class="i property">Status</a>.<span class="i">Equals</span>(<span class="s">&quot;Paused&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>if</b> (!<span class="r126 r">service</span>.<span class="i">Status</span>.<span class="i">Equals</span>(<span class="i">ServiceControllerStatus</span>.<span class="i">Paused</span>))
                            {
                                <a href="#5a28e36868635dad" class="i method">DoPauseService</a>(<span class="r126 r">service</span>);
                            }
                        }
                    }
 
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#c39eef4603017e55" class="i property">SecurityDescriptorSddl</a>))
                    {
                        <a href="#b9bc4a850c3897aa" class="i method">SetServiceSecurityDescriptor</a>(<span class="r126 r">service</span>, <a href="#c39eef4603017e55" class="i property">SecurityDescriptorSddl</a>, <span class="r135 r">hService</span>);
                    }
 
                    <b>if</b> (<a href="#7b09cbd97b74f47b" class="i property">PassThru</a>.<span class="i">IsPresent</span>)
                    {
                        <span class="c">// To display the service, refreshing the service would not show the display name after updating</span>
                        <span class="i">ServiceController</span> <span id="r156 rd" class="r156 r">displayservice</span> = <b>new</b>(<a href="#96e45d7ebcc64d3d" class="i property">Name</a>);
                        <span class="i">WriteObject</span>(<span class="r156 r">displayservice</span>);
                    }
                }
                <b>finally</b>
                {
                    <b>if</b> (<span class="r136 r">delayedAutoStartInfoBuffer</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <span class="i">Marshal</span>.<span class="i">FreeCoTaskMem</span>(<span class="r136 r">delayedAutoStartInfoBuffer</span>);
                    }
 
                    <b>if</b> (<span class="r135 r">hService</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>bool</b> <span id="r157 rd" class="r157 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r135 r">hService</span>);
                        <b>if</b> (!<span class="r157 r">succeeded</span>)
                        {
                            <b>int</b> <span id="r158 rd" class="r158 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <span class="i">Win32Exception</span> <span id="r159 rd" class="r159 r">exception</span> = <b>new</b>(<span class="r158 r">lastError</span>);
                            <span class="i">WriteNonTerminatingError</span>(
                                <span class="r126 r">service</span>,
                                <span class="r159 r">exception</span>,
                                <span class="s">&quot;CouldNotSetServiceDescription&quot;</span>,
                                <span class="i">ServiceResources</span>.<span class="i">CouldNotSetServiceDescription</span>,
                                <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        }
                    }
 
                    <b>if</b> (<span class="r134 r">hScManager</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>bool</b> <span id="r160 rd" class="r160 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r134 r">hScManager</span>);
                        <b>if</b> (!<span class="r160 r">succeeded</span>)
                        {
                            <b>int</b> <span id="r161 rd" class="r161 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <span class="i">Win32Exception</span> <span id="r162 rd" class="r162 r">exception</span> = <b>new</b>(<span class="r161 r">lastError</span>);
                            <span class="i">WriteNonTerminatingError</span>(
                                <span class="r126 r">service</span>,
                                <span class="r162 r">exception</span>,
                                <span class="s">&quot;CouldNotSetServiceDescription&quot;</span>,
                                <span class="i">ServiceResources</span>.<span class="i">CouldNotSetServiceDescription</span>,
                                <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        }
                    }
                }
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r127 r">password</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="i">Marshal</span>.<span class="i">ZeroFreeCoTaskMemUnicode</span>(<span class="r127 r">password</span>);
                }
 
                <b>if</b> (<span class="r128 r">objServiceShouldBeDisposed</span>)
                {
                    <span class="r126 r">service</span>.<span class="i">Dispose</span>();
                }
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> SetServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> NewServiceCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the New-Service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsCommon</span>.<span class="i">New</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096905&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ServiceController</span>))]
    <b>public class</b> <a id="4eaeaefd91cc3a65" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="b689db7de5607369">NewServiceCommand</span></a> : <a href="#057be076428c3adc" class="t t">ServiceBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the service to create.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">Mandatory</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ServiceName&quot;</span>)]
        <b>public string</b> <a id="52527abdeb24a5e9" href="../../R/52527abdeb24a5e9.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b> { <b>return</b> <a href="#f602812f38298fde" class="i field">serviceName</a>; }
 
            <b>set</b> { <a href="#f602812f38298fde" class="i field">serviceName</a> = <b>value</b>; }
        }
 
        <b>internal string</b> <a id="f602812f38298fde" href="../../R/f602812f38298fde.html" target="n" data-glyph="44,1" class="i field">serviceName</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The executable which implements this service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 1, <span class="i">Mandatory</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;Path&quot;</span>)]
        <b>public string</b> <a id="217aa61fc313009d" href="../../R/217aa61fc313009d.html" target="n" data-glyph="102,1" class="i property">BinaryPathName</a>
        {
            <b>get</b> { <b>return</b> <a href="#3fd25d8a6586ab96" class="i field">binaryPathName</a>; }
 
            <b>set</b> { <a href="#3fd25d8a6586ab96" class="i field">binaryPathName</a> = <b>value</b>; }
        }
 
        <b>internal string</b> <a id="3fd25d8a6586ab96" href="../../R/3fd25d8a6586ab96.html" target="n" data-glyph="44,1" class="i field">binaryPathName</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> DisplayName of the service to create.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="9f7b1e3bc9aa888c" href="../../R/9f7b1e3bc9aa888c.html" target="n" data-glyph="102,1" class="i property">DisplayName</a>
        {
            <b>get</b> { <b>return</b> <a href="#fce50838f856c931" class="i field">displayName</a>; }
 
            <b>set</b> { <a href="#fce50838f856c931" class="i field">displayName</a> = <b>value</b>; }
        }
 
        <b>internal string</b> <a id="fce50838f856c931" href="../../R/fce50838f856c931.html" target="n" data-glyph="44,1" class="i field">displayName</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Description of the service to create.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="a24a4f36eb369e35" href="../../R/a24a4f36eb369e35.html" target="n" data-glyph="102,1" class="i property">Description</a>
        {
            <b>get</b> { <b>return</b> <a href="#40bd20cdc514e07d" class="i field">description</a>; }
 
            <b>set</b> { <a href="#40bd20cdc514e07d" class="i field">description</a> = <b>value</b>; }
        }
 
        <b>internal string</b> <a id="40bd20cdc514e07d" href="../../R/40bd20cdc514e07d.html" target="n" data-glyph="44,1" class="i field">description</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Should the service start automatically?</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a> <a id="3f11c3db61cb85a3" href="../../R/3f11c3db61cb85a3.html" target="n" data-glyph="102,1" class="i property">StartupType</a>
        {
            <b>get</b> { <b>return</b> <a href="#2226c18008cae04e" class="i field">startupType</a>; }
 
            <b>set</b> { <a href="#2226c18008cae04e" class="i field">startupType</a> = <b>value</b>; }
        }
 
        <b>internal</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a> <a id="2226c18008cae04e" href="../../R/2226c18008cae04e.html" target="n" data-glyph="44,1" class="i field">startupType</a> = <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#7003922d6d85b7ee" class="i field">Automatic</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Account under which the service should run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Credential</span>()]
        <b>public</b> <span class="i">PSCredential</span> <a id="00bf191d7072ef79" href="../../R/00bf191d7072ef79.html" target="n" data-glyph="102,1" class="i property">Credential</a>
        {
            <b>get</b> { <b>return</b> <a href="#46ba8e4d66ad599e" class="i field">credential</a>; }
 
            <b>set</b> { <a href="#46ba8e4d66ad599e" class="i field">credential</a> = <b>value</b>; }
        }
 
        <b>internal</b> <span class="i">PSCredential</span> <a id="46ba8e4d66ad599e" href="../../R/46ba8e4d66ad599e.html" target="n" data-glyph="44,1" class="i field">credential</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the SecurityDescriptorSddl of the service using a SDDL string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;sd&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="67eeccf0a7eb8d5f" href="../../R/67eeccf0a7eb8d5f.html" target="n" data-glyph="102,1" class="i property">SecurityDescriptorSddl</a>
        {
            <b>get</b>;
            <b>set</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Other services on which the new service depends.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public string</b>[] <a id="b5e0c9e9ba693e77" href="../../R/b5e0c9e9ba693e77.html" target="n" data-glyph="102,1" class="i property">DependsOn</a>
        {
            <b>get</b> { <b>return</b> <a href="#3f02599ec1181aed" class="i field">dependsOn</a>; }
 
            <b>set</b> { <a href="#3f02599ec1181aed" class="i field">dependsOn</a> = <b>value</b>; }
        }
 
        <b>internal string</b>[] <a id="3f02599ec1181aed" href="../../R/3f02599ec1181aed.html" target="n" data-glyph="44,1" class="i field">dependsOn</a> = <b>null</b>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">ArchitectureSensitive</span>]
        <b>protected override void</b> <a id="3e10be3a97db34ab" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <span class="i">ServiceController</span> <span id="r163 rd" class="r163 r">service</span> = <b>null</b>;
            <span class="i">Diagnostics</span>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#52527abdeb24a5e9" class="i property">Name</a>),
                <span class="s">&quot;null ServiceName&quot;</span>);
            <span class="i">Diagnostics</span>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#217aa61fc313009d" class="i property">BinaryPathName</a>),
                <span class="s">&quot;null BinaryPathName&quot;</span>);
 
            <span class="c">// confirm the operation first</span>
            <span class="c">// this is always false if WhatIf is set</span>
            <b>if</b> (!<span class="i">ShouldProcessServiceOperation</span>(<a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a> ?? <b>string</b>.<span class="i">Empty</span>, <a href="#52527abdeb24a5e9" class="i property">Name</a>))
            {
                <b>return</b>;
            }
 
            <span class="c">// Connect to the service controller</span>
            <span class="i">NakedWin32Handle</span> <span id="r164 rd" class="r164 r">hScManager</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="i">NakedWin32Handle</span> <span id="r165 rd" class="r165 r">hService</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="i">IntPtr</span> <span id="r166 rd" class="r166 r">password</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="i">IntPtr</span> <span id="r167 rd" class="r167 r">delayedAutoStartInfoBuffer</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <b>try</b>
            {
                <span class="r164 r">hScManager</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">OpenSCManagerW</span>(
                    <b>null</b>,
                    <b>null</b>,
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#cf1f86e8f9eac5f7" class="i field">SC_MANAGER_CONNECT</a> | <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#24913401f94b7082" class="i field">SC_MANAGER_CREATE_SERVICE</a>
                    );
                <b>if</b> (<span class="r164 r">hScManager</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <b>int</b> <span id="r168 rd" class="r168 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                    <span class="i">Win32Exception</span> <span id="r169 rd" class="r169 r">exception</span> = <b>new</b>(<span class="r168 r">lastError</span>);
                    <span class="i">WriteNonTerminatingError</span>(
                        <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                        <a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a>,
                        <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                        <span class="r169 r">exception</span>,
                        <span class="s">&quot;CouldNotNewService&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotNewService</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    <b>return</b>;
                }
 
                <b>if</b> (!<a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#67fff2228f3f3f88" class="i method">TryGetNativeStartupType</a>(<a href="#3f11c3db61cb85a3" class="i property">StartupType</a>, <b>out</b> <span class="i">DWORD</span> <span id="r170 rd" class="r170 r">dwStartType</span>))
                {
                    <span class="i">WriteNonTerminatingError</span>(<a href="#3f11c3db61cb85a3" class="i property">StartupType</a>.<span class="i">ToString</span>(), <span class="s">&quot;New-Service&quot;</span>, <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                        <b>new</b> <span class="i">ArgumentException</span>(), <span class="s">&quot;CouldNotNewService&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">UnsupportedStartupType</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>);
                    <b>return</b>;
                }
                <span class="c">// set up the double-null-terminated lpDependencies parameter</span>
                <span class="i">IntPtr</span> <span id="r171 rd" class="r171 r">lpDependencies</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <b>if</b> (<a href="#b5e0c9e9ba693e77" class="i property">DependsOn</a> != <b>null</b>)
                {
                    <b>int</b> <span id="r172 rd" class="r172 r">numchars</span> = 1; <span class="c">// final null</span>
                    <b>foreach</b> (<b>string</b> <span id="r173 rd" class="r173 r">dependedOn</span> <b>in</b> <a href="#b5e0c9e9ba693e77" class="i property">DependsOn</a>)
                    {
                        <span class="r172 r">numchars</span> += <span class="r173 r">dependedOn</span>.<span class="i">Length</span> + 1;
                    }
 
                    <b>char</b>[] <span id="r174 rd" class="r174 r">doubleNullArray</span> = <b>new</b> <b>char</b>[<span class="r172 r">numchars</span>];
                    <b>int</b> <span id="r175 rd" class="r175 r">pos</span> = 0;
                    <b>foreach</b> (<b>string</b> <span id="r176 rd" class="r176 r">dependedOn</span> <b>in</b> <a href="#b5e0c9e9ba693e77" class="i property">DependsOn</a>)
                    {
                        <span class="i">Array</span>.<span class="i">Copy</span>(
                            <span class="r176 r">dependedOn</span>.<span class="i">ToCharArray</span>(), 0,
                            <span class="r174 r">doubleNullArray</span>, <span class="r175 r">pos</span>,
                            <span class="r176 r">dependedOn</span>.<span class="i">Length</span>
                            );
                        <span class="r175 r">pos</span> += <span class="r176 r">dependedOn</span>.<span class="i">Length</span>;
                        <span class="r174 r">doubleNullArray</span>[<span class="r175 r">pos</span>++] = (<b>char</b>)0; <span class="c">// null terminator</span>
                    }
 
                    <span class="r174 r">doubleNullArray</span>[<span class="r175 r">pos</span>++] = (<b>char</b>)0; <span class="c">// double-null terminator</span>
                    <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<span class="r175 r">pos</span> == <span class="r172 r">numchars</span>, <span class="s">&quot;lpDependencies build error&quot;</span>);
                    <span class="r171 r">lpDependencies</span> = <span class="i">Marshal</span>.<span class="i">AllocHGlobal</span>(
                        <span class="r172 r">numchars</span> * <span class="i">Marshal</span>.<span class="i">SystemDefaultCharSize</span>);
                    <span class="i">Marshal</span>.<span class="i">Copy</span>(<span class="r174 r">doubleNullArray</span>, 0, <span class="r171 r">lpDependencies</span>, <span class="r172 r">numchars</span>);
                }
 
                <span class="c">// set up the Credential parameter</span>
                <b>string</b> <span id="r177 rd" class="r177 r">username</span> = <b>null</b>;
                <b>if</b> (<a href="#00bf191d7072ef79" class="i property">Credential</a> != <b>null</b>)
                {
                    <span class="r177 r">username</span> = <a href="#00bf191d7072ef79" class="i property">Credential</a>.<span class="i">UserName</span>;
                    <span class="r166 r">password</span> = <span class="i">Marshal</span>.<span class="i">SecureStringToCoTaskMemUnicode</span>(<a href="#00bf191d7072ef79" class="i property">Credential</a>.<span class="i">Password</span>);
                }
 
                <span class="c">// Create the service</span>
                <span class="r165 r">hService</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">CreateServiceW</span>(
                    <span class="r164 r">hScManager</span>,
                    <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                    <a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a>,
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#542d7644d4c59fd9" class="i field">SERVICE_CHANGE_CONFIG</a> | <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b6141de8201c6dbb" class="i field">WRITE_DAC</a> | <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#5c0fe13e1d62165b" class="i field">WRITE_OWNER</a>,
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#3fb445e8cf0c8c0c" class="i field">SERVICE_WIN32_OWN_PROCESS</a>,
                    <span class="r170 r">dwStartType</span>,
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#1c18d45bb47e1afc" class="i field">SERVICE_ERROR_NORMAL</a>,
                    <a href="#217aa61fc313009d" class="i property">BinaryPathName</a>,
                    <b>null</b>,
                    <b>null</b>,
                    <span class="r171 r">lpDependencies</span>,
                    <span class="r177 r">username</span>,
                    <span class="r166 r">password</span>
                    );
                <b>if</b> (<span class="r165 r">hService</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <b>int</b> <span id="r178 rd" class="r178 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                    <span class="i">Win32Exception</span> <span id="r179 rd" class="r179 r">exception</span> = <b>new</b>(<span class="r178 r">lastError</span>);
                    <span class="i">WriteNonTerminatingError</span>(
                        <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                        <a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a>,
                        <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                        <span class="r179 r">exception</span>,
                        <span class="s">&quot;CouldNotNewService&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotNewService</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    <b>return</b>;
                }
 
                <span class="c">// Set the service description</span>
                <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#2bc1098513f803dc" class="t t">SERVICE_DESCRIPTIONW</a> <span id="r180 rd" class="r180 r">sd</span> = <b>new</b>();
                <span class="r180 r">sd</span>.<a href="#c52c6d443408a75f" class="i field">lpDescription</a> = <a href="#a24a4f36eb369e35" class="i property">Description</a>;
                <b>int</b> <span id="r181 rd" class="r181 r">size</span> = <span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r180 r">sd</span>);
                <span class="i">IntPtr</span> <span id="r182 rd" class="r182 r">buffer</span> = <span class="i">Marshal</span>.<span class="i">AllocCoTaskMem</span>(<span class="r181 r">size</span>);
                <span class="i">Marshal</span>.<span class="i">StructureToPtr</span>(<span class="r180 r">sd</span>, <span class="r182 r">buffer</span>, <b>false</b>);
 
                <b>bool</b> <span id="r183 rd" class="r183 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#1db68b9dcdfc65a0" class="i method">ChangeServiceConfig2W</a>(
                    <span class="r165 r">hService</span>,
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#751c9d4dde3dfee0" class="i field">SERVICE_CONFIG_DESCRIPTION</a>,
                    <span class="r182 r">buffer</span>);
 
                <b>if</b> (!<span class="r183 r">succeeded</span>)
                {
                    <b>int</b> <span id="r184 rd" class="r184 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                    <span class="i">Win32Exception</span> <span id="r185 rd" class="r185 r">exception</span> = <b>new</b>(<span class="r184 r">lastError</span>);
                    <span class="i">WriteNonTerminatingError</span>(
                        <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                        <a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a>,
                        <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                        <span class="r185 r">exception</span>,
                        <span class="s">&quot;CouldNotNewServiceDescription&quot;</span>,
                        <span class="i">ServiceResources</span>.<span class="i">CouldNotNewServiceDescription</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                }
 
                <span class="c">// Set the delayed auto start</span>
                <b>if</b> (<a href="#3f11c3db61cb85a3" class="i property">StartupType</a> == <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#b343bfbc1cf66a3a" class="i field">AutomaticDelayedStart</a>)
                {
                    <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b5b0e1e4dd1950a7" class="t t">SERVICE_DELAYED_AUTO_START_INFO</a> <span id="r186 rd" class="r186 r">ds</span> = <b>new</b>();
                    <span class="r186 r">ds</span>.<a href="#b1bd34dde2957ded" class="i field">fDelayedAutostart</a> = <b>true</b>;
                    <span class="r181 r">size</span> = <span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r186 r">ds</span>);
                    <span class="r167 r">delayedAutoStartInfoBuffer</span> = <span class="i">Marshal</span>.<span class="i">AllocCoTaskMem</span>(<span class="r181 r">size</span>);
                    <span class="i">Marshal</span>.<span class="i">StructureToPtr</span>(<span class="r186 r">ds</span>, <span class="r167 r">delayedAutoStartInfoBuffer</span>, <b>false</b>);
 
                    <span class="r183 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#1db68b9dcdfc65a0" class="i method">ChangeServiceConfig2W</a>(
                        <span class="r165 r">hService</span>,
                        <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#2ce69483ff46c549" class="i field">SERVICE_CONFIG_DELAYED_AUTO_START_INFO</a>,
                        <span class="r167 r">delayedAutoStartInfoBuffer</span>);
 
                    <b>if</b> (!<span class="r183 r">succeeded</span>)
                    {
                        <b>int</b> <span id="r187 rd" class="r187 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r188 rd" class="r188 r">exception</span> = <b>new</b>(<span class="r187 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                            <a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a>,
                            <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                            <span class="r188 r">exception</span>,
                            <span class="s">&quot;CouldNotNewServiceDelayedAutoStart&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotNewServiceDelayedAutoStart</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                }
 
                <span class="c">// write the ServiceController for the new service</span>
                <span class="r163 r">service</span> = <b>new</b> <span class="i">ServiceController</span>(<a href="#52527abdeb24a5e9" class="i property">Name</a>);
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#67eeccf0a7eb8d5f" class="i property">SecurityDescriptorSddl</a>))
                {
                    <a href="#b9bc4a850c3897aa" class="i method">SetServiceSecurityDescriptor</a>(<span class="r163 r">service</span>, <a href="#67eeccf0a7eb8d5f" class="i property">SecurityDescriptorSddl</a>, <span class="r165 r">hService</span>);
                }
 
                <span class="i">WriteObject</span>(<span class="r163 r">service</span>);
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r167 r">delayedAutoStartInfoBuffer</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="i">Marshal</span>.<span class="i">FreeCoTaskMem</span>(<span class="r167 r">delayedAutoStartInfoBuffer</span>);
                }
 
                <b>if</b> (<span class="r166 r">password</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="i">Marshal</span>.<span class="i">ZeroFreeCoTaskMemUnicode</span>(<span class="r166 r">password</span>);
                }
 
                <b>if</b> (<span class="r165 r">hService</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <b>bool</b> <span id="r189 rd" class="r189 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r165 r">hService</span>);
                    <b>if</b> (!<span class="r189 r">succeeded</span>)
                    {
                        <b>int</b> <span id="r190 rd" class="r190 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r191 rd" class="r191 r">exception</span> = <b>new</b>(<span class="r190 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                            <a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a>,
                            <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                            <span class="r191 r">exception</span>,
                            <span class="s">&quot;CouldNotNewServiceDescription&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotNewServiceDescription</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                }
 
                <b>if</b> (<span class="r164 r">hScManager</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <b>bool</b> <span id="r192 rd" class="r192 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r164 r">hScManager</span>);
                    <b>if</b> (!<span class="r192 r">succeeded</span>)
                    {
                        <b>int</b> <span id="r193 rd" class="r193 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r194 rd" class="r194 r">exception</span> = <b>new</b>(<span class="r193 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                            <a href="#9f7b1e3bc9aa888c" class="i property">DisplayName</a>,
                            <a href="#52527abdeb24a5e9" class="i property">Name</a>,
                            <span class="r194 r">exception</span>,
                            <span class="s">&quot;CouldNotNewServiceDescription&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotNewServiceDescription</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                }
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> NewServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> RemoveServiceCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the Remove-Service command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsCommon</span>.<span class="i">Remove</span>, <span class="s">&quot;Service&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Name&quot;</span>)]
    <b>public class</b> <a id="35142bbd1d326433" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="411e46935b4fe739">RemoveServiceCommand</span></a> : <a href="#057be076428c3adc" class="t t">ServiceBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the service to remove.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">Mandatory</span> = <b>true</b>, <span class="i">ValueFromPipeline</span> = <b>true</b>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;Name&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ServiceName&quot;</span>, <span class="s">&quot;SN&quot;</span>)]
        <b>public string</b> <a id="1bbeee494600e37f" href="../../R/1bbeee494600e37f.html" target="n" data-glyph="102,1" class="i property">Name</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following is the definition of the input parameter &quot;InputObject&quot;.</span>
        <span class="c">///</span><span class="c"> Specifies ServiceController object representing the services to be removed.</span>
        <span class="c">///</span><span class="c"> Enter a variable that contains the objects or type a command or expression</span>
        <span class="c">///</span><span class="c"> that gets the objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ValueFromPipeline</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>)]
        <b>public</b> <span class="i">ServiceController</span> <a id="a931935b1665d2c7" href="../../R/a931935b1665d2c7.html" target="n" data-glyph="102,1" class="i property">InputObject</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Remove the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">ArchitectureSensitive</span>]
        <b>protected override void</b> <a id="aaddb5982936d3dd" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <span class="i">ServiceController</span> <span id="r195 rd" class="r195 r">service</span> = <b>null</b>;
            <b>bool</b> <span id="r196 rd" class="r196 r">objServiceShouldBeDisposed</span> = <b>false</b>;
            <b>try</b>
            {
                <b>if</b> (<a href="#a931935b1665d2c7" class="i property">InputObject</a> != <b>null</b>)
                {
                    <span class="r195 r">service</span> = <a href="#a931935b1665d2c7" class="i property">InputObject</a>;
                    <a href="#1bbeee494600e37f" class="i property">Name</a> = <span class="r195 r">service</span>.<span class="i">ServiceName</span>;
                    <span class="r196 r">objServiceShouldBeDisposed</span> = <b>false</b>;
                }
                <b>else</b>
                {
                    <span class="r195 r">service</span> = <b>new</b> <span class="i">ServiceController</span>(<a href="#1bbeee494600e37f" class="i property">Name</a>);
                    <span class="r196 r">objServiceShouldBeDisposed</span> = <b>true</b>;
                }
 
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#1bbeee494600e37f" class="i property">Name</a>), <span class="s">&quot;null ServiceName&quot;</span>);
 
                <span class="c">// &quot;new ServiceController&quot; will succeed even if there is no such service.</span>
                <span class="c">// This checks whether the service actually exists.</span>
                <b>string</b> <span id="r197 rd" class="r197 r">unusedByDesign</span> = <span class="r195 r">service</span>.<span class="i">DisplayName</span>;
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r198 rd" class="r198 r">ex</span>)
            {
                <span class="c">// Cannot use WriteNonterminatingError as service is null</span>
                <span class="i">ErrorRecord</span> <span id="r199 rd" class="r199 r">er</span> = <b>new</b>(<span class="r198 r">ex</span>, <span class="s">&quot;ArgumentException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>, <a href="#1bbeee494600e37f" class="i property">Name</a>);
                <span class="i">WriteError</span>(<span class="r199 r">er</span>);
                <b>return</b>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r200 rd" class="r200 r">ex</span>)
            {
                <span class="c">// Cannot use WriteNonterminatingError as service is null</span>
                <span class="i">ErrorRecord</span> <span id="r201 rd" class="r201 r">er</span> = <b>new</b>(<span class="r200 r">ex</span>, <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>, <a href="#1bbeee494600e37f" class="i property">Name</a>);
                <span class="i">WriteError</span>(<span class="r201 r">er</span>);
                <b>return</b>;
            }
 
            <b>try</b> <span class="c">// In finally we ensure dispose, if object not pipelined.</span>
            {
                <span class="c">// Confirm the operation first.</span>
                <span class="c">// This is always false if WhatIf is set.</span>
                <b>if</b> (!<a href="#d74e872d88d6d9d5" class="i method">ShouldProcessServiceOperation</a>(<span class="r195 r">service</span>))
                {
                    <b>return</b>;
                }
 
                <span class="i">NakedWin32Handle</span> <span id="r202 rd" class="r202 r">hScManager</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <span class="i">NakedWin32Handle</span> <span id="r203 rd" class="r203 r">hService</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <b>try</b>
                {
                    <span class="r202 r">hScManager</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">OpenSCManagerW</span>(
                        <span class="i">lpMachineName</span>: <b>string</b>.<span class="i">Empty</span>,
                        <span class="i">lpDatabaseName</span>: <b>null</b>,
                        <span class="i">dwDesiredAccess</span>: <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#44a79599f10366a7" class="i field">SC_MANAGER_ALL_ACCESS</a>
                        );
                    <b>if</b> (<span class="r202 r">hScManager</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>int</b> <span id="r204 rd" class="r204 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r205 rd" class="r205 r">exception</span> = <b>new</b>(<span class="r204 r">lastError</span>);
                        <span class="i">WriteObject</span>(<span class="r205 r">exception</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r195 r">service</span>,
                            <span class="r205 r">exception</span>,
                            <span class="s">&quot;FailToOpenServiceControlManager&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">FailToOpenServiceControlManager</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        <b>return</b>;
                    }
 
                    <span class="r203 r">hService</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#06642c1e2bf140f5" class="i method">OpenServiceW</a>(
                        <span class="r202 r">hScManager</span>,
                        <a href="#1bbeee494600e37f" class="i property">Name</a>,
                        <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#a4981a80260f1988" class="i field">SERVICE_DELETE</a>
                        );
                    <b>if</b> (<span class="r203 r">hService</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>int</b> <span id="r206 rd" class="r206 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r207 rd" class="r207 r">exception</span> = <b>new</b>(<span class="r206 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r195 r">service</span>,
                            <span class="r207 r">exception</span>,
                            <span class="s">&quot;CouldNotRemoveService&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotRemoveService</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        <b>return</b>;
                    }
 
                    <b>bool</b> <span id="r208 rd" class="r208 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#ec15ba6982dd4c39" class="i method">DeleteService</a>(<span class="r203 r">hService</span>);
 
                    <b>if</b> (!<span class="r208 r">status</span>)
                    {
                        <b>int</b> <span id="r209 rd" class="r209 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <span class="i">Win32Exception</span> <span id="r210 rd" class="r210 r">exception</span> = <b>new</b>(<span class="r209 r">lastError</span>);
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r195 r">service</span>,
                            <span class="r210 r">exception</span>,
                            <span class="s">&quot;CouldNotRemoveService&quot;</span>,
                            <span class="i">ServiceResources</span>.<span class="i">CouldNotRemoveService</span>,
                            <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                }
                <b>finally</b>
                {
                    <b>if</b> (<span class="r203 r">hService</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>bool</b> <span id="r211 rd" class="r211 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r203 r">hService</span>);
                        <b>if</b> (!<span class="r211 r">succeeded</span>)
                        {
                            <b>int</b> <span id="r212 rd" class="r212 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<span class="r212 r">lastError</span> != 0, <span class="s">&quot;ErrorCode not success&quot;</span>);
                        }
                    }
 
                    <b>if</b> (<span class="r202 r">hScManager</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <b>bool</b> <span id="r213 rd" class="r213 r">succeeded</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ef53ccf2ad31f0c" class="i method">CloseServiceHandle</a>(<span class="r202 r">hScManager</span>);
                        <b>if</b> (!<span class="r213 r">succeeded</span>)
                        {
                            <b>int</b> <span id="r214 rd" class="r214 r">lastError</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<span class="r214 r">lastError</span> != 0, <span class="s">&quot;ErrorCode not success&quot;</span>);
                        }
                    }
                }
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r196 r">objServiceShouldBeDisposed</span>)
                {
                    <span class="r195 r">service</span>.<span class="i">Dispose</span>();
                }
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> RemoveServiceCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ServiceCommandException
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Non-terminating errors occurring in the service noun commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Serializable</span>]
    <b>public class</b> <a id="44aed4e263278c73" href="../../R/44aed4e263278c73.html" target="n" data-glyph="0,0" class="t t">ServiceCommandException</a> : <span class="i">SystemException</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctors
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Unimplemented standard constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Doesn&#39;t return.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a id="d1c83beb9aa642bd" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ServiceCommandException</a>()
            : <b>base</b>()
        {
            <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Standard constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r215 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Constructed object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a id="fb4429e34fe46db7" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ServiceCommandException</a>(<b>string</b> <span id="r215 rd" class="r215 r">message</span>)
            : <b>base</b>(<span class="r215 r">message</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Standard constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r216 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r217 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="cd90e14aa335aaa8" href="../../R/cd90e14aa335aaa8.html" target="n" data-glyph="72,1" class="t constructor">ServiceCommandException</a>(<b>string</b> <span id="r216 rd" class="r216 r">message</span>, <span class="i">Exception</span> <span id="r217 rd" class="r217 r">innerException</span>)
            : <b>base</b>(<span class="r216 r">message</span>, <span class="r217 r">innerException</span>)
        {
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctors
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Serialization
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serialization constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r218 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r219 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Constructed object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected</b> <a id="23a95ae56deca7f2" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">ServiceCommandException</a>(<span class="i">SerializationInfo</span> <span id="r218 rd" class="r218 r">info</span>, <span class="i">StreamingContext</span> <span id="r219 rd" class="r219 r">context</span>)
            : <b>base</b>(<span class="r218 r">info</span>, <span class="r219 r">context</span>)
        {
            <b>if</b> (<span class="r218 r">info</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r218 r">info</span>));
            }
 
            <a href="#8efd597676e9cdfb" class="i field">_serviceName</a> = <span class="r218 r">info</span>.<span class="i">GetString</span>(<span class="s">&quot;ServiceName&quot;</span>);
        }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r220 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Serialization information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r221 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Streaming context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="2ad40f81c17172a4" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetObjectData</a>(<span class="i">SerializationInfo</span> <span id="r220 rd" class="r220 r">info</span>, <span class="i">StreamingContext</span> <span id="r221 rd" class="r221 r">context</span>)
        {
            <b>if</b> (<span class="r220 r">info</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r220 r">info</span>));
            }
 
            <b>base</b>.<span class="i">GetObjectData</span>(<span class="r220 r">info</span>, <span class="r221 r">context</span>);
            <span class="r220 r">info</span>.<span class="i">AddValue</span>(<span class="s">&quot;ServiceName&quot;</span>, <a href="#8efd597676e9cdfb" class="i field">_serviceName</a>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Serialization
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the service which could not be found or operated upon.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>public string</b> <a id="98b08c8e9e8123ef" href="../../R/98b08c8e9e8123ef.html" target="n" data-glyph="102,1" class="i property">ServiceName</a>
        {
            <b>get</b> { <b>return</b> <a href="#8efd597676e9cdfb" class="i field">_serviceName</a>; }
 
            <b>set</b> { <a href="#8efd597676e9cdfb" class="i field">_serviceName</a> = <b>value</b>; }
        }
 
        <b>private string</b> <a id="8efd597676e9cdfb" href="../../R/8efd597676e9cdfb.html" target="n" data-glyph="46,1" class="i field">_serviceName</a> = <b>string</b>.<span class="i">Empty</span>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Properties
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ServiceCommandException
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> NativeMethods
    <b>internal static class</b> <a id="d4f00dbde8926963" href="../../R/d4f00dbde8926963.html" target="n" data-glyph="2,0" class="t t">NativeMethods</a>
    {
        <span class="c">// from winuser.h</span>
        <b>internal const int</b> <a id="6697684b555eb3ff" href="../../R/6697684b555eb3ff.html" target="n" data-glyph="8,1" class="i field">ERROR_SERVICE_ALREADY_RUNNING</a> = 1056;
        <b>internal const int</b> <a id="77719ea4b336f8e0" href="../../R/77719ea4b336f8e0.html" target="n" data-glyph="8,1" class="i field">ERROR_SERVICE_NOT_ACTIVE</a> = 1062;
        <b>internal const int</b> <a id="0f63784d1d702e4f" href="../../R/0f63784d1d702e4f.html" target="n" data-glyph="8,1" class="i field">ERROR_INSUFFICIENT_BUFFER</a> = 122;
        <b>internal const</b> <span class="i">DWORD</span> <a id="92b769997e7da9e5" href="../../R/92b769997e7da9e5.html" target="n" data-glyph="8,1" class="i field">ERROR_ACCESS_DENIED</a> = 0x5;
        <b>internal const</b> <span class="i">DWORD</span> <a id="cf1f86e8f9eac5f7" href="../../R/cf1f86e8f9eac5f7.html" target="n" data-glyph="8,1" class="i field">SC_MANAGER_CONNECT</a> = 1;
        <b>internal const</b> <span class="i">DWORD</span> <a id="24913401f94b7082" href="../../R/24913401f94b7082.html" target="n" data-glyph="8,1" class="i field">SC_MANAGER_CREATE_SERVICE</a> = 2;
        <b>internal const</b> <span class="i">DWORD</span> <a id="44a79599f10366a7" href="../../R/44a79599f10366a7.html" target="n" data-glyph="8,1" class="i field">SC_MANAGER_ALL_ACCESS</a> = 0xf003f;
        <b>internal const</b> <span class="i">DWORD</span> <a id="7c7a1ea429d0023f" href="../../R/7c7a1ea429d0023f.html" target="n" data-glyph="8,1" class="i field">SERVICE_QUERY_CONFIG</a> = 1;
        <b>internal const</b> <span class="i">DWORD</span> <a id="542d7644d4c59fd9" href="../../R/542d7644d4c59fd9.html" target="n" data-glyph="8,1" class="i field">SERVICE_CHANGE_CONFIG</a> = 2;
        <b>internal const</b> <span class="i">DWORD</span> <a id="a4981a80260f1988" href="../../R/a4981a80260f1988.html" target="n" data-glyph="8,1" class="i field">SERVICE_DELETE</a> = 0x10000;
        <b>internal const</b> <span class="i">DWORD</span> <a id="b58d133597cd5d07" href="../../R/b58d133597cd5d07.html" target="n" data-glyph="8,1" class="i field">SERVICE_NO_CHANGE</a> = 0xffffffff;
        <b>internal const</b> <span class="i">DWORD</span> <a id="4ab7d222bab1f48e" href="../../R/4ab7d222bab1f48e.html" target="n" data-glyph="8,1" class="i field">SERVICE_AUTO_START</a> = 0x2;
        <b>internal const</b> <span class="i">DWORD</span> <a id="ae84640278c45ede" href="../../R/ae84640278c45ede.html" target="n" data-glyph="8,1" class="i field">SERVICE_DEMAND_START</a> = 0x3;
        <b>internal const</b> <span class="i">DWORD</span> <a id="849d683b1cf1aa56" href="../../R/849d683b1cf1aa56.html" target="n" data-glyph="8,1" class="i field">SERVICE_DISABLED</a> = 0x4;
        <b>internal const</b> <span class="i">DWORD</span> <a id="751c9d4dde3dfee0" href="../../R/751c9d4dde3dfee0.html" target="n" data-glyph="8,1" class="i field">SERVICE_CONFIG_DESCRIPTION</a> = 1;
        <b>internal const</b> <span class="i">DWORD</span> <a id="2ce69483ff46c549" href="../../R/2ce69483ff46c549.html" target="n" data-glyph="8,1" class="i field">SERVICE_CONFIG_DELAYED_AUTO_START_INFO</a> = 3;
        <b>internal const</b> <span class="i">DWORD</span> <a id="def695abfefe980d" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SERVICE_CONFIG_SERVICE_SID_INFO</a> = 5;
        <b>internal const</b> <span class="i">DWORD</span> <a id="b6141de8201c6dbb" href="../../R/b6141de8201c6dbb.html" target="n" data-glyph="8,1" class="i field">WRITE_DAC</a> = 262144;
        <b>internal const</b> <span class="i">DWORD</span> <a id="5c0fe13e1d62165b" href="../../R/5c0fe13e1d62165b.html" target="n" data-glyph="8,1" class="i field">WRITE_OWNER</a> = 524288;
        <b>internal const</b> <span class="i">DWORD</span> <a id="3fb445e8cf0c8c0c" href="../../R/3fb445e8cf0c8c0c.html" target="n" data-glyph="8,1" class="i field">SERVICE_WIN32_OWN_PROCESS</a> = 0x10;
        <b>internal const</b> <span class="i">DWORD</span> <a id="1c18d45bb47e1afc" href="../../R/1c18d45bb47e1afc.html" target="n" data-glyph="8,1" class="i field">SERVICE_ERROR_NORMAL</a> = 1;
 
        <span class="c">// from winnt.h</span>
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">OpenSCManagerWDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern</b>
        <span class="i">NakedWin32Handle</span> <a id="800a4aeb03d571f5" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">OpenSCManagerW</a>(
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r222 rd" class="r222 r">lpMachineName</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r223 rd" class="r223 r">lpDatabaseName</span>,
            <span class="i">DWORD</span> <span id="r224 rd" class="r224 r">dwDesiredAccess</span>
            );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">OpenServiceWDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern</b>
        <span class="i">NakedWin32Handle</span> <a id="06642c1e2bf140f5" href="../../R/06642c1e2bf140f5.html" target="n" data-glyph="74,1" class="i method">OpenServiceW</a>(
            <span class="i">NakedWin32Handle</span> <span id="r225 rd" class="r225 r">hSCManager</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r226 rd" class="r226 r">lpServiceName</span>,
            <span class="i">DWORD</span> <span id="r227 rd" class="r227 r">dwDesiredAccess</span>
            );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">QueryServiceConfigDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern
        bool</b> <a id="6effe9ea3cd33a9e" href="../../R/6effe9ea3cd33a9e.html" target="n" data-glyph="74,1" class="i method">QueryServiceConfigW</a>(
            <span class="i">NakedWin32Handle</span> <span id="r228 rd" class="r228 r">hSCManager</span>,
            <span class="i">IntPtr</span> <span id="r229 rd" class="r229 r">lpServiceConfig</span>,
            <span class="i">DWORD</span> <span id="r230 rd" class="r230 r">cbBufSize</span>,
            <b>out</b> <span class="i">DWORD</span> <span id="r231 rd" class="r231 r">pcbBytesNeeded</span>
            );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">QueryServiceConfig2DllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern
        bool</b> <a id="90cd6d3fdd0abe43" href="../../R/90cd6d3fdd0abe43.html" target="n" data-glyph="74,1" class="i method">QueryServiceConfig2W</a>(
            <span class="i">NakedWin32Handle</span> <span id="r232 rd" class="r232 r">hService</span>,
            <span class="i">DWORD</span> <span id="r233 rd" class="r233 r">dwInfoLevel</span>,
            <span class="i">IntPtr</span> <span id="r234 rd" class="r234 r">lpBuffer</span>,
            <span class="i">DWORD</span> <span id="r235 rd" class="r235 r">cbBufSize</span>,
            <b>out</b> <span class="i">DWORD</span> <span id="r236 rd" class="r236 r">pcbBytesNeeded</span>
            );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CloseServiceHandleDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern
        bool</b> <a id="4ef53ccf2ad31f0c" href="../../R/4ef53ccf2ad31f0c.html" target="n" data-glyph="74,1" class="i method">CloseServiceHandle</a>(
            <span class="i">NakedWin32Handle</span> <span id="r237 rd" class="r237 r">hSCManagerOrService</span>
            );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">DeleteServiceDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern
        bool</b> <a id="ec15ba6982dd4c39" href="../../R/ec15ba6982dd4c39.html" target="n" data-glyph="74,1" class="i method">DeleteService</a>(
            <span class="i">NakedWin32Handle</span> <span id="r238 rd" class="r238 r">hService</span>
            );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ChangeServiceConfigWDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern
        bool</b> <a id="4db5dccce319a7d1" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ChangeServiceConfigW</a>(
            <span class="i">NakedWin32Handle</span> <span id="r239 rd" class="r239 r">hService</span>,
            <span class="i">DWORD</span> <span id="r240 rd" class="r240 r">dwServiceType</span>,
            <span class="i">DWORD</span> <span id="r241 rd" class="r241 r">dwStartType</span>,
            <span class="i">DWORD</span> <span id="r242 rd" class="r242 r">dwErrorControl</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r243 rd" class="r243 r">lpBinaryPathName</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r244 rd" class="r244 r">lpLoadOrderGroup</span>,
            <span class="i">IntPtr</span> <span id="r245 rd" class="r245 r">lpdwTagId</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r246 rd" class="r246 r">lpDependencies</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r247 rd" class="r247 r">lpServiceStartName</span>,
            [<span class="i">In</span>] <span class="i">IntPtr</span> <span id="r248 rd" class="r248 r">lpPassword</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r249 rd" class="r249 r">lpDisplayName</span>
            );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ChangeServiceConfig2WDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern
        bool</b> <a id="1db68b9dcdfc65a0" href="../../R/1db68b9dcdfc65a0.html" target="n" data-glyph="74,1" class="i method">ChangeServiceConfig2W</a>(
            <span class="i">NakedWin32Handle</span> <span id="r250 rd" class="r250 r">hService</span>,
            <span class="i">DWORD</span> <span id="r251 rd" class="r251 r">dwInfoLevel</span>,
            <span class="i">IntPtr</span> <span id="r252 rd" class="r252 r">lpInfo</span>
            );
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="2bc1098513f803dc" href="../../R/2bc1098513f803dc.html" target="n" data-glyph="110,1" class="t t"><span id="2fa23de92fb9aa19">SERVICE_DESCRIPTIONW</span></a>
        {
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)]
            <b>internal string</b> <a id="c52c6d443408a75f" href="../../R/c52c6d443408a75f.html" target="n" data-glyph="44,2" class="i field">lpDescription</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="b356145bb2f724c7" href="../../R/b356145bb2f724c7.html" target="n" data-glyph="110,1" class="t t"><span id="96cc7c6808c169ec">QUERY_SERVICE_CONFIG</span></a>
        {
            <b>internal uint</b> <a id="ded196d474059add" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">dwServiceType</a>;
            <b>internal uint</b> <a id="d563a18436edbb54" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">dwStartType</a>;
            <b>internal uint</b> <a id="1271f50125254207" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">dwErrorControl</a>;
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>internal string</b> <a id="f8c9f4583b705728" href="../../R/f8c9f4583b705728.html" target="n" data-glyph="44,2" class="i field">lpBinaryPathName</a>;
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>internal string</b> <a id="c80041bbb06b8c80" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">lpLoadOrderGroup</a>;
            <b>internal uint</b> <a id="b41fc101d2ad4be6" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">dwTagId</a>;
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>internal string</b> <a id="ca626ae7bf959cfe" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">lpDependencies</a>;
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>internal string</b> <a id="246e55e03fee905e" href="../../R/246e55e03fee905e.html" target="n" data-glyph="44,2" class="i field">lpServiceStartName</a>;
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>internal string</b> <a id="47346e07b73d9169" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">lpDisplayName</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="b5b0e1e4dd1950a7" href="../../R/b5b0e1e4dd1950a7.html" target="n" data-glyph="110,1" class="t t"><span id="9e0574b7622307f7">SERVICE_DELAYED_AUTO_START_INFO</span></a>
        {
            <b>internal bool</b> <a id="b1bd34dde2957ded" href="../../R/b1bd34dde2957ded.html" target="n" data-glyph="44,2" class="i field">fDelayedAutostart</a>;
        }
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CreateServiceWDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>internal static extern</b>
        <span class="i">NakedWin32Handle</span> <a id="ca437da10df132a7" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreateServiceW</a>(
            <span class="i">NakedWin32Handle</span> <span id="r253 rd" class="r253 r">hSCManager</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r254 rd" class="r254 r">lpServiceName</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r255 rd" class="r255 r">lpDisplayName</span>,
            <span class="i">DWORD</span> <span id="r256 rd" class="r256 r">dwDesiredAccess</span>,
            <span class="i">DWORD</span> <span id="r257 rd" class="r257 r">dwServiceType</span>,
            <span class="i">DWORD</span> <span id="r258 rd" class="r258 r">dwStartType</span>,
            <span class="i">DWORD</span> <span id="r259 rd" class="r259 r">dwErrorControl</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r260 rd" class="r260 r">lpBinaryPathName</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r261 rd" class="r261 r">lpLoadOrderGroup</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r262 rd" class="r262 r">lpdwTagId</span>,
            [<span class="i">In</span>] <span class="i">IntPtr</span> <span id="r263 rd" class="r263 r">lpDependencies</span>,
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r264 rd" class="r264 r">lpServiceStartName</span>,
            [<span class="i">In</span>] <span class="i">IntPtr</span> <span id="r265 rd" class="r265 r">lpPassword</span>
        );
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetServiceObjectSecurityDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>internal static extern
        bool</b> <a id="a72269da99e3d350" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetServiceObjectSecurity</a>(
            <span class="i">NakedWin32Handle</span> <span id="r266 rd" class="r266 r">hSCManager</span>,
            <span class="i">System</span>.<span class="i">Security</span>.<span class="i">AccessControl</span>.<span class="i">SecurityInfos</span> <span id="r267 rd" class="r267 r">dwSecurityInformation</span>,
            <b>byte</b>[] <span id="r268 rd" class="r268 r">lpSecurityDescriptor</span>
            );
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> CreateJobObject API creates or opens a job object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r269 r">lpJobAttributes</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A pointer to a SECURITY_ATTRIBUTES structure that specifies the security descriptor for the</span>
        <span class="c">///</span><span class="c"> job object and determines whether child processes can inherit the returned handle.</span>
        <span class="c">///</span><span class="c"> If lpJobAttributes is NULL, the job object gets a default security descriptor</span>
        <span class="c">///</span><span class="c"> and the handle cannot be inherited.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r270 r">lpName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the job.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the function succeeds, the return value is a handle to the job object.</span>
        <span class="c">///</span><span class="c"> If the object existed before the function call, the function</span>
        <span class="c">///</span><span class="c"> returns a handle to the existing job object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;Kernel32.dll&quot;</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
        <b>internal static extern</b> <span class="i">IntPtr</span> <a id="0337890467a78573" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreateJobObject</a>(<span class="i">IntPtr</span> <span id="r269 rd" class="r269 r">lpJobAttributes</span>, <b>string</b> <span id="r270 rd" class="r270 r">lpName</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> AssignProcessToJobObject API is used to assign a process to an existing job object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r271 r">hJob</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A handle to the job object to which the process will be associated.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r272 r">hProcess</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A handle to the process to associate with the job object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">If the function succeeds, the return value is nonzero.</span>
        <span class="c">///</span><span class="c"> If the function fails, the return value is zero.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;Kernel32.dll&quot;</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>internal static extern bool</b> <a id="351be7face506eca" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AssignProcessToJobObject</a>(<span class="i">SafeHandle</span> <span id="r271 rd" class="r271 r">hJob</span>, <span class="i">IntPtr</span> <span id="r272 rd" class="r272 r">hProcess</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves job state information from the job object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r273 r">hJob</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A handle to the job whose information is being queried.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r274 r">JobObjectInfoClass</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The information class for the limits to be queried.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r275 r">lpJobObjectInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The limit or job state information.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r276 r">cbJobObjectLength</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The count of the job information being queried, in bytes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r277 r">lpReturnLength</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A pointer to a variable that receives the length of</span>
        <span class="c">///</span><span class="c"> data written to the structure pointed to by the lpJobObjectInfo parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">If the function succeeds, the return value is nonzero.</span>
        <span class="c">///</span><span class="c"> If the function fails, the return value is zero.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;Kernel32.dll&quot;</span>, <span class="i">EntryPoint</span> = <span class="s">&quot;QueryInformationJobObject&quot;</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
        <b>public static extern bool</b> <a id="115da8d0ebecee93" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">QueryInformationJobObject</a>(<span class="i">SafeHandle</span> <span id="r273 rd" class="r273 r">hJob</span>, <b>int</b> <span id="r274 rd" class="r274 r">JobObjectInfoClass</span>,
                                    <b>ref</b> <a href="Process.cs.html#182d1b5693785be2" class="t t">JOBOBJECT_BASIC_PROCESS_ID_LIST</a> <span id="r275 rd" class="r275 r">lpJobObjectInfo</span>,
                                    <b>int</b> <span id="r276 rd" class="r276 r">cbJobObjectLength</span>, <span class="i">IntPtr</span> <span id="r277 rd" class="r277 r">lpReturnLength</span>);
 
        <b>internal static bool</b> <a id="90f99ef4595f1804" href="../../R/90f99ef4595f1804.html" target="n" data-glyph="74,1" class="i method">QueryServiceConfig</a>(<span class="i">NakedWin32Handle</span> <span id="r278 rd" class="r278 r">hService</span>, <b>out</b> <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b356145bb2f724c7" class="t t">QUERY_SERVICE_CONFIG</a> <span id="r279 rd" class="r279 r">configStructure</span>)
        {
            <span class="i">IntPtr</span> <span id="r280 rd" class="r280 r">lpBuffer</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="r279 r">configStructure</span> = <b>default</b>(<a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b356145bb2f724c7" class="t t">QUERY_SERVICE_CONFIG</a>);
            <span class="i">DWORD</span> <span id="r281 rd" class="r281 r">bufferSize</span>, <span id="r282 rd" class="r282 r">bufferSizeNeeded</span> = 0;
            <b>bool</b> <span id="r283 rd" class="r283 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">QueryServiceConfigW</span>(
                <span class="i">hSCManager</span>: <span class="r278 r">hService</span>,
                <span class="i">lpServiceConfig</span>: <span class="r280 r">lpBuffer</span>,
                <span class="i">cbBufSize</span>: 0,
                <span class="i">pcbBytesNeeded</span>: <b>out</b> <span class="r282 r">bufferSizeNeeded</span>);
 
            <b>if</b> (!<span class="r283 r">status</span> &amp;&amp; <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>() != <a href="#0f63784d1d702e4f" class="i field">ERROR_INSUFFICIENT_BUFFER</a>)
            {
                <b>return</b> <span class="r283 r">status</span>;
            }
 
            <b>try</b>
            {
                <span class="r280 r">lpBuffer</span> = <span class="i">Marshal</span>.<span class="i">AllocCoTaskMem</span>((<b>int</b>)<span class="r282 r">bufferSizeNeeded</span>);
                <span class="r281 r">bufferSize</span> = <span class="r282 r">bufferSizeNeeded</span>;
 
                <span class="r283 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#6effe9ea3cd33a9e" class="i method">QueryServiceConfigW</a>(
                    <span class="r278 r">hService</span>,
                    <span class="r280 r">lpBuffer</span>,
                    <span class="r281 r">bufferSize</span>,
                    <b>out</b> <span class="r282 r">bufferSizeNeeded</span>);
                <span class="r279 r">configStructure</span> = (<a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b356145bb2f724c7" class="t t">QUERY_SERVICE_CONFIG</a>)<span class="i">Marshal</span>.<span class="i">PtrToStructure</span>(<span class="r280 r">lpBuffer</span>, <b>typeof</b>(<a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b356145bb2f724c7" class="t t">QUERY_SERVICE_CONFIG</a>));
            }
            <b>finally</b>
            {
                <span class="i">Marshal</span>.<span class="i">FreeCoTaskMem</span>(<span class="r280 r">lpBuffer</span>);
            }
 
            <b>return</b> <span class="r283 r">status</span>;
        }
 
        <b>internal static bool</b> <a id="08f44942f5e802fd" href="../../R/08f44942f5e802fd.html" target="n" data-glyph="74,1" class="i method">QueryServiceConfig2</a>&lt;<span id="r284 rd t" class="r284 r t">T</span>&gt;(<span class="i">NakedWin32Handle</span> <span id="r285 rd" class="r285 r">hService</span>, <span class="i">DWORD</span> <span id="r286 rd" class="r286 r">infolevel</span>, <b>out</b> <span class="r284 r t">T</span> <span id="r287 rd" class="r287 r">configStructure</span>)
        {
            <span class="i">IntPtr</span> <span id="r288 rd" class="r288 r">lpBuffer</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="r287 r">configStructure</span> = <b>default</b>(<span class="r284 r t">T</span>);
            <span class="i">DWORD</span> <span id="r289 rd" class="r289 r">bufferSize</span>, <span id="r290 rd" class="r290 r">bufferSizeNeeded</span> = 0;
 
            <b>bool</b> <span id="r291 rd" class="r291 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">QueryServiceConfig2W</span>(
                <span class="i">hService</span>: <span class="r285 r">hService</span>,
                <span class="i">dwInfoLevel</span>: <span class="r286 r">infolevel</span>,
                <span class="i">lpBuffer</span>: <span class="r288 r">lpBuffer</span>,
                <span class="i">cbBufSize</span>: 0,
                <span class="i">pcbBytesNeeded</span>: <b>out</b> <span class="r290 r">bufferSizeNeeded</span>);
 
            <b>if</b> (!<span class="r291 r">status</span> &amp;&amp; <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>() != <a href="#0f63784d1d702e4f" class="i field">ERROR_INSUFFICIENT_BUFFER</a>)
            {
                <b>return</b> <span class="r291 r">status</span>;
            }
 
            <b>try</b>
            {
                <span class="r288 r">lpBuffer</span> = <span class="i">Marshal</span>.<span class="i">AllocCoTaskMem</span>((<b>int</b>)<span class="r290 r">bufferSizeNeeded</span>);
                <span class="r289 r">bufferSize</span> = <span class="r290 r">bufferSizeNeeded</span>;
 
                <span class="r291 r">status</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#90cd6d3fdd0abe43" class="i method">QueryServiceConfig2W</a>(
                    <span class="r285 r">hService</span>,
                    <span class="r286 r">infolevel</span>,
                    <span class="r288 r">lpBuffer</span>,
                    <span class="r289 r">bufferSize</span>,
                    <b>out</b> <span class="r290 r">bufferSizeNeeded</span>);
                <span class="r287 r">configStructure</span> = (<span class="r284 r t">T</span>)<span class="i">Marshal</span>.<span class="i">PtrToStructure</span>(<span class="r288 r">lpBuffer</span>, <b>typeof</b>(<span class="r284 r t">T</span>));
            }
            <b>finally</b>
            {
                <span class="i">Marshal</span>.<span class="i">FreeCoTaskMem</span>(<span class="r288 r">lpBuffer</span>);
            }
 
            <b>return</b> <span class="r291 r">status</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get appropriate win32 StartupType.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r292 r">StartupType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> StartupType provided by the user.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r293 r">dwStartType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Out parameter of the native win32 StartupType</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If a supported StartupType is provided, funciton returns true, otherwise false.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="67fff2228f3f3f88" href="../../R/67fff2228f3f3f88.html" target="n" data-glyph="74,1" class="i method">TryGetNativeStartupType</a>(<a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a> <span id="r292 rd" class="r292 r">StartupType</span>, <b>out</b> <span class="i">DWORD</span> <span id="r293 rd" class="r293 r">dwStartType</span>)
        {
            <b>bool</b> <span id="r294 rd" class="r294 r">success</span> = <b>true</b>;
            <span class="r293 r">dwStartType</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b58d133597cd5d07" class="i field">SERVICE_NO_CHANGE</a>;
            <b>switch</b> (<span class="r292 r">StartupType</span>)
            {
                <b>case</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#7003922d6d85b7ee" class="i field">Automatic</a>:
                <b>case</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#b343bfbc1cf66a3a" class="i field">AutomaticDelayedStart</a>:
                    <span class="r293 r">dwStartType</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#4ab7d222bab1f48e" class="i field">SERVICE_AUTO_START</a>;
                    <b>break</b>;
                <b>case</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#82d8277e9cf1561f" class="i field">Manual</a>:
                    <span class="r293 r">dwStartType</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#ae84640278c45ede" class="i field">SERVICE_DEMAND_START</a>;
                    <b>break</b>;
                <b>case</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#9193e09ab9d35288" class="i field">Disabled</a>:
                    <span class="r293 r">dwStartType</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#849d683b1cf1aa56" class="i field">SERVICE_DISABLED</a>;
                    <b>break</b>;
                <b>case</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#386403234ca2e535" class="i field">InvalidValue</a>:
                    <span class="r293 r">dwStartType</span> = <a href="#d4f00dbde8926963" class="t t">NativeMethods</a>.<a href="#b58d133597cd5d07" class="i field">SERVICE_NO_CHANGE</a>;
                    <b>break</b>;
                <b>default</b>:
                    <span class="r294 r">success</span> = <b>false</b>;
                    <b>break</b>;
            }
 
            <b>return</b> <span class="r294 r">success</span>;
        }
 
        <b>internal static</b> <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a> <a id="8495b3c770e5b942" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetServiceStartupType</a>(<span class="i">ServiceStartMode</span> <span id="r295 rd" class="r295 r">startMode</span>, <b>bool</b> <span id="r296 rd" class="r296 r">delayedAutoStart</span>)
        {
            <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a> <span id="r297 rd" class="r297 r">result</span> = <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#9193e09ab9d35288" class="i field">Disabled</a>;
            <b>switch</b> (<span class="r295 r">startMode</span>)
            {
                <b>case</b> <span class="i">ServiceStartMode</span>.<span class="i">Automatic</span>:
                    <span class="r297 r">result</span> = <span class="r296 r">delayedAutoStart</span> ? <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#b343bfbc1cf66a3a" class="i field">AutomaticDelayedStart</a> : <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#7003922d6d85b7ee" class="i field">Automatic</a>;
                    <b>break</b>;
                <b>case</b> <span class="i">ServiceStartMode</span>.<span class="i">Manual</span>:
                    <span class="r297 r">result</span> = <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#82d8277e9cf1561f" class="i field">Manual</a>;
                    <b>break</b>;
                <b>case</b> <span class="i">ServiceStartMode</span>.<span class="i">Disabled</span>:
                    <span class="r297 r">result</span> = <a href="#26bd1b48e3377a63" class="t t">ServiceStartupType</a>.<a href="#9193e09ab9d35288" class="i field">Disabled</a>;
                    <b>break</b>;
            }
 
            <b>return</b> <span class="r297 r">result</span>;
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> NativeMethods
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ServiceStartupType
    <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">Enum for usage with StartupType. Automatic, Manual and Disabled index matched from System.ServiceProcess.ServiceStartMode</span>
    <span class="c">///</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="26bd1b48e3377a63" href="../../R/26bd1b48e3377a63.html" target="n" data-glyph="18,0" class="t t"><span id="7dc92e0e2bb54b6b">ServiceStartupType</span></a>
    {
        <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Invalid service</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="386403234ca2e535" href="../../R/386403234ca2e535.html" target="n" data-glyph="24,1" class="i field">InvalidValue</a> = -1,
        <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Automatic service</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="7003922d6d85b7ee" href="../../R/7003922d6d85b7ee.html" target="n" data-glyph="24,1" class="i field">Automatic</a> = 2,
        <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Manual service</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="82d8277e9cf1561f" href="../../R/82d8277e9cf1561f.html" target="n" data-glyph="24,1" class="i field">Manual</a> = 3,
        <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Disabled service</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="9193e09ab9d35288" href="../../R/9193e09ab9d35288.html" target="n" data-glyph="24,1" class="i field">Disabled</a> = 4,
        <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Automatic (Delayed Start) service</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="b343bfbc1cf66a3a" href="../../R/b343bfbc1cf66a3a.html" target="n" data-glyph="24,1" class="i field">AutomaticDelayedStart</a> = 10
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ServiceStartupType
}
 
<span class="k preprocess">#</span><span class="k preprocess">endif</span> <span class="c">// Not built on Unix</span>
</pre></td></tr></table></div></body></html>
