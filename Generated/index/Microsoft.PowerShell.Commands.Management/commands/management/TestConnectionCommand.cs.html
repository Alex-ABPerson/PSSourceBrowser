<!DOCTYPE html>
<html><head><title>TestConnectionCommand.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1099);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/commands/management/TestConnectionCommand.cs" target="_top">commands\management\TestConnectionCommand.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">enable</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Internal</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Net</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Net</span>.<span class="i">NetworkInformation</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Net</span>.<span class="i">Sockets</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The implementation of the &quot;Test-Connection&quot; cmdlet.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsDiagnostic</span>.<span class="i">Test</span>, <span class="s">&quot;Connection&quot;</span>, <span class="i">DefaultParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097144&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="#9be3860f5d7a0a5e" class="t t">PingStatus</a>), <span class="i">ParameterSetName</span> = <b>new</b> <b>string</b>[] { <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a> })]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="#9be3860f5d7a0a5e" class="t t">PingStatus</a>), <span class="i">ParameterSetName</span> = <b>new</b> <b>string</b>[] { <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>, <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a> })]
    [<span class="i">OutputType</span>(<b>typeof</b>(<b>bool</b>), <span class="i">ParameterSetName</span> = <b>new</b> <b>string</b>[] { <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>, <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>, <a href="#54aab4a7066f44ba" class="i field">TcpPortParameterSet</a> })]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="#f0dface89530e0ac" class="t t">PingMtuStatus</a>), <span class="i">ParameterSetName</span> = <b>new</b> <b>string</b>[] { <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a> })]
    [<span class="i">OutputType</span>(<b>typeof</b>(<b>int</b>), <span class="i">ParameterSetName</span> = <b>new</b> <b>string</b>[] { <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a> })]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="#776703316bdcd0e1" class="t t">TraceStatus</a>), <span class="i">ParameterSetName</span> = <b>new</b> <b>string</b>[] { <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a> })]
    <b>public class</b> <a id="5321ee1f6a221808" href="../../R/5321ee1f6a221808.html" target="n" data-glyph="0,0" class="t t"><span id="74f12e7ae6268db9">TestConnectionCommand</span></a> : <span class="i">PSCmdlet</span>, <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameter Set Names
        <b>private const string</b> <a id="a05387a517d8a8a2" href="../../R/a05387a517d8a8a2.html" target="n" data-glyph="10,1" class="i field">DefaultPingParameterSet</a> = <span class="s">&quot;DefaultPing&quot;</span>;
        <b>private const string</b> <a id="45e6b47e010124ef" href="../../R/45e6b47e010124ef.html" target="n" data-glyph="10,1" class="i field">RepeatPingParameterSet</a> = <span class="s">&quot;RepeatPing&quot;</span>;
        <b>private const string</b> <a id="1d459f8fe1c76039" href="../../R/1d459f8fe1c76039.html" target="n" data-glyph="10,1" class="i field">TraceRouteParameterSet</a> = <span class="s">&quot;TraceRoute&quot;</span>;
        <b>private const string</b> <a id="54aab4a7066f44ba" href="../../R/54aab4a7066f44ba.html" target="n" data-glyph="10,1" class="i field">TcpPortParameterSet</a> = <span class="s">&quot;TcpPort&quot;</span>;
        <b>private const string</b> <a id="79f8793e672eb8bb" href="../../R/79f8793e672eb8bb.html" target="n" data-glyph="10,1" class="i field">MtuSizeDetectParameterSet</a> = <span class="s">&quot;MtuSizeDetect&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Cmdlet Defaults
 
        <span class="c">// Count of pings sent to each trace route hop. Default mimics Windows&#39; defaults.</span>
        <span class="c">// If this value changes, we need to update &#39;ConsoleTraceRouteReply&#39; resource string.</span>
        <b>private const uint</b> <a id="e953fbcb88dc4fa0" href="../../R/e953fbcb88dc4fa0.html" target="n" data-glyph="10,1" class="i field">DefaultTraceRoutePingCount</a> = 3;
 
        <span class="c">// Default size for the send buffer.</span>
        <b>private const int</b> <a id="aa8175edff52c6b5" href="../../R/aa8175edff52c6b5.html" target="n" data-glyph="10,1" class="i field">DefaultSendBufferSize</a> = 32;
 
        <b>private const int</b> <a id="fda377cd0d177185" href="../../R/fda377cd0d177185.html" target="n" data-glyph="10,1" class="i field">DefaultMaxHops</a> = 128;
 
        <b>private const string</b> <a id="8b39d64497f044fd" href="../../R/8b39d64497f044fd.html" target="n" data-glyph="10,1" class="i field">TestConnectionExceptionId</a> = <span class="s">&quot;TestConnectionException&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Fields
 
        <b>private static byte</b>[]? <a id="cc3c1c85274b241d" href="../../R/cc3c1c85274b241d.html" target="n" data-glyph="46,1" class="i field">s_DefaultSendBuffer</a>;
 
        <b>private readonly</b> <span class="i">CancellationTokenSource</span> <a id="4305abaa634c3540" href="../../R/4305abaa634c3540.html" target="n" data-glyph="46,1" class="i field">_dnsLookupCancel</a> = <b>new</b>();
 
        <b>private bool</b> <a id="c60acc6839aaa723" href="../../R/c60acc6839aaa723.html" target="n" data-glyph="46,1" class="i field">_disposed</a>;
 
        <b>private</b> <span class="i">Ping</span>? <a id="d44970e08e30afec" href="../../R/d44970e08e30afec.html" target="n" data-glyph="46,1" class="i field">_sender</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to do ping test.</span>
        <span class="c">///</span><span class="c"> Default is true.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="08ef016307329028" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Ping</a> { <b>get</b>; <b>set</b>; } = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to force use of IPv4 protocol.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#54aab4a7066f44ba" class="i field">TcpPortParameterSet</a>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="ef51dff983395e8c" href="../../R/ef51dff983395e8c.html" target="n" data-glyph="102,1" class="i property">IPv4</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to force use of IPv6 protocol.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#54aab4a7066f44ba" class="i field">TcpPortParameterSet</a>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="c52094cd27164201" href="../../R/c52094cd27164201.html" target="n" data-glyph="102,1" class="i property">IPv6</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to do reverse DNS lookup to get names for IP addresses.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#54aab4a7066f44ba" class="i field">TcpPortParameterSet</a>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="45051e8417e812d5" href="../../R/45051e8417e812d5.html" target="n" data-glyph="102,1" class="i property">ResolveDestination</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the source from which to run the selected test.</span>
        <span class="c">///</span><span class="c"> The default is localhost.</span>
        <span class="c">///</span><span class="c"> Remoting is not yet implemented internally in the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#54aab4a7066f44ba" class="i field">TcpPortParameterSet</a>)]
        <b>public string</b> <a id="2041a060818ed445" href="../../R/2041a060818ed445.html" target="n" data-glyph="102,1" class="i property">Source</a> { <b>get</b>; } = <span class="i">Dns</span>.<span class="i">GetHostName</span>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the number of times the Ping data packets can be forwarded by routers.</span>
        <span class="c">///</span><span class="c"> As gateways and routers transmit packets through a network, they decrement the Time-to-Live (TTL)</span>
        <span class="c">///</span><span class="c"> value found in the packet header.</span>
        <span class="c">///</span><span class="c"> The default (from Windows) is 128 hops.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a>)]
        [<span class="i">ValidateRange</span>(1, <a href="#fda377cd0d177185" class="i field">DefaultMaxHops</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;Ttl&quot;</span>, <span class="s">&quot;TimeToLive&quot;</span>, <span class="s">&quot;Hops&quot;</span>)]
        <b>public int</b> <a id="ecc53cd0b595d12c" href="../../R/ecc53cd0b595d12c.html" target="n" data-glyph="102,1" class="i property">MaxHops</a> { <b>get</b>; <b>set</b>; } = <a href="#fda377cd0d177185" class="i field">DefaultMaxHops</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the number of ping attempts.</span>
        <span class="c">///</span><span class="c"> The default (from Windows) is 4 times.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">ValidateRange</span>(<span class="i">ValidateRangeKind</span>.<span class="i">Positive</span>)]
        <b>public int</b> <a id="9bf9dc5be52a4274" href="../../R/9bf9dc5be52a4274.html" target="n" data-glyph="102,1" class="i property">Count</a> { <b>get</b>; <b>set</b>; } = 4;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the delay between ping attempts.</span>
        <span class="c">///</span><span class="c"> The default (from Windows) is 1 second.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">ValidateRange</span>(<span class="i">ValidateRangeKind</span>.<span class="i">Positive</span>)]
        <b>public int</b> <a id="6cec0204d0cacbe4" href="../../R/6cec0204d0cacbe4.html" target="n" data-glyph="102,1" class="i property">Delay</a> { <b>get</b>; <b>set</b>; } = 1;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the buffer size to send with the ping packet.</span>
        <span class="c">///</span><span class="c"> The default (from Windows) is 32 bytes.</span>
        <span class="c">///</span><span class="c"> Max value is 65500 (limitation imposed by Windows API).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;Size&quot;</span>, <span class="s">&quot;Bytes&quot;</span>, <span class="s">&quot;BS&quot;</span>)]
        [<span class="i">ValidateRange</span>(0, 65500)]
        <b>public int</b> <a id="844b1adad3c577ee" href="../../R/844b1adad3c577ee.html" target="n" data-glyph="102,1" class="i property">BufferSize</a> { <b>get</b>; <b>set</b>; } = <a href="#aa8175edff52c6b5" class="i field">DefaultSendBufferSize</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to prevent fragmentation of the ICMP packets.</span>
        <span class="c">///</span><span class="c"> Currently CoreFX not supports this on Unix.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="1dd105b0a1c6a805" href="../../R/1dd105b0a1c6a805.html" target="n" data-glyph="102,1" class="i property">DontFragment</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to continue pinging until user presses Ctrl-C (or Int.MaxValue threshold reached).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;Continuous&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="b0b5e8e5a5216e03" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Repeat</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to enable quiet output mode, reducing output to a single simple value only.</span>
        <span class="c">///</span><span class="c"> By default, PingStatus, PingMtuStatus, or TraceStatus objects are emitted.</span>
        <span class="c">///</span><span class="c"> With this switch, standard ping and -Traceroute returns only true / false, and -MtuSize returns an integer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="3d31cf0832c86016" href="../../R/3d31cf0832c86016.html" target="n" data-glyph="102,1" class="i property">Quiet</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the timeout value for an individual ping in seconds.</span>
        <span class="c">///</span><span class="c"> If a response is not received in this time, no response is assumed.</span>
        <span class="c">///</span><span class="c"> The default (from Windows) is 5 seconds.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateRange</span>(<span class="i">ValidateRangeKind</span>.<span class="i">Positive</span>)]
        <b>public int</b> <a id="e73d0f409d57d41a" href="../../R/e73d0f409d57d41a.html" target="n" data-glyph="102,1" class="i property">TimeoutSeconds</a> { <b>get</b>; <b>set</b>; } = 5;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the destination hostname or IP address.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">Position</span> = 0,
            <span class="i">ValueFromPipeline</span> = <b>true</b>,
            <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;ComputerName&quot;</span>)]
        <b>public string</b>[]? <a id="aac67f2aab71024f" href="../../R/aac67f2aab71024f.html" target="n" data-glyph="102,1" class="i property">TargetName</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to detect Maximum Transmission Unit size.</span>
        <span class="c">///</span><span class="c"> When selected, only a single ping result is returned, indicating the maximum buffer size</span>
        <span class="c">///</span><span class="c"> the route to the destination can support without fragmenting the ICMP packets.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;MtuSizeDetect&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="34c578500ced5de3" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">MtuSize</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to perform a traceroute test.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="1e5437e715c56ac0" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Traceroute</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets whether to perform a TCP connection test.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">ValidateRange</span>(0, 65535)]
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <a href="#54aab4a7066f44ba" class="i field">TcpPortParameterSet</a>)]
        <b>public int</b> <a id="d1e511ea169cef83" href="../../R/d1e511ea169cef83.html" target="n" data-glyph="102,1" class="i property">TcpPort</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> BeginProcessing implementation for TestConnectionCommand.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="ce5af4b099a920cf" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <b>switch</b> (<span class="i">ParameterSetName</span>)
            {
                <b>case</b> <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>:
                    <a href="#9bf9dc5be52a4274" class="i property">Count</a> = <b>int</b>.<span class="i">MaxValue</span>;
                    <b>break</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Process a connection test.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="f64d6ce027963c14" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>if</b> (<a href="#aac67f2aab71024f" class="i property">TargetName</a> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>foreach</b> (<b>var</b> <span id="r0 rd" class="r0 r">targetName</span> <b>in</b> <a href="#aac67f2aab71024f" class="i property">TargetName</a>)
            {
                <b>switch</b> (<span class="i">ParameterSetName</span>)
                {
                    <b>case</b> <a href="#a05387a517d8a8a2" class="i field">DefaultPingParameterSet</a>:
                    <b>case</b> <a href="#45e6b47e010124ef" class="i field">RepeatPingParameterSet</a>:
                        <a href="#12d139d6843452df" class="i method">ProcessPing</a>(<span class="r0 r">targetName</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#79f8793e672eb8bb" class="i field">MtuSizeDetectParameterSet</a>:
                        <a href="#7f78de7fdacd22b0" class="i method">ProcessMTUSize</a>(<span class="r0 r">targetName</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#1d459f8fe1c76039" class="i field">TraceRouteParameterSet</a>:
                        <a href="#bf4d5bd5ddce8ea1" class="i method">ProcessTraceroute</a>(<span class="r0 r">targetName</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#54aab4a7066f44ba" class="i field">TcpPortParameterSet</a>:
                        <a href="#99cf97efdc1886d7" class="i method">ProcessConnectionByTCPPort</a>(<span class="r0 r">targetName</span>);
                        <b>break</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> On receiving the StopProcessing() request, the cmdlet will immediately cancel any in-progress ping request.</span>
        <span class="c">///</span><span class="c"> This allows a cancellation to occur during a ping request without having to wait for the timeout.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="6521d59a39dedce3" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">StopProcessing</a>()
        {
            <a href="#d44970e08e30afec" class="i field">_sender</a>?.<span class="i">SendAsyncCancel</span>();
            <a href="#4305abaa634c3540" class="i field">_dnsLookupCancel</a>.<span class="i">Cancel</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ConnectionTest
 
        <b>private void</b> <a id="99cf97efdc1886d7" href="../../R/99cf97efdc1886d7.html" target="n" data-glyph="76,1" class="i method">ProcessConnectionByTCPPort</a>(<b>string</b> <span id="r1 rd" class="r1 r">targetNameOrAddress</span>)
        {
            <b>if</b> (!<a href="#f9f38a3f357932d7" class="i method">TryResolveNameOrAddress</a>(<span class="r1 r">targetNameOrAddress</span>, <b>out _</b>, <b>out</b> <span class="i">IPAddress</span>? <span id="r2 rd" class="r2 r">targetAddress</span>))
            {
                <b>if</b> (<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
                {
                    <span class="i">WriteObject</span>(<b>false</b>);
                }
 
                <b>return</b>;
            }
 
            <span class="i">TcpClient</span> <span id="r3 rd" class="r3 r">client</span> = <b>new</b>();
 
            <b>try</b>
            {
                <span class="i">Task</span> <span id="r4 rd" class="r4 r">connectionTask</span> = <span class="r3 r">client</span>.<span class="i">ConnectAsync</span>(<span class="r2 r">targetAddress</span>, <a href="#d1e511ea169cef83" class="i property">TcpPort</a>);
                <b>string</b> <span id="r5 rd" class="r5 r">targetString</span> = <span class="r2 r">targetAddress</span>.<span class="i">ToString</span>();
 
                <b>for</b> (<b>var</b> <span id="r6 rd" class="r6 r">i</span> = 1; <span class="r6 r">i</span> &lt;= <a href="#e73d0f409d57d41a" class="i property">TimeoutSeconds</a>; <span class="r6 r">i</span>++)
                {
                    <span class="i">Task</span> <span id="r7 rd" class="r7 r">timeoutTask</span> = <span class="i">Task</span>.<span class="i">Delay</span>(<span class="i">millisecondsDelay</span>: 1000);
                    <span class="i">Task</span>.<span class="i">WhenAny</span>(<span class="r4 r">connectionTask</span>, <span class="r7 r">timeoutTask</span>).<span class="i">Result</span>.<span class="i">Wait</span>();
 
                    <b>if</b> (<span class="r7 r">timeoutTask</span>.<span class="i">Status</span> == <span class="i">TaskStatus</span>.<span class="i">Faulted</span> || <span class="r7 r">timeoutTask</span>.<span class="i">Status</span> == <span class="i">TaskStatus</span>.<span class="i">Canceled</span>)
                    {
                        <span class="c">// Waiting is interrupted by Ctrl-C.</span>
                        <span class="i">WriteObject</span>(<b>false</b>);
                        <b>return</b>;
                    }
 
                    <b>if</b> (<span class="r4 r">connectionTask</span>.<span class="i">Status</span> == <span class="i">TaskStatus</span>.<span class="i">RanToCompletion</span>)
                    {
                        <span class="i">WriteObject</span>(<b>true</b>);
                        <b>return</b>;
                    }
                }
            }
            <b>catch</b>
            {
                <span class="c">// Silently ignore connection errors.</span>
            }
            <b>finally</b>
            {
                <span class="r3 r">client</span>.<span class="i">Close</span>();
            }
 
            <span class="i">WriteObject</span>(<b>false</b>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ConnectionTest
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> TracerouteTest
 
        <b>private void</b> <a id="bf4d5bd5ddce8ea1" href="../../R/bf4d5bd5ddce8ea1.html" target="n" data-glyph="76,1" class="i method">ProcessTraceroute</a>(<b>string</b> <span id="r8 rd" class="r8 r">targetNameOrAddress</span>)
        {
            <b>byte</b>[] <span id="r9 rd" class="r9 r">buffer</span> = <a href="#feb101db10c98fe9" class="i method">GetSendBuffer</a>(<a href="#844b1adad3c577ee" class="i property">BufferSize</a>);
 
            <b>if</b> (!<a href="#f9f38a3f357932d7" class="i method">TryResolveNameOrAddress</a>(<span class="r8 r">targetNameOrAddress</span>, <b>out string</b> <span id="r10 rd" class="r10 r">resolvedTargetName</span>, <b>out</b> <span class="i">IPAddress</span>? <span id="r11 rd" class="r11 r">targetAddress</span>))
            {
                <b>if</b> (!<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
                {
                    <span class="i">WriteObject</span>(<b>false</b>);
                }
 
                <b>return</b>;
            }
 
            <b>int</b> <span id="r12 rd" class="r12 r">currentHop</span> = 1;
            <span class="i">PingOptions</span> <span id="r13 rd" class="r13 r">pingOptions</span> = <b>new</b>(<span class="r12 r">currentHop</span>, <a href="#1dd105b0a1c6a805" class="i property">DontFragment</a>.<span class="i">IsPresent</span>);
            <span class="i">PingReply</span> <span id="r14 rd" class="r14 r">reply</span>;
            <span class="i">PingReply</span> <span id="r15 rd" class="r15 r">discoveryReply</span>;
            <b>int</b> <span id="r16 rd" class="r16 r">timeout</span> = <a href="#e73d0f409d57d41a" class="i property">TimeoutSeconds</a> * 1000;
            <span class="i">Stopwatch</span> <span id="r17 rd" class="r17 r">timer</span> = <b>new</b>();
 
            <span class="i">IPAddress</span> <span id="r18 rd" class="r18 r">hopAddress</span>;
            <b>do</b>
            {
                <span class="r13 r">pingOptions</span>.<span class="i">Ttl</span> = <span class="r12 r">currentHop</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                <span class="c">// Get intermediate hop target. This needs to be done first, so that we can target it properly</span>
                <span class="c">// and get useful responses.</span>
                <b>var</b> <span id="r19 rd" class="r19 r">discoveryAttempts</span> = 0;
                <b>bool</b> <span id="r20 rd" class="r20 r">addressIsValid</span> = <b>false</b>;
                <b>do</b>
                {
                    <span class="r15 r">discoveryReply</span> = <span class="i">SendCancellablePing</span>(<span class="r11 r">targetAddress</span>, <span class="r16 r">timeout</span>, <span class="r9 r">buffer</span>, <span class="r13 r">pingOptions</span>);
                    <span class="r19 r">discoveryAttempts</span>++;
                    <span class="r20 r">addressIsValid</span> = !(<span class="r15 r">discoveryReply</span>.<span class="i">Address</span>.<span class="i">Equals</span>(<span class="i">IPAddress</span>.<span class="i">Any</span>)
                        || <span class="r15 r">discoveryReply</span>.<span class="i">Address</span>.<span class="i">Equals</span>(<span class="i">IPAddress</span>.<span class="i">IPv6Any</span>));
                }
                <b>while</b> (<span class="r19 r">discoveryAttempts</span> &lt;= <a href="#e953fbcb88dc4fa0" class="i field">DefaultTraceRoutePingCount</a> &amp;&amp; <span class="r20 r">addressIsValid</span>);
 
                <span class="c">// If we aren&#39;t able to get a valid address, just re-target the final destination of the trace.</span>
                <span class="r18 r">hopAddress</span> = <span class="r20 r">addressIsValid</span> ? <span class="r15 r">discoveryReply</span>.<span class="i">Address</span> : <span class="r11 r">targetAddress</span>;
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">                // Unix Ping API returns nonsense &quot;TimedOut&quot; for ALL intermediate hops. No way around this
                // issue for traceroutes as we rely on information (intermediate addresses, etc.) that is
                // simply not returned to us by the API.
                // The only supported states on Unix seem to be Success and TimedOut. Workaround is to
                // keep targeting the final address; at the very least we will be able to tell the user
                // the required number of hops to reach the destination.
                hopAddress = targetAddress;
                discoveryReply = SendCancellablePing(targetAddress, timeout, buffer, pingOptions);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <b>var</b> <span id="r21 rd" class="r21 r">hopAddressString</span> = <span class="r15 r">discoveryReply</span>.<span class="i">Address</span>.<span class="i">ToString</span>();
 
                <b>string</b> <span id="r22 rd" class="r22 r">routerName</span> = <span class="r21 r">hopAddressString</span>;
                <b>try</b>
                {
                    <b>if</b> (!<span class="i">TryResolveNameOrAddress</span>(<span class="r21 r">hopAddressString</span>, <b>out</b> <span class="r22 r">routerName</span>, <b>out _</b>))
                    {
                        <span class="r22 r">routerName</span> = <span class="r21 r">hopAddressString</span>;
                    }
                }
                <b>catch</b>
                {
                    <span class="c">// Swallow hostname resolve exceptions and continue with traceroute</span>
                }
 
                <span class="c">// In traceroutes we don&#39;t use &#39;Count&#39; parameter.</span>
                <span class="c">// If we change &#39;DefaultTraceRoutePingCount&#39; we should change &#39;ConsoleTraceRouteReply&#39; resource string.</span>
                <b>for</b> (<b>uint</b> <span id="r23 rd" class="r23 r">i</span> = 1; <span class="r23 r">i</span> &lt;= <a href="#e953fbcb88dc4fa0" class="i field">DefaultTraceRoutePingCount</a>; <span class="r23 r">i</span>++)
                {
                    <b>try</b>
                    {
                        <span class="r14 r">reply</span> = <span class="i">SendCancellablePing</span>(<span class="r18 r">hopAddress</span>, <span class="r16 r">timeout</span>, <span class="r9 r">buffer</span>, <span class="r13 r">pingOptions</span>, <span class="r17 r">timer</span>);
 
                        <b>if</b> (!<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
                        {
                            <a href="#9be3860f5d7a0a5e" class="k">var</a> <span id="r24 rd" class="r24 r">status</span> = <b>new</b> <span class="t">PingStatus</span>(
                                <a href="#2041a060818ed445" class="i property">Source</a>,
                                <span class="r22 r">routerName</span>,
                                <span class="r14 r">reply</span>,
                                <span class="r14 r">reply</span>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">Success</span>
                                    ? <span class="r14 r">reply</span>.<span class="i">RoundtripTime</span>
                                    : <span class="r17 r">timer</span>.<span class="i">ElapsedMilliseconds</span>,
                                <span class="r9 r">buffer</span>.<span class="i">Length</span>,
                                <span class="i">pingNum</span>: <span class="r23 r">i</span>);
                            <span class="i">WriteObject</span>(<b>new</b> <span class="t">TraceStatus</span>(
                                <span class="r12 r">currentHop</span>,
                                <span class="r24 r">status</span>,
                                <a href="#2041a060818ed445" class="i property">Source</a>,
                                <span class="r10 r">resolvedTargetName</span>,
                                <span class="r11 r">targetAddress</span>));
                        }
                    }
                    <b>catch</b> (<span class="i">PingException</span> <span id="r25 rd" class="r25 r">ex</span>)
                    {
                        <b>string</b> <span id="r26 rd" class="r26 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                            <span class="i">TestConnectionResources</span>.<span class="i">NoPingResult</span>,
                            <span class="r10 r">resolvedTargetName</span>,
                            <span class="r25 r">ex</span>.<span class="i">Message</span>);
                        <span class="i">Exception</span> <span id="r27 rd" class="r27 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r26 r">message</span>, <span class="r25 r">ex</span>.<span class="i">InnerException</span>);
                        <span class="i">ErrorRecord</span> <span id="r28 rd" class="r28 r">errorRecord</span> = <b>new</b>(
                            <span class="r27 r">pingException</span>,
                            <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                            <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                            <span class="r10 r">resolvedTargetName</span>);
                        <span class="i">WriteError</span>(<span class="r28 r">errorRecord</span>);
 
                        <b>continue</b>;
                    }
 
                    <span class="c">// We use short delay because it is impossible DoS with trace route.</span>
                    <span class="i">Thread</span>.<span class="i">Sleep</span>(50);
                    <span class="r17 r">timer</span>.<span class="i">Reset</span>();
                }
 
                <span class="r12 r">currentHop</span>++;
            } <b>while</b> (<span class="r12 r">currentHop</span> &lt;= <a href="#ecc53cd0b595d12c" class="i property">MaxHops</a>
                &amp;&amp; (<span class="r15 r">discoveryReply</span>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">TtlExpired</span>
                    || <span class="r15 r">discoveryReply</span>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">TimedOut</span>));
 
            <b>if</b> (<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
            {
                <span class="i">WriteObject</span>(<span class="r12 r">currentHop</span> &lt;= <a href="#ecc53cd0b595d12c" class="i property">MaxHops</a>);
            }
            <b>else</b> <b>if</b> (<span class="r12 r">currentHop</span> &gt; <a href="#ecc53cd0b595d12c" class="i property">MaxHops</a>)
            {
                <b>var</b> <span id="r29 rd" class="r29 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                    <span class="i">TestConnectionResources</span>.<span class="i">MaxHopsExceeded</span>,
                    <span class="r10 r">resolvedTargetName</span>,
                    <a href="#ecc53cd0b595d12c" class="i property">MaxHops</a>);
                <b>var</b> <span id="r30 rd" class="r30 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r29 r">message</span>);
                <span class="i">WriteError</span>(<b>new</b> <span class="i">ErrorRecord</span>(
                    <span class="r30 r">pingException</span>,
                    <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                    <span class="i">ErrorCategory</span>.<span class="i">ConnectionError</span>,
                    <span class="r11 r">targetAddress</span>));
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> TracerouteTest
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> MTUSizeTest
        <b>private void</b> <a id="7f78de7fdacd22b0" href="../../R/7f78de7fdacd22b0.html" target="n" data-glyph="76,1" class="i method">ProcessMTUSize</a>(<b>string</b> <span id="r31 rd" class="r31 r">targetNameOrAddress</span>)
        {
            <span class="i">PingReply</span>? <span id="r32 rd" class="r32 r">reply</span>, <span id="r33 rd" class="r33 r">replyResult</span> = <b>null</b>;
            <b>if</b> (!<a href="#f9f38a3f357932d7" class="i method">TryResolveNameOrAddress</a>(<span class="r31 r">targetNameOrAddress</span>, <b>out string</b> <span id="r34 rd" class="r34 r">resolvedTargetName</span>, <b>out</b> <span class="i">IPAddress</span>? <span id="r35 rd" class="r35 r">targetAddress</span>))
            {
                <b>if</b> (<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
                {
                    <span class="i">WriteObject</span>(-1);
                }
 
                <b>return</b>;
            }
 
            <span class="c">// Caution! Algorithm is sensitive to changing boundary values.</span>
            <b>int</b> <span id="r36 rd" class="r36 r">HighMTUSize</span> = 10000;
            <b>int</b> <span id="r37 rd" class="r37 r">CurrentMTUSize</span> = 1473;
            <b>int</b> <span id="r38 rd" class="r38 r">LowMTUSize</span> = <span class="r35 r">targetAddress</span>.<span class="i">AddressFamily</span> == <span class="i">AddressFamily</span>.<span class="i">InterNetworkV6</span> ? 1280 : 68;
            <b>int</b> <span id="r39 rd" class="r39 r">timeout</span> = <a href="#e73d0f409d57d41a" class="i property">TimeoutSeconds</a> * 1000;
 
            <b>try</b>
            {
                <span class="i">PingOptions</span> <span id="r40 rd" class="r40 r">pingOptions</span> = <b>new</b>(<a href="#ecc53cd0b595d12c" class="i property">MaxHops</a>, <b>true</b>);
                <b>int</b> <span id="r41 rd" class="r41 r">retry</span> = 1;
 
                <b>while</b> (<span class="r38 r">LowMTUSize</span> &lt; (<span class="r36 r">HighMTUSize</span> - 1))
                {
                    <b>byte</b>[] <span id="r42 rd" class="r42 r">buffer</span> = <a href="#feb101db10c98fe9" class="i method">GetSendBuffer</a>(<span class="r37 r">CurrentMTUSize</span>);
 
                    <span class="i">WriteDebug</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(
                        <span class="s">&quot;LowMTUSize: {0}, CurrentMTUSize: {1}, HighMTUSize: {2}&quot;</span>,
                        <span class="r38 r">LowMTUSize</span>,
                        <span class="r37 r">CurrentMTUSize</span>,
                        <span class="r36 r">HighMTUSize</span>));
 
                    <span class="r32 r">reply</span> = <span class="i">SendCancellablePing</span>(<span class="r35 r">targetAddress</span>, <span class="r39 r">timeout</span>, <span class="r42 r">buffer</span>, <span class="r40 r">pingOptions</span>);
 
                    <b>if</b> (<span class="r32 r">reply</span>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">PacketTooBig</span> || <span class="r32 r">reply</span>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">TimedOut</span>)
                    {
                        <span class="r36 r">HighMTUSize</span> = <span class="r37 r">CurrentMTUSize</span>;
                        <span class="r41 r">retry</span> = 1;
                    }
                    <b>else</b> <b>if</b> (<span class="r32 r">reply</span>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">Success</span>)
                    {
                        <span class="r38 r">LowMTUSize</span> = <span class="r37 r">CurrentMTUSize</span>;
                        <span class="r33 r">replyResult</span> = <span class="r32 r">reply</span>;
                        <span class="r41 r">retry</span> = 1;
                    }
                    <b>else</b>
                    {
                        <span class="c">// If the host didn&#39;t reply, try again up to the &#39;Count&#39; value.</span>
                        <b>if</b> (<span class="r41 r">retry</span> &gt;= <a href="#9bf9dc5be52a4274" class="i property">Count</a>)
                        {
                            <b>string</b> <span id="r43 rd" class="r43 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                                <span class="i">TestConnectionResources</span>.<span class="i">NoPingResult</span>,
                                <span class="r35 r">targetAddress</span>,
                                <span class="r32 r">reply</span>.<span class="i">Status</span>.<span class="i">ToString</span>());
                            <span class="i">Exception</span> <span id="r44 rd" class="r44 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r43 r">message</span>);
                            <span class="i">ErrorRecord</span> <span id="r45 rd" class="r45 r">errorRecord</span> = <b>new</b>(
                                <span class="r44 r">pingException</span>,
                                <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                                <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                                <span class="r35 r">targetAddress</span>);
                            <span class="i">WriteError</span>(<span class="r45 r">errorRecord</span>);
                            <b>return</b>;
                        }
                        <b>else</b>
                        {
                            <span class="r41 r">retry</span>++;
                            <b>continue</b>;
                        }
                    }
 
                    <span class="r37 r">CurrentMTUSize</span> = (<span class="r38 r">LowMTUSize</span> + <span class="r36 r">HighMTUSize</span>) / 2;
 
                    <span class="c">// Prevent DoS attack.</span>
                    <span class="i">Thread</span>.<span class="i">Sleep</span>(100);
                }
            }
            <b>catch</b> (<span class="i">PingException</span> <span id="r46 rd" class="r46 r">ex</span>)
            {
                <b>string</b> <span id="r47 rd" class="r47 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">TestConnectionResources</span>.<span class="i">NoPingResult</span>, <span class="r35 r">targetAddress</span>, <span class="r46 r">ex</span>.<span class="i">Message</span>);
                <span class="i">Exception</span> <span id="r48 rd" class="r48 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r47 r">message</span>, <span class="r46 r">ex</span>.<span class="i">InnerException</span>);
                <span class="i">ErrorRecord</span> <span id="r49 rd" class="r49 r">errorRecord</span> = <b>new</b>(
                    <span class="r48 r">pingException</span>,
                    <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                    <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                    <span class="r35 r">targetAddress</span>);
                <span class="i">WriteError</span>(<span class="r49 r">errorRecord</span>);
                <b>return</b>;
            }
 
            <b>if</b> (<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
            {
                <span class="i">WriteObject</span>(<span class="r37 r">CurrentMTUSize</span>);
            }
            <b>else</b>
            {
                <span class="i">WriteObject</span>(<b>new</b> <span class="t">PingMtuStatus</span>(
                    <a href="#2041a060818ed445" class="i property">Source</a>,
                    <span class="r34 r">resolvedTargetName</span>,
                    <span class="r33 r">replyResult</span> ?? <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r33 r">replyResult</span>)),
                    <span class="r37 r">CurrentMTUSize</span>));
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> MTUSizeTest
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> PingTest
 
        <b>private void</b> <a id="12d139d6843452df" href="../../R/12d139d6843452df.html" target="n" data-glyph="76,1" class="i method">ProcessPing</a>(<b>string</b> <span id="r50 rd" class="r50 r">targetNameOrAddress</span>)
        {
            <b>if</b> (!<a href="#f9f38a3f357932d7" class="i method">TryResolveNameOrAddress</a>(<span class="r50 r">targetNameOrAddress</span>, <b>out string</b> <span id="r51 rd" class="r51 r">resolvedTargetName</span>, <b>out</b> <span class="i">IPAddress</span>? <span id="r52 rd" class="r52 r">targetAddress</span>))
            {
                <b>if</b> (<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
                {
                    <span class="i">WriteObject</span>(<b>false</b>);
                }
 
                <b>return</b>;
            }
 
            <b>bool</b> <span id="r53 rd" class="r53 r">quietResult</span> = <b>true</b>;
            <b>byte</b>[] <span id="r54 rd" class="r54 r">buffer</span> = <a href="#feb101db10c98fe9" class="i method">GetSendBuffer</a>(<a href="#844b1adad3c577ee" class="i property">BufferSize</a>);
 
            <span class="i">PingReply</span> <span id="r55 rd" class="r55 r">reply</span>;
            <span class="i">PingOptions</span> <span id="r56 rd" class="r56 r">pingOptions</span> = <b>new</b>(<a href="#ecc53cd0b595d12c" class="i property">MaxHops</a>, <a href="#1dd105b0a1c6a805" class="i property">DontFragment</a>.<span class="i">IsPresent</span>);
            <b>int</b> <span id="r57 rd" class="r57 r">timeout</span> = <a href="#e73d0f409d57d41a" class="i property">TimeoutSeconds</a> * 1000;
            <b>int</b> <span id="r58 rd" class="r58 r">delay</span> = <a href="#6cec0204d0cacbe4" class="i property">Delay</a> * 1000;
 
            <b>for</b> (<b>int</b> <span id="r59 rd" class="r59 r">i</span> = 1; <span class="r59 r">i</span> &lt;= <a href="#9bf9dc5be52a4274" class="i property">Count</a>; <span class="r59 r">i</span>++)
            {
                <b>try</b>
                {
                    <span class="r55 r">reply</span> = <span class="i">SendCancellablePing</span>(<span class="r52 r">targetAddress</span>, <span class="r57 r">timeout</span>, <span class="r54 r">buffer</span>, <span class="r56 r">pingOptions</span>);
                }
                <b>catch</b> (<span class="i">PingException</span> <span id="r60 rd" class="r60 r">ex</span>)
                {
                    <b>string</b> <span id="r61 rd" class="r61 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">TestConnectionResources</span>.<span class="i">NoPingResult</span>, <span class="r51 r">resolvedTargetName</span>, <span class="r60 r">ex</span>.<span class="i">Message</span>);
                    <span class="i">Exception</span> <span id="r62 rd" class="r62 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r61 r">message</span>, <span class="r60 r">ex</span>.<span class="i">InnerException</span>);
                    <span class="i">ErrorRecord</span> <span id="r63 rd" class="r63 r">errorRecord</span> = <b>new</b>(
                        <span class="r62 r">pingException</span>,
                        <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                        <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                        <span class="r51 r">resolvedTargetName</span>);
                    <span class="i">WriteError</span>(<span class="r63 r">errorRecord</span>);
 
                    <span class="r53 r">quietResult</span> = <b>false</b>;
                    <b>continue</b>;
                }
 
                <b>if</b> (<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
                {
                    <span class="c">// Return &#39;true&#39; only if all pings have completed successfully.</span>
                    <span class="r53 r">quietResult</span> &amp;= <span class="r55 r">reply</span>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">Success</span>;
                }
                <b>else</b>
                {
                    <span class="i">WriteObject</span>(<b>new</b> <span class="t">PingStatus</span>(
                        <a href="#2041a060818ed445" class="i property">Source</a>,
                        <span class="r51 r">resolvedTargetName</span>,
                        <span class="r55 r">reply</span>,
                        <span class="r55 r">reply</span>.<span class="i">RoundtripTime</span>,
                        <span class="r54 r">buffer</span>.<span class="i">Length</span>,
                        <span class="i">pingNum</span>: (<b>uint</b>)<span class="r59 r">i</span>));
                }
 
                <span class="c">// Delay between pings, but not after last ping.</span>
                <b>if</b> (<span class="r59 r">i</span> &lt; <a href="#9bf9dc5be52a4274" class="i property">Count</a> &amp;&amp; <a href="#6cec0204d0cacbe4" class="i property">Delay</a> &gt; 0)
                {
                    <span class="i">Thread</span>.<span class="i">Sleep</span>(<span class="r58 r">delay</span>);
                }
            }
 
            <b>if</b> (<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
            {
                <span class="i">WriteObject</span>(<span class="r53 r">quietResult</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> PingTest
 
        <b>private bool</b> <a id="f9f38a3f357932d7" href="../../R/f9f38a3f357932d7.html" target="n" data-glyph="76,1" class="i method">TryResolveNameOrAddress</a>(
            <b>string</b> <span id="r64 rd" class="r64 r">targetNameOrAddress</span>,
            <b>out string</b> <span id="r65 rd" class="r65 r">resolvedTargetName</span>,
            [<span class="i">NotNullWhen</span>(<b>true</b>)]
            <b>out</b> <span class="i">IPAddress</span>? <span id="r66 rd" class="r66 r">targetAddress</span>)
        {
            <span class="r65 r">resolvedTargetName</span> = <span class="r64 r">targetNameOrAddress</span>;
 
            <span class="i">IPHostEntry</span> <span id="r67 rd" class="r67 r">hostEntry</span>;
            <b>if</b> (<span class="i">IPAddress</span>.<span class="i">TryParse</span>(<span class="r64 r">targetNameOrAddress</span>, <b>out</b> <span class="r66 r">targetAddress</span>))
            {
                <b>if</b> ((<a href="#ef51dff983395e8c" class="i property">IPv4</a> &amp;&amp; <span class="r66 r">targetAddress</span>.<span class="i">AddressFamily</span> != <span class="i">AddressFamily</span>.<span class="i">InterNetwork</span>)
                    || (<a href="#c52094cd27164201" class="i property">IPv6</a> &amp;&amp; <span class="r66 r">targetAddress</span>.<span class="i">AddressFamily</span> != <span class="i">AddressFamily</span>.<span class="i">InterNetworkV6</span>))
                {
                    <b>string</b> <span id="r68 rd" class="r68 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                        <span class="i">TestConnectionResources</span>.<span class="i">NoPingResult</span>,
                        <span class="r65 r">resolvedTargetName</span>,
                        <span class="i">TestConnectionResources</span>.<span class="i">TargetAddressAbsent</span>);
                    <span class="i">Exception</span> <span id="r69 rd" class="r69 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r68 r">message</span>, <b>null</b>);
                    <span class="i">ErrorRecord</span> <span id="r70 rd" class="r70 r">errorRecord</span> = <b>new</b>(
                        <span class="r69 r">pingException</span>,
                        <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                        <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                        <span class="r65 r">resolvedTargetName</span>);
                    <span class="i">WriteError</span>(<span class="r70 r">errorRecord</span>);
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (<a href="#45051e8417e812d5" class="i property">ResolveDestination</a>)
                {
                    <span class="r67 r">hostEntry</span> = <a href="#92228962af4f3255" class="i method">GetCancellableHostEntry</a>(<span class="r64 r">targetNameOrAddress</span>);
                    <span class="r65 r">resolvedTargetName</span> = <span class="r67 r">hostEntry</span>.<span class="i">HostName</span>;
                }
                <b>else</b>
                {
                    <span class="r65 r">resolvedTargetName</span> = <span class="r66 r">targetAddress</span>.<span class="i">ToString</span>();
                }
            }
            <b>else</b>
            {
                <b>try</b>
                {
                    <span class="r67 r">hostEntry</span> = <a href="#92228962af4f3255" class="i method">GetCancellableHostEntry</a>(<span class="r64 r">targetNameOrAddress</span>);
 
                    <b>if</b> (<a href="#45051e8417e812d5" class="i property">ResolveDestination</a>)
                    {
                        <span class="r65 r">resolvedTargetName</span> = <span class="r67 r">hostEntry</span>.<span class="i">HostName</span>;
                        <span class="r67 r">hostEntry</span> = <span class="i">GetCancellableHostEntry</span>(<span class="r67 r">hostEntry</span>.<span class="i">HostName</span>);
                    }
                }
                <b>catch</b> (<span class="i">PipelineStoppedException</span>)
                {
                    <b>throw</b>;
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r71 rd" class="r71 r">ex</span>)
                {
                    <b>if</b> (!<a href="#3d31cf0832c86016" class="i property">Quiet</a>.<span class="i">IsPresent</span>)
                    {
                        <b>string</b> <span id="r72 rd" class="r72 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                            <span class="i">TestConnectionResources</span>.<span class="i">NoPingResult</span>,
                            <span class="r65 r">resolvedTargetName</span>,
                            <span class="i">TestConnectionResources</span>.<span class="i">CannotResolveTargetName</span>);
                        <span class="i">Exception</span> <span id="r73 rd" class="r73 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r72 r">message</span>, <span class="r71 r">ex</span>);
                        <span class="i">ErrorRecord</span> <span id="r74 rd" class="r74 r">errorRecord</span> = <b>new</b>(
                            <span class="r73 r">pingException</span>,
                            <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                            <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                            <span class="r65 r">resolvedTargetName</span>);
                        <span class="i">WriteError</span>(<span class="r74 r">errorRecord</span>);
                    }
 
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (<a href="#c52094cd27164201" class="i property">IPv6</a> || <a href="#ef51dff983395e8c" class="i property">IPv4</a>)
                {
                    <span class="r66 r">targetAddress</span> = <a href="#4b4111ac7fd24f3f" class="i method">GetHostAddress</a>(<span class="r67 r">hostEntry</span>);
 
                    <b>if</b> (<span class="r66 r">targetAddress</span> == <b>null</b>)
                    {
                        <b>string</b> <span id="r75 rd" class="r75 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                            <span class="i">TestConnectionResources</span>.<span class="i">NoPingResult</span>,
                            <span class="r65 r">resolvedTargetName</span>,
                            <span class="i">TestConnectionResources</span>.<span class="i">TargetAddressAbsent</span>);
                        <span class="i">Exception</span> <span id="r76 rd" class="r76 r">pingException</span> = <b>new</b> <span class="i">PingException</span>(<span class="r75 r">message</span>, <b>null</b>);
                        <span class="i">ErrorRecord</span> <span id="r77 rd" class="r77 r">errorRecord</span> = <b>new</b>(
                            <span class="r76 r">pingException</span>,
                            <a href="#8b39d64497f044fd" class="i field">TestConnectionExceptionId</a>,
                            <span class="i">ErrorCategory</span>.<span class="i">ResourceUnavailable</span>,
                            <span class="r65 r">resolvedTargetName</span>);
                        <span class="i">WriteError</span>(<span class="r77 r">errorRecord</span>);
                        <b>return</b> <b>false</b>;
                    }
                }
                <b>else</b>
                {
                    <span class="r66 r">targetAddress</span> = <span class="r67 r">hostEntry</span>.<span class="i">AddressList</span>[0];
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private</b> <span class="i">IPHostEntry</span> <a id="92228962af4f3255" href="../../R/92228962af4f3255.html" target="n" data-glyph="76,1" class="i method">GetCancellableHostEntry</a>(<b>string</b> <span id="r78 rd" class="r78 r">targetNameOrAddress</span>)
        {
            <b>var</b> <span id="r79 rd" class="r79 r">task</span> = <span class="i">Dns</span>.<span class="i">GetHostEntryAsync</span>(<span class="r78 r">targetNameOrAddress</span>);
            <b>var</b> <span id="r80 rd" class="r80 r">waitHandles</span> = <b>new</b>[] { ((<span class="i">IAsyncResult</span>)<span class="r79 r">task</span>).<span class="i">AsyncWaitHandle</span>, <a href="#4305abaa634c3540" class="i field">_dnsLookupCancel</a>.<span class="i">Token</span>.<span class="i">WaitHandle</span> };
 
            <span class="c">// WaitAny() returns the index of the first signal it gets; 1 is our cancellation token.</span>
            <b>if</b> (<span class="i">WaitHandle</span>.<span class="i">WaitAny</span>(<span class="r80 r">waitHandles</span>) == 1)
            {
                <b>throw</b> <b>new</b> <span class="i">PipelineStoppedException</span>();
            }
 
            <b>return</b> <span class="r79 r">task</span>.<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
        }
 
        <b>private</b> <span class="i">IPAddress</span>? <a id="4b4111ac7fd24f3f" href="../../R/4b4111ac7fd24f3f.html" target="n" data-glyph="76,1" class="i method">GetHostAddress</a>(<span class="i">IPHostEntry</span> <span id="r81 rd" class="r81 r">hostEntry</span>)
        {
            <span class="i">AddressFamily</span> <span id="r82 rd" class="r82 r">addressFamily</span> = <a href="#c52094cd27164201" class="i property">IPv6</a> ? <span class="i">AddressFamily</span>.<span class="i">InterNetworkV6</span> : <span class="i">AddressFamily</span>.<span class="i">InterNetwork</span>;
 
            <b>foreach</b> (<b>var</b> <span id="r83 rd" class="r83 r">address</span> <b>in</b> <span class="r81 r">hostEntry</span>.<span class="i">AddressList</span>)
            {
                <b>if</b> (<span class="r83 r">address</span>.<span class="i">AddressFamily</span> == <span class="r82 r">addressFamily</span>)
                {
                    <b>return</b> <span class="r83 r">address</span>;
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">// Users most often use the default buffer size so we cache the buffer.</span>
        <span class="c">// Creates and fills a send buffer. This follows the ping.exe and CoreFX model.</span>
        <b>private static byte</b>[] <a id="feb101db10c98fe9" href="../../R/feb101db10c98fe9.html" target="n" data-glyph="76,1" class="i method">GetSendBuffer</a>(<b>int</b> <span id="r84 rd" class="r84 r">bufferSize</span>)
        {
            <b>if</b> (<span class="r84 r">bufferSize</span> == <a href="#aa8175edff52c6b5" class="i field">DefaultSendBufferSize</a> &amp;&amp; <a href="#cc3c1c85274b241d" class="i field">s_DefaultSendBuffer</a> != <b>null</b>)
            {
                <b>return</b> <a href="#cc3c1c85274b241d" class="i field">s_DefaultSendBuffer</a>;
            }
 
            <b>byte</b>[] <span id="r85 rd" class="r85 r">sendBuffer</span> = <b>new</b> <b>byte</b>[<span class="r84 r">bufferSize</span>];
 
            <b>for</b> (<b>int</b> <span id="r86 rd" class="r86 r">i</span> = 0; <span class="r86 r">i</span> &lt; <span class="r84 r">bufferSize</span>; <span class="r86 r">i</span>++)
            {
                <span class="r85 r">sendBuffer</span>[<span class="r86 r">i</span>] = (<b>byte</b>)((<b>int</b>)<span class="s">&#39;a&#39;</span> + <span class="r86 r">i</span> % 23);
            }
 
            <b>if</b> (<span class="r84 r">bufferSize</span> == <a href="#aa8175edff52c6b5" class="i field">DefaultSendBufferSize</a> &amp;&amp; <a href="#cc3c1c85274b241d" class="i field">s_DefaultSendBuffer</a> == <b>null</b>)
            {
                <a href="#cc3c1c85274b241d" class="i field">s_DefaultSendBuffer</a> = <span class="r85 r">sendBuffer</span>;
            }
 
            <b>return</b> <span class="r85 r">sendBuffer</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> IDisposable implementation, dispose of any disposable resources created by the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="c1a5a630eef0d69a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#6d783f0d1ba3e77a" class="i method">Dispose</a>(<span class="r87 r">disposing</span>: <b>true</b>);
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#5321ee1f6a221808" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implementation of IDisposable for both manual Dispose() and finalizer-called disposal of resources.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specified as true when Dispose() was called, false if this is called from the finalizer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="6d783f0d1ba3e77a" href="../../R/6d783f0d1ba3e77a.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r87 rd" class="r87 r">disposing</span>)
        {
            <b>if</b> (!<a href="#c60acc6839aaa723" class="i field">_disposed</a>)
            {
                <b>if</b> (<span class="r87 r">disposing</span>)
                {
                    <a href="#d44970e08e30afec" class="i field">_sender</a>?.<span class="i">Dispose</span>();
                    <a href="#4305abaa634c3540" class="i field">_dnsLookupCancel</a>.<span class="i">Dispose</span>();
                }
 
                <a href="#c60acc6839aaa723" class="i field">_disposed</a> = <b>true</b>;
            }
        }
 
        <span class="c">// Uses the SendAsync() method to send pings, so that Ctrl+C can halt the request early if needed.</span>
        <b>private</b> <span class="i">PingReply</span> <a id="aafb75fb7be68f27" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SendCancellablePing</a>(
            <span class="i">IPAddress</span> <span id="r88 rd" class="r88 r">targetAddress</span>,
            <b>int</b> <span id="r89 rd" class="r89 r">timeout</span>,
            <b>byte</b>[] <span id="r90 rd" class="r90 r">buffer</span>,
            <span class="i">PingOptions</span> <span id="r91 rd" class="r91 r">pingOptions</span>,
            <span class="i">Stopwatch</span>? <span id="r92 rd" class="r92 r">timer</span> = <b>null</b>)
        {
            <b>try</b>
            {
                <a href="#d44970e08e30afec" class="i field">_sender</a> = <b>new</b> <span class="i">Ping</span>();
 
                <span class="r92 r">timer</span>?.<span class="i">Start</span>();
                <span class="c">// &#39;SendPingAsync&#39; always uses the default synchronization context (threadpool).</span>
                <span class="c">// This is what we want to avoid the deadlock resulted by async work being scheduled back to the</span>
                <span class="c">// pipeline thread due to a change of the current synchronization context of the pipeline thread.</span>
                <b>return</b> <a href="#d44970e08e30afec" class="i field">_sender</a>.<span class="i">SendPingAsync</span>(<span class="r88 r">targetAddress</span>, <span class="r89 r">timeout</span>, <span class="r90 r">buffer</span>, <span class="r91 r">pingOptions</span>).<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
            }
            <b>catch</b> (<span class="i">PingException</span> <span id="r93 rd" class="r93 r">ex</span>) <b>when</b> (<span class="r93 r">ex</span>.<span class="i">InnerException</span> <b>is</b> <span class="i">TaskCanceledException</span>)
            {
                <span class="c">// The only cancellation we have implemented is on pipeline stops via StopProcessing().</span>
                <b>throw</b> <b>new</b> <span class="i">PipelineStoppedException</span>();
            }
            <b>finally</b>
            {
                <span class="r92 r">timer</span>?.<span class="i">Stop</span>();
                <a href="#d44970e08e30afec" class="i field">_sender</a>?.<span class="i">Dispose</span>();
                <a href="#d44970e08e30afec" class="i field">_sender</a> = <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The class contains information about the source, the destination and ping results.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public class</b> <a id="9be3860f5d7a0a5e" href="../../R/9be3860f5d7a0a5e.html" target="n" data-glyph="0,1" class="t t">PingStatus</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9be3860f5d7a0a5e" class="t t">PingStatus</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
            <span class="c">///</span><span class="c"> This constructor allows manually specifying the initial values for the cases where the PingReply</span>
            <span class="c">///</span><span class="c"> object may be missing some information, specifically in the instances where PingReply objects are</span>
            <span class="c">///</span><span class="c"> utilised to perform a traceroute.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The source machine name or IP of the ping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The destination machine name of the ping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">reply</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The response from the ping attempt.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">latency</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The latency of the ping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r98 r">bufferSize</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The buffer size.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">pingNum</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number in the sequence of pings to the hop point.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal</b> <a id="ba8dfc0f02185157" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">PingStatus</a>(
                <b>string</b> <span id="r94 rd" class="r94 r">source</span>,
                <b>string</b> <span id="r95 rd" class="r95 r">destination</span>,
                <span class="i">PingReply</span> <span id="r96 rd" class="r96 r">reply</span>,
                <b>long</b> <span id="r97 rd" class="r97 r">latency</span>,
                <b>int</b> <span id="r98 rd" class="r98 r">bufferSize</span>,
                <b>uint</b> <span id="r99 rd" class="r99 r">pingNum</span>)
                : <a href="#2eb4b49d4c4d6f25" class="k">this</a>(<span class="r94 r">source</span>, <span class="r95 r">destination</span>, <span class="r96 r">reply</span>, <span class="r99 r">pingNum</span>)
            {
                <a href="#7222d5abb1b187a3" class="i field">_bufferSize</a> = <span class="r98 r">bufferSize</span>;
                <a href="#3251bd7c8ed5041b" class="i field">_latency</a> = <span class="r97 r">latency</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9be3860f5d7a0a5e" class="t t">PingStatus</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The source machine name or IP of the ping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The destination machine name of the ping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">reply</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The response from the ping attempt.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">pingNum</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number of the ping in the sequence of pings to the target.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal</b> <a id="2eb4b49d4c4d6f25" href="../../R/2eb4b49d4c4d6f25.html" target="n" data-glyph="74,2" class="t constructor">PingStatus</a>(<b>string</b> <span id="r100 rd" class="r100 r">source</span>, <b>string</b> <span id="r101 rd" class="r101 r">destination</span>, <span class="i">PingReply</span> <span id="r102 rd" class="r102 r">reply</span>, <b>uint</b> <span id="r103 rd" class="r103 r">pingNum</span>)
            {
                <a href="#5a7e8e147f7576ef" class="i property">Ping</a> = <span class="r103 r">pingNum</span>;
                <a href="#a36252a6248e1ae9" class="i property">Reply</a> = <span class="r102 r">reply</span>;
                <a href="#134f52234460c12d" class="i property">Source</a> = <span class="r100 r">source</span>;
                <a href="#a63df84ddfe35b4a" class="i property">Destination</a> = <span class="r101 r">destination</span>;
            }
 
            <span class="c">// These values can be set manually to skirt issues with the Ping API on Unix platforms</span>
            <span class="c">// so that we can return meaningful known data that is discarded by the API.</span>
            <b>private readonly int</b> <a id="7222d5abb1b187a3" href="../../R/7222d5abb1b187a3.html" target="n" data-glyph="46,2" class="i field">_bufferSize</a> = -1;
 
            <b>private readonly long</b> <a id="3251bd7c8ed5041b" href="../../R/3251bd7c8ed5041b.html" target="n" data-glyph="46,2" class="i field">_latency</a> = -1;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the sequence number of this ping in the sequence of pings to the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#a63df84ddfe35b4a" class="i property">Destination</a><span class="c">&quot;</span><span class="c">/&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public uint</b> <a id="5a7e8e147f7576ef" href="../../R/5a7e8e147f7576ef.html" target="n" data-glyph="102,2" class="i property">Ping</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the source from which the ping was sent.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public string</b> <a id="134f52234460c12d" href="../../R/134f52234460c12d.html" target="n" data-glyph="102,2" class="i property">Source</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the destination which was pinged.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public string</b> <a id="a63df84ddfe35b4a" href="../../R/a63df84ddfe35b4a.html" target="n" data-glyph="102,2" class="i property">Destination</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the target address of the ping.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">IPAddress</span>? <a id="cdf60f3908894901" href="../../R/cdf60f3908894901.html" target="n" data-glyph="102,2" class="i property">Address</a> { <b>get</b> =&gt; <a href="#a36252a6248e1ae9" class="i property">Reply</a>.<span class="i">Status</span> == <span class="i">IPStatus</span>.<span class="i">Success</span> ? <a href="#a36252a6248e1ae9" class="i property">Reply</a>.<span class="i">Address</span> : <b>null</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the target address of the ping if one is available, or &quot;*&quot; if it is not.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public string</b> <a id="51ef3c44540b2111" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">DisplayAddress</a> { <b>get</b> =&gt; <a href="#cdf60f3908894901" class="i property">Address</a>?.<span class="i">ToString</span>() ?? <span class="s">&quot;*&quot;</span>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the roundtrip time of the ping in milliseconds.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public long</b> <a id="dc39112c0b01fc99" href="../../R/dc39112c0b01fc99.html" target="n" data-glyph="102,2" class="i property">Latency</a> { <b>get</b> =&gt; <a href="#3251bd7c8ed5041b" class="i field">_latency</a> &gt;= 0 ? <a href="#3251bd7c8ed5041b" class="i field">_latency</a> : <a href="#a36252a6248e1ae9" class="i property">Reply</a>.<span class="i">RoundtripTime</span>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the returned status of the ping.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">IPStatus</span> <a id="5a64e185c2c5dd70" href="../../R/5a64e185c2c5dd70.html" target="n" data-glyph="102,2" class="i property">Status</a> { <b>get</b> =&gt; <a href="#a36252a6248e1ae9" class="i property">Reply</a>.<span class="i">Status</span>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the size in bytes of the buffer data sent in the ping.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public int</b> <a id="0892afa6bb05d056" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">BufferSize</a> { <b>get</b> =&gt; <a href="#7222d5abb1b187a3" class="i field">_bufferSize</a> &gt;= 0 ? <a href="#7222d5abb1b187a3" class="i field">_bufferSize</a> : <a href="#a36252a6248e1ae9" class="i property">Reply</a>.<span class="i">Buffer</span>.<span class="i">Length</span>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the reply object from this ping.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">PingReply</span> <a id="a36252a6248e1ae9" href="../../R/a36252a6248e1ae9.html" target="n" data-glyph="102,2" class="i property">Reply</a> { <b>get</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The class contains information about the source, the destination and ping results.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public class</b> <a id="f0dface89530e0ac" href="../../R/f0dface89530e0ac.html" target="n" data-glyph="0,1" class="t t">PingMtuStatus</a> : <a href="#9be3860f5d7a0a5e" class="t t">PingStatus</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#f0dface89530e0ac" class="t t">PingMtuStatus</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The source machine name or IP of the ping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The destination machine name of the ping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">reply</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The response from the ping attempt.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">bufferSize</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The buffer size from the successful ping attempt.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal</b> <a id="094b65d2e16ab2ab" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">PingMtuStatus</a>(<b>string</b> <span id="r104 rd" class="r104 r">source</span>, <b>string</b> <span id="r105 rd" class="r105 r">destination</span>, <span class="i">PingReply</span> <span id="r106 rd" class="r106 r">reply</span>, <b>int</b> <span id="r107 rd" class="r107 r">bufferSize</span>)
                : <a href="#2eb4b49d4c4d6f25" class="k">base</a>(<span class="r104 r">source</span>, <span class="r105 r">destination</span>, <span class="r106 r">reply</span>, 1)
            {
                <a href="#fe82fec1911d5c7f" class="i property">MtuSize</a> = <span class="r107 r">bufferSize</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the maximum transmission unit size on the network path between the source and destination.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public int</b> <a id="fe82fec1911d5c7f" href="../../R/fe82fec1911d5c7f.html" target="n" data-glyph="102,2" class="i property">MtuSize</a> { <b>get</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The class contains an information about a trace route attempt.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public class</b> <a id="776703316bdcd0e1" href="../../R/776703316bdcd0e1.html" target="n" data-glyph="0,1" class="t t">TraceStatus</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#776703316bdcd0e1" class="t t">TraceStatus</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">hop</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The hop number of this trace hop.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">status</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The PingStatus response from this trace hop.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">source</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The source computer name or IP address of the traceroute.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">destination</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The target destination of the traceroute.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">destinationAddress</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The target IPAddress of the overall traceroute.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal</b> <a id="39b519f7a605891e" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">TraceStatus</a>(
                <b>int</b> <span id="r108 rd" class="r108 r">hop</span>,
                <a href="#9be3860f5d7a0a5e" class="t t">PingStatus</a> <span id="r109 rd" class="r109 r">status</span>,
                <b>string</b> <span id="r110 rd" class="r110 r">source</span>,
                <b>string</b> <span id="r111 rd" class="r111 r">destination</span>,
                <span class="i">IPAddress</span> <span id="r112 rd" class="r112 r">destinationAddress</span>)
            {
                <a href="#70e04acbeea80468" class="i field">_status</a> = <span class="r109 r">status</span>;
                <a href="#5e1982dc1b6f56ca" class="i property">Hop</a> = <span class="r108 r">hop</span>;
                <a href="#85e5ff1a54aa1da4" class="i property">Source</a> = <span class="r110 r">source</span>;
                <a href="#fa877002409e8d10" class="i property">Target</a> = <span class="r111 r">destination</span>;
                <a href="#1c8ae82c7c8523a9" class="i property">TargetAddress</a> = <span class="r112 r">destinationAddress</span>;
 
                <b>if</b> (<a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#cdf60f3908894901" class="i property">Address</a> == <span class="i">IPAddress</span>.<span class="i">Any</span>
                    || <a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#cdf60f3908894901" class="i property">Address</a> == <span class="i">IPAddress</span>.<span class="i">IPv6Any</span>)
                {
                    <a href="#8b4d3ce4f5a2d9e8" class="i property">Hostname</a> = <b>null</b>;
                }
                <b>else</b>
                {
                    <a href="#8b4d3ce4f5a2d9e8" class="i property">Hostname</a> = <a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#a63df84ddfe35b4a" class="i property">Destination</a>;
                }
            }
 
            <b>private readonly</b> <a href="#9be3860f5d7a0a5e" class="t t">PingStatus</a> <a id="70e04acbeea80468" href="../../R/70e04acbeea80468.html" target="n" data-glyph="46,2" class="i field">_status</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the number of the current hop / router.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public int</b> <a id="5e1982dc1b6f56ca" href="../../R/5e1982dc1b6f56ca.html" target="n" data-glyph="102,2" class="i property">Hop</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the hostname of the current hop point.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
            <b>public string</b>? <a id="8b4d3ce4f5a2d9e8" href="../../R/8b4d3ce4f5a2d9e8.html" target="n" data-glyph="102,2" class="i property">Hostname</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the sequence number of the ping in the sequence of pings to the hop point.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public uint</b> <a id="005e76c5e590bccc" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">Ping</a> { <b>get</b> =&gt; <a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#5a7e8e147f7576ef" class="i property">Ping</a>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the IP address of the current hop point.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">IPAddress</span>? <a id="a3102980ea82ad67" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">HopAddress</a> { <b>get</b> =&gt; <a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#cdf60f3908894901" class="i property">Address</a>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the latency values of each ping to the current hop point.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public long</b> <a id="86d0e9a09304f9ed" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">Latency</a> { <b>get</b> =&gt; <a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#dc39112c0b01fc99" class="i property">Latency</a>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the status of the traceroute hop.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">IPStatus</span> <a id="4720b2f3206cb99d" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">Status</a> { <b>get</b> =&gt; <a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#5a64e185c2c5dd70" class="i property">Status</a>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the source address of the traceroute command.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public string</b> <a id="85e5ff1a54aa1da4" href="../../R/85e5ff1a54aa1da4.html" target="n" data-glyph="102,2" class="i property">Source</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the final destination hostname of the trace.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public string</b> <a id="fa877002409e8d10" href="../../R/fa877002409e8d10.html" target="n" data-glyph="102,2" class="i property">Target</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the final destination IP address of the trace.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">IPAddress</span> <a id="1c8ae82c7c8523a9" href="../../R/1c8ae82c7c8523a9.html" target="n" data-glyph="102,2" class="i property">TargetAddress</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Gets the raw PingReply object received from the ping to this hop point.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">PingReply</span> <a id="8e9c38226c927858" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">Reply</a> { <b>get</b> =&gt; <a href="#70e04acbeea80468" class="i field">_status</a>.<a href="#a36252a6248e1ae9" class="i property">Reply</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Finalizes an instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5321ee1f6a221808" class="t t">TestConnectionCommand</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        ~<a id="e804bfb0570a0f6e" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="t method">TestConnectionCommand</a>()
        {
            <a href="#6d783f0d1ba3e77a" class="i method">Dispose</a>(<span class="r87 r">disposing</span>: <b>false</b>);
        }
    }
}
</pre></td></tr></table></div></body></html>
