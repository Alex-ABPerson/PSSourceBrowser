<!DOCTYPE html>
<html><head><title>TimeZoneCommands.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(794);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/commands/management/TimeZoneCommands.cs" target="_top">commands\management\TimeZoneCommands.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A cmdlet to retrieve time zone information.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsCommon</span>.<span class="i">Get</span>, <span class="s">&quot;TimeZone&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Name&quot;</span>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkId=2096904&quot;</span>)]
    [<span class="i">Alias</span>(<span class="s">&quot;gtz&quot;</span>)]
    <b>public class</b> <a id="1867e060c11dc618" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="bd72dee5d06575c5">GetTimeZoneCommand</span></a> : <span class="i">PSCmdlet</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A list of the local time zone ids that the cmdlet should look up.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;Id&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="b63da4de6d31bc9f" href="../../R/b63da4de6d31bc9f.html" target="n" data-glyph="102,1" class="i property">Id</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies that the cmdlet should produce a collection of the</span>
        <span class="c">///</span><span class="c"> TimeZoneInfo objects that are available on the system.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;ListAvailable&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="3def2aa8b728efc9" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">ListAvailable</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A list of the local time zone names that the cmdlet should look up.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">ValueFromPipeline</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;Name&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="23992a0ae79ceb87" href="../../R/23992a0ae79ceb87.html" target="n" data-glyph="102,1" class="i property">Name</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implementation of the ProcessRecord method for Get-TimeZone.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="9520c5c5454f6adf" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <span class="c">// make sure we&#39;ve got the latest time zone settings</span>
            <span class="i">TimeZoneInfo</span>.<span class="i">ClearCachedData</span>();
 
            <b>if</b> (<a href="#1867e060c11dc618" class="k">this</a>.<span class="i">ParameterSetName</span>.<span class="i">Equals</span>(<span class="s">&quot;ListAvailable&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// output the list of all available time zones</span>
                <span class="i">WriteObject</span>(<span class="i">TimeZoneInfo</span>.<span class="i">GetSystemTimeZones</span>(), <b>true</b>);
            }
            <b>else</b> <b>if</b> (<a href="#1867e060c11dc618" class="k">this</a>.<span class="i">ParameterSetName</span>.<span class="i">Equals</span>(<span class="s">&quot;Id&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// lookup each time zone id</span>
                <b>foreach</b> (<b>string</b> <span id="r0 rd" class="r0 r">tzid</span> <b>in</b> <a href="#b63da4de6d31bc9f" class="i property">Id</a>)
                {
                    <b>try</b>
                    {
                        <span class="i">WriteObject</span>(<span class="i">TimeZoneInfo</span>.<span class="i">FindSystemTimeZoneById</span>(<span class="r0 r">tzid</span>));
                    }
                    <b>catch</b> (<span class="i">TimeZoneNotFoundException</span> <span id="r1 rd" class="r1 r">e</span>)
                    {
                        <span class="i">WriteError</span>(<b>new</b> <span class="i">ErrorRecord</span>(<span class="r1 r">e</span>, <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#ca5a78a98f1b6aa1" class="i field">TimeZoneNotFoundError</a>,
                            <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>, <span class="s">&quot;Id&quot;</span>));
                    }
                }
            }
            <b>else</b> <span class="c">// ParameterSetName == &quot;Name&quot;</span>
            {
                <b>if</b> (<a href="#23992a0ae79ceb87" class="i property">Name</a> != <b>null</b>)
                {
                    <span class="c">// lookup each time zone name (or wildcard pattern)</span>
                    <b>foreach</b> (<b>string</b> <span id="r2 rd" class="r2 r">tzname</span> <b>in</b> <a href="#23992a0ae79ceb87" class="i property">Name</a>)
                    {
                        <span class="i">TimeZoneInfo</span>[] <span id="r3 rd" class="r3 r">timeZones</span> = <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#0d7624979a522550" class="i method">LookupSystemTimeZoneInfoByName</a>(<span class="r2 r">tzname</span>);
                        <b>if</b> (<span class="r3 r">timeZones</span>.<span class="i">Length</span> &gt; 0)
                        {
                            <span class="c">// manually process each object in the array, so if there is only a single</span>
                            <span class="c">// entry then the returned type is TimeZoneInfo and not TimeZoneInfo[], and</span>
                            <span class="c">// it can be pipelined to Set-TimeZone more easily</span>
                            <b>foreach</b> (<span class="i">TimeZoneInfo</span> <span id="r4 rd" class="r4 r">timeZone</span> <b>in</b> <span class="r3 r">timeZones</span>)
                            {
                                <span class="i">WriteObject</span>(<span class="r4 r">timeZone</span>);
                            }
                        }
                        <b>else</b>
                        {
                            <b>string</b> <span id="r5 rd" class="r5 r">message</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                <span class="i">TimeZoneResources</span>.<span class="i">TimeZoneNameNotFound</span>, <span class="r2 r">tzname</span>);
 
                            <span class="i">Exception</span> <span id="r6 rd" class="r6 r">e</span> = <b>new</b> <span class="i">TimeZoneNotFoundException</span>(<span class="r5 r">message</span>);
                            <span class="i">WriteError</span>(<b>new</b> <span class="i">ErrorRecord</span>(<span class="r6 r">e</span>, <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#ca5a78a98f1b6aa1" class="i field">TimeZoneNotFoundError</a>,
                                <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>, <span class="s">&quot;Name&quot;</span>));
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="c">// return the current system local time zone</span>
                    <span class="i">WriteObject</span>(<span class="i">TimeZoneInfo</span>.<span class="i">Local</span>);
                }
            }
        }
    }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A cmdlet to set the system&#39;s local time zone.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsCommon</span>.<span class="i">Set</span>, <span class="s">&quot;TimeZone&quot;</span>,
        <span class="i">SupportsShouldProcess</span> = <b>true</b>,
        <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Name&quot;</span>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkId=2097056&quot;</span>)]
    [<span class="i">Alias</span>(<span class="s">&quot;stz&quot;</span>)]
    <b>public class</b> <a id="3ddceac37ed590ec" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="1d2d118cd01ca5a5">SetTimeZoneCommand</span></a> : <span class="i">PSCmdlet</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> string constants
 
        <b>private const string</b> <a id="ccb2c5d50478d59b" href="../../R/ccb2c5d50478d59b.html" target="n" data-glyph="10,1" class="i field">TimeZoneTarget</a> = <span class="s">&quot;Local System&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> string constants
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the local time zone that the system should use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">ParameterSetName</span> = <span class="s">&quot;Id&quot;</span>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        <b>public string</b> <a id="368891dacdfd69f2" href="../../R/368891dacdfd69f2.html" target="n" data-glyph="102,1" class="i property">Id</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A TimeZoneInfo object identifying the local time zone that the system should use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">Position</span> = 0, <span class="i">ParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        <b>public</b> <span class="i">TimeZoneInfo</span> <a id="a0525d5a8358c301" href="../../R/a0525d5a8358c301.html" target="n" data-glyph="102,1" class="i property">InputObject</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the local time zone that the system should use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">Position</span> = 0, <span class="i">ParameterSetName</span> = <span class="s">&quot;Name&quot;</span>)]
        <b>public string</b> <a id="05cd3db971c5d824" href="../../R/05cd3db971c5d824.html" target="n" data-glyph="102,1" class="i property">Name</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Request return of the new local time zone as a TimeZoneInfo object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="55df6719fa71c8e8" href="../../R/55df6719fa71c8e8.html" target="n" data-glyph="102,1" class="i property">PassThru</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implementation of the ProcessRecord method for Get-TimeZone.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2208:InstantiateArgumentExceptionsCorrectly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Since Name is not a parameter of this method, it confuses FXCop. It is the appropriate value for the exception.&quot;</span>)]
        <b>protected override void</b> <a id="2890e92ad8df1a68" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <span class="c">// make sure we&#39;ve got fresh data, in case the requested time zone was added</span>
            <span class="c">// to the system (registry) after our process was started</span>
            <span class="i">TimeZoneInfo</span>.<span class="i">ClearCachedData</span>();
 
            <span class="c">// acquire a TimeZoneInfo if one wasn&#39;t supplied.</span>
            <b>if</b> (<a href="#3ddceac37ed590ec" class="k">this</a>.<span class="i">ParameterSetName</span>.<span class="i">Equals</span>(<span class="s">&quot;Id&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>try</b>
                {
                    <a href="#a0525d5a8358c301" class="i property">InputObject</a> = <span class="i">TimeZoneInfo</span>.<span class="i">FindSystemTimeZoneById</span>(<a href="#368891dacdfd69f2" class="i property">Id</a>);
                }
                <b>catch</b> (<span class="i">TimeZoneNotFoundException</span> <span id="r7 rd" class="r7 r">e</span>)
                {
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="i">ErrorRecord</span>(
                        <span class="r7 r">e</span>,
                        <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#ca5a78a98f1b6aa1" class="i field">TimeZoneNotFoundError</a>,
                        <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>,
                        <span class="s">&quot;Id&quot;</span>));
                }
            }
            <b>else</b> <b>if</b> (<a href="#3ddceac37ed590ec" class="k">this</a>.<span class="i">ParameterSetName</span>.<span class="i">Equals</span>(<span class="s">&quot;Name&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// lookup the time zone name and make sure we have one (and only one) match</span>
                <span class="i">TimeZoneInfo</span>[] <span id="r8 rd" class="r8 r">timeZones</span> = <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#0d7624979a522550" class="i method">LookupSystemTimeZoneInfoByName</a>(<a href="#05cd3db971c5d824" class="i property">Name</a>);
                <b>if</b> (<span class="r8 r">timeZones</span>.<span class="i">Length</span> == 0)
                {
                    <b>string</b> <span id="r9 rd" class="r9 r">message</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="i">TimeZoneResources</span>.<span class="i">TimeZoneNameNotFound</span>, <a href="#05cd3db971c5d824" class="i property">Name</a>);
                    <span class="i">Exception</span> <span id="r10 rd" class="r10 r">e</span> = <b>new</b> <span class="i">TimeZoneNotFoundException</span>(<span class="r9 r">message</span>);
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="i">ErrorRecord</span>(<span class="r10 r">e</span>,
                        <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#ca5a78a98f1b6aa1" class="i field">TimeZoneNotFoundError</a>,
                        <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>,
                        <span class="s">&quot;Name&quot;</span>));
                }
                <b>else</b> <b>if</b> (<span class="r8 r">timeZones</span>.<span class="i">Length</span> &gt; 1)
                {
                    <b>string</b> <span id="r11 rd" class="r11 r">message</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="i">TimeZoneResources</span>.<span class="i">MultipleMatchingTimeZones</span>, <a href="#05cd3db971c5d824" class="i property">Name</a>);
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="i">ErrorRecord</span>(
                            <b>new</b> <span class="i">PSArgumentException</span>(<span class="r11 r">message</span>, <span class="s">&quot;Name&quot;</span>),
                            <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#1e46021b0f7266ea" class="i field">MultipleMatchingTimeZonesError</a>,
                            <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>,
                            <span class="s">&quot;Name&quot;</span>));
                }
                <b>else</b>
                {
                    <a href="#a0525d5a8358c301" class="i property">InputObject</a> = <span class="r8 r">timeZones</span>[0];
                }
            }
            <b>else</b> <span class="c">// ParameterSetName == &quot;InputObject&quot;</span>
            {
                <b>try</b>
                {
                    <span class="c">// a TimeZoneInfo object was supplied, so use it to make sure we can find</span>
                    <span class="c">// a backing system time zone, otherwise it&#39;s an error condition</span>
                    <a href="#a0525d5a8358c301" class="i property">InputObject</a> = <span class="i">TimeZoneInfo</span>.<span class="i">FindSystemTimeZoneById</span>(<a href="#a0525d5a8358c301" class="i property">InputObject</a>.<span class="i">Id</span>);
                }
                <b>catch</b> (<span class="i">TimeZoneNotFoundException</span> <span id="r12 rd" class="r12 r">e</span>)
                {
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="i">ErrorRecord</span>(
                        <span class="r12 r">e</span>,
                        <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#ca5a78a98f1b6aa1" class="i field">TimeZoneNotFoundError</a>,
                        <span class="i">ErrorCategory</span>.<span class="i">InvalidArgument</span>,
                        <span class="s">&quot;InputObject&quot;</span>));
                }
            }
 
            <b>if</b> (<span class="i">ShouldProcess</span>(<a href="#ccb2c5d50478d59b" class="i field">TimeZoneTarget</a>))
            {
                <b>bool</b> <span id="r13 rd" class="r13 r">acquireAccess</span> = <b>false</b>;
                <b>try</b>
                {
                    <span class="c">// check to see if permission to set the time zone is already enabled for this process</span>
                    <b>if</b> (!<a href="#f1ac22718e625a6d" class="i property">HasAccess</a>)
                    {
                        <span class="c">// acquire permissions to set the timezone</span>
                        <a href="#2d6bdafcac360a5a" class="i method">SetAccessToken</a>(<b>true</b>);
                        <span class="r13 r">acquireAccess</span> = <b>true</b>;
                    }
                }
                <b>catch</b> (<span class="i">Win32Exception</span> <span id="r14 rd" class="r14 r">e</span>)
                {
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="i">ErrorRecord</span>(<span class="r14 r">e</span>,
                        <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#7d03f26c61778ec2" class="i field">InsufficientPermissionsError</a>,
                        <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>, <b>null</b>));
                }
 
                <b>try</b>
                {
                    <span class="c">// construct and populate a new DYNAMIC_TIME_ZONE_INFORMATION structure</span>
                    <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#e91b9ea3122c08bf" class="t t">DYNAMIC_TIME_ZONE_INFORMATION</a> <span id="r15 rd" class="r15 r">dtzi</span> = <b>new</b>();
                    <span class="r15 r">dtzi</span>.<a href="#ef11daa2cc497923" class="i field">Bias</a> -= (<b>int</b>)<a href="#a0525d5a8358c301" class="i property">InputObject</a>.<span class="i">BaseUtcOffset</span>.<span class="i">TotalMinutes</span>;
                    <span class="r15 r">dtzi</span>.<a href="#0fcc32dc64fd2d8d" class="i field">StandardName</a> = <a href="#a0525d5a8358c301" class="i property">InputObject</a>.<span class="i">StandardName</span>;
                    <span class="r15 r">dtzi</span>.<a href="#380d137b0a586932" class="i field">DaylightName</a> = <a href="#a0525d5a8358c301" class="i property">InputObject</a>.<span class="i">DaylightName</span>;
                    <span class="r15 r">dtzi</span>.<a href="#8261749240e4f92d" class="i field">TimeZoneKeyName</a> = <a href="#a0525d5a8358c301" class="i property">InputObject</a>.<span class="i">Id</span>;
 
                    <span class="c">// Request time zone transition information for the current year</span>
                    <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#64b85e7a49e624b6" class="t t">TIME_ZONE_INFORMATION</a> <span id="r16 rd" class="r16 r">tzi</span> = <b>new</b>();
                    <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#78ddf3e7851c82ca" class="i method">GetTimeZoneInformationForYear</a>((<b>ushort</b>)<span class="i">DateTime</span>.<span class="i">Now</span>.<span class="i">Year</span>, <b>ref</b> <span class="r15 r">dtzi</span>, <b>ref</b> <span class="r16 r">tzi</span>))
                    {
                        <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
                    }
 
                    <span class="c">// copy over the transition times</span>
                    <span class="r15 r">dtzi</span>.<a href="#e905a1d4c7202c18" class="i field">StandardBias</a> = <span class="r16 r">tzi</span>.<a href="#4c1dfba60e5e2d90" class="i field">StandardBias</a>;
                    <span class="r15 r">dtzi</span>.<a href="#27407b1bb35294b7" class="i field">StandardDate</a> = <span class="r16 r">tzi</span>.<a href="#c4afacbc2dff10cd" class="i field">StandardDate</a>;
                    <span class="r15 r">dtzi</span>.<a href="#db3eac7dbfa296f7" class="i field">DaylightBias</a> = <span class="r16 r">tzi</span>.<a href="#8dae49510b6b659e" class="i field">DaylightBias</a>;
                    <span class="r15 r">dtzi</span>.<a href="#5da12bab11b2319c" class="i field">DaylightDate</a> = <span class="r16 r">tzi</span>.<a href="#f646ec37688d76da" class="i field">DaylightDate</a>;
 
                    <span class="c">// set the new local time zone for the system</span>
                    <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#18bda21be42e3310" class="i method">SetDynamicTimeZoneInformation</a>(<b>ref</b> <span class="r15 r">dtzi</span>))
                    {
                        <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
                    }
 
                    <span class="c">// broadcast a WM_SETTINGCHANGE notification message to all top-level windows so that they</span>
                    <span class="c">// know to update their notion of the current system time (and time zone) if applicable</span>
                    <b>int</b> <span id="r17 rd" class="r17 r">result</span> = 0;
                    <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#8ff90df535030622" class="i method">SendMessageTimeout</a>((<span class="i">IntPtr</span>)<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#2e8da9b4511f22c2" class="i field">HWND_BROADCAST</a>, <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#ed65fb67c487d4d5" class="i field">WM_SETTINGCHANGE</a>,
                        (<span class="i">IntPtr</span>)0, <span class="s">&quot;intl&quot;</span>, <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#4d26d88ae6948eaa" class="i field">SMTO_ABORTIFHUNG</a>, 5000, <b>ref</b> <span class="r17 r">result</span>);
 
                    <span class="c">// clear the time zone data or this PowerShell session</span>
                    <span class="c">// will not recognize the new time zone settings</span>
                    <span class="i">TimeZoneInfo</span>.<span class="i">ClearCachedData</span>();
 
                    <b>if</b> (<a href="#55df6719fa71c8e8" class="i property">PassThru</a>.<span class="i">IsPresent</span>)
                    {
                        <span class="c">// return the TimeZoneInfo object for the (new) current local time zone</span>
                        <span class="i">WriteObject</span>(<span class="i">TimeZoneInfo</span>.<span class="i">Local</span>);
                    }
                }
                <b>catch</b> (<span class="i">Win32Exception</span> <span id="r18 rd" class="r18 r">e</span>)
                {
                    <span class="i">ThrowTerminatingError</span>(<b>new</b> <span class="i">ErrorRecord</span>(<span class="r18 r">e</span>,
                        <a href="#763c73d9a3b47b92" class="t t">TimeZoneHelper</a>.<a href="#549ccec4179c318c" class="i field">SetTimeZoneFailedError</a>,
                        <span class="i">ErrorCategory</span>.<span class="i">FromStdErr</span>, <b>null</b>));
                }
                <b>finally</b>
                {
                    <b>if</b> (<span class="r13 r">acquireAccess</span>)
                    {
                        <span class="c">// reset the permissions</span>
                        <a href="#2d6bdafcac360a5a" class="i method">SetAccessToken</a>(<b>false</b>);
                    }
                }
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#55df6719fa71c8e8" class="i property">PassThru</a>.<span class="i">IsPresent</span>)
                {
                    <span class="c">// show the user the time zone settings that would have been used.</span>
                    <span class="i">WriteObject</span>(<a href="#a0525d5a8358c301" class="i property">InputObject</a>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helper functions
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the current process has access to change the time zone setting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="f1ac22718e625a6d" href="../../R/f1ac22718e625a6d.html" target="n" data-glyph="105,1" class="i property">HasAccess</a>
        {
            <b>get</b>
            {
                <b>bool</b> <span id="r19 rd" class="r19 r">hasAccess</span> = <b>false</b>;
 
                <span class="c">// open the access token for the current process</span>
                <span class="i">IntPtr</span> <span id="r20 rd" class="r20 r">hToken</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <span class="i">IntPtr</span> <span id="r21 rd" class="r21 r">hProcess</span> = <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#67ec6d79d70744d8" class="i method">GetCurrentProcess</a>();
                <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<span class="i">OpenProcessToken</span>(<span class="r21 r">hProcess</span>,
                    <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#c2e6467fb9fe172b" class="i field">TOKEN_ADJUST_PRIVILEGES</a> | <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#9809bf2827ff82b7" class="i field">TOKEN_QUERY</a>, <b>ref</b> <span class="r20 r">hToken</span>))
                {
                    <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
                }
 
                <b>try</b>
                {
                    <span class="c">// setup the privileges being checked</span>
                    <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#233ed06992678a04" class="t t">PRIVILEGE_SET</a> <span id="r22 rd" class="r22 r">ps</span> = <b>new</b>()
                    {
                        <a href="#16751f2d9f63acef" class="i field">PrivilegeCount</a> = 1,
                        <a href="#2a5580b9fbcf61a9" class="i field">Control</a> = 1,
                        <a href="#d7c332e410c1ea53" class="i field">Luid</a> = 0,
                        <a href="#bb4d51dad8388ea3" class="i field">Attributes</a> = <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#47db0309019b6ec2" class="i field">SE_PRIVILEGE_ENABLED</a>,
                    };
 
                    <span class="c">// lookup the Luid of the SeTimeZonePrivilege</span>
                    <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#b73f9583bc713133" class="i method">LookupPrivilegeValue</a>(<b>null</b>, <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#7b74e3073cbc710e" class="i field">SE_TIME_ZONE_NAME</a>, <b>ref</b> <span class="r22 r">ps</span>.<a href="#d7c332e410c1ea53" class="i field">Luid</a>))
                    {
                        <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
                    }
 
                    <span class="c">// set the privilege for the open access token</span>
                    <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#b680a50986f63104" class="i method">PrivilegeCheck</a>(<span class="r20 r">hToken</span>, <b>ref</b> <span class="r22 r">ps</span>, <b>ref</b> <span class="r19 r">hasAccess</span>))
                    {
                        <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
                    }
                }
                <b>finally</b>
                {
                    <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#7aa2440cfd3fb036" class="i method">CloseHandle</a>(<span class="r20 r">hToken</span>);
                }
 
                <b>return</b> (<span class="r19 r">hasAccess</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the SeTimeZonePrivilege, which controls access to the SetDynamicTimeZoneInformation API.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">enable</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Set to true to enable (or false to disable) the privilege.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="2d6bdafcac360a5a" href="../../R/2d6bdafcac360a5a.html" target="n" data-glyph="75,1" class="i method">SetAccessToken</a>(<b>bool</b> <span id="r23 rd" class="r23 r">enable</span>)
        {
            <span class="c">// open the access token for the current process</span>
            <span class="i">IntPtr</span> <span id="r24 rd" class="r24 r">hToken</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="i">IntPtr</span> <span id="r25 rd" class="r25 r">hProcess</span> = <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#67ec6d79d70744d8" class="i method">GetCurrentProcess</a>();
            <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<span class="i">OpenProcessToken</span>(<span class="r25 r">hProcess</span>,
                <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#c2e6467fb9fe172b" class="i field">TOKEN_ADJUST_PRIVILEGES</a> | <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#9809bf2827ff82b7" class="i field">TOKEN_QUERY</a>, <b>ref</b> <span class="r24 r">hToken</span>))
            {
                <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
            }
 
            <b>try</b>
            {
                <span class="c">// setup the privileges being requested</span>
                <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#6961bb6c38a408ae" class="t t">TOKEN_PRIVILEGES</a> <span id="r26 rd" class="r26 r">tp</span> = <b>new</b>()
                {
                    <a href="#0900c91098dc5808" class="i field">PrivilegeCount</a> = 1,
                    <a href="#30015f7cf2c51b6a" class="i field">Luid</a> = 0,
                    <a href="#4b7b9403cfae7250" class="i field">Attributes</a> = (<span class="r23 r">enable</span> ? <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#47db0309019b6ec2" class="i field">SE_PRIVILEGE_ENABLED</a> : 0),
                };
 
                <span class="c">// lookup the Luid of the SeTimeZonePrivilege</span>
                <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#b73f9583bc713133" class="i method">LookupPrivilegeValue</a>(<b>null</b>, <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#7b74e3073cbc710e" class="i field">SE_TIME_ZONE_NAME</a>, <b>ref</b> <span class="r26 r">tp</span>.<a href="#30015f7cf2c51b6a" class="i field">Luid</a>))
                {
                    <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
                }
 
                <span class="c">// set the privilege for the open access token</span>
                <b>if</b> (!<a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<span class="i">AdjustTokenPrivileges</span>(<span class="r24 r">hToken</span>, <b>false</b>, <b>ref</b> <span class="r26 r">tp</span>, 0, <span class="i">IntPtr</span>.<span class="i">Zero</span>, <span class="i">IntPtr</span>.<span class="i">Zero</span>))
                {
                    <a href="#593f34c4ca5471b1" class="i method">ThrowWin32Error</a>();
                }
            }
            <b>finally</b>
            {
                <a href="#69780c757930fc4b" class="t t">NativeMethods</a>.<a href="#7aa2440cfd3fb036" class="i method">CloseHandle</a>(<span class="r24 r">hToken</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the Win32 error code from GetLastError and throw an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="593f34c4ca5471b1" href="../../R/593f34c4ca5471b1.html" target="n" data-glyph="75,1" class="i method">ThrowWin32Error</a>()
        {
            <b>int</b> <span id="r27 rd" class="r27 r">error</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
            <b>throw</b> <b>new</b> <span class="i">Win32Exception</span>(<span class="r27 r">error</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Helper functions
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Win32 interop helper
 
        <b>internal static class</b> <a id="69780c757930fc4b" href="../../R/69780c757930fc4b.html" target="n" data-glyph="2,1" class="t t">NativeMethods</a>
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Native DLL locations
 
            <b>private const string</b> <a id="a9effd206ff2f3e2" href="../../R/a9effd206ff2f3e2.html" target="n" data-glyph="10,2" class="i field">SetDynamicTimeZoneApiDllName</a> = <span class="s">&quot;api-ms-win-core-timezone-l1-1-0.dll&quot;</span>;
            <b>private const string</b> <a id="b2fbf6b7d71eeb62" href="../../R/b2fbf6b7d71eeb62.html" target="n" data-glyph="10,2" class="i field">GetTimeZoneInformationForYearApiDllName</a> = <span class="s">&quot;api-ms-win-core-timezone-l1-1-0.dll&quot;</span>;
            <b>private const string</b> <a id="9015059150d2e739" href="../../R/9015059150d2e739.html" target="n" data-glyph="10,2" class="i field">GetCurrentProcessApiDllName</a> = <span class="s">&quot;api-ms-win-downlevel-kernel32-l1-1-0.dll&quot;</span>;
            <b>private const string</b> <a id="0745e16b17e9f5f1" href="../../R/0745e16b17e9f5f1.html" target="n" data-glyph="10,2" class="i field">OpenProcessTokenApiDllName</a> = <span class="s">&quot;api-ms-win-downlevel-advapi32-l1-1-1.dll&quot;</span>;
            <b>private const string</b> <a id="09fca3644c09e316" href="../../R/09fca3644c09e316.html" target="n" data-glyph="10,2" class="i field">LookupPrivilegeTokenApiDllName</a> = <span class="s">&quot;api-ms-win-downlevel-advapi32-l4-1-0.dll&quot;</span>;
            <b>private const string</b> <a id="f40d5e2ff97b48e2" href="../../R/f40d5e2ff97b48e2.html" target="n" data-glyph="10,2" class="i field">PrivilegeCheckApiDllName</a> = <span class="s">&quot;api-ms-win-downlevel-advapi32-l1-1-1.dll&quot;</span>;
            <b>private const string</b> <a id="4cb44b312ecc2b4c" href="../../R/4cb44b312ecc2b4c.html" target="n" data-glyph="10,2" class="i field">AdjustTokenPrivilegesApiDllName</a> = <span class="s">&quot;api-ms-win-downlevel-advapi32-l1-1-1.dll&quot;</span>;
            <b>private const string</b> <a id="6b552bcf0611e5bc" href="../../R/6b552bcf0611e5bc.html" target="n" data-glyph="10,2" class="i field">CloseHandleApiDllName</a> = <span class="s">&quot;api-ms-win-downlevel-kernel32-l1-1-0.dll&quot;</span>;
            <b>private const string</b> <a id="603dfcf8e8b41722" href="../../R/603dfcf8e8b41722.html" target="n" data-glyph="10,2" class="i field">SendMessageTimeoutApiDllName</a> = <span class="s">&quot;ext-ms-win-rtcore-ntuser-window-ext-l1-1-0.dll&quot;</span>;
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Native DLL locations
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Win32 SetDynamicTimeZoneInformation imports
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Used to marshal win32 SystemTime structure to managed code layer.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
            <b>public struct</b> <a id="00bbbf8c6924e3ae" href="../../R/00bbbf8c6924e3ae.html" target="n" data-glyph="108,2" class="t t"><span id="c5957b7e385583c4">SystemTime</span></a>
            {
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The year.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="2a6cc0a45ef839f4" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Year</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The month.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="bac0fc60c569bb07" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Month</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The day of the week.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="e775162cb491c173" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">DayOfWeek</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The day of the month.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="08009ba06e8d4dae" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Day</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The hour.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="7bfed8ddae3878a1" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Hour</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The minute.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="2e0bfb2f1e471be0" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Minute</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The second.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="970848ac24640373" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Second</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The millisecond.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U2</span>)]
                <b>public short</b> <a id="46b7279a2aae15a2" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Milliseconds</a>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Used to marshal win32 DYNAMIC_TIME_ZONE_INFORMATION structure to managed code layer.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>public struct</b> <a id="e91b9ea3122c08bf" href="../../R/e91b9ea3122c08bf.html" target="n" data-glyph="108,2" class="t t"><span id="200fc27201687db1">DYNAMIC_TIME_ZONE_INFORMATION</span></a>
            {
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The current bias for local time translation on this computer, in minutes.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">I4</span>)]
                <b>public int</b> <a id="ef11daa2cc497923" href="../../R/ef11daa2cc497923.html" target="n" data-glyph="42,3" class="i field">Bias</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A description for standard time.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 0x20)]
                <b>public string</b> <a id="0fcc32dc64fd2d8d" href="../../R/0fcc32dc64fd2d8d.html" target="n" data-glyph="42,3" class="i field">StandardName</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A SystemTime structure that contains a date and local time when the transition from daylight saving time to standard time occurs on this operating system.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                <b>public</b> <a href="#00bbbf8c6924e3ae" class="t t">SystemTime</a> <a id="27407b1bb35294b7" href="../../R/27407b1bb35294b7.html" target="n" data-glyph="42,3" class="i field">StandardDate</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The bias value to be used during local time translations that occur during standard time.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">I4</span>)]
                <b>public int</b> <a id="e905a1d4c7202c18" href="../../R/e905a1d4c7202c18.html" target="n" data-glyph="42,3" class="i field">StandardBias</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A description for daylight saving time (DST).</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 0x20)]
                <b>public string</b> <a id="380d137b0a586932" href="../../R/380d137b0a586932.html" target="n" data-glyph="42,3" class="i field">DaylightName</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A SystemTime structure that contains a date and local time when the transition from standard time to daylight saving time occurs on this operating system.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                <b>public</b> <a href="#00bbbf8c6924e3ae" class="t t">SystemTime</a> <a id="5da12bab11b2319c" href="../../R/5da12bab11b2319c.html" target="n" data-glyph="42,3" class="i field">DaylightDate</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The bias value to be used during local time translations that occur during daylight saving time.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">I4</span>)]
                <b>public int</b> <a id="db3eac7dbfa296f7" href="../../R/db3eac7dbfa296f7.html" target="n" data-glyph="42,3" class="i field">DaylightBias</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The name of the time zone registry key on the local computer.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 0x80)]
                <b>public string</b> <a id="8261749240e4f92d" href="../../R/8261749240e4f92d.html" target="n" data-glyph="42,3" class="i field">TimeZoneKeyName</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> Indicates whether dynamic daylight saving time is disabled.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">U1</span>)]
                <b>public bool</b> <a id="b9dec0900ec51900" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">DynamicDaylightTimeDisabled</a>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Used to marshal win32 TIME_ZONE_INFORMATION structure to managed code layer.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>public struct</b> <a id="64b85e7a49e624b6" href="../../R/64b85e7a49e624b6.html" target="n" data-glyph="108,2" class="t t"><span id="db3ebdf6cf0fb712">TIME_ZONE_INFORMATION</span></a>
            {
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The current bias for local time translation on this computer, in minutes.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">I4</span>)]
                <b>public int</b> <a id="6c452e7082dcd611" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">Bias</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A description for standard time.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 0x20)]
                <b>public string</b> <a id="6685ee28e031277a" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">StandardName</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A SystemTime structure that contains a date and local time when the transition from daylight saving time to standard time occurs on this operating system.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                <b>public</b> <a href="#00bbbf8c6924e3ae" class="t t">SystemTime</a> <a id="c4afacbc2dff10cd" href="../../R/c4afacbc2dff10cd.html" target="n" data-glyph="42,3" class="i field">StandardDate</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The bias value to be used during local time translations that occur during standard time.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">I4</span>)]
                <b>public int</b> <a id="4c1dfba60e5e2d90" href="../../R/4c1dfba60e5e2d90.html" target="n" data-glyph="42,3" class="i field">StandardBias</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A description for daylight saving time (DST).</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 0x20)]
                <b>public string</b> <a id="ce66043677c5be65" href="../../R/../../0000000000.html" target="n" data-glyph="42,3" class="i field">DaylightName</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> A SystemTime structure that contains a date and local time when the transition from standard time to daylight saving time occurs on this operating system.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                <b>public</b> <a href="#00bbbf8c6924e3ae" class="t t">SystemTime</a> <a id="f646ec37688d76da" href="../../R/f646ec37688d76da.html" target="n" data-glyph="42,3" class="i field">DaylightDate</a>;
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
                <span class="c">///</span><span class="c"> The bias value to be used during local time translations that occur during daylight saving time.</span>
                <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
                [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">I4</span>)]
                <b>public int</b> <a id="8dae49510b6b659e" href="../../R/8dae49510b6b659e.html" target="n" data-glyph="42,3" class="i field">DaylightBias</a>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke SetDynamicTimeZoneInformation API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">lpTimeZoneInformation</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A DYNAMIC_TIME_ZONE_INFORMATION structure representing the desired local time zone.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#a9effd206ff2f3e2" class="i field">SetDynamicTimeZoneApiDllName</a>, <span class="i">SetLastError</span> = <b>true</b>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>public static extern bool</b> <a id="18bda21be42e3310" href="../../R/18bda21be42e3310.html" target="n" data-glyph="72,2" class="i method">SetDynamicTimeZoneInformation</a>([<span class="i">In</span>] <b>ref</b> <a href="#e91b9ea3122c08bf" class="t t">DYNAMIC_TIME_ZONE_INFORMATION</a> <span id="r28 rd" class="r28 r">lpTimeZoneInformation</span>);
 
            [<span class="i">DllImport</span>(<a href="#b2fbf6b7d71eeb62" class="i field">GetTimeZoneInformationForYearApiDllName</a>, <span class="i">SetLastError</span> = <b>true</b>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>public static extern bool</b> <a id="78ddf3e7851c82ca" href="../../R/78ddf3e7851c82ca.html" target="n" data-glyph="72,2" class="i method">GetTimeZoneInformationForYear</a>([<span class="i">In</span>] <b>ushort</b> <span id="r29 rd" class="r29 r">wYear</span>, [<span class="i">In</span>] <b>ref</b> <a href="#e91b9ea3122c08bf" class="t t">DYNAMIC_TIME_ZONE_INFORMATION</a> <span id="r30 rd" class="r30 r">pdtzi</span>, <b>ref</b> <a href="#64b85e7a49e624b6" class="t t">TIME_ZONE_INFORMATION</a> <span id="r31 rd" class="r31 r">ptzi</span>);
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Win32 SetDynamicTimeZoneInformation imports
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Win32 AdjustTokenPrivilege imports
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Definition of TOKEN_QUERY constant from Win32 API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public const int</b> <a id="9809bf2827ff82b7" href="../../R/9809bf2827ff82b7.html" target="n" data-glyph="6,2" class="i field">TOKEN_QUERY</a> = 0x00000008;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Definition of TOKEN_ADJUST_PRIVILEGES constant from Win32 API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public const int</b> <a id="c2e6467fb9fe172b" href="../../R/c2e6467fb9fe172b.html" target="n" data-glyph="6,2" class="i field">TOKEN_ADJUST_PRIVILEGES</a> = 0x00000020;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Definition of SE_PRIVILEGE_ENABLED constant from Win32 API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public const int</b> <a id="47db0309019b6ec2" href="../../R/47db0309019b6ec2.html" target="n" data-glyph="6,2" class="i field">SE_PRIVILEGE_ENABLED</a> = 0x00000002;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Definition of SE_TIME_ZONE_NAME constant from Win32 API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public const string</b> <a id="7b74e3073cbc710e" href="../../R/7b74e3073cbc710e.html" target="n" data-glyph="6,2" class="i field">SE_TIME_ZONE_NAME</a> = <span class="s">&quot;SeTimeZonePrivilege&quot;</span>; <span class="c">// https://msdn.microsoft.com/library/bb530716(VS.85).aspx</span>
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke GetCurrentProcess API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#9015059150d2e739" class="i field">GetCurrentProcessApiDllName</a>, <span class="i">ExactSpelling</span> = <b>true</b>)]
            <b>public static extern</b> <span class="i">IntPtr</span> <a id="67ec6d79d70744d8" href="../../R/67ec6d79d70744d8.html" target="n" data-glyph="72,2" class="i method">GetCurrentProcess</a>();
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke OpenProcessToken API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">ProcessHandle</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">DesiredAccess</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">TokenHandle</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#0745e16b17e9f5f1" class="i field">OpenProcessTokenApiDllName</a>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">BestFitMapping</span> = <b>false</b>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>public static extern bool</b> <a id="84fbaf71f9efb71a" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">OpenProcessToken</a>(<span class="i">IntPtr</span> <span id="r32 rd" class="r32 r">ProcessHandle</span>, <b>int</b> <span id="r33 rd" class="r33 r">DesiredAccess</span>, <b>ref</b> <span class="i">IntPtr</span> <span id="r34 rd" class="r34 r">TokenHandle</span>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke LookupPrivilegeValue API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">lpSystemName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">lpName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">lpLuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#09fca3644c09e316" class="i field">LookupPrivilegeTokenApiDllName</a>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">BestFitMapping</span> = <b>false</b>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>public static extern bool</b> <a id="b73f9583bc713133" href="../../R/b73f9583bc713133.html" target="n" data-glyph="72,2" class="i method">LookupPrivilegeValue</a>(<b>string</b> <span id="r35 rd" class="r35 r">lpSystemName</span>, <b>string</b> <span id="r36 rd" class="r36 r">lpName</span>, <b>ref long</b> <span id="r37 rd" class="r37 r">lpLuid</span>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke PrivilegeCheck API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">ClientToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">RequiredPrivileges</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">pfResult</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#f40d5e2ff97b48e2" class="i field">PrivilegeCheckApiDllName</a>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">BestFitMapping</span> = <b>false</b>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>public static extern bool</b> <a id="b680a50986f63104" href="../../R/b680a50986f63104.html" target="n" data-glyph="72,2" class="i method">PrivilegeCheck</a>(<span class="i">IntPtr</span> <span id="r38 rd" class="r38 r">ClientToken</span>, <b>ref</b> <a href="#233ed06992678a04" class="t t">PRIVILEGE_SET</a> <span id="r39 rd" class="r39 r">RequiredPrivileges</span>, <b>ref bool</b> <span id="r40 rd" class="r40 r">pfResult</span>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke AdjustTokenPrivilege API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">TokenHandle</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">DisableAllPrivileges</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">NewState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">BufferLength</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">PreviousState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">ReturnLength</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#4cb44b312ecc2b4c" class="i field">AdjustTokenPrivilegesApiDllName</a>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">BestFitMapping</span> = <b>false</b>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>public static extern bool</b> <a id="2e274384591900aa" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">AdjustTokenPrivileges</a>(<span class="i">IntPtr</span> <span id="r41 rd" class="r41 r">TokenHandle</span>, <b>bool</b> <span id="r42 rd" class="r42 r">DisableAllPrivileges</span>,
                <b>ref</b> <a href="#6961bb6c38a408ae" class="t t">TOKEN_PRIVILEGES</a> <span id="r43 rd" class="r43 r">NewState</span>, <b>int</b> <span id="r44 rd" class="r44 r">BufferLength</span>, <span class="i">IntPtr</span> <span id="r45 rd" class="r45 r">PreviousState</span>, <span class="i">IntPtr</span> <span id="r46 rd" class="r46 r">ReturnLength</span>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke CloseHandle API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r47 r">hObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#6b552bcf0611e5bc" class="i field">CloseHandleApiDllName</a>, <span class="i">ExactSpelling</span> = <b>true</b>, <span class="i">SetLastError</span> = <b>true</b>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>public static extern bool</b> <a id="7aa2440cfd3fb036" href="../../R/7aa2440cfd3fb036.html" target="n" data-glyph="72,2" class="i method">CloseHandle</a>(<span class="i">IntPtr</span> <span id="r47 rd" class="r47 r">hObject</span>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Used to marshal win32 PRIVILEGE_SET structure to managed code layer.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">Pack</span> = 1)]
            <b>public struct</b> <a id="233ed06992678a04" href="../../R/233ed06992678a04.html" target="n" data-glyph="108,2" class="t t"><span id="718af4d644725545">PRIVILEGE_SET</span></a>
            {
                <b>public int</b> <a id="16751f2d9f63acef" href="../../R/16751f2d9f63acef.html" target="n" data-glyph="42,3" class="i field">PrivilegeCount</a>;
                <b>public int</b> <a id="2a5580b9fbcf61a9" href="../../R/2a5580b9fbcf61a9.html" target="n" data-glyph="42,3" class="i field">Control</a>;
                <b>public long</b> <a id="d7c332e410c1ea53" href="../../R/d7c332e410c1ea53.html" target="n" data-glyph="42,3" class="i field">Luid</a>;
                <b>public int</b> <a id="bb4d51dad8388ea3" href="../../R/bb4d51dad8388ea3.html" target="n" data-glyph="42,3" class="i field">Attributes</a>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Used to marshal win32 TOKEN_PRIVILEGES structure to managed code layer.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">Pack</span> = 1)]
            <b>public struct</b> <a id="6961bb6c38a408ae" href="../../R/6961bb6c38a408ae.html" target="n" data-glyph="108,2" class="t t"><span id="9fed9ea5e32a8eb1">TOKEN_PRIVILEGES</span></a>
            {
                <b>public int</b> <a id="0900c91098dc5808" href="../../R/0900c91098dc5808.html" target="n" data-glyph="42,3" class="i field">PrivilegeCount</a>;
                <b>public long</b> <a id="30015f7cf2c51b6a" href="../../R/30015f7cf2c51b6a.html" target="n" data-glyph="42,3" class="i field">Luid</a>;
                <b>public int</b> <a id="4b7b9403cfae7250" href="../../R/4b7b9403cfae7250.html" target="n" data-glyph="42,3" class="i field">Attributes</a>;
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Win32 AdjustTokenPrivilege imports
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Win32 SendMessage imports
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Definition of WM_SETTINGCHANGE constant from Win32 API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public const int</b> <a id="ed65fb67c487d4d5" href="../../R/ed65fb67c487d4d5.html" target="n" data-glyph="6,2" class="i field">WM_SETTINGCHANGE</a> = 0x001A;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Definition of HWND_BROADCAST constant from Win32 API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public const int</b> <a id="2e8da9b4511f22c2" href="../../R/2e8da9b4511f22c2.html" target="n" data-glyph="6,2" class="i field">HWND_BROADCAST</a> = (-1);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Definition of SMTO_ABORTIFHUNG constant from Win32 API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public const int</b> <a id="4d26d88ae6948eaa" href="../../R/4d26d88ae6948eaa.html" target="n" data-glyph="6,2" class="i field">SMTO_ABORTIFHUNG</a> = 0x0002;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> PInvoke SendMessageTimeout API.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">hWnd</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">Msg</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">wParam</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">lParam</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">fuFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">uTimeout</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">lpdwResult</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            [<span class="i">DllImport</span>(<a href="#603dfcf8e8b41722" class="i field">SendMessageTimeoutApiDllName</a>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>public static extern</b> <span class="i">IntPtr</span> <a id="8ff90df535030622" href="../../R/8ff90df535030622.html" target="n" data-glyph="72,2" class="i method">SendMessageTimeout</a>(<span class="i">IntPtr</span> <span id="r48 rd" class="r48 r">hWnd</span>, <b>int</b> <span id="r49 rd" class="r49 r">Msg</span>, <span class="i">IntPtr</span> <span id="r50 rd" class="r50 r">wParam</span>, <b>string</b> <span id="r51 rd" class="r51 r">lParam</span>, <b>int</b> <span id="r52 rd" class="r52 r">fuFlags</span>, <b>int</b> <span id="r53 rd" class="r53 r">uTimeout</span>, <b>ref int</b> <span id="r54 rd" class="r54 r">lpdwResult</span>);
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Win32 SendMessage imports
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Win32 interop helper
    }
 
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Static Helper class for working with system time zones.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="763c73d9a3b47b92" href="../../R/763c73d9a3b47b92.html" target="n" data-glyph="2,0" class="t t">TimeZoneHelper</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Error Ids
 
        <b>internal const string</b> <a id="ca5a78a98f1b6aa1" href="../../R/ca5a78a98f1b6aa1.html" target="n" data-glyph="8,1" class="i field">TimeZoneNotFoundError</a> = <span class="s">&quot;TimeZoneNotFound&quot;</span>;
        <b>internal const string</b> <a id="1e46021b0f7266ea" href="../../R/1e46021b0f7266ea.html" target="n" data-glyph="8,1" class="i field">MultipleMatchingTimeZonesError</a> = <span class="s">&quot;MultipleMatchingTimeZones&quot;</span>;
        <b>internal const string</b> <a id="7d03f26c61778ec2" href="../../R/7d03f26c61778ec2.html" target="n" data-glyph="8,1" class="i field">InsufficientPermissionsError</a> = <span class="s">&quot;InsufficientPermissions&quot;</span>;
        <b>internal const string</b> <a id="549ccec4179c318c" href="../../R/549ccec4179c318c.html" target="n" data-glyph="8,1" class="i field">SetTimeZoneFailedError</a> = <span class="s">&quot;SetTimeZoneFailed&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Error Ids
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the system time zone by checking first against StandardName and then,</span>
        <span class="c">///</span><span class="c"> if no matches were found, against the DaylightName.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name (or wildcard pattern) of the system time zone to find.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A TimeZoneInfo object array containing information about the specified system time zones.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">TimeZoneInfo</span>[] <a id="0d7624979a522550" href="../../R/0d7624979a522550.html" target="n" data-glyph="74,1" class="i method">LookupSystemTimeZoneInfoByName</a>(<b>string</b> <span id="r55 rd" class="r55 r">name</span>)
        {
            <span class="i">WildcardPattern</span> <span id="r56 rd" class="r56 r">namePattern</span> = <b>new</b>(<span class="r55 r">name</span>, <span class="i">WildcardOptions</span>.<span class="i">IgnoreCase</span>);
            <span class="i">List</span>&lt;<span class="i">TimeZoneInfo</span>&gt; <span id="r57 rd" class="r57 r">tzi</span> = <b>new</b>();
 
            <span class="c">// get the available system time zones</span>
            <span class="i">ReadOnlyCollection</span>&lt;<span class="i">TimeZoneInfo</span>&gt; <span id="r58 rd" class="r58 r">zones</span> = <span class="i">TimeZoneInfo</span>.<span class="i">GetSystemTimeZones</span>();
 
            <span class="c">// check against the standard and daylight names for each TimeZoneInfo</span>
            <b>foreach</b> (<span class="i">TimeZoneInfo</span> <span id="r59 rd" class="r59 r">zone</span> <b>in</b> <span class="r58 r">zones</span>)
            {
                <b>if</b> (<span class="r56 r">namePattern</span>.<span class="i">IsMatch</span>(<span class="r59 r">zone</span>.<span class="i">StandardName</span>) || <span class="r56 r">namePattern</span>.<span class="i">IsMatch</span>(<span class="r59 r">zone</span>.<span class="i">DaylightName</span>))
                {
                    <span class="r57 r">tzi</span>.<span class="i">Add</span>(<span class="r59 r">zone</span>);
                }
            }
 
            <b>return</b> (<span class="r57 r">tzi</span>.<span class="i">ToArray</span>());
        }
    }
}
</pre></td></tr></table></div></body></html>
