<!DOCTYPE html>
<html><head><title>Process.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(3048);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/commands/management/Process.cs" target="_top">commands\management\Process.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Specialized</span>;
<b>using</b> <span class="i">System</span>.<span class="i">ComponentModel</span>; <span class="c">// Win32Exception</span>
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>; <span class="c">// Process class</span>
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Management</span>.<span class="i">Automation</span>.<span class="i">Internal</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Net</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">Serialization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Security</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>.<span class="i">SafeHandles</span>;
<b>using</b> <span class="i">DWORD</span> = <span class="i">System</span>.<span class="i">UInt32</span>;
<b>using</b> <span class="i">FileNakedHandle</span> = <span class="i">System</span>.<span class="i">IntPtr</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ProcessBaseCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the base for process commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public abstract class</b> <a id="a4902c4cc3ff7918" href="../../R/a4902c4cc3ff7918.html" target="n" data-glyph="0,0" class="t t"><span id="8b619947fbe4e361">ProcessBaseCommand</span></a> : <span class="i">Cmdlet</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The various process selection modes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal enum</b> <a id="d0a4a13cf5a86313" href="../../R/d0a4a13cf5a86313.html" target="n" data-glyph="20,1" class="t t"><span id="23bcbea7d203497d">MatchMode</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select all processes.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="7ac2190f70a92225" href="../../R/7ac2190f70a92225.html" target="n" data-glyph="24,2" class="i field">All</a>,
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select processes matching the supplied names.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="7d51efabc3222610" href="../../R/7d51efabc3222610.html" target="n" data-glyph="24,2" class="i field">ByName</a>,
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select the processes matching the id.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="be7660dfe6c09a44" href="../../R/be7660dfe6c09a44.html" target="n" data-glyph="24,2" class="i field">ById</a>,
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Select the processes specified as input.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="e9155cf563ed43f3" href="../../R/e9155cf563ed43f3.html" target="n" data-glyph="24,2" class="i field">ByInput</a>
        }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The current process selection mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a> <a id="9f4c02d347a14d42" href="../../R/9f4c02d347a14d42.html" target="n" data-glyph="44,1" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#7ac2190f70a92225" class="i field">All</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The Name parameter is declared in subclasses,</span>
        <span class="c">///</span><span class="c"> since it is optional for GetProcess and mandatory for StopProcess.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b>[] <a id="3d4a4018e38c404e" href="../../R/3d4a4018e38c404e.html" target="n" data-glyph="44,1" class="i field">processNames</a> = <b>null</b>;
 
        <span class="c">// The Id parameter is declared in subclasses,</span>
        <span class="c">// since it is positional for StopProcess but not for GetProcess.</span>
        <b>internal int</b>[] <a id="cbd372973d7e4bdd" href="../../R/cbd372973d7e4bdd.html" target="n" data-glyph="44,1" class="i field">processIds</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the input is a stream of [collections of]</span>
        <span class="c">///</span><span class="c"> Process objects, we bypass the Name and</span>
        <span class="c">///</span><span class="c"> Id parameters and read the Process objects</span>
        <span class="c">///</span><span class="c"> directly.  This allows us to deal with processes which</span>
        <span class="c">///</span><span class="c"> have wildcard characters in their name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">Process objects</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">ParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>,
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        <b>public virtual</b> <span class="i">Process</span>[] <a id="b005c6d00ae4b43e" href="../../R/b005c6d00ae4b43e.html" target="n" data-glyph="102,1" class="i property">InputObject</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#b177fc0d7b04fe45" class="i field">_input</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#e9155cf563ed43f3" class="i field">ByInput</a>;
                <a href="#b177fc0d7b04fe45" class="i field">_input</a> = <b>value</b>;
            }
        }
 
        <b>private</b> <span class="i">Process</span>[] <a id="b177fc0d7b04fe45" href="../../R/b177fc0d7b04fe45.html" target="n" data-glyph="46,1" class="i field">_input</a> = <b>null</b>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal
 
        <span class="c">// We use a Dictionary to optimize the check whether the object</span>
        <span class="c">// is already in the list.</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">Process</span>&gt; <a id="1f5342f067cc4378" href="../../R/1f5342f067cc4378.html" target="n" data-glyph="46,1" class="i field">_matchingProcesses</a> = <b>new</b>();
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<b>int</b>, <span class="i">Process</span>&gt; <a id="62c0bec2e7d979d3" href="../../R/62c0bec2e7d979d3.html" target="n" data-glyph="46,1" class="i field">_keys</a> = <b>new</b>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve the list of all processes matching the Name, Id</span>
        <span class="c">///</span><span class="c"> and InputObject parameters, sorted by Id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<span class="i">Process</span>&gt; <a id="2cf443ea19da6543" href="../../R/2cf443ea19da6543.html" target="n" data-glyph="74,1" class="i method">MatchingProcesses</a>()
        {
            <a href="#1f5342f067cc4378" class="i field">_matchingProcesses</a>.<span class="i">Clear</span>();
            <b>switch</b> (<a href="#9f4c02d347a14d42" class="i field">myMode</a>)
            {
                <b>case</b> <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#be7660dfe6c09a44" class="i field">ById</a>:
                    <a href="#6c4bf2270b458b96" class="i method">RetrieveMatchingProcessesById</a>();
                    <b>break</b>;
 
                <b>case</b> <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#e9155cf563ed43f3" class="i field">ByInput</a>:
                    <a href="#358802844df8bf1b" class="i method">RetrieveProcessesByInput</a>();
                    <b>break</b>;
                <b>default</b>:
                    <span class="c">// Default is &quot;Name&quot;:</span>
                    <a href="#db73decec712e0ca" class="i method">RetrieveMatchingProcessesByProcessName</a>();
                    <b>break</b>;
            }
            <span class="c">// 2004/12/16 Note that the processes will be sorted</span>
            <span class="c">//  before being stopped.  PM confirms that this is fine.</span>
            <a href="#1f5342f067cc4378" class="i field">_matchingProcesses</a>.<span class="i">Sort</span>(<span class="i">ProcessComparison</span>);
            <b>return</b> <a href="#1f5342f067cc4378" class="i field">_matchingProcesses</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sort function to sort by Name first, then Id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">x</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">First Process object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">y</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Second Process object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> As string.Compare: returns less than zero if x less than y,</span>
        <span class="c">///</span><span class="c"> greater than 0 if x greater than y, 0 if x == y.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static int</b> <a id="5d4560ce70c61c07" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ProcessComparison</a>(<span class="i">Process</span> <span id="r0 rd" class="r0 r">x</span>, <span class="i">Process</span> <span id="r1 rd" class="r1 r">y</span>)
        {
            <b>int</b> <span id="r2 rd" class="r2 r">diff</span> = <b>string</b>.<span class="i">Compare</span>(
                <a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r0 r">x</span>),
                <a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r1 r">y</span>),
                <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
            <b>if</b> (<span class="r2 r">diff</span> != 0)
                <b>return</b> <span class="r2 r">diff</span>;
            <b>return</b> <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r0 r">x</span>) - <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r1 r">y</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the list of all processes matching the Name</span>
        <span class="c">///</span><span class="c"> parameter.</span>
        <span class="c">///</span><span class="c"> Generates a non-terminating error for each specified</span>
        <span class="c">///</span><span class="c"> process name which is not found even though it contains</span>
        <span class="c">///</span><span class="c"> no wildcards.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private void</b> <a id="db73decec712e0ca" href="../../R/db73decec712e0ca.html" target="n" data-glyph="76,1" class="i method">RetrieveMatchingProcessesByProcessName</a>()
        {
            <b>if</b> (<a href="#3d4a4018e38c404e" class="i field">processNames</a> == <b>null</b>)
            {
                <a href="#1f5342f067cc4378" class="i field">_matchingProcesses</a> = <b>new</b> <span class="i">List</span>&lt;<span class="i">Process</span>&gt;(<a href="#40a8ac52aca1371a" class="i property">AllProcesses</a>);
                <b>return</b>;
            }
 
            <b>foreach</b> (<b>string</b> <span id="r3 rd" class="r3 r">pattern</span> <b>in</b> <a href="#3d4a4018e38c404e" class="i field">processNames</a>)
            {
                <span class="i">WildcardPattern</span> <span id="r4 rd" class="r4 r">wildcard</span> =
                    <span class="i">WildcardPattern</span>.<span class="i">Get</span>(<span class="r3 r">pattern</span>, <span class="i">WildcardOptions</span>.<span class="i">IgnoreCase</span>);
                <b>bool</b> <span id="r5 rd" class="r5 r">found</span> = <b>false</b>;
                <b>foreach</b> (<span class="i">Process</span> <span id="r6 rd" class="r6 r">process</span> <b>in</b> <a href="#40a8ac52aca1371a" class="i property">AllProcesses</a>)
                {
                    <b>if</b> (!<span class="r4 r">wildcard</span>.<span class="i">IsMatch</span>(<a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r6 r">process</span>)))
                        <b>continue</b>;
                    <span class="r5 r">found</span> = <b>true</b>;
                    <a href="#dc945bc99b105286" class="i method">AddIdempotent</a>(<span class="r6 r">process</span>);
                }
 
                <b>if</b> (!<span class="r5 r">found</span> &amp;&amp;
                    !<span class="i">WildcardPattern</span>.<span class="i">ContainsWildcardCharacters</span>(<span class="r3 r">pattern</span>))
                {
                    <b>string</b> <span id="r7 rd" class="r7 r">errorText</span> = <span class="i">ProcessResources</span>.<span class="i">NoProcessFoundForGivenName</span>;
                    <b>string</b> <span id="r8 rd" class="r8 r">errorName</span> = <b>nameof</b>(<span class="i">ProcessResources</span>.<span class="i">NoProcessFoundForGivenName</span>);
 
                    <b>if</b> (<b>int</b>.<span class="i">TryParse</span>(<span class="r3 r">pattern</span>, <b>out int</b> <span id="r9 rd" class="r9 r">x</span>) &amp;&amp; <span class="r9 r">x</span> &gt;= 0)
                    {
                        <span class="r7 r">errorText</span> = <span class="i">ProcessResources</span>.<span class="i">RecommendIdTagForGivenName</span>;
                        <span class="r8 r">errorName</span> = <b>nameof</b>(<span class="i">ProcessResources</span>.<span class="i">RecommendIdTagForGivenName</span>);
                    }
 
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="i">processName</span>: <span class="r3 r">pattern</span>,
                        <span class="i">processId</span>: 0,
                        <span class="i">targetObject</span>: <span class="r3 r">pattern</span>,
                        <span class="i">innerException</span>: <b>null</b>,
                        <span class="i">resourceId</span>: <span class="r7 r">errorText</span>,
                        <span class="i">errorId</span>: <span class="r8 r">errorName</span>,
                        <span class="i">category</span>: <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the list of all processes matching the Id</span>
        <span class="c">///</span><span class="c"> parameter.</span>
        <span class="c">///</span><span class="c"> Generates a non-terminating error for each specified</span>
        <span class="c">///</span><span class="c"> process ID which is not found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private void</b> <a id="6c4bf2270b458b96" href="../../R/6c4bf2270b458b96.html" target="n" data-glyph="76,1" class="i method">RetrieveMatchingProcessesById</a>()
        {
            <b>if</b> (<a href="#cbd372973d7e4bdd" class="i field">processIds</a> == <b>null</b>)
            {
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;null processIds&quot;</span>);
                <b>throw</b> <span class="i">PSTraceSource</span>.<span class="i">NewInvalidOperationException</span>();
            }
 
            <b>foreach</b> (<b>int</b> <span id="r10 rd" class="r10 r">processId</span> <b>in</b> <a href="#cbd372973d7e4bdd" class="i field">processIds</a>)
            {
                <span class="i">Process</span> <span id="r11 rd" class="r11 r">process</span>;
                <b>try</b>
                {
                    <span class="r11 r">process</span> = <span class="i">Process</span>.<span class="i">GetProcessById</span>(<span class="r10 r">processId</span>);
                    <a href="#dc945bc99b105286" class="i method">AddIdempotent</a>(<span class="r11 r">process</span>);
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <b>string</b>.<span class="i">Empty</span>,
                        <span class="r10 r">processId</span>,
                        <span class="r10 r">processId</span>,
                        <b>null</b>,
                        <span class="i">ProcessResources</span>.<span class="i">NoProcessFoundForGivenId</span>,
                        <span class="s">&quot;NoProcessFoundForGivenId&quot;</span>,
                        <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>);
                    <b>continue</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the list of all processes matching the InputObject</span>
        <span class="c">///</span><span class="c"> parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private void</b> <a id="358802844df8bf1b" href="../../R/358802844df8bf1b.html" target="n" data-glyph="76,1" class="i method">RetrieveProcessesByInput</a>()
        {
            <b>if</b> (<a href="#b005c6d00ae4b43e" class="i property">InputObject</a> == <b>null</b>)
            {
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;null InputObject&quot;</span>);
                <b>throw</b> <span class="i">PSTraceSource</span>.<span class="i">NewInvalidOperationException</span>();
            }
 
            <b>foreach</b> (<span class="i">Process</span> <span id="r12 rd" class="r12 r">process</span> <b>in</b> <a href="#b005c6d00ae4b43e" class="i property">InputObject</a>)
            {
                <a href="#42b9b3f1c7806b28" class="i method">SafeRefresh</a>(<span class="r12 r">process</span>);
                <a href="#dc945bc99b105286" class="i method">AddIdempotent</a>(<span class="r12 r">process</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets an array of all processes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">An array of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">Process</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> components that represents all the process resources.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> MSDN does not document the list of exceptions,</span>
        <span class="c">///</span><span class="c"> but it is reasonable to expect that SecurityException is</span>
        <span class="c">///</span><span class="c"> among them.  Errors here will terminate the cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Process</span>[] <a id="40a8ac52aca1371a" href="../../R/40a8ac52aca1371a.html" target="n" data-glyph="104,1" class="i property">AllProcesses</a> =&gt; <a href="#d58105d0bdd08721" class="i field">_allProcesses</a> ??= <span class="i">Process</span>.<span class="i">GetProcesses</span>();
 
        <b>private</b> <span class="i">Process</span>[] <a id="d58105d0bdd08721" href="../../R/d58105d0bdd08721.html" target="n" data-glyph="46,1" class="i field">_allProcesses</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">process</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#1f5342f067cc4378" class="i field">_matchingProcesses</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> but only if it is not already on  </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#1f5342f067cc4378" class="i field">_matchingProcesses</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> We use a Dictionary to optimize the check whether the object</span>
        <span class="c">///</span><span class="c"> is already in the list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Process to add to list.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="dc945bc99b105286" href="../../R/dc945bc99b105286.html" target="n" data-glyph="76,1" class="i method">AddIdempotent</a>(
            <span class="i">Process</span> <span id="r13 rd" class="r13 r">process</span>)
        {
            <b>int</b> <span id="r14 rd" class="r14 r">hashCode</span> = <a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r13 r">process</span>).<span class="i">GetHashCode</span>()
                ^ <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r13 r">process</span>); <span class="c">// XOR</span>
            <b>if</b> (!<a href="#62c0bec2e7d979d3" class="i field">_keys</a>.<span class="i">ContainsKey</span>(<span class="r14 r">hashCode</span>))
            {
                <a href="#62c0bec2e7d979d3" class="i field">_keys</a>.<span class="i">Add</span>(<span class="r14 r">hashCode</span>, <span class="r13 r">process</span>);
                <a href="#1f5342f067cc4378" class="i field">_matchingProcesses</a>.<span class="i">Add</span>(<span class="r13 r">process</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes a non-terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">resourceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">errorId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">category</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="6c545d8ae6cba910" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">WriteNonTerminatingError</a>(
            <span class="i">Process</span> <span id="r15 rd" class="r15 r">process</span>,
            <span class="i">Exception</span> <span id="r16 rd" class="r16 r">innerException</span>,
            <b>string</b> <span id="r17 rd" class="r17 r">resourceId</span>, <b>string</b> <span id="r18 rd" class="r18 r">errorId</span>,
            <span class="i">ErrorCategory</span> <span id="r19 rd" class="r19 r">category</span>)
        {
            <span class="i">WriteNonTerminatingError</span>(
                <a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r15 r">process</span>),
                <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r15 r">process</span>),
                <span class="r15 r">process</span>,
                <span class="r16 r">innerException</span>,
                <span class="r17 r">resourceId</span>,
                <span class="r18 r">errorId</span>,
                <span class="r19 r">category</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes a non-terminating error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">processName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">processId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">targetObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">resourceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">errorId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">category</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="50f6d69cc1841947" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">WriteNonTerminatingError</a>(
            <b>string</b> <span id="r20 rd" class="r20 r">processName</span>,
            <b>int</b> <span id="r21 rd" class="r21 r">processId</span>,
            <b>object</b> <span id="r22 rd" class="r22 r">targetObject</span>,
            <span class="i">Exception</span> <span id="r23 rd" class="r23 r">innerException</span>,
            <b>string</b> <span id="r24 rd" class="r24 r">resourceId</span>,
            <b>string</b> <span id="r25 rd" class="r25 r">errorId</span>,
            <span class="i">ErrorCategory</span> <span id="r26 rd" class="r26 r">category</span>)
        {
            <b>string</b> <span id="r27 rd" class="r27 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="r24 r">resourceId</span>,
                <span class="r20 r">processName</span>,
                <span class="r21 r">processId</span>,
                (<span class="r23 r">innerException</span> == <b>null</b>) ? <b>string</b>.<span class="i">Empty</span> : <span class="r23 r">innerException</span>.<span class="i">Message</span>);
            <a href="#f1e517eab4a4dded" class="t t">ProcessCommandException</a> <span id="r28 rd" class="r28 r">exception</span> =
                <b>new</b>(<span class="r27 r">message</span>, <span class="r23 r">innerException</span>);
            <span class="r28 r">exception</span>.<a href="#db53df5ba7416b86" class="i property">ProcessName</a> = <span class="r20 r">processName</span>;
 
            <span class="i">WriteError</span>(<b>new</b> <span class="i">ErrorRecord</span>(
                <span class="r28 r">exception</span>, <span class="r25 r">errorId</span>, <span class="r26 r">category</span>, <span class="r22 r">targetObject</span>));
        }
 
        <span class="c">// The Name property is not always available, even for</span>
        <span class="c">// live processes (such as the Idle process).</span>
        <b>internal static string</b> <a id="596dc640083f8b3e" href="../../R/596dc640083f8b3e.html" target="n" data-glyph="74,1" class="i method">SafeGetProcessName</a>(<span class="i">Process</span> <span id="r29 rd" class="r29 r">process</span>)
        {
            <b>try</b>
            {
                <b>return</b> <span class="r29 r">process</span>.<span class="i">ProcessName</span>;
            }
            <b>catch</b> (<span class="i">Win32Exception</span>)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
        }
 
        <span class="c">// 2004/12/17-JonN I saw this fail once too, so we&#39;ll play it safe</span>
        <b>internal static int</b> <a id="55e99fe16cff86a8" href="../../R/55e99fe16cff86a8.html" target="n" data-glyph="74,1" class="i method">SafeGetProcessId</a>(<span class="i">Process</span> <span id="r30 rd" class="r30 r">process</span>)
        {
            <b>try</b>
            {
                <b>return</b> <span class="r30 r">process</span>.<span class="i">Id</span>;
            }
            <b>catch</b> (<span class="i">Win32Exception</span>)
            {
                <b>return</b> <b>int</b>.<span class="i">MinValue</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
                <b>return</b> <b>int</b>.<span class="i">MinValue</span>;
            }
        }
 
        <b>internal static void</b> <a id="42b9b3f1c7806b28" href="../../R/42b9b3f1c7806b28.html" target="n" data-glyph="74,1" class="i method">SafeRefresh</a>(<span class="i">Process</span> <span id="r31 rd" class="r31 r">process</span>)
        {
            <b>try</b>
            {
                <span class="r31 r">process</span>.<span class="i">Refresh</span>();
            }
            <b>catch</b> (<span class="i">Win32Exception</span>)
            {
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> TryHasExited is a helper function used to detect if the process has aready exited or not.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Process whose exit status has to be checked.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Tre if the process has exited or else returns false.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="0d9b52cf10c5a33e" href="../../R/0d9b52cf10c5a33e.html" target="n" data-glyph="74,1" class="i method">TryHasExited</a>(<span class="i">Process</span> <span id="r32 rd" class="r32 r">process</span>)
        {
            <b>bool</b> <span id="r33 rd" class="r33 r">hasExited</span> = <b>true</b>;
 
            <b>try</b>
            {
                <span class="r33 r">hasExited</span> = <span class="r32 r">process</span>.<span class="i">HasExited</span>;
            }
            <b>catch</b> (<span class="i">Win32Exception</span>)
            {
                <span class="r33 r">hasExited</span> = <b>false</b>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
                <span class="r33 r">hasExited</span> = <b>false</b>;
            }
 
            <b>return</b> <span class="r33 r">hasExited</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ProcessBaseCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> GetProcessCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the get-process command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsCommon</span>.<span class="i">Get</span>, <span class="s">&quot;Process&quot;</span>, <span class="i">DefaultParameterSetName</span> = <a href="#19c2426a471a7438" class="i field">NameParameterSet</a>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096814&quot;</span>, <span class="i">RemotingCapability</span> = <span class="i">RemotingCapability</span>.<span class="i">SupportedByCommand</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">ProcessModule</span>), <b>typeof</b>(<span class="i">FileVersionInfo</span>), <b>typeof</b>(<span class="i">Process</span>))]
    <b>public sealed class</b> <a id="1882785fe5745ea2" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="9b7664981215d678">GetProcessCommand</span></a> : <a href="#a4902c4cc3ff7918" class="t t">ProcessBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ParameterSetStrings
 
        <b>private const string</b> <a id="19c2426a471a7438" href="../../R/19c2426a471a7438.html" target="n" data-glyph="10,1" class="i field">NameParameterSet</a> = <span class="s">&quot;Name&quot;</span>;
        <b>private const string</b> <a id="af77c5505a9c72c1" href="../../R/af77c5505a9c72c1.html" target="n" data-glyph="10,1" class="i field">IdParameterSet</a> = <span class="s">&quot;Id&quot;</span>;
        <b>private const string</b> <a id="bc17ebd8db76d117" href="../../R/bc17ebd8db76d117.html" target="n" data-glyph="10,1" class="i field">InputObjectParameterSet</a> = <span class="s">&quot;InputObject&quot;</span>;
        <b>private const string</b> <a id="1ef6e0c2dc1c5cc4" href="../../R/1ef6e0c2dc1c5cc4.html" target="n" data-glyph="10,1" class="i field">NameWithUserNameParameterSet</a> = <span class="s">&quot;NameWithUserName&quot;</span>;
        <b>private const string</b> <a id="ab8d248d4de900df" href="../../R/ab8d248d4de900df.html" target="n" data-glyph="10,1" class="i field">IdWithUserNameParameterSet</a> = <span class="s">&quot;IdWithUserName&quot;</span>;
        <b>private const string</b> <a id="82279a21738cf192" href="../../R/82279a21738cf192.html" target="n" data-glyph="10,1" class="i field">InputObjectWithUserNameParameterSet</a> = <span class="s">&quot;InputObjectWithUserName&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ParameterSetStrings
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Has the list of process names on which to this command will work.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">ParameterSetName</span> = <a href="#19c2426a471a7438" class="i field">NameParameterSet</a>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 0, <span class="i">ParameterSetName</span> = <a href="#1ef6e0c2dc1c5cc4" class="i field">NameWithUserNameParameterSet</a>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ProcessName&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b>[] <a id="bde97dc08eaa08f8" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3d4a4018e38c404e" class="i field">processNames</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#7d51efabc3222610" class="i field">ByName</a>;
                <a href="#3d4a4018e38c404e" class="i field">processNames</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets/sets an array of process IDs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#af77c5505a9c72c1" class="i field">IdParameterSet</a>, <span class="i">Mandatory</span> = <b>true</b>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#ab8d248d4de900df" class="i field">IdWithUserNameParameterSet</a>, <span class="i">Mandatory</span> = <b>true</b>, <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;PID&quot;</span>)]
        <b>public int</b>[] <a id="19e1d1f51cd8a8ef" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Id</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#cbd372973d7e4bdd" class="i field">processIds</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#be7660dfe6c09a44" class="i field">ById</a>;
                <a href="#cbd372973d7e4bdd" class="i field">processIds</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input is a stream of [collections of] Process objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#bc17ebd8db76d117" class="i field">InputObjectParameterSet</a>, <span class="i">Mandatory</span> = <b>true</b>, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#82279a21738cf192" class="i field">InputObjectWithUserNameParameterSet</a>, <span class="i">Mandatory</span> = <b>true</b>, <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        <b>public override</b> <span class="i">Process</span>[] <a id="72d6953b9934bb8c" href="../../R/72d6953b9934bb8c.html" target="n" data-glyph="102,1" class="i property">InputObject</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a4902c4cc3ff7918" class="k">base</a>.<a href="#b005c6d00ae4b43e" class="i property">InputObject</a>;
            }
 
            <b>set</b>
            {
                <a href="#a4902c4cc3ff7918" class="k">base</a>.<a href="#b005c6d00ae4b43e" class="i property">InputObject</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Include the UserName.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#1ef6e0c2dc1c5cc4" class="i field">NameWithUserNameParameterSet</a>, <span class="i">Mandatory</span> = <b>true</b>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#ab8d248d4de900df" class="i field">IdWithUserNameParameterSet</a>, <span class="i">Mandatory</span> = <b>true</b>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#82279a21738cf192" class="i field">InputObjectWithUserNameParameterSet</a>, <span class="i">Mandatory</span> = <b>true</b>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="43cae9297eb55f3c" href="../../R/43cae9297eb55f3c.html" target="n" data-glyph="102,1" class="i property">IncludeUserName</a>
        {
            <b>get</b> { <b>return</b> <a href="#b628496f2fd8f658" class="i field">_includeUserName</a>; }
 
            <b>set</b> { <a href="#b628496f2fd8f658" class="i field">_includeUserName</a> = <b>value</b>; }
        }
 
        <b>private bool</b> <a id="b628496f2fd8f658" href="../../R/b628496f2fd8f658.html" target="n" data-glyph="46,1" class="i field">_includeUserName</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> To display the modules of a process.</span>
        <span class="c">///</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#19c2426a471a7438" class="i field">NameParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#af77c5505a9c72c1" class="i field">IdParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#bc17ebd8db76d117" class="i field">InputObjectParameterSet</a>)]
        [<span class="i">ValidateNotNull</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="f1471332b3328362" href="../../R/f1471332b3328362.html" target="n" data-glyph="102,1" class="i property">Module</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> To display the fileversioninfo of the main module of a process.</span>
        <span class="c">///</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#19c2426a471a7438" class="i field">NameParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#af77c5505a9c72c1" class="i field">IdParameterSet</a>)]
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <a href="#bc17ebd8db76d117" class="i field">InputObjectParameterSet</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;FV&quot;</span>, <span class="s">&quot;FVI&quot;</span>)]
        [<span class="i">ValidateNotNull</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="16a6414b6a8efcfb" href="../../R/16a6414b6a8efcfb.html" target="n" data-glyph="102,1" class="i property">FileVersionInfo</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check the elevation mode if IncludeUserName is specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="90cd6299b549e5d4" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <span class="c">// The parameter &#39;IncludeUserName&#39; requires administrator privilege</span>
            <b>if</b> (<a href="#43cae9297eb55f3c" class="i property">IncludeUserName</a>.<span class="i">IsPresent</span> &amp;&amp; !<span class="i">Utils</span>.<span class="i">IsAdministrator</span>())
            {
                <b>var</b> <span id="r34 rd" class="r34 r">ex</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">ProcessResources</span>.<span class="i">IncludeUserNameRequiresElevation</span>);
                <b>var</b> <span id="r35 rd" class="r35 r">er</span> = <b>new</b> <span class="i">ErrorRecord</span>(<span class="r34 r">ex</span>, <span class="s">&quot;IncludeUserNameRequiresElevation&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r35 r">er</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Write the process objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="2ceaf2cc7904a505" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">Process</span> <span id="r36 rd" class="r36 r">process</span> <b>in</b> <a href="#2cf443ea19da6543" class="i method">MatchingProcesses</a>())
            {
                <b>if</b> (<a href="#f1471332b3328362" class="i property">Module</a>.<span class="i">IsPresent</span> &amp;&amp; <a href="#16a6414b6a8efcfb" class="i property">FileVersionInfo</a>.<span class="i">IsPresent</span>)
                {
                    <span class="i">ProcessModule</span> <span id="r37 rd" class="r37 r">tempmodule</span> = <b>null</b>;
                    <b>try</b>
                    {
                        <span class="i">ProcessModuleCollection</span> <span id="r38 rd" class="r38 r">modules</span> = <span class="r36 r">process</span>.<span class="i">Modules</span>;
                        <b>foreach</b> (<span class="i">ProcessModule</span> <span id="r39 rd" class="r39 r">pmodule</span> <b>in</b> <span class="r38 r">modules</span>)
                        {
                            <span class="c">// Assigning to tempmodule to rethrow for exceptions on 64 bit machines</span>
                            <span class="r37 r">tempmodule</span> = <span class="r39 r">pmodule</span>;
                            <span class="i">WriteObject</span>(<span class="r39 r">pmodule</span>.<span class="i">FileVersionInfo</span>, <b>true</b>);
                        }
                    }
                    <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r40 rd" class="r40 r">exception</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r40 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModuleFileVer</span>, <span class="s">&quot;CouldNotEnumerateModuleFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                    <b>catch</b> (<span class="i">ArgumentException</span> <span id="r41 rd" class="r41 r">exception</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r41 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModuleFileVer</span>, <span class="s">&quot;CouldNotEnumerateModuleFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                    <b>catch</b> (<span class="i">Win32Exception</span> <span id="r42 rd" class="r42 r">exception</span>)
                    {
                        <b>try</b>
                        {
                            <b>if</b> (<span class="r42 r">exception</span>.<span class="i">HResult</span> == 299)
                            {
                                <span class="i">WriteObject</span>(<span class="r37 r">tempmodule</span>.<span class="i">FileVersionInfo</span>, <b>true</b>);
                            }
                            <b>else</b>
                            {
                                <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r42 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModuleFileVer</span>, <span class="s">&quot;CouldNotEnumerateModuleFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                            }
                        }
                        <b>catch</b> (<span class="i">Win32Exception</span> <span id="r43 rd" class="r43 r">ex</span>)
                        {
                            <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r43 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModuleFileVer</span>, <span class="s">&quot;CouldNotEnumerateModuleFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r44 rd" class="r44 r">exception</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r44 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModuleFileVer</span>, <span class="s">&quot;CouldNotEnumerateModuleFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                }
                <b>else</b> <b>if</b> (<a href="#f1471332b3328362" class="i property">Module</a>.<span class="i">IsPresent</span>)
                {
                    <b>try</b>
                    {
                        <span class="i">WriteObject</span>(<span class="r36 r">process</span>.<span class="i">Modules</span>, <b>true</b>);
                    }
                    <b>catch</b> (<span class="i">Win32Exception</span> <span id="r45 rd" class="r45 r">exception</span>)
                    {
                        <b>try</b>
                        {
                            <b>if</b> (<span class="r45 r">exception</span>.<span class="i">HResult</span> == 299)
                            {
                                <span class="i">WriteObject</span>(<span class="r36 r">process</span>.<span class="i">Modules</span>, <b>true</b>);
                            }
                            <b>else</b>
                            {
                                <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r45 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModules</span>, <span class="s">&quot;CouldNotEnumerateModules&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                            }
                        }
                        <b>catch</b> (<span class="i">Win32Exception</span> <span id="r46 rd" class="r46 r">ex</span>)
                        {
                            <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r46 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModules</span>, <span class="s">&quot;CouldNotEnumerateModules&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        }
                    }
                    <b>catch</b> (<span class="i">PipelineStoppedException</span>) 
                    {
                        <b>throw</b>;
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r47 rd" class="r47 r">exception</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r47 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateModules</span>, <span class="s">&quot;CouldNotEnumerateModules&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                }
                <b>else</b> <b>if</b> (<a href="#16a6414b6a8efcfb" class="i property">FileVersionInfo</a>.<span class="i">IsPresent</span>)
                {
                    <b>try</b>
                    {
                        <span class="i">ProcessModule</span> <span id="r48 rd" class="r48 r">mainModule</span> = <span class="r36 r">process</span>.<span class="i">MainModule</span>;
                        <b>if</b> (<span class="r48 r">mainModule</span> != <b>null</b>)
                        {
                            <span class="i">WriteObject</span>(<span class="r48 r">mainModule</span>.<span class="i">FileVersionInfo</span>, <b>true</b>);
                        }
                    }
                    <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r49 rd" class="r49 r">exception</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r49 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateFileVer</span>, <span class="s">&quot;CouldNotEnumerateFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                    <b>catch</b> (<span class="i">ArgumentException</span> <span id="r50 rd" class="r50 r">exception</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r50 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateFileVer</span>, <span class="s">&quot;CouldNotEnumerateFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                    <b>catch</b> (<span class="i">Win32Exception</span> <span id="r51 rd" class="r51 r">exception</span>)
                    {
                        <b>try</b>
                        {
                            <b>if</b> (<span class="r51 r">exception</span>.<span class="i">HResult</span> == 299)
                            {
                                <span class="i">WriteObject</span>(<span class="r36 r">process</span>.<span class="i">MainModule</span>?.<span class="i">FileVersionInfo</span>, <b>true</b>);
                            }
                            <b>else</b>
                            {
                                <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r51 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateFileVer</span>, <span class="s">&quot;CouldNotEnumerateFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                            }
                        }
                        <b>catch</b> (<span class="i">Win32Exception</span> <span id="r52 rd" class="r52 r">ex</span>)
                        {
                            <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r52 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateFileVer</span>, <span class="s">&quot;CouldNotEnumerateFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r53 rd" class="r53 r">exception</span>)
                    {
                        <span class="i">WriteNonTerminatingError</span>(<span class="r36 r">process</span>, <span class="r53 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotEnumerateFileVer</span>, <span class="s">&quot;CouldNotEnumerateFileVer&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">PermissionDenied</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="i">WriteObject</span>(<a href="#43cae9297eb55f3c" class="i property">IncludeUserName</a>.<span class="i">IsPresent</span> ? <a href="#75b8ee490e0a9803" class="i method">AddUserNameToProcess</a>(<span class="r36 r">process</span>) : (<b>object</b>)<span class="r36 r">process</span>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Privates
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New PSTypeName added to the process object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const string</b> <a id="85d898f1d933c6e0" href="../../R/85d898f1d933c6e0.html" target="n" data-glyph="10,1" class="i field">TypeNameForProcessWithUserName</a> = <span class="s">&quot;System.Diagnostics.Process#IncludeUserName&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add the &#39;UserName&#39; NoteProperty to the Process object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">PSObject</span> <a id="75b8ee490e0a9803" href="../../R/75b8ee490e0a9803.html" target="n" data-glyph="76,1" class="i method">AddUserNameToProcess</a>(<span class="i">Process</span> <span id="r54 rd" class="r54 r">process</span>)
        {
            <span class="c">// Return null if we failed to get the owner information</span>
            <b>string</b> <span id="r55 rd" class="r55 r">userName</span> = <a href="#966f58d401f81f5f" class="i method">RetrieveProcessUserName</a>(<span class="r54 r">process</span>);
 
            <span class="i">PSObject</span> <span id="r56 rd" class="r56 r">processAsPsobj</span> = <span class="i">PSObject</span>.<span class="i">AsPSObject</span>(<span class="r54 r">process</span>);
            <span class="i">PSNoteProperty</span> <span id="r57 rd" class="r57 r">noteProperty</span> = <b>new</b>(<span class="s">&quot;UserName&quot;</span>, <span class="r55 r">userName</span>);
 
            <span class="r56 r">processAsPsobj</span>.<span class="i">Properties</span>.<span class="i">Add</span>(<span class="r57 r">noteProperty</span>, <b>true</b>);
            <span class="r56 r">processAsPsobj</span>.<span class="i">TypeNames</span>.<span class="i">Insert</span>(0, <a href="#85d898f1d933c6e0" class="i field">TypeNameForProcessWithUserName</a>);
 
            <b>return</b> <span class="r56 r">processAsPsobj</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve the UserName through PInvoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="966f58d401f81f5f" href="../../R/966f58d401f81f5f.html" target="n" data-glyph="76,1" class="i method">RetrieveProcessUserName</a>(<span class="i">Process</span> <span id="r58 rd" class="r58 r">process</span>)
        {
            <b>string</b> <span id="r59 rd" class="r59 r">userName</span> = <b>null</b>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            userName = Platform.NonWindowsGetUserFromPid(process.Id);
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <span class="i">IntPtr</span> <span id="r60 rd" class="r60 r">tokenUserInfo</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <span class="i">IntPtr</span> <span id="r61 rd" class="r61 r">processTokenHandler</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
 
            <b>const uint</b> <span id="r62 rd" class="r62 r">TOKEN_QUERY</span> = 0x0008;
 
            <b>try</b>
            {
                <b>do</b>
                {
                    <b>int</b> <span id="r63 rd" class="r63 r">error</span>;
                    <b>if</b> (!<span class="i">Win32Native</span>.<span class="i">OpenProcessToken</span>(<span class="r58 r">process</span>.<span class="i">Handle</span>, <span class="r62 r">TOKEN_QUERY</span>, <b>out</b> <span class="r61 r">processTokenHandler</span>)) { <b>break</b>; }
 
                    <span class="c">// Set the default length to be 256, so it will be sufficient for most cases.</span>
                    <b>int</b> <span id="r64 rd" class="r64 r">tokenInfoLength</span> = 256;
                    <span class="r60 r">tokenUserInfo</span> = <span class="i">Marshal</span>.<span class="i">AllocHGlobal</span>(<span class="r64 r">tokenInfoLength</span>);
                    <b>if</b> (!<span class="i">Win32Native</span>.<span class="i">GetTokenInformation</span>(<span class="r61 r">processTokenHandler</span>, <span class="i">Win32Native</span>.<span class="i">TOKEN_INFORMATION_CLASS</span>.<span class="i">TokenUser</span>, <span class="r60 r">tokenUserInfo</span>, <span class="r64 r">tokenInfoLength</span>, <b>out</b> <span class="r64 r">tokenInfoLength</span>))
                    {
                        <span class="r63 r">error</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                        <b>if</b> (<span class="r63 r">error</span> == <span class="i">Win32Native</span>.<span class="i">ERROR_INSUFFICIENT_BUFFER</span>)
                        {
                            <span class="i">Marshal</span>.<span class="i">FreeHGlobal</span>(<span class="r60 r">tokenUserInfo</span>);
                            <span class="r60 r">tokenUserInfo</span> = <span class="i">Marshal</span>.<span class="i">AllocHGlobal</span>(<span class="r64 r">tokenInfoLength</span>);
 
                            <b>if</b> (!<span class="i">Win32Native</span>.<span class="i">GetTokenInformation</span>(<span class="r61 r">processTokenHandler</span>, <span class="i">Win32Native</span>.<span class="i">TOKEN_INFORMATION_CLASS</span>.<span class="i">TokenUser</span>, <span class="r60 r">tokenUserInfo</span>, <span class="r64 r">tokenInfoLength</span>, <b>out</b> <span class="r64 r">tokenInfoLength</span>)) { <b>break</b>; }
                        }
                        <b>else</b>
                        {
                            <b>break</b>;
                        }
                    }
 
                    <b>var</b> <span id="r65 rd" class="r65 r">tokenUser</span> = <span class="i">Marshal</span>.<span class="i">PtrToStructure</span>&lt;<span class="i">Win32Native</span>.<span class="i">TOKEN_USER</span>&gt;(<span class="r60 r">tokenUserInfo</span>);
 
                    <span class="c">// Max username is defined as UNLEN = 256 in lmcons.h</span>
                    <span class="c">// Max domainname is defined as DNLEN = CNLEN = 15 in lmcons.h</span>
                    <span class="c">// The buffer length must be +1, last position is for a null string terminator.</span>
                    <b>int</b> <span id="r66 rd" class="r66 r">userNameLength</span> = 257;
                    <b>int</b> <span id="r67 rd" class="r67 r">domainNameLength</span> = 16;
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CA2014</span>
                    <span class="i">Span</span>&lt;<b>char</b>&gt; <span id="r68 rd" class="r68 r">userNameStr</span> = <b>stackalloc char</b>[<span class="r66 r">userNameLength</span>];
                    <span class="i">Span</span>&lt;<b>char</b>&gt; <span id="r69 rd" class="r69 r">domainNameStr</span> = <b>stackalloc char</b>[<span class="r67 r">domainNameLength</span>];
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">CA2014</span>
                    <span class="i">Win32Native</span>.<span class="i">SID_NAME_USE</span> <span id="r70 rd" class="r70 r">accountType</span>;
 
                    <span class="c">// userNameLength and domainNameLength will be set to actual lengths.</span>
                    <b>if</b> (!<span class="i">Win32Native</span>.<span class="i">LookupAccountSid</span>(<b>null</b>, <span class="r65 r">tokenUser</span>.<span class="i">User</span>.<span class="i">Sid</span>, <span class="r68 r">userNameStr</span>, <b>ref</b> <span class="r66 r">userNameLength</span>, <span class="r69 r">domainNameStr</span>, <b>ref</b> <span class="r67 r">domainNameLength</span>, <b>out</b> <span class="r70 r">accountType</span>))
                    {
                        <b>break</b>;
                    }
 
                    <span class="r59 r">userName</span> = <b>string</b>.<span class="i">Concat</span>(<span class="r69 r">domainNameStr</span>.<span class="i">Slice</span>(0, <span class="r67 r">domainNameLength</span>), <span class="s">&quot;\\&quot;</span>, <span class="r68 r">userNameStr</span>.<span class="i">Slice</span>(0, <span class="r66 r">userNameLength</span>));
                } <b>while</b> (<b>false</b>);
            }
            <b>catch</b> (<span class="i">NotSupportedException</span>)
            {
                <span class="c">// The Process not started yet, or it&#39;s a process from a remote machine.</span>
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
                <span class="c">// The Process has exited, Process.Handle will raise this exception.</span>
            }
            <b>catch</b> (<span class="i">Win32Exception</span>)
            {
                <span class="c">// We might get an AccessDenied error.</span>
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// I don&#39;t expect to get other exceptions.</span>
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r60 r">tokenUserInfo</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="i">Marshal</span>.<span class="i">FreeHGlobal</span>(<span class="r60 r">tokenUserInfo</span>);
                }
 
                <b>if</b> (<span class="r61 r">processTokenHandler</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="i">Win32Native</span>.<span class="i">CloseHandle</span>(<span class="r61 r">processTokenHandler</span>);
                }
            }
 
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>return</b> <span class="r59 r">userName</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Privates
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> GetProcessCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> WaitProcessCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the Wait-process command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Wait</span>, <span class="s">&quot;Process&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Name&quot;</span>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097146&quot;</span>)]
    <b>public sealed class</b> <a id="df14662150c6b85d" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="d783da08d639cba4">WaitProcessCommand</span></a> : <a href="#a4902c4cc3ff7918" class="t t">ProcessBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies the process IDs of the processes to be waited on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">ParameterSetName</span> = <span class="s">&quot;Id&quot;</span>,
            <span class="i">Position</span> = 0,
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;PID&quot;</span>, <span class="s">&quot;ProcessId&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public int</b>[] <a id="6b0be69492d2c85f" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Id</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#cbd372973d7e4bdd" class="i field">processIds</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#be7660dfe6c09a44" class="i field">ById</a>;
                <a href="#cbd372973d7e4bdd" class="i field">processIds</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the processes to wait on for termination.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">ParameterSetName</span> = <span class="s">&quot;Name&quot;</span>,
            <span class="i">Position</span> = 0,
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ProcessName&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="2ecec30313ea7dff" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3d4a4018e38c404e" class="i field">processNames</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#7d51efabc3222610" class="i field">ByName</a>;
                <a href="#3d4a4018e38c404e" class="i field">processNames</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If specified, wait for this number of seconds.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 1)]
        [<span class="i">Alias</span>(<span class="s">&quot;TimeoutSec&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">ValidateRange</span>(0, 32767)]
        <b>public int</b> <a id="f628de9778018c9f" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Timeout</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#207141284d0427fe" class="i field">_timeout</a>;
            }
 
            <b>set</b>
            {
                <a href="#207141284d0427fe" class="i field">_timeout</a> = <b>value</b>;
                <a href="#8ccb5f4850a9c87a" class="i field">_timeOutSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private int</b> <a id="207141284d0427fe" href="../../R/207141284d0427fe.html" target="n" data-glyph="46,1" class="i field">_timeout</a> = 0;
        <b>private bool</b> <a id="8ccb5f4850a9c87a" href="../../R/8ccb5f4850a9c87a.html" target="n" data-glyph="46,1" class="i field">_timeOutSpecified</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <b>private bool</b> <a id="3c6ae28c04b144ab" href="../../R/3c6ae28c04b144ab.html" target="n" data-glyph="46,1" class="i field">_disposed</a> = <b>false</b>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dispose method of IDisposable interface.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="30906c3bafac3d4e" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <b>if</b> (!<a href="#3c6ae28c04b144ab" class="i field">_disposed</a>)
            {
                <b>if</b> (<a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a> != <b>null</b>)
                {
                    <a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a>.<span class="i">Dispose</span>();
                    <a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a> = <b>null</b>;
                }
 
                <a href="#3c6ae28c04b144ab" class="i field">_disposed</a> = <b>true</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private methods
        <span class="c">// Handle Exited event and display process information.</span>
        <b>private void</b> <a id="8b69e36125864925" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">myProcess_Exited</a>(<b>object</b> <span id="r71 rd" class="r71 r">sender</span>, <span class="i">System</span>.<span class="i">EventArgs</span> <span id="r72 rd" class="r72 r">e</span>)
        {
            <b>if</b> (<span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Interlocked</span>.<span class="i">Decrement</span>(<b>ref</b> <a href="#fd1afd2d72677bdb" class="i field">_numberOfProcessesToWaitFor</a>) == 0)
            {
                <b>if</b> (<a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a> != <b>null</b>)
                {
                    <a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a>.<span class="i">Set</span>();
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
 
        <b>private readonly</b> <span class="i">List</span>&lt;<span class="i">Process</span>&gt; <a id="0c64f48dcc6304db" href="../../R/0c64f48dcc6304db.html" target="n" data-glyph="46,1" class="i field">_processList</a> = <b>new</b>();
 
        <span class="c">// Wait handle which is used by thread to sleep.</span>
        <b>private</b> <span class="i">ManualResetEvent</span> <a id="bc6b9d53e68109f0" href="../../R/bc6b9d53e68109f0.html" target="n" data-glyph="46,1" class="i field">_waitHandle</a>;
        <b>private int</b> <a id="fd1afd2d72677bdb" href="../../R/fd1afd2d72677bdb.html" target="n" data-glyph="46,1" class="i field">_numberOfProcessesToWaitFor</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the list of process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="351b419775cd45d9" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <span class="c">// adding the processes into the list</span>
            <b>foreach</b> (<span class="i">Process</span> <span id="r73 rd" class="r73 r">process</span> <b>in</b> <a href="#2cf443ea19da6543" class="i method">MatchingProcesses</a>())
            {
                <span class="c">// Idle process has processid zero,so handle that because we cannot wait on it.</span>
                <b>if</b> (<span class="r73 r">process</span>.<span class="i">Id</span> == 0)
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r73 r">process</span>, <b>null</b>, <span class="i">ProcessResources</span>.<span class="i">WaitOnIdleProcess</span>, <span class="s">&quot;WaitOnIdleProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>);
                    <b>continue</b>;
                }
 
                <span class="c">// It cannot wait on itself</span>
                <b>if</b> (<span class="r73 r">process</span>.<span class="i">Id</span>.<span class="i">Equals</span>(<span class="i">Environment</span>.<span class="i">ProcessId</span>))
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r73 r">process</span>, <b>null</b>, <span class="i">ProcessResources</span>.<span class="i">WaitOnItself</span>, <span class="s">&quot;WaitOnItself&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>);
                    <b>continue</b>;
                }
 
                <a href="#0c64f48dcc6304db" class="i field">_processList</a>.<span class="i">Add</span>(<span class="r73 r">process</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wait for the process to terminate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="455f2db180590649" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">EndProcessing</a>()
        {
            <a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a> = <b>new</b> <span class="i">ManualResetEvent</span>(<b>false</b>);
            <b>foreach</b> (<span class="i">Process</span> <span id="r74 rd" class="r74 r">process</span> <b>in</b> <a href="#0c64f48dcc6304db" class="i field">_processList</a>)
            {
                <b>try</b>
                {
                    <b>if</b> (!<span class="r74 r">process</span>.<span class="i">HasExited</span>)
                    {
                        <span class="r74 r">process</span>.<span class="i">EnableRaisingEvents</span> = <b>true</b>;
                        <span class="r74 r">process</span>.<span class="i">Exited</span> += <span class="i">myProcess_Exited</span>;
                        <b>if</b> (!<span class="r74 r">process</span>.<span class="i">HasExited</span>)
                        {
                            <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Interlocked</span>.<span class="i">Increment</span>(<b>ref</b> <a href="#fd1afd2d72677bdb" class="i field">_numberOfProcessesToWaitFor</a>);
                        }
                    }
                }
                <b>catch</b> (<span class="i">Win32Exception</span> <span id="r75 rd" class="r75 r">exception</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r74 r">process</span>, <span class="r75 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">ProcessIsNotTerminated</span>, <span class="s">&quot;ProcessNotTerminated&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                }
            }
 
            <b>if</b> (<a href="#fd1afd2d72677bdb" class="i field">_numberOfProcessesToWaitFor</a> &gt; 0)
            {
                <b>if</b> (<a href="#8ccb5f4850a9c87a" class="i field">_timeOutSpecified</a>)
                {
                    <a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a>.<span class="i">WaitOne</span>(<a href="#207141284d0427fe" class="i field">_timeout</a> * 1000);
                }
                <b>else</b>
                {
                    <a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a>.<span class="i">WaitOne</span>();
                }
            }
 
            <b>foreach</b> (<span class="i">Process</span> <span id="r76 rd" class="r76 r">process</span> <b>in</b> <a href="#0c64f48dcc6304db" class="i field">_processList</a>)
            {
                <b>try</b>
                {
                    <b>if</b> (!<span class="r76 r">process</span>.<span class="i">HasExited</span>)
                    {
                        <b>string</b> <span id="r77 rd" class="r77 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">ProcessNotTerminated</span>, <b>new</b> <b>object</b>[] { <span class="r76 r">process</span>.<span class="i">ProcessName</span>, <span class="r76 r">process</span>.<span class="i">Id</span> });
                        <span class="i">ErrorRecord</span> <span id="r78 rd" class="r78 r">errorRecord</span> = <b>new</b>(<b>new</b> <span class="i">TimeoutException</span>(<span class="r77 r">message</span>), <span class="s">&quot;ProcessNotTerminated&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>, <span class="r76 r">process</span>);
                        <span class="i">WriteError</span>(<span class="r78 r">errorRecord</span>);
                    }
                }
                <b>catch</b> (<span class="i">Win32Exception</span> <span id="r79 rd" class="r79 r">exception</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(<span class="r76 r">process</span>, <span class="r79 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">ProcessIsNotTerminated</span>, <span class="s">&quot;ProcessNotTerminated&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> StopProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="b012c61128de5e22" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">StopProcessing</a>()
        {
            <b>if</b> (<a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a> != <b>null</b>)
            {
                <a href="#bc6b9d53e68109f0" class="i field">_waitHandle</a>.<span class="i">Set</span>();
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> WaitProcessCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> StopProcessCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the stop-process command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Processes will be sorted before being stopped.  PM confirms</span>
    <span class="c">///</span><span class="c"> that this should be fine.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Stop</span>, <span class="s">&quot;Process&quot;</span>,
        <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Id&quot;</span>,
        <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097058&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">Process</span>))]
    <b>public sealed class</b> <a id="eed3b623d1ab6e40" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="bde0db09be033d4e">StopProcessCommand</span></a> : <a href="#a4902c4cc3ff7918" class="t t">ProcessBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Has the list of process names on which to this command will work.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">ParameterSetName</span> = <span class="s">&quot;Name&quot;</span>,
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ProcessName&quot;</span>)]
        <b>public string</b>[] <a id="0843534259087210" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3d4a4018e38c404e" class="i field">processNames</a>;
            }
 
            <b>set</b>
            {
                <a href="#3d4a4018e38c404e" class="i field">processNames</a> = <b>value</b>;
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#7d51efabc3222610" class="i field">ByName</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets/sets an array of process IDs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
           <span class="i">Position</span> = 0,
           <span class="i">ParameterSetName</span> = <span class="s">&quot;Id&quot;</span>,
           <span class="i">Mandatory</span> = <b>true</b>,
           <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        <b>public int</b>[] <a id="cd64c4076a26e797" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Id</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#cbd372973d7e4bdd" class="i field">processIds</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#be7660dfe6c09a44" class="i field">ById</a>;
                <a href="#cbd372973d7e4bdd" class="i field">processIds</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets/sets an array of objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">Position</span> = 0,
            <span class="i">ParameterSetName</span> = <span class="s">&quot;InputObject&quot;</span>,
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">ValueFromPipeline</span> = <b>true</b>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public</b> <b>new</b> <span class="i">Process</span>[] <a id="034f437f3bac4d94" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">InputObject</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a4902c4cc3ff7918" class="k">base</a>.<a href="#b005c6d00ae4b43e" class="i property">InputObject</a>;
            }
 
            <b>set</b>
            {
                <a href="#a4902c4cc3ff7918" class="k">base</a>.<a href="#b005c6d00ae4b43e" class="i property">InputObject</a> = <b>value</b>;
            }
        }
 
        <b>private bool</b> <a id="a53952f6f9f80d76" href="../../R/a53952f6f9f80d76.html" target="n" data-glyph="46,1" class="i field">_passThru</a>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The updated process object should be passed down the pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="8440cba8b24d7ab5" href="../../R/8440cba8b24d7ab5.html" target="n" data-glyph="102,1" class="i property">PassThru</a>
        {
            <b>get</b> { <b>return</b> <a href="#a53952f6f9f80d76" class="i field">_passThru</a>; }
 
            <b>set</b> { <a href="#a53952f6f9f80d76" class="i field">_passThru</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies whether to force a process to kill</span>
        <span class="c">///</span><span class="c"> even if it has dependent services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="060dc14bbb8bea5d" href="../../R/060dc14bbb8bea5d.html" target="n" data-glyph="102,1" class="i property">Force</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Kill the processes.</span>
        <span class="c">///</span><span class="c"> It is a non-terminating error if the Process.Kill() operation fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="96b205843ffcc9ec" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>if</b> (<a href="#9f4c02d347a14d42" class="i field">myMode</a> == <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#7ac2190f70a92225" class="i field">All</a> || (<a href="#9f4c02d347a14d42" class="i field">myMode</a> == <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#7d51efabc3222610" class="i field">ByName</a> &amp;&amp; <a href="#3d4a4018e38c404e" class="i field">processNames</a> == <b>null</b>))
            {
                <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;trying to kill all processes&quot;</span>);
                <b>throw</b> <span class="i">PSTraceSource</span>.<span class="i">NewInvalidOperationException</span>();
            }
 
            <b>foreach</b> (<span class="i">Process</span> <span id="r80 rd" class="r80 r">process</span> <b>in</b> <a href="#2cf443ea19da6543" class="i method">MatchingProcesses</a>())
            {
                <span class="c">// confirm the operation first</span>
                <span class="c">// this is always false if WhatIf is set</span>
                <span class="c">// 2005-06-21 Moved this ahead of the hasExited check</span>
                <b>string</b> <span id="r81 rd" class="r81 r">targetString</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                            <span class="i">ProcessResources</span>.<span class="i">ProcessNameForConfirmation</span>,
                            <a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r80 r">process</span>),
                            <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r80 r">process</span>));
 
                <b>if</b> (!<span class="i">ShouldProcess</span>(<span class="r81 r">targetString</span>)) { <b>continue</b>; }
 
                <b>try</b>
                {
                    <span class="c">// Many properties including Name are not available if the process has exited.</span>
                    <span class="c">// If this is the case, we skip the process. If the process is from a remote</span>
                    <span class="c">// machine, then we generate a non-terminating error because .NET doesn&#39;t support</span>
                    <span class="c">// terminate a remote process.</span>
                    <b>if</b> (<span class="r80 r">process</span>.<span class="i">HasExited</span>)
                    {
                        <b>if</b> (<a href="#8440cba8b24d7ab5" class="i property">PassThru</a>)
                            <span class="i">WriteObject</span>(<span class="r80 r">process</span>);
                        <b>continue</b>;
                    }
                }
                <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r82 rd" class="r82 r">ex</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r80 r">process</span>, <span class="r82 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotStopProcess</span>,
                        <span class="s">&quot;CouldNotStopProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
                    <b>continue</b>;
                }
                <b>catch</b> (<span class="i">Win32Exception</span> <span id="r83 rd" class="r83 r">ex</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r80 r">process</span>, <span class="r83 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotStopProcess</span>,
                        <span class="s">&quot;CouldNotStopProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                    <b>continue</b>;
                }
 
                <b>try</b>
                {
                    <b>if</b> (<span class="i">Environment</span>.<span class="i">ProcessId</span> == <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r80 r">process</span>))
                    {
                        <a href="#4d932af8a675e489" class="i field">_shouldKillCurrentProcess</a> = <b>true</b>;
                        <b>continue</b>;
                    }
 
                    <b>if</b> (<span class="i">Platform</span>.<span class="i">IsWindows</span> &amp;&amp; !<a href="#060dc14bbb8bea5d" class="i property">Force</a>)
                    {
                        <b>if</b> (!<a href="#faea46b0859d12e1" class="i method">IsProcessOwnedByCurrentUser</a>(<span class="r80 r">process</span>))
                        {
                            <b>string</b> <span id="r84 rd" class="r84 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                                        <span class="i">ProcessResources</span>.<span class="i">ConfirmStopProcess</span>,
                                        <a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r80 r">process</span>),
                                        <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r80 r">process</span>));
 
                            <span class="c">// caption: null = default caption</span>
                            <b>if</b> (!<span class="i">ShouldContinue</span>(<span class="r84 r">message</span>, <b>null</b>, <b>ref</b> <a href="#b528fe648a16e2fe" class="i field">_yesToAll</a>, <b>ref</b> <a href="#da28bb40b953d24c" class="i field">_noToAll</a>))
                                <b>continue</b>;
                        }
                    }
 
                    <span class="c">// If the process is svchost stop all the dependent services before killing process</span>
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r80 r">process</span>), <span class="s">&quot;SVCHOST&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <a href="#e7fd368408d9255d" class="i method">StopDependentService</a>(<span class="r80 r">process</span>);
                    }
 
                    <b>if</b> (!<span class="r80 r">process</span>.<span class="i">HasExited</span>)
                    {
                        <span class="r80 r">process</span>.<span class="i">Kill</span>();
                    }
                }
                <b>catch</b> (<span class="i">Win32Exception</span> <span id="r85 rd" class="r85 r">exception</span>)
                {
                    <b>if</b> (!<a href="#0d9b52cf10c5a33e" class="i method">TryHasExited</a>(<span class="r80 r">process</span>))
                    {
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r80 r">process</span>, <span class="r85 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotStopProcess</span>,
                            <span class="s">&quot;CouldNotStopProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                        <b>continue</b>;
                    }
                }
                <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r86 rd" class="r86 r">exception</span>)
                {
                    <b>if</b> (!<a href="#0d9b52cf10c5a33e" class="i method">TryHasExited</a>(<span class="r80 r">process</span>))
                    {
                        <span class="i">WriteNonTerminatingError</span>(
                            <span class="r80 r">process</span>, <span class="r86 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotStopProcess</span>,
                            <span class="s">&quot;CouldNotStopProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                        <b>continue</b>;
                    }
                }
 
                <b>if</b> (<a href="#8440cba8b24d7ab5" class="i property">PassThru</a>)
                    <span class="i">WriteObject</span>(<span class="r80 r">process</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Kill the current process here.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="483758c9c924e675" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">EndProcessing</a>()
        {
            <b>if</b> (<a href="#4d932af8a675e489" class="i field">_shouldKillCurrentProcess</a>)
            {
                <span class="i">StopProcess</span>(<span class="i">Process</span>.<span class="i">GetCurrentProcess</span>());
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Should the current powershell process to be killed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="4d932af8a675e489" href="../../R/4d932af8a675e489.html" target="n" data-glyph="46,1" class="i field">_shouldKillCurrentProcess</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Boolean variables to display the warning using ShouldContinue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="b528fe648a16e2fe" href="../../R/b528fe648a16e2fe.html" target="n" data-glyph="46,1" class="i field">_yesToAll</a>, <a id="da28bb40b953d24c" href="../../R/da28bb40b953d24c.html" target="n" data-glyph="46,1" class="i field">_noToAll</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Current windows user name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="8cb8177485c6afae" href="../../R/8cb8177485c6afae.html" target="n" data-glyph="46,1" class="i field">_currentUserName</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the owner of the process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Returns the owner.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="faea46b0859d12e1" href="../../R/faea46b0859d12e1.html" target="n" data-glyph="76,1" class="i method">IsProcessOwnedByCurrentUser</a>(<span class="i">Process</span> <span id="r87 rd" class="r87 r">process</span>)
        {
            <b>const uint</b> <span id="r88 rd" class="r88 r">TOKEN_QUERY</span> = 0x0008;
            <span class="i">IntPtr</span> <span id="r89 rd" class="r89 r">ph</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <b>try</b>
            {
                <b>if</b> (<span class="i">Win32Native</span>.<span class="i">OpenProcessToken</span>(<span class="r87 r">process</span>.<span class="i">Handle</span>, <span class="r88 r">TOKEN_QUERY</span>, <b>out</b> <span class="r89 r">ph</span>))
                {
                    <b>if</b> (<a href="#8cb8177485c6afae" class="i field">_currentUserName</a> == <b>null</b>)
                    {
                        <b>using</b> (<b>var</b> <span id="r90 rd" class="r90 r">currentUser</span> = <span class="i">WindowsIdentity</span>.<span class="i">GetCurrent</span>())
                        {
                            <a href="#8cb8177485c6afae" class="i field">_currentUserName</a> = <span class="r90 r">currentUser</span>.<span class="i">Name</span>;
                        }
                    }
 
                    <b>using</b> (<b>var</b> <span id="r91 rd" class="r91 r">processUser</span> = <b>new</b> <span class="i">WindowsIdentity</span>(<span class="r89 r">ph</span>))
                    {
                        <b>return</b> <b>string</b>.<span class="i">Equals</span>(<span class="r91 r">processUser</span>.<span class="i">Name</span>, <a href="#8cb8177485c6afae" class="i field">_currentUserName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
                    }
                }
            }
            <b>catch</b> (<span class="i">IdentityNotMappedException</span>)
            {
                <span class="c">// Catching IdentityMappedException</span>
                <span class="c">// Need not throw error.</span>
            }
            <b>catch</b> (<span class="i">ArgumentException</span>)
            {
                <span class="c">// Catching ArgumentException. In Win2k3 Token is zero</span>
                <span class="c">// Need not throw error.</span>
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r89 r">ph</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>) { <span class="i">Win32Native</span>.<span class="i">CloseHandle</span>(<span class="r89 r">ph</span>); }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the service that depends on the process and its child services.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="e7fd368408d9255d" href="../../R/e7fd368408d9255d.html" target="n" data-glyph="76,1" class="i method">StopDependentService</a>(<span class="i">Process</span> <span id="r92 rd" class="r92 r">process</span>)
        {
            <b>string</b> <span id="r93 rd" class="r93 r">queryString</span> = <span class="s">&quot;Select * From Win32_Service Where ProcessId=&quot;</span> + <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r92 r">process</span>) + <span class="s">&quot; And State !=&#39;Stopped&#39;&quot;</span>;
 
            <b>try</b>
            {
                <b>using</b> (<span class="i">CimSession</span> <span id="r94 rd" class="r94 r">cimSession</span> = <span class="i">CimSession</span>.<span class="i">Create</span>(<b>null</b>))
                {
                    <span class="i">IEnumerable</span>&lt;<span class="i">CimInstance</span>&gt; <span id="r95 rd" class="r95 r">serviceList</span> =
                        <span class="r94 r">cimSession</span>.<span class="i">QueryInstances</span>(<span class="s">&quot;root/cimv2&quot;</span>, <span class="s">&quot;WQL&quot;</span>, <span class="r93 r">queryString</span>);
                    <b>foreach</b> (<span class="i">CimInstance</span> <span id="r96 rd" class="r96 r">oService</span> <b>in</b> <span class="r95 r">serviceList</span>)
                    {
                        <b>string</b> <span id="r97 rd" class="r97 r">serviceName</span> = <span class="r96 r">oService</span>.<span class="i">CimInstanceProperties</span>[<span class="s">&quot;Name&quot;</span>].<span class="i">Value</span>.<span class="i">ToString</span>();
                        <b>using</b> (<b>var</b> <span id="r98 rd" class="r98 r">service</span> = <b>new</b> <span class="i">System</span>.<span class="i">ServiceProcess</span>.<span class="i">ServiceController</span>(<span class="r97 r">serviceName</span>))
                        {
                            <b>try</b>
                            {
                                <span class="r98 r">service</span>.<span class="i">Stop</span>();
                                <span class="c">// Wait 2 sec for the status to become &#39;Stopped&#39;</span>
                                <span class="r98 r">service</span>.<span class="i">WaitForStatus</span>(<span class="i">System</span>.<span class="i">ServiceProcess</span>.<span class="i">ServiceControllerStatus</span>.<span class="i">Stopped</span>, <b>new</b> <span class="i">TimeSpan</span>(0, 0, 2));
                            }
                            <b>catch</b> (<span class="i">Win32Exception</span>) { }
                            <b>catch</b> (<span class="i">InvalidOperationException</span>) { }
                            <b>catch</b> (<span class="i">System</span>.<span class="i">ServiceProcess</span>.<span class="i">TimeoutException</span>) { }
                        }
                    }
                }
            }
            <b>catch</b> (<span class="i">CimException</span> <span id="r99 rd" class="r99 r">ex</span>)
            {
                <b>var</b> <span id="r100 rd" class="r100 r">errorRecord</span> = <b>new</b> <span class="i">ErrorRecord</span>(<span class="r99 r">ex</span>, <span class="s">&quot;GetCimException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                <span class="i">WriteError</span>(<span class="r100 r">errorRecord</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stops the given process throws non terminating error if can&#39;t.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Process to be stopped.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if process stopped successfully else false.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private void</b> <a id="41aeeaebec88aa35" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StopProcess</a>(<span class="i">Process</span> <span id="r101 rd" class="r101 r">process</span>)
        {
            <span class="i">Exception</span> <span id="r102 rd" class="r102 r">exception</span> = <b>null</b>;
            <b>try</b>
            {
                <b>if</b> (!<span class="r101 r">process</span>.<span class="i">HasExited</span>)
                {
                    <span class="r101 r">process</span>.<span class="i">Kill</span>();
                }
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r103 rd" class="r103 r">e</span>)
            {
                <span class="r102 r">exception</span> = <span class="r103 r">e</span>;
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r104 rd" class="r104 r">e</span>)
            {
                <span class="r102 r">exception</span> = <span class="r104 r">e</span>;
            }
 
            <b>if</b> (<span class="r102 r">exception</span> != <b>null</b>)
            {
                <b>if</b> (!<a href="#0d9b52cf10c5a33e" class="i method">TryHasExited</a>(<span class="r101 r">process</span>))
                {
                    <span class="c">// This process could not be stopped,</span>
                    <span class="c">// so write a non-terminating error.</span>
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r101 r">process</span>, <span class="r102 r">exception</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotStopProcess</span>,
                        <span class="s">&quot;CouldNotStopProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> StopProcessCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> DebugProcessCommand
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the Debug-process command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsDiagnostic</span>.<span class="i">Debug</span>, <span class="s">&quot;Process&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Name&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096809&quot;</span>)]
    <b>public sealed class</b> <a id="9fe46c25bfbe1f91" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="492ef10c61093d50">DebugProcessCommand</span></a> : <a href="#a4902c4cc3ff7918" class="t t">ProcessBaseCommand</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies the process IDs of the processes to be waited on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">ParameterSetName</span> = <span class="s">&quot;Id&quot;</span>,
            <span class="i">Position</span> = 0,
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;PID&quot;</span>, <span class="s">&quot;ProcessId&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public int</b>[] <a id="ec121a120b97b28a" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Id</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#cbd372973d7e4bdd" class="i field">processIds</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#be7660dfe6c09a44" class="i field">ById</a>;
                <a href="#cbd372973d7e4bdd" class="i field">processIds</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the processes to wait on for termination.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(
            <span class="i">ParameterSetName</span> = <span class="s">&quot;Name&quot;</span>,
            <span class="i">Position</span> = 0,
            <span class="i">Mandatory</span> = <b>true</b>,
            <span class="i">ValueFromPipelineByPropertyName</span> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;ProcessName&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="d6068e48940f7b21" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3d4a4018e38c404e" class="i field">processNames</a>;
            }
 
            <b>set</b>
            {
                <a href="#9f4c02d347a14d42" class="i field">myMode</a> = <a href="#d0a4a13cf5a86313" class="t t">MatchMode</a>.<a href="#7d51efabc3222610" class="i field">ByName</a>;
                <a href="#3d4a4018e38c404e" class="i field">processNames</a> = <b>value</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the list of process and attach the debugger to the processes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="0fe9395e26224432" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>foreach</b> (<span class="i">Process</span> <span id="r105 rd" class="r105 r">process</span> <b>in</b> <a href="#2cf443ea19da6543" class="i method">MatchingProcesses</a>())
            {
                <b>string</b> <span id="r106 rd" class="r106 r">targetMessage</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(
                            <span class="i">ProcessResources</span>.<span class="i">ProcessNameForConfirmation</span>,
                            <a href="#596dc640083f8b3e" class="i method">SafeGetProcessName</a>(<span class="r105 r">process</span>),
                            <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r105 r">process</span>));
 
                <b>if</b> (!<span class="i">ShouldProcess</span>(<span class="r106 r">targetMessage</span>)) { <b>continue</b>; }
 
                <span class="c">// Sometimes Idle process has processid zero,so handle that because we cannot attach debugger to it.</span>
                <b>if</b> (<span class="r105 r">process</span>.<span class="i">Id</span> == 0)
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r105 r">process</span>, <b>null</b>, <span class="i">ProcessResources</span>.<span class="i">NoDebuggerFound</span>,
                        <span class="s">&quot;NoDebuggerFound&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">ObjectNotFound</span>);
                    <b>continue</b>;
                }
 
                <b>try</b>
                {
                    <span class="c">// If the process has exited, we skip it. If the process is from a remote</span>
                    <span class="c">// machine, then we generate a non-terminating error.</span>
                    <b>if</b> (<span class="r105 r">process</span>.<span class="i">HasExited</span>) { <b>continue</b>; }
                }
                <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r107 rd" class="r107 r">ex</span>)
                {
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r105 r">process</span>, <span class="r107 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotDebugProcess</span>,
                        <span class="s">&quot;CouldNotDebugProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
                    <b>continue</b>;
                }
                <b>catch</b> (<span class="i">Win32Exception</span> <span id="r108 rd" class="r108 r">ex</span>)
                {
                    <span class="c">// This process could not be stopped, so write a non-terminating error.</span>
                    <span class="i">WriteNonTerminatingError</span>(
                        <span class="r105 r">process</span>, <span class="r108 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotDebugProcess</span>,
                        <span class="s">&quot;CouldNotDebugProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">CloseError</span>);
                    <b>continue</b>;
                }
 
                <a href="#10360256369619a6" class="i method">AttachDebuggerToProcess</a>(<span class="r105 r">process</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Attach debugger to the process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="10360256369619a6" href="../../R/10360256369619a6.html" target="n" data-glyph="76,1" class="i method">AttachDebuggerToProcess</a>(<span class="i">Process</span> <span id="r109 rd" class="r109 r">process</span>)
        {
            <b>string</b> <span id="r110 rd" class="r110 r">searchQuery</span> = <span class="s">&quot;Select * From Win32_Process Where ProcessId=&quot;</span> + <a href="#55e99fe16cff86a8" class="i method">SafeGetProcessId</a>(<span class="r109 r">process</span>);
            <b>using</b> (<span class="i">CimSession</span> <span id="r111 rd" class="r111 r">cimSession</span> = <span class="i">CimSession</span>.<span class="i">Create</span>(<b>null</b>))
            {
                <span class="i">IEnumerable</span>&lt;<span class="i">CimInstance</span>&gt; <span id="r112 rd" class="r112 r">processCollection</span> =
                    <span class="r111 r">cimSession</span>.<span class="i">QueryInstances</span>(<span class="s">&quot;root/cimv2&quot;</span>, <span class="s">&quot;WQL&quot;</span>, <span class="r110 r">searchQuery</span>);
                <b>foreach</b> (<span class="i">CimInstance</span> <span id="r113 rd" class="r113 r">processInstance</span> <b>in</b> <span class="r112 r">processCollection</span>)
                {
                    <b>try</b>
                    {
                        <span class="c">// Call the AttachDebugger method</span>
                        <span class="i">CimMethodResult</span> <span id="r114 rd" class="r114 r">result</span> = <span class="r111 r">cimSession</span>.<span class="i">InvokeMethod</span>(<span class="r113 r">processInstance</span>, <span class="s">&quot;AttachDebugger&quot;</span>, <b>null</b>);
                        <b>int</b> <span id="r115 rd" class="r115 r">returnCode</span> = <span class="i">Convert</span>.<span class="i">ToInt32</span>(<span class="r114 r">result</span>.<span class="i">ReturnValue</span>.<span class="i">Value</span>, <span class="i">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
                        <b>if</b> (<span class="r115 r">returnCode</span> != 0)
                        {
                            <b>var</b> <span id="r116 rd" class="r116 r">ex</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<a href="#e976f4ced3cdc3df" class="i method">MapReturnCodeToErrorMessage</a>(<span class="r115 r">returnCode</span>));
                            <span class="i">WriteNonTerminatingError</span>(
                                <span class="r109 r">process</span>, <span class="r116 r">ex</span>, <span class="i">ProcessResources</span>.<span class="i">CouldNotDebugProcess</span>,
                                <span class="s">&quot;CouldNotDebugProcess&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>);
                        }
                    }
                    <b>catch</b> (<span class="i">CimException</span> <span id="r117 rd" class="r117 r">e</span>)
                    {
                        <b>string</b> <span id="r118 rd" class="r118 r">message</span> = <span class="r117 r">e</span>.<span class="i">Message</span>;
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r118 r">message</span>)) { <span class="r118 r">message</span> = <span class="r118 r">message</span>.<span class="i">Trim</span>(); }
 
                        <b>var</b> <span id="r119 rd" class="r119 r">errorRecord</span> = <b>new</b> <span class="i">ErrorRecord</span>(
                                <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">DebuggerError</span>, <span class="r118 r">message</span>)),
                                <span class="s">&quot;GetCimException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                        <span class="i">WriteError</span>(<span class="r119 r">errorRecord</span>);
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Map the return code from &#39;AttachDebugger&#39; to error message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="e976f4ced3cdc3df" href="../../R/e976f4ced3cdc3df.html" target="n" data-glyph="76,1" class="i method">MapReturnCodeToErrorMessage</a>(<b>int</b> <span id="r120 rd" class="r120 r">returnCode</span>)
        {
            <b>string</b> <span id="r121 rd" class="r121 r">errorMessage</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>switch</b> (<span class="r120 r">returnCode</span>)
            {
                <b>case</b> 2: <span class="r121 r">errorMessage</span> = <span class="i">ProcessResources</span>.<span class="i">AttachDebuggerReturnCode2</span>; <b>break</b>;
                <b>case</b> 3: <span class="r121 r">errorMessage</span> = <span class="i">ProcessResources</span>.<span class="i">AttachDebuggerReturnCode3</span>; <b>break</b>;
                <b>case</b> 8: <span class="r121 r">errorMessage</span> = <span class="i">ProcessResources</span>.<span class="i">AttachDebuggerReturnCode8</span>; <b>break</b>;
                <b>case</b> 9: <span class="r121 r">errorMessage</span> = <span class="i">ProcessResources</span>.<span class="i">AttachDebuggerReturnCode9</span>; <b>break</b>;
                <b>case</b> 21: <span class="r121 r">errorMessage</span> = <span class="i">ProcessResources</span>.<span class="i">AttachDebuggerReturnCode21</span>; <b>break</b>;
                <b>default</b>: <span class="i">Diagnostics</span>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;Unreachable code.&quot;</span>); <b>break</b>;
            }
 
            <b>return</b> <span class="r121 r">errorMessage</span>;
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> DebugProcessCommand
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> StartProcessCommand
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements the Start-process command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<span class="i">VerbsLifecycle</span>.<span class="i">Start</span>, <span class="s">&quot;Process&quot;</span>, <span class="i">DefaultParameterSetName</span> = <span class="s">&quot;Default&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2097141&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<span class="i">Process</span>))]
    <b>public sealed class</b> <a id="91784a85a27ce387" href="../../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="d396df5471957fb9">StartProcessCommand</span></a> : <span class="i">PSCmdlet</span>, <span class="i">IDisposable</span>
    {
        <b>private</b> <span class="i">ManualResetEvent</span> <a id="4393eab8d0f93fa3" href="../../R/4393eab8d0f93fa3.html" target="n" data-glyph="46,1" class="i field">_waithandle</a> = <b>null</b>;
        <b>private bool</b> <a id="04243f145321a55f" href="../../R/04243f145321a55f.html" target="n" data-glyph="46,1" class="i field">_isDefaultSetParameterSpecified</a> = <b>false</b>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Path/FileName of the process to start.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Mandatory</span> = <b>true</b>, <span class="i">Position</span> = 0)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;PSPath&quot;</span>, <span class="s">&quot;Path&quot;</span>)]
        <b>public string</b> <a id="7de7dde4c528bf3e" href="../../R/7de7dde4c528bf3e.html" target="n" data-glyph="102,1" class="i property">FilePath</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Arguments for the process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">Position</span> = 1)]
        [<span class="i">Alias</span>(<span class="s">&quot;Args&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public string</b>[] <a id="050dd9f35a9c1b4f" href="../../R/050dd9f35a9c1b4f.html" target="n" data-glyph="102,1" class="i property">ArgumentList</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Credentials for the process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;RunAs&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">Credential</span>]
        <b>public</b> <span class="i">PSCredential</span> <a id="8a4019483db8100e" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Credential</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#096fdec6952eac45" class="i field">_credential</a>;
            }
 
            <b>set</b>
            {
                <a href="#096fdec6952eac45" class="i field">_credential</a> = <b>value</b>;
                <a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <span class="i">PSCredential</span> <a id="096fdec6952eac45" href="../../R/096fdec6952eac45.html" target="n" data-glyph="46,1" class="i field">_credential</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Working directory of the process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="1c9fee30bf1adaaa" href="../../R/1c9fee30bf1adaaa.html" target="n" data-glyph="102,1" class="i property">WorkingDirectory</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load user profile from registry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;Lup&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="9055e8cb4eea888b" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">LoadUserProfile</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5804ad72aeb127d3" class="i field">_loaduserprofile</a>;
            }
 
            <b>set</b>
            {
                <a href="#5804ad72aeb127d3" class="i field">_loaduserprofile</a> = <b>value</b>;
                <a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <span class="i">SwitchParameter</span> <a id="5804ad72aeb127d3" href="../../R/5804ad72aeb127d3.html" target="n" data-glyph="46,1" class="i field">_loaduserprofile</a> = <span class="i">SwitchParameter</span>.<span class="i">Present</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Starts process in a new window.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;nnw&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="299f2b7b03ff1844" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">NoNewWindow</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#9de7ca3882d9a14b" class="i field">_nonewwindow</a>;
            }
 
            <b>set</b>
            {
                <a href="#9de7ca3882d9a14b" class="i field">_nonewwindow</a> = <b>value</b>;
                <a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <span class="i">SwitchParameter</span> <a id="9de7ca3882d9a14b" href="../../R/9de7ca3882d9a14b.html" target="n" data-glyph="46,1" class="i field">_nonewwindow</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PassThru parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="19058ad8471c125c" href="../../R/19058ad8471c125c.html" target="n" data-glyph="102,1" class="i property">PassThru</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Redirect error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;RSE&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="375d0d3b7c0d9f34" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">RedirectStandardError</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a>;
            }
 
            <b>set</b>
            {
                <a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a> = <b>value</b>;
                <a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private string</b> <a id="5970dc4033c0e4af" href="../../R/5970dc4033c0e4af.html" target="n" data-glyph="46,1" class="i field">_redirectstandarderror</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Redirect input.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;RSI&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="98ea27e6c2a85950" href="../../R/98ea27e6c2a85950.html" target="n" data-glyph="102,1" class="i property">RedirectStandardInput</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>;
            }
 
            <b>set</b>
            {
                <a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> = <b>value</b>;
                <a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private string</b> <a id="49a5d66e4b3449d6" href="../../R/49a5d66e4b3449d6.html" target="n" data-glyph="46,1" class="i field">_redirectstandardinput</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Redirect output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>)]
        [<span class="i">Alias</span>(<span class="s">&quot;RSO&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="7595e337d6b9bb6c" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">RedirectStandardOutput</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a>;
            }
 
            <b>set</b>
            {
                <a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a> = <b>value</b>;
                <a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private string</b> <a id="2410246d2da5bf0b" href="../../R/2410246d2da5bf0b.html" target="n" data-glyph="46,1" class="i field">_redirectstandardoutput</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verb.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The &#39;Verb&#39; parameter is only supported on Windows Desktop.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;UseShellExecute&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="a77053c2a303fb2f" href="../../R/a77053c2a303fb2f.html" target="n" data-glyph="102,1" class="i property">Verb</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Window style of the process window.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <span class="i">ProcessWindowStyle</span> <a id="95f4a49ae1b0dfef" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">WindowStyle</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ef1366d53f66e388" class="i field">_windowstyle</a>;
            }
 
            <b>set</b>
            {
                <a href="#ef1366d53f66e388" class="i field">_windowstyle</a> = <b>value</b>;
                <a href="#3c86031ca89f7eff" class="i field">_windowstyleSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <span class="i">ProcessWindowStyle</span> <a id="ef1366d53f66e388" href="../../R/ef1366d53f66e388.html" target="n" data-glyph="46,1" class="i field">_windowstyle</a> = <span class="i">ProcessWindowStyle</span>.<span class="i">Normal</span>;
        <b>private bool</b> <a id="3c86031ca89f7eff" href="../../R/3c86031ca89f7eff.html" target="n" data-glyph="46,1" class="i field">_windowstyleSpecified</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wait for the process to terminate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="4741dec18cafde75" href="../../R/4741dec18cafde75.html" target="n" data-glyph="102,1" class="i property">Wait</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default Environment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<span class="i">ParameterSetName</span> = <span class="s">&quot;Default&quot;</span>)]
        <b>public</b> <span class="i">SwitchParameter</span> <a id="27432bd90b6677b4" href="../../R/27432bd90b6677b4.html" target="n" data-glyph="102,1" class="i property">UseNewEnvironment</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#da3bb8ab07cad923" class="i field">_UseNewEnvironment</a>;
            }
 
            <b>set</b>
            {
                <a href="#da3bb8ab07cad923" class="i field">_UseNewEnvironment</a> = <b>value</b>;
                <a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private</b> <span class="i">SwitchParameter</span> <a id="da3bb8ab07cad923" href="../../R/da3bb8ab07cad923.html" target="n" data-glyph="46,1" class="i field">_UseNewEnvironment</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> BeginProcessing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="cceb93c4a86016e9" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <b>string</b> <span id="r122 rd" class="r122 r">message</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <span class="c">// -Verb and -WindowStyle are not supported on non-Windows platforms as well as Windows headless SKUs</span>
            <b>if</b> (<span class="i">Platform</span>.<span class="i">IsWindowsDesktop</span>)
            {
                <span class="c">// Parameters &#39;-NoNewWindow&#39; and &#39;-WindowStyle&#39; are both valid on full windows SKUs.</span>
                <b>if</b> (<a href="#9de7ca3882d9a14b" class="i field">_nonewwindow</a> &amp;&amp; <a href="#3c86031ca89f7eff" class="i field">_windowstyleSpecified</a>)
                {
                    <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">ContradictParametersSpecified</span>, <span class="s">&quot;-NoNewWindow&quot;</span>, <span class="s">&quot;-WindowStyle&quot;</span>);
                    <span class="i">ErrorRecord</span> <span id="r123 rd" class="r123 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r122 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                    <span class="i">WriteError</span>(<span class="r123 r">er</span>);
                    <b>return</b>;
                }
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#91784a85a27ce387" class="k">this</a>.<span class="i">ParameterSetName</span>.<span class="i">Equals</span>(<span class="s">&quot;UseShellExecute&quot;</span>))
                {
                    <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">ParameterNotSupportedOnPSEdition</span>, <span class="s">&quot;-Verb&quot;</span>, <span class="s">&quot;Start-Process&quot;</span>);
                }
                <b>else</b> <b>if</b> (<a href="#3c86031ca89f7eff" class="i field">_windowstyleSpecified</a>)
                {
                    <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">ParameterNotSupportedOnPSEdition</span>, <span class="s">&quot;-WindowStyle&quot;</span>, <span class="s">&quot;Start-Process&quot;</span>);
                }
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r122 r">message</span>))
                {
                    <span class="i">ErrorRecord</span> <span id="r124 rd" class="r124 r">er</span> = <b>new</b>(<b>new</b> <span class="i">NotSupportedException</span>(<span class="r122 r">message</span>), <span class="s">&quot;NotSupportedException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">NotImplemented</span>, <b>null</b>);
                    <span class="i">ThrowTerminatingError</span>(<span class="r124 r">er</span>);
                }
            }
 
            <span class="i">ProcessStartInfo</span> <span id="r125 rd" class="r125 r">startInfo</span> = <b>new</b>();
            <span class="c">// Use ShellExecute by default if we are running on full windows SKUs</span>
            <span class="r125 r">startInfo</span>.<span class="i">UseShellExecute</span> = <span class="i">Platform</span>.<span class="i">IsWindowsDesktop</span>;
 
            <span class="c">// Path = Mandatory parameter -&gt; Will not be empty.</span>
            <b>try</b>
            {
                <span class="i">CommandInfo</span> <span id="r126 rd" class="r126 r">cmdinfo</span> = <span class="i">CommandDiscovery</span>.<span class="i">LookupCommandInfo</span>(
                    <a href="#7de7dde4c528bf3e" class="i property">FilePath</a>, <span class="i">CommandTypes</span>.<span class="i">Application</span> | <span class="i">CommandTypes</span>.<span class="i">ExternalScript</span>,
                    <span class="i">SearchResolutionOptions</span>.<span class="i">None</span>, <span class="i">CommandOrigin</span>.<span class="i">Internal</span>, <a href="#91784a85a27ce387" class="k">this</a>.<span class="i">Context</span>);
 
                <span class="r125 r">startInfo</span>.<span class="i">FileName</span> = <span class="r126 r">cmdinfo</span>.<span class="i">Definition</span>;
            }
            <b>catch</b> (<span class="i">CommandNotFoundException</span>)
            {
                <span class="r125 r">startInfo</span>.<span class="i">FileName</span> = <a href="#7de7dde4c528bf3e" class="i property">FilePath</a>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">                // Arguments are passed incorrectly to the executable used for ShellExecute and not to filename https://github.com/dotnet/corefx/issues/30718
                // so don&#39;t use ShellExecute if arguments are specified
 
                // Linux relies on `xdg-open` and macOS relies on `open` which behave differently than Windows ShellExecute when running console commands
                // as a new console will be opened.  So to avoid that, we only use ShellExecute on non-Windows if the filename is not an actual command (like a URI)
                startInfo.UseShellExecute = (ArgumentList == null);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
 
            <b>if</b> (<a href="#050dd9f35a9c1b4f" class="i property">ArgumentList</a> != <b>null</b>)
            {
                <span class="r125 r">startInfo</span>.<span class="i">Arguments</span> = <b>string</b>.<span class="i">Join</span>(<span class="s">&#39; &#39;</span>, <a href="#050dd9f35a9c1b4f" class="i property">ArgumentList</a>);
            }
 
            <b>if</b> (<a href="#1c9fee30bf1adaaa" class="i property">WorkingDirectory</a> != <b>null</b>)
            {
                <span class="c">// WorkingDirectory -&gt; Not Exist -&gt; Throw Error</span>
                <a href="#1c9fee30bf1adaaa" class="i property">WorkingDirectory</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#1c9fee30bf1adaaa" class="i property">WorkingDirectory</a>);
                <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<a href="#1c9fee30bf1adaaa" class="i property">WorkingDirectory</a>))
                {
                    <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidInput</span>, <span class="s">&quot;WorkingDirectory&quot;</span>);
                    <span class="i">ErrorRecord</span> <span id="r127 rd" class="r127 r">er</span> = <b>new</b>(<b>new</b> <span class="i">DirectoryNotFoundException</span>(<span class="r122 r">message</span>), <span class="s">&quot;DirectoryNotFoundException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                    <span class="i">WriteError</span>(<span class="r127 r">er</span>);
                    <b>return</b>;
                }
 
                <span class="r125 r">startInfo</span>.<span class="i">WorkingDirectory</span> = <a href="#1c9fee30bf1adaaa" class="i property">WorkingDirectory</a>;
            }
            <b>else</b>
            {
                <span class="c">// Working Directory not specified -&gt; Assign Current Path.</span>
                <span class="r125 r">startInfo</span>.<span class="i">WorkingDirectory</span> = <span class="i">PathUtils</span>.<span class="i">ResolveFilePath</span>(<a href="#91784a85a27ce387" class="k">this</a>.<span class="i">SessionState</span>.<span class="i">Path</span>.<span class="i">CurrentFileSystemLocation</span>.<span class="i">Path</span>, <a href="#91784a85a27ce387" class="k">this</a>, <span class="i">isLiteralPath</span>: <b>true</b>);
            }
 
            <b>if</b> (<a href="#91784a85a27ce387" class="k">this</a>.<span class="i">ParameterSetName</span>.<span class="i">Equals</span>(<span class="s">&quot;Default&quot;</span>))
            {
                <b>if</b> (<a href="#04243f145321a55f" class="i field">_isDefaultSetParameterSpecified</a>)
                {
                    <span class="r125 r">startInfo</span>.<span class="i">UseShellExecute</span> = <b>false</b>;
                }
 
                <b>if</b> (<a href="#da3bb8ab07cad923" class="i field">_UseNewEnvironment</a>)
                {
                    <span class="r125 r">startInfo</span>.<span class="i">EnvironmentVariables</span>.<span class="i">Clear</span>();
                    <span class="i">LoadEnvironmentVariable</span>(<span class="r125 r">startInfo</span>, <span class="i">Environment</span>.<span class="i">GetEnvironmentVariables</span>(<span class="i">EnvironmentVariableTarget</span>.<span class="i">Machine</span>));
                    <span class="i">LoadEnvironmentVariable</span>(<span class="r125 r">startInfo</span>, <span class="i">Environment</span>.<span class="i">GetEnvironmentVariables</span>(<span class="i">EnvironmentVariableTarget</span>.<span class="i">User</span>));
                }
 
                <span class="r125 r">startInfo</span>.<span class="i">WindowStyle</span> = <a href="#ef1366d53f66e388" class="i field">_windowstyle</a>;
 
                <b>if</b> (<a href="#9de7ca3882d9a14b" class="i field">_nonewwindow</a>)
                {
                    <span class="r125 r">startInfo</span>.<span class="i">CreateNoWindow</span> = <a href="#9de7ca3882d9a14b" class="i field">_nonewwindow</a>;
                }
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                <span class="r125 r">startInfo</span>.<span class="i">LoadUserProfile</span> = <a href="#5804ad72aeb127d3" class="i field">_loaduserprofile</a>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <b>if</b> (<a href="#096fdec6952eac45" class="i field">_credential</a> != <b>null</b>)
                {
                    <span class="i">NetworkCredential</span> <span id="r128 rd" class="r128 r">nwcredential</span> = <a href="#096fdec6952eac45" class="i field">_credential</a>.<span class="i">GetNetworkCredential</span>();
                    <span class="r125 r">startInfo</span>.<span class="i">UserName</span> = <span class="r128 r">nwcredential</span>.<span class="i">UserName</span>;
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r128 r">nwcredential</span>.<span class="i">Domain</span>))
                    {
                        <span class="r125 r">startInfo</span>.<span class="i">Domain</span> = <span class="s">&quot;.&quot;</span>;
                    }
                    <b>else</b>
                    {
                        <span class="r125 r">startInfo</span>.<span class="i">Domain</span> = <span class="r128 r">nwcredential</span>.<span class="i">Domain</span>;
                    }
 
                    <span class="r125 r">startInfo</span>.<span class="i">Password</span> = <a href="#096fdec6952eac45" class="i field">_credential</a>.<span class="i">Password</span>;
                }
 
                <span class="c">// RedirectionInput File Check -&gt; Not Exist -&gt; Throw Error</span>
                <b>if</b> (<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> != <b>null</b>)
                {
                    <a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>);
                    <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>))
                    {
                        <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidInput</span>, <span class="s">&quot;RedirectStandardInput &#39;&quot;</span> + <a href="#91784a85a27ce387" class="k">this</a>.<a href="#98ea27e6c2a85950" class="i property">RedirectStandardInput</a> + <span class="s">&quot;&#39;&quot;</span>);
                        <span class="i">ErrorRecord</span> <span id="r129 rd" class="r129 r">er</span> = <b>new</b>(<b>new</b> <span class="i">FileNotFoundException</span>(<span class="r122 r">message</span>), <span class="s">&quot;FileNotFoundException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                        <span class="i">WriteError</span>(<span class="r129 r">er</span>);
                        <b>return</b>;
                    }
                }
 
                <span class="c">// RedirectionInput == RedirectionOutput -&gt; Throw Error</span>
                <b>if</b> (<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> != <b>null</b> &amp;&amp; <a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a> != <b>null</b>)
                {
                    <a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>);
                    <a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a>);
                    <b>if</b> (<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>.<span class="i">Equals</span>(<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">DuplicateEntry</span>, <span class="s">&quot;RedirectStandardInput&quot;</span>, <span class="s">&quot;RedirectStandardOutput&quot;</span>);
                        <span class="i">ErrorRecord</span> <span id="r130 rd" class="r130 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r122 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                        <span class="i">WriteError</span>(<span class="r130 r">er</span>);
                        <b>return</b>;
                    }
                }
 
                <span class="c">// RedirectionInput == RedirectionError -&gt; Throw Error</span>
                <b>if</b> (<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> != <b>null</b> &amp;&amp; <a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a> != <b>null</b>)
                {
                    <a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>);
                    <a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a>);
                    <b>if</b> (<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>.<span class="i">Equals</span>(<a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">DuplicateEntry</span>, <span class="s">&quot;RedirectStandardInput&quot;</span>, <span class="s">&quot;RedirectStandardError&quot;</span>);
                        <span class="i">ErrorRecord</span> <span id="r131 rd" class="r131 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r122 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                        <span class="i">WriteError</span>(<span class="r131 r">er</span>);
                        <b>return</b>;
                    }
                }
 
                <span class="c">// RedirectionOutput == RedirectionError -&gt; Throw Error</span>
                <b>if</b> (<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a> != <b>null</b> &amp;&amp; <a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a> != <b>null</b>)
                {
                    <a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a>);
                    <a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a>);
                    <b>if</b> (<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a>.<span class="i">Equals</span>(<a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">DuplicateEntry</span>, <span class="s">&quot;RedirectStandardOutput&quot;</span>, <span class="s">&quot;RedirectStandardError&quot;</span>);
                        <span class="i">ErrorRecord</span> <span id="r132 rd" class="r132 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r122 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                        <span class="i">WriteError</span>(<span class="r132 r">er</span>);
                        <b>return</b>;
                    }
                }
            }
            <b>else</b> <b>if</b> (<span class="i">ParameterSetName</span>.<span class="i">Equals</span>(<span class="s">&quot;UseShellExecute&quot;</span>))
            {
                <b>if</b> (<a href="#a77053c2a303fb2f" class="i property">Verb</a> != <b>null</b>) { <span class="r125 r">startInfo</span>.<span class="i">Verb</span> = <a href="#a77053c2a303fb2f" class="i property">Verb</a>; }
 
                <span class="r125 r">startInfo</span>.<span class="i">WindowStyle</span> = <a href="#ef1366d53f66e388" class="i field">_windowstyle</a>;
            }
 
            <b>string</b> <span id="r133 rd" class="r133 r">targetMessage</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">StartProcessTarget</span>, <span class="r125 r">startInfo</span>.<span class="i">FileName</span>, <span class="r125 r">startInfo</span>.<span class="i">Arguments</span>.<span class="i">Trim</span>());
            <b>if</b> (!<span class="i">ShouldProcess</span>(<span class="r133 r">targetMessage</span>)) { <b>return</b>; }
 
            <span class="i">Process</span> <span id="r134 rd" class="r134 r">process</span> = <a href="#90ecc1f100a4f81c" class="i method">Start</a>(<span class="r125 r">startInfo</span>);
 
            <b>if</b> (<a href="#19058ad8471c125c" class="i property">PassThru</a>.<span class="i">IsPresent</span>)
            {
                <b>if</b> (<span class="r134 r">process</span> != <b>null</b>)
                {
                    <span class="i">WriteObject</span>(<span class="r134 r">process</span>);
                }
                <b>else</b>
                {
                    <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">CannotStarttheProcess</span>);
                    <span class="i">ErrorRecord</span> <span id="r135 rd" class="r135 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r122 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                    <span class="i">ThrowTerminatingError</span>(<span class="r135 r">er</span>);
                }
            }
 
            <b>if</b> (<a href="#4741dec18cafde75" class="i property">Wait</a>.<span class="i">IsPresent</span>)
            {
                <b>if</b> (<span class="r134 r">process</span> != <b>null</b>)
                {
                    <b>if</b> (!<span class="r134 r">process</span>.<span class="i">HasExited</span>)
                    {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">                        process.WaitForExit();
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
                        <a href="#4393eab8d0f93fa3" class="i field">_waithandle</a> = <b>new</b> <span class="i">ManualResetEvent</span>(<b>false</b>);
 
                        <span class="c">// Create and start the job object</span>
                        <a href="#da03ea3fc9989473" class="t t">ProcessCollection</a> <span id="r136 rd" class="r136 r">jobObject</span> = <b>new</b>();
                        <b>if</b> (<span class="r136 r">jobObject</span>.<a href="#17e0918b3469f769" class="i method">AssignProcessToJobObject</a>(<span class="r134 r">process</span>))
                        {
                            <span class="c">// Wait for the job object to finish</span>
                            <span class="r136 r">jobObject</span>.<a href="#0ca539287bfab1a1" class="i method">WaitOne</a>(<a href="#4393eab8d0f93fa3" class="i field">_waithandle</a>);
                        }
                        <b>else</b> <b>if</b> (!<span class="r134 r">process</span>.<span class="i">HasExited</span>)
                        {
                            <span class="c">// WinBlue: 27537 Start-Process -Wait doesn&#39;t work in a remote session on Windows 7 or lower.</span>
                            <span class="r134 r">process</span>.<span class="i">Exited</span> += <span class="i">myProcess_Exited</span>;
                            <span class="r134 r">process</span>.<span class="i">EnableRaisingEvents</span> = <b>true</b>;
                            <span class="r134 r">process</span>.<span class="i">WaitForExit</span>();
                        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
                    }
                }
                <b>else</b>
                {
                    <span class="r122 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">CannotStarttheProcess</span>);
                    <span class="i">ErrorRecord</span> <span id="r137 rd" class="r137 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r122 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                    <span class="i">ThrowTerminatingError</span>(<span class="r137 r">er</span>);
                }
            }
        }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implements ^c, after creating a process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="8f023801558a2904" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">StopProcessing</a>()
        {
            <b>if</b> (<a href="#4393eab8d0f93fa3" class="i field">_waithandle</a> != <b>null</b>)
            {
                <a href="#4393eab8d0f93fa3" class="i field">_waithandle</a>.<span class="i">Set</span>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dispose WaitHandle used to honor -Wait parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="a48a3412b9670c6f" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#42b2b807f35c9148" class="i method">Dispose</a>(<b>true</b>);
            <span class="i">System</span>.<span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#91784a85a27ce387" class="k">this</a>);
        }
 
        <b>private void</b> <a id="42b2b807f35c9148" href="../../R/42b2b807f35c9148.html" target="n" data-glyph="76,1" class="i method">Dispose</a>(<b>bool</b> <span id="r138 rd" class="r138 r">isDisposing</span>)
        {
            <b>if</b> (<a href="#4393eab8d0f93fa3" class="i field">_waithandle</a> != <b>null</b>)
            {
                <a href="#4393eab8d0f93fa3" class="i field">_waithandle</a>.<span class="i">Dispose</span>();
                <a href="#4393eab8d0f93fa3" class="i field">_waithandle</a> = <b>null</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When Process exits the wait handle is set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="650404f12d0a27a5" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">myProcess_Exited</a>(<b>object</b> <span id="r139 rd" class="r139 r">sender</span>, <span class="i">System</span>.<span class="i">EventArgs</span> <span id="r140 rd" class="r140 r">e</span>)
        {
            <b>if</b> (<a href="#4393eab8d0f93fa3" class="i field">_waithandle</a> != <b>null</b>)
            {
                <a href="#4393eab8d0f93fa3" class="i field">_waithandle</a>.<span class="i">Set</span>();
            }
        }
 
        <b>private string</b> <a id="31b947c4050fea09" href="../../R/31b947c4050fea09.html" target="n" data-glyph="76,1" class="i method">ResolveFilePath</a>(<b>string</b> <span id="r141 rd" class="r141 r">path</span>)
        {
            <b>string</b> <span id="r142 rd" class="r142 r">filepath</span> = <span class="i">PathUtils</span>.<span class="i">ResolveFilePath</span>(<span class="r141 r">path</span>, <a href="#91784a85a27ce387" class="k">this</a>);
            <b>return</b> <span class="r142 r">filepath</span>;
        }
 
        <b>private static void</b> <a id="8d18c421129d17a1" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">LoadEnvironmentVariable</a>(<span class="i">ProcessStartInfo</span> <span id="r143 rd" class="r143 r">startinfo</span>, <span class="i">IDictionary</span> <span id="r144 rd" class="r144 r">EnvironmentVariables</span>)
        {
            <b>var</b> <span id="r145 rd" class="r145 r">processEnvironment</span> = <span class="r143 r">startinfo</span>.<span class="i">EnvironmentVariables</span>;
            <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r146 rd" class="r146 r">entry</span> <b>in</b> <span class="r144 r">EnvironmentVariables</span>)
            {
                <b>if</b> (<span class="r145 r">processEnvironment</span>.<span class="i">ContainsKey</span>(<span class="r146 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>()))
                {
                    <span class="r145 r">processEnvironment</span>.<span class="i">Remove</span>(<span class="r146 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>());
                }
 
                <b>if</b> (<span class="r146 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>().<span class="i">Equals</span>(<span class="s">&quot;PATH&quot;</span>))
                {
                    <span class="r145 r">processEnvironment</span>.<span class="i">Add</span>(<span class="r146 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="r146 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="i">EnvironmentVariableTarget</span>.<span class="i">Machine</span>) + <span class="s">&quot;;&quot;</span> + <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="r146 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="i">EnvironmentVariableTarget</span>.<span class="i">User</span>));
                }
                <b>else</b>
                {
                    <span class="r145 r">processEnvironment</span>.<span class="i">Add</span>(<span class="r146 r">entry</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="r146 r">entry</span>.<span class="i">Value</span>.<span class="i">ToString</span>());
                }
            }
        }
 
        <b>private</b> <span class="i">Process</span> <a id="90ecc1f100a4f81c" href="../../R/90ecc1f100a4f81c.html" target="n" data-glyph="76,1" class="i method">Start</a>(<span class="i">ProcessStartInfo</span> <span id="r147 rd" class="r147 r">startInfo</span>)
        {
            <span class="i">Process</span> <span id="r148 rd" class="r148 r">process</span> = <b>null</b>;
            <b>if</b> (<span class="r147 r">startInfo</span>.<span class="i">UseShellExecute</span>)
            {
                <span class="r148 r">process</span> = <a href="#4158d37e78b86623" class="i method">StartWithShellExecute</a>(<span class="r147 r">startInfo</span>);
            }
            <b>else</b>
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">                process = new Process() { StartInfo = startInfo };
                SetupInputOutputRedirection(process);
                process.Start();
                if (process.StartInfo.RedirectStandardOutput)
                {
                    process.BeginOutputReadLine();
                }
 
                if (process.StartInfo.RedirectStandardError)
                {
                    process.BeginErrorReadLine();
                }
 
                if (process.StartInfo.RedirectStandardInput)
                {
                    WriteToStandardInput(process);
                }
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
                <span class="r148 r">process</span> = <a href="#aad3cf0ee3837faf" class="i method">StartWithCreateProcess</a>(<span class="r147 r">startInfo</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
 
            <b>return</b> <span class="r148 r">process</span>;
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">        private StreamWriter _outputWriter;
        private StreamWriter _errorWriter;
 
        private void StdOutputHandler(object sendingProcess, DataReceivedEventArgs outLine)
        {
            if (!string.IsNullOrEmpty(outLine.Data))
            {
                _outputWriter.WriteLine(outLine.Data);
                _outputWriter.Flush();
            }
        }
 
        private void StdErrorHandler(object sendingProcess, DataReceivedEventArgs outLine)
        {
            if (!string.IsNullOrEmpty(outLine.Data))
            {
                _errorWriter.WriteLine(outLine.Data);
                _errorWriter.Flush();
            }
        }
 
        private void ExitHandler(object sendingProcess, System.EventArgs e)
        {
            // To avoid a race condition with Std*Handler, let&#39;s wait a bit before closing the streams
            // System.Timer is not supported in CoreCLR, so let&#39;s spawn a new thread to do the wait
 
            Thread delayedStreamClosing = new Thread(StreamClosing);
            delayedStreamClosing.Start();
        }
 
        private void StreamClosing()
        {
            Thread.Sleep(1000);
 
            if (_outputWriter != null)
            {
                _outputWriter.Dispose();
            }
 
            if (_errorWriter != null)
            {
                _errorWriter.Dispose();
            }
        }
 
        private void SetupInputOutputRedirection(Process p)
        {
            if (_redirectstandardinput != null)
            {
                p.StartInfo.RedirectStandardInput = true;
                _redirectstandardinput = ResolveFilePath(_redirectstandardinput);
            }
            else
            {
                p.StartInfo.RedirectStandardInput = false;
            }
 
            if (_redirectstandardoutput != null)
            {
                p.StartInfo.RedirectStandardOutput = true;
                _redirectstandardoutput = ResolveFilePath(_redirectstandardoutput);
                p.OutputDataReceived += new DataReceivedEventHandler(StdOutputHandler);
 
                // Can&#39;t do StreamWriter(string) in coreCLR
                _outputWriter = new StreamWriter(new FileStream(_redirectstandardoutput, FileMode.Create));
            }
            else
            {
                p.StartInfo.RedirectStandardOutput = false;
                _outputWriter = null;
            }
 
            if (_redirectstandarderror != null)
            {
                p.StartInfo.RedirectStandardError = true;
                _redirectstandarderror = ResolveFilePath(_redirectstandarderror);
                p.ErrorDataReceived += new DataReceivedEventHandler(StdErrorHandler);
 
                // Can&#39;t do StreamWriter(string) in coreCLR
                _errorWriter = new StreamWriter(new FileStream(_redirectstandarderror, FileMode.Create));
            }
            else
            {
                p.StartInfo.RedirectStandardError = false;
                _errorWriter = null;
            }
 
            p.EnableRaisingEvents = true;
            p.Exited += new EventHandler(ExitHandler);
        }
 
        private void WriteToStandardInput(Process p)
        {
            StreamWriter writer = p.StandardInput;
            using (StreamReader reader = new StreamReader(new FileStream(_redirectstandardinput, FileMode.Open)))
            {
                string line = reader.ReadToEnd();
                writer.WriteLine(line);
            }
 
            writer.Dispose();
        }
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
        <b>private</b> <span class="i">SafeFileHandle</span> <a id="e2d435c8f219d8c5" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetSafeFileHandleForRedirection</a>(<b>string</b> <span id="r149 rd" class="r149 r">RedirectionPath</span>, <b>uint</b> <span id="r150 rd" class="r150 r">dwCreationDisposition</span>)
        {
            <span class="i">System</span>.<span class="i">IntPtr</span> <span id="r151 rd" class="r151 r">hFileHandle</span> = <span class="i">System</span>.<span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#1951cb3461c991f3" class="t t">SECURITY_ATTRIBUTES</a> <span id="r152 rd" class="r152 r">lpSecurityAttributes</span> = <b>new</b>();
 
            <span class="r151 r">hFileHandle</span> = <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<span class="i">CreateFileW</span>(<span class="r149 r">RedirectionPath</span>,
                <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#7886ea7ef0cdce81" class="i field">GENERIC_READ</a> | <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#3dc822b070ac8764" class="i field">GENERIC_WRITE</a>,
                <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#44340a188ceb2954" class="i field">FILE_SHARE_WRITE</a> | <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#e0abdb7c2fde9b0a" class="i field">FILE_SHARE_READ</a>,
                <span class="r152 r">lpSecurityAttributes</span>,
                <span class="r150 r">dwCreationDisposition</span>,
                <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#8543bf72a31c5393" class="i field">FILE_ATTRIBUTE_NORMAL</a>,
                <span class="i">System</span>.<span class="i">IntPtr</span>.<span class="i">Zero</span>);
            <b>if</b> (<span class="r151 r">hFileHandle</span> == <span class="i">System</span>.<span class="i">IntPtr</span>.<span class="i">Zero</span>)
            {
                <b>int</b> <span id="r153 rd" class="r153 r">error</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                <span class="i">Win32Exception</span> <span id="r154 rd" class="r154 r">win32ex</span> = <b>new</b>(<span class="r153 r">error</span>);
                <b>string</b> <span id="r155 rd" class="r155 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidStartProcess</span>, <span class="r154 r">win32ex</span>.<span class="i">Message</span>);
                <span class="i">ErrorRecord</span> <span id="r156 rd" class="r156 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r155 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r156 r">er</span>);
            }
 
            <span class="i">SafeFileHandle</span> <span id="r157 rd" class="r157 r">sf</span> = <b>new</b>(<span class="r151 r">hFileHandle</span>, <b>true</b>);
            <b>return</b> <span class="r157 r">sf</span>;
        }
 
        <b>private static</b> <span class="i">StringBuilder</span> <a id="68ba2efb4b16a047" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BuildCommandLine</a>(<b>string</b> <span id="r158 rd" class="r158 r">executableFileName</span>, <b>string</b> <span id="r159 rd" class="r159 r">arguments</span>)
        {
            <span class="i">StringBuilder</span> <span id="r160 rd" class="r160 r">builder</span> = <b>new</b>();
            <b>string</b> <span id="r161 rd" class="r161 r">str</span> = <span class="r158 r">executableFileName</span>.<span class="i">Trim</span>();
            <b>bool</b> <span id="r162 rd" class="r162 r">flag</span> = <span class="r161 r">str</span>.<span class="i">StartsWith</span>(<span class="s">&#39;&quot;&#39;</span>) &amp;&amp; <span class="r161 r">str</span>.<span class="i">EndsWith</span>(<span class="s">&#39;&quot;&#39;</span>);
            <b>if</b> (!<span class="r162 r">flag</span>)
            {
                <span class="r160 r">builder</span>.<span class="i">Append</span>(<span class="s">&#39;&quot;&#39;</span>);
            }
 
            <span class="r160 r">builder</span>.<span class="i">Append</span>(<span class="r161 r">str</span>);
            <b>if</b> (!<span class="r162 r">flag</span>)
            {
                <span class="r160 r">builder</span>.<span class="i">Append</span>(<span class="s">&#39;&quot;&#39;</span>);
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r159 r">arguments</span>))
            {
                <span class="r160 r">builder</span>.<span class="i">Append</span>(<span class="s">&#39; &#39;</span>);
                <span class="r160 r">builder</span>.<span class="i">Append</span>(<span class="r159 r">arguments</span>);
            }
 
            <b>return</b> <span class="r160 r">builder</span>;
        }
 
        <b>private static byte</b>[] <a id="a4898928dc7c2063" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ConvertEnvVarsToByteArray</a>(<span class="i">StringDictionary</span> <span id="r163 rd" class="r163 r">sd</span>)
        {
            <b>string</b>[] <span id="r164 rd" class="r164 r">array</span> = <b>new</b> <b>string</b>[<span class="r163 r">sd</span>.<span class="i">Count</span>];
            <b>byte</b>[] <span id="r165 rd" class="r165 r">bytes</span> = <b>null</b>;
            <span class="r163 r">sd</span>.<span class="i">Keys</span>.<span class="i">CopyTo</span>(<span class="r164 r">array</span>, 0);
            <b>string</b>[] <span id="r166 rd" class="r166 r">strArray2</span> = <b>new</b> <b>string</b>[<span class="r163 r">sd</span>.<span class="i">Count</span>];
            <span class="r163 r">sd</span>.<span class="i">Values</span>.<span class="i">CopyTo</span>(<span class="r166 r">strArray2</span>, 0);
            <span class="i">Array</span>.<span class="i">Sort</span>(<span class="r164 r">array</span>, <span class="r166 r">strArray2</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <span class="i">StringBuilder</span> <span id="r167 rd" class="r167 r">builder</span> = <b>new</b>();
            <b>for</b> (<b>int</b> <span id="r168 rd" class="r168 r">i</span> = 0; <span class="r168 r">i</span> &lt; <span class="r163 r">sd</span>.<span class="i">Count</span>; <span class="r168 r">i</span>++)
            {
                <span class="r167 r">builder</span>.<span class="i">Append</span>(<span class="r164 r">array</span>[<span class="r168 r">i</span>]);
                <span class="r167 r">builder</span>.<span class="i">Append</span>(<span class="s">&#39;=&#39;</span>);
                <span class="r167 r">builder</span>.<span class="i">Append</span>(<span class="r166 r">strArray2</span>[<span class="r168 r">i</span>]);
                <span class="r167 r">builder</span>.<span class="i">Append</span>(<span class="s">&#39;\0&#39;</span>);
            }
 
            <span class="r167 r">builder</span>.<span class="i">Append</span>(<span class="s">&#39;\0&#39;</span>);
 
            <span class="c">// Use Unicode encoding</span>
            <span class="r165 r">bytes</span> = <span class="i">Encoding</span>.<span class="i">Unicode</span>.<span class="i">GetBytes</span>(<span class="r167 r">builder</span>.<span class="i">ToString</span>());
 
            <b>return</b> <span class="r165 r">bytes</span>;
        }
 
        <b>private void</b> <a id="b4d68b082872796c" href="../../R/b4d68b082872796c.html" target="n" data-glyph="76,1" class="i method">SetStartupInfo</a>(<span class="i">ProcessStartInfo</span> <span id="r169 rd" class="r169 r">startinfo</span>, <b>ref</b> <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#6527eff70b12c885" class="t t">STARTUPINFO</a> <span id="r170 rd" class="r170 r">lpStartupInfo</span>, <b>ref int</b> <span id="r171 rd" class="r171 r">creationFlags</span>)
        {
            <span class="c">// RedirectionStandardInput</span>
            <b>if</b> (<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> != <b>null</b>)
            {
                <span class="r169 r">startinfo</span>.<span class="i">RedirectStandardInput</span> = <b>true</b>;
                <a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>);
                <span class="r170 r">lpStartupInfo</span>.<a href="#8d71d638ce7e1ac3" class="i field">hStdInput</a> = <span class="i">GetSafeFileHandleForRedirection</span>(<a href="#49a5d66e4b3449d6" class="i field">_redirectstandardinput</a>, <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#31b9da8e325aedfe" class="i field">OPEN_EXISTING</a>);
            }
            <b>else</b>
            {
                <span class="r170 r">lpStartupInfo</span>.<a href="#8d71d638ce7e1ac3" class="i field">hStdInput</a> = <b>new</b> <span class="i">SafeFileHandle</span>(<a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<span class="i">GetStdHandle</span>(-10), <b>false</b>);
            }
 
            <span class="c">// RedirectionStandardOutput</span>
            <b>if</b> (<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a> != <b>null</b>)
            {
                <span class="r169 r">startinfo</span>.<span class="i">RedirectStandardOutput</span> = <b>true</b>;
                <a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a>);
                <span class="r170 r">lpStartupInfo</span>.<a href="#ca5755f729063b7e" class="i field">hStdOutput</a> = <span class="i">GetSafeFileHandleForRedirection</span>(<a href="#2410246d2da5bf0b" class="i field">_redirectstandardoutput</a>, <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#2b89a8b0b156d5e2" class="i field">CREATE_ALWAYS</a>);
            }
            <b>else</b>
            {
                <span class="r170 r">lpStartupInfo</span>.<a href="#ca5755f729063b7e" class="i field">hStdOutput</a> = <b>new</b> <span class="i">SafeFileHandle</span>(<a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<span class="i">GetStdHandle</span>(-11), <b>false</b>);
            }
 
            <span class="c">// RedirectionStandardError</span>
            <b>if</b> (<a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a> != <b>null</b>)
            {
                <span class="r169 r">startinfo</span>.<span class="i">RedirectStandardError</span> = <b>true</b>;
                <a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a> = <a href="#31b947c4050fea09" class="i method">ResolveFilePath</a>(<a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a>);
                <span class="r170 r">lpStartupInfo</span>.<a href="#67f12c3dfa2d9dbd" class="i field">hStdError</a> = <span class="i">GetSafeFileHandleForRedirection</span>(<a href="#5970dc4033c0e4af" class="i field">_redirectstandarderror</a>, <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#2b89a8b0b156d5e2" class="i field">CREATE_ALWAYS</a>);
            }
            <b>else</b>
            {
                <span class="r170 r">lpStartupInfo</span>.<a href="#67f12c3dfa2d9dbd" class="i field">hStdError</a> = <b>new</b> <span class="i">SafeFileHandle</span>(<a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<span class="i">GetStdHandle</span>(-12), <b>false</b>);
            }
 
            <span class="c">// STARTF_USESTDHANDLES</span>
            <span class="r170 r">lpStartupInfo</span>.<a href="#4131c146a5d7ea18" class="i field">dwFlags</a> = 0x100;
 
            <b>if</b> (<span class="r169 r">startinfo</span>.<span class="i">CreateNoWindow</span>)
            {
                <span class="c">// No new window: Inherit the parent process&#39;s console window</span>
                <span class="r171 r">creationFlags</span> = 0x00000000;
            }
            <b>else</b>
            {
                <span class="c">// CREATE_NEW_CONSOLE</span>
                <span class="r171 r">creationFlags</span> |= 0x00000010;
 
                <span class="c">// STARTF_USESHOWWINDOW</span>
                <span class="r170 r">lpStartupInfo</span>.<a href="#4131c146a5d7ea18" class="i field">dwFlags</a> |= 0x00000001;
 
                <span class="c">// On headless SKUs like NanoServer and IoT, window style can only be the default value &#39;Normal&#39;.</span>
                <b>switch</b> (<span class="r169 r">startinfo</span>.<span class="i">WindowStyle</span>)
                {
                    <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Normal</span>:
                        <span class="c">// SW_SHOWNORMAL</span>
                        <span class="r170 r">lpStartupInfo</span>.<a href="#b02845342d292126" class="i field">wShowWindow</a> = 1;
                        <b>break</b>;
                    <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Minimized</span>:
                        <span class="c">// SW_SHOWMINIMIZED</span>
                        <span class="r170 r">lpStartupInfo</span>.<a href="#b02845342d292126" class="i field">wShowWindow</a> = 2;
                        <b>break</b>;
                    <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Maximized</span>:
                        <span class="c">// SW_SHOWMAXIMIZED</span>
                        <span class="r170 r">lpStartupInfo</span>.<a href="#b02845342d292126" class="i field">wShowWindow</a> = 3;
                        <b>break</b>;
                    <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Hidden</span>:
                        <span class="c">// SW_HIDE</span>
                        <span class="r170 r">lpStartupInfo</span>.<a href="#b02845342d292126" class="i field">wShowWindow</a> = 0;
                        <b>break</b>;
                }
            }
 
            <span class="c">// Create the new process suspended so we have a chance to get a corresponding Process object in case it terminates quickly.</span>
            <span class="r171 r">creationFlags</span> |= 0x00000004;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method will be used on all windows platforms, both full desktop and headless SKUs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Process</span> <a id="aad3cf0ee3837faf" href="../../R/aad3cf0ee3837faf.html" target="n" data-glyph="76,1" class="i method">StartWithCreateProcess</a>(<span class="i">ProcessStartInfo</span> <span id="r172 rd" class="r172 r">startinfo</span>)
        {
            <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#6527eff70b12c885" class="t t">STARTUPINFO</a> <span id="r173 rd" class="r173 r">lpStartupInfo</span> = <b>new</b>();
            <a href="#6e3c4fe570c10009" class="t t">SafeNativeMethods</a>.<a href="#651a518328ac0af1" class="t t">PROCESS_INFORMATION</a> <span id="r174 rd" class="r174 r">lpProcessInformation</span> = <b>new</b>();
            <b>int</b> <span id="r175 rd" class="r175 r">error</span> = 0;
            <span class="i">GCHandle</span> <span id="r176 rd" class="r176 r">pinnedEnvironmentBlock</span> = <b>new</b>();
            <span class="i">IntPtr</span> <span id="r177 rd" class="r177 r">AddressOfEnvironmentBlock</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <b>string</b> <span id="r178 rd" class="r178 r">message</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <span class="c">// building the cmdline with the file name given and it&#39;s arguments</span>
            <span class="i">StringBuilder</span> <span id="r179 rd" class="r179 r">cmdLine</span> = <span class="i">BuildCommandLine</span>(<span class="r172 r">startinfo</span>.<span class="i">FileName</span>, <span class="r172 r">startinfo</span>.<span class="i">Arguments</span>);
 
            <b>try</b>
            {
                <b>int</b> <span id="r180 rd" class="r180 r">creationFlags</span> = 0;
 
                <a href="#b4d68b082872796c" class="i method">SetStartupInfo</a>(<span class="r172 r">startinfo</span>, <b>ref</b> <span class="r173 r">lpStartupInfo</span>, <b>ref</b> <span class="r180 r">creationFlags</span>);
 
                <span class="c">// We follow the logic:</span>
                <span class="c">//   - Ignore `UseNewEnvironment` when we run a process as another user.</span>
                <span class="c">//          Setting initial environment variables makes sense only for current user.</span>
                <span class="c">//   - Set environment variables if they present in ProcessStartupInfo.</span>
                <b>if</b> (!<a href="#27432bd90b6677b4" class="i property">UseNewEnvironment</a>)
                {
                    <b>var</b> <span id="r181 rd" class="r181 r">environmentVars</span> = <span class="r172 r">startinfo</span>.<span class="i">EnvironmentVariables</span>;
                    <b>if</b> (<span class="r181 r">environmentVars</span> != <b>null</b>)
                    {
                        <span class="c">// All Windows Operating Systems that we support are Windows NT systems, so we use Unicode for environment.</span>
                        <span class="r180 r">creationFlags</span> |= 0x400;
 
                        <span class="r176 r">pinnedEnvironmentBlock</span> = <span class="i">GCHandle</span>.<span class="i">Alloc</span>(<span class="i">ConvertEnvVarsToByteArray</span>(<span class="r181 r">environmentVars</span>), <span class="i">GCHandleType</span>.<span class="i">Pinned</span>);
                        <span class="r177 r">AddressOfEnvironmentBlock</span> = <span class="r176 r">pinnedEnvironmentBlock</span>.<span class="i">AddrOfPinnedObject</span>();
                    }
                }
 
                <b>bool</b> <span id="r182 rd" class="r182 r">flag</span>;
 
                <b>if</b> (<a href="#096fdec6952eac45" class="i field">_credential</a> != <b>null</b>)
                {
                    <span class="c">// Run process as another user.</span>
                    <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#9ce1990984810b4c" class="t t">LogonFlags</a> <span id="r183 rd" class="r183 r">logonFlags</span> = 0;
                    <b>if</b> (<span class="r172 r">startinfo</span>.<span class="i">LoadUserProfile</span>)
                    {
                        <span class="r183 r">logonFlags</span> = <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#9ce1990984810b4c" class="t t">LogonFlags</a>.<a href="#2ab09b13bddfe844" class="i field">LOGON_WITH_PROFILE</a>;
                    }
 
                    <span class="i">IntPtr</span> <span id="r184 rd" class="r184 r">password</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                    <b>try</b>
                    {
                        <span class="r184 r">password</span> = (<span class="r172 r">startinfo</span>.<span class="i">Password</span> == <b>null</b>) ? <span class="i">Marshal</span>.<span class="i">StringToCoTaskMemUni</span>(<b>string</b>.<span class="i">Empty</span>) : <span class="i">Marshal</span>.<span class="i">SecureStringToCoTaskMemUnicode</span>(<span class="r172 r">startinfo</span>.<span class="i">Password</span>);
                        <span class="r182 r">flag</span> = <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<span class="i">CreateProcessWithLogonW</span>(<span class="r172 r">startinfo</span>.<span class="i">UserName</span>, <span class="r172 r">startinfo</span>.<span class="i">Domain</span>, <span class="r184 r">password</span>, <span class="r183 r">logonFlags</span>, <b>null</b>, <span class="r179 r">cmdLine</span>, <span class="r180 r">creationFlags</span>, <span class="r177 r">AddressOfEnvironmentBlock</span>, <span class="r172 r">startinfo</span>.<span class="i">WorkingDirectory</span>, <span class="r173 r">lpStartupInfo</span>, <span class="r174 r">lpProcessInformation</span>);
                        <b>if</b> (!<span class="r182 r">flag</span>)
                        {
                            <span class="r175 r">error</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <span class="i">ErrorRecord</span> <span id="r185 rd" class="r185 r">er</span> = <b>null</b>;
 
                            <b>if</b> (<span class="r175 r">error</span> == 0xc1)
                            {
                                <span class="r178 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidApplication</span>, <a href="#7de7dde4c528bf3e" class="i property">FilePath</a>);
                            }
                            <b>else</b> <b>if</b> (<span class="r175 r">error</span> == 0x424)
                            {
                                <span class="c">// The API &#39;CreateProcessWithLogonW&#39; depends on the &#39;Secondary Logon&#39; service, but the component &#39;Microsoft-Windows-SecondaryLogonService&#39;</span>
                                <span class="c">// is not installed in OneCoreUAP. We will get error code 0x424 when the service is not available.</span>
                                <span class="r178 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">ParameterNotSupported</span>, <span class="s">&quot;-Credential&quot;</span>, <span class="s">&quot;Start-Process&quot;</span>);
                                <span class="r185 r">er</span> = <b>new</b> <span class="i">ErrorRecord</span>(<b>new</b> <span class="i">NotSupportedException</span>(<span class="r178 r">message</span>), <span class="s">&quot;NotSupportedException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">NotInstalled</span>, <b>null</b>);
                            }
                            <b>else</b>
                            {
                                <span class="i">Win32Exception</span> <span id="r186 rd" class="r186 r">win32ex</span> = <b>new</b>(<span class="r175 r">error</span>);
                                <span class="r178 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidStartProcess</span>, <span class="r186 r">win32ex</span>.<span class="i">Message</span>);
                            }
 
                            <span class="r185 r">er</span> ??= <b>new</b> <span class="i">ErrorRecord</span>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r178 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                            <span class="i">ThrowTerminatingError</span>(<span class="r185 r">er</span>);
                        }
 
                        <b>goto</b> <span class="i">Label_03AE</span>;
                    }
                    <b>finally</b>
                    {
                        <b>if</b> (<span class="r184 r">password</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                        {
                            <span class="i">Marshal</span>.<span class="i">ZeroFreeCoTaskMemUnicode</span>(<span class="r184 r">password</span>);
                        }
                    }
                }
 
                <span class="c">// Run process as current user.</span>
                <b>if</b> (<a href="#27432bd90b6677b4" class="i property">UseNewEnvironment</a>)
                {
                    <span class="c">// All Windows Operating Systems that we support are Windows NT systems, so we use Unicode for environment.</span>
                    <span class="r180 r">creationFlags</span> |= 0x400;
 
                    <span class="i">IntPtr</span> <span id="r187 rd" class="r187 r">token</span> = <span class="i">WindowsIdentity</span>.<span class="i">GetCurrent</span>().<span class="i">Token</span>;
                    <b>if</b> (!<a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#05a532097c51df9e" class="i method">CreateEnvironmentBlock</a>(<b>out</b> <span class="r177 r">AddressOfEnvironmentBlock</span>, <span class="r187 r">token</span>, <b>false</b>))
                    {
                        <span class="i">Win32Exception</span> <span id="r188 rd" class="r188 r">win32ex</span> = <b>new</b>(<span class="r175 r">error</span>);
                        <span class="r178 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidStartProcess</span>, <span class="r188 r">win32ex</span>.<span class="i">Message</span>);
                        <b>var</b> <span id="r189 rd" class="r189 r">errorRecord</span> = <b>new</b> <span class="i">ErrorRecord</span>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r178 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                        <span class="i">ThrowTerminatingError</span>(<span class="r189 r">errorRecord</span>);
                    }
                }
 
                <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#1951cb3461c991f3" class="t t">SECURITY_ATTRIBUTES</a> <span id="r190 rd" class="r190 r">lpProcessAttributes</span> = <b>new</b>();
                <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#1951cb3461c991f3" class="t t">SECURITY_ATTRIBUTES</a> <span id="r191 rd" class="r191 r">lpThreadAttributes</span> = <b>new</b>();
                <span class="r182 r">flag</span> = <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<span class="i">CreateProcess</span>(<b>null</b>, <span class="r179 r">cmdLine</span>, <span class="r190 r">lpProcessAttributes</span>, <span class="r191 r">lpThreadAttributes</span>, <b>true</b>, <span class="r180 r">creationFlags</span>, <span class="r177 r">AddressOfEnvironmentBlock</span>, <span class="r172 r">startinfo</span>.<span class="i">WorkingDirectory</span>, <span class="r173 r">lpStartupInfo</span>, <span class="r174 r">lpProcessInformation</span>);
                <b>if</b> (!<span class="r182 r">flag</span>)
                {
                    <span class="r175 r">error</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                    <span class="i">Win32Exception</span> <span id="r192 rd" class="r192 r">win32ex</span> = <b>new</b>(<span class="r175 r">error</span>);
                    <span class="r178 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidStartProcess</span>, <span class="r192 r">win32ex</span>.<span class="i">Message</span>);
                    <span class="i">ErrorRecord</span> <span id="r193 rd" class="r193 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r178 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                    <span class="i">ThrowTerminatingError</span>(<span class="r193 r">er</span>);
                }
 
            <span class="i">Label_03AE</span>:
 
                <span class="c">// At this point, we should have a suspended process.  Get the .Net Process object, resume the process, and return.</span>
                <span class="i">Process</span> <span id="r194 rd" class="r194 r">result</span> = <span class="i">Process</span>.<span class="i">GetProcessById</span>(<span class="r174 r">lpProcessInformation</span>.<a href="#c66affb63fdd32cd" class="i field">dwProcessId</a>);
                <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#61f28d74178862eb" class="i method">ResumeThread</a>(<span class="r174 r">lpProcessInformation</span>.<a href="#b68857c8439c9668" class="i field">hThread</a>);
 
                <b>return</b> <span class="r194 r">result</span>;
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r176 r">pinnedEnvironmentBlock</span>.<span class="i">IsAllocated</span>)
                {
                    <span class="r176 r">pinnedEnvironmentBlock</span>.<span class="i">Free</span>();
                }
                <b>else</b>
                {
                    <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#f299e7b624849573" class="i method">DestroyEnvironmentBlock</a>(<span class="r177 r">AddressOfEnvironmentBlock</span>);
                }
 
                <span class="r173 r">lpStartupInfo</span>.<a href="#892c1bcb18767584" class="i method">Dispose</a>();
                <span class="r174 r">lpProcessInformation</span>.<a href="#310d0cdcb1ad4cad" class="i method">Dispose</a>();
            }
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method will be used only on Windows full desktop.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Process</span> <a id="4158d37e78b86623" href="../../R/4158d37e78b86623.html" target="n" data-glyph="76,1" class="i method">StartWithShellExecute</a>(<span class="i">ProcessStartInfo</span> <span id="r195 rd" class="r195 r">startInfo</span>)
        {
            <span class="i">Process</span> <span id="r196 rd" class="r196 r">result</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r196 r">result</span> = <span class="i">Process</span>.<span class="i">Start</span>(<span class="r195 r">startInfo</span>);
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r197 rd" class="r197 r">ex</span>)
            {
                <b>string</b> <span id="r198 rd" class="r198 r">message</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="i">ProcessResources</span>.<span class="i">InvalidStartProcess</span>, <span class="r197 r">ex</span>.<span class="i">Message</span>);
                <span class="i">ErrorRecord</span> <span id="r199 rd" class="r199 r">er</span> = <b>new</b>(<b>new</b> <span class="i">InvalidOperationException</span>(<span class="r198 r">message</span>), <span class="s">&quot;InvalidOperationException&quot;</span>, <span class="i">ErrorCategory</span>.<span class="i">InvalidOperation</span>, <b>null</b>);
                <span class="i">ThrowTerminatingError</span>(<span class="r199 r">er</span>);
            }
 
            <b>return</b> <span class="r196 r">result</span>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> ProcessCollection is a helper class used by Start-Process -Wait cmdlet to monitor the</span>
    <span class="c">///</span><span class="c"> child processes created by the main process hosted by the Start-process cmdlet.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="da03ea3fc9989473" href="../../R/da03ea3fc9989473.html" target="n" data-glyph="2,0" class="t t">ProcessCollection</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> JobObjectHandle is a reference to the job object used to track</span>
        <span class="c">///</span><span class="c"> the child processes created by the main process hosted by the Start-Process cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="#572b11e461a554ec" class="t t">SafeJobHandle</a> <a id="4910c676491e82ba" href="../../R/4910c676491e82ba.html" target="n" data-glyph="46,1" class="i field">_jobObjectHandle</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ProcessCollection constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="ee305ef441e01295" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">ProcessCollection</a>()
        {
            <span class="i">IntPtr</span> <span id="r200 rd" class="r200 r">jobObjectHandleIntPtr</span> = <a href="Service.cs.html#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">CreateJobObject</span>(<span class="i">IntPtr</span>.<span class="i">Zero</span>, <b>null</b>);
            <a href="#4910c676491e82ba" class="i field">_jobObjectHandle</a> = <b>new</b> <a href="#188fb1c5289bbf39" class="t constructor">SafeJobHandle</a>(<span class="r200 r">jobObjectHandleIntPtr</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start API assigns the process to the JobObject and starts monitoring</span>
        <span class="c">///</span><span class="c"> the child processes hosted by the process created by Start-Process cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="17e0918b3469f769" href="../../R/17e0918b3469f769.html" target="n" data-glyph="74,1" class="i method">AssignProcessToJobObject</a>(<span class="i">Process</span> <span id="r201 rd" class="r201 r">process</span>)
        {
            <span class="c">// Add the process to the job object</span>
            <b>bool</b> <span id="r202 rd" class="r202 r">result</span> = <a href="Service.cs.html#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">AssignProcessToJobObject</span>(<a href="#4910c676491e82ba" class="i field">_jobObjectHandle</a>, <span class="r201 r">process</span>.<span class="i">Handle</span>);
            <b>return</b> <span class="r202 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks to see if the JobObject is empty (has no assigned processes).</span>
        <span class="c">///</span><span class="c"> If job is empty the auto reset event supplied as input would be set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="be694ea9ac943b61" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CheckJobStatus</a>(<b>object</b> <span id="r203 rd" class="r203 r">stateInfo</span>)
        {
            <span class="i">ManualResetEvent</span> <span id="r204 rd" class="r204 r">emptyJobAutoEvent</span> = (<span class="i">ManualResetEvent</span>)<span class="r203 r">stateInfo</span>;
            <b>int</b> <span id="r205 rd" class="r205 r">dwSize</span> = 0;
            <b>const int</b> <span id="r206 rd" class="r206 r">JOB_OBJECT_BASIC_PROCESS_ID_LIST</span> = 3;
            <a href="#182d1b5693785be2" class="t t">JOBOBJECT_BASIC_PROCESS_ID_LIST</a> <span id="r207 rd" class="r207 r">JobList</span> = <b>new</b>();
 
            <span class="r205 r">dwSize</span> = <span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r207 r">JobList</span>);
            <b>if</b> (<a href="Service.cs.html#d4f00dbde8926963" class="t t">NativeMethods</a>.<span class="i">QueryInformationJobObject</span>(<a href="#4910c676491e82ba" class="i field">_jobObjectHandle</a>,
                <span class="r206 r">JOB_OBJECT_BASIC_PROCESS_ID_LIST</span>,
                <b>ref</b> <span class="r207 r">JobList</span>, <span class="r205 r">dwSize</span>, <span class="i">IntPtr</span>.<span class="i">Zero</span>))
            {
                <b>if</b> (<span class="r207 r">JobList</span>.<a href="#91bfa3bd6fa3f920" class="i field">NumberOfAssignedProcess</a> == 0)
                {
                    <span class="r204 r">emptyJobAutoEvent</span>.<span class="i">Set</span>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> WaitOne blocks the current thread until the current instance receives a signal, using</span>
        <span class="c">///</span><span class="c"> a System.TimeSpan to measure the time interval and specifying whether to</span>
        <span class="c">///</span><span class="c"> exit the synchronization domain before the wait.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">waitHandleToUse</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> WaitHandle to use for waiting on the job object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="0ca539287bfab1a1" href="../../R/0ca539287bfab1a1.html" target="n" data-glyph="74,1" class="i method">WaitOne</a>(<span class="i">ManualResetEvent</span> <span id="r208 rd" class="r208 r">waitHandleToUse</span>)
        {
            <span class="i">TimerCallback</span> <span id="r209 rd" class="r209 r">jobObjectStatusCb</span> = <a href="#da03ea3fc9989473" class="k">this</a>.<span class="i">CheckJobStatus</span>;
            <b>using</b> (<span class="i">Timer</span> <span id="r210 rd" class="r210 r">stateTimer</span> = <b>new</b>(<span class="r209 r">jobObjectStatusCb</span>, <span class="r208 r">waitHandleToUse</span>, 0, 1000))
            {
                <span class="r208 r">waitHandleToUse</span>.<span class="i">WaitOne</span>();
            }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> JOBOBJECT_BASIC_PROCESS_ID_LIST Contains the process identifier list for a job object.</span>
    <span class="c">///</span><span class="c"> If the job is nested, the process identifier list consists of all</span>
    <span class="c">///</span><span class="c"> processes associated with the job and its child jobs.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
    <b>internal struct</b> <a id="182d1b5693785be2" href="../../R/182d1b5693785be2.html" target="n" data-glyph="110,0" class="t t"><span id="f25a97c1af5e06c6">JOBOBJECT_BASIC_PROCESS_ID_LIST</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of process identifiers to be stored in ProcessIdList.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public uint</b> <a id="91bfa3bd6fa3f920" href="../../R/91bfa3bd6fa3f920.html" target="n" data-glyph="42,1" class="i field">NumberOfAssignedProcess</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of process identifiers returned in the ProcessIdList buffer.</span>
        <span class="c">///</span><span class="c"> If this number is less than NumberOfAssignedProcesses, increase</span>
        <span class="c">///</span><span class="c"> the size of the buffer to accommodate the complete list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public uint</b> <a id="85a85a3ce1e76fda" href="../../R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">NumberOfProcessIdsInList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A variable-length array of process identifiers returned by this call.</span>
        <span class="c">///</span><span class="c"> Array elements 0 through NumberOfProcessIdsInList minus 1</span>
        <span class="c">///</span><span class="c"> contain valid process identifiers.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IntPtr</span> <a id="fe4820383c5e1faf" href="../../R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">ProcessIdList</a>;
    }
 
    <b>internal static class</b> <a id="e56bae155c22e7b2" href="../../R/e56bae155c22e7b2.html" target="n" data-glyph="2,0" class="t t">ProcessNativeMethods</a>
    {
        <span class="c">// Fields</span>
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="7886ea7ef0cdce81" href="../../R/7886ea7ef0cdce81.html" target="n" data-glyph="44,1" class="i field">GENERIC_READ</a> = 0x80000000;
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="3dc822b070ac8764" href="../../R/3dc822b070ac8764.html" target="n" data-glyph="44,1" class="i field">GENERIC_WRITE</a> = 0x40000000;
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="8543bf72a31c5393" href="../../R/8543bf72a31c5393.html" target="n" data-glyph="44,1" class="i field">FILE_ATTRIBUTE_NORMAL</a> = 0x80000000;
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="2b89a8b0b156d5e2" href="../../R/2b89a8b0b156d5e2.html" target="n" data-glyph="44,1" class="i field">CREATE_ALWAYS</a> = 2;
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="44340a188ceb2954" href="../../R/44340a188ceb2954.html" target="n" data-glyph="44,1" class="i field">FILE_SHARE_WRITE</a> = 0x00000002;
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="e0abdb7c2fde9b0a" href="../../R/e0abdb7c2fde9b0a.html" target="n" data-glyph="44,1" class="i field">FILE_SHARE_READ</a> = 0x00000001;
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="066a56306e9dc1b2" href="../../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">OF_READWRITE</a> = 0x00000002;
        <b>internal static readonly</b> <span class="i">UInt32</span> <a id="31b9da8e325aedfe" href="../../R/31b9da8e325aedfe.html" target="n" data-glyph="44,1" class="i field">OPEN_EXISTING</a> = 3;
 
        <span class="c">// Methods</span>
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetStdHandleDllName</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>public static extern</b> <span class="i">IntPtr</span> <a id="bf387e52cfbdc568" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetStdHandle</a>(<b>int</b> <span id="r211 rd" class="r211 r">whichHandle</span>);
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CreateProcessWithLogonWDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">ExactSpelling</span> = <b>true</b>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>internal static extern bool</b> <a id="b810ae6dd36ad51a" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreateProcessWithLogonW</a>(<b>string</b> <span id="r212 rd" class="r212 r">userName</span>,
            <b>string</b> <span id="r213 rd" class="r213 r">domain</span>,
            <span class="i">IntPtr</span> <span id="r214 rd" class="r214 r">password</span>,
            <a href="#9ce1990984810b4c" class="t t">LogonFlags</a> <span id="r215 rd" class="r215 r">logonFlags</span>,
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r216 rd" class="r216 r">appName</span>,
            <span class="i">StringBuilder</span> <span id="r217 rd" class="r217 r">cmdLine</span>,
            <b>int</b> <span id="r218 rd" class="r218 r">creationFlags</span>,
            <span class="i">IntPtr</span> <span id="r219 rd" class="r219 r">environmentBlock</span>,
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r220 rd" class="r220 r">lpCurrentDirectory</span>,
            <a href="#6527eff70b12c885" class="t t">STARTUPINFO</a> <span id="r221 rd" class="r221 r">lpStartupInfo</span>,
            <a href="#6e3c4fe570c10009" class="t t">SafeNativeMethods</a>.<a href="#651a518328ac0af1" class="t t">PROCESS_INFORMATION</a> <span id="r222 rd" class="r222 r">lpProcessInformation</span>);
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CreateProcessDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>public static extern bool</b> <a id="3701f2238c4aa7a9" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateProcess</a>([<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r223 rd" class="r223 r">lpApplicationName</span>,
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <span class="i">StringBuilder</span> <span id="r224 rd" class="r224 r">lpCommandLine</span>,
            <a href="#1951cb3461c991f3" class="t t">SECURITY_ATTRIBUTES</a> <span id="r225 rd" class="r225 r">lpProcessAttributes</span>,
            <a href="#1951cb3461c991f3" class="t t">SECURITY_ATTRIBUTES</a> <span id="r226 rd" class="r226 r">lpThreadAttributes</span>,
            <b>bool</b> <span id="r227 rd" class="r227 r">bInheritHandles</span>,
            <b>int</b> <span id="r228 rd" class="r228 r">dwCreationFlags</span>,
            <span class="i">IntPtr</span> <span id="r229 rd" class="r229 r">lpEnvironment</span>,
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r230 rd" class="r230 r">lpCurrentDirectory</span>,
            <a href="#6527eff70b12c885" class="t t">STARTUPINFO</a> <span id="r231 rd" class="r231 r">lpStartupInfo</span>,
            <a href="#6e3c4fe570c10009" class="t t">SafeNativeMethods</a>.<a href="#651a518328ac0af1" class="t t">PROCESS_INFORMATION</a> <span id="r232 rd" class="r232 r">lpProcessInformation</span>);
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ResumeThreadDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>public static extern uint</b> <a id="61f28d74178862eb" href="../../R/61f28d74178862eb.html" target="n" data-glyph="72,1" class="i method">ResumeThread</a>(<span class="i">IntPtr</span> <span id="r233 rd" class="r233 r">threadHandle</span>);
 
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CreateFileDllName</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        <b>public static extern</b> <span class="i">FileNakedHandle</span> <a id="1bfaefd289102742" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateFileW</a>(
            [<span class="i">In</span>, <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">LPWStr</span>)] <b>string</b> <span id="r234 rd" class="r234 r">lpFileName</span>,
            <span class="i">DWORD</span> <span id="r235 rd" class="r235 r">dwDesiredAccess</span>,
            <span class="i">DWORD</span> <span id="r236 rd" class="r236 r">dwShareMode</span>,
            <a href="#e56bae155c22e7b2" class="t t">ProcessNativeMethods</a>.<a href="#1951cb3461c991f3" class="t t">SECURITY_ATTRIBUTES</a> <span id="r237 rd" class="r237 r">lpSecurityAttributes</span>,
            <span class="i">DWORD</span> <span id="r238 rd" class="r238 r">dwCreationDisposition</span>,
            <span class="i">DWORD</span> <span id="r239 rd" class="r239 r">dwFlagsAndAttributes</span>,
            <span class="i">System</span>.<span class="i">IntPtr</span> <span id="r240 rd" class="r240 r">hTemplateFile</span>
            );
 
        [<span class="i">DllImport</span>(<span class="s">&quot;userenv.dll&quot;</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>public static extern bool</b> <a id="05a532097c51df9e" href="../../R/05a532097c51df9e.html" target="n" data-glyph="72,1" class="i method">CreateEnvironmentBlock</a>(<b>out</b> <span class="i">IntPtr</span> <span id="r241 rd" class="r241 r">lpEnvironment</span>, <span class="i">IntPtr</span> <span id="r242 rd" class="r242 r">hToken</span>, <b>bool</b> <span id="r243 rd" class="r243 r">bInherit</span>);
 
        [<span class="i">DllImport</span>(<span class="s">&quot;userenv.dll&quot;</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>public static extern bool</b> <a id="f299e7b624849573" href="../../R/f299e7b624849573.html" target="n" data-glyph="72,1" class="i method">DestroyEnvironmentBlock</a>(<span class="i">IntPtr</span> <span id="r244 rd" class="r244 r">lpEnvironment</span>);
 
        [<span class="i">Flags</span>]
        <b>internal enum</b> <a id="9ce1990984810b4c" href="../../R/9ce1990984810b4c.html" target="n" data-glyph="20,1" class="t t"><span id="ba4fd1d0c72b3de3">LogonFlags</span></a>
        {
            <a id="2ca9a84f6e3ecb5c" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">LOGON_NETCREDENTIALS_ONLY</a> = 2,
            <a id="2ab09b13bddfe844" href="../../R/2ab09b13bddfe844.html" target="n" data-glyph="24,2" class="i field">LOGON_WITH_PROFILE</a> = 1
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal class</b> <a id="1951cb3461c991f3" href="../../R/1951cb3461c991f3.html" target="n" data-glyph="2,1" class="t t">SECURITY_ATTRIBUTES</a>
        {
            <b>public int</b> <a id="614ee31397a0e061" href="../../R/614ee31397a0e061.html" target="n" data-glyph="42,2" class="i field">nLength</a>;
            <b>public</b> <a href="#3452c5040db936f2" class="t t">SafeLocalMemHandle</a> <a id="e9bb1bdf11e301a3" href="../../R/e9bb1bdf11e301a3.html" target="n" data-glyph="42,2" class="i field">lpSecurityDescriptor</a>;
            <b>public bool</b> <a id="3299c85317dd1c14" href="../../R/3299c85317dd1c14.html" target="n" data-glyph="42,2" class="i field">bInheritHandle</a>;
 
            <b>public</b> <a id="25d4e6122ced2f23" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">SECURITY_ATTRIBUTES</a>()
            {
                <a href="#1951cb3461c991f3" class="k">this</a>.<a href="#614ee31397a0e061" class="i field">nLength</a> = 12;
                <a href="#1951cb3461c991f3" class="k">this</a>.<a href="#3299c85317dd1c14" class="i field">bInheritHandle</a> = <b>true</b>;
                <a href="#1951cb3461c991f3" class="k">this</a>.<a href="#e9bb1bdf11e301a3" class="i field">lpSecurityDescriptor</a> = <b>new</b> <span class="t">SafeLocalMemHandle</span>(<span class="i">IntPtr</span>.<span class="i">Zero</span>, <b>true</b>);
            }
        }
 
        <b>internal sealed class</b> <a id="3452c5040db936f2" href="../../R/3452c5040db936f2.html" target="n" data-glyph="2,1" class="t t">SafeLocalMemHandle</a> : <span class="i">SafeHandleZeroOrMinusOneIsInvalid</span>
        {
            <span class="c">// Methods</span>
            <b>internal</b> <a id="a95deee3fa2dced9" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">SafeLocalMemHandle</a>()
                : <b>base</b>(<b>true</b>)
            {
            }
 
            <b>internal</b> <a id="8f458601983bff28" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">SafeLocalMemHandle</a>(<span class="i">IntPtr</span> <span id="r245 rd" class="r245 r">existingHandle</span>, <b>bool</b> <span id="r246 rd" class="r246 r">ownsHandle</span>)
                : <b>base</b>(<span class="r246 r">ownsHandle</span>)
            {
                <b>base</b>.<span class="i">SetHandle</span>(<span class="r245 r">existingHandle</span>);
            }
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">LocalFreeDllName</span>)]
            <b>private static extern</b> <span class="i">IntPtr</span> <a id="086ea4911dacbeb3" href="../../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">LocalFree</a>(<span class="i">IntPtr</span> <span id="r247 rd" class="r247 r">hMem</span>);
 
            <b>protected override bool</b> <a id="ffe91df67c979a96" href="../../R/../../0000000000.html" target="n" data-glyph="75,2" class="i method">ReleaseHandle</a>()
            {
                <b>return</b> (<span class="i">LocalFree</span>(<b>base</b>.<span class="i">handle</span>) == <span class="i">IntPtr</span>.<span class="i">Zero</span>);
            }
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal class</b> <a id="6527eff70b12c885" href="../../R/6527eff70b12c885.html" target="n" data-glyph="2,1" class="t t">STARTUPINFO</a>
        {
            <b>public int</b> <a id="b3e079acb17504d7" href="../../R/b3e079acb17504d7.html" target="n" data-glyph="42,2" class="i field">cb</a>;
            <b>public</b> <span class="i">IntPtr</span> <a id="ff504036c21adebf" href="../../R/ff504036c21adebf.html" target="n" data-glyph="42,2" class="i field">lpReserved</a>;
            <b>public</b> <span class="i">IntPtr</span> <a id="223429a4eaee11d8" href="../../R/223429a4eaee11d8.html" target="n" data-glyph="42,2" class="i field">lpDesktop</a>;
            <b>public</b> <span class="i">IntPtr</span> <a id="760ddf8720276de7" href="../../R/760ddf8720276de7.html" target="n" data-glyph="42,2" class="i field">lpTitle</a>;
            <b>public int</b> <a id="b9caa90b39136b67" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwX</a>;
            <b>public int</b> <a id="17dc7020469d8ddd" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwY</a>;
            <b>public int</b> <a id="fb3589f3ac7babc0" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwXSize</a>;
            <b>public int</b> <a id="ebee301266a09f31" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwYSize</a>;
            <b>public int</b> <a id="40415bb861ad1c6c" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwXCountChars</a>;
            <b>public int</b> <a id="6a07218cbc231c37" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwYCountChars</a>;
            <b>public int</b> <a id="9df430313b48cb6e" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwFillAttribute</a>;
            <b>public int</b> <a id="4131c146a5d7ea18" href="../../R/4131c146a5d7ea18.html" target="n" data-glyph="42,2" class="i field">dwFlags</a>;
            <b>public short</b> <a id="b02845342d292126" href="../../R/b02845342d292126.html" target="n" data-glyph="42,2" class="i field">wShowWindow</a>;
            <b>public short</b> <a id="9e9779a5c02ed70d" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">cbReserved2</a>;
            <b>public</b> <span class="i">IntPtr</span> <a id="b233685bae3079d3" href="../../R/b233685bae3079d3.html" target="n" data-glyph="42,2" class="i field">lpReserved2</a>;
            <b>public</b> <span class="i">SafeFileHandle</span> <a id="8d71d638ce7e1ac3" href="../../R/8d71d638ce7e1ac3.html" target="n" data-glyph="42,2" class="i field">hStdInput</a>;
            <b>public</b> <span class="i">SafeFileHandle</span> <a id="ca5755f729063b7e" href="../../R/ca5755f729063b7e.html" target="n" data-glyph="42,2" class="i field">hStdOutput</a>;
            <b>public</b> <span class="i">SafeFileHandle</span> <a id="67f12c3dfa2d9dbd" href="../../R/67f12c3dfa2d9dbd.html" target="n" data-glyph="42,2" class="i field">hStdError</a>;
 
            <b>public</b> <a id="15129988ceb42137" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">STARTUPINFO</a>()
            {
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#ff504036c21adebf" class="i field">lpReserved</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#223429a4eaee11d8" class="i field">lpDesktop</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#760ddf8720276de7" class="i field">lpTitle</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#b233685bae3079d3" class="i field">lpReserved2</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#8d71d638ce7e1ac3" class="i field">hStdInput</a> = <b>new</b> <span class="i">SafeFileHandle</span>(<span class="i">IntPtr</span>.<span class="i">Zero</span>, <b>false</b>);
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#ca5755f729063b7e" class="i field">hStdOutput</a> = <b>new</b> <span class="i">SafeFileHandle</span>(<span class="i">IntPtr</span>.<span class="i">Zero</span>, <b>false</b>);
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#67f12c3dfa2d9dbd" class="i field">hStdError</a> = <b>new</b> <span class="i">SafeFileHandle</span>(<span class="i">IntPtr</span>.<span class="i">Zero</span>, <b>false</b>);
                <a href="#6527eff70b12c885" class="k">this</a>.<a href="#b3e079acb17504d7" class="i field">cb</a> = <span class="i">Marshal</span>.<span class="i">SizeOf</span>(<a href="#6527eff70b12c885" class="k">this</a>);
            }
 
            <b>public void</b> <a id="48065b129b69fa8b" href="../../R/48065b129b69fa8b.html" target="n" data-glyph="72,2" class="i method">Dispose</a>(<b>bool</b> <span id="r248 rd" class="r248 r">disposing</span>)
            {
                <b>if</b> (<span class="r248 r">disposing</span>)
                {
                    <b>if</b> ((<a href="#6527eff70b12c885" class="k">this</a>.<a href="#8d71d638ce7e1ac3" class="i field">hStdInput</a> != <b>null</b>) &amp;&amp; !<a href="#6527eff70b12c885" class="k">this</a>.<a href="#8d71d638ce7e1ac3" class="i field">hStdInput</a>.<span class="i">IsInvalid</span>)
                    {
                        <a href="#6527eff70b12c885" class="k">this</a>.<a href="#8d71d638ce7e1ac3" class="i field">hStdInput</a>.<span class="i">Dispose</span>();
                        <a href="#6527eff70b12c885" class="k">this</a>.<a href="#8d71d638ce7e1ac3" class="i field">hStdInput</a> = <b>null</b>;
                    }
 
                    <b>if</b> ((<a href="#6527eff70b12c885" class="k">this</a>.<a href="#ca5755f729063b7e" class="i field">hStdOutput</a> != <b>null</b>) &amp;&amp; !<a href="#6527eff70b12c885" class="k">this</a>.<a href="#ca5755f729063b7e" class="i field">hStdOutput</a>.<span class="i">IsInvalid</span>)
                    {
                        <a href="#6527eff70b12c885" class="k">this</a>.<a href="#ca5755f729063b7e" class="i field">hStdOutput</a>.<span class="i">Dispose</span>();
                        <a href="#6527eff70b12c885" class="k">this</a>.<a href="#ca5755f729063b7e" class="i field">hStdOutput</a> = <b>null</b>;
                    }
 
                    <b>if</b> ((<a href="#6527eff70b12c885" class="k">this</a>.<a href="#67f12c3dfa2d9dbd" class="i field">hStdError</a> != <b>null</b>) &amp;&amp; !<a href="#6527eff70b12c885" class="k">this</a>.<a href="#67f12c3dfa2d9dbd" class="i field">hStdError</a>.<span class="i">IsInvalid</span>)
                    {
                        <a href="#6527eff70b12c885" class="k">this</a>.<a href="#67f12c3dfa2d9dbd" class="i field">hStdError</a>.<span class="i">Dispose</span>();
                        <a href="#6527eff70b12c885" class="k">this</a>.<a href="#67f12c3dfa2d9dbd" class="i field">hStdError</a> = <b>null</b>;
                    }
                }
            }
 
            <b>public void</b> <a id="892c1bcb18767584" href="../../R/892c1bcb18767584.html" target="n" data-glyph="72,2" class="i method">Dispose</a>()
            {
                <a href="#48065b129b69fa8b" class="i method">Dispose</a>(<b>true</b>);
            }
        }
    }
 
    <b>internal static class</b> <a id="6e3c4fe570c10009" href="../../R/6e3c4fe570c10009.html" target="n" data-glyph="2,0" class="t t">SafeNativeMethods</a>
    {
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CloseHandleDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">ExactSpelling</span> = <b>true</b>)]
        <b>public static extern bool</b> <a id="43091a488eb6ec3c" href="../../R/43091a488eb6ec3c.html" target="n" data-glyph="72,1" class="i method">CloseHandle</a>(<span class="i">IntPtr</span> <span id="r249 rd" class="r249 r">handle</span>);
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal class</b> <a id="651a518328ac0af1" href="../../R/651a518328ac0af1.html" target="n" data-glyph="2,1" class="t t">PROCESS_INFORMATION</a>
        {
            <b>public</b> <span class="i">IntPtr</span> <a id="bd7d34a7244dcc27" href="../../R/bd7d34a7244dcc27.html" target="n" data-glyph="42,2" class="i field">hProcess</a>;
            <b>public</b> <span class="i">IntPtr</span> <a id="b68857c8439c9668" href="../../R/b68857c8439c9668.html" target="n" data-glyph="42,2" class="i field">hThread</a>;
            <b>public int</b> <a id="c66affb63fdd32cd" href="../../R/c66affb63fdd32cd.html" target="n" data-glyph="42,2" class="i field">dwProcessId</a>;
            <b>public int</b> <a id="99661311f2f0b4b8" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwThreadId</a>;
 
            <b>public</b> <a id="beadfd0fab9ee053" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">PROCESS_INFORMATION</a>()
            {
                <a href="#651a518328ac0af1" class="k">this</a>.<a href="#bd7d34a7244dcc27" class="i field">hProcess</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                <a href="#651a518328ac0af1" class="k">this</a>.<a href="#b68857c8439c9668" class="i field">hThread</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Dispose.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public void</b> <a id="310d0cdcb1ad4cad" href="../../R/310d0cdcb1ad4cad.html" target="n" data-glyph="72,2" class="i method">Dispose</a>()
            {
                <a href="#964566b1c44db6f3" class="i method">Dispose</a>(<b>true</b>);
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Dispose.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r250 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>private void</b> <a id="964566b1c44db6f3" href="../../R/964566b1c44db6f3.html" target="n" data-glyph="76,2" class="i method">Dispose</a>(<b>bool</b> <span id="r250 rd" class="r250 r">disposing</span>)
            {
                <b>if</b> (<span class="r250 r">disposing</span>)
                {
                    <b>if</b> (<a href="#651a518328ac0af1" class="k">this</a>.<a href="#bd7d34a7244dcc27" class="i field">hProcess</a> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <a href="#43091a488eb6ec3c" class="i method">CloseHandle</a>(<a href="#651a518328ac0af1" class="k">this</a>.<a href="#bd7d34a7244dcc27" class="i field">hProcess</a>);
                        <a href="#651a518328ac0af1" class="k">this</a>.<a href="#bd7d34a7244dcc27" class="i field">hProcess</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                    }
 
                    <b>if</b> (<a href="#651a518328ac0af1" class="k">this</a>.<a href="#b68857c8439c9668" class="i field">hThread</a> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                    {
                        <a href="#43091a488eb6ec3c" class="i method">CloseHandle</a>(<a href="#651a518328ac0af1" class="k">this</a>.<a href="#b68857c8439c9668" class="i field">hThread</a>);
                        <a href="#651a518328ac0af1" class="k">this</a>.<a href="#b68857c8439c9668" class="i field">hThread</a> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
                    }
                }
            }
        }
    }
 
    [<span class="i">SuppressUnmanagedCodeSecurity</span>]
    <b>internal sealed class</b> <a id="572b11e461a554ec" href="../../R/572b11e461a554ec.html" target="n" data-glyph="2,0" class="t t">SafeJobHandle</a> : <span class="i">SafeHandleZeroOrMinusOneIsInvalid</span>
    {
        <b>internal</b> <a id="188fb1c5289bbf39" href="../../R/188fb1c5289bbf39.html" target="n" data-glyph="74,1" class="t constructor">SafeJobHandle</a>(<span class="i">IntPtr</span> <span id="r251 rd" class="r251 r">jobHandle</span>)
            : <b>base</b>(<b>true</b>)
        {
            <b>base</b>.<span class="i">SetHandle</span>(<span class="r251 r">jobHandle</span>);
        }
 
        <b>protected override bool</b> <a id="33791285009333c1" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ReleaseHandle</a>()
        {
            <b>return</b> <a href="#6e3c4fe570c10009" class="t t">SafeNativeMethods</a>.<span class="i">CloseHandle</span>(<b>base</b>.<span class="i">handle</span>);
        }
    }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ProcessCommandException
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Non-terminating errors occurring in the process noun commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Serializable</span>]
    <b>public class</b> <a id="f1e517eab4a4dded" href="../../R/f1e517eab4a4dded.html" target="n" data-glyph="0,0" class="t t">ProcessCommandException</a> : <span class="i">SystemException</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctors
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Unimplemented standard constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Doesn&#39;t return.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a id="05cf73a9bd832c51" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ProcessCommandException</a>() : <b>base</b>()
        {
            <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Standard constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r252 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Constructed object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a id="ec36152efebcc7e6" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ProcessCommandException</a>(<b>string</b> <span id="r252 rd" class="r252 r">message</span>) : <b>base</b>(<span class="r252 r">message</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Standard constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r253 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r254 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="aae630274854b5f2" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ProcessCommandException</a>(<b>string</b> <span id="r253 rd" class="r253 r">message</span>, <span class="i">Exception</span> <span id="r254 rd" class="r254 r">innerException</span>)
            : <b>base</b>(<span class="r253 r">message</span>, <span class="r254 r">innerException</span>)
        {
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctors
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Serialization
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serialization constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r255 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r256 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Constructed object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected</b> <a id="8d496349d843d5bd" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">ProcessCommandException</a>(
            <span class="i">SerializationInfo</span> <span id="r255 rd" class="r255 r">info</span>,
            <span class="i">StreamingContext</span> <span id="r256 rd" class="r256 r">context</span>)
            : <b>base</b>(<span class="r255 r">info</span>, <span class="r256 r">context</span>)
        {
            <a href="#e4f263e04d0c1e28" class="i field">_processName</a> = <span class="r255 r">info</span>.<span class="i">GetString</span>(<span class="s">&quot;ProcessName&quot;</span>);
        }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r257 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Serialization information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r258 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Streaming context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="d3ffcc21d03791df" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetObjectData</a>(
            <span class="i">SerializationInfo</span> <span id="r257 rd" class="r257 r">info</span>,
            <span class="i">StreamingContext</span> <span id="r258 rd" class="r258 r">context</span>)
        {
            <b>base</b>.<span class="i">GetObjectData</span>(<span class="r257 r">info</span>, <span class="r258 r">context</span>);
 
            <b>if</b> (<span class="r257 r">info</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r257 r">info</span>));
 
            <span class="r257 r">info</span>.<span class="i">AddValue</span>(<span class="s">&quot;ProcessName&quot;</span>, <a href="#e4f263e04d0c1e28" class="i field">_processName</a>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Serialization
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the process which could not be found or operated upon.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>public string</b> <a id="db53df5ba7416b86" href="../../R/db53df5ba7416b86.html" target="n" data-glyph="102,1" class="i property">ProcessName</a>
        {
            <b>get</b> { <b>return</b> <a href="#e4f263e04d0c1e28" class="i field">_processName</a>; }
 
            <b>set</b> { <a href="#e4f263e04d0c1e28" class="i field">_processName</a> = <b>value</b>; }
        }
 
        <b>private string</b> <a id="e4f263e04d0c1e28" href="../../R/e4f263e04d0c1e28.html" target="n" data-glyph="46,1" class="i field">_processName</a> = <b>string</b>.<span class="i">Empty</span>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Properties
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ProcessCommandException
}
</pre></td></tr></table></div></body></html>
