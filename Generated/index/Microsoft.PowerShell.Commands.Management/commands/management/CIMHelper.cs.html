<!DOCTYPE html>
<html><head><title>CIMHelper.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(331);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management/commands/management/CIMHelper.cs" target="_top">commands\management\CIMHelper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.Commands.Management" target="_top">src\Microsoft.PowerShell.Commands.Management\Microsoft.PowerShell.Commands.Management.csproj</a> (Microsoft.PowerShell.Commands.Management)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Reflection</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <b>using</b> <span class="i n">Extensions</span>;
 
    <b>internal static class</b> <a id="37b99d2cc39c6c42" href="../../R/37b99d2cc39c6c42.html" target="n" data-glyph="2,0" class="t t">CIMHelper</a>
    {
        <b>internal static class</b> <a id="a73b32b6b67af7b1" href="../../R/a73b32b6b67af7b1.html" target="n" data-glyph="2,1" class="t t">ClassNames</a>
        {
            <b>internal const string</b> <a id="469bee94dd2e0bc8" href="../../R/469bee94dd2e0bc8.html" target="n" data-glyph="8,2" class="i field">OperatingSystem</a> = <span class="s">&quot;Win32_OperatingSystem&quot;</span>;
            <b>internal const string</b> <a id="126d3ce0c9bce43d" href="../../R/126d3ce0c9bce43d.html" target="n" data-glyph="8,2" class="i field">PageFileUsage</a> = <span class="s">&quot;Win32_PageFileUsage&quot;</span>;
            <b>internal const string</b> <a id="f638714012e05286" href="../../R/f638714012e05286.html" target="n" data-glyph="8,2" class="i field">Bios</a> = <span class="s">&quot;Win32_BIOS&quot;</span>;
            <b>internal const string</b> <a id="495e8669dc8910dd" href="../../R/495e8669dc8910dd.html" target="n" data-glyph="8,2" class="i field">BaseBoard</a> = <span class="s">&quot;Win32_BaseBoard&quot;</span>;
            <b>internal const string</b> <a id="f8495129f17f0526" href="../../R/f8495129f17f0526.html" target="n" data-glyph="8,2" class="i field">ComputerSystem</a> = <span class="s">&quot;Win32_ComputerSystem&quot;</span>;
            <b>internal const string</b> <a id="bb8297228be790cb" href="../../R/bb8297228be790cb.html" target="n" data-glyph="8,2" class="i field">Keyboard</a> = <span class="s">&quot;Win32_Keyboard&quot;</span>;
            <b>internal const string</b> <a id="0c05446d33b57aab" href="../../R/0c05446d33b57aab.html" target="n" data-glyph="8,2" class="i field">DeviceGuard</a> = <span class="s">&quot;Win32_DeviceGuard&quot;</span>;
            <b>internal const string</b> <a id="f3ac45afea0f1645" href="../../R/f3ac45afea0f1645.html" target="n" data-glyph="8,2" class="i field">HotFix</a> = <span class="s">&quot;Win32_QuickFixEngineering&quot;</span>;
            <b>internal const string</b> <a id="2f258cfa6d558a7f" href="../../R/2f258cfa6d558a7f.html" target="n" data-glyph="8,2" class="i field">MicrosoftNetworkAdapter</a> = <span class="s">&quot;MSFT_NetAdapter&quot;</span>;
            <b>internal const string</b> <a id="7d4fabde11df6c75" href="../../R/7d4fabde11df6c75.html" target="n" data-glyph="8,2" class="i field">NetworkAdapter</a> = <span class="s">&quot;Win32_NetworkAdapter&quot;</span>;
            <b>internal const string</b> <a id="df0992dca412ab4f" href="../../R/df0992dca412ab4f.html" target="n" data-glyph="8,2" class="i field">NetworkAdapterConfiguration</a> = <span class="s">&quot;Win32_NetworkAdapterConfiguration&quot;</span>;
            <b>internal const string</b> <a id="3fcd9458f9549a3d" href="../../R/3fcd9458f9549a3d.html" target="n" data-glyph="8,2" class="i field">Processor</a> = <span class="s">&quot;Win32_Processor&quot;</span>;
            <b>internal const string</b> <a id="3d509921dbe21b6b" href="../../R/../../0000000000.html" target="n" data-glyph="8,2" class="i field">PhysicalMemory</a> = <span class="s">&quot;Win32_PhysicalMemory&quot;</span>;
            <b>internal const string</b> <a id="0f91d1e64e385b8d" href="../../R/../../0000000000.html" target="n" data-glyph="8,2" class="i field">TimeZone</a> = <span class="s">&quot;Win32_TimeZone&quot;</span>;
        }
 
        <b>internal const string</b> <a id="9a13cbdc0323c7e0" href="../../R/9a13cbdc0323c7e0.html" target="n" data-glyph="8,1" class="i field">DefaultNamespace</a> = <span class="s">@&quot;root\cimv2&quot;</span>;
        <b>internal const string</b> <a id="52316a079bd87bf2" href="../../R/52316a079bd87bf2.html" target="n" data-glyph="8,1" class="i field">DeviceGuardNamespace</a> = <span class="s">@&quot;root\Microsoft\Windows\DeviceGuard&quot;</span>;
        <b>internal const string</b> <a id="1729a75ecfc0526a" href="../../R/1729a75ecfc0526a.html" target="n" data-glyph="8,1" class="i field">MicrosoftNetworkAdapterNamespace</a> = <span class="s">&quot;root/StandardCimv2&quot;</span>;
        <b>internal const string</b> <a id="b7ade2e7a1eb4694" href="../../R/b7ade2e7a1eb4694.html" target="n" data-glyph="8,1" class="i field">DefaultQueryDialect</a> = <span class="s">&quot;WQL&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a WQL query string to retrieve all properties from</span>
        <span class="c">///</span><span class="c"> the specified WMI class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">from</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A string containing the WMI class name.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string containing the WQL query string</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="c876350c89bc547d" href="../../R/c876350c89bc547d.html" target="n" data-glyph="74,1" class="i method">WqlQueryAll</a>(<b>string</b> <span id="r0 rd" class="r0 r">from</span>)
        {
            <b>return</b> <span class="s">&quot;SELECT * from &quot;</span> + <span class="r0 r">from</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve a new object of type T, whose properties and fields are</span>
        <span class="c">///</span><span class="c"> populated from an instance of the named WMI class. If the CIM</span>
        <span class="c">///</span><span class="c"> query results in multiple instances, only the first instance is</span>
        <span class="c">///</span><span class="c"> returned.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type of the object to be created. Must be a default-constructable</span>
        <span class="c">///</span><span class="c"> reference type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The CIM session to be queried.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">nameSpace</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string containing the namespace to run the query against</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">wmiClassName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string containing the name of the WMI class from which to populate</span>
        <span class="c">///</span><span class="c"> the resultant object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A new object of type T if successful, null otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method matches property and field names of type T with identically</span>
        <span class="c">///</span><span class="c"> named properties in the WMI class instance. The WMI property is converted</span>
        <span class="c">///</span><span class="c"> to the type of T&#39;s property or field.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="r1 r t">T</span> <a id="997b142c7c00157d" href="../../R/997b142c7c00157d.html" target="n" data-glyph="74,1" class="i method">GetFirst</a>&lt;<span id="r1 rd t" class="r1 r t">T</span>&gt;(<span class="i">CimSession</span> <span id="r2 rd" class="r2 r">session</span>, <b>string</b> <span id="r3 rd" class="r3 r">nameSpace</span>, <b>string</b> <span id="r4 rd" class="r4 r">wmiClassName</span>) <b>where</b> <span class="r1 r t">T</span> : <b>class</b>, <b>new</b>()
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r4 r">wmiClassName</span>))
                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<span class="s">&quot;String argument may not be null or empty&quot;</span>, <b>nameof</b>(<span class="r4 r">wmiClassName</span>));
 
            <b>try</b>
            {
                <b>var</b> <span id="r5 rd" class="r5 r">type</span> = <b>typeof</b>(<span class="r1 r t">T</span>);
                <b>const</b> <span class="i">BindingFlags</span> <span id="r6 rd" class="r6 r">binding</span> = <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>;
                <span class="r1 r t">T</span> <span id="r7 rd" class="r7 r">rv</span> = <b>new</b>();
 
                <b>using</b> (<b>var</b> <span id="r8 rd" class="r8 r">instance</span> = <span class="r2 r">session</span>.<a href="#baa28670bcab9478" class="i method">QueryFirstInstance</a>(<span class="r3 r">nameSpace</span>, <a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#c876350c89bc547d" class="i method">WqlQueryAll</a>(<span class="r4 r">wmiClassName</span>)))
                {
                    <a href="#1109ef873d499328" class="i method">SetObjectDataMembers</a>(<span class="r7 r">rv</span>, <span class="r6 r">binding</span>, <span class="r8 r">instance</span>);
                }
 
                <b>return</b> <span class="r7 r">rv</span>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span class="c">/*ex*/</span>)
            {
                <span class="c">// on any error fall through to the null return below</span>
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve an array of new objects of type T, whose properties and fields are</span>
        <span class="c">///</span><span class="c"> populated from an instance of the specified WMI class on the specified CIM</span>
        <span class="c">///</span><span class="c"> session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type of the object to be created. Must be a default-constructable</span>
        <span class="c">///</span><span class="c"> reference type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The CIM session to be queried.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">nameSpace</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string containing the namespace to run the query against</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">wmiClassName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string containing the name of the WMI class from which to populate</span>
        <span class="c">///</span><span class="c"> the resultant array elements.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of new objects of type T if successful, null otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method matches property and field names of type T with identically</span>
        <span class="c">///</span><span class="c"> named properties in the WMI class instance. The WMI property is converted</span>
        <span class="c">///</span><span class="c"> to the type of T&#39;s property or field.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="r9 r t">T</span>[] <a id="d4fc4de28acbfe02" href="../../R/d4fc4de28acbfe02.html" target="n" data-glyph="74,1" class="i method">GetAll</a>&lt;<span id="r9 rd t" class="r9 r t">T</span>&gt;(<span class="i">CimSession</span> <span id="r10 rd" class="r10 r">session</span>, <b>string</b> <span id="r11 rd" class="r11 r">nameSpace</span>, <b>string</b> <span id="r12 rd" class="r12 r">wmiClassName</span>) <b>where</b> <span class="r9 r t">T</span> : <b>class</b>, <b>new</b>()
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r12 r">wmiClassName</span>))
                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<span class="s">&quot;String argument may not be null or empty&quot;</span>, <b>nameof</b>(<span class="r12 r">wmiClassName</span>));
 
            <b>var</b> <span id="r13 rd" class="r13 r">rv</span> = <b>new</b> <span class="i">List</span>&lt;<span class="r9 r t">T</span>&gt;();
 
            <b>try</b>
            {
                <b>var</b> <span id="r14 rd" class="r14 r">instances</span> = <span class="r10 r">session</span>.<a href="#892f39a4485d0044" class="i method">QueryInstances</a>(<span class="r11 r">nameSpace</span>, <a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#c876350c89bc547d" class="i method">WqlQueryAll</a>(<span class="r12 r">wmiClassName</span>));
 
                <b>if</b> (<span class="r14 r">instances</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r15 rd" class="r15 r">type</span> = <b>typeof</b>(<span class="r9 r t">T</span>);
                    <b>const</b> <span class="i">BindingFlags</span> <span id="r16 rd" class="r16 r">binding</span> = <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>;
 
                    <b>foreach</b> (<b>var</b> <span id="r17 rd" class="r17 r">instance</span> <b>in</b> <span class="r14 r">instances</span>)
                    {
                        <span class="r9 r t">T</span> <span id="r18 rd" class="r18 r">objT</span> = <b>new</b>();
 
                        <b>using</b> (<span class="r17 r">instance</span>)
                        {
                            <span class="i">SetObjectDataMembers</span>(<span class="r18 r">objT</span>, <span class="r16 r">binding</span>, <span class="r17 r">instance</span>);
                        }
 
                        <span class="r13 r">rv</span>.<span class="i">Add</span>(<span class="r18 r">objT</span>);
                    }
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span class="c">/*ex*/</span>)
            {
                <span class="c">// on any error we&#39;ll just fall through to the return below</span>
            }
 
            <b>return</b> <span class="r13 r">rv</span>.<span class="i">ToArray</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve an array of new objects of type T, whose properties and fields are</span>
        <span class="c">///</span><span class="c"> populated from an instance of the specified WMI class on the specified CIM</span>
        <span class="c">///</span><span class="c"> session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type of the object to be created. Must be a default-constructable</span>
        <span class="c">///</span><span class="c"> reference type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The CIM session to be queried.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">wmiClassName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string containing the name of the WMI class from which to populate</span>
        <span class="c">///</span><span class="c"> the resultant array elements.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An array of new objects of type T if successful, null otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method matches property and field names of type T with identically</span>
        <span class="c">///</span><span class="c"> named properties in the WMI class instance. The WMI property is converted</span>
        <span class="c">///</span><span class="c"> to the type of T&#39;s property or field.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="r19 r t">T</span>[] <a id="73333d10666db37c" href="../../R/73333d10666db37c.html" target="n" data-glyph="74,1" class="i method">GetAll</a>&lt;<span id="r19 rd t" class="r19 r t">T</span>&gt;(<span class="i">CimSession</span> <span id="r20 rd" class="r20 r">session</span>, <b>string</b> <span id="r21 rd" class="r21 r">wmiClassName</span>) <b>where</b> <span class="r19 r t">T</span> : <b>class</b>, <b>new</b>()
        {
            <b>return</b> <a href="#d4fc4de28acbfe02" class="i method">GetAll</a>&lt;<span class="r19 r t">T</span>&gt;(<span class="r20 r">session</span>, <a href="#9a13cbdc0323c7e0" class="i field">DefaultNamespace</a>, <span class="r21 r">wmiClassName</span>);
        }
 
        <b>internal static void</b> <a id="d897fbdcdc2d9741" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetObjectDataMember</a>(<b>object</b> <span id="r22 rd" class="r22 r">obj</span>, <span class="i">BindingFlags</span> <span id="r23 rd" class="r23 r">binding</span>, <span class="i">CimProperty</span> <span id="r24 rd" class="r24 r">cimProperty</span>)
        {
            <b>var</b> <span id="r25 rd" class="r25 r">type</span> = <span class="r22 r">obj</span>.<span class="i">GetType</span>();
 
            <b>var</b> <span id="r26 rd" class="r26 r">pi</span> = <span class="r25 r">type</span>.<span class="i">GetProperty</span>(<span class="r24 r">cimProperty</span>.<span class="i">Name</span>, <span class="r23 r">binding</span>);
 
            <b>if</b> (<span class="r26 r">pi</span> != <b>null</b> &amp;&amp; <span class="r26 r">pi</span>.<span class="i">CanWrite</span>)
            {
                <span class="r26 r">pi</span>.<span class="i">SetValue</span>(<span class="r22 r">obj</span>, <span class="r24 r">cimProperty</span>.<span class="i">Value</span>, <b>null</b>);
            }
            <b>else</b>
            {
                <b>var</b> <span id="r27 rd" class="r27 r">fi</span> = <span class="r25 r">type</span>.<span class="i">GetField</span>(<span class="r24 r">cimProperty</span>.<span class="i">Name</span>, <span class="r23 r">binding</span>);
 
                <b>if</b> (<span class="r27 r">fi</span> != <b>null</b> &amp;&amp; !<span class="r27 r">fi</span>.<span class="i">IsInitOnly</span>)
                {
                    <span class="r27 r">fi</span>.<span class="i">SetValue</span>(<span class="r22 r">obj</span>, <span class="r24 r">cimProperty</span>.<span class="i">Value</span>);
                }
            }
        }
 
        <b>internal static void</b> <a id="1109ef873d499328" href="../../R/1109ef873d499328.html" target="n" data-glyph="74,1" class="i method">SetObjectDataMembers</a>(<b>object</b> <span id="r28 rd" class="r28 r">obj</span>, <span class="i">BindingFlags</span> <span id="r29 rd" class="r29 r">binding</span>, <span class="i">CimInstance</span> <span id="r30 rd" class="r30 r">instance</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r31 rd" class="r31 r">wmiProp</span> <b>in</b> <span class="r30 r">instance</span>.<span class="i">CimInstanceProperties</span>)
                <span class="i">SetObjectDataMember</span>(<span class="r28 r">obj</span>, <span class="r29 r">binding</span>, <span class="r31 r">wmiProp</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Escape any backslash (\) characters in a path with an additional</span>
        <span class="c">///</span><span class="c"> backslash, allowing the path to be used within a WMI query.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A string that may contain backslash characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A new string in which any backslash characters have been &quot;escaped&quot;</span>
        <span class="c">///</span><span class="c"> by prefacing then with an additional backslash</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="25b8b5af26688367" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">EscapePath</a>(<b>string</b> <span id="r32 rd" class="r32 r">path</span>)
        {
            <b>return</b> <b>string</b>.<span class="i">Join</span>(<span class="s">@&quot;\\&quot;</span>, <span class="r32 r">path</span>.<span class="i">Split</span>(<span class="s">&#39;\\&#39;</span>));
        }
    }
}
 
<b>namespace</b> <span class="i n">Extensions</span>
{
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
 
    <b>internal static class</b> <a id="b16b0cd453952ca9" href="../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">CIMExtensions</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An &quot;overload&quot; of the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimSession</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.QueryInstances</span>
        <span class="c">///</span><span class="c"> method that takes only the namespace and query string as a parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The CimSession to be queried.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">nameSpace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A string containing the namespace to run the query against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">query</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A string containing the query to be run.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An IEnumerable interface that can be used to enumerate the instances</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">IEnumerable</span>&lt;<span class="i">CimInstance</span>&gt; <a id="892f39a4485d0044" href="../../R/892f39a4485d0044.html" target="n" data-glyph="221,1" class="i method">QueryInstances</a>(<b>this</b> <span class="i">CimSession</span> <span id="r33 rd" class="r33 r">session</span>, <b>string</b> <span id="r34 rd" class="r34 r">nameSpace</span>, <b>string</b> <span id="r35 rd" class="r35 r">query</span>)
        {
            <b>return</b> <span class="r33 r">session</span>.<span class="i">QueryInstances</span>(<span class="r34 r">nameSpace</span>, <a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#b7ade2e7a1eb4694" class="i field">DefaultQueryDialect</a>, <span class="r35 r">query</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Execute a CIM query and return only the first instance in the result.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The CimSession to be queried.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">nameSpace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A string containing the namespace to run the query against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">query</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A string containing the query to be run.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimInstance</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object</span>
        <span class="c">///</span><span class="c"> representing the first instance in a query result if successful, null</span>
        <span class="c">///</span><span class="c"> otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">CimInstance</span> <a id="baa28670bcab9478" href="../../R/baa28670bcab9478.html" target="n" data-glyph="221,1" class="i method">QueryFirstInstance</a>(<b>this</b> <span class="i">CimSession</span> <span id="r36 rd" class="r36 r">session</span>, <b>string</b> <span id="r37 rd" class="r37 r">nameSpace</span>, <b>string</b> <span id="r38 rd" class="r38 r">query</span>)
        {
            <b>try</b>
            {
                <b>var</b> <span id="r39 rd" class="r39 r">instances</span> = <span class="r36 r">session</span>.<a href="#892f39a4485d0044" class="i method">QueryInstances</a>(<span class="r37 r">nameSpace</span>, <span class="r38 r">query</span>);
                <b>var</b> <span id="r40 rd" class="r40 r">enumerator</span> = <span class="r39 r">instances</span>.<span class="i">GetEnumerator</span>();
 
                <b>if</b> (<span class="r40 r">enumerator</span>.<span class="i">MoveNext</span>())
                    <b>return</b> <span class="r40 r">enumerator</span>.<span class="i">Current</span>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span class="c">/*ex*/</span>)
            {
                <span class="c">// on any error, fall through to the null return below</span>
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Execute a CIM query and return only the first instance in the result.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The CimSession to be queried.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">query</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A string containing the query to be run.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimInstance</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object</span>
        <span class="c">///</span><span class="c"> representing the first instance in a query result if successful, null</span>
        <span class="c">///</span><span class="c"> otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">CimInstance</span> <a id="1766a59c3c5b9bd9" href="../../R/1766a59c3c5b9bd9.html" target="n" data-glyph="221,1" class="i method">QueryFirstInstance</a>(<b>this</b> <span class="i">CimSession</span> <span id="r41 rd" class="r41 r">session</span>, <b>string</b> <span id="r42 rd" class="r42 r">query</span>)
        {
            <b>return</b> <span class="r41 r">session</span>.<a href="#baa28670bcab9478" class="i method">QueryFirstInstance</a>(<a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#9a13cbdc0323c7e0" class="i field">DefaultNamespace</a>, <span class="r42 r">query</span>);
        }
 
        <b>internal static</b> <span class="r43 r t">T</span> <a id="d99b5e8de724d540" href="../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">GetFirst</a>&lt;<span id="r43 rd t" class="r43 r t">T</span>&gt;(<b>this</b> <span class="i">CimSession</span> <span id="r44 rd" class="r44 r">session</span>, <b>string</b> <span id="r45 rd" class="r45 r">wmiClassName</span>) <b>where</b> <span class="r43 r t">T</span> : <b>class</b>, <b>new</b>()
        {
            <b>return</b> <span class="r44 r">session</span>.<a href="#8db1eb04ae0454af" class="i method">GetFirst</a>&lt;<span class="r43 r t">T</span>&gt;(<a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#9a13cbdc0323c7e0" class="i field">DefaultNamespace</a>, <span class="r45 r">wmiClassName</span>);
        }
 
        <b>internal static</b> <span class="r46 r t">T</span> <a id="8db1eb04ae0454af" href="../../R/8db1eb04ae0454af.html" target="n" data-glyph="221,1" class="i method">GetFirst</a>&lt;<span id="r46 rd t" class="r46 r t">T</span>&gt;(<b>this</b> <span class="i">CimSession</span> <span id="r47 rd" class="r47 r">session</span>, <b>string</b> <span id="r48 rd" class="r48 r">wmiNamespace</span>, <b>string</b> <span id="r49 rd" class="r49 r">wmiClassName</span>) <b>where</b> <span class="r46 r t">T</span> : <b>class</b>, <b>new</b>()
        {
            <b>return</b> <a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#997b142c7c00157d" class="i method">GetFirst</a>&lt;<span class="r46 r t">T</span>&gt;(<span class="r47 r">session</span>, <span class="r48 r">wmiNamespace</span>, <span class="r49 r">wmiClassName</span>);
        }
 
        <b>internal static</b> <span class="r50 r t">T</span>[] <a id="b5b0852690ec940e" href="../../R/b5b0852690ec940e.html" target="n" data-glyph="221,1" class="i method">GetAll</a>&lt;<span id="r50 rd t" class="r50 r t">T</span>&gt;(<b>this</b> <span class="i">CimSession</span> <span id="r51 rd" class="r51 r">session</span>, <b>string</b> <span id="r52 rd" class="r52 r">wmiClassName</span>) <b>where</b> <span class="r50 r t">T</span> : <b>class</b>, <b>new</b>()
        {
            <b>return</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#73333d10666db37c" class="i method">GetAll</a>&lt;<span class="r50 r t">T</span>&gt;(<span class="r51 r">session</span>, <span class="r52 r">wmiClassName</span>);
        }
 
        <b>internal static</b> <span class="r53 r t">T</span>[] <a id="0659d691fd08f5d6" href="../../R/0659d691fd08f5d6.html" target="n" data-glyph="221,1" class="i method">GetAll</a>&lt;<span id="r53 rd t" class="r53 r t">T</span>&gt;(<b>this</b> <span class="i">CimSession</span> <span id="r54 rd" class="r54 r">session</span>, <b>string</b> <span id="r55 rd" class="r55 r">wmiNamespace</span>, <b>string</b> <span id="r56 rd" class="r56 r">wmiClassName</span>) <b>where</b> <span class="r53 r t">T</span> : <b>class</b>, <b>new</b>()
        {
            <b>return</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="#37b99d2cc39c6c42" class="t t">CIMHelper</a>.<a href="#d4fc4de28acbfe02" class="i method">GetAll</a>&lt;<span class="r53 r t">T</span>&gt;(<span class="r54 r">session</span>, <span class="r55 r">wmiNamespace</span>, <span class="r56 r">wmiClassName</span>);
        }
    }
}
</pre></td></tr></table></div></body></html>
