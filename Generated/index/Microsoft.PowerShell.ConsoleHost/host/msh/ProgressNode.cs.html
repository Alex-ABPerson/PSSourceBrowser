<!DOCTYPE html>
<html><head><title>ProgressNode.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(612);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.ConsoleHost/host/msh/ProgressNode.cs" target="_top">host\msh\ProgressNode.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.ConsoleHost" target="_top">src\Microsoft.PowerShell.ConsoleHost\Microsoft.PowerShell.ConsoleHost.csproj</a> (Microsoft.PowerShell.ConsoleHost)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<span class="i n">Internal</span>.<span class="i n">Format</span>;
 
<b>using</b> <span class="i">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> ProgressNode is an augmentation of the ProgressRecord type that adds extra fields for the purposes of tracking</span>
    <span class="c">///</span><span class="c"> outstanding activities received by the host, and rendering them in the console.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal
    class</b>
    <a id="6a20a1285e45ccc4" href="../../R/6a20a1285e45ccc4.html" target="n" data-glyph="2,0" class="t t">ProgressNode</a> : <a href="/System.Management.Automation/A.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicates the various layouts for rendering a particular node.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal
        enum</b>
        <a id="f316e0b274d9a366" href="../../R/f316e0b274d9a366.html" target="n" data-glyph="20,1" class="t t"><span id="64ef0b2db29b1925">RenderStyle</span></a>
        {
            <a id="2cbf587c96745de4" href="../../R/2cbf587c96745de4.html" target="n" data-glyph="24,2" class="i field">Invisible</a> = 0,
            <a id="e1d2757f2d847fd2" href="../../R/e1d2757f2d847fd2.html" target="n" data-glyph="24,2" class="i field">Minimal</a> = 1,
            <a id="803abfda866db9ee" href="../../R/803abfda866db9ee.html" target="n" data-glyph="24,2" class="i field">Compact</a> = 2,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Allocate only one line for displaying the StatusDescription or the CurrentOperation,</span>
            <span class="c">///</span><span class="c"> truncate the rest if the StatusDescription or CurrentOperation doesn&#39;t fit in one line.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="f01fea0f0a17adeb" href="../../R/f01fea0f0a17adeb.html" target="n" data-glyph="24,2" class="i field">Full</a> = 3,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The node will be displayed the same as Full, plus, the whole StatusDescription and CurrentOperation will be displayed (in multiple lines if needed).</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="2d0d71f2562b1743" href="../../R/2d0d71f2562b1743.html" target="n" data-glyph="24,2" class="i field">FullPlus</a> = 4,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The node will be displayed using ANSI escape sequences.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="3be01dd5283725b1" href="../../R/3be01dd5283725b1.html" target="n" data-glyph="24,2" class="i field">Ansi</a> = 5,
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs an instance from a ProgressRecord.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b>
        <a id="bd9293d6aec9d661" href="../../R/bd9293d6aec9d661.html" target="n" data-glyph="74,1" class="t constructor">ProgressNode</a>(<b>long</b> <span id="r0 rd" class="r0 r">sourceId</span>, <a href="/System.Management.Automation/A.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a> <span id="r1 rd" class="r1 r">record</span>)
            : <b>base</b>(<span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#035f9f51bcda9b17" class="i property">ActivityId</a>, <span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#4b85501b44d8e997" class="i property">Activity</a>, <span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#b83bd20609cddaf5" class="i property">RecordType</a> == <a href="/System.Management.Automation/A.html#1f168993cf0b800f" class="t t">ProgressRecordType</a>.<a href="/System.Management.Automation/A.html#b02a1a2b864a452c" class="i field">Processing</a>, <span class="s">&quot;should only create node for Processing records&quot;</span>);
 
            <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#730521203ee4eba0" class="i property">ParentActivityId</a> = <span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#730521203ee4eba0" class="i property">ParentActivityId</a>;
            <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a> = <span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>;
            <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> = <span class="i">Math</span>.<span class="i">Min</span>(<span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a>, 100);
            <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a> = <span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a>;
            <a href="#6a20a1285e45ccc4" class="k">this</a>.<span class="i">RecordType</span> = <span class="r1 r">record</span>.<a href="/System.Management.Automation/A.html#b83bd20609cddaf5" class="i property">RecordType</a>;
 
            <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="#e0a8cd20c1ddf4d4" class="i field">Style</a> = <a href="#9d177bf2fa6cf9ce" class="i method">IsMinimalProgressRenderingEnabled</a>()
                ? <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#3be01dd5283725b1" class="i field">Ansi</a>
                : <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="#e0a8cd20c1ddf4d4" class="i field">Style</a> = <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#2d0d71f2562b1743" class="i field">FullPlus</a>;
 
            <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="#d59c7d8669eac769" class="i field">SourceId</a> = <span class="r0 r">sourceId</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renders a single progress node as strings of text according to that node&#39;s style. The text is appended to the</span>
        <span class="c">///</span><span class="c"> supplied list of strings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">strCollection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of strings to which the node&#39;s rendering will be appended.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">indentation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The indentation level (in BufferCells) at which the node should be rendered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">maxWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The maximum number of BufferCells that the rendering is allowed to consume.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">rawUI</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PSHostRawUserInterface used to gauge string widths in the rendering.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal
        void</b>
        <a id="5c2b9b779e8507b1" href="../../R/5c2b9b779e8507b1.html" target="n" data-glyph="74,1" class="i method">Render</a>(<span class="i">ArrayList</span> <span id="r2 rd" class="r2 r">strCollection</span>, <b>int</b> <span id="r3 rd" class="r3 r">indentation</span>, <b>int</b> <span id="r4 rd" class="r4 r">maxWidth</span>, <a href="/System.Management.Automation/A.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r5 rd" class="r5 r">rawUI</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r2 r">strCollection</span> != <b>null</b>, <span class="s">&quot;strCollection should not be null&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r3 r">indentation</span> &gt;= 0, <span class="s">&quot;indentation is negative&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#b83bd20609cddaf5" class="i property">RecordType</a> != <a href="/System.Management.Automation/A.html#1f168993cf0b800f" class="t t">ProgressRecordType</a>.<a href="/System.Management.Automation/A.html#be29e101fe03f5d0" class="i field">Completed</a>, <span class="s">&quot;should never render completed records&quot;</span>);
 
            <b>switch</b> (<a href="#e0a8cd20c1ddf4d4" class="i field">Style</a>)
            {
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#2d0d71f2562b1743" class="i field">FullPlus</a>:
                    <a href="#53f40d4d83fc7a41" class="i method">RenderFull</a>(<span class="r2 r">strCollection</span>, <span class="r3 r">indentation</span>, <span class="r4 r">maxWidth</span>, <span class="r5 r">rawUI</span>, <span class="r6 r">isFullPlus</span>: <b>true</b>);
                    <b>break</b>;
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#f01fea0f0a17adeb" class="i field">Full</a>:
                    <a href="#53f40d4d83fc7a41" class="i method">RenderFull</a>(<span class="r2 r">strCollection</span>, <span class="r3 r">indentation</span>, <span class="r4 r">maxWidth</span>, <span class="r5 r">rawUI</span>, <span class="r6 r">isFullPlus</span>: <b>false</b>);
                    <b>break</b>;
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#803abfda866db9ee" class="i field">Compact</a>:
                    <a href="#ef1c837d5b65fffe" class="i method">RenderCompact</a>(<span class="r2 r">strCollection</span>, <span class="r3 r">indentation</span>, <span class="r4 r">maxWidth</span>, <span class="r5 r">rawUI</span>);
                    <b>break</b>;
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#e1d2757f2d847fd2" class="i field">Minimal</a>:
                    <a href="#331cee3aa9edb133" class="i method">RenderMinimal</a>(<span class="r2 r">strCollection</span>, <span class="r3 r">indentation</span>, <span class="r4 r">maxWidth</span>, <span class="r5 r">rawUI</span>);
                    <b>break</b>;
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#3be01dd5283725b1" class="i field">Ansi</a>:
                    <a href="#4a129777e45066b4" class="i method">RenderAnsi</a>(<span class="r2 r">strCollection</span>, <span class="r3 r">indentation</span>, <span class="r4 r">maxWidth</span>);
                    <b>break</b>;
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#2cbf587c96745de4" class="i field">Invisible</a>:
                    <span class="c">// do nothing</span>
                    <b>break</b>;
                <b>default</b>:
                    <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;unrecognized RenderStyle value&quot;</span>);
                    <b>break</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renders a node in the &quot;Full&quot; style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">strCollection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of strings to which the node&#39;s rendering will be appended.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">indentation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The indentation level (in BufferCells) at which the node should be rendered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">maxWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The maximum number of BufferCells that the rendering is allowed to consume.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">rawUI</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PSHostRawUserInterface used to gauge string widths in the rendering.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">isFullPlus</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicate if the full StatusDescription and CurrentOperation should be displayed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private
        void</b>
        <a id="53f40d4d83fc7a41" href="../../R/53f40d4d83fc7a41.html" target="n" data-glyph="76,1" class="i method">RenderFull</a>(<span class="i">ArrayList</span> <span id="r7 rd" class="r7 r">strCollection</span>, <b>int</b> <span id="r8 rd" class="r8 r">indentation</span>, <b>int</b> <span id="r9 rd" class="r9 r">maxWidth</span>, <a href="/System.Management.Automation/A.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r10 rd" class="r10 r">rawUI</span>, <b>bool</b> <span id="r6 rd" class="r6 r">isFullPlus</span>)
        {
            <b>string</b> <span id="r11 rd" class="r11 r">indent</span> = <span class="i">StringUtil</span>.<span class="i">Padding</span>(<span class="r8 r">indentation</span>);
 
            <span class="c">// First line: the activity</span>
 
            <span class="r7 r">strCollection</span>.<span class="i">Add</span>(
                <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(
                    <span class="r10 r">rawUI</span>, <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="s">&quot; {0}{1} &quot;</span>, <span class="r11 r">indent</span>, <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#4b85501b44d8e997" class="i property">Activity</a>), <span class="r9 r">maxWidth</span>));
 
            <span class="r8 r">indentation</span> += 3;
            <span class="r11 r">indent</span> = <span class="i">StringUtil</span>.<span class="i">Padding</span>(<span class="r8 r">indentation</span>);
 
            <span class="c">// Second line: the status description</span>
 
            <a href="#b7e3c6d46c673d06" class="i method">RenderFullDescription</a>(<a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>, <span class="r11 r">indent</span>, <span class="r9 r">maxWidth</span>, <span class="r10 r">rawUI</span>, <span class="r7 r">strCollection</span>, <span class="r6 r">isFullPlus</span>);
 
            <span class="c">// Third line: the percentage thermometer. The size of this is proportional to the width we&#39;re allowed</span>
            <span class="c">// to consume. -2 for the whitespace, -2 again for the brackets around thermo, -5 to not be too big</span>
 
            <b>if</b> (<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> &gt;= 0)
            {
                <b>int</b> <span id="r12 rd" class="r12 r">thermoWidth</span> = <span class="i">Math</span>.<span class="i">Max</span>(3, <span class="r9 r">maxWidth</span> - <span class="r8 r">indentation</span> - 2 - 2 - 5);
                <b>int</b> <span id="r13 rd" class="r13 r">mercuryWidth</span> = 0;
                <span class="r13 r">mercuryWidth</span> = <a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> * <span class="r12 r">thermoWidth</span> / 100;
                <b>if</b> (<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> &lt; 100 &amp;&amp; <span class="r13 r">mercuryWidth</span> == <span class="r12 r">thermoWidth</span>)
                {
                    <span class="c">// back off a tad unless we&#39;re totally complete to prevent the appearance of completion before</span>
                    <span class="c">// the fact.</span>
 
                    --<span class="r13 r">mercuryWidth</span>;
                }
 
                <span class="r7 r">strCollection</span>.<span class="i">Add</span>(
                    <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(
                        <span class="r10 r">rawUI</span>,
                        <span class="i">StringUtil</span>.<span class="i">Format</span>(
                            <span class="s">&quot; {0}[{1}{2}] &quot;</span>,
                            <span class="r11 r">indent</span>,
                            <b>new</b> <b>string</b>(<span class="s">&#39;o&#39;</span>, <span class="r13 r">mercuryWidth</span>),
                            <span class="i">StringUtil</span>.<span class="i">Padding</span>(<span class="r12 r">thermoWidth</span> - <span class="r13 r">mercuryWidth</span>)),
                        <span class="r9 r">maxWidth</span>));
            }
 
            <span class="c">// Fourth line: the seconds remaining</span>
 
            <b>if</b> (<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a> &gt;= 0)
            {
                <span class="i">TimeSpan</span> <span id="r14 rd" class="r14 r">span</span> = <b>new</b> <span class="i">TimeSpan</span>(0, 0, <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a>);
 
                <span class="r7 r">strCollection</span>.<span class="i">Add</span>(
                    <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(
                        <span class="r10 r">rawUI</span>,
                        <span class="s">&quot; &quot;</span>
                        + <span class="i">StringUtil</span>.<span class="i">Format</span>(
                            <span class="i">ProgressNodeStrings</span>.<span class="i">SecondsRemaining</span>,
                            <span class="r11 r">indent</span>,
                            <span class="r14 r">span</span>)
                        + <span class="s">&quot; &quot;</span>,
                    <span class="r9 r">maxWidth</span>));
            }
 
            <span class="c">// Fifth and Sixth lines: The current operation</span>
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>))
            {
                <span class="r7 r">strCollection</span>.<span class="i">Add</span>(<span class="s">&quot; &quot;</span>);
                <a href="#b7e3c6d46c673d06" class="i method">RenderFullDescription</a>(<a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>, <span class="r11 r">indent</span>, <span class="r9 r">maxWidth</span>, <span class="r10 r">rawUI</span>, <span class="r7 r">strCollection</span>, <span class="r6 r">isFullPlus</span>);
            }
        }
 
        <b>private static void</b> <a id="b7e3c6d46c673d06" href="../../R/b7e3c6d46c673d06.html" target="n" data-glyph="76,1" class="i method">RenderFullDescription</a>(<b>string</b> <span id="r15 rd" class="r15 r">description</span>, <b>string</b> <span id="r16 rd" class="r16 r">indent</span>, <b>int</b> <span id="r17 rd" class="r17 r">maxWidth</span>, <a href="/System.Management.Automation/A.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r18 rd" class="r18 r">rawUi</span>, <span class="i">ArrayList</span> <span id="r19 rd" class="r19 r">strCollection</span>, <b>bool</b> <span id="r20 rd" class="r20 r">isFullPlus</span>)
        {
            <b>string</b> <span id="r21 rd" class="r21 r">oldDescription</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="s">&quot; {0}{1} &quot;</span>, <span class="r16 r">indent</span>, <span class="r15 r">description</span>);
            <b>string</b> <span id="r22 rd" class="r22 r">newDescription</span>;
 
            <b>do</b>
            {
                <span class="r22 r">newDescription</span> = <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(<span class="r18 r">rawUi</span>, <span class="r21 r">oldDescription</span>, <span class="r17 r">maxWidth</span>);
                <span class="r19 r">strCollection</span>.<span class="i">Add</span>(<span class="r22 r">newDescription</span>);
 
                <b>if</b> (<span class="r21 r">oldDescription</span>.<span class="i">Length</span> == <span class="r22 r">newDescription</span>.<span class="i">Length</span>)
                {
                    <b>break</b>;
                }
                <b>else</b>
                {
                    <span class="r21 r">oldDescription</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="s">&quot; {0}{1}&quot;</span>, <span class="r16 r">indent</span>, <span class="r21 r">oldDescription</span>.<span class="i">Substring</span>(<span class="r22 r">newDescription</span>.<span class="i">Length</span>));
                }
            } <b>while</b> (<span class="r20 r">isFullPlus</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renders a node in the &quot;Compact&quot; style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">strCollection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of strings to which the node&#39;s rendering will be appended.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">indentation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The indentation level (in BufferCells) at which the node should be rendered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">maxWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The maximum number of BufferCells that the rendering is allowed to consume.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">rawUI</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PSHostRawUserInterface used to gauge string widths in the rendering.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private
        void</b>
        <a id="ef1c837d5b65fffe" href="../../R/ef1c837d5b65fffe.html" target="n" data-glyph="76,1" class="i method">RenderCompact</a>(<span class="i">ArrayList</span> <span id="r23 rd" class="r23 r">strCollection</span>, <b>int</b> <span id="r24 rd" class="r24 r">indentation</span>, <b>int</b> <span id="r25 rd" class="r25 r">maxWidth</span>, <a href="/System.Management.Automation/A.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r26 rd" class="r26 r">rawUI</span>)
        {
            <b>string</b> <span id="r27 rd" class="r27 r">indent</span> = <span class="i">StringUtil</span>.<span class="i">Padding</span>(<span class="r24 r">indentation</span>);
 
            <span class="c">// First line: the activity</span>
 
            <span class="r23 r">strCollection</span>.<span class="i">Add</span>(
                <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(
                    <span class="r26 r">rawUI</span>,
                    <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="s">&quot; {0}{1} &quot;</span>, <span class="r27 r">indent</span>, <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#4b85501b44d8e997" class="i property">Activity</a>), <span class="r25 r">maxWidth</span>));
 
            <span class="r24 r">indentation</span> += 3;
            <span class="r27 r">indent</span> = <span class="i">StringUtil</span>.<span class="i">Padding</span>(<span class="r24 r">indentation</span>);
 
            <span class="c">// Second line: the status description with percentage and time remaining, if applicable.</span>
 
            <b>string</b> <span id="r28 rd" class="r28 r">percent</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> &gt;= 0)
            {
                <span class="r28 r">percent</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="s">&quot;{0}% &quot;</span>, <a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a>);
            }
 
            <b>string</b> <span id="r29 rd" class="r29 r">secRemain</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a> &gt;= 0)
            {
                <span class="i">TimeSpan</span> <span id="r30 rd" class="r30 r">span</span> = <b>new</b> <span class="i">TimeSpan</span>(0, 0, <a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a>);
                <span class="r29 r">secRemain</span> = <span class="r30 r">span</span>.<span class="i">ToString</span>() + <span class="s">&quot; &quot;</span>;
            }
 
            <span class="r23 r">strCollection</span>.<span class="i">Add</span>(
                <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(
                    <span class="r26 r">rawUI</span>,
                    <span class="i">StringUtil</span>.<span class="i">Format</span>(
                        <span class="s">&quot; {0}{1}{2}{3} &quot;</span>,
                        <span class="r27 r">indent</span>,
                        <span class="r28 r">percent</span>,
                        <span class="r29 r">secRemain</span>,
                        <a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>),
                    <span class="r25 r">maxWidth</span>));
 
            <span class="c">// Third line: The current operation</span>
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>))
            {
                <span class="r23 r">strCollection</span>.<span class="i">Add</span>(
                    <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(
                        <span class="r26 r">rawUI</span>,
                        <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="s">&quot; {0}{1} &quot;</span>, <span class="r27 r">indent</span>, <a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>), <span class="r25 r">maxWidth</span>));
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renders a node in the &quot;Minimal&quot; style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">strCollection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of strings to which the node&#39;s rendering will be appended.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">indentation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The indentation level (in BufferCells) at which the node should be rendered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">maxWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The maximum number of BufferCells that the rendering is allowed to consume.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">rawUI</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The PSHostRawUserInterface used to gauge string widths in the rendering.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private
        void</b>
        <a id="331cee3aa9edb133" href="../../R/331cee3aa9edb133.html" target="n" data-glyph="76,1" class="i method">RenderMinimal</a>(<span class="i">ArrayList</span> <span id="r31 rd" class="r31 r">strCollection</span>, <b>int</b> <span id="r32 rd" class="r32 r">indentation</span>, <b>int</b> <span id="r33 rd" class="r33 r">maxWidth</span>, <a href="/System.Management.Automation/A.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r34 rd" class="r34 r">rawUI</span>)
        {
            <b>string</b> <span id="r35 rd" class="r35 r">indent</span> = <span class="i">StringUtil</span>.<span class="i">Padding</span>(<span class="r32 r">indentation</span>);
 
            <span class="c">// First line: Everything mushed into one line</span>
 
            <b>string</b> <span id="r36 rd" class="r36 r">percent</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> &gt;= 0)
            {
                <span class="r36 r">percent</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="s">&quot;{0}% &quot;</span>, <a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a>);
            }
 
            <b>string</b> <span id="r37 rd" class="r37 r">secRemain</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a> &gt;= 0)
            {
                <span class="i">TimeSpan</span> <span id="r38 rd" class="r38 r">span</span> = <b>new</b> <span class="i">TimeSpan</span>(0, 0, <a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a>);
                <span class="r37 r">secRemain</span> = <span class="r38 r">span</span>.<span class="i">ToString</span>() + <span class="s">&quot; &quot;</span>;
            }
 
            <span class="r31 r">strCollection</span>.<span class="i">Add</span>(
                <span class="i">StringUtil</span>.<span class="i">TruncateToBufferCellWidth</span>(
                    <span class="r34 r">rawUI</span>,
                    <span class="i">StringUtil</span>.<span class="i">Format</span>(
                        <span class="s">&quot; {0}{1} {2}{3}{4} &quot;</span>,
                        <span class="r35 r">indent</span>,
                        <a href="/System.Management.Automation/A.html#4b85501b44d8e997" class="i property">Activity</a>,
                        <span class="r36 r">percent</span>,
                        <span class="r37 r">secRemain</span>,
                        <a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>),
                    <span class="r33 r">maxWidth</span>));
        }
 
        <b>internal static bool</b> <a id="9d177bf2fa6cf9ce" href="../../R/9d177bf2fa6cf9ce.html" target="n" data-glyph="74,1" class="i method">IsMinimalProgressRenderingEnabled</a>()
        {
            <b>return</b> <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#c2a3cad5bce5e8e3" class="i property">Progress</a>.<a href="/System.Management.Automation/A.html#846219c81508d00e" class="i property">View</a> == <a href="/System.Management.Automation/A.html#7a61b08f2e68222d" class="t t">ProgressView</a>.<a href="/System.Management.Automation/A.html#d7d65dcedf91bb81" class="i field">Minimal</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renders a node in the &quot;ANSI&quot; style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">strCollection</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of strings to which the node&#39;s rendering will be appended.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">indentation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The indentation level in chars at which the node should be rendered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">maxWidth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The maximum number of chars that the rendering is allowed to consume.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private
        void</b>
        <a id="4a129777e45066b4" href="../../R/4a129777e45066b4.html" target="n" data-glyph="76,1" class="i method">RenderAnsi</a>(<span class="i">ArrayList</span> <span id="r39 rd" class="r39 r">strCollection</span>, <b>int</b> <span id="r40 rd" class="r40 r">indentation</span>, <b>int</b> <span id="r41 rd" class="r41 r">maxWidth</span>)
        {
            <b>string</b> <span id="r42 rd" class="r42 r">indent</span> = <span class="i">StringUtil</span>.<span class="i">Padding</span>(<span class="r40 r">indentation</span>);
            <b>string</b> <span id="r43 rd" class="r43 r">secRemain</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a> &gt;= 0)
            {
                <span class="r43 r">secRemain</span> = <a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a>.<span class="i">ToString</span>() + <span class="s">&quot;s&quot;</span>;
            }
 
            <b>int</b> <span id="r44 rd" class="r44 r">secRemainLength</span> = <span class="r43 r">secRemain</span>.<span class="i">Length</span> + 1;
 
            <span class="c">// limit progress bar to 120 chars as no need to render full width</span>
            <b>if</b> (<a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#c2a3cad5bce5e8e3" class="i property">Progress</a>.<a href="/System.Management.Automation/A.html#f229877feb331b9f" class="i property">MaxWidth</a> &gt; 0 &amp;&amp; <span class="r41 r">maxWidth</span> &gt; <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#c2a3cad5bce5e8e3" class="i property">Progress</a>.<a href="/System.Management.Automation/A.html#f229877feb331b9f" class="i property">MaxWidth</a>)
            {
                <span class="r41 r">maxWidth</span> = <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#c2a3cad5bce5e8e3" class="i property">Progress</a>.<a href="/System.Management.Automation/A.html#f229877feb331b9f" class="i property">MaxWidth</a>;
            }
 
            <span class="c">// if the activity is really long, only use up to half the width</span>
            <b>string</b> <span id="r45 rd" class="r45 r">activity</span>;
            <b>if</b> (<a href="/System.Management.Automation/A.html#4b85501b44d8e997" class="i property">Activity</a>.<span class="i">Length</span> &gt; <span class="r41 r">maxWidth</span> / 2)
            {
                <span class="r45 r">activity</span> = <a href="/System.Management.Automation/A.html#4b85501b44d8e997" class="i property">Activity</a>.<span class="i">Substring</span>(0, <span class="r41 r">maxWidth</span> / 2) + <span class="i">PSObjectHelper</span>.<span class="i">Ellipsis</span>;
            }
            <b>else</b>
            {
                <span class="r45 r">activity</span> = <a href="/System.Management.Automation/A.html#4b85501b44d8e997" class="i property">Activity</a>;
            }
 
            <span class="c">// 4 is for the extra space and square brackets below and one extra space</span>
            <b>int</b> <span id="r46 rd" class="r46 r">barWidth</span> = <span class="r41 r">maxWidth</span> - <span class="r45 r">activity</span>.<span class="i">Length</span> - <span class="r40 r">indentation</span> - 4;
 
            <b>var</b> <span id="r47 rd" class="r47 r">sb</span> = <b>new</b> <span class="i">StringBuilder</span>();
            <b>int</b> <span id="r48 rd" class="r48 r">padding</span> = <span class="r41 r">maxWidth</span> + <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#c2a3cad5bce5e8e3" class="i property">Progress</a>.<a href="/System.Management.Automation/A.html#9e674efb9ebd3763" class="i property">Style</a>.<span class="i">Length</span> + <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#e101fa5c023b5a83" class="i property">Reverse</a>.<span class="i">Length</span> + <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#e45d5a3c6ebef3ee" class="i property">ReverseOff</a>.<span class="i">Length</span>;
            <span class="r47 r">sb</span>.<span class="i">Append</span>(<a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#e101fa5c023b5a83" class="i property">Reverse</a>);
 
            <b>int</b> <span id="r49 rd" class="r49 r">maxStatusLength</span> = <span class="r46 r">barWidth</span> - <span class="r44 r">secRemainLength</span> - 1;
            <b>if</b> (<span class="r49 r">maxStatusLength</span> &gt; 0 &amp;&amp; <a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>.<span class="i">Length</span> &gt; <span class="r46 r">barWidth</span> - <span class="r44 r">secRemainLength</span>)
            {
                <span class="r47 r">sb</span>.<span class="i">Append</span>(<a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>.<span class="i">AsSpan</span>(0, <span class="r46 r">barWidth</span> - <span class="r44 r">secRemainLength</span> - 1));
                <span class="r47 r">sb</span>.<span class="i">Append</span>(<span class="i">PSObjectHelper</span>.<span class="i">Ellipsis</span>);
            }
            <b>else</b>
            {
                <span class="r47 r">sb</span>.<span class="i">Append</span>(<a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>);
            }
 
            <b>int</b> <span id="r50 rd" class="r50 r">emptyPadLength</span> = <span class="r46 r">barWidth</span> + <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#e101fa5c023b5a83" class="i property">Reverse</a>.<span class="i">Length</span> - <span class="r47 r">sb</span>.<span class="i">Length</span> - <span class="r44 r">secRemainLength</span>;
            <b>if</b> (<span class="r50 r">emptyPadLength</span> &gt; 0)
            {
                <span class="r47 r">sb</span>.<span class="i">Append</span>(<b>string</b>.<span class="i">Empty</span>.<span class="i">PadRight</span>(<span class="r50 r">emptyPadLength</span>));
            }
 
            <span class="r47 r">sb</span>.<span class="i">Append</span>(<span class="r43 r">secRemain</span>);
 
            <b>if</b> (<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> &gt; 0 &amp;&amp; <a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> &lt; 100 &amp;&amp; <span class="r46 r">barWidth</span> &gt; 0)
            {
                <b>int</b> <span id="r51 rd" class="r51 r">barLength</span> = <a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> * <span class="r46 r">barWidth</span> / 100;
                <b>if</b> (<span class="r51 r">barLength</span> &gt;= <span class="r46 r">barWidth</span>)
                {
                    <span class="r51 r">barLength</span> = <span class="r46 r">barWidth</span> - 1;
                }
 
                <b>if</b> (<span class="r51 r">barLength</span> &lt; <span class="r47 r">sb</span>.<span class="i">Length</span>)
                {
                    <span class="r47 r">sb</span>.<span class="i">Insert</span>(<span class="r51 r">barLength</span> + <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#e101fa5c023b5a83" class="i property">Reverse</a>.<span class="i">Length</span>, <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#e45d5a3c6ebef3ee" class="i property">ReverseOff</a>);
                }
            }
            <b>else</b>
            {
                <span class="r47 r">sb</span>.<span class="i">Append</span>(<a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#e45d5a3c6ebef3ee" class="i property">ReverseOff</a>);
            }
 
            <span class="r39 r">strCollection</span>.<span class="i">Add</span>(
                <span class="i">StringUtil</span>.<span class="i">Format</span>(
                    <span class="s">&quot;{0}{1}{2} [{3}]{4}&quot;</span>,
                    <span class="r42 r">indent</span>,
                    <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#c2a3cad5bce5e8e3" class="i property">Progress</a>.<a href="/System.Management.Automation/A.html#9e674efb9ebd3763" class="i property">Style</a>,
                    <span class="r45 r">activity</span>,
                    <span class="r47 r">sb</span>.<span class="i">ToString</span>(),
                    <a href="/System.Management.Automation/A.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="/System.Management.Automation/A.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="/System.Management.Automation/A.html#0b1059dd37953926" class="i property">Reset</a>)
                .<span class="i">PadRight</span>(<span class="r48 r">padding</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The nodes that have this node as their parent.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b>
        <span class="i">ArrayList</span>
        <a id="41bbda2b04dd427e" href="../../R/41bbda2b04dd427e.html" target="n" data-glyph="44,1" class="i field">Children</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The &quot;age&quot; of the node.  A node&#39;s age is incremented by PendingProgress.Update each time a new ProgressRecord is</span>
        <span class="c">///</span><span class="c"> received by the host. A node&#39;s age is reset when a corresponding ProgressRecord is received.  Thus, the age of</span>
        <span class="c">///</span><span class="c"> a node reflects the number of ProgressRecord that have been received since the node was last updated.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The age is used by PendingProgress.Render to determine which nodes should be rendered on the display, and how. As the</span>
        <span class="c">///</span><span class="c"> display has finite size, it may be possible to have many more outstanding progress activities than will fit in that</span>
        <span class="c">///</span><span class="c"> space. The rendering of nodes can be progressively &quot;compressed&quot; into a more terse format, or not rendered at all in</span>
        <span class="c">///</span><span class="c"> order to fit as many nodes as possible in the available space. The oldest nodes are compressed or skipped first.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal
        int</b>
        <a id="49ddd719949c9e90" href="../../R/49ddd719949c9e90.html" target="n" data-glyph="44,1" class="i field">Age</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The style in which this node should be rendered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b>
        <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>
        <a id="e0a8cd20c1ddf4d4" href="../../R/e0a8cd20c1ddf4d4.html" target="n" data-glyph="44,1" class="i field">Style</a> = <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#2d0d71f2562b1743" class="i field">FullPlus</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Identifies the source of the progress record.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal
        long</b>
        <a id="d59c7d8669eac769" href="../../R/d59c7d8669eac769.html" target="n" data-glyph="44,1" class="i field">SourceId</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of vertical BufferCells that are required to render the node in its current style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal int</b> <a id="e3e38c61af1f9a3e" href="../../R/e3e38c61af1f9a3e.html" target="n" data-glyph="74,1" class="i method">LinesRequiredMethod</a>(<a href="/System.Management.Automation/A.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r52 rd" class="r52 r">rawUi</span>, <b>int</b> <span id="r53 rd" class="r53 r">maxWidth</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<a href="#6a20a1285e45ccc4" class="k">this</a>.<a href="/System.Management.Automation/A.html#b83bd20609cddaf5" class="i property">RecordType</a> != <a href="/System.Management.Automation/A.html#1f168993cf0b800f" class="t t">ProgressRecordType</a>.<a href="/System.Management.Automation/A.html#be29e101fe03f5d0" class="i field">Completed</a>, <span class="s">&quot;should never render completed records&quot;</span>);
 
            <b>switch</b> (<a href="#e0a8cd20c1ddf4d4" class="i field">Style</a>)
            {
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#2d0d71f2562b1743" class="i field">FullPlus</a>:
                    <b>return</b> <a href="#2c5fc892cdd9fc2a" class="i method">LinesRequiredInFullStyleMethod</a>(<span class="r52 r">rawUi</span>, <span class="r53 r">maxWidth</span>, <span class="r54 r">isFullPlus</span>: <b>true</b>);
 
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#f01fea0f0a17adeb" class="i field">Full</a>:
                    <b>return</b> <a href="#2c5fc892cdd9fc2a" class="i method">LinesRequiredInFullStyleMethod</a>(<span class="r52 r">rawUi</span>, <span class="r53 r">maxWidth</span>, <span class="r54 r">isFullPlus</span>: <b>false</b>);
 
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#803abfda866db9ee" class="i field">Compact</a>:
                    <b>return</b> <a href="#0b530ad89bc91cac" class="i property">LinesRequiredInCompactStyle</a>;
 
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#e1d2757f2d847fd2" class="i field">Minimal</a>:
                    <b>return</b> 1;
 
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#2cbf587c96745de4" class="i field">Invisible</a>:
                    <b>return</b> 0;
 
                <b>case</b> <a href="#f316e0b274d9a366" class="t t">RenderStyle</a>.<a href="#3be01dd5283725b1" class="i field">Ansi</a>:
                    <b>return</b> 1;
 
                <b>default</b>:
                    <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>false</b>, <span class="s">&quot;Unknown RenderStyle value&quot;</span>);
                    <b>break</b>;
            }
 
            <b>return</b> 0;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of vertical BufferCells that are required to render the node in the Full style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>private int</b> <a id="2c5fc892cdd9fc2a" href="../../R/2c5fc892cdd9fc2a.html" target="n" data-glyph="76,1" class="i method">LinesRequiredInFullStyleMethod</a>(<a href="/System.Management.Automation/A.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r55 rd" class="r55 r">rawUi</span>, <b>int</b> <span id="r56 rd" class="r56 r">maxWidth</span>, <b>bool</b> <span id="r54 rd" class="r54 r">isFullPlus</span>)
        {
            <span class="c">// Since the fields of this instance could have been changed, we compute this on-the-fly.</span>
 
            <span class="c">// NTRAID#Windows OS Bugs-1062104-2004/12/15-sburns we assume 1 line for each field.  If we ever need to</span>
            <span class="c">// word-wrap text fields, then this calculation will need updating.</span>
 
            <span class="c">// Start with 1 for the Activity</span>
            <b>int</b> <span id="r57 rd" class="r57 r">lines</span> = 1;
            <span class="c">// Use 5 spaces as the heuristic indent. 5 spaces stand for the indent for the CurrentOperation of the first-level child node</span>
            <b>var</b> <span id="r58 rd" class="r58 r">indent</span> = <span class="i">StringUtil</span>.<span class="i">Padding</span>(5);
            <b>var</b> <span id="r59 rd" class="r59 r">temp</span> = <b>new</b> <span class="i">ArrayList</span>();
 
            <b>if</b> (<span class="r54 r">isFullPlus</span>)
            {
                <span class="r59 r">temp</span>.<span class="i">Clear</span>();
                <a href="#b7e3c6d46c673d06" class="i method">RenderFullDescription</a>(<a href="/System.Management.Automation/A.html#7b8dea277788f5cd" class="i property">StatusDescription</a>, <span class="r58 r">indent</span>, <span class="r56 r">maxWidth</span>, <span class="r55 r">rawUi</span>, <span class="r59 r">temp</span>, <span class="r20 r">isFullPlus</span>: <b>true</b>);
                <span class="r57 r">lines</span> += <span class="r59 r">temp</span>.<span class="i">Count</span>;
            }
            <b>else</b>
            {
                <span class="c">// 1 for the Status</span>
                <span class="r57 r">lines</span>++;
            }
 
            <b>if</b> (<a href="/System.Management.Automation/A.html#7c559492a0012510" class="i property">PercentComplete</a> &gt;= 0)
            {
                ++<span class="r57 r">lines</span>;
            }
 
            <b>if</b> (<a href="/System.Management.Automation/A.html#b36a767584bc86ea" class="i property">SecondsRemaining</a> &gt;= 0)
            {
                ++<span class="r57 r">lines</span>;
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>))
            {
                <b>if</b> (<span class="r54 r">isFullPlus</span>)
                {
                    <span class="r57 r">lines</span> += 1;
                    <span class="r59 r">temp</span>.<span class="i">Clear</span>();
                    <a href="#b7e3c6d46c673d06" class="i method">RenderFullDescription</a>(<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>, <span class="r58 r">indent</span>, <span class="r56 r">maxWidth</span>, <span class="r55 r">rawUi</span>, <span class="r59 r">temp</span>, <span class="r20 r">isFullPlus</span>: <b>true</b>);
                    <span class="r57 r">lines</span> += <span class="r59 r">temp</span>.<span class="i">Count</span>;
                }
                <b>else</b>
                {
                    <span class="r57 r">lines</span> += 2;
                }
            }
 
            <b>return</b> <span class="r57 r">lines</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of vertical BufferCells that are required to render the node in the Compact style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>private
        int</b>
        <a id="0b530ad89bc91cac" href="../../R/0b530ad89bc91cac.html" target="n" data-glyph="106,1" class="i property">LinesRequiredInCompactStyle</a>
        {
            <b>get</b>
            {
                <span class="c">// Since the fields of this instance could have been changed, we compute this on-the-fly.</span>
 
                <span class="c">// NTRAID#Windows OS Bugs-1062104-2004/12/15-sburns we assume 1 line for each field.  If we ever need to</span>
                <span class="c">// word-wrap text fields, then this calculation will need updating.</span>
 
                <span class="c">// Start with 1 for the Activity, and 1 for the Status.</span>
 
                <b>int</b> <span id="r60 rd" class="r60 r">lines</span> = 2;
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="/System.Management.Automation/A.html#f7d64fec26cd635a" class="i property">CurrentOperation</a>))
                {
                    ++<span class="r60 r">lines</span>;
                }
 
                <b>return</b> <span class="r60 r">lines</span>;
            }
        }
    }
}   <span class="c">// namespace</span>
</pre></td></tr></table></div></body></html>
