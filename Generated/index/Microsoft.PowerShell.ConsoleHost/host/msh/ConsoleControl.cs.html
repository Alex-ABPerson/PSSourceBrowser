<!DOCTYPE html>
<html><head><title>ConsoleControl.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(3215);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.PowerShell.ConsoleHost/host/msh/ConsoleControl.cs" target="_top">host\msh\ConsoleControl.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.PowerShell.ConsoleHost" target="_top">src\Microsoft.PowerShell.ConsoleHost\Microsoft.PowerShell.ConsoleHost.csproj</a> (Microsoft.PowerShell.ConsoleHost)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
 
<span class="c">// Implementation notes: In the functions that take ConsoleHandle parameters, we only assert that the handle is valid and not</span>
<span class="c">// closed, as opposed to doing a check and throwing an exception.  This is because the win32 APIs that those functions wrap will</span>
<span class="c">// fail on invalid/closed handles, and the check for API failure will throw the exception.</span>
<span class="c">//</span>
<span class="c">// On the use of DangerousGetHandle: If the handle has been invalidated, then the API we pass it to will return an error.  These</span>
<span class="c">// handles should not be exposed to recycling attacks (because they are not exposed at all), but if they were, the worse they</span>
<span class="c">// could do is diddle with the console buffer.</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 1634, 1691
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Diagnostics</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>.<span class="i">SafeHandles</span>;
 
<b>using</b> <span class="i">ConsoleHandle</span> = <span class="i n">Microsoft</span>.<span class="i">Win32</span>.<span class="i">SafeHandles</span>.<span class="i">SafeFileHandle</span>;
 
<b>using</b> <span class="i">WORD</span> = <span class="i n">System</span>.<span class="i">UInt16</span>;
<b>using</b> <span class="i">ULONG</span> = <span class="i n">System</span>.<span class="i">UInt32</span>;
<b>using</b> <span class="i">DWORD</span> = <span class="i n">System</span>.<span class="i">UInt32</span>;
<b>using</b> <span class="i">NakedWin32Handle</span> = <span class="i n">System</span>.<span class="i">IntPtr</span>;
<b>using</b> <span class="i">HWND</span> = <span class="i n">System</span>.<span class="i">IntPtr</span>;
<b>using</b> <span class="i">HDC</span> = <span class="i n">System</span>.<span class="i">IntPtr</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Class ConsoleControl is used to wrap the various win32 console APIs 1:1 (i.e. at a low level, without attempting to be a</span>
    <span class="c">///</span><span class="c"> &quot;true&quot; object-oriented library.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="e8b5dc8576b8da6f" href="../../R/e8b5dc8576b8da6f.html" target="n" data-glyph="2,0" class="t t">ConsoleControl</a>
    {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <span class="k preprocess">#</span><span class="k preprocess">region</span> structs
 
        <b>internal enum</b> <a id="909b13750b87fe9a" href="../../R/909b13750b87fe9a.html" target="n" data-glyph="20,1" class="t t"><span id="e09a74587cf2ed2e">InputRecordEventTypes</span></a> : <b>ushort</b>
        {
            <span class="c">// from wincon.h.  These look like bit flags, but of course they could not really be used that way, since it would</span>
            <span class="c">// not make sense to have more than one of the INPUT_RECORD union members &quot;in effect&quot; at any one time.</span>
 
            <a id="207951a2afb6e3a2" href="../../R/207951a2afb6e3a2.html" target="n" data-glyph="24,2" class="i field">KEY_EVENT</a> = 0x0001,
            <a id="9524bc13c9218907" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">MOUSE_EVENT</a> = 0x0002,
            <a id="17137f45d1662d9b" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">WINDOW_BUFFER_SIZE_EVENT</a> = 0x0004,
            <a id="3f4d23809ff2f4bc" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">MENU_EVENT</a> = 0x0008,
            <a id="8b75a0150d216922" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">FOCUS_EVENT</a> = 0x0010
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="3515a77acb59df32" href="../../R/3515a77acb59df32.html" target="n" data-glyph="110,1" class="t t"><span id="6beb1bf6175c444e">INPUT_RECORD</span></a>
        {
            <b>internal</b> <span class="i">WORD</span> <a id="692b201be40e1be8" href="../../R/692b201be40e1be8.html" target="n" data-glyph="44,2" class="i field">EventType</a>;
            <b>internal</b> <a href="#e73d8325cf12163f" class="t t">KEY_EVENT_RECORD</a> <a id="cd0b04dc517b5739" href="../../R/cd0b04dc517b5739.html" target="n" data-glyph="44,2" class="i field">KeyEvent</a>;
        }
 
        [<span class="i">Flags</span>]
        <b>internal enum</b> <a id="b797ea5eb625f015" href="../../R/../../0000000000.html" target="n" data-glyph="20,1" class="t t"><span id="65f539ce78a2fc21">ControlKeyStates</span></a> : <b>uint</b>
        {
            <span class="c">// From wincon.h.</span>
            <a id="030d8baf4a5ca20b" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">RIGHT_ALT_PRESSED</a> = 0x0001, <span class="c">// the right alt key is pressed.</span>
            <a id="83e628d93dfaad02" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">LEFT_ALT_PRESSED</a> = 0x0002, <span class="c">// the left alt key is pressed.</span>
            <a id="c63b5dd67697c1b7" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">RIGHT_CTRL_PRESSED</a> = 0x0004, <span class="c">// the right ctrl key is pressed.</span>
            <a id="ccda0e05437ad9a0" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">LEFT_CTRL_PRESSED</a> = 0x0008, <span class="c">// the left ctrl key is pressed.</span>
            <a id="aa185dc677252d0e" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">SHIFT_PRESSED</a> = 0x0010, <span class="c">// the shift key is pressed.</span>
            <a id="66fe6765ef0c69f9" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">NUMLOCK_ON</a> = 0x0020, <span class="c">// the numlock light is on.</span>
            <a id="29cce37be9924a97" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">SCROLLLOCK_ON</a> = 0x0040, <span class="c">// the scrolllock light is on.</span>
            <a id="45fad97d000ae3d7" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">CAPSLOCK_ON</a> = 0x0080, <span class="c">// the capslock light is on.</span>
            <a id="69c4b47d431f5bf1" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">ENHANCED_KEY</a> = 0x0100  <span class="c">// the key is enhanced.</span>
        }
 
        <span class="c">// LayoutKind must be Explicit</span>
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="e73d8325cf12163f" href="../../R/e73d8325cf12163f.html" target="n" data-glyph="110,1" class="t t"><span id="8f8431b6698179fd">KEY_EVENT_RECORD</span></a>
        {
            <b>internal bool</b> <a id="03dada6459abc972" href="../../R/03dada6459abc972.html" target="n" data-glyph="44,2" class="i field">KeyDown</a>;
 
            <b>internal</b> <span class="i">WORD</span> <a id="09193d9fb3bc908c" href="../../R/09193d9fb3bc908c.html" target="n" data-glyph="44,2" class="i field">RepeatCount</a>;
 
            <b>internal</b> <span class="i">WORD</span> <a id="200e0018f0eb3bb3" href="../../R/200e0018f0eb3bb3.html" target="n" data-glyph="44,2" class="i field">VirtualKeyCode</a>;
 
            <b>internal</b> <span class="i">WORD</span> <a id="97a7c56f3e75709a" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">VirtualScanCode</a>;
 
            <b>internal char</b> <a id="3ba5fb532dbded4b" href="../../R/3ba5fb532dbded4b.html" target="n" data-glyph="44,2" class="i field">UnicodeChar</a>;
 
            <b>internal</b> <span class="i">DWORD</span> <a id="084ac8e4e12a4f8a" href="../../R/084ac8e4e12a4f8a.html" target="n" data-glyph="44,2" class="i field">ControlKeyState</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="00043fcf4690a445" href="../../R/00043fcf4690a445.html" target="n" data-glyph="110,1" class="t t"><span id="223fcc52d402fc1e">COORD</span></a>
        {
            <b>internal short</b> <a id="0742affafd7a86ed" href="../../R/0742affafd7a86ed.html" target="n" data-glyph="44,2" class="i field">X</a>;
 
            <b>internal short</b> <a id="3fd8b6ba4892d18e" href="../../R/3fd8b6ba4892d18e.html" target="n" data-glyph="44,2" class="i field">Y</a>;
 
            <b>public override string</b> <a id="df7746ff164bca59" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">ToString</a>()
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0},{1}&quot;</span>, <a href="#0742affafd7a86ed" class="i field">X</a>, <a href="#3fd8b6ba4892d18e" class="i field">Y</a>);
            }
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="75931d4b0b657960" href="../../R/75931d4b0b657960.html" target="n" data-glyph="110,1" class="t t"><span id="ba940e499fbe0466">CONSOLE_READCONSOLE_CONTROL</span></a>
        {
            <span class="c">// from public/internal/windows/inc/winconp.h</span>
            <b>internal</b> <span class="i">ULONG</span> <a id="514e4b903a2307d2" href="../../R/514e4b903a2307d2.html" target="n" data-glyph="44,2" class="i field">nLength</a>;
 
            <b>internal</b> <span class="i">ULONG</span> <a id="da0b62b1dc4de467" href="../../R/da0b62b1dc4de467.html" target="n" data-glyph="44,2" class="i field">nInitialChars</a>;
 
            <b>internal</b> <span class="i">ULONG</span> <a id="1c60c4e05c8b3f33" href="../../R/1c60c4e05c8b3f33.html" target="n" data-glyph="44,2" class="i field">dwCtrlWakeupMask</a>;
 
            <b>internal</b> <span class="c">/* out */</span> <span class="i">ULONG</span> <a id="ebc5e6594bc61988" href="../../R/ebc5e6594bc61988.html" target="n" data-glyph="44,2" class="i field">dwControlKeyState</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
        <b>internal struct</b> <a id="a07c3f2be802fbbf" href="../../R/a07c3f2be802fbbf.html" target="n" data-glyph="110,1" class="t t"><span id="7a14e2893ef2893a">CONSOLE_FONT_INFO_EX</span></a>
        {
            <b>internal int</b> <a id="6f17e8828e545aac" href="../../R/6f17e8828e545aac.html" target="n" data-glyph="44,2" class="i field">cbSize</a>;
            <b>internal int</b> <a id="2d5c369e35226f80" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">nFont</a>;
            <b>internal short</b> <a id="06f23f368c7c84b1" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">FontWidth</a>;
            <b>internal short</b> <a id="3fab58a28afa263c" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">FontHeight</a>;
            <b>internal int</b> <a id="80b3e640d9bf39e0" href="../../R/80b3e640d9bf39e0.html" target="n" data-glyph="44,2" class="i field">FontFamily</a>;
            <b>internal int</b> <a id="87012c86179b6aa3" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">FontWeight</a>;
 
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 32)]
            <b>internal string</b> <a id="aa9ce54476d38ce2" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">FontFace</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="9ad6afa10191aa8a" href="../../R/9ad6afa10191aa8a.html" target="n" data-glyph="110,1" class="t t"><span id="c932463c7bdf6516">CHAR_INFO</span></a>
        {
            <b>internal ushort</b> <a id="99811542029cf255" href="../../R/99811542029cf255.html" target="n" data-glyph="44,2" class="i field">UnicodeChar</a>;
 
            <b>internal</b> <span class="i">WORD</span> <a id="740512f5552ef4e2" href="../../R/740512f5552ef4e2.html" target="n" data-glyph="44,2" class="i field">Attributes</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="6cd4a96da231ccf6" href="../../R/6cd4a96da231ccf6.html" target="n" data-glyph="110,1" class="t t"><span id="077c578a4113f71e">SMALL_RECT</span></a>
        {
            <b>internal short</b> <a id="66ce7deb70bef9f3" href="../../R/66ce7deb70bef9f3.html" target="n" data-glyph="44,2" class="i field">Left</a>;
 
            <b>internal short</b> <a id="40d524bbcb015b61" href="../../R/40d524bbcb015b61.html" target="n" data-glyph="44,2" class="i field">Top</a>;
 
            <b>internal short</b> <a id="0016188fa9c34162" href="../../R/0016188fa9c34162.html" target="n" data-glyph="44,2" class="i field">Right</a>;
 
            <b>internal short</b> <a id="2a466af33d30108e" href="../../R/2a466af33d30108e.html" target="n" data-glyph="44,2" class="i field">Bottom</a>;
 
            <b>public override string</b> <a id="10c7d71a86fe40d3" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">ToString</a>()
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0},{1},{2},{3}&quot;</span>, <a href="#66ce7deb70bef9f3" class="i field">Left</a>, <a href="#40d524bbcb015b61" class="i field">Top</a>, <a href="#0016188fa9c34162" class="i field">Right</a>, <a href="#2a466af33d30108e" class="i field">Bottom</a>);
            }
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="bddc36d28ff118a0" href="../../R/bddc36d28ff118a0.html" target="n" data-glyph="110,1" class="t t"><span id="e4eea3b29049f362">CONSOLE_SCREEN_BUFFER_INFO</span></a>
        {
            <b>internal</b> <a href="#00043fcf4690a445" class="t t">COORD</a> <a id="8948dd4587a0e93f" href="../../R/8948dd4587a0e93f.html" target="n" data-glyph="44,2" class="i field">BufferSize</a>;
 
            <b>internal</b> <a href="#00043fcf4690a445" class="t t">COORD</a> <a id="7cea348f0132a8d5" href="../../R/7cea348f0132a8d5.html" target="n" data-glyph="44,2" class="i field">CursorPosition</a>;
 
            <b>internal</b> <span class="i">WORD</span> <a id="0d610058fdf6684a" href="../../R/0d610058fdf6684a.html" target="n" data-glyph="44,2" class="i field">Attributes</a>;
 
            <b>internal</b> <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <a id="a631f54217795fe3" href="../../R/a631f54217795fe3.html" target="n" data-glyph="44,2" class="i field">WindowRect</a>;
 
            <b>internal</b> <a href="#00043fcf4690a445" class="t t">COORD</a> <a id="a12ce3646588958c" href="../../R/a12ce3646588958c.html" target="n" data-glyph="44,2" class="i field">MaxWindowSize</a>;
 
            <span class="c">// NTRAID#Windows Out Of Band Releases-938428-2006/07/17-jwh</span>
            <span class="c">// Bring the total size of the struct to 24 bytes.</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="5012f0fc2267a78e" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Padding</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="207b7680f453770b" href="../../R/207b7680f453770b.html" target="n" data-glyph="110,1" class="t t"><span id="5c1983c445bb0565">CONSOLE_CURSOR_INFO</span></a>
        {
            <b>internal</b> <span class="i">DWORD</span> <a id="af307a12a3753dbb" href="../../R/af307a12a3753dbb.html" target="n" data-glyph="44,2" class="i field">Size</a>;
 
            <b>internal bool</b> <a id="cad7d7cf6d579097" href="../../R/cad7d7cf6d579097.html" target="n" data-glyph="44,2" class="i field">Visible</a>;
 
            <b>public override string</b> <a id="6a74e5f782a79dbf" href="../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">ToString</a>()
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;Size: {0}, Visible: {1}&quot;</span>, <a href="#af307a12a3753dbb" class="i field">Size</a>, <a href="#cad7d7cf6d579097" class="i field">Visible</a>);
            }
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="fdf4fbb94fe26ccc" href="../../R/fdf4fbb94fe26ccc.html" target="n" data-glyph="110,1" class="t t"><span id="3e82b367c185af30">FONTSIGNATURE</span></a>
        {
            <span class="c">// From public\sdk\inc\wingdi.h</span>
 
            <span class="c">// fsUsb*: A 128-bit Unicode subset bitfield (USB) identifying up to 126 Unicode subranges</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="d41ef660ce246b25" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fsUsb0</a>;
            <b>internal</b> <span class="i">DWORD</span> <a id="c231237ad5592b77" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fsUsb1</a>;
            <b>internal</b> <span class="i">DWORD</span> <a id="f6b1b8ada19956ce" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fsUsb2</a>;
            <b>internal</b> <span class="i">DWORD</span> <a id="0159081d9caf79be" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fsUsb3</a>;
            <span class="c">// fsCsb*: A 64-bit, code-page bitfield (CPB) that identifies a specific character set or code page.</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="194bf46ab4b569dc" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fsCsb0</a>;
            <b>internal</b> <span class="i">DWORD</span> <a id="e98a404bb1cd5b4b" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fsCsb1</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="b7f6c52dc603a623" href="../../R/../../0000000000.html" target="n" data-glyph="110,1" class="t t"><span id="84d8daf361868dcd">CHARSETINFO</span></a>
        {
            <span class="c">// From public\sdk\inc\wingdi.h</span>
            <b>internal uint</b> <a id="d2b7c63003604d37" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">ciCharset</a>;   <span class="c">// Character set value.</span>
            <b>internal uint</b> <a id="1fe0514e7e0b23fc" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">ciACP</a>;       <span class="c">// ANSI code-page identifier.</span>
            <b>internal</b> <a href="#fdf4fbb94fe26ccc" class="t t">FONTSIGNATURE</a> <a id="13dd6686068826da" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">fs</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
        <b>internal struct</b> <a id="8dc2eaae45a04360" href="../../R/../../0000000000.html" target="n" data-glyph="110,1" class="t t"><span id="389fbdf1f59fcd29">TEXTMETRIC</span></a>
        {
            <span class="c">// From public\sdk\inc\wingdi.h</span>
            <b>public int</b> <a id="6dbcaff5ca96662b" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmHeight</a>;
            <b>public int</b> <a id="8cdc92ff4930b728" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmAscent</a>;
            <b>public int</b> <a id="0cb32fdf4a946097" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmDescent</a>;
            <b>public int</b> <a id="c21c796390e0e654" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmInternalLeading</a>;
            <b>public int</b> <a id="816abb9513315418" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmExternalLeading</a>;
            <b>public int</b> <a id="8c517283006a619c" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmAveCharWidth</a>;
            <b>public int</b> <a id="aaa295d28bf65dbe" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmMaxCharWidth</a>;
            <b>public int</b> <a id="665e128ce9e614d1" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmWeight</a>;
            <b>public int</b> <a id="11775ec5f1fb4412" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmOverhang</a>;
            <b>public int</b> <a id="344704ec39347b08" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmDigitizedAspectX</a>;
            <b>public int</b> <a id="7e75a543adc2c146" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmDigitizedAspectY</a>;
            <b>public char</b> <a id="408f0b8a5a5dbef6" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmFirstChar</a>;
            <b>public char</b> <a id="aaba54f7069e823c" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmLastChar</a>;
            <b>public char</b> <a id="efca9a2db26d85bb" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmDefaultChar</a>;
            <b>public char</b> <a id="a8206dbf33b2fa90" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmBreakChar</a>;
            <b>public byte</b> <a id="9481dedf8dd41154" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmItalic</a>;
            <b>public byte</b> <a id="c36720fd8b8d9044" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmUnderlined</a>;
            <b>public byte</b> <a id="53ed49da0d5af1c0" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmStruckOut</a>;
            <b>public byte</b> <a id="829a19516876f9dc" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmPitchAndFamily</a>;
            <b>public byte</b> <a id="ddab90bcfa6d1512" href="../../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">tmCharSet</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> SentInput Data Structures
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="f9880a1b43685c6d" href="../../R/f9880a1b43685c6d.html" target="n" data-glyph="110,1" class="t t"><span id="ad2e760f2b2ff5bf">INPUT</span></a>
        {
            <b>internal</b> <span class="i">DWORD</span> <a id="ce335fdef2c721a9" href="../../R/ce335fdef2c721a9.html" target="n" data-glyph="44,2" class="i field">Type</a>;
            <b>internal</b> <a href="#9c17da6b9e2a55f6" class="t t">MouseKeyboardHardwareInput</a> <a id="50f79363f245deb1" href="../../R/50f79363f245deb1.html" target="n" data-glyph="44,2" class="i field">Data</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Explicit</span>)]
        <b>internal struct</b> <a id="9c17da6b9e2a55f6" href="../../R/9c17da6b9e2a55f6.html" target="n" data-glyph="110,1" class="t t"><span id="6ceb9c96c16fc000">MouseKeyboardHardwareInput</span></a>
        {
            [<span class="i">FieldOffset</span>(0)]
            <b>internal</b> <a href="#3c7644b4f6e98a38" class="t t">MouseInput</a> <a id="195b6ccfe4681cf1" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Mouse</a>;
 
            [<span class="i">FieldOffset</span>(0)]
            <b>internal</b> <a href="#fed29a0152751cdc" class="t t">KeyboardInput</a> <a id="b7b4173067eaeced" href="../../R/b7b4173067eaeced.html" target="n" data-glyph="44,2" class="i field">Keyboard</a>;
 
            [<span class="i">FieldOffset</span>(0)]
            <b>internal</b> <a href="#4e71f0ff6f24b56f" class="t t">HardwareInput</a> <a id="f8c74a53a54fef84" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Hardware</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="3c7644b4f6e98a38" href="../../R/3c7644b4f6e98a38.html" target="n" data-glyph="110,1" class="t t"><span id="d5843746cc72d6a4">MouseInput</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The absolute position of the mouse, or the amount of motion since the last mouse event was generated, depending on the value of the dwFlags member.</span>
            <span class="c">///</span><span class="c"> Absolute data is specified as the x coordinate of the mouse; relative data is specified as the number of pixels moved.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal int</b> <a id="791a34c1c777b6c3" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">X</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The absolute position of the mouse, or the amount of motion since the last mouse event was generated, depending on the value of the dwFlags member.</span>
            <span class="c">///</span><span class="c"> Absolute data is specified as the y coordinate of the mouse; relative data is specified as the number of pixels moved.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal int</b> <a id="2bdc08e58d12381b" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Y</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> If dwFlags contains MOUSEEVENTF_WHEEL, then mouseData specifies the amount of wheel movement. A positive value indicates that the wheel was rotated forward, away from the user;</span>
            <span class="c">///</span><span class="c"> a negative value indicates that the wheel was rotated backward, toward the user. One wheel click is defined as WHEEL_DELTA, which is 120.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="9d7ceb6971611420" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">MouseData</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> A set of bit flags that specify various aspects of mouse motion and button clicks.</span>
            <span class="c">///</span><span class="c"> See (https://msdn.microsoft.com/library/ms646273(VS.85).aspx)</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="ad6245360f9723a5" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Flags</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The time stamp for the event, in milliseconds. If this parameter is 0, the system will provide its own time stamp.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="b58edea118e6e4fa" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Time</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> An additional value associated with the mouse event. An application calls GetMessageExtraInfo to obtain this extra information.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">IntPtr</span> <a id="cfcb02d7c93ae08a" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">ExtraInfo</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="fed29a0152751cdc" href="../../R/fed29a0152751cdc.html" target="n" data-glyph="110,1" class="t t"><span id="a8f2afd6ebf31f4c">KeyboardInput</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> A virtual-key code. The code must be a value in the range 1 to 254.</span>
            <span class="c">///</span><span class="c"> If the dwFlags member specifies KEYEVENTF_UNICODE, wVk must be 0.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">WORD</span> <a id="8d2f2a2119c335ee" href="../../R/8d2f2a2119c335ee.html" target="n" data-glyph="44,2" class="i field">Vk</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> A hardware scan code for the key. If dwFlags specifies KEYEVENTF_UNICODE,</span>
            <span class="c">///</span><span class="c"> wScan specifies a Unicode character which is to be sent to the foreground application.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">WORD</span> <a id="d9869f6782de9b79" href="../../R/d9869f6782de9b79.html" target="n" data-glyph="44,2" class="i field">Scan</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Specifies various aspects of a keystroke.</span>
            <span class="c">///</span><span class="c"> This member can be certain combinations of the following values.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="c4b5e9e335280c46" href="../../R/c4b5e9e335280c46.html" target="n" data-glyph="44,2" class="i field">Flags</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The time stamp for the event, in milliseconds.</span>
            <span class="c">///</span><span class="c"> If this parameter is zero, the system will provide its own time stamp.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="66b7780b0c48a6e0" href="../../R/66b7780b0c48a6e0.html" target="n" data-glyph="44,2" class="i field">Time</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> An additional value associated with the keystroke.</span>
            <span class="c">///</span><span class="c"> Use the GetMessageExtraInfo function to obtain this information.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">IntPtr</span> <a id="495a9cb2c5d30f02" href="../../R/495a9cb2c5d30f02.html" target="n" data-glyph="44,2" class="i field">ExtraInfo</a>;
        }
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>)]
        <b>internal struct</b> <a id="4e71f0ff6f24b56f" href="../../R/4e71f0ff6f24b56f.html" target="n" data-glyph="110,1" class="t t"><span id="0a6393d48b34d9e0">HardwareInput</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The message generated by the input hardware.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">DWORD</span> <a id="6590e6e25fdcaaf0" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Msg</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The low-order word of the lParam parameter for uMsg.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">WORD</span> <a id="4f88ff688f5b8a88" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">ParamL</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The high-order word of the lParam parameter for uMsg.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal</b> <span class="i">WORD</span> <a id="85ca3e708c63fcb9" href="../../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">ParamH</a>;
        }
 
        <b>internal enum</b> <a id="7a58bff344498f46" href="../../R/7a58bff344498f46.html" target="n" data-glyph="20,1" class="t t"><span id="b7504e60f0b55f65">VirtualKeyCode</span></a> : <b>ushort</b>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> LEFT ARROW key.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="985ab494f27304a2" href="../../R/985ab494f27304a2.html" target="n" data-glyph="24,2" class="i field">Left</a> = 0x25,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> ENTER key.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="1fb8ed0aec5248b9" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">Return</a> = 0x0D,
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specify the type of the input.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal enum</b> <a id="e06451988aa64b8c" href="../../R/e06451988aa64b8c.html" target="n" data-glyph="20,1" class="t t"><span id="9c11726b67753d54">InputType</span></a> : <b>uint</b>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> INPUT_MOUSE = 0x00.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="167df77372ba9f9a" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">Mouse</a> = 0,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> INPUT_KEYBOARD = 0x01.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="cdbc39ccfc5c93cb" href="../../R/cdbc39ccfc5c93cb.html" target="n" data-glyph="24,2" class="i field">Keyboard</a> = 1,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> INPUT_HARDWARE = 0x02.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="2357f58839bc530b" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">Hardware</a> = 2,
        }
 
        <b>internal enum</b> <a id="ce9a35f070d2961b" href="../../R/ce9a35f070d2961b.html" target="n" data-glyph="20,1" class="t t"><span id="2b325036149337f9">KeyboardFlag</span></a> : <b>uint</b>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> If specified, the scan code was preceded by a prefix byte that has the value 0xE0 (224).</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="53e01d05f3d67645" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">ExtendedKey</a> = 0x0001,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> If specified, the key is being released. If not specified, the key is being pressed.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="dc31d1ea217fc8f5" href="../../R/dc31d1ea217fc8f5.html" target="n" data-glyph="24,2" class="i field">KeyUp</a> = 0x0002,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> If specified, wScan identifies the key and wVk is ignored.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="df475ca775f6b008" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">Unicode</a> = 0x0004,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> If specified, the system synthesizes a VK_PACKET keystroke. The wVk parameter must be zero.</span>
            <span class="c">///</span><span class="c"> This flag can only be combined with the KEYEVENTF_KEYUP flag.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="587c1bbbcec2d1b8" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">ScanCode</a> = 0x0008
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> SentInput Data Structures
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> structs
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Window Visibility
        [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetConsoleWindowDllName</span>)]
        <b>internal static extern</b> <span class="i">IntPtr</span> <a id="8fed99c196d3173f" href="../../R/8fed99c196d3173f.html" target="n" data-glyph="74,1" class="i method">GetConsoleWindow</a>();
 
        <b>internal const int</b> <a id="dfbc0c40cf5f4873" href="../../R/dfbc0c40cf5f4873.html" target="n" data-glyph="8,1" class="i field">SW_HIDE</a> = 0;
        <b>internal const int</b> <a id="da7ce7e16809ead7" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWNORMAL</a> = 1;
        <b>internal const int</b> <a id="f9762af322fb95e0" href="../../R/f9762af322fb95e0.html" target="n" data-glyph="8,1" class="i field">SW_NORMAL</a> = 1;
        <b>internal const int</b> <a id="c1b5523ae6703259" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWMINIMIZED</a> = 2;
        <b>internal const int</b> <a id="016dd4f8ef0770db" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWMAXIMIZED</a> = 3;
        <b>internal const int</b> <a id="5bd3f14bd31f4369" href="../../R/5bd3f14bd31f4369.html" target="n" data-glyph="8,1" class="i field">SW_MAXIMIZE</a> = 3;
        <b>internal const int</b> <a id="e820fe2d88cf610d" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWNOACTIVATE</a> = 4;
        <b>internal const int</b> <a id="d99eff1bcfb0702c" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOW</a> = 5;
        <b>internal const int</b> <a id="fae71f591bb596f3" href="../../R/fae71f591bb596f3.html" target="n" data-glyph="8,1" class="i field">SW_MINIMIZE</a> = 6;
        <b>internal const int</b> <a id="5271e26b4ffd9c98" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWMINNOACTIVE</a> = 7;
        <b>internal const int</b> <a id="e3081c1ffef6e1bf" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWNA</a> = 8;
        <b>internal const int</b> <a id="cbc5238285bccb69" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_RESTORE</a> = 9;
        <b>internal const int</b> <a id="005a305cb11ce96a" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWDEFAULT</a> = 10;
        <b>internal const int</b> <a id="debde80dd4a26d67" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_FORCEMINIMIZE</a> = 11;
        <b>internal const int</b> <a id="c3bb03ef30f0b7fe" href="../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_MAX</a> = 11;
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Code to control the display properties of the a window...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">hWnd</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The window to show...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">nCmdShow</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The command to do.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if it was successful.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;user32.dll&quot;</span>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>internal static extern bool</b> <a id="11ab23d8be5f5f65" href="../../R/11ab23d8be5f5f65.html" target="n" data-glyph="74,1" class="i method">ShowWindow</a>(<span class="i">IntPtr</span> <span id="r0 rd" class="r0 r">hWnd</span>, <b>int</b> <span id="r1 rd" class="r1 r">nCmdShow</span>);
 
        <b>internal static void</b> <a id="6679901a33a0b225" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetConsoleMode</a>(<span class="i">ProcessWindowStyle</span> <span id="r2 rd" class="r2 r">style</span>)
        {
            <span class="i">IntPtr</span> <span id="r3 rd" class="r3 r">hwnd</span> = <a href="#8fed99c196d3173f" class="i method">GetConsoleWindow</a>();
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r3 r">hwnd</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>, <span class="s">&quot;Console handle should never be zero&quot;</span>);
            <b>switch</b> (<span class="r2 r">style</span>)
            {
                <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Hidden</span>:
                    <a href="#11ab23d8be5f5f65" class="i method">ShowWindow</a>(<span class="r3 r">hwnd</span>, <a href="#dfbc0c40cf5f4873" class="i field">SW_HIDE</a>);
                    <b>break</b>;
                <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Maximized</span>:
                    <a href="#11ab23d8be5f5f65" class="i method">ShowWindow</a>(<span class="r3 r">hwnd</span>, <a href="#5bd3f14bd31f4369" class="i field">SW_MAXIMIZE</a>);
                    <b>break</b>;
                <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Minimized</span>:
                    <a href="#11ab23d8be5f5f65" class="i method">ShowWindow</a>(<span class="r3 r">hwnd</span>, <a href="#fae71f591bb596f3" class="i field">SW_MINIMIZE</a>);
                    <b>break</b>;
                <b>case</b> <span class="i">ProcessWindowStyle</span>.<span class="i">Normal</span>:
                    <a href="#11ab23d8be5f5f65" class="i method">ShowWindow</a>(<span class="r3 r">hwnd</span>, <a href="#f9762af322fb95e0" class="i field">SW_NORMAL</a>);
                    <b>break</b>;
            }
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Input break handler (Ctrl-C, Ctrl-Break)
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Types of control ConsoleBreakSignals received by break Win32Handler delegates.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal enum</b> <a id="7afb579825643d15" href="../../R/7afb579825643d15.html" target="n" data-glyph="20,1" class="t t"><span id="5cd5d35fbeca705b">ConsoleBreakSignal</span></a> : <b>uint</b>
        {
            <span class="c">// These correspond to the CRTL_XXX_EVENT #defines in public/sdk/inc/wincon.h</span>
 
            <a id="a31c8c0984b618f5" href="../../R/a31c8c0984b618f5.html" target="n" data-glyph="24,2" class="i field">CtrlC</a> = 0,
            <a id="dac5377417c719a9" href="../../R/dac5377417c719a9.html" target="n" data-glyph="24,2" class="i field">CtrlBreak</a> = 1,
            <a id="124ac64f4a8763c2" href="../../R/124ac64f4a8763c2.html" target="n" data-glyph="24,2" class="i field">Close</a> = 2,
            <a id="7cac9bb10563241c" href="../../R/7cac9bb10563241c.html" target="n" data-glyph="24,2" class="i field">Logoff</a> = 5,
 
            <span class="c">// This only gets received by services</span>
 
            <a id="6ceaa93d1c6410be" href="../../R/6ceaa93d1c6410be.html" target="n" data-glyph="24,2" class="i field">Shutdown</a> = 6,
 
            <span class="c">// None is not really a signal -- it&#39;s used to indicate that no signal exists.</span>
 
            <a id="7ad449e1b6fcd185" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">None</a> = 0xFF
        }
 
        <span class="c">// NOTE: this delegate will be executed in its own thread</span>
 
        <b>internal delegate bool</b> <a id="fc771999e869a2f6" href="../../R/fc771999e869a2f6.html" target="n" data-glyph="14,1" class="t t"><span id="551b5db589ee183d">BreakHandler</span></a>(<a href="#7afb579825643d15" class="t t">ConsoleBreakSignal</a> <span id="r4 rd" class="r4 r">ConsoleBreakSignal</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the console&#39;s break handler.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">handlerDelegate</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s SetConsoleCtrlHandler fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="ccd3e9fc5b2c706d" href="../../R/ccd3e9fc5b2c706d.html" target="n" data-glyph="74,1" class="i method">AddBreakHandler</a>(<a href="#fc771999e869a2f6" class="t t">BreakHandler</a> <span id="r5 rd" class="r5 r">handlerDelegate</span>)
        {
            <b>bool</b> <span id="r6 rd" class="r6 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#67e7e01d6cab2477" class="i method">SetConsoleCtrlHandler</a>(<span class="r5 r">handlerDelegate</span>, <b>true</b>);
 
            <b>if</b> (!<span class="r6 r">result</span>)
            {
                <b>int</b> <span id="r7 rd" class="r7 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r8 rd" class="r8 r">e</span> = <span class="i">CreateHostException</span>(<span class="r7 r">err</span>, <span class="s">&quot;AddBreakHandler&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">AddBreakHandlerExceptionMessage</span>);
                <b>throw</b> <span class="r8 r">e</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the console&#39;s break handler to null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s SetConsoleCtrlHandler fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="bfb4ee3c70af3cfe" href="../../R/bfb4ee3c70af3cfe.html" target="n" data-glyph="74,1" class="i method">RemoveBreakHandler</a>()
        {
            <b>bool</b> <span id="r9 rd" class="r9 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#67e7e01d6cab2477" class="i method">SetConsoleCtrlHandler</a>(<b>null</b>, <b>false</b>);
 
            <b>if</b> (!<span class="r9 r">result</span>)
            {
                <b>int</b> <span id="r10 rd" class="r10 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r11 rd" class="r11 r">e</span> = <span class="i">CreateHostException</span>(<span class="r10 r">err</span>, <span class="s">&quot;RemoveBreakHandler&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">RemoveBreakHandlerExceptionTemplate</span>);
                <b>throw</b> <span class="r11 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Win32Handles
 
        <b>private static readonly</b> <span class="i">Lazy</span>&lt;<span class="i">ConsoleHandle</span>&gt; <a id="2f4c35c54e423cf3" href="../../R/2f4c35c54e423cf3.html" target="n" data-glyph="46,1" class="i field">_keyboardInputHandle</a> = <b>new</b> <span class="i">Lazy</span>&lt;<span class="i">SafeFileHandle</span>&gt;(() =&gt;
            {
                <b>var</b> <span id="r12 rd" class="r12 r">handle</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">CreateFile</span>(
                    <span class="s">&quot;CONIN$&quot;</span>,
                    (<span class="i">UInt32</span>)(<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#1444c3b1c7f48035" class="t t">AccessQualifiers</a>.<a href="#2c716a9d68edd188" class="i field">GenericRead</a> | <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#1444c3b1c7f48035" class="t t">AccessQualifiers</a>.<a href="#abe8e77289796d74" class="i field">GenericWrite</a>),
                    (<span class="i">UInt32</span>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#c144dc8f5d316d14" class="t t">ShareModes</a>.<a href="#63438f357d54a546" class="i field">ShareRead</a>,
                    (<span class="i">IntPtr</span>)0,
                    (<span class="i">UInt32</span>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#1711d221b860bd3c" class="t t">CreationDisposition</a>.<a href="#f60fea27ef7bfa23" class="i field">OpenExisting</a>,
                    0,
                    (<span class="i">IntPtr</span>)0);
 
                <b>if</b> (<span class="r12 r">handle</span> == <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#933083c3b887c19c" class="i field">INVALID_HANDLE_VALUE</a>)
                {
                    <b>int</b> <span id="r13 rd" class="r13 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                    <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r14 rd" class="r14 r">e</span> = <span class="i">CreateHostException</span>(<span class="r13 r">err</span>, <span class="s">&quot;RetreiveInputConsoleHandle&quot;</span>,
                                                            <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>,
                                                            <span class="i">ConsoleControlStrings</span>.<span class="i">GetInputModeExceptionTemplate</span>);
                    <b>throw</b> <span class="r14 r">e</span>;
                }
 
                <b>return</b> <b>new</b> <span class="i">ConsoleHandle</span>(<span class="r12 r">handle</span>, <b>true</b>);
            }
        );
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a ConsoleHandle to the console (keyboard device)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">ConsoleHandle</span> <a id="082a79a70f5af6dc" href="../../R/082a79a70f5af6dc.html" target="n" data-glyph="74,1" class="i method">GetConioDeviceHandle</a>()
        {
            <b>return</b> <a href="#2f4c35c54e423cf3" class="i field">_keyboardInputHandle</a>.<span class="i">Value</span>;
        }
 
        <b>private static readonly</b> <span class="i">Lazy</span>&lt;<span class="i">ConsoleHandle</span>&gt; <a id="57f0eb6efe920590" href="../../R/57f0eb6efe920590.html" target="n" data-glyph="46,1" class="i field">_outputHandle</a> = <b>new</b> <span class="i">Lazy</span>&lt;<span class="i">SafeFileHandle</span>&gt;(() =&gt;
            {
                <span class="c">// We use CreateFile here instead of GetStdWin32Handle, as GetStdWin32Handle will return redirected handles</span>
                <b>var</b> <span id="r15 rd" class="r15 r">handle</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">CreateFile</span>(
                    <span class="s">&quot;CONOUT$&quot;</span>,
                    (<span class="i">UInt32</span>)(<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#1444c3b1c7f48035" class="t t">AccessQualifiers</a>.<a href="#2c716a9d68edd188" class="i field">GenericRead</a> | <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#1444c3b1c7f48035" class="t t">AccessQualifiers</a>.<a href="#abe8e77289796d74" class="i field">GenericWrite</a>),
                    (<span class="i">UInt32</span>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#c144dc8f5d316d14" class="t t">ShareModes</a>.<a href="#11134cf838df87b7" class="i field">ShareWrite</a>,
                    (<span class="i">IntPtr</span>)0,
                    (<span class="i">UInt32</span>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#1711d221b860bd3c" class="t t">CreationDisposition</a>.<a href="#f60fea27ef7bfa23" class="i field">OpenExisting</a>,
                    0,
                    (<span class="i">IntPtr</span>)0);
 
                <b>if</b> (<span class="r15 r">handle</span> == <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#933083c3b887c19c" class="i field">INVALID_HANDLE_VALUE</a>)
                {
                    <b>int</b> <span id="r16 rd" class="r16 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                    <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r17 rd" class="r17 r">e</span> = <span class="i">CreateHostException</span>(<span class="r16 r">err</span>, <span class="s">&quot;RetreiveActiveScreenBufferConsoleHandle&quot;</span>,
                        <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">GetActiveScreenBufferHandleExceptionTemplate</span>);
                    <b>throw</b> <span class="r17 r">e</span>;
                }
 
                <b>return</b> <b>new</b> <span class="i">ConsoleHandle</span>(<span class="r15 r">handle</span>, <b>true</b>);
            }
        );
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a ConsoleHandle to the active screen buffer, even if that output has been redirected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s CreateFile fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">ConsoleHandle</span> <a id="d72136ddad017191" href="../../R/d72136ddad017191.html" target="n" data-glyph="74,1" class="i method">GetActiveScreenBufferHandle</a>()
        {
            <b>return</b> <a href="#57f0eb6efe920590" class="i field">_outputHandle</a>.<span class="i">Value</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Mode
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flags used by ConsoleControl.GetMode and ConsoleControl.SetMode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Flags</span>]
        <b>internal enum</b> <a id="1d1eff9fb00ac8e2" href="../../R/1d1eff9fb00ac8e2.html" target="n" data-glyph="20,1" class="t t"><span id="35cce73f4cd1a4f0">ConsoleModes</span></a> : <b>uint</b>
        {
            <span class="c">// These values from wincon.h</span>
            <span class="c">// input modes</span>
            <a id="dc342310a77c2d1f" href="../../R/dc342310a77c2d1f.html" target="n" data-glyph="24,2" class="i field">ProcessedInput</a> = 0x001,
            <a id="6059b69bb324025e" href="../../R/6059b69bb324025e.html" target="n" data-glyph="24,2" class="i field">LineInput</a> = 0x002,
            <a id="adac23d1297e0802" href="../../R/adac23d1297e0802.html" target="n" data-glyph="24,2" class="i field">EchoInput</a> = 0x004,
            <a id="e5176e17af084185" href="../../R/e5176e17af084185.html" target="n" data-glyph="24,2" class="i field">WindowInput</a> = 0x008,
            <a id="ace876bd01ee480a" href="../../R/ace876bd01ee480a.html" target="n" data-glyph="24,2" class="i field">MouseInput</a> = 0x010,
            <a id="5c5fa4d6cebb6694" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">Insert</a> = 0x020,
            <a id="9cf28d0a88dc851f" href="../../R/9cf28d0a88dc851f.html" target="n" data-glyph="24,2" class="i field">QuickEdit</a> = 0x040,
            <a id="f91282e15d35c3f0" href="../../R/f91282e15d35c3f0.html" target="n" data-glyph="24,2" class="i field">Extended</a> = 0x080,
            <a id="23c2263d81d2ab07" href="../../R/../../0000000000.html" target="n" data-glyph="24,2" class="i field">AutoPosition</a> = 0x100,
            <span class="c">// output modes</span>
            <a id="4e6e0e9e95f52938" href="../../R/4e6e0e9e95f52938.html" target="n" data-glyph="24,2" class="i field">ProcessedOutput</a> = 0x001,  <span class="c">// yes, I know they are the same values as some flags defined above.</span>
            <a id="1143cb06c4507f89" href="../../R/1143cb06c4507f89.html" target="n" data-glyph="24,2" class="i field">WrapEndOfLine</a> = 0x002,
            <a id="75b80d335eae6d9f" href="../../R/75b80d335eae6d9f.html" target="n" data-glyph="24,2" class="i field">VirtualTerminal</a> = 0x004,
            <span class="c">// Error getting console mode</span>
            <a id="fc3ca3fb0292ebf8" href="../../R/fc3ca3fb0292ebf8.html" target="n" data-glyph="24,2" class="i field">Unknown</a> = 0xffffffff,
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a mask of ConsoleModes flags describing the current modality of the console.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s GetConsoleMode fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#1d1eff9fb00ac8e2" class="t t">ConsoleModes</a> <a id="133579be57ae9c3e" href="../../R/133579be57ae9c3e.html" target="n" data-glyph="74,1" class="i method">GetMode</a>(<span class="i">ConsoleHandle</span> <span id="r18 rd" class="r18 r">consoleHandle</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r18 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;consoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r18 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <span class="i">UInt32</span> <span id="r19 rd" class="r19 r">m</span> = 0;
            <b>bool</b> <span id="r20 rd" class="r20 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">GetConsoleMode</span>(<span class="r18 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <b>out</b> <span class="r19 r">m</span>);
 
            <b>if</b> (!<span class="r20 r">result</span>)
            {
                <b>int</b> <span id="r21 rd" class="r21 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r22 rd" class="r22 r">e</span> = <span class="i">CreateHostException</span>(<span class="r21 r">err</span>, <span class="s">&quot;GetConsoleMode&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">GetModeExceptionTemplate</span>);
                <b>throw</b> <span class="r22 r">e</span>;
            }
 
            <b>return</b> (<a href="#1d1eff9fb00ac8e2" class="t t">ConsoleModes</a>)<span class="r19 r">m</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the current mode of the console device.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handle to the console device returned by GetInputHandle</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">mode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Mask of mode flags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s SetConsoleMode fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="6c1ab9fc2b7085b1" href="../../R/6c1ab9fc2b7085b1.html" target="n" data-glyph="74,1" class="i method">SetMode</a>(<span class="i">ConsoleHandle</span> <span id="r23 rd" class="r23 r">consoleHandle</span>, <a href="#1d1eff9fb00ac8e2" class="t t">ConsoleModes</a> <span id="r24 rd" class="r24 r">mode</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r23 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;consoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r23 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <b>bool</b> <span id="r25 rd" class="r25 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">SetConsoleMode</span>(<span class="r23 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), (<span class="i">DWORD</span>)<span class="r24 r">mode</span>);
 
            <b>if</b> (!<span class="r25 r">result</span>)
            {
                <b>int</b> <span id="r26 rd" class="r26 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r27 rd" class="r27 r">e</span> = <span class="i">CreateHostException</span>(<span class="r26 r">err</span>, <span class="s">&quot;SetConsoleMode&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">SetModeExceptionTemplate</span>);
                <b>throw</b> <span class="r27 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Input
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reads input from the console device according to the mode in effect (see GetMode, SetMode)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handle to the console device returned by GetInputHandle</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">initialContentLength</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Length of initial content of the edit buffer. Zero if no initial content exists.</span>
        <span class="c">///</span><span class="c"> Must be less than editBuffer length.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">editBuffer</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Edit buffer with optional initial content.</span>
        <span class="c">///</span><span class="c"> Caution! Last position in the edit buffer is for a null in native code.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">charactersToRead</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Number of characters to read from the device.</span>
        <span class="c">///</span><span class="c"> Must be less than editBuffer length.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">endOnTab</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True to allow the user to terminate input by hitting the tab or shift-tab key, in addition to the enter key</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">keyState</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Bit mask indicating the state of the control/shift keys at the point input was terminated.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/param&gt;</span>
        <span class="c">///</span><span class="c"> &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="c">///</span><span class="c"> &lt;exception cref=&quot;HostException&quot;&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s ReadConsole fails</span>
        <span class="c">///</span><span class="c"> &lt;/exception&gt;</span>
        <b>internal static string</b> <a id="cc37450eec4d5e6d" href="../../R/cc37450eec4d5e6d.html" target="n" data-glyph="74,1" class="i method">ReadConsole</a>(
            <span class="i">ConsoleHandle</span> <span id="r28 rd" class="r28 r">consoleHandle</span>,
            <b>int</b> <span id="r29 rd" class="r29 r">initialContentLength</span>,
            <span class="i">Span</span>&lt;<b>char</b>&gt; <span id="r30 rd" class="r30 r">editBuffer</span>,
            <b>int</b> <span id="r31 rd" class="r31 r">charactersToRead</span>,
            <b>bool</b> <span id="r32 rd" class="r32 r">endOnTab</span>,
            <b>out uint</b> <span id="r33 rd" class="r33 r">keyState</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r28 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r28 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r29 r">initialContentLength</span> &lt; <span class="r30 r">editBuffer</span>.<span class="i">Length</span>, <span class="s">&quot;initialContentLength must be less than editBuffer.Length&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r31 r">charactersToRead</span> &lt; <span class="r30 r">editBuffer</span>.<span class="i">Length</span>, <span class="s">&quot;charactersToRead must be less than editBuffer.Length&quot;</span>);
            <span class="r33 r">keyState</span> = 0;
 
            <a href="#75931d4b0b657960" class="t t">CONSOLE_READCONSOLE_CONTROL</a> <span id="r34 rd" class="r34 r">control</span> = <b>new</b> <span class="t">CONSOLE_READCONSOLE_CONTROL</span>();
 
            <span class="r34 r">control</span>.<a href="#514e4b903a2307d2" class="i field">nLength</a> = (<span class="i">ULONG</span>)<span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r34 r">control</span>);
            <span class="r34 r">control</span>.<a href="#da0b62b1dc4de467" class="i field">nInitialChars</a> = (<span class="i">ULONG</span>)<span class="r29 r">initialContentLength</span>;
            <span class="r34 r">control</span>.<a href="#ebc5e6594bc61988" class="i field">dwControlKeyState</a> = 0;
            <b>if</b> (<span class="r32 r">endOnTab</span>)
            {
                <b>const int</b> <span id="r35 rd" class="r35 r">TAB</span> = 0x9;
 
                <span class="r34 r">control</span>.<a href="#1c60c4e05c8b3f33" class="i field">dwCtrlWakeupMask</a> = (1 &lt;&lt; <span class="r35 r">TAB</span>);
            }
 
            <span class="i">DWORD</span> <span id="r36 rd" class="r36 r">charsReaded</span> = 0;
 
            <b>bool</b> <span id="r37 rd" class="r37 r">result</span> =
                <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">ReadConsole</span>(
                    <span class="r28 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                    <span class="r30 r">editBuffer</span>,
                    (<span class="i">DWORD</span>)<span class="r31 r">charactersToRead</span>,
                    <b>out</b> <span class="r36 r">charsReaded</span>,
                    <b>ref</b> <span class="r34 r">control</span>);
            <span class="r33 r">keyState</span> = <span class="r34 r">control</span>.<a href="#ebc5e6594bc61988" class="i field">dwControlKeyState</a>;
            <b>if</b> (!<span class="r37 r">result</span>)
            {
                <b>int</b> <span id="r38 rd" class="r38 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r39 rd" class="r39 r">e</span> = <span class="i">CreateHostException</span>(
                    <span class="r38 r">err</span>,
                    <span class="s">&quot;ReadConsole&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>,
                    <span class="i">ConsoleControlStrings</span>.<span class="i">ReadConsoleExceptionTemplate</span>);
                <b>throw</b> <span class="r39 r">e</span>;
            }
 
            <b>if</b> (<span class="r36 r">charsReaded</span> &gt; (<b>uint</b>)<span class="r31 r">charactersToRead</span>)
            {
                <span class="r36 r">charsReaded</span> = (<b>uint</b>)<span class="r31 r">charactersToRead</span>;
            }
 
            <b>return</b> <span class="r30 r">editBuffer</span>.<span class="i">Slice</span>(0, (<b>int</b>)<span class="r36 r">charsReaded</span>).<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 ReadConsoleInput.</span>
        <span class="c">///</span><span class="c"> Returns the number of records read in buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where input is read</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">buffer</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> array where data read are stored</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> actual number of input records read</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s ReadConsoleInput fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static int</b> <a id="f965c525cbbe65be" href="../../R/f965c525cbbe65be.html" target="n" data-glyph="74,1" class="i method">ReadConsoleInput</a>(<span class="i">ConsoleHandle</span> <span id="r40 rd" class="r40 r">consoleHandle</span>, <b>ref</b> <a href="#3515a77acb59df32" class="t t">INPUT_RECORD</a>[] <span id="r41 rd" class="r41 r">buffer</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r40 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r40 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <span class="i">DWORD</span> <span id="r42 rd" class="r42 r">recordsRead</span> = 0;
            <b>bool</b> <span id="r43 rd" class="r43 r">result</span> =
                <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">ReadConsoleInput</span>(
                    <span class="r40 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                    <span class="r41 r">buffer</span>,
                    (<span class="i">DWORD</span>)<span class="r41 r">buffer</span>.<span class="i">Length</span>,
                    <b>out</b> <span class="r42 r">recordsRead</span>);
            <b>if</b> (!<span class="r43 r">result</span>)
            {
                <b>int</b> <span id="r44 rd" class="r44 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r45 rd" class="r45 r">e</span> = <span class="i">CreateHostException</span>(<span class="r44 r">err</span>, <span class="s">&quot;ReadConsoleInput&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">ReadConsoleInputExceptionTemplate</span>);
                <b>throw</b> <span class="r45 r">e</span>;
            }
 
            <b>return</b> (<b>int</b>)<span class="r42 r">recordsRead</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 PeekConsoleInput.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where input is peeked</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r47 r">buffer</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> array where data read are stored</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> actual number of input records peeked</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s PeekConsoleInput fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static int</b> <a id="02768bae29db33fd" href="../../R/02768bae29db33fd.html" target="n" data-glyph="74,1" class="i method">PeekConsoleInput</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r46 rd" class="r46 r">consoleHandle</span>,
            <b>ref</b> <a href="#3515a77acb59df32" class="t t">INPUT_RECORD</a>[] <span id="r47 rd" class="r47 r">buffer</span>
        )
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r46 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r46 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <span class="i">DWORD</span> <span id="r48 rd" class="r48 r">recordsRead</span>;
            <b>bool</b> <span id="r49 rd" class="r49 r">result</span> =
                <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">PeekConsoleInput</span>(
                    <span class="r46 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                    <span class="r47 r">buffer</span>,
                    (<span class="i">DWORD</span>)<span class="r47 r">buffer</span>.<span class="i">Length</span>,
                    <b>out</b> <span class="r48 r">recordsRead</span>);
 
            <b>if</b> (!<span class="r49 r">result</span>)
            {
                <b>int</b> <span id="r50 rd" class="r50 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r51 rd" class="r51 r">e</span> = <span class="i">CreateHostException</span>(<span class="r50 r">err</span>, <span class="s">&quot;PeekConsoleInput&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">PeekConsoleInputExceptionTemplate</span>);
                <b>throw</b> <span class="r51 r">e</span>;
            }
 
            <b>return</b> (<b>int</b>)<span class="r48 r">recordsRead</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 GetNumberOfConsoleInputEvents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where the number of console input events is obtained</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> number of console input events</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s GetNumberOfConsoleInputEvents fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static int</b> <a id="e15d7b59091da7e8" href="../../R/e15d7b59091da7e8.html" target="n" data-glyph="74,1" class="i method">GetNumberOfConsoleInputEvents</a>(<span class="i">ConsoleHandle</span> <span id="r52 rd" class="r52 r">consoleHandle</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r52 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r52 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <span class="i">DWORD</span> <span id="r53 rd" class="r53 r">numEvents</span>;
            <b>bool</b> <span id="r54 rd" class="r54 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">GetNumberOfConsoleInputEvents</span>(<span class="r52 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <b>out</b> <span class="r53 r">numEvents</span>);
 
            <b>if</b> (!<span class="r54 r">result</span>)
            {
                <b>int</b> <span id="r55 rd" class="r55 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r56 rd" class="r56 r">e</span> = <span class="i">CreateHostException</span>(<span class="r55 r">err</span>, <span class="s">&quot;GetNumberOfConsoleInputEvents&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">GetNumberOfConsoleInputEventsExceptionTemplate</span>);
                <b>throw</b> <span class="r56 r">e</span>;
            }
 
            <b>return</b> (<b>int</b>)<span class="r53 r">numEvents</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 FlushConsoleInputBuffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where the input buffer is flushed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s FlushConsoleInputBuffer fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="b6792028911d4516" href="../../R/b6792028911d4516.html" target="n" data-glyph="74,1" class="i method">FlushConsoleInputBuffer</a>(<span class="i">ConsoleHandle</span> <span id="r57 rd" class="r57 r">consoleHandle</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r57 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r57 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <b>bool</b> <span id="r58 rd" class="r58 r">result</span> = <b>false</b>;
            <span class="i">NakedWin32Handle</span> <span id="r59 rd" class="r59 r">h</span> = <span class="r57 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>();
            <span class="r58 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#57b3e25ba5a7a8df" class="i method">FlushConsoleInputBuffer</a>(<span class="r59 r">h</span>);
 
            <b>if</b> (!<span class="r58 r">result</span>)
            {
                <b>int</b> <span id="r60 rd" class="r60 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r61 rd" class="r61 r">e</span> = <span class="i">CreateHostException</span>(<span class="r60 r">err</span>, <span class="s">&quot;FlushConsoleInputBuffer&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">FlushConsoleInputBufferExceptionTemplate</span>);
                <b>throw</b> <span class="r61 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Input
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Buffer
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 GetConsoleScreenBufferInfo</span>
        <span class="c">///</span><span class="c"> Returns Console Screen Buffer Info.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handle for the console where the screen buffer info is obtained</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> info about the screen buffer. See the definition of CONSOLE_SCREEN_BUFFER_INFO</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s GetConsoleScreenBufferInfo fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <a id="a992b7826acc25f2" href="../../R/a992b7826acc25f2.html" target="n" data-glyph="74,1" class="i method">GetConsoleScreenBufferInfo</a>(<span class="i">ConsoleHandle</span> <span id="r62 rd" class="r62 r">consoleHandle</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r62 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r62 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <span id="r63 rd" class="r63 r">bufferInfo</span>;
            <b>bool</b> <span id="r64 rd" class="r64 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">GetConsoleScreenBufferInfo</span>(<span class="r62 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <b>out</b> <span class="r63 r">bufferInfo</span>);
 
            <b>if</b> (!<span class="r64 r">result</span>)
            {
                <b>int</b> <span id="r65 rd" class="r65 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r66 rd" class="r66 r">e</span> = <span class="i">CreateHostException</span>(<span class="r65 r">err</span>, <span class="s">&quot;GetConsoleScreenBufferInfo&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">GetConsoleScreenBufferInfoExceptionTemplate</span>);
                <b>throw</b> <span class="r66 r">e</span>;
            }
 
            <b>return</b> <span class="r63 r">bufferInfo</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the output buffer&#39;s size.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">newSize</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s SetConsoleScreenBufferSize fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="20c37713e74573a8" href="../../R/20c37713e74573a8.html" target="n" data-glyph="74,1" class="i method">SetConsoleScreenBufferSize</a>(<span class="i">ConsoleHandle</span> <span id="r67 rd" class="r67 r">consoleHandle</span>, <a href="/System.Management.Automation/A.html#4d1d20b1c8ac2812" class="t t">Size</a> <span id="r68 rd" class="r68 r">newSize</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r67 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r67 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r69 rd" class="r69 r">s</span>;
 
            <span class="r69 r">s</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="r68 r">newSize</span>.<a href="/System.Management.Automation/A.html#cc1bb8de7549bf9d" class="i property">Width</a>;
            <span class="r69 r">s</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)<span class="r68 r">newSize</span>.<a href="/System.Management.Automation/A.html#5ca800015fea1ce6" class="i property">Height</a>;
 
            <b>bool</b> <span id="r70 rd" class="r70 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">SetConsoleScreenBufferSize</span>(<span class="r67 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <span class="r69 r">s</span>);
 
            <b>if</b> (!<span class="r70 r">result</span>)
            {
                <b>int</b> <span id="r71 rd" class="r71 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r72 rd" class="r72 r">e</span> = <span class="i">CreateHostException</span>(<span class="r71 r">err</span>, <span class="s">&quot;SetConsoleScreenBufferSize&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">SetConsoleScreenBufferSizeExceptionTemplate</span>);
                <b>throw</b> <span class="r72 r">e</span>;
            }
        }
 
        <b>internal static bool</b> <a id="3da2dd36d1d92e02" href="../../R/3da2dd36d1d92e02.html" target="n" data-glyph="74,1" class="i method">IsConsoleColor</a>(<span class="i">ConsoleColor</span> <span id="r73 rd" class="r73 r">c</span>)
        {
            <b>switch</b> (<span class="r73 r">c</span>)
            {
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Black</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Blue</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Cyan</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">DarkBlue</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">DarkCyan</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">DarkGray</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">DarkGreen</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">DarkMagenta</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">DarkRed</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">DarkYellow</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Gray</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Green</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Magenta</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Red</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">White</span>:
                <b>case</b> <span class="i">ConsoleColor</span>.<span class="i">Yellow</span>:
                    <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static void</b> <a id="a92de6f8349ea0f7" href="../../R/a92de6f8349ea0f7.html" target="n" data-glyph="74,1" class="i method">WORDToColor</a>(<span class="i">WORD</span> <span id="r74 rd" class="r74 r">attribute</span>, <b>out</b> <span class="i">ConsoleColor</span> <span id="r75 rd" class="r75 r">foreground</span>, <b>out</b> <span class="i">ConsoleColor</span> <span id="r76 rd" class="r76 r">background</span>)
        {
            <span class="c">// foreground color is the low-byte in the word, background color is the hi-byte.</span>
            <span class="r75 r">foreground</span> = (<span class="i">ConsoleColor</span>)(<span class="r74 r">attribute</span> &amp; 0x0f);
            <span class="r76 r">background</span> = (<span class="i">ConsoleColor</span>)((<span class="r74 r">attribute</span> &amp; 0xf0) &gt;&gt; 4);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<a href="#3da2dd36d1d92e02" class="i method">IsConsoleColor</a>(<span class="r75 r">foreground</span>), <span class="s">&quot;unknown color&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<a href="#3da2dd36d1d92e02" class="i method">IsConsoleColor</a>(<span class="r76 r">background</span>), <span class="s">&quot;unknown color&quot;</span>);
        }
 
        <b>internal static</b> <span class="i">WORD</span> <a id="56184f1fd54da646" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ColorToWORD</a>(<span class="i">ConsoleColor</span> <span id="r77 rd" class="r77 r">foreground</span>, <span class="i">ConsoleColor</span> <span id="r78 rd" class="r78 r">background</span>)
        {
            <span class="i">WORD</span> <span id="r79 rd" class="r79 r">result</span> = (<span class="i">WORD</span>)(((<b>int</b>)<span class="r78 r">background</span> &lt;&lt; 4) | (<b>int</b>)<span class="r77 r">foreground</span>);
 
            <b>return</b> <span class="r79 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wrap32 WriteConsoleOutput.</span>
        <span class="c">///</span><span class="c"> This wrapper is not limited to 64K or 8K CHAR_INFO to which Win32&#39;s WriteConsoleOutput</span>
        <span class="c">///</span><span class="c"> is constrained.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where output is written</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">origin</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> location on screen buffer where writing starts</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r82 r">contents</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 2D array of cells. Caller needs to ensure that the array is 2D.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s GetConsoleScreenBufferInfo fails</span>
        <span class="c">///</span><span class="c"> If there is not enough memory to complete calls to Win32&#39;s WriteConsoleOutput</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r82 r">contents</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If it is illegal to write </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r82 r">contents</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to the output buffer</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="a8a1fecddbe032de" href="../../R/a8a1fecddbe032de.html" target="n" data-glyph="74,1" class="i method">WriteConsoleOutput</a>(<span class="i">ConsoleHandle</span> <span id="r80 rd" class="r80 r">consoleHandle</span>, <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r81 rd" class="r81 r">origin</span>, <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r82 rd" class="r82 r">contents</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r80 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r80 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
            <b>if</b> (<span class="r82 r">contents</span> == <b>null</b>)
            {
                <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentNullException</span>(<b>nameof</b>(<span class="r82 r">contents</span>));
            }
 
            <b>uint</b> <span id="r83 rd" class="r83 r">codePage</span>;
            <b>if</b> (<a href="#b4d45aadc9c3920c" class="i method">IsCJKOutputCodePage</a>(<b>out</b> <span class="r83 r">codePage</span>))
            {
                <span class="c">// contentsRegion indicates the area in contents (declared below) in which</span>
                <span class="c">// the data read from ReadConsoleOutput is stored.</span>
                <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r84 rd" class="r84 r">contentsRegion</span> = <b>new</b> <span class="t">Rectangle</span>();
                <a href="#e8b5dc8576b8da6f" class="t t">ConsoleControl</a>.<a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <span id="r85 rd" class="r85 r">bufferInfo</span> =
                    <a href="#a992b7826acc25f2" class="i method">GetConsoleScreenBufferInfo</a>(<span class="r80 r">consoleHandle</span>);
 
                <b>int</b> <span id="r86 rd" class="r86 r">bufferWidth</span> = <span class="r85 r">bufferInfo</span>.<a href="#8948dd4587a0e93f" class="i field">BufferSize</a>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                <b>int</b> <span id="r87 rd" class="r87 r">bufferHeight</span> = <span class="r85 r">bufferInfo</span>.<a href="#8948dd4587a0e93f" class="i field">BufferSize</a>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
                <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r88 rd" class="r88 r">screenRegion</span> = <b>new</b> <span class="t">Rectangle</span>(
                    <span class="r81 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>, <span class="r81 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>,
                    <span class="i">Math</span>.<span class="i">Min</span>(<span class="r81 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> + <span class="r82 r">contents</span>.<span class="i">GetLength</span>(1) - 1, <span class="r86 r">bufferWidth</span> - 1),
                    <span class="i">Math</span>.<span class="i">Min</span>(<span class="r81 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a> + <span class="r82 r">contents</span>.<span class="i">GetLength</span>(0) - 1, <span class="r87 r">bufferHeight</span> - 1));
 
                <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> = <span class="r82 r">contents</span>.<span class="i">GetLowerBound</span>(1);
                <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> = <span class="r82 r">contents</span>.<span class="i">GetLowerBound</span>(0);
                <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> = <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> +
                    <span class="r88 r">screenRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r88 r">screenRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>;
                <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> = <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> +
                    <span class="r88 r">screenRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> - <span class="r88 r">screenRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>;
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
                <span class="c">// Check contents in contentsRegion</span>
                <a href="#9a59ff08aed768ab" class="i method">CheckWriteConsoleOutputContents</a>(<span class="r82 r">contents</span>, <span class="r84 r">contentsRegion</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                <span class="c">// Identify edges and areas of identical contiguous edges in contentsRegion</span>
                <span class="i">List</span>&lt;<a href="#fa28edfe79b0bbad" class="t t">BufferCellArrayRowTypeRange</a>&gt; <span id="r89 rd" class="r89 r">sameEdgeAreas</span> = <b>new</b> <span class="i">List</span>&lt;<a href="#fa28edfe79b0bbad" class="t t">BufferCellArrayRowTypeRange</a>&gt;();
                <b>int</b> <span id="r90 rd" class="r90 r">firstLeftTrailingRow</span> = -1, <span id="r91 rd" class="r91 r">firstRightLeadingRow</span> = -1;
                <a href="#7f33b2ae37184a86" class="i method">BuildEdgeTypeInfo</a>(<span class="r84 r">contentsRegion</span>, <span class="r82 r">contents</span>,
                    <span class="r89 r">sameEdgeAreas</span>, <b>out</b> <span class="r90 r">firstLeftTrailingRow</span>, <b>out</b> <span class="r91 r">firstRightLeadingRow</span>);
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
                <a href="#79f5118fa114ec48" class="i method">CheckWriteEdges</a>(<span class="r80 r">consoleHandle</span>, <span class="r83 r">codePage</span>, <span class="r81 r">origin</span>, <span class="r82 r">contents</span>, <span class="r84 r">contentsRegion</span>,
                    <span class="r85 r">bufferInfo</span>, <span class="r90 r">firstLeftTrailingRow</span>, <span class="r91 r">firstRightLeadingRow</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                <b>foreach</b> (<a href="#fa28edfe79b0bbad" class="t t">BufferCellArrayRowTypeRange</a> <span id="r92 rd" class="r92 r">area</span> <b>in</b> <span class="r89 r">sameEdgeAreas</span>)
                {
                    <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r93 rd" class="r93 r">o</span> = <b>new</b> <span class="t">Coordinates</span>(<span class="r81 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>,
                                                    <span class="r81 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a> + <span class="r92 r">area</span>.<a href="#e845f90492943fb0" class="i field">Start</a> - <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>);
                    <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r94 rd" class="r94 r">contRegion</span> = <b>new</b> <span class="t">Rectangle</span>(
                        <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>, <span class="r92 r">area</span>.<a href="#e845f90492943fb0" class="i field">Start</a>, <span class="r84 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>, <span class="r92 r">area</span>.<a href="#091809423140c7cc" class="i field">End</a>);
                    <b>if</b> ((<span class="r92 r">area</span>.<a href="#1754079887effaac" class="i field">Type</a> &amp; <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a>.<a href="#f333f3a19a67cf23" class="i field">LeftTrailing</a>) != 0)
                    {
                        <span class="r94 r">contRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>++;
                        <span class="r93 r">o</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>++;
                        <b>if</b> (<span class="r93 r">o</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> &gt;= <span class="r86 r">bufferWidth</span> || <span class="r94 r">contRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> &lt; <span class="r94 r">contRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>)
                        {
                            <b>return</b>;
                        }
                    }
 
                    <a href="#ee061cde74240589" class="i method">WriteConsoleOutputCJK</a>(<span class="r80 r">consoleHandle</span>, <span class="r93 r">o</span>, <span class="r94 r">contRegion</span>, <span class="r82 r">contents</span>, <span class="r92 r">area</span>.<a href="#1754079887effaac" class="i field">Type</a>);
                }
            }
            <b>else</b>
            {
                <a href="#d340df63d0057dfb" class="i method">WriteConsoleOutputPlain</a>(<span class="r80 r">consoleHandle</span>, <span class="r81 r">origin</span>, <span class="r82 r">contents</span>);
            }
        }
 
        <b>private static void</b> <a id="7f33b2ae37184a86" href="../../R/7f33b2ae37184a86.html" target="n" data-glyph="76,1" class="i method">BuildEdgeTypeInfo</a>(
            <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r95 rd" class="r95 r">contentsRegion</span>,
            <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r96 rd" class="r96 r">contents</span>,
            <span class="i">List</span>&lt;<a href="#fa28edfe79b0bbad" class="t t">BufferCellArrayRowTypeRange</a>&gt; <span id="r97 rd" class="r97 r">sameEdgeAreas</span>,
            <b>out int</b> <span id="r98 rd" class="r98 r">firstLeftTrailingRow</span>,
            <b>out int</b> <span id="r99 rd" class="r99 r">firstRightLeadingRow</span>)
        {
            <span class="r98 r">firstLeftTrailingRow</span> = -1;
            <span class="r99 r">firstRightLeadingRow</span> = -1;
            <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a> <span id="r100 rd" class="r100 r">edgeType</span> =
                <a href="#841925832cc0b578" class="i method">GetEdgeType</a>(<span class="r96 r">contents</span>[<span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>, <span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>],
                    <span class="r96 r">contents</span>[<span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>, <span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>]);
            <b>for</b> (<b>int</b> <span id="r101 rd" class="r101 r">r</span> = <span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>; <span class="r101 r">r</span> &lt;= <span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>;)
            {
                <a href="#fa28edfe79b0bbad" class="t t">BufferCellArrayRowTypeRange</a> <span id="r102 rd" class="r102 r">range</span>;
                <span class="r102 r">range</span>.<a href="#e845f90492943fb0" class="i field">Start</a> = <span class="r101 r">r</span>;
                <span class="r102 r">range</span>.<a href="#1754079887effaac" class="i field">Type</a> = <span class="r100 r">edgeType</span>;
                <b>if</b> (<span class="r98 r">firstLeftTrailingRow</span> == -1 &amp;&amp; ((<span class="r102 r">range</span>.<a href="#1754079887effaac" class="i field">Type</a> &amp; <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a>.<a href="#f333f3a19a67cf23" class="i field">LeftTrailing</a>) != 0))
                {
                    <span class="r98 r">firstLeftTrailingRow</span> = <span class="r101 r">r</span>;
                }
 
                <b>if</b> (<span class="r99 r">firstRightLeadingRow</span> == -1 &amp;&amp; ((<span class="r102 r">range</span>.<a href="#1754079887effaac" class="i field">Type</a> &amp; <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a>.<a href="#81c7b89db5f58601" class="i field">RightLeading</a>) != 0))
                {
                    <span class="r99 r">firstRightLeadingRow</span> = <span class="r101 r">r</span>;
                }
 
                <b>while</b> (<b>true</b>)
                {
                    <span class="r101 r">r</span>++;
                    <b>if</b> (<span class="r101 r">r</span> &gt; <span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>)
                    {
                        <span class="r102 r">range</span>.<a href="#091809423140c7cc" class="i field">End</a> = <span class="r101 r">r</span> - 1;
                        <span class="r97 r">sameEdgeAreas</span>.<span class="i">Add</span>(<span class="r102 r">range</span>);
                        <b>return</b>;
                    }
 
                    <span class="r100 r">edgeType</span> = <a href="#841925832cc0b578" class="i method">GetEdgeType</a>(<span class="r96 r">contents</span>[<span class="r101 r">r</span>, <span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>], <span class="r96 r">contents</span>[<span class="r101 r">r</span>, <span class="r95 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>]);
                    <b>if</b> (<span class="r100 r">edgeType</span> != <span class="r102 r">range</span>.<a href="#1754079887effaac" class="i field">Type</a>)
                    {
                        <span class="r102 r">range</span>.<a href="#091809423140c7cc" class="i field">End</a> = <span class="r101 r">r</span> - 1;
                        <span class="r97 r">sameEdgeAreas</span>.<span class="i">Add</span>(<span class="r102 r">range</span>);
                        <b>break</b>;
                    }
                }
            }
        }
 
        <b>private static</b> <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a> <a id="841925832cc0b578" href="../../R/841925832cc0b578.html" target="n" data-glyph="76,1" class="i method">GetEdgeType</a>(<a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a> <span id="r103 rd" class="r103 r">left</span>, <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a> <span id="r104 rd" class="r104 r">right</span>)
        {
            <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a> <span id="r105 rd" class="r105 r">edgeType</span> = 0;
            <b>if</b> (<span class="r103 r">left</span>.<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a>)
            {
                <span class="r105 r">edgeType</span> |= <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a>.<a href="#f333f3a19a67cf23" class="i field">LeftTrailing</a>;
            }
 
            <b>if</b> (<span class="r104 r">right</span>.<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>)
            {
                <span class="r105 r">edgeType</span> |= <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a>.<a href="#81c7b89db5f58601" class="i field">RightLeading</a>;
            }
 
            <b>return</b> <span class="r105 r">edgeType</span>;
        }
 
        <b>private struct</b> <a id="fa28edfe79b0bbad" href="../../R/fa28edfe79b0bbad.html" target="n" data-glyph="112,1" class="t t"><span id="820dc829b21e2bc9">BufferCellArrayRowTypeRange</span></a>
        {
            <b>internal int</b> <a id="e845f90492943fb0" href="../../R/e845f90492943fb0.html" target="n" data-glyph="44,2" class="i field">Start</a>;
            <b>internal int</b> <a id="091809423140c7cc" href="../../R/091809423140c7cc.html" target="n" data-glyph="44,2" class="i field">End</a>;
            <b>internal</b> <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a> <a id="1754079887effaac" href="../../R/1754079887effaac.html" target="n" data-glyph="44,2" class="i field">Type</a>;
        }
 
        [<span class="i">Flags</span>]
        <b>private enum</b> <a id="130e594dc7838367" href="../../R/130e594dc7838367.html" target="n" data-glyph="22,1" class="t t"><span id="1587730d24ae4cd6">BufferCellArrayRowType</span></a> : <b>uint</b>
        {
            <a id="f333f3a19a67cf23" href="../../R/f333f3a19a67cf23.html" target="n" data-glyph="24,2" class="i field">LeftTrailing</a> = 0x1,
            <a id="81c7b89db5f58601" href="../../R/81c7b89db5f58601.html" target="n" data-glyph="24,2" class="i field">RightLeading</a> = 0x2
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check the existing screen columns left and right of areas to be written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">codePage</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">origin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Must be within the screen buffer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">contents</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">contentsRegion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">bufferInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">firstLeftTrailingRow</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">firstRightLeadingRow</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If it is illegal to write </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">contents</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> at </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">origin</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is not enough memory to complete calls to Win32&#39;s ReadConsoleOutput</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1811:AvoidUncalledPrivateCode&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Called in CHK builds&quot;</span>)]
        <b>internal static void</b> <a id="79f5118fa114ec48" href="../../R/79f5118fa114ec48.html" target="n" data-glyph="74,1" class="i method">CheckWriteEdges</a>(
            <span class="i">ConsoleHandle</span> <span id="r106 rd" class="r106 r">consoleHandle</span>,
            <b>uint</b> <span id="r107 rd" class="r107 r">codePage</span>, <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r108 rd" class="r108 r">origin</span>,
            <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r109 rd" class="r109 r">contents</span>,
            <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r110 rd" class="r110 r">contentsRegion</span>,
            <a href="#e8b5dc8576b8da6f" class="t t">ConsoleControl</a>.<a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <span id="r111 rd" class="r111 r">bufferInfo</span>,
            <b>int</b> <span id="r112 rd" class="r112 r">firstLeftTrailingRow</span>,
            <b>int</b> <span id="r113 rd" class="r113 r">firstRightLeadingRow</span>)
        {
            <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r114 rd" class="r114 r">existingRegion</span> = <b>new</b> <span class="t">Rectangle</span>(0, 0, 1, <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> - <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>);
            <b>if</b> (<span class="r108 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> == 0)
            {
                <b>if</b> (<span class="r112 r">firstLeftTrailingRow</span> &gt;= 0)
                {
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;contents[{0}, {1}]&quot;</span>,
                        <span class="r112 r">firstLeftTrailingRow</span>, <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>));
                }
            }
            <b>else</b>
            {
                <span class="c">// use ReadConsoleOutputCJK because checking the left and right edges of the existing output</span>
                <span class="c">// is NOT needed</span>
                <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r115 rd" class="r115 r">leftExisting</span> = <b>new</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[<span class="r114 r">existingRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> + 1, 2];
                <a href="#9f652e9aab6b1d6d" class="i method">ReadConsoleOutputCJK</a>(<span class="r106 r">consoleHandle</span>, <span class="r107 r">codePage</span>,
                    <b>new</b> <span class="t">Coordinates</span>(<span class="r108 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> - 1, <span class="r108 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>), <span class="r114 r">existingRegion</span>, <b>ref</b> <span class="r115 r">leftExisting</span>);
                <b>for</b> (<b>int</b> <span id="r116 rd" class="r116 r">r</span> = <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>, <span id="r117 rd" class="r117 r">i</span> = 0; <span class="r116 r">r</span> &lt;= <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>; <span class="r116 r">r</span>++, <span class="r117 r">i</span>++)
                {
                    <b>if</b> (<span class="r115 r">leftExisting</span>[<span class="r116 r">r</span>, 0].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a> ^
                            <span class="r109 r">contents</span>[<span class="r116 r">r</span>, <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a>)
                    {
                        <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;contents[{0}, {1}]&quot;</span>,
                            <span class="r116 r">r</span>, <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>));
                    }
                }
            }
            <span class="c">// Check right edge</span>
            <b>if</b> (<span class="r108 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> + (<span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>) + 1 &gt;= <span class="r111 r">bufferInfo</span>.<a href="#8948dd4587a0e93f" class="i field">BufferSize</a>.<a href="#0742affafd7a86ed" class="i field">X</a>)
            {
                <b>if</b> (<span class="r113 r">firstRightLeadingRow</span> &gt;= 0)
                {
                    <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;contents[{0}, {1}]&quot;</span>,
                            <span class="r113 r">firstRightLeadingRow</span>, <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>));
                }
            }
            <b>else</b>
            {
                <span class="c">// use ReadConsoleOutputCJK because checking the left and right edges of the existing output</span>
                <span class="c">// is NOT needed</span>
                <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r118 rd" class="r118 r">rightExisting</span> = <b>new</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[<span class="r114 r">existingRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> + 1, 2];
                <a href="#9f652e9aab6b1d6d" class="i method">ReadConsoleOutputCJK</a>(<span class="r106 r">consoleHandle</span>, <span class="r107 r">codePage</span>,
                    <b>new</b> <span class="t">Coordinates</span>(<span class="r108 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> + (<span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>), <span class="r108 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>), <span class="r114 r">existingRegion</span>, <b>ref</b> <span class="r118 r">rightExisting</span>);
                <b>for</b> (<b>int</b> <span id="r119 rd" class="r119 r">r</span> = <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>, <span id="r120 rd" class="r120 r">i</span> = 0; <span class="r119 r">r</span> &lt;= <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>; <span class="r119 r">r</span>++, <span class="r120 r">i</span>++)
                {
                    <b>if</b> (<span class="r118 r">rightExisting</span>[<span class="r119 r">r</span>, 0].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a> ^
                            <span class="r109 r">contents</span>[<span class="r119 r">r</span>, <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>)
                    {
                        <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;contents[{0}, {1}]&quot;</span>,
                            <span class="r119 r">r</span>, <span class="r110 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>));
                    }
                }
            }
        }
 
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1811:AvoidUncalledPrivateCode&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Called in CHK builds&quot;</span>)]
        <b>private static void</b> <a id="9a59ff08aed768ab" href="../../R/9a59ff08aed768ab.html" target="n" data-glyph="76,1" class="i method">CheckWriteConsoleOutputContents</a>(<a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r121 rd" class="r121 r">contents</span>, <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r122 rd" class="r122 r">contentsRegion</span>)
        {
            <b>for</b> (<b>int</b> <span id="r123 rd" class="r123 r">r</span> = <span class="r122 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>; <span class="r123 r">r</span> &lt;= <span class="r122 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>; <span class="r123 r">r</span>++)
            {
                <b>for</b> (<b>int</b> <span id="r124 rd" class="r124 r">c</span> = <span class="r122 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>; <span class="r124 r">c</span> &lt;= <span class="r122 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>; <span class="r124 r">c</span>++)
                {
                    <span class="c">// Changes have been made in the following code such that 2 cell characters</span>
                    <span class="c">// (Chinese, Japanese or Korean) can be in a single BufferCell structure</span>
                    <span class="c">// which is complete</span>
                    <b>if</b> (<span class="r121 r">contents</span>[<span class="r123 r">r</span>, <span class="r124 r">c</span>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a> &amp;&amp;
                        <span class="r121 r">contents</span>[<span class="r123 r">r</span>, <span class="r124 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> != 0)
                    {
                        <span class="c">// trailing character is not 0</span>
                        <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;contents[{0}, {1}]&quot;</span>, <span class="r123 r">r</span>, <span class="r124 r">c</span>));
                    }
 
                    <b>if</b> (<span class="r121 r">contents</span>[<span class="r123 r">r</span>, <span class="r124 r">c</span>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>)
                    {
                        <span class="r124 r">c</span>++;
                        <b>if</b> (<span class="r124 r">c</span> &gt; <span class="r122 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>)
                        {
                            <b>break</b>;
                        }
 
                        <b>if</b> (<span class="r121 r">contents</span>[<span class="r123 r">r</span>, <span class="r124 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> != 0 || <span class="r121 r">contents</span>[<span class="r123 r">r</span>, <span class="r124 r">c</span>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> != <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a>)
                        {
                            <span class="c">// for a 2 cell character, either there is no trailing BufferCell or</span>
                            <span class="c">// the trailing BufferCell&#39;s character is not 0</span>
                            <b>throw</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;contents[{0}, {1}]&quot;</span>, <span class="r123 r">r</span>, <span class="r124 r">c</span>));
                        }
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="ee061cde74240589" href="../../R/ee061cde74240589.html" target="n" data-glyph="76,1" class="i method">WriteConsoleOutputCJK</a>(<span class="i">ConsoleHandle</span> <span id="r125 rd" class="r125 r">consoleHandle</span>, <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r126 rd" class="r126 r">origin</span>, <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r127 rd" class="r127 r">contentsRegion</span>, <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r128 rd" class="r128 r">contents</span>, <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a> <span id="r129 rd" class="r129 r">rowType</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r126 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> &gt;= 0 &amp;&amp; <span class="r126 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a> &gt;= 0,
                <span class="s">&quot;origin must be within the output buffer&quot;</span>);
            <b>int</b> <span id="r130 rd" class="r130 r">rows</span> = <span class="r127 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> - <span class="r127 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> + 1;
            <b>int</b> <span id="r131 rd" class="r131 r">cols</span> = <span class="r127 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r127 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> + 1;
 
            <a href="#a07c3f2be802fbbf" class="t t">CONSOLE_FONT_INFO_EX</a> <span id="r132 rd" class="r132 r">fontInfo</span> = <a href="#7a7977eeab9957f3" class="i method">GetConsoleFontInfo</a>(<span class="r125 r">consoleHandle</span>);
            <b>int</b> <span id="r133 rd" class="r133 r">fontType</span> = <span class="r132 r">fontInfo</span>.<a href="#80b3e640d9bf39e0" class="i field">FontFamily</a> &amp; <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#76d1e2f1058e25d9" class="i field">FontTypeMask</a>;
            <b>bool</b> <span id="r134 rd" class="r134 r">trueTypeInUse</span> = (<span class="r133 r">fontType</span> &amp; <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#10d50bbe4dcb92a2" class="i field">TrueTypeFont</a>) == <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#10d50bbe4dcb92a2" class="i field">TrueTypeFont</a>;
 
            <b>int</b> <span id="r135 rd" class="r135 r">bufferLimit</span> = 2 * 1024; <span class="c">// Limit is 8K bytes as each CHAR_INFO takes 4 bytes</span>
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r136 rd" class="r136 r">bufferCoord</span>;
 
            <span class="r136 r">bufferCoord</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = 0;
            <span class="r136 r">bufferCoord</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
 
            <span class="c">// keeps track of which screen area write</span>
            <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r137 rd" class="r137 r">writeRegion</span>;
 
            <span class="r137 r">writeRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> = (<b>short</b>)<span class="r126 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>;
 
            <b>int</b> <span id="r138 rd" class="r138 r">rowsRemaining</span> = <span class="r130 r">rows</span>;
 
            <b>while</b> (<span class="r138 r">rowsRemaining</span> &gt; 0)
            {
                <span class="c">// Iteration of columns is nested inside iteration of rows.</span>
                <span class="c">// If the size of contents exceeds the buffer limit, writing is</span>
                <span class="c">// done in blocks of size equal to the bufferlimit from left to right</span>
                <span class="c">// then top to bottom.</span>
                <span class="c">// For each iteration of rows,</span>
                <span class="c">// - writeRegion.Left and bufferSize.X are reset</span>
                <span class="c">// - rowsRemaining, writeRegion.Top, writeRegion.Bottom, and bufferSize.Y</span>
                <span class="c">//     are updated</span>
                <span class="c">//   For each iteration of columns,</span>
                <span class="c">//   - writeRegion.Left, writeRegion.Right and bufferSize.X are updated</span>
 
                <span class="r137 r">writeRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> = (<b>short</b>)<span class="r126 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>;
 
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r139 rd" class="r139 r">bufferSize</span>;
 
                <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r131 r">cols</span>, <span class="r135 r">bufferLimit</span>);
                <span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>
                                        (
                                            <span class="r138 r">rowsRemaining</span>,
                                            <span class="r135 r">bufferLimit</span> / <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>
                                        );
                <span class="r137 r">writeRegion</span>.<a href="#2a466af33d30108e" class="i field">Bottom</a> = (<b>short</b>)(<span class="r137 r">writeRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> + <span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> - 1);
 
                <span class="c">// atRow is at which row of contents a particular iteration is operating</span>
                <b>int</b> <span id="r140 rd" class="r140 r">atRow</span> = <span class="r130 r">rows</span> - <span class="r138 r">rowsRemaining</span> + <span class="r127 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>;
 
                <span class="c">// number of columns yet to be written</span>
                <b>int</b> <span id="r141 rd" class="r141 r">colsRemaining</span> = <span class="r131 r">cols</span>;
                <b>while</b> (<span class="r141 r">colsRemaining</span> &gt; 0)
                {
                    <span class="r137 r">writeRegion</span>.<a href="#0016188fa9c34162" class="i field">Right</a> = (<b>short</b>)(<span class="r137 r">writeRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> + <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> - 1);
 
                    <span class="c">// atCol is at which column of contents a particular iteration is operating</span>
                    <b>int</b> <span id="r142 rd" class="r142 r">atCol</span> = <span class="r131 r">cols</span> - <span class="r141 r">colsRemaining</span> + <span class="r127 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>;
                    <span class="c">// if this is not the last column iteration &amp;&amp;</span>
                    <span class="c">//   the leftmost BufferCell is a leading cell, don&#39;t write that cell</span>
                    <b>if</b> (<span class="r141 r">colsRemaining</span> &gt; <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> &amp;&amp;
                         <span class="r128 r">contents</span>[<span class="r140 r">atRow</span>, <span class="r142 r">atCol</span> + <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> - 1].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>)
                    {
                        <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>--;
                        <span class="r137 r">writeRegion</span>.<a href="#0016188fa9c34162" class="i field">Right</a>--;
                    }
 
                    <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[] <span id="r143 rd" class="r143 r">characterBuffer</span> = <b>new</b> <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[<span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> * <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>];
 
                    <span class="c">// copy characterBuffer to contents;</span>
                    <b>int</b> <span id="r144 rd" class="r144 r">characterBufferIndex</span> = 0;
                    <b>bool</b> <span id="r145 rd" class="r145 r">lastCharIsLeading</span> = <b>false</b>;
                    <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a> <span id="r146 rd" class="r146 r">lastLeadingCell</span> = <b>new</b> <span class="t">BufferCell</span>();
                    <b>for</b> (<b>int</b> <span id="r147 rd" class="r147 r">r</span> = <span class="r140 r">atRow</span>; <span class="r147 r">r</span> &lt; <span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> + <span class="r140 r">atRow</span>; <span class="r147 r">r</span>++)
                    {
                        <b>for</b> (<b>int</b> <span id="r148 rd" class="r148 r">c</span> = <span class="r142 r">atCol</span>; <span class="r148 r">c</span> &lt; <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> + <span class="r142 r">atCol</span>; <span class="r148 r">c</span>++, <span class="r144 r">characterBufferIndex</span>++)
                        {
                            <b>if</b> (<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#09bc52b9f7ebe144" class="i field">Complete</a>)
                            {
                                <span class="r143 r">characterBuffer</span>[<span class="r144 r">characterBufferIndex</span>].<a href="#99811542029cf255" class="i field">UnicodeChar</a> =
                                    (<b>ushort</b>)<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a>;
                                <span class="r143 r">characterBuffer</span>[<span class="r144 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a> =
                                    (<b>ushort</b>)(<span class="i">ColorToWORD</span>(<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a>, <span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a>));
 
                                <span class="r145 r">lastCharIsLeading</span> = <b>false</b>;
                            }
                            <b>else</b> <b>if</b> (<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>)
                            {
                                <span class="r143 r">characterBuffer</span>[<span class="r144 r">characterBufferIndex</span>].<a href="#99811542029cf255" class="i field">UnicodeChar</a> =
                                    (<b>ushort</b>)<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a>;
                                <span class="r143 r">characterBuffer</span>[<span class="r144 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a> =
                                    (<b>ushort</b>)(<span class="i">ColorToWORD</span>(<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a>, <span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a>)
                                                | (<b>ushort</b>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#9c28974a86e93297" class="t t">CHAR_INFO_Attributes</a>.<a href="#eddb350a87124adc" class="i field">COMMON_LVB_LEADING_BYTE</a>);
 
                                <span class="r145 r">lastCharIsLeading</span> = <b>true</b>;
                                <span class="r146 r">lastLeadingCell</span> = <span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>];
                            }
                            <b>else</b> <b>if</b> (<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a>)
                            {
                                <span class="c">// The FontFamily is a 8-bit integer. The low-order bit (bit 0) specifies the pitch of the font.</span>
                                <span class="c">// If it is 1, the font is variable pitch (or proportional). If it is 0, the font is fixed pitch</span>
                                <span class="c">// (or monospace). Bits 1 and 2 specify the font type. If both bits are 0, the font is a raster font;</span>
                                <span class="c">// if bit 1 is 1 and bit 2 is 0, the font is a vector font; if bit 1 is 0 and bit 2 is set, or if both</span>
                                <span class="c">// bits are 1, the font is true type. Bit 3 is 1 if the font is a device font; otherwise, it is 0.</span>
                                <span class="c">// We only care about the bit 1 and 2, which indicate the font type.</span>
                                <span class="c">// There are only two font type defined for the Console, at</span>
                                <span class="c">// HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Console\.</span>
                                <span class="c">//     Console\Nls           --- national language supports</span>
                                <span class="c">//     Console\RasterFonts   --- raster type font</span>
                                <span class="c">//     Console\TrueTypeFont  --- true type font</span>
                                <span class="c">// For CJK characters, if it&#39;s TrueType, we need to output the trailing character marked with &quot;Trailing_byte&quot;</span>
                                <span class="c">// attribute. But if it&#39;s RasterFont, we ignore the trailing character, and the &quot;Leading_byte&quot;/&quot;Trailing_byte&quot;</span>
                                <span class="c">// attributes are not effective at all when reading the character from the console buffer.</span>
                                <b>if</b> (<span class="r145 r">lastCharIsLeading</span> &amp;&amp; <span class="r134 r">trueTypeInUse</span>)
                                {
                                    <span class="c">// For TrueType Font, we output the trailing byte with &quot;Trailing_byte&quot; attribute</span>
                                    <span class="r143 r">characterBuffer</span>[<span class="r144 r">characterBufferIndex</span>].<a href="#99811542029cf255" class="i field">UnicodeChar</a> = <span class="r146 r">lastLeadingCell</span>.<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a>;
                                    <span class="r143 r">characterBuffer</span>[<span class="r144 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a> =
                                        (<b>ushort</b>)(<span class="i">ColorToWORD</span>(<span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a>, <span class="r128 r">contents</span>[<span class="r147 r">r</span>, <span class="r148 r">c</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a>)
                                                | (<b>ushort</b>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#9c28974a86e93297" class="t t">CHAR_INFO_Attributes</a>.<a href="#2a905313eae4f173" class="i field">COMMON_LVB_TRAILING_BYTE</a>);
                                }
                                <b>else</b>
                                {
                                    <span class="c">// We don&#39;t output anything for this cell if Raster font is in use, or if the last cell is not a leading byte</span>
                                    <span class="r144 r">characterBufferIndex</span>--;
                                }
 
                                <span class="r145 r">lastCharIsLeading</span> = <b>false</b>;
                            }
                        }
                    }
 
                    <span class="c">// Now writeRegion, bufferSize and characterBuffer are updated.</span>
                    <span class="c">// Call NativeMethods.WriteConsoleOutput</span>
                    <b>bool</b> <span id="r149 rd" class="r149 r">result</span>;
                    <b>if</b> ((<span class="r129 r">rowType</span> &amp; <a href="#130e594dc7838367" class="t t">BufferCellArrayRowType</a>.<a href="#81c7b89db5f58601" class="i field">RightLeading</a>) != 0 &amp;&amp;
                            <span class="r141 r">colsRemaining</span> == <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>)
                    {
                        <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r150 rd" class="r150 r">bSize</span> = <span class="r139 r">bufferSize</span>;
                        <span class="r150 r">bSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>++;
                        <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r151 rd" class="r151 r">wRegion</span> = <span class="r137 r">writeRegion</span>;
                        <span class="r151 r">wRegion</span>.<a href="#0016188fa9c34162" class="i field">Right</a>++;
                        <span class="c">// Suppress the PreFAST warning about not using Marshal.GetLastWin32Error() to</span>
                        <span class="c">// get the error code.</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56523
                        <span class="r149 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">WriteConsoleOutput</span>(
                            <span class="r125 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                            <span class="r143 r">characterBuffer</span>,
                            <span class="r150 r">bSize</span>,
                            <span class="r136 r">bufferCoord</span>,
                            <b>ref</b> <span class="r151 r">wRegion</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// Suppress the PreFAST warning about not using Marshal.GetLastWin32Error() to</span>
                        <span class="c">// get the error code.</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56523
                        <span class="r149 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">WriteConsoleOutput</span>(
                            <span class="r125 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                            <span class="r143 r">characterBuffer</span>,
                            <span class="r139 r">bufferSize</span>,
                            <span class="r136 r">bufferCoord</span>,
                            <b>ref</b> <span class="r137 r">writeRegion</span>);
                    }
 
                    <b>if</b> (!<span class="r149 r">result</span>)
                    {
                        <span class="c">// When WriteConsoleOutput fails, half bufferLimit</span>
                        <b>if</b> (<span class="r135 r">bufferLimit</span> &lt; 2)
                        {
                            <b>int</b> <span id="r152 rd" class="r152 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r153 rd" class="r153 r">e</span> = <span class="i">CreateHostException</span>(<span class="r152 r">err</span>, <span class="s">&quot;WriteConsoleOutput&quot;</span>,
                                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">WriteConsoleOutputExceptionTemplate</span>);
                            <b>throw</b> <span class="r153 r">e</span>;
                        }
 
                        <span class="r135 r">bufferLimit</span> /= 2;
                        <b>if</b> (<span class="r131 r">cols</span> == <span class="r141 r">colsRemaining</span>)
                        {
                            <span class="c">// if cols == colsRemaining, nothing is guaranteed written in this pass and</span>
                            <span class="c">//  the unwritten area is still rectangular</span>
                            <span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
                            <b>break</b>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// some areas have been written. This could only happen when the number of columns</span>
                            <span class="c">// to write is larger than bufferLimit. In that case, the algorithm writes one row</span>
                            <span class="c">// at a time =&gt; bufferSize.Y == 1. Then, we can safely leave bufferSize.Y unchanged</span>
                            <span class="c">// to retry with a smaller bufferSize.X.</span>
                            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> == 1, <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;bufferSize.Y should be 1, but is {0}&quot;</span>, <span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>));
                            <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r141 r">colsRemaining</span>, <span class="r135 r">bufferLimit</span>);
                            <b>continue</b>;
                        }
                    }
 
                    <span class="r141 r">colsRemaining</span> -= <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <span class="r137 r">writeRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> += <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <span class="r139 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r141 r">colsRemaining</span>, <span class="r135 r">bufferLimit</span>);
                }  <span class="c">// column iteration</span>
 
                <span class="r138 r">rowsRemaining</span> -= <span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
                <span class="r137 r">writeRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> += <span class="r139 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
            }  <span class="c">// row iteration</span>
        }
 
        <b>private static void</b> <a id="d340df63d0057dfb" href="../../R/d340df63d0057dfb.html" target="n" data-glyph="76,1" class="i method">WriteConsoleOutputPlain</a>(<span class="i">ConsoleHandle</span> <span id="r154 rd" class="r154 r">consoleHandle</span>, <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r155 rd" class="r155 r">origin</span>, <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r156 rd" class="r156 r">contents</span>)
        {
            <b>int</b> <span id="r157 rd" class="r157 r">rows</span> = <span class="r156 r">contents</span>.<span class="i">GetLength</span>(0);
            <b>int</b> <span id="r158 rd" class="r158 r">cols</span> = <span class="r156 r">contents</span>.<span class="i">GetLength</span>(1);
 
            <b>if</b> ((<span class="r157 r">rows</span> &lt;= 0) || <span class="r158 r">cols</span> &lt;= 0)
            {
                <a href="#25a8024fd022835d" class="i field">tracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;contents passed in has 0 rows and columns&quot;</span>);
                <b>return</b>;
            }
 
            <b>int</b> <span id="r159 rd" class="r159 r">bufferLimit</span> = 2 * 1024; <span class="c">// Limit is 8K bytes as each CHAR_INFO takes 4 bytes</span>
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r160 rd" class="r160 r">bufferCoord</span>;
 
            <span class="r160 r">bufferCoord</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = 0;
            <span class="r160 r">bufferCoord</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
 
            <span class="c">// keeps track of which screen area write</span>
            <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r161 rd" class="r161 r">writeRegion</span>;
 
            <span class="r161 r">writeRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> = (<b>short</b>)<span class="r155 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>;
 
            <b>int</b> <span id="r162 rd" class="r162 r">rowsRemaining</span> = <span class="r157 r">rows</span>;
 
            <b>while</b> (<span class="r162 r">rowsRemaining</span> &gt; 0)
            {
                <span class="c">// Iteration of columns is nested inside iteration of rows.</span>
                <span class="c">// If the size of contents exceeds the buffer limit, writing is</span>
                <span class="c">// done in blocks of size equal to the bufferlimit from left to right</span>
                <span class="c">// then top to bottom.</span>
                <span class="c">// For each iteration of rows,</span>
                <span class="c">// - writeRegion.Left and bufferSize.X are reset</span>
                <span class="c">// - rowsRemaining, writeRegion.Top, writeRegion.Bottom, and bufferSize.Y</span>
                <span class="c">//     are updated</span>
                <span class="c">//   For each iteration of columns,</span>
                <span class="c">//   - writeRegion.Left, writeRegion.Right and bufferSize.X are updated</span>
 
                <span class="r161 r">writeRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> = (<b>short</b>)<span class="r155 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>;
 
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r163 rd" class="r163 r">bufferSize</span>;
 
                <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r158 r">cols</span>, <span class="r159 r">bufferLimit</span>);
                <span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>
                                        (
                                            <span class="r162 r">rowsRemaining</span>,
                                            <span class="r159 r">bufferLimit</span> / <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>
                                        );
                <span class="r161 r">writeRegion</span>.<a href="#2a466af33d30108e" class="i field">Bottom</a> = (<b>short</b>)(<span class="r161 r">writeRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> + <span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> - 1);
 
                <span class="c">// atRow is at which row of contents a particular iteration is operating</span>
                <b>int</b> <span id="r164 rd" class="r164 r">atRow</span> = <span class="r157 r">rows</span> - <span class="r162 r">rowsRemaining</span> + <span class="r156 r">contents</span>.<span class="i">GetLowerBound</span>(0);
 
                <span class="c">// number of columns yet to be written</span>
                <b>int</b> <span id="r165 rd" class="r165 r">colsRemaining</span> = <span class="r158 r">cols</span>;
 
                <b>while</b> (<span class="r165 r">colsRemaining</span> &gt; 0)
                {
                    <span class="r161 r">writeRegion</span>.<a href="#0016188fa9c34162" class="i field">Right</a> = (<b>short</b>)(<span class="r161 r">writeRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> + <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> - 1);
 
                    <span class="c">// atCol is at which column of contents a particular iteration is operating</span>
                    <b>int</b> <span id="r166 rd" class="r166 r">atCol</span> = <span class="r158 r">cols</span> - <span class="r165 r">colsRemaining</span> + <span class="r156 r">contents</span>.<span class="i">GetLowerBound</span>(1);
                    <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[] <span id="r167 rd" class="r167 r">characterBuffer</span> = <b>new</b> <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[<span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> * <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>];
 
                    <span class="c">// copy characterBuffer to contents;</span>
                    <b>for</b> (<b>int</b> <span id="r168 rd" class="r168 r">r</span> = <span class="r164 r">atRow</span>, <span id="r169 rd" class="r169 r">characterBufferIndex</span> = 0;
                        <span class="r168 r">r</span> &lt; <span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> + <span class="r164 r">atRow</span>; <span class="r168 r">r</span>++)
                    {
                        <b>for</b> (<b>int</b> <span id="r170 rd" class="r170 r">c</span> = <span class="r166 r">atCol</span>; <span class="r170 r">c</span> &lt; <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> + <span class="r166 r">atCol</span>; <span class="r170 r">c</span>++, <span class="r169 r">characterBufferIndex</span>++)
                        {
                            <span class="r167 r">characterBuffer</span>[<span class="r169 r">characterBufferIndex</span>].<a href="#99811542029cf255" class="i field">UnicodeChar</a> =
                                (<b>ushort</b>)<span class="r156 r">contents</span>[<span class="r168 r">r</span>, <span class="r170 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a>;
                            <span class="r167 r">characterBuffer</span>[<span class="r169 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a> =
                                <span class="i">ColorToWORD</span>(<span class="r156 r">contents</span>[<span class="r168 r">r</span>, <span class="r170 r">c</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a>, <span class="r156 r">contents</span>[<span class="r168 r">r</span>, <span class="r170 r">c</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a>);
                        }
                    }
 
                    <span class="c">// Now writeRegion, bufferSize and characterBuffer are updated.</span>
                    <span class="c">// Call NativeMethods.WriteConsoleOutput</span>
                    <b>bool</b> <span id="r171 rd" class="r171 r">result</span> =
                        <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">WriteConsoleOutput</span>(
                            <span class="r154 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                            <span class="r167 r">characterBuffer</span>,
                            <span class="r163 r">bufferSize</span>,
                            <span class="r160 r">bufferCoord</span>,
                            <b>ref</b> <span class="r161 r">writeRegion</span>);
 
                    <b>if</b> (!<span class="r171 r">result</span>)
                    {
                        <span class="c">// When WriteConsoleOutput fails, half bufferLimit</span>
                        <b>if</b> (<span class="r159 r">bufferLimit</span> &lt; 2)
                        {
                            <b>int</b> <span id="r172 rd" class="r172 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
                            <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r173 rd" class="r173 r">e</span> = <span class="i">CreateHostException</span>(<span class="r172 r">err</span>, <span class="s">&quot;WriteConsoleOutput&quot;</span>,
                                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">WriteConsoleOutputExceptionTemplate</span>);
                            <b>throw</b> <span class="r173 r">e</span>;
                        }
 
                        <span class="r159 r">bufferLimit</span> /= 2;
                        <b>if</b> (<span class="r158 r">cols</span> == <span class="r165 r">colsRemaining</span>)
                        {
                            <span class="c">// if cols == colsRemaining, nothing is guaranteed written in this pass and</span>
                            <span class="c">//  the unwritten area is still rectangular</span>
                            <span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
                            <b>break</b>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// some areas have been written. This could only happen when the number of columns</span>
                            <span class="c">// to write is larger than bufferLimit. In that case, the algorithm writes one row</span>
                            <span class="c">// at a time =&gt; bufferSize.Y == 1. Then, we can safely leave bufferSize.Y unchanged</span>
                            <span class="c">// to retry with a smaller bufferSize.X.</span>
                            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> == 1, <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;bufferSize.Y should be 1, but is {0}&quot;</span>, <span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>));
                            <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r165 r">colsRemaining</span>, <span class="r159 r">bufferLimit</span>);
                            <b>continue</b>;
                        }
                    }
 
                    <span class="r165 r">colsRemaining</span> -= <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <span class="r161 r">writeRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> += <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <span class="r163 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r165 r">colsRemaining</span>, <span class="r159 r">bufferLimit</span>);
                }  <span class="c">// column iteration</span>
 
                <span class="r162 r">rowsRemaining</span> -= <span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
                <span class="r161 r">writeRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> += <span class="r163 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
            }  <span class="c">// row iteration</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wrap32 ReadConsoleOutput</span>
        <span class="c">///</span><span class="c"> This wrapper is not limited to 64K or 8K CHAR_INFO to which Win32&#39;s ReadConsoleOutput</span>
        <span class="c">///</span><span class="c"> is constrained.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where output is read</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">origin</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> location on screen buffer where reading begins</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">contentsRegion</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> indicates the area in </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">contents</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> where the data read</span>
        <span class="c">///</span><span class="c"> is stored.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">contents</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> this is ref because the bounds and size of the array are needed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is not enough memory to complete calls to Win32&#39;s ReadConsoleOutput</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="c635f6fe721b9351" href="../../R/c635f6fe721b9351.html" target="n" data-glyph="74,1" class="i method">ReadConsoleOutput</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r174 rd" class="r174 r">consoleHandle</span>,
            <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r175 rd" class="r175 r">origin</span>,
            <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r176 rd" class="r176 r">contentsRegion</span>,
            <b>ref</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r177 rd" class="r177 r">contents</span>
        )
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r174 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r174 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
            <b>uint</b> <span id="r178 rd" class="r178 r">codePage</span>;
            <b>if</b> (<a href="#b4d45aadc9c3920c" class="i method">IsCJKOutputCodePage</a>(<b>out</b> <span class="r178 r">codePage</span>))
            {
                <a href="#9f652e9aab6b1d6d" class="i method">ReadConsoleOutputCJK</a>(<span class="r174 r">consoleHandle</span>, <span class="r178 r">codePage</span>, <span class="r175 r">origin</span>, <span class="r176 r">contentsRegion</span>, <b>ref</b> <span class="r177 r">contents</span>);
                <span class="c">// check left edge</span>
                <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r179 rd" class="r179 r">cellArray</span> = <b>null</b>;
                <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r180 rd" class="r180 r">checkOrigin</span>;
                <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r181 rd" class="r181 r">cellArrayRegion</span> = <b>new</b> <span class="t">Rectangle</span>(0, 0, 1, <span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> - <span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>);
                <b>if</b> (<span class="r175 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> &gt; 0 &amp;&amp; <a href="#414777b1586a0e8c" class="i method">ShouldCheck</a>(<span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>, <span class="r177 r">contents</span>, <span class="r176 r">contentsRegion</span>))
                {
                    <span class="r179 r">cellArray</span> = <b>new</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[<span class="r181 r">cellArrayRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> + 1, 2];
                    <span class="r180 r">checkOrigin</span> = <b>new</b> <span class="t">Coordinates</span>(<span class="r175 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> - 1, <span class="r175 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>);
                    <a href="#9f652e9aab6b1d6d" class="i method">ReadConsoleOutputCJK</a>(<span class="r174 r">consoleHandle</span>, <span class="r178 r">codePage</span>, <span class="r180 r">checkOrigin</span>,
                        <span class="r181 r">cellArrayRegion</span>, <b>ref</b> <span class="r179 r">cellArray</span>);
                    <b>for</b> (<b>int</b> <span id="r182 rd" class="r182 r">i</span> = 0; <span class="r182 r">i</span> &lt;= <span class="r181 r">cellArrayRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>; <span class="r182 r">i</span>++)
                    {
                        <b>if</b> (<span class="r179 r">cellArray</span>[<span class="r182 r">i</span>, 0].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>)
                        {
                            <span class="r177 r">contents</span>[<span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> + <span class="r182 r">i</span>, 0].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> = (<b>char</b>)0;
                            <span class="r177 r">contents</span>[<span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> + <span class="r182 r">i</span>, 0].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> = <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a>;
                        }
                    }
                }
 
                <span class="c">// check right edge</span>
                <a href="#e8b5dc8576b8da6f" class="t t">ConsoleControl</a>.<a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <span id="r183 rd" class="r183 r">bufferInfo</span> =
                    <a href="#a992b7826acc25f2" class="i method">GetConsoleScreenBufferInfo</a>(<span class="r174 r">consoleHandle</span>);
                <b>if</b> (<span class="r175 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> + (<span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>) + 1 &lt; <span class="r183 r">bufferInfo</span>.<a href="#8948dd4587a0e93f" class="i field">BufferSize</a>.<a href="#0742affafd7a86ed" class="i field">X</a> &amp;&amp;
                    <a href="#414777b1586a0e8c" class="i method">ShouldCheck</a>(<span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>, <span class="r177 r">contents</span>, <span class="r176 r">contentsRegion</span>))
                {
                    <b>if</b> (<span class="r179 r">cellArray</span> == <b>null</b>)
                    {
                        <span class="r179 r">cellArray</span> = <b>new</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[<span class="r181 r">cellArrayRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> + 1, 2];
                    }
 
                    <span class="r180 r">checkOrigin</span> = <b>new</b> <span class="t">Coordinates</span>(<span class="r175 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> +
                        (<span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>), <span class="r175 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>);
                    <a href="#9f652e9aab6b1d6d" class="i method">ReadConsoleOutputCJK</a>(<span class="r174 r">consoleHandle</span>, <span class="r178 r">codePage</span>, <span class="r180 r">checkOrigin</span>,
                        <span class="r181 r">cellArrayRegion</span>, <b>ref</b> <span class="r179 r">cellArray</span>);
                    <b>for</b> (<b>int</b> <span id="r184 rd" class="r184 r">i</span> = 0; <span class="r184 r">i</span> &lt;= <span class="r181 r">cellArrayRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>; <span class="r184 r">i</span>++)
                    {
                        <b>if</b> (<span class="r179 r">cellArray</span>[<span class="r184 r">i</span>, 0].<a href="/System.Management.Automation/A.html#2dbed14bfac26d72" class="i property">BufferCellType</a> == <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>)
                        {
                            <span class="r177 r">contents</span>[<span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> + <span class="r184 r">i</span>, <span class="r176 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>] = <span class="r179 r">cellArray</span>[<span class="r184 r">i</span>, 0];
                        }
                    }
                }
            }
            <b>else</b>
            {
                <a href="#29754fe59d96a91e" class="i method">ReadConsoleOutputPlain</a>(<span class="r174 r">consoleHandle</span>, <span class="r175 r">origin</span>, <span class="r176 r">contentsRegion</span>, <b>ref</b> <span class="r177 r">contents</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ReadConsoleOutput CJK
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If an edge cell read is a blank, it is potentially part of a double width character. Hence,</span>
        <span class="c">///</span><span class="c">  at least one of the left and right edges should be checked.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r185 r">edge</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r186 r">contents</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">contentsRegion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="414777b1586a0e8c" href="../../R/414777b1586a0e8c.html" target="n" data-glyph="76,1" class="i method">ShouldCheck</a>(<b>int</b> <span id="r185 rd" class="r185 r">edge</span>, <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r186 rd" class="r186 r">contents</span>, <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r187 rd" class="r187 r">contentsRegion</span>)
        {
            <b>for</b> (<b>int</b> <span id="r188 rd" class="r188 r">i</span> = <span class="r187 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>; <span class="r188 r">i</span> &lt;= <span class="r187 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>; <span class="r188 r">i</span>++)
            {
                <b>if</b> (<span class="r186 r">contents</span>[<span class="r188 r">i</span>, <span class="r185 r">edge</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> == <span class="s">&#39; &#39;</span>)
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static bool</b> <a id="c3a84df3e850f1ba" href="../../R/c3a84df3e850f1ba.html" target="n" data-glyph="76,1" class="i method">ReadConsoleOutputCJKSmall</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r189 rd" class="r189 r">consoleHandle</span>,
            <b>uint</b> <span id="r190 rd" class="r190 r">codePage</span>,
            <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r191 rd" class="r191 r">origin</span>,
            <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r192 rd" class="r192 r">contentsRegion</span>,
            <b>ref</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r193 rd" class="r193 r">contents</span>
        )
        {
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r194 rd" class="r194 r">bufferSize</span>;
            <span class="r194 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)(<span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> + 1);
            <span class="r194 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)(<span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> - <span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> + 1);
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r195 rd" class="r195 r">bufferCoord</span>;
            <span class="r195 r">bufferCoord</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = 0;
            <span class="r195 r">bufferCoord</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
            <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[] <span id="r196 rd" class="r196 r">characterBuffer</span> = <b>new</b> <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[<span class="r194 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> * <span class="r194 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>];
            <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r197 rd" class="r197 r">readRegion</span>;
            <span class="r197 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> = (<b>short</b>)<span class="r191 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>;
            <span class="r197 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> = (<b>short</b>)<span class="r191 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>;
            <span class="r197 r">readRegion</span>.<a href="#0016188fa9c34162" class="i field">Right</a> = (<b>short</b>)(<span class="r191 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a> + <span class="r194 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> - 1);
            <span class="r197 r">readRegion</span>.<a href="#2a466af33d30108e" class="i field">Bottom</a> = (<b>short</b>)(<span class="r191 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a> + <span class="r194 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> - 1);
            <span class="c">// Suppress the PreFAST warning about not using Marshal.GetLastWin32Error() to</span>
            <span class="c">// get the error code.</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56523
            <b>bool</b> <span id="r198 rd" class="r198 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">ReadConsoleOutput</span>(
                                        <span class="r189 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                                        <span class="r196 r">characterBuffer</span>,
                                        <span class="r194 r">bufferSize</span>,
                                        <span class="r195 r">bufferCoord</span>,
                                        <b>ref</b> <span class="r197 r">readRegion</span>);
            <b>if</b> (!<span class="r198 r">result</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>int</b> <span id="r199 rd" class="r199 r">characterBufferIndex</span> = 0;
 
            <b>for</b> (<b>int</b> <span id="r200 rd" class="r200 r">r</span> = <span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>; <span class="r200 r">r</span> &lt;= <span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>; <span class="r200 r">r</span>++)
            {
                <b>for</b> (<b>int</b> <span id="r201 rd" class="r201 r">c</span> = <span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>; <span class="r201 r">c</span> &lt;= <span class="r192 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>; <span class="r201 r">c</span>++, <span class="r199 r">characterBufferIndex</span>++)
                {
                    <span class="i">ConsoleColor</span> <span id="r202 rd" class="r202 r">fgColor</span>, <span id="r203 rd" class="r203 r">bgColor</span>;
 
                    <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> = (<b>char</b>)<span class="r196 r">characterBuffer</span>[<span class="r199 r">characterBufferIndex</span>].<a href="#99811542029cf255" class="i field">UnicodeChar</a>;
                    <a href="#a92de6f8349ea0f7" class="i method">WORDToColor</a>(<span class="r196 r">characterBuffer</span>[<span class="r199 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a>,
                                <b>out</b> <span class="r202 r">fgColor</span>,
                                <b>out</b> <span class="r203 r">bgColor</span>);
                    <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a> = <span class="r202 r">fgColor</span>;
                    <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a> = <span class="r203 r">bgColor</span>;
 
                    <span class="c">// Set the attributes of the buffercells to be the same as that of the</span>
                    <span class="c">// incoming CHAR_INFO. In case where the CHAR_INFO character is a</span>
                    <span class="c">// trailing byte set the Character of BufferCell to 0. This is done</span>
                    <span class="c">// because at a lot of places this check is being done. Having a trailing</span>
                    <span class="c">// character to be 0 is by design.</span>
 
                    <b>if</b> ((<span class="r196 r">characterBuffer</span>[<span class="r199 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a> &amp; (<b>ushort</b>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#9c28974a86e93297" class="t t">CHAR_INFO_Attributes</a>.<a href="#eddb350a87124adc" class="i field">COMMON_LVB_LEADING_BYTE</a>)
                            == (<b>ushort</b>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#9c28974a86e93297" class="t t">CHAR_INFO_Attributes</a>.<a href="#eddb350a87124adc" class="i field">COMMON_LVB_LEADING_BYTE</a>)
                    {
                        <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<span class="i">BufferCellType</span> = <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>;
                    }
                    <b>else</b> <b>if</b> ((<span class="r196 r">characterBuffer</span>[<span class="r199 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a> &amp; (<b>ushort</b>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#9c28974a86e93297" class="t t">CHAR_INFO_Attributes</a>.<a href="#2a905313eae4f173" class="i field">COMMON_LVB_TRAILING_BYTE</a>)
                            == (<b>ushort</b>)<a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#9c28974a86e93297" class="t t">CHAR_INFO_Attributes</a>.<a href="#2a905313eae4f173" class="i field">COMMON_LVB_TRAILING_BYTE</a>)
                    {
                        <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> = (<b>char</b>)0;
                        <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<span class="i">BufferCellType</span> = <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a>;
                    }
                    <b>else</b>
                    {
                        <b>int</b> <span id="r204 rd" class="r204 r">charLength</span> = <a href="#e26e981e21022d34" class="i method">LengthInBufferCells</a>(<span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a>);
                        <b>if</b> (<span class="r204 r">charLength</span> == 2)
                        {
                            <span class="c">// When it&#39;s RasterFont, the &quot;Leading_byte&quot;/&quot;Trailing_byte&quot; are not effective, we</span>
                            <span class="c">// need to decide the leading byte by checking the char length.</span>
                            <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<span class="i">BufferCellType</span> = <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#f6d6d49b392106b7" class="i field">Leading</a>;
                            <span class="r201 r">c</span>++;
                            <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> = (<b>char</b>)0;
                            <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a> = <span class="r202 r">fgColor</span>;
                            <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a> = <span class="r203 r">bgColor</span>;
                            <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<span class="i">BufferCellType</span> = <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#3ff75c3285a036d7" class="i field">Trailing</a>;
                        }
                        <b>else</b>
                        {
                            <span class="r193 r">contents</span>[<span class="r200 r">r</span>, <span class="r201 r">c</span>].<span class="i">BufferCellType</span> = <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#09bc52b9f7ebe144" class="i field">Complete</a>;
                        }
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Can handle reading CJK characters, but the left and right edges are not checked.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r205 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r206 r">codePage</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r207 r">origin</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">contentsRegion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">contents</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is not enough memory to complete calls to Win32&#39;s ReadConsoleOutput</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="9f652e9aab6b1d6d" href="../../R/9f652e9aab6b1d6d.html" target="n" data-glyph="74,1" class="i method">ReadConsoleOutputCJK</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r205 rd" class="r205 r">consoleHandle</span>,
            <b>uint</b> <span id="r206 rd" class="r206 r">codePage</span>,
            <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r207 rd" class="r207 r">origin</span>,
            <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r208 rd" class="r208 r">contentsRegion</span>,
            <b>ref</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r209 rd" class="r209 r">contents</span>
        )
        {
            <b>int</b> <span id="r210 rd" class="r210 r">rows</span> = <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> - <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> + 1;
            <b>int</b> <span id="r211 rd" class="r211 r">cols</span> = <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> + 1;
 
            <b>if</b> ((<span class="r210 r">rows</span> &lt;= 0) || <span class="r211 r">cols</span> &lt;= 0)
            {
                <a href="#25a8024fd022835d" class="i field">tracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;invalid contents region&quot;</span>);
                <b>return</b>;
            }
 
            <b>int</b> <span id="r212 rd" class="r212 r">bufferLimit</span> = 2 * 1024; <span class="c">// Limit is 8K bytes as each CHAR_INFO takes 4 bytes</span>
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r213 rd" class="r213 r">bufferCoord</span>;
 
            <span class="r213 r">bufferCoord</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = 0;
            <span class="r213 r">bufferCoord</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
 
            <span class="c">// keeps track of which screen area is read</span>
            <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r214 rd" class="r214 r">readRegion</span>;
 
            <span class="r214 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> = (<b>short</b>)<span class="r207 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>;
 
            <b>int</b> <span id="r215 rd" class="r215 r">rowsRemaining</span> = <span class="r210 r">rows</span>;
 
            <b>while</b> (<span class="r215 r">rowsRemaining</span> &gt; 0)
            {
                <span class="c">// Iteration of columns is nested inside iteration of rows.</span>
                <span class="c">// If the size of contents exceeds the buffer limit, reading is</span>
                <span class="c">// done in blocks of size equal to the bufferlimit from left to right</span>
                <span class="c">// then top to bottom.</span>
                <span class="c">// For each iteration of rows,</span>
                <span class="c">// - readRegion.Left and bufferSize.X are reset</span>
                <span class="c">// - rowsRemaining, readRegion.Top, readRegion.Bottom, and bufferSize.Y</span>
                <span class="c">//     are updated</span>
                <span class="c">//   For each iteration of columns,</span>
                <span class="c">//   - readRegion.Left, readRegion.Right and bufferSize.X are updated</span>
 
                <span class="r214 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> = (<b>short</b>)<span class="r207 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>;
 
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r216 rd" class="r216 r">bufferSize</span>;
                <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r211 r">cols</span>, <span class="r212 r">bufferLimit</span>);
                <span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>
                                        (
                                            <span class="r215 r">rowsRemaining</span>,
                                            <span class="r212 r">bufferLimit</span> / <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>
                                        );
                <span class="r214 r">readRegion</span>.<a href="#2a466af33d30108e" class="i field">Bottom</a> = (<b>short</b>)(<span class="r214 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> + <span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> - 1);
 
                <span class="c">// atContentsRow is at which row of contents a particular iteration is operating</span>
                <b>int</b> <span id="r217 rd" class="r217 r">atContentsRow</span> = <span class="r210 r">rows</span> - <span class="r215 r">rowsRemaining</span> + <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>;
 
                <span class="c">// number of columns yet to be read</span>
                <b>int</b> <span id="r218 rd" class="r218 r">colsRemaining</span> = <span class="r211 r">cols</span>;
 
                <b>while</b> (<span class="r218 r">colsRemaining</span> &gt; 0)
                {
                    <span class="c">// atContentsCol is at which column of contents a particular iteration is operating</span>
                    <b>int</b> <span id="r219 rd" class="r219 r">atContentsCol</span> = <span class="r211 r">cols</span> - <span class="r218 r">colsRemaining</span> + <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>;
 
                    <span class="r214 r">readRegion</span>.<a href="#0016188fa9c34162" class="i field">Right</a> = (<b>short</b>)(<span class="r214 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> + <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> - 1);
 
                    <span class="c">// Now readRegion and bufferSize are updated.</span>
                    <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r220 rd" class="r220 r">atContents</span> = <b>new</b> <span class="t">Rectangle</span>(<span class="r219 r">atContentsCol</span>, <span class="r217 r">atContentsRow</span>,
                                <span class="r219 r">atContentsCol</span> + <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> - 1, <span class="r217 r">atContentsRow</span> + <span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> - 1);
                    <b>bool</b> <span id="r221 rd" class="r221 r">result</span> =
                        <a href="#c3a84df3e850f1ba" class="i method">ReadConsoleOutputCJKSmall</a>(<span class="r205 r">consoleHandle</span>, <span class="r206 r">codePage</span>,
                            <b>new</b> <span class="t">Coordinates</span>(<span class="r214 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a>, <span class="r214 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a>),
                            <span class="r220 r">atContents</span>,
                            <b>ref</b> <span class="r209 r">contents</span>);
                    <b>if</b> (!<span class="r221 r">result</span>)
                    {
                        <span class="c">// When WriteConsoleOutput fails, half bufferLimit</span>
                        <b>if</b> (<span class="r212 r">bufferLimit</span> &lt; 2)
                        {
                            <b>int</b> <span id="r222 rd" class="r222 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                            <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r223 rd" class="r223 r">e</span> = <span class="i">CreateHostException</span>(<span class="r222 r">err</span>, <span class="s">&quot;ReadConsoleOutput&quot;</span>,
                                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">ReadConsoleOutputExceptionTemplate</span>);
                            <b>throw</b> <span class="r223 r">e</span>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// if cols == colsRemaining, nothing is guaranteed read in this pass and</span>
                            <span class="c">//  the unread area is still rectangular</span>
                            <span class="r212 r">bufferLimit</span> /= 2;
                            <b>if</b> (<span class="r211 r">cols</span> == <span class="r218 r">colsRemaining</span>)
                            {
                                <span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
                                <b>break</b>;
                            }
                            <b>else</b>
                            {
                                <span class="c">// some areas have been read. This could only happen when the number of columns</span>
                                <span class="c">// to write is larger than bufferLimit. In that case, the algorithm reads one row</span>
                                <span class="c">// at a time =&gt; bufferSize.Y == 1. Then, we can safely leave bufferSize.Y unchanged</span>
                                <span class="c">// to retry with a smaller bufferSize.X.</span>
                                <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> == 1, <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;bufferSize.Y should be 1, but is {0}&quot;</span>, <span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>));
                                <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r218 r">colsRemaining</span>, <span class="r212 r">bufferLimit</span>);
                                <b>continue</b>;
                            }
                        }
                    }
 
                    <span class="r218 r">colsRemaining</span> -= <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <span class="r214 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> += <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <b>if</b> (<span class="r218 r">colsRemaining</span> &gt; 0 &amp;&amp; (<span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> == 1) &amp;&amp;
                        (<span class="r209 r">contents</span>[<span class="r220 r">atContents</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a>, <span class="r220 r">atContents</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> == <span class="s">&#39; &#39;</span>))
                    {
                        <span class="r218 r">colsRemaining</span>++;
                        <span class="r214 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a>--;
                    }
 
                    <span class="r216 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r218 r">colsRemaining</span>, <span class="r212 r">bufferLimit</span>);
                }  <span class="c">// column iteration</span>
 
                <span class="r215 r">rowsRemaining</span> -= <span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
                <span class="r214 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> += <span class="r216 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
            }  <span class="c">// row iteration</span>
 
            <span class="c">// The following nested loop set the value of the empty cells in contents:</span>
            <span class="c">// character to &#39; &#39;</span>
            <span class="c">// foreground color to console&#39;s foreground color</span>
            <span class="c">// background color to console&#39;s background color</span>
            <b>int</b> <span id="r224 rd" class="r224 r">rowIndex</span> = <span class="r209 r">contents</span>.<span class="i">GetLowerBound</span>(0);
            <b>int</b> <span id="r225 rd" class="r225 r">rowEnd</span> = <span class="r209 r">contents</span>.<span class="i">GetUpperBound</span>(0);
            <b>int</b> <span id="r226 rd" class="r226 r">colBegin</span> = <span class="r209 r">contents</span>.<span class="i">GetLowerBound</span>(1);
            <b>int</b> <span id="r227 rd" class="r227 r">colEnd</span> = <span class="r209 r">contents</span>.<span class="i">GetUpperBound</span>(1);
            <a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <span id="r228 rd" class="r228 r">bufferInfo</span> =
                        <a href="#a992b7826acc25f2" class="i method">GetConsoleScreenBufferInfo</a>(<span class="r205 r">consoleHandle</span>);
            <span class="i">ConsoleColor</span> <span id="r229 rd" class="r229 r">foreground</span> = 0;
            <span class="i">ConsoleColor</span> <span id="r230 rd" class="r230 r">background</span> = 0;
 
            <a href="#a92de6f8349ea0f7" class="i method">WORDToColor</a>(
                            <span class="r228 r">bufferInfo</span>.<a href="#0d610058fdf6684a" class="i field">Attributes</a>,
                            <b>out</b> <span class="r229 r">foreground</span>,
                            <b>out</b> <span class="r230 r">background</span>
                        );
 
            <b>while</b> (<span class="r224 r">rowIndex</span> &lt;= <span class="r225 r">rowEnd</span>)
            {
                <b>int</b> <span id="r231 rd" class="r231 r">colIndex</span> = <span class="r226 r">colBegin</span>;
                <b>while</b> (<b>true</b>)
                {
                    <span class="c">// if contents[rowIndex,colIndex] is in contentsRegion, hence a non-empty cell,</span>
                    <span class="c">// move colIndex to one past the right end of contentsRegion</span>
                    <b>if</b> (<span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> &lt;= <span class="r224 r">rowIndex</span> &amp;&amp; <span class="r224 r">rowIndex</span> &lt;= <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> &amp;&amp;
                        <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> &lt;= <span class="r231 r">colIndex</span> &amp;&amp; <span class="r231 r">colIndex</span> &lt;= <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>)
                    {
                        <span class="r231 r">colIndex</span> = <span class="r208 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> + 1;
                    }
                    <span class="c">// colIndex past contents last column</span>
                    <b>if</b> (<span class="r231 r">colIndex</span> &gt; <span class="r227 r">colEnd</span>)
                    {
                        <b>break</b>;
                    }
 
                    <span class="r209 r">contents</span>[<span class="r224 r">rowIndex</span>, <span class="r231 r">colIndex</span>] = <b>new</b> <span class="t">BufferCell</span>(
                        <span class="s">&#39; &#39;</span>, <span class="r229 r">foreground</span>, <span class="r230 r">background</span>, <a href="/System.Management.Automation/A.html#3c3f2b2b5dfb7582" class="t t">BufferCellType</a>.<a href="/System.Management.Automation/A.html#09bc52b9f7ebe144" class="i field">Complete</a>);
                    <span class="r231 r">colIndex</span>++;
                }
 
                <span class="r224 r">rowIndex</span>++;
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ReadConsoleOutput CJK
 
        <b>private static void</b> <a id="29754fe59d96a91e" href="../../R/29754fe59d96a91e.html" target="n" data-glyph="76,1" class="i method">ReadConsoleOutputPlain</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r232 rd" class="r232 r">consoleHandle</span>,
            <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r233 rd" class="r233 r">origin</span>,
            <a href="/System.Management.Automation/A.html#bf950e0fd28033b0" class="t t">Rectangle</a> <span id="r234 rd" class="r234 r">contentsRegion</span>,
            <b>ref</b> <a href="/System.Management.Automation/A.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r235 rd" class="r235 r">contents</span>
        )
        {
            <b>int</b> <span id="r236 rd" class="r236 r">rows</span> = <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> - <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> + 1;
            <b>int</b> <span id="r237 rd" class="r237 r">cols</span> = <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> - <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> + 1;
 
            <b>if</b> ((<span class="r236 r">rows</span> &lt;= 0) || <span class="r237 r">cols</span> &lt;= 0)
            {
                <a href="#25a8024fd022835d" class="i field">tracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;invalid contents region&quot;</span>);
                <b>return</b>;
            }
 
            <b>int</b> <span id="r238 rd" class="r238 r">bufferLimit</span> = 2 * 1024; <span class="c">// Limit is 8K bytes as each CHAR_INFO takes 4 bytes</span>
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r239 rd" class="r239 r">bufferCoord</span>;
 
            <span class="r239 r">bufferCoord</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = 0;
            <span class="r239 r">bufferCoord</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
 
            <span class="c">// keeps track of which screen area read</span>
            <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r240 rd" class="r240 r">readRegion</span>;
 
            <span class="r240 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> = (<b>short</b>)<span class="r233 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>;
 
            <b>int</b> <span id="r241 rd" class="r241 r">rowsRemaining</span> = <span class="r236 r">rows</span>;
 
            <b>while</b> (<span class="r241 r">rowsRemaining</span> &gt; 0)
            {
                <span class="c">// Iteration of columns is nested inside iteration of rows.</span>
                <span class="c">// If the size of contents exceeds the buffer limit, reading is</span>
                <span class="c">// done in blocks of size equal to the bufferlimit from left to right</span>
                <span class="c">// then top to bottom.</span>
                <span class="c">// For each iteration of rows,</span>
                <span class="c">// - readRegion.Left and bufferSize.X are reset</span>
                <span class="c">// - rowsRemaining, readRegion.Top, readRegion.Bottom, and bufferSize.Y</span>
                <span class="c">//     are updated</span>
                <span class="c">//   For each iteration of columns,</span>
                <span class="c">//   - readRegion.Left, readRegion.Right and bufferSize.X are updated</span>
 
                <span class="r240 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> = (<b>short</b>)<span class="r233 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>;
 
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r242 rd" class="r242 r">bufferSize</span>;
                <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r237 r">cols</span>, <span class="r238 r">bufferLimit</span>);
                <span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>
                                        (
                                            <span class="r241 r">rowsRemaining</span>,
                                            <span class="r238 r">bufferLimit</span> / <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>
                                        );
                <span class="r240 r">readRegion</span>.<a href="#2a466af33d30108e" class="i field">Bottom</a> = (<b>short</b>)(<span class="r240 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> + <span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> - 1);
 
                <span class="c">// atContentsRow is at which row of contents a particular iteration is operating</span>
                <b>int</b> <span id="r243 rd" class="r243 r">atContentsRow</span> = <span class="r236 r">rows</span> - <span class="r241 r">rowsRemaining</span> + <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a>;
 
                <span class="c">// number of columns yet to be read</span>
                <b>int</b> <span id="r244 rd" class="r244 r">colsRemaining</span> = <span class="r237 r">cols</span>;
 
                <b>while</b> (<span class="r244 r">colsRemaining</span> &gt; 0)
                {
                    <span class="r240 r">readRegion</span>.<a href="#0016188fa9c34162" class="i field">Right</a> = (<b>short</b>)(<span class="r240 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> + <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> - 1);
 
                    <span class="c">// Now readRegion and bufferSize are updated.</span>
                    <span class="c">// Call NativeMethods.ReadConsoleOutput</span>
                    <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[] <span id="r245 rd" class="r245 r">characterBuffer</span> = <b>new</b> <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[<span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> * <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>];
                    <b>bool</b> <span id="r246 rd" class="r246 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">ReadConsoleOutput</span>(
                                        <span class="r232 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                                        <span class="r245 r">characterBuffer</span>,
                                        <span class="r242 r">bufferSize</span>,
                                        <span class="r239 r">bufferCoord</span>,
                                        <b>ref</b> <span class="r240 r">readRegion</span>);
 
                    <b>if</b> (!<span class="r246 r">result</span>)
                    {
                        <span class="c">// When WriteConsoleOutput fails, half bufferLimit</span>
                        <b>if</b> (<span class="r238 r">bufferLimit</span> &lt; 2)
                        {
                            <b>int</b> <span id="r247 rd" class="r247 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                            <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r248 rd" class="r248 r">e</span> = <span class="i">CreateHostException</span>(<span class="r247 r">err</span>, <span class="s">&quot;ReadConsoleOutput&quot;</span>,
                                <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cad1e0e3e13dc1f3" class="i field">ReadError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">ReadConsoleOutputExceptionTemplate</span>);
                            <b>throw</b> <span class="r248 r">e</span>;
                        }
                        <span class="c">// if cols == colsRemaining, nothing is guaranteed read in this pass and</span>
                        <span class="c">//  the unread area is still rectangular</span>
                        <span class="r238 r">bufferLimit</span> /= 2;
                        <b>if</b> (<span class="r237 r">cols</span> == <span class="r244 r">colsRemaining</span>)
                        {
                            <span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = 0;
                            <b>break</b>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// some areas have been read. This could only happen when the number of columns</span>
                            <span class="c">// to write is larger than bufferLimit. In that case, the algorithm reads one row</span>
                            <span class="c">// at a time =&gt; bufferSize.Y == 1. Then, we can safely leave bufferSize.Y unchanged</span>
                            <span class="c">// to retry with a smaller bufferSize.X.</span>
                            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> == 1, <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;bufferSize.Y should be 1, but is {0}&quot;</span>, <span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>));
                            <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r244 r">colsRemaining</span>, <span class="r238 r">bufferLimit</span>);
                            <b>continue</b>;
                        }
                    }
 
                    <span class="c">// atContentsCol is at which column of contents a particular iteration is operating</span>
                    <b>int</b> <span id="r249 rd" class="r249 r">atContentsCol</span> = <span class="r237 r">cols</span> - <span class="r244 r">colsRemaining</span> + <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a>;
 
                    <span class="c">// copy characterBuffer to contents;</span>
                    <b>int</b> <span id="r250 rd" class="r250 r">characterBufferIndex</span> = 0;
                    <b>for</b> (<b>int</b> <span id="r251 rd" class="r251 r">r</span> = <span class="r243 r">atContentsRow</span>; <span class="r251 r">r</span> &lt; <span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> + <span class="r243 r">atContentsRow</span>; <span class="r251 r">r</span>++)
                    {
                        <b>for</b> (<b>int</b> <span id="r252 rd" class="r252 r">c</span> = <span class="r249 r">atContentsCol</span>; <span class="r252 r">c</span> &lt; <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> + <span class="r249 r">atContentsCol</span>; <span class="r252 r">c</span>++, <span class="r250 r">characterBufferIndex</span>++)
                        {
                            <span class="r235 r">contents</span>[<span class="r251 r">r</span>, <span class="r252 r">c</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> = (<b>char</b>)<span class="r245 r">characterBuffer</span>[<span class="r250 r">characterBufferIndex</span>].<a href="#99811542029cf255" class="i field">UnicodeChar</a>;
                            <span class="i">ConsoleColor</span> <span id="r253 rd" class="r253 r">fgColor</span>, <span id="r254 rd" class="r254 r">bgColor</span>;
                            <a href="#a92de6f8349ea0f7" class="i method">WORDToColor</a>(<span class="r245 r">characterBuffer</span>[<span class="r250 r">characterBufferIndex</span>].<a href="#740512f5552ef4e2" class="i field">Attributes</a>,
                                <b>out</b> <span class="r253 r">fgColor</span>,
                                <b>out</b> <span class="r254 r">bgColor</span>);
                            <span class="r235 r">contents</span>[<span class="r251 r">r</span>, <span class="r252 r">c</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a> = <span class="r253 r">fgColor</span>;
                            <span class="r235 r">contents</span>[<span class="r251 r">r</span>, <span class="r252 r">c</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a> = <span class="r254 r">bgColor</span>;
                        }
                    }
 
                    <span class="r244 r">colsRemaining</span> -= <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <span class="r240 r">readRegion</span>.<a href="#66ce7deb70bef9f3" class="i field">Left</a> += <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a>;
                    <span class="r242 r">bufferSize</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="i">Math</span>.<span class="i">Min</span>(<span class="r244 r">colsRemaining</span>, <span class="r238 r">bufferLimit</span>);
                }  <span class="c">// column iteration</span>
 
                <span class="r241 r">rowsRemaining</span> -= <span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
                <span class="r240 r">readRegion</span>.<a href="#40d524bbcb015b61" class="i field">Top</a> += <span class="r242 r">bufferSize</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>;
            }  <span class="c">// row iteration</span>
 
            <span class="c">// The following nested loop set the value of the empty cells in contents:</span>
            <span class="c">// character to &#39; &#39;</span>
            <span class="c">// foreground color to console&#39;s foreground color</span>
            <span class="c">// background color to console&#39;s background color</span>
            <b>int</b> <span id="r255 rd" class="r255 r">rowIndex</span> = <span class="r235 r">contents</span>.<span class="i">GetLowerBound</span>(0);
            <b>int</b> <span id="r256 rd" class="r256 r">rowEnd</span> = <span class="r235 r">contents</span>.<span class="i">GetUpperBound</span>(0);
            <b>int</b> <span id="r257 rd" class="r257 r">colBegin</span> = <span class="r235 r">contents</span>.<span class="i">GetLowerBound</span>(1);
            <b>int</b> <span id="r258 rd" class="r258 r">colEnd</span> = <span class="r235 r">contents</span>.<span class="i">GetUpperBound</span>(1);
            <a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <span id="r259 rd" class="r259 r">bufferInfo</span> =
                        <a href="#a992b7826acc25f2" class="i method">GetConsoleScreenBufferInfo</a>(<span class="r232 r">consoleHandle</span>);
            <span class="i">ConsoleColor</span> <span id="r260 rd" class="r260 r">foreground</span> = 0;
            <span class="i">ConsoleColor</span> <span id="r261 rd" class="r261 r">background</span> = 0;
 
            <a href="#a92de6f8349ea0f7" class="i method">WORDToColor</a>(
                            <span class="r259 r">bufferInfo</span>.<a href="#0d610058fdf6684a" class="i field">Attributes</a>,
                            <b>out</b> <span class="r260 r">foreground</span>,
                            <b>out</b> <span class="r261 r">background</span>
                       );
 
            <b>while</b> (<span class="r255 r">rowIndex</span> &lt;= <span class="r256 r">rowEnd</span>)
            {
                <b>int</b> <span id="r262 rd" class="r262 r">colIndex</span> = <span class="r257 r">colBegin</span>;
                <b>while</b> (<b>true</b>)
                {
                    <span class="c">// if contents[rowIndex,colIndex] is in contentsRegion, hence a non-empty cell,</span>
                    <span class="c">// move colIndex to one past the right end of contentsRegion</span>
                    <b>if</b> (<span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#b735ee5b0a172601" class="i property">Top</a> &lt;= <span class="r255 r">rowIndex</span> &amp;&amp; <span class="r255 r">rowIndex</span> &lt;= <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#ac779af5ccbcb1f6" class="i property">Bottom</a> &amp;&amp;
                        <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#f9f9b1a5f1ea8921" class="i property">Left</a> &lt;= <span class="r262 r">colIndex</span> &amp;&amp; <span class="r262 r">colIndex</span> &lt;= <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a>)
                    {
                        <span class="r262 r">colIndex</span> = <span class="r234 r">contentsRegion</span>.<a href="/System.Management.Automation/A.html#3b92808be89977f9" class="i property">Right</a> + 1;
                    }
                    <span class="c">// colIndex past contents last column</span>
                    <b>if</b> (<span class="r262 r">colIndex</span> &gt; <span class="r258 r">colEnd</span>)
                    {
                        <b>break</b>;
                    }
 
                    <span class="r235 r">contents</span>[<span class="r255 r">rowIndex</span>, <span class="r262 r">colIndex</span>].<a href="/System.Management.Automation/A.html#b94f4479d2cd5557" class="i property">Character</a> = <span class="s">&#39; &#39;</span>;
                    <span class="r235 r">contents</span>[<span class="r255 r">rowIndex</span>, <span class="r262 r">colIndex</span>].<a href="/System.Management.Automation/A.html#35e126b8f7133d81" class="i property">ForegroundColor</a> = <span class="r260 r">foreground</span>;
                    <span class="r235 r">contents</span>[<span class="r255 r">rowIndex</span>, <span class="r262 r">colIndex</span>].<a href="/System.Management.Automation/A.html#a2242c14e6ef19a3" class="i property">BackgroundColor</a> = <span class="r261 r">background</span>;
                    <span class="r262 r">colIndex</span>++;
                }
 
                <span class="r255 r">rowIndex</span>++;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 FillConsoleOutputCharacter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r263 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where output is filled</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r264 r">character</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> character to fill the console output</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r265 r">numberToWrite</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> number of times to write character</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r266 r">origin</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> location on screen buffer where writing starts</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s FillConsoleOutputCharacter fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="a6a910c01b3d8537" href="../../R/a6a910c01b3d8537.html" target="n" data-glyph="74,1" class="i method">FillConsoleOutputCharacter</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r263 rd" class="r263 r">consoleHandle</span>,
            <b>char</b> <span id="r264 rd" class="r264 r">character</span>,
            <b>int</b> <span id="r265 rd" class="r265 r">numberToWrite</span>,
            <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r266 rd" class="r266 r">origin</span>
        )
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r263 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r263 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r267 rd" class="r267 r">c</span>;
 
            <span class="r267 r">c</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="r266 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>;
            <span class="r267 r">c</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)<span class="r266 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>;
 
            <span class="i">DWORD</span> <span id="r268 rd" class="r268 r">unused</span> = 0;
            <b>bool</b> <span id="r269 rd" class="r269 r">result</span> =
                <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">FillConsoleOutputCharacter</span>(
                    <span class="r263 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                    <span class="r264 r">character</span>,
                    (<span class="i">DWORD</span>)<span class="r265 r">numberToWrite</span>,
                    <span class="r267 r">c</span>,
                    <b>out</b> <span class="r268 r">unused</span>);
            <b>if</b> (!<span class="r269 r">result</span>)
            {
                <b>int</b> <span id="r270 rd" class="r270 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r271 rd" class="r271 r">e</span> = <span class="i">CreateHostException</span>(<span class="r270 r">err</span>, <span class="s">&quot;FillConsoleOutputCharacter&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">FillConsoleOutputCharacterExceptionTemplate</span>);
                <b>throw</b> <span class="r271 r">e</span>;
            }
            <span class="c">// we don&#39;t assert that the number actually written matches the number we asked for, as the function may clip if</span>
            <span class="c">// the number of cells to write extends past the end of the screen buffer.</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 FillConsoleOutputAttribute.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r272 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where output is filled</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r273 r">attribute</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> attribute to fill the console output</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r274 r">numberToWrite</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> number of times to write attribute</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r275 r">origin</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> location on screen buffer where writing starts</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s FillConsoleOutputAttribute fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="dd39a6c393a8924a" href="../../R/dd39a6c393a8924a.html" target="n" data-glyph="74,1" class="i method">FillConsoleOutputAttribute</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r272 rd" class="r272 r">consoleHandle</span>,
            <span class="i">WORD</span> <span id="r273 rd" class="r273 r">attribute</span>,
            <b>int</b> <span id="r274 rd" class="r274 r">numberToWrite</span>,
            <a href="/System.Management.Automation/A.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r275 rd" class="r275 r">origin</span>
        )
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r272 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r272 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r276 rd" class="r276 r">c</span>;
 
            <span class="r276 r">c</span>.<a href="#0742affafd7a86ed" class="i field">X</a> = (<b>short</b>)<span class="r275 r">origin</span>.<a href="/System.Management.Automation/A.html#62aff8c33e5f09b9" class="i property">X</a>;
            <span class="r276 r">c</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> = (<b>short</b>)<span class="r275 r">origin</span>.<a href="/System.Management.Automation/A.html#168280a926d1b9da" class="i property">Y</a>;
 
            <span class="i">DWORD</span> <span id="r277 rd" class="r277 r">unused</span> = 0;
            <b>bool</b> <span id="r278 rd" class="r278 r">result</span> =
                <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">FillConsoleOutputAttribute</span>(
                    <span class="r272 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                    <span class="r273 r">attribute</span>,
                    (<span class="i">DWORD</span>)<span class="r274 r">numberToWrite</span>,
                    <span class="r276 r">c</span>,
                    <b>out</b> <span class="r277 r">unused</span>);
 
            <b>if</b> (!<span class="r278 r">result</span>)
            {
                <b>int</b> <span id="r279 rd" class="r279 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r280 rd" class="r280 r">e</span> = <span class="i">CreateHostException</span>(<span class="r279 r">err</span>, <span class="s">&quot;FillConsoleOutputAttribute&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">FillConsoleOutputAttributeExceptionTemplate</span>);
                <b>throw</b> <span class="r280 r">e</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wrap Win32 ScrollConsoleScreenBuffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r281 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where screen buffer is scrolled</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r282 r">scrollRectangle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> area to be scrolled</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r283 r">clipRectangle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> area to be updated after scrolling</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r284 r">destOrigin</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> location to which the top left corner of scrollRectangle move</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r285 r">fill</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> character and attribute to fill the area vacated by the scroll</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s ScrollConsoleScreenBuffer fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="a27674f6e46b93e0" href="../../R/a27674f6e46b93e0.html" target="n" data-glyph="74,1" class="i method">ScrollConsoleScreenBuffer</a>
        (
            <span class="i">ConsoleHandle</span> <span id="r281 rd" class="r281 r">consoleHandle</span>,
            <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r282 rd" class="r282 r">scrollRectangle</span>,
            <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r283 rd" class="r283 r">clipRectangle</span>,
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r284 rd" class="r284 r">destOrigin</span>, <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a> <span id="r285 rd" class="r285 r">fill</span>
        )
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r281 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r281 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <b>bool</b> <span id="r286 rd" class="r286 r">result</span> =
                <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">ScrollConsoleScreenBuffer</span>(
                    <span class="r281 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                    <b>ref</b> <span class="r282 r">scrollRectangle</span>,
                    <b>ref</b> <span class="r283 r">clipRectangle</span>,
                    <span class="r284 r">destOrigin</span>,
                    <b>ref</b> <span class="r285 r">fill</span>);
 
            <b>if</b> (!<span class="r286 r">result</span>)
            {
                <b>int</b> <span id="r287 rd" class="r287 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r288 rd" class="r288 r">e</span> = <span class="i">CreateHostException</span>(<span class="r287 r">err</span>, <span class="s">&quot;ScrollConsoleScreenBuffer&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">ScrollConsoleScreenBufferExceptionTemplate</span>);
                <b>throw</b> <span class="r288 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Buffer
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Window
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 SetConsoleWindowInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r289 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where window info is set</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r290 r">absolute</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this parameter is TRUE, the coordinates specify the new upper-left and</span>
        <span class="c">///</span><span class="c"> lower-right corners of the window. If it is false, the coordinates are offsets</span>
        <span class="c">///</span><span class="c"> to the current window-corner coordinates</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r291 r">windowInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> specify the size and position of the console screen buffer&#39;s window</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s SetConsoleWindowInfo fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="6c949b0bf64ed813" href="../../R/6c949b0bf64ed813.html" target="n" data-glyph="74,1" class="i method">SetConsoleWindowInfo</a>(<span class="i">ConsoleHandle</span> <span id="r289 rd" class="r289 r">consoleHandle</span>, <b>bool</b> <span id="r290 rd" class="r290 r">absolute</span>, <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r291 rd" class="r291 r">windowInfo</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r289 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r289 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <b>bool</b> <span id="r292 rd" class="r292 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">SetConsoleWindowInfo</span>(<span class="r289 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <span class="r290 r">absolute</span>, <b>ref</b> <span class="r291 r">windowInfo</span>);
 
            <b>if</b> (!<span class="r292 r">result</span>)
            {
                <b>int</b> <span id="r293 rd" class="r293 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r294 rd" class="r294 r">e</span> = <span class="i">CreateHostException</span>(<span class="r293 r">err</span>, <span class="s">&quot;SetConsoleWindowInfo&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">SetConsoleWindowInfoExceptionTemplate</span>);
                <b>throw</b> <span class="r294 r">e</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 GetLargestConsoleWindowSize.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r295 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console for which the largest window size is obtained</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> the largest window size</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s GetLargestConsoleWindowSize fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="/System.Management.Automation/A.html#4d1d20b1c8ac2812" class="t t">Size</a> <a id="618df1b8c7afb6fc" href="../../R/618df1b8c7afb6fc.html" target="n" data-glyph="74,1" class="i method">GetLargestConsoleWindowSize</a>(<span class="i">ConsoleHandle</span> <span id="r295 rd" class="r295 r">consoleHandle</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r295 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r295 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r296 rd" class="r296 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">GetLargestConsoleWindowSize</span>(<span class="r295 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>());
 
            <b>if</b> ((<span class="r296 r">result</span>.<a href="#0742affafd7a86ed" class="i field">X</a> == 0) &amp;&amp; (<span class="r296 r">result</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a> == 0))
            {
                <b>int</b> <span id="r297 rd" class="r297 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r298 rd" class="r298 r">e</span> = <span class="i">CreateHostException</span>(<span class="r297 r">err</span>, <span class="s">&quot;GetLargestConsoleWindowSize&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">GetLargestConsoleWindowSizeExceptionTemplate</span>);
                <b>throw</b> <span class="r298 r">e</span>;
            }
 
            <b>return</b> <b>new</b> <span class="t">Size</span>(<span class="r296 r">result</span>.<a href="#0742affafd7a86ed" class="i field">X</a>, <span class="r296 r">result</span>.<a href="#3fd8b6ba4892d18e" class="i field">Y</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 GetConsoleTitle. 1K is the safe limit experimentally. The 64K limit</span>
        <span class="c">///</span><span class="c"> found in the docs is disregarded because it is essentially meaningless.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> a string for the title of the window</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s GetConsoleTitle fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="a9a0c130d8d40cc4" href="../../R/a9a0c130d8d40cc4.html" target="n" data-glyph="74,1" class="i method">GetConsoleWindowTitle</a>()
        {
            <b>const int</b> <span id="r299 rd" class="r299 r">MaxWindowTitleLength</span> = 1024;
            <b>const</b> <span class="i">DWORD</span> <span id="r300 rd" class="r300 r">bufferSize</span> = <span class="r299 r">MaxWindowTitleLength</span>;
            <span class="i">DWORD</span> <span id="r301 rd" class="r301 r">result</span>;
            <span class="i">StringBuilder</span> <span id="r302 rd" class="r302 r">consoleTitle</span> = <b>new</b> <span class="i">StringBuilder</span>((<b>int</b>)<span class="r300 r">bufferSize</span>);
 
            <span class="c">// Suppress the PreFAST warning about not using Marshal.GetLastWin32Error() to</span>
            <span class="c">// get the error code.</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56523
            <span class="r301 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#5320486e7cf0e653" class="i method">GetConsoleTitle</a>(<span class="r302 r">consoleTitle</span>, <span class="r300 r">bufferSize</span>);
            <span class="c">// If the result is zero, it may mean and error but it may also mean</span>
            <span class="c">// that the window title has been set to null. Since we can&#39;t tell the</span>
            <span class="c">// the difference, we&#39;ll just return the empty string every time.</span>
            <b>if</b> (<span class="r301 r">result</span> == 0)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <b>return</b> <span class="r302 r">consoleTitle</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 SetConsoleTitle.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r303 r">consoleTitle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> a string for the title of the window</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s SetConsoleTitle fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="24eecbbf011d99cc" href="../../R/24eecbbf011d99cc.html" target="n" data-glyph="74,1" class="i method">SetConsoleWindowTitle</a>(<b>string</b> <span id="r303 rd" class="r303 r">consoleTitle</span>)
        {
            <b>bool</b> <span id="r304 rd" class="r304 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#61c85d3405489118" class="i method">SetConsoleTitle</a>(<span class="r303 r">consoleTitle</span>);
 
            <b>if</b> (!<span class="r304 r">result</span>)
            {
                <b>int</b> <span id="r305 rd" class="r305 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r306 rd" class="r306 r">e</span> = <span class="i">CreateHostException</span>(<span class="r305 r">err</span>, <span class="s">&quot;SetConsoleWindowTitle&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">SetConsoleWindowTitleExceptionTemplate</span>);
                <b>throw</b> <span class="r306 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Window
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wrap Win32 WriteConsole.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r307 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handle for the console where the string is written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r308 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> String that is written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r309 r">newLine</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New line is written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the Win32&#39;s WriteConsole fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="565a10751a537803" href="../../R/565a10751a537803.html" target="n" data-glyph="74,1" class="i method">WriteConsole</a>(<span class="i">ConsoleHandle</span> <span id="r307 rd" class="r307 r">consoleHandle</span>, <span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r308 rd" class="r308 r">output</span>, <b>bool</b> <span id="r309 rd" class="r309 r">newLine</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r307 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r307 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <b>if</b> (<span class="r308 r">output</span>.<span class="i">Length</span> == 0)
            {
                <b>if</b> (<span class="r309 r">newLine</span>)
                {
                    <span class="i">WriteConsole</span>(<span class="r307 r">consoleHandle</span>, <span class="i">Environment</span>.<span class="i">NewLine</span>);
                }
 
                <b>return</b>;
            }
 
            <span class="c">// Native WriteConsole doesn&#39;t support output buffer longer than 64K.</span>
            <span class="c">// We need to chop the output string if it is too long.</span>
            <b>int</b> <span id="r310 rd" class="r310 r">cursor</span> = 0; <span class="c">// This records the chopping position in output string</span>
            <b>const int</b> <span id="r311 rd" class="r311 r">MaxBufferSize</span> = 16383; <span class="c">// this is 64K/4 - 1 to account for possible width of each character.</span>
 
            <b>while</b> (<span class="r310 r">cursor</span> &lt; <span class="r308 r">output</span>.<span class="i">Length</span>)
            {
                <span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r312 rd" class="r312 r">outBuffer</span>;
 
                <b>if</b> (<span class="r310 r">cursor</span> + <span class="r311 r">MaxBufferSize</span> &lt; <span class="r308 r">output</span>.<span class="i">Length</span>)
                {
                    <span class="r312 r">outBuffer</span> = <span class="r308 r">output</span>.<span class="i">Slice</span>(<span class="r310 r">cursor</span>, <span class="r311 r">MaxBufferSize</span>);
                    <span class="r310 r">cursor</span> += <span class="r311 r">MaxBufferSize</span>;
 
                    <a href="#551be51fb2bd09c9" class="i method">WriteConsole</a>(<span class="r307 r">consoleHandle</span>, <span class="r312 r">outBuffer</span>);
                }
                <b>else</b>
                {
                    <span class="r312 r">outBuffer</span> = <span class="r308 r">output</span>.<span class="i">Slice</span>(<span class="r310 r">cursor</span>);
                    <span class="r310 r">cursor</span> = <span class="r308 r">output</span>.<span class="i">Length</span>;
 
                    <b>if</b> (<span class="r309 r">newLine</span>)
                    {
                        <b>var</b> <span id="r313 rd" class="r313 r">endOfLine</span> = <span class="i">Environment</span>.<span class="i">NewLine</span>.<span class="i">AsSpan</span>();
                        <b>var</b> <span id="r314 rd" class="r314 r">endOfLineLength</span> = <span class="r313 r">endOfLine</span>.<span class="i">Length</span>;
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CA2014</span>
                        <span class="i">Span</span>&lt;<b>char</b>&gt; <span id="r315 rd" class="r315 r">outBufferLine</span> = <b>stackalloc char</b>[<span class="r312 r">outBuffer</span>.<span class="i">Length</span> + <span class="r314 r">endOfLineLength</span>];
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">CA2014</span>
                        <span class="r312 r">outBuffer</span>.<span class="i">CopyTo</span>(<span class="r315 r">outBufferLine</span>);
                        <span class="r313 r">endOfLine</span>.<span class="i">CopyTo</span>(<span class="r315 r">outBufferLine</span>.<span class="i">Slice</span>(<span class="r315 r">outBufferLine</span>.<span class="i">Length</span> - <span class="r314 r">endOfLineLength</span>));
                        <span class="i">WriteConsole</span>(<span class="r307 r">consoleHandle</span>, <span class="r315 r">outBufferLine</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#551be51fb2bd09c9" class="i method">WriteConsole</a>(<span class="r307 r">consoleHandle</span>, <span class="r312 r">outBuffer</span>);
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="551be51fb2bd09c9" href="../../R/551be51fb2bd09c9.html" target="n" data-glyph="76,1" class="i method">WriteConsole</a>(<span class="i">ConsoleHandle</span> <span id="r316 rd" class="r316 r">consoleHandle</span>, <span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r317 rd" class="r317 r">buffer</span>)
        {
            <span class="i">DWORD</span> <span id="r318 rd" class="r318 r">charsWritten</span>;
            <b>bool</b> <span id="r319 rd" class="r319 r">result</span> =
                <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">WriteConsole</span>(
                    <span class="r316 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(),
                    <span class="r317 r">buffer</span>,
                    (<span class="i">DWORD</span>)<span class="r317 r">buffer</span>.<span class="i">Length</span>,
                    <b>out</b> <span class="r318 r">charsWritten</span>,
                    <span class="i">IntPtr</span>.<span class="i">Zero</span>);
 
            <b>if</b> (!<span class="r319 r">result</span>)
            {
                <b>int</b> <span id="r320 rd" class="r320 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r321 rd" class="r321 r">e</span> = <span class="i">CreateHostException</span>(
                    <span class="r320 r">err</span>,
                    <span class="s">&quot;WriteConsole&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>,
                    <span class="i">ConsoleControlStrings</span>.<span class="i">WriteConsoleExceptionTemplate</span>);
                <b>throw</b> <span class="r321 r">e</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 SetConsoleTextAttribute.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r322 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where text attribute is set</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r323 r">attribute</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> text attribute to set the console</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if the Win32&#39;s SetConsoleTextAttribute fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="4aae2bd633440bef" href="../../R/4aae2bd633440bef.html" target="n" data-glyph="74,1" class="i method">SetConsoleTextAttribute</a>(<span class="i">ConsoleHandle</span> <span id="r322 rd" class="r322 r">consoleHandle</span>, <span class="i">WORD</span> <span id="r323 rd" class="r323 r">attribute</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r322 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r322 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <b>bool</b> <span id="r324 rd" class="r324 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">SetConsoleTextAttribute</span>(<span class="r322 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <span class="r323 r">attribute</span>);
 
            <b>if</b> (!<span class="r324 r">result</span>)
            {
                <b>int</b> <span id="r325 rd" class="r325 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r326 rd" class="r326 r">e</span> = <span class="i">CreateHostException</span>(<span class="r325 r">err</span>, <span class="s">&quot;SetConsoleTextAttribute&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">SetConsoleTextAttributeExceptionTemplate</span>);
                <b>throw</b> <span class="r326 r">e</span>;
            }
        }
 
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Dealing with CJK
 
        <span class="c">// Return the length of a VT100 control sequence character in str starting</span>
        <span class="c">// at the given offset.</span>
        <span class="c">//</span>
        <span class="c">// This code only handles the following formatting sequences, corresponding to</span>
        <span class="c">// the patterns:</span>
        <span class="c">//     CSI params? &#39;m&#39;               // SGR: Select Graphics Rendition</span>
        <span class="c">//     CSI params? &#39;#&#39; [{}pq]        // XTPUSHSGR (&#39;{&#39;), XTPOPSGR (&#39;}&#39;), or their aliases (&#39;p&#39; and &#39;q&#39;)</span>
        <span class="c">//</span>
        <span class="c">// Where:</span>
        <span class="c">//     params: digit+ ((&#39;;&#39; | &#39;:&#39;) params)?</span>
        <span class="c">//     CSI:     C0_CSI | C1_CSI</span>
        <span class="c">//     C0_CSI:  \x001b &#39;[&#39;            // ESC &#39;[&#39;</span>
        <span class="c">//     C1_CSI:  \x009b</span>
        <span class="c">//</span>
        <span class="c">// There are many other VT100 escape sequences, but these text attribute sequences</span>
        <span class="c">// (color-related, underline, etc.) are sufficient for our formatting system.  We</span>
        <span class="c">// won&#39;t handle cursor movements or other attempts at animation.</span>
        <span class="c">//</span>
        <span class="c">// Note that offset is adjusted past the escape sequence, or at least one</span>
        <span class="c">// character forward if there is no escape sequence at the specified position.</span>
        <b>internal static int</b> <a id="84177468d5e7b1a7" href="../../R/84177468d5e7b1a7.html" target="n" data-glyph="74,1" class="i method">ControlSequenceLength</a>(<b>string</b> <span id="r327 rd" class="r327 r">str</span>, <b>ref int</b> <span id="r328 rd" class="r328 r">offset</span>)
        {
            <b>var</b> <span id="r329 rd" class="r329 r">start</span> = <span class="r328 r">offset</span>;
 
            <span class="c">// First, check for the CSI:</span>
            <b>if</b> ((<span class="r327 r">str</span>[<span class="r328 r">offset</span>] == (<b>char</b>)0x1b) &amp;&amp; (<span class="r327 r">str</span>.<span class="i">Length</span> &gt; (<span class="r328 r">offset</span> + 1)) &amp;&amp; (<span class="r327 r">str</span>[<span class="r328 r">offset</span> + 1] == <span class="s">&#39;[&#39;</span>))
            {
                <span class="c">// C0 CSI</span>
                <span class="r328 r">offset</span> += 2;
            }
            <b>else</b> <b>if</b> (<span class="r327 r">str</span>[<span class="r328 r">offset</span>] == (<b>char</b>)0x9b)
            {
                <span class="c">// C1 CSI</span>
                <span class="r328 r">offset</span> += 1;
            }
            <b>else</b>
            {
                <span class="c">// No CSI at the current location, so we are done looking, but we still</span>
                <span class="c">// need to advance offset.</span>
                <span class="r328 r">offset</span> += 1;
                <b>return</b> 0;
            }
 
            <b>if</b> (<span class="r328 r">offset</span> &gt;= <span class="r327 r">str</span>.<span class="i">Length</span>)
            {
                <b>return</b> 0;
            }
 
            <span class="c">// Next, handle possible numeric arguments:</span>
            <b>char</b> <span id="r330 rd" class="r330 r">c</span>;
            <b>do</b>
            {
                <span class="r330 r">c</span> = <span class="r327 r">str</span>[<span class="r328 r">offset</span>++];
            }
            <b>while</b> ((<span class="r328 r">offset</span> &lt; <span class="r327 r">str</span>.<span class="i">Length</span>) &amp;&amp; (<b>char</b>.<span class="i">IsDigit</span>(<span class="r330 r">c</span>) || (<span class="r330 r">c</span> == <span class="s">&#39;;&#39;</span>) || (<span class="r330 r">c</span> == <span class="s">&#39;:&#39;</span>)));
 
            <span class="c">// Finally, handle the command characters for the specific sequences we</span>
            <span class="c">// handle:</span>
            <b>if</b> (<span class="r330 r">c</span> == <span class="s">&#39;m&#39;</span>)
            {
                <span class="c">// SGR: Select Graphics Rendition</span>
                <b>return</b> <span class="r328 r">offset</span> - <span class="r329 r">start</span>;
            }
 
            <span class="c">// Maybe XTPUSHSGR or XTPOPSGR, but we need to read another char. Offset is</span>
            <span class="c">// already positioned on the next char (or past the end).</span>
            <b>if</b> (<span class="r328 r">offset</span> &gt;= <span class="r327 r">str</span>.<span class="i">Length</span>)
            {
                <b>return</b> 0;
            }
 
            <b>if</b> (<span class="r330 r">c</span> == <span class="s">&#39;#&#39;</span>)
            {
                <span class="c">// &#39;{&#39; : XTPUSHSGR</span>
                <span class="c">// &#39;}&#39; : XTPOPSGR</span>
                <span class="c">// &#39;p&#39; : alias for XTPUSHSGR</span>
                <span class="c">// &#39;q&#39; : alias for XTPOPSGR</span>
                <span class="r330 r">c</span> = <span class="r327 r">str</span>[<span class="r328 r">offset</span>++];
                <b>if</b> ((<span class="r330 r">c</span> == <span class="s">&#39;{&#39;</span>) ||
                    (<span class="r330 r">c</span> == <span class="s">&#39;}&#39;</span>) ||
                    (<span class="r330 r">c</span> == <span class="s">&#39;p&#39;</span>) ||
                    (<span class="r330 r">c</span> == <span class="s">&#39;q&#39;</span>))
                {
                    <b>return</b> <span class="r328 r">offset</span> - <span class="r329 r">start</span>;
                }
            }
 
            <b>return</b> 0;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> From IsConsoleFullWidth in \windows\core\ntcon\server\dbcs.c.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA1806:DoNotIgnoreMethodResults&quot;</span>,
            <span class="i">MessageId</span> = <span class="s">&quot;Microsoft.PowerShell.ConsoleControl+NativeMethods.ReleaseDC(System.IntPtr,System.IntPtr)&quot;</span>)]
        <b>internal static int</b> <a id="b78d80746511c2bb" href="../../R/b78d80746511c2bb.html" target="n" data-glyph="74,1" class="i method">LengthInBufferCells</a>(<b>string</b> <span id="r331 rd" class="r331 r">str</span>, <b>int</b> <span id="r332 rd" class="r332 r">offset</span>, <b>bool</b> <span id="r333 rd" class="r333 r">checkEscapeSequences</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r332 r">offset</span> &gt;= 0, <span class="s">&quot;offset &gt;= 0&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r331 r">str</span>) || (<span class="r332 r">offset</span> &lt; <span class="r331 r">str</span>.<span class="i">Length</span>), <span class="s">&quot;offset &lt; str.Length&quot;</span>);
 
            <b>var</b> <span id="r334 rd" class="r334 r">escapeSequenceAdjustment</span> = 0;
            <b>if</b> (<span class="r333 r">checkEscapeSequences</span>)
            {
                <b>int</b> <span id="r335 rd" class="r335 r">i</span> = 0;
                <b>while</b> (<span class="r335 r">i</span> &lt; <span class="r332 r">offset</span>)
                {
                    <a href="#84177468d5e7b1a7" class="i method">ControlSequenceLength</a>(<span class="r331 r">str</span>, <b>ref</b> <span class="r335 r">i</span>);
                }
 
                <span class="c">// If offset != i, we&#39;re in the middle of a sequence, which the caller should avoid,</span>
                <span class="c">// but we&#39;ll tolerate.</span>
                <b>while</b> (<span class="r335 r">i</span> &lt; <span class="r331 r">str</span>.<span class="i">Length</span>)
                {
                    <span class="r334 r">escapeSequenceAdjustment</span> += <a href="#84177468d5e7b1a7" class="i method">ControlSequenceLength</a>(<span class="r331 r">str</span>, <b>ref</b> <span class="r335 r">i</span>);
                }
            }
 
            <b>int</b> <span id="r336 rd" class="r336 r">length</span> = 0;
            <b>foreach</b> (<b>char</b> <span id="r337 rd" class="r337 r">c</span> <b>in</b> <span class="r331 r">str</span>)
            {
                <span class="r336 r">length</span> += <a href="#e26e981e21022d34" class="i method">LengthInBufferCells</a>(<span class="r337 r">c</span>);
            }
 
            <b>return</b> <span class="r336 r">length</span> - <span class="r332 r">offset</span> - <span class="r334 r">escapeSequenceAdjustment</span>;
        }
 
        <b>internal static int</b> <a id="e26e981e21022d34" href="../../R/e26e981e21022d34.html" target="n" data-glyph="74,1" class="i method">LengthInBufferCells</a>(<b>char</b> <span id="r338 rd" class="r338 r">c</span>)
        {
            <span class="c">// The following is based on http://www.cl.cam.ac.uk/~mgk25/c/wcwidth.c</span>
            <span class="c">// which is derived from https://www.unicode.org/Public/UCD/latest/ucd/EastAsianWidth.txt</span>
            <b>bool</b> <span id="r339 rd" class="r339 r">isWide</span> = <span class="r338 r">c</span> &gt;= 0x1100 &amp;&amp;
                (<span class="r338 r">c</span> &lt;= 0x115f || <span class="c">/* Hangul Jamo init. consonants */</span>
                 <span class="r338 r">c</span> == 0x2329 || <span class="r338 r">c</span> == 0x232a ||
                 ((<b>uint</b>)(<span class="r338 r">c</span> - 0x2e80) &lt;= (0xa4cf - 0x2e80) &amp;&amp;
                  <span class="r338 r">c</span> != 0x303f) || <span class="c">/* CJK ... Yi */</span>
                 ((<b>uint</b>)(<span class="r338 r">c</span> - 0xac00) &lt;= (0xd7a3 - 0xac00)) || <span class="c">/* Hangul Syllables */</span>
                 ((<b>uint</b>)(<span class="r338 r">c</span> - 0xf900) &lt;= (0xfaff - 0xf900)) || <span class="c">/* CJK Compatibility Ideographs */</span>
                 ((<b>uint</b>)(<span class="r338 r">c</span> - 0xfe10) &lt;= (0xfe19 - 0xfe10)) || <span class="c">/* Vertical forms */</span>
                 ((<b>uint</b>)(<span class="r338 r">c</span> - 0xfe30) &lt;= (0xfe6f - 0xfe30)) || <span class="c">/* CJK Compatibility Forms */</span>
                 ((<b>uint</b>)(<span class="r338 r">c</span> - 0xff00) &lt;= (0xff60 - 0xff00)) || <span class="c">/* Fullwidth Forms */</span>
                 ((<b>uint</b>)(<span class="r338 r">c</span> - 0xffe0) &lt;= (0xffe6 - 0xffe0)));
 
            <span class="c">// We can ignore these ranges because .Net strings use surrogate pairs</span>
            <span class="c">// for this range and we do not handle surrogage pairs.</span>
            <span class="c">// (c &gt;= 0x20000 &amp;&amp; c &lt;= 0x2fffd) ||</span>
            <span class="c">// (c &gt;= 0x30000 &amp;&amp; c &lt;= 0x3fffd)</span>
            <b>return</b> 1 + (<span class="r339 r">isWide</span> ? 1 : 0);
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the output buffer code page is Japanese, Simplified Chinese, Korean, or Traditional Chinese.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r340 r">codePage</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="b4d45aadc9c3920c" href="../../R/b4d45aadc9c3920c.html" target="n" data-glyph="74,1" class="i method">IsCJKOutputCodePage</a>(<b>out uint</b> <span id="r340 rd" class="r340 r">codePage</span>)
        {
            <span class="r340 r">codePage</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<a href="#c688549d0897a91d" class="i method">GetConsoleOutputCP</a>();
            <b>return</b> <span class="r340 r">codePage</span> == 932 || <span class="c">// Japanese</span>
                <span class="r340 r">codePage</span> == 936 || <span class="c">// Simplified Chinese</span>
                <span class="r340 r">codePage</span> == 949 || <span class="c">// Korean</span>
                <span class="r340 r">codePage</span> == 950;  <span class="c">// Traditional Chinese</span>
        }
 
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Dealing with CJK
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Cursor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 GetConsoleCursorInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r341 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where cursor info is obtained</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> cursor info</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s GetConsoleCursorInfo fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#207b7680f453770b" class="t t">CONSOLE_CURSOR_INFO</a> <a id="8e9dc1f40894850a" href="../../R/8e9dc1f40894850a.html" target="n" data-glyph="74,1" class="i method">GetConsoleCursorInfo</a>(<span class="i">ConsoleHandle</span> <span id="r341 rd" class="r341 r">consoleHandle</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r341 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r341 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <a href="#207b7680f453770b" class="t t">CONSOLE_CURSOR_INFO</a> <span id="r342 rd" class="r342 r">cursorInfo</span>;
 
            <b>bool</b> <span id="r343 rd" class="r343 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">GetConsoleCursorInfo</span>(<span class="r341 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <b>out</b> <span class="r342 r">cursorInfo</span>);
 
            <b>if</b> (!<span class="r343 r">result</span>)
            {
                <b>int</b> <span id="r344 rd" class="r344 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r345 rd" class="r345 r">e</span> = <span class="i">CreateHostException</span>(<span class="r344 r">err</span>, <span class="s">&quot;GetConsoleCursorInfo&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">GetConsoleCursorInfoExceptionTemplate</span>);
                <b>throw</b> <span class="r345 r">e</span>;
            }
 
            <b>return</b> <span class="r342 r">cursorInfo</span>;
        }
 
        <b>internal static</b> <a href="#a07c3f2be802fbbf" class="t t">CONSOLE_FONT_INFO_EX</a> <a id="7a7977eeab9957f3" href="../../R/7a7977eeab9957f3.html" target="n" data-glyph="74,1" class="i method">GetConsoleFontInfo</a>(<span class="i">ConsoleHandle</span> <span id="r346 rd" class="r346 r">consoleHandle</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r346 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r346 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <a href="#a07c3f2be802fbbf" class="t t">CONSOLE_FONT_INFO_EX</a> <span id="r347 rd" class="r347 r">fontInfo</span> = <b>new</b> <span class="t">CONSOLE_FONT_INFO_EX</span>();
            <span class="r347 r">fontInfo</span>.<a href="#6f17e8828e545aac" class="i field">cbSize</a> = <span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r347 r">fontInfo</span>);
            <b>bool</b> <span id="r348 rd" class="r348 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">GetCurrentConsoleFontEx</span>(<span class="r346 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <b>false</b>, <b>ref</b> <span class="r347 r">fontInfo</span>);
 
            <b>if</b> (!<span class="r348 r">result</span>)
            {
                <b>int</b> <span id="r349 rd" class="r349 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r350 rd" class="r350 r">e</span> = <span class="i">CreateHostException</span>(<span class="r349 r">err</span>, <span class="s">&quot;GetConsoleFontInfo&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">GetConsoleFontInfoExceptionTemplate</span>);
                <b>throw</b> <span class="r350 r">e</span>;
            }
 
            <b>return</b> <span class="r347 r">fontInfo</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wraps Win32 SetConsoleCursorInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r351 r">consoleHandle</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> handle for the console where cursor info is set</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r352 r">cursorInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> cursor info to set the cursor</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If Win32&#39;s SetConsoleCursorInfo fails</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="ff9185707bb9c695" href="../../R/ff9185707bb9c695.html" target="n" data-glyph="74,1" class="i method">SetConsoleCursorInfo</a>(<span class="i">ConsoleHandle</span> <span id="r351 rd" class="r351 r">consoleHandle</span>, <a href="#207b7680f453770b" class="t t">CONSOLE_CURSOR_INFO</a> <span id="r352 rd" class="r352 r">cursorInfo</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r351 r">consoleHandle</span>.<span class="i">IsInvalid</span>, <span class="s">&quot;ConsoleHandle is not valid&quot;</span>);
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r351 r">consoleHandle</span>.<span class="i">IsClosed</span>, <span class="s">&quot;ConsoleHandle is closed&quot;</span>);
 
            <b>bool</b> <span id="r353 rd" class="r353 r">result</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">SetConsoleCursorInfo</span>(<span class="r351 r">consoleHandle</span>.<span class="i">DangerousGetHandle</span>(), <b>ref</b> <span class="r352 r">cursorInfo</span>);
 
            <b>if</b> (!<span class="r353 r">result</span>)
            {
                <b>int</b> <span id="r354 rd" class="r354 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r355 rd" class="r355 r">e</span> = <span class="i">CreateHostException</span>(<span class="r354 r">err</span>, <span class="s">&quot;SetConsoleCursorInfo&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">SetConsoleCursorInfoExceptionTemplate</span>);
                <b>throw</b> <span class="r355 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Cursor
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> helper
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper function to create the proper HostException.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r356 r">win32Error</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r357 r">errorId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r358 r">category</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r359 r">resourceStr</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <a id="7a910d915ae27b15" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateHostException</a>(
            <b>int</b> <span id="r356 rd" class="r356 r">win32Error</span>, <b>string</b> <span id="r357 rd" class="r357 r">errorId</span>, <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a> <span id="r358 rd" class="r358 r">category</span>, <b>string</b> <span id="r359 rd" class="r359 r">resourceStr</span>)
        {
            <span class="i">Win32Exception</span> <span id="r360 rd" class="r360 r">innerException</span> = <b>new</b> <span class="i">Win32Exception</span>(<span class="r356 r">win32Error</span>);
            <b>string</b> <span id="r361 rd" class="r361 r">msg</span> = <span class="i">StringUtil</span>.<span class="i">Format</span>(<span class="r359 r">resourceStr</span>, <span class="r360 r">innerException</span>.<span class="i">Message</span>, <span class="r356 r">win32Error</span>);
            <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r362 rd" class="r362 r">e</span> = <b>new</b> <span class="t">HostException</span>(<span class="r361 r">msg</span>, <span class="r360 r">innerException</span>, <span class="r357 r">errorId</span>, <span class="r358 r">category</span>);
            <b>return</b> <span class="r362 r">e</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> helper
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> SendInput
 
        <b>internal static void</b> <a id="1b0107cd8bcfa099" href="../../R/1b0107cd8bcfa099.html" target="n" data-glyph="74,1" class="i method">MimicKeyPress</a>(<a href="#f9880a1b43685c6d" class="t t">INPUT</a>[] <span id="r363 rd" class="r363 r">inputs</span>)
        {
            <a href="/System.Management.Automation/A.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(<span class="r363 r">inputs</span> != <b>null</b> &amp;&amp; <span class="r363 r">inputs</span>.<span class="i">Length</span> &gt; 0, <span class="s">&quot;inputs should not be null or empty&quot;</span>);
            <b>var</b> <span id="r364 rd" class="r364 r">numberOfSuccessfulEvents</span> = <a href="#4ea030ef9c4281a7" class="t t">NativeMethods</a>.<span class="i">SendInput</span>((<b>uint</b>)<span class="r363 r">inputs</span>.<span class="i">Length</span>, <span class="r363 r">inputs</span>, <span class="i">Marshal</span>.<span class="i">SizeOf</span>&lt;<a href="#f9880a1b43685c6d" class="t t">INPUT</a>&gt;());
 
            <b>if</b> (<span class="r364 r">numberOfSuccessfulEvents</span> == 0)
            {
                <b>int</b> <span id="r365 rd" class="r365 r">err</span> = <span class="i">Marshal</span>.<span class="i">GetLastWin32Error</span>();
 
                <a href="/System.Management.Automation/A.html#4b15a598e99c7dd9" class="t t">HostException</a> <span id="r366 rd" class="r366 r">e</span> = <span class="i">CreateHostException</span>(<span class="r365 r">err</span>, <span class="s">&quot;SendKeyPressInput&quot;</span>,
                    <a href="/System.Management.Automation/A.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="/System.Management.Automation/A.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="i">ConsoleControlStrings</span>.<span class="i">SendKeyPressInputExceptionTemplate</span>);
                <b>throw</b> <span class="r366 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> SendInput
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Class to hold the Native Methods used in this file enclosing class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static class</b> <a id="4ea030ef9c4281a7" href="../../R/4ea030ef9c4281a7.html" target="n" data-glyph="2,1" class="t t">NativeMethods</a>
        {
            <b>internal static readonly</b> <span class="i">IntPtr</span> <a id="933083c3b887c19c" href="../../R/933083c3b887c19c.html" target="n" data-glyph="44,2" class="i field">INVALID_HANDLE_VALUE</a> = <b>new</b> <span class="i">IntPtr</span>(-1);  <span class="c">// WinBase.h</span>
 
            <b>internal const int</b> <a id="76d1e2f1058e25d9" href="../../R/76d1e2f1058e25d9.html" target="n" data-glyph="8,2" class="i field">FontTypeMask</a> = 0x06;
            <b>internal const int</b> <a id="10d50bbe4dcb92a2" href="../../R/10d50bbe4dcb92a2.html" target="n" data-glyph="8,2" class="i field">TrueTypeFont</a> = 0x04;
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> CreateFile
 
            [<span class="i">Flags</span>]
            <b>internal enum</b> <a id="1444c3b1c7f48035" href="../../R/1444c3b1c7f48035.html" target="n" data-glyph="20,2" class="t t"><span id="91bc98745e27b76d">AccessQualifiers</span></a> : <b>uint</b>
            {
                <span class="c">// From winnt.h</span>
                <a id="2c716a9d68edd188" href="../../R/2c716a9d68edd188.html" target="n" data-glyph="24,3" class="i field">GenericRead</a> = 0x80000000,
                <a id="abe8e77289796d74" href="../../R/abe8e77289796d74.html" target="n" data-glyph="24,3" class="i field">GenericWrite</a> = 0x40000000
            }
 
            [<span class="i">Flags</span>]
            <b>internal enum</b> <a id="c144dc8f5d316d14" href="../../R/c144dc8f5d316d14.html" target="n" data-glyph="20,2" class="t t"><span id="08768e83f282d477">ShareModes</span></a> : <b>uint</b>
            {
                <span class="c">// From winnt.h</span>
                <a id="63438f357d54a546" href="../../R/63438f357d54a546.html" target="n" data-glyph="24,3" class="i field">ShareRead</a> = 0x00000001,
                <a id="11134cf838df87b7" href="../../R/11134cf838df87b7.html" target="n" data-glyph="24,3" class="i field">ShareWrite</a> = 0x00000002
            }
 
            <b>internal enum</b> <a id="1711d221b860bd3c" href="../../R/1711d221b860bd3c.html" target="n" data-glyph="20,2" class="t t"><span id="d86643aa66f53f09">CreationDisposition</span></a> : <b>uint</b>
            {
                <span class="c">// From winbase.h</span>
                <a id="caaa08035cdd8ad0" href="../../R/../../0000000000.html" target="n" data-glyph="24,3" class="i field">CreateNew</a> = 1,
                <a id="54847ff4366d343f" href="../../R/../../0000000000.html" target="n" data-glyph="24,3" class="i field">CreateAlways</a> = 2,
                <a id="f60fea27ef7bfa23" href="../../R/f60fea27ef7bfa23.html" target="n" data-glyph="24,3" class="i field">OpenExisting</a> = 3,
                <a id="d1d0fe4351b5365c" href="../../R/../../0000000000.html" target="n" data-glyph="24,3" class="i field">OpenAlways</a> = 4,
                <a id="53c2d6276e3b2173" href="../../R/../../0000000000.html" target="n" data-glyph="24,3" class="i field">TruncateExisting</a> = 5
            }
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">CreateFileDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern</b> <span class="i">NakedWin32Handle</span> <a id="722141caad7094ec" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">CreateFile</a>
            (
                <b>string</b> <span id="r367 rd" class="r367 r">fileName</span>,
                <span class="i">DWORD</span> <span id="r368 rd" class="r368 r">desiredAccess</span>,
                <span class="i">DWORD</span> <span id="r369 rd" class="r369 r">ShareModes</span>,
                <span class="i">IntPtr</span> <span id="r370 rd" class="r370 r">securityAttributes</span>,
                <span class="i">DWORD</span> <span id="r371 rd" class="r371 r">creationDisposition</span>,
                <span class="i">DWORD</span> <span id="r372 rd" class="r372 r">flagsAndAttributes</span>,
                <span class="i">NakedWin32Handle</span> <span id="r373 rd" class="r373 r">templateFileWin32Handle</span>
            );
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> CreateFile
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Code Page
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetConsoleOutputCPDllName</span>, <span class="i">SetLastError</span> = <b>false</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern uint</b> <a id="c688549d0897a91d" href="../../R/c688549d0897a91d.html" target="n" data-glyph="74,2" class="i method">GetConsoleOutputCP</a>();
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Code Page
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetConsoleWindowDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern</b> <span class="i">HWND</span> <a id="a9ee16efe14ac974" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetConsoleWindow</a>();
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetDCDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern</b> <span class="i">HDC</span> <a id="e77263b8b4cac6c3" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetDC</a>(<span class="i">HWND</span> <span id="r374 rd" class="r374 r">hwnd</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ReleaseDCDllName</span>, <span class="i">SetLastError</span> = <b>false</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern int</b> <a id="2f713d74b5996b47" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">ReleaseDC</a>(<span class="i">HWND</span> <span id="r375 rd" class="r375 r">hwnd</span>, <span class="i">HDC</span> <span id="r376 rd" class="r376 r">hdc</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">FlushConsoleInputBufferDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="57b3e25ba5a7a8df" href="../../R/57b3e25ba5a7a8df.html" target="n" data-glyph="74,2" class="i method">FlushConsoleInputBuffer</a>(<span class="i">NakedWin32Handle</span> <span id="r377 rd" class="r377 r">consoleInput</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">FillConsoleOutputAttributeDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="7af2d18dbae6053d" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">FillConsoleOutputAttribute</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r378 rd" class="r378 r">consoleOutput</span>,
                <span class="i">WORD</span> <span id="r379 rd" class="r379 r">attribute</span>,
                <span class="i">DWORD</span> <span id="r380 rd" class="r380 r">length</span>,
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r381 rd" class="r381 r">writeCoord</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r382 rd" class="r382 r">numberOfAttrsWritten</span>
            );
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">FillConsoleOutputCharacterDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="f1bb9966584c5fd4" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">FillConsoleOutputCharacter</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r383 rd" class="r383 r">consoleOutput</span>,
                <b>char</b> <span id="r384 rd" class="r384 r">character</span>,
                <span class="i">DWORD</span> <span id="r385 rd" class="r385 r">length</span>,
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r386 rd" class="r386 r">writeCoord</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r387 rd" class="r387 r">numberOfCharsWritten</span>
            );
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">WriteConsoleDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>private static extern unsafe bool</b> <a id="73b53a77fab051e2" href="../../R/73b53a77fab051e2.html" target="n" data-glyph="76,2" class="i method">WriteConsole</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r388 rd" class="r388 r">consoleOutput</span>,
                <b>char</b>* <span id="r389 rd" class="r389 r">buffer</span>,
                <span class="i">DWORD</span> <span id="r390 rd" class="r390 r">numberOfCharsToWrite</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r391 rd" class="r391 r">numberOfCharsWritten</span>,
                <span class="i">IntPtr</span> <span id="r392 rd" class="r392 r">reserved</span>
            );
 
            <b>internal static unsafe bool</b> <a id="783197e376d1f2fb" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">WriteConsole</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r393 rd" class="r393 r">consoleOutput</span>,
                <span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r394 rd" class="r394 r">buffer</span>,
                <span class="i">DWORD</span> <span id="r395 rd" class="r395 r">numberOfCharsToWrite</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r396 rd" class="r396 r">numberOfCharsWritten</span>,
                <span class="i">IntPtr</span> <span id="r397 rd" class="r397 r">reserved</span>
            )
            {
                <b>fixed</b> (<b>char</b>* <span id="r398 rd" class="r398 r">bufferPtr</span> = &amp;<span class="i">MemoryMarshal</span>.<span class="i">GetReference</span>(<span class="r394 r">buffer</span>))
                {
                    <b>return</b> <a href="#73b53a77fab051e2" class="i method">WriteConsole</a>(<span class="r393 r">consoleOutput</span>, <span class="r398 r">bufferPtr</span>, <span class="r395 r">numberOfCharsToWrite</span>, <b>out</b> <span class="r396 r">numberOfCharsWritten</span>, <span class="r397 r">reserved</span>);
                }
            }
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetConsoleTitleDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern</b> <span class="i">DWORD</span> <a id="5320486e7cf0e653" href="../../R/5320486e7cf0e653.html" target="n" data-glyph="74,2" class="i method">GetConsoleTitle</a>(<span class="i">StringBuilder</span> <span id="r399 rd" class="r399 r">consoleTitle</span>, <span class="i">DWORD</span> <span id="r400 rd" class="r400 r">size</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetConsoleTitleDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="61c85d3405489118" href="../../R/61c85d3405489118.html" target="n" data-glyph="74,2" class="i method">SetConsoleTitle</a>(<b>string</b> <span id="r401 rd" class="r401 r">consoleTitle</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetConsoleModeDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="174a23a7e329e2c7" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetConsoleMode</a>(<span class="i">NakedWin32Handle</span> <span id="r402 rd" class="r402 r">consoleHandle</span>, <b>out</b> <span class="i">UInt32</span> <span id="r403 rd" class="r403 r">mode</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetConsoleScreenBufferInfoDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="8f8c2f9ce3c0d6d9" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetConsoleScreenBufferInfo</a>(<span class="i">NakedWin32Handle</span> <span id="r404 rd" class="r404 r">consoleHandle</span>, <b>out</b> <a href="#bddc36d28ff118a0" class="t t">CONSOLE_SCREEN_BUFFER_INFO</a> <span id="r405 rd" class="r405 r">consoleScreenBufferInfo</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetLargestConsoleWindowSizeDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern</b> <a href="#00043fcf4690a445" class="t t">COORD</a> <a id="6bef618471eccea4" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetLargestConsoleWindowSize</a>(<span class="i">NakedWin32Handle</span> <span id="r406 rd" class="r406 r">consoleOutput</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ReadConsoleDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>private static extern unsafe bool</b> <a id="ecba2853aad63560" href="../../R/ecba2853aad63560.html" target="n" data-glyph="76,2" class="i method">ReadConsole</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r407 rd" class="r407 r">consoleInput</span>,
                <b>char</b>* <span id="r408 rd" class="r408 r">lpBuffer</span>,
                <span class="i">DWORD</span> <span id="r409 rd" class="r409 r">numberOfCharsToRead</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r410 rd" class="r410 r">numberOfCharsRead</span>,
                <b>ref</b> <a href="#75931d4b0b657960" class="t t">CONSOLE_READCONSOLE_CONTROL</a> <span id="r411 rd" class="r411 r">controlData</span>
            );
 
            <b>internal static unsafe bool</b> <a id="7b70306783434ec8" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">ReadConsole</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r412 rd" class="r412 r">consoleInput</span>,
                <span class="i">Span</span>&lt;<b>char</b>&gt; <span id="r413 rd" class="r413 r">buffer</span>,
                <span class="i">DWORD</span> <span id="r414 rd" class="r414 r">numberOfCharsToRead</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r415 rd" class="r415 r">numberOfCharsRead</span>,
                <b>ref</b> <a href="#75931d4b0b657960" class="t t">CONSOLE_READCONSOLE_CONTROL</a> <span id="r416 rd" class="r416 r">controlData</span>
            )
            {
                <b>fixed</b> (<b>char</b>* <span id="r417 rd" class="r417 r">bufferPtr</span> = &amp;<span class="i">MemoryMarshal</span>.<span class="i">GetReference</span>(<span class="r413 r">buffer</span>))
                {
                    <b>return</b> <a href="#ecba2853aad63560" class="i method">ReadConsole</a>(<span class="r412 r">consoleInput</span>, <span class="r417 r">bufferPtr</span>, <span class="r414 r">numberOfCharsToRead</span>, <b>out</b> <span class="r415 r">numberOfCharsRead</span>, <b>ref</b> <span class="r416 r">controlData</span>);
                }
            }
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">PeekConsoleInputDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="763107fcc9b76364" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">PeekConsoleInput</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r418 rd" class="r418 r">consoleInput</span>,
                [<span class="i">Out</span>] <a href="#3515a77acb59df32" class="t t">INPUT_RECORD</a>[] <span id="r419 rd" class="r419 r">buffer</span>,
                <span class="i">DWORD</span> <span id="r420 rd" class="r420 r">length</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r421 rd" class="r421 r">numberOfEventsRead</span>
            );
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetNumberOfConsoleInputEventsDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="374bcc32532178b7" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetNumberOfConsoleInputEvents</a>(<span class="i">NakedWin32Handle</span> <span id="r422 rd" class="r422 r">consoleInput</span>, <b>out</b> <span class="i">DWORD</span> <span id="r423 rd" class="r423 r">numberOfEvents</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetConsoleCtrlHandlerDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="67e7e01d6cab2477" href="../../R/67e7e01d6cab2477.html" target="n" data-glyph="74,2" class="i method">SetConsoleCtrlHandler</a>(<a href="#fc771999e869a2f6" class="t t">BreakHandler</a> <span id="r424 rd" class="r424 r">handlerRoutine</span>, <b>bool</b> <span id="r425 rd" class="r425 r">add</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetConsoleModeDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="e0e76de8117c5a86" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">SetConsoleMode</a>(<span class="i">NakedWin32Handle</span> <span id="r426 rd" class="r426 r">consoleHandle</span>, <span class="i">DWORD</span> <span id="r427 rd" class="r427 r">mode</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetConsoleScreenBufferSizeDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="c955da00d860ce99" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">SetConsoleScreenBufferSize</a>(<span class="i">NakedWin32Handle</span> <span id="r428 rd" class="r428 r">consoleOutput</span>, <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r429 rd" class="r429 r">size</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetConsoleTextAttributeDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="c0a8f93be0965f5c" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">SetConsoleTextAttribute</a>(<span class="i">NakedWin32Handle</span> <span id="r430 rd" class="r430 r">consoleOutput</span>, <span class="i">WORD</span> <span id="r431 rd" class="r431 r">attributes</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetConsoleWindowInfoDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="9856ae4f17f9addc" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">SetConsoleWindowInfo</a>(<span class="i">NakedWin32Handle</span> <span id="r432 rd" class="r432 r">consoleHandle</span>, <b>bool</b> <span id="r433 rd" class="r433 r">absolute</span>, <b>ref</b> <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r434 rd" class="r434 r">windowInfo</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">WriteConsoleOutputDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="d90c50fe880b3aa8" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">WriteConsoleOutput</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r435 rd" class="r435 r">consoleOutput</span>,
                <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[] <span id="r436 rd" class="r436 r">buffer</span>,
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r437 rd" class="r437 r">bufferSize</span>,
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r438 rd" class="r438 r">bufferCoord</span>,
                <b>ref</b> <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r439 rd" class="r439 r">writeRegion</span>
            );
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ReadConsoleOutputDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="1e361adcc2efa3f1" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">ReadConsoleOutput</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r440 rd" class="r440 r">consoleOutput</span>,
                [<span class="i">Out</span>] <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a>[] <span id="r441 rd" class="r441 r">buffer</span>,
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r442 rd" class="r442 r">bufferSize</span>,
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r443 rd" class="r443 r">bufferCoord</span>,
                <b>ref</b> <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r444 rd" class="r444 r">readRegion</span>
            );
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ScrollConsoleScreenBufferDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="893ccb3c2702626a" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">ScrollConsoleScreenBuffer</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r445 rd" class="r445 r">consoleOutput</span>,
                <b>ref</b> <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r446 rd" class="r446 r">scrollRectangle</span>,
                <b>ref</b> <a href="#6cd4a96da231ccf6" class="t t">SMALL_RECT</a> <span id="r447 rd" class="r447 r">clipRectangle</span>,
                <a href="#00043fcf4690a445" class="t t">COORD</a> <span id="r448 rd" class="r448 r">destinationOrigin</span>,
                <b>ref</b> <a href="#9ad6afa10191aa8a" class="t t">CHAR_INFO</a> <span id="r449 rd" class="r449 r">fill</span>
            );
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SendInputDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            <b>internal static extern</b> <span class="i">UInt32</span> <a id="52b2472c50931456" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">SendInput</a>(<span class="i">UInt32</span> <span id="r450 rd" class="r450 r">inputNumbers</span>, <a href="#f9880a1b43685c6d" class="t t">INPUT</a>[] <span id="r451 rd" class="r451 r">inputs</span>, <b>int</b> <span id="r452 rd" class="r452 r">sizeOfInput</span>);
 
            <span class="c">// There is no GetCurrentConsoleFontEx on Core</span>
            [<span class="i">DllImport</span>(<span class="s">&quot;kernel32.dll&quot;</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="d9cdcbbd0e3f3ce0" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetCurrentConsoleFontEx</a>(<span class="i">NakedWin32Handle</span> <span id="r453 rd" class="r453 r">consoleOutput</span>, <b>bool</b> <span id="r454 rd" class="r454 r">bMaximumWindow</span>, <b>ref</b> <a href="#a07c3f2be802fbbf" class="t t">CONSOLE_FONT_INFO_EX</a> <span id="r455 rd" class="r455 r">consoleFontInfo</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">GetConsoleCursorInfoDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="a412ad0606a08ca4" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">GetConsoleCursorInfo</a>(<span class="i">NakedWin32Handle</span> <span id="r456 rd" class="r456 r">consoleOutput</span>, <b>out</b> <a href="#207b7680f453770b" class="t t">CONSOLE_CURSOR_INFO</a> <span id="r457 rd" class="r457 r">consoleCursorInfo</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">SetConsoleCursorInfoDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="d4c7cd20512f0d5d" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">SetConsoleCursorInfo</a>(<span class="i">NakedWin32Handle</span> <span id="r458 rd" class="r458 r">consoleOutput</span>, <b>ref</b> <a href="#207b7680f453770b" class="t t">CONSOLE_CURSOR_INFO</a> <span id="r459 rd" class="r459 r">consoleCursorInfo</span>);
 
            [<span class="i">DllImport</span>(<span class="i">PinvokeDllNames</span>.<span class="i">ReadConsoleInputDllName</span>, <span class="i">SetLastError</span> = <b>true</b>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
            [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
            <b>internal static extern bool</b> <a id="da7a5f8e32376c2c" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">ReadConsoleInput</a>
            (
                <span class="i">NakedWin32Handle</span> <span id="r460 rd" class="r460 r">consoleInput</span>,
                [<span class="i">Out</span>] <a href="#3515a77acb59df32" class="t t">INPUT_RECORD</a>[] <span id="r461 rd" class="r461 r">buffer</span>,
                <span class="i">DWORD</span> <span id="r462 rd" class="r462 r">length</span>,
                <b>out</b> <span class="i">DWORD</span> <span id="r463 rd" class="r463 r">numberOfEventsRead</span>
            );
 
            <b>internal enum</b> <a id="9c28974a86e93297" href="../../R/9c28974a86e93297.html" target="n" data-glyph="20,2" class="t t"><span id="d64b8f093d21e804">CHAR_INFO_Attributes</span></a> : <b>uint</b>
            {
                <a id="eddb350a87124adc" href="../../R/eddb350a87124adc.html" target="n" data-glyph="24,3" class="i field">COMMON_LVB_LEADING_BYTE</a> = 0x0100,
                <a id="2a905313eae4f173" href="../../R/2a905313eae4f173.html" target="n" data-glyph="24,3" class="i field">COMMON_LVB_TRAILING_BYTE</a> = 0x0200
            }
        }
 
        [<span class="i">TraceSourceAttribute</span>(<span class="s">&quot;ConsoleControl&quot;</span>, <span class="s">&quot;Console control methods&quot;</span>)]
        <b>private static readonly</b> <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="25a8024fd022835d" href="../../R/25a8024fd022835d.html" target="n" data-glyph="46,1" class="i field">tracer</a> = <a href="/System.Management.Automation/A.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">GetTracer</span>(<span class="s">&quot;ConsoleControl&quot;</span>, <span class="s">&quot;Console control methods&quot;</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
    }
}
</pre></td></tr></table></div></body></html>
