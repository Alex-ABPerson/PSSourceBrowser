<!DOCTYPE html>
<html><head><title>CimRegisterCimIndication.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(354);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Management.Infrastructure.CimCmdlets/CimRegisterCimIndication.cs" target="_top">CimRegisterCimIndication.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Management.Infrastructure.CimCmdlets" target="_top">src\Microsoft.Management.Infrastructure.CimCmdlets\Microsoft.Management.Infrastructure.CimCmdlets.csproj</a> (Microsoft.Management.Infrastructure.CimCmdlets)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">region</span> Using directives
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Management</span>.<span class="i n">Infrastructure</span>.<span class="i n">CimCmdlets</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Subscription result event args</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal abstract class</b> <a id="32f9cd59614d5971" href="R/32f9cd59614d5971.html" target="n" data-glyph="2,0" class="t t"><span id="52833967c7b6ad4f">CimSubscriptionEventArgs</span></a> : <span class="i">EventArgs</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an Object value for an operation context</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public object</b> <a id="2c9af673a4251bce" href="R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Context</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#e5939696bdd79e1d" class="i field">context</a>;
            }
        }
 
        <b>protected object</b> <a id="e5939696bdd79e1d" href="R/e5939696bdd79e1d.html" target="n" data-glyph="45,1" class="i field">context</a>;
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Subscription result event args</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="1d60ebffc1aef37a" href="R/1d60ebffc1aef37a.html" target="n" data-glyph="2,0" class="t t">CimSubscriptionResultEventArgs</a> : <a href="#32f9cd59614d5971" class="t t">CimSubscriptionEventArgs</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> subscription result</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">CimSubscriptionResult</span> <a id="6c485761df7e29aa" href="R/6c485761df7e29aa.html" target="n" data-glyph="102,1" class="i property">Result</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#1d60ebffc1aef37a" class="t t">CimSubscriptionResultEventArgs</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">theResult</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="442f11ff381c63b0" href="R/442f11ff381c63b0.html" target="n" data-glyph="72,1" class="t constructor">CimSubscriptionResultEventArgs</a>(
            <span class="i">CimSubscriptionResult</span> <span id="r0 rd" class="r0 r">theResult</span>)
        {
            <a href="#1d60ebffc1aef37a" class="k">this</a>.<a href="#e5939696bdd79e1d" class="i field">context</a> = <b>null</b>;
            <a href="#1d60ebffc1aef37a" class="k">this</a>.<a href="#6c485761df7e29aa" class="i property">Result</a> = <span class="r0 r">theResult</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Subscription result event args</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="56a3ad504fdf7941" href="R/56a3ad504fdf7941.html" target="n" data-glyph="2,0" class="t t">CimSubscriptionExceptionEventArgs</a> : <a href="#32f9cd59614d5971" class="t t">CimSubscriptionEventArgs</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> subscription result</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">Exception</span> <a id="6719452656aa7607" href="R/6719452656aa7607.html" target="n" data-glyph="102,1" class="i property">Exception</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#56a3ad504fdf7941" class="t t">CimSubscriptionExceptionEventArgs</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">theResult</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="5e5d947032fd1049" href="R/5e5d947032fd1049.html" target="n" data-glyph="72,1" class="t constructor">CimSubscriptionExceptionEventArgs</a>(
            <span class="i">Exception</span> <span id="r1 rd" class="r1 r">theException</span>)
        {
            <a href="#56a3ad504fdf7941" class="k">this</a>.<a href="#e5939696bdd79e1d" class="i field">context</a> = <b>null</b>;
            <a href="#56a3ad504fdf7941" class="k">this</a>.<a href="#6719452656aa7607" class="i property">Exception</a> = <span class="r1 r">theException</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Implements operations of register-cimindication cmdlet.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="390ec0ac9cdd39c7" href="R/390ec0ac9cdd39c7.html" target="n" data-glyph="2,0" class="t t">CimRegisterCimIndication</a> : <a href="CimAsyncOperation.cs.html#c0ecd00f7d90f163" class="t t">CimAsyncOperation</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New subscription result event</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public event</b> <span class="i">EventHandler</span>&lt;<a href="#32f9cd59614d5971" class="t t">CimSubscriptionEventArgs</a>&gt; <a id="5a90e42b5d6a4db5" href="R/5a90e42b5d6a4db5.html" target="n" data-glyph="30,1" class="i">OnNewSubscriptionResult</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#390ec0ac9cdd39c7" class="t t">CimRegisterCimIndication</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="49ada76f4f7b395b" href="R/49ada76f4f7b395b.html" target="n" data-glyph="72,1" class="t constructor">CimRegisterCimIndication</a>()
            : <a href="CimAsyncOperation.cs.html#b6a9bb91f10e5995" class="k">base</a>()
        {
            <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#9f1405b741d357bb" class="i field">ackedEvent</a> = <b>new</b> <span class="i">ManualResetEventSlim</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start an indication subscription target to the given computer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">computerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Null stands for localhost.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">nameSpace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">queryDialect</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">queryExpression</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">operationTimeout</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="7acf93bfe995dc1a" href="R/7acf93bfe995dc1a.html" target="n" data-glyph="72,1" class="i method">RegisterCimIndication</a>(
            <b>string</b> <span id="r2 rd" class="r2 r">computerName</span>,
            <b>string</b> <span id="r3 rd" class="r3 r">nameSpace</span>,
            <b>string</b> <span id="r4 rd" class="r4 r">queryDialect</span>,
            <b>string</b> <span id="r5 rd" class="r5 r">queryExpression</span>,
            <b>uint</b> <span id="r6 rd" class="r6 r">operationTimeout</span>)
        {
            <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#41e91352aaa16ae7" class="i method">WriteLogEx</a>(<span class="s">&quot;queryDialect = &#39;{0}&#39;; queryExpression = &#39;{1}&#39;&quot;</span>, 0, <span class="r4 r">queryDialect</span>, <span class="r5 r">queryExpression</span>);
            <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#20a4f59f42ac276b" class="i property">TargetComputerName</a> = <span class="r2 r">computerName</span>;
            <a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a> <span id="r7 rd" class="r7 r">proxy</span> = <a href="#98bc31195eabc08e" class="i method">CreateSessionProxy</a>(<span class="r2 r">computerName</span>, <span class="r6 r">operationTimeout</span>);
            <span class="r7 r">proxy</span>.<a href="CimSessionProxy.cs.html#bc21511d5872f3b2" class="i method">SubscribeAsync</a>(<span class="r3 r">nameSpace</span>, <span class="r4 r">queryDialect</span>, <span class="r5 r">queryExpression</span>);
            <a href="#48807d75abed40e9" class="i method">WaitForAckMessage</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start an indication subscription through a given </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CimSession</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">cimSession</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cannot be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">nameSpace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">queryDialect</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">queryExpression</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">operationTimeout</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Throw if cimSession is null.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public void</b> <a id="6c9751a877b256c5" href="R/6c9751a877b256c5.html" target="n" data-glyph="72,1" class="i method">RegisterCimIndication</a>(
            <span class="i">CimSession</span> <span id="r8 rd" class="r8 r">cimSession</span>,
            <b>string</b> <span id="r9 rd" class="r9 r">nameSpace</span>,
            <b>string</b> <span id="r10 rd" class="r10 r">queryDialect</span>,
            <b>string</b> <span id="r11 rd" class="r11 r">queryExpression</span>,
            <b>uint</b> <span id="r12 rd" class="r12 r">operationTimeout</span>)
        {
            <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#41e91352aaa16ae7" class="i method">WriteLogEx</a>(<span class="s">&quot;queryDialect = &#39;{0}&#39;; queryExpression = &#39;{1}&#39;&quot;</span>, 0, <span class="r10 r">queryDialect</span>, <span class="r11 r">queryExpression</span>);
            <b>if</b> (<span class="r8 r">cimSession</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentUICulture</span>, <span class="i">CimCmdletStrings</span>.<span class="i">NullArgument</span>, <b>nameof</b>(<span class="r8 r">cimSession</span>)));
            }
 
            <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#20a4f59f42ac276b" class="i property">TargetComputerName</a> = <span class="r8 r">cimSession</span>.<span class="i">ComputerName</span>;
            <a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a> <span id="r13 rd" class="r13 r">proxy</span> = <a href="#dfb860f0a180cb27" class="i method">CreateSessionProxy</a>(<span class="r8 r">cimSession</span>, <span class="r12 r">operationTimeout</span>);
            <span class="r13 r">proxy</span>.<a href="CimSessionProxy.cs.html#bc21511d5872f3b2" class="i method">SubscribeAsync</a>(<span class="r9 r">nameSpace</span>, <span class="r10 r">queryDialect</span>, <span class="r11 r">queryExpression</span>);
            <a href="#48807d75abed40e9" class="i method">WaitForAckMessage</a>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> override methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Subscribe to the events issued by </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">proxy</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="3a842e2a06b8cabc" href="R/3a842e2a06b8cabc.html" target="n" data-glyph="75,1" class="i method">SubscribeToCimSessionProxyEvent</a>(<a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a> <span id="r14 rd" class="r14 r">proxy</span>)
        {
            <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#4021e88828f2c984" class="i method">WriteLog</a>(<span class="s">&quot;SubscribeToCimSessionProxyEvent&quot;</span>, 4);
            <span class="c">// Raise event instead of write object to ps</span>
            <span class="r14 r">proxy</span>.<a href="CimSessionProxy.cs.html#04abbccddbb40bcb" class="i">OnNewCmdletAction</a> += <a href="#390ec0ac9cdd39c7" class="k">this</a>.<span class="i">CimIndicationHandler</span>;
            <span class="r14 r">proxy</span>.<a href="CimSessionProxy.cs.html#4358670844ddc0c7" class="i">OnOperationCreated</a> += <a href="#390ec0ac9cdd39c7" class="k">this</a>.<span class="i">OperationCreatedHandler</span>;
            <span class="r14 r">proxy</span>.<a href="CimSessionProxy.cs.html#7aee8b0b9291b20b" class="i">OnOperationDeleted</a> += <a href="#390ec0ac9cdd39c7" class="k">this</a>.<span class="i">OperationDeletedHandler</span>;
            <span class="r14 r">proxy</span>.<a href="CimSessionProxy.cs.html#6175600d03d1d002" class="i property">EnableMethodResultStreaming</a> = <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler used to handle new action event from</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">cimSession</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CimSession</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object raised the event</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">actionArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Event argument.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="cfea863fe60e2909" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CimIndicationHandler</a>(<b>object</b> <span id="r15 rd" class="r15 r">cimSession</span>, <a href="CimSessionProxy.cs.html#f9a63e977fe06b4e" class="t t">CmdletActionEventArgs</a> <span id="r16 rd" class="r16 r">actionArgs</span>)
        {
            <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#41e91352aaa16ae7" class="i method">WriteLogEx</a>(<span class="s">&quot;action is {0}. Disposed {1}&quot;</span>, 0, <span class="r16 r">actionArgs</span>.<a href="CimSessionProxy.cs.html#36809e757e44acff" class="i field">Action</a>, <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#e89f0ecdfc5d7f5c" class="i property">Disposed</a>);
 
            <b>if</b> (<a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#e89f0ecdfc5d7f5c" class="i property">Disposed</a>)
            {
                <b>return</b>;
            }
 
            <span class="c">// NOTES: should move after this.Disposed, but need to log the exception</span>
            <a href="CimWriteError.cs.html#b6cd4871b3fed104" class="t t">CimWriteError</a> <span id="r17 rd" class="r17 r">cimWriteError</span> = <span class="r16 r">actionArgs</span>.<a href="CimSessionProxy.cs.html#36809e757e44acff" class="i field">Action</a> <b>as</b> <a href="CimWriteError.cs.html#b6cd4871b3fed104" class="t t">CimWriteError</a>;
            <b>if</b> (<span class="r17 r">cimWriteError</span> != <b>null</b>)
            {
                <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#ce747777084b292e" class="i property">Exception</a> = <span class="r17 r">cimWriteError</span>.<a href="CimWriteError.cs.html#19fed363fa82fbe3" class="i property">Exception</a>;
                <b>if</b> (!<a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#9f1405b741d357bb" class="i field">ackedEvent</a>.<span class="i">IsSet</span>)
                {
                    <span class="c">// an exception happened</span>
                    <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#b52a9a49322f0296" class="i method">WriteLogEx</a>(<span class="s">&quot;an exception happened&quot;</span>, 0);
                    <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#9f1405b741d357bb" class="i field">ackedEvent</a>.<span class="i">Set</span>();
                    <b>return</b>;
                }
 
                <span class="i">EventHandler</span>&lt;<a href="#32f9cd59614d5971" class="t t">CimSubscriptionEventArgs</a>&gt; <span id="r18 rd" class="r18 r">temp</span> = <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#5a90e42b5d6a4db5" class="i">OnNewSubscriptionResult</a>;
                <b>if</b> (<span class="r18 r">temp</span> != <b>null</b>)
                {
                    <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#4021e88828f2c984" class="i method">WriteLog</a>(<span class="s">&quot;Raise an exception event&quot;</span>, 2);
 
                    <span class="r18 r">temp</span>(<a href="#390ec0ac9cdd39c7" class="k">this</a>, <b>new</b> <a href="#5e5d947032fd1049" class="t constructor">CimSubscriptionExceptionEventArgs</a>(<a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#ce747777084b292e" class="i property">Exception</a>));
                }
 
                <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<span class="i">WriteLog</span>(<span class="s">&quot;Got an exception: {0}&quot;</span>, 2, <a href="#ce747777084b292e" class="i property">Exception</a>);
            }
 
            <a href="CimWriteResultObject.cs.html#b7a3847402daf14e" class="t t">CimWriteResultObject</a> <span id="r19 rd" class="r19 r">cimWriteResultObject</span> = <span class="r16 r">actionArgs</span>.<a href="CimSessionProxy.cs.html#36809e757e44acff" class="i field">Action</a> <b>as</b> <a href="CimWriteResultObject.cs.html#b7a3847402daf14e" class="t t">CimWriteResultObject</a>;
            <b>if</b> (<span class="r19 r">cimWriteResultObject</span> != <b>null</b>)
            {
                <span class="i">CimSubscriptionResult</span> <span id="r20 rd" class="r20 r">result</span> = <span class="r19 r">cimWriteResultObject</span>.<a href="CimWriteResultObject.cs.html#5001549a4e79a9c9" class="i property">Result</a> <b>as</b> <span class="i">CimSubscriptionResult</span>;
                <b>if</b> (<span class="r20 r">result</span> != <b>null</b>)
                {
                    <span class="i">EventHandler</span>&lt;<a href="#32f9cd59614d5971" class="t t">CimSubscriptionEventArgs</a>&gt; <span id="r21 rd" class="r21 r">temp</span> = <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#5a90e42b5d6a4db5" class="i">OnNewSubscriptionResult</a>;
                    <b>if</b> (<span class="r21 r">temp</span> != <b>null</b>)
                    {
                        <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#4021e88828f2c984" class="i method">WriteLog</a>(<span class="s">&quot;Raise an result event&quot;</span>, 2);
                        <span class="r21 r">temp</span>(<a href="#390ec0ac9cdd39c7" class="k">this</a>, <b>new</b> <a href="#442f11ff381c63b0" class="t constructor">CimSubscriptionResultEventArgs</a>(<span class="r20 r">result</span>));
                    }
                }
                <b>else</b>
                {
                    <b>if</b> (!<a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#9f1405b741d357bb" class="i field">ackedEvent</a>.<span class="i">IsSet</span>)
                    {
                        <span class="c">// an ACK message returned</span>
                        <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#b52a9a49322f0296" class="i method">WriteLogEx</a>(<span class="s">&quot;an ack message happened&quot;</span>, 0);
                        <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#9f1405b741d357bb" class="i field">ackedEvent</a>.<span class="i">Set</span>();
                        <b>return</b>;
                    }
                    <b>else</b>
                    {
                        <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#b52a9a49322f0296" class="i method">WriteLogEx</a>(<span class="s">&quot;an ack message should not happen here&quot;</span>, 0);
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Block the ps thread until ACK message or Error happened.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="48807d75abed40e9" href="R/48807d75abed40e9.html" target="n" data-glyph="76,1" class="i method">WaitForAckMessage</a>()
        {
            <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#651773f290fcb6be" class="i method">WriteLogEx</a>();
            <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="CimAsyncOperation.cs.html#9f1405b741d357bb" class="i field">ackedEvent</a>.<span class="i">Wait</span>();
            <b>if</b> (<a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#ce747777084b292e" class="i property">Exception</a> != <b>null</b>)
            {
                <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#b52a9a49322f0296" class="i method">WriteLogEx</a>(<span class="s">&quot;error happened&quot;</span>, 0);
                <b>if</b> (<a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#a3110d2fbcb4d06c" class="i property">Cmdlet</a> != <b>null</b>)
                {
                    <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#b52a9a49322f0296" class="i method">WriteLogEx</a>(<span class="s">&quot;Throw Terminating error&quot;</span>, 1);
 
                    <span class="c">// throw terminating error</span>
                    <a href="/System.Management.Automation/A.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r22 rd" class="r22 r">errorRecord</span> = <a href="CimWriteError.cs.html#612639b9585974e2" class="t t">ErrorToErrorRecord</a>.<a href="CimWriteError.cs.html#b8967a9b90afaca5" class="i method">ErrorRecordFromAnyException</a>(
                        <b>new</b> <a href="CimSessionProxy.cs.html#1471b9a573777a2d" class="t constructor">InvocationContext</a>(<a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#20a4f59f42ac276b" class="i property">TargetComputerName</a>, <b>null</b>), <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#ce747777084b292e" class="i property">Exception</a>, <b>null</b>);
                    <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#a3110d2fbcb4d06c" class="i property">Cmdlet</a>.<span class="i">ThrowTerminatingError</span>(<span class="r22 r">errorRecord</span>);
                }
                <b>else</b>
                {
                    <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#b52a9a49322f0296" class="i method">WriteLogEx</a>(<span class="s">&quot;Throw exception&quot;</span>, 1);
                    <span class="c">// throw exception out</span>
                    <b>throw</b> <a href="#390ec0ac9cdd39c7" class="k">this</a>.<a href="#ce747777084b292e" class="i property">Exception</a>;
                }
            }
 
            <a href="Utils.cs.html#6b0644b87482dbb3" class="t t">DebugHelper</a>.<a href="Utils.cs.html#b52a9a49322f0296" class="i method">WriteLogEx</a>(<span class="s">&quot;ACK happened&quot;</span>, 0);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> internal property
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The cmdlet object who issue this subscription,</span>
        <span class="c">///</span><span class="c"> to throw ThrowTerminatingError</span>
        <span class="c">///</span><span class="c"> in case there is a subscription failure.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a href="/System.Management.Automation/A.html#b0d421ff1d7581f9" class="t t">Cmdlet</a> <a id="a3110d2fbcb4d06c" href="R/a3110d2fbcb4d06c.html" target="n" data-glyph="104,1" class="i property">Cmdlet</a>
        {
            <b>get</b>;
            <b>set</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Target computername.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="20a4f59f42ac276b" href="R/20a4f59f42ac276b.html" target="n" data-glyph="104,1" class="i property">TargetComputerName</a>
        {
            <b>get</b>;
            <b>set</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private methods
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and set properties</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">computerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">timeout</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a> <a id="98bc31195eabc08e" href="R/98bc31195eabc08e.html" target="n" data-glyph="76,1" class="i method">CreateSessionProxy</a>(
            <b>string</b> <span id="r23 rd" class="r23 r">computerName</span>,
            <b>uint</b> <span id="r24 rd" class="r24 r">timeout</span>)
        {
            <a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a> <span id="r25 rd" class="r25 r">proxy</span> = <a href="CimAsyncOperation.cs.html#4f68c7b030b8fa5e" class="i method">CreateCimSessionProxy</a>(<span class="r23 r">computerName</span>);
            <span class="r25 r">proxy</span>.<a href="CimSessionProxy.cs.html#6d62e741d043340b" class="i property">OperationTimeout</a> = <span class="r24 r">timeout</span>;
            <b>return</b> <span class="r25 r">proxy</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and set properties.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">session</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">timeout</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a> <a id="dfb860f0a180cb27" href="R/dfb860f0a180cb27.html" target="n" data-glyph="76,1" class="i method">CreateSessionProxy</a>(
            <span class="i">CimSession</span> <span id="r26 rd" class="r26 r">session</span>,
            <b>uint</b> <span id="r27 rd" class="r27 r">timeout</span>)
        {
            <a href="CimSessionProxy.cs.html#64da31a8ef7908ad" class="t t">CimSessionProxy</a> <span id="r28 rd" class="r28 r">proxy</span> = <a href="CimAsyncOperation.cs.html#703bb2b6e0f3691d" class="i method">CreateCimSessionProxy</a>(<span class="r26 r">session</span>);
            <span class="r28 r">proxy</span>.<a href="CimSessionProxy.cs.html#6d62e741d043340b" class="i property">OperationTimeout</a> = <span class="r27 r">timeout</span>;
            <b>return</b> <span class="r28 r">proxy</span>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private members
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Exception occurred while start the subscription.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Exception</span> <a id="ce747777084b292e" href="R/ce747777084b292e.html" target="n" data-glyph="104,1" class="i property">Exception</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    }
}
</pre></td></tr></table></div></body></html>
