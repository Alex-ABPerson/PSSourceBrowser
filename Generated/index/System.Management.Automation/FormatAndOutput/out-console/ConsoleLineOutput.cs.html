<!DOCTYPE html>
<html><head><title>ConsoleLineOutput.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(628);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/FormatAndOutput/out-console/ConsoleLineOutput.cs" target="_top">FormatAndOutput\out-console\ConsoleLineOutput.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="c">// NOTE: define this if you want to test the output on US machine and ASCII</span>
<span class="c">// characters</span>
<span class="c">//#define TEST_MULTICELL_ON_SINGLE_CELL_LOCALE</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Specialized</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<span class="c">// interfaces for host interaction</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<span class="i n">Internal</span>.<span class="i n">Format</span>
{
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">TEST_MULTICELL_ON_SINGLE_CELL_LOCALE</span>
<span class="e">
    /// &lt;summary&gt;
    /// Test class to provide easily overridable behavior for testing on US machines
    /// using US data.
    /// NOTE: the class just forces any uppercase letter [A-Z] to be prepended
    /// with an underscore (e.g. &quot;A&quot; becomes &quot;_A&quot;, but &quot;a&quot; stays the same)
    /// &lt;/summary&gt;
    internal class DisplayCellsTest : DisplayCells
    {
        internal override int Length(string str, int offset)
        {
            int len = 0;
            for (int k = offset; k &lt; str.Length; k++)
            {
                len += this.Length(str[k]);
            }
 
            return len;
        }
 
        internal override int Length(char character)
        {
            if (character &gt;= &#39;A&#39; &amp;&amp; character &lt;= &#39;Z&#39;)
                return 2;
            return 1;
        }
 
        internal override int GetHeadSplitLength(string str, int offset, int displayCells)
        {
            return GetSplitLengthInternalHelper(str, offset, displayCells, true);
        }
 
        internal override int GetTailSplitLength(string str, int offset, int displayCells)
        {
            return GetSplitLengthInternalHelper(str, offset, displayCells, false);
        }
 
        internal string GenerateTestString(string str)
        {
            StringBuilder sb = new StringBuilder();
            for (int k = 0; k &lt; str.Length; k++)
            {
                char ch = str[k];
                if (this.Length(ch) == 2)
                {
                    sb.Append(&#39;_&#39;);
                }
 
                sb.Append(ch);
            }
 
            return sb.ToString();
        }
 
    }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Tear off class.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="c8be04b8bd1f8878" href="../../R/c8be04b8bd1f8878.html" target="n" data-glyph="2,0" class="t t">DisplayCellsPSHost</a> : <a href="../common/ILineOutput.cs.html#20795ffb5d8d2dc1" class="t t">DisplayCells</a>
    {
        <b>internal</b> <a id="f7b0dbbd35b9241d" href="../../R/f7b0dbbd35b9241d.html" target="n" data-glyph="74,1" class="t constructor">DisplayCellsPSHost</a>(<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r0 rd" class="r0 r">rawUserInterface</span>)
        {
            <a href="#f13faa9d06fb0c3c" class="i field">_rawUserInterface</a> = <span class="r0 r">rawUserInterface</span>;
        }
 
        <b>internal override int</b> <a id="f55091460bfd06ad" href="../../R/f55091460bfd06ad.html" target="n" data-glyph="74,1" class="i method">Length</a>(<b>string</b> <span id="r1 rd" class="r1 r">str</span>, <b>int</b> <span id="r2 rd" class="r2 r">offset</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r1 r">str</span>))
            {
                <b>return</b> 0;
            }
 
            <b>if</b> (<span class="r2 r">offset</span> &lt; 0 || <span class="r2 r">offset</span> &gt;= <span class="r1 r">str</span>.<span class="i">Length</span>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<b>nameof</b>(<span class="r2 r">offset</span>));
            }
 
            <b>try</b>
            {
                <b>return</b> <a href="#f13faa9d06fb0c3c" class="i field">_rawUserInterface</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#dbe7f37780d0d7a2" class="i method">LengthInBufferCells</a>(<span class="r1 r">str</span>, <span class="r2 r">offset</span>);
            }
            <b>catch</b>
            {
                <span class="c">// thrown when external host rawui is not implemented, in which case</span>
                <span class="c">// we will fallback to the default value.</span>
            }
 
            <b>return</b> <span class="r1 r">str</span>.<span class="i">Length</span> - <span class="r2 r">offset</span>;
        }
 
        <b>internal override int</b> <a id="f54cecbe4939390c" href="../../R/f54cecbe4939390c.html" target="n" data-glyph="74,1" class="i method">Length</a>(<b>string</b> <span id="r3 rd" class="r3 r">str</span>)
        {
            <b>try</b>
            {
                <b>return</b> <a href="#f13faa9d06fb0c3c" class="i field">_rawUserInterface</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#b0859e4899c7530b" class="i method">LengthInBufferCells</a>(<span class="r3 r">str</span>);
            }
            <b>catch</b>
            {
                <span class="c">// thrown when external host rawui is not implemented, in which case</span>
                <span class="c">// we will fallback to the default value.</span>
            }
 
            <b>return</b> <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r3 r">str</span>) ? 0 : <span class="r3 r">str</span>.<span class="i">Length</span>;
        }
 
        <b>internal override int</b> <a id="f4e2cb71c3328f43" href="../../R/f4e2cb71c3328f43.html" target="n" data-glyph="74,1" class="i method">Length</a>(<b>char</b> <span id="r4 rd" class="r4 r">character</span>)
        {
            <b>try</b>
            {
                <b>return</b> <a href="#f13faa9d06fb0c3c" class="i field">_rawUserInterface</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#57277ea6de18a178" class="i method">LengthInBufferCells</a>(<span class="r4 r">character</span>);
            }
            <b>catch</b>
            {
                <span class="c">// thrown when external host rawui is not implemented, in which case</span>
                <span class="c">// we will fallback to the default value.</span>
            }
 
            <b>return</b> 1;
        }
 
        <b>internal override int</b> <a id="26f3886795d363cd" href="../../R/26f3886795d363cd.html" target="n" data-glyph="74,1" class="i method">GetHeadSplitLength</a>(<b>string</b> <span id="r5 rd" class="r5 r">str</span>, <b>int</b> <span id="r6 rd" class="r6 r">offset</span>, <b>int</b> <span id="r7 rd" class="r7 r">displayCells</span>)
        {
            <b>return</b> <a href="../common/ILineOutput.cs.html#f5f3775d3fa4e75d" class="i method">GetSplitLengthInternalHelper</a>(<span class="r5 r">str</span>, <span class="r6 r">offset</span>, <span class="r7 r">displayCells</span>, <b>true</b>);
        }
 
        <b>internal override int</b> <a id="cd135ec910e87322" href="../../R/cd135ec910e87322.html" target="n" data-glyph="74,1" class="i method">GetTailSplitLength</a>(<b>string</b> <span id="r8 rd" class="r8 r">str</span>, <b>int</b> <span id="r9 rd" class="r9 r">offset</span>, <b>int</b> <span id="r10 rd" class="r10 r">displayCells</span>)
        {
            <b>return</b> <a href="../common/ILineOutput.cs.html#f5f3775d3fa4e75d" class="i method">GetSplitLengthInternalHelper</a>(<span class="r8 r">str</span>, <span class="r9 r">offset</span>, <span class="r10 r">displayCells</span>, <b>false</b>);
        }
 
        <b>private readonly</b> <a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <a id="f13faa9d06fb0c3c" href="../../R/f13faa9d06fb0c3c.html" target="n" data-glyph="46,1" class="i field">_rawUserInterface</a>;
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Implementation of the LineOutput interface on top of Console and RawConsole.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="639bd14375dbfbb1" href="../../R/639bd14375dbfbb1.html" target="n" data-glyph="2,0" class="t t">ConsoleLineOutput</a> : <a href="../common/ILineOutput.cs.html#bef25620bcca346e" class="t t">LineOutput</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> tracer
        [<span class="i">TraceSource</span>(<span class="s">&quot;ConsoleLineOutput&quot;</span>, <span class="s">&quot;ConsoleLineOutput&quot;</span>)]
        <b>internal static readonly</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="1ea25ccda3a4e7fa" href="../../R/1ea25ccda3a4e7fa.html" target="n" data-glyph="44,1" class="i field">tracer</a> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;ConsoleLineOutput&quot;</span>, <span class="s">&quot;ConsoleLineOutput&quot;</span>);
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> tracer
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> LineOutput implementation
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The # of columns is just the width of the screen buffer (not the</span>
        <span class="c">///</span><span class="c"> width of the window)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal override int</b> <a id="5f6aaab4e1756a8c" href="../../R/5f6aaab4e1756a8c.html" target="n" data-glyph="104,1" class="i property">ColumnNumber</a>
        {
            <b>get</b>
            {
                <a href="../common/ILineOutput.cs.html#5f6f4fa8410735ac" class="i method">CheckStopProcessing</a>();
                <a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r11 rd" class="r11 r">raw</span> = <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>;
 
                <span class="c">// IMPORTANT NOTE: we subtract one because</span>
                <span class="c">// we want to make sure the console&#39;s last column</span>
                <span class="c">// is never considered written. This causes the writing</span>
                <span class="c">// logic to always call WriteLine(), making sure a CR</span>
                <span class="c">// is inserted.</span>
 
                <b>try</b>
                {
                    <b>return</b> <a href="#5e6cc58a145ffde4" class="i field">_forceNewLine</a> ? <span class="r11 r">raw</span>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#fb00d782b83e287c" class="i property">BufferSize</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#cc1bb8de7549bf9d" class="i property">Width</a> - 1 : <span class="r11 r">raw</span>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#fb00d782b83e287c" class="i property">BufferSize</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#cc1bb8de7549bf9d" class="i property">Width</a>;
                }
                <b>catch</b>
                {
                    <span class="c">// thrown when external host rawui is not implemented, in which case</span>
                    <span class="c">// we will fallback to the default value.</span>
                }
 
                <b>return</b> <a href="#5e6cc58a145ffde4" class="i field">_forceNewLine</a> ? <a href="#1eeb608037044be3" class="i field">_fallbackRawConsoleColumnNumber</a> - 1 : <a href="#1eeb608037044be3" class="i field">_fallbackRawConsoleColumnNumber</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The # of rows is the # of rows visible in the window (and not the # of</span>
        <span class="c">///</span><span class="c"> rows in the screen buffer)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal override int</b> <a id="2e93ccf206ccccd7" href="../../R/2e93ccf206ccccd7.html" target="n" data-glyph="104,1" class="i property">RowNumber</a>
        {
            <b>get</b>
            {
                <a href="../common/ILineOutput.cs.html#5f6f4fa8410735ac" class="i method">CheckStopProcessing</a>();
                <a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r12 rd" class="r12 r">raw</span> = <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>;
 
                <b>try</b>
                {
                    <b>return</b> <span class="r12 r">raw</span>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#e690f314a36b033e" class="i property">WindowSize</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#5ca800015fea1ce6" class="i property">Height</a>;
                }
                <b>catch</b>
                {
                    <span class="c">// thrown when external host rawui is not implemented, in which case</span>
                    <span class="c">// we will fallback to the default value.</span>
                }
 
                <b>return</b> <a href="#395d8428181e1de4" class="i field">_fallbackRawConsoleRowNumber</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Write a line to the output device.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Line to write.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="ba376d6f9197c6f2" href="../../R/ba376d6f9197c6f2.html" target="n" data-glyph="74,1" class="i method">WriteLine</a>(<b>string</b> <span id="r13 rd" class="r13 r">s</span>)
        {
            <a href="../common/ILineOutput.cs.html#5f6f4fa8410735ac" class="i method">CheckStopProcessing</a>();
 
            <span class="c">// delegate the action to the helper,</span>
            <span class="c">// that will properly break the string into</span>
            <span class="c">// screen lines</span>
            <a href="#b4fac84ee781e1f1" class="i field">_writeLineHelper</a>.<a href="../common/ILineOutput.cs.html#9e2617a87f377d51" class="i method">WriteLine</a>(<span class="r13 r">s</span>, <a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#5f6aaab4e1756a8c" class="i property">ColumnNumber</a>);
        }
 
        <b>internal override</b> <a href="../common/ILineOutput.cs.html#20795ffb5d8d2dc1" class="t t">DisplayCells</a> <a id="2797e9407219c801" href="../../R/2797e9407219c801.html" target="n" data-glyph="104,1" class="i property">DisplayCells</a>
        {
            <b>get</b>
            {
                <a href="../common/ILineOutput.cs.html#5f6f4fa8410735ac" class="i method">CheckStopProcessing</a>();
                <b>if</b> (<a href="#9f436bc4d2085587" class="i field">_displayCellsPSHost</a> != <b>null</b>)
                {
                    <b>return</b> <a href="#9f436bc4d2085587" class="i field">_displayCellsPSHost</a>;
                }
                <span class="c">// fall back if we do not have a Msh host specific instance</span>
                <b>return</b> <a href="#9f436bc4d2085587" class="i field">_displayCellsPSHost</a>;
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for the ConsoleLineOutput.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">hostConsole</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PSHostUserInterface to wrap.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">paging</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if we require prompting for page breaks.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">errorContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Error context to throw exceptions.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="6a4850d3c8c061a5" href="../../R/6a4850d3c8c061a5.html" target="n" data-glyph="74,1" class="t constructor">ConsoleLineOutput</a>(<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#3fd0cd9d58631820" class="t t">PSHostUserInterface</a> <span id="r14 rd" class="r14 r">hostConsole</span>, <b>bool</b> <span id="r15 rd" class="r15 r">paging</span>, <a href="../common/BaseCommand.cs.html#2dfdff306d6451a6" class="t t">TerminatingErrorContext</a> <span id="r16 rd" class="r16 r">errorContext</span>)
        {
            <b>if</b> (<span class="r14 r">hostConsole</span> == <b>null</b>)
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r14 r">hostConsole</span>));
            <b>if</b> (<span class="r16 r">errorContext</span> == <b>null</b>)
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r16 r">errorContext</span>));
 
            <a href="#8e451d7f4a34c889" class="i field">_console</a> = <span class="r14 r">hostConsole</span>;
            <a href="#17cb6cb653f28d04" class="i field">_errorContext</a> = <span class="r16 r">errorContext</span>;
 
            <b>if</b> (<span class="r15 r">paging</span>)
            {
                <a href="#1ea25ccda3a4e7fa" class="i field">tracer</a>.<a href="../../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;paging is needed&quot;</span>);
                <span class="c">// if we need to do paging, instantiate a prompt handler</span>
                <span class="c">// that will take care of the screen interaction</span>
                <b>string</b> <span id="r17 rd" class="r17 r">promptString</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">FormatAndOut_out_xxx</span>.<span class="i">ConsoleLineOutput_PagingPrompt</span>);
                <a href="#e13dc6471d2959c6" class="i field">_prompt</a> = <b>new</b> <a href="#a7bff99b8b83942c" class="t constructor">PromptHandler</a>(<span class="r17 r">promptString</span>, <a href="#639bd14375dbfbb1" class="k">this</a>);
            }
 
            <a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r18 rd" class="r18 r">raw</span> = <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>;
            <b>if</b> (<span class="r18 r">raw</span> != <b>null</b>)
            {
                <a href="#1ea25ccda3a4e7fa" class="i field">tracer</a>.<a href="../../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;there is a valid raw interface&quot;</span>);
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">TEST_MULTICELL_ON_SINGLE_CELL_LOCALE</span>
<span class="e">                // create a test instance with fake behavior
                this._displayCellsPSHost = new DisplayCellsTest();
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
                <span class="c">// set only if we have a valid raw interface</span>
                <a href="#9f436bc4d2085587" class="i field">_displayCellsPSHost</a> = <b>new</b> <a href="#f7b0dbbd35b9241d" class="t constructor">DisplayCellsPSHost</a>(<span class="r18 r">raw</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
 
            <span class="c">// instantiate the helper to do the line processing when ILineOutput.WriteXXX() is called</span>
            <a href="../common/ILineOutput.cs.html#38a633af3780947e" class="t t">WriteLineHelper</a>.<a href="../common/ILineOutput.cs.html#257cedfe2060ec23" class="t t">WriteCallback</a> <span id="r19 rd" class="r19 r">wl</span> = <b>new</b> <a href="../common/ILineOutput.cs.html#38a633af3780947e" class="t t">WriteLineHelper</a>.<span class="t">WriteCallback</span>(<a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#bb0b9c401357adb0" class="i method">OnWriteLine</a>);
            <a href="../common/ILineOutput.cs.html#38a633af3780947e" class="t t">WriteLineHelper</a>.<a href="../common/ILineOutput.cs.html#257cedfe2060ec23" class="t t">WriteCallback</a> <span id="r20 rd" class="r20 r">w</span> = <b>new</b> <a href="../common/ILineOutput.cs.html#38a633af3780947e" class="t t">WriteLineHelper</a>.<span class="t">WriteCallback</span>(<a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#ba671283a5d72bb1" class="i method">OnWrite</a>);
 
            <b>if</b> (<a href="#5e6cc58a145ffde4" class="i field">_forceNewLine</a>)
            {
                <a href="#b4fac84ee781e1f1" class="i field">_writeLineHelper</a> = <b>new</b> <a href="../common/ILineOutput.cs.html#b5f96840e3ead06a" class="t constructor">WriteLineHelper</a>(<span class="c">/*lineWrap*/</span><b>false</b>, <span class="r19 r">wl</span>, <b>null</b>, <a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#2797e9407219c801" class="i property">DisplayCells</a>);
            }
            <b>else</b>
            {
                <a href="#b4fac84ee781e1f1" class="i field">_writeLineHelper</a> = <b>new</b> <a href="../common/ILineOutput.cs.html#b5f96840e3ead06a" class="t constructor">WriteLineHelper</a>(<span class="c">/*lineWrap*/</span><b>false</b>, <span class="r19 r">wl</span>, <span class="r20 r">w</span>, <a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#2797e9407219c801" class="i property">DisplayCells</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Callback to be called when ILineOutput.WriteLine() is called by WriteLineHelper.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">String to write.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="bb0b9c401357adb0" href="../../R/bb0b9c401357adb0.html" target="n" data-glyph="76,1" class="i method">OnWriteLine</a>(<b>string</b> <span id="r21 rd" class="r21 r">s</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">TEST_MULTICELL_ON_SINGLE_CELL_LOCALE</span>
<span class="e">            s = ((DisplayCellsTest)this._displayCellsPSHost).GenerateTestString(s);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <span class="c">// Do any default transcription.</span>
            <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#257416bc2c610658" class="i method">TranscribeResult</a>(<span class="r21 r">s</span>);
 
            <b>switch</b> (<a href="#639bd14375dbfbb1" class="k">this</a>.<a href="../common/ILineOutput.cs.html#6d6f4ce7ecf426c3" class="i property">WriteStream</a>)
            {
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#af472c29dba3fb51" class="i field">Error</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#c90737c2e1ab652f" class="i method">WriteErrorLine</a>(<span class="r21 r">s</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#6c92852b80d52e75" class="i field">Warning</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#1c7bdddbbd1bab31" class="i method">WriteWarningLine</a>(<span class="r21 r">s</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#74af4733316f3145" class="i field">Verbose</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#be9a01fd092f8614" class="i method">WriteVerboseLine</a>(<span class="r21 r">s</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#9b1a014e3b7e9eb3" class="i field">Debug</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#92e834f5f174ffe2" class="i method">WriteDebugLine</a>(<span class="r21 r">s</span>);
                    <b>break</b>;
 
                <b>default</b>:
                    <span class="c">// If the host is in &quot;transcribe only&quot;</span>
                    <span class="c">// mode (due to an implicitly added call to Out-Default -Transcribe),</span>
                    <span class="c">// then don&#39;t call the actual host API.</span>
                    <b>if</b> (!<a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#0b0a4196ed6cce64" class="i property">TranscribeOnly</a>)
                    {
                        <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#41cef667d4ee22a2" class="i method">WriteLine</a>(<span class="r21 r">s</span>);
                    }
 
                    <b>break</b>;
            }
 
            <a href="#67d97779b59bae43" class="i method">LineWrittenEvent</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Callback to be called when ILineOutput.Write() is called by WriteLineHelper</span>
        <span class="c">///</span><span class="c"> This is called when the WriteLineHelper needs to write a line whose length</span>
        <span class="c">///</span><span class="c"> is the same as the width of the screen buffer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">String to write.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="ba671283a5d72bb1" href="../../R/ba671283a5d72bb1.html" target="n" data-glyph="76,1" class="i method">OnWrite</a>(<b>string</b> <span id="r22 rd" class="r22 r">s</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">TEST_MULTICELL_ON_SINGLE_CELL_LOCALE</span>
<span class="e">            s = ((DisplayCellsTest)this._displayCellsPSHost).GenerateTestString(s);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
            <b>switch</b> (<a href="#639bd14375dbfbb1" class="k">this</a>.<a href="../common/ILineOutput.cs.html#6d6f4ce7ecf426c3" class="i property">WriteStream</a>)
            {
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#af472c29dba3fb51" class="i field">Error</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#c90737c2e1ab652f" class="i method">WriteErrorLine</a>(<span class="r22 r">s</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#6c92852b80d52e75" class="i field">Warning</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#1c7bdddbbd1bab31" class="i method">WriteWarningLine</a>(<span class="r22 r">s</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#74af4733316f3145" class="i field">Verbose</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#be9a01fd092f8614" class="i method">WriteVerboseLine</a>(<span class="r22 r">s</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../../engine/MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../engine/MshObject.cs.html#9b1a014e3b7e9eb3" class="i field">Debug</a>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#92e834f5f174ffe2" class="i method">WriteDebugLine</a>(<span class="r22 r">s</span>);
                    <b>break</b>;
 
                <b>default</b>:
                    <a href="#8e451d7f4a34c889" class="i field">_console</a>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#49793db835d30773" class="i method">Write</a>(<span class="r22 r">s</span>);
                    <b>break</b>;
            }
 
            <a href="#67d97779b59bae43" class="i method">LineWrittenEvent</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called when a line was written to console.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="67d97779b59bae43" href="../../R/67d97779b59bae43.html" target="n" data-glyph="76,1" class="i method">LineWrittenEvent</a>()
        {
            <span class="c">// check to avoid reentrancy from the prompt handler</span>
            <span class="c">// writing during the PromptUser() call</span>
            <b>if</b> (<a href="#50fb2932f33caf91" class="i field">_disableLineWrittenEvent</a>)
                <b>return</b>;
 
            <span class="c">// if there is no prompting, we are done</span>
            <b>if</b> (<a href="#e13dc6471d2959c6" class="i field">_prompt</a> == <b>null</b>)
                <b>return</b>;
 
            <span class="c">// increment the count of lines written to the screen</span>
            <a href="#5ddae77904f5d06c" class="i field">_linesWritten</a>++;
 
            <span class="c">// check if we need to put out a prompt</span>
            <b>if</b> (<a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#9fa7b8483233f8f1" class="i property">NeedToPrompt</a>)
            {
                <span class="c">// put out the prompt</span>
                <a href="#50fb2932f33caf91" class="i field">_disableLineWrittenEvent</a> = <b>true</b>;
                <a href="#7c1df7ae0fee008b" class="t t">PromptHandler</a>.<a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a> <span id="r23 rd" class="r23 r">response</span> = <a href="#e13dc6471d2959c6" class="i field">_prompt</a>.<a href="#126a7ee2b5f31e42" class="i method">PromptUser</a>(<a href="#8e451d7f4a34c889" class="i field">_console</a>);
                <a href="#50fb2932f33caf91" class="i field">_disableLineWrittenEvent</a> = <b>false</b>;
 
                <b>switch</b> (<span class="r23 r">response</span>)
                {
                    <b>case</b> <a href="#7c1df7ae0fee008b" class="t t">PromptHandler</a>.<a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a>.<a href="#9c6de731490e1b2e" class="i field">NextPage</a>:
                        {
                            <span class="c">// reset the counter, since we are starting a new page</span>
                            <a href="#5ddae77904f5d06c" class="i field">_linesWritten</a> = 0;
                        }
 
                        <b>break</b>;
                    <b>case</b> <a href="#7c1df7ae0fee008b" class="t t">PromptHandler</a>.<a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a>.<a href="#2820325201895b96" class="i field">NextLine</a>:
                        {
                            <span class="c">// roll back the counter by one, since we allow one more line</span>
                            <a href="#5ddae77904f5d06c" class="i field">_linesWritten</a>--;
                        }
 
                        <b>break</b>;
                    <b>case</b> <a href="#7c1df7ae0fee008b" class="t t">PromptHandler</a>.<a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a>.<a href="#9fd223da4b4e124d" class="i field">Quit</a>:
                        <span class="c">// 1021203-2005/05/09-JonN</span>
                        <span class="c">// HaltCommandException will cause the command</span>
                        <span class="c">// to stop, but not be reported as an error.</span>
                        <b>throw</b> <b>new</b> <a href="../../utils/ExecutionExceptions.cs.html#9fec55af99baee08" class="t constructor">HaltCommandException</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if we need to put out a prompt.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">true if we need to prompt</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="9fa7b8483233f8f1" href="../../R/9fa7b8483233f8f1.html" target="n" data-glyph="106,1" class="i property">NeedToPrompt</a>
        {
            <b>get</b>
            {
                <span class="c">// NOTE: we recompute all the time to take into account screen resizing</span>
                <b>int</b> <span id="r24 rd" class="r24 r">rawRowNumber</span> = <a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#2e93ccf206ccccd7" class="i property">RowNumber</a>;
 
                <b>if</b> (<span class="r24 r">rawRowNumber</span> &lt;= 0)
                {
                    <span class="c">// something is wrong, there is no real estate, we suppress prompting</span>
                    <b>return</b> <b>false</b>;
                }
 
                <span class="c">// the prompt will occupy some lines, so we need to subtract them form the total</span>
                <span class="c">// screen line count</span>
                <b>int</b> <span id="r25 rd" class="r25 r">computedPromptLines</span> = <a href="#e13dc6471d2959c6" class="i field">_prompt</a>.<a href="#fa4304b91cca40af" class="i method">ComputePromptLines</a>(<a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#2797e9407219c801" class="i property">DisplayCells</a>, <a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#5f6aaab4e1756a8c" class="i property">ColumnNumber</a>);
                <b>int</b> <span id="r26 rd" class="r26 r">availableLines</span> = <a href="#639bd14375dbfbb1" class="k">this</a>.<a href="#2e93ccf206ccccd7" class="i property">RowNumber</a> - <span class="r25 r">computedPromptLines</span>;
 
                <b>if</b> (<span class="r26 r">availableLines</span> &lt;= 0)
                {
                    <a href="#1ea25ccda3a4e7fa" class="i field">tracer</a>.<a href="../../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;No available Lines; suppress prompting&quot;</span>);
                    <span class="c">// something is wrong, there is no real estate, we suppress prompting</span>
                    <b>return</b> <b>false</b>;
                }
 
                <b>return</b> <a href="#5ddae77904f5d06c" class="i field">_linesWritten</a> &gt;= <span class="r26 r">availableLines</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Members
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object to manage prompting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private sealed class</b> <a id="7c1df7ae0fee008b" href="../../R/7c1df7ae0fee008b.html" target="n" data-glyph="4,1" class="t t">PromptHandler</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Prompt handler with the given prompt.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">s</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Prompt string to be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Cmdlet using this prompt handler.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal</b> <a id="a7bff99b8b83942c" href="../../R/a7bff99b8b83942c.html" target="n" data-glyph="74,2" class="t constructor">PromptHandler</a>(<b>string</b> <span id="r27 rd" class="r27 r">s</span>, <a href="#639bd14375dbfbb1" class="t t">ConsoleLineOutput</a> <span id="r28 rd" class="r28 r">cmdlet</span>)
            {
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r27 r">s</span>))
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r27 r">s</span>));
 
                <a href="#cf4b6322d12802c1" class="i field">_promptString</a> = <span class="r27 r">s</span>;
                <a href="#46f86b270d55ada8" class="i field">_callingCmdlet</a> = <span class="r28 r">cmdlet</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Determine how many rows the prompt should take.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">cols</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Current number of columns on the screen.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">displayCells</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">String manipulation helper.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>internal int</b> <a id="fa4304b91cca40af" href="../../R/fa4304b91cca40af.html" target="n" data-glyph="74,2" class="i method">ComputePromptLines</a>(<a href="../common/ILineOutput.cs.html#20795ffb5d8d2dc1" class="t t">DisplayCells</a> <span id="r30 rd" class="r30 r">displayCells</span>, <b>int</b> <span id="r29 rd" class="r29 r">cols</span>)
            {
                <span class="c">// split the prompt string into lines</span>
                <a href="#72350d728edac96c" class="i field">_actualPrompt</a> = <a href="../common/ComplexWriter.cs.html#ce52aabdba932938" class="t t">StringManipulationHelper</a>.<a href="../common/ComplexWriter.cs.html#d919cc7a3bb58a02" class="i method">GenerateLines</a>(<span class="r30 r">displayCells</span>, <a href="#cf4b6322d12802c1" class="i field">_promptString</a>, <span class="r29 r">cols</span>, <span class="r29 r">cols</span>);
                <b>return</b> <a href="#72350d728edac96c" class="i field">_actualPrompt</a>.<span class="i">Count</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Options returned by the PromptUser() call.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal enum</b> <a id="fc6a5aac1af941a4" href="../../R/fc6a5aac1af941a4.html" target="n" data-glyph="20,2" class="t t"><span id="ae97ebd6ce08b447">PromptResponse</span></a>
            {
                <a id="9c6de731490e1b2e" href="../../R/9c6de731490e1b2e.html" target="n" data-glyph="24,3" class="i field">NextPage</a>,
                <a id="2820325201895b96" href="../../R/2820325201895b96.html" target="n" data-glyph="24,3" class="i field">NextLine</a>,
                <a id="9fd223da4b4e124d" href="../../R/9fd223da4b4e124d.html" target="n" data-glyph="24,3" class="i field">Quit</a>
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Do the actual prompting.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">console</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PSHostUserInterface instance to prompt to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal</b> <a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a> <a id="126a7ee2b5f31e42" href="../../R/126a7ee2b5f31e42.html" target="n" data-glyph="74,2" class="i method">PromptUser</a>(<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#3fd0cd9d58631820" class="t t">PSHostUserInterface</a> <span id="r31 rd" class="r31 r">console</span>)
            {
                <span class="c">// NOTE: assume the values passed to ComputePromptLines are still valid</span>
 
                <span class="c">// write out the prompt line(s). The last one will not have a new line</span>
                <span class="c">// at the end because we leave the prompt at the end of the line</span>
                <b>for</b> (<b>int</b> <span id="r32 rd" class="r32 r">k</span> = 0; <span class="r32 r">k</span> &lt; <a href="#72350d728edac96c" class="i field">_actualPrompt</a>.<span class="i">Count</span>; <span class="r32 r">k</span>++)
                {
                    <b>if</b> (<span class="r32 r">k</span> &lt; (<a href="#72350d728edac96c" class="i field">_actualPrompt</a>.<span class="i">Count</span> - 1))
                        <span class="r31 r">console</span>.<span class="i">WriteLine</span>(<a href="#72350d728edac96c" class="i field">_actualPrompt</a>[<span class="r32 r">k</span>]); <span class="c">// intermediate line(s)</span>
                    <b>else</b>
                        <span class="r31 r">console</span>.<span class="i">Write</span>(<a href="#72350d728edac96c" class="i field">_actualPrompt</a>[<span class="r32 r">k</span>]); <span class="c">// last line</span>
                }
 
                <b>while</b> (<b>true</b>)
                {
                    <a href="#46f86b270d55ada8" class="i field">_callingCmdlet</a>.<a href="../common/ILineOutput.cs.html#5f6f4fa8410735ac" class="i method">CheckStopProcessing</a>();
                    <a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#789e42f61d8e8616" class="t t">KeyInfo</a> <span id="r33 rd" class="r33 r">ki</span> = <span class="r31 r">console</span>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#40db3894523c25ab" class="i method">ReadKey</a>(<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#da21b13889b0c6ff" class="t t">ReadKeyOptions</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#31318a6916ef253b" class="i field">IncludeKeyUp</a> | <a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#da21b13889b0c6ff" class="t t">ReadKeyOptions</a>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#04b955d74c21745f" class="i field">NoEcho</a>);
                    <b>char</b> <span id="r34 rd" class="r34 r">key</span> = <span class="r33 r">ki</span>.<a href="../../engine/hostifaces/MshHostRawUserInterface.cs.html#5ecc487d47639a7c" class="i property">Character</a>;
                    <b>if</b> (<span class="r34 r">key</span> == <span class="s">&#39;q&#39;</span> || <span class="r34 r">key</span> == <span class="s">&#39;Q&#39;</span>)
                    {
                        <span class="c">// need to move to the next line since we accepted input, add a newline</span>
                        <span class="r31 r">console</span>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#f95b9cbe920380e3" class="i method">WriteLine</a>();
                        <b>return</b> <a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a>.<a href="#9fd223da4b4e124d" class="i field">Quit</a>;
                    }
                    <b>else</b> <b>if</b> (<span class="r34 r">key</span> == <span class="s">&#39; &#39;</span>)
                    {
                        <span class="c">// need to move to the next line since we accepted input, add a newline</span>
                        <span class="r31 r">console</span>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#f95b9cbe920380e3" class="i method">WriteLine</a>();
                        <b>return</b> <a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a>.<a href="#9c6de731490e1b2e" class="i field">NextPage</a>;
                    }
                    <b>else</b> <b>if</b> (<span class="r34 r">key</span> == <span class="s">&#39;\r&#39;</span>)
                    {
                        <span class="c">// need to move to the next line since we accepted input, add a newline</span>
                        <span class="r31 r">console</span>.<a href="../../engine/hostifaces/MshHostUserInterface.cs.html#f95b9cbe920380e3" class="i method">WriteLine</a>();
                        <b>return</b> <a href="#fc6a5aac1af941a4" class="t t">PromptResponse</a>.<a href="#2820325201895b96" class="i field">NextLine</a>;
                    }
                }
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Cached string(s) valid during a sequence of ComputePromptLines()/PromptUser()</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>private</b> <span class="i">StringCollection</span> <a id="72350d728edac96c" href="../../R/72350d728edac96c.html" target="n" data-glyph="46,2" class="i field">_actualPrompt</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Prompt string as passed at initialization.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>private readonly string</b> <a id="cf4b6322d12802c1" href="../../R/cf4b6322d12802c1.html" target="n" data-glyph="46,2" class="i field">_promptString</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The cmdlet that uses this prompt helper.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>private readonly</b> <a href="#639bd14375dbfbb1" class="t t">ConsoleLineOutput</a> <a id="46f86b270d55ada8" href="../../R/46f86b270d55ada8.html" target="n" data-glyph="46,2" class="i field">_callingCmdlet</a> = <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flag to force new lines in CMD.EXE by limiting the</span>
        <span class="c">///</span><span class="c"> usable width to N-1 (e.g. 80-1) and forcing a call</span>
        <span class="c">///</span><span class="c"> to WriteLine()</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly bool</b> <a id="5e6cc58a145ffde4" href="../../R/5e6cc58a145ffde4.html" target="n" data-glyph="46,1" class="i field">_forceNewLine</a> = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Use this if IRawConsole is null;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly int</b> <a id="1eeb608037044be3" href="../../R/1eeb608037044be3.html" target="n" data-glyph="46,1" class="i field">_fallbackRawConsoleColumnNumber</a> = 80;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Use this if IRawConsole is null;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly int</b> <a id="395d8428181e1de4" href="../../R/395d8428181e1de4.html" target="n" data-glyph="46,1" class="i field">_fallbackRawConsoleRowNumber</a> = 40;
 
        <b>private readonly</b> <a href="../common/ILineOutput.cs.html#38a633af3780947e" class="t t">WriteLineHelper</a> <a id="b4fac84ee781e1f1" href="../../R/b4fac84ee781e1f1.html" target="n" data-glyph="46,1" class="i field">_writeLineHelper</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler to prompt the user for page breaks</span>
        <span class="c">///</span><span class="c"> if this handler is not null, we have prompting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="#7c1df7ae0fee008b" class="t t">PromptHandler</a> <a id="e13dc6471d2959c6" href="../../R/e13dc6471d2959c6.html" target="n" data-glyph="46,1" class="i field">_prompt</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Conter for the # of lines written when prompting is on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private long</b> <a id="5ddae77904f5d06c" href="../../R/5ddae77904f5d06c.html" target="n" data-glyph="46,1" class="i field">_linesWritten</a> = 0;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flag to avoid reentrancy on prompting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="50fb2932f33caf91" href="../../R/50fb2932f33caf91.html" target="n" data-glyph="46,1" class="i field">_disableLineWrittenEvent</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Refecence to the PSHostUserInterface interface we use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="../../engine/hostifaces/MshHostUserInterface.cs.html#3fd0cd9d58631820" class="t t">PSHostUserInterface</a> <a id="8e451d7f4a34c889" href="../../R/8e451d7f4a34c889.html" target="n" data-glyph="46,1" class="i field">_console</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Msh host specific string manipulation helper.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="../common/ILineOutput.cs.html#20795ffb5d8d2dc1" class="t t">DisplayCells</a> <a id="9f436bc4d2085587" href="../../R/9f436bc4d2085587.html" target="n" data-glyph="46,1" class="i field">_displayCellsPSHost</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reference to error context to throw Msh exceptions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="../common/BaseCommand.cs.html#2dfdff306d6451a6" class="t t">TerminatingErrorContext</a> <a id="17cb6cb653f28d04" href="../../R/17cb6cb653f28d04.html" target="n" data-glyph="46,1" class="i field">_errorContext</a> = <b>null</b>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
