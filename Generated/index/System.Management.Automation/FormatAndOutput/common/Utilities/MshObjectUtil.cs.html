<!DOCTYPE html>
<html><head><title>MshObjectUtil.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(637);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/FormatAndOutput/common/Utilities/MshObjectUtil.cs" target="_top">FormatAndOutput\common\Utilities\MshObjectUtil.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<span class="i n">Internal</span>.<span class="i n">Format</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Class containing miscellaneous helpers to deal with</span>
    <span class="c">///</span><span class="c"> PSObject manipulation.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="fa81a7bc4f9cb4f0" href="../../../R/fa81a7bc4f9cb4f0.html" target="n" data-glyph="2,0" class="t t">PSObjectHelper</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> tracer
        [<span class="i">TraceSource</span>(<span class="s">&quot;PSObjectHelper&quot;</span>, <span class="s">&quot;PSObjectHelper&quot;</span>)]
        <b>private static readonly</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="564da872db5d246c" href="../../../R/564da872db5d246c.html" target="n" data-glyph="46,1" class="i field">s_tracer</a> = <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;PSObjectHelper&quot;</span>, <span class="s">&quot;PSObjectHelper&quot;</span>);
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> tracer
 
        <b>internal const char</b> <a id="a5549bfa35c48a67" href="../../../R/a5549bfa35c48a67.html" target="n" data-glyph="8,1" class="i field">Ellipsis</a> = <span class="s">&#39;\u2026&#39;</span>;
 
        <b>internal static string</b> <a id="ff11eb07e566e898" href="../../../R/ff11eb07e566e898.html" target="n" data-glyph="74,1" class="i method">PSObjectIsOfExactType</a>(<span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r0 rd" class="r0 r">typeNames</span>)
        {
            <b>if</b> (<span class="r0 r">typeNames</span>.<span class="i">Count</span> != 0)
                <b>return</b> <span class="r0 r">typeNames</span>[0];
            <b>return</b> <b>null</b>;
        }
 
        <b>internal static bool</b> <a id="4bf2c1de171773d8" href="../../../R/4bf2c1de171773d8.html" target="n" data-glyph="74,1" class="i method">PSObjectIsEnum</a>(<span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r1 rd" class="r1 r">typeNames</span>)
        {
            <b>if</b> (<span class="r1 r">typeNames</span>.<span class="i">Count</span> &lt; 2 || <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r1 r">typeNames</span>[1]))
                <b>return</b> <b>false</b>;
            <b>return</b> <b>string</b>.<span class="i">Equals</span>(<span class="r1 r">typeNames</span>[1], <span class="s">&quot;System.Enum&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve the display name. It looks for a well known property and,</span>
        <span class="c">///</span><span class="c"> if not found, it uses some heuristics to get a &quot;close&quot; match.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">target</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Shell object to process.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">expressionFactory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression factory to create PSPropertyExpression.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Resolved PSPropertyExpression; null if no match was found.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <a id="c543a5aa770662b2" href="../../../R/c543a5aa770662b2.html" target="n" data-glyph="74,1" class="i method">GetDisplayNameExpression</a>(<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r2 rd" class="r2 r">target</span>, <a href="#ac8b562fd83d9f0f" class="t t">PSPropertyExpressionFactory</a> <span id="r3 rd" class="r3 r">expressionFactory</span>)
        {
            <span class="c">// first try to get the expression from the object (types.ps1xml data)</span>
            <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <span id="r4 rd" class="r4 r">expressionFromObject</span> = <a href="#adb9170b24c32bdd" class="i method">GetDefaultNameExpression</a>(<span class="r2 r">target</span>);
            <b>if</b> (<span class="r4 r">expressionFromObject</span> != <b>null</b>)
            {
                <b>return</b> <span class="r4 r">expressionFromObject</span>;
            }
 
            <span class="c">// we failed the default display name, let&#39;s try some well known names</span>
            <span class="c">// trying to get something potentially useful</span>
            <b>string</b>[] <span id="r5 rd" class="r5 r">knownPatterns</span> = <b>new</b> <b>string</b>[] {
                <span class="s">&quot;name&quot;</span>, <span class="s">&quot;id&quot;</span>, <span class="s">&quot;key&quot;</span>, <span class="s">&quot;*key&quot;</span>, <span class="s">&quot;*name&quot;</span>, <span class="s">&quot;*id&quot;</span>,
            };
 
            <span class="c">// go over the patterns, looking for the first match</span>
            <b>foreach</b> (<b>string</b> <span id="r6 rd" class="r6 r">pattern</span> <b>in</b> <span class="r5 r">knownPatterns</span>)
            {
                <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <span id="r7 rd" class="r7 r">ex</span> = <b>new</b> <a href="Mshexpression.cs.html#484c4460dc545619" class="t constructor">PSPropertyExpression</a>(<span class="r6 r">pattern</span>);
                <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt; <span id="r8 rd" class="r8 r">exprList</span> = <span class="r7 r">ex</span>.<a href="Mshexpression.cs.html#b282aad8812891f2" class="i method">ResolveNames</a>(<span class="r2 r">target</span>);
 
                <b>while</b> ((<span class="r8 r">exprList</span>.<span class="i">Count</span> &gt; 0) &amp;&amp; (
                    <span class="r8 r">exprList</span>[0].<span class="i">ToString</span>().<span class="i">Equals</span>(<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#b64ee1a165cf4e4d" class="i field">ComputerNameNoteProperty</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    <span class="r8 r">exprList</span>[0].<span class="i">ToString</span>().<span class="i">Equals</span>(<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#63fb661fa395e3a3" class="i field">ShowComputerNameNoteProperty</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    <span class="r8 r">exprList</span>[0].<span class="i">ToString</span>().<span class="i">Equals</span>(<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#283cde56f2755f0c" class="i field">RunspaceIdNoteProperty</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    <span class="r8 r">exprList</span>[0].<span class="i">ToString</span>().<span class="i">Equals</span>(<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#b6939c85b2591c0c" class="i field">SourceJobInstanceId</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <span class="r8 r">exprList</span>.<span class="i">RemoveAt</span>(0);
                }
 
                <b>if</b> (<span class="r8 r">exprList</span>.<span class="i">Count</span> == 0)
                    <b>continue</b>;
 
                <span class="c">// if more than one match, just return the first one</span>
                <b>return</b> <span class="r8 r">exprList</span>[0];
            }
 
            <span class="c">// we did not find anything</span>
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> It gets the display name value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">target</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Shell object to process.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">expressionFactory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression factory to create PSPropertyExpression.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">PSPropertyExpressionResult if successful; null otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="Mshexpression.cs.html#32098d49a681ff30" class="t t">PSPropertyExpressionResult</a> <a id="1047b2eca39151de" href="../../../R/1047b2eca39151de.html" target="n" data-glyph="74,1" class="i method">GetDisplayName</a>(<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r9 rd" class="r9 r">target</span>, <a href="#ac8b562fd83d9f0f" class="t t">PSPropertyExpressionFactory</a> <span id="r10 rd" class="r10 r">expressionFactory</span>)
        {
            <span class="c">// get the expression to evaluate</span>
            <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <span id="r11 rd" class="r11 r">ex</span> = <a href="#c543a5aa770662b2" class="i method">GetDisplayNameExpression</a>(<span class="r9 r">target</span>, <span class="r10 r">expressionFactory</span>);
            <b>if</b> (<span class="r11 r">ex</span> == <b>null</b>)
                <b>return</b> <b>null</b>;
 
            <span class="c">// evaluate the expression</span>
            <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#32098d49a681ff30" class="t t">PSPropertyExpressionResult</a>&gt; <span id="r12 rd" class="r12 r">resList</span> = <span class="r11 r">ex</span>.<a href="Mshexpression.cs.html#1e7cef19203a999b" class="i method">GetValues</a>(<span class="r9 r">target</span>);
 
            <b>if</b> (<span class="r12 r">resList</span>.<span class="i">Count</span> == 0 || <span class="r12 r">resList</span>[0].<span class="i">Exception</span> != <b>null</b>)
            {
                <span class="c">// no results or the retrieval on the first one failed</span>
                <b>return</b> <b>null</b>;
            }
            <span class="c">// return something only if the first match was successful</span>
            <b>return</b> <span class="r12 r">resList</span>[0];
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is necessary only to consider IDictionaries as IEnumerables, since LanguagePrimitives.GetEnumerable does not.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Object to extract the IEnumerable from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">IEnumerable</span> <a id="a532bab7048287b1" href="../../../R/a532bab7048287b1.html" target="n" data-glyph="74,1" class="i method">GetEnumerable</a>(<b>object</b> <span id="r13 rd" class="r13 r">obj</span>)
        {
            <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r14 rd" class="r14 r">mshObj</span> = <span class="r13 r">obj</span> <b>as</b> <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r14 r">mshObj</span> != <b>null</b>)
            {
                <span class="r13 r">obj</span> = <span class="r14 r">mshObj</span>.<a href="../../../engine/MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
            }
 
            <b>if</b> (<span class="r13 r">obj</span> <b>is</b> <span class="i">IDictionary</span>)
            {
                <b>return</b> (<span class="i">IEnumerable</span>)<span class="r13 r">obj</span>;
            }
 
            <b>return</b> <a href="../../../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../../engine/LanguagePrimitives.cs.html#5489692986d47497" class="i method">GetEnumerable</a>(<span class="r13 r">obj</span>);
        }
 
        <b>private static string</b> <a id="0e0ded2296692a32" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetSmartToStringDisplayName</a>(<b>object</b> <span id="r15 rd" class="r15 r">x</span>, <a href="#ac8b562fd83d9f0f" class="t t">PSPropertyExpressionFactory</a> <span id="r16 rd" class="r16 r">expressionFactory</span>)
        {
            <a href="Mshexpression.cs.html#32098d49a681ff30" class="t t">PSPropertyExpressionResult</a> <span id="r17 rd" class="r17 r">r</span> = <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#1047b2eca39151de" class="i method">GetDisplayName</a>(<a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r15 r">x</span>), <span class="r16 r">expressionFactory</span>);
            <b>if</b> ((<span class="r17 r">r</span> != <b>null</b>) &amp;&amp; (<span class="r17 r">r</span>.<a href="Mshexpression.cs.html#a35b9dec64c079ad" class="i property">Exception</a> == <b>null</b>))
            {
                <b>return</b> <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r17 r">r</span>.<a href="Mshexpression.cs.html#5ffe7f472d198e60" class="i property">Result</a>).<a href="../../../engine/MshObject.cs.html#298666357e641f03" class="i method">ToString</a>();
            }
            <b>else</b>
            {
                <b>return</b> <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r15 r">x</span>).<a href="../../../engine/MshObject.cs.html#298666357e641f03" class="i method">ToString</a>();
            }
        }
 
        <b>private static string</b> <a id="e900395b0685f8c8" href="../../../R/e900395b0685f8c8.html" target="n" data-glyph="76,1" class="i method">GetObjectName</a>(<b>object</b> <span id="r18 rd" class="r18 r">x</span>, <a href="#ac8b562fd83d9f0f" class="t t">PSPropertyExpressionFactory</a> <span id="r19 rd" class="r19 r">expressionFactory</span>)
        {
            <b>string</b> <span id="r20 rd" class="r20 r">objName</span>;
 
            <span class="c">// check if the underlying object is of primitive type</span>
            <span class="c">// if so just return its value</span>
            <b>if</b> (<span class="r18 r">x</span> <b>is</b> <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp;
                (<a href="../../../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">IsBoolOrSwitchParameterType</span>((((<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)<span class="r18 r">x</span>).<a href="../../../engine/MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>).<span class="i">GetType</span>()) ||
                <a href="../../../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../../engine/LanguagePrimitives.cs.html#e25b1c6d235a82c5" class="i method">IsNumeric</a>(((((<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)<span class="r18 r">x</span>).<a href="../../../engine/MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>).<span class="i">GetType</span>()).<span class="i">GetTypeCode</span>()) ||
                <a href="../../../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../../engine/LanguagePrimitives.cs.html#cf665fbdc4612d9d" class="i method">IsNull</a>(<span class="r18 r">x</span>)))
            {
                <span class="r20 r">objName</span> = <span class="r18 r">x</span>.<span class="i">ToString</span>();
            }
            <b>else</b> <b>if</b> (<span class="r18 r">x</span> == <b>null</b>)
            {
                <span class="c">// use PowerShell&#39;s $null variable to indicate that the value is null...</span>
                <span class="r20 r">objName</span> = <span class="s">&quot;$null&quot;</span>;
            }
            <b>else</b>
            {
                <span class="i">MethodInfo</span> <span id="r21 rd" class="r21 r">toStringMethod</span> = <span class="r18 r">x</span>.<span class="i">GetType</span>().<span class="i">GetMethod</span>(<span class="s">&quot;ToString&quot;</span>, <span class="i">Type</span>.<span class="i">EmptyTypes</span>);
                <span class="c">// TODO:CORECLR double check with CORE CLR that x.GetType() == toStringMethod.ReflectedType</span>
                <span class="c">// Check if the given object &quot;x&quot; implements &quot;toString&quot; method. Do that by comparing &quot;DeclaringType&quot; which &#39;Gets the class that declares this member&#39; and the object type</span>
                <b>if</b> (<span class="r21 r">toStringMethod</span>.<span class="i">DeclaringType</span> == <span class="r18 r">x</span>.<span class="i">GetType</span>())
                {
                    <span class="r20 r">objName</span> = <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r18 r">x</span>).<a href="../../../engine/MshObject.cs.html#298666357e641f03" class="i method">ToString</a>();
                }
                <b>else</b>
                {
                    <a href="Mshexpression.cs.html#32098d49a681ff30" class="t t">PSPropertyExpressionResult</a> <span id="r22 rd" class="r22 r">r</span> = <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#1047b2eca39151de" class="i method">GetDisplayName</a>(<a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r18 r">x</span>), <span class="r19 r">expressionFactory</span>);
                    <b>if</b> ((<span class="r22 r">r</span> != <b>null</b>) &amp;&amp; (<span class="r22 r">r</span>.<a href="Mshexpression.cs.html#a35b9dec64c079ad" class="i property">Exception</a> == <b>null</b>))
                    {
                        <span class="r20 r">objName</span> = <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r22 r">r</span>.<a href="Mshexpression.cs.html#5ffe7f472d198e60" class="i property">Result</a>).<a href="../../../engine/MshObject.cs.html#298666357e641f03" class="i method">ToString</a>();
                    }
                    <b>else</b>
                    {
                        <span class="r20 r">objName</span> = <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r18 r">x</span>).<a href="../../../engine/MshObject.cs.html#298666357e641f03" class="i method">ToString</a>();
                        <b>if</b> (<span class="r20 r">objName</span> == <b>string</b>.<span class="i">Empty</span>)
                        {
                            <b>var</b> <span id="r23 rd" class="r23 r">baseObj</span> = <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../../engine/MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r18 r">x</span>);
                            <b>if</b> (<span class="r23 r">baseObj</span> != <b>null</b>)
                            {
                                <span class="r20 r">objName</span> = <span class="r23 r">baseObj</span>.<span class="i">ToString</span>();
                            }
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r20 r">objName</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper to convert an PSObject into a string</span>
        <span class="c">///</span><span class="c"> It takes into account enumerations (use display name)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">so</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Shell object to process.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">expressionFactory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression factory to create PSPropertyExpression.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">enumerationLimit</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Limit on IEnumerable enumeration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">formatErrorObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Stores errors during string conversion.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">String representation.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="982c120083201153" href="../../../R/982c120083201153.html" target="n" data-glyph="74,1" class="i method">SmartToString</a>(<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r24 rd" class="r24 r">so</span>, <a href="#ac8b562fd83d9f0f" class="t t">PSPropertyExpressionFactory</a> <span id="r25 rd" class="r25 r">expressionFactory</span>, <b>int</b> <span id="r26 rd" class="r26 r">enumerationLimit</span>, <a href="#b2c053e472911f78" class="t t">StringFormatError</a> <span id="r27 rd" class="r27 r">formatErrorObject</span>)
        {
            <b>if</b> (<span class="r24 r">so</span> == <b>null</b>)
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
 
            <b>try</b>
            {
                <span class="i">IEnumerable</span> <span id="r28 rd" class="r28 r">e</span> = <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#a532bab7048287b1" class="i method">GetEnumerable</a>(<span class="r24 r">so</span>);
                <b>if</b> (<span class="r28 r">e</span> != <b>null</b>)
                {
                    <span class="i">StringBuilder</span> <span id="r29 rd" class="r29 r">sb</span> = <b>new</b> <span class="i">StringBuilder</span>();
                    <span class="r29 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;{&#39;</span>);
 
                    <b>bool</b> <span id="r30 rd" class="r30 r">first</span> = <b>true</b>;
                    <b>int</b> <span id="r31 rd" class="r31 r">enumCount</span> = 0;
                    <span class="i">IEnumerator</span> <span id="r32 rd" class="r32 r">enumerator</span> = <span class="r28 r">e</span>.<span class="i">GetEnumerator</span>();
                    <b>if</b> (<span class="r32 r">enumerator</span> != <b>null</b>)
                    {
                        <a href="../../../engine/hostifaces/PSDataCollection.cs.html#f5fb0c031dd75f97" class="t t">IBlockingEnumerator</a>&lt;<b>object</b>&gt; <span id="r33 rd" class="r33 r">be</span> = <span class="r32 r">enumerator</span> <b>as</b> <a href="../../../engine/hostifaces/PSDataCollection.cs.html#f5fb0c031dd75f97" class="t t">IBlockingEnumerator</a>&lt;<b>object</b>&gt;;
                        <b>if</b> (<span class="r33 r">be</span> != <b>null</b>)
                        {
                            <b>while</b> (<span class="r33 r">be</span>.<a href="../../../engine/hostifaces/PSDataCollection.cs.html#715ce037d075bc7f" class="i method">MoveNext</a>(<b>false</b>))
                            {
                                <b>if</b> (<a href="../../../engine/hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../../engine/hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>().<a href="../../../engine/ExecutionContext.cs.html#bc7d7c4d79ef05e4" class="i property">CurrentPipelineStopping</a>)
                                {
                                    <b>throw</b> <b>new</b> <a href="../../../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                                }
 
                                <b>if</b> (<span class="r26 r">enumerationLimit</span> &gt;= 0)
                                {
                                    <b>if</b> (<span class="r31 r">enumCount</span> == <span class="r26 r">enumerationLimit</span>)
                                    {
                                        <span class="r29 r">sb</span>.<span class="i">Append</span>(<a href="#a5549bfa35c48a67" class="i field">Ellipsis</a>);
                                        <b>break</b>;
                                    }
 
                                    <span class="r31 r">enumCount</span>++;
                                }
 
                                <b>if</b> (!<span class="r30 r">first</span>)
                                {
                                    <span class="r29 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;, &quot;</span>);
                                }
 
                                <span class="r29 r">sb</span>.<span class="i">Append</span>(<span class="i">GetObjectName</span>(<span class="r33 r">be</span>.<span class="i">Current</span>, <span class="r25 r">expressionFactory</span>));
                                <b>if</b> (<span class="r30 r">first</span>)
                                    <span class="r30 r">first</span> = <b>false</b>;
                            }
                        }
                        <b>else</b>
                        {
                            <b>foreach</b> (<b>object</b> <span id="r34 rd" class="r34 r">x</span> <b>in</b> <span class="r28 r">e</span>)
                            {
                                <b>if</b> (<a href="../../../engine/hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../../engine/hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>().<a href="../../../engine/ExecutionContext.cs.html#bc7d7c4d79ef05e4" class="i property">CurrentPipelineStopping</a>)
                                {
                                    <b>throw</b> <b>new</b> <a href="../../../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                                }
 
                                <b>if</b> (<span class="r26 r">enumerationLimit</span> &gt;= 0)
                                {
                                    <b>if</b> (<span class="r31 r">enumCount</span> == <span class="r26 r">enumerationLimit</span>)
                                    {
                                        <span class="r29 r">sb</span>.<span class="i">Append</span>(<a href="#a5549bfa35c48a67" class="i field">Ellipsis</a>);
                                        <b>break</b>;
                                    }
 
                                    <span class="r31 r">enumCount</span>++;
                                }
 
                                <b>if</b> (!<span class="r30 r">first</span>)
                                {
                                    <span class="r29 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;, &quot;</span>);
                                }
 
                                <span class="r29 r">sb</span>.<span class="i">Append</span>(<a href="#e900395b0685f8c8" class="i method">GetObjectName</a>(<span class="r34 r">x</span>, <span class="r25 r">expressionFactory</span>));
                                <b>if</b> (<span class="r30 r">first</span>)
                                    <span class="r30 r">first</span> = <b>false</b>;
                            }
                        }
                    }
 
                    <span class="r29 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;}&#39;</span>);
                    <b>return</b> <span class="r29 r">sb</span>.<span class="i">ToString</span>();
                }
 
                <span class="c">// take care of the case there is no base object</span>
                <b>return</b> <span class="r24 r">so</span>.<a href="../../../engine/MshObject.cs.html#298666357e641f03" class="i method">ToString</a>();
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r35 rd" class="r35 r">e</span>) <b>when</b> (<span class="r35 r">e</span> <b>is</b> <a href="../../../engine/ExtendedTypeSystemException.cs.html#288b83424f7afe8b" class="t t">ExtendedTypeSystemException</a> || <span class="r35 r">e</span> <b>is</b> <span class="i">InvalidOperationException</span>)
            {
                <span class="c">// These exceptions are being caught and handled by returning an empty string when</span>
                <span class="c">// the object cannot be stringified due to ETS or an instance in the collection has been modified</span>
                <a href="#564da872db5d246c" class="i field">s_tracer</a>.<a href="../../../utils/StructuredTraceSource.cs.html#906bc47eb55bba45" class="i method">TraceWarning</a>(<span class="s">$&quot;</span><span class="s">SmartToString method: Exception during conversion to string, emitting empty string: </span>{<span class="r35 r">e</span>.<span class="i">Message</span>}<span class="s">&quot;</span>);
 
                <b>if</b> (<span class="r27 r">formatErrorObject</span> != <b>null</b>)
                {
                    <span class="r27 r">formatErrorObject</span>.<a href="#953f8cc5addb2241" class="i field">sourceObject</a> = <span class="r24 r">so</span>;
                    <span class="r27 r">formatErrorObject</span>.<a href="#f4c78e3b4f174ffb" class="i field">exception</a> = <span class="r35 r">e</span>;
                }
 
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
        }
 
        <b>private static readonly</b> <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="1ba66fa5e67c1752" href="../../../R/1ba66fa5e67c1752.html" target="n" data-glyph="46,1" class="i field">s_emptyPSObject</a> = <b>new</b> <span class="t">PSObject</span>(<b>string</b>.<span class="i">Empty</span>);
 
        <b>internal static</b> <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="f46bb6f0d2c46a5c" href="../../../R/f46bb6f0d2c46a5c.html" target="n" data-glyph="74,1" class="i method">AsPSObject</a>(<b>object</b> <span id="r36 rd" class="r36 r">obj</span>)
        {
            <b>return</b> (<span class="r36 r">obj</span> == <b>null</b>) ? <a href="#1ba66fa5e67c1752" class="i field">s_emptyPSObject</a> : <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../../engine/MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r36 r">obj</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Format an object using a provided format string directive.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">directive</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Format directive object to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">val</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Object to format.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">enumerationLimit</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Limit on IEnumerable enumeration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">formatErrorObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Formatting error object, if present.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">expressionFactory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression factory to create PSPropertyExpression.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">String representation.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="e4612b43d245b791" href="../../../R/e4612b43d245b791.html" target="n" data-glyph="74,1" class="i method">FormatField</a>(<a href="../DisplayDatabase/displayDescriptionData.cs.html#94a81ac7165c610e" class="t t">FieldFormattingDirective</a> <span id="r37 rd" class="r37 r">directive</span>, <b>object</b> <span id="r38 rd" class="r38 r">val</span>, <b>int</b> <span id="r39 rd" class="r39 r">enumerationLimit</span>,
            <a href="#b2c053e472911f78" class="t t">StringFormatError</a> <span id="r40 rd" class="r40 r">formatErrorObject</span>, <a href="#ac8b562fd83d9f0f" class="t t">PSPropertyExpressionFactory</a> <span id="r41 rd" class="r41 r">expressionFactory</span>)
        {
            <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r42 rd" class="r42 r">so</span> = <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#f46bb6f0d2c46a5c" class="i method">AsPSObject</a>(<span class="r38 r">val</span>);
            <b>if</b> (<span class="r37 r">directive</span> != <b>null</b> &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r37 r">directive</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#3f9e1708749d83d3" class="i field">formatString</a>))
            {
                <span class="c">// we have a formatting directive, apply it</span>
                <span class="c">// NOTE: with a format directive, we do not make any attempt</span>
                <span class="c">// to deal with IEnumerable</span>
                <b>try</b>
                {
                    <span class="c">// use some heuristics to determine if we have &quot;composite formatting&quot;</span>
                    <span class="c">// 2004/11/16-JonN This is heuristic but should be safe enough</span>
                    <b>if</b> (<span class="r37 r">directive</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#3f9e1708749d83d3" class="i field">formatString</a>.<span class="i">Contains</span>(<span class="s">&quot;{0&quot;</span>) || <span class="r37 r">directive</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#3f9e1708749d83d3" class="i field">formatString</a>.<span class="i">Contains</span>(<span class="s">&#39;}&#39;</span>))
                    {
                        <span class="c">// we do have it, just use it</span>
                        <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="r37 r">directive</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#3f9e1708749d83d3" class="i field">formatString</a>, <span class="r42 r">so</span>);
                    }
                    <span class="c">// we fall back to the PSObject&#39;s IFormattable.ToString()</span>
                    <span class="c">// pass a null IFormatProvider</span>
                    <b>return</b> <span class="r42 r">so</span>.<a href="../../../engine/MshObject.cs.html#833d606fcbc0c908" class="i method">ToString</a>(<span class="r37 r">directive</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#3f9e1708749d83d3" class="i field">formatString</a>, <b>null</b>);
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r43 rd" class="r43 r">e</span>) <span class="c">// 2004/11/17-JonN This covers exceptions thrown in</span>
                                    <span class="c">// string.Format and PSObject.ToString().</span>
                                    <span class="c">// I think we can swallow these.</span>
                {
                    <span class="c">// NOTE: we catch all the exceptions, since we do not know</span>
                    <span class="c">// what the underlying object access would throw</span>
                    <b>if</b> (<span class="r40 r">formatErrorObject</span> != <b>null</b>)
                    {
                        <span class="r40 r">formatErrorObject</span>.<a href="#953f8cc5addb2241" class="i field">sourceObject</a> = <span class="r42 r">so</span>;
                        <span class="r40 r">formatErrorObject</span>.<a href="#f4c78e3b4f174ffb" class="i field">exception</a> = <span class="r43 r">e</span>;
                        <span class="r40 r">formatErrorObject</span>.<a href="#eeb7251b546d4e9f" class="i field">formatString</a> = <span class="r37 r">directive</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#3f9e1708749d83d3" class="i field">formatString</a>;
                        <b>return</b> <b>string</b>.<span class="i">Empty</span>;
                    }
                }
            }
            <span class="c">// we do not have a formatting directive or we failed the formatting (fallback)</span>
            <span class="c">// but we did not report as an error;</span>
            <span class="c">// this call would deal with IEnumerable if the object implements it</span>
            <b>return</b> <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#982c120083201153" class="i method">SmartToString</a>(<span class="r42 r">so</span>, <span class="r41 r">expressionFactory</span>, <span class="r39 r">enumerationLimit</span>, <span class="r40 r">formatErrorObject</span>);
        }
 
        <b>private static</b> <a href="../../../engine/MshMemberInfo.cs.html#c0aa7acbc9a4a567" class="t t">PSMemberSet</a> <a id="5e6e7fb56b839fc8" href="../../../R/5e6e7fb56b839fc8.html" target="n" data-glyph="76,1" class="i method">MaskDeserializedAndGetStandardMembers</a>(<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r44 rd" class="r44 r">so</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r44 r">so</span> != <b>null</b>, <span class="s">&quot;Shell object to process cannot be null&quot;</span>);
            <a href="../../../engine/TypeTable.cs.html#d34ed619706e31fc" class="k">var</a> <span id="r45 rd" class="r45 r">typeNames</span> = <span class="r44 r">so</span>.<a href="../../../engine/MshObject.cs.html#829da48f79891848" class="i property">InternalTypeNames</a>;
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r46 rd" class="r46 r">typeNamesWithoutDeserializedPrefix</span> = <a href="../../../engine/serialization.cs.html#27835b221aec7524" class="t t">Deserializer</a>.<span class="i">MaskDeserializationPrefix</span>(<span class="r45 r">typeNames</span>);
            <b>if</b> (<span class="r46 r">typeNamesWithoutDeserializedPrefix</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="../../../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="t t">TypeTable</a> <span id="r47 rd" class="r47 r">typeTable</span> = <span class="r44 r">so</span>.<a href="../../../engine/MshObject.cs.html#d5f9f98808bbda0e" class="i method">GetTypeTable</a>();
            <b>if</b> (<span class="r47 r">typeTable</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="../../../engine/MshMemberInfo.cs.html#d9b894a5fd752b79" class="t t">PSMemberInfoInternalCollection</a>&lt;<a href="../../../engine/MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt; <span id="r48 rd" class="r48 r">members</span> =
                <span class="r47 r">typeTable</span>.<a href="../../../engine/TypeTable.cs.html#360ddf05c317b5ab" class="i method">GetMembers</a>&lt;<a href="../../../engine/MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<b>new</b> <span class="t">ConsolidatedString</span>(<span class="r46 r">typeNamesWithoutDeserializedPrefix</span>));
            <b>return</b> <span class="r48 r">members</span><a href="../../../engine/MshMemberInfo.cs.html#fe158918a7413959">[</a><a href="../../../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="t t">TypeTable</a>.<a href="../../../engine/TypeTable.cs.html#ddc869cbe4f3534d" class="i field">PSStandardMembers</a>] <b>as</b> <a href="../../../engine/MshMemberInfo.cs.html#c0aa7acbc9a4a567" class="t t">PSMemberSet</a>;
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt; <a id="1d8783ad17ef5756" href="../../../R/1d8783ad17ef5756.html" target="n" data-glyph="76,1" class="i method">GetDefaultPropertySet</a>(<a href="../../../engine/MshMemberInfo.cs.html#c0aa7acbc9a4a567" class="t t">PSMemberSet</a> <span id="r49 rd" class="r49 r">standardMembersSet</span>)
        {
            <b>if</b> (<span class="r49 r">standardMembersSet</span> != <b>null</b>)
            {
                <a href="../../../engine/MshMemberInfo.cs.html#c31cdd74ab6aa669" class="t t">PSPropertySet</a> <span id="r50 rd" class="r50 r">defaultDisplayPropertySet</span> = <span class="r49 r">standardMembersSet</span>.<a href="../../../engine/MshMemberInfo.cs.html#23ba75fd4c58af6c" class="i property">Members</a><a href="../../../engine/MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../../../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="t t">TypeTable</a>.<a href="../../../engine/TypeTable.cs.html#1a92ddfaa6a19f7c" class="i field">DefaultDisplayPropertySet</a>] <b>as</b> <a href="../../../engine/MshMemberInfo.cs.html#c31cdd74ab6aa669" class="t t">PSPropertySet</a>;
                <b>if</b> (<span class="r50 r">defaultDisplayPropertySet</span> != <b>null</b>)
                {
                    <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt; <span id="r51 rd" class="r51 r">retVal</span> = <b>new</b> <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt;();
                    <b>foreach</b> (<b>string</b> <span id="r52 rd" class="r52 r">prop</span> <b>in</b> <span class="r50 r">defaultDisplayPropertySet</span>.<a href="../../../engine/MshMemberInfo.cs.html#0928c39b9a095520" class="i property">ReferencedPropertyNames</a>)
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r52 r">prop</span>))
                        {
                            <span class="r51 r">retVal</span>.<span class="i">Add</span>(<b>new</b> <a href="Mshexpression.cs.html#484c4460dc545619" class="t constructor">PSPropertyExpression</a>(<span class="r52 r">prop</span>));
                        }
                    }
 
                    <b>return</b> <span class="r51 r">retVal</span>;
                }
            }
 
            <b>return</b> <b>new</b> <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt;();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper to retrieve the default property set of a shell object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">so</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Shell object to process.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Resolved expression; empty list if not found.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt; <a id="790e58b6ea611caf" href="../../../R/790e58b6ea611caf.html" target="n" data-glyph="74,1" class="i method">GetDefaultPropertySet</a>(<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r53 rd" class="r53 r">so</span>)
        {
            <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt; <span id="r54 rd" class="r54 r">retVal</span> = <a href="#1d8783ad17ef5756" class="i method">GetDefaultPropertySet</a>(<span class="r53 r">so</span>.<a href="../../../engine/MshObject.cs.html#7f00a096ce2593cb" class="i property">PSStandardMembers</a>);
            <b>if</b> (<span class="r54 r">retVal</span>.<span class="i">Count</span> == 0)
            {
                <span class="r54 r">retVal</span> = <a href="#1d8783ad17ef5756" class="i method">GetDefaultPropertySet</a>(<a href="#5e6e7fb56b839fc8" class="i method">MaskDeserializedAndGetStandardMembers</a>(<span class="r53 r">so</span>));
            }
 
            <b>return</b> <span class="r54 r">retVal</span>;
        }
 
        <b>private static</b> <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <a id="d2a451104b08e357" href="../../../R/d2a451104b08e357.html" target="n" data-glyph="76,1" class="i method">GetDefaultNameExpression</a>(<a href="../../../engine/MshMemberInfo.cs.html#c0aa7acbc9a4a567" class="t t">PSMemberSet</a> <span id="r55 rd" class="r55 r">standardMembersSet</span>)
        {
            <b>if</b> (<span class="r55 r">standardMembersSet</span> != <b>null</b>)
            {
                <a href="../../../engine/MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a> <span id="r56 rd" class="r56 r">defaultDisplayProperty</span> = <span class="r55 r">standardMembersSet</span>.<a href="../../../engine/MshMemberInfo.cs.html#23ba75fd4c58af6c" class="i property">Members</a><a href="../../../engine/MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../../../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="t t">TypeTable</a>.<a href="../../../engine/TypeTable.cs.html#a3dca65105033cbc" class="i field">DefaultDisplayProperty</a>] <b>as</b> <a href="../../../engine/MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>;
                <b>if</b> (<span class="r56 r">defaultDisplayProperty</span> != <b>null</b>)
                {
                    <b>string</b> <span id="r57 rd" class="r57 r">expressionString</span> = <span class="r56 r">defaultDisplayProperty</span>.<a href="../../../engine/MshMemberInfo.cs.html#0426306a39cc419e" class="i property">Value</a>.<span class="i">ToString</span>();
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r57 r">expressionString</span>))
                    {
                        <span class="c">// invalid data, the PSObject is empty</span>
                        <b>return</b> <b>null</b>;
                    }
                    <b>else</b>
                    {
                        <b>return</b> <b>new</b> <a href="Mshexpression.cs.html#484c4460dc545619" class="t constructor">PSPropertyExpression</a>(<span class="r57 r">expressionString</span>);
                    }
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private static</b> <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <a id="adb9170b24c32bdd" href="../../../R/adb9170b24c32bdd.html" target="n" data-glyph="76,1" class="i method">GetDefaultNameExpression</a>(<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r58 rd" class="r58 r">so</span>)
        {
            <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <span id="r59 rd" class="r59 r">retVal</span> = <a href="#d2a451104b08e357" class="i method">GetDefaultNameExpression</a>(<span class="r58 r">so</span>.<a href="../../../engine/MshObject.cs.html#7f00a096ce2593cb" class="i property">PSStandardMembers</a>) ??
                                   <a href="#d2a451104b08e357" class="i method">GetDefaultNameExpression</a>(<a href="#5e6e7fb56b839fc8" class="i method">MaskDeserializedAndGetStandardMembers</a>(<span class="r58 r">so</span>));
 
            <b>return</b> <span class="r59 r">retVal</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper to retrieve the value of an PSPropertyExpression and to format it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">so</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Shell object to process.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">enumerationLimit</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Limit on IEnumerable enumeration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">ex</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression to use for retrieval.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">directive</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Format directive to use for formatting.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r64 r">formatErrorObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r65 r">expressionFactory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression factory to create PSPropertyExpression.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">result</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Not null if an error condition arose.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Formatted string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="8821b0cd5983de31" href="../../../R/8821b0cd5983de31.html" target="n" data-glyph="74,1" class="i method">GetExpressionDisplayValue</a>(
            <a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r60 rd" class="r60 r">so</span>,
            <b>int</b> <span id="r61 rd" class="r61 r">enumerationLimit</span>,
            <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <span id="r62 rd" class="r62 r">ex</span>,
            <a href="../DisplayDatabase/displayDescriptionData.cs.html#94a81ac7165c610e" class="t t">FieldFormattingDirective</a> <span id="r63 rd" class="r63 r">directive</span>,
            <a href="#b2c053e472911f78" class="t t">StringFormatError</a> <span id="r64 rd" class="r64 r">formatErrorObject</span>,
            <a href="#ac8b562fd83d9f0f" class="t t">PSPropertyExpressionFactory</a> <span id="r65 rd" class="r65 r">expressionFactory</span>,
            <b>out</b> <a href="Mshexpression.cs.html#32098d49a681ff30" class="t t">PSPropertyExpressionResult</a> <span id="r66 rd" class="r66 r">result</span>)
        {
            <span class="r66 r">result</span> = <b>null</b>;
            <span class="i">List</span>&lt;<a href="Mshexpression.cs.html#32098d49a681ff30" class="t t">PSPropertyExpressionResult</a>&gt; <span id="r67 rd" class="r67 r">resList</span> = <span class="r62 r">ex</span>.<a href="Mshexpression.cs.html#1e7cef19203a999b" class="i method">GetValues</a>(<span class="r60 r">so</span>);
 
            <b>if</b> (<span class="r67 r">resList</span>.<span class="i">Count</span> == 0)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <span class="r66 r">result</span> = <span class="r67 r">resList</span>[0];
            <b>if</b> (<span class="r66 r">result</span>.<a href="Mshexpression.cs.html#a35b9dec64c079ad" class="i property">Exception</a> != <b>null</b>)
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <b>return</b> <a href="#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="#e4612b43d245b791" class="i method">FormatField</a>(<span class="r63 r">directive</span>, <span class="r66 r">result</span>.<a href="Mshexpression.cs.html#5ffe7f472d198e60" class="i property">Result</a>, <span class="r61 r">enumerationLimit</span>, <span class="r64 r">formatErrorObject</span>, <span class="r65 r">expressionFactory</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Queries PSObject and determines if ComputerName property should be shown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">so</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="5b277609e87413fc" href="../../../R/5b277609e87413fc.html" target="n" data-glyph="74,1" class="i method">ShouldShowComputerNameProperty</a>(<a href="../../../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r68 rd" class="r68 r">so</span>)
        {
            <b>bool</b> <span id="r69 rd" class="r69 r">result</span> = <b>false</b>;
            <b>if</b> (<span class="r68 r">so</span> != <b>null</b>)
            {
                <b>try</b>
                {
                    <a href="../../../engine/MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r70 rd" class="r70 r">computerNameProperty</span> = <span class="r68 r">so</span>.<a href="../../../engine/MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../../engine/MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#b64ee1a165cf4e4d" class="i field">ComputerNameNoteProperty</a>];
                    <a href="../../../engine/MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r71 rd" class="r71 r">showComputerNameProperty</span> = <span class="r68 r">so</span>.<a href="../../../engine/MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../../engine/MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../../../engine/remoting/common/WireDataFormat/EncodeAndDecode.cs.html#63fb661fa395e3a3" class="i field">ShowComputerNameNoteProperty</a>];
 
                    <span class="c">// if computer name property exists then this must be a remote object. see</span>
                    <span class="c">// if it can be displayed.</span>
                    <b>if</b> ((<span class="r70 r">computerNameProperty</span> != <b>null</b>) &amp;&amp; (<span class="r71 r">showComputerNameProperty</span> != <b>null</b>))
                    {
                        <a href="../../../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../../engine/LanguagePrimitives.cs.html#0ba3f8cd03b35aee" class="i method">TryConvertTo</a>&lt;<b>bool</b>&gt;(<span class="r71 r">showComputerNameProperty</span>.<a href="../../../engine/MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>, <b>out</b> <span class="r69 r">result</span>);
                    }
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                    <span class="c">// ignore any exceptions thrown retrieving the *ComputerName properties</span>
                    <span class="c">// from the object</span>
                }
                <b>catch</b> (<a href="../../../engine/ExtendedTypeSystemException.cs.html#288b83424f7afe8b" class="t t">ExtendedTypeSystemException</a>)
                {
                    <span class="c">// ignore any exceptions thrown retrieving the *ComputerName properties</span>
                    <span class="c">// from the object</span>
                }
            }
 
            <b>return</b> <span class="r69 r">result</span>;
        }
    }
 
    <b>internal abstract class</b> <a id="6ede2b1afddeca57" href="../../../R/6ede2b1afddeca57.html" target="n" data-glyph="2,0" class="t t"><span id="136bc8465353d0df">FormattingError</span></a>
    {
        <b>internal object</b> <a id="953f8cc5addb2241" href="../../../R/953f8cc5addb2241.html" target="n" data-glyph="44,1" class="i field">sourceObject</a>;
    }
 
    <b>internal sealed class</b> <a id="838c705d30ff70d2" href="../../../R/838c705d30ff70d2.html" target="n" data-glyph="2,0" class="t t"><span id="5a98455fb416ebea">PSPropertyExpressionError</span></a> : <a href="#6ede2b1afddeca57" class="t t">FormattingError</a>
    {
        <b>internal</b> <a href="Mshexpression.cs.html#32098d49a681ff30" class="t t">PSPropertyExpressionResult</a> <a id="978024d49e2568e4" href="../../../R/978024d49e2568e4.html" target="n" data-glyph="44,1" class="i field">result</a>;
    }
 
    <b>internal sealed class</b> <a id="b2c053e472911f78" href="../../../R/b2c053e472911f78.html" target="n" data-glyph="2,0" class="t t"><span id="7735d43dad31528e">StringFormatError</span></a> : <a href="#6ede2b1afddeca57" class="t t">FormattingError</a>
    {
        <b>internal string</b> <a id="eeb7251b546d4e9f" href="../../../R/eeb7251b546d4e9f.html" target="n" data-glyph="44,1" class="i field">formatString</a>;
        <b>internal</b> <span class="i">Exception</span> <a id="f4c78e3b4f174ffb" href="../../../R/f4c78e3b4f174ffb.html" target="n" data-glyph="44,1" class="i field">exception</a>;
    }
 
    <b>internal delegate</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="1b3cea754691c9dd" href="../../../R/../../0000000000.html" target="n" data-glyph="14,0" class="t t"><span id="a01ab21c1bf4329c">CreateScriptBlockFromString</span></a>(<b>string</b> <span id="r72 rd" class="r72 r">scriptBlockString</span>);
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Helper class to create PSPropertyExpression&#39;s from format.ps1xml data structures.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="ac8b562fd83d9f0f" href="../../../R/ac8b562fd83d9f0f.html" target="n" data-glyph="2,0" class="t t"><span id="1a53630809f7f5dc">PSPropertyExpressionFactory</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../../utils/ParserException.cs.html#89a0a90c9fc1219d" class="t t">ParseException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="b42dc4dca2b927f7" href="../../../R/b42dc4dca2b927f7.html" target="n" data-glyph="74,1" class="i method">VerifyScriptBlockText</a>(<b>string</b> <span id="r73 rd" class="r73 r">scriptText</span>)
        {
            <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../../engine/lang/scriptblock.cs.html#adfac0fa7bf5725f" class="i method">Create</a>(<span class="r73 r">scriptText</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create an expression from an expression token.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r74 r">et</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression token to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Constructed expression.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../../utils/ParserException.cs.html#89a0a90c9fc1219d" class="t t">ParseException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <a id="4b53942d44f0a91f" href="../../../R/4b53942d44f0a91f.html" target="n" data-glyph="74,1" class="i method">CreateFromExpressionToken</a>(<a href="../DisplayDatabase/displayDescriptionData.cs.html#82a5bbc134cdede1" class="t t">ExpressionToken</a> <span id="r74 rd" class="r74 r">et</span>)
        {
            <b>return</b> <a href="#7824b14db1a1b446" class="i method">CreateFromExpressionToken</a>(<span class="r74 r">et</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create an expression from an expression token.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">et</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expression token to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">loadingInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The context from which the file was loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Constructed expression.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../../utils/ParserException.cs.html#89a0a90c9fc1219d" class="t t">ParseException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <a id="7824b14db1a1b446" href="../../../R/7824b14db1a1b446.html" target="n" data-glyph="74,1" class="i method">CreateFromExpressionToken</a>(<a href="../DisplayDatabase/displayDescriptionData.cs.html#82a5bbc134cdede1" class="t t">ExpressionToken</a> <span id="r75 rd" class="r75 r">et</span>, <a href="../DisplayDatabase/displayDescriptionData.cs.html#6f18a6e62cd3034a" class="t t">DatabaseLoadingInfo</a> <span id="r76 rd" class="r76 r">loadingInfo</span>)
        {
            <b>if</b> (<span class="r75 r">et</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#0739e14437b19f5a" class="i field">isScriptBlock</a>)
            {
                <span class="c">// we cache script blocks from expression tokens</span>
                <b>if</b> (<a href="#02e4047c0c3a1926" class="i field">_expressionCache</a> != <b>null</b>)
                {
                    <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <span id="r77 rd" class="r77 r">value</span>;
                    <b>if</b> (<a href="#02e4047c0c3a1926" class="i field">_expressionCache</a>.<span class="i">TryGetValue</span>(<span class="r75 r">et</span>, <b>out</b> <span class="r77 r">value</span>))
                    {
                        <span class="c">// got a hit on the cache, just return</span>
                        <b>return</b> <span class="r77 r">value</span>;
                    }
                }
                <b>else</b>
                {
                    <a href="#02e4047c0c3a1926" class="i field">_expressionCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<a href="../DisplayDatabase/displayDescriptionData.cs.html#82a5bbc134cdede1" class="t t">ExpressionToken</a>, <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt;();
                }
 
                <b>bool</b> <span id="r78 rd" class="r78 r">isFullyTrusted</span> = <b>false</b>;
                <b>bool</b> <span id="r79 rd" class="r79 r">isProductCode</span> = <b>false</b>;
                <b>if</b> (<span class="r76 r">loadingInfo</span> != <b>null</b>)
                {
                    <span class="r78 r">isFullyTrusted</span> = <span class="r76 r">loadingInfo</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#ce1a4be78365b0d0" class="i field">isFullyTrusted</a>;
                    <span class="r79 r">isProductCode</span> = <span class="r76 r">loadingInfo</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#cf26a3869e271788" class="i field">isProductCode</a>;
                }
 
                <span class="c">// no hit, we build one and we cache</span>
                <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r80 rd" class="r80 r">sb</span> = <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../../engine/lang/scriptblock.cs.html#5855871887dc8453" class="i method">CreateDelayParsedScriptBlock</a>(<span class="r75 r">et</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#5d00f85462b58293" class="i field">expressionValue</a>, <span class="r81 r">isProductCode</span>: <span class="r79 r">isProductCode</span>);
                <span class="r80 r">sb</span>.<a href="../../../engine/runtime/CompiledScriptBlock.cs.html#28f1dfc28a9bfb01" class="i property">DebuggerStepThrough</a> = <b>true</b>;
 
                <b>if</b> (<span class="r78 r">isFullyTrusted</span>)
                {
                    <span class="r80 r">sb</span>.<a href="../../../engine/lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> = <a href="../../../engine/SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../../engine/SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
                }
 
                <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a> <span id="r82 rd" class="r82 r">ex</span> = <b>new</b> <a href="Mshexpression.cs.html#e84243206b310a17" class="t constructor">PSPropertyExpression</a>(<span class="r80 r">sb</span>);
 
                <a href="#02e4047c0c3a1926" class="i field">_expressionCache</a>.<span class="i">Add</span>(<span class="r75 r">et</span>, <span class="r82 r">ex</span>);
 
                <b>return</b> <span class="r82 r">ex</span>;
            }
 
            <span class="c">// we do not cache if it is just a property name</span>
            <b>return</b> <b>new</b> <a href="Mshexpression.cs.html#484c4460dc545619" class="t constructor">PSPropertyExpression</a>(<span class="r75 r">et</span>.<a href="../DisplayDatabase/displayDescriptionData.cs.html#5d00f85462b58293" class="i field">expressionValue</a>);
        }
 
        <b>private</b> <span class="i">Dictionary</span>&lt;<a href="../DisplayDatabase/displayDescriptionData.cs.html#82a5bbc134cdede1" class="t t">ExpressionToken</a>, <a href="Mshexpression.cs.html#52be71f6c3a4a3d9" class="t t">PSPropertyExpression</a>&gt; <a id="02e4047c0c3a1926" href="../../../R/02e4047c0c3a1926.html" target="n" data-glyph="46,1" class="i field">_expressionCache</a>;
    }
}
</pre></td></tr></table></div></body></html>
