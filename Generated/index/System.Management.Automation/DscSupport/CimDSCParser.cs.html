<!DOCTYPE html>
<html><head><title>CimDSCParser.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(4090);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/DscSupport/CimDSCParser.cs" target="_top">DscSupport\CimDSCParser.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Serialization</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
 
<b>using static</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<a href="../security/SecureStringHelper.cs.html#01b0e2a85ff89895" class="t t">SecureStringHelper</a>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="i n">Internal</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.MSInternal&quot;</span>, <span class="s">&quot;CA903:InternalNamespaceShouldNotContainPublicTypes&quot;</span>,
        <span class="i">Justification</span> = <span class="s">&quot;Needed Internal use only&quot;</span>)]
    <b>public static class</b> <a id="a8c9e9658a9400db" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">DscRemoteOperationsClass</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Convert Cim Instance representing Resource desired state to Powershell Class Object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static object</b> <a id="98e9544360935077" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ConvertCimInstanceToObject</a>(<span class="i">Type</span> <span id="r0 rd" class="r0 r">targetType</span>, <span class="i">CimInstance</span> <span id="r1 rd" class="r1 r">instance</span>, <b>string</b> <span id="r2 rd" class="r2 r">moduleName</span>)
        {
            <b>var</b> <span id="r3 rd" class="r3 r">className</span> = <span class="r1 r">instance</span>.<span class="i">CimClass</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>;
            <b>object</b> <span id="r4 rd" class="r4 r">targetObject</span> = <b>null</b>;
            <b>string</b> <span id="r5 rd" class="r5 r">errorMessage</span>;
 
            <b>using</b> (<span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../engine/hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r6 rd" class="r6 r">powerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../engine/hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../engine/hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../engine/hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../engine/hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>))
            {
                <span class="r6 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#c97f8d15a2f93e31" class="i method">AddScript</a>(<span class="s">&quot;param($targetType,$moduleName) &amp; (Microsoft.PowerShell.Core\\Get-Module $moduleName) { New-Object $targetType } &quot;</span>);
                <span class="r6 r">powerShell</span>.<span class="i">AddArgument</span>(<span class="r0 r">targetType</span>);
                <span class="r6 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#b2931353596991a4" class="i method">AddArgument</a>(<span class="r2 r">moduleName</span>);
 
                <span class="i">Collection</span>&lt;<a href="../engine/MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r7 rd" class="r7 r">psExecutionResult</span> = <span class="r6 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#184e23c46120523e" class="i method">Invoke</a>();
                <b>if</b> (<span class="r7 r">psExecutionResult</span>.<span class="i">Count</span> == 1)
                {
                    <span class="r4 r">targetObject</span> = <span class="r7 r">psExecutionResult</span>[0].<span class="i">BaseObject</span>;
                }
                <b>else</b>
                {
                    <span class="i">Exception</span> <span id="r8 rd" class="r8 r">innerException</span> = <b>null</b>;
                    <b>if</b> (<span class="r6 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../engine/hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a> != <b>null</b> &amp;&amp; <span class="r6 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../engine/hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>.<a href="../engine/hostifaces/PSDataCollection.cs.html#e7cb43bbebbb4aca" class="i property">Count</a> &gt; 0)
                    {
                        <span class="r8 r">innerException</span> = <span class="r6 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../engine/hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>[0].<a href="../engine/ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>;
                    }
 
                    <span class="r5 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">InstantiatePSClassObjectFailed</span>, <span class="r3 r">className</span>);
                    <b>var</b> <span id="r9 rd" class="r9 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r5 r">errorMessage</span>, <span class="r8 r">innerException</span>);
                    <b>throw</b> <span class="r9 r">invalidOperationException</span>;
                }
            }
 
            <b>foreach</b> (<b>var</b> <span id="r10 rd" class="r10 r">property</span> <b>in</b> <span class="r1 r">instance</span>.<span class="i">CimInstanceProperties</span>)
            {
                <b>if</b> (<span class="r10 r">property</span>.<span class="i">Value</span> != <b>null</b>)
                {
                    <span class="i">MemberInfo</span>[] <span id="r11 rd" class="r11 r">memberInfo</span> = <span class="r0 r">targetType</span>.<span class="i">GetMember</span>(<span class="r10 r">property</span>.<span class="i">Name</span>, <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>);
 
                    <span class="c">// verify property exists in corresponding class type</span>
                    <b>if</b> (<span class="r11 r">memberInfo</span> == <b>null</b>
                        || <span class="r11 r">memberInfo</span>.<span class="i">Length</span> &gt; 1
                        || (<span class="r11 r">memberInfo</span>[0] <b>is not</b> <span class="i">PropertyInfo</span> &amp;&amp; <span class="r11 r">memberInfo</span>[0] <b>is not</b> <span class="i">FieldInfo</span>))
                    {
                        <span class="r5 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotDeclaredInPSClass</span>, <b>new</b> <b>object</b>[] { <span class="r10 r">property</span>.<span class="i">Name</span>, <span class="r3 r">className</span> });
                        <b>var</b> <span id="r12 rd" class="r12 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r5 r">errorMessage</span>);
                        <b>throw</b> <span class="r12 r">invalidOperationException</span>;
                    }
 
                    <b>var</b> <span id="r13 rd" class="r13 r">member</span> = <span class="r11 r">memberInfo</span>[0];
                    <b>var</b> <span id="r14 rd" class="r14 r">memberType</span> = (<span class="r13 r">member</span> <b>is</b> <span class="i">FieldInfo</span>)
                        ? ((<span class="i">FieldInfo</span>)<span class="r13 r">member</span>).<span class="i">FieldType</span>
                        : ((<span class="i">PropertyInfo</span>)<span class="r13 r">member</span>).<span class="i">PropertyType</span>;
 
                    <b>object</b> <span id="r15 rd" class="r15 r">targetValue</span> = <b>null</b>;
                    <b>switch</b> (<span class="r10 r">property</span>.<span class="i">CimType</span>)
                    {
                        <b>case</b> <span class="i">CimType</span>.<span class="i">Instance</span>:
                            {
                                <b>var</b> <span id="r16 rd" class="r16 r">cimPropertyInstance</span> = <span class="r10 r">property</span>.<span class="i">Value</span> <b>as</b> <span class="i">CimInstance</span>;
                                <b>if</b> (<span class="r16 r">cimPropertyInstance</span> != <b>null</b> &amp;&amp;
                                    <span class="r16 r">cimPropertyInstance</span>.<span class="i">CimClass</span> != <b>null</b> &amp;&amp;
                                    <span class="r16 r">cimPropertyInstance</span>.<span class="i">CimClass</span>.<span class="i">CimSystemProperties</span> != <b>null</b> &amp;&amp;
                                    <b>string</b>.<span class="i">Equals</span>(
                                        <span class="r16 r">cimPropertyInstance</span>.<span class="i">CimClass</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>,
                                        <span class="s">&quot;MSFT_Credential&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                {
                                    <span class="r15 r">targetValue</span> = <a href="#a9e2c4e6ef199a52" class="i method">ConvertCimInstancePsCredential</a>(<span class="r2 r">moduleName</span>, <span class="r16 r">cimPropertyInstance</span>);
                                }
                                <b>else</b>
                                {
                                    <span class="r15 r">targetValue</span> = <span class="i">ConvertCimInstanceToObject</span>(<span class="r14 r">memberType</span>, <span class="r16 r">cimPropertyInstance</span>, <span class="r2 r">moduleName</span>);
                                }
 
                                <b>if</b> (<span class="r15 r">targetValue</span> == <b>null</b>)
                                {
                                    <b>return</b> <b>null</b>;
                                }
                            }
 
                            <b>break</b>;
                        <b>case</b> <span class="i">CimType</span>.<span class="i">InstanceArray</span>:
                            {
                                <b>if</b> (<span class="r14 r">memberType</span> == <b>typeof</b>(<span class="i">Hashtable</span>))
                                {
                                    <span class="r15 r">targetValue</span> = <a href="#b3108a1657c92259" class="i method">ConvertCimInstanceHashtable</a>(<span class="r2 r">moduleName</span>, (<span class="i">CimInstance</span>[])<span class="r10 r">property</span>.<span class="i">Value</span>);
                                }
                                <b>else</b>
                                {
                                    <b>var</b> <span id="r17 rd" class="r17 r">instanceArray</span> = (<span class="i">CimInstance</span>[])<span class="r10 r">property</span>.<span class="i">Value</span>;
                                    <b>if</b> (!<span class="r14 r">memberType</span>.<span class="i">IsArray</span>)
                                    {
                                        <span class="r5 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ExpectArrayTypeOfPropertyInPSClass</span>, <b>new</b> <b>object</b>[] { <span class="r10 r">property</span>.<span class="i">Name</span>, <span class="r3 r">className</span> });
                                        <b>var</b> <span id="r18 rd" class="r18 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r5 r">errorMessage</span>);
                                        <b>throw</b> <span class="r18 r">invalidOperationException</span>;
                                    }
 
                                    <b>var</b> <span id="r19 rd" class="r19 r">elementType</span> = <span class="r14 r">memberType</span>.<span class="i">GetElementType</span>();
                                    <b>var</b> <span id="r20 rd" class="r20 r">targetArray</span> = <span class="i">Array</span>.<span class="i">CreateInstance</span>(<span class="r19 r">elementType</span>, <span class="r17 r">instanceArray</span>.<span class="i">Length</span>);
                                    <b>for</b> (<b>int</b> <span id="r21 rd" class="r21 r">i</span> = 0; <span class="r21 r">i</span> &lt; <span class="r17 r">instanceArray</span>.<span class="i">Length</span>; <span class="r21 r">i</span>++)
                                    {
                                        <b>var</b> <span id="r22 rd" class="r22 r">obj</span> = <span class="i">ConvertCimInstanceToObject</span>(<span class="r19 r">elementType</span>, <span class="r17 r">instanceArray</span>[<span class="r21 r">i</span>], <span class="r2 r">moduleName</span>);
                                        <b>if</b> (<span class="r22 r">obj</span> == <b>null</b>)
                                        {
                                            <b>return</b> <b>null</b>;
                                        }
 
                                        <span class="r20 r">targetArray</span>.<span class="i">SetValue</span>(<span class="r22 r">obj</span>, <span class="r21 r">i</span>);
                                    }
 
                                    <span class="r15 r">targetValue</span> = <span class="r20 r">targetArray</span>;
                                }
                            }
 
                            <b>break</b>;
                        <b>default</b>:
                            <span class="r15 r">targetValue</span> = <a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r10 r">property</span>.<span class="i">Value</span>, <span class="r14 r">memberType</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                            <b>break</b>;
                    }
 
                    <b>if</b> (<span class="r15 r">targetValue</span> == <b>null</b>)
                    {
                        <span class="r5 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ConvertCimPropertyToObjectPropertyFailed</span>, <b>new</b> <b>object</b>[] { <span class="r10 r">property</span>.<span class="i">Name</span>, <span class="r3 r">className</span> });
                        <b>var</b> <span id="r23 rd" class="r23 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r5 r">errorMessage</span>);
                        <b>throw</b> <span class="r23 r">invalidOperationException</span>;
                    }
 
                    <b>if</b> (<span class="r13 r">member</span> <b>is</b> <span class="i">FieldInfo</span>)
                    {
                        ((<span class="i">FieldInfo</span>)<span class="r13 r">member</span>).<span class="i">SetValue</span>(<span class="r4 r">targetObject</span>, <span class="r15 r">targetValue</span>);
                    }
 
                    <b>if</b> (<span class="r13 r">member</span> <b>is</b> <span class="i">PropertyInfo</span>)
                    {
                        ((<span class="i">PropertyInfo</span>)<span class="r13 r">member</span>).<span class="i">SetValue</span>(<span class="r4 r">targetObject</span>, <span class="r15 r">targetValue</span>);
                    }
                }
            }
 
            <b>return</b> <span class="r4 r">targetObject</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Convert hashtable from Ciminstance to hashtable primitive type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">providerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">arrayInstance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static object</b> <a id="b3108a1657c92259" href="../R/b3108a1657c92259.html" target="n" data-glyph="76,1" class="i method">ConvertCimInstanceHashtable</a>(<b>string</b> <span id="r24 rd" class="r24 r">providerName</span>, <span class="i">CimInstance</span>[] <span id="r25 rd" class="r25 r">arrayInstance</span>)
        {
            <b>var</b> <span id="r26 rd" class="r26 r">result</span> = <b>new</b> <span class="i">Hashtable</span>();
            <b>string</b> <span id="r27 rd" class="r27 r">errorMessage</span>;
 
            <b>try</b>
            {
                <b>foreach</b> (<b>var</b> <span id="r28 rd" class="r28 r">keyValuePair</span> <b>in</b> <span class="r25 r">arrayInstance</span>)
                {
                    <b>var</b> <span id="r29 rd" class="r29 r">key</span> = <span class="r28 r">keyValuePair</span>.<span class="i">CimInstanceProperties</span>[<span class="s">&quot;Key&quot;</span>];
                    <b>var</b> <span id="r30 rd" class="r30 r">value</span> = <span class="r28 r">keyValuePair</span>.<span class="i">CimInstanceProperties</span>[<span class="s">&quot;Value&quot;</span>];
 
                    <b>if</b> (<span class="r29 r">key</span> == <b>null</b> || <span class="r30 r">value</span> == <b>null</b>)
                    {
                        <span class="r27 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidHashtable</span>, <span class="r24 r">providerName</span>);
                        <b>var</b> <span id="r31 rd" class="r31 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r27 r">errorMessage</span>);
                        <b>throw</b> <span class="r31 r">invalidOperationException</span>;
                    }
 
                    <span class="r26 r">result</span>.<span class="i">Add</span>(<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>&lt;<b>string</b>&gt;(<span class="r29 r">key</span>.<span class="i">Value</span>), <a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>&lt;<b>string</b>&gt;(<span class="r30 r">value</span>.<span class="i">Value</span>));
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r32 rd" class="r32 r">exception</span>)
            {
                <span class="r27 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidHashtable</span>, <span class="r24 r">providerName</span>);
                <b>var</b> <span id="r33 rd" class="r33 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r27 r">errorMessage</span>, <span class="r32 r">exception</span>);
                <b>throw</b> <span class="r33 r">invalidOperationException</span>;
            }
 
            <b>return</b> <span class="r26 r">result</span>;
        }
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Convert CIM instance to PS Credential.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">providerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">propertyInstance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static object</b> <a id="a9e2c4e6ef199a52" href="../R/a9e2c4e6ef199a52.html" target="n" data-glyph="76,1" class="i method">ConvertCimInstancePsCredential</a>(<b>string</b> <span id="r34 rd" class="r34 r">providerName</span>, <span class="i">CimInstance</span> <span id="r35 rd" class="r35 r">propertyInstance</span>)
        {
            <b>string</b> <span id="r36 rd" class="r36 r">errorMessage</span>;
            <b>string</b> <span id="r37 rd" class="r37 r">userName</span>;
            <b>string</b> <span id="r38 rd" class="r38 r">plainPassWord</span>;
 
            <b>try</b>
            {
                <span class="r37 r">userName</span> = <span class="r35 r">propertyInstance</span>.<span class="i">CimInstanceProperties</span>[<span class="s">&quot;UserName&quot;</span>].<span class="i">Value</span> <b>as string</b>;
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r37 r">userName</span>))
                {
                    <span class="r36 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidUserName</span>, <span class="r34 r">providerName</span>);
                    <b>var</b> <span id="r39 rd" class="r39 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r36 r">errorMessage</span>);
                    <b>throw</b> <span class="r39 r">invalidOperationException</span>;
                }
            }
            <b>catch</b> (<span class="i">CimException</span> <span id="r40 rd" class="r40 r">exception</span>)
            {
                <span class="r36 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidUserName</span>, <span class="r34 r">providerName</span>);
                <b>var</b> <span id="r41 rd" class="r41 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r36 r">errorMessage</span>, <span class="r40 r">exception</span>);
                <b>throw</b> <span class="r41 r">invalidOperationException</span>;
            }
 
            <b>try</b>
            {
                <span class="r38 r">plainPassWord</span> = <span class="r35 r">propertyInstance</span>.<span class="i">CimInstanceProperties</span>[<span class="s">&quot;PassWord&quot;</span>].<span class="i">Value</span> <b>as string</b>;
 
                <span class="c">// In future we might receive password in an encrypted format. Make sure we add</span>
                <span class="c">// the decryption login in this method.</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r38 r">plainPassWord</span>))
                {
                    <span class="r36 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidPassword</span>, <span class="r34 r">providerName</span>);
                    <b>var</b> <span id="r42 rd" class="r42 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r36 r">errorMessage</span>);
                    <b>throw</b> <span class="r42 r">invalidOperationException</span>;
                }
            }
            <b>catch</b> (<span class="i">CimException</span> <span id="r43 rd" class="r43 r">exception</span>)
            {
                <span class="r36 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidPassword</span>, <span class="r34 r">providerName</span>);
                <b>var</b> <span id="r44 rd" class="r44 r">invalidOperationException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r36 r">errorMessage</span>, <span class="r43 r">exception</span>);
                <b>throw</b> <span class="r44 r">invalidOperationException</span>;
            }
 
            <span class="i">SecureString</span> <span id="r45 rd" class="r45 r">password</span> = <a href="../security/SecureStringHelper.cs.html#01b0e2a85ff89895" class="t t">SecureStringHelper</a>.<a href="../security/SecureStringHelper.cs.html#23f59887f2470e1a" class="i method">FromPlainTextString</a>(<span class="r38 r">plainPassWord</span>);
 
            <span class="r45 r">password</span>.<span class="i">MakeReadOnly</span>();
            <b>return</b> <b>new</b> <a href="../engine/Credential.cs.html#cddcf55c2817657f" class="t constructor">PSCredential</a>(<span class="r37 r">userName</span>, <span class="r45 r">password</span>);
        }
    }
}
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> To make it easier to specify -ConfigurationData parameter, we add an ArgumentTransformationAttribute here.</span>
    <span class="c">///</span><span class="c"> When the input data is of type string and is valid path to a file that can be converted to hashtable, we do</span>
    <span class="c">///</span><span class="c"> the conversion and return the converted value. Otherwise, we just return the input data.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">AttributeUsage</span>(<span class="i">AttributeTargets</span>.<span class="i">Field</span> | <span class="i">AttributeTargets</span>.<span class="i">Property</span> | <span class="i">AttributeTargets</span>.<span class="i">Parameter</span>, <span class="i">AllowMultiple</span> = <b>false</b>)]
    <b>public sealed class</b> <a id="719e5f87cc73872a" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="2902d819c5517967">ArgumentToConfigurationDataTransformationAttribute</span></a> : <a href="../engine/Attributes.cs.html#80472519ecf33cf1" class="t t">ArgumentTransformationAttribute</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Convert a file of ConfigurationData into a hashtable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">engineIntrinsics</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r47 r">inputData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override object</b> <a id="9b2c5ca5ab020abd" href="../R/9b2c5ca5ab020abd.html" target="n" data-glyph="72,1" class="i method">Transform</a>(<a href="../engine/EngineIntrinsics.cs.html#e9f6dd7d61246066" class="t t">EngineIntrinsics</a> <span id="r46 rd" class="r46 r">engineIntrinsics</span>, <b>object</b> <span id="r47 rd" class="r47 r">inputData</span>)
        {
            <b>var</b> <span id="r48 rd" class="r48 r">configDataPath</span> = <span class="r47 r">inputData</span> <b>as string</b>;
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r48 r">configDataPath</span>))
            {
                <b>return</b> <span class="r47 r">inputData</span>;
            }
 
            <b>if</b> (<span class="r46 r">engineIntrinsics</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r46 r">engineIntrinsics</span>));
            }
 
            <b>return</b> <a href="../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../utils/PsUtils.cs.html#565d9c5a2abda2dc" class="i method">EvaluatePowerShellDataFileAsModuleManifest</a>(
                      <span class="s">&quot;ConfigurationData&quot;</span>,
                      <span class="r48 r">configDataPath</span>,
                      <span class="r46 r">engineIntrinsics</span>.<a href="../engine/EngineIntrinsics.cs.html#73254f4142672190" class="i property">SessionState</a>.<a href="../engine/SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../engine/SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>,
                      <span class="r49 r">skipPathValidation</span>: <b>false</b>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Represents a communication channel to a CIM server.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This is the main entry point of the Microsoft.Management.Infrastructure API.</span>
    <span class="c">///</span><span class="c"> All CIM operations are represented as methods of this class.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="99fdd306a0467422" href="../R/99fdd306a0467422.html" target="n" data-glyph="2,0" class="t t">CimDSCParser</a>
    {
        <b>private readonly</b> <span class="i">CimMofDeserializer</span> <a id="bb88104def21d4ae" href="../R/bb88104def21d4ae.html" target="n" data-glyph="46,1" class="i field">_deserializer</a>;
        <b>private readonly</b> <span class="i">CimMofDeserializer</span>.<span class="i">OnClassNeeded</span> <a id="3dbf78726c577b3f" href="../R/3dbf78726c577b3f.html" target="n" data-glyph="46,1" class="i field">_onClassNeeded</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="4dc4219a7734d965" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">CimDSCParser</a>(<span class="i">CimMofDeserializer</span>.<span class="i">OnClassNeeded</span> <span id="r50 rd" class="r50 r">onClassNeeded</span>)
        {
            <a href="#bb88104def21d4ae" class="i field">_deserializer</a> = <span class="i">CimMofDeserializer</span>.<span class="i">Create</span>();
            <a href="#3dbf78726c577b3f" class="i field">_onClassNeeded</a> = <span class="r50 r">onClassNeeded</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="1e30bc26fc627a42" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">CimDSCParser</a>(<span class="i">CimMofDeserializer</span>.<span class="i">OnClassNeeded</span> <span id="r51 rd" class="r51 r">onClassNeeded</span>, <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Serialization</span>.<span class="i">MofDeserializerSchemaValidationOption</span> <span id="r52 rd" class="r52 r">validationOptions</span>)
        {
            <a href="#bb88104def21d4ae" class="i field">_deserializer</a> = <span class="i">CimMofDeserializer</span>.<span class="i">Create</span>();
            <a href="#bb88104def21d4ae" class="i field">_deserializer</a>.<span class="i">SchemaValidationOption</span> = <span class="r52 r">validationOptions</span>;
            <a href="#3dbf78726c577b3f" class="i field">_onClassNeeded</a> = <span class="r51 r">onClassNeeded</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1045:DoNotPassTypesByReference&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;3#&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Have to return 2 things.  Wrapping those 2 things in a class will result in a more, not less complexity&quot;</span>)]
        <b>internal</b> <span class="i">List</span>&lt;<span class="i">CimInstance</span>&gt; <a id="384480aa08466a88" href="../R/384480aa08466a88.html" target="n" data-glyph="74,1" class="i method">ParseInstanceMof</a>(<b>string</b> <span id="r53 rd" class="r53 r">filePath</span>)
        {
            <b>uint</b> <span id="r54 rd" class="r54 r">offset</span> = 0;
            <b>var</b> <span id="r55 rd" class="r55 r">buffer</span> = <a href="#c7bdb9e1135f49d4" class="i method">GetFileContent</a>(<span class="r53 r">filePath</span>);
            <b>try</b>
            {
                <b>var</b> <span id="r56 rd" class="r56 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">CimInstance</span>&gt;(<a href="#bb88104def21d4ae" class="i field">_deserializer</a>.<span class="i">DeserializeInstances</span>(<span class="r55 r">buffer</span>, <b>ref</b> <span class="r54 r">offset</span>, <a href="#3dbf78726c577b3f" class="i field">_onClassNeeded</a>, <b>null</b>));
                <b>return</b> <span class="r56 r">result</span>;
            }
            <b>catch</b> (<span class="i">CimException</span> <span id="r57 rd" class="r57 r">exception</span>)
            {
                <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r58 rd" class="r58 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                    <span class="r57 r">exception</span>, <span class="i">ParserStrings</span>.<span class="i">CimDeserializationError</span>, <span class="r53 r">filePath</span>);
 
                <span class="r58 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;CimDeserializationError&quot;</span>);
                <b>throw</b> <span class="r58 r">e</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Read file content to byte array.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">fullFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static byte</b>[] <a id="c7bdb9e1135f49d4" href="../R/c7bdb9e1135f49d4.html" target="n" data-glyph="74,1" class="i method">GetFileContent</a>(<b>string</b> <span id="r59 rd" class="r59 r">fullFilePath</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r59 r">fullFilePath</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r59 r">fullFilePath</span>));
            }
 
            <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r59 r">fullFilePath</span>))
            {
                <b>var</b> <span id="r60 rd" class="r60 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">FileNotFound</span>, <span class="r59 r">fullFilePath</span>);
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r59 r">fullFilePath</span>), <span class="r60 r">errorMessage</span>);
            }
 
            <b>using</b> (<span class="i">FileStream</span> <span id="r61 rd" class="r61 r">fs</span> = <span class="i">File</span>.<span class="i">OpenRead</span>(<span class="r59 r">fullFilePath</span>))
            {
                <b>var</b> <span id="r62 rd" class="r62 r">bytes</span> = <b>new</b> <b>byte</b>[<span class="r61 r">fs</span>.<span class="i">Length</span>];
                <span class="r61 r">fs</span>.<span class="i">Read</span>(<span class="r62 r">bytes</span>, 0, <span class="i">Convert</span>.<span class="i">ToInt32</span>(<span class="r61 r">fs</span>.<span class="i">Length</span>));
                <b>return</b> <span class="r62 r">bytes</span>;
            }
        }
 
        <b>internal</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <a id="264768f02d5ff0ea" href="../R/264768f02d5ff0ea.html" target="n" data-glyph="74,1" class="i method">ParseSchemaMofFileBuffer</a>(<b>string</b> <span id="r63 rd" class="r63 r">mof</span>)
        {
            <b>uint</b> <span id="r64 rd" class="r64 r">offset</span> = 0;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            // OMI only supports UTF-8 without BOM
            var encoding = new UTF8Encoding(encoderShouldEmitUTF8Identifier: false);
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <span class="c">// This is what we traditionally use with Windows</span>
            <span class="c">// DSC asked to keep it UTF-32 for Windows</span>
            <b>var</b> <span id="r65 rd" class="r65 r">encoding</span> = <b>new</b> <span class="i">UnicodeEncoding</span>();
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
            <b>var</b> <span id="r66 rd" class="r66 r">buffer</span> = <span class="r65 r">encoding</span>.<span class="i">GetBytes</span>(<span class="r63 r">mof</span>);
 
            <b>var</b> <span id="r67 rd" class="r67 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt;(<a href="#bb88104def21d4ae" class="i field">_deserializer</a>.<span class="i">DeserializeClasses</span>(<span class="r66 r">buffer</span>, <b>ref</b> <span class="r64 r">offset</span>, <b>null</b>, <b>null</b>, <b>null</b>, <a href="#3dbf78726c577b3f" class="i field">_onClassNeeded</a>, <b>null</b>));
            <b>return</b> <span class="r67 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1045:DoNotPassTypesByReference&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;3#&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Have to return 2 things.  Wrapping those 2 things in a class will result in a more, not less complexity&quot;</span>)]
        <b>internal</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <a id="a813d06b3db6b7e1" href="../R/a813d06b3db6b7e1.html" target="n" data-glyph="74,1" class="i method">ParseSchemaMof</a>(<b>string</b> <span id="r68 rd" class="r68 r">filePath</span>)
        {
            <b>uint</b> <span id="r69 rd" class="r69 r">offset</span> = 0;
            <b>var</b> <span id="r70 rd" class="r70 r">buffer</span> = <a href="#c7bdb9e1135f49d4" class="i method">GetFileContent</a>(<span class="r68 r">filePath</span>);
            <b>try</b>
            {
                <b>string</b> <span id="r71 rd" class="r71 r">fileNameDefiningClass</span> = <span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r68 r">filePath</span>);
                <b>int</b> <span id="r72 rd" class="r72 r">dotIndex</span> = <span class="r71 r">fileNameDefiningClass</span>.<span class="i">IndexOf</span>(<span class="s">&#39;.&#39;</span>);
                <b>if</b> (<span class="r72 r">dotIndex</span> != -1)
                {
                    <span class="r71 r">fileNameDefiningClass</span> = <span class="r71 r">fileNameDefiningClass</span>.<span class="i">Substring</span>(0, <span class="r72 r">dotIndex</span>);
                }
 
                <b>var</b> <span id="r73 rd" class="r73 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt;(<a href="#bb88104def21d4ae" class="i field">_deserializer</a>.<span class="i">DeserializeClasses</span>(<span class="r70 r">buffer</span>, <b>ref</b> <span class="r69 r">offset</span>, <b>null</b>, <b>null</b>, <b>null</b>, <a href="#3dbf78726c577b3f" class="i field">_onClassNeeded</a>, <b>null</b>));
                <b>foreach</b> (<span class="i">CimClass</span> <span id="r74 rd" class="r74 r">c</span> <b>in</b> <span class="r73 r">result</span>)
                {
                    <b>string</b> <span id="r75 rd" class="r75 r">superClassName</span> = <span class="r74 r">c</span>.<span class="i">CimSuperClassName</span>;
                    <b>string</b> <span id="r76 rd" class="r76 r">className</span> = <span class="r74 r">c</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>;
                    <b>if</b> ((<span class="r75 r">superClassName</span> != <b>null</b>) &amp;&amp; (<span class="r75 r">superClassName</span>.<span class="i">Equals</span>(<span class="s">&quot;OMI_BaseResource&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                    {
                        <span class="c">// Get the name of the file without schema.mof extension</span>
                        <b>if</b> (!(<span class="r76 r">className</span>.<span class="i">Equals</span>(<span class="r71 r">fileNameDefiningClass</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                        {
                            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r77 rd" class="r77 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">ParserStrings</span>.<span class="i">ClassNameNotSameAsDefiningFile</span>, <span class="r76 r">className</span>, <span class="r71 r">fileNameDefiningClass</span>);
                            <b>throw</b> <span class="r77 r">e</span>;
                        }
                    }
                }
 
                <b>return</b> <span class="r73 r">result</span>;
            }
            <b>catch</b> (<span class="i">CimException</span> <span id="r78 rd" class="r78 r">exception</span>)
            {
                <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r79 rd" class="r79 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                    <span class="r78 r">exception</span>, <span class="i">ParserStrings</span>.<span class="i">CimDeserializationError</span>, <span class="r68 r">filePath</span>);
 
                <span class="r79 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;CimDeserializationError&quot;</span>);
                <b>throw</b> <span class="r79 r">e</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Make sure that the instance conforms to the schema.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">classText</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="df7fba73717e44aa" href="../R/df7fba73717e44aa.html" target="n" data-glyph="74,1" class="i method">ValidateInstanceText</a>(<b>string</b> <span id="r80 rd" class="r80 r">classText</span>)
        {
            <b>uint</b> <span id="r81 rd" class="r81 r">offset</span> = 0;
            <b>byte</b>[] <span id="r82 rd" class="r82 r">bytes</span> = <b>null</b>;
 
            <b>if</b> (<a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#99a87a41a4637eed" class="i property">IsLinux</a> || <a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#560f200299e30e2b" class="i property">IsMacOS</a>)
            {
                <span class="r82 r">bytes</span> = <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">Encoding</span>.<span class="i">UTF8</span>.<span class="i">GetBytes</span>(<span class="r80 r">classText</span>);
            }
            <b>else</b>
            {
                <span class="r82 r">bytes</span> = <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">Encoding</span>.<span class="i">Unicode</span>.<span class="i">GetBytes</span>(<span class="r80 r">classText</span>);
            }
 
            <a href="#bb88104def21d4ae" class="i field">_deserializer</a>.<span class="i">DeserializeInstances</span>(<span class="r82 r">bytes</span>, <b>ref</b> <span class="r81 r">offset</span>, <a href="#3dbf78726c577b3f" class="i field">_onClassNeeded</a>, <b>null</b>);
        }
    }
}
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="i n">Internal</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.MSInternal&quot;</span>, <span class="s">&quot;CA903:InternalNamespaceShouldNotContainPublicTypes&quot;</span>,
        <span class="i">Justification</span> = <span class="s">&quot;Needed Internal use only&quot;</span>)]
    <b>internal class</b> <a id="0fec7b2a57438c56" href="../R/0fec7b2a57438c56.html" target="n" data-glyph="2,0" class="t t">DscClassCacheEntry</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Store the RunAs Credentials that this DSC resource will use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a> <a id="c18b033bc9f3fbac" href="../R/c18b033bc9f3fbac.html" target="n" data-glyph="42,1" class="i field">DscResRunAsCred</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If we have implicitly imported this resource, we will set this field to true. This will</span>
        <span class="c">///</span><span class="c"> only happen to InBox resources.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="b3c5fdb1e3e079a1" href="../R/b3c5fdb1e3e079a1.html" target="n" data-glyph="42,1" class="i field">IsImportedImplicitly</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A CimClass instance for this resource.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span> <a id="5892cf2a84ca4067" href="../R/5892cf2a84ca4067.html" target="n" data-glyph="42,1" class="i field">CimClassInstance</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes variables with default values.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="aa78b871c699f92a" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">DscClassCacheEntry</a>() : <a href="#228090f13344ff34" class="k">this</a>(<a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#fa33313e269e6f40" class="i field">Default</a>, <b>false</b>, <b>null</b>) { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes all values.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">aDSCResourceRunAsCredential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">aIsImportedImplicitly</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r85 r">aCimClassInstance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="228090f13344ff34" href="../R/228090f13344ff34.html" target="n" data-glyph="72,1" class="t constructor">DscClassCacheEntry</a>(<a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a> <span id="r83 rd" class="r83 r">aDSCResourceRunAsCredential</span>, <b>bool</b> <span id="r84 rd" class="r84 r">aIsImportedImplicitly</span>, <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span> <span id="r85 rd" class="r85 r">aCimClassInstance</span>)
        {
            <a href="#c18b033bc9f3fbac" class="i field">DscResRunAsCred</a> = <span class="r83 r">aDSCResourceRunAsCredential</span>;
            <a href="#b3c5fdb1e3e079a1" class="i field">IsImportedImplicitly</a> = <span class="r84 r">aIsImportedImplicitly</span>;
            <a href="#5892cf2a84ca4067" class="i field">CimClassInstance</a> = <span class="r85 r">aCimClassInstance</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.MSInternal&quot;</span>, <span class="s">&quot;CA903:InternalNamespaceShouldNotContainPublicTypes&quot;</span>,
        <span class="i">Justification</span> = <span class="s">&quot;Needed Internal use only&quot;</span>)]
    <b>public static class</b> <a id="bfd37d71cb227350" href="../R/bfd37d71cb227350.html" target="n" data-glyph="0,0" class="t t">DscClassCache</a>
    {
        <b>private const string</b> <a id="9b31d9dfa55a6442" href="../R/9b31d9dfa55a6442.html" target="n" data-glyph="10,1" class="i field">InboxDscResourceModulePath</a> = <span class="s">&quot;WindowsPowershell\\v1.0\\Modules\\PsDesiredStateConfiguration&quot;</span>;
        <b>private const string</b> <a id="fea87de65cb6d5e8" href="../R/fea87de65cb6d5e8.html" target="n" data-glyph="10,1" class="i field">reservedDynamicKeywords</a> = <span class="s">&quot;^(Synchronization|Certificate|IIS|SQL)$&quot;</span>;
 
        <b>private const string</b> <a id="3258bd2478d594d5" href="../R/3258bd2478d594d5.html" target="n" data-glyph="10,1" class="i field">reservedProperties</a> = <span class="s">&quot;^(Require|Trigger|Notify|Before|After|Subscribe)$&quot;</span>;
 
        <b>private static readonly</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="1fcd900375683d97" href="../R/1fcd900375683d97.html" target="n" data-glyph="46,1" class="i field">s_tracer</a> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;DSC&quot;</span>, <span class="s">&quot;DSC Class Cache&quot;</span>);
 
        <span class="c">// Constants for items in the module qualified name (Module\Version\ClassName)</span>
        <b>private const int</b> <a id="826cbdcc555fbeee" href="../R/826cbdcc555fbeee.html" target="n" data-glyph="10,1" class="i field">IndexModuleName</a> = 0;
        <b>private const int</b> <a id="0107e770be50f634" href="../R/0107e770be50f634.html" target="n" data-glyph="10,1" class="i field">IndexModuleVersion</a> = 1;
        <b>private const int</b> <a id="cb5c480a05121321" href="../R/cb5c480a05121321.html" target="n" data-glyph="10,1" class="i field">IndexClassName</a> = 2;
        <b>private const int</b> <a id="fbf3cc1944d4ef0d" href="../R/fbf3cc1944d4ef0d.html" target="n" data-glyph="10,1" class="i field">IndexFriendlyName</a> = 3;
 
        <span class="c">// Create a list of classes which are not actual DSC resources similar to what we do inside PSDesiredStateConfiguration.psm1</span>
        <b>private static readonly string</b>[] <a id="2f07a78d9d503a9d" href="../R/2f07a78d9d503a9d.html" target="n" data-glyph="46,1" class="i field">s_hiddenResourceList</a> =
        {
            <span class="s">&quot;MSFT_BaseConfigurationProviderRegistration&quot;</span>,
            <span class="s">&quot;MSFT_CimConfigurationProviderRegistration&quot;</span>,
            <span class="s">&quot;MSFT_PSConfigurationProviderRegistration&quot;</span>,
        };
 
        <span class="c">// Create a HashSet for fast lookup. According to MSDN, the time complexity of search for an element in a HashSet is O(1)</span>
        <b>private static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="fe8128ae5d89e924" href="../R/fe8128ae5d89e924.html" target="n" data-glyph="46,1" class="i field">s_hiddenResourceCache</a> =
            <b>new</b>(<a href="#2f07a78d9d503a9d" class="i field">s_hiddenResourceList</a>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <span class="c">// a collection to hold current importing script based resource file</span>
        <span class="c">// this prevent circular importing case when the script resource existing in the same module with resources it import-dscresource</span>
        <b>private static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="5fa38071fd92c8dc" href="../R/5fa38071fd92c8dc.html" target="n" data-glyph="46,1" class="i field">s_currentImportingScriptFiles</a> = <b>new</b>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> DSC class cache for this runspace.</span>
        <span class="c">///</span><span class="c"> Cache stores the DSCRunAsBehavior, cim class and boolean to indicate if an Inbox resource has been implicitly imported.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt; <a id="33d37dbc421f598c" href="../R/33d37dbc421f598c.html" target="n" data-glyph="106,1" class="i property">ClassCache</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#e26a0ec669945f1b" class="i field">t_classCache</a> == <b>null</b>)
                {
                    <a href="#e26a0ec669945f1b" class="i field">t_classCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                }
 
                <b>return</b> <a href="#e26a0ec669945f1b" class="i field">t_classCache</a>;
            }
        }
 
        [<span class="i">ThreadStatic</span>]
        <b>private static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt; <a id="e26a0ec669945f1b" href="../R/e26a0ec669945f1b.html" target="n" data-glyph="46,1" class="i field">t_classCache</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> DSC classname to source module mapper.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;&gt; <a id="538a786bc32fe440" href="../R/538a786bc32fe440.html" target="n" data-glyph="106,1" class="i property">ByClassModuleCache</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#1848c787c01999b2" class="i field">t_byClassModuleCache</a> == <b>null</b>)
                {
                    <a href="#1848c787c01999b2" class="i field">t_byClassModuleCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                }
 
                <b>return</b> <a href="#1848c787c01999b2" class="i field">t_byClassModuleCache</a>;
            }
        }
 
        [<span class="i">ThreadStatic</span>]
        <b>private static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;&gt; <a id="1848c787c01999b2" href="../R/1848c787c01999b2.html" target="n" data-glyph="46,1" class="i field">t_byClassModuleCache</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> DSC filename to defined class mapper.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span>&gt;&gt; <a id="1981c1bc3c235153" href="../R/1981c1bc3c235153.html" target="n" data-glyph="106,1" class="i property">ByFileClassCache</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#7b0396c0787cc6c5" class="i field">t_byFileClassCache</a> == <b>null</b>)
                {
                    <a href="#7b0396c0787cc6c5" class="i field">t_byFileClassCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span>&gt;&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                }
 
                <b>return</b> <a href="#7b0396c0787cc6c5" class="i field">t_byFileClassCache</a>;
            }
        }
 
        [<span class="i">ThreadStatic</span>]
        <b>private static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span>&gt;&gt; <a id="7b0396c0787cc6c5" href="../R/7b0396c0787cc6c5.html" target="n" data-glyph="46,1" class="i field">t_byFileClassCache</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Filenames from which we have imported script dynamic keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="83670b5df3e7c7e4" href="../R/83670b5df3e7c7e4.html" target="n" data-glyph="106,1" class="i property">ScriptKeywordFileCache</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#d0ac27e82fa003f9" class="i field">t_scriptKeywordFileCache</a> == <b>null</b>)
                {
                    <a href="#d0ac27e82fa003f9" class="i field">t_scriptKeywordFileCache</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                }
 
                <b>return</b> <a href="#d0ac27e82fa003f9" class="i field">t_scriptKeywordFileCache</a>;
            }
        }
 
        [<span class="i">ThreadStatic</span>]
        <b>private static</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="d0ac27e82fa003f9" href="../R/d0ac27e82fa003f9.html" target="n" data-glyph="46,1" class="i field">t_scriptKeywordFileCache</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default ModuleName and ModuleVersion to use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static readonly</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt; <a id="a453791e14320b7e" href="../R/a453791e14320b7e.html" target="n" data-glyph="46,1" class="i field">s_defaultModuleInfoForResource</a> =
            <b>new</b>(<span class="s">&quot;PSDesiredStateConfiguration&quot;</span>, <b>new</b> <span class="i">Version</span>(<span class="s">&quot;1.1&quot;</span>));
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default ModuleName and ModuleVersion to use for meta configuration resources.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static readonly</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt; <a id="2e791b70efb80de3" href="../R/2e791b70efb80de3.html" target="n" data-glyph="44,1" class="i field">DefaultModuleInfoForMetaConfigResource</a> =
            <b>new</b>(<span class="s">&quot;PSDesiredStateConfigurationEngine&quot;</span>, <b>new</b> <span class="i">Version</span>(<span class="s">&quot;2.0&quot;</span>));
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A set of dynamic keywords that can be used in both configuration and meta configuration.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="e2f03a2c829bbdce" href="../R/e2f03a2c829bbdce.html" target="n" data-glyph="44,1" class="i field">SystemResourceNames</a> =
            <b>new</b>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>) { <span class="s">&quot;Node&quot;</span>, <span class="s">&quot;OMI_ConfigurationDocument&quot;</span> };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When this property is set to true, DSC Cache will cache multiple versions of a resource.</span>
        <span class="c">///</span><span class="c"> That means it will cache duplicate resource classes (class names for a resource in two different module versions are same).</span>
        <span class="c">///</span><span class="c"> NOTE: This property should be set to false for DSC compiler related methods/functionality, such as Import-DscResource,</span>
        <span class="c">///</span><span class="c">       because the Mof serializer does not support deserialization of classes with different versions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">ThreadStatic</span>]
        <b>private static bool</b> <a id="3a0f2ec85d24ea4f" href="../R/3a0f2ec85d24ea4f.html" target="n" data-glyph="46,1" class="i field">t_cacheResourcesFromMultipleModuleVersions</a>;
 
        <b>private static bool</b> <a id="6b8e947cc79979ca" href="../R/6b8e947cc79979ca.html" target="n" data-glyph="106,1" class="i property">CacheResourcesFromMultipleModuleVersions</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3a0f2ec85d24ea4f" class="i field">t_cacheResourcesFromMultipleModuleVersions</a>;
            }
 
            <b>set</b>
            {
                <a href="#3a0f2ec85d24ea4f" class="i field">t_cacheResourcesFromMultipleModuleVersions</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize the class cache with the default classes in $ENV:SystemDirectory\Configuration.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="55887a34a91a7b8f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Initialize</a>()
        {
            <a href="#03b231c6c3dca65e" class="i method">Initialize</a>(<b>null</b>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize the class cache with the default classes in $ENV:SystemDirectory\Configuration.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">errors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Collection of any errors encountered during initialization.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">modulePathList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">List of module path from where DSC PS modules will be loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="03b231c6c3dca65e" href="../R/03b231c6c3dca65e.html" target="n" data-glyph="72,1" class="i method">Initialize</a>(<span class="i">Collection</span>&lt;<span class="i">Exception</span>&gt; <span id="r86 rd" class="r86 r">errors</span>, <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r87 rd" class="r87 r">modulePathList</span>)
        {
            <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;Initializing DSC class cache force={0}&quot;</span>);
 
            <b>if</b> (<a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#99a87a41a4637eed" class="i property">IsLinux</a> || <a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#560f200299e30e2b" class="i property">IsMacOS</a>)
            {
                <span class="c">//</span>
                <span class="c">// Load the base schema files.</span>
                <span class="c">//</span>
                <a href="#6ebe0026b4cda8f1" class="i method">ClearCache</a>();
                <b>var</b> <span id="r88 rd" class="r88 r">dscConfigurationDirectory</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="s">&quot;DSC_HOME&quot;</span>) ??
                                                <span class="s">&quot;/etc/opt/omi/conf/dsc/configuration&quot;</span>;
 
                <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r88 r">dscConfigurationDirectory</span>))
                {
                    <b>throw</b> <b>new</b> <span class="i">DirectoryNotFoundException</span>(<span class="s">&quot;Unable to find DSC schema store at &quot;</span> + <span class="r88 r">dscConfigurationDirectory</span> + <span class="s">&quot;. Please ensure PS DSC for Linux is installed.&quot;</span>);
                }
 
                <b>var</b> <span id="r89 rd" class="r89 r">resourceBaseFile</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r88 r">dscConfigurationDirectory</span>, <span class="s">&quot;BaseRegistration/BaseResource.schema.mof&quot;</span>);
                <span class="i">ImportClasses</span>(<span class="r89 r">resourceBaseFile</span>, <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>, <span class="r86 r">errors</span>);
 
                <b>var</b> <span id="r90 rd" class="r90 r">metaConfigFile</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r88 r">dscConfigurationDirectory</span>, <span class="s">&quot;BaseRegistration/MSFT_DSCMetaConfiguration.mof&quot;</span>);
                <span class="i">ImportClasses</span>(<span class="r90 r">metaConfigFile</span>, <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>, <span class="r86 r">errors</span>);
 
                <b>var</b> <span id="r91 rd" class="r91 r">allResourceRoots</span> = <b>new</b> <b>string</b>[] { <span class="r88 r">dscConfigurationDirectory</span> };
 
                <span class="c">//</span>
                <span class="c">// Load all of the system resource schema files, searching</span>
                <span class="c">//</span>
                <b>string</b> <span id="r92 rd" class="r92 r">resources</span>;
                <b>foreach</b> (<b>var</b> <span id="r93 rd" class="r93 r">resourceRoot</span> <b>in</b> <span class="r91 r">allResourceRoots</span>)
                {
                    <span class="r92 r">resources</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r93 r">resourceRoot</span>, <span class="s">&quot;schema&quot;</span>);
                    <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r92 r">resources</span>))
                    {
                        <b>continue</b>;
                    }
 
                    <b>foreach</b> (<b>var</b> <span id="r94 rd" class="r94 r">schemaFile</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateDirectories</span>(<span class="r92 r">resources</span>).<span class="i">SelectMany</span>(<b>static</b> <span id="r95 rd" class="r95 r">d</span> =&gt; <span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<span class="r95 r">d</span>, <span class="s">&quot;*.schema.mof&quot;</span>)))
                    {
                        <span class="i">ImportClasses</span>(<span class="r94 r">schemaFile</span>, <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>, <span class="r86 r">errors</span>);
                    }
                }
 
                <span class="c">// Linux DSC Modules are installed to the dscConfigurationDirectory, so no need to load them.</span>
            }
            <b>else</b>
            {
                <span class="c">// DSC SxS scenario</span>
                <b>var</b> <span id="r96 rd" class="r96 r">configSystemPath</span> = <a href="../engine/Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../engine/Utils.cs.html#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>;
                <b>var</b> <span id="r97 rd" class="r97 r">systemResourceRoot</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r96 r">configSystemPath</span>, <span class="s">&quot;Configuration&quot;</span>);
                <b>var</b> <span id="r98 rd" class="r98 r">inboxModulePath</span> = <span class="s">&quot;Modules\\PSDesiredStateConfiguration&quot;</span>;
 
                <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r97 r">systemResourceRoot</span>))
                {
                    <span class="r96 r">configSystemPath</span> = <a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">System</span>);
                    <span class="r97 r">systemResourceRoot</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r96 r">configSystemPath</span>, <span class="s">&quot;Configuration&quot;</span>);
                    <span class="r98 r">inboxModulePath</span> = <a href="#9b31d9dfa55a6442" class="i field">InboxDscResourceModulePath</a>;
                }
 
                <b>var</b> <span id="r99 rd" class="r99 r">programFilesDirectory</span> = <a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">ProgramFiles</span>);
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r99 r">programFilesDirectory</span> != <b>null</b>, <span class="s">&quot;Program Files environment variable does not exist!&quot;</span>);
                <b>var</b> <span id="r100 rd" class="r100 r">customResourceRoot</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r99 r">programFilesDirectory</span>, <span class="s">&quot;WindowsPowerShell\\Configuration&quot;</span>);
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r100 r">customResourceRoot</span>), <span class="s">&quot;%ProgramFiles%\\WindowsPowerShell\\Configuration Directory does not exist&quot;</span>);
                <b>var</b> <span id="r101 rd" class="r101 r">allResourceRoots</span> = <b>new</b> <b>string</b>[] { <span class="r97 r">systemResourceRoot</span>, <span class="r100 r">customResourceRoot</span> };
                <span class="c">//</span>
                <span class="c">// Load the base schema files.</span>
                <span class="c">//</span>
                <a href="#6ebe0026b4cda8f1" class="i method">ClearCache</a>();
                <b>var</b> <span id="r102 rd" class="r102 r">resourceBaseFile</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r97 r">systemResourceRoot</span>, <span class="s">&quot;BaseRegistration\\BaseResource.schema.mof&quot;</span>);
                <span class="i">ImportClasses</span>(<span class="r102 r">resourceBaseFile</span>, <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>, <span class="r86 r">errors</span>);
 
                <b>var</b> <span id="r103 rd" class="r103 r">metaConfigFile</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r97 r">systemResourceRoot</span>, <span class="s">&quot;BaseRegistration\\MSFT_DSCMetaConfiguration.mof&quot;</span>);
                <span class="i">ImportClasses</span>(<span class="r103 r">metaConfigFile</span>, <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>, <span class="r86 r">errors</span>);
 
                <b>var</b> <span id="r104 rd" class="r104 r">metaConfigExtensionFile</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r97 r">systemResourceRoot</span>, <span class="s">&quot;BaseRegistration\\MSFT_MetaConfigurationExtensionClasses.schema.mof&quot;</span>);
                <span class="i">ImportClasses</span>(<span class="r104 r">metaConfigExtensionFile</span>, <a href="#2e791b70efb80de3" class="i field">DefaultModuleInfoForMetaConfigResource</a>, <span class="r86 r">errors</span>);
 
                <span class="c">//</span>
                <span class="c">// Load all of the system resource schema files, searching</span>
                <span class="c">//</span>
                <b>string</b> <span id="r105 rd" class="r105 r">resources</span>;
                <b>foreach</b> (<b>var</b> <span id="r106 rd" class="r106 r">resourceRoot</span> <b>in</b> <span class="r101 r">allResourceRoots</span>)
                {
                    <span class="r105 r">resources</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r106 r">resourceRoot</span>, <span class="s">&quot;Schema&quot;</span>);
                    <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r105 r">resources</span>))
                    {
                        <b>continue</b>;
                    }
 
                    <b>foreach</b> (<b>var</b> <span id="r107 rd" class="r107 r">schemaFile</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateDirectories</span>(<span class="r105 r">resources</span>).<span class="i">SelectMany</span>(<b>static</b> <span id="r108 rd" class="r108 r">d</span> =&gt; <span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<span class="r108 r">d</span>, <span class="s">&quot;*.schema.mof&quot;</span>)))
                    {
                        <span class="i">ImportClasses</span>(<span class="r107 r">schemaFile</span>, <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>, <span class="r86 r">errors</span>);
                    }
                }
 
                <span class="c">// Load Regular and DSC PS modules</span>
                <b>bool</b> <span id="r109 rd" class="r109 r">importInBoxResourcesImplicitly</span> = <b>false</b>;
                <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r110 rd" class="r110 r">modulePaths</span> = <b>new</b>();
                <b>if</b> (<span class="r87 r">modulePathList</span> == <b>null</b> || <span class="r87 r">modulePathList</span>.<span class="i">Count</span> == 0)
                {
                    <span class="r110 r">modulePaths</span>.<span class="i">Add</span>(<span class="i">Path</span>.<span class="i">Combine</span>(<span class="r96 r">configSystemPath</span>, <span class="r98 r">inboxModulePath</span>));
                    <span class="r109 r">importInBoxResourcesImplicitly</span> = <b>true</b>;
                }
                <b>else</b>
                {
                    <b>foreach</b> (<b>string</b> <span id="r111 rd" class="r111 r">moduleFolderPath</span> <b>in</b> <span class="r87 r">modulePathList</span>)
                    {
                        <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r111 r">moduleFolderPath</span>))
                        {
                            <b>continue</b>;
                        }
 
                        <b>foreach</b> (<b>string</b> <span id="r112 rd" class="r112 r">moduleDir</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateDirectories</span>(<span class="r111 r">moduleFolderPath</span>))
                        {
                            <span class="r110 r">modulePaths</span>.<span class="i">Add</span>(<span class="r112 r">moduleDir</span>);
                        }
                    }
                }
 
                <a href="#26ba941e034f6562" class="i method">LoadDSCResourceIntoCache</a>(<span class="r86 r">errors</span>, <span class="r110 r">modulePaths</span>, <span class="r109 r">importInBoxResourcesImplicitly</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load DSC resources into Cache from moduleFolderPath.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">errors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Collection of any errors encountered during initialization.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">modulePathList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Module path from where DSC PS modules will be loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r115 r">importInBoxResourcesImplicitly</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if module is inbox.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="26ba941e034f6562" href="../R/26ba941e034f6562.html" target="n" data-glyph="76,1" class="i method">LoadDSCResourceIntoCache</a>(<span class="i">Collection</span>&lt;<span class="i">Exception</span>&gt; <span id="r113 rd" class="r113 r">errors</span>, <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r114 rd" class="r114 r">modulePathList</span>, <b>bool</b> <span id="r115 rd" class="r115 r">importInBoxResourcesImplicitly</span>)
        {
            <b>foreach</b> (<b>string</b> <span id="r116 rd" class="r116 r">moduleDir</span> <b>in</b> <span class="r114 r">modulePathList</span>)
            {
                <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r116 r">moduleDir</span>)) <b>continue</b>;
 
                <b>var</b> <span id="r117 rd" class="r117 r">dscResourcesPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r116 r">moduleDir</span>, <span class="s">&quot;DscResources&quot;</span>);
                <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r117 r">dscResourcesPath</span>))
                {
                    <b>foreach</b> (<b>string</b> <span id="r118 rd" class="r118 r">resourceDir</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateDirectories</span>(<span class="r117 r">dscResourcesPath</span>))
                    {
                        <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r119 rd" class="r119 r">schemaFiles</span> = <span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<span class="r118 r">resourceDir</span>, <span class="s">&quot;*.schema.mof&quot;</span>);
                        <b>if</b> (!<span class="r119 r">schemaFiles</span>.<span class="i">Any</span>())
                        {
                            <b>continue</b>;
                        }
 
                        <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt; <span id="r120 rd" class="r120 r">moduleInfo</span> = <a href="#9e3f55025eb4968a" class="i method">GetModuleInfoHelper</a>(<span class="r116 r">moduleDir</span>, <span class="r115 r">importInBoxResourcesImplicitly</span>, <span class="r121 r">isPsProviderModule</span>: <b>false</b>);
                        <b>if</b> (<span class="r120 r">moduleInfo</span> == <b>null</b>)
                        {
                            <b>continue</b>;
                        }
 
                        <b>foreach</b> (<b>string</b> <span id="r122 rd" class="r122 r">schemaFile</span> <b>in</b> <span class="r119 r">schemaFiles</span>)
                        {
                            <a href="#2e87c4641eccb833" class="i method">ImportClasses</a>(<span class="r122 r">schemaFile</span>, <span class="r120 r">moduleInfo</span>, <span class="r113 r">errors</span>, <span class="r115 r">importInBoxResourcesImplicitly</span>);
                        }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the module name and module version.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r123 r">moduleFolderPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Path to the module folder</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">importInBoxResourcesImplicitly</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> if module is inbox and we are importing resources implicitly</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">isPsProviderModule</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicate a internal DSC module</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt; <a id="9e3f55025eb4968a" href="../R/9e3f55025eb4968a.html" target="n" data-glyph="76,1" class="i method">GetModuleInfoHelper</a>(<b>string</b> <span id="r123 rd" class="r123 r">moduleFolderPath</span>, <b>bool</b> <span id="r124 rd" class="r124 r">importInBoxResourcesImplicitly</span>, <b>bool</b> <span id="r121 rd" class="r121 r">isPsProviderModule</span>)
        {
            <b>string</b> <span id="r125 rd" class="r125 r">moduleName</span> = <span class="s">&quot;PsDesiredStateConfiguration&quot;</span>;
            <b>if</b> (!<span class="r124 r">importInBoxResourcesImplicitly</span>)
            {
                <span class="r125 r">moduleName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r123 r">moduleFolderPath</span>);
            }
 
            <b>string</b> <span id="r126 rd" class="r126 r">manifestPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r123 r">moduleFolderPath</span>, <span class="r125 r">moduleName</span> + <span class="s">&quot;.psd1&quot;</span>);
            <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;DSC GetModuleVersion: Try retrieving module version information from file: {0}.&quot;</span>, <span class="r126 r">manifestPath</span>);
 
            <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r126 r">manifestPath</span>))
            {
                <b>if</b> (<span class="r121 r">isPsProviderModule</span>)
                {
                    <span class="c">// Some internal PSProviders do not come with a .psd1 file, such</span>
                    <span class="c">// as MSFT_LogResource. We don&#39;t report error in this case.</span>
                    <b>return</b> <b>new</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;(<span class="r125 r">moduleName</span>, <b>new</b> <span class="i">Version</span>(<span class="s">&quot;1.0&quot;</span>));
                }
                <b>else</b>
                {
                    <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;DSC GetModuleVersion: Manifest file &#39;{0}&#39; not exist.&quot;</span>, <span class="r126 r">manifestPath</span>);
                    <b>return</b> <b>null</b>;
                }
            }
 
            <b>try</b>
            {
                <span class="i">Hashtable</span> <span id="r127 rd" class="r127 r">dataFileSetting</span> =
                    <a href="../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../utils/PsUtils.cs.html#7c4997ce508c858f" class="i method">GetModuleManifestProperties</a>(
                        <span class="r126 r">manifestPath</span>,
                        <a href="../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../utils/PsUtils.cs.html#6d92135ec8cdd0a6" class="i field">ManifestModuleVersionPropertyName</a>);
 
                <b>object</b> <span id="r128 rd" class="r128 r">versionValue</span> = <span class="r127 r">dataFileSetting</span>[<span class="s">&quot;ModuleVersion&quot;</span>];
                <b>if</b> (<span class="r128 r">versionValue</span> != <b>null</b>)
                {
                    <span class="i">Version</span> <span id="r129 rd" class="r129 r">moduleVersion</span>;
                    <b>if</b> (<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r128 r">versionValue</span>, <b>out</b> <span class="r129 r">moduleVersion</span>))
                    {
                        <b>return</b> <b>new</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;(<span class="r125 r">moduleName</span>, <span class="r129 r">moduleVersion</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(
                            <span class="s">&quot;DSC GetModuleVersion: ModuleVersion value &#39;{0}&#39; cannot be converted to System.Version. Skip the module &#39;{1}&#39;.&quot;</span>,
                            <span class="r128 r">versionValue</span>, <span class="r125 r">moduleName</span>);
                    }
                }
                <b>else</b>
                {
                    <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(
                        <span class="s">&quot;DSC GetModuleVersion: Manifest file &#39;{0}&#39; does not contain ModuleVersion. Skip the module &#39;{1}&#39;.&quot;</span>,
                        <span class="r126 r">manifestPath</span>, <span class="r125 r">moduleName</span>);
                }
            }
            <b>catch</b> (<a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r130 rd" class="r130 r">ex</span>)
            {
                <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ea4adc43a7440f6a" class="i method">WriteLine</a>(
                    <span class="s">&quot;DSC GetModuleVersion: Error evaluating module manifest file &#39;{0}&#39;, with error &#39;{1}&#39;. Skip the module &#39;{2}&#39;.&quot;</span>,
                    <span class="r126 r">manifestPath</span>, <span class="r130 r">ex</span>, <span class="r125 r">moduleName</span>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">// Callback implementation...</span>
        <b>private static</b> <span class="i">CimClass</span> <a id="cdf7b3ebe5ccf095" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">MyClassCallback</a>(<b>string</b> <span id="r131 rd" class="r131 r">serverName</span>, <b>string</b> <span id="r132 rd" class="r132 r">namespaceName</span>, <b>string</b> <span id="r133 rd" class="r133 r">className</span>)
        {
            <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt; <span id="r134 rd" class="r134 r">cimClass</span> <b>in</b> <a href="#33d37dbc421f598c" class="i property">ClassCache</a>)
            {
                <b>string</b> <span id="r135 rd" class="r135 r">cachedClassName</span> = <span class="r134 r">cimClass</span>.<span class="i">Key</span>.<span class="i">Split</span>(<a href="../engine/Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../engine/Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../engine/Utils.cs.html#247bb446a0dd1494" class="i field">Backslash</a>)[<a href="#cb5c480a05121321" class="i field">IndexClassName</a>];
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r135 r">cachedClassName</span>, <span class="r133 r">className</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <span class="r134 r">cimClass</span>.<span class="i">Value</span>.<span class="i">CimClassInstance</span>;
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reads CIM MOF schema file and returns classes defined in it.</span>
        <span class="c">///</span><span class="c"> This is used MOF-&gt;PSClass conversion tool.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r136 r">mofPath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Path to CIM MOF schema file for reading.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of classes from MOF schema file.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <a id="d4ab099114c31efe" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadCimSchemaMof</a>(<b>string</b> <span id="r136 rd" class="r136 r">mofPath</span>)
        {
            <a href="#99fdd306a0467422" class="k">var</a> <span id="r137 rd" class="r137 r">parser</span> = <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="t">CimDSCParser</span>(<span class="i">MyClassCallback</span>);
            <b>return</b> <span class="r137 r">parser</span>.<a href="#a813d06b3db6b7e1" class="i method">ParseSchemaMof</a>(<span class="r136 r">mofPath</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Import CIM classes from the given file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r138 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r139 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r140 r">errors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r141 r">importInBoxResourcesImplicitly</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <a id="2e87c4641eccb833" href="../R/2e87c4641eccb833.html" target="n" data-glyph="72,1" class="i method">ImportClasses</a>(<b>string</b> <span id="r138 rd" class="r138 r">path</span>, <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt; <span id="r139 rd" class="r139 r">moduleInfo</span>, <span class="i">Collection</span>&lt;<span class="i">Exception</span>&gt; <span id="r140 rd" class="r140 r">errors</span>, <b>bool</b> <span id="r141 rd" class="r141 r">importInBoxResourcesImplicitly</span> = <b>false</b>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r138 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r138 r">path</span>));
            }
 
            <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;DSC ClassCache: importing file: {0}&quot;</span>, <span class="r138 r">path</span>);
 
            <a href="#99fdd306a0467422" class="k">var</a> <span id="r142 rd" class="r142 r">parser</span> = <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="t">CimDSCParser</span>(<span class="i">MyClassCallback</span>);
 
            <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <span id="r143 rd" class="r143 r">classes</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r143 r">classes</span> = <span class="r142 r">parser</span>.<a href="#a813d06b3db6b7e1" class="i method">ParseSchemaMof</a>(<span class="r138 r">path</span>);
            }
            <b>catch</b> (<a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r144 rd" class="r144 r">e</span>)
            {
                <span class="c">// Ignore modules with invalid schemas.</span>
                <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(<span class="s">&quot;DSC ClassCache: Error importing file &#39;{0}&#39;, with error &#39;{1}&#39;.  Skipping file.&quot;</span>, <span class="r138 r">path</span>, <span class="r144 r">e</span>);
                <b>if</b> (<span class="r140 r">errors</span> != <b>null</b>)
                {
                    <span class="r140 r">errors</span>.<span class="i">Add</span>(<span class="r144 r">e</span>);
                }
            }
 
            <b>if</b> (<span class="r143 r">classes</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r145 rd" class="r145 r">c</span> <b>in</b> <span class="r143 r">classes</span>)
                {
                    <span class="c">// Only add the class once...</span>
                    <b>var</b> <span id="r146 rd" class="r146 r">className</span> = <span class="r145 r">c</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>;
                    <b>string</b> <span id="r147 rd" class="r147 r">alias</span> = <span class="i">GetFriendlyName</span>(<span class="r145 r">c</span>);
                    <b>var</b> <span id="r148 rd" class="r148 r">friendlyName</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r147 r">alias</span>) ? <span class="r146 r">className</span> : <span class="r147 r">alias</span>;
                    <b>string</b> <span id="r149 rd" class="r149 r">moduleQualifiedResourceName</span> = <span class="i">GetModuleQualifiedResourceName</span>(<span class="r139 r">moduleInfo</span>.<span class="i">Item1</span>, <span class="r139 r">moduleInfo</span>.<span class="i">Item2</span>.<span class="i">ToString</span>(), <span class="r146 r">className</span>, <span class="r148 r">friendlyName</span>);
                    <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a> <span id="r150 rd" class="r150 r">cimClassInfo</span>;
 
                    <b>if</b> (<a href="#33d37dbc421f598c" class="i property">ClassCache</a>.<span class="i">TryGetValue</span>(<span class="r149 r">moduleQualifiedResourceName</span>, <b>out</b> <span class="r150 r">cimClassInfo</span>))
                    {
                        <span class="i">CimClass</span> <span id="r151 rd" class="r151 r">cimClass</span> = <span class="r150 r">cimClassInfo</span>.<a href="#5892cf2a84ca4067" class="i field">CimClassInstance</a>;
 
                        <span class="c">// If this is a nested object and we already have exactly same nested object, we will</span>
                        <span class="c">// allow sharing of nested objects.</span>
                        <b>if</b> (!<span class="i">IsSameNestedObject</span>(<span class="r151 r">cimClass</span>, <span class="r145 r">c</span>))
                        {
                            <b>var</b> <span id="r152 rd" class="r152 r">files</span> = <b>string</b>.<span class="i">Join</span>(<span class="s">&quot;,&quot;</span>, <span class="i">GetFileDefiningClass</span>(<span class="r146 r">className</span>));
                            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r153 rd" class="r153 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">ParserStrings</span>.<span class="i">DuplicateCimClassDefinition</span>, <span class="r146 r">className</span>, <span class="r138 r">path</span>, <span class="r152 r">files</span>);
 
                            <span class="r153 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;DuplicateCimClassDefinition&quot;</span>);
                            <b>if</b> (<span class="r140 r">errors</span> != <b>null</b>)
                            {
                                <span class="r140 r">errors</span>.<span class="i">Add</span>(<span class="r153 r">e</span>);
                            }
                        }
                    }
 
                    <b>if</b> (<a href="#fe8128ae5d89e924" class="i field">s_hiddenResourceCache</a>.<span class="i">Contains</span>(<span class="r146 r">className</span>))
                    {
                        <b>continue</b>;
                    }
 
                    <b>if</b> (!<a href="#6b8e947cc79979ca" class="i property">CacheResourcesFromMultipleModuleVersions</a>)
                    {
                        <span class="c">// Find &amp; remove the previous version of the resource.</span>
                        <span class="i">List</span>&lt;<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt;&gt; <span id="r154 rd" class="r154 r">resourceList</span> = <span class="i">FindResourceInCache</span>(<span class="r139 r">moduleInfo</span>.<span class="i">Item1</span>, <span class="r146 r">className</span>, <span class="r148 r">friendlyName</span>);
                        <b>if</b> (<span class="r154 r">resourceList</span>.<span class="i">Count</span> &gt; 0 &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r154 r">resourceList</span>[0].<span class="i">Key</span>))
                        {
                            <a href="#33d37dbc421f598c" class="i property">ClassCache</a>.<span class="i">Remove</span>(<span class="r154 r">resourceList</span>[0].<span class="i">Key</span>);
 
                            <span class="c">// keyword is already defined and it is a Inbox resource, remove it</span>
                            <b>if</b> (<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<span class="i">ContainsKeyword</span>(<span class="r148 r">friendlyName</span>) &amp;&amp; <span class="r154 r">resourceList</span>[0].<span class="i">Value</span>.<span class="i">IsImportedImplicitly</span>)
                            {
                                <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<span class="i">RemoveKeyword</span>(<span class="r148 r">friendlyName</span>);
                            }
                        }
                    }
 
                    <a href="#33d37dbc421f598c" class="i property">ClassCache</a>[<span class="r149 r">moduleQualifiedResourceName</span>] = <b>new</b> <span class="t">DscClassCacheEntry</span>(<a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#fa33313e269e6f40" class="i field">Default</a>, <span class="r141 r">importInBoxResourcesImplicitly</span>, <span class="r145 r">c</span>);
                    <a href="#538a786bc32fe440" class="i property">ByClassModuleCache</a>[<span class="r146 r">className</span>] = <span class="r139 r">moduleInfo</span>;
                }
 
                <b>var</b> <span id="r155 rd" class="r155 r">sb</span> = <b>new</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">StringBuilder</span>();
                <b>foreach</b> (<b>var</b> <span id="r156 rd" class="r156 r">c</span> <b>in</b> <span class="r143 r">classes</span>)
                {
                    <span class="r155 r">sb</span>.<span class="i">Append</span>(<span class="r156 r">c</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>);
                    <span class="r155 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;,&#39;</span>);
                }
 
                <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;DSC ClassCache: loading file &#39;{0}&#39; added the following classes to the cache: {1}&quot;</span>, <span class="r138 r">path</span>, <span class="r155 r">sb</span>.<span class="i">ToString</span>());
            }
            <b>else</b>
            {
                <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;DSC ClassCache: loading file &#39;{0}&#39; added no classes to the cache.&quot;</span>);
            }
 
            <a href="#1981c1bc3c235153" class="i property">ByFileClassCache</a>[<span class="r138 r">path</span>] = <span class="r143 r">classes</span>;
            <b>return</b> <span class="r143 r">classes</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get text from SecureString.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r157 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Value of SecureString.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Decoded string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="16f770a659f8af02" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetStringFromSecureString</a>(<span class="i">SecureString</span> <span id="r157 rd" class="r157 r">value</span>)
        {
            <b>string</b> <span id="r158 rd" class="r158 r">passwordValueToAdd</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <b>if</b> (<span class="r157 r">value</span> != <b>null</b>)
            {
                <span class="i">IntPtr</span> <span id="r159 rd" class="r159 r">ptr</span> = <span class="i">Marshal</span>.<span class="i">SecureStringToCoTaskMemUnicode</span>(<span class="r157 r">value</span>);
                <span class="r158 r">passwordValueToAdd</span> = <span class="i">Marshal</span>.<span class="i">PtrToStringUni</span>(<span class="r159 r">ptr</span>);
                <span class="i">Marshal</span>.<span class="i">ZeroFreeCoTaskMemUnicode</span>(<span class="r159 r">ptr</span>);
            }
 
            <b>return</b> <span class="r158 r">passwordValueToAdd</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Clear out the existing collection of CIM classes and associated keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="6ebe0026b4cda8f1" href="../R/6ebe0026b4cda8f1.html" target="n" data-glyph="72,1" class="i method">ClearCache</a>()
        {
            <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;DSC class: clearing the cache and associated keywords.&quot;</span>);
            <a href="#33d37dbc421f598c" class="i property">ClassCache</a>.<span class="i">Clear</span>();
            <a href="#538a786bc32fe440" class="i property">ByClassModuleCache</a>.<span class="i">Clear</span>();
            <a href="#1981c1bc3c235153" class="i property">ByFileClassCache</a>.<span class="i">Clear</span>();
            <a href="#83670b5df3e7c7e4" class="i property">ScriptKeywordFileCache</a>.<span class="i">Clear</span>();
            <a href="#6b8e947cc79979ca" class="i property">CacheResourcesFromMultipleModuleVersions</a> = <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns module qualified resource name in &quot;Module\Version\Class&quot; format.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r161 r">moduleVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r162 r">className</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r163 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="0bf3c352f8a6ac17" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetModuleQualifiedResourceName</a>(<b>string</b> <span id="r160 rd" class="r160 r">moduleName</span>, <b>string</b> <span id="r161 rd" class="r161 r">moduleVersion</span>, <b>string</b> <span id="r162 rd" class="r162 r">className</span>, <b>string</b> <span id="r163 rd" class="r163 r">resourceName</span>)
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}\\{1}\\{2}\\{3}&quot;</span>, <span class="r160 r">moduleName</span>, <span class="r161 r">moduleVersion</span>, <span class="r162 r">className</span>, <span class="r163 r">resourceName</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Finds resources in the that which matches the specified class and module name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r164 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Module name.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r165 r">className</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Resource type name.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Resource friendly name.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of found resources in the form of Dictionary{moduleQualifiedName, cimClass}, otherwise empty list.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">List</span>&lt;<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt;&gt; <a id="0e7cace85e1ce356" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FindResourceInCache</a>(<b>string</b> <span id="r164 rd" class="r164 r">moduleName</span>, <b>string</b> <span id="r165 rd" class="r165 r">className</span>, <b>string</b> <span id="r166 rd" class="r166 r">resourceName</span>)
        {
            <b>return</b> (<b>from</b> <span class="i">cacheEntry</span> <b>in</b> <a href="#33d37dbc421f598c" class="i property">ClassCache</a>
                    <b>let</b> <span class="i">splittedName</span> = <span class="i">cacheEntry</span>.<span class="i">Key</span>.<span class="i">Split</span>(<a href="../engine/Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../engine/Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../engine/Utils.cs.html#247bb446a0dd1494" class="i field">Backslash</a>)
                    <b>let</b> <span class="i">cachedClassName</span> = <span class="i">splittedName</span>[<a href="#cb5c480a05121321" class="i field">IndexClassName</a>]
                    <b>let</b> <span class="i">cachedModuleName</span> = <span class="i">splittedName</span>[<a href="#826cbdcc555fbeee" class="i field">IndexModuleName</a>]
                    <b>let</b> <span class="i">cachedResourceName</span> = <span class="i">splittedName</span>[<a href="#fbf3cc1944d4ef0d" class="i field">IndexFriendlyName</a>]
                    <b>where</b> (<b>string</b>.<span class="i">Equals</span>(<span class="i">cachedResourceName</span>, <span class="r166 r">resourceName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                    || (<b>string</b>.<span class="i">Equals</span>(<span class="i">cachedClassName</span>, <span class="r165 r">className</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                        &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="i">cachedModuleName</span>, <span class="r164 r">moduleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                    <b>select</b> <span class="i">cacheEntry</span>).<span class="i">ToList</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">List</span>&lt;<a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt; <a id="5d704b9f9c16ea91" href="../R/5d704b9f9c16ea91.html" target="n" data-glyph="76,1" class="i method">GetCachedClasses</a>()
        {
            <b>return</b> <a href="#33d37dbc421f598c" class="i property">ClassCache</a>.<span class="i">Values</span>.<span class="i">ToList</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find cached cim classes defined under specified module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r167 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of cached cim classes.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span>&gt; <a id="fb5d52d24169d3bd" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetCachedClassesForModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r167 rd" class="r167 r">module</span>)
        {
            <span class="i">List</span>&lt;<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span>&gt; <span id="r168 rd" class="r168 r">cachedClasses</span> = <b>new</b>();
            <b>var</b> <span id="r169 rd" class="r169 r">moduleQualifiedName</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}\\{1}&quot;</span>, <span class="r167 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r167 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>.<span class="i">ToString</span>());
            <b>foreach</b> (<b>var</b> <span id="r170 rd" class="r170 r">dscClassCacheEntry</span> <b>in</b> <a href="#33d37dbc421f598c" class="i property">ClassCache</a>)
            {
                <b>if</b> (<span class="r170 r">dscClassCacheEntry</span>.<span class="i">Key</span>.<span class="i">StartsWith</span>(<span class="r169 r">moduleQualifiedName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r168 r">cachedClasses</span>.<span class="i">Add</span>(<span class="r170 r">dscClassCacheEntry</span>.<span class="i">Value</span>.<span class="i">CimClassInstance</span>);
                }
            }
 
            <b>return</b> <span class="r168 r">cachedClasses</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the file that defined this class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r171 r">className</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="907c162ebfe19868" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetFileDefiningClass</a>(<b>string</b> <span id="r171 rd" class="r171 r">className</span>)
        {
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r172 rd" class="r172 r">files</span> = <b>new</b>();
            <b>foreach</b> (<b>var</b> <span id="r173 rd" class="r173 r">pair</span> <b>in</b> <a href="#1981c1bc3c235153" class="i property">ByFileClassCache</a>)
            {
                <b>var</b> <span id="r174 rd" class="r174 r">file</span> = <span class="r173 r">pair</span>.<span class="i">Key</span>;
                <b>var</b> <span id="r175 rd" class="r175 r">classList</span> = <span class="r173 r">pair</span>.<span class="i">Value</span>;
                <b>if</b> (<span class="r175 r">classList</span> != <b>null</b> &amp;&amp; <span class="r175 r">classList</span>.<span class="i">Find</span>((<span class="i">CimClass</span> <span id="r176 rd" class="r176 r">c</span>) =&gt; <b>string</b>.<span class="i">Equals</span>(<span class="r176 r">c</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>, <span class="r171 r">className</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)) != <b>null</b>)
                {
                    <span class="r172 r">files</span>.<span class="i">Add</span>(<span class="r174 r">file</span>);
                }
            }
 
            <b>return</b> <span class="r172 r">files</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get a list of files from which classes have been loaded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b>[] <a id="d97b83ca1500a1ac" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetLoadedFiles</a>()
        {
            <b>return</b> <a href="#1981c1bc3c235153" class="i property">ByFileClassCache</a>.<span class="i">Keys</span>.<span class="i">ToArray</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the classes that we loaded from the specified file name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <a id="e19a02169c52eebf" href="../R/e19a02169c52eebf.html" target="n" data-glyph="72,1" class="i method">GetCachedClassByFileName</a>(<b>string</b> <span id="r177 rd" class="r177 r">fileName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r177 r">fileName</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r177 r">fileName</span>));
            }
 
            <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <span id="r178 rd" class="r178 r">listCimClass</span>;
            <a href="#1981c1bc3c235153" class="i property">ByFileClassCache</a>.<span class="i">TryGetValue</span>(<span class="r177 r">fileName</span>, <b>out</b> <span class="r178 r">listCimClass</span>);
            <b>return</b> <span class="r178 r">listCimClass</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the classes associated with the specified module name.</span>
        <span class="c">///</span><span class="c"> Per PowerShell the module name is the base name of the schema file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<span class="i">CimClass</span>&gt; <a id="4ea8ddf1f1166e30" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetCachedClassByModuleName</a>(<b>string</b> <span id="r179 rd" class="r179 r">moduleName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r179 r">moduleName</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r179 r">moduleName</span>));
            }
 
            <b>var</b> <span id="r180 rd" class="r180 r">moduleFileName</span> = <span class="r179 r">moduleName</span> + <span class="s">&quot;.schema.mof&quot;</span>;
            <b>return</b> (<b>from</b> <span class="i">filename</span> <b>in</b> <a href="#1981c1bc3c235153" class="i property">ByFileClassCache</a>.<span class="i">Keys</span> <b>where string</b>.<span class="i">Equals</span>(<span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="i">filename</span>), <span class="r180 r">moduleFileName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) <b>select</b> <span class="i">GetCachedClassByFileName</span>(<span class="i">filename</span>)).<span class="i">FirstOrDefault</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Routine used to load a set of CIM instances from a .mof file using the</span>
        <span class="c">///</span><span class="c"> current set of cached classes for schema validation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r181 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file to load the classes from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<span class="i">CimInstance</span>&gt; <a id="01c323c62caf5e7c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ImportInstances</a>(<b>string</b> <span id="r181 rd" class="r181 r">path</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r181 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r181 r">path</span>));
            }
 
            <a href="#99fdd306a0467422" class="k">var</a> <span id="r182 rd" class="r182 r">parser</span> = <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="t">CimDSCParser</span>(<span class="i">MyClassCallback</span>);
 
            <b>return</b> <span class="r182 r">parser</span>.<a href="#384480aa08466a88" class="i method">ParseInstanceMof</a>(<span class="r181 r">path</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Routine used to load a set of CIM instances from a .mof file using the</span>
        <span class="c">///</span><span class="c"> current set of cached classes for schema validation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r183 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r184 r">schemaValidationOption</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<span class="i">CimInstance</span>&gt; <a id="ea1ad3d0e347e29a" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ImportInstances</a>(<b>string</b> <span id="r183 rd" class="r183 r">path</span>, <b>int</b> <span id="r184 rd" class="r184 r">schemaValidationOption</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r183 r">path</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r183 r">path</span>));
            }
 
            <b>if</b> (<span class="r184 r">schemaValidationOption</span> &lt; (<b>int</b>)<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Serialization</span>.<span class="i">MofDeserializerSchemaValidationOption</span>.<span class="i">Default</span> ||
                <span class="r184 r">schemaValidationOption</span> &gt; (<b>int</b>)<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Serialization</span>.<span class="i">MofDeserializerSchemaValidationOption</span>.<span class="i">Ignore</span>)
            {
                <b>throw</b> <b>new</b> <span class="i">IndexOutOfRangeException</span>(<span class="s">&quot;schemaValidationOption&quot;</span>);
            }
 
            <a href="#99fdd306a0467422" class="k">var</a> <span id="r185 rd" class="r185 r">parser</span> = <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="t">CimDSCParser</span>(<span class="i">MyClassCallback</span>, (<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Serialization</span>.<span class="i">MofDeserializerSchemaValidationOption</span>)<span class="r184 r">schemaValidationOption</span>);
 
            <b>return</b> <span class="r185 r">parser</span>.<a href="#384480aa08466a88" class="i method">ParseInstanceMof</a>(<span class="r183 r">path</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A routine that validates a string containing MOF instances against the</span>
        <span class="c">///</span><span class="c"> current set of cached classes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r186 r">instanceText</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="8605426afbb686ac" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ValidateInstanceText</a>(<b>string</b> <span id="r186 rd" class="r186 r">instanceText</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r186 r">instanceText</span>))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r186 r">instanceText</span>));
            }
 
            <a href="#99fdd306a0467422" class="k">var</a> <span id="r187 rd" class="r187 r">parser</span> = <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="t">CimDSCParser</span>(<span class="i">MyClassCallback</span>);
 
            <span class="r187 r">parser</span>.<a href="#df7fba73717e44aa" class="i method">ValidateInstanceText</a>(<span class="r186 r">instanceText</span>);
        }
 
        <b>private static bool</b> <a id="e9790dd6a7813172" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsMagicProperty</a>(<b>string</b> <span id="r188 rd" class="r188 r">propertyName</span>)
        {
            <b>return</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">Regex</span>.<span class="i">Match</span>(<span class="r188 r">propertyName</span>,
                <span class="s">&quot;^(ResourceId|SourceInfo|ModuleName|ModuleVersion|ConfigurationName)$&quot;</span>,
                <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>).<span class="i">Success</span>;
        }
 
        <b>private static string</b> <a id="5c2c52adeb8a693f" href="../R/5c2c52adeb8a693f.html" target="n" data-glyph="76,1" class="i method">GetFriendlyName</a>(<span class="i">CimClass</span> <span id="r189 rd" class="r189 r">cimClass</span>)
        {
            <b>try</b>
            {
                <b>var</b> <span id="r190 rd" class="r190 r">aliasQualifier</span> = <span class="r189 r">cimClass</span>.<span class="i">CimClassQualifiers</span>[<span class="s">&quot;FriendlyName&quot;</span>];
                <b>if</b> (<span class="r190 r">aliasQualifier</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r190 r">aliasQualifier</span>.<span class="i">Value</span> <b>as string</b>;
                }
            }
            <b>catch</b> (<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimException</span>)
            {
                <span class="c">// exception means no DSCAlias</span>
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Method to get the cached classes in the form of DynamicKeyword.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">Collection</span>&lt;<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>&gt; <a id="540899f12bbdf5e6" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetCachedKeywords</a>()
        {
            <span class="i">Collection</span>&lt;<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>&gt; <span id="r191 rd" class="r191 r">keywords</span> = <b>new</b>();
 
            <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt; <span id="r192 rd" class="r192 r">cachedClass</span> <b>in</b> <a href="#33d37dbc421f598c" class="i property">ClassCache</a>)
            {
                <b>string</b>[] <span id="r193 rd" class="r193 r">splittedName</span> = <span class="r192 r">cachedClass</span>.<span class="i">Key</span>.<span class="i">Split</span>(<a href="../engine/Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../engine/Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../engine/Utils.cs.html#247bb446a0dd1494" class="i field">Backslash</a>);
                <b>string</b> <span id="r194 rd" class="r194 r">moduleName</span> = <span class="r193 r">splittedName</span>[<a href="#826cbdcc555fbeee" class="i field">IndexModuleName</a>];
                <b>string</b> <span id="r195 rd" class="r195 r">moduleVersion</span> = <span class="r193 r">splittedName</span>[<a href="#0107e770be50f634" class="i field">IndexModuleVersion</a>];
 
                <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="k">var</a> <span id="r196 rd" class="r196 r">keyword</span> = <span class="i">CreateKeywordFromCimClass</span>(<span class="r194 r">moduleName</span>, <span class="i">Version</span>.<span class="i">Parse</span>(<span class="r195 r">moduleVersion</span>), <span class="r192 r">cachedClass</span>.<span class="i">Value</span>.<span class="i">CimClassInstance</span>, <b>null</b>, <span class="r192 r">cachedClass</span>.<span class="i">Value</span>.<span class="i">DscResRunAsCred</span>);
                <b>if</b> (<span class="r196 r">keyword</span> != <b>null</b>)
                {
                    <span class="r191 r">keywords</span>.<span class="i">Add</span>(<span class="r196 r">keyword</span>);
                }
            }
 
            <b>return</b> <span class="r191 r">keywords</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A method to generate a keyword from a CIM class object and register it to DynamicKeyword table.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r197 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r198 r">moduleVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r199 r">cimClass</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r200 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true, don&#39;t define the keywords, just create the functions.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r201 r">runAsBehavior</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">To Specify RunAsBehavior of the class.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="b5db017799fa0106" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateAndRegisterKeywordFromCimClass</a>(<b>string</b> <span id="r197 rd" class="r197 r">moduleName</span>, <span class="i">Version</span> <span id="r198 rd" class="r198 r">moduleVersion</span>, <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span> <span id="r199 rd" class="r199 r">cimClass</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r200 rd" class="r200 r">functionsToDefine</span>, <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a> <span id="r201 rd" class="r201 r">runAsBehavior</span>)
        {
            <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="k">var</a> <span id="r202 rd" class="r202 r">keyword</span> = <a href="#55159492b41fe7bd" class="i method">CreateKeywordFromCimClass</a>(<span class="r197 r">moduleName</span>, <span class="r198 r">moduleVersion</span>, <span class="r199 r">cimClass</span>, <span class="r200 r">functionsToDefine</span>, <span class="r201 r">runAsBehavior</span>);
            <b>if</b> (<span class="r202 r">keyword</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// keyword is already defined and we don&#39;t allow redefine it</span>
            <b>if</b> (!<a href="#6b8e947cc79979ca" class="i property">CacheResourcesFromMultipleModuleVersions</a> &amp;&amp; <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#2af1cc3c0788237c" class="i method">ContainsKeyword</a>(<span class="r202 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>))
            {
                <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="k">var</a> <span id="r203 rd" class="r203 r">oldKeyword</span> = <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#1f19ca15ed12e7d3" class="i method">GetKeyword</a>(<span class="r202 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>);
                <b>if</b> (<span class="r203 r">oldKeyword</span>.<a href="../engine/parser/tokenizer.cs.html#9757f90b46da4d4e" class="i property">ImplementingModule</a> == <b>null</b> ||
                    !<span class="r203 r">oldKeyword</span>.<a href="../engine/parser/tokenizer.cs.html#9757f90b46da4d4e" class="i property">ImplementingModule</a>.<span class="i">Equals</span>(<span class="r197 r">moduleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) || <span class="r203 r">oldKeyword</span>.<a href="../engine/parser/tokenizer.cs.html#3a89c893b71586c2" class="i property">ImplementingModuleVersion</a> != <span class="r198 r">moduleVersion</span>)
                {
                    <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="k">var</a> <span id="r204 rd" class="r204 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">ParserStrings</span>.<span class="i">DuplicateKeywordDefinition</span>, <span class="r202 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>);
                    <span class="r204 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;DuplicateKeywordDefinition&quot;</span>);
                    <b>throw</b> <span class="r204 r">e</span>;
                }
            }
            <span class="c">// Add the dynamic keyword to the table</span>
            <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#1aa0699a8df0ecd2" class="i method">AddKeyword</a>(<span class="r202 r">keyword</span>);
 
            <span class="c">// And now define the driver functions in the current scope...</span>
            <b>if</b> (<span class="r200 r">functionsToDefine</span> != <b>null</b>)
            {
                <span class="r200 r">functionsToDefine</span>[<span class="r197 r">moduleName</span> + <span class="s">&quot;\\&quot;</span> + <span class="r202 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>] = <a href="#07f9b437c0440e5a" class="i property">CimKeywordImplementationFunction</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A method to generate a keyword from a CIM class object. This is used for DSC.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r205 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r206 r">moduleVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r207 r">cimClass</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true, don&#39;t define the keywords, just create the functions.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">runAsBehavior</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">To specify RunAs behavior of the class.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a> <a id="55159492b41fe7bd" href="../R/55159492b41fe7bd.html" target="n" data-glyph="76,1" class="i method">CreateKeywordFromCimClass</a>(<b>string</b> <span id="r205 rd" class="r205 r">moduleName</span>, <span class="i">Version</span> <span id="r206 rd" class="r206 r">moduleVersion</span>, <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimClass</span> <span id="r207 rd" class="r207 r">cimClass</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r208 rd" class="r208 r">functionsToDefine</span>, <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a> <span id="r209 rd" class="r209 r">runAsBehavior</span>)
        {
            <b>var</b> <span id="r210 rd" class="r210 r">resourceName</span> = <span class="r207 r">cimClass</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>;
            <b>string</b> <span id="r211 rd" class="r211 r">alias</span> = <span class="i">GetFriendlyName</span>(<span class="r207 r">cimClass</span>);
            <b>var</b> <span id="r212 rd" class="r212 r">keywordString</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r211 r">alias</span>) ? <span class="r210 r">resourceName</span> : <span class="r211 r">alias</span>;
 
            <span class="c">//</span>
            <span class="c">// Skip all of the base, meta, registration and other classes that are not intended to be used directly by a script author</span>
            <span class="c">//</span>
            <b>if</b> (<span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">Regex</span>.<span class="i">Match</span>(<span class="r212 r">keywordString</span>, <span class="s">&quot;^OMI_Base|^OMI_.*Registration&quot;</span>, <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>).<span class="i">Success</span>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="k">var</a> <span id="r213 rd" class="r213 r">keyword</span> = <b>new</b> <span class="t">DynamicKeyword</span>()
            {
                <a href="../engine/parser/tokenizer.cs.html#46e96fbd06c2c3af" class="i property">BodyMode</a> = <a href="../engine/parser/tokenizer.cs.html#dc369c18a439471a" class="t t">DynamicKeywordBodyMode</a>.<a href="../engine/parser/tokenizer.cs.html#5da06d8412de17c8" class="i field">Hashtable</a>,
                <a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a> = <span class="r212 r">keywordString</span>,
                <a href="../engine/parser/tokenizer.cs.html#1ab8fd5746dc90ae" class="i property">ResourceName</a> = <span class="r210 r">resourceName</span>,
                <a href="../engine/parser/tokenizer.cs.html#9757f90b46da4d4e" class="i property">ImplementingModule</a> = <span class="r205 r">moduleName</span>,
                <a href="../engine/parser/tokenizer.cs.html#3a89c893b71586c2" class="i property">ImplementingModuleVersion</a> = <span class="r206 r">moduleVersion</span>,
                <a href="../engine/parser/tokenizer.cs.html#31e7c406e5824274" class="i property">SemanticCheck</a> = <span class="i">CheckMandatoryPropertiesPresent</span>
            };
 
            <span class="c">// If it&#39;s one of reserved dynamic keyword, mark it</span>
            <b>if</b> (<span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">Regex</span>.<span class="i">Match</span>(<span class="r212 r">keywordString</span>, <a href="#fea87de65cb6d5e8" class="i field">reservedDynamicKeywords</a>, <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>).<span class="i">Success</span>)
            {
                <span class="r213 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#0478d618518110b3" class="i property">IsReservedKeyword</a> = <b>true</b>;
            }
 
            <span class="c">// see if it&#39;s a resource type i.e. it inherits from OMI_BaseResource</span>
            <b>bool</b> <span id="r214 rd" class="r214 r">isResourceType</span> = <b>false</b>;
            <b>for</b> (<b>var</b> <span id="r215 rd" class="r215 r">classToCheck</span> = <span class="r207 r">cimClass</span>; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r215 r">classToCheck</span>.<span class="i">CimSuperClassName</span>); <span class="r215 r">classToCheck</span> = <span class="r215 r">classToCheck</span>.<span class="i">CimSuperClass</span>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="s">&quot;OMI_BaseResource&quot;</span>, <span class="r215 r">classToCheck</span>.<span class="i">CimSuperClassName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) || <b>string</b>.<span class="i">Equals</span>(<span class="s">&quot;OMI_MetaConfigurationResource&quot;</span>, <span class="r215 r">classToCheck</span>.<span class="i">CimSuperClassName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r214 r">isResourceType</span> = <b>true</b>;
                    <b>break</b>;
                }
            }
 
            <span class="c">// If it&#39;s a resource type, then a resource name is required.</span>
            <span class="r213 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#a246b575bebf7355" class="i property">NameMode</a> = <span class="r214 r">isResourceType</span> ? <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#36ae172a002d6bd7" class="i field">NameRequired</a> : <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#f4392d4c8185a4f0" class="i field">NoName</a>;
 
            <span class="c">//</span>
            <span class="c">// Add the settable properties to the keyword object</span>
            <span class="c">//</span>
            <b>foreach</b> (<b>var</b> <span id="r216 rd" class="r216 r">prop</span> <b>in</b> <span class="r207 r">cimClass</span>.<span class="i">CimClassProperties</span>)
            {
                <span class="c">// If the property is marked as readonly, skip it...</span>
                <b>if</b> ((<span class="r216 r">prop</span>.<span class="i">Flags</span> &amp; <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimFlags</span>.<span class="i">ReadOnly</span>) == <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimFlags</span>.<span class="i">ReadOnly</span>)
                {
                    <b>continue</b>;
                }
 
                <b>try</b>
                {
                    <span class="c">// If the property has the Read qualifier, also skip it.</span>
                    <b>if</b> (<span class="r216 r">prop</span>.<span class="i">Qualifiers</span>[<span class="s">&quot;Read&quot;</span>] != <b>null</b>)
                    {
                        <b>continue</b>;
                    }
                }
                <b>catch</b> (<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimException</span>)
                {
                    <span class="c">// Cim exception means Read wasn&#39;t found so continue...</span>
                }
 
                <span class="c">// If it&#39;s one of our magic properties, skip it</span>
                <b>if</b> (<span class="i">IsMagicProperty</span>(<span class="r216 r">prop</span>.<span class="i">Name</span>))
                {
                    <b>continue</b>;
                }
 
                <b>if</b> (<span class="r209 r">runAsBehavior</span> == <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#53235cb5ce6b4405" class="i field">NotSupported</a>)
                {
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r216 r">prop</span>.<span class="i">Name</span>, <span class="s">&quot;PsDscRunAsCredential&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="c">// skip adding PsDscRunAsCredential to the dynamic word for the dsc resource.</span>
                        <b>continue</b>;
                    }
                }
                <span class="c">// If it&#39;s one of our reserved properties, save it for error reporting</span>
                <b>if</b> (<span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">Regex</span>.<span class="i">Match</span>(<span class="r216 r">prop</span>.<span class="i">Name</span>, <a href="#3258bd2478d594d5" class="i field">reservedProperties</a>, <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>.<span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>).<span class="i">Success</span>)
                {
                    <span class="r213 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#19d5aaf963addcf9" class="i property">HasReservedProperties</a> = <b>true</b>;
                    <b>continue</b>;
                }
 
                <span class="c">// Otherwise, add it to the Keyword List.</span>
                <a href="../engine/parser/tokenizer.cs.html#d3231c99121763c4" class="k">var</a> <span id="r217 rd" class="r217 r">keyProp</span> = <b>new</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>.<span class="t">DynamicKeywordProperty</span>();
                <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#1f6c4268727988c7" class="i property">Name</a> = <span class="r216 r">prop</span>.<span class="i">Name</span>;
 
                <span class="c">// Set the mandatory flag if appropriate</span>
                <b>if</b> ((<span class="r216 r">prop</span>.<span class="i">Flags</span> &amp; <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimFlags</span>.<span class="i">Key</span>) == <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimFlags</span>.<span class="i">Key</span>)
                {
                    <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#f2dfcdf74f160f88" class="i property">Mandatory</a> = <b>true</b>;
                    <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#e12bd6b71ced59c2" class="i property">IsKey</a> = <b>true</b>;
                }
 
                <span class="c">// Copy the type name string. If it&#39;s an embedded instance, need to grab it from the ReferenceClassName</span>
                <b>bool</b> <span id="r218 rd" class="r218 r">referenceClassNameIsNullOrEmpty</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r216 r">prop</span>.<span class="i">ReferenceClassName</span>);
                <b>if</b> (<span class="r216 r">prop</span>.<span class="i">CimType</span> == <span class="i">CimType</span>.<span class="i">Instance</span> &amp;&amp; !<span class="r218 r">referenceClassNameIsNullOrEmpty</span>)
                {
                    <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#ee8bc84e145d2931" class="i property">TypeConstraint</a> = <span class="r216 r">prop</span>.<span class="i">ReferenceClassName</span>;
                }
                <b>else</b> <b>if</b> (<span class="r216 r">prop</span>.<span class="i">CimType</span> == <span class="i">CimType</span>.<span class="i">InstanceArray</span> &amp;&amp; !<span class="r218 r">referenceClassNameIsNullOrEmpty</span>)
                {
                    <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#ee8bc84e145d2931" class="i property">TypeConstraint</a> = <span class="r216 r">prop</span>.<span class="i">ReferenceClassName</span> + <span class="s">&quot;[]&quot;</span>;
                }
                <b>else</b>
                {
                    <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#ee8bc84e145d2931" class="i property">TypeConstraint</a> = <span class="r216 r">prop</span>.<span class="i">CimType</span>.<span class="i">ToString</span>();
                }
 
                <b>string</b>[] <span id="r219 rd" class="r219 r">valueMap</span> = <b>null</b>;
                <b>foreach</b> (<b>var</b> <span id="r220 rd" class="r220 r">qualifier</span> <b>in</b> <span class="r216 r">prop</span>.<span class="i">Qualifiers</span>)
                {
                    <span class="c">// Check to see if there is a Values attribute and save the list of allowed values if so.</span>
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r220 r">qualifier</span>.<span class="i">Name</span>, <span class="s">&quot;Values&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp; <span class="r220 r">qualifier</span>.<span class="i">CimType</span> == <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimType</span>.<span class="i">StringArray</span>)
                    {
                        <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#292138791ae38c47" class="i property">Values</a>.<span class="i">AddRange</span>((<b>string</b>[])<span class="r220 r">qualifier</span>.<span class="i">Value</span>);
                    }
 
                    <span class="c">// Check to see if there is a ValueMap attribute and save the list of allowed values if so.</span>
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r220 r">qualifier</span>.<span class="i">Name</span>, <span class="s">&quot;ValueMap&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp; <span class="r220 r">qualifier</span>.<span class="i">CimType</span> == <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimType</span>.<span class="i">StringArray</span>)
                    {
                        <span class="r219 r">valueMap</span> = (<b>string</b>[])<span class="r220 r">qualifier</span>.<span class="i">Value</span>;
                    }
 
                    <span class="c">// Check to see if this property has the Required qualifier associated with it.</span>
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r220 r">qualifier</span>.<span class="i">Name</span>, <span class="s">&quot;Required&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                        <span class="r220 r">qualifier</span>.<span class="i">CimType</span> == <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimType</span>.<span class="i">Boolean</span> &amp;&amp;
                            (<b>bool</b>)<span class="r220 r">qualifier</span>.<span class="i">Value</span>)
                    {
                        <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#f2dfcdf74f160f88" class="i property">Mandatory</a> = <b>true</b>;
                    }
 
                    <span class="c">// set the property to mandatory is specified for the resource.</span>
                    <b>if</b> (<span class="r209 r">runAsBehavior</span> == <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#258c9ad1d17bd118" class="i field">Mandatory</a>)
                    {
                        <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r216 r">prop</span>.<span class="i">Name</span>, <span class="s">&quot;PsDscRunAsCredential&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#f2dfcdf74f160f88" class="i property">Mandatory</a> = <b>true</b>;
                        }
                    }
                }
 
                <b>if</b> (<span class="r219 r">valueMap</span> != <b>null</b> &amp;&amp; <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#292138791ae38c47" class="i property">Values</a>.<span class="i">Count</span> &gt; 0)
                {
                    <b>if</b> (<span class="r219 r">valueMap</span>.<span class="i">Length</span> != <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#292138791ae38c47" class="i property">Values</a>.<span class="i">Count</span>)
                    {
                        <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<span class="i">WriteLine</span>(
                            <span class="s">&quot;DSC CreateDynamicKeywordFromClass: the count of values for qualifier &#39;Values&#39; and &#39;ValueMap&#39; doesn&#39;t match. count of &#39;Values&#39;: {0}, count of &#39;ValueMap&#39;: {1}. Skip the keyword &#39;{2}&#39;.&quot;</span>,
                            <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#292138791ae38c47" class="i property">Values</a>.<span class="i">Count</span>, <span class="r219 r">valueMap</span>.<span class="i">Length</span>, <span class="r213 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>);
                        <b>return</b> <b>null</b>;
                    }
 
                    <b>for</b> (<b>int</b> <span id="r221 rd" class="r221 r">index</span> = 0; <span class="r221 r">index</span> &lt; <span class="r219 r">valueMap</span>.<span class="i">Length</span>; <span class="r221 r">index</span>++)
                    {
                        <b>string</b> <span id="r222 rd" class="r222 r">key</span> = <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#292138791ae38c47" class="i property">Values</a>[<span class="r221 r">index</span>];
                        <b>string</b> <span id="r223 rd" class="r223 r">value</span> = <span class="r219 r">valueMap</span>[<span class="r221 r">index</span>];
 
                        <b>if</b> (<span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a>.<span class="i">ContainsKey</span>(<span class="r222 r">key</span>))
                        {
                            <a href="#1fcd900375683d97" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(
                                <span class="s">&quot;DSC CreateDynamicKeywordFromClass: same string value &#39;{0}&#39; appears more than once in qualifier &#39;Values&#39;. Skip the keyword &#39;{1}&#39;.&quot;</span>,
                                <span class="r222 r">key</span>, <span class="r213 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>);
                            <b>return</b> <b>null</b>;
                        }
 
                        <span class="r217 r">keyProp</span>.<a href="../engine/parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a>.<span class="i">Add</span>(<span class="r222 r">key</span>, <span class="r223 r">value</span>);
                    }
                }
 
                <span class="r213 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>.<span class="i">Add</span>(<span class="r216 r">prop</span>.<span class="i">Name</span>, <span class="r217 r">keyProp</span>);
            }
 
            <span class="c">// update specific keyword with range constraints</span>
            <a href="#f3f2c067ff747a5d" class="i method">UpdateKnownRestriction</a>(<span class="r213 r">keyword</span>);
 
            <b>return</b> <span class="r213 r">keyword</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Update range restriction for meta configuration keywords</span>
        <span class="c">///</span><span class="c"> the restrictions are for</span>
        <span class="c">///</span><span class="c"> ConfigurationModeFrequency: 15-44640</span>
        <span class="c">///</span><span class="c"> RefreshFrequency: 30-44640.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r224 r">keyword</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="f3f2c067ff747a5d" href="../R/f3f2c067ff747a5d.html" target="n" data-glyph="76,1" class="i method">UpdateKnownRestriction</a>(<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a> <span id="r224 rd" class="r224 r">keyword</span>)
        {
            <b>if</b> (
                <b>string</b>.<span class="i">Equals</span>(<span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#1ab8fd5746dc90ae" class="i property">ResourceName</a>, <span class="s">&quot;MSFT_DSCMetaConfigurationV2&quot;</span>,
                    <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                ||
                <b>string</b>.<span class="i">Equals</span>(<span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#1ab8fd5746dc90ae" class="i property">ResourceName</a>, <span class="s">&quot;MSFT_DSCMetaConfiguration&quot;</span>,
                    <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>[<span class="s">&quot;RefreshFrequencyMins&quot;</span>] != <b>null</b>)
                {
                    <span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>[<span class="s">&quot;RefreshFrequencyMins&quot;</span>].<span class="i">Range</span> = <b>new</b> <span class="i">Tuple</span>&lt;<b>int</b>, <b>int</b>&gt;(30, 44640);
                }
 
                <b>if</b> (<span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>[<span class="s">&quot;ConfigurationModeFrequencyMins&quot;</span>] != <b>null</b>)
                {
                    <span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>[<span class="s">&quot;ConfigurationModeFrequencyMins&quot;</span>].<span class="i">Range</span> = <b>new</b> <span class="i">Tuple</span>&lt;<b>int</b>, <b>int</b>&gt;(15, 44640);
                }
 
                <b>if</b> (<span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>[<span class="s">&quot;DebugMode&quot;</span>] != <b>null</b>)
                {
                    <span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>[<span class="s">&quot;DebugMode&quot;</span>].<span class="i">Values</span>.<span class="i">Remove</span>(<span class="s">&quot;ResourceScriptBreakAll&quot;</span>);
                    <span class="r224 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>[<span class="s">&quot;DebugMode&quot;</span>].<span class="i">ValueMap</span>.<span class="i">Remove</span>(<span class="s">&quot;ResourceScriptBreakAll&quot;</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load the default system CIM classes and create the corresponding keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="dd083c49d1ff74e0" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadDefaultCimKeywords</a>()
        {
            <a href="#af7317d0cabc73de" class="i method">LoadDefaultCimKeywords</a>(<b>null</b>, <b>null</b>, <b>null</b>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load the default system CIM classes and create the corresponding keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r225 r">modulePathList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">List of module path from where DSC PS modules will be loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="aeba1bdc777210bb" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadDefaultCimKeywords</a>(<span class="i">List</span>&lt;<b>string</b>&gt; <span id="r225 rd" class="r225 r">modulePathList</span>)
        {
            <a href="#af7317d0cabc73de" class="i method">LoadDefaultCimKeywords</a>(<b>null</b>, <b>null</b>, <span class="r225 r">modulePathList</span>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load the default system CIM classes and create the corresponding keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r226 r">errors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Collection of any errors encountered while loading keywords.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="fb94c5ac76850865" href="../R/fb94c5ac76850865.html" target="n" data-glyph="72,1" class="i method">LoadDefaultCimKeywords</a>(<span class="i">Collection</span>&lt;<span class="i">Exception</span>&gt; <span id="r226 rd" class="r226 r">errors</span>)
        {
            <a href="#af7317d0cabc73de" class="i method">LoadDefaultCimKeywords</a>(<b>null</b>, <span class="r226 r">errors</span>, <b>null</b>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load the default system CIM classes and create the corresponding keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r227 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A dictionary to add the defined functions to, may be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="258a7bbe8003184f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadDefaultCimKeywords</a>(<span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r227 rd" class="r227 r">functionsToDefine</span>)
        {
            <a href="#af7317d0cabc73de" class="i method">LoadDefaultCimKeywords</a>(<span class="r227 r">functionsToDefine</span>, <b>null</b>, <b>null</b>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load the default system CIM classes and create the corresponding keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r228 r">errors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Collection of any errors encountered while loading keywords.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r229 r">cacheResourcesFromMultipleModuleVersions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Allow caching the resources from multiple versions of modules.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="602e3d74616eee8f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadDefaultCimKeywords</a>(<span class="i">Collection</span>&lt;<span class="i">Exception</span>&gt; <span id="r228 rd" class="r228 r">errors</span>, <b>bool</b> <span id="r229 rd" class="r229 r">cacheResourcesFromMultipleModuleVersions</span>)
        {
            <a href="#af7317d0cabc73de" class="i method">LoadDefaultCimKeywords</a>(<b>null</b>, <span class="r228 r">errors</span>, <b>null</b>, <span class="r229 r">cacheResourcesFromMultipleModuleVersions</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load the default system CIM classes and create the corresponding keywords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r230 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A dictionary to add the defined functions to, may be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r231 r">errors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Collection of any errors encountered while loading keywords.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r232 r">modulePathList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">List of module path from where DSC PS modules will be loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r233 r">cacheResourcesFromMultipleModuleVersions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Allow caching the resources from multiple versions of modules.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="af7317d0cabc73de" href="../R/af7317d0cabc73de.html" target="n" data-glyph="76,1" class="i method">LoadDefaultCimKeywords</a>(<span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r230 rd" class="r230 r">functionsToDefine</span>, <span class="i">Collection</span>&lt;<span class="i">Exception</span>&gt; <span id="r231 rd" class="r231 r">errors</span>,
                                                   <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r232 rd" class="r232 r">modulePathList</span>, <b>bool</b> <span id="r233 rd" class="r233 r">cacheResourcesFromMultipleModuleVersions</span>)
        {
            <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#e3ae68982f2c125a" class="i method">Reset</a>();
            <a href="#03b231c6c3dca65e" class="i method">Initialize</a>(<span class="r231 r">errors</span>, <span class="r232 r">modulePathList</span>);
 
            <span class="c">// Initialize-&gt;ClearCache resets CacheResourcesFromMultipleModuleVersions to false,</span>
            <span class="c">// workaround is to set it after Initialize method call.</span>
            <span class="c">// Initialize method imports all the Inbox resources and internal classes which belongs to only one version</span>
            <span class="c">// of the module, so it is ok if this property is not set during cache initialization.</span>
            <a href="#6b8e947cc79979ca" class="i property">CacheResourcesFromMultipleModuleVersions</a> = <span class="r233 r">cacheResourcesFromMultipleModuleVersions</span>;
 
            <b>foreach</b> (<b>var</b> <span id="r234 rd" class="r234 r">cimClass</span> <b>in</b> <a href="#5d704b9f9c16ea91" class="i method">GetCachedClasses</a>())
            {
                <b>var</b> <span id="r235 rd" class="r235 r">className</span> = <span class="r234 r">cimClass</span>.<span class="i">CimClassInstance</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>;
                <b>var</b> <span id="r236 rd" class="r236 r">moduleInfo</span> = <a href="#538a786bc32fe440" class="i property">ByClassModuleCache</a>[<span class="r235 r">className</span>];
                <span class="i">CreateAndRegisterKeywordFromCimClass</span>(<span class="r236 r">moduleInfo</span>.<span class="i">Item1</span>, <span class="r236 r">moduleInfo</span>.<span class="i">Item2</span>, <span class="r234 r">cimClass</span>.<span class="i">CimClassInstance</span>, <span class="r230 r">functionsToDefine</span>, <span class="r234 r">cimClass</span>.<span class="i">DscResRunAsCred</span>);
            }
 
            <span class="c">// And add the Node keyword definitions</span>
            <b>if</b> (!<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#2af1cc3c0788237c" class="i method">ContainsKeyword</a>(<span class="s">&quot;Node&quot;</span>))
            {
                <span class="c">// Implement dispatch to the Node keyword.</span>
                <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="k">var</a> <span id="r237 rd" class="r237 r">nodeKeyword</span> = <b>new</b> <span class="t">DynamicKeyword</span>()
                {
                    <a href="../engine/parser/tokenizer.cs.html#46e96fbd06c2c3af" class="i property">BodyMode</a> = <a href="../engine/parser/tokenizer.cs.html#dc369c18a439471a" class="t t">DynamicKeywordBodyMode</a>.<a href="../engine/parser/tokenizer.cs.html#57e864f08639804e" class="i field">ScriptBlock</a>,
                    <a href="../engine/parser/tokenizer.cs.html#9757f90b46da4d4e" class="i property">ImplementingModule</a> = <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>.<span class="i">Item1</span>,
                    <a href="../engine/parser/tokenizer.cs.html#3a89c893b71586c2" class="i property">ImplementingModuleVersion</a> = <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>.<span class="i">Item2</span>,
                    <a href="../engine/parser/tokenizer.cs.html#a246b575bebf7355" class="i property">NameMode</a> = <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#36ae172a002d6bd7" class="i field">NameRequired</a>,
                    <a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a> = <span class="s">&quot;Node&quot;</span>,
                };
                <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#1aa0699a8df0ecd2" class="i method">AddKeyword</a>(<span class="r237 r">nodeKeyword</span>);
            }
 
            <span class="c">// And add the Import-DscResource keyword definitions</span>
            <b>if</b> (!<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#2af1cc3c0788237c" class="i method">ContainsKeyword</a>(<span class="s">&quot;Import-DscResource&quot;</span>))
            {
                <span class="c">// Implement dispatch to the Node keyword.</span>
                <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="k">var</a> <span id="r238 rd" class="r238 r">nodeKeyword</span> = <b>new</b> <span class="t">DynamicKeyword</span>()
                {
                    <a href="../engine/parser/tokenizer.cs.html#46e96fbd06c2c3af" class="i property">BodyMode</a> = <a href="../engine/parser/tokenizer.cs.html#dc369c18a439471a" class="t t">DynamicKeywordBodyMode</a>.<a href="../engine/parser/tokenizer.cs.html#a2dc466a9a78cf46" class="i field">Command</a>,
                    <a href="../engine/parser/tokenizer.cs.html#9757f90b46da4d4e" class="i property">ImplementingModule</a> = <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>.<span class="i">Item1</span>,
                    <a href="../engine/parser/tokenizer.cs.html#3a89c893b71586c2" class="i property">ImplementingModuleVersion</a> = <a href="#a453791e14320b7e" class="i field">s_defaultModuleInfoForResource</a>.<span class="i">Item2</span>,
                    <a href="../engine/parser/tokenizer.cs.html#a246b575bebf7355" class="i property">NameMode</a> = <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#f4392d4c8185a4f0" class="i field">NoName</a>,
                    <a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a> = <span class="s">&quot;Import-DscResource&quot;</span>,
                    <a href="../engine/parser/tokenizer.cs.html#22566df5302919e2" class="i property">MetaStatement</a> = <b>true</b>,
                    <a href="../engine/parser/tokenizer.cs.html#fd34ab8e73a2860c" class="i property">PostParse</a> = <span class="i">ImportResourcePostParse</span>,
                    <a href="../engine/parser/tokenizer.cs.html#31e7c406e5824274" class="i property">SemanticCheck</a> = <span class="i">ImportResourceCheckSemantics</span>
                };
                <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<a href="../engine/parser/tokenizer.cs.html#1aa0699a8df0ecd2" class="i method">AddKeyword</a>(<span class="r238 r">nodeKeyword</span>);
            }
        }
 
        <span class="c">// This function is called after parsing the Import-DscResource keyword and it&#39;s arguments, but before parsing</span>
        <span class="c">// anything else.</span>
        <span class="c">//</span>
        <span class="c">//</span>
        <b>private static</b> <a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <a id="d0884bf605882e8b" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ImportResourcePostParse</a>(<a href="../engine/parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r239 rd" class="r239 r">kwAst</span>)
        {
            <b>var</b> <span id="r240 rd" class="r240 r">elements</span> = <a href="../engine/parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<span class="i">CopyElements</span>(<span class="r239 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#783dff95585ad1fe" class="i property">CommandElements</a>);
 
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r240 r">elements</span>[0] <b>is</b> <a href="../engine/parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a> &amp;&amp;
                               ((<a href="../engine/parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>)<span class="r240 r">elements</span>[0]).<a href="../engine/parser/ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a>.<span class="i">Equals</span>(<span class="s">&quot;Import-DscResource&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>),
                               <span class="s">&quot;Incorrect ast for expected keyword&quot;</span>);
            <a href="../engine/parser/ast.cs.html#a310aaa1e0374ddd" class="k">var</a> <span id="r241 rd" class="r241 r">commandAst</span> = <b>new</b> <span class="t">CommandAst</span>(<span class="r239 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>, <span class="r240 r">elements</span>, <a href="../engine/parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../engine/parser/token.cs.html#109dbe127dd9cac0" class="i field">Unknown</a>, <b>null</b>);
 
            <b>const string</b> <span id="r242 rd" class="r242 r">nameParam</span> = <span class="s">&quot;Name&quot;</span>;
            <b>const string</b> <span id="r243 rd" class="r243 r">moduleNameParam</span> = <span class="s">&quot;ModuleName&quot;</span>;
            <b>const string</b> <span id="r244 rd" class="r244 r">moduleVersionParam</span> = <span class="s">&quot;ModuleVersion&quot;</span>;
 
            <a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#cae64ef619e0a99a" class="t t">StaticBindingResult</a> <span id="r245 rd" class="r245 r">bindingResult</span> = <a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#b6eface4652c31d3" class="t t">StaticParameterBinder</a>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#d2b93539d7859acd" class="i method">BindCommand</a>(<span class="r241 r">commandAst</span>, <b>false</b>);
 
            <b>var</b> <span id="r246 rd" class="r246 r">errorList</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>&gt;();
            <b>foreach</b> (<b>var</b> <span id="r247 rd" class="r247 r">bindingException</span> <b>in</b> <span class="r245 r">bindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2adc460fbc055cd5" class="i property">BindingExceptions</a>.<span class="i">Values</span>)
            {
                <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r247 r">bindingException</span>.<span class="i">CommandElement</span>.<span class="i">Extent</span>,
                                             <span class="s">&quot;ParameterBindingException&quot;</span>,
                                             <span class="r247 r">bindingException</span>.<span class="i">BindingException</span>.<span class="i">Message</span>));
            }
 
            <a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#15f8f4f4f6f1cb09" class="t t">ParameterBindingResult</a> <span id="r248 rd" class="r248 r">moduleNameBindingResult</span> = <b>null</b>;
            <a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#15f8f4f4f6f1cb09" class="t t">ParameterBindingResult</a> <span id="r249 rd" class="r249 r">resourceNameBindingResult</span> = <b>null</b>;
            <a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#15f8f4f4f6f1cb09" class="t t">ParameterBindingResult</a> <span id="r250 rd" class="r250 r">moduleVersionBindingResult</span> = <b>null</b>;
 
            <b>foreach</b> (<b>var</b> <span id="r251 rd" class="r251 r">binding</span> <b>in</b> <span class="r245 r">bindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#e54921e80ff4b0b1" class="i property">BoundParameters</a>)
            {
                <span class="c">// Error case when positional parameter values are specified</span>
                <b>var</b> <span id="r252 rd" class="r252 r">boundParameterName</span> = <span class="r251 r">binding</span>.<span class="i">Key</span>;
                <b>var</b> <span id="r253 rd" class="r253 r">parameterBindingResult</span> = <span class="r251 r">binding</span>.<span class="i">Value</span>;
                <b>if</b> (<span class="r252 r">boundParameterName</span>.<span class="i">All</span>(<b>char</b>.<span class="i">IsDigit</span>))
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r253 r">parameterBindingResult</span>.<span class="i">Value</span>.<span class="i">Extent</span>,
                                                 <span class="s">&quot;ImportDscResourcePositionalParamsNotSupported&quot;</span>,
                                                 <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourcePositionalParamsNotSupported</span>)));
                    <b>continue</b>;
                }
 
                <b>if</b> (<span class="r242 r">nameParam</span>.<span class="i">StartsWith</span>(<span class="r252 r">boundParameterName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r249 r">resourceNameBindingResult</span> = <span class="r253 r">parameterBindingResult</span>;
                }
                <b>else</b> <b>if</b> (<span class="r243 r">moduleNameParam</span>.<span class="i">StartsWith</span>(<span class="r252 r">boundParameterName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r248 r">moduleNameBindingResult</span> = <span class="r253 r">parameterBindingResult</span>;
                }
                <b>else</b> <b>if</b> (<span class="r244 r">moduleVersionParam</span>.<span class="i">StartsWith</span>(<span class="r252 r">boundParameterName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r250 r">moduleVersionBindingResult</span> = <span class="r253 r">parameterBindingResult</span>;
                }
                <b>else</b>
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r253 r">parameterBindingResult</span>.<span class="i">Value</span>.<span class="i">Extent</span>,
                                                 <span class="s">&quot;ImportDscResourceNeedParams&quot;</span>,
                                                 <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourceNeedParams</span>)));
                }
            }
 
            <b>if</b> (<span class="r246 r">errorList</span>.<span class="i">Count</span> == 0 &amp;&amp; <span class="r248 r">moduleNameBindingResult</span> == <b>null</b> &amp;&amp; <span class="r249 r">resourceNameBindingResult</span> == <b>null</b>)
            {
                <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r239 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                             <span class="s">&quot;ImportDscResourceNeedParams&quot;</span>,
                                             <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourceNeedParams</span>)));
            }
 
            <span class="c">// Check here if Version is specified but modulename is not specified</span>
            <b>if</b> (<span class="r250 r">moduleVersionBindingResult</span> != <b>null</b> &amp;&amp; <span class="r248 r">moduleNameBindingResult</span> == <b>null</b>)
            {
                <span class="c">// only add this error again to the error list if resources is not null</span>
                <span class="c">// if resources and modules are both null we have already added this error in collection</span>
                <span class="c">// we do not want to do this twice. since we are giving same error ImportDscResourceNeedParams in both cases</span>
                <span class="c">// once we have different error messages for 2 scenarios we can remove this check</span>
                <b>if</b> (<span class="r249 r">resourceNameBindingResult</span> != <b>null</b>)
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r239 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                 <span class="s">&quot;ImportDscResourceNeedModuleNameWithModuleVersion&quot;</span>,
                                                 <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourceNeedParams</span>)));
                }
            }
 
            <b>string</b>[] <span id="r254 rd" class="r254 r">resourceNames</span> = <b>null</b>;
            <b>if</b> (<span class="r249 r">resourceNameBindingResult</span> != <b>null</b>)
            {
                <b>object</b> <span id="r255 rd" class="r255 r">resourceName</span> = <b>null</b>;
                <b>if</b> (!<a href="../engine/parser/ConstantValues.cs.html#763a3f726666bcfe" class="t t">IsConstantValueVisitor</a>.<a href="../engine/parser/ConstantValues.cs.html#594e7e13f898b0a1" class="i method">IsConstant</a>(<span class="r249 r">resourceNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>, <b>out</b> <span class="r255 r">resourceName</span>, <b>true</b>, <b>true</b>) ||
                    !<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../engine/LanguagePrimitives.cs.html#0ba3f8cd03b35aee" class="i method">TryConvertTo</a>(<span class="r255 r">resourceName</span>, <b>out</b> <span class="r254 r">resourceNames</span>))
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r249 r">resourceNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                 <span class="s">&quot;RequiresInvalidStringArgument&quot;</span>,
                                                 <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">RequiresInvalidStringArgument</span>, <span class="r242 r">nameParam</span>)));
                }
            }
 
            <span class="i n">System</span>.<span class="i">Version</span> <span id="r256 rd" class="r256 r">moduleVersion</span> = <b>null</b>;
            <b>if</b> (<span class="r250 r">moduleVersionBindingResult</span> != <b>null</b>)
            {
                <b>object</b> <span id="r257 rd" class="r257 r">moduleVer</span> = <b>null</b>;
                <b>if</b> (!<a href="../engine/parser/ConstantValues.cs.html#763a3f726666bcfe" class="t t">IsConstantValueVisitor</a>.<a href="../engine/parser/ConstantValues.cs.html#594e7e13f898b0a1" class="i method">IsConstant</a>(<span class="r250 r">moduleVersionBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>, <b>out</b> <span class="r257 r">moduleVer</span>, <b>true</b>, <b>true</b>))
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r250 r">moduleVersionBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                 <span class="s">&quot;RequiresArgumentMustBeConstant&quot;</span>,
                                                 <span class="i">ParserStrings</span>.<span class="i">RequiresArgumentMustBeConstant</span>));
                }
 
                <b>if</b> (<span class="r257 r">moduleVer</span> <b>is double</b>)
                {
                    <span class="c">// this happens in case -ModuleVersion 1.0, then use extent text for that.</span>
                    <span class="c">// The better way to do it would be define static binding API against CommandInfo, that holds information about parameter types.</span>
                    <span class="c">// This way, we can avoid this ugly special-casing and say that -ModuleVersion has type [System.Version].</span>
                    <span class="r257 r">moduleVer</span> = <span class="r250 r">moduleVersionBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../engine/parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>;
                }
 
                <b>if</b> (!<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r257 r">moduleVer</span>, <b>out</b> <span class="r256 r">moduleVersion</span>))
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r250 r">moduleVersionBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                 <span class="s">&quot;RequiresVersionInvalid&quot;</span>,
                                                 <span class="i">ParserStrings</span>.<span class="i">RequiresVersionInvalid</span>));
                }
            }
 
            <a href="../engine/Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r258 rd" class="r258 r">moduleSpecifications</span> = <b>null</b>;
            <b>if</b> (<span class="r248 r">moduleNameBindingResult</span> != <b>null</b>)
            {
                <b>object</b> <span id="r259 rd" class="r259 r">moduleName</span> = <b>null</b>;
                <b>if</b> (!<a href="../engine/parser/ConstantValues.cs.html#763a3f726666bcfe" class="t t">IsConstantValueVisitor</a>.<a href="../engine/parser/ConstantValues.cs.html#594e7e13f898b0a1" class="i method">IsConstant</a>(<span class="r248 r">moduleNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>, <b>out</b> <span class="r259 r">moduleName</span>, <b>true</b>, <b>true</b>))
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r248 r">moduleNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                 <span class="s">&quot;RequiresArgumentMustBeConstant&quot;</span>,
                                                 <span class="i">ParserStrings</span>.<span class="i">RequiresArgumentMustBeConstant</span>));
                }
 
                <b>if</b> (<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../engine/LanguagePrimitives.cs.html#0ba3f8cd03b35aee" class="i method">TryConvertTo</a>(<span class="r259 r">moduleName</span>, <b>out</b> <span class="r258 r">moduleSpecifications</span>))
                {
                    <span class="c">// if resourceNames are specified then we can not specify multiple modules name</span>
                    <b>if</b> (<span class="r258 r">moduleSpecifications</span> != <b>null</b> &amp;&amp; <span class="r258 r">moduleSpecifications</span>.<span class="i">Length</span> &gt; 1 &amp;&amp; <span class="r254 r">resourceNames</span> != <b>null</b>)
                    {
                        <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r248 r">moduleNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                     <span class="s">&quot;ImportDscResourceMultipleModulesNotSupportedWithName&quot;</span>,
                                                     <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourceMultipleModulesNotSupportedWithName</span>)));
                    }
 
                    <span class="c">// if moduleversion is specified then we can not specify multiple modules name</span>
                    <b>if</b> (<span class="r258 r">moduleSpecifications</span> != <b>null</b> &amp;&amp; <span class="r258 r">moduleSpecifications</span>.<span class="i">Length</span> &gt; 1 &amp;&amp; <span class="r256 r">moduleVersion</span> != <b>null</b>)
                    {
                        <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r248 r">moduleNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                     <span class="s">&quot;ImportDscResourceMultipleModulesNotSupportedWithVersion&quot;</span>,
                                                     <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourceNeedParams</span>)));
                    }
 
                    <span class="c">// if moduleversion is specified then we can not specify another version in modulespecification object of ModuleName</span>
                    <b>if</b> (<span class="r258 r">moduleSpecifications</span> != <b>null</b> &amp;&amp; (<span class="r258 r">moduleSpecifications</span>[0].<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> != <b>null</b> || <span class="r258 r">moduleSpecifications</span>[0].<a href="../engine/Modules/ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> != <b>null</b>) &amp;&amp; <span class="r256 r">moduleVersion</span> != <b>null</b>)
                    {
                        <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r248 r">moduleNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                     <span class="s">&quot;ImportDscResourceMultipleModuleVersionsNotSupported&quot;</span>,
                                                     <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourceNeedParams</span>)));
                    }
 
                    <span class="c">// If moduleVersion is specified we have only one module Name in valid scenario</span>
                    <span class="c">// So update it&#39;s version property in module specification object that will be used to load modules</span>
                    <b>if</b> (<span class="r258 r">moduleSpecifications</span> != <b>null</b> &amp;&amp; <span class="r258 r">moduleSpecifications</span>[0].<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> == <b>null</b> &amp;&amp; <span class="r258 r">moduleSpecifications</span>[0].<a href="../engine/Modules/ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> == <b>null</b> &amp;&amp; <span class="r256 r">moduleVersion</span> != <b>null</b>)
                    {
                        <span class="r258 r">moduleSpecifications</span>[0].<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> = <span class="r256 r">moduleVersion</span>;
                    }
                }
                <b>else</b>
                {
                    <span class="r246 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r248 r">moduleNameBindingResult</span>.<a href="../engine/CommandCompletion/PseudoParameterBinder.cs.html#2eb0a9f4c6d73128" class="i property">Value</a>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                                 <span class="s">&quot;RequiresInvalidStringArgument&quot;</span>,
                                                 <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">RequiresInvalidStringArgument</span>, <span class="r243 r">moduleNameParam</span>)));
                }
            }
 
            <b>if</b> (<span class="r246 r">errorList</span>.<span class="i">Count</span> == 0)
            {
                <span class="c">// No errors, try to load the resources</span>
                <a href="#08ab7c683307e00c" class="i method">LoadResourcesFromModule</a>(<span class="r239 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>, <span class="r258 r">moduleSpecifications</span>, <span class="r254 r">resourceNames</span>, <span class="r246 r">errorList</span>);
            }
 
            <b>return</b> <span class="r246 r">errorList</span>.<span class="i">ToArray</span>();
        }
 
        <span class="c">// This function performs semantic checks for Import-DscResource</span>
        <b>private static</b> <a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <a id="0aafa1b7e197f0c9" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ImportResourceCheckSemantics</a>(<a href="../engine/parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r260 rd" class="r260 r">kwAst</span>)
        {
            <span class="i">List</span>&lt;<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>&gt; <span id="r261 rd" class="r261 r">errorList</span> = <b>null</b>;
 
            <a href="../engine/parser/ast.cs.html#2c7580ec5eda8932" class="k">var</a> <span id="r262 rd" class="r262 r">keywordAst</span> = <a href="../engine/parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../engine/parser/ast.cs.html#4ec2535310b60c23" class="i method">GetAncestorAst</a>&lt;<a href="../engine/parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a>&gt;(<span class="r260 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a>);
            <b>while</b> (<span class="r262 r">keywordAst</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r262 r">keywordAst</span>.<a href="../engine/parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>.<span class="i">Equals</span>(<span class="s">&quot;Node&quot;</span>))
                {
                    <b>if</b> (<span class="r261 r">errorList</span> == <b>null</b>)
                    {
                        <span class="r261 r">errorList</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>&gt;();
                    }
 
                    <span class="r261 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r260 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>,
                                         <span class="s">&quot;ImportDscResourceInsideNode&quot;</span>,
                                         <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ImportDscResourceInsideNode</span>)));
                    <b>break</b>;
                }
 
                <span class="r262 r">keywordAst</span> = <a href="../engine/parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../engine/parser/ast.cs.html#4ec2535310b60c23" class="i method">GetAncestorAst</a>&lt;<a href="../engine/parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a>&gt;(<span class="r262 r">keywordAst</span>.<a href="../engine/parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a>);
            }
 
            <b>if</b> (<span class="r261 r">errorList</span> != <b>null</b>)
            {
                <b>return</b> <span class="r261 r">errorList</span>.<span class="i">ToArray</span>();
            }
            <b>else</b>
            {
                <b>return</b> <b>null</b>;
            }
        }
 
        <span class="c">// This function performs semantic checks for all DSC Resources keywords.</span>
        <b>private static</b> <a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <a id="f20e95af70c40bcb" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CheckMandatoryPropertiesPresent</a>(<a href="../engine/parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r263 rd" class="r263 r">kwAst</span>)
        {
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r264 rd" class="r264 r">mandatoryPropertiesNames</span> = <b>new</b>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <b>foreach</b> (<b>var</b> <span id="r265 rd" class="r265 r">pair</span> <b>in</b> <span class="r263 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>)
            {
                <b>if</b> (<span class="r265 r">pair</span>.<span class="i">Value</span>.<span class="i">Mandatory</span>)
                {
                    <span class="r264 r">mandatoryPropertiesNames</span>.<span class="i">Add</span>(<span class="r265 r">pair</span>.<span class="i">Key</span>);
                }
            }
 
            <span class="c">// by design mandatoryPropertiesNames are not empty at this point:</span>
            <span class="c">// every resource must have at least one Key property.</span>
 
            <a href="../engine/parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a> <span id="r266 rd" class="r266 r">hashtableAst</span> = <b>null</b>;
            <b>foreach</b> (<b>var</b> <span id="r267 rd" class="r267 r">ast</span> <b>in</b> <span class="r263 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#783dff95585ad1fe" class="i property">CommandElements</a>)
            {
                <span class="r266 r">hashtableAst</span> = <span class="r267 r">ast</span> <b>as</b> <a href="../engine/parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a>;
                <b>if</b> (<span class="r266 r">hashtableAst</span> != <b>null</b>)
                {
                    <b>break</b>;
                }
            }
 
            <b>if</b> (<span class="r266 r">hashtableAst</span> == <b>null</b>)
            {
                <span class="c">// nothing to validate</span>
                <b>return</b> <b>null</b>;
            }
 
            <b>foreach</b> (<b>var</b> <span id="r268 rd" class="r268 r">pair</span> <b>in</b> <span class="r266 r">hashtableAst</span>.<a href="../engine/parser/ast.cs.html#87313f35bc2b66d9" class="i property">KeyValuePairs</a>)
            {
                <b>object</b> <span id="r269 rd" class="r269 r">evalResultObject</span>;
                <b>if</b> (<a href="../engine/parser/ConstantValues.cs.html#763a3f726666bcfe" class="t t">IsConstantValueVisitor</a>.<span class="i">IsConstant</span>(<span class="r268 r">pair</span>.<span class="i">Item1</span>, <b>out</b> <span class="r269 r">evalResultObject</span>, <span class="i">forAttribute</span>: <b>false</b>, <span class="i">forRequires</span>: <b>false</b>))
                {
                    <b>var</b> <span id="r270 rd" class="r270 r">presentName</span> = <span class="r269 r">evalResultObject</span> <b>as string</b>;
                    <b>if</b> (<span class="r270 r">presentName</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r264 r">mandatoryPropertiesNames</span>.<span class="i">Remove</span>(<span class="r270 r">presentName</span>) &amp;&amp; <span class="r264 r">mandatoryPropertiesNames</span>.<span class="i">Count</span> == 0)
                        {
                            <span class="c">// optimization, once all mandatory properties are specified, we can safely exit.</span>
                            <b>return</b> <b>null</b>;
                        }
                    }
                }
            }
 
            <b>if</b> (<span class="r264 r">mandatoryPropertiesNames</span>.<span class="i">Count</span> &gt; 0)
            {
                <a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <span id="r271 rd" class="r271 r">errors</span> = <b>new</b> <a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[<span class="r264 r">mandatoryPropertiesNames</span>.<span class="i">Count</span>];
                <b>var</b> <span id="r272 rd" class="r272 r">extent</span> = <span class="r263 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#783dff95585ad1fe" class="i property">CommandElements</a>[0].<span class="i">Extent</span>;
                <b>int</b> <span id="r273 rd" class="r273 r">i</span> = 0;
                <b>foreach</b> (<b>string</b> <span id="r274 rd" class="r274 r">name</span> <b>in</b> <span class="r264 r">mandatoryPropertiesNames</span>)
                {
                    <span class="r271 r">errors</span>[<span class="r273 r">i</span>] = <b>new</b> <span class="t">ParseError</span>(<span class="r272 r">extent</span>, <span class="s">&quot;MissingValueForMandatoryProperty&quot;</span>,
                        <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">MissingValueForMandatoryProperty</span>,
                                    <span class="r263 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>, <span class="r263 r">kwAst</span>.<a href="../engine/parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>.<span class="i">First</span>(
                                        <span id="r275 rd" class="r275 r">p</span> =&gt; <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>.<span class="i">Equals</span>(<span class="r275 r">p</span>.<span class="i">Value</span>.<span class="i">Name</span>, <span class="r274 r">name</span>)).<span class="i">Value</span>.<span class="i">TypeConstraint</span>, <span class="r274 r">name</span>));
                    <span class="r273 r">i</span>++;
                }
 
                <b>return</b> <span class="r271 r">errors</span>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load DSC resources from specified module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r276 r">scriptExtent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Script statement loading the module, can be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r277 r">moduleSpecifications</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Module information, can be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r278 r">resourceNames</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of the resource to be loaded from module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r279 r">errorList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">List of errors reported by the method.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="08ab7c683307e00c" href="../R/08ab7c683307e00c.html" target="n" data-glyph="72,1" class="i method">LoadResourcesFromModule</a>(<a href="../engine/parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r276 rd" class="r276 r">scriptExtent</span>,
                                                           <a href="../engine/Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r277 rd" class="r277 r">moduleSpecifications</span>,
                                                           <b>string</b>[] <span id="r278 rd" class="r278 r">resourceNames</span>,
                                                           <span class="i">List</span>&lt;<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>&gt; <span id="r279 rd" class="r279 r">errorList</span>)
        {
            <span class="c">// get all required modules</span>
            <b>var</b> <span id="r280 rd" class="r280 r">modules</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
            <b>if</b> (<span class="r277 r">moduleSpecifications</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="../engine/Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="k">var</a> <span id="r281 rd" class="r281 r">moduleToImport</span> <b>in</b> <span class="r277 r">moduleSpecifications</span>)
                {
                    <b>bool</b> <span id="r282 rd" class="r282 r">foundModule</span> = <b>false</b>;
                    <b>var</b> <span id="r283 rd" class="r283 r">moduleInfos</span> = <a href="../engine/Modules/ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="../engine/Modules/ModuleCmdletBase.cs.html#b9b9dc933360a626" class="i method">GetModuleIfAvailable</a>(<span class="r281 r">moduleToImport</span>);
 
                    <b>if</b> (<span class="r283 r">moduleInfos</span>.<span class="i">Count</span> &gt;= 1 &amp;&amp; (<span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> != <b>null</b> || <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a> != <b>null</b>))
                    {
                        <b>foreach</b> (<b>var</b> <span id="r284 rd" class="r284 r">psModuleInfo</span> <b>in</b> <span class="r283 r">moduleInfos</span>)
                        {
                            <b>if</b> ((<span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>.<span class="i">HasValue</span> &amp;&amp; <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>.<span class="i">Equals</span>(<span class="r284 r">psModuleInfo</span>.<span class="i">Guid</span>)) ||
                                (<span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> != <b>null</b> &amp;&amp;
                                 <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>.<span class="i">Equals</span>(<span class="r284 r">psModuleInfo</span>.<span class="i">Version</span>)))
                            {
                                <span class="r280 r">modules</span>.<span class="i">Add</span>(<span class="r284 r">psModuleInfo</span>);
                                <span class="r282 r">foundModule</span> = <b>true</b>;
                                <b>break</b>;
                            }
                        }
                    }
                    <b>else</b> <b>if</b> (<span class="r283 r">moduleInfos</span>.<span class="i">Count</span> == 1)
                    {
                        <span class="r280 r">modules</span>.<span class="i">Add</span>(<span class="r283 r">moduleInfos</span>[0]);
                        <span class="r282 r">foundModule</span> = <b>true</b>;
                    }
 
                    <b>if</b> (!<span class="r282 r">foundModule</span>)
                    {
                        <b>if</b> (<span class="r283 r">moduleInfos</span>.<span class="i">Count</span> &gt; 1)
                        {
                            <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>,
                                                         <span class="s">&quot;MultipleModuleEntriesFoundDuringParse&quot;</span>,
                                                         <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>,
                                                                       <span class="i">ParserStrings</span>.<span class="i">MultipleModuleEntriesFoundDuringParse</span>,
                                                                       <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>)));
                        }
                        <b>else</b>
                        {
                            <b>string</b> <span id="r285 rd" class="r285 r">moduleString</span> = <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> == <b>null</b>
                                ? <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>
                                : <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="s">&quot;&lt;{0}, {1}&gt;&quot;</span>, <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="r281 r">moduleToImport</span>.<a href="../engine/Modules/ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>);
 
                            <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>, <span class="s">&quot;ModuleNotFoundDuringParse&quot;</span>,
                                <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ModuleNotFoundDuringParse</span>, <span class="r285 r">moduleString</span>)));
                        }
 
                        <b>return</b>;
                    }
                }
            }
            <b>else</b> <b>if</b> (<span class="r278 r">resourceNames</span> != <b>null</b>)
            {
                <span class="c">// Lookup the required resources under available PowerShell modules when modulename is not specified</span>
                <b>using</b> (<a href="../engine/hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r286 rd" class="r286 r">powerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../engine/hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../engine/hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../engine/hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../engine/hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>))
                {
                    <span class="r286 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Get-Module&quot;</span>);
                    <span class="r286 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#ad181c9dec5e4ffa" class="i method">AddParameter</a>(<span class="s">&quot;ListAvailable&quot;</span>);
                    <span class="r280 r">modules</span> = <span class="r286 r">powerShell</span>.<a href="../engine/hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
                }
            }
 
            <span class="c">// When ModuleName only specified, we need to import all resources from that module</span>
            <b>var</b> <span id="r287 rd" class="r287 r">resourcesToImport</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <b>if</b> (<span class="r278 r">resourceNames</span> == <b>null</b> || <span class="r278 r">resourceNames</span>.<span class="i">Length</span> == 0)
            {
                <span class="r287 r">resourcesToImport</span>.<span class="i">Add</span>(<span class="s">&quot;*&quot;</span>);
            }
            <b>else</b>
            {
                <span class="r287 r">resourcesToImport</span>.<span class="i">AddRange</span>(<span class="r278 r">resourceNames</span>);
            }
 
            <b>foreach</b> (<b>var</b> <span id="r288 rd" class="r288 r">moduleInfo</span> <b>in</b> <span class="r280 r">modules</span>)
            {
                <b>var</b> <span id="r289 rd" class="r289 r">dscResourcesPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r288 r">moduleInfo</span>.<span class="i">ModuleBase</span>, <span class="s">&quot;DscResources&quot;</span>);
 
                <b>var</b> <span id="r290 rd" class="r290 r">resourcesFound</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                <span class="i">LoadPowerShellClassResourcesFromModule</span>(<span class="r288 r">moduleInfo</span>, <span class="r288 r">moduleInfo</span>, <span class="r287 r">resourcesToImport</span>, <span class="r290 r">resourcesFound</span>, <span class="r279 r">errorList</span>, <b>null</b>, <b>true</b>, <span class="r276 r">scriptExtent</span>);
 
                <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r289 r">dscResourcesPath</span>))
                {
                    <b>foreach</b> (<b>var</b> <span id="r291 rd" class="r291 r">resourceToImport</span> <b>in</b> <span class="r287 r">resourcesToImport</span>)
                    {
                        <b>bool</b> <span id="r292 rd" class="r292 r">foundResources</span> = <b>false</b>;
                        <b>foreach</b> (<b>var</b> <span id="r293 rd" class="r293 r">resourceDir</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateDirectories</span>(<span class="r289 r">dscResourcesPath</span>, <span class="r291 r">resourceToImport</span>))
                        {
                            <b>var</b> <span id="r294 rd" class="r294 r">resourceName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r293 r">resourceDir</span>);
 
                            <b>bool</b> <span id="r295 rd" class="r295 r">foundCimSchema</span> = <b>false</b>;
                            <b>bool</b> <span id="r296 rd" class="r296 r">foundScriptSchema</span> = <b>false</b>;
                            <b>string</b> <span id="r297 rd" class="r297 r">schemaMofFilePath</span> = <b>string</b>.<span class="i">Empty</span>;
 
                            <b>try</b>
                            {
                                <span class="r295 r">foundCimSchema</span> = <span class="i">ImportCimKeywordsFromModule</span>(<span class="r288 r">moduleInfo</span>, <span class="r294 r">resourceName</span>, <b>out</b> <span class="r297 r">schemaMofFilePath</span>);
                            }
                            <b>catch</b> (<span class="i">FileNotFoundException</span>)
                            {
                                <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>,
                                                             <span class="s">&quot;SchemaFileNotFound&quot;</span>,
                                                             <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">SchemaFileNotFound</span>, <span class="r297 r">schemaMofFilePath</span>)));
                            }
                            <b>catch</b> (<a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r298 rd" class="r298 r">e</span>)
                            {
                                <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>,
                                                            <span class="r298 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>.<a href="../engine/ErrorPackage.cs.html#80d40f16f77d32bb" class="i property">FullyQualifiedErrorId</a>,
                                                            <span class="r298 r">e</span>.<span class="i">Message</span>));
                            }
                            <b>catch</b> (<span class="i">Exception</span> <span id="r299 rd" class="r299 r">e</span>)
                            {
                                <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>,
                                                             <span class="s">&quot;ExceptionParsingMOFFile&quot;</span>,
                                                             <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">ExceptionParsingMOFFile</span>, <span class="r297 r">schemaMofFilePath</span>, <span class="r299 r">e</span>.<span class="i">Message</span>)));
                            }
 
                            <b>var</b> <span id="r300 rd" class="r300 r">schemaScriptFilePath</span> = <b>string</b>.<span class="i">Empty</span>;
 
                            <b>try</b>
                            {
                                <span class="r296 r">foundScriptSchema</span> = <span class="i">ImportScriptKeywordsFromModule</span>(<span class="r288 r">moduleInfo</span>, <span class="r294 r">resourceName</span>, <b>out</b> <span class="r300 r">schemaScriptFilePath</span>);
                            }
                            <b>catch</b> (<span class="i">FileNotFoundException</span>)
                            {
                                <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>,
                                                             <span class="s">&quot;SchemaFileNotFound&quot;</span>,
                                                             <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">SchemaFileNotFound</span>, <span class="r300 r">schemaScriptFilePath</span>)));
                            }
                            <b>catch</b> (<span class="i">Exception</span> <span id="r301 rd" class="r301 r">e</span>)
                            {
                                <span class="c">// This shouldn&#39;t happen so just report the error as is</span>
                                <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>,
                                                             <span class="s">&quot;UnexpectedParseError&quot;</span>,
                                                             <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="r301 r">e</span>.<span class="i">ToString</span>())));
                            }
 
                            <b>if</b> (<span class="r295 r">foundCimSchema</span> || <span class="r296 r">foundScriptSchema</span>)
                            {
                                <span class="r292 r">foundResources</span> = <b>true</b>;
                            }
                        }
 
                        <span class="c">//</span>
                        <span class="c">// resourceToImport may be the friendly name of the DSC resource</span>
                        <span class="c">//</span>
                        <b>if</b> (!<span class="r292 r">foundResources</span>)
                        {
                            <b>try</b>
                            {
                                <b>string</b> <span id="r302 rd" class="r302 r">unused</span>;
                                <span class="r292 r">foundResources</span> = <span class="i">ImportCimKeywordsFromModule</span>(<span class="r288 r">moduleInfo</span>, <span class="r291 r">resourceToImport</span>, <b>out</b> <span class="r302 r">unused</span>);
                            }
                            <b>catch</b> (<span class="i">Exception</span>)
                            {
                            }
                        }
 
                        <span class="c">// resource name without wildcard (*) should be imported only once</span>
                        <b>if</b> (!<span class="r291 r">resourceToImport</span>.<span class="i">Contains</span>(<span class="s">&#39;*&#39;</span>) &amp;&amp; <span class="r292 r">foundResources</span>)
                        {
                            <span class="r290 r">resourcesFound</span>.<span class="i">Add</span>(<span class="r291 r">resourceToImport</span>);
                        }
                    }
                }
 
                <b>foreach</b> (<b>var</b> <span id="r303 rd" class="r303 r">resource</span> <b>in</b> <span class="r290 r">resourcesFound</span>)
                {
                    <span class="r287 r">resourcesToImport</span>.<span class="i">Remove</span>(<span class="r303 r">resource</span>);
                }
 
                <b>if</b> (<span class="r287 r">resourcesToImport</span>.<span class="i">Count</span> == 0)
                {
                    <b>break</b>;
                }
            }
 
            <b>if</b> (<span class="r287 r">resourcesToImport</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>foreach</b> (<b>var</b> <span id="r304 rd" class="r304 r">resourceNameToImport</span> <b>in</b> <span class="r287 r">resourcesToImport</span>)
                {
                    <b>if</b> (!<span class="r304 r">resourceNameToImport</span>.<span class="i">Contains</span>(<span class="s">&#39;*&#39;</span>))
                    {
                        <span class="r279 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r276 r">scriptExtent</span>,
                                                     <span class="s">&quot;DscResourcesNotFoundDuringParsing&quot;</span>,
                                                     <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">DscResourcesNotFoundDuringParsing</span>, <span class="r304 r">resourceNameToImport</span>)));
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="7b63b18eedb21725" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">LoadPowerShellClassResourcesFromModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r305 rd" class="r305 r">primaryModuleInfo</span>, <a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r306 rd" class="r306 r">moduleInfo</span>, <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r307 rd" class="r307 r">resourcesToImport</span>, <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r308 rd" class="r308 r">resourcesFound</span>,
            <span class="i">List</span>&lt;<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>&gt; <span id="r309 rd" class="r309 r">errorList</span>,
            <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r310 rd" class="r310 r">functionsToDefine</span> = <b>null</b>,
            <b>bool</b> <span id="r311 rd" class="r311 r">recurse</span> = <b>true</b>,
            <a href="../engine/parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r312 rd" class="r312 r">extent</span> = <b>null</b>)
        {
            <b>if</b> (<span class="r305 r">primaryModuleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a> == <b>null</b> || <span class="r305 r">primaryModuleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a>.<span class="i">Count</span> == 0)
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> == <a href="../engine/Modules/PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="../engine/Modules/PSModuleInfo.cs.html#1c66a8819a72670d" class="i field">Binary</a>)
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">CORECLR</span>
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<span class="s">&quot;isConfiguration&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">ConfigurationNotSupportedInPowerShellCore</span>);
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">                ResolveEventHandler reh = (sender, args) =&gt; CurrentDomain_ReflectionOnlyAssemblyResolve(sender, args, moduleInfo);
 
                try
                {
                    AppDomain.CurrentDomain.ReflectionOnlyAssemblyResolve += reh;
                    var assembly = moduleInfo.ImplementingAssembly;
                    if (assembly == null &amp;&amp; moduleInfo.Path != null)
                    {
                        try
                        {
                            var path = moduleInfo.Path;
 
                            if (moduleInfo.RootModule != null &amp;&amp; !Path.GetExtension(moduleInfo.Path).Equals(&quot;.dll&quot;, StringComparison.OrdinalIgnoreCase))
                            {
                                path = moduleInfo.ModuleBase + &quot;\\&quot; + moduleInfo.RootModule;
                            }
 
                            assembly = Assembly.ReflectionOnlyLoadFrom(path);
                        }
                        catch { }
                    }
 
                    // Ignore the module if we can&#39;t find the assembly.
                    if (assembly != null)
                    {
                        ImportKeywordsFromAssembly(moduleInfo, resourcesToImport, resourcesFound, functionsToDefine, assembly);
                    }
                }
                finally
                {
                    AppDomain.CurrentDomain.ReflectionOnlyAssemblyResolve -= reh;
                }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
            <b>else</b>
            {
                <b>string</b> <span id="r313 rd" class="r313 r">scriptPath</span> = <b>null</b>;
                <span class="c">// handle RootModule and nestedModule together</span>
                <b>if</b> (<span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> != <b>null</b>)
                {
                    <span class="r313 r">scriptPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>, <span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a>);
                }
                <b>else</b> <b>if</b> (<span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a> != <b>null</b>)
                {
                    <span class="r313 r">scriptPath</span> = <span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>;
                }
 
                <a href="#c970e61500335419" class="i method">ImportKeywordsFromScriptFile</a>(<span class="r313 r">scriptPath</span>, <span class="r305 r">primaryModuleInfo</span>, <span class="r307 r">resourcesToImport</span>, <span class="r308 r">resourcesFound</span>, <span class="r310 r">functionsToDefine</span>, <span class="r309 r">errorList</span>, <span class="r312 r">extent</span>);
            }
 
            <b>if</b> (<span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a> != <b>null</b> &amp;&amp; <span class="r311 r">recurse</span>)
            {
                <b>foreach</b> (<b>var</b> <span id="r314 rd" class="r314 r">nestedModule</span> <b>in</b> <span class="r306 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>)
                {
                    <span class="i">LoadPowerShellClassResourcesFromModule</span>(<span class="r305 r">primaryModuleInfo</span>, <span class="r314 r">nestedModule</span>, <span class="r307 r">resourcesToImport</span>, <span class="r308 r">resourcesFound</span>, <span class="r309 r">errorList</span>, <span class="r310 r">functionsToDefine</span>, <span class="i">recurse</span>: <b>false</b>, <span class="i">extent</span>: <span class="r312 r">extent</span>);
                }
            }
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">CORECLR</span>
<span class="e">        private static Assembly CurrentDomain_ReflectionOnlyAssemblyResolve(object sender, ResolveEventArgs args, PSModuleInfo moduleInfo)
        {
            AssemblyName name = new AssemblyName(args.Name);
 
            if (moduleInfo != null &amp;&amp; !string.IsNullOrEmpty(moduleInfo.Path))
            {
                string asmToCheck = Path.GetDirectoryName(moduleInfo.Path) + &quot;\\&quot; + name.Name + &quot;.dll&quot;;
                if (File.Exists(asmToCheck))
                {
                    return Assembly.ReflectionOnlyLoadFrom(asmToCheck);
                }
 
                asmToCheck = Path.GetDirectoryName(moduleInfo.Path) + &quot;\\&quot; + name.Name + &quot;.exe&quot;;
                if (File.Exists(asmToCheck))
                {
                    return Assembly.ReflectionOnlyLoadFrom(asmToCheck);
                }
            }
 
            return Assembly.ReflectionOnlyLoad(args.Name);
        }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r315 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r316 r">resourcesToImport</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r317 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The list of resources imported from this module.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="51947aa830f5677c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ImportClassResourcesFromModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r315 rd" class="r315 r">moduleInfo</span>, <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r316 rd" class="r316 r">resourcesToImport</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r317 rd" class="r317 r">functionsToDefine</span>)
        {
            <b>var</b> <span id="r318 rd" class="r318 r">resourcesImported</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <span class="i">LoadPowerShellClassResourcesFromModule</span>(<span class="r315 r">moduleInfo</span>, <span class="r315 r">moduleInfo</span>, <span class="r316 r">resourcesToImport</span>, <span class="r318 r">resourcesImported</span>, <b>null</b>, <span class="r317 r">functionsToDefine</span>);
            <b>return</b> <span class="r318 r">resourcesImported</span>;
        }
 
        <b>internal static string</b> <a id="a2b4e86c2ee3f162" href="../R/a2b4e86c2ee3f162.html" target="n" data-glyph="74,1" class="i method">GenerateMofForAst</a>(<a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r319 rd" class="r319 r">typeAst</span>)
        {
            <b>var</b> <span id="r320 rd" class="r320 r">embeddedInstanceTypes</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <b>var</b> <span id="r321 rd" class="r321 r">sb</span> = <b>new</b> <span class="i">StringBuilder</span>();
 
            <a href="#ca09426e00327800" class="i method">GenerateMofForAst</a>(<span class="r319 r">typeAst</span>, <span class="r321 r">sb</span>, <span class="r320 r">embeddedInstanceTypes</span>);
            <b>var</b> <span id="r322 rd" class="r322 r">visitedInstances</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <span class="r322 r">visitedInstances</span>.<span class="i">Add</span>(<span class="r319 r">typeAst</span>);
            <a href="#8b0a3a7f7015c76f" class="i method">ProcessEmbeddedInstanceTypes</a>(<span class="r320 r">embeddedInstanceTypes</span>, <span class="r322 r">visitedInstances</span>, <span class="r321 r">sb</span>);
 
            <b>return</b> <span class="r321 r">sb</span>.<span class="i">ToString</span>();
        }
 
        <b>internal static string</b> <a id="4914925e7a102fa7" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">MapTypeNameToMofType</a>(<a href="../engine/parser/ast.cs.html#a422e1772da6dbc8" class="t t">ITypeName</a> <span id="r323 rd" class="r323 r">typeName</span>, <b>string</b> <span id="r324 rd" class="r324 r">memberName</span>, <b>string</b> <span id="r325 rd" class="r325 r">className</span>, <b>out bool</b> <span id="r326 rd" class="r326 r">isArrayType</span>, <b>out string</b> <span id="r327 rd" class="r327 r">embeddedInstanceType</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r328 rd" class="r328 r">embeddedInstanceTypes</span>, <b>ref string</b>[] <span id="r329 rd" class="r329 r">enumNames</span>)
        {
            <a href="../engine/parser/ast.cs.html#83b43c1855a09e15" class="t t">TypeName</a> <span id="r330 rd" class="r330 r">propTypeName</span>;
            <a href="../engine/parser/ast.cs.html#8588eb9308b68261" class="k">var</a> <span id="r331 rd" class="r331 r">arrayTypeName</span> = <span class="r323 r">typeName</span> <b>as</b> <a href="../engine/parser/ast.cs.html#8588eb9308b68261" class="t t">ArrayTypeName</a>;
            <b>if</b> (<span class="r331 r">arrayTypeName</span> != <b>null</b>)
            {
                <span class="r326 r">isArrayType</span> = <b>true</b>;
                <span class="r330 r">propTypeName</span> = <span class="r331 r">arrayTypeName</span>.<a href="../engine/parser/ast.cs.html#0f81729ec1838610" class="i property">ElementType</a> <b>as</b> <a href="../engine/parser/ast.cs.html#83b43c1855a09e15" class="t t">TypeName</a>;
            }
            <b>else</b>
            {
                <span class="r326 r">isArrayType</span> = <b>false</b>;
                <span class="r330 r">propTypeName</span> = <span class="r323 r">typeName</span> <b>as</b> <a href="../engine/parser/ast.cs.html#83b43c1855a09e15" class="t t">TypeName</a>;
            }
 
            <b>if</b> (<span class="r330 r">propTypeName</span> == <b>null</b> || <span class="r330 r">propTypeName</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">NotSupportedException</span>(<b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">ParserStrings</span>.<span class="i">UnsupportedPropertyTypeOfDSCResourceClass</span>,
                    <span class="r324 r">memberName</span>,
                    <span class="r323 r">typeName</span>.<a href="../engine/parser/ast.cs.html#15c64a580f477707" class="i property">FullName</a>,
                    <span class="r323 r">typeName</span>));
            }
 
            <b>if</b> (<span class="r330 r">propTypeName</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a>.<a href="../engine/parser/ast.cs.html#26f9adfa0f5150bd" class="i property">IsEnum</a>)
            {
                <span class="r329 r">enumNames</span> = <span class="r330 r">propTypeName</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a>.<a href="../engine/parser/ast.cs.html#9f439131b4d83a32" class="i property">Members</a>.<span class="i">Select</span>(<b>static</b> <span id="r332 rd" class="r332 r">m</span> =&gt; <span class="r332 r">m</span>.<span class="i">Name</span>).<span class="i">ToArray</span>();
                <span class="r326 r">isArrayType</span> = <b>false</b>;
                <span class="r327 r">embeddedInstanceType</span> = <b>null</b>;
                <b>return</b> <span class="s">&quot;string&quot;</span>;
            }
 
            <b>if</b> (!<span class="r328 r">embeddedInstanceTypes</span>.<span class="i">Contains</span>(<span class="r330 r">propTypeName</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a>))
            {
                <span class="r328 r">embeddedInstanceTypes</span>.<span class="i">Add</span>(<span class="r330 r">propTypeName</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a>);
            }
 
            <span class="c">// The type is obviously not a string, but in the mof, we represent</span>
            <span class="c">// it as string (really, embeddedinstance of the class type)</span>
            <span class="r327 r">embeddedInstanceType</span> = <span class="r330 r">propTypeName</span>.<a href="../engine/parser/ast.cs.html#a9592c89dfa9c9ad" class="i property">Name</a>.<span class="i">Replace</span>(<span class="s">&#39;.&#39;</span>, <span class="s">&#39;_&#39;</span>);
            <b>return</b> <span class="s">&quot;string&quot;</span>;
        }
 
        <b>private static void</b> <a id="ca09426e00327800" href="../R/ca09426e00327800.html" target="n" data-glyph="76,1" class="i method">GenerateMofForAst</a>(<a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r333 rd" class="r333 r">typeAst</span>, <span class="i">StringBuilder</span> <span id="r334 rd" class="r334 r">sb</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r335 rd" class="r335 r">embeddedInstanceTypes</span>)
        {
            <b>var</b> <span id="r336 rd" class="r336 r">className</span> = <span class="r333 r">typeAst</span>.<a href="../engine/parser/ast.cs.html#b2edb6e99afb6054" class="i property">Name</a>;
            <span class="r334 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;[ClassVersion(\&quot;1.0.0\&quot;), FriendlyName(\&quot;{0}\&quot;)]\nclass {0}&quot;</span>, <span class="r336 r">className</span>);
 
            <b>if</b> (<span class="r333 r">typeAst</span>.<a href="../engine/parser/ast.cs.html#9bd8b4fdfddab8c7" class="i property">Attributes</a>.<span class="i">Any</span>(<b>static</b> <span id="r337 rd" class="r337 r">a</span> =&gt; <span class="r337 r">a</span>.<span class="i">TypeName</span>.<span class="i">GetReflectionAttributeType</span>() == <b>typeof</b>(<a href="../engine/Attributes.cs.html#07160ce4e78c3181" class="t t">DscResourceAttribute</a>)))
            {
                <span class="r334 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot; : OMI_BaseResource&quot;</span>);
            }
 
            <span class="r334 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;\n{\n&quot;</span>);
 
            <a href="#acc5742793c321fc" class="i method">ProcessMembers</a>(<span class="r334 r">sb</span>, <span class="r335 r">embeddedInstanceTypes</span>, <span class="r333 r">typeAst</span>, <span class="r336 r">className</span>);
 
            <span class="i">Queue</span>&lt;<b>object</b>&gt; <span id="r338 rd" class="r338 r">bases</span> = <b>new</b>();
            <b>foreach</b> (<b>var</b> <span id="r339 rd" class="r339 r">b</span> <b>in</b> <span class="r333 r">typeAst</span>.<a href="../engine/parser/ast.cs.html#10a87071659a5887" class="i property">BaseTypes</a>)
            {
                <span class="r338 r">bases</span>.<span class="i">Enqueue</span>(<span class="r339 r">b</span>);
            }
 
            <b>while</b> (<span class="r338 r">bases</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>var</b> <span id="r340 rd" class="r340 r">b</span> = <span class="r338 r">bases</span>.<span class="i">Dequeue</span>();
                <a href="../engine/parser/ast.cs.html#34b9d5dbbaca964d" class="k">var</a> <span id="r341 rd" class="r341 r">tc</span> = <span class="r340 r">b</span> <b>as</b> <a href="../engine/parser/ast.cs.html#34b9d5dbbaca964d" class="t t">TypeConstraintAst</a>;
 
                <b>if</b> (<span class="r341 r">tc</span> != <b>null</b>)
                {
                    <span class="r340 r">b</span> = <span class="r341 r">tc</span>.<a href="../engine/parser/ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a>.<a href="../engine/parser/ast.cs.html#eba83ef9fd0feedd" class="i method">GetReflectionType</a>();
                    <b>if</b> (<span class="r340 r">b</span> == <b>null</b>)
                    {
                        <a href="../engine/parser/ast.cs.html#83b43c1855a09e15" class="k">var</a> <span id="r342 rd" class="r342 r">td</span> = <span class="r341 r">tc</span>.<a href="../engine/parser/ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a> <b>as</b> <a href="../engine/parser/ast.cs.html#83b43c1855a09e15" class="t t">TypeName</a>;
                        <b>if</b> (<span class="r342 r">td</span> != <b>null</b> &amp;&amp; <span class="r342 r">td</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a> != <b>null</b>)
                        {
                            <a href="#acc5742793c321fc" class="i method">ProcessMembers</a>(<span class="r334 r">sb</span>, <span class="r335 r">embeddedInstanceTypes</span>, <span class="r342 r">td</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a>, <span class="r336 r">className</span>);
                            <b>foreach</b> (<b>var</b> <span id="r343 rd" class="r343 r">b1</span> <b>in</b> <span class="r342 r">td</span>.<a href="../engine/parser/ast.cs.html#6cfa32d15ba13d9d" class="i field">_typeDefinitionAst</a>.<a href="../engine/parser/ast.cs.html#10a87071659a5887" class="i property">BaseTypes</a>)
                            {
                                <span class="r338 r">bases</span>.<span class="i">Enqueue</span>(<span class="r343 r">b1</span>);
                            }
                        }
 
                        <b>continue</b>;
                    }
                }
 
                <b>var</b> <span id="r344 rd" class="r344 r">type</span> = <span class="r340 r">b</span> <b>as</b> <span class="i">Type</span>;
                <b>if</b> (<span class="r344 r">type</span> != <b>null</b>)
                {
                    <a href="#320c3bb1e1fd6032" class="i method">ProcessMembers</a>(<span class="r344 r">type</span>, <span class="r334 r">sb</span>, <span class="r335 r">embeddedInstanceTypes</span>, <span class="r336 r">className</span>);
                    <b>var</b> <span id="r345 rd" class="r345 r">t</span> = <span class="r344 r">type</span>.<span class="i">BaseType</span>;
                    <b>if</b> (<span class="r345 r">t</span> != <b>null</b>)
                    {
                        <span class="r338 r">bases</span>.<span class="i">Enqueue</span>(<span class="r345 r">t</span>);
                    }
                }
            }
 
            <span class="r334 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;};&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the line no for DSC Class Resource Get/Set/Test methods.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r346 r">typeDefinitionAst</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r347 r">methodsLinePosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="b8822d21f06a13b7" href="../R/b8822d21f06a13b7.html" target="n" data-glyph="76,1" class="i method">GetResourceMethodsLineNumber</a>(<a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r346 rd" class="r346 r">typeDefinitionAst</span>, <b>out</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt; <span id="r347 rd" class="r347 r">methodsLinePosition</span>)
        {
            <b>const string</b> <span id="r348 rd" class="r348 r">getMethodName</span> = <span class="s">&quot;Get&quot;</span>;
            <b>const string</b> <span id="r349 rd" class="r349 r">setMethodName</span> = <span class="s">&quot;Set&quot;</span>;
            <b>const string</b> <span id="r350 rd" class="r350 r">testMethodName</span> = <span class="s">&quot;Test&quot;</span>;
 
            <span class="r347 r">methodsLinePosition</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;();
            <b>foreach</b> (<b>var</b> <span id="r351 rd" class="r351 r">member</span> <b>in</b> <span class="r346 r">typeDefinitionAst</span>.<a href="../engine/parser/ast.cs.html#9f439131b4d83a32" class="i property">Members</a>)
            {
                <a href="../engine/parser/ast.cs.html#0c4f2db9a681a977" class="k">var</a> <span id="r352 rd" class="r352 r">functionMemberAst</span> = <span class="r351 r">member</span> <b>as</b> <a href="../engine/parser/ast.cs.html#0c4f2db9a681a977" class="t t">FunctionMemberAst</a>;
                <b>if</b> (<span class="r352 r">functionMemberAst</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r352 r">functionMemberAst</span>.<a href="../engine/parser/ast.cs.html#4a93ad116ed68e0e" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r348 r">getMethodName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r347 r">methodsLinePosition</span>[<span class="r348 r">getMethodName</span>] = <span class="r352 r">functionMemberAst</span>.<a href="../engine/parser/ast.cs.html#7383b4996970fa8a" class="i property">NameExtent</a>.<a href="../engine/parser/Position.cs.html#cc356dc28b41997d" class="i property">StartLineNumber</a>;
                    }
                    <b>else</b> <b>if</b> (<span class="r352 r">functionMemberAst</span>.<a href="../engine/parser/ast.cs.html#4a93ad116ed68e0e" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r349 r">setMethodName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r347 r">methodsLinePosition</span>[<span class="r349 r">setMethodName</span>] = <span class="r352 r">functionMemberAst</span>.<a href="../engine/parser/ast.cs.html#7383b4996970fa8a" class="i property">NameExtent</a>.<a href="../engine/parser/Position.cs.html#cc356dc28b41997d" class="i property">StartLineNumber</a>;
                    }
                    <b>else</b> <b>if</b> (<span class="r352 r">functionMemberAst</span>.<a href="../engine/parser/ast.cs.html#4a93ad116ed68e0e" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r350 r">testMethodName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r347 r">methodsLinePosition</span>[<span class="r350 r">testMethodName</span>] = <span class="r352 r">functionMemberAst</span>.<a href="../engine/parser/ast.cs.html#7383b4996970fa8a" class="i property">NameExtent</a>.<a href="../engine/parser/Position.cs.html#cc356dc28b41997d" class="i property">StartLineNumber</a>;
                    }
                }
            }
 
            <span class="c">// All 3 methods (Get/Set/Test) position should be found.</span>
            <b>return</b> (<span class="r347 r">methodsLinePosition</span>.<span class="i">Count</span> == 3);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the line no for DSC Class Resource Get/Set/Test methods.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r353 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r354 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r355 r">resourceMethodsLinePosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r356 r">resourceFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="e2c47c4f7ab11626" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetResourceMethodsLinePosition</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r353 rd" class="r353 r">moduleInfo</span>, <b>string</b> <span id="r354 rd" class="r354 r">resourceName</span>, <b>out</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt; <span id="r355 rd" class="r355 r">resourceMethodsLinePosition</span>, <b>out string</b> <span id="r356 rd" class="r356 r">resourceFilePath</span>)
        {
            <span class="r355 r">resourceMethodsLinePosition</span> = <b>null</b>;
            <span class="r356 r">resourceFilePath</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<span class="r353 r">moduleInfo</span> == <b>null</b> || <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r354 r">resourceName</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="i">IEnumerable</span>&lt;<a href="../engine/parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <span id="r357 rd" class="r357 r">resourceDefinitions</span>;
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r358 rd" class="r358 r">moduleFiles</span> = <b>new</b>();
            <b>if</b> (<span class="r353 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> != <b>null</b>)
            {
                <span class="r358 r">moduleFiles</span>.<span class="i">Add</span>(<span class="r353 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
            }
 
            <b>if</b> (<span class="r353 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r359 rd" class="r359 r">nestedModule</span> <b>in</b> <span class="r353 r">moduleInfo</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>.<span class="i">Where</span>(<b>static</b> <span id="r360 rd" class="r360 r">m</span> =&gt; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r360 r">m</span>.<span class="i">Path</span>)))
                {
                    <span class="r358 r">moduleFiles</span>.<span class="i">Add</span>(<span class="r359 r">nestedModule</span>.<span class="i">Path</span>);
                }
            }
 
            <b>foreach</b> (<b>string</b> <span id="r361 rd" class="r361 r">moduleFile</span> <b>in</b> <span class="r358 r">moduleFiles</span>)
            {
                <b>if</b> (<a href="#8d65cd8521489714" class="i method">GetResourceDefinitionsFromModule</a>(<span class="r361 r">moduleFile</span>, <b>out</b> <span class="r357 r">resourceDefinitions</span>, <b>null</b>, <b>null</b>))
                {
                    <b>foreach</b> (<b>var</b> <span id="r362 rd" class="r362 r">r</span> <b>in</b> <span class="r357 r">resourceDefinitions</span>)
                    {
                        <a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="k">var</a> <span id="r363 rd" class="r363 r">resourceDefnAst</span> = (<a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a>)<span class="r362 r">r</span>;
                        <b>if</b> (!<span class="r354 r">resourceName</span>.<span class="i">Equals</span>(<span class="r363 r">resourceDefnAst</span>.<a href="../engine/parser/ast.cs.html#b2edb6e99afb6054" class="i property">Name</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>continue</b>;
                        }
 
                        <b>if</b> (<a href="#b8822d21f06a13b7" class="i method">GetResourceMethodsLineNumber</a>(<span class="r363 r">resourceDefnAst</span>, <b>out</b> <span class="r355 r">resourceMethodsLinePosition</span>))
                        {
                            <span class="r356 r">resourceFilePath</span> = <span class="r361 r">moduleFile</span>;
                            <b>return</b> <b>true</b>;
                        }
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static void</b> <a id="acc5742793c321fc" href="../R/acc5742793c321fc.html" target="n" data-glyph="76,1" class="i method">ProcessMembers</a>(<span class="i">StringBuilder</span> <span id="r364 rd" class="r364 r">sb</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r365 rd" class="r365 r">embeddedInstanceTypes</span>, <a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r366 rd" class="r366 r">typeDefinitionAst</span>, <b>string</b> <span id="r367 rd" class="r367 r">className</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r368 rd" class="r368 r">member</span> <b>in</b> <span class="r366 r">typeDefinitionAst</span>.<a href="../engine/parser/ast.cs.html#9f439131b4d83a32" class="i property">Members</a>)
            {
                <a href="../engine/parser/ast.cs.html#88ad8abafd061e97" class="k">var</a> <span id="r369 rd" class="r369 r">property</span> = <span class="r368 r">member</span> <b>as</b> <a href="../engine/parser/ast.cs.html#88ad8abafd061e97" class="t t">PropertyMemberAst</a>;
 
                <b>if</b> (<span class="r369 r">property</span> == <b>null</b> || <span class="r369 r">property</span>.<a href="../engine/parser/ast.cs.html#a4fccd8c1d834725" class="i property">IsStatic</a> ||
                    <span class="r369 r">property</span>.<a href="../engine/parser/ast.cs.html#8ea99b56a0b0002a" class="i property">Attributes</a>.<span class="i">All</span>(<span id="r370 rd" class="r370 r">a</span> =&gt; <span class="r370 r">a</span>.<span class="i">TypeName</span>.<span class="i">GetReflectionAttributeType</span>() != <b>typeof</b>(<a href="../engine/Attributes.cs.html#4f12f4e96778ea95" class="t t">DscPropertyAttribute</a>)))
                {
                    <b>continue</b>;
                }
 
                <b>var</b> <span id="r371 rd" class="r371 r">memberType</span> = <span class="r369 r">property</span>.<a href="../engine/parser/ast.cs.html#15850665413648cb" class="i property">PropertyType</a> == <b>null</b>
                    ? <b>typeof</b>(<b>object</b>)
                    : <span class="r369 r">property</span>.<a href="../engine/parser/ast.cs.html#15850665413648cb" class="i property">PropertyType</a>.<a href="../engine/parser/ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a>.<a href="../engine/parser/ast.cs.html#eba83ef9fd0feedd" class="i method">GetReflectionType</a>();
 
                <b>var</b> <span id="r372 rd" class="r372 r">attributes</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
                <b>for</b> (<b>int</b> <span id="r373 rd" class="r373 r">i</span> = 0; <span class="r373 r">i</span> &lt; <span class="r369 r">property</span>.<a href="../engine/parser/ast.cs.html#8ea99b56a0b0002a" class="i property">Attributes</a>.<span class="i">Count</span>; <span class="r373 r">i</span>++)
                {
                    <span class="r372 r">attributes</span>.<span class="i">Add</span>(<span class="r369 r">property</span>.<a href="../engine/parser/ast.cs.html#8ea99b56a0b0002a" class="i property">Attributes</a>[<span class="r373 r">i</span>].<span class="i">GetAttribute</span>());
                }
 
                <b>string</b> <span id="r374 rd" class="r374 r">mofType</span>;
                <b>bool</b> <span id="r375 rd" class="r375 r">isArrayType</span>;
                <b>string</b> <span id="r376 rd" class="r376 r">embeddedInstanceType</span>;
                <b>string</b>[] <span id="r377 rd" class="r377 r">enumNames</span> = <b>null</b>;
 
                <b>if</b> (<span class="r371 r">memberType</span> != <b>null</b>)
                {
                    <span class="c">// TODO - validate type and name</span>
                    <span class="r374 r">mofType</span> = <span class="i">MapTypeToMofType</span>(<span class="r371 r">memberType</span>, <span class="r368 r">member</span>.<span class="i">Name</span>, <span class="r367 r">className</span>, <b>out</b> <span class="r375 r">isArrayType</span>,
                        <b>out</b> <span class="r376 r">embeddedInstanceType</span>,
                        <span class="r365 r">embeddedInstanceTypes</span>);
                    <b>if</b> (<span class="r371 r">memberType</span>.<span class="i">IsEnum</span>)
                    {
                        <span class="r377 r">enumNames</span> = <span class="i">Enum</span>.<span class="i">GetNames</span>(<span class="r371 r">memberType</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="c">// PropertyType can&#39;t be null, we used typeof(object) above in that case so we don&#39;t get here.</span>
                    <span class="r374 r">mofType</span> = <span class="i">MapTypeNameToMofType</span>(<span class="r369 r">property</span>.<a href="../engine/parser/ast.cs.html#15850665413648cb" class="i property">PropertyType</a>.<a href="../engine/parser/ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a>, <span class="r368 r">member</span>.<span class="i">Name</span>, <span class="r367 r">className</span>,
                        <b>out</b> <span class="r375 r">isArrayType</span>,
                        <b>out</b> <span class="r376 r">embeddedInstanceType</span>, <span class="r365 r">embeddedInstanceTypes</span>, <b>ref</b> <span class="r377 r">enumNames</span>);
                }
 
                <b>string</b> <span id="r378 rd" class="r378 r">arrayAffix</span> = <span class="r375 r">isArrayType</span> ? <span class="s">&quot;[]&quot;</span> : <b>string</b>.<span class="i">Empty</span>;
 
                <span class="r364 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="s">&quot;    {0}{1} {2}{3};\n&quot;</span>,
                    <span class="i">MapAttributesToMof</span>(<span class="r377 r">enumNames</span>, <span class="r372 r">attributes</span>, <span class="r376 r">embeddedInstanceType</span>),
                    <span class="r374 r">mofType</span>,
                    <span class="r368 r">member</span>.<span class="i">Name</span>,
                    <span class="r378 r">arrayAffix</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r379 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r380 r">resourceDefinitions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r381 r">errorList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r382 r">extent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="8d65cd8521489714" href="../R/8d65cd8521489714.html" target="n" data-glyph="76,1" class="i method">GetResourceDefinitionsFromModule</a>(<b>string</b> <span id="r379 rd" class="r379 r">fileName</span>, <b>out</b> <span class="i">IEnumerable</span>&lt;<a href="../engine/parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <span id="r380 rd" class="r380 r">resourceDefinitions</span>, <span class="i">List</span>&lt;<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>&gt; <span id="r381 rd" class="r381 r">errorList</span>, <a href="../engine/parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r382 rd" class="r382 r">extent</span>)
        {
            <span class="r380 r">resourceDefinitions</span> = <b>null</b>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r379 r">fileName</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (!<span class="s">&quot;.psm1&quot;</span>.<span class="i">Equals</span>(<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r379 r">fileName</span>), <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                !<span class="s">&quot;.ps1&quot;</span>.<span class="i">Equals</span>(<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r379 r">fileName</span>), <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// If script dynamic keywords has already been loaded from the file, don&#39;t load them again.</span>
            <span class="c">// The ScriptKeywordFile cache is always initialized from scratch by the top-level</span>
            <span class="c">// configuration statement so within a single compile, things shouldn&#39;t change.</span>
            <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r379 r">fileName</span>) || <a href="#83670b5df3e7c7e4" class="i property">ScriptKeywordFileCache</a>.<span class="i">Contains</span>(<span class="r379 r">fileName</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// BUGBUG - need to fix up how the module gets set.</span>
            <a href="../engine/parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[] <span id="r383 rd" class="r383 r">tokens</span>;
            <a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <span id="r384 rd" class="r384 r">errors</span>;
            <a href="../engine/parser/ast.cs.html#6f963589327835a4" class="k">var</a> <span id="r385 rd" class="r385 r">ast</span> = <a href="../engine/parser/Parser.cs.html#bbf5e856fb3215c5" class="t t">Parser</a>.<a href="../engine/parser/Parser.cs.html#7eda9a6e0ad43105" class="i method">ParseFile</a>(<span class="r379 r">fileName</span>, <b>out</b> <span class="r383 r">tokens</span>, <b>out</b> <span class="r384 r">errors</span>);
 
            <b>if</b> (<span class="r384 r">errors</span> != <b>null</b> &amp;&amp; <span class="r384 r">errors</span>.<span class="i">Length</span> &gt; 0)
            {
                <b>if</b> (<span class="r381 r">errorList</span> != <b>null</b> &amp;&amp; <span class="r382 r">extent</span> != <b>null</b>)
                {
                    <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r386 rd" class="r386 r">errorMessages</span> = <b>new</b>();
                    <b>foreach</b> (<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="k">var</a> <span id="r387 rd" class="r387 r">error</span> <b>in</b> <span class="r384 r">errors</span>)
                    {
                        <span class="r386 r">errorMessages</span>.<span class="i">Add</span>(<span class="r387 r">error</span>.<a href="../engine/parser/Parser.cs.html#58b8452033130dea" class="i method">ToString</a>());
                    }
 
                    <span class="r381 r">errorList</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ParseError</span>(<span class="r382 r">extent</span>, <span class="s">&quot;FailToParseModuleScriptFile&quot;</span>,
                        <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <span class="i">ParserStrings</span>.<span class="i">FailToParseModuleScriptFile</span>, <span class="r379 r">fileName</span>, <b>string</b>.<span class="i">Join</span>(<span class="i">Environment</span>.<span class="i">NewLine</span>, <span class="r386 r">errorMessages</span>))));
                }
 
                <b>return</b> <b>false</b>;
            }
 
            <span class="r380 r">resourceDefinitions</span> = <span class="r385 r">ast</span>.<span class="i">FindAll</span>(<span id="r388 rd" class="r388 r">n</span> =&gt;
            {
                <a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="k">var</a> <span id="r389 rd" class="r389 r">typeAst</span> = <span class="r388 r">n</span> <b>as</b> <a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a>;
                <b>if</b> (<span class="r389 r">typeAst</span> != <b>null</b>)
                {
                    <b>for</b> (<b>int</b> <span id="r390 rd" class="r390 r">i</span> = 0; <span class="r390 r">i</span> &lt; <span class="r389 r">typeAst</span>.<a href="../engine/parser/ast.cs.html#9bd8b4fdfddab8c7" class="i property">Attributes</a>.<span class="i">Count</span>; <span class="r390 r">i</span>++)
                    {
                        <b>var</b> <span id="r391 rd" class="r391 r">a</span> = <span class="r389 r">typeAst</span>.<a href="../engine/parser/ast.cs.html#9bd8b4fdfddab8c7" class="i property">Attributes</a>[<span class="r390 r">i</span>];
                        <b>if</b> (<span class="r391 r">a</span>.<span class="i">TypeName</span>.<span class="i">GetReflectionAttributeType</span>() == <b>typeof</b>(<a href="../engine/Attributes.cs.html#07160ce4e78c3181" class="t t">DscResourceAttribute</a>)) <b>return</b> <b>true</b>;
                    }
                }
 
                <b>return</b> <b>false</b>;
            }, <b>false</b>);
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r392 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r393 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r394 r">resourcesToImport</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r395 r">resourcesFound</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r396 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r397 r">errorList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r398 r">extent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="c970e61500335419" href="../R/c970e61500335419.html" target="n" data-glyph="76,1" class="i method">ImportKeywordsFromScriptFile</a>(<b>string</b> <span id="r392 rd" class="r392 r">fileName</span>, <a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r393 rd" class="r393 r">module</span>, <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r394 rd" class="r394 r">resourcesToImport</span>, <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r395 rd" class="r395 r">resourcesFound</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r396 rd" class="r396 r">functionsToDefine</span>, <span class="i">List</span>&lt;<a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>&gt; <span id="r397 rd" class="r397 r">errorList</span>, <a href="../engine/parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r398 rd" class="r398 r">extent</span>)
        {
            <span class="i">IEnumerable</span>&lt;<a href="../engine/parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <span id="r399 rd" class="r399 r">resourceDefinitions</span>;
            <b>if</b> (!<a href="#8d65cd8521489714" class="i method">GetResourceDefinitionsFromModule</a>(<span class="r392 r">fileName</span>, <b>out</b> <span class="r399 r">resourceDefinitions</span>, <span class="r397 r">errorList</span>, <span class="r398 r">extent</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>var</b> <span id="r400 rd" class="r400 r">result</span> = <b>false</b>;
            <a href="#99fdd306a0467422" class="k">var</a> <span id="r401 rd" class="r401 r">parser</span> = <b>new</b> <span class="t">CimDSCParser</span>(<span class="i">MyClassCallback</span>);
 
            <b>const</b> <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a> <span id="r402 rd" class="r402 r">wildcardOptions</span> = <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a>;
            <span class="i">IEnumerable</span>&lt;<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r403 rd" class="r403 r">patternList</span> = <a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">CreateWildcardsFromStrings</span>(<span class="r393 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a>, <span class="r402 r">wildcardOptions</span>);
 
            <b>foreach</b> (<b>var</b> <span id="r404 rd" class="r404 r">r</span> <b>in</b> <span class="r399 r">resourceDefinitions</span>)
            {
                <span class="r400 r">result</span> = <b>true</b>;
                <a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="k">var</a> <span id="r405 rd" class="r405 r">resourceDefnAst</span> = (<a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a>)<span class="r404 r">r</span>;
 
                <b>if</b> (!<a href="../engine/SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<a href="../engine/SessionStateUtils.cs.html#b39473f09d53bf7d" class="i method">MatchesAnyWildcardPattern</a>(<span class="r405 r">resourceDefnAst</span>.<a href="../engine/parser/ast.cs.html#b2edb6e99afb6054" class="i property">Name</a>, <span class="r403 r">patternList</span>, <b>true</b>))
                {
                    <b>continue</b>;
                }
 
                <b>bool</b> <span id="r406 rd" class="r406 r">skip</span> = <b>true</b>;
                <b>foreach</b> (<b>var</b> <span id="r407 rd" class="r407 r">toImport</span> <b>in</b> <span class="r394 r">resourcesToImport</span>)
                {
                    <b>if</b> ((<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">Get</span>(<span class="r407 r">toImport</span>, <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>)).<a href="../engine/regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r405 r">resourceDefnAst</span>.<a href="../engine/parser/ast.cs.html#b2edb6e99afb6054" class="i property">Name</a>))
                    {
                        <span class="r406 r">skip</span> = <b>false</b>;
                        <b>break</b>;
                    }
                }
 
                <b>if</b> (<span class="r406 r">skip</span>) <b>continue</b>;
 
                <span class="c">// Parse the Resource Attribute to see if RunAs behavior is specified for the resource.</span>
                <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a> <span id="r408 rd" class="r408 r">runAsBehavior</span> = <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#fa33313e269e6f40" class="i field">Default</a>;
                <b>foreach</b> (<b>var</b> <span id="r409 rd" class="r409 r">attr</span> <b>in</b> <span class="r405 r">resourceDefnAst</span>.<a href="../engine/parser/ast.cs.html#9bd8b4fdfddab8c7" class="i property">Attributes</a>)
                {
                    <b>if</b> (<span class="r409 r">attr</span>.<span class="i">TypeName</span>.<span class="i">GetReflectionAttributeType</span>() == <b>typeof</b>(<a href="../engine/Attributes.cs.html#07160ce4e78c3181" class="t t">DscResourceAttribute</a>))
                    {
                        <b>foreach</b> (<b>var</b> <span id="r410 rd" class="r410 r">na</span> <b>in</b> <span class="r409 r">attr</span>.<span class="i">NamedArguments</span>)
                        {
                            <b>if</b> (<span class="r410 r">na</span>.<span class="i">ArgumentName</span>.<span class="i">Equals</span>(<span class="s">&quot;RunAsCredential&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <a href="../engine/Attributes.cs.html#07160ce4e78c3181" class="k">var</a> <span id="r411 rd" class="r411 r">dscResourceAttribute</span> = <span class="r409 r">attr</span>.<span class="i">GetAttribute</span>() <b>as</b> <a href="../engine/Attributes.cs.html#07160ce4e78c3181" class="t t">DscResourceAttribute</a>;
                                <b>if</b> (<span class="r411 r">dscResourceAttribute</span> != <b>null</b>)
                                {
                                    <span class="r408 r">runAsBehavior</span> = <span class="r411 r">dscResourceAttribute</span>.<a href="../engine/Attributes.cs.html#988a51d809ab148e" class="i property">RunAsCredential</a>;
                                }
                            }
                        }
                    }
                }
 
                <b>var</b> <span id="r412 rd" class="r412 r">mof</span> = <a href="#a2b4e86c2ee3f162" class="i method">GenerateMofForAst</a>(<span class="r405 r">resourceDefnAst</span>);
 
                <a href="#5488c81582a6c2b8" class="i method">ProcessMofForDynamicKeywords</a>(<span class="r393 r">module</span>, <span class="r395 r">resourcesFound</span>, <span class="r396 r">functionsToDefine</span>, <span class="r401 r">parser</span>, <span class="r412 r">mof</span>, <span class="r408 r">runAsBehavior</span>);
            }
 
            <b>return</b> <span class="r400 r">result</span>;
        }
 
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">Type</span>, <b>string</b>&gt; <a id="d1442c3752de50e3" href="../R/d1442c3752de50e3.html" target="n" data-glyph="46,1" class="i field">s_mapPrimitiveDotNetTypeToMof</a> = <b>new</b>()
        {
            { <b>typeof</b>(<b>sbyte</b>), <span class="s">&quot;sint8&quot;</span> },
            { <b>typeof</b>(<b>byte</b>), <span class="s">&quot;uint8&quot;</span>},
            { <b>typeof</b>(<b>short</b>), <span class="s">&quot;sint16&quot;</span>},
            { <b>typeof</b>(<b>ushort</b>), <span class="s">&quot;uint16&quot;</span>},
            { <b>typeof</b>(<b>int</b>), <span class="s">&quot;sint32&quot;</span>},
            { <b>typeof</b>(<b>uint</b>), <span class="s">&quot;uint32&quot;</span>},
            { <b>typeof</b>(<b>long</b>), <span class="s">&quot;sint64&quot;</span>},
            { <b>typeof</b>(<b>ulong</b>), <span class="s">&quot;uint64&quot;</span> },
            { <b>typeof</b>(<b>float</b>), <span class="s">&quot;real32&quot;</span>},
            { <b>typeof</b>(<b>double</b>), <span class="s">&quot;real64&quot;</span>},
            { <b>typeof</b>(<b>bool</b>), <span class="s">&quot;boolean&quot;</span>},
            { <b>typeof</b>(<b>string</b>), <span class="s">&quot;string&quot;</span> },
            { <b>typeof</b>(<span class="i">DateTime</span>), <span class="s">&quot;datetime&quot;</span> },
            { <b>typeof</b>(<a href="../engine/Credential.cs.html#6245dc122e2f1916" class="t t">PSCredential</a>), <span class="s">&quot;string&quot;</span> },
            { <b>typeof</b>(<b>char</b>), <span class="s">&quot;char16&quot;</span> },
        };
 
        <b>private static bool</b> <a id="a67487ccfc43255f" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AreQualifiersSame</a>(<span class="i">CimReadOnlyKeyedCollection</span>&lt;<span class="i">CimQualifier</span>&gt; <span id="r413 rd" class="r413 r">oldQualifier</span>, <span class="i">CimReadOnlyKeyedCollection</span>&lt;<span class="i">CimQualifier</span>&gt; <span id="r414 rd" class="r414 r">newQualifiers</span>)
        {
            <b>if</b> (<span class="r413 r">oldQualifier</span>.<span class="i">Count</span> != <span class="r414 r">newQualifiers</span>.<span class="i">Count</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<b>var</b> <span id="r415 rd" class="r415 r">qual</span> <b>in</b> <span class="r413 r">oldQualifier</span>)
            {
                <span class="c">// Find the qualifier in new class</span>
                <b>var</b> <span id="r416 rd" class="r416 r">newQual</span> = <span class="r414 r">newQualifiers</span>[<span class="r415 r">qual</span>.<span class="i">Name</span>];
                <b>if</b> (<span class="r416 r">newQual</span> == <b>null</b>)
                {
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> ((<span class="r415 r">qual</span>.<span class="i">CimType</span> != <span class="r416 r">newQual</span>.<span class="i">CimType</span>) ||
                    (<span class="r415 r">qual</span>.<span class="i">Flags</span> != <span class="r416 r">newQual</span>.<span class="i">Flags</span>))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> ((<span class="r415 r">qual</span>.<span class="i">Value</span> == <b>null</b> &amp;&amp; <span class="r416 r">newQual</span>.<span class="i">Value</span> != <b>null</b>) ||
                    (<span class="r415 r">qual</span>.<span class="i">Value</span> != <b>null</b> &amp;&amp; <span class="r416 r">newQual</span>.<span class="i">Value</span> == <b>null</b>) ||
                    (<span class="r415 r">qual</span>.<span class="i">Value</span> != <b>null</b> &amp;&amp; <span class="r416 r">newQual</span>.<span class="i">Value</span> != <b>null</b> &amp;&amp;
                        !<b>string</b>.<span class="i">Equals</span>(<span class="r415 r">qual</span>.<span class="i">Value</span>.<span class="i">ToString</span>(), <span class="r416 r">newQual</span>.<span class="i">Value</span>.<span class="i">ToString</span>(), <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                    )
                  )
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private static bool</b> <a id="ebbe39e4c93811a5" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ArePropertiesSame</a>(<span class="i">CimReadOnlyKeyedCollection</span>&lt;<span class="i">CimPropertyDeclaration</span>&gt; <span id="r417 rd" class="r417 r">oldProperties</span>, <span class="i">CimReadOnlyKeyedCollection</span>&lt;<span class="i">CimPropertyDeclaration</span>&gt; <span id="r418 rd" class="r418 r">newProperties</span>)
        {
            <b>if</b> (<span class="r417 r">oldProperties</span>.<span class="i">Count</span> != <span class="r418 r">newProperties</span>.<span class="i">Count</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<b>var</b> <span id="r419 rd" class="r419 r">prop</span> <b>in</b> <span class="r417 r">oldProperties</span>)
            {
                <span class="c">// Find the property in new class</span>
                <b>var</b> <span id="r420 rd" class="r420 r">newProp</span> = <span class="r418 r">newProperties</span>[<span class="r419 r">prop</span>.<span class="i">Name</span>];
                <b>if</b> (<span class="r420 r">newProp</span> == <b>null</b>)
                {
                    <b>return</b> <b>false</b>;
                }
                <span class="c">// flags and type should match</span>
                <b>if</b> ((<span class="r419 r">prop</span>.<span class="i">CimType</span> != <span class="r420 r">newProp</span>.<span class="i">CimType</span>) ||
                    (<span class="r419 r">prop</span>.<span class="i">Flags</span> != <span class="r420 r">newProp</span>.<span class="i">Flags</span>))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (!<span class="i">AreQualifiersSame</span>(<span class="r419 r">prop</span>.<span class="i">Qualifiers</span>, <span class="r420 r">newProp</span>.<span class="i">Qualifiers</span>))
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private static bool</b> <a id="34f2da002b14328b" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsSameNestedObject</a>(<span class="i">CimClass</span> <span id="r421 rd" class="r421 r">oldClass</span>, <span class="i">CimClass</span> <span id="r422 rd" class="r422 r">newClass</span>)
        {
            <span class="c">// #1 both the classes should be nested class and not DSC resource</span>
            <b>if</b> ((<span class="r421 r">oldClass</span>.<span class="i">CimSuperClassName</span> != <b>null</b> &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="s">&quot;OMI_BaseResource&quot;</span>, <span class="r421 r">oldClass</span>.<span class="i">CimSuperClassName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)) ||
                (<span class="r422 r">newClass</span>.<span class="i">CimSuperClassName</span> != <b>null</b> &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="s">&quot;OMI_BaseResource&quot;</span>, <span class="r422 r">newClass</span>.<span class="i">CimSuperClassName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
            {
                <b>return</b> <b>false</b>;
            }
            <span class="c">// #2 qualifier count, names, values and types should be same</span>
            <b>if</b> (!<span class="i">AreQualifiersSame</span>(<span class="r421 r">oldClass</span>.<span class="i">CimClassQualifiers</span>, <span class="r422 r">newClass</span>.<span class="i">CimClassQualifiers</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// #3 property count, names, values, qualifiers and types should be same</span>
            <b>if</b> (!<span class="i">ArePropertiesSame</span>(<span class="r421 r">oldClass</span>.<span class="i">CimClassProperties</span>, <span class="r422 r">newClass</span>.<span class="i">CimClassProperties</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static string</b> <a id="859f7008fdb5e906" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">MapTypeToMofType</a>(<span class="i">Type</span> <span id="r423 rd" class="r423 r">type</span>, <b>string</b> <span id="r424 rd" class="r424 r">memberName</span>, <b>string</b> <span id="r425 rd" class="r425 r">className</span>, <b>out bool</b> <span id="r426 rd" class="r426 r">isArrayType</span>, <b>out string</b> <span id="r427 rd" class="r427 r">embeddedInstanceType</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r428 rd" class="r428 r">embeddedInstanceTypes</span>)
        {
            <span class="r426 r">isArrayType</span> = <b>false</b>;
            <b>if</b> (<span class="r423 r">type</span>.<span class="i">IsValueType</span>)
            {
                <span class="r423 r">type</span> = <span class="i">Nullable</span>.<span class="i">GetUnderlyingType</span>(<span class="r423 r">type</span>) ?? <span class="r423 r">type</span>;
            }
 
            <b>if</b> (<span class="r423 r">type</span>.<span class="i">IsEnum</span>)
            {
                <span class="r427 r">embeddedInstanceType</span> = <b>null</b>;
                <b>return</b> <span class="s">&quot;string&quot;</span>;
            }
 
            <b>if</b> (<span class="r423 r">type</span> == <b>typeof</b>(<span class="i">Hashtable</span>))
            {
                <span class="c">// Hashtable is obviously not an array, but in the mof, we represent</span>
                <span class="c">// it as string[] (really, embeddedinstance of MSFT_KeyValuePair), but</span>
                <span class="c">// we need an array to hold each entry in the hashtable.</span>
                <span class="r426 r">isArrayType</span> = <b>true</b>;
                <span class="r427 r">embeddedInstanceType</span> = <span class="s">&quot;MSFT_KeyValuePair&quot;</span>;
                <b>return</b> <span class="s">&quot;string&quot;</span>;
            }
 
            <b>if</b> (<span class="r423 r">type</span> == <b>typeof</b>(<a href="../engine/Credential.cs.html#6245dc122e2f1916" class="t t">PSCredential</a>))
            {
                <span class="r427 r">embeddedInstanceType</span> = <span class="s">&quot;MSFT_Credential&quot;</span>;
                <b>return</b> <span class="s">&quot;string&quot;</span>;
            }
 
            <b>if</b> (<span class="r423 r">type</span>.<span class="i">IsArray</span>)
            {
                <span class="r426 r">isArrayType</span> = <b>true</b>;
                <b>bool</b> <span id="r429 rd" class="r429 r">temp</span>;
                <b>var</b> <span id="r430 rd" class="r430 r">elementType</span> = <span class="r423 r">type</span>.<span class="i">GetElementType</span>();
                <b>if</b> (!<span class="r430 r">elementType</span>.<span class="i">IsArray</span>)
                    <b>return</b> <span class="i">MapTypeToMofType</span>(<span class="r423 r">type</span>.<span class="i">GetElementType</span>(), <span class="r424 r">memberName</span>, <span class="r425 r">className</span>, <b>out</b> <span class="r429 r">temp</span>, <b>out</b> <span class="r427 r">embeddedInstanceType</span>, <span class="r428 r">embeddedInstanceTypes</span>);
            }
            <b>else</b>
            {
                <b>string</b> <span id="r431 rd" class="r431 r">cimType</span>;
                <b>if</b> (<a href="#d1442c3752de50e3" class="i field">s_mapPrimitiveDotNetTypeToMof</a>.<span class="i">TryGetValue</span>(<span class="r423 r">type</span>, <b>out</b> <span class="r431 r">cimType</span>))
                {
                    <span class="r427 r">embeddedInstanceType</span> = <b>null</b>;
                    <b>return</b> <span class="r431 r">cimType</span>;
                }
            }
 
            <b>bool</b> <span id="r432 rd" class="r432 r">supported</span> = <b>false</b>;
            <b>bool</b> <span id="r433 rd" class="r433 r">missingDefaultConstructor</span> = <b>false</b>;
            <b>if</b> (<span class="r423 r">type</span>.<span class="i">IsValueType</span>)
            {
                <b>if</b> (<a href="#d1442c3752de50e3" class="i field">s_mapPrimitiveDotNetTypeToMof</a>.<span class="i">ContainsKey</span>(<span class="r423 r">type</span>))
                {
                    <span class="r432 r">supported</span> = <b>true</b>;
                }
            }
            <b>else</b> <b>if</b> (!<span class="r423 r">type</span>.<span class="i">IsAbstract</span>)
            {
                <span class="c">// Must have default constructor, at least 1 public property/field, and no base classes</span>
                <b>if</b> (<span class="r423 r">type</span>.<span class="i">GetConstructor</span>(<span class="i">Type</span>.<span class="i">EmptyTypes</span>) == <b>null</b>)
                {
                    <span class="r433 r">missingDefaultConstructor</span> = <b>true</b>;
                }
                <b>else</b> <b>if</b> (<span class="r423 r">type</span>.<span class="i">BaseType</span> == <b>typeof</b>(<b>object</b>) &amp;&amp;
                    (<span class="r423 r">type</span>.<span class="i">GetProperties</span>(<span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span>).<span class="i">Length</span> &gt; 0 ||
                         <span class="r423 r">type</span>.<span class="i">GetFields</span>(<span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span>).<span class="i">Length</span> &gt; 0))
                {
                    <span class="r432 r">supported</span> = <b>true</b>;
                }
            }
 
            <b>if</b> (<span class="r432 r">supported</span>)
            {
                <b>if</b> (!<span class="r428 r">embeddedInstanceTypes</span>.<span class="i">Contains</span>(<span class="r423 r">type</span>))
                {
                    <span class="r428 r">embeddedInstanceTypes</span>.<span class="i">Add</span>(<span class="r423 r">type</span>);
                }
 
                <span class="c">// The type is obviously not a string, but in the mof, we represent</span>
                <span class="c">// it as string (really, embeddedinstance of the class type)</span>
                <span class="r427 r">embeddedInstanceType</span> = <span class="r423 r">type</span>.<span class="i">FullName</span>.<span class="i">Replace</span>(<span class="s">&#39;.&#39;</span>, <span class="s">&#39;_&#39;</span>);
                <b>return</b> <span class="s">&quot;string&quot;</span>;
            }
 
            <b>if</b> (<span class="r433 r">missingDefaultConstructor</span>)
            {
                <b>throw</b> <b>new</b> <span class="i">NotSupportedException</span>(<b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">ParserStrings</span>.<span class="i">DscResourceMissingDefaultConstructor</span>,
                    <span class="r423 r">type</span>.<span class="i">Name</span>));
            }
            <b>else</b>
            {
                <b>throw</b> <b>new</b> <span class="i">NotSupportedException</span>(<b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">ParserStrings</span>.<span class="i">UnsupportedPropertyTypeOfDSCResourceClass</span>,
                    <span class="r424 r">memberName</span>,
                    <span class="r423 r">type</span>.<span class="i">Name</span>,
                    <span class="r425 r">className</span>));
            }
        }
 
        <b>private static string</b> <a id="f4a69d57ea6b5896" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">MapAttributesToMof</a>(<b>string</b>[] <span id="r434 rd" class="r434 r">enumNames</span>, <span class="i">IEnumerable</span>&lt;<b>object</b>&gt; <span id="r435 rd" class="r435 r">customAttributes</span>, <b>string</b> <span id="r436 rd" class="r436 r">embeddedInstanceType</span>)
        {
            <b>var</b> <span id="r437 rd" class="r437 r">sb</span> = <b>new</b> <span class="i">StringBuilder</span>();
 
            <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;[&#39;</span>);
            <b>bool</b> <span id="r438 rd" class="r438 r">needComma</span> = <b>false</b>;
            <b>foreach</b> (<b>var</b> <span id="r439 rd" class="r439 r">attr</span> <b>in</b> <span class="r435 r">customAttributes</span>)
            {
                <a href="../engine/Attributes.cs.html#4f12f4e96778ea95" class="k">var</a> <span id="r440 rd" class="r440 r">dscProperty</span> = <span class="r439 r">attr</span> <b>as</b> <a href="../engine/Attributes.cs.html#4f12f4e96778ea95" class="t t">DscPropertyAttribute</a>;
                <b>if</b> (<span class="r440 r">dscProperty</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r440 r">dscProperty</span>.<a href="../engine/Attributes.cs.html#34eac15f200e9bf0" class="i property">Key</a>)
                    {
                        <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}key&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>);
                        <span class="r438 r">needComma</span> = <b>true</b>;
                    }
 
                    <b>if</b> (<span class="r440 r">dscProperty</span>.<a href="../engine/Attributes.cs.html#9ef11b2748714ea9" class="i property">Mandatory</a>)
                    {
                        <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}required&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>);
                        <span class="r438 r">needComma</span> = <b>true</b>;
                    }
 
                    <b>if</b> (<span class="r440 r">dscProperty</span>.<a href="../engine/Attributes.cs.html#d7c458f7b04b8911" class="i property">NotConfigurable</a>)
                    {
                        <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}read&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>);
                        <span class="r438 r">needComma</span> = <b>true</b>;
                    }
 
                    <b>continue</b>;
                }
 
                <a href="../engine/Attributes.cs.html#33a6a027748d30a4" class="k">var</a> <span id="r441 rd" class="r441 r">validateSet</span> = <span class="r439 r">attr</span> <b>as</b> <a href="../engine/Attributes.cs.html#33a6a027748d30a4" class="t t">ValidateSetAttribute</a>;
                <b>if</b> (<span class="r441 r">validateSet</span> != <b>null</b>)
                {
                    <b>bool</b> <span id="r442 rd" class="r442 r">valueMapComma</span> = <b>false</b>;
                    <span class="i">StringBuilder</span> <span id="r443 rd" class="r443 r">sbValues</span> = <b>new</b>(<span class="s">&quot;, Values{&quot;</span>);
                    <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}ValueMap{{&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>);
                    <span class="r438 r">needComma</span> = <b>true</b>;
 
                    <b>foreach</b> (<b>var</b> <span id="r444 rd" class="r444 r">value</span> <b>in</b> <span class="r441 r">validateSet</span>.<a href="../engine/Attributes.cs.html#7e92ecc5d5d777ac" class="i property">ValidValues</a>)
                    {
                        <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}\&quot;{1}\&quot;&quot;</span>, <span class="r442 r">valueMapComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>, <span class="r444 r">value</span>);
                        <span class="r443 r">sbValues</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}\&quot;{1}\&quot;&quot;</span>, <span class="r442 r">valueMapComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>, <span class="r444 r">value</span>);
                        <span class="r442 r">valueMapComma</span> = <b>true</b>;
                    }
 
                    <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;}&#39;</span>);
                    <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="r443 r">sbValues</span>);
                    <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;}&#39;</span>);
                }
            }
 
            <span class="c">// Default is write - skipped if we already have some attributes</span>
            <b>if</b> (<span class="r437 r">sb</span>.<span class="i">Length</span> == 1)
            {
                <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;write&quot;</span>);
                <span class="r438 r">needComma</span> = <b>true</b>;
            }
 
            <b>if</b> (<span class="r434 r">enumNames</span> != <b>null</b>)
            {
                <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}ValueMap{{&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>);
                <span class="r438 r">needComma</span> = <b>false</b>;
                <b>foreach</b> (<b>var</b> <span id="r445 rd" class="r445 r">name</span> <b>in</b> <span class="r434 r">enumNames</span>)
                {
                    <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}\&quot;{1}\&quot;&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>, <span class="r445 r">name</span>);
                    <span class="r438 r">needComma</span> = <b>true</b>;
                }
 
                <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;}, Values{&quot;</span>);
                <span class="r438 r">needComma</span> = <b>false</b>;
                <b>foreach</b> (<b>var</b> <span id="r446 rd" class="r446 r">name</span> <b>in</b> <span class="r434 r">enumNames</span>)
                {
                    <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}\&quot;{1}\&quot;&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>, <span class="r446 r">name</span>);
                    <span class="r438 r">needComma</span> = <b>true</b>;
                }
 
                <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;}&#39;</span>);
            }
            <b>else</b> <b>if</b> (<span class="r436 r">embeddedInstanceType</span> != <b>null</b>)
            {
                <span class="r437 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}EmbeddedInstance(\&quot;{1}\&quot;)&quot;</span>, <span class="r438 r">needComma</span> ? <span class="s">&quot;, &quot;</span> : <b>string</b>.<span class="i">Empty</span>, <span class="r436 r">embeddedInstanceType</span>);
            }
 
            <span class="r437 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;]&#39;</span>);
            <b>return</b> <span class="r437 r">sb</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r447 r">type</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="d66324ee247ef68d" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GenerateMofForType</a>(<span class="i">Type</span> <span id="r447 rd" class="r447 r">type</span>)
        {
            <b>var</b> <span id="r448 rd" class="r448 r">embeddedInstanceTypes</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <b>var</b> <span id="r449 rd" class="r449 r">sb</span> = <b>new</b> <span class="i">StringBuilder</span>();
 
            <a href="#82c901fcb20cfb63" class="i method">GenerateMofForType</a>(<span class="r447 r">type</span>, <span class="r449 r">sb</span>, <span class="r448 r">embeddedInstanceTypes</span>);
            <b>var</b> <span id="r450 rd" class="r450 r">visitedInstances</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <span class="r450 r">visitedInstances</span>.<span class="i">Add</span>(<span class="r447 r">type</span>);
            <a href="#8b0a3a7f7015c76f" class="i method">ProcessEmbeddedInstanceTypes</a>(<span class="r448 r">embeddedInstanceTypes</span>, <span class="r450 r">visitedInstances</span>, <span class="r449 r">sb</span>);
 
            <b>return</b> <span class="r449 r">sb</span>.<span class="i">ToString</span>();
        }
 
        <b>private static void</b> <a id="8b0a3a7f7015c76f" href="../R/8b0a3a7f7015c76f.html" target="n" data-glyph="76,1" class="i method">ProcessEmbeddedInstanceTypes</a>(<span class="i">List</span>&lt;<b>object</b>&gt; <span id="r451 rd" class="r451 r">embeddedInstanceTypes</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r452 rd" class="r452 r">visitedInstances</span>, <span class="i">StringBuilder</span> <span id="r453 rd" class="r453 r">sb</span>)
        {
            <span class="i">StringBuilder</span> <span id="r454 rd" class="r454 r">nestedSb</span> = <b>null</b>;
 
            <b>while</b> (<span class="r451 r">embeddedInstanceTypes</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>if</b> (<span class="r454 r">nestedSb</span> == <b>null</b>)
                {
                    <span class="r454 r">nestedSb</span> = <b>new</b> <span class="i">StringBuilder</span>();
                }
                <b>else</b>
                {
                    <span class="r454 r">nestedSb</span>.<span class="i">Clear</span>();
                }
 
                <b>var</b> <span id="r455 rd" class="r455 r">batchedTypes</span> = <span class="r451 r">embeddedInstanceTypes</span>.<span class="i">Where</span>(<span id="r456 rd" class="r456 r">x</span> =&gt; !<span class="r452 r">visitedInstances</span>.<span class="i">Contains</span>(<span class="r456 r">x</span>)).<span class="i">ToArray</span>();
                <span class="r451 r">embeddedInstanceTypes</span>.<span class="i">Clear</span>();
 
                <b>for</b> (<b>int</b> <span id="r457 rd" class="r457 r">i</span> = <span class="r455 r">batchedTypes</span>.<span class="i">Length</span> - 1; <span class="r457 r">i</span> &gt;= 0; <span class="r457 r">i</span>--)
                {
                    <span class="r452 r">visitedInstances</span>.<span class="i">Add</span>(<span class="r455 r">batchedTypes</span>[<span class="r457 r">i</span>]);
                    <b>var</b> <span id="r458 rd" class="r458 r">type</span> = <span class="r455 r">batchedTypes</span>[<span class="r457 r">i</span>] <b>as</b> <span class="i">Type</span>;
                    <b>if</b> (<span class="r458 r">type</span> != <b>null</b>)
                    {
                        <a href="#82c901fcb20cfb63" class="i method">GenerateMofForType</a>(<span class="r458 r">type</span>, <span class="r454 r">nestedSb</span>, <span class="r451 r">embeddedInstanceTypes</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#ca09426e00327800" class="i method">GenerateMofForAst</a>((<a href="../engine/parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a>)<span class="r455 r">batchedTypes</span>[<span class="r457 r">i</span>], <span class="r454 r">nestedSb</span>, <span class="r451 r">embeddedInstanceTypes</span>);
                    }
 
                    <span class="r454 r">nestedSb</span>.<span class="i">Append</span>(<span class="s">&#39;\n&#39;</span>);
                }
 
                <span class="r453 r">sb</span>.<span class="i">Insert</span>(0, <span class="r454 r">nestedSb</span>.<span class="i">ToString</span>());
            }
        }
 
        <b>private static void</b> <a id="82c901fcb20cfb63" href="../R/82c901fcb20cfb63.html" target="n" data-glyph="76,1" class="i method">GenerateMofForType</a>(<span class="i">Type</span> <span id="r459 rd" class="r459 r">type</span>, <span class="i">StringBuilder</span> <span id="r460 rd" class="r460 r">sb</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r461 rd" class="r461 r">embeddedInstanceTypes</span>)
        {
            <b>var</b> <span id="r462 rd" class="r462 r">className</span> = <span class="r459 r">type</span>.<span class="i">Name</span>;
            <span class="c">// Friendly name is required by module validator to verify resource instance against the exclusive resource name list.</span>
            <span class="r460 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;[ClassVersion(\&quot;1.0.0\&quot;), FriendlyName(\&quot;{0}\&quot;)]\nclass {0}&quot;</span>, <span class="r462 r">className</span>);
 
            <b>if</b> (<span class="r459 r">type</span>.<span class="i">GetCustomAttributes</span>&lt;<a href="../engine/Attributes.cs.html#07160ce4e78c3181" class="t t">DscResourceAttribute</a>&gt;().<span class="i">Any</span>())
            {
                <span class="r460 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot; : OMI_BaseResource&quot;</span>);
            }
 
            <span class="r460 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;\n{\n&quot;</span>);
 
            <span class="i">ProcessMembers</span>(<span class="r459 r">type</span>, <span class="r460 r">sb</span>, <span class="r461 r">embeddedInstanceTypes</span>, <span class="r462 r">className</span>);
            <span class="r460 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;};&quot;</span>);
        }
 
        <b>private static void</b> <a id="320c3bb1e1fd6032" href="../R/320c3bb1e1fd6032.html" target="n" data-glyph="76,1" class="i method">ProcessMembers</a>(<span class="i">Type</span> <span id="r463 rd" class="r463 r">type</span>, <span class="i">StringBuilder</span> <span id="r464 rd" class="r464 r">sb</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r465 rd" class="r465 r">embeddedInstanceTypes</span>, <b>string</b> <span id="r466 rd" class="r466 r">className</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r467 rd" class="r467 r">member</span> <b>in</b> <span class="r463 r">type</span>.<span class="i">GetMembers</span>(<span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span>).<span class="i">Where</span>(<b>static</b> <span id="r468 rd" class="r468 r">m</span> =&gt; <span class="r468 r">m</span> <b>is</b> <span class="i">PropertyInfo</span> || <span class="r468 r">m</span> <b>is</b> <span class="i">FieldInfo</span>))
            {
                <b>if</b> (<span class="r467 r">member</span>.<span class="i">CustomAttributes</span>.<span class="i">All</span>(<b>static</b> <span id="r469 rd" class="r469 r">cad</span> =&gt; <span class="r469 r">cad</span>.<span class="i">AttributeType</span> != <b>typeof</b>(<a href="../engine/Attributes.cs.html#4f12f4e96778ea95" class="t t">DscPropertyAttribute</a>)))
                {
                    <b>continue</b>;
                }
 
                <span class="i">Type</span> <span id="r470 rd" class="r470 r">memberType</span>;
                <b>var</b> <span id="r471 rd" class="r471 r">propertyInfo</span> = <span class="r467 r">member</span> <b>as</b> <span class="i">PropertyInfo</span>;
                <b>if</b> (<span class="r471 r">propertyInfo</span> == <b>null</b>)
                {
                    <b>var</b> <span id="r472 rd" class="r472 r">fieldInfo</span> = (<span class="i">FieldInfo</span>)<span class="r467 r">member</span>;
                    <span class="r470 r">memberType</span> = <span class="r472 r">fieldInfo</span>.<span class="i">FieldType</span>;
                }
                <b>else</b>
                {
                    <b>if</b> (<span class="r471 r">propertyInfo</span>.<span class="i">GetSetMethod</span>() == <b>null</b>)
                    {
                        <b>continue</b>;
                    }
 
                    <span class="r470 r">memberType</span> = <span class="r471 r">propertyInfo</span>.<span class="i">PropertyType</span>;
                }
 
                <span class="c">// TODO - validate type and name</span>
                <b>bool</b> <span id="r473 rd" class="r473 r">isArrayType</span>;
                <b>string</b> <span id="r474 rd" class="r474 r">embeddedInstanceType</span>;
                <b>string</b> <span id="r475 rd" class="r475 r">mofType</span> = <span class="i">MapTypeToMofType</span>(<span class="r470 r">memberType</span>, <span class="r467 r">member</span>.<span class="i">Name</span>, <span class="r466 r">className</span>, <b>out</b> <span class="r473 r">isArrayType</span>, <b>out</b> <span class="r474 r">embeddedInstanceType</span>,
                    <span class="r465 r">embeddedInstanceTypes</span>);
                <b>string</b> <span id="r476 rd" class="r476 r">arrayAffix</span> = <span class="r473 r">isArrayType</span> ? <span class="s">&quot;[]&quot;</span> : <b>string</b>.<span class="i">Empty</span>;
 
                <b>var</b> <span id="r477 rd" class="r477 r">enumNames</span> = <span class="r470 r">memberType</span>.<span class="i">IsEnum</span>
                    ? <span class="i">Enum</span>.<span class="i">GetNames</span>(<span class="r470 r">memberType</span>)
                    : <b>null</b>;
                <span class="r464 r">sb</span>.<span class="i">AppendFormat</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="s">&quot;    {0}{1} {2}{3};\n&quot;</span>,
                    <span class="i">MapAttributesToMof</span>(<span class="r477 r">enumNames</span>, <span class="r467 r">member</span>.<span class="i">GetCustomAttributes</span>(<b>true</b>), <span class="r474 r">embeddedInstanceType</span>),
                    <span class="r475 r">mofType</span>,
                    <span class="r467 r">member</span>.<span class="i">Name</span>,
                    <span class="r476 r">arrayAffix</span>);
            }
        }
 
        <b>private static bool</b> <a id="1621a4d612d65299" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ImportKeywordsFromAssembly</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r478 rd" class="r478 r">module</span>,
                                                       <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r479 rd" class="r479 r">resourcesToImport</span>,
                                                       <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r480 rd" class="r480 r">resourcesFound</span>,
                                                       <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r481 rd" class="r481 r">functionsToDefine</span>,
                                                       <span class="i">Assembly</span> <span id="r482 rd" class="r482 r">assembly</span>)
        {
            <b>bool</b> <span id="r483 rd" class="r483 r">result</span> = <b>false</b>;
 
            <a href="#99fdd306a0467422" class="k">var</a> <span id="r484 rd" class="r484 r">parser</span> = <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="t">CimDSCParser</span>(<span class="i">MyClassCallback</span>);
 
            <span class="i">IEnumerable</span>&lt;<span class="i">Type</span>&gt; <span id="r485 rd" class="r485 r">resourceDefinitions</span> =
                <span class="r482 r">assembly</span>.<span class="i">GetTypes</span>().<span class="i">Where</span>(<b>static</b> <span id="r486 rd" class="r486 r">t</span> =&gt; <span class="r486 r">t</span>.<span class="i">GetCustomAttributes</span>&lt;<a href="../engine/Attributes.cs.html#07160ce4e78c3181" class="t t">DscResourceAttribute</a>&gt;().<span class="i">Any</span>());
 
            <b>foreach</b> (<b>var</b> <span id="r487 rd" class="r487 r">r</span> <b>in</b> <span class="r485 r">resourceDefinitions</span>)
            {
                <span class="r483 r">result</span> = <b>true</b>;
                <b>bool</b> <span id="r488 rd" class="r488 r">skip</span> = <b>true</b>;
 
                <b>foreach</b> (<b>var</b> <span id="r489 rd" class="r489 r">toImport</span> <b>in</b> <span class="r479 r">resourcesToImport</span>)
                {
                    <b>if</b> ((<a href="../engine/regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">Get</span>(<span class="r489 r">toImport</span>, <a href="../engine/regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../engine/regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>)).<span class="i">IsMatch</span>(<span class="r487 r">r</span>.<span class="i">Name</span>))
                    {
                        <span class="r488 r">skip</span> = <b>false</b>;
                        <b>break</b>;
                    }
                }
 
                <b>if</b> (<span class="r488 r">skip</span>) <b>continue</b>;
 
                <b>var</b> <span id="r490 rd" class="r490 r">mof</span> = <span class="i">GenerateMofForType</span>(<span class="r487 r">r</span>);
 
                <span class="i">ProcessMofForDynamicKeywords</span>(<span class="r478 r">module</span>, <span class="r480 r">resourcesFound</span>, <span class="r481 r">functionsToDefine</span>, <span class="r484 r">parser</span>, <span class="r490 r">mof</span>, <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#fa33313e269e6f40" class="i field">Default</a>);
            }
 
            <b>return</b> <span class="r483 r">result</span>;
        }
 
        <b>private static void</b> <a id="5488c81582a6c2b8" href="../R/5488c81582a6c2b8.html" target="n" data-glyph="76,1" class="i method">ProcessMofForDynamicKeywords</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r491 rd" class="r491 r">module</span>, <span class="i">ICollection</span>&lt;<b>string</b>&gt; <span id="r492 rd" class="r492 r">resourcesFound</span>,
            <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r493 rd" class="r493 r">functionsToDefine</span>, <a href="#99fdd306a0467422" class="t t">CimDSCParser</a> <span id="r494 rd" class="r494 r">parser</span>, <b>string</b> <span id="r495 rd" class="r495 r">mof</span>, <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a> <span id="r496 rd" class="r496 r">runAsBehavior</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r497 rd" class="r497 r">c</span> <b>in</b> <span class="r494 r">parser</span>.<a href="#264768f02d5ff0ea" class="i method">ParseSchemaMofFileBuffer</a>(<span class="r495 r">mof</span>))
            {
                <b>var</b> <span id="r498 rd" class="r498 r">className</span> = <span class="r497 r">c</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>;
                <b>string</b> <span id="r499 rd" class="r499 r">alias</span> = <span class="i">GetFriendlyName</span>(<span class="r497 r">c</span>);
                <b>var</b> <span id="r500 rd" class="r500 r">friendlyName</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r499 r">alias</span>) ? <span class="r498 r">className</span> : <span class="r499 r">alias</span>;
                <b>if</b> (!<a href="#6b8e947cc79979ca" class="i property">CacheResourcesFromMultipleModuleVersions</a>)
                {
                    <span class="c">// Find &amp; remove the previous version of the resource.</span>
                    <span class="i">List</span>&lt;<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="#0fec7b2a57438c56" class="t t">DscClassCacheEntry</a>&gt;&gt; <span id="r501 rd" class="r501 r">resourceList</span> = <span class="i">FindResourceInCache</span>(<span class="r491 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r498 r">className</span>, <span class="r500 r">friendlyName</span>);
 
                    <b>if</b> (<span class="r501 r">resourceList</span>.<span class="i">Count</span> &gt; 0 &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r501 r">resourceList</span>[0].<span class="i">Key</span>))
                    {
                        <a href="#33d37dbc421f598c" class="i property">ClassCache</a>.<span class="i">Remove</span>(<span class="r501 r">resourceList</span>[0].<span class="i">Key</span>);
 
                        <span class="c">// keyword is already defined and it is a Inbox resource, remove it</span>
                        <b>if</b> (<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<span class="i">ContainsKeyword</span>(<span class="r500 r">friendlyName</span>) &amp;&amp; <span class="r501 r">resourceList</span>[0].<span class="i">Value</span>.<span class="i">IsImportedImplicitly</span>)
                        {
                            <a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<span class="i">RemoveKeyword</span>(<span class="r500 r">friendlyName</span>);
                        }
                    }
                }
 
                <b>var</b> <span id="r502 rd" class="r502 r">moduleQualifiedResourceName</span> = <span class="i">GetModuleQualifiedResourceName</span>(<span class="r491 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r491 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>.<span class="i">ToString</span>(), <span class="r498 r">className</span>, <span class="r500 r">friendlyName</span>);
                <a href="#33d37dbc421f598c" class="i property">ClassCache</a>[<span class="r502 r">moduleQualifiedResourceName</span>] = <b>new</b> <span class="t">DscClassCacheEntry</span>(<span class="r496 r">runAsBehavior</span>, <b>false</b>, <span class="r497 r">c</span>);
                <a href="#538a786bc32fe440" class="i property">ByClassModuleCache</a>[<span class="r498 r">className</span>] = <b>new</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;(<span class="r491 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r491 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>);
                <span class="r492 r">resourcesFound</span>.<span class="i">Add</span>(<span class="r498 r">className</span>);
                <span class="i">CreateAndRegisterKeywordFromCimClass</span>(<span class="r491 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r491 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>, <span class="r497 r">c</span>, <span class="r493 r">functionsToDefine</span>, <span class="r496 r">runAsBehavior</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Import the CIM functions from a module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r503 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r504 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r505 r">schemaFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Full path of the loaded schema file...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="b6a382a0a826e422" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ImportCimKeywordsFromModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r503 rd" class="r503 r">module</span>, <b>string</b> <span id="r504 rd" class="r504 r">resourceName</span>, <b>out string</b> <span id="r505 rd" class="r505 r">schemaFilePath</span>)
        {
            <b>return</b> <a href="#b0d9eb96440f0750" class="i method">ImportCimKeywordsFromModule</a>(<span class="r503 r">module</span>, <span class="r504 r">resourceName</span>, <b>out</b> <span class="r505 r">schemaFilePath</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Import the CIM functions from a module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r506 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r507 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r508 r">schemaFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Full path of the loaded schema file...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r509 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="b0d9eb96440f0750" href="../R/b0d9eb96440f0750.html" target="n" data-glyph="72,1" class="i method">ImportCimKeywordsFromModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r506 rd" class="r506 r">module</span>, <b>string</b> <span id="r507 rd" class="r507 r">resourceName</span>, <b>out string</b> <span id="r508 rd" class="r508 r">schemaFilePath</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r509 rd" class="r509 r">functionsToDefine</span>)
        {
            <b>return</b> <a href="#04d2162047b991b9" class="i method">ImportCimKeywordsFromModule</a>(<span class="r506 r">module</span>, <span class="r507 r">resourceName</span>, <b>out</b> <span class="r508 r">schemaFilePath</span>, <span class="r509 r">functionsToDefine</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Import the CIM functions from a module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r510 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r511 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r512 r">schemaFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Full path of the loaded schema file...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r513 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r514 r">errors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Error reported during deserialization.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="04d2162047b991b9" href="../R/04d2162047b991b9.html" target="n" data-glyph="72,1" class="i method">ImportCimKeywordsFromModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r510 rd" class="r510 r">module</span>, <b>string</b> <span id="r511 rd" class="r511 r">resourceName</span>, <b>out string</b> <span id="r512 rd" class="r512 r">schemaFilePath</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r513 rd" class="r513 r">functionsToDefine</span>, <span class="i">Collection</span>&lt;<span class="i">Exception</span>&gt; <span id="r514 rd" class="r514 r">errors</span>)
        {
            <b>if</b> (<span class="r510 r">module</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r510 r">module</span>));
            }
 
            <b>if</b> (<span class="r511 r">resourceName</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r511 r">resourceName</span>));
            }
 
            <b>string</b> <span id="r515 rd" class="r515 r">dscResourcesPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>, <span class="s">&quot;DscResources&quot;</span>);
            <span class="r512 r">schemaFilePath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="i">Path</span>.<span class="i">Combine</span>(<span class="r515 r">dscResourcesPath</span>, <span class="r511 r">resourceName</span>), <span class="r511 r">resourceName</span> + <span class="s">&quot;.schema.mof&quot;</span>);
 
            <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r512 r">schemaFilePath</span>))
            {
                <span class="c">// If the file has already been loaded, don&#39;t load it again.</span>
                <span class="c">// The class cache is always initialized from scratch by the top-level</span>
                <span class="c">// configuration statement so within a single compile, things shouldn&#39;t</span>
                <span class="c">// change.</span>
                <b>var</b> <span id="r516 rd" class="r516 r">classes</span> = <a href="#e19a02169c52eebf" class="i method">GetCachedClassByFileName</a>(<span class="r512 r">schemaFilePath</span>) ?? <a href="#2e87c4641eccb833" class="i method">ImportClasses</a>(<span class="r512 r">schemaFilePath</span>, <b>new</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;(<span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>), <span class="r514 r">errors</span>);
                <b>if</b> (<span class="r516 r">classes</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r517 rd" class="r517 r">c</span> <b>in</b> <span class="r516 r">classes</span>)
                    {
                        <span class="i">CreateAndRegisterKeywordFromCimClass</span>(<span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>, <span class="r517 r">c</span>, <span class="r513 r">functionsToDefine</span>, <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#fa33313e269e6f40" class="i field">Default</a>);
                        <span class="i">ClearImplicitlyImportedFlagFromResourceInClassCache</span>(<span class="r510 r">module</span>, <span class="r517 r">c</span>);
                    }
                }
 
                <b>return</b> <b>true</b>;
            }
            <b>else</b> <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r515 r">dscResourcesPath</span>))
            {
                <span class="c">//</span>
                <span class="c">// Cannot find the schema file, then resourceName may be a friendly name,</span>
                <span class="c">// try to search all DscResources&#39; schemas under DscResources folder</span>
                <span class="c">//</span>
                <b>try</b>
                {
                    <b>var</b> <span id="r518 rd" class="r518 r">dscResourceDirectories</span> = <span class="i">Directory</span>.<span class="i">GetDirectories</span>(<span class="r515 r">dscResourcesPath</span>);
                    <b>foreach</b> (<b>var</b> <span id="r519 rd" class="r519 r">directory</span> <b>in</b> <span class="r518 r">dscResourceDirectories</span>)
                    {
                        <b>var</b> <span id="r520 rd" class="r520 r">schemaFiles</span> = <span class="i">Directory</span>.<span class="i">GetFiles</span>(<span class="r519 r">directory</span>, <span class="s">&quot;*.schema.mof&quot;</span>, <span class="i">SearchOption</span>.<span class="i">TopDirectoryOnly</span>);
                        <b>if</b> (<span class="r520 r">schemaFiles</span>.<span class="i">Length</span> &gt; 0)
                        {
                            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r520 r">schemaFiles</span>.<span class="i">Length</span> == 1, <span class="s">&quot;A valid DSCResource module can have only one schema mof file&quot;</span>);
                            <b>var</b> <span id="r521 rd" class="r521 r">tempSchemaFilepath</span> = <span class="r520 r">schemaFiles</span>[0];
                            <b>var</b> <span id="r522 rd" class="r522 r">classes</span> = <span class="i">GetCachedClassByFileName</span>(<span class="r521 r">tempSchemaFilepath</span>) ?? <span class="i">ImportClasses</span>(<span class="r521 r">tempSchemaFilepath</span>, <b>new</b> <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Version</span>&gt;(<span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>), <span class="r514 r">errors</span>);
                            <b>if</b> (<span class="r522 r">classes</span> != <b>null</b>)
                            {
                                <span class="c">//</span>
                                <span class="c">// search if class&#39;s friendly name is the given resourceName</span>
                                <span class="c">//</span>
                                <b>foreach</b> (<b>var</b> <span id="r523 rd" class="r523 r">c</span> <b>in</b> <span class="r522 r">classes</span>)
                                {
                                    <b>var</b> <span id="r524 rd" class="r524 r">alias</span> = <span class="i">GetFriendlyName</span>(<span class="r523 r">c</span>);
                                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r524 r">alias</span>, <span class="r511 r">resourceName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                    {
                                        <span class="i">CreateAndRegisterKeywordFromCimClass</span>(<span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r510 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>, <span class="r523 r">c</span>, <span class="r513 r">functionsToDefine</span>, <a href="../engine/Attributes.cs.html#b2f866b6f09accb0" class="t t">DSCResourceRunAsCredential</a>.<a href="../engine/Attributes.cs.html#fa33313e269e6f40" class="i field">Default</a>);
                                        <span class="i">ClearImplicitlyImportedFlagFromResourceInClassCache</span>(<span class="r510 r">module</span>, <span class="r523 r">c</span>);
                                        <b>return</b> <b>true</b>;
                                    }
                                }
                            }
                        }
                    }
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                    <span class="c">//</span>
                    <span class="c">// silent in case of exception</span>
                    <span class="c">//</span>
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Clear the &#39;IsImportedImplicitly&#39; flag when explicitly importing a resource.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r525 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r526 r">cimClass</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="f852a2a4c6338a3e" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ClearImplicitlyImportedFlagFromResourceInClassCache</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r525 rd" class="r525 r">module</span>, <span class="i">CimClass</span> <span id="r526 rd" class="r526 r">cimClass</span>)
        {
            <b>var</b> <span id="r527 rd" class="r527 r">className</span> = <span class="r526 r">cimClass</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>;
            <b>var</b> <span id="r528 rd" class="r528 r">alias</span> = <a href="#5c2c52adeb8a693f" class="i method">GetFriendlyName</a>(<span class="r526 r">cimClass</span>);
            <b>var</b> <span id="r529 rd" class="r529 r">friendlyName</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r528 r">alias</span>) ? <span class="r527 r">className</span> : <span class="r528 r">alias</span>;
            <b>var</b> <span id="r530 rd" class="r530 r">moduleQualifiedResourceName</span> = <span class="i">GetModuleQualifiedResourceName</span>(<span class="r525 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r525 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>.<span class="i">ToString</span>(), <span class="r527 r">className</span>, <span class="r529 r">friendlyName</span>);
            <a href="#33d37dbc421f598c" class="i property">ClassCache</a>[<span class="r530 r">moduleQualifiedResourceName</span>].<span class="i">IsImportedImplicitly</span> = <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Imports configuration keywords from a .psm1 file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r531 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r532 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r533 r">schemaFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="b3037b3ea1a6094d" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ImportScriptKeywordsFromModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r531 rd" class="r531 r">module</span>, <b>string</b> <span id="r532 rd" class="r532 r">resourceName</span>, <b>out string</b> <span id="r533 rd" class="r533 r">schemaFilePath</span>)
        {
            <b>return</b> <a href="#5e7bf4ac60018475" class="i method">ImportScriptKeywordsFromModule</a>(<span class="r531 r">module</span>, <span class="r532 r">resourceName</span>, <b>out</b> <span class="r533 r">schemaFilePath</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Imports configuration keywords from a .psm1 file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r534 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r535 r">resourceName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r536 r">schemaFilePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r537 r">functionsToDefine</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="5e7bf4ac60018475" href="../R/5e7bf4ac60018475.html" target="n" data-glyph="72,1" class="i method">ImportScriptKeywordsFromModule</a>(<a href="../engine/Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r534 rd" class="r534 r">module</span>, <b>string</b> <span id="r535 rd" class="r535 r">resourceName</span>, <b>out string</b> <span id="r536 rd" class="r536 r">schemaFilePath</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <span id="r537 rd" class="r537 r">functionsToDefine</span>)
        {
            <b>if</b> (<span class="r534 r">module</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r534 r">module</span>));
            }
 
            <b>if</b> (<span class="r535 r">resourceName</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r535 r">resourceName</span>));
            }
 
            <span class="r536 r">schemaFilePath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="i">Path</span>.<span class="i">Combine</span>(<span class="i">Path</span>.<span class="i">Combine</span>(<span class="r534 r">module</span>.<a href="../engine/Modules/PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>, <span class="s">&quot;DscResources&quot;</span>), <span class="r535 r">resourceName</span>), <span class="r535 r">resourceName</span> + <span class="s">&quot;.Schema.psm1&quot;</span>);
 
            <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r536 r">schemaFilePath</span>) &amp;&amp; !<a href="#5fa38071fd92c8dc" class="i field">s_currentImportingScriptFiles</a>.<span class="i">Contains</span>(<span class="r536 r">schemaFilePath</span>))
            {
                <span class="c">// If script dynamic keywords has already been loaded from the file, don&#39;t load them again.</span>
                <span class="c">// The ScriptKeywordFile cache is always initialized from scratch by the top-level</span>
                <span class="c">// configuration statement so within a single compile, things shouldn&#39;t change.</span>
                <b>if</b> (!<a href="#83670b5df3e7c7e4" class="i property">ScriptKeywordFileCache</a>.<span class="i">Contains</span>(<span class="r536 r">schemaFilePath</span>))
                {
                    <span class="c">// Parsing the file is all that needs to be done to add the keywords</span>
                    <span class="c">// BUGBUG - need to fix up how the module gets set.</span>
                    <span class="c">// BUGBUG - should fail somehow if errors is not empty</span>
                    <a href="../engine/parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[] <span id="r538 rd" class="r538 r">tokens</span>; <a href="../engine/parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <span id="r539 rd" class="r539 r">errors</span>;
                    <a href="#5fa38071fd92c8dc" class="i field">s_currentImportingScriptFiles</a>.<span class="i">Add</span>(<span class="r536 r">schemaFilePath</span>);
                    <a href="../engine/parser/Parser.cs.html#bbf5e856fb3215c5" class="t t">Parser</a>.<a href="../engine/parser/Parser.cs.html#7eda9a6e0ad43105" class="i method">ParseFile</a>(<span class="r536 r">schemaFilePath</span>, <b>out</b> <span class="r538 r">tokens</span>, <b>out</b> <span class="r539 r">errors</span>);
                    <a href="#5fa38071fd92c8dc" class="i field">s_currentImportingScriptFiles</a>.<span class="i">Remove</span>(<span class="r536 r">schemaFilePath</span>);
                    <a href="#83670b5df3e7c7e4" class="i property">ScriptKeywordFileCache</a>.<span class="i">Add</span>(<span class="r536 r">schemaFilePath</span>);
                }
 
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of a malformed resource reference in the DependsOn list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r540 r">badDependsOnReference</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The malformed resource.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r541 r">definingResource</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The referencing resource instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="bdf6929c3cc134e0" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBadlyFormedRequiredResourceIdErrorRecord</a>(<b>string</b> <span id="r540 rd" class="r540 r">badDependsOnReference</span>, <b>string</b> <span id="r541 rd" class="r541 r">definingResource</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r542 rd" class="r542 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                 <span class="i">ParserStrings</span>.<span class="i">GetBadlyFormedRequiredResourceId</span>, <span class="r540 r">badDependsOnReference</span>, <span class="r541 r">definingResource</span>);
 
            <span class="r542 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;GetBadlyFormedRequiredResourceId&quot;</span>);
            <b>return</b> <span class="r542 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of a malformed resource reference in the exclusive resources list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r543 r">badExclusiveResourcereference</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The malformed resource.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r544 r">definingResource</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The referencing resource instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="0f9a03c45d87295a" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBadlyFormedExclusiveResourceIdErrorRecord</a>(<b>string</b> <span id="r543 rd" class="r543 r">badExclusiveResourcereference</span>, <b>string</b> <span id="r544 rd" class="r544 r">definingResource</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r545 rd" class="r545 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                 <span class="i">ParserStrings</span>.<span class="i">GetBadlyFormedExclusiveResourceId</span>, <span class="r543 r">badExclusiveResourcereference</span>, <span class="r544 r">definingResource</span>);
 
            <span class="r545 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;GetBadlyFormedExclusiveResourceId&quot;</span>);
            <b>return</b> <span class="r545 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If a partial configuration is in &#39;Pull&#39; Mode, it needs a configuration source.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r546 r">resourceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="dbc8efc2f72fbb26" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetPullModeNeedConfigurationSource</a>(<b>string</b> <span id="r546 rd" class="r546 r">resourceId</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r547 rd" class="r547 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                 <span class="i">ParserStrings</span>.<span class="i">GetPullModeNeedConfigurationSource</span>, <span class="r546 r">resourceId</span>);
 
            <span class="r547 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;GetPullModeNeedConfigurationSource&quot;</span>);
            <b>return</b> <span class="r547 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Refresh Mode can not be Disabled for the Partial Configurations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r548 r">resourceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="7ad7e6a26c693b10" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DisabledRefreshModeNotValidForPartialConfig</a>(<b>string</b> <span id="r548 rd" class="r548 r">resourceId</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r549 rd" class="r549 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                 <span class="i">ParserStrings</span>.<span class="i">DisabledRefreshModeNotValidForPartialConfig</span>, <span class="r548 r">resourceId</span>);
 
            <span class="r549 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;DisabledRefreshModeNotValidForPartialConfig&quot;</span>);
            <b>return</b> <span class="r549 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of a malformed resource reference in the DependsOn list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r550 r">duplicateResourceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The duplicate resource identifier.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r551 r">nodeName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The node being defined.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The error record to use.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="7b49a4a7168fc182" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DuplicateResourceIdInNodeStatementErrorRecord</a>(<b>string</b> <span id="r550 rd" class="r550 r">duplicateResourceId</span>, <b>string</b> <span id="r551 rd" class="r551 r">nodeName</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r552 rd" class="r552 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                 <span class="i">ParserStrings</span>.<span class="i">DuplicateResourceIdInNodeStatement</span>, <span class="r550 r">duplicateResourceId</span>, <span class="r551 r">nodeName</span>);
 
            <span class="r552 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;DuplicateResourceIdInNodeStatement&quot;</span>);
            <b>return</b> <span class="r552 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of a configuration name is invalid.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r553 r">configurationName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="cdd9c51446f094c5" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvalidConfigurationNameErrorRecord</a>(<b>string</b> <span id="r553 rd" class="r553 r">configurationName</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r554 rd" class="r554 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                <span class="i">ParserStrings</span>.<span class="i">InvalidConfigurationName</span>, <span class="r553 r">configurationName</span>);
 
            <span class="r554 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidConfigurationName&quot;</span>);
            <b>return</b> <span class="r554 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of the given value for a property is invalid.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r555 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r556 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r557 r">keywordName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r558 r">validValues</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="acc8473f7da5d5ab" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvalidValueForPropertyErrorRecord</a>(<b>string</b> <span id="r555 rd" class="r555 r">propertyName</span>, <b>string</b> <span id="r556 rd" class="r556 r">value</span>, <b>string</b> <span id="r557 rd" class="r557 r">keywordName</span>, <b>string</b> <span id="r558 rd" class="r558 r">validValues</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r559 rd" class="r559 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                <span class="i">ParserStrings</span>.<span class="i">InvalidValueForProperty</span>, <span class="r556 r">value</span>, <span class="r555 r">propertyName</span>, <span class="r557 r">keywordName</span>, <span class="r558 r">validValues</span>);
 
            <span class="r559 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidValueForProperty&quot;</span>);
            <b>return</b> <span class="r559 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in case the given property is not valid LocalConfigurationManager property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r560 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r561 r">validProperties</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="3c1a3656a7116ab8" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvalidLocalConfigurationManagerPropertyErrorRecord</a>(<b>string</b> <span id="r560 rd" class="r560 r">propertyName</span>, <b>string</b> <span id="r561 rd" class="r561 r">validProperties</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r562 rd" class="r562 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                <span class="i">ParserStrings</span>.<span class="i">InvalidLocalConfigurationManagerProperty</span>, <span class="r560 r">propertyName</span>, <span class="r561 r">validProperties</span>);
 
            <span class="r562 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidLocalConfigurationManagerProperty&quot;</span>);
            <b>return</b> <span class="r562 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of the given value for a property is not supported.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r563 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r564 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r565 r">keywordName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r566 r">validValues</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="04ab210d4cf08e38" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">UnsupportedValueForPropertyErrorRecord</a>(<b>string</b> <span id="r563 rd" class="r563 r">propertyName</span>, <b>string</b> <span id="r564 rd" class="r564 r">value</span>, <b>string</b> <span id="r565 rd" class="r565 r">keywordName</span>, <b>string</b> <span id="r566 rd" class="r566 r">validValues</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r567 rd" class="r567 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                <span class="i">ParserStrings</span>.<span class="i">UnsupportedValueForProperty</span>, <span class="r564 r">value</span>, <span class="r563 r">propertyName</span>, <span class="r565 r">keywordName</span>, <span class="r566 r">validValues</span>);
 
            <span class="r567 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;UnsupportedValueForProperty&quot;</span>);
            <b>return</b> <span class="r567 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of no value is provided for a mandatory property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r568 r">keywordName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r569 r">typeName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r570 r">propertyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="afcfc1e2df50ed6b" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">MissingValueForMandatoryPropertyErrorRecord</a>(<b>string</b> <span id="r568 rd" class="r568 r">keywordName</span>, <b>string</b> <span id="r569 rd" class="r569 r">typeName</span>, <b>string</b> <span id="r570 rd" class="r570 r">propertyName</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r571 rd" class="r571 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                <span class="i">ParserStrings</span>.<span class="i">MissingValueForMandatoryProperty</span>, <span class="r568 r">keywordName</span>, <span class="r569 r">typeName</span>, <span class="r570 r">propertyName</span>);
 
            <span class="r571 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;MissingValueForMandatoryProperty&quot;</span>);
            <b>return</b> <span class="r571 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use in the case of more than one values are provided for DebugMode property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="9dd8ecfaf07742ed" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DebugModeShouldHaveOneValue</a>()
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r572 rd" class="r572 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                <span class="i">ParserStrings</span>.<span class="i">DebugModeShouldHaveOneValue</span>);
 
            <span class="r572 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;DebugModeShouldHaveOneValue&quot;</span>);
            <b>return</b> <span class="r572 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return an error to indicate a value is out of range for a dynamic keyword property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r573 r">property</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r574 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r575 r">providedValue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r576 r">lower</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r577 r">upper</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="d552364aadddcf7e" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ValueNotInRangeErrorRecord</a>(<b>string</b> <span id="r573 rd" class="r573 r">property</span>, <b>string</b> <span id="r574 rd" class="r574 r">name</span>, <b>int</b> <span id="r575 rd" class="r575 r">providedValue</span>, <b>int</b> <span id="r576 rd" class="r576 r">lower</span>, <b>int</b> <span id="r577 rd" class="r577 r">upper</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r578 rd" class="r578 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                <span class="i">ParserStrings</span>.<span class="i">ValueNotInRange</span>, <span class="r573 r">property</span>, <span class="r574 r">name</span>, <span class="r575 r">providedValue</span>, <span class="r576 r">lower</span>, <span class="r577 r">upper</span>);
 
            <span class="r578 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;ValueNotInRange&quot;</span>);
            <b>return</b> <span class="r578 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an error record to use when composite resource and its resource instances both has PsDscRunAsCredentials value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r579 r">resourceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">ResourceId of resource.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../engine/ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="6c13e6be72e44394" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PsDscRunAsCredentialMergeErrorForCompositeResources</a>(<b>string</b> <span id="r579 rd" class="r579 r">resourceId</span>)
        {
            <a href="../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r580 rd" class="r580 r">e</span> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                 <span class="i">ParserStrings</span>.<span class="i">PsDscRunAsCredentialMergeErrorForCompositeResources</span>, <span class="r579 r">resourceId</span>);
 
            <span class="r580 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;PsDscRunAsCredentialMergeErrorForCompositeResources&quot;</span>);
            <b>return</b> <span class="r580 r">e</span>.<a href="../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Routine to format a usage string from keyword. The resulting string should look like:</span>
        <span class="c">///</span><span class="c">        User [string] #ResourceName</span>
        <span class="c">///</span><span class="c">        {</span>
        <span class="c">///</span><span class="c">            UserName = [string]</span>
        <span class="c">///</span><span class="c">            [ Description = [string] ]</span>
        <span class="c">///</span><span class="c">            [ Disabled = [bool] ]</span>
        <span class="c">///</span><span class="c">            [ Ensure = [string] { Absent | Present }  ]</span>
        <span class="c">///</span><span class="c">            [ Force = [bool] ]</span>
        <span class="c">///</span><span class="c">            [ FullName = [string] ]</span>
        <span class="c">///</span><span class="c">            [ Password = [PSCredential] ]</span>
        <span class="c">///</span><span class="c">            [ PasswordChangeNotAllowed = [bool] ]</span>
        <span class="c">///</span><span class="c">            [ PasswordChangeRequired = [bool] ]</span>
        <span class="c">///</span><span class="c">            [ PasswordNeverExpires = [bool] ]</span>
        <span class="c">///</span><span class="c">            [ DependsOn = [string[]] ]</span>
        <span class="c">///</span><span class="c">        }</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r581 r">keyword</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="646a7d36b8e4386a" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetDSCResourceUsageString</a>(<a href="../engine/parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a> <span id="r581 rd" class="r581 r">keyword</span>)
        {
            <span class="i">StringBuilder</span> <span id="r582 rd" class="r582 r">usageString</span>;
            <b>switch</b> (<span class="r581 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#a246b575bebf7355" class="i property">NameMode</a>)
            {
                <span class="c">// Name must be present and simple non-empty bare word</span>
                <b>case</b> <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#f6123ea2d4c5e6ea" class="i field">SimpleNameRequired</a>:
                    <span class="r582 r">usageString</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r581 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a> + <span class="s">&quot; [string] # Resource Name&quot;</span>);
                    <b>break</b>;
 
                <span class="c">// Name must be present but can also be an expression</span>
                <b>case</b> <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#36ae172a002d6bd7" class="i field">NameRequired</a>:
                    <span class="r582 r">usageString</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r581 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a> + <span class="s">&quot; [string[]] # Name List&quot;</span>);
                    <b>break</b>;
 
                <span class="c">// Name may be optionally present, but if it is present, it must be a non-empty bare word.</span>
                <b>case</b> <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#dd4d9558e70de62a" class="i field">SimpleOptionalName</a>:
                    <span class="r582 r">usageString</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r581 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a> + <span class="s">&quot; [ [string] ] # Optional Name&quot;</span>);
                    <b>break</b>;
 
                <span class="c">// Name may be optionally present, expression or bare word</span>
                <b>case</b> <a href="../engine/parser/tokenizer.cs.html#84f739c2f84d69ad" class="t t">DynamicKeywordNameMode</a>.<a href="../engine/parser/tokenizer.cs.html#ba3aaa0c881f40f4" class="i field">OptionalName</a>:
                    <span class="r582 r">usageString</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r581 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a> + <span class="s">&quot; [ [string[]] ] # Optional NameList&quot;</span>);
                    <b>break</b>;
 
                <span class="c">// Does not take a name</span>
                <b>default</b>:
                    <span class="r582 r">usageString</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r581 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>);
                    <b>break</b>;
            }
 
            <span class="r582 r">usageString</span>.<span class="i">Append</span>(<span class="s">&quot;\n{\n&quot;</span>);
 
            <b>bool</b> <span id="r583 rd" class="r583 r">listKeyProperties</span> = <b>true</b>;
            <b>while</b> (<b>true</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r584 rd" class="r584 r">prop</span> <b>in</b> <span class="r581 r">keyword</span>.<a href="../engine/parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>.<span class="i">OrderBy</span>(<b>static</b> <span id="r585 rd" class="r585 r">ob</span> =&gt; <span class="r585 r">ob</span>.<span class="i">Key</span>))
                {
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r584 r">prop</span>.<span class="i">Key</span>, <span class="s">&quot;ResourceId&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>continue</b>;
                    }
 
                    <b>var</b> <span id="r586 rd" class="r586 r">propVal</span> = <span class="r584 r">prop</span>.<span class="i">Value</span>;
                    <b>if</b> (<span class="r583 r">listKeyProperties</span> &amp;&amp; <span class="r586 r">propVal</span>.<span class="i">IsKey</span> || !<span class="r583 r">listKeyProperties</span> &amp;&amp; !<span class="r586 r">propVal</span>.<span class="i">IsKey</span>)
                    {
                        <span class="r582 r">usageString</span>.<span class="i">Append</span>(<span class="r586 r">propVal</span>.<span class="i">Mandatory</span> ? <span class="s">&quot;    &quot;</span> : <span class="s">&quot;    [ &quot;</span>);
                        <span class="r582 r">usageString</span>.<span class="i">Append</span>(<span class="r584 r">prop</span>.<span class="i">Key</span>);
                        <span class="r582 r">usageString</span>.<span class="i">Append</span>(<span class="s">&quot; = &quot;</span>);
                        <span class="r582 r">usageString</span>.<span class="i">Append</span>(<span class="i">FormatCimPropertyType</span>(<span class="r586 r">propVal</span>, !<span class="r586 r">propVal</span>.<span class="i">Mandatory</span>));
                    }
                }
 
                <b>if</b> (<span class="r583 r">listKeyProperties</span>)
                {
                    <span class="r583 r">listKeyProperties</span> = <b>false</b>;
                }
                <b>else</b>
                {
                    <b>break</b>;
                }
            }
 
            <span class="r582 r">usageString</span>.<span class="i">Append</span>(<span class="s">&#39;}&#39;</span>);
 
            <b>return</b> <span class="r582 r">usageString</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Format the type name of a CIM property in a presentable way.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r587 r">prop</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r588 r">isOptionalProperty</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">StringBuilder</span> <a id="515d7d97e1e95773" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FormatCimPropertyType</a>(<a href="../engine/parser/tokenizer.cs.html#d3231c99121763c4" class="t t">DynamicKeywordProperty</a> <span id="r587 rd" class="r587 r">prop</span>, <b>bool</b> <span id="r588 rd" class="r588 r">isOptionalProperty</span>)
        {
            <b>string</b> <span id="r589 rd" class="r589 r">cimTypeName</span> = <span class="r587 r">prop</span>.<a href="../engine/parser/tokenizer.cs.html#ee8bc84e145d2931" class="i property">TypeConstraint</a>;
            <span class="i">StringBuilder</span> <span id="r590 rd" class="r590 r">formattedTypeString</span> = <b>new</b>();
 
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r589 r">cimTypeName</span>, <span class="s">&quot;MSFT_Credential&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r590 r">formattedTypeString</span>.<span class="i">Append</span>(<span class="s">&quot;[PSCredential]&quot;</span>);
            }
            <b>else</b> <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r589 r">cimTypeName</span>, <span class="s">&quot;MSFT_KeyValuePair&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) || <b>string</b>.<span class="i">Equals</span>(<span class="r589 r">cimTypeName</span>, <span class="s">&quot;MSFT_KeyValuePair[]&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r590 r">formattedTypeString</span>.<span class="i">Append</span>(<span class="s">&quot;[Hashtable]&quot;</span>);
            }
            <b>else</b>
            {
                <b>string</b> <span id="r591 rd" class="r591 r">convertedTypeString</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../engine/LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../engine/LanguagePrimitives.cs.html#ec9a4e138461cd43" class="i method">ConvertTypeNameToPSTypeName</a>(<span class="r589 r">cimTypeName</span>);
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r591 r">convertedTypeString</span>) &amp;&amp; !<b>string</b>.<span class="i">Equals</span>(<span class="r591 r">convertedTypeString</span>, <span class="s">&quot;[]&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r590 r">formattedTypeString</span>.<span class="i">Append</span>(<span class="r591 r">convertedTypeString</span>);
                }
                <b>else</b>
                {
                    <span class="r590 r">formattedTypeString</span>.<span class="i">Append</span>(<span class="s">&quot;[&quot;</span> + <span class="r589 r">cimTypeName</span> + <span class="s">&quot;]&quot;</span>);
                }
            }
 
            <span class="c">// Do the property values map</span>
            <b>if</b> (<span class="r587 r">prop</span>.<a href="../engine/parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a> != <b>null</b> &amp;&amp; <span class="r587 r">prop</span>.<a href="../engine/parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r590 r">formattedTypeString</span>.<span class="i">Append</span>(<span class="s">&quot; { &quot;</span> + <b>string</b>.<span class="i">Join</span>(<span class="s">&quot; | &quot;</span>, <span class="r587 r">prop</span>.<a href="../engine/parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a>.<span class="i">Keys</span>.<span class="i">OrderBy</span>(<b>static</b> <span id="r592 rd" class="r592 r">x</span> =&gt; <span class="r592 r">x</span>)) + <span class="s">&quot; }&quot;</span>);
            }
 
            <span class="c">// We prepend optional property with &quot;[&quot; so close out it here. This way it is shown with [ ] to indication optional</span>
            <b>if</b> (<span class="r588 r">isOptionalProperty</span>)
            {
                <span class="r590 r">formattedTypeString</span>.<span class="i">Append</span>(<span class="s">&#39;]&#39;</span>);
            }
 
            <span class="r590 r">formattedTypeString</span>.<span class="i">Append</span>(<span class="s">&#39;\n&#39;</span>);
 
            <b>return</b> <span class="r590 r">formattedTypeString</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The scriptblock that implements the CIM keyword functionality.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="07f9b437c0440e5a" href="../R/07f9b437c0440e5a.html" target="n" data-glyph="106,1" class="i property">CimKeywordImplementationFunction</a>
        {
            <b>get</b>
            {
                <span class="c">// The scriptblock cache will handle mutual exclusion</span>
                <b>return</b> <a href="#d2588aa0b2e2cbf5" class="i field">s_cimKeywordImplementationFunction</a> ??= <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../engine/lang/scriptblock.cs.html#adfac0fa7bf5725f" class="i method">Create</a>(<a href="#8204414d6968b864" class="i field">CimKeywordImplementationFunctionText</a>);
            }
        }
 
        <b>private static</b> <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="d2588aa0b2e2cbf5" href="../R/d2588aa0b2e2cbf5.html" target="n" data-glyph="46,1" class="i field">s_cimKeywordImplementationFunction</a>;
 
        <b>private const string</b> <a id="8204414d6968b864" href="../R/8204414d6968b864.html" target="n" data-glyph="10,1" class="i field">CimKeywordImplementationFunctionText</a> = <span class="s">@&quot;
    param (
        [Parameter(Mandatory)]
            $KeywordData,
        [Parameter(Mandatory)]
            $Name,
        [Parameter(Mandatory)]
        [Hashtable]
            $Value,
        [Parameter(Mandatory)]
            $SourceMetadata
    )
 
# walk the call stack to get at all of the enclosing configuration resource IDs
    $stackedConfigs = @(Get-PSCallStack |
        where { ($null -ne $_.InvocationInfo.MyCommand) -and ($_.InvocationInfo.MyCommand.CommandType -eq &#39;Configuration&#39;) })
# keep all but the top-most
    $stackedConfigs = $stackedConfigs[0..(@($stackedConfigs).Length - 2)]
# and build the complex resource ID suffix.
    $complexResourceQualifier = ( $stackedConfigs | ForEach-Object { &#39;[&#39; + $_.Command + &#39;]&#39; + $_.InvocationInfo.BoundParameters[&#39;InstanceName&#39;] } ) -join &#39;::&#39;
 
#
# Utility function used to validate that the DependsOn arguments are well-formed.
# The function also adds them to the define nodes resource collection.
# in the case of resources generated inside a script resource, this routine
# will also fix up the DependsOn references to &#39;[Type]Instance::[OuterType]::OuterInstance
#
    function Test-DependsOn
    {
 
# make sure the references are well-formed
        $updatedDependsOn = foreach ($DependsOnVar in $value[&#39;DependsOn&#39;]) {
# match [ResourceType]ResourceName. ResourceName should starts with [a-z_0-9] followed by [a-z_0-9\p{Zs}\.\\-]*
            if ($DependsOnVar -notmatch &#39;^\[[a-z]\w*\][a-z_0-9][a-z_0-9\p{Zs}\.\\-]*$&#39;)
            {
                Update-ConfigurationErrorCount
                Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::GetBadlyFormedRequiredResourceIdErrorRecord($DependsOnVar, $resourceId))
            }
 
# Fix up DependsOn for nested names
            if ($MyTypeName -and $typeName -ne $MyTypeName -and $InstanceName)
            {
                &quot;&quot;$DependsOnVar::$complexResourceQualifier&quot;&quot;
            }
            else
            {
                $DependsOnVar
            }
        }
 
        $value[&#39;DependsOn&#39;]= $updatedDependsOn
 
        if($null -ne $DependsOn)
        {
#
# Combine DependsOn with dependson from outer composite resource
# which is set as local variable $DependsOn at the composite resource context
#
            $value[&#39;DependsOn&#39;]= @($value[&#39;DependsOn&#39;]) + $DependsOn
        }
 
# Save the resource id in a per-node dictionary to do cross validation at the end
        Set-NodeResources $resourceId @( $value[&#39;DependsOn&#39;])
 
# Remove depends on because it need to be fixed up for composite resources
# We do it in ValidateNodeResource and Update-Depends on in configuration/Node function
        $value.Remove(&#39;DependsOn&#39;)
    }
 
# A copy of the value object with correctly-cased property names
    $canonicalizedValue = @{}
 
    $typeName = $keywordData.ResourceName # CIM type
    $keywordName = $keywordData.Keyword   # user-friendly alias that is used in scripts
    $keyValues = &#39;&#39;
    $debugPrefix = &quot;&quot;   ${TypeName}:&quot;&quot; # set up a debug prefix string that makes it easier to track what&#39;s happening.
 
    Write-Debug &quot;&quot;${debugPrefix} RESOURCE PROCESSING STARTED [KeywordName=&#39;$keywordName&#39;] Function=&#39;$($myinvocation.Invocationname)&#39;]&quot;&quot;
 
# Check whether it&#39;s an old style metaconfig
    $OldMetaConfig = $false
    if ((-not $IsMetaConfig) -and ($keywordName -ieq &#39;LocalConfigurationManager&#39;)) {
        $OldMetaConfig = $true
    }
 
# Check to see if it&#39;s a resource keyword. If so add the meta-properties to the canonical property collection.
    $resourceId = $null
# todo: need to include configuration managers and partial configuration
    if (($keywordData.Properties.Keys -contains &#39;DependsOn&#39;) -or (($KeywordData.ImplementingModule -ieq &#39;PSDesiredStateConfigurationEngine&#39;) -and ($KeywordData.NameMode -eq [System.Management.Automation.Language.DynamicKeywordNameMode]::NameRequired)))
    {
 
        $resourceId = &quot;&quot;[$keywordName]$name&quot;&quot;
        if ($MyTypeName -and $keywordName -ne $MyTypeName -and $InstanceName)
        {
            $resourceId += &quot;&quot;::$complexResourceQualifier&quot;&quot;
        }
 
        Write-Debug &quot;&quot;${debugPrefix} ResourceID = $resourceId&quot;&quot;
 
# copy the meta-properties
        $canonicalizedValue[&#39;ResourceID&#39;] = $resourceId
        $canonicalizedValue[&#39;SourceInfo&#39;] = $SourceMetadata
        if(-not $IsMetaConfig)
        {
            $canonicalizedValue[&#39;ModuleName&#39;] = $keywordData.ImplementingModule
            $canonicalizedValue[&#39;ModuleVersion&#39;] = $keywordData.ImplementingModuleVersion -as [string]
        }
 
# see if there is already a resource with this ID.
        if (Test-NodeResources $resourceId)
        {
            Update-ConfigurationErrorCount
            Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::DuplicateResourceIdInNodeStatementErrorRecord($resourceId, (Get-PSCurrentConfigurationNode)))
        }
        else
        {
# If there are prerequisite resources, validate that the references are well-formed strings
# This routine also adds the resource to the global node resources table.
            Test-DependsOn
 
# Check if PsDscRunCredential is being specified as Arguments to Configuration
        if($null -ne $PsDscRunAsCredential)
        {
# Check if resource is also trying to set the value for RunAsCred
# In that case we will generate error during compilation, this is merge error
        if($null -ne $value[&#39;PsDscRunAsCredential&#39;])
        {
            Update-ConfigurationErrorCount
            Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::PsDscRunAsCredentialMergeErrorForCompositeResources($resourceId))
        }
# Set the Value of RunAsCred to that of outer configuration
        else
        {
            $value[&#39;PsDscRunAsCredential&#39;] = $PsDscRunAsCredential
        }
    }
 
# Save the resource id in a per-node dictionary to do cross validation at the end
            if($keywordData.ImplementingModule -ieq &quot;&quot;PSDesiredStateConfigurationEngine&quot;&quot;)
            {
#$keywordName is PartialConfiguration
                if($keywordName -eq &#39;PartialConfiguration&#39;)
                {
# RefreshMode is &#39;Pull&#39; and .ConfigurationSource is empty
                    if($value[&#39;RefreshMode&#39;] -eq &#39;Pull&#39; -and -not $value[&#39;ConfigurationSource&#39;])
                    {
                        Update-ConfigurationErrorCount
                        Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::GetPullModeNeedConfigurationSource($resourceId))
                    }
 
# Verify that RefreshMode is not Disabled for Partial configuration
                    if($value[&#39;RefreshMode&#39;] -eq &#39;Disabled&#39;)
                    {
                        Update-ConfigurationErrorCount
                        Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::DisabledRefreshModeNotValidForPartialConfig($resourceId))
                    }
 
                    if($null -ne $value[&#39;ConfigurationSource&#39;])
                    {
                        Set-NodeManager $resourceId $value[&#39;ConfigurationSource&#39;]
                    }
 
                    if($null -ne $value[&#39;ResourceModuleSource&#39;])
                    {
                        Set-NodeResourceSource $resourceId $value[&#39;ResourceModuleSource&#39;]
                    }
                }
 
                if($null -ne $value[&#39;ExclusiveResources&#39;])
                {
# make sure the references are well-formed
                    foreach ($ExclusiveResource in $value[&#39;ExclusiveResources&#39;]) {
                        if (($ExclusiveResource -notmatch &#39;^[a-z][a-z_0-9]*\\[a-z][a-z_0-9]*$&#39;) -and ($ExclusiveResource -notmatch &#39;^[a-z][a-z_0-9]*$&#39;) -and ($ExclusiveResource -notmatch &#39;^[a-z][a-z_0-9]*\\\*$&#39;))
                        {
                            Update-ConfigurationErrorCount
                            Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::GetBadlyFormedExclusiveResourceIdErrorRecord($ExclusiveResource, $resourceId))
                        }
                    }
 
# Save the resource id in a per-node dictionary to do cross validation at the end
# Validate resource exist
# Also update the resource reference from module\friendlyname to module\name
                    $value[&#39;ExclusiveResources&#39;] = @(Set-NodeExclusiveResources $resourceId @( $value[&#39;ExclusiveResources&#39;] ))
                }
            }
        }
    }
    else
    {
        Write-Debug &quot;&quot;${debugPrefix} TYPE IS NOT AS DSC RESOURCE&quot;&quot;
    }
 
#
# Copy the user-supplied values into a new collection with canonicalized property names
#
    foreach ($key in $keywordData.Properties.Keys)
    {
        Write-Debug &quot;&quot;${debugPrefix} Processing property &#39;$key&#39; [&quot;&quot;
 
        if ($value.Contains($key))
        {
            if ($OldMetaConfig -and (-not ($V1MetaConfigPropertyList -contains $key)))
            {
                Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::InvalidLocalConfigurationManagerPropertyErrorRecord($key, ($V1MetaConfigPropertyList -join &#39;, &#39;)))
                Update-ConfigurationErrorCount
            }
# see if there is a list of allowed values for this property (similar to an enum)
            $allowedValues = $keywordData.Properties[$key].Values
# If there is and user-provided value is not in that list, write an error.
            if ($allowedValues)
            {
                if(($null -eq $value[$key]) -and ($allowedValues -notcontains $value[$key]))
                {
                    Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::InvalidValueForPropertyErrorRecord($key, &quot;&quot;$($value[$key])&quot;&quot;, $keywordData.Keyword, ($allowedValues -join &#39;, &#39;)))
                    Update-ConfigurationErrorCount
                }
                else
                {
                    $notAllowedValue=$null
                    foreach($v in $value[$key])
                    {
                        if($allowedValues -notcontains $v)
                        {
                            $notAllowedValue +=$v.ToString() + &#39;, &#39;
                        }
                    }
 
                    if($notAllowedValue)
                    {
                        $notAllowedValue = $notAllowedValue.Substring(0, $notAllowedValue.Length -2)
                        Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::UnsupportedValueForPropertyErrorRecord($key, $notAllowedValue, $keywordData.Keyword, ($allowedValues -join &#39;, &#39;)))
                        Update-ConfigurationErrorCount
                    }
                }
            }
 
# see if a value range is defined for this property
            $allowedRange = $keywordData.Properties[$key].Range
            if($allowedRange)
            {
                $castedValue = $value[$key] -as [int]
                if((($castedValue -is [int]) -and (($castedValue -lt  $keywordData.Properties[$key].Range.Item1) -or ($castedValue -gt $keywordData.Properties[$key].Range.Item2))) -or ($null -eq $castedValue))
                {
                    Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::ValueNotInRangeErrorRecord($key, $keywordName, $value[$key],  $keywordData.Properties[$key].Range.Item1,  $keywordData.Properties[$key].Range.Item2))
                    Update-ConfigurationErrorCount
                }
            }
 
            Write-Debug &quot;&quot;${debugPrefix}        Canonicalized property &#39;$key&#39; = &#39;$($value[$key])&#39;&quot;&quot;
 
            if ($keywordData.Properties[$key].IsKey)
            {
                if($null -eq $value[$key])
                {
                    $keyValues += &quot;&quot;::__NULL__&quot;&quot;
                }
                else
                {
                    $keyValues += &quot;&quot;::&quot;&quot; + $value[$key]
                }
            }
 
# see if ValueMap is also defined for this property (actual values)
            $allowedValueMap = $keywordData.Properties[$key].ValueMap
#if it is and the ValueMap contains the user-provided value as a key, use the actual value
            if ($allowedValueMap -and $allowedValueMap.ContainsKey($value[$key]))
            {
                $canonicalizedValue[$key] = $allowedValueMap[$value[$key]]
            }
            else
            {
                $canonicalizedValue[$key] = $value[$key]
            }
        }
        elseif ($keywordData.Properties[$key].Mandatory)
        {
# If the property was mandatory but the user didn&#39;t provide a value, write and error.
            Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::MissingValueForMandatoryPropertyErrorRecord($keywordData.Keyword, $keywordData.Properties[$key].TypeConstraint, $Key))
            Update-ConfigurationErrorCount
        }
 
        Write-Debug &quot;&quot;${debugPrefix}    Processing completed &#39;$key&#39; ]&quot;&quot;
    }
 
    if($keyValues)
    {
        $keyValues = $keyValues.Substring(2) # Remove the leading &#39;::&#39;
        Add-NodeKeys $keyValues $keywordName
        Test-ConflictingResources $keywordName $canonicalizedValue $keywordData
    }
 
# update OMI_ConfigurationDocument
    if($IsMetaConfig)
    {
        if($keywordData.ResourceName -eq &#39;OMI_ConfigurationDocument&#39;)
        {
            if($(Get-PSMetaConfigurationProcessed))
            {
                $PSMetaConfigDocumentInstVersionInfo = Get-PSMetaConfigDocumentInstVersionInfo
                $canonicalizedValue[&#39;MinimumCompatibleVersion&#39;]=$PSMetaConfigDocumentInstVersionInfo[&#39;MinimumCompatibleVersion&#39;]
            }
            else
            {
                Set-PSMetaConfigDocInsProcessedBeforeMeta
                $canonicalizedValue[&#39;MinimumCompatibleVersion&#39;]=&#39;1.0.0&#39;
            }
        }
 
        if(($keywordData.ResourceName -eq &#39;MSFT_WebDownloadManager&#39;) `
            -or ($keywordData.ResourceName -eq &#39;MSFT_FileDownloadManager&#39;) `
            -or ($keywordData.ResourceName -eq &#39;MSFT_WebResourceManager&#39;) `
            -or ($keywordData.ResourceName -eq &#39;MSFT_FileResourceManager&#39;) `
            -or ($keywordData.ResourceName -eq &#39;MSFT_WebReportManager&#39;) `
            -or ($keywordData.ResourceName -eq &#39;MSFT_SignatureValidation&#39;) `
            -or ($keywordData.ResourceName -eq &#39;MSFT_PartialConfiguration&#39;))
        {
            Set-PSMetaConfigVersionInfoV2
        }
    }
    elseif($keywordData.ResourceName -eq &#39;OMI_ConfigurationDocument&#39;)
    {
        $canonicalizedValue[&#39;MinimumCompatibleVersion&#39;]=&#39;1.0.0&#39;
        $canonicalizedValue[&#39;CompatibleVersionAdditionalProperties&#39;]=@(&#39;Omi_BaseResource:ConfigurationName&#39;)
    }
 
    if(($keywordData.ResourceName -eq &#39;MSFT_DSCMetaConfiguration&#39;) -or ($keywordData.ResourceName -eq &#39;MSFT_DSCMetaConfigurationV2&#39;))
    {
        if($canonicalizedValue[&#39;DebugMode&#39;] -and @($canonicalizedValue[&#39;DebugMode&#39;]).Length -gt 1)
        {
# we only allow one value for debug mode now.
            Write-Error -ErrorRecord ([Microsoft.PowerShell.DesiredStateConfiguration.Internal.DscClassCache]::DebugModeShouldHaveOneValue())
            Update-ConfigurationErrorCount
        }
    }
 
# Generate the MOF text for this resource instance.
# when generate mof text for OMI_ConfigurationDocument we handle below two cases:
# 1. we will add versioning related property based on meta configuration instance already process
# 2. we update the existing OMI_ConfigurationDocument instance if it already exists when process meta configuration instance
    $aliasId = ConvertTo-MOFInstance $keywordName $canonicalizedValue
 
# If a OMI_ConfigurationDocument is executed outside of a node statement, it becomes the default
# for all nodes that don&#39;t have an explicit OMI_ConfigurationDocument declaration
    if ($keywordData.ResourceName -eq &#39;OMI_ConfigurationDocument&#39; -and -not (Get-PSCurrentConfigurationNode))
    {
        $data = Get-MoFInstanceText $aliasId
        Write-Debug &quot;&quot;${debugPrefix} DEFINING DEFAULT CONFIGURATION DOCUMENT: $data&quot;&quot;
        Set-PSDefaultConfigurationDocument $data
    }
 
    Write-Debug &quot;&quot;${debugPrefix} MOF alias for this resource is &#39;$aliasId&#39;&quot;&quot;
 
# always return the aliasId so the generated file will be well-formed if not valid
    $aliasId
 
    Write-Debug &quot;&quot;${debugPrefix} RESOURCE PROCESSING COMPLETED. TOTAL ERROR COUNT: $(Get-ConfigurationErrorCount)&quot;&quot;
 
    &quot;</span>;
    }
}
</pre></td></tr></table></div></body></html>
