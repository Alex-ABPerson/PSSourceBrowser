<!DOCTYPE html>
<html><head><title>ParameterBinderBase.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(2069);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/ParameterBinderBase.cs" target="_top">engine\ParameterBinderBase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Flags.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Flags</span>]
    <b>internal enum</b> <a id="2554c5af1a54de10" href="../R/2554c5af1a54de10.html" target="n" data-glyph="20,0" class="t t"><span id="a4705c1c2aa4452c">ParameterBindingFlags</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No flags specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="fc91c8b7242cb73c" href="../R/fc91c8b7242cb73c.html" target="n" data-glyph="24,1" class="i field">None</a> = 0,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set when the argument should be converted to the parameter type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="624cb715ac400e62" href="../R/624cb715ac400e62.html" target="n" data-glyph="24,1" class="i field">ShouldCoerceType</a> = 0x01,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set when the argument should not be validated or recorded in BoundParameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="765bb2966dedd770" href="../R/765bb2966dedd770.html" target="n" data-glyph="24,1" class="i field">IsDefaultValue</a> = 0x02,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set when script blocks can be bound as a script block parameter instead of a normal argument.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="31ebbff231d00d8c" href="../R/31ebbff231d00d8c.html" target="n" data-glyph="24,1" class="i field">DelayBindScriptBlock</a> = 0x04,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set when an exception will be thrown if a matching parameter could not be found.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="29b6a605a3b407fe" href="../R/29b6a605a3b407fe.html" target="n" data-glyph="24,1" class="i field">ThrowOnParameterNotFound</a> = 0x08,
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> An abstract class used by the CommandProcessor to bind parameters to a bindable object.</span>
    <span class="c">///</span><span class="c"> Derived classes are used to provide specific binding behavior for different object types,</span>
    <span class="c">///</span><span class="c"> like Cmdlet, PsuedoParameterCollection, and dynamic parameter objects.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">DebuggerDisplay</span>(<span class="s">&quot;Command = {command}&quot;</span>)]
    <b>internal abstract class</b> <a id="6a035e6bf95bfc67" href="../R/6a035e6bf95bfc67.html" target="n" data-glyph="2,0" class="t t">ParameterBinderBase</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> tracer
        [<span class="i">TraceSource</span>(<span class="s">&quot;ParameterBinderBase&quot;</span>, <span class="s">&quot;A abstract helper class for the CommandProcessor that binds parameters to the specified object.&quot;</span>)]
        <b>private static readonly</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="b3b3f9a9a9756bfd" href="../R/b3b3f9a9a9756bfd.html" target="n" data-glyph="46,1" class="i field">s_tracer</a> = <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;ParameterBinderBase&quot;</span>, <span class="s">&quot;A abstract helper class for the CommandProcessor that binds parameters to the specified object.&quot;</span>);
 
        [<span class="i">TraceSource</span>(<span class="s">&quot;ParameterBinding&quot;</span>, <span class="s">&quot;Traces the process of binding the arguments to the parameters of cmdlets, scripts, and applications.&quot;</span>)]
        <b>internal static readonly</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="53b6cf6cdd8c3311" href="../R/53b6cf6cdd8c3311.html" target="n" data-glyph="44,1" class="i field">bindingTracer</a> =
            <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#24b0f68d5add3eb3" class="i method">GetTracer</a>(
                <span class="s">&quot;ParameterBinding&quot;</span>,
                <span class="s">&quot;Traces the process of binding the arguments to the parameters of cmdlets, scripts, and applications.&quot;</span>,
                <b>false</b>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> tracer
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs the parameter binder with the specified type metadata. The binder is only valid</span>
        <span class="c">///</span><span class="c"> for a single instance of a bindable object and only for the duration of a command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">target</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The target object that the parameter values will be bound to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">invocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The invocation information for the code that is being bound.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context of the currently running engine.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The command that the parameter binder is binding to. The command can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="bc256a2078ea84da" href="../R/bc256a2078ea84da.html" target="n" data-glyph="74,1" class="t constructor">ParameterBinderBase</a>(
            <b>object</b> <span id="r0 rd" class="r0 r">target</span>,
            <a href="InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r1 rd" class="r1 r">invocationInfo</span>,
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r2 rd" class="r2 r">context</span>,
            <a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <span id="r3 rd" class="r3 r">command</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r0 r">target</span> != <b>null</b>, <span class="s">&quot;caller to verify target is not null.&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r1 r">invocationInfo</span> != <b>null</b>, <span class="s">&quot;caller to verify invocationInfo is not null.&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r2 r">context</span> != <b>null</b>, <span class="s">&quot;caller to verify context is not null.&quot;</span>);
 
            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#3505964c91d1d5ab" class="i property">ShowHeaders</a> = <b>false</b>;
 
            <a href="#7a3d84607d418b57" class="i field">_command</a> = <span class="r3 r">command</span>;
            <a href="#498e870165ab176c" class="i field">_target</a> = <span class="r0 r">target</span>;
            <a href="#80ed49655f77084a" class="i field">_invocationInfo</a> = <span class="r1 r">invocationInfo</span>;
            <a href="#e067e081f2e9b0bc" class="i field">_context</a> = <span class="r2 r">context</span>;
            <a href="#330e079e5228709c" class="i field">_engine</a> = <span class="r2 r">context</span>.<a href="ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>;
            <a href="#7abe01a0503a6db5" class="i field">_isTranscribing</a> = <span class="r2 r">context</span>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#6694b338e46fdead" class="i property">IsTranscribing</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs the parameter binder with the specified type metadata. The binder is only valid</span>
        <span class="c">///</span><span class="c"> for a single instance of a bindable object and only for the duration of a command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">invocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The invocation information for the code that is being bound.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context of the currently running engine.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The command that the parameter binder is binding to. The command can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="ff7cf804804dd6cc" href="../R/ff7cf804804dd6cc.html" target="n" data-glyph="74,1" class="t constructor">ParameterBinderBase</a>(
            <a href="InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r4 rd" class="r4 r">invocationInfo</span>,
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r5 rd" class="r5 r">context</span>,
            <a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <span id="r6 rd" class="r6 r">command</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r4 r">invocationInfo</span> != <b>null</b>, <span class="s">&quot;caller to verify invocationInfo is not null.&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r5 r">context</span> != <b>null</b>, <span class="s">&quot;caller to verify context is not null.&quot;</span>);
 
            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#3505964c91d1d5ab" class="i property">ShowHeaders</a> = <b>false</b>;
 
            <a href="#7a3d84607d418b57" class="i field">_command</a> = <span class="r6 r">command</span>;
            <a href="#80ed49655f77084a" class="i field">_invocationInfo</a> = <span class="r4 r">invocationInfo</span>;
            <a href="#e067e081f2e9b0bc" class="i field">_context</a> = <span class="r5 r">context</span>;
            <a href="#330e079e5228709c" class="i field">_engine</a> = <span class="r5 r">context</span>.<a href="ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>;
            <a href="#7abe01a0503a6db5" class="i field">_isTranscribing</a> = <span class="r5 r">context</span>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#6694b338e46fdead" class="i property">IsTranscribing</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctor
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> internal members
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the bindable object that the binder will bind parameters to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="62c9f56fb1113471" href="../R/62c9f56fb1113471.html" target="n" data-glyph="104,1" class="i property">Target</a>
        {
            <b>get</b>
            {
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                    <a href="#498e870165ab176c" class="i field">_target</a> != <b>null</b>,
                    <span class="s">&quot;The target should always be set for the binder&quot;</span>);
 
                <b>return</b> <a href="#498e870165ab176c" class="i field">_target</a>;
            }
 
            <b>set</b>
            {
                <a href="#498e870165ab176c" class="i field">_target</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The bindable object that parameters will be bound to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private object</b> <a id="498e870165ab176c" href="../R/498e870165ab176c.html" target="n" data-glyph="46,1" class="i field">_target</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Holds the set of parameters that have been bound from the command line...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#efc1e794ccda0552" class="t t">CommandLineParameters</a> <a id="4555288f0b3927cb" href="../R/4555288f0b3927cb.html" target="n" data-glyph="104,1" class="i property">CommandLineParameters</a>
        {
            <b>get</b> { <b>return</b> <a href="#608a94ea4758528a" class="i field">_commandLineParameters</a> ??= <b>new</b> <span class="t">CommandLineParameters</span>(); }
 
            <span class="c">// Setter is needed to pass into RuntimeParameterBinder instances</span>
            <b>set</b> { <a href="#608a94ea4758528a" class="i field">_commandLineParameters</a> = <b>value</b>; }
        }
 
        <b>private</b> <a href="#efc1e794ccda0552" class="t t">CommandLineParameters</a> <a id="608a94ea4758528a" href="../R/608a94ea4758528a.html" target="n" data-glyph="46,1" class="i field">_commandLineParameters</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this is true, then we want to record the list of bound parameters...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="80f311903d85dd3b" href="../R/80f311903d85dd3b.html" target="n" data-glyph="44,1" class="i field">RecordBoundParameters</a> = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Full Qualified ID for the obsolete parameter warning.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const string</b> <a id="1e7425f5fa5359d6" href="../R/1e7425f5fa5359d6.html" target="n" data-glyph="8,1" class="i field">FQIDParameterObsolete</a> = <span class="s">&quot;ParameterObsolete&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameter default values
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Derived classes must override this method to get the default parameter</span>
        <span class="c">///</span><span class="c"> value so that it can be restored between pipeline input.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the parameter to get the default value of.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The value of the parameter specified by name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal abstract object</b> <a id="5b59a05c2ca863a1" href="../R/5b59a05c2ca863a1.html" target="n" data-glyph="74,1" class="i method">GetDefaultParameterValue</a>(<b>string</b> <span id="r7 rd" class="r7 r">name</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameter default values
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameter binding
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Derived classes define this method to bind the specified value</span>
        <span class="c">///</span><span class="c"> to the specified parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     The name of the parameter to bind the value to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     The value to bind to the parameter. It should be assumed by</span>
        <span class="c">///</span><span class="c">     derived classes that the proper type coercion has already taken</span>
        <span class="c">///</span><span class="c">     place and that any validation metadata has been satisfied.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">parameterMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal abstract void</b> <a id="fa702e1956545968" href="../R/fa702e1956545968.html" target="n" data-glyph="74,1" class="i method">BindParameter</a>(<b>string</b> <span id="r8 rd" class="r8 r">name</span>, <b>object</b> <span id="r9 rd" class="r9 r">value</span>, <a href="CompiledCommandParameter.cs.html#0bb5a64f862f9cc4" class="t t">CompiledCommandParameter</a> <span id="r10 rd" class="r10 r">parameterMetadata</span>);
 
        <b>private void</b> <a id="525dab7ff926cdcd" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ValidatePSTypeName</a>(
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r11 rd" class="r11 r">parameter</span>,
            <a href="CompiledCommandParameter.cs.html#0bb5a64f862f9cc4" class="t t">CompiledCommandParameter</a> <span id="r12 rd" class="r12 r">parameterMetadata</span>,
            <b>bool</b> <span id="r13 rd" class="r13 r">retryOtherBindingAfterFailure</span>,
            <b>object</b> <span id="r14 rd" class="r14 r">parameterValue</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r11 r">parameter</span> != <b>null</b>, <span class="s">&quot;Caller should verify parameter != null&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r12 r">parameterMetadata</span> != <b>null</b>, <span class="s">&quot;Caller should verify parameterMetadata != null&quot;</span>);
 
            <b>if</b> (<span class="r14 r">parameterValue</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r15 rd" class="r15 r">psTypeNamesOfArgumentValue</span> = <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r14 r">parameterValue</span>).<a href="MshObject.cs.html#829da48f79891848" class="i property">InternalTypeNames</a>;
            <b>string</b> <span id="r16 rd" class="r16 r">psTypeNameRequestedByParameter</span> = <span class="r12 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#9ba1940df549678f" class="i property">PSTypeName</a>;
 
            <b>if</b> (!<span class="r15 r">psTypeNamesOfArgumentValue</span>.<span class="i">Contains</span>(<span class="r16 r">psTypeNameRequestedByParameter</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// win8: 228176..The callers know when to ignore and when not to ignore invalid cast exceptions.</span>
                <a href="ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a> <span id="r17 rd" class="r17 r">e</span> = <b>new</b> <span class="t">PSInvalidCastException</span>(<b>nameof</b>(<a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>),
                        <b>null</b>,
                        <span class="i">ParameterBinderStrings</span>.<span class="i">MismatchedPSTypeName</span>,
                        (<a href="#80ed49655f77084a" class="i field">_invocationInfo</a> != <b>null</b>) &amp;&amp; (<a href="#80ed49655f77084a" class="i field">_invocationInfo</a>.<a href="InvocationInfo.cs.html#8edab65bf1913897" class="i property">MyCommand</a> != <b>null</b>) ? <a href="#80ed49655f77084a" class="i field">_invocationInfo</a>.<a href="InvocationInfo.cs.html#8edab65bf1913897" class="i property">MyCommand</a>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a> : <b>string</b>.<span class="i">Empty</span>,
                        <span class="r12 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                        <span class="r12 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                        <span class="r14 r">parameterValue</span>.<span class="i">GetType</span>(),
                        0,
                        0,
                        <span class="r16 r">psTypeNameRequestedByParameter</span>);
 
                <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r18 rd" class="r18 r">parameterBindingException</span>;
                <b>if</b> (!<span class="r13 r">retryOtherBindingAfterFailure</span>)
                {
                    <span class="r18 r">parameterBindingException</span> = <b>new</b> <span class="t">ParameterBindingArgumentTransformationException</span>(
                        <span class="r17 r">e</span>,
                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                        <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r11 r">parameter</span>),
                        <span class="r12 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                        <span class="r12 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                        <span class="r14 r">parameterValue</span>.<span class="i">GetType</span>(),
                        <span class="i">ParameterBinderStrings</span>.<span class="i">MismatchedPSTypeName</span>,
                        <span class="s">&quot;MismatchedPSTypeName&quot;</span>,
                        <span class="r16 r">psTypeNameRequestedByParameter</span>);
                }
                <b>else</b>
                {
                    <span class="r18 r">parameterBindingException</span> = <b>new</b> <span class="t">ParameterBindingException</span>(
                        <span class="r17 r">e</span>,
                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                        <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r11 r">parameter</span>),
                        <span class="r12 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                        <span class="r12 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                        <span class="r14 r">parameterValue</span>.<span class="i">GetType</span>(),
                        <span class="i">ParameterBinderStrings</span>.<span class="i">MismatchedPSTypeName</span>,
                        <span class="s">&quot;MismatchedPSTypeName&quot;</span>,
                        <span class="r16 r">psTypeNameRequestedByParameter</span>);
                }
 
                <b>throw</b> <span class="r18 r">parameterBindingException</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Does all the type coercion, data generation, and validation necessary to bind the</span>
        <span class="c">///</span><span class="c"> parameter, then calls the protected BindParameter method to have</span>
        <span class="c">///</span><span class="c"> the derived class do the actual binding.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">parameter</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The parameter to be bound.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">parameterMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The metadata for the parameter to use in guiding the binding.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">flags</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flags for type coercion and validation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the parameter was successfully bound. False if </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">coerceTypeIfNeeded</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> is false and the type does not match the parameter type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The binding algorithm goes as follows:</span>
        <span class="c">///</span><span class="c"> 1. The data generation attributes are run</span>
        <span class="c">///</span><span class="c"> 2. The data is coerced into the correct type</span>
        <span class="c">///</span><span class="c"> 3. The data if validated using the validation attributes</span>
        <span class="c">///</span><span class="c"> 4. The data is encoded into the bindable object using the</span>
        <span class="c">///</span><span class="c">    protected BindParameter method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">parameter</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">parameterMetadata</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If argument transformation fails.</span>
        <span class="c">///</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> The argument could not be coerced to the appropriate type for the parameter.</span>
        <span class="c">///</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> The parameter argument transformation, prerequisite, or validation failed.</span>
        <span class="c">///</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> If the binding to the parameter fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal virtual bool</b> <a id="af68f8de580249df" href="../R/af68f8de580249df.html" target="n" data-glyph="74,1" class="i method">BindParameter</a>(
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r19 rd" class="r19 r">parameter</span>,
            <a href="CompiledCommandParameter.cs.html#0bb5a64f862f9cc4" class="t t">CompiledCommandParameter</a> <span id="r20 rd" class="r20 r">parameterMetadata</span>,
            <a href="#2554c5af1a54de10" class="t t">ParameterBindingFlags</a> <span id="r21 rd" class="r21 r">flags</span>)
        {
            <b>bool</b> <span id="r22 rd" class="r22 r">result</span> = <b>false</b>;
            <b>bool</b> <span id="r23 rd" class="r23 r">coerceTypeIfNeeded</span> = (<span class="r21 r">flags</span> &amp; <a href="#2554c5af1a54de10" class="t t">ParameterBindingFlags</a>.<a href="#624cb715ac400e62" class="i field">ShouldCoerceType</a>) != 0;
            <b>bool</b> <span id="r24 rd" class="r24 r">isDefaultValue</span> = (<span class="r21 r">flags</span> &amp; <a href="#2554c5af1a54de10" class="t t">ParameterBindingFlags</a>.<a href="#765bb2966dedd770" class="i field">IsDefaultValue</a>) != 0;
 
            <b>if</b> (<span class="r19 r">parameter</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r19 r">parameter</span>));
            }
 
            <b>if</b> (<span class="r20 r">parameterMetadata</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r20 r">parameterMetadata</span>));
            }
 
            <b>using</b> (<a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#3e3de94a643f35de" class="i method">TraceScope</a>(
                       <span class="s">&quot;BIND arg [{0}] to parameter [{1}]&quot;</span>,
                       <span class="r19 r">parameter</span>.<a href="CommandParameter.cs.html#8b23fe67ce0ebecb" class="i property">ArgumentValue</a>,
                       <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>))
            {
                <span class="c">// Set the complete parameter name</span>
 
                <span class="r19 r">parameter</span>.<a href="CommandParameter.cs.html#8a262faeff991e7d" class="i property">ParameterName</a> = <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>;
 
                <b>object</b> <span id="r25 rd" class="r25 r">parameterValue</span> = <span class="r19 r">parameter</span>.<a href="CommandParameter.cs.html#8b23fe67ce0ebecb" class="i property">ArgumentValue</a>;
 
                <b>do</b> <span class="c">// false loop</span>
                {
                    <span class="c">// Now call any argument transformation attributes that might be present on the parameter</span>
                    <a href="scriptparameterbinder.cs.html#070e81280a64ffb7" class="t t">ScriptParameterBinder</a> <span id="r26 rd" class="r26 r">spb</span> = <a href="#6a035e6bf95bfc67" class="k">this</a> <b>as</b> <a href="scriptparameterbinder.cs.html#070e81280a64ffb7" class="t t">ScriptParameterBinder</a>;
                    <b>bool</b> <span id="r27 rd" class="r27 r">usesCmdletBinding</span> = <b>false</b>;
                    <b>if</b> (<span class="r26 r">spb</span> != <b>null</b>)
                    {
                        <span class="r27 r">usesCmdletBinding</span> = <span class="r26 r">spb</span>.<a href="scriptparameterbinder.cs.html#b642403a070fddb7" class="i property">Script</a>.<a href="runtime/CompiledScriptBlock.cs.html#42e46e4ff0244eb3" class="i property">UsesCmdletBinding</a>;
                    }
 
                    <span class="c">// Now do the argument transformation. No transformation is done for the default values in script that meet the following 2 conditions:</span>
                    <span class="c">//  1. the default value is not specified by the user, but is the powershell default value.</span>
                    <span class="c">//     e.g. the powershell default value for a class type is null, for the string type is string.empty.</span>
                    <span class="c">//  2. the powershell default value is null.</span>
                    <span class="c">// This is to prevent ArgumentTransformationAttributes from making a non-mandatory parameter behave like a mandatory one.</span>
                    <span class="c">// Example:</span>
                    <span class="c">//   ## without the fix, &#39;CredentialAttribute&#39; would make $Credential like a mandatory parameter</span>
                    <span class="c">//   ## &#39;PS&gt; test-credential&#39; would prompt for credential input</span>
                    <span class="c">//   function test-credential {</span>
                    <span class="c">//       param(</span>
                    <span class="c">//           [System.Management.Automation.CredentialAttribute()]</span>
                    <span class="c">//           $Credential</span>
                    <span class="c">//       )</span>
                    <span class="c">//       $Credential</span>
                    <span class="c">//   }</span>
                    <span class="c">//</span>
                    <b>foreach</b> (<a href="Attributes.cs.html#80472519ecf33cf1" class="t t">ArgumentTransformationAttribute</a> <span id="r28 rd" class="r28 r">dma</span> <b>in</b> <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#91e5071384d2bc8f" class="i property">ArgumentTransformationAttributes</a>)
                    {
                        <b>using</b> (<a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">TraceScope</span>(
                            <span class="s">&quot;Executing DATA GENERATION metadata: [{0}]&quot;</span>,
                            <span class="r28 r">dma</span>.<span class="i">GetType</span>()))
                        {
                            <b>try</b>
                            {
                                <a href="ArgumentTypeConverterAttribute.cs.html#3116d64966cc38c0" class="t t">ArgumentTypeConverterAttribute</a> <span id="r29 rd" class="r29 r">argumentTypeConverter</span> = <span class="r28 r">dma</span> <b>as</b> <a href="ArgumentTypeConverterAttribute.cs.html#3116d64966cc38c0" class="t t">ArgumentTypeConverterAttribute</a>;
 
                                <b>if</b> (<span class="r29 r">argumentTypeConverter</span> != <b>null</b>)
                                {
                                    <b>if</b> (<span class="r23 r">coerceTypeIfNeeded</span>)
                                    {
                                        <span class="r25 r">parameterValue</span> = <span class="r29 r">argumentTypeConverter</span>.<a href="ArgumentTypeConverterAttribute.cs.html#ccf6ab3305cb0c5f" class="i method">Transform</a>(<a href="#330e079e5228709c" class="i field">_engine</a>, <span class="r25 r">parameterValue</span>, <b>true</b>, <span class="r27 r">usesCmdletBinding</span>);
                                    }
                                }
                                <b>else</b>
                                {
                                    <span class="c">// Only apply argument transformation when the argument is not null, is mandatory, or disallows null as a value.</span>
                                    <span class="c">//</span>
                                    <span class="c">// If we are binding default value for an unbound script parameter, this parameter is guaranteed not mandatory</span>
                                    <span class="c">// in the chosen parameter set. This is because:</span>
                                    <span class="c">//  1. If we use cmdlet binding for this script (CmdletParameterBinderController is used), then binding</span>
                                    <span class="c">//     default value to unbound parameters won&#39;t happen until after all mandatory parameters from the</span>
                                    <span class="c">//     chosen parameter set are handled. Therefore, the unbound parameter we are dealing with here won&#39;t</span>
                                    <span class="c">//     be mandatory in the chosen parameter set.</span>
                                    <span class="c">//  2. If we use script binding (ScriptParameterBinderController is used), then parameters won&#39;t have the</span>
                                    <span class="c">//     ParameterAttribute declared for them, and thus are definitely not mandatory.</span>
                                    <span class="c">// So we check &#39;IsParameterMandatory&#39; only if we are not binding default values.</span>
                                    <b>if</b> ((<span class="r25 r">parameterValue</span> != <b>null</b>) ||
                                        (!<span class="r24 r">isDefaultValue</span> &amp;&amp; (<span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#2506aa2af2064ac8" class="i property">IsMandatoryInSomeParameterSet</a> ||
                                                             <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#27f88d250bb0f73c" class="i property">CannotBeNull</a> ||
                                                             <span class="r28 r">dma</span>.<a href="Attributes.cs.html#2cb575235616359c" class="i property">TransformNullOptionalParameters</a>)))
                                    {
                                        <span class="r25 r">parameterValue</span> = <span class="r28 r">dma</span>.<a href="Attributes.cs.html#4c34fe99877b7ff2" class="i method">TransformInternal</a>(<a href="#330e079e5228709c" class="i field">_engine</a>, <span class="r25 r">parameterValue</span>);
                                    }
                                }
 
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                                    <span class="s">&quot;result returned from DATA GENERATION: {0}&quot;</span>,
                                    <span class="r25 r">parameterValue</span>);
                            }
                            <b>catch</b> (<span class="i">Exception</span> <span id="r30 rd" class="r30 r">e</span>) <span class="c">// Catch-all OK, 3rd party callout</span>
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                    <span class="s">&quot;ERROR: DATA GENERATION: {0}&quot;</span>,
                                    <span class="r30 r">e</span>.<span class="i">Message</span>);
 
                                <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r31 rd" class="r31 r">bindingException</span> =
                                        <b>new</b> <span class="t">ParameterBindingArgumentTransformationException</span>(
                                            <span class="r30 r">e</span>,
                                            <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                            <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r19 r">parameter</span>),
                                            <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                                            <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                                            <span class="r25 r">parameterValue</span>?.<span class="i">GetType</span>(),
                                            <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterArgumentTransformationError</span>,
                                            <span class="s">&quot;ParameterArgumentTransformationError&quot;</span>,
                                            <span class="r30 r">e</span>.<span class="i">Message</span>);
                                <b>throw</b> <span class="r31 r">bindingException</span>;
                            }
                        }
                    }
 
                    <span class="c">// Only try to coerce the type if asked. If not asked,</span>
                    <span class="c">// see if the value type matches or is a subclass of</span>
                    <span class="c">// the parameter type.</span>
 
                    <b>if</b> (<span class="r23 r">coerceTypeIfNeeded</span>)
                    {
                        <span class="c">// Now do the type coercion</span>
 
                        <span class="r25 r">parameterValue</span> =
                            <a href="#011a1ac4f4501af3" class="i method">CoerceTypeAsNeeded</a>(
                                <span class="r19 r">parameter</span>,
                                <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                                <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                                <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#417af85aa7cb39b1" class="i property">CollectionTypeInformation</a>,
                                <span class="r25 r">parameterValue</span>);
                    }
                    <b>else</b>
                    {
                        <b>if</b> (!<a href="#eeb26fb0ba0f452a" class="i method">ShouldContinueUncoercedBind</a>(<span class="r19 r">parameter</span>, <span class="r20 r">parameterMetadata</span>, <span class="r21 r">flags</span>, <b>ref</b> <span class="r25 r">parameterValue</span>))
                        {
                            <span class="c">// Don&#39;t attempt the bind because the value</span>
                            <span class="c">// is not of the correct</span>
                            <span class="c">// type for the parameter.</span>
                            <b>break</b>;
                        }
                    }
 
                    <b>if</b> ((<span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#9ba1940df549678f" class="i property">PSTypeName</a> != <b>null</b>) &amp;&amp; (<span class="r25 r">parameterValue</span> != <b>null</b>))
                    {
                        <span class="i">IEnumerable</span> <span id="r32 rd" class="r32 r">parameterValueAsEnumerable</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#5489692986d47497" class="i method">GetEnumerable</a>(<span class="r25 r">parameterValue</span>);
                        <b>if</b> (<span class="r32 r">parameterValueAsEnumerable</span> != <b>null</b>)
                        {
                            <b>foreach</b> (<b>object</b> <span id="r33 rd" class="r33 r">o</span> <b>in</b> <span class="r32 r">parameterValueAsEnumerable</span>)
                            {
                                <a href="#6a035e6bf95bfc67" class="k">this</a>.<span class="i">ValidatePSTypeName</span>(<span class="r19 r">parameter</span>, <span class="r20 r">parameterMetadata</span>, !<span class="r23 r">coerceTypeIfNeeded</span>, <span class="r33 r">o</span>);
                            }
                        }
                        <b>else</b>
                        {
                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<span class="i">ValidatePSTypeName</span>(<span class="r19 r">parameter</span>, <span class="r20 r">parameterMetadata</span>, !<span class="r23 r">coerceTypeIfNeeded</span>, <span class="r25 r">parameterValue</span>);
                        }
                    }
 
                    <span class="c">// Now do the data validation.  No validation is done for default values in script as that is</span>
                    <span class="c">// one way for people to have a known &quot;bad&quot; value to detect unspecified parameters.</span>
 
                    <b>if</b> (!<span class="r24 r">isDefaultValue</span>)
                    {
                        <b>for</b> (<b>int</b> <span id="r34 rd" class="r34 r">i</span> = 0; <span class="r34 r">i</span> &lt; <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#f854be24d6c5bdf6" class="i property">ValidationAttributes</a>.<span class="i">Length</span>; <span class="r34 r">i</span>++)
                        {
                            <a href="Attributes.cs.html#f182d3d1083583da" class="k">var</a> <span id="r35 rd" class="r35 r">validationAttribute</span> = <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#f854be24d6c5bdf6" class="i property">ValidationAttributes</a>[<span class="r34 r">i</span>];
 
                            <b>using</b> (<a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">TraceScope</span>(
                                <span class="s">&quot;Executing VALIDATION metadata: [{0}]&quot;</span>,
                                <span class="r35 r">validationAttribute</span>.<span class="i">GetType</span>()))
                            {
                                <b>try</b>
                                {
                                    <span class="r35 r">validationAttribute</span>.<a href="Attributes.cs.html#54d60c0eea27aaf1" class="i method">InternalValidate</a>(<span class="r25 r">parameterValue</span>, <a href="#330e079e5228709c" class="i field">_engine</a>);
                                }
                                <b>catch</b> (<span class="i">Exception</span> <span id="r36 rd" class="r36 r">e</span>) <span class="c">// Catch-all OK, 3rd party callout</span>
                                {
                                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                        <span class="s">&quot;ERROR: VALIDATION FAILED: {0}&quot;</span>,
                                        <span class="r36 r">e</span>.<span class="i">Message</span>);
 
                                    <a href="../utils/ParameterBinderExceptions.cs.html#e39f77ef0b39d632" class="t t">ParameterBindingValidationException</a> <span id="r37 rd" class="r37 r">bindingException</span> =
                                        <b>new</b> <span class="t">ParameterBindingValidationException</span>(
                                            <span class="r36 r">e</span>,
                                            <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                            <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r19 r">parameter</span>),
                                            <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                                            <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                                            <span class="r25 r">parameterValue</span>?.<span class="i">GetType</span>(),
                                            <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterArgumentValidationError</span>,
                                            <span class="s">&quot;ParameterArgumentValidationError&quot;</span>,
                                            <span class="r36 r">e</span>.<span class="i">Message</span>);
                                    <b>throw</b> <span class="r37 r">bindingException</span>;
                                }
 
                                <a href="#b3b3f9a9a9756bfd" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(<span class="s">&quot;Validation attribute on {0} returned {1}.&quot;</span>, <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>, <span class="r22 r">result</span>);
                            }
                        }
 
                        <span class="c">// If the is null, an empty string, or an empty collection,</span>
                        <span class="c">// check the parameter metadata to ensure that binding can continue</span>
                        <span class="c">// This method throws an appropriate ParameterBindingException</span>
                        <span class="c">// if binding cannot continue. If it returns then binding can</span>
                        <span class="c">// proceed.</span>
                        <b>if</b> (<span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#2506aa2af2064ac8" class="i property">IsMandatoryInSomeParameterSet</a>)
                        {
                            <a href="#fabe0c526a9eb2fa" class="i method">ValidateNullOrEmptyArgument</a>(<span class="r19 r">parameter</span>, <span class="r20 r">parameterMetadata</span>, <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>, <span class="r25 r">parameterValue</span>, <b>true</b>);
                        }
                    }
 
                    <span class="c">// Write out obsolete parameter warning only if</span>
                    <span class="c">//  1. We are binding parameters for a simple function/script</span>
                    <span class="c">//  2. We are not binding a default parameter value</span>
 
                    <b>if</b> (<span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#40248e207b9f981e" class="i property">ObsoleteAttribute</a> != <b>null</b> &amp;&amp;
                        (!<span class="r24 r">isDefaultValue</span>) &amp;&amp;
                        <span class="r26 r">spb</span> != <b>null</b> &amp;&amp; !<span class="r27 r">usesCmdletBinding</span>)
                    {
                        <b>string</b> <span id="r38 rd" class="r38 r">obsoleteWarning</span> = <b>string</b>.<span class="i">Format</span>(
                            <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                            <span class="i">ParameterBinderStrings</span>.<span class="i">UseOfDeprecatedParameterWarning</span>,
                            <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                            <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#40248e207b9f981e" class="i property">ObsoleteAttribute</a>.<span class="i">Message</span>);
 
                        <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="k">var</a> <span id="r39 rd" class="r39 r">mshCommandRuntime</span> = <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#99954e76bd5b2111" class="i property">Command</a>.<a href="CommandBase.cs.html#71eb09c6dd471a86" class="i field">commandRuntime</a> <b>as</b> <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>;
                        <b>if</b> (<span class="r39 r">mshCommandRuntime</span> != <b>null</b>)
                        {
                            <span class="c">// Write out warning only if we are in the context of MshCommandRuntime.</span>
                            <span class="c">// This is because</span>
                            <span class="c">//  1. The overload method WriteWarning(WarningRecord) is only available in MshCommandRuntime;</span>
                            <span class="c">//  2. We write out warnings for obsolete commands and obsolete cmdlet parameters only when in</span>
                            <span class="c">//     the context of MshCommandRuntime. So we do it here to keep consistency.</span>
                            <span class="r39 r">mshCommandRuntime</span>.<a href="MshCommandRuntime.cs.html#9cc8b7d137e9323d" class="i method">WriteWarning</a>(<b>new</b> <a href="hostifaces/InformationalRecord.cs.html#dcad78b02a1ab129" class="t constructor">WarningRecord</a>(<a href="#1e7425f5fa5359d6" class="i field">FQIDParameterObsolete</a>, <span class="r38 r">obsoleteWarning</span>));
                        }
                    }
 
                    <span class="c">// Finally bind the argument to the parameter</span>
 
                    <span class="i">Exception</span> <span id="r40 rd" class="r40 r">bindError</span> = <b>null</b>;
 
                    <b>try</b>
                    {
                        <a href="#fa702e1956545968" class="i method">BindParameter</a>(<span class="r19 r">parameter</span>.<a href="CommandParameter.cs.html#8a262faeff991e7d" class="i property">ParameterName</a>, <span class="r25 r">parameterValue</span>, <span class="r20 r">parameterMetadata</span>);
                        <span class="r22 r">result</span> = <b>true</b>;
                    }
                    <b>catch</b> (<a href="ExtendedTypeSystemException.cs.html#8f44bde8a24c50c0" class="t t">SetValueException</a> <span id="r41 rd" class="r41 r">setValueException</span>)
                    {
                        <span class="r40 r">bindError</span> = <span class="r41 r">setValueException</span>;
                    }
 
                    <b>if</b> (<span class="r40 r">bindError</span> != <b>null</b>)
                    {
                        <span class="i">Type</span> <span id="r42 rd" class="r42 r">specifiedType</span> = <span class="r25 r">parameterValue</span>?.<span class="i">GetType</span>();
                        <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r43 rd" class="r43 r">bindingException</span> =
                            <b>new</b> <span class="t">ParameterBindingException</span>(
                                <span class="r40 r">bindError</span>,
                                <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#0c2f4b9c74e5b7c2" class="i field">WriteError</a>,
                                <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r19 r">parameter</span>),
                                <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                                <span class="r20 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                                <span class="r42 r">specifiedType</span>,
                                <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterBindingFailed</span>,
                                <span class="s">&quot;ParameterBindingFailed&quot;</span>,
                                <span class="r40 r">bindError</span>.<span class="i">Message</span>);
 
                        <b>throw</b> <span class="r43 r">bindingException</span>;
                    }
                }
                <b>while</b> (<b>false</b>);
 
                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ea4adc43a7440f6a" class="i method">WriteLine</a>(
                    <span class="s">&quot;BIND arg [{0}] to param [{1}] {2}&quot;</span>,
                    <span class="r25 r">parameterValue</span>,
                    <span class="r19 r">parameter</span>.<a href="CommandParameter.cs.html#8a262faeff991e7d" class="i property">ParameterName</a>,
                    (<span class="r22 r">result</span>) ? <span class="s">&quot;SUCCESSFUL&quot;</span> : <span class="s">&quot;SKIPPED&quot;</span>);
 
                <b>if</b> (<span class="r22 r">result</span>)
                {
                    <span class="c">// Add this name to the set of bound parameters...</span>
                    <b>if</b> (<a href="#80f311903d85dd3b" class="i field">RecordBoundParameters</a>)
                    {
                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#4555288f0b3927cb" class="i property">CommandLineParameters</a>.<a href="#fb9729d19c4f40b0" class="i method">Add</a>(<span class="r19 r">parameter</span>.<a href="CommandParameter.cs.html#8a262faeff991e7d" class="i property">ParameterName</a>, <span class="r25 r">parameterValue</span>);
                    }
 
                    <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a> <span id="r44 rd" class="r44 r">cmdRuntime</span> = <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#99954e76bd5b2111" class="i property">Command</a>.<a href="CommandBase.cs.html#71eb09c6dd471a86" class="i field">commandRuntime</a> <b>as</b> <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>;
                    <b>if</b> ((<span class="r44 r">cmdRuntime</span> != <b>null</b>) &amp;&amp;
                        (<span class="r44 r">cmdRuntime</span>.<a href="MshCommandRuntime.cs.html#10aa6c1ae5d83a77" class="i property">LogPipelineExecutionDetail</a> || <a href="#7abe01a0503a6db5" class="i field">_isTranscribing</a>) &amp;&amp;
                        (<span class="r44 r">cmdRuntime</span>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a> != <b>null</b>))
                    {
                        <b>string</b> <span id="r45 rd" class="r45 r">stringToPrint</span> = <b>null</b>;
                        <b>try</b>
                        {
                            <span class="c">// Unroll parameter value</span>
                            <span class="i">IEnumerable</span> <span id="r46 rd" class="r46 r">values</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#5489692986d47497" class="i method">GetEnumerable</a>(<span class="r25 r">parameterValue</span>);
                            <b>if</b> (<span class="r46 r">values</span> != <b>null</b>)
                            {
                                <b>var</b> <span id="r47 rd" class="r47 r">sb</span> = <b>new</b> <span class="i">Text</span>.<span class="i">StringBuilder</span>(256);
                                <b>var</b> <span id="r48 rd" class="r48 r">sep</span> = <b>string</b>.<span class="i">Empty</span>;
                                <b>foreach</b> (<b>var</b> <span id="r49 rd" class="r49 r">value</span> <b>in</b> <span class="r46 r">values</span>)
                                {
                                    <span class="r47 r">sb</span>.<span class="i">Append</span>(<span class="r48 r">sep</span>);
                                    <span class="r48 r">sep</span> = <span class="s">&quot;, &quot;</span>;
                                    <span class="r47 r">sb</span>.<span class="i">Append</span>(<span class="r49 r">value</span>);
                                    <span class="c">// For better performance, avoid logging too much</span>
                                    <b>if</b> (<span class="r47 r">sb</span>.<span class="i">Length</span> &gt; 256)
                                    {
                                        <span class="r47 r">sb</span>.<span class="i">Append</span>(<span class="s">&quot;, ...&quot;</span>);
                                        <b>break</b>;
                                    }
                                }
 
                                <span class="r45 r">stringToPrint</span> = <span class="r47 r">sb</span>.<span class="i">ToString</span>();
                            }
                            <b>else</b> <b>if</b> (<span class="r25 r">parameterValue</span> != <b>null</b>)
                            {
                                <span class="r45 r">stringToPrint</span> = <span class="r25 r">parameterValue</span>.<span class="i">ToString</span>();
                            }
                        }
                        <b>catch</b> (<span class="i">Exception</span>) <span class="c">// Catch-all OK, 3rd party callout</span>
                        {
                        }
 
                        <b>if</b> (<span class="r45 r">stringToPrint</span> != <b>null</b>)
                        {
                            <span class="r44 r">cmdRuntime</span>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a>.<a href="pipeline.cs.html#1d7dbd966ef093e2" class="i method">LogExecutionParameterBinding</a>(<a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>, <span class="r19 r">parameter</span>.<a href="CommandParameter.cs.html#8a262faeff991e7d" class="i property">ParameterName</a>, <span class="r45 r">stringToPrint</span>);
                        }
                    }
                }
 
                <b>return</b> <span class="r22 r">result</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method ensures that if the parameter is mandatory, and AllowNull, AllowEmptyString,</span>
        <span class="c">///</span><span class="c"> and/or AllowEmptyCollection is not specified, then argument is not null or empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">parameter</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The argument token.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">parameterMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The metadata for the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">argumentType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type of the argument to validate against.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">parameterValue</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The value that will be bound to the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">recurseIntoCollections</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, then elements of collections will be validated against the metadata.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="fabe0c526a9eb2fa" href="../R/fabe0c526a9eb2fa.html" target="n" data-glyph="76,1" class="i method">ValidateNullOrEmptyArgument</a>(
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r50 rd" class="r50 r">parameter</span>,
            <a href="CompiledCommandParameter.cs.html#0bb5a64f862f9cc4" class="t t">CompiledCommandParameter</a> <span id="r51 rd" class="r51 r">parameterMetadata</span>,
            <span class="i">Type</span> <span id="r52 rd" class="r52 r">argumentType</span>,
            <b>object</b> <span id="r53 rd" class="r53 r">parameterValue</span>,
            <b>bool</b> <span id="r54 rd" class="r54 r">recurseIntoCollections</span>)
        {
            <b>if</b> (<span class="r53 r">parameterValue</span> == <b>null</b> &amp;&amp; <span class="r52 r">argumentType</span> != <b>typeof</b>(<b>bool</b>?))
            {
                <b>if</b> (!<span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#b41c1ff05779ca0b" class="i property">AllowsNullArgument</a>)
                {
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;ERROR: Argument cannot be null&quot;</span>);
 
                    <a href="../utils/ParameterBinderExceptions.cs.html#e39f77ef0b39d632" class="t t">ParameterBindingValidationException</a> <span id="r55 rd" class="r55 r">bindingException</span> =
                        <b>new</b> <span class="t">ParameterBindingValidationException</span>(
                            <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                            <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r50 r">parameter</span>),
                            <span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                            <span class="r52 r">argumentType</span>,
                            <b>null</b>,
                            <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterArgumentValidationErrorNullNotAllowed</span>,
                            <span class="s">&quot;ParameterArgumentValidationErrorNullNotAllowed&quot;</span>);
                    <b>throw</b> <span class="r55 r">bindingException</span>;
                }
 
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r52 r">argumentType</span> == <b>typeof</b>(<b>string</b>))
            {
                <span class="c">// Since the parameter is of type string, verify that either the argument</span>
                <span class="c">// is not null and not empty or that the parameter can accept null or empty.</span>
                <b>string</b> <span id="r56 rd" class="r56 r">stringParamValue</span> = <span class="r53 r">parameterValue</span> <b>as string</b>;
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                    <span class="r56 r">stringParamValue</span> != <b>null</b>,
                    <span class="s">&quot;Type coercion should have already converted the argument value to a string&quot;</span>);
 
                <b>if</b> (<span class="r56 r">stringParamValue</span>.<span class="i">Length</span> == 0 &amp;&amp; !<span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#5f0aee6ae12205cc" class="i property">AllowsEmptyStringArgument</a>)
                {
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;ERROR: Argument cannot be an empty string&quot;</span>);
 
                    <a href="../utils/ParameterBinderExceptions.cs.html#e39f77ef0b39d632" class="t t">ParameterBindingValidationException</a> <span id="r57 rd" class="r57 r">bindingException</span> =
                        <b>new</b> <span class="t">ParameterBindingValidationException</span>(
                            <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                            <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r50 r">parameter</span>),
                            <span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                            <span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                            <span class="r53 r">parameterValue</span>?.<span class="i">GetType</span>(),
                            <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterArgumentValidationErrorEmptyStringNotAllowed</span>,
                            <span class="s">&quot;ParameterArgumentValidationErrorEmptyStringNotAllowed&quot;</span>);
                    <b>throw</b> <span class="r57 r">bindingException</span>;
                }
 
                <b>return</b>;
            }
 
            <b>if</b> (!<span class="r54 r">recurseIntoCollections</span>)
                <b>return</b>;
 
            <b>switch</b> (<span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#417af85aa7cb39b1" class="i property">CollectionTypeInformation</a>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a>)
            {
                <b>case</b> <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#604944248a2940a0" class="i field">IList</a>:
                <b>case</b> <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#44ab365e38ccd61c" class="i field">Array</a>:
                <b>case</b> <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#a831bb7acd7a9369" class="i field">ICollectionGeneric</a>:
                    <b>break</b>;
                <b>default</b>:
                    <span class="c">// not a recognized collection, no need to recurse</span>
                    <b>return</b>;
            }
 
            <span class="c">// All these collection types implement IEnumerable</span>
            <span class="i">IEnumerator</span> <span id="r58 rd" class="r58 r">ienum</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#837b38179d9ca088" class="i method">GetEnumerator</a>(<span class="r53 r">parameterValue</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                <span class="r58 r">ienum</span> != <b>null</b>,
                <span class="s">&quot;Type coercion should have already converted the argument value to an IEnumerator&quot;</span>);
 
            <span class="c">// Ensure that each element abides by the metadata</span>
            <b>bool</b> <span id="r59 rd" class="r59 r">isEmpty</span> = <b>true</b>;
            <span class="i">Type</span> <span id="r60 rd" class="r60 r">elementType</span> = <span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#417af85aa7cb39b1" class="i property">CollectionTypeInformation</a>.<a href="CompiledCommandParameter.cs.html#a3e13d75b560e4c1" class="i property">ElementType</a>;
            <b>bool</b> <span id="r61 rd" class="r61 r">isElementValueType</span> = <span class="r60 r">elementType</span> != <b>null</b> &amp;&amp; <span class="r60 r">elementType</span>.<span class="i">IsValueType</span>;
 
            <span class="c">// Note - we explicitly don&#39;t pass the context here because we don&#39;t want</span>
            <span class="c">// the overhead of the calls that check for stopping.</span>
            <b>if</b> (<a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#5cba6b6355dba7e3" class="i method">MoveNext</a>(<b>null</b>, <b>null</b>, <span class="r58 r">ienum</span>)) { <span class="r59 r">isEmpty</span> = <b>false</b>; }
 
            <span class="c">// If the element of the collection is of value type, then no need to check for null</span>
            <span class="c">// because a value-type value cannot be null.</span>
            <b>if</b> (!<span class="r59 r">isEmpty</span> &amp;&amp; !<span class="r61 r">isElementValueType</span>)
            {
                <b>do</b>
                {
                    <b>object</b> <span id="r62 rd" class="r62 r">element</span> = <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#4c90bd640fcb396f" class="i method">Current</a>(<b>null</b>, <span class="r58 r">ienum</span>);
                    <a href="#fabe0c526a9eb2fa" class="i method">ValidateNullOrEmptyArgument</a>(
                        <span class="r50 r">parameter</span>,
                        <span class="r51 r">parameterMetadata</span>,
                        <span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#417af85aa7cb39b1" class="i property">CollectionTypeInformation</a>.<a href="CompiledCommandParameter.cs.html#a3e13d75b560e4c1" class="i property">ElementType</a>,
                        <span class="r62 r">element</span>,
                        <b>false</b>);
                } <b>while</b> (<a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#5cba6b6355dba7e3" class="i method">MoveNext</a>(<b>null</b>, <b>null</b>, <span class="r58 r">ienum</span>));
            }
 
            <b>if</b> (<span class="r59 r">isEmpty</span> &amp;&amp; !<span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#1a8c11d2f3591bb6" class="i property">AllowsEmptyCollectionArgument</a>)
            {
                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="s">&quot;ERROR: Argument cannot be an empty collection&quot;</span>);
 
                <b>string</b> <span id="r63 rd" class="r63 r">errorId</span>, <span id="r64 rd" class="r64 r">resourceString</span>;
                <b>if</b> (<span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#417af85aa7cb39b1" class="i property">CollectionTypeInformation</a>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#44ab365e38ccd61c" class="i field">Array</a>)
                {
                    <span class="r63 r">errorId</span> = <span class="s">&quot;ParameterArgumentValidationErrorEmptyArrayNotAllowed&quot;</span>;
                    <span class="r64 r">resourceString</span> = <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterArgumentValidationErrorEmptyArrayNotAllowed</span>;
                }
                <b>else</b>
                {
                    <span class="r63 r">errorId</span> = <span class="s">&quot;ParameterArgumentValidationErrorEmptyCollectionNotAllowed&quot;</span>;
                    <span class="r64 r">resourceString</span> = <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterArgumentValidationErrorEmptyCollectionNotAllowed</span>;
                }
 
                <a href="../utils/ParameterBinderExceptions.cs.html#e39f77ef0b39d632" class="t t">ParameterBindingValidationException</a> <span id="r65 rd" class="r65 r">bindingException</span> =
                    <b>new</b> <span class="t">ParameterBindingValidationException</span>(
                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                        <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r50 r">parameter</span>),
                        <span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                        <span class="r51 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>,
                        <span class="r53 r">parameterValue</span>?.<span class="i">GetType</span>(),
                        <span class="r64 r">resourceString</span>,
                        <span class="r63 r">errorId</span>);
                <b>throw</b> <span class="r65 r">bindingException</span>;
            }
        }
 
        <b>private bool</b> <a id="eeb26fb0ba0f452a" href="../R/eeb26fb0ba0f452a.html" target="n" data-glyph="76,1" class="i method">ShouldContinueUncoercedBind</a>(
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r66 rd" class="r66 r">parameter</span>,
            <a href="CompiledCommandParameter.cs.html#0bb5a64f862f9cc4" class="t t">CompiledCommandParameter</a> <span id="r67 rd" class="r67 r">parameterMetadata</span>,
            <a href="#2554c5af1a54de10" class="t t">ParameterBindingFlags</a> <span id="r68 rd" class="r68 r">flags</span>,
            <b>ref object</b> <span id="r69 rd" class="r69 r">parameterValue</span>)
        {
            <b>bool</b> <span id="r70 rd" class="r70 r">isDefaultValue</span> = (<span class="r68 r">flags</span> &amp; <a href="#2554c5af1a54de10" class="t t">ParameterBindingFlags</a>.<a href="#765bb2966dedd770" class="i field">IsDefaultValue</a>) != 0;
            <span class="i">Type</span> <span id="r71 rd" class="r71 r">parameterType</span> = <span class="r67 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#d559cbd358d9cd28" class="i property">Type</a>;
 
            <b>if</b> (<span class="r69 r">parameterValue</span> == <b>null</b>)
            {
                <b>return</b> <span class="r71 r">parameterType</span> == <b>null</b> ||
                       <span class="r70 r">isDefaultValue</span> ||
                       (!<span class="r71 r">parameterType</span>.<span class="i">IsValueType</span> &amp;&amp;
                        <span class="r71 r">parameterType</span> != <b>typeof</b>(<b>string</b>));
            }
 
            <span class="c">// If the types are not a direct match, or</span>
            <span class="c">// the value type is not a subclass of the parameter type, or</span>
            <span class="c">// the value is an PSObject and the parameter type is not object and</span>
            <span class="c">//     the PSObject.BaseObject type does not match or is not a subclass</span>
            <span class="c">//     of the parameter type, or</span>
            <span class="c">// the value must be encoded into a collection but it is not of the correct element type</span>
            <span class="c">//</span>
            <span class="c">// then return false</span>
 
            <b>if</b> (<span class="r71 r">parameterType</span>.<span class="i">IsInstanceOfType</span>(<span class="r69 r">parameterValue</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <a href="MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r72 rd" class="r72 r">psobj</span> = <span class="r69 r">parameterValue</span> <b>as</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r72 r">psobj</span> != <b>null</b> &amp;&amp; !<span class="r72 r">psobj</span>.<a href="MshObject.cs.html#caa97e1ddfac8ce8" class="i property">ImmediateBaseObjectIsEmpty</a>)
            {
                <span class="c">// See if the base object is of the same type or</span>
                <span class="c">// as subclass of the parameter</span>
 
                <span class="r69 r">parameterValue</span> = <span class="r72 r">psobj</span>.<a href="MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
 
                <b>if</b> (<span class="r71 r">parameterType</span>.<span class="i">IsInstanceOfType</span>(<span class="r69 r">parameterValue</span>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <span class="c">// Maybe the parameter type is a collection and the value needs to</span>
            <span class="c">// be encoded</span>
 
            <b>if</b> (<span class="r67 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#417af85aa7cb39b1" class="i property">CollectionTypeInformation</a>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> != <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#f21241fc7477e88a" class="i field">NotCollection</a>)
            {
                <span class="c">// See if the value needs to be encoded in a collection</span>
 
                <b>bool</b> <span id="r73 rd" class="r73 r">coercionRequired</span>;
                <b>object</b> <span id="r74 rd" class="r74 r">encodedValue</span> =
                    <a href="#16ff268913aa00d5" class="i method">EncodeCollection</a>(
                        <span class="r66 r">parameter</span>,
                        <span class="r67 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#a6029b38dac72768" class="i property">Name</a>,
                        <span class="r67 r">parameterMetadata</span>.<a href="CompiledCommandParameter.cs.html#417af85aa7cb39b1" class="i property">CollectionTypeInformation</a>,
                        <span class="r71 r">parameterType</span>,
                        <span class="r69 r">parameterValue</span>,
                        <b>false</b>,
                        <b>out</b> <span class="r73 r">coercionRequired</span>);
 
                <b>if</b> (<span class="r74 r">encodedValue</span> == <b>null</b> || <span class="r73 r">coercionRequired</span>)
                {
                    <span class="c">// Don&#39;t attempt the bind because the</span>
                    <span class="c">// PSObject BaseObject is not of the correct</span>
                    <span class="c">// type for the parameter.</span>
                    <b>return</b> <b>false</b>;
                }
 
                <span class="r69 r">parameterValue</span> = <span class="r74 r">encodedValue</span>;
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameter binding
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The invocation information for the code that is being bound.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <a id="80ed49655f77084a" href="../R/80ed49655f77084a.html" target="n" data-glyph="46,1" class="i field">_invocationInfo</a>;
 
        <b>internal</b> <a href="InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <a id="d4033a216a206c72" href="../R/d4033a216a206c72.html" target="n" data-glyph="104,1" class="i property">InvocationInfo</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#80ed49655f77084a" class="i field">_invocationInfo</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The context of the currently running engine.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="e067e081f2e9b0bc" href="../R/e067e081f2e9b0bc.html" target="n" data-glyph="46,1" class="i field">_context</a>;
 
        <b>internal</b> <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="38a4ecbc6a44c18f" href="../R/38a4ecbc6a44c18f.html" target="n" data-glyph="104,1" class="i property">Context</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#e067e081f2e9b0bc" class="i field">_context</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An instance of InternalCommand that the binder is binding to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <a id="7a3d84607d418b57" href="../R/7a3d84607d418b57.html" target="n" data-glyph="46,1" class="i field">_command</a>;
 
        <b>internal</b> <a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <a id="99954e76bd5b2111" href="../R/99954e76bd5b2111.html" target="n" data-glyph="104,1" class="i property">Command</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#7a3d84607d418b57" class="i field">_command</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The engine APIs that need to be passed the attributes when evaluated.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="EngineIntrinsics.cs.html#e9f6dd7d61246066" class="t t">EngineIntrinsics</a> <a id="330e079e5228709c" href="../R/330e079e5228709c.html" target="n" data-glyph="46,1" class="i field">_engine</a>;
 
        <b>private readonly bool</b> <a id="7abe01a0503a6db5" href="../R/7abe01a0503a6db5.html" target="n" data-glyph="46,1" class="i field">_isTranscribing</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> internal members
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private helpers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Coerces the argument type to the parameter value type as needed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">argument</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The argument as was specified by the command line.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">parameterName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the parameter that the coercion is taking place to bind to. It is</span>
        <span class="c">///</span><span class="c"> used only for error reporting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">toType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type to coerce the value to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">collectionTypeInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The information about the collection type, like element type, etc.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">currentValue</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The current value of the argument.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The value of the argument in the type of the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">argument</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">toType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the argument value is missing and the parameter is not a bool or SwitchParameter.</span>
        <span class="c">///</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> If the argument value could not be converted to the parameter type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private object</b> <a id="011a1ac4f4501af3" href="../R/011a1ac4f4501af3.html" target="n" data-glyph="76,1" class="i method">CoerceTypeAsNeeded</a>(
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r75 rd" class="r75 r">argument</span>,
            <b>string</b> <span id="r76 rd" class="r76 r">parameterName</span>,
            <span class="i">Type</span> <span id="r77 rd" class="r77 r">toType</span>,
            <a href="CompiledCommandParameter.cs.html#b78c35f87c747be1" class="t t">ParameterCollectionTypeInformation</a> <span id="r78 rd" class="r78 r">collectionTypeInfo</span>,
            <b>object</b> <span id="r79 rd" class="r79 r">currentValue</span>)
        {
            <b>if</b> (<span class="r75 r">argument</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r75 r">argument</span>));
            }
 
            <b>if</b> (<span class="r77 r">toType</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r77 r">toType</span>));
            }
 
            <span class="c">// Construct the collection type information if it wasn&#39;t passed in.</span>
 
            <b>if</b> (<span class="r78 r">collectionTypeInfo</span> == <b>null</b>)
            {
                <span class="r78 r">collectionTypeInfo</span> = <b>new</b> <a href="CompiledCommandParameter.cs.html#712e8f9f6e1029cc" class="t constructor">ParameterCollectionTypeInformation</a>(<span class="r77 r">toType</span>);
            }
 
            <b>object</b> <span id="r80 rd" class="r80 r">originalValue</span> = <span class="r79 r">currentValue</span>;
            <b>object</b> <span id="r81 rd" class="r81 r">result</span> = <span class="r79 r">currentValue</span>;
 
            <b>using</b> (<a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">TraceScope</span>(
                <span class="s">&quot;COERCE arg to [{0}]&quot;</span>, <span class="r77 r">toType</span>))
            {
                <span class="i">Type</span> <span id="r82 rd" class="r82 r">argumentType</span> = <b>null</b>;
                <b>try</b>
                {
                    <b>do</b> <span class="c">// false loop</span>
                    {
                        <b>if</b> (<a href="#806beb5b2eb5ad69" class="i method">IsNullParameterValue</a>(<span class="r79 r">currentValue</span>))
                        {
                            <span class="r81 r">result</span> = <a href="#ce8e4409c5c5ab5d" class="i method">HandleNullParameterForSpecialTypes</a>(<span class="r75 r">argument</span>, <span class="r76 r">parameterName</span>, <span class="r77 r">toType</span>, <span class="r79 r">currentValue</span>);
                            <b>break</b>;
                        }
 
                        <span class="c">// Do the coercion</span>
                        <span class="r82 r">argumentType</span> = <span class="r79 r">currentValue</span>.<span class="i">GetType</span>();
 
                        <span class="c">// If the types are identical (or can be cast directly,) then no coercion</span>
                        <span class="c">// needs to be done</span>
                        <b>if</b> (<span class="r77 r">toType</span>.<span class="i">IsAssignableFrom</span>(<span class="r82 r">argumentType</span>))
                        {
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                                <span class="s">&quot;Parameter and arg types the same, no coercion is needed.&quot;</span>);
 
                            <span class="r81 r">result</span> = <span class="r79 r">currentValue</span>;
                            <b>break</b>;
                        }
 
                        <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;Trying to convert argument value from {0} to {1}&quot;</span>, <span class="r82 r">argumentType</span>, <span class="r77 r">toType</span>);
 
                        <span class="c">// Likewise shortcircuit the case were the user has asked for a shell object.</span>
                        <span class="c">// He always gets a shell object regardless of the actual type of the object.</span>
                        <b>if</b> (<span class="r77 r">toType</span> == <b>typeof</b>(<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>))
                        {
                            <span class="c">// It may be the case that we&#39;re binding the current pipeline object</span>
                            <span class="c">// as is to a PSObject parameter in which case, we want to make</span>
                            <span class="c">// sure that we&#39;re using the same shell object instead of creating an</span>
                            <span class="c">// alias object.</span>
                            <b>if</b> (<a href="#7a3d84607d418b57" class="i field">_command</a> != <b>null</b> &amp;&amp;
                                <span class="r79 r">currentValue</span> == <a href="#7a3d84607d418b57" class="i field">_command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a>.<a href="MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>)
                            {
                                <span class="r79 r">currentValue</span> = <a href="#7a3d84607d418b57" class="i field">_command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a>;
                            }
 
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                <span class="s">&quot;The parameter is of type [{0}] and the argument is an PSObject, so the parameter value is the argument value wrapped into an PSObject.&quot;</span>,
                                <span class="r77 r">toType</span>);
                            <span class="r81 r">result</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e9d9a7d7ec7be239" class="i method">AsPSObjectOrNull</a>(<span class="r79 r">currentValue</span>);
                            <b>break</b>;
                        }
 
                        <span class="c">// NTRAID#Windows OS Bugs-1064175-2004/02/28-JeffJon</span>
                        <span class="c">// If we have an PSObject with null base and we are trying to</span>
                        <span class="c">// convert to a string, then we need to use null instead of</span>
                        <span class="c">// calling LanguagePrimitives.ConvertTo as that will return</span>
                        <span class="c">// string.Empty.</span>
 
                        <b>if</b> (<span class="r77 r">toType</span> == <b>typeof</b>(<b>string</b>) &amp;&amp;
                            <span class="r82 r">argumentType</span> == <b>typeof</b>(<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>))
                        {
                            <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r83 rd" class="r83 r">currentValueAsPSObject</span> = (<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)<span class="r79 r">currentValue</span>;
 
                            <b>if</b> (<span class="r83 r">currentValueAsPSObject</span> == <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                                    <span class="s">&quot;CONVERT a null PSObject to a null string.&quot;</span>);
                                <span class="r81 r">result</span> = <b>null</b>;
                                <b>break</b>;
                            }
                        }
 
                        <span class="c">// NTRAID#Windows OS Bugs -&lt;bug id here&gt; - Nana</span>
                        <span class="c">// If we have a boolean, we have to ensure that it can</span>
                        <span class="c">// only take parameters of type boolean or numbers with</span>
                        <span class="c">// 0 indicating false and everything else indicating true</span>
                        <span class="c">// Anything else passed should be reported as an error</span>
 
                        <b>if</b> (<span class="r77 r">toType</span> == <b>typeof</b>(<b>bool</b>) || <span class="r77 r">toType</span> == <b>typeof</b>(<a href="MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>) ||
                            <span class="r77 r">toType</span> == <b>typeof</b>(<b>bool</b>?))
                        {
                            <span class="i">Type</span> <span id="r84 rd" class="r84 r">boType</span> = <b>null</b>;
                            <b>if</b> (<span class="r82 r">argumentType</span> == <b>typeof</b>(<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>))
                            {
                                <span class="c">// Unwrap the PSObject at this point...</span>
                                <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r85 rd" class="r85 r">currentValueAsPSObject</span> = (<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)<span class="r79 r">currentValue</span>;
                                <span class="r79 r">currentValue</span> = <span class="r85 r">currentValueAsPSObject</span>.<a href="MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
 
                                <b>if</b> (<span class="r79 r">currentValue</span> <b>is</b> <a href="MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>)
                                {
                                    <span class="r79 r">currentValue</span> = ((<a href="MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>)<span class="r79 r">currentValue</span>).<a href="MshCmdlet.cs.html#e9c777a85700d3da" class="i property">IsPresent</a>;
                                }
 
                                <span class="r84 r">boType</span> = <span class="r79 r">currentValue</span>.<span class="i">GetType</span>();
                            }
                            <b>else</b>
                            {
                                <span class="r84 r">boType</span> = <span class="r82 r">argumentType</span>;
                            }
 
                            <b>if</b> (<span class="r84 r">boType</span> == <b>typeof</b>(<b>bool</b>))
                            {
                                <b>if</b> (<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e38962e3de48a9c2" class="i method">IsBooleanType</a>(<span class="r77 r">toType</span>))
                                    <span class="r81 r">result</span> = <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#54fac34e4ea24d13" class="i method">BoolToObject</a>((<b>bool</b>)<span class="r79 r">currentValue</span>);
                                <b>else</b>
                                    <span class="r81 r">result</span> = <b>new</b> <a href="MshCmdlet.cs.html#bc9e109b8e1a51f1" class="t constructor">SwitchParameter</a>((<b>bool</b>)<span class="r79 r">currentValue</span>);
                            }
                            <b>else</b> <b>if</b> (<span class="r84 r">boType</span> == <b>typeof</b>(<b>int</b>))
                            {
                                <b>if</b> ((<b>int</b>)<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r79 r">currentValue</span>,
                                            <b>typeof</b>(<b>int</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>) != 0)
                                {
                                    <b>if</b> (<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e38962e3de48a9c2" class="i method">IsBooleanType</a>(<span class="r77 r">toType</span>))
                                        <span class="r81 r">result</span> = <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#54fac34e4ea24d13" class="i method">BoolToObject</a>(<b>true</b>);
                                    <b>else</b>
                                        <span class="r81 r">result</span> = <b>new</b> <a href="MshCmdlet.cs.html#bc9e109b8e1a51f1" class="t constructor">SwitchParameter</a>(<b>true</b>);
                                }
                                <b>else</b>
                                {
                                    <b>if</b> (<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e38962e3de48a9c2" class="i method">IsBooleanType</a>(<span class="r77 r">toType</span>))
                                        <span class="r81 r">result</span> = <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#54fac34e4ea24d13" class="i method">BoolToObject</a>(<b>false</b>);
                                    <b>else</b>
                                        <span class="r81 r">result</span> = <b>new</b> <a href="MshCmdlet.cs.html#bc9e109b8e1a51f1" class="t constructor">SwitchParameter</a>(<b>false</b>);
                                }
                            }
                            <b>else</b> <b>if</b> (<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e25b1c6d235a82c5" class="i method">IsNumeric</a>(<span class="r84 r">boType</span>.<a href="../utils/ExtensionMethods.cs.html#6941492779b390f9" class="i method">GetTypeCode</a>()))
                            {
                                <b>double</b> <span id="r86 rd" class="r86 r">currentValueAsDouble</span> = (<b>double</b>)<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                                                                        <span class="r79 r">currentValue</span>, <b>typeof</b>(<b>double</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
 
                                <b>if</b> (<span class="r86 r">currentValueAsDouble</span> != 0)
                                {
                                    <b>if</b> (<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e38962e3de48a9c2" class="i method">IsBooleanType</a>(<span class="r77 r">toType</span>))
                                        <span class="r81 r">result</span> = <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#54fac34e4ea24d13" class="i method">BoolToObject</a>(<b>true</b>);
                                    <b>else</b>
                                        <span class="r81 r">result</span> = <b>new</b> <a href="MshCmdlet.cs.html#bc9e109b8e1a51f1" class="t constructor">SwitchParameter</a>(<b>true</b>);
                                }
                                <b>else</b>
                                {
                                    <b>if</b> (<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#e38962e3de48a9c2" class="i method">IsBooleanType</a>(<span class="r77 r">toType</span>))
                                        <span class="r81 r">result</span> = <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#54fac34e4ea24d13" class="i method">BoolToObject</a>(<b>false</b>);
                                    <b>else</b>
                                        <span class="r81 r">result</span> = <b>new</b> <a href="MshCmdlet.cs.html#bc9e109b8e1a51f1" class="t constructor">SwitchParameter</a>(<b>false</b>);
                                }
                            }
                            <b>else</b>
                            {
                                <span class="c">// Invalid types which cannot be associated with a bool</span>
                                <span class="c">// Since there is a catch block which appropriately</span>
                                <span class="c">// handles this situation we just throw an exception here</span>
                                <span class="c">// throw new PSInvalidCastException();</span>
                                <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r87 rd" class="r87 r">pbe</span> =
                                    <b>new</b> <span class="t">ParameterBindingException</span>(
                                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                        <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r75 r">argument</span>),
                                        <span class="r76 r">parameterName</span>,
                                        <span class="r77 r">toType</span>,
                                        <span class="r82 r">argumentType</span>,
                                        <span class="i">ParameterBinderStrings</span>.<span class="i">CannotConvertArgument</span>,
                                        <span class="s">&quot;CannotConvertArgument&quot;</span>,
                                        <span class="r84 r">boType</span>,
                                        <b>string</b>.<span class="i">Empty</span>);
 
                                <b>throw</b> <span class="r87 r">pbe</span>;
                            }
 
                            <b>break</b>;
                        }
 
                        <span class="c">// NTRAID#Windows OS Bugs-1009284-2004/05/05-JeffJon</span>
                        <span class="c">// Need to handle other collection types here as well</span>
 
                        <span class="c">// Before attempting to encode a collection, we check if we can convert the argument directly via</span>
                        <span class="c">// a restricted set of conversions (as the general conversion mechanism is far too general, it may</span>
                        <span class="c">// succeed where it shouldn&#39;t.  We don&#39;t bother checking arrays parameters because they won&#39;t have</span>
                        <span class="c">// conversions we&#39;re allowing.</span>
                        <b>if</b> (<span class="r78 r">collectionTypeInfo</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#a831bb7acd7a9369" class="i field">ICollectionGeneric</a>
                            || <span class="r78 r">collectionTypeInfo</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#604944248a2940a0" class="i field">IList</a>)
                        {
                            <b>object</b> <span id="r88 rd" class="r88 r">currentValueToConvert</span> = <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r79 r">currentValue</span>);
                            <b>if</b> (<span class="r88 r">currentValueToConvert</span> != <b>null</b>)
                            {
                                <a href="LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a> <span id="r89 rd" class="r89 r">rank</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetConversionRank</span>(<span class="r88 r">currentValueToConvert</span>.<span class="i">GetType</span>(), <span class="r77 r">toType</span>);
                                <b>if</b> (<span class="r89 r">rank</span> == <a href="LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="LanguagePrimitives.cs.html#f884ff66af1f97c4" class="i field">Constructor</a> || <span class="r89 r">rank</span> == <a href="LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="LanguagePrimitives.cs.html#16af78347d5ada13" class="i field">ImplicitCast</a> || <span class="r89 r">rank</span> == <a href="LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="LanguagePrimitives.cs.html#1ec464ef054dabee" class="i field">ExplicitCast</a>)
                                {
                                    <span class="c">// This conversion will fail in the common case, and when it does, we&#39;ll use EncodeCollection below.</span>
                                    <b>if</b> (<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r79 r">currentValue</span>, <span class="r77 r">toType</span>, <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <b>out</b> <span class="r81 r">result</span>))
                                    {
                                        <b>break</b>;
                                    }
                                }
                            }
                        }
 
                        <b>if</b> (<span class="r78 r">collectionTypeInfo</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> != <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#f21241fc7477e88a" class="i field">NotCollection</a>)
                        {
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                                <span class="s">&quot;ENCODING arg into collection&quot;</span>);
 
                            <b>bool</b> <span id="r90 rd" class="r90 r">ignored</span> = <b>false</b>;
                            <span class="r81 r">result</span> =
                                <a href="#16ff268913aa00d5" class="i method">EncodeCollection</a>(
                                    <span class="r75 r">argument</span>,
                                    <span class="r76 r">parameterName</span>,
                                    <span class="r78 r">collectionTypeInfo</span>,
                                    <span class="r77 r">toType</span>,
                                    <span class="r79 r">currentValue</span>,
                                    (<span class="r78 r">collectionTypeInfo</span>.<a href="CompiledCommandParameter.cs.html#a3e13d75b560e4c1" class="i property">ElementType</a> != <b>null</b>),
                                    <b>out</b> <span class="r90 r">ignored</span>);
 
                            <b>break</b>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// Check to see if the current value is a collection. If so, fail because</span>
                            <span class="c">// we don&#39;t want to attempt to bind a collection to a scalar unless</span>
                            <span class="c">// the parameter type is Object or PSObject or enum.</span>
 
                            <b>if</b> (<a href="#e3143cf69b7ef81f" class="i method">GetIList</a>(<span class="r79 r">currentValue</span>) != <b>null</b> &amp;&amp;
                                <span class="r77 r">toType</span> != <b>typeof</b>(<b>object</b>) &amp;&amp;
                                <span class="r77 r">toType</span> != <b>typeof</b>(<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>) &amp;&amp;
                                <span class="r77 r">toType</span> != <b>typeof</b>(<a href="hostifaces/ListModifier.cs.html#c1e57da97dcae456" class="t t">PSListModifier</a>) &amp;&amp;
                                (!<span class="r77 r">toType</span>.<span class="i">IsGenericType</span> || <span class="r77 r">toType</span>.<span class="i">GetGenericTypeDefinition</span>() != <b>typeof</b>(<a href="hostifaces/ListModifier.cs.html#cc2c9c6311898c2f" class="t t">PSListModifier</a>&lt;&gt;)) &amp;&amp;
                                (!<span class="r77 r">toType</span>.<span class="i">IsGenericType</span> || <span class="r77 r">toType</span>.<span class="i">GetGenericTypeDefinition</span>() != <b>typeof</b>(<a href="EnumExpressionEvaluator.cs.html#596ee50bb25acc45" class="t t">FlagsExpression</a>&lt;&gt;)) &amp;&amp;
                                !<span class="r77 r">toType</span>.<span class="i">IsEnum</span>)
                            {
                                <b>throw</b> <b>new</b> <span class="i">NotSupportedException</span>();
                            }
                        }
 
                        <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                            <span class="s">&quot;CONVERT arg type to param type using LanguagePrimitives.ConvertTo&quot;</span>);
 
                        <span class="c">// If we are in constrained language mode and the target command is trusted, which is often</span>
                        <span class="c">// the case for C# cmdlets, then we allow type conversion to the target parameter type.</span>
                        <span class="c">//</span>
                        <span class="c">// However, we don&#39;t allow Hashtable-to-Object conversion (PSObject and IDictionary) because</span>
                        <span class="c">// those can lead to property setters that probably aren&#39;t expected. This is enforced by</span>
                        <span class="c">// setting &#39;Context.LanguageModeTransitionInParameterBinding&#39; to true before the conversion.</span>
                        <b>bool</b> <span id="r91 rd" class="r91 r">changeLanguageModeForTrustedCommand</span> =
                            <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a> &amp;&amp;
                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#99954e76bd5b2111" class="i property">Command</a>.<a href="CommandBase.cs.html#1f4a1f38862b466a" class="i property">CommandInfo</a>.<a href="CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a> == <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
                        <b>bool</b> <span id="r92 rd" class="r92 r">oldLangModeTransitionStatus</span> = <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#800d673aaa498da6" class="i property">LanguageModeTransitionInParameterBinding</a>;
 
                        <b>try</b>
                        {
                            <b>if</b> (<span class="r91 r">changeLanguageModeForTrustedCommand</span>)
                            {
                                <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
                                <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#800d673aaa498da6" class="i property">LanguageModeTransitionInParameterBinding</a> = <b>true</b>;
                            }
 
                            <span class="r81 r">result</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r79 r">currentValue</span>, <span class="r77 r">toType</span>, <span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>);
                        }
                        <b>finally</b>
                        {
                            <b>if</b> (<span class="r91 r">changeLanguageModeForTrustedCommand</span>)
                            {
                                <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>;
                                <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#800d673aaa498da6" class="i property">LanguageModeTransitionInParameterBinding</a> = <span class="r92 r">oldLangModeTransitionStatus</span>;
                            }
                        }
 
                        <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                            <span class="s">&quot;CONVERT SUCCESSFUL using LanguagePrimitives.ConvertTo: [{0}]&quot;</span>,
                            (<span class="r81 r">result</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r81 r">result</span>.<span class="i">ToString</span>());
                    } <b>while</b> (<b>false</b>);
                }
                <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r93 rd" class="r93 r">notSupported</span>)
                {
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">TraceError</span>(
                        <span class="s">&quot;ERROR: COERCE FAILED: arg [{0}] could not be converted to the parameter type [{1}]&quot;</span>,
                        <span class="r81 r">result</span> ?? <span class="s">&quot;null&quot;</span>,
                        <span class="r77 r">toType</span>);
 
                    <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r94 rd" class="r94 r">pbe</span> =
                        <b>new</b> <span class="t">ParameterBindingException</span>(
                            <span class="r93 r">notSupported</span>,
                            <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                            <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r75 r">argument</span>),
                            <span class="r76 r">parameterName</span>,
                            <span class="r77 r">toType</span>,
                            <span class="r82 r">argumentType</span>,
                            <span class="i">ParameterBinderStrings</span>.<span class="i">CannotConvertArgument</span>,
                            <span class="s">&quot;CannotConvertArgument&quot;</span>,
                            <span class="r81 r">result</span> ?? <span class="s">&quot;null&quot;</span>,
                            <span class="r93 r">notSupported</span>.<span class="i">Message</span>);
 
                    <b>throw</b> <span class="r94 r">pbe</span>;
                }
                <b>catch</b> (<a href="ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a> <span id="r95 rd" class="r95 r">invalidCast</span>)
                {
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">TraceError</span>(
                      <span class="s">&quot;ERROR: COERCE FAILED: arg [{0}] could not be converted to the parameter type [{1}]&quot;</span>,
                      <span class="r81 r">result</span> ?? <span class="s">&quot;null&quot;</span>,
                      <span class="r77 r">toType</span>);
 
                    <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r96 rd" class="r96 r">pbe</span> =
                        <b>new</b> <span class="t">ParameterBindingException</span>(
                            <span class="r95 r">invalidCast</span>,
                            <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                            <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                            <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r75 r">argument</span>),
                            <span class="r76 r">parameterName</span>,
                            <span class="r77 r">toType</span>,
                            <span class="r82 r">argumentType</span>,
                            <span class="i">ParameterBinderStrings</span>.<span class="i">CannotConvertArgumentNoMessage</span>,
                            <span class="s">&quot;CannotConvertArgumentNoMessage&quot;</span>,
                            <span class="r95 r">invalidCast</span>.<span class="i">Message</span>);
 
                    <b>throw</b> <span class="r96 r">pbe</span>;
                }
            }
 
            <b>if</b> (<span class="r81 r">result</span> != <b>null</b>)
            {
                <span class="c">// Set the converted result object untrusted if necessary</span>
                <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="ExecutionContext.cs.html#91bedc10554ff828" class="i method">PropagateInputSource</a>(<span class="r80 r">originalValue</span>, <span class="r81 r">result</span>, <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>);
            }
 
            <b>return</b> <span class="r81 r">result</span>;
        }
 
        <b>private static bool</b> <a id="806beb5b2eb5ad69" href="../R/806beb5b2eb5ad69.html" target="n" data-glyph="76,1" class="i method">IsNullParameterValue</a>(<b>object</b> <span id="r97 rd" class="r97 r">currentValue</span>)
        {
            <b>bool</b> <span id="r98 rd" class="r98 r">result</span> = <b>false</b>;
 
            <b>if</b> (<span class="r97 r">currentValue</span> == <b>null</b> ||
                <span class="r97 r">currentValue</span> == <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a> ||
                <span class="r97 r">currentValue</span> == <a href="#e106e169b0ec2e07" class="t t">UnboundParameter</a>.<a href="#914edbc3371c49e2" class="i property">Value</a>)
            {
                <span class="r98 r">result</span> = <b>true</b>;
            }
 
            <b>return</b> <span class="r98 r">result</span>;
        }
 
        <b>private object</b> <a id="ce8e4409c5c5ab5d" href="../R/ce8e4409c5c5ab5d.html" target="n" data-glyph="76,1" class="i method">HandleNullParameterForSpecialTypes</a>(
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r99 rd" class="r99 r">argument</span>,
            <b>string</b> <span id="r100 rd" class="r100 r">parameterName</span>,
            <span class="i">Type</span> <span id="r101 rd" class="r101 r">toType</span>,
            <b>object</b> <span id="r102 rd" class="r102 r">currentValue</span>)
        {
            <b>object</b> <span id="r103 rd" class="r103 r">result</span> = <b>null</b>;
 
            <span class="c">// The presence of the name switch for SwitchParameters (and not booleans)</span>
            <span class="c">// makes them true.</span>
 
            <b>if</b> (<span class="r101 r">toType</span> == <b>typeof</b>(<b>bool</b>))
            {
                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                        <span class="s">&quot;ERROR: No argument is specified for parameter and parameter type is BOOL&quot;</span>);
 
                <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r104 rd" class="r104 r">exception</span> =
                    <b>new</b> <span class="t">ParameterBindingException</span>(
                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                        <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r99 r">argument</span>),
                        <span class="r100 r">parameterName</span>,
                        <span class="r101 r">toType</span>,
                        <b>null</b>,
                        <span class="i">ParameterBinderStrings</span>.<span class="i">ParameterArgumentValidationErrorNullNotAllowed</span>,
                        <span class="s">&quot;ParameterArgumentValidationErrorNullNotAllowed&quot;</span>,
                        <b>string</b>.<span class="i">Empty</span>);
 
                <b>throw</b> <span class="r104 r">exception</span>;
            }
            <b>else</b>
                <b>if</b> (<span class="r101 r">toType</span> == <b>typeof</b>(<a href="MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>))
            {
                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                    <span class="s">&quot;Arg is null or not present, parameter type is SWITCHPARAMTER, value is true.&quot;</span>);
                <span class="r103 r">result</span> = <a href="MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>.<a href="MshCmdlet.cs.html#df46a7a19deb662a" class="i property">Present</a>;
            }
            <b>else</b> <b>if</b> (<span class="r102 r">currentValue</span> == <a href="#e106e169b0ec2e07" class="t t">UnboundParameter</a>.<a href="#914edbc3371c49e2" class="i property">Value</a>)
            {
                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#e7dd110db4bf902f" class="i method">TraceError</a>(
                    <span class="s">&quot;ERROR: No argument was specified for the parameter and the parameter is not of type bool&quot;</span>);
 
                <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r105 rd" class="r105 r">exception</span> =
                    <b>new</b> <span class="t">ParameterBindingException</span>(
                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                        <a href="#57b3e53bd388f896" class="i method">GetParameterErrorExtent</a>(<span class="r99 r">argument</span>),
                        <span class="r100 r">parameterName</span>,
                        <span class="r101 r">toType</span>,
                        <b>null</b>,
                        <span class="i">ParameterBinderStrings</span>.<span class="i">MissingArgument</span>,
                        <span class="s">&quot;MissingArgument&quot;</span>);
 
                <b>throw</b> <span class="r105 r">exception</span>;
            }
            <b>else</b>
            {
                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(
                    <span class="s">&quot;Arg is null, parameter type not bool or SwitchParameter, value is null.&quot;</span>);
                <span class="r103 r">result</span> = <b>null</b>;
            }
 
            <b>return</b> <span class="r103 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Takes the current value specified and converts or adds it to</span>
        <span class="c">///</span><span class="c"> a collection of the appropriate type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">argument</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The argument the current value comes from. Used for error reporting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">parameterName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">collectionTypeInformation</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The collection type information to which the current value will be</span>
        <span class="c">///</span><span class="c"> encoded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">toType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The type the current value will be converted to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">currentValue</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The value to be encoded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">coerceElementTypeIfNeeded</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, the element will be coerced into the appropriate type</span>
        <span class="c">///</span><span class="c"> for the collection. If false, and the element isn&#39;t of the appropriate</span>
        <span class="c">///</span><span class="c"> type then the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">coercionRequired</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> out parameter will</span>
        <span class="c">///</span><span class="c"> be true.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">coercionRequired</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This out parameter will be true if </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">coerceElementTypeIfNeeded</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> is true and the value could not be encoded into the collection because it</span>
        <span class="c">///</span><span class="c"> requires coercion to the element type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A collection of the appropriate type containing the specified value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">currentValue</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a collection and one of its values</span>
        <span class="c">///</span><span class="c"> cannot be coerced into the appropriate type.</span>
        <span class="c">///</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> A collection of the appropriate </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">collectionTypeInformation</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> could not be created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Maintainability&quot;</span>, <span class="s">&quot;CA1505:AvoidUnmaintainableCode&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Maintainability&quot;</span>, <span class="s">&quot;CA1506:AvoidExcessiveClassCoupling&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Consider Simplyfing it&quot;</span>)]
        <b>private object</b> <a id="16ff268913aa00d5" href="../R/16ff268913aa00d5.html" target="n" data-glyph="76,1" class="i method">EncodeCollection</a>(
            <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r106 rd" class="r106 r">argument</span>,
            <b>string</b> <span id="r107 rd" class="r107 r">parameterName</span>,
            <a href="CompiledCommandParameter.cs.html#b78c35f87c747be1" class="t t">ParameterCollectionTypeInformation</a> <span id="r108 rd" class="r108 r">collectionTypeInformation</span>,
            <span class="i">Type</span> <span id="r109 rd" class="r109 r">toType</span>,
            <b>object</b> <span id="r110 rd" class="r110 r">currentValue</span>,
            <b>bool</b> <span id="r111 rd" class="r111 r">coerceElementTypeIfNeeded</span>,
            <b>out bool</b> <span id="r112 rd" class="r112 r">coercionRequired</span>)
        {
            <b>object</b> <span id="r113 rd" class="r113 r">originalValue</span> = <span class="r110 r">currentValue</span>;
            <b>object</b> <span id="r114 rd" class="r114 r">result</span> = <b>null</b>;
            <span class="r112 r">coercionRequired</span> = <b>false</b>;
 
            <b>do</b> <span class="c">// false loop</span>
            {
                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                    <span class="s">&quot;Binding collection parameter {0}: argument type [{1}], parameter type [{2}], collection type {3}, element type [{4}], {5}&quot;</span>,
                    <span class="r107 r">parameterName</span>,
                    (<span class="r110 r">currentValue</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r110 r">currentValue</span>.<span class="i">GetType</span>().<span class="i">Name</span>,
                    <span class="r109 r">toType</span>,
                    <span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a>,
                    <span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#a3e13d75b560e4c1" class="i property">ElementType</a>,
                    <span class="r111 r">coerceElementTypeIfNeeded</span> ? <span class="s">&quot;coerceElementType&quot;</span> : <span class="s">&quot;no coerceElementType&quot;</span>);
 
                <b>if</b> (<span class="r110 r">currentValue</span> == <b>null</b>)
                {
                    <b>break</b>;
                }
 
                <b>int</b> <span id="r115 rd" class="r115 r">numberOfElements</span> = 1;
                <span class="i">Type</span> <span id="r116 rd" class="r116 r">collectionElementType</span> = <span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#a3e13d75b560e4c1" class="i property">ElementType</a>;
 
                <span class="c">// If the current value is an IList, get the count of the elements</span>
                <span class="c">// Or if it is an PSObject which wraps an IList</span>
 
                <span class="i">IList</span> <span id="r117 rd" class="r117 r">currentValueAsIList</span> = <a href="#e3143cf69b7ef81f" class="i method">GetIList</a>(<span class="r110 r">currentValue</span>);
 
                <b>if</b> (<span class="r117 r">currentValueAsIList</span> != <b>null</b>)
                {
                    <span class="r115 r">numberOfElements</span> = <span class="r117 r">currentValueAsIList</span>.<span class="i">Count</span>;
 
                    <a href="#b3b3f9a9a9756bfd" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#70ee671c8687bfbd" class="i method">WriteLine</a>(<span class="s">&quot;current value is an IList with {0} elements&quot;</span>, <span class="r115 r">numberOfElements</span>);
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#70ee671c8687bfbd" class="i method">WriteLine</a>(
                        <span class="s">&quot;Arg is IList with {0} elements&quot;</span>,
                        <span class="r115 r">numberOfElements</span>);
                }
 
                <b>object</b> <span id="r118 rd" class="r118 r">resultCollection</span> = <b>null</b>;
                <span class="i">IList</span> <span id="r119 rd" class="r119 r">resultAsIList</span> = <b>null</b>;
                <span class="i">MethodInfo</span> <span id="r120 rd" class="r120 r">addMethod</span> = <b>null</b>;
 
                <span class="c">// We must special case System.Array to be like an object array since it is an</span>
                <span class="c">// abstract base class and cannot be created in the IList path below.</span>
                <b>bool</b> <span id="r121 rd" class="r121 r">isSystemDotArray</span> = (<span class="r109 r">toType</span> == <b>typeof</b>(<span class="i n">System</span>.<span class="i">Array</span>));
 
                <b>if</b> (<span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#44ab365e38ccd61c" class="i field">Array</a> ||
                    <span class="r121 r">isSystemDotArray</span>)
                {
                    <b>if</b> (<span class="r121 r">isSystemDotArray</span>)
                    {
                        <span class="c">// If System.Array is the type we are encoding to, then</span>
                        <span class="c">// the element type should be System.Object.</span>
 
                        <span class="r116 r">collectionElementType</span> = <b>typeof</b>(<b>object</b>);
                    }
 
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                        <span class="s">&quot;Creating array with element type [{0}] and {1} elements&quot;</span>,
                        <span class="r116 r">collectionElementType</span>,
                        <span class="r115 r">numberOfElements</span>);
 
                    <span class="c">// Since the destination is an array we will have to create an array</span>
                    <span class="c">// of the element type with the correct length</span>
 
                    <span class="r118 r">resultCollection</span> = <span class="r119 r">resultAsIList</span> =
                        (<span class="i">IList</span>)<span class="i">Array</span>.<span class="i">CreateInstance</span>(
                            <span class="r116 r">collectionElementType</span>,
                            <span class="r115 r">numberOfElements</span>);
                }
                <b>else</b> <b>if</b> (<span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#604944248a2940a0" class="i field">IList</a> ||
                         <span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#a831bb7acd7a9369" class="i field">ICollectionGeneric</a>)
                {
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                        <span class="s">&quot;Creating collection [{0}]&quot;</span>,
                        <span class="r109 r">toType</span>);
 
                    <span class="c">// Create an instance of the parameter type</span>
 
                    <span class="c">// NTRAID#Windows Out Of Band Releases-906820-2005/09/01</span>
                    <span class="c">// This code previously used the ctor(int) ctor form.</span>
                    <span class="c">// System.Collections.ObjectModel.Collection&lt;T&gt; does not</span>
                    <span class="c">// support this ctor form.  More generally, there is no</span>
                    <span class="c">// guarantee that the ctor parameter has the semantic</span>
                    <span class="c">// meaning of &quot;likely list size&quot;.  Blindly calling the</span>
                    <span class="c">// parameterless ctor is also risky, but seems like a</span>
                    <span class="c">// safer choice.</span>
 
                    <b>bool</b> <span id="r122 rd" class="r122 r">errorOccurred</span> = <b>false</b>;
                    <span class="i">Exception</span> <span id="r123 rd" class="r123 r">error</span> = <b>null</b>;
                    <b>try</b>
                    {
                        <span class="r118 r">resultCollection</span> =
                            <span class="i">Activator</span>.<span class="i">CreateInstance</span>(
                                <span class="r109 r">toType</span>,
                                0,
                                <b>null</b>,
                                <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;(),
                                <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                        <b>if</b> (<span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#604944248a2940a0" class="i field">IList</a>)
                            <span class="r119 r">resultAsIList</span> = (<span class="i">IList</span>)<span class="r118 r">resultCollection</span>;
                        <b>else</b>
                        {
                            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                                <span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#a831bb7acd7a9369" class="i field">ICollectionGeneric</a>,
                                <span class="s">&quot;invalid collection type&quot;</span>
                                );
                            <span class="c">// extract the ICollection&lt;T&gt;::Add(T) method</span>
                            <b>const</b> <span class="i">BindingFlags</span> <span id="r124 rd" class="r124 r">bindingFlags</span> = <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>;
                            <span class="i">Type</span> <span id="r125 rd" class="r125 r">elementType</span> = <span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#a3e13d75b560e4c1" class="i property">ElementType</a>;
                            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r125 r">elementType</span> != <b>null</b>, <span class="s">&quot;null ElementType&quot;</span>);
                            <span class="i">Exception</span> <span id="r126 rd" class="r126 r">getMethodError</span> = <b>null</b>;
                            <b>try</b>
                            {
                                <span class="r120 r">addMethod</span> = <span class="r109 r">toType</span>.<span class="i">GetMethod</span>(<span class="s">&quot;Add&quot;</span>, <span class="r124 r">bindingFlags</span>, <b>null</b>, <b>new</b> <span class="i">Type</span>[1] { <span class="r125 r">elementType</span> }, <b>null</b>);
                            }
                            <b>catch</b> (<span class="i">AmbiguousMatchException</span> <span id="r127 rd" class="r127 r">e</span>)
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(<span class="s">&quot;Ambiguous match to Add(T) for type {0}: {1}&quot;</span>, <span class="r109 r">toType</span>.<span class="i">FullName</span>, <span class="r127 r">e</span>.<span class="i">Message</span>);
                                <span class="r126 r">getMethodError</span> = <span class="r127 r">e</span>;
                            }
                            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r128 rd" class="r128 r">e</span>)
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                    <span class="s">&quot;ArgumentException matching Add(T) for type {0}: {1}&quot;</span>, <span class="r109 r">toType</span>.<span class="i">FullName</span>, <span class="r128 r">e</span>.<span class="i">Message</span>);
                                <span class="r126 r">getMethodError</span> = <span class="r128 r">e</span>;
                            }
 
                            <b>if</b> (<span class="r120 r">addMethod</span> == <b>null</b>)
                            {
                                <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r129 rd" class="r129 r">bindingException</span> =
                                    <b>new</b> <span class="t">ParameterBindingException</span>(
                                        <span class="r126 r">getMethodError</span>,
                                        <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                                        <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                        <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r106 r">argument</span>),
                                        <span class="r107 r">parameterName</span>,
                                        <span class="r109 r">toType</span>,
                                        <span class="r110 r">currentValue</span>.<span class="i">GetType</span>(),
                                        <span class="i">ParameterBinderStrings</span>.<span class="i">CannotExtractAddMethod</span>,
                                        <span class="s">&quot;CannotExtractAddMethod&quot;</span>,
                                        (<span class="r126 r">getMethodError</span> == <b>null</b>) ? <b>string</b>.<span class="i">Empty</span> : <span class="r126 r">getMethodError</span>.<span class="i">Message</span>);
                                <b>throw</b> <span class="r129 r">bindingException</span>;
                            }
                        }
                    }
                    <b>catch</b> (<span class="i">ArgumentException</span> <span id="r130 rd" class="r130 r">argException</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r130 r">argException</span>;
                    }
                    <b>catch</b> (<span class="i">NotSupportedException</span> <span id="r131 rd" class="r131 r">notSupported</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r131 r">notSupported</span>;
                    }
                    <b>catch</b> (<span class="i">TargetInvocationException</span> <span id="r132 rd" class="r132 r">targetInvocationException</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r132 r">targetInvocationException</span>;
                    }
                    <b>catch</b> (<span class="i">MethodAccessException</span> <span id="r133 rd" class="r133 r">methodAccessException</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r133 r">methodAccessException</span>;
                    }
                    <b>catch</b> (<span class="i">MemberAccessException</span> <span id="r134 rd" class="r134 r">memberAccessException</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r134 r">memberAccessException</span>;
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>.<span class="i">InvalidComObjectException</span> <span id="r135 rd" class="r135 r">invalidComObject</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r135 r">invalidComObject</span>;
                    }
                    <b>catch</b> (<span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>.<span class="i">COMException</span> <span id="r136 rd" class="r136 r">comException</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r136 r">comException</span>;
                    }
                    <b>catch</b> (<span class="i">TypeLoadException</span> <span id="r137 rd" class="r137 r">typeLoadException</span>)
                    {
                        <span class="r122 r">errorOccurred</span> = <b>true</b>;
                        <span class="r123 r">error</span> = <span class="r137 r">typeLoadException</span>;
                    }
 
                    <b>if</b> (<span class="r122 r">errorOccurred</span>)
                    {
                        <span class="c">// Throw a ParameterBindingException</span>
 
                        <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r138 rd" class="r138 r">bindingException</span> =
                            <b>new</b> <span class="t">ParameterBindingException</span>(
                                <span class="r123 r">error</span>,
                                <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                                <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r106 r">argument</span>),
                                <span class="r107 r">parameterName</span>,
                                <span class="r109 r">toType</span>,
                                <span class="r110 r">currentValue</span>.<span class="i">GetType</span>(),
                                <span class="i">ParameterBinderStrings</span>.<span class="i">CannotConvertArgument</span>,
                                <span class="s">&quot;CannotConvertArgument&quot;</span>,
                                <span class="s">&quot;null&quot;</span>,
                                <span class="r123 r">error</span>.<span class="i">Message</span>);
                        <b>throw</b> <span class="r138 r">bindingException</span>;
                    }
                }
                <b>else</b>
                {
                    <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                        <b>false</b>,
                        <span class="s">&quot;This method should not be called for a parameter that is not a collection&quot;</span>);
                    <b>break</b>;
                }
 
                <span class="c">// NTRAID#Windows OS Bugs-966440-2004/05/05-JeffJon</span>
                <span class="c">// This coercion can only go to a collection type.  It cannot take a</span>
                <span class="c">// collection type and coerce it into a scalar type.</span>
 
                <span class="c">// Now that the new collection instance has been created, coerce each element type</span>
                <span class="c">// of the current value to the element type of the property value and add it</span>
 
                <b>if</b> (<span class="r117 r">currentValueAsIList</span> != <b>null</b>)
                {
                    <span class="c">// Since arrays don&#39;t support the Add method, we must use indexing</span>
                    <span class="c">// to set the value.</span>
                    <b>int</b> <span id="r139 rd" class="r139 r">arrayIndex</span> = 0;
 
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                        <span class="s">&quot;Argument type {0} is IList&quot;</span>,
                        <span class="r110 r">currentValue</span>.<span class="i">GetType</span>());
 
                    <b>foreach</b> (<b>object</b> <span id="r140 rd" class="r140 r">valueElement</span> <b>in</b> <span class="r117 r">currentValueAsIList</span>)
                    {
                        <b>object</b> <span id="r141 rd" class="r141 r">currentValueElement</span> = <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r140 r">valueElement</span>);
 
                        <b>if</b> (<span class="r111 r">coerceElementTypeIfNeeded</span>)
                        {
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                <span class="s">&quot;COERCE collection element from type {0} to type {1}&quot;</span>,
                                (<span class="r140 r">valueElement</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r140 r">valueElement</span>.<span class="i">GetType</span>().<span class="i">Name</span>,
                                <span class="r116 r">collectionElementType</span>);
 
                            <span class="c">// Coerce the element to the appropriate type.</span>
                            <span class="c">// Note, this may be recursive if the element is a</span>
                            <span class="c">// collection itself.</span>
 
                            <span class="r141 r">currentValueElement</span> =
                                <a href="#011a1ac4f4501af3" class="i method">CoerceTypeAsNeeded</a>(
                                        <span class="r106 r">argument</span>,
                                        <span class="r107 r">parameterName</span>,
                                        <span class="r116 r">collectionElementType</span>,
                                        <b>null</b>,
                                        <span class="r140 r">valueElement</span>);
                        }
                        <b>else</b> <b>if</b> (<span class="r116 r">collectionElementType</span> != <b>null</b> &amp;&amp; <span class="r141 r">currentValueElement</span> != <b>null</b>)
                        {
                            <span class="i">Type</span> <span id="r142 rd" class="r142 r">currentValueElementType</span> = <span class="r141 r">currentValueElement</span>.<span class="i">GetType</span>();
                            <span class="i">Type</span> <span id="r143 rd" class="r143 r">desiredElementType</span> = <span class="r116 r">collectionElementType</span>;
 
                            <b>if</b> (<span class="r142 r">currentValueElementType</span> != <span class="r143 r">desiredElementType</span> &amp;&amp;
                                !<span class="r142 r">currentValueElementType</span>.<span class="i">IsSubclassOf</span>(<span class="r143 r">desiredElementType</span>))
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                    <span class="s">&quot;COERCION REQUIRED: Did not attempt to coerce collection element from type {0} to type {1}&quot;</span>,
                                    (<span class="r140 r">valueElement</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r140 r">valueElement</span>.<span class="i">GetType</span>().<span class="i">Name</span>,
                                    <span class="r116 r">collectionElementType</span>);
 
                                <span class="r112 r">coercionRequired</span> = <b>true</b>;
                                <b>break</b>;
                            }
                        }
 
                        <span class="c">// Add() will fail with ArgumentException</span>
                        <span class="c">// for Collection&lt;T&gt; with the wrong type.</span>
                        <b>try</b>
                        {
                            <b>if</b> (<span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#44ab365e38ccd61c" class="i field">Array</a> ||
                                <span class="r121 r">isSystemDotArray</span>)
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(
                                    <span class="s">&quot;Adding element of type {0} to array position {1}&quot;</span>,
                                    (<span class="r141 r">currentValueElement</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r141 r">currentValueElement</span>.<span class="i">GetType</span>().<span class="i">Name</span>,
                                    <span class="r139 r">arrayIndex</span>);
                                <span class="r119 r">resultAsIList</span>[<span class="r139 r">arrayIndex</span>++] = <span class="r141 r">currentValueElement</span>;
                            }
                            <b>else</b> <b>if</b> (<span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#604944248a2940a0" class="i field">IList</a>)
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                                    <span class="s">&quot;Adding element of type {0} via IList.Add&quot;</span>,
                                    (<span class="r141 r">currentValueElement</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r141 r">currentValueElement</span>.<span class="i">GetType</span>().<span class="i">Name</span>);
                                <span class="r119 r">resultAsIList</span>.<span class="i">Add</span>(<span class="r141 r">currentValueElement</span>);
                            }
                            <b>else</b>
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                                    <span class="s">&quot;Adding element of type {0} via ICollection&lt;T&gt;::Add()&quot;</span>,
                                    (<span class="r141 r">currentValueElement</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r141 r">currentValueElement</span>.<span class="i">GetType</span>().<span class="i">Name</span>);
                                <span class="r120 r">addMethod</span>.<span class="i">Invoke</span>(<span class="r118 r">resultCollection</span>, <b>new</b> <b>object</b>[1] { <span class="r141 r">currentValueElement</span> });
                            }
                        }
                        <b>catch</b> (<span class="i">Exception</span> <span id="r144 rd" class="r144 r">error</span>) <span class="c">// OK, we catch all here by design</span>
                        {
                            <span class="c">// The inner exception to TargetInvocationException</span>
                            <span class="c">// (if present) has a better Message</span>
                            <b>if</b> (<span class="r144 r">error</span> <b>is</b> <span class="i">TargetInvocationException</span> &amp;&amp;
                                <span class="r144 r">error</span>.<span class="i">InnerException</span> != <b>null</b>)
                            {
                                <span class="r144 r">error</span> = <span class="r144 r">error</span>.<span class="i">InnerException</span>;
                            }
 
                            <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r145 rd" class="r145 r">bindingException</span> =
                                <b>new</b> <span class="t">ParameterBindingException</span>(
                                    <span class="r144 r">error</span>,
                                    <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                                    <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                    <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r106 r">argument</span>),
                                    <span class="r107 r">parameterName</span>,
                                    <span class="r109 r">toType</span>,
                                    <span class="r141 r">currentValueElement</span>?.<span class="i">GetType</span>(),
                                    <span class="i">ParameterBinderStrings</span>.<span class="i">CannotConvertArgument</span>,
                                    <span class="s">&quot;CannotConvertArgument&quot;</span>,
                                    <span class="r141 r">currentValueElement</span> ?? <span class="s">&quot;null&quot;</span>,
                                    <span class="r144 r">error</span>.<span class="i">Message</span>);
                            <b>throw</b> <span class="r145 r">bindingException</span>;
                        }
                    }
                }
                <b>else</b> <span class="c">// (currentValueAsIList == null)</span>
                {
                    <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                        <span class="s">&quot;Argument type {0} is not IList, treating this as scalar&quot;</span>,
                        <span class="r110 r">currentValue</span>.<span class="i">GetType</span>().<span class="i">Name</span>);
 
                    <b>if</b> (<span class="r116 r">collectionElementType</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r111 r">coerceElementTypeIfNeeded</span>)
                        {
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                <span class="s">&quot;Coercing scalar arg value to type {0}&quot;</span>,
                                <span class="r116 r">collectionElementType</span>);
 
                            <span class="c">// Coerce the scalar type into the collection</span>
 
                            <span class="r110 r">currentValue</span> =
                                <a href="#011a1ac4f4501af3" class="i method">CoerceTypeAsNeeded</a>(
                                    <span class="r106 r">argument</span>,
                                    <span class="r107 r">parameterName</span>,
                                    <span class="r116 r">collectionElementType</span>,
                                    <b>null</b>,
                                    <span class="r110 r">currentValue</span>);
                        }
                        <b>else</b>
                        {
                            <span class="i">Type</span> <span id="r146 rd" class="r146 r">currentValueElementType</span> = <span class="r110 r">currentValue</span>.<span class="i">GetType</span>();
                            <span class="i">Type</span> <span id="r147 rd" class="r147 r">desiredElementType</span> = <span class="r116 r">collectionElementType</span>;
 
                            <b>if</b> (<span class="r146 r">currentValueElementType</span> != <span class="r147 r">desiredElementType</span> &amp;&amp;
                                !<span class="r146 r">currentValueElementType</span>.<span class="i">IsSubclassOf</span>(<span class="r147 r">desiredElementType</span>))
                            {
                                <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">WriteLine</span>(
                                    <span class="s">&quot;COERCION REQUIRED: Did not coerce scalar arg value to type {1}&quot;</span>,
                                    <span class="r116 r">collectionElementType</span>);
 
                                <span class="r112 r">coercionRequired</span> = <b>true</b>;
                                <b>break</b>;
                            }
                        }
                    }
 
                    <span class="c">// Add() will fail with ArgumentException</span>
                    <span class="c">// for Collection&lt;T&gt; with the wrong type.</span>
                    <b>try</b>
                    {
                        <b>if</b> (<span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#44ab365e38ccd61c" class="i field">Array</a> ||
                            <span class="r121 r">isSystemDotArray</span>)
                        {
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#49bf988885074437" class="i method">WriteLine</a>(
                                <span class="s">&quot;Adding scalar element of type {0} to array position {1}&quot;</span>,
                                (<span class="r110 r">currentValue</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r110 r">currentValue</span>.<span class="i">GetType</span>().<span class="i">Name</span>,
                                0);
                            <span class="r119 r">resultAsIList</span>[0] = <span class="r110 r">currentValue</span>;
                        }
                        <b>else</b> <b>if</b> (<span class="r108 r">collectionTypeInformation</span>.<a href="CompiledCommandParameter.cs.html#5b7b2c72ae3167c5" class="i property">ParameterCollectionType</a> == <a href="CompiledCommandParameter.cs.html#8e2afd828adc549d" class="t t">ParameterCollectionType</a>.<a href="CompiledCommandParameter.cs.html#604944248a2940a0" class="i field">IList</a>)
                        {
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                                <span class="s">&quot;Adding scalar element of type {0} via IList.Add&quot;</span>,
                                (<span class="r110 r">currentValue</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r110 r">currentValue</span>.<span class="i">GetType</span>().<span class="i">Name</span>);
                            <span class="r119 r">resultAsIList</span>.<span class="i">Add</span>(<span class="r110 r">currentValue</span>);
                        }
                        <b>else</b>
                        {
                            <a href="#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(
                                <span class="s">&quot;Adding scalar element of type {0} via ICollection&lt;T&gt;::Add()&quot;</span>,
                                (<span class="r110 r">currentValue</span> == <b>null</b>) ? <span class="s">&quot;null&quot;</span> : <span class="r110 r">currentValue</span>.<span class="i">GetType</span>().<span class="i">Name</span>);
                            <span class="r120 r">addMethod</span>.<span class="i">Invoke</span>(<span class="r118 r">resultCollection</span>, <b>new</b> <b>object</b>[1] { <span class="r110 r">currentValue</span> });
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r148 rd" class="r148 r">error</span>) <span class="c">// OK, we catch all here by design</span>
                    {
                        <span class="c">// The inner exception to TargetInvocationException</span>
                        <span class="c">// (if present) has a better Message</span>
                        <b>if</b> (<span class="r148 r">error</span> <b>is</b> <span class="i">TargetInvocationException</span> &amp;&amp;
                            <span class="r148 r">error</span>.<span class="i">InnerException</span> != <b>null</b>)
                        {
                            <span class="r148 r">error</span> = <span class="r148 r">error</span>.<span class="i">InnerException</span>;
                        }
 
                        <a href="../utils/ParameterBinderExceptions.cs.html#8e3f022461e43e12" class="t t">ParameterBindingException</a> <span id="r149 rd" class="r149 r">bindingException</span> =
                            <b>new</b> <span class="t">ParameterBindingException</span>(
                                <span class="r148 r">error</span>,
                                <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                                <a href="#6a035e6bf95bfc67" class="k">this</a>.<a href="#d4033a216a206c72" class="i property">InvocationInfo</a>,
                                <a href="#0f7ccdbd51e0d9b1" class="i method">GetErrorExtent</a>(<span class="r106 r">argument</span>),
                                <span class="r107 r">parameterName</span>,
                                <span class="r109 r">toType</span>,
                                <span class="r110 r">currentValue</span>?.<span class="i">GetType</span>(),
                                <span class="i">ParameterBinderStrings</span>.<span class="i">CannotConvertArgument</span>,
                                <span class="s">&quot;CannotConvertArgument&quot;</span>,
                                <span class="r110 r">currentValue</span> ?? <span class="s">&quot;null&quot;</span>,
                                <span class="r148 r">error</span>.<span class="i">Message</span>);
                        <b>throw</b> <span class="r149 r">bindingException</span>;
                    }
                }
 
                <b>if</b> (!<span class="r112 r">coercionRequired</span>)
                {
                    <span class="r114 r">result</span> = <span class="r118 r">resultCollection</span>;
 
                    <span class="c">// Set the converted result object untrusted if necessary</span>
                    <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="ExecutionContext.cs.html#91bedc10554ff828" class="i method">PropagateInputSource</a>(<span class="r113 r">originalValue</span>, <span class="r114 r">result</span>, <a href="#38a4ecbc6a44c18f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>);
                }
            } <b>while</b> (<b>false</b>);
 
            <b>return</b> <span class="r114 r">result</span>;
        }
 
        <b>internal static</b> <span class="i">IList</span> <a id="e3143cf69b7ef81f" href="../R/e3143cf69b7ef81f.html" target="n" data-glyph="74,1" class="i method">GetIList</a>(<b>object</b> <span id="r150 rd" class="r150 r">value</span>)
        {
            <b>var</b> <span id="r151 rd" class="r151 r">baseObj</span> = <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r150 r">value</span>);
            <b>var</b> <span id="r152 rd" class="r152 r">result</span> = <span class="r151 r">baseObj</span> <b>as</b> <span class="i">IList</span>;
            <b>if</b> (<span class="r152 r">result</span> != <b>null</b>)
            {
                <span class="c">// Reference comparison to determine if &#39;value&#39; is a PSObject</span>
                <a href="#b3b3f9a9a9756bfd" class="i field">s_tracer</a>.<a href="../utils/StructuredTraceSource.cs.html#96aaf3813a5962a0" class="i method">WriteLine</a>(<span class="r151 r">baseObj</span> == <span class="r150 r">value</span>
                                     ? <span class="s">&quot;argument is IList&quot;</span>
                                     : <span class="s">&quot;argument is PSObject with BaseObject as IList&quot;</span>);
            }
 
            <b>return</b> <span class="r152 r">result</span>;
        }
 
        <b>protected</b> <a href="parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <a id="0f7ccdbd51e0d9b1" href="../R/0f7ccdbd51e0d9b1.html" target="n" data-glyph="75,1" class="i method">GetErrorExtent</a>(<a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r153 rd" class="r153 r">cpi</span>)
        {
            <a href="parser/Position.cs.html#bbc751d075344454" class="k">var</a> <span id="r154 rd" class="r154 r">result</span> = <span class="r153 r">cpi</span>.<a href="CommandParameter.cs.html#d5b8f6c7dafdc5cb" class="i property">ErrorExtent</a>;
            <b>if</b> (<span class="r154 r">result</span> == <a href="parser/Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="parser/Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>)
                <span class="r154 r">result</span> = <a href="#d4033a216a206c72" class="i property">InvocationInfo</a>.<a href="InvocationInfo.cs.html#36c1c0cc46ab70ad" class="i property">ScriptPosition</a>;
            <span class="c">// Can&#39;t use this assertion - we don&#39;t have useful positions when invoked via PowerShell API</span>
            <span class="c">// Diagnostics.Assert(result != PositionUtilities.EmptyExtent, &quot;We are missing a valid position somewhere&quot;);</span>
            <b>return</b> <span class="r154 r">result</span>;
        }
 
        <b>protected</b> <a href="parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <a id="57b3e53bd388f896" href="../R/57b3e53bd388f896.html" target="n" data-glyph="75,1" class="i method">GetParameterErrorExtent</a>(<a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r155 rd" class="r155 r">cpi</span>)
        {
            <a href="parser/Position.cs.html#bbc751d075344454" class="k">var</a> <span id="r156 rd" class="r156 r">result</span> = <span class="r155 r">cpi</span>.<a href="CommandParameter.cs.html#d12a5051b2b93c45" class="i property">ParameterExtent</a>;
            <b>if</b> (<span class="r156 r">result</span> == <a href="parser/Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="parser/Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>)
                <span class="r156 r">result</span> = <a href="#d4033a216a206c72" class="i property">InvocationInfo</a>.<a href="InvocationInfo.cs.html#36c1c0cc46ab70ad" class="i property">ScriptPosition</a>;
            <span class="c">// Can&#39;t use this assertion - we don&#39;t have useful positions when invoked via PowerShell API</span>
            <span class="c">// Diagnostics.Assert(result != PositionUtilities.EmptyExtent, &quot;We are missing a valid position somewhere&quot;);</span>
            <b>return</b> <span class="r156 r">result</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> private helpers
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Represents an unbound parameter object in the engine. It&#39;s similar to</span>
    <span class="c">///</span><span class="c"> AutomationNull.Value however AutomationNull.Value as a parameter value</span>
    <span class="c">///</span><span class="c"> is used to say &quot;use the default value for this object&quot; whereas UnboundParameter</span>
    <span class="c">///</span><span class="c"> says &quot;this parameter is unbound, use the default only if the target type</span>
    <span class="c">///</span><span class="c"> supports permits this.&quot;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">It&#39;s a singleton class. Sealed to prevent subclassing</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="e106e169b0ec2e07" href="../R/e106e169b0ec2e07.html" target="n" data-glyph="2,0" class="t t">UnboundParameter</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctor
 
        <span class="c">// Private constructor</span>
        <b>private</b> <a id="4a85b615ed933dd5" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">UnboundParameter</a>() { }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctor
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> private_members
 
        <span class="c">// Private member for Value.</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> private_members
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> public_property
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Represents an object of the same class (singleton class).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static object</b> <a id="914edbc3371c49e2" href="../R/914edbc3371c49e2.html" target="n" data-glyph="104,1" class="i property">Value</a> { <b>get</b>; } = <b>new</b> <b>object</b>();
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> public_property
    }
 
    <span class="c">// This class is a thin wrapper around Dictionary, but adds a member BoundPositionally.</span>
    <span class="c">// $PSBoundParameters used to be a PSObject with an instance member, but that was quite</span>
    <span class="c">// slow for a relatively common case, this class should work identically, except maybe</span>
    <span class="c">// if somebody depends on the typename being the same.</span>
    <b>internal sealed class</b> <a id="9382e45706fdb782" href="../R/9382e45706fdb782.html" target="n" data-glyph="2,0" class="t t">PSBoundParametersDictionary</a> : <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt;
    {
        <b>internal</b> <a id="ba0fe6b0a6fa9eab" href="../R/ba0fe6b0a6fa9eab.html" target="n" data-glyph="74,1" class="t constructor">PSBoundParametersDictionary</a>()
            : <b>base</b>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)
        {
            <a href="#1a300485d1d5b986" class="i property">BoundPositionally</a> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <a href="#a1b19c52ca59759e" class="i property">ImplicitUsingParameters</a> = <a href="#b75059f1674195a7" class="i field">s_emptyUsingParameters</a>;
        }
 
        <b>private static readonly</b> <span class="i">IDictionary</span> <a id="b75059f1674195a7" href="../R/b75059f1674195a7.html" target="n" data-glyph="46,1" class="i field">s_emptyUsingParameters</a> = <b>new</b> <span class="i">ReadOnlyDictionary</span>&lt;<b>object</b>, <b>object</b>&gt;(<b>new</b> <span class="i">Dictionary</span>&lt;<b>object</b>, <b>object</b>&gt;());
 
        <b>public</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="1a300485d1d5b986" href="../R/1a300485d1d5b986.html" target="n" data-glyph="102,1" class="i property">BoundPositionally</a> { <b>get</b>; }
 
        <b>internal</b> <span class="i">IDictionary</span> <a id="a1b19c52ca59759e" href="../R/a1b19c52ca59759e.html" target="n" data-glyph="104,1" class="i property">ImplicitUsingParameters</a> { <b>get</b>; <b>set</b>; }
    }
 
    <b>internal sealed class</b> <a id="efc1e794ccda0552" href="../R/efc1e794ccda0552.html" target="n" data-glyph="2,0" class="t t"><span id="06376fb8fd0780a0">CommandLineParameters</span></a>
    {
        <b>private readonly</b> <a href="#9382e45706fdb782" class="t t">PSBoundParametersDictionary</a> <a id="35578d3206b2ab7f" href="../R/35578d3206b2ab7f.html" target="n" data-glyph="46,1" class="i field">_dictionary</a> = <b>new</b> <a href="#ba0fe6b0a6fa9eab" class="t constructor">PSBoundParametersDictionary</a>();
 
        <b>internal bool</b> <a id="13e30d3c8502fa00" href="../R/13e30d3c8502fa00.html" target="n" data-glyph="74,1" class="i method">ContainsKey</a>(<b>string</b> <span id="r157 rd" class="r157 r">name</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r157 r">name</span>), <span class="s">&quot;parameter names should not be empty&quot;</span>);
            <b>return</b> <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<span class="i">ContainsKey</span>(<span class="r157 r">name</span>);
        }
 
        <b>internal void</b> <a id="fb9729d19c4f40b0" href="../R/fb9729d19c4f40b0.html" target="n" data-glyph="74,1" class="i method">Add</a>(<b>string</b> <span id="r158 rd" class="r158 r">name</span>, <b>object</b> <span id="r159 rd" class="r159 r">value</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r158 r">name</span>), <span class="s">&quot;parameter names should not be empty&quot;</span>);
            <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>[<span class="r158 r">name</span>] = <span class="r159 r">value</span>;
        }
 
        <b>internal void</b> <a id="300462d4aee417ae" href="../R/300462d4aee417ae.html" target="n" data-glyph="74,1" class="i method">MarkAsBoundPositionally</a>(<b>string</b> <span id="r160 rd" class="r160 r">name</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r160 r">name</span>), <span class="s">&quot;parameter names should not be empty&quot;</span>);
            <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<a href="#1a300485d1d5b986" class="i property">BoundPositionally</a>.<span class="i">Add</span>(<span class="r160 r">name</span>);
        }
 
        <b>internal void</b> <a id="d9103cd063bafe68" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetPSBoundParametersVariable</a>(<a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r161 rd" class="r161 r">context</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r161 r">context</span> != <b>null</b>, <span class="s">&quot;caller should verify that context != null&quot;</span>);
 
            <span class="r161 r">context</span>.<a href="ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="SpecialVariables.cs.html#ac0581fe030e7548" class="i field">PSBoundParametersVarPath</a>, <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>);
        }
 
        <b>internal void</b> <a id="ebd10d420500ef5c" href="../R/ebd10d420500ef5c.html" target="n" data-glyph="74,1" class="i method">SetImplicitUsingParameters</a>(<b>object</b> <span id="r162 rd" class="r162 r">obj</span>)
        {
            <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<a href="#a1b19c52ca59759e" class="i property">ImplicitUsingParameters</a> = <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r162 r">obj</span>) <b>as</b> <span class="i">IDictionary</span>;
            <b>if</b> (<a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<a href="#a1b19c52ca59759e" class="i property">ImplicitUsingParameters</a> == <b>null</b>)
            {
                <span class="c">// Handle downlevel V4 case where using parameters are passed as an array list.</span>
                <span class="i">IList</span> <span id="r163 rd" class="r163 r">implicitArrayUsingParameters</span> = <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r162 r">obj</span>) <b>as</b> <span class="i">IList</span>;
                <b>if</b> ((<span class="r163 r">implicitArrayUsingParameters</span> != <b>null</b>) &amp;&amp; (<span class="r163 r">implicitArrayUsingParameters</span>.<span class="i">Count</span> &gt; 0))
                {
                    <span class="c">// Convert array to hash table.</span>
                    <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<a href="#a1b19c52ca59759e" class="i property">ImplicitUsingParameters</a> = <b>new</b> <span class="i">Hashtable</span>();
                    <b>for</b> (<b>int</b> <span id="r164 rd" class="r164 r">index</span> = 0; <span class="r164 r">index</span> &lt; <span class="r163 r">implicitArrayUsingParameters</span>.<span class="i">Count</span>; <span class="r164 r">index</span>++)
                    {
                        <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<a href="#a1b19c52ca59759e" class="i property">ImplicitUsingParameters</a>.<span class="i">Add</span>(<span class="r164 r">index</span>, <span class="r163 r">implicitArrayUsingParameters</span>[<span class="r164 r">index</span>]);
                    }
                }
            }
        }
 
        <b>internal</b> <span class="i">IDictionary</span> <a id="12b5ea06f8c115f8" href="../R/12b5ea06f8c115f8.html" target="n" data-glyph="74,1" class="i method">GetImplicitUsingParameters</a>()
        {
            <b>return</b> <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<a href="#a1b19c52ca59759e" class="i property">ImplicitUsingParameters</a>;
        }
 
        <b>internal object</b> <a id="a424a7a35309dc44" href="../R/a424a7a35309dc44.html" target="n" data-glyph="74,1" class="i method">GetValueToBindToPSBoundParameters</a>()
        {
            <b>return</b> <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>;
        }
 
        <b>internal void</b> <a id="ab97e37b119045b9" href="../R/ab97e37b119045b9.html" target="n" data-glyph="74,1" class="i method">UpdateInvocationInfo</a>(<a href="InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r165 rd" class="r165 r">invocationInfo</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r165 r">invocationInfo</span> != <b>null</b>, <span class="s">&quot;caller should verify that invocationInfo != null&quot;</span>);
            <span class="r165 r">invocationInfo</span>.<a href="InvocationInfo.cs.html#1927782a0117ff76" class="i property">BoundParameters</a> = <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>;
        }
 
        <b>internal</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="7ee86d5b14016915" href="../R/7ee86d5b14016915.html" target="n" data-glyph="74,1" class="i method">CopyBoundPositionalParameters</a>()
        {
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r166 rd" class="r166 r">result</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">CurrentCultureIgnoreCase</span>);
            <b>foreach</b> (<b>string</b> <span id="r167 rd" class="r167 r">item</span> <b>in</b> <a href="#35578d3206b2ab7f" class="i field">_dictionary</a>.<a href="#1a300485d1d5b986" class="i property">BoundPositionally</a>)
            {
                <span class="r166 r">result</span>.<span class="i">Add</span>(<span class="r167 r">item</span>);
            }
 
            <b>return</b> <span class="r166 r">result</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
