<!DOCTYPE html>
<html><head><title>Utils.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(1926);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/Utils.cs" target="_top">engine\Utils.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Security</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Numerics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>.<span class="i">SafeHandles</span>;
 
<b>using</b> <span class="t">TypeTable</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="t t">TypeTable</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Helper fns.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="9185d6ecbaebbec0" href="../R/9185d6ecbaebbec0.html" target="n" data-glyph="2,0" class="t t">Utils</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a given double value to BigInteger via Math.Round().</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">d</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The value to convert.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Returns a BigInteger value equivalent to the input value rounded to nearest integer.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">BigInteger</span> <a id="885164d8b80cf459" href="../R/885164d8b80cf459.html" target="n" data-glyph="221,1" class="i method">AsBigInt</a>(<b>this</b> <b>double</b> <span id="r0 rd" class="r0 r">d</span>) =&gt; <b>new</b> <span class="i">BigInteger</span>(<span class="i">Math</span>.<span class="i">Round</span>(<span class="r0 r">d</span>));
 
        <b>internal static bool</b> <a id="e3922f530b7cdb88" href="../R/e3922f530b7cdb88.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r1 rd" class="r1 r">value</span>, <b>out byte</b> <span id="r2 rd" class="r2 r">b</span>)
        {
            <b>if</b> (<span class="r1 r">value</span> &lt; <b>byte</b>.<span class="i">MinValue</span> || <span class="r1 r">value</span> &gt; <b>byte</b>.<span class="i">MaxValue</span>)
            {
                <span class="r2 r">b</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r2 r">b</span> = (<b>byte</b>)<span class="r1 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="3fe8963e3122fe70" href="../R/3fe8963e3122fe70.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r3 rd" class="r3 r">value</span>, <b>out sbyte</b> <span id="r4 rd" class="r4 r">sb</span>)
        {
            <b>if</b> (<span class="r3 r">value</span> &lt; <b>sbyte</b>.<span class="i">MinValue</span> || <span class="r3 r">value</span> &gt; <b>sbyte</b>.<span class="i">MaxValue</span>)
            {
                <span class="r4 r">sb</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r4 r">sb</span> = (<b>sbyte</b>)<span class="r3 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="817e92e6a6568ad3" href="../R/817e92e6a6568ad3.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r5 rd" class="r5 r">value</span>, <b>out short</b> <span id="r6 rd" class="r6 r">s</span>)
        {
            <b>if</b> (<span class="r5 r">value</span> &lt; <b>short</b>.<span class="i">MinValue</span> || <span class="r5 r">value</span> &gt; <b>short</b>.<span class="i">MaxValue</span>)
            {
                <span class="r6 r">s</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r6 r">s</span> = (<b>short</b>)<span class="r5 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="987b9e08295ada65" href="../R/987b9e08295ada65.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r7 rd" class="r7 r">value</span>, <b>out ushort</b> <span id="r8 rd" class="r8 r">us</span>)
        {
            <b>if</b> (<span class="r7 r">value</span> &lt; <b>ushort</b>.<span class="i">MinValue</span> || <span class="r7 r">value</span> &gt; <b>ushort</b>.<span class="i">MaxValue</span>)
            {
                <span class="r8 r">us</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r8 r">us</span> = (<b>ushort</b>)<span class="r7 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="6b23b38eb72b93f0" href="../R/6b23b38eb72b93f0.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r9 rd" class="r9 r">value</span>, <b>out int</b> <span id="r10 rd" class="r10 r">i</span>)
        {
            <b>if</b> (<span class="r9 r">value</span> &lt; <b>int</b>.<span class="i">MinValue</span> || <span class="r9 r">value</span> &gt; <b>int</b>.<span class="i">MaxValue</span>)
            {
                <span class="r10 r">i</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r10 r">i</span> = (<b>int</b>)<span class="r9 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="a3991df57b5c7dbe" href="../R/a3991df57b5c7dbe.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r11 rd" class="r11 r">value</span>, <b>out uint</b> <span id="r12 rd" class="r12 r">u</span>)
        {
            <b>if</b> (<span class="r11 r">value</span> &lt; <b>uint</b>.<span class="i">MinValue</span> || <span class="r11 r">value</span> &gt; <b>uint</b>.<span class="i">MaxValue</span>)
            {
                <span class="r12 r">u</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r12 r">u</span> = (<b>uint</b>)<span class="r11 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="602fcab7e62015c7" href="../R/602fcab7e62015c7.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r13 rd" class="r13 r">value</span>, <b>out long</b> <span id="r14 rd" class="r14 r">l</span>)
        {
            <b>if</b> (<span class="r13 r">value</span> &lt; <b>long</b>.<span class="i">MinValue</span> || <span class="r13 r">value</span> &gt; <b>long</b>.<span class="i">MaxValue</span>)
            {
                <span class="r14 r">l</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r14 r">l</span> = (<b>long</b>)<span class="r13 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="7655988a5f31128a" href="../R/7655988a5f31128a.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r15 rd" class="r15 r">value</span>, <b>out ulong</b> <span id="r16 rd" class="r16 r">ul</span>)
        {
            <b>if</b> (<span class="r15 r">value</span> &lt; <b>ulong</b>.<span class="i">MinValue</span> || <span class="r15 r">value</span> &gt; <b>ulong</b>.<span class="i">MaxValue</span>)
            {
                <span class="r16 r">ul</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r16 r">ul</span> = (<b>ulong</b>)<span class="r15 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="acaa7e986dd8380a" href="../R/acaa7e986dd8380a.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r17 rd" class="r17 r">value</span>, <b>out decimal</b> <span id="r18 rd" class="r18 r">dm</span>)
        {
            <b>if</b> (<span class="r17 r">value</span> &lt; (<span class="i">BigInteger</span>)<b>decimal</b>.<span class="i">MinValue</span> || (<span class="i">BigInteger</span>)<b>decimal</b>.<span class="i">MaxValue</span> &lt; <span class="r17 r">value</span>)
            {
                <span class="r18 r">dm</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r18 r">dm</span> = (<b>decimal</b>)<span class="r17 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static bool</b> <a id="1266456bbae7e4dc" href="../R/1266456bbae7e4dc.html" target="n" data-glyph="74,1" class="i method">TryCast</a>(<span class="i">BigInteger</span> <span id="r19 rd" class="r19 r">value</span>, <b>out double</b> <span id="r20 rd" class="r20 r">db</span>)
        {
            <b>if</b> (<span class="r19 r">value</span> &lt; (<span class="i">BigInteger</span>)<b>double</b>.<span class="i">MinValue</span> || (<span class="i">BigInteger</span>)<b>double</b>.<span class="i">MaxValue</span> &lt; <span class="r19 r">value</span>)
            {
                <span class="r20 r">db</span> = 0;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r20 r">db</span> = (<b>double</b>)<span class="r19 r">value</span>;
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parses a given string or ReadOnlySpan</span><span class="c">&amp;lt;</span><span class="c">char</span><span class="c">&amp;gt;</span><span class="c"> to calculate its value as a binary number.</span>
        <span class="c">///</span><span class="c"> Assumes input has already been sanitized and only contains zeroes (0) or ones (1).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">digits</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Span or string of binary digits. Assumes all digits are either 1 or 0.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">unsigned</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Whether to treat the number as unsigned. When false, respects established conventions</span>
        <span class="c">///</span><span class="c"> with sign bits for certain input string lengths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Returns the value of the binary string as a BigInteger.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">BigInteger</span> <a id="1afcb4099c395f31" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ParseBinary</a>(<span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r21 rd" class="r21 r">digits</span>, <b>bool</b> <span id="r22 rd" class="r22 r">unsigned</span>)
        {
            <b>if</b> (!<span class="r22 r">unsigned</span>)
            {
                <b>if</b> (<span class="r21 r">digits</span>[0] == <span class="s">&#39;0&#39;</span>)
                {
                    <span class="r22 r">unsigned</span> = <b>true</b>;
                }
                <b>else</b>
                {
                    <b>switch</b> (<span class="r21 r">digits</span>.<span class="i">Length</span>)
                    {
                        <span class="c">// Only accept sign bits at these lengths:</span>
                        <b>case</b> 8: <span class="c">// byte</span>
                        <b>case</b> 16: <span class="c">// short</span>
                        <b>case</b> 32: <span class="c">// int</span>
                        <b>case</b> 64: <span class="c">// long</span>
                        <b>case</b> 96: <span class="c">// decimal</span>
                        <b>case</b> <b>int</b> <span id="r23 rd" class="r23 r">n</span> <b>when</b> <span class="r23 r">n</span> &gt;= 128: <span class="c">// BigInteger</span>
                            <b>break</b>;
                        <b>default</b>:
                            <span class="c">// If we do not flag these as unsigned, bigint assumes a sign bit for any (8 * n) string length</span>
                            <span class="r22 r">unsigned</span> = <b>true</b>;
                            <b>break</b>;
                    }
                }
            }
 
            <span class="c">// Only use heap allocation for very large numbers</span>
            <b>const int</b> <span id="r24 rd" class="r24 r">MaxStackAllocation</span> = 512;
 
            <span class="c">// Calculate number of 8-bit bytes needed to hold the input,  rounded up to next whole number.</span>
            <b>int</b> <span id="r25 rd" class="r25 r">outputByteCount</span> = (<span class="r21 r">digits</span>.<span class="i">Length</span> + 7) / 8;
            <span class="i">Span</span>&lt;<b>byte</b>&gt; <span id="r26 rd" class="r26 r">outputBytes</span> = <span class="r25 r">outputByteCount</span> &lt;= <span class="r24 r">MaxStackAllocation</span> ? <b>stackalloc byte</b>[<span class="r25 r">outputByteCount</span>] : <b>new</b> <b>byte</b>[<span class="r25 r">outputByteCount</span>];
            <b>int</b> <span id="r27 rd" class="r27 r">outputByteIndex</span> = <span class="r26 r">outputBytes</span>.<span class="i">Length</span> - 1;
 
            <span class="c">// We need to be prepared for any partial leading bytes, (e.g., 010|00000011|00101100), or cases</span>
            <span class="c">// where we only have less than 8 bits to work with from the beginning.</span>
            <span class="c">//</span>
            <span class="c">// Walk bytes right to left, stepping one whole byte at a time (if there are any whole bytes).</span>
            <b>int</b> <span id="r28 rd" class="r28 r">byteWalker</span>;
            <b>for</b> (<span class="r28 r">byteWalker</span> = <span class="r21 r">digits</span>.<span class="i">Length</span> - 1; <span class="r28 r">byteWalker</span> &gt;= 7; <span class="r28 r">byteWalker</span> -= 8)
            {
                <span class="c">// Use bit shifts and binary-or to sum the values in each byte.  These calculations will</span>
                <span class="c">// create values higher than a single byte, but the higher bits will be stripped out when cast</span>
                <span class="c">// to byte.</span>
                <span class="c">//</span>
                <span class="c">// The low bits are added in separately to allow us to strip the higher &#39;noise&#39; bits before we</span>
                <span class="c">// sum the values using binary-or.</span>
                <span class="c">//</span>
                <span class="c">// Simplified representation of logic:     (byte)( (7)|(6)|(5)|(4) ) | ( ( (3)|(2)|(1)|(0) ) &amp; 0b1111 )</span>
                <span class="c">//</span>
                <span class="c">// N.B.: This code has been tested against a straight for loop iterating through the byte, and in no</span>
                <span class="c">// circumstance was it faster or more effective than this unrolled version.</span>
                <span class="r26 r">outputBytes</span>[<span class="r27 r">outputByteIndex</span>--] =
                    (<b>byte</b>)(
                        ((<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span> - 7] &lt;&lt; 7)
                        | (<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span> - 6] &lt;&lt; 6)
                        | (<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span> - 5] &lt;&lt; 5)
                        | (<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span> - 4] &lt;&lt; 4)
                        )
                    | (
                        ((<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span> - 3] &lt;&lt; 3)
                        | (<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span> - 2] &lt;&lt; 2)
                        | (<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span> - 1] &lt;&lt; 1)
                        | (<span class="r21 r">digits</span>[<span class="r28 r">byteWalker</span>])
                        ) &amp; 0b1111
                      )
                    );
            }
 
            <span class="c">// With complete bytes parsed, byteWalker is either at the partial byte start index, or at -1</span>
            <b>if</b> (<span class="r28 r">byteWalker</span> &gt;= 0)
            {
                <b>int</b> <span id="r29 rd" class="r29 r">currentByteValue</span> = 0;
                <b>for</b> (<b>int</b> <span id="r30 rd" class="r30 r">i</span> = 0; <span class="r30 r">i</span> &lt;= <span class="r28 r">byteWalker</span>; <span class="r30 r">i</span>++)
                {
                    <span class="r29 r">currentByteValue</span> = (<span class="r29 r">currentByteValue</span> &lt;&lt; 1) | (<span class="r21 r">digits</span>[<span class="r30 r">i</span>] - <span class="s">&#39;0&#39;</span>);
                }
 
                <span class="r26 r">outputBytes</span>[<span class="r27 r">outputByteIndex</span>] = (<b>byte</b>)<span class="r29 r">currentByteValue</span>;
            }
 
            <b>return</b> <b>new</b> <span class="i">BigInteger</span>(<span class="r26 r">outputBytes</span>, <span class="i">isUnsigned</span>: <span class="r22 r">unsigned</span>, <span class="i">isBigEndian</span>: <b>true</b>);
        }
 
        <span class="c">// From System.Web.Util.HashCodeCombiner</span>
        <b>internal static int</b> <a id="104f5bed6ef7880b" href="../R/104f5bed6ef7880b.html" target="n" data-glyph="74,1" class="i method">CombineHashCodes</a>(<b>int</b> <span id="r31 rd" class="r31 r">h1</span>, <b>int</b> <span id="r32 rd" class="r32 r">h2</span>)
        {
            <b>return</b> <b>unchecked</b>(((<span class="r31 r">h1</span> &lt;&lt; 5) + <span class="r31 r">h1</span>) ^ <span class="r32 r">h2</span>);
        }
 
        <b>internal static int</b> <a id="f9ceabed328d9d10" href="../R/f9ceabed328d9d10.html" target="n" data-glyph="74,1" class="i method">CombineHashCodes</a>(<b>int</b> <span id="r33 rd" class="r33 r">h1</span>, <b>int</b> <span id="r34 rd" class="r34 r">h2</span>, <b>int</b> <span id="r35 rd" class="r35 r">h3</span>)
        {
            <b>return</b> <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<span class="r33 r">h1</span>, <span class="r34 r">h2</span>), <span class="r35 r">h3</span>);
        }
 
        <b>internal static int</b> <a id="03ba3aae0626e6f8" href="../R/03ba3aae0626e6f8.html" target="n" data-glyph="74,1" class="i method">CombineHashCodes</a>(<b>int</b> <span id="r36 rd" class="r36 r">h1</span>, <b>int</b> <span id="r37 rd" class="r37 r">h2</span>, <b>int</b> <span id="r38 rd" class="r38 r">h3</span>, <b>int</b> <span id="r39 rd" class="r39 r">h4</span>)
        {
            <b>return</b> <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<span class="r36 r">h1</span>, <span class="r37 r">h2</span>), <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<span class="r38 r">h3</span>, <span class="r39 r">h4</span>));
        }
 
        <b>internal static int</b> <a id="ee2ae228aab8c96e" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CombineHashCodes</a>(<b>int</b> <span id="r40 rd" class="r40 r">h1</span>, <b>int</b> <span id="r41 rd" class="r41 r">h2</span>, <b>int</b> <span id="r42 rd" class="r42 r">h3</span>, <b>int</b> <span id="r43 rd" class="r43 r">h4</span>, <b>int</b> <span id="r44 rd" class="r44 r">h5</span>)
        {
            <b>return</b> <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<a href="#03ba3aae0626e6f8" class="i method">CombineHashCodes</a>(<span class="r40 r">h1</span>, <span class="r41 r">h2</span>, <span class="r42 r">h3</span>, <span class="r43 r">h4</span>), <span class="r44 r">h5</span>);
        }
 
        <b>internal static int</b> <a id="dd779d77343cf5ab" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CombineHashCodes</a>(<b>int</b> <span id="r45 rd" class="r45 r">h1</span>, <b>int</b> <span id="r46 rd" class="r46 r">h2</span>, <b>int</b> <span id="r47 rd" class="r47 r">h3</span>, <b>int</b> <span id="r48 rd" class="r48 r">h4</span>, <b>int</b> <span id="r49 rd" class="r49 r">h5</span>, <b>int</b> <span id="r50 rd" class="r50 r">h6</span>)
        {
            <b>return</b> <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<a href="#03ba3aae0626e6f8" class="i method">CombineHashCodes</a>(<span class="r45 r">h1</span>, <span class="r46 r">h2</span>, <span class="r47 r">h3</span>, <span class="r48 r">h4</span>), <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<span class="r49 r">h5</span>, <span class="r50 r">h6</span>));
        }
 
        <b>internal static int</b> <a id="ed3b89e0115e25a7" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CombineHashCodes</a>(<b>int</b> <span id="r51 rd" class="r51 r">h1</span>, <b>int</b> <span id="r52 rd" class="r52 r">h2</span>, <b>int</b> <span id="r53 rd" class="r53 r">h3</span>, <b>int</b> <span id="r54 rd" class="r54 r">h4</span>, <b>int</b> <span id="r55 rd" class="r55 r">h5</span>, <b>int</b> <span id="r56 rd" class="r56 r">h6</span>, <b>int</b> <span id="r57 rd" class="r57 r">h7</span>)
        {
            <b>return</b> <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<a href="#03ba3aae0626e6f8" class="i method">CombineHashCodes</a>(<span class="r51 r">h1</span>, <span class="r52 r">h2</span>, <span class="r53 r">h3</span>, <span class="r54 r">h4</span>), <a href="#f9ceabed328d9d10" class="i method">CombineHashCodes</a>(<span class="r55 r">h5</span>, <span class="r56 r">h6</span>, <span class="r57 r">h7</span>));
        }
 
        <b>internal static int</b> <a id="a2ad7e0c8070721e" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CombineHashCodes</a>(<b>int</b> <span id="r58 rd" class="r58 r">h1</span>, <b>int</b> <span id="r59 rd" class="r59 r">h2</span>, <b>int</b> <span id="r60 rd" class="r60 r">h3</span>, <b>int</b> <span id="r61 rd" class="r61 r">h4</span>, <b>int</b> <span id="r62 rd" class="r62 r">h5</span>, <b>int</b> <span id="r63 rd" class="r63 r">h6</span>, <b>int</b> <span id="r64 rd" class="r64 r">h7</span>, <b>int</b> <span id="r65 rd" class="r65 r">h8</span>)
        {
            <b>return</b> <a href="#104f5bed6ef7880b" class="i method">CombineHashCodes</a>(<a href="#03ba3aae0626e6f8" class="i method">CombineHashCodes</a>(<span class="r58 r">h1</span>, <span class="r59 r">h2</span>, <span class="r60 r">h3</span>, <span class="r61 r">h4</span>), <a href="#03ba3aae0626e6f8" class="i method">CombineHashCodes</a>(<span class="r62 r">h5</span>, <span class="r63 r">h6</span>, <span class="r64 r">h7</span>, <span class="r65 r">h8</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Allowed PowerShell Editions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static readonly string</b>[] <a id="6bc43a213c3de3ea" href="../R/6bc43a213c3de3ea.html" target="n" data-glyph="44,1" class="i field">AllowedEditionValues</a> = { <span class="s">&quot;Desktop&quot;</span>, <span class="s">&quot;Core&quot;</span> };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper fn to check byte[] arg for null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">arg</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> arg to check </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">argName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> name of the arg </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c"> Does not return a value.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="870db537e3dbf553" href="../R/870db537e3dbf553.html" target="n" data-glyph="74,1" class="i method">CheckKeyArg</a>(<b>byte</b>[] <span id="r66 rd" class="r66 r">arg</span>, <b>string</b> <span id="r67 rd" class="r67 r">argName</span>)
        {
            <b>if</b> (<span class="r66 r">arg</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="r67 r">argName</span>);
            }
            <span class="c">//</span>
            <span class="c">// we use AES algorithm which supports key</span>
            <span class="c">// lengths of 128, 192 and 256 bits.</span>
            <span class="c">// We throw ArgumentException if the key is</span>
            <span class="c">// of any other length</span>
            <span class="c">//</span>
            <b>else</b> <b>if</b> (!((<span class="r66 r">arg</span>.<span class="i">Length</span> == 16) ||
                       (<span class="r66 r">arg</span>.<span class="i">Length</span> == 24) ||
                       (<span class="r66 r">arg</span>.<span class="i">Length</span> == 32)))
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<span class="r67 r">argName</span>, <span class="i">Serialization</span>.<span class="i">InvalidKeyLength</span>, <span class="r67 r">argName</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper fn to check arg for empty or null.</span>
        <span class="c">///</span><span class="c"> Throws ArgumentNullException on either condition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">arg</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> arg to check </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">argName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> name of the arg </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c"> Does not return a value.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="f42507df2adff9b7" href="../R/f42507df2adff9b7.html" target="n" data-glyph="74,1" class="i method">CheckArgForNullOrEmpty</a>(<b>string</b> <span id="r68 rd" class="r68 r">arg</span>, <b>string</b> <span id="r69 rd" class="r69 r">argName</span>)
        {
            <b>if</b> (<span class="r68 r">arg</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="r69 r">argName</span>);
            }
            <b>else</b> <b>if</b> (<span class="r68 r">arg</span>.<span class="i">Length</span> == 0)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fed5f40dc0075d41" class="i method">NewArgumentException</a>(<span class="r69 r">argName</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper fn to check arg for null.</span>
        <span class="c">///</span><span class="c"> Throws ArgumentNullException on either condition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">arg</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> arg to check </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r71 r">argName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> name of the arg </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c"> Does not return a value.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="153698bbdd7dddf8" href="../R/153698bbdd7dddf8.html" target="n" data-glyph="74,1" class="i method">CheckArgForNull</a>(<b>object</b> <span id="r70 rd" class="r70 r">arg</span>, <b>string</b> <span id="r71 rd" class="r71 r">argName</span>)
        {
            <b>if</b> (<span class="r70 r">arg</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="r71 r">argName</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper fn to check arg for null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">arg</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> arg to check </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r73 r">argName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> name of the arg </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c"> Does not return a value.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="59c662bfbc2797c0" href="../R/59c662bfbc2797c0.html" target="n" data-glyph="74,1" class="i method">CheckSecureStringArg</a>(<span class="i">SecureString</span> <span id="r72 rd" class="r72 r">arg</span>, <b>string</b> <span id="r73 rd" class="r73 r">argName</span>)
        {
            <b>if</b> (<span class="r72 r">arg</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="r73 r">argName</span>);
            }
        }
 
        [<span class="i">ArchitectureSensitive</span>]
        <b>internal static string</b> <a id="9614046a009e0ac0" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetStringFromSecureString</a>(<span class="i">SecureString</span> <span id="r74 rd" class="r74 r">ss</span>)
        {
            <span class="i">IntPtr</span> <span id="r75 rd" class="r75 r">p</span> = <span class="i">IntPtr</span>.<span class="i">Zero</span>;
            <b>string</b> <span id="r76 rd" class="r76 r">s</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="r75 r">p</span> = <span class="i">Marshal</span>.<span class="i">SecureStringToCoTaskMemUnicode</span>(<span class="r74 r">ss</span>);
                <span class="r76 r">s</span> = <span class="i">Marshal</span>.<span class="i">PtrToStringUni</span>(<span class="r75 r">p</span>);
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r75 r">p</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
                {
                    <span class="i">Marshal</span>.<span class="i">ZeroFreeCoTaskMemUnicode</span>(<span class="r75 r">p</span>);
                }
            }
 
            <b>return</b> <span class="r76 r">s</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets TypeTable by querying the ExecutionContext stored in</span>
        <span class="c">///</span><span class="c"> Thread-Local-Storage. This will return null if ExecutionContext</span>
        <span class="c">///</span><span class="c"> is not available.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="t t">TypeTable</a> <a id="7c94e15c53ac5a07" href="../R/7c94e15c53ac5a07.html" target="n" data-glyph="74,1" class="i method">GetTypeTableFromExecutionContextTLS</a>()
        {
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r77 rd" class="r77 r">ecFromTLS</span> = <span class="i n">Runspaces</span>.<a href="hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <b>if</b> (<span class="r77 r">ecFromTLS</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r77 r">ecFromTLS</span>.<a href="ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>;
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <b>private static string</b> <a id="4ada12ccacda8f2e" href="../R/4ada12ccacda8f2e.html" target="n" data-glyph="46,1" class="i field">s_pshome</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the application base path of the shell from registry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="da5fc4703d8a5e1a" href="../R/da5fc4703d8a5e1a.html" target="n" data-glyph="74,1" class="i method">GetApplicationBaseFromRegistry</a>(<b>string</b> <span id="r78 rd" class="r78 r">shellId</span>)
        {
            <b>bool</b> <span id="r79 rd" class="r79 r">wantPsHome</span> = (<b>object</b>)<span class="r78 r">shellId</span> == (<b>object</b>)<a href="#afe3ed92dba2b2b0" class="i field">DefaultPowerShellShellID</a>;
            <b>if</b> (<span class="r79 r">wantPsHome</span> &amp;&amp; <a href="#4ada12ccacda8f2e" class="i field">s_pshome</a> != <b>null</b>)
                <b>return</b> <a href="#4ada12ccacda8f2e" class="i field">s_pshome</a>;
 
            <b>string</b> <span id="r80 rd" class="r80 r">engineKeyPath</span> = <a href="../singleshell/config/MshSnapinInfo.cs.html#fefd5b5c5e75f6ff" class="t t">RegistryStrings</a>.<a href="../singleshell/config/MshSnapinInfo.cs.html#930717e253bcfc29" class="i field">MonadRootKeyPath</a> + <span class="s">&quot;\\&quot;</span> +
                <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#3534d982fe0e3a8c" class="i property">RegistryVersionKey</a> + <span class="s">&quot;\\&quot;</span> + <a href="../singleshell/config/MshSnapinInfo.cs.html#fefd5b5c5e75f6ff" class="t t">RegistryStrings</a>.<a href="../singleshell/config/MshSnapinInfo.cs.html#cc0f8515a11bdfdc" class="i field">MonadEngineKey</a>;
 
            <b>using</b> (<span class="i">RegistryKey</span> <span id="r81 rd" class="r81 r">engineKey</span> = <span class="i">Registry</span>.<span class="i">LocalMachine</span>.<span class="i">OpenSubKey</span>(<span class="r80 r">engineKeyPath</span>))
            {
                <b>if</b> (<span class="r81 r">engineKey</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r82 rd" class="r82 r">result</span> = <span class="r81 r">engineKey</span>.<span class="i">GetValue</span>(<a href="../singleshell/config/MshSnapinInfo.cs.html#fefd5b5c5e75f6ff" class="t t">RegistryStrings</a>.<a href="../singleshell/config/MshSnapinInfo.cs.html#95527460585fa99e" class="i field">MonadEngine_ApplicationBase</a>) <b>as string</b>;
                    <span class="r82 r">result</span> = <span class="i">Environment</span>.<span class="i">ExpandEnvironmentVariables</span>(<span class="r82 r">result</span>);
                    <b>if</b> (<span class="r79 r">wantPsHome</span>)
                        <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#4ada12ccacda8f2e" class="i field">s_pshome</a>, <b>null</b>, <span class="r82 r">result</span>);
 
                    <b>return</b> <span class="r82 r">result</span>;
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private static string</b> <a id="d1bf5604b2b39901" href="../R/d1bf5604b2b39901.html" target="n" data-glyph="46,1" class="i field">s_windowsPowerShellVersion</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the Windows PowerShell version from registry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> String of Windows PowerShell version from registry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="e409259aca008667" href="../R/e409259aca008667.html" target="n" data-glyph="74,1" class="i method">GetWindowsPowerShellVersionFromRegistry</a>()
        {
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="#cc79ccfaa36b4962" class="i field">TestWindowsPowerShellVersionString</a>))
            {
                <b>return</b> <a href="#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="#cc79ccfaa36b4962" class="i field">TestWindowsPowerShellVersionString</a>;
            }
 
            <b>if</b> (<a href="#d1bf5604b2b39901" class="i field">s_windowsPowerShellVersion</a> != <b>null</b>)
            {
                <b>return</b> <a href="#d1bf5604b2b39901" class="i field">s_windowsPowerShellVersion</a>;
            }
 
            <b>string</b> <span id="r83 rd" class="r83 r">engineKeyPath</span> = <a href="../singleshell/config/MshSnapinInfo.cs.html#fefd5b5c5e75f6ff" class="t t">RegistryStrings</a>.<a href="../singleshell/config/MshSnapinInfo.cs.html#930717e253bcfc29" class="i field">MonadRootKeyPath</a> + <span class="s">&quot;\\&quot;</span> +
                <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#3534d982fe0e3a8c" class="i property">RegistryVersionKey</a> + <span class="s">&quot;\\&quot;</span> + <a href="../singleshell/config/MshSnapinInfo.cs.html#fefd5b5c5e75f6ff" class="t t">RegistryStrings</a>.<a href="../singleshell/config/MshSnapinInfo.cs.html#cc0f8515a11bdfdc" class="i field">MonadEngineKey</a>;
 
            <b>using</b> (<span class="i">RegistryKey</span> <span id="r84 rd" class="r84 r">engineKey</span> = <span class="i">Registry</span>.<span class="i">LocalMachine</span>.<span class="i">OpenSubKey</span>(<span class="r83 r">engineKeyPath</span>))
            {
                <b>if</b> (<span class="r84 r">engineKey</span> != <b>null</b>)
                {
                    <a href="#d1bf5604b2b39901" class="i field">s_windowsPowerShellVersion</a> = <span class="r84 r">engineKey</span>.<span class="i">GetValue</span>(<a href="../singleshell/config/MshSnapinInfo.cs.html#fefd5b5c5e75f6ff" class="t t">RegistryStrings</a>.<a href="../singleshell/config/MshSnapinInfo.cs.html#c31af753d2bfb9a0" class="i field">MonadEngine_MonadVersion</a>) <b>as string</b>;
                    <b>return</b> <a href="#d1bf5604b2b39901" class="i field">s_windowsPowerShellVersion</a>;
                }
            }
 
            <b>return</b> <b>string</b>.<span class="i">Empty</span>;
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <b>internal static string</b> <a id="c677cc800603f8f5" href="../R/c677cc800603f8f5.html" target="n" data-glyph="104,1" class="i property">DefaultPowerShellAppBase</a> =&gt; <a href="#78d6f695d9d21e06" class="i method">GetApplicationBase</a>(<a href="#afe3ed92dba2b2b0" class="i field">DefaultPowerShellShellID</a>);
 
        <b>internal static string</b> <a id="78d6f695d9d21e06" href="../R/78d6f695d9d21e06.html" target="n" data-glyph="74,1" class="i method">GetApplicationBase</a>(<b>string</b> <span id="r85 rd" class="r85 r">shellId</span>)
        {
            <span class="c">// Use the location of SMA.dll as the application base.</span>
            <span class="i">Assembly</span> <span id="r86 rd" class="r86 r">assembly</span> = <b>typeof</b>(<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>).<span class="i">Assembly</span>;
            <b>return</b> <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r86 r">assembly</span>.<span class="i">Location</span>);
        }
 
        <b>private static string</b>[] <a id="fbb64aea1cfc82bf" href="../R/fbb64aea1cfc82bf.html" target="n" data-glyph="46,1" class="i field">s_productFolderDirectories</a>;
 
        <b>private static string</b>[] <a id="ad0d4b0e329598a5" href="../R/ad0d4b0e329598a5.html" target="n" data-glyph="76,1" class="i method">GetProductFolderDirectories</a>()
        {
            <b>if</b> (<a href="#fbb64aea1cfc82bf" class="i field">s_productFolderDirectories</a> == <b>null</b>)
            {
                <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r87 rd" class="r87 r">baseDirectories</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
                <span class="c">// Retrieve the application base from the registry</span>
                <b>string</b> <span id="r88 rd" class="r88 r">appBase</span> = <a href="#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>;
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r88 r">appBase</span>))
                {
                    <span class="r87 r">baseDirectories</span>.<span class="i">Add</span>(<span class="r88 r">appBase</span>);
                }
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                <span class="c">// Now add the two variations of System32</span>
                <span class="r87 r">baseDirectories</span>.<span class="i">Add</span>(<span class="i">Environment</span>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">System</span>));
                <b>string</b> <span id="r89 rd" class="r89 r">systemX86</span> = <span class="i">Environment</span>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">SystemX86</span>);
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r89 r">systemX86</span>))
                {
                    <span class="r87 r">baseDirectories</span>.<span class="i">Add</span>(<span class="r89 r">systemX86</span>);
                }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#fbb64aea1cfc82bf" class="i field">s_productFolderDirectories</a>, <span class="r87 r">baseDirectories</span>.<span class="i">ToArray</span>(), <b>null</b>);
            }
 
            <b>return</b> <a href="#fbb64aea1cfc82bf" class="i field">s_productFolderDirectories</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the filePath represents a file under product folder</span>
        <span class="c">///</span><span class="c"> ie., PowerShell ApplicationBase or $env:windir\system32 or</span>
        <span class="c">///</span><span class="c"> $env:windir\syswow64.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> true: if the filePath is under product folder</span>
        <span class="c">///</span><span class="c"> false: otherwise</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="5824ed94fc599925" href="../R/5824ed94fc599925.html" target="n" data-glyph="74,1" class="i method">IsUnderProductFolder</a>(<b>string</b> <span id="r90 rd" class="r90 r">filePath</span>)
        {
            <span class="i">FileInfo</span> <span id="r91 rd" class="r91 r">fileInfo</span> = <b>new</b> <span class="i">FileInfo</span>(<span class="r90 r">filePath</span>);
            <b>string</b> <span id="r92 rd" class="r92 r">filename</span> = <span class="r91 r">fileInfo</span>.<span class="i">FullName</span>;
 
            <b>var</b> <span id="r93 rd" class="r93 r">productFolderDirectories</span> = <a href="#ad0d4b0e329598a5" class="i method">GetProductFolderDirectories</a>();
            <b>for</b> (<b>int</b> <span id="r94 rd" class="r94 r">i</span> = 0; <span class="r94 r">i</span> &lt; <span class="r93 r">productFolderDirectories</span>.<span class="i">Length</span>; <span class="r94 r">i</span>++)
            {
                <b>string</b> <span id="r95 rd" class="r95 r">applicationBase</span> = <span class="r93 r">productFolderDirectories</span>[<span class="r94 r">i</span>];
                <b>if</b> (<span class="r92 r">filename</span>.<span class="i">StartsWith</span>(<span class="r95 r">applicationBase</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the current process is using WOW.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="5f8a1d321a085e3e" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsRunningFromSysWOW64</a>()
        {
            <b>return</b> <a href="#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>.<span class="i">Contains</span>(<span class="s">&quot;SysWOW64&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if host machine is WinPE.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="9aecc212ae3f42c7" href="../R/9aecc212ae3f42c7.html" target="n" data-glyph="74,1" class="i method">IsWinPEHost</a>()
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <span class="i">RegistryKey</span> <span id="r96 rd" class="r96 r">winPEKey</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="c">// The existence of the following registry confirms that the host machine is a WinPE</span>
                <span class="c">// HKLM\System\CurrentControlSet\Control\MiniNT</span>
                <span class="r96 r">winPEKey</span> = <span class="i">Registry</span>.<span class="i">LocalMachine</span>.<span class="i">OpenSubKey</span>(<span class="s">@&quot;System\CurrentControlSet\Control\MiniNT&quot;</span>);
 
                <b>return</b> <span class="r96 r">winPEKey</span> != <b>null</b>;
            }
            <b>catch</b> (<span class="i">ArgumentException</span>) { }
            <b>catch</b> (<span class="i">SecurityException</span>) { }
            <b>catch</b> (<span class="i">ObjectDisposedException</span>) { }
            <b>finally</b>
            {
                <b>if</b> (<span class="r96 r">winPEKey</span> != <b>null</b>)
                {
                    <span class="r96 r">winPEKey</span>.<span class="i">Dispose</span>();
                }
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Versioning related methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns current major version of monad ( that is running ) in a string</span>
        <span class="c">///</span><span class="c"> format.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">String.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cannot return a Version object as minor number is a requirement for</span>
        <span class="c">///</span><span class="c"> version object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="0feba1ef9bf5a9cc" href="../R/0feba1ef9bf5a9cc.html" target="n" data-glyph="74,1" class="i method">GetCurrentMajorVersion</a>()
        {
            <b>return</b> <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#ad63365ac7690eeb" class="i property">PSVersion</a>.<span class="i">Major</span>.<span class="i">ToString</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Coverts a string to version format.</span>
        <span class="c">///</span><span class="c"> If the string is of the format x (ie., no dots), then &quot;.0&quot; is appended</span>
        <span class="c">///</span><span class="c"> to the string.</span>
        <span class="c">///</span><span class="c"> Version.TryParse will be used to convert the string to a Version</span>
        <span class="c">///</span><span class="c"> object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">versionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">String representing version.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A Version Object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Version</span> <a id="12d99513c4a52180" href="../R/12d99513c4a52180.html" target="n" data-glyph="74,1" class="i method">StringToVersion</a>(<b>string</b> <span id="r97 rd" class="r97 r">versionString</span>)
        {
            <span class="c">// max of 1 dot is allowed in version</span>
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r97 r">versionString</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>int</b> <span id="r98 rd" class="r98 r">dotCount</span> = 0;
            <b>foreach</b> (<b>char</b> <span id="r99 rd" class="r99 r">c</span> <b>in</b> <span class="r97 r">versionString</span>)
            {
                <b>if</b> (<span class="r99 r">c</span> == <span class="s">&#39;.&#39;</span>)
                {
                    <span class="r98 r">dotCount</span>++;
                    <b>if</b> (<span class="r98 r">dotCount</span> &gt; 1)
                    {
                        <b>break</b>;
                    }
                }
            }
            <span class="c">// Version.TryParse expects the string to be in format: major.minor[.build[.revision]]</span>
            <b>if</b> (<span class="r98 r">dotCount</span> == 0)
            {
                <span class="r97 r">versionString</span> += <span class="s">&quot;.0&quot;</span>;
            }
 
            <span class="i">Version</span> <span id="r100 rd" class="r100 r">result</span> = <b>null</b>;
            <b>if</b> (<span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r97 r">versionString</span>, <b>out</b> <span class="r100 r">result</span>))
            {
                <b>return</b> <span class="r100 r">result</span>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks whether current monad session supports version specified</span>
        <span class="c">///</span><span class="c"> by ver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">ver</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Version to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if supported, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="8dc07d775679d6d7" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsPSVersionSupported</a>(<b>string</b> <span id="r101 rd" class="r101 r">ver</span>)
        {
            <span class="c">// Convert version to supported format ie., x.x</span>
            <span class="i">Version</span> <span id="r102 rd" class="r102 r">inputVersion</span> = <a href="#12d99513c4a52180" class="i method">StringToVersion</a>(<span class="r101 r">ver</span>);
            <b>return</b> <a href="#80e75c94b0c6f4d5" class="i method">IsPSVersionSupported</a>(<span class="r102 r">inputVersion</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks whether current monad session supports version specified</span>
        <span class="c">///</span><span class="c"> by checkVersion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">checkVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Version to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if supported, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="80e75c94b0c6f4d5" href="../R/80e75c94b0c6f4d5.html" target="n" data-glyph="74,1" class="i method">IsPSVersionSupported</a>(<span class="i">Version</span> <span id="r103 rd" class="r103 r">checkVersion</span>)
        {
            <b>if</b> (<span class="r103 r">checkVersion</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<span class="i">Version</span> <span id="r104 rd" class="r104 r">compatibleVersion</span> <b>in</b> <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#cf4a92925d79db6b" class="i property">PSCompatibleVersions</a>)
            {
                <b>if</b> (<span class="r103 r">checkVersion</span>.<span class="i">Major</span> == <span class="r104 r">compatibleVersion</span>.<span class="i">Major</span> &amp;&amp; <span class="r103 r">checkVersion</span>.<span class="i">Minor</span> &lt;= <span class="r104 r">compatibleVersion</span>.<span class="i">Minor</span>)
                    <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks whether current PowerShell session supports edition specified</span>
        <span class="c">///</span><span class="c"> by checkEdition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">checkEdition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Edition to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if supported, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="7a11eb38d2a0cb58" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsPSEditionSupported</a>(<b>string</b> <span id="r105 rd" class="r105 r">checkEdition</span>)
        {
            <b>return</b> <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#6576f52d703d79c5" class="i property">PSEdition</a>.<span class="i">Equals</span>(<span class="r105 r">checkEdition</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check whether the current PowerShell session supports any of the specified editions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">editions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The PowerShell editions to check compatibility with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the edition is supported by this runtime, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="3e3c3de5e69bfa72" href="../R/3e3c3de5e69bfa72.html" target="n" data-glyph="74,1" class="i method">IsPSEditionSupported</a>(<span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r106 rd" class="r106 r">editions</span>)
        {
            <b>string</b> <span id="r107 rd" class="r107 r">currentPSEdition</span> = <a href="PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="PSVersionInfo.cs.html#6576f52d703d79c5" class="i property">PSEdition</a>;
            <b>foreach</b> (<b>string</b> <span id="r108 rd" class="r108 r">edition</span> <b>in</b> <span class="r106 r">editions</span>)
            {
                <b>if</b> (<span class="r107 r">currentPSEdition</span>.<span class="i">Equals</span>(<span class="r108 r">edition</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks whether the specified edition value is allowed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">editionValue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Edition value to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if allowed, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="86d8f503fbbc2c67" href="../R/86d8f503fbbc2c67.html" target="n" data-glyph="74,1" class="i method">IsValidPSEditionValue</a>(<b>string</b> <span id="r109 rd" class="r109 r">editionValue</span>)
        {
            <b>return</b> <a href="#6bc43a213c3de3ea" class="i field">AllowedEditionValues</a>.<span class="i">Contains</span>(<span class="r109 r">editionValue</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> String representing the Default shellID.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const string</b> <a id="afe3ed92dba2b2b0" href="../R/afe3ed92dba2b2b0.html" target="n" data-glyph="8,1" class="i field">DefaultPowerShellShellID</a> = <span class="s">&quot;Microsoft.PowerShell&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is used to construct the profile path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const string</b> <a id="22e35e156d76df77" href="../R/22e35e156d76df77.html" target="n" data-glyph="8,1" class="i field">ProductNameForDirectory</a> = <span class="s">&quot;PowerShell&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> WSL introduces a new filesystem path to access the Linux filesystem from Windows, like &#39;\\wsl$\ubuntu&#39;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const string</b> <a id="27ced2dd003c2668" href="../R/27ced2dd003c2668.html" target="n" data-glyph="8,1" class="i field">WslRootPath</a> = <span class="s">@&quot;\\wsl$&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The subdirectory of module paths</span>
        <span class="c">///</span><span class="c"> e.g. ~\Documents\WindowsPowerShell\Modules and %ProgramFiles%\WindowsPowerShell\Modules.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static readonly string</b> <a id="95980f521347c6c4" href="../R/95980f521347c6c4.html" target="n" data-glyph="44,1" class="i field">ModuleDirectory</a> = <span class="i">Path</span>.<span class="i">Combine</span>(<a href="#22e35e156d76df77" class="i field">ProductNameForDirectory</a>, <span class="s">&quot;Modules&quot;</span>);
 
        <b>internal static readonly</b> <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>[] <a id="56b94f3ef7006dfe" href="../R/56b94f3ef7006dfe.html" target="n" data-glyph="44,1" class="i field">SystemWideOnlyConfig</a> = <b>new</b>[] { <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="PSConfiguration.cs.html#378339620026a80d" class="i field">AllUsers</a> };
        <b>internal static readonly</b> <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>[] <a id="97ee8220b56a1889" href="../R/97ee8220b56a1889.html" target="n" data-glyph="44,1" class="i field">CurrentUserOnlyConfig</a> = <b>new</b>[] { <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="PSConfiguration.cs.html#2486a7ab834532b3" class="i field">CurrentUser</a> };
        <b>internal static readonly</b> <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>[] <a id="7a2ef29ad39fd97e" href="../R/7a2ef29ad39fd97e.html" target="n" data-glyph="44,1" class="i field">SystemWideThenCurrentUserConfig</a> = <b>new</b>[] { <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="PSConfiguration.cs.html#378339620026a80d" class="i field">AllUsers</a>, <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="PSConfiguration.cs.html#2486a7ab834532b3" class="i field">CurrentUser</a> };
        <b>internal static readonly</b> <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>[] <a id="f502b8cd8ed6aabe" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">CurrentUserThenSystemWideConfig</a> = <b>new</b>[] { <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="PSConfiguration.cs.html#2486a7ab834532b3" class="i field">CurrentUser</a>, <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="PSConfiguration.cs.html#378339620026a80d" class="i field">AllUsers</a> };
 
        <b>internal static</b> <span class="r110 r t">T</span> <a id="fb031837cf810b13" href="../R/fb031837cf810b13.html" target="n" data-glyph="74,1" class="i method">GetPolicySetting</a>&lt;<span id="r110 rd t" class="r110 r t">T</span>&gt;(<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>[] <span id="r111 rd" class="r111 r">preferenceOrder</span>) <b>where</b> <span class="r110 r t">T</span> : <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>, <b>new</b>()
        {
            <span class="r110 r t">T</span> <span id="r112 rd" class="r112 r">policy</span> = <b>null</b>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <span class="c">// On Windows, group policy settings from registry take precedence.</span>
            <span class="c">// If the requested policy is not defined in registry, we query the configuration file.</span>
            <span class="r112 r">policy</span> = <span class="i">GetPolicySettingFromGPO</span>&lt;<span class="r110 r t">T</span>&gt;(<span class="r111 r">preferenceOrder</span>);
            <b>if</b> (<span class="r112 r">policy</span> != <b>null</b>) { <b>return</b> <span class="r112 r">policy</span>; }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <span class="r112 r">policy</span> = <span class="i">GetPolicySettingFromConfigFile</span>&lt;<span class="r110 r t">T</span>&gt;(<span class="r111 r">preferenceOrder</span>);
            <b>return</b> <span class="r112 r">policy</span>;
        }
 
        <b>private static readonly</b> <span class="i">ConcurrentDictionary</span>&lt;<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>, <a href="PSConfiguration.cs.html#e7c16de5b71ffcc1" class="t t">PowerShellPolicies</a>&gt; <a id="2977b84649e14839" href="../R/2977b84649e14839.html" target="n" data-glyph="46,1" class="i field">s_cachedPoliciesFromConfigFile</a> =
            <b>new</b> <span class="i">ConcurrentDictionary</span>&lt;<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>, <a href="PSConfiguration.cs.html#e7c16de5b71ffcc1" class="t t">PowerShellPolicies</a>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get a specific kind of policy setting from the configuration file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="r113 r t">T</span> <a id="824f6c491e9d90d3" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetPolicySettingFromConfigFile</a>&lt;<span id="r113 rd t" class="r113 r t">T</span>&gt;(<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>[] <span id="r114 rd" class="r114 r">preferenceOrder</span>) <b>where</b> <span class="r113 r t">T</span> : <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>, <b>new</b>()
        {
            <b>foreach</b> (<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a> <span id="r115 rd" class="r115 r">scope</span> <b>in</b> <span class="r114 r">preferenceOrder</span>)
            {
                <a href="PSConfiguration.cs.html#e7c16de5b71ffcc1" class="t t">PowerShellPolicies</a> <span id="r116 rd" class="r116 r">policies</span>;
                <b>if</b> (<a href="#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="#de82c6590fd7de27" class="i field">BypassGroupPolicyCaching</a>)
                {
                    <span class="r116 r">policies</span> = <a href="PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="PSConfiguration.cs.html#8ab7d27aca20bb75" class="i method">GetPowerShellPolicies</a>(<span class="r115 r">scope</span>);
                }
                <b>else</b> <b>if</b> (!<a href="#2977b84649e14839" class="i field">s_cachedPoliciesFromConfigFile</a>.<span class="i">TryGetValue</span>(<span class="r115 r">scope</span>, <b>out</b> <span class="r116 r">policies</span>))
                {
                    <span class="c">// Use lock here to reduce the contention on accessing the configuration file</span>
                    <b>lock</b> (<a href="#2977b84649e14839" class="i field">s_cachedPoliciesFromConfigFile</a>)
                    {
                        <span class="r116 r">policies</span> = <a href="#2977b84649e14839" class="i field">s_cachedPoliciesFromConfigFile</a>.<span class="i">GetOrAdd</span>(<span class="r115 r">scope</span>, <a href="PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<span class="i">GetPowerShellPolicies</span>);
                    }
                }
 
                <b>if</b> (<span class="r116 r">policies</span> != <b>null</b>)
                {
                    <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a> <span id="r117 rd" class="r117 r">result</span> = <b>null</b>;
                    <b>switch</b> (<b>typeof</b>(<span class="r113 r t">T</span>).<span class="i">Name</span>)
                    {
                        <b>case</b> <b>nameof</b>(<a href="PSConfiguration.cs.html#e6a5eb5440f63458" class="t t">ScriptExecution</a>):
                            <span class="r117 r">result</span> = <span class="r116 r">policies</span>.<a href="PSConfiguration.cs.html#f2ea1eba8b279f4e" class="i property">ScriptExecution</a>;
                            <b>break</b>;
                        <b>case</b> <b>nameof</b>(<a href="PSConfiguration.cs.html#77a0f8dab4448573" class="t t">ScriptBlockLogging</a>):
                            <span class="r117 r">result</span> = <span class="r116 r">policies</span>.<a href="PSConfiguration.cs.html#e850bc12e3db81cf" class="i property">ScriptBlockLogging</a>;
                            <b>break</b>;
                        <b>case</b> <b>nameof</b>(<a href="PSConfiguration.cs.html#6a0db7ae0b44cb93" class="t t">ModuleLogging</a>):
                            <span class="r117 r">result</span> = <span class="r116 r">policies</span>.<a href="PSConfiguration.cs.html#dac515fd04e45e6e" class="i property">ModuleLogging</a>;
                            <b>break</b>;
                        <b>case</b> <b>nameof</b>(<a href="PSConfiguration.cs.html#b80e130b16229ecc" class="t t">ProtectedEventLogging</a>):
                            <span class="r117 r">result</span> = <span class="r116 r">policies</span>.<a href="PSConfiguration.cs.html#455b654df4e7f120" class="i property">ProtectedEventLogging</a>;
                            <b>break</b>;
                        <b>case</b> <b>nameof</b>(<a href="PSConfiguration.cs.html#d275218ef3d9ed7d" class="t t">Transcription</a>):
                            <span class="r117 r">result</span> = <span class="r116 r">policies</span>.<a href="PSConfiguration.cs.html#3eb9c8a49e62b42b" class="i property">Transcription</a>;
                            <b>break</b>;
                        <b>case</b> <b>nameof</b>(<a href="PSConfiguration.cs.html#212375668f08d542" class="t t">UpdatableHelp</a>):
                            <span class="r117 r">result</span> = <span class="r116 r">policies</span>.<a href="PSConfiguration.cs.html#ff78d7401e9556ab" class="i property">UpdatableHelp</a>;
                            <b>break</b>;
                        <b>case</b> <b>nameof</b>(<a href="PSConfiguration.cs.html#8b911683783ef1aa" class="t t">ConsoleSessionConfiguration</a>):
                            <span class="r117 r">result</span> = <span class="r116 r">policies</span>.<a href="PSConfiguration.cs.html#168d66565d36487b" class="i property">ConsoleSessionConfiguration</a>;
                            <b>break</b>;
                        <b>default</b>:
                            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Should be unreachable code. Update this switch block when new PowerShell policy types are added.&quot;</span>);
                            <b>break</b>;
                    }
 
                    <b>if</b> (<span class="r117 r">result</span> != <b>null</b>) { <b>return</b> (<span class="r113 r t">T</span>)<span class="r117 r">result</span>; }
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <a id="8b933390eef92c2d" href="../R/8b933390eef92c2d.html" target="n" data-glyph="46,1" class="i field">GroupPolicyKeys</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt;
        {
            {<b>nameof</b>(<a href="PSConfiguration.cs.html#e6a5eb5440f63458" class="t t">ScriptExecution</a>), <span class="s">@&quot;Software\Policies\Microsoft\PowerShellCore&quot;</span>},
            {<b>nameof</b>(<a href="PSConfiguration.cs.html#77a0f8dab4448573" class="t t">ScriptBlockLogging</a>), <span class="s">@&quot;Software\Policies\Microsoft\PowerShellCore\ScriptBlockLogging&quot;</span>},
            {<b>nameof</b>(<a href="PSConfiguration.cs.html#6a0db7ae0b44cb93" class="t t">ModuleLogging</a>), <span class="s">@&quot;Software\Policies\Microsoft\PowerShellCore\ModuleLogging&quot;</span>},
            {<b>nameof</b>(<a href="PSConfiguration.cs.html#b80e130b16229ecc" class="t t">ProtectedEventLogging</a>), <span class="s">@&quot;Software\Policies\Microsoft\Windows\EventLog\ProtectedEventLogging&quot;</span>},
            {<b>nameof</b>(<a href="PSConfiguration.cs.html#d275218ef3d9ed7d" class="t t">Transcription</a>), <span class="s">@&quot;Software\Policies\Microsoft\PowerShellCore\Transcription&quot;</span>},
            {<b>nameof</b>(<a href="PSConfiguration.cs.html#212375668f08d542" class="t t">UpdatableHelp</a>), <span class="s">@&quot;Software\Policies\Microsoft\PowerShellCore\UpdatableHelp&quot;</span>},
            {<b>nameof</b>(<a href="PSConfiguration.cs.html#8b911683783ef1aa" class="t t">ConsoleSessionConfiguration</a>), <span class="s">@&quot;Software\Policies\Microsoft\PowerShellCore\ConsoleSessionConfiguration&quot;</span>}
        };
 
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <a id="19acc67b9a9b5ac5" href="../R/19acc67b9a9b5ac5.html" target="n" data-glyph="46,1" class="i field">WindowsPowershellGroupPolicyKeys</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt;
        {
            { <b>nameof</b>(<a href="PSConfiguration.cs.html#e6a5eb5440f63458" class="t t">ScriptExecution</a>), <span class="s">@&quot;Software\Policies\Microsoft\Windows\PowerShell&quot;</span> },
            { <b>nameof</b>(<a href="PSConfiguration.cs.html#77a0f8dab4448573" class="t t">ScriptBlockLogging</a>), <span class="s">@&quot;Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging&quot;</span> },
            { <b>nameof</b>(<a href="PSConfiguration.cs.html#6a0db7ae0b44cb93" class="t t">ModuleLogging</a>), <span class="s">@&quot;Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging&quot;</span> },
            { <b>nameof</b>(<a href="PSConfiguration.cs.html#d275218ef3d9ed7d" class="t t">Transcription</a>), <span class="s">@&quot;Software\Policies\Microsoft\Windows\PowerShell\Transcription&quot;</span> },
            { <b>nameof</b>(<a href="PSConfiguration.cs.html#212375668f08d542" class="t t">UpdatableHelp</a>), <span class="s">@&quot;Software\Policies\Microsoft\Windows\PowerShell\UpdatableHelp&quot;</span> },
        };
 
        <b>private const string</b> <a id="a12a08f289cd3cbc" href="../R/a12a08f289cd3cbc.html" target="n" data-glyph="10,1" class="i field">PolicySettingFallbackKey</a> = <span class="s">&quot;UseWindowsPowerShellPolicySetting&quot;</span>;
 
        <b>private static readonly</b> <span class="i">ConcurrentDictionary</span>&lt;<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>, <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>&gt;&gt; <a id="c1a96db0085e49c5" href="../R/c1a96db0085e49c5.html" target="n" data-glyph="46,1" class="i field">s_cachedPoliciesFromRegistry</a> =
            <b>new</b> <span class="i">ConcurrentDictionary</span>&lt;<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>, <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>&gt;&gt;();
 
        <b>private static readonly</b> <span class="i">Func</span>&lt;<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>, <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>&gt;&gt; <a id="7aa09ad2d63baeeb" href="../R/7aa09ad2d63baeeb.html" target="n" data-glyph="46,1" class="i field">s_subCacheCreationDelegate</a> =
            <span id="r118 rd" class="r118 r">key</span> =&gt; <b>new</b> <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>&gt;(<span class="i">StringComparer</span>.<span class="i">Ordinal</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Read policy settings from a registry key into a policy object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r119 r">instance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Policy object that will be filled with values from registry.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r120 r">instanceType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Type of policy object used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">gpoKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Registry key that has policy settings.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if any property was successfully set on the policy object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="723cc9350f7b4ec7" href="../R/723cc9350f7b4ec7.html" target="n" data-glyph="76,1" class="i method">TrySetPolicySettingsFromRegistryKey</a>(<b>object</b> <span id="r119 rd" class="r119 r">instance</span>, <span class="i">Type</span> <span id="r120 rd" class="r120 r">instanceType</span>, <span class="i">RegistryKey</span> <span id="r121 rd" class="r121 r">gpoKey</span>)
        {
            <b>var</b> <span id="r122 rd" class="r122 r">properties</span> = <span class="r120 r">instanceType</span>.<span class="i">GetProperties</span>(<span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span>);
            <b>bool</b> <span id="r123 rd" class="r123 r">isAnyPropertySet</span> = <b>false</b>;
 
            <b>string</b>[] <span id="r124 rd" class="r124 r">valueNames</span> = <span class="r121 r">gpoKey</span>.<span class="i">GetValueNames</span>();
            <b>string</b>[] <span id="r125 rd" class="r125 r">subKeyNames</span> = <span class="r121 r">gpoKey</span>.<span class="i">GetSubKeyNames</span>();
            <b>var</b> <span id="r126 rd" class="r126 r">valueNameSet</span> = <span class="r124 r">valueNames</span>.<span class="i">Length</span> &gt; 0 ? <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="r124 r">valueNames</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>) : <b>null</b>;
            <b>var</b> <span id="r127 rd" class="r127 r">subKeyNameSet</span> = <span class="r125 r">subKeyNames</span>.<span class="i">Length</span> &gt; 0 ? <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="r125 r">subKeyNames</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>) : <b>null</b>;
 
            <span class="c">// If there are any values or subkeys in the registry key - read them into the policy instance object</span>
            <b>if</b> ((<span class="r126 r">valueNameSet</span> != <b>null</b>) || (<span class="r127 r">subKeyNameSet</span> != <b>null</b>))
            {
                <b>foreach</b> (<b>var</b> <span id="r128 rd" class="r128 r">property</span> <b>in</b> <span class="r122 r">properties</span>)
                {
                    <b>string</b> <span id="r129 rd" class="r129 r">settingName</span> = <span class="r128 r">property</span>.<span class="i">Name</span>;
                    <b>object</b> <span id="r130 rd" class="r130 r">rawRegistryValue</span> = <b>null</b>;
 
                    <span class="c">// Get the raw value from registry.</span>
                    <b>if</b> (<span class="r126 r">valueNameSet</span> != <b>null</b> &amp;&amp; <span class="r126 r">valueNameSet</span>.<span class="i">Contains</span>(<span class="r129 r">settingName</span>))
                    {
                        <span class="r130 r">rawRegistryValue</span> = <span class="r121 r">gpoKey</span>.<span class="i">GetValue</span>(<span class="r129 r">settingName</span>);
                    }
                    <b>else</b> <b>if</b> (<span class="r127 r">subKeyNameSet</span> != <b>null</b> &amp;&amp; <span class="r127 r">subKeyNameSet</span>.<span class="i">Contains</span>(<span class="r129 r">settingName</span>))
                    {
                        <b>using</b> (<span class="i">RegistryKey</span> <span id="r131 rd" class="r131 r">subKey</span> = <span class="r121 r">gpoKey</span>.<span class="i">OpenSubKey</span>(<span class="r129 r">settingName</span>))
                        {
                            <b>if</b> (<span class="r131 r">subKey</span> != <b>null</b>)
                            {
                                <span class="r130 r">rawRegistryValue</span> = <span class="r131 r">subKey</span>.<span class="i">GetValueNames</span>();
                            }
                        }
                    }
 
                    <span class="c">// Get the actual property value based on the property type.</span>
                    <span class="c">// If the final property value is not null, then set the property.</span>
                    <b>if</b> (<span class="r130 r">rawRegistryValue</span> != <b>null</b>)
                    {
                        <span class="i">Type</span> <span id="r132 rd" class="r132 r">propertyType</span> = <span class="r128 r">property</span>.<span class="i">PropertyType</span>;
                        <b>object</b> <span id="r133 rd" class="r133 r">propertyValue</span> = <b>null</b>;
 
                        <b>switch</b> (<span class="r132 r">propertyType</span>)
                        {
                            <b>case</b> <b>var</b> <b>_</b> <b>when</b> <span class="r132 r">propertyType</span> == <b>typeof</b>(<b>bool</b>?):
                                <b>if</b> (<span class="r130 r">rawRegistryValue</span> <b>is int</b> <span id="r134 rd" class="r134 r">rawIntValue</span>)
                                {
                                    <b>if</b> (<span class="r134 r">rawIntValue</span> == 1)
                                    {
                                        <span class="r133 r">propertyValue</span> = <b>true</b>;
                                    }
                                    <b>else</b> <b>if</b> (<span class="r134 r">rawIntValue</span> == 0)
                                    {
                                        <span class="r133 r">propertyValue</span> = <b>false</b>;
                                    }
                                }
 
                                <b>break</b>;
                            <b>case</b> <b>var</b> <b>_</b> <b>when</b> <span class="r132 r">propertyType</span> == <b>typeof</b>(<b>string</b>):
                                <b>if</b> (<span class="r130 r">rawRegistryValue</span> <b>is string</b> <span id="r135 rd" class="r135 r">rawStringValue</span>)
                                {
                                    <span class="r133 r">propertyValue</span> = <span class="r135 r">rawStringValue</span>;
                                }
 
                                <b>break</b>;
                            <b>case</b> <b>var</b> <b>_</b> <b>when</b> <span class="r132 r">propertyType</span> == <b>typeof</b>(<b>string</b>[]):
                                <b>if</b> (<span class="r130 r">rawRegistryValue</span> <b>is string</b>[] <span id="r136 rd" class="r136 r">rawStringArrayValue</span>)
                                {
                                    <span class="r133 r">propertyValue</span> = <span class="r136 r">rawStringArrayValue</span>;
                                }
                                <b>else</b> <b>if</b> (<span class="r130 r">rawRegistryValue</span> <b>is string</b> <span id="r137 rd" class="r137 r">stringValue</span>)
                                {
                                    <span class="r133 r">propertyValue</span> = <b>new</b> <b>string</b>[] { <span class="r137 r">stringValue</span> };
                                }
 
                                <b>break</b>;
                            <b>default</b>:
                                <b>throw</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Interpreter</span>.<a href="interpreter/Utilities.cs.html#f760db0369027867" class="t t">Assert</a>.<a href="interpreter/Utilities.cs.html#176abe9780c04116" class="i property">Unreachable</a>;
                        }
 
                        <span class="c">// Set the property if the value is not null</span>
                        <b>if</b> (<span class="r133 r">propertyValue</span> != <b>null</b>)
                        {
                            <span class="r128 r">property</span>.<span class="i">SetValue</span>(<span class="r119 r">instance</span>, <span class="r133 r">propertyValue</span>);
                            <span class="r123 r">isAnyPropertySet</span> = <b>true</b>;
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r123 r">isAnyPropertySet</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The implementation of fetching a specific kind of policy setting from the given configuration scope.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="r138 r t">T</span> <a id="dd651a7a8d42fdd7" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetPolicySettingFromGPOImpl</a>&lt;<span id="r138 rd t" class="r138 r t">T</span>&gt;(<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a> <span id="r139 rd" class="r139 r">scope</span>) <b>where</b> <span class="r138 r t">T</span> : <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>, <b>new</b>()
        {
            <span class="i">Type</span> <span id="r140 rd" class="r140 r">tType</span> = <b>typeof</b>(<span class="r138 r t">T</span>);
            <span class="c">// SystemWide scope means &#39;LocalMachine&#39; root key when query from registry</span>
            <span class="i">RegistryKey</span> <span id="r141 rd" class="r141 r">rootKey</span> = (<span class="r139 r">scope</span> == <a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="PSConfiguration.cs.html#378339620026a80d" class="i field">AllUsers</a>) ? <span class="i">Registry</span>.<span class="i">LocalMachine</span> : <span class="i">Registry</span>.<span class="i">CurrentUser</span>;
 
            <a href="#8b933390eef92c2d" class="i field">GroupPolicyKeys</a>.<span class="i">TryGetValue</span>(<span class="r140 r">tType</span>.<span class="i">Name</span>, <b>out string</b> <span id="r142 rd" class="r142 r">gpoKeyPath</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r142 r">gpoKeyPath</span> != <b>null</b>, <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="s">&quot;The GPO registry key path should be pre-defined for {0}&quot;</span>, <span class="r140 r">tType</span>.<span class="i">Name</span>));
 
            <b>using</b> (<span class="i">RegistryKey</span> <span id="r143 rd" class="r143 r">gpoKey</span> = <span class="r141 r">rootKey</span>.<span class="i">OpenSubKey</span>(<span class="r142 r">gpoKeyPath</span>))
            {
                <span class="c">// If the corresponding GPO key doesn&#39;t exist, return null</span>
                <b>if</b> (<span class="r143 r">gpoKey</span> == <b>null</b>) { <b>return</b> <b>null</b>; }
 
                <span class="c">// The corresponding GPO key exists, then create an instance of T</span>
                <span class="c">// and populate its properties with the settings</span>
                <b>object</b> <span id="r144 rd" class="r144 r">tInstance</span> = <span class="i">Activator</span>.<span class="i">CreateInstance</span>(<span class="r140 r">tType</span>, <span class="i">nonPublic</span>: <b>true</b>);
                <b>bool</b> <span id="r145 rd" class="r145 r">isAnyPropertySet</span> = <b>false</b>;
 
                <span class="c">// if PolicySettingFallbackKey is Not set - use PowerShell Core policy reg key</span>
                <b>if</b> ((<b>int</b>)<span class="r143 r">gpoKey</span>.<span class="i">GetValue</span>(<a href="#a12a08f289cd3cbc" class="i field">PolicySettingFallbackKey</a>, 0) == 0)
                {
                    <span class="r145 r">isAnyPropertySet</span> = <a href="#723cc9350f7b4ec7" class="i method">TrySetPolicySettingsFromRegistryKey</a>(<span class="r144 r">tInstance</span>, <span class="r140 r">tType</span>, <span class="r143 r">gpoKey</span>);
                }
                <b>else</b>
                {
                    <span class="c">// when PolicySettingFallbackKey flag is set (REG_DWORD &quot;1&quot;) use Windows PS policy reg key</span>
                    <a href="#19acc67b9a9b5ac5" class="i field">WindowsPowershellGroupPolicyKeys</a>.<span class="i">TryGetValue</span>(<span class="r140 r">tType</span>.<span class="i">Name</span>, <b>out string</b> <span id="r146 rd" class="r146 r">winPowershellGpoKeyPath</span>);
                    <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r146 r">winPowershellGpoKeyPath</span> != <b>null</b>, <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="s">&quot;The Windows PS GPO registry key path should be pre-defined for {0}&quot;</span>, <span class="r140 r">tType</span>.<span class="i">Name</span>));
                    <b>using</b> (<span class="i">RegistryKey</span> <span id="r147 rd" class="r147 r">winPowershellGpoKey</span> = <span class="r141 r">rootKey</span>.<span class="i">OpenSubKey</span>(<span class="r146 r">winPowershellGpoKeyPath</span>))
                    {
                        <span class="c">// If the corresponding Windows PS GPO key doesn&#39;t exist, return null</span>
                        <b>if</b> (<span class="r147 r">winPowershellGpoKey</span> == <b>null</b>) { <b>return</b> <b>null</b>; }
                        <span class="r145 r">isAnyPropertySet</span> = <a href="#723cc9350f7b4ec7" class="i method">TrySetPolicySettingsFromRegistryKey</a>(<span class="r144 r">tInstance</span>, <span class="r140 r">tType</span>, <span class="r147 r">winPowershellGpoKey</span>);
                    }
                }
 
                <span class="c">// If no property is set, then we consider this policy as undefined</span>
                <b>return</b> <span class="r145 r">isAnyPropertySet</span> ? (<span class="r138 r t">T</span>)<span class="r144 r">tInstance</span> : <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get a specific kind of policy setting from the group policy registry key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="r148 r t">T</span> <a id="ce987ed81cda4a57" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetPolicySettingFromGPO</a>&lt;<span id="r148 rd t" class="r148 r t">T</span>&gt;(<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>[] <span id="r149 rd" class="r149 r">preferenceOrder</span>) <b>where</b> <span class="r148 r t">T</span> : <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a>, <b>new</b>()
        {
            <a href="PSConfiguration.cs.html#9f84b38dbcf6f535" class="t t">PolicyBase</a> <span id="r150 rd" class="r150 r">policy</span> = <b>null</b>;
            <b>string</b> <span id="r151 rd" class="r151 r">policyName</span> = <b>typeof</b>(<span class="r148 r t">T</span>).<span class="i">Name</span>;
 
            <b>foreach</b> (<a href="PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a> <span id="r152 rd" class="r152 r">scope</span> <b>in</b> <span class="r149 r">preferenceOrder</span>)
            {
                <b>if</b> (<a href="#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="#de82c6590fd7de27" class="i field">BypassGroupPolicyCaching</a>)
                {
                    <span class="r150 r">policy</span> = <span class="i">GetPolicySettingFromGPOImpl</span>&lt;<span class="r148 r t">T</span>&gt;(<span class="r152 r">scope</span>);
                }
                <b>else</b>
                {
                    <b>var</b> <span id="r153 rd" class="r153 r">subordinateCache</span> = <a href="#c1a96db0085e49c5" class="i field">s_cachedPoliciesFromRegistry</a>.<span class="i">GetOrAdd</span>(<span class="r152 r">scope</span>, <a href="#7aa09ad2d63baeeb" class="i field">s_subCacheCreationDelegate</a>);
                    <b>if</b> (!<span class="r153 r">subordinateCache</span>.<span class="i">TryGetValue</span>(<span class="r151 r">policyName</span>, <b>out</b> <span class="r150 r">policy</span>))
                    {
                        <span class="r150 r">policy</span> = <span class="r153 r">subordinateCache</span>.<span class="i">GetOrAdd</span>(<span class="r151 r">policyName</span>, <span id="r154 rd" class="r154 r">key</span> =&gt; <span class="i">GetPolicySettingFromGPOImpl</span>&lt;<span class="r148 r t">T</span>&gt;(<span class="r152 r">scope</span>));
                    }
                }
 
                <b>if</b> (<span class="r150 r">policy</span> != <b>null</b>) { <b>return</b> (<span class="r148 r t">T</span>)<span class="r150 r">policy</span>; }
            }
 
            <b>return</b> <b>null</b>;
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Scheduled job module name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const string</b> <a id="433d9ed78f584f39" href="../R/433d9ed78f584f39.html" target="n" data-glyph="8,1" class="i field">ScheduledJobModuleName</a> = <span class="s">&quot;PSScheduledJob&quot;</span>;
 
        <b>internal static void</b> <a id="8acffd0f963a3fa1" href="../R/8acffd0f963a3fa1.html" target="n" data-glyph="74,1" class="i method">EnsureModuleLoaded</a>(<b>string</b> <span id="r155 rd" class="r155 r">module</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r156 rd" class="r156 r">context</span>)
        {
            <b>if</b> (<span class="r156 r">context</span> != <b>null</b> &amp;&amp; !<span class="r156 r">context</span>.<a href="ExecutionContext.cs.html#57a7d9d22f06323e" class="i property">AutoLoadingModuleInProgress</a>.<span class="i">Contains</span>(<span class="r155 r">module</span>))
            {
                <span class="i">List</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r157 rd" class="r157 r">loadedModules</span> = <span class="r156 r">context</span>.<a href="ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="Modules/ModuleIntrinsics.cs.html#1c52622ea6eacb86" class="i method">GetModules</a>(<b>new</b> <b>string</b>[] { <span class="r155 r">module</span> }, <b>false</b>);
 
                <b>if</b> ((<span class="r157 r">loadedModules</span> == <b>null</b>) || (<span class="r157 r">loadedModules</span>.<span class="i">Count</span> == 0))
                {
                    <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r158 rd" class="r158 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Import-Module&quot;</span>, <b>typeof</b>(<span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="Modules/ImportModuleCommand.cs.html#4a6e75cbbfb65b34" class="t t">ImportModuleCommand</a>),
                                                             <b>null</b>, <b>null</b>, <span class="r156 r">context</span>);
                    <a href="hostifaces/Command.cs.html#b55b68a3bf75e612" class="k">var</a> <span id="r159 rd" class="r159 r">importModuleCommand</span> = <b>new</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="hostifaces/Command.cs.html#7afd6fbc88a9b688" class="t constructor">Command</a>(<span class="r158 r">commandInfo</span>);
 
                    <span class="r156 r">context</span>.<a href="ExecutionContext.cs.html#57a7d9d22f06323e" class="i property">AutoLoadingModuleInProgress</a>.<span class="i">Add</span>(<span class="r155 r">module</span>);
 
                    <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r160 rd" class="r160 r">ps</span> = <b>null</b>;
 
                    <b>try</b>
                    {
                        <span class="r160 r">ps</span> = <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>)
                            .<a href="hostifaces/PowerShell.cs.html#f68f5b3ba7949aa4" class="i method">AddCommand</a>(<span class="r159 r">importModuleCommand</span>)
                            .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <span class="r155 r">module</span>)
                            .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Scope&quot;</span>, <a href="SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="SessionStateStrings.cs.html#76950d3d9588bb8a" class="i field">Global</a>)
                            .<span class="i">AddParameter</span>(<span class="s">&quot;ErrorAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                            .<span class="i">AddParameter</span>(<span class="s">&quot;WarningAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                            .<span class="i">AddParameter</span>(<span class="s">&quot;InformationAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                            .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Verbose&quot;</span>, <b>false</b>)
                            .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Debug&quot;</span>, <b>false</b>)
                            .<a href="hostifaces/PowerShell.cs.html#ad181c9dec5e4ffa" class="i method">AddParameter</a>(<span class="s">&quot;PassThru&quot;</span>);
 
                        <span class="r160 r">ps</span>.<a href="hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                        <span class="c">// Call-out to user code, catch-all OK</span>
                    }
                    <b>finally</b>
                    {
                        <span class="r156 r">context</span>.<a href="ExecutionContext.cs.html#57a7d9d22f06323e" class="i property">AutoLoadingModuleInProgress</a>.<span class="i">Remove</span>(<span class="r155 r">module</span>);
                        <b>if</b> (<span class="r160 r">ps</span> != <b>null</b>)
                        {
                            <span class="r160 r">ps</span>.<a href="hostifaces/PowerShell.cs.html#18cbb6bfae891ee7" class="i method">Dispose</a>();
                        }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns modules (either loaded or in available) that match pattern </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r161 r">module</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> Uses Get-Module -ListAvailable cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r161 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r162 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of PSModuleInfo&#39;s or Null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">List</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="47243ec3bd91f59b" href="../R/47243ec3bd91f59b.html" target="n" data-glyph="74,1" class="i method">GetModules</a>(<b>string</b> <span id="r161 rd" class="r161 r">module</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r162 rd" class="r162 r">context</span>)
        {
            <span class="c">// first look in the loaded modules and then append the modules from gmo -Listavailable</span>
            <span class="c">// Reason: gmo -li looks only the PSModulepath. There may be cases where a module</span>
            <span class="c">// is imported directly from a path (that is not in PSModulePath).</span>
            <span class="i">List</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r163 rd" class="r163 r">result</span> = <span class="r162 r">context</span>.<a href="ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="Modules/ModuleIntrinsics.cs.html#1c52622ea6eacb86" class="i method">GetModules</a>(<b>new</b> <b>string</b>[] { <span class="r161 r">module</span> }, <b>false</b>);
 
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r164 rd" class="r164 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Get-Module&quot;</span>, <b>typeof</b>(<span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="Modules/GetModuleCommand.cs.html#6f6537067f4dfc41" class="t t">GetModuleCommand</a>),
                                                     <b>null</b>, <b>null</b>, <span class="r162 r">context</span>);
            <a href="hostifaces/Command.cs.html#b55b68a3bf75e612" class="k">var</a> <span id="r165 rd" class="r165 r">getModuleCommand</span> = <b>new</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="hostifaces/Command.cs.html#7afd6fbc88a9b688" class="t constructor">Command</a>(<span class="r164 r">commandInfo</span>);
 
            <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r166 rd" class="r166 r">ps</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r166 r">ps</span> = <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>)
                        .<a href="hostifaces/PowerShell.cs.html#f68f5b3ba7949aa4" class="i method">AddCommand</a>(<span class="r165 r">getModuleCommand</span>)
                        .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <span class="r161 r">module</span>)
                        .<span class="i">AddParameter</span>(<span class="s">&quot;ErrorAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                        .<span class="i">AddParameter</span>(<span class="s">&quot;WarningAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                        .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Verbose&quot;</span>, <b>false</b>)
                        .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Debug&quot;</span>, <b>false</b>)
                        .<a href="hostifaces/PowerShell.cs.html#ad181c9dec5e4ffa" class="i method">AddParameter</a>(<span class="s">&quot;ListAvailable&quot;</span>);
 
                <span class="i">Collection</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r167 rd" class="r167 r">gmoOutPut</span> = <span class="r166 r">ps</span>.<a href="hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
                <b>if</b> (<span class="r167 r">gmoOutPut</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r163 r">result</span> == <b>null</b>)
                    {
                        <span class="r163 r">result</span> = <span class="r167 r">gmoOutPut</span>.<span class="i">ToList</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
                    }
                    <b>else</b>
                    {
                        <span class="r163 r">result</span>.<span class="i">AddRange</span>(<span class="r167 r">gmoOutPut</span>);
                    }
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// Call-out to user code, catch-all OK</span>
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r166 r">ps</span> != <b>null</b>)
                {
                    <span class="r166 r">ps</span>.<a href="hostifaces/PowerShell.cs.html#18cbb6bfae891ee7" class="i method">Dispose</a>();
                }
            }
 
            <b>return</b> <span class="r163 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns modules (either loaded or in available) that match FullyQualifiedName </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r168 r">fullyQualifiedName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> Uses Get-Module -ListAvailable cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r168 r">fullyQualifiedName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r169 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of PSModuleInfo&#39;s or Null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">List</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="eefa0070f2dabd05" href="../R/eefa0070f2dabd05.html" target="n" data-glyph="74,1" class="i method">GetModules</a>(<a href="Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r168 rd" class="r168 r">fullyQualifiedName</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r169 rd" class="r169 r">context</span>)
        {
            <span class="c">// first look in the loaded modules and then append the modules from gmo -Listavailable</span>
            <span class="c">// Reason: gmo -li looks only the PSModulepath. There may be cases where a module</span>
            <span class="c">// is imported directly from a path (that is not in PSModulePath).</span>
            <span class="i">List</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r170 rd" class="r170 r">result</span> = <span class="r169 r">context</span>.<a href="ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="Modules/ModuleIntrinsics.cs.html#d05a036ceb288706" class="i method">GetModules</a>(<b>new</b>[] { <span class="r168 r">fullyQualifiedName</span> }, <b>false</b>);
            <a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r171 rd" class="r171 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Get-Module&quot;</span>, <b>typeof</b>(<a href="Modules/GetModuleCommand.cs.html#6f6537067f4dfc41" class="t t">GetModuleCommand</a>),
                                                     <b>null</b>, <b>null</b>, <span class="r169 r">context</span>);
            <a href="hostifaces/Command.cs.html#b55b68a3bf75e612" class="k">var</a> <span id="r172 rd" class="r172 r">getModuleCommand</span> = <b>new</b> <span class="i n">Runspaces</span>.<a href="hostifaces/Command.cs.html#7afd6fbc88a9b688" class="t constructor">Command</a>(<span class="r171 r">commandInfo</span>);
 
            <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r173 rd" class="r173 r">ps</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r173 r">ps</span> = <a href="hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>)
                        .<a href="hostifaces/PowerShell.cs.html#f68f5b3ba7949aa4" class="i method">AddCommand</a>(<span class="r172 r">getModuleCommand</span>)
                        .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;FullyQualifiedName&quot;</span>, <span class="r168 r">fullyQualifiedName</span>)
                        .<span class="i">AddParameter</span>(<span class="s">&quot;ErrorAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                        .<span class="i">AddParameter</span>(<span class="s">&quot;WarningAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                        .<span class="i">AddParameter</span>(<span class="s">&quot;InformationAction&quot;</span>, <a href="CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>)
                        .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Verbose&quot;</span>, <b>false</b>)
                        .<a href="hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Debug&quot;</span>, <b>false</b>)
                        .<a href="hostifaces/PowerShell.cs.html#ad181c9dec5e4ffa" class="i method">AddParameter</a>(<span class="s">&quot;ListAvailable&quot;</span>);
 
                <span class="i">Collection</span>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r174 rd" class="r174 r">gmoOutput</span> = <span class="r173 r">ps</span>.<a href="hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
                <b>if</b> (<span class="r174 r">gmoOutput</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r170 r">result</span> == <b>null</b>)
                    {
                        <span class="r170 r">result</span> = <span class="r174 r">gmoOutput</span>.<span class="i">ToList</span>();
                    }
                    <b>else</b>
                    {
                        <span class="c">// append to result</span>
                        <span class="r170 r">result</span>.<span class="i">AddRange</span>(<span class="r174 r">gmoOutput</span>);
                    }
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// Call-out to user code, catch-all OK</span>
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r173 r">ps</span> != <b>null</b>)
                {
                    <span class="r173 r">ps</span>.<a href="hostifaces/PowerShell.cs.html#18cbb6bfae891ee7" class="i method">Dispose</a>();
                }
            }
 
            <b>return</b> <span class="r170 r">result</span>;
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <b>private static bool</b> <a id="62a986f448216661" href="../R/62a986f448216661.html" target="n" data-glyph="76,1" class="i method">TryGetWindowsCurrentIdentity</a>(<b>out</b> <span class="i">WindowsIdentity</span> <span id="r175 rd" class="r175 r">currentIdentity</span>)
        {
            <b>try</b>
            {
                <span class="r175 r">currentIdentity</span> = <span class="i">WindowsIdentity</span>.<span class="i">GetCurrent</span>();
            }
            <b>catch</b> (<span class="i">SecurityException</span>)
            {
                <span class="r175 r">currentIdentity</span> = <b>null</b>;
            }
 
            <b>return</b> (<span class="r175 r">currentIdentity</span> != <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the current impersonating Windows identity, if any.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">impersonatedIdentity</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Current impersonated Windows identity or null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if current identity is impersonated.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="9b44ca7f35bc8c39" href="../R/9b44ca7f35bc8c39.html" target="n" data-glyph="74,1" class="i method">TryGetWindowsImpersonatedIdentity</a>(<b>out</b> <span class="i">WindowsIdentity</span> <span id="r176 rd" class="r176 r">impersonatedIdentity</span>)
        {
            <span class="i">WindowsIdentity</span> <span id="r177 rd" class="r177 r">currentIdentity</span>;
            <b>if</b> (<a href="#62a986f448216661" class="i method">TryGetWindowsCurrentIdentity</a>(<b>out</b> <span class="r177 r">currentIdentity</span>) &amp;&amp; (<span class="r177 r">currentIdentity</span>.<span class="i">ImpersonationLevel</span> == <span class="i">TokenImpersonationLevel</span>.<span class="i">Impersonation</span>))
            {
                <span class="r176 r">impersonatedIdentity</span> = <span class="r177 r">currentIdentity</span>;
                <b>return</b> <b>true</b>;
            }
 
            <span class="r176 r">impersonatedIdentity</span> = <b>null</b>;
            <b>return</b> <b>false</b>;
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <b>internal static bool</b> <a id="7484d766d2be3ec7" href="../R/7484d766d2be3ec7.html" target="n" data-glyph="74,1" class="i method">IsAdministrator</a>()
        {
            <span class="c">// Porting note: only Windows supports the SecurityPrincipal API of .NET. Due to</span>
            <span class="c">// advanced privilege models, the correct approach on Unix is to assume the user has</span>
            <span class="c">// permissions, attempt the task, and error gracefully if the task fails due to</span>
            <span class="c">// permissions. To fit into PowerShell&#39;s existing model of preemptively checking</span>
            <span class="c">// permissions (which cannot be assumed on Unix), we &quot;assume&quot; the user is an</span>
            <span class="c">// administrator by returning true, thus nullifying this check on Unix.</span>
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return true;
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <span class="i">WindowsIdentity</span> <span id="r178 rd" class="r178 r">currentIdentity</span>;
            <b>if</b> (<a href="#62a986f448216661" class="i method">TryGetWindowsCurrentIdentity</a>(<b>out</b> <span class="r178 r">currentIdentity</span>))
            {
                <b>var</b> <span id="r179 rd" class="r179 r">principal</span> = <b>new</b> <span class="i">WindowsPrincipal</span>(<span class="r178 r">currentIdentity</span>);
                <b>return</b> <span class="r179 r">principal</span>.<span class="i">IsInRole</span>(<span class="i">WindowsBuiltInRole</span>.<span class="i">Administrator</span>);
            }
 
            <b>return</b> <b>false</b>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <b>internal static bool</b> <a id="562333e0cb916c25" href="../R/562333e0cb916c25.html" target="n" data-glyph="74,1" class="i method">IsReservedDeviceName</a>(<b>string</b> <span id="r180 rd" class="r180 r">destinationPath</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <b>string</b>[] <span id="r181 rd" class="r181 r">reservedDeviceNames</span> = { <span class="s">&quot;CON&quot;</span>, <span class="s">&quot;PRN&quot;</span>, <span class="s">&quot;AUX&quot;</span>, <span class="s">&quot;CLOCK$&quot;</span>, <span class="s">&quot;NUL&quot;</span>, <span class="s">&quot;CONIN$&quot;</span>, <span class="s">&quot;CONOUT$&quot;</span>,
                                             <span class="s">&quot;COM0&quot;</span>, <span class="s">&quot;COM1&quot;</span>, <span class="s">&quot;COM2&quot;</span>, <span class="s">&quot;COM3&quot;</span>, <span class="s">&quot;COM4&quot;</span>, <span class="s">&quot;COM5&quot;</span>, <span class="s">&quot;COM6&quot;</span>, <span class="s">&quot;COM7&quot;</span>, <span class="s">&quot;COM8&quot;</span>, <span class="s">&quot;COM9&quot;</span>,
                                             <span class="s">&quot;LPT0&quot;</span>, <span class="s">&quot;LPT1&quot;</span>, <span class="s">&quot;LPT2&quot;</span>, <span class="s">&quot;LPT3&quot;</span>, <span class="s">&quot;LPT4&quot;</span>, <span class="s">&quot;LPT5&quot;</span>, <span class="s">&quot;LPT6&quot;</span>, <span class="s">&quot;LPT7&quot;</span>, <span class="s">&quot;LPT8&quot;</span>, <span class="s">&quot;LPT9&quot;</span> };
            <b>string</b> <span id="r182 rd" class="r182 r">compareName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r180 r">destinationPath</span>);
            <b>string</b> <span id="r183 rd" class="r183 r">noExtensionCompareName</span> = <span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r180 r">destinationPath</span>);
 
            <b>if</b> (((<span class="r182 r">compareName</span>.<span class="i">Length</span> &lt; 3) || (<span class="r182 r">compareName</span>.<span class="i">Length</span> &gt; 7)) &amp;&amp;
                ((<span class="r183 r">noExtensionCompareName</span>.<span class="i">Length</span> &lt; 3) || (<span class="r183 r">noExtensionCompareName</span>.<span class="i">Length</span> &gt; 7)))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<b>string</b> <span id="r184 rd" class="r184 r">deviceName</span> <b>in</b> <span class="r181 r">reservedDeviceNames</span>)
            {
                <b>if</b> (
                    <b>string</b>.<span class="i">Equals</span>(<span class="r184 r">deviceName</span>, <span class="r182 r">compareName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    <b>string</b>.<span class="i">Equals</span>(<span class="r184 r">deviceName</span>, <span class="r183 r">noExtensionCompareName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static bool</b> <a id="035be1ae91f35c16" href="../R/035be1ae91f35c16.html" target="n" data-glyph="74,1" class="i method">PathIsUnc</a>(<b>string</b> <span id="r185 rd" class="r185 r">path</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return false;
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r185 r">path</span>) || !<span class="r185 r">path</span>.<span class="i">StartsWith</span>(<span class="s">&#39;\\&#39;</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// handle special cases like \\wsl$\ubuntu which isn&#39;t a UNC path, but we can say it is so the filesystemprovider can use it</span>
            <b>if</b> (<span class="r185 r">path</span>.<span class="i">StartsWith</span>(<a href="#27ced2dd003c2668" class="i field">WslRootPath</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="i">Uri</span> <span id="r186 rd" class="r186 r">uri</span>;
            <b>return</b> <span class="i">Uri</span>.<span class="i">TryCreate</span>(<span class="r185 r">path</span>, <span class="i">UriKind</span>.<span class="i">Absolute</span>, <b>out</b> <span class="r186 r">uri</span>) &amp;&amp; <span class="r186 r">uri</span>.<span class="i">IsUnc</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <b>internal static readonly string</b> <a id="dca3ae86e55c5b35" href="../R/dca3ae86e55c5b35.html" target="n" data-glyph="44,1" class="i field">PowerShellAssemblyStrongNameFormat</a> =
            <span class="s">&quot;{0}, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&quot;</span>;
 
        <b>internal static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="7c9b025d8c05a902" href="../R/7c9b025d8c05a902.html" target="n" data-glyph="44,1" class="i field">PowerShellAssemblies</a> =
            <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)
                {
                    <span class="s">&quot;microsoft.powershell.commands.diagnostics&quot;</span>,
                    <span class="s">&quot;microsoft.powershell.commands.management&quot;</span>,
                    <span class="s">&quot;microsoft.powershell.commands.utility&quot;</span>,
                    <span class="s">&quot;microsoft.powershell.consolehost&quot;</span>,
                    <span class="s">&quot;microsoft.powershell.scheduledjob&quot;</span>,
                    <span class="s">&quot;microsoft.powershell.security&quot;</span>,
                    <span class="s">&quot;microsoft.wsman.management&quot;</span>,
                    <span class="s">&quot;microsoft.wsman.runtime&quot;</span>,
                    <span class="s">&quot;system.management.automation&quot;</span>
                };
 
        <b>internal static bool</b> <a id="4b2ba2d00a0ce944" href="../R/4b2ba2d00a0ce944.html" target="n" data-glyph="74,1" class="i method">IsPowerShellAssembly</a>(<b>string</b> <span id="r187 rd" class="r187 r">assemblyName</span>)
        {
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r187 r">assemblyName</span>))
            {
                <span class="c">// Remove the &#39;.dll&#39; if it&#39;s there...</span>
                <b>var</b> <span id="r188 rd" class="r188 r">fixedName</span> = <span class="r187 r">assemblyName</span>.<span class="i">EndsWith</span>(<a href="SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                                ? <span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r187 r">assemblyName</span>)
                                : <span class="r187 r">assemblyName</span>;
 
                <b>if</b> ((<span class="r188 r">fixedName</span> != <b>null</b>) &amp;&amp; <a href="#7c9b025d8c05a902" class="i field">PowerShellAssemblies</a>.<span class="i">Contains</span>(<span class="r188 r">fixedName</span>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static string</b> <a id="ace9457935d64a9e" href="../R/ace9457935d64a9e.html" target="n" data-glyph="74,1" class="i method">GetPowerShellAssemblyStrongName</a>(<b>string</b> <span id="r189 rd" class="r189 r">assemblyName</span>)
        {
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r189 r">assemblyName</span>))
            {
                <span class="c">// Remove the &#39;.dll&#39; if it&#39;s there...</span>
                <b>string</b> <span id="r190 rd" class="r190 r">fixedName</span> = <span class="r189 r">assemblyName</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.dll&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                                ? <span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r189 r">assemblyName</span>)
                                : <span class="r189 r">assemblyName</span>;
 
                <b>if</b> ((<span class="r190 r">fixedName</span> != <b>null</b>) &amp;&amp; <a href="#7c9b025d8c05a902" class="i field">PowerShellAssemblies</a>.<span class="i">Contains</span>(<span class="r190 r">fixedName</span>))
                {
                    <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <a href="#dca3ae86e55c5b35" class="i field">PowerShellAssemblyStrongNameFormat</a>, <span class="r190 r">fixedName</span>);
                }
            }
 
            <b>return</b> <span class="r189 r">assemblyName</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If a mutex is abandoned, in our case, it is ok to proceed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r191 r">mutex</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The mutex to wait on. If it is null, a new one will be created.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r192 r">initializer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The initializer to use to recreate the mutex.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A working mutex. If the mutex was abandoned, a new one is created to replace it.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Mutex</span> <a id="130e30fa5f01f63a" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SafeWaitMutex</a>(<span class="i">Mutex</span> <span id="r191 rd" class="r191 r">mutex</span>, <a href="#8f6543140e664d8e" class="t t">MutexInitializer</a> <span id="r192 rd" class="r192 r">initializer</span>)
        {
            <b>try</b>
            {
                <span class="r191 r">mutex</span>.<span class="i">WaitOne</span>();
            }
            <b>catch</b> (<span class="i">AbandonedMutexException</span>)
            {
                <span class="c">// If the Mutex has been abandoned, then the process protecting the critical section</span>
                <span class="c">// is no longer valid. We need to release to continue normal operations.</span>
                <span class="r191 r">mutex</span>.<span class="i">ReleaseMutex</span>();
                ((<span class="i">IDisposable</span>)<span class="r191 r">mutex</span>).<span class="i">Dispose</span>();
 
                <span class="c">// Try again, throw if it still fails</span>
                <span class="r191 r">mutex</span> = <span class="r192 r">initializer</span>();
                <span class="r191 r">mutex</span>.<span class="i">WaitOne</span>();
            }
 
            <b>return</b> <span class="r191 r">mutex</span>;
        }
 
        <b>internal delegate</b> <span class="i">Mutex</span> <a id="8f6543140e664d8e" href="../R/8f6543140e664d8e.html" target="n" data-glyph="14,1" class="t t"><span id="d4d823a494ab3835">MutexInitializer</span></a>();
 
        <b>internal static bool</b> <a id="e1e11f89c723edd9" href="../R/e1e11f89c723edd9.html" target="n" data-glyph="74,1" class="i method">Succeeded</a>(<b>int</b> <span id="r193 rd" class="r193 r">hresult</span>)
        {
            <b>return</b> <span class="r193 r">hresult</span> &gt;= 0;
        }
 
        <span class="c">// BigEndianUTF32 encoding is possible, but requires creation</span>
        <b>internal static readonly</b> <span class="i">Encoding</span> <a id="4ff7a84d51389f74" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">BigEndianUTF32Encoding</a> = <b>new</b> <span class="i">UTF32Encoding</span>(<span class="i">bigEndian</span>: <b>true</b>, <span class="i">byteOrderMark</span>: <b>true</b>);
        <span class="c">// [System.Text.Encoding]::GetEncodings() | Where-Object { $_.GetEncoding().GetPreamble() } |</span>
        <span class="c">//     Add-Member ScriptProperty Preamble { $this.GetEncoding().GetPreamble() -join &quot;-&quot; } -PassThru |</span>
        <span class="c">//     Format-Table -Auto</span>
 
        <b>internal static readonly</b> <span class="i">UTF8Encoding</span> <a id="7a7127f6fafd6bca" href="../R/7a7127f6fafd6bca.html" target="n" data-glyph="44,1" class="i field">utf8NoBom</a> =
            <b>new</b> <span class="i">UTF8Encoding</span>(<span class="i">encoderShouldEmitUTF8Identifier</span>: <b>false</b>);
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Queues a CLR worker thread with impersonation of provided Windows identity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r194 r">identityToImpersonate</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Windows identity to impersonate or null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r195 r">threadProc</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Thread procedure for thread.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r196 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Optional state for thread procedure.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="4b3987980ff94442" href="../R/4b3987980ff94442.html" target="n" data-glyph="74,1" class="i method">QueueWorkItemWithImpersonation</a>(
            <span class="i">WindowsIdentity</span> <span id="r194 rd" class="r194 r">identityToImpersonate</span>,
            <span class="i">WaitCallback</span> <span id="r195 rd" class="r195 r">threadProc</span>,
            <b>object</b> <span id="r196 rd" class="r196 r">state</span>)
        {
            <b>object</b>[] <span id="r197 rd" class="r197 r">args</span> = <b>new</b> <b>object</b>[3];
            <span class="r197 r">args</span>[0] = <span class="r194 r">identityToImpersonate</span>;
            <span class="r197 r">args</span>[1] = <span class="r195 r">threadProc</span>;
            <span class="r197 r">args</span>[2] = <span class="r196 r">state</span>;
            <span class="i">Threading</span>.<span class="i">ThreadPool</span>.<span class="i">QueueUserWorkItem</span>(<span class="i">WorkItemCallback</span>, <span class="r197 r">args</span>);
        }
 
        <b>private static void</b> <a id="2bf080d75c39cb19" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">WorkItemCallback</a>(<b>object</b> <span id="r198 rd" class="r198 r">callBackArgs</span>)
        {
            <b>object</b>[] <span id="r199 rd" class="r199 r">args</span> = <span class="r198 r">callBackArgs</span> <b>as object</b>[];
            <span class="i">WindowsIdentity</span> <span id="r200 rd" class="r200 r">identityToImpersonate</span> = <span class="r199 r">args</span>[0] <b>as</b> <span class="i">WindowsIdentity</span>;
            <span class="i">WaitCallback</span> <span id="r201 rd" class="r201 r">callback</span> = <span class="r199 r">args</span>[1] <b>as</b> <span class="i">WaitCallback</span>;
            <b>object</b> <span id="r202 rd" class="r202 r">state</span> = <span class="r199 r">args</span>[2];
 
            <b>if</b> (<span class="r200 r">identityToImpersonate</span> != <b>null</b>)
            {
                <span class="i">WindowsIdentity</span>.<span class="i">RunImpersonated</span>(
                    <span class="r200 r">identityToImpersonate</span>.<span class="i">AccessToken</span>,
                    () =&gt; <span class="r201 r">callback</span>(<span class="r202 r">state</span>));
                <b>return</b>;
            }
 
            <span class="r201 r">callback</span>(<span class="r202 r">state</span>);
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the command name is fully qualified then it is split into its component parts</span>
        <span class="c">///</span><span class="c"> E.g., moduleName\commandName.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r203 r">commandName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r204 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Command name and as appropriate Module name in out parameter.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="65b18cb655761e08" href="../R/65b18cb655761e08.html" target="n" data-glyph="74,1" class="i method">ParseCommandName</a>(<b>string</b> <span id="r203 rd" class="r203 r">commandName</span>, <b>out string</b> <span id="r204 rd" class="r204 r">moduleName</span>)
        {
            <b>var</b> <span id="r205 rd" class="r205 r">names</span> = <span class="r203 r">commandName</span>.<span class="i">Split</span>(<a href="#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="#247bb446a0dd1494" class="i field">Backslash</a>, 2);
            <b>if</b> (<span class="r205 r">names</span>.<span class="i">Length</span> == 2)
            {
                <span class="r204 r">moduleName</span> = <span class="r205 r">names</span>[0];
                <b>return</b> <span class="r205 r">names</span>[1];
            }
 
            <span class="r204 r">moduleName</span> = <b>null</b>;
            <b>return</b> <span class="r203 r">commandName</span>;
        }
 
        <b>internal static</b> <span class="i">ReadOnlyCollection</span>&lt;<span class="r206 r t">T</span>&gt; <a id="6addb097ebf2d60e" href="../R/6addb097ebf2d60e.html" target="n" data-glyph="74,1" class="i method">EmptyReadOnlyCollection</a>&lt;<span id="r206 rd t" class="r206 r t">T</span>&gt;()
        {
            <b>return</b> <a href="#6ceb274e19363010" class="t t">EmptyReadOnlyCollectionHolder</a>&lt;<span class="r206 r t">T</span>&gt;.<a href="#cac6f38ae201d84d" class="i field">_instance</a>;
        }
 
        <b>private static class</b> <a id="6ceb274e19363010" href="../R/6ceb274e19363010.html" target="n" data-glyph="4,1" class="t t">EmptyReadOnlyCollectionHolder</a>&lt;<span id="r207 rd t" class="r207 r t">T</span>&gt;
        {
            <b>internal static readonly</b> <span class="i">ReadOnlyCollection</span>&lt;<span class="r207 r t">T</span>&gt; <a id="cac6f38ae201d84d" href="../R/cac6f38ae201d84d.html" target="n" data-glyph="44,2" class="i field">_instance</a> =
                <b>new</b> <span class="i">ReadOnlyCollection</span>&lt;<span class="r207 r t">T</span>&gt;(<span class="i">Array</span>.<span class="i">Empty</span>&lt;<span class="r207 r t">T</span>&gt;());
        }
 
        <b>internal static class</b> <a id="6fd6d3492cb91f87" href="../R/6fd6d3492cb91f87.html" target="n" data-glyph="2,1" class="t t">Separators</a>
        {
            <b>internal static readonly char</b>[] <a id="247bb446a0dd1494" href="../R/247bb446a0dd1494.html" target="n" data-glyph="44,2" class="i field">Backslash</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;\\&#39;</span> };
            <b>internal static readonly char</b>[] <a id="182cf4a18b62de18" href="../R/182cf4a18b62de18.html" target="n" data-glyph="44,2" class="i field">Directory</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;\\&#39;</span>, <span class="s">&#39;/&#39;</span> };
            <b>internal static readonly char</b>[] <a id="0702ea1962d7d49b" href="../R/0702ea1962d7d49b.html" target="n" data-glyph="44,2" class="i field">DirectoryOrDrive</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;\\&#39;</span>, <span class="s">&#39;/&#39;</span>, <span class="s">&#39;:&#39;</span> };
 
            <b>internal static readonly char</b>[] <a id="464cd2b65728c452" href="../R/464cd2b65728c452.html" target="n" data-glyph="44,2" class="i field">Colon</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;:&#39;</span> };
            <b>internal static readonly char</b>[] <a id="ffdbb627389644d2" href="../R/ffdbb627389644d2.html" target="n" data-glyph="44,2" class="i field">Dot</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;.&#39;</span> };
            <b>internal static readonly char</b>[] <a id="44758784c9527e16" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">Pipe</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;|&#39;</span> };
            <b>internal static readonly char</b>[] <a id="dd38bba5cad3f99e" href="../R/dd38bba5cad3f99e.html" target="n" data-glyph="44,2" class="i field">Comma</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;,&#39;</span> };
            <b>internal static readonly char</b>[] <a id="13f45855e9b92e58" href="../R/13f45855e9b92e58.html" target="n" data-glyph="44,2" class="i field">Semicolon</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;;&#39;</span> };
            <b>internal static readonly char</b>[] <a id="8bdf3580e6bcbb80" href="../R/8bdf3580e6bcbb80.html" target="n" data-glyph="44,2" class="i field">StarOrQuestion</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;*&#39;</span>, <span class="s">&#39;?&#39;</span> };
            <b>internal static readonly char</b>[] <a id="928ae75b04c26cb4" href="../R/928ae75b04c26cb4.html" target="n" data-glyph="44,2" class="i field">ColonOrBackslash</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;\\&#39;</span>, <span class="s">&#39;:&#39;</span> };
            <b>internal static readonly char</b>[] <a id="016bc808c2acadd4" href="../R/016bc808c2acadd4.html" target="n" data-glyph="44,2" class="i field">PathSeparator</a> = <b>new</b> <b>char</b>[] { <span class="i">Path</span>.<span class="i">PathSeparator</span> };
 
            <b>internal static readonly char</b>[] <a id="45cd291214a65bbf" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">QuoteChars</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;\&#39;&#39;</span>, <span class="s">&#39;&quot;&#39;</span> };
            <b>internal static readonly char</b>[] <a id="ae9efc7d00636f59" href="../R/ae9efc7d00636f59.html" target="n" data-glyph="44,2" class="i field">Space</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39; &#39;</span> };
            <b>internal static readonly char</b>[] <a id="fed92797fe707e6f" href="../R/../../0000000000.html" target="n" data-glyph="44,2" class="i field">QuotesSpaceOrTab</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39; &#39;</span>, <span class="s">&#39;\t&#39;</span>, <span class="s">&#39;\&#39;&#39;</span>, <span class="s">&#39;&quot;&#39;</span> };
            <b>internal static readonly char</b>[] <a id="7558d85b44c5e428" href="../R/7558d85b44c5e428.html" target="n" data-glyph="44,2" class="i field">SpaceOrTab</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39; &#39;</span>, <span class="s">&#39;\t&#39;</span> };
            <b>internal static readonly char</b>[] <a id="f4b640ef9b5adf48" href="../R/f4b640ef9b5adf48.html" target="n" data-glyph="44,2" class="i field">Newline</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;\n&#39;</span> };
            <b>internal static readonly char</b>[] <a id="bac08b33e7613991" href="../R/bac08b33e7613991.html" target="n" data-glyph="44,2" class="i field">CrLf</a> = <b>new</b> <b>char</b>[] { <span class="s">&#39;\r&#39;</span>, <span class="s">&#39;\n&#39;</span> };
 
            <span class="c">// (Copied from System.IO.Path so we can call TrimEnd in the same way that Directory.EnumerateFiles would on the search patterns).</span>
            <span class="c">// Trim trailing white spaces, tabs etc but don&#39;t be aggressive in removing everything that has UnicodeCategory of trailing space.</span>
            <span class="c">// String.WhitespaceChars will trim aggressively than what the underlying FS does (for ex, NTFS, FAT).</span>
            <b>internal static readonly char</b>[] <a id="a30ec3eede1d04e5" href="../R/a30ec3eede1d04e5.html" target="n" data-glyph="44,2" class="i field">PathSearchTrimEnd</a> = { (<b>char</b>)0x9, (<b>char</b>)0xA, (<b>char</b>)0xB, (<b>char</b>)0xC, (<b>char</b>)0xD, (<b>char</b>)0x20, (<b>char</b>)0x85, (<b>char</b>)0xA0 };
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A COM object could be directly of the type &#39;System.__ComObject&#39;, or it could be a strongly typed RWC,</span>
        <span class="c">///</span><span class="c"> whose specific type derives from &#39;System.__ComObject&#39;.</span>
        <span class="c">///</span><span class="c"> A strongly typed RWC can be created via the &#39;new&#39; operation with a Primary Interop Assembly (PIA).</span>
        <span class="c">///</span><span class="c"> For example, with the PIA &#39;Microsoft.Office.Interop.Excel&#39;, you can write the following code:</span>
        <span class="c">///</span><span class="c">    var excelApp = new Microsoft.Office.Interop.Excel.Application();</span>
        <span class="c">///</span><span class="c">    Type type = excelApp.GetType();</span>
        <span class="c">///</span><span class="c">    Type comObjectType = typeof(object).Assembly.GetType(&quot;System.__ComObject&quot;);</span>
        <span class="c">///</span><span class="c">    Console.WriteLine(&quot;excelApp type: {0}&quot;, type.FullName);</span>
        <span class="c">///</span><span class="c">    Console.WriteLine(&quot;Is __ComObject assignable from? {0}&quot;, comObjectType.IsAssignableFrom(type));</span>
        <span class="c">///</span><span class="c"> and the results are:</span>
        <span class="c">///</span><span class="c">    excelApp type: Microsoft.Office.Interop.Excel.ApplicationClass</span>
        <span class="c">///</span><span class="c">    Is __ComObject assignable from? True.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="05fe9ce66a13db48" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsComObject</a>(<b>object</b> <span id="r208 rd" class="r208 r">obj</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return false;
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>return</b> <span class="r208 r">obj</span> != <b>null</b> &amp;&amp; <span class="i">Marshal</span>.<span class="i">IsComObject</span>(<span class="r208 r">obj</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> EnforceSystemLockDownLanguageMode</span>
        <span class="c">///</span><span class="c">     FullLangauge        -&gt;  ConstrainedLanguage</span>
        <span class="c">///</span><span class="c">     RestrictedLanguage  -&gt;  NoLanguage</span>
        <span class="c">///</span><span class="c">     ConstrainedLanguage -&gt;  ConstrainedLanguage</span>
        <span class="c">///</span><span class="c">     NoLanguage          -&gt;  NoLanguage.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">ExecutionContext.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Previous language mode or null for no language mode change.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>? <a id="dbcc27a19c6d4943" href="../R/dbcc27a19c6d4943.html" target="n" data-glyph="74,1" class="i method">EnforceSystemLockDownLanguageMode</a>(<a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r209 rd" class="r209 r">context</span>)
        {
            <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>? <span id="r210 rd" class="r210 r">oldMode</span> = <b>null</b>;
 
            <b>if</b> (<a href="../security/wldpNativeMethods.cs.html#6b51558a7a8cde26" class="t t">SystemPolicy</a>.<a href="../security/wldpNativeMethods.cs.html#2c0da8883146dab2" class="i method">GetSystemLockdownPolicy</a>() == <a href="../security/wldpNativeMethods.cs.html#9f0915f7b351778e" class="t t">SystemEnforcementMode</a>.<a href="../security/wldpNativeMethods.cs.html#5d74206001d0b817" class="i field">Enforce</a>)
            {
                <b>switch</b> (<span class="r209 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>)
                {
                    <b>case</b> <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>:
                        <span class="r210 r">oldMode</span> = <span class="r209 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>;
                        <span class="r209 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>;
                        <b>break</b>;
 
                    <b>case</b> <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#ea8105287b8c6b25" class="i field">RestrictedLanguage</a>:
                        <span class="r210 r">oldMode</span> = <span class="r209 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>;
                        <span class="r209 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#a659f53717c16b4b" class="i field">NoLanguage</a>;
                        <b>break</b>;
 
                    <b>case</b> <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>:
                    <b>case</b> <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#a659f53717c16b4b" class="i field">NoLanguage</a>:
                        <b>break</b>;
 
                    <b>default</b>:
                        <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Unexpected PSLanguageMode&quot;</span>);
                        <span class="r210 r">oldMode</span> = <span class="r209 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>;
                        <span class="r209 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#a659f53717c16b4b" class="i field">NoLanguage</a>;
                        <b>break</b>;
                }
            }
 
            <b>return</b> <span class="r210 r">oldMode</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> PSAnsiRendering
 
        <b>internal static bool</b> <a id="24c4a440ff6dbfe0" href="../R/24c4a440ff6dbfe0.html" target="n" data-glyph="74,1" class="i method">ShouldOutputPlainText</a>(<b>bool</b> <span id="r211 rd" class="r211 r">isHost</span>, <b>bool</b>? <span id="r212 rd" class="r212 r">supportsVirtualTerminal</span>)
        {
            <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="k">var</a> <span id="r213 rd" class="r213 r">outputRendering</span> = <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#7c15525879cb5021" class="i field">Ansi</a>;
 
            <b>if</b> (<span class="r212 r">supportsVirtualTerminal</span> != <b>false</b>)
            {
                <b>switch</b> (<a href="../FormatAndOutput/common/PSStyle.cs.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#a871a306861db3aa" class="i property">OutputRendering</a>)
                {
                    <b>case</b> <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#2bd11d5b33a1e4cc" class="i field">Host</a>:
                        <span class="r213 r">outputRendering</span> = <span class="r211 r">isHost</span> ? <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#7c15525879cb5021" class="i field">Ansi</a> : <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#bd2dfddf3028517b" class="i field">PlainText</a>;
                        <b>break</b>;
                    <b>default</b>:
                        <span class="r213 r">outputRendering</span> = <a href="../FormatAndOutput/common/PSStyle.cs.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#a871a306861db3aa" class="i property">OutputRendering</a>;
                        <b>break</b>;
                }
            }
 
            <b>return</b> <span class="r213 r">outputRendering</span> == <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#bd2dfddf3028517b" class="i field">PlainText</a>;
        }
 
        <b>internal static string</b> <a id="41f9193492b84495" href="../R/41f9193492b84495.html" target="n" data-glyph="74,1" class="i method">GetOutputString</a>(<b>string</b> <span id="r214 rd" class="r214 r">s</span>, <b>bool</b> <span id="r215 rd" class="r215 r">isHost</span>, <b>bool</b>? <span id="r216 rd" class="r216 r">supportsVirtualTerminal</span> = <b>null</b>, <b>bool</b> <span id="r217 rd" class="r217 r">isOutputRedirected</span> = <b>false</b>)
        {
            <a href="../FormatAndOutput/common/StringDecorated.cs.html#c4ddb2a2993f79b9" class="k">var</a> <span id="r218 rd" class="r218 r">sd</span> = <b>new</b> <a href="../FormatAndOutput/common/StringDecorated.cs.html#3833cb3fe7fffe53" class="t constructor">ValueStringDecorated</a>(<span class="r214 r">s</span>);
 
            <b>if</b> (<span class="r218 r">sd</span>.<a href="../FormatAndOutput/common/StringDecorated.cs.html#93ec27487cb62cf0" class="i property">IsDecorated</a>)
            {
                <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="k">var</a> <span id="r219 rd" class="r219 r">outputRendering</span> = <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#7c15525879cb5021" class="i field">Ansi</a>;
                <b>if</b> (<a href="#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="#8d53e95ad00e9884" class="i field">BypassOutputRedirectionCheck</a>)
                {
                    <span class="r217 r">isOutputRedirected</span> = <b>false</b>;
                }
 
                <b>if</b> (<span class="r217 r">isOutputRedirected</span> || <a href="#24c4a440ff6dbfe0" class="i method">ShouldOutputPlainText</a>(<span class="r215 r">isHost</span>, <span class="r216 r">supportsVirtualTerminal</span>))
                {
                    <span class="r219 r">outputRendering</span> = <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#bd2dfddf3028517b" class="i field">PlainText</a>;
                }
 
                <span class="r214 r">s</span> = <span class="r218 r">sd</span>.<a href="../FormatAndOutput/common/StringDecorated.cs.html#5db8a00d8d418e4d" class="i method">ToString</a>(<span class="r219 r">outputRendering</span>);
            }
 
            <b>return</b> <span class="r214 r">s</span>;
        }
 
        <b>internal enum</b> <a id="21ab2f666464040e" href="../R/21ab2f666464040e.html" target="n" data-glyph="20,1" class="t t"><span id="261c46d8496e29af">FormatStyle</span></a>
        {
            <a id="8913ac1f9c486eb8" href="../R/8913ac1f9c486eb8.html" target="n" data-glyph="24,2" class="i field">Reset</a>,
            <a id="6e2c1c05a1e5ccd5" href="../R/6e2c1c05a1e5ccd5.html" target="n" data-glyph="24,2" class="i field">FormatAccent</a>,
            <a id="c96a062f628509c3" href="../R/c96a062f628509c3.html" target="n" data-glyph="24,2" class="i field">TableHeader</a>,
            <a id="169b2e3c622b866b" href="../R/169b2e3c622b866b.html" target="n" data-glyph="24,2" class="i field">ErrorAccent</a>,
            <a id="0c24c0de4989e901" href="../R/0c24c0de4989e901.html" target="n" data-glyph="24,2" class="i field">Error</a>,
            <a id="7e25d55982b4f90f" href="../R/7e25d55982b4f90f.html" target="n" data-glyph="24,2" class="i field">Warning</a>,
            <a id="d0629135e2bcbf73" href="../R/d0629135e2bcbf73.html" target="n" data-glyph="24,2" class="i field">Verbose</a>,
            <a id="b11ec9dd94f6bfd4" href="../R/b11ec9dd94f6bfd4.html" target="n" data-glyph="24,2" class="i field">Debug</a>,
        }
 
        <b>internal static string</b> <a id="9949c3db4d281302" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetFormatStyleString</a>(<a href="#21ab2f666464040e" class="t t">FormatStyle</a> <span id="r220 rd" class="r220 r">formatStyle</span>)
        {
            <span class="c">// redirected console gets plaintext output to preserve existing behavior</span>
            <b>if</b> (!<a href="#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="#8d53e95ad00e9884" class="i field">BypassOutputRedirectionCheck</a> &amp;&amp;
                ((<a href="../FormatAndOutput/common/PSStyle.cs.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#f7875006d0bc55f1" class="i property">Instance</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#a871a306861db3aa" class="i property">OutputRendering</a> == <a href="../FormatAndOutput/common/PSStyle.cs.html#aaed168a484b0007" class="t t">OutputRendering</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#bd2dfddf3028517b" class="i field">PlainText</a>) ||
                (<span class="r220 r">formatStyle</span> == <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#0c24c0de4989e901" class="i field">Error</a> &amp;&amp; <span class="i">Console</span>.<span class="i">IsErrorRedirected</span>) ||
                (<span class="r220 r">formatStyle</span> != <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#0c24c0de4989e901" class="i field">Error</a> &amp;&amp; <span class="i">Console</span>.<span class="i">IsOutputRedirected</span>)))
            {
                <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
 
            <a href="../FormatAndOutput/common/PSStyle.cs.html#340d221c8aa09678" class="t t">PSStyle</a> <span id="r221 rd" class="r221 r">psstyle</span> = <a href="../FormatAndOutput/common/PSStyle.cs.html#340d221c8aa09678" class="t t">PSStyle</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#f7875006d0bc55f1" class="i property">Instance</a>;                
            <b>switch</b> (<span class="r220 r">formatStyle</span>)
            {
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#8913ac1f9c486eb8" class="i field">Reset</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#0b1059dd37953926" class="i property">Reset</a>;
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#6e2c1c05a1e5ccd5" class="i field">FormatAccent</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#994226c730f84059" class="i property">Formatting</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#cc52ac108245f53d" class="i property">FormatAccent</a>;
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#c96a062f628509c3" class="i field">TableHeader</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#994226c730f84059" class="i property">Formatting</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#4634e78ec9d162e5" class="i property">TableHeader</a>;
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#169b2e3c622b866b" class="i field">ErrorAccent</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#994226c730f84059" class="i property">Formatting</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#7ed176430d2429fe" class="i property">ErrorAccent</a>;
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#0c24c0de4989e901" class="i field">Error</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#994226c730f84059" class="i property">Formatting</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#ab4c38275ac21bd4" class="i property">Error</a>;
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#7e25d55982b4f90f" class="i field">Warning</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#994226c730f84059" class="i property">Formatting</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#2d57cabfcd42db66" class="i property">Warning</a>;
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#d0629135e2bcbf73" class="i field">Verbose</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#994226c730f84059" class="i property">Formatting</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#bf779c82e263ef9d" class="i property">Verbose</a>;
                <b>case</b> <a href="#21ab2f666464040e" class="t t">FormatStyle</a>.<a href="#b11ec9dd94f6bfd4" class="i field">Debug</a>:
                    <b>return</b> <span class="r221 r">psstyle</span>.<a href="../FormatAndOutput/common/PSStyle.cs.html#994226c730f84059" class="i property">Formatting</a>.<a href="../FormatAndOutput/common/PSStyle.cs.html#fd3ae5ed18692133" class="i property">Debug</a>;
                <b>default</b>:
                    <b>return</b> <b>string</b>.<span class="i">Empty</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">This class is used for internal test purposes.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.MSInternal&quot;</span>, <span class="s">&quot;CA903:InternalNamespaceShouldNotContainPublicTypes&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Needed Internal use only&quot;</span>)]
    <b>public static class</b> <a id="f365eaa75311eda0" href="../R/f365eaa75311eda0.html" target="n" data-glyph="0,0" class="t t">InternalTestHooks</a>
    {
        <b>internal static bool</b> <a id="de82c6590fd7de27" href="../R/de82c6590fd7de27.html" target="n" data-glyph="44,1" class="i field">BypassGroupPolicyCaching</a>;
        <b>internal static bool</b> <a id="60588f95c91db986" href="../R/60588f95c91db986.html" target="n" data-glyph="44,1" class="i field">ForceScriptBlockLogging</a>;
        <b>internal static bool</b> <a id="3172c8cec3dfcb9d" href="../R/3172c8cec3dfcb9d.html" target="n" data-glyph="44,1" class="i field">UseDebugAmsiImplementation</a>;
        <b>internal static bool</b> <a id="bbc04dd553528929" href="../R/bbc04dd553528929.html" target="n" data-glyph="44,1" class="i field">BypassAppLockerPolicyCaching</a>;
        <b>internal static bool</b> <a id="1ac48e16298071ba" href="../R/1ac48e16298071ba.html" target="n" data-glyph="44,1" class="i field">BypassOnlineHelpRetrieval</a>;
        <b>internal static bool</b> <a id="65709a9a331108b6" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">ForcePromptForChoiceDefaultOption</a>;
        <b>internal static bool</b> <a id="8d53e95ad00e9884" href="../R/8d53e95ad00e9884.html" target="n" data-glyph="44,1" class="i field">BypassOutputRedirectionCheck</a>;
        <b>internal static bool</b> <a id="06700d0a903c0da4" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">NoPromptForPassword</a>;
        <b>internal static bool</b> <a id="76cf6a0620456706" href="../R/76cf6a0620456706.html" target="n" data-glyph="44,1" class="i field">ForceFormatListFixedLabelWidth</a>;
 
        <span class="c">// Stop/Restart/Rename Computer tests</span>
        <b>internal static bool</b> <a id="c67da12aa510144f" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">TestStopComputer</a>;
        <b>internal static bool</b> <a id="c62a74d90f332f7e" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">TestWaitStopComputer</a>;
        <b>internal static bool</b> <a id="f94881c907f6fad5" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">TestRenameComputer</a>;
        <b>internal static int</b> <a id="e1a1741fbb0c0ce7" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">TestStopComputerResults</a>;
        <b>internal static int</b> <a id="8f77d2a5f5f4ee9d" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">TestRenameComputerResults</a>;
 
        <span class="c">// It&#39;s useful to test that we don&#39;t depend on the ScriptBlock and AST objects and can use a re-parsed version.</span>
        <b>internal static bool</b> <a id="a188e382998526ae" href="../R/a188e382998526ae.html" target="n" data-glyph="44,1" class="i field">IgnoreScriptBlockCache</a>;
        <span class="c">// Simulate &#39;System.Diagnostics.Stopwatch.IsHighResolution is false&#39; to test Get-Uptime throw</span>
        <b>internal static bool</b> <a id="7c25de607f512e82" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">StopwatchIsNotHighResolution</a>;
        <b>internal static bool</b> <a id="465f5deb46e7a9cb" href="../R/465f5deb46e7a9cb.html" target="n" data-glyph="44,1" class="i field">DisableGACLoading</a>;
        <b>internal static bool</b> <a id="eceb430589b651ca" href="../R/eceb430589b651ca.html" target="n" data-glyph="44,1" class="i field">SetConsoleWidthToZero</a>;
        <b>internal static bool</b> <a id="e6a1ce5eceaa5326" href="../R/e6a1ce5eceaa5326.html" target="n" data-glyph="44,1" class="i field">SetConsoleHeightToZero</a>;
 
        <span class="c">// A location to test PSEdition compatibility functionality for Windows PowerShell modules with</span>
        <span class="c">// since we can&#39;t manipulate the System32 directory in a test</span>
        <b>internal static string</b> <a id="b8dcd5e111afc295" href="../R/b8dcd5e111afc295.html" target="n" data-glyph="44,1" class="i field">TestWindowsPowerShellPSHomeLocation</a>;
 
        <span class="c">// A version of Windows PS that is installed on the system; normally this is retrieved from a reg key that is write-protected.</span>
        <b>internal static string</b> <a id="cc79ccfaa36b4962" href="../R/cc79ccfaa36b4962.html" target="n" data-glyph="44,1" class="i field">TestWindowsPowerShellVersionString</a>;
 
        <b>internal static bool</b> <a id="622dc2487a57e8c2" href="../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">ShowMarkdownOutputBypass</a>;
 
        <b>internal static bool</b> <a id="7ab5bd80fb0edd04" href="../R/7ab5bd80fb0edd04.html" target="n" data-glyph="44,1" class="i field">ThrowExdevErrorOnMoveDirectory</a>;
 
        <span class="c">// To emulate OneDrive behavior we use the hard-coded symlink.</span>
        <span class="c">// If OneDriveTestRecurseOn is false then the symlink works as regular symlink.</span>
        <span class="c">// If OneDriveTestRecurseOn is true then we recurse into the symlink as OneDrive should work.</span>
        <span class="c">// OneDriveTestSymlinkName defines the symlink name used in tests.</span>
        <b>internal static bool</b> <a id="9f1ecef5221b3e20" href="../R/9f1ecef5221b3e20.html" target="n" data-glyph="44,1" class="i field">OneDriveTestOn</a>;
        <b>internal static bool</b> <a id="ef7c978c6f943e37" href="../R/ef7c978c6f943e37.html" target="n" data-glyph="44,1" class="i field">OneDriveTestRecurseOn</a>;
        <b>internal static string</b> <a id="693288444174cf3b" href="../R/693288444174cf3b.html" target="n" data-glyph="44,1" class="i field">OneDriveTestSymlinkName</a> = <span class="s">&quot;link-Beta&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">This member is used for internal test purposes.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="c99a279a1fa6fa27" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetTestHook</a>(<b>string</b> <span id="r222 rd" class="r222 r">property</span>, <b>object</b> <span id="r223 rd" class="r223 r">value</span>)
        {
            <b>var</b> <span id="r224 rd" class="r224 r">fieldInfo</span> = <b>typeof</b>(<a href="#f365eaa75311eda0" class="t t">InternalTestHooks</a>).<span class="i">GetField</span>(<span class="r222 r">property</span>, <span class="i">BindingFlags</span>.<span class="i">Static</span> | <span class="i">BindingFlags</span>.<span class="i">NonPublic</span>);
            <b>if</b> (<span class="r224 r">fieldInfo</span> != <b>null</b>)
            {
                <span class="r224 r">fieldInfo</span>.<span class="i">SetValue</span>(<b>null</b>, <span class="r223 r">value</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs a custom PSSenderInfo instance that can be assigned to $PSSenderInfo</span>
        <span class="c">///</span><span class="c"> in order to simulate a remoting session with respect to the $PSSenderInfo.ConnectionString (connection URL)</span>
        <span class="c">///</span><span class="c"> and $PSSenderInfo.ApplicationArguments.PSVersionTable.PSVersion (the remoting client&#39;s PowerShell version).</span>
        <span class="c">///</span><span class="c"> See Get-FormatDataTest.ps1.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r225 r">url</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The connection URL to reflect in the returned instance&#39;s ConnectionString property.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r226 r">clientVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version number to report as the remoting client&#39;s PowerShell version.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The newly constructed custom PSSenderInfo instance.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="remoting/fanin/PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <a id="b1f360d63ea5e3b4" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetCustomPSSenderInfo</a>(<b>string</b> <span id="r225 rd" class="r225 r">url</span>, <span class="i">Version</span> <span id="r226 rd" class="r226 r">clientVersion</span>)
        {
            <a href="remoting/fanin/PSPrincipal.cs.html#f38f79fd26abc753" class="k">var</a> <span id="r227 rd" class="r227 r">dummyPrincipal</span> = <b>new</b> <a href="remoting/fanin/PSPrincipal.cs.html#9fa65de366a45f51" class="t constructor">PSPrincipal</a>(<b>new</b> <a href="remoting/fanin/PSPrincipal.cs.html#3c9c1564875caeb1" class="t constructor">PSIdentity</a>(<span class="s">&quot;none&quot;</span>, <b>true</b>, <span class="s">&quot;someuser&quot;</span>, <b>null</b>), <b>null</b>);
            <a href="remoting/fanin/PSPrincipal.cs.html#eeedcf9113508cb9" class="k">var</a> <span id="r228 rd" class="r228 r">pssi</span> = <b>new</b> <a href="remoting/fanin/PSPrincipal.cs.html#041d397e8ed43c11" class="t constructor">PSSenderInfo</a>(<span class="r227 r">dummyPrincipal</span>, <span class="r225 r">url</span>);
            <span class="r228 r">pssi</span>.<a href="remoting/fanin/PSPrincipal.cs.html#fbb9c1201251c818" class="i property">ApplicationArguments</a> = <b>new</b> <a href="serialization.cs.html#8d1ee4ea90ea9904" class="t constructor">PSPrimitiveDictionary</a>();
            <span class="r228 r">pssi</span>.<a href="remoting/fanin/PSPrincipal.cs.html#fbb9c1201251c818" class="i property">ApplicationArguments</a>.<a href="serialization.cs.html#6c56b64af5b281e9" class="i method">Add</a>(<span class="s">&quot;PSVersionTable&quot;</span>, <b>new</b> <a href="MshObject.cs.html#3ee1d75e736c4afc" class="t constructor">PSObject</a>(<b>new</b> <a href="serialization.cs.html#8d1ee4ea90ea9904" class="t constructor">PSPrimitiveDictionary</a>()));
            ((<a href="serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a>)<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r228 r">pssi</span>.<a href="remoting/fanin/PSPrincipal.cs.html#fbb9c1201251c818" class="i property">ApplicationArguments</a><a href="serialization.cs.html#ef1aa37a4f65ba77">[</a><span class="s">&quot;PSVersionTable&quot;</span>])).<a href="serialization.cs.html#6c56b64af5b281e9" class="i method">Add</a>(<span class="s">&quot;PSVersion&quot;</span>, <b>new</b> <span class="t">PSObject</span>(<span class="r226 r">clientVersion</span>));
            <b>return</b> <span class="r228 r">pssi</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provides undo/redo functionality by using 2 instances of </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#950d9957a16b0330" class="t t">BoundedStack</a>{<span class="r229 r t">T</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="719c49f3889c4be6" href="../R/719c49f3889c4be6.html" target="n" data-glyph="2,0" class="t t">HistoryStack</a>&lt;<span id="r230 rd t" class="r230 r t">T</span>&gt;
    {
        <b>private readonly</b> <a href="#950d9957a16b0330" class="t t">BoundedStack</a>&lt;<span class="r230 r t">T</span>&gt; <a id="7bc58aae75510b50" href="../R/7bc58aae75510b50.html" target="n" data-glyph="46,1" class="i field">_boundedUndoStack</a>;
        <b>private readonly</b> <a href="#950d9957a16b0330" class="t t">BoundedStack</a>&lt;<span class="r230 r t">T</span>&gt; <a id="fe653e75f0771e04" href="../R/fe653e75f0771e04.html" target="n" data-glyph="46,1" class="i field">_boundedRedoStack</a>;
 
        <b>internal</b> <a id="b7824ff6130c3c98" href="../R/b7824ff6130c3c98.html" target="n" data-glyph="74,1" class="t constructor">HistoryStack</a>(<b>int</b> <span id="r231 rd" class="r231 r">capacity</span>)
        {
            <a href="#7bc58aae75510b50" class="i field">_boundedUndoStack</a> = <b>new</b> <a href="#ba3ecd4aca98f573" class="t constructor">BoundedStack</a>&lt;<span class="r230 r t">T</span>&gt;(<span class="r231 r">capacity</span>);
            <a href="#fe653e75f0771e04" class="i field">_boundedRedoStack</a> = <b>new</b> <a href="#ba3ecd4aca98f573" class="t constructor">BoundedStack</a>&lt;<span class="r230 r t">T</span>&gt;(<span class="r231 r">capacity</span>);
        }
 
        <b>internal void</b> <a id="cad99e613b3ba9d0" href="../R/cad99e613b3ba9d0.html" target="n" data-glyph="74,1" class="i method">Push</a>(<span class="r230 r t">T</span> <span id="r232 rd" class="r232 r">item</span>)
        {
            <a href="#7bc58aae75510b50" class="i field">_boundedUndoStack</a>.<a href="#45e67e024064fd4d" class="i method">Push</a>(<span class="r232 r">item</span>);
            <b>if</b> (<a href="#20fee02422a3edf9" class="i property">RedoCount</a> &gt;= 0)
            {
                <a href="#fe653e75f0771e04" class="i field">_boundedRedoStack</a>.<span class="i">Clear</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handles bounded history stacks by pushing the current item to the redoStack and returning the item from the popped undoStack.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="r230 r t">T</span> <a id="6ad647b78e73f051" href="../R/6ad647b78e73f051.html" target="n" data-glyph="74,1" class="i method">Undo</a>(<span class="r230 r t">T</span> <span id="r233 rd" class="r233 r">currentItem</span>)
        {
            <span class="r230 r t">T</span> <span id="r234 rd" class="r234 r">previousItem</span> = <a href="#7bc58aae75510b50" class="i field">_boundedUndoStack</a>.<a href="#c0e027a494281c7c" class="i method">Pop</a>();
            <a href="#fe653e75f0771e04" class="i field">_boundedRedoStack</a>.<a href="#45e67e024064fd4d" class="i method">Push</a>(<span class="r233 r">currentItem</span>);
            <b>return</b> <span class="r234 r">previousItem</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handles bounded history stacks by pushing the current item to the undoStack and returning the item from the popped redoStack.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="r230 r t">T</span> <a id="c80008ebea9ff0eb" href="../R/c80008ebea9ff0eb.html" target="n" data-glyph="74,1" class="i method">Redo</a>(<span class="r230 r t">T</span> <span id="r235 rd" class="r235 r">currentItem</span>)
        {
            <span class="r230 r t">var</span> <span id="r236 rd" class="r236 r">nextItem</span> = <a href="#fe653e75f0771e04" class="i field">_boundedRedoStack</a>.<a href="#c0e027a494281c7c" class="i method">Pop</a>();
            <a href="#7bc58aae75510b50" class="i field">_boundedUndoStack</a>.<a href="#45e67e024064fd4d" class="i method">Push</a>(<span class="r235 r">currentItem</span>);
            <b>return</b> <span class="r236 r">nextItem</span>;
        }
 
        <b>internal int</b> <a id="24f8a58e6783bdc9" href="../R/24f8a58e6783bdc9.html" target="n" data-glyph="104,1" class="i property">UndoCount</a> =&gt; <a href="#7bc58aae75510b50" class="i field">_boundedUndoStack</a>.<span class="i">Count</span>;
 
        <b>internal int</b> <a id="20fee02422a3edf9" href="../R/20fee02422a3edf9.html" target="n" data-glyph="104,1" class="i property">RedoCount</a> =&gt; <a href="#fe653e75f0771e04" class="i field">_boundedRedoStack</a>.<span class="i">Count</span>;
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A bounded stack based on a linked list.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="950d9957a16b0330" href="../R/950d9957a16b0330.html" target="n" data-glyph="2,0" class="t t">BoundedStack</a>&lt;<span id="r237 rd t" class="r237 r t">T</span>&gt; : <span class="i">LinkedList</span>&lt;<span class="r237 r t">T</span>&gt;
    {
        <b>private readonly int</b> <a id="b1a282e024589988" href="../R/b1a282e024589988.html" target="n" data-glyph="46,1" class="i field">_capacity</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Lazy initialisation, i.e. it sets only its limit but does not allocate the memory for the given capacity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r238 r">capacity</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="ba3ecd4aca98f573" href="../R/ba3ecd4aca98f573.html" target="n" data-glyph="74,1" class="t constructor">BoundedStack</a>(<b>int</b> <span id="r238 rd" class="r238 r">capacity</span>)
        {
            <a href="#b1a282e024589988" class="i field">_capacity</a> = <span class="r238 r">capacity</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Push item.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r239 r">item</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="45e67e024064fd4d" href="../R/45e67e024064fd4d.html" target="n" data-glyph="74,1" class="i method">Push</a>(<span class="r237 r t">T</span> <span id="r239 rd" class="r239 r">item</span>)
        {
            <a href="#950d9957a16b0330" class="k">this</a>.<span class="i">AddFirst</span>(<span class="r239 r">item</span>);
 
            <b>if</b> (<a href="#950d9957a16b0330" class="k">this</a>.<span class="i">Count</span> &gt; <a href="#b1a282e024589988" class="i field">_capacity</a>)
            {
                <a href="#950d9957a16b0330" class="k">this</a>.<span class="i">RemoveLast</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Pop item.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="r237 r t">T</span> <a id="c0e027a494281c7c" href="../R/c0e027a494281c7c.html" target="n" data-glyph="74,1" class="i method">Pop</a>()
        {
            <b>if</b> (<a href="#950d9957a16b0330" class="k">this</a>.<span class="i">First</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">SessionStateStrings</span>.<span class="i">BoundedStackIsEmpty</span>);
            }
 
            <b>var</b> <span id="r240 rd" class="r240 r">item</span> = <a href="#950d9957a16b0330" class="k">this</a>.<span class="i">First</span>.<span class="i">Value</span>;
            <b>try</b>
            {
                <a href="#950d9957a16b0330" class="k">this</a>.<span class="i">RemoveFirst</span>();
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">SessionStateStrings</span>.<span class="i">BoundedStackIsEmpty</span>);
            }
 
            <b>return</b> <span class="r240 r">item</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A readonly Hashset.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="c140db2e16ef0555" href="../R/c140db2e16ef0555.html" target="n" data-glyph="2,0" class="t t">ReadOnlyBag</a>&lt;<span id="r241 rd t" class="r241 r t">T</span>&gt; : <span class="i">IEnumerable</span>
    {
        <b>private readonly</b> <span class="i">HashSet</span>&lt;<span class="r241 r t">T</span>&gt; <a id="e8e85e8181bb1ae5" href="../R/e8e85e8181bb1ae5.html" target="n" data-glyph="46,1" class="i field">_hashset</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for the readonly Hashset.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="fda2e3fe5c8576f8" href="../R/fda2e3fe5c8576f8.html" target="n" data-glyph="74,1" class="t constructor">ReadOnlyBag</a>(<span class="i">HashSet</span>&lt;<span class="r241 r t">T</span>&gt; <span id="r242 rd" class="r242 r">hashset</span>)
        {
            <b>if</b> (<span class="r242 r">hashset</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r242 r">hashset</span>));
            }
 
            <a href="#e8e85e8181bb1ae5" class="i field">_hashset</a> = <span class="r242 r">hashset</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the count of the Hashset.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public int</b> <a id="b8b4116f79378bf3" href="../R/b8b4116f79378bf3.html" target="n" data-glyph="102,1" class="i property">Count</a> =&gt; <a href="#e8e85e8181bb1ae5" class="i field">_hashset</a>.<span class="i">Count</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicate if it&#39;s a readonly Hashset.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="8ad3ea307382902d" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">IsReadOnly</a> =&gt; <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the set contains an item.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="c256f66b23584a5f" href="../R/c256f66b23584a5f.html" target="n" data-glyph="72,1" class="i method">Contains</a>(<span class="r241 r t">T</span> <span id="r243 rd" class="r243 r">item</span>) =&gt; <a href="#e8e85e8181bb1ae5" class="i field">_hashset</a>.<span class="i">Contains</span>(<span class="r243 r">item</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> GetEnumerator method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="i">IEnumerator</span> <a id="0a8e8fb84bbe2135" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetEnumerator</a>() =&gt; <a href="#e8e85e8181bb1ae5" class="i field">_hashset</a>.<span class="i">GetEnumerator</span>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get an empty singleton.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static readonly</b> <a href="#c140db2e16ef0555" class="t t">ReadOnlyBag</a>&lt;<span class="r241 r t">T</span>&gt; <a id="f38b353b7f12ff23" href="../R/f38b353b7f12ff23.html" target="n" data-glyph="44,1" class="i field">Empty</a> = <b>new</b> <a href="#fda2e3fe5c8576f8" class="t constructor">ReadOnlyBag</a>&lt;<span class="r241 r t">T</span>&gt;(<b>new</b> <span class="i">HashSet</span>&lt;<span class="r241 r t">T</span>&gt;(<span class="i">capacity</span>: 0));
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Helper class for simple argument validations.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="e78607cf01bce0bc" href="../R/e78607cf01bce0bc.html" target="n" data-glyph="2,0" class="t t">Requires</a>
    {
        <b>internal static void</b> <a id="3ccd539550c9f90e" href="../R/3ccd539550c9f90e.html" target="n" data-glyph="74,1" class="i method">NotNull</a>(<b>object</b> <span id="r244 rd" class="r244 r">value</span>, <b>string</b> <span id="r245 rd" class="r245 r">paramName</span>)
        {
            <b>if</b> (<span class="r244 r">value</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<span class="r245 r">paramName</span>);
            }
        }
 
        <b>internal static void</b> <a id="4a6aac070fc8ea73" href="../R/4a6aac070fc8ea73.html" target="n" data-glyph="74,1" class="i method">NotNullOrEmpty</a>(<b>string</b> <span id="r246 rd" class="r246 r">value</span>, <b>string</b> <span id="r247 rd" class="r247 r">paramName</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r246 r">value</span>))
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<span class="r247 r">paramName</span>);
            }
        }
 
        <b>internal static void</b> <a id="addd592cb80cfa71" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">NotNullOrEmpty</a>(<span class="i">ICollection</span> <span id="r248 rd" class="r248 r">value</span>, <b>string</b> <span id="r249 rd" class="r249 r">paramName</span>)
        {
            <b>if</b> (<span class="r248 r">value</span> == <b>null</b> || <span class="r248 r">value</span>.<span class="i">Count</span> == 0)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<span class="r249 r">paramName</span>);
            }
        }
 
        <b>internal static void</b> <a id="c0df78c81f7081de" href="../R/c0df78c81f7081de.html" target="n" data-glyph="74,1" class="i method">Condition</a>([<span class="i">DoesNotReturnIf</span>(<b>false</b>)] <b>bool</b> <span id="r250 rd" class="r250 r">precondition</span>, <b>string</b> <span id="r251 rd" class="r251 r">paramName</span>)
        {
            <b>if</b> (!<span class="r250 r">precondition</span>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<span class="r251 r">paramName</span>);
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
