<!DOCTYPE html>
<html><head><title>CompletionAnalysis.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(2205);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/CommandCompletion/CompletionAnalysis.cs" target="_top">engine\CommandCompletion\CompletionAnalysis.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Subsystem</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Subsystem</span>.<span class="i n">DSC</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <b>internal class</b> <a id="f4bb7b26e8be6324" href="../../R/f4bb7b26e8be6324.html" target="n" data-glyph="2,0" class="t t"><span id="a8893d578bfbe50e">CompletionContext</span></a>
    {
        <b>internal</b> <span class="i">List</span>&lt;<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <a id="c4b25a4935fa7b79" href="../../R/c4b25a4935fa7b79.html" target="n" data-glyph="104,1" class="i property">RelatedAsts</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">// Only one of TokenAtCursor or TokenBeforeCursor is set</span>
        <span class="c">// This is how we can tell if we&#39;re trying to complete part of something (like a member)</span>
        <span class="c">// or complete an argument, where TokenBeforeCursor could be a parameter name.</span>
        <b>internal</b> <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <a id="63bd97dbd0ed3b94" href="../../R/63bd97dbd0ed3b94.html" target="n" data-glyph="104,1" class="i property">TokenAtCursor</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <a id="13e001aeea27aaa6" href="../../R/13e001aeea27aaa6.html" target="n" data-glyph="104,1" class="i property">TokenBeforeCursor</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <a id="cf83a017dd6fc3e8" href="../../R/cf83a017dd6fc3e8.html" target="n" data-glyph="104,1" class="i property">CursorPosition</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <a href="../../utils/PowerShellExecutionHelper.cs.html#4790f0f05d781b55" class="t t">PowerShellExecutionHelper</a> <a id="f944e077619447e4" href="../../R/f944e077619447e4.html" target="n" data-glyph="104,1" class="i property">Helper</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <span class="i">Hashtable</span> <a id="f3f4d193708c896f" href="../../R/f3f4d193708c896f.html" target="n" data-glyph="104,1" class="i property">Options</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <a id="d7d397e503f13ffb" href="../../R/d7d397e503f13ffb.html" target="n" data-glyph="104,1" class="i property">CustomArgumentCompleters</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>&gt; <a id="e6b0eb9fc41f5838" href="../../R/e6b0eb9fc41f5838.html" target="n" data-glyph="104,1" class="i property">NativeArgumentCompleters</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal string</b> <a id="cf3f9752b9748c9c" href="../../R/cf3f9752b9748c9c.html" target="n" data-glyph="104,1" class="i property">WordToComplete</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal int</b> <a id="2d472ecad9988a80" href="../../R/2d472ecad9988a80.html" target="n" data-glyph="104,1" class="i property">ReplacementIndex</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal int</b> <a id="c219030db690057a" href="../../R/c219030db690057a.html" target="n" data-glyph="104,1" class="i property">ReplacementLength</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="4055c622a2008ac8" href="../../R/4055c622a2008ac8.html" target="n" data-glyph="104,1" class="i property">ExecutionContext</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <a href="PseudoParameterBinder.cs.html#5ac9244be24c2bbd" class="t t">PseudoBindingInfo</a> <a id="aa0594eac663bfde" href="../../R/aa0594eac663bfde.html" target="n" data-glyph="104,1" class="i property">PseudoBindingInfo</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <a href="../parser/TypeInferenceVisitor.cs.html#475e6219e3f308ae" class="t t">TypeInferenceContext</a> <a id="95d0769179a8633b" href="../../R/95d0769179a8633b.html" target="n" data-glyph="104,1" class="i property">TypeInferenceContext</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal bool</b> <a id="21758d2e318f92cc" href="../../R/21758d2e318f92cc.html" target="n" data-glyph="74,1" class="i method">GetOption</a>(<b>string</b> <span id="r0 rd" class="r0 r">option</span>, <b>bool</b> <span id="r1 rd" class="r1 r">@default</span>)
        {
            <b>if</b> (<a href="#f3f4d193708c896f" class="i property">Options</a> == <b>null</b> || !<a href="#f3f4d193708c896f" class="i property">Options</a>.<span class="i">ContainsKey</span>(<span class="r0 r">option</span>))
            {
                <b>return</b> <span class="r1 r">@default</span>;
            }
 
            <b>return</b> <a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>&lt;<b>bool</b>&gt;(<a href="#f3f4d193708c896f" class="i property">Options</a>[<span class="r0 r">option</span>]);
        }
    }
 
    <b>internal class</b> <a id="978ec9faf3baf106" href="../../R/978ec9faf3baf106.html" target="n" data-glyph="2,0" class="t t">CompletionAnalysis</a>
    {
        <b>private readonly</b> <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <a id="1994043b9b09d1fe" href="../../R/1994043b9b09d1fe.html" target="n" data-glyph="46,1" class="i field">_ast</a>;
        <b>private readonly</b> <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[] <a id="2b2e6f8adffb2817" href="../../R/2b2e6f8adffb2817.html" target="n" data-glyph="46,1" class="i field">_tokens</a>;
        <b>private readonly</b> <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <a id="97fcb2c0e771fbe7" href="../../R/97fcb2c0e771fbe7.html" target="n" data-glyph="46,1" class="i field">_cursorPosition</a>;
        <b>private readonly</b> <span class="i">Hashtable</span> <a id="868c6de52bceecc5" href="../../R/868c6de52bceecc5.html" target="n" data-glyph="46,1" class="i field">_options</a>;
 
        <b>internal</b> <a id="b6ce3ec3700571b3" href="../../R/b6ce3ec3700571b3.html" target="n" data-glyph="74,1" class="t constructor">CompletionAnalysis</a>(<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r2 rd" class="r2 r">ast</span>, <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[] <span id="r3 rd" class="r3 r">tokens</span>, <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r4 rd" class="r4 r">cursorPosition</span>, <span class="i">Hashtable</span> <span id="r5 rd" class="r5 r">options</span>)
        {
            <a href="#1994043b9b09d1fe" class="i field">_ast</a> = <span class="r2 r">ast</span>;
            <a href="#2b2e6f8adffb2817" class="i field">_tokens</a> = <span class="r3 r">tokens</span>;
            <a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a> = <span class="r4 r">cursorPosition</span>;
            <a href="#868c6de52bceecc5" class="i field">_options</a> = <span class="r5 r">options</span>;
        }
 
        <b>private static bool</b> <a id="231a6db287114e0a" href="../../R/231a6db287114e0a.html" target="n" data-glyph="76,1" class="i method">IsInterestingToken</a>(<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r6 rd" class="r6 r">token</span>)
        {
            <b>return</b> <span class="r6 r">token</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> != <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#c105a5282a4e4395" class="i field">NewLine</a> &amp;&amp; <span class="r6 r">token</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> != <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#600440634a32d0c4" class="i field">EndOfInput</a>;
        }
 
        <b>private static bool</b> <a id="3ed3a5ced7abae07" href="../../R/3ed3a5ced7abae07.html" target="n" data-glyph="76,1" class="i method">IsCursorWithinOrJustAfterExtent</a>(<a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r7 rd" class="r7 r">cursor</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r8 rd" class="r8 r">extent</span>)
        {
            <b>return</b> <span class="r7 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &gt; <span class="r8 r">extent</span>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a> &amp;&amp; <span class="r7 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &lt;= <span class="r8 r">extent</span>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>;
        }
 
        <b>private static bool</b> <a id="cf3442bcf4f1e10c" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsCursorRightAfterExtent</a>(<a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r9 rd" class="r9 r">cursor</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r10 rd" class="r10 r">extent</span>)
        {
            <b>return</b> <span class="r9 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> == <span class="r10 r">extent</span>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>;
        }
 
        <b>private static bool</b> <a id="ee6cce2ff8fb1cd0" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsCursorAfterExtentAndInTheSameLine</a>(<a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r11 rd" class="r11 r">cursor</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r12 rd" class="r12 r">extent</span>)
        {
            <b>return</b> <span class="r11 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &gt;= <span class="r12 r">extent</span>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a> &amp;&amp; <span class="r12 r">extent</span>.<a href="../parser/Position.cs.html#ccd649a5269e237d" class="i property">EndLineNumber</a> == <span class="r11 r">cursor</span>.<a href="../parser/Position.cs.html#d4acfffbdddc618b" class="i property">LineNumber</a>;
        }
 
        <b>private static bool</b> <a id="6a3a6821cae2bf9d" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsCursorBeforeExtent</a>(<a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r13 rd" class="r13 r">cursor</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r14 rd" class="r14 r">extent</span>)
        {
            <b>return</b> <span class="r13 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &lt; <span class="r14 r">extent</span>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a>;
        }
 
        <b>private static bool</b> <a id="ede1024ee569b083" href="../../R/ede1024ee569b083.html" target="n" data-glyph="76,1" class="i method">IsCursorAfterExtent</a>(<a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r15 rd" class="r15 r">cursor</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r16 rd" class="r16 r">extent</span>)
        {
            <b>return</b> <span class="r16 r">extent</span>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a> &lt; <span class="r15 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
        }
 
        <b>private static bool</b> <a id="15755919009fa144" href="../../R/15755919009fa144.html" target="n" data-glyph="76,1" class="i method">IsCursorOutsideOfExtent</a>(<a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r17 rd" class="r17 r">cursor</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r18 rd" class="r18 r">extent</span>)
        {
            <b>return</b> <span class="r17 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &lt; <span class="r18 r">extent</span>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a> || <span class="r17 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &gt; <span class="r18 r">extent</span>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>;
        }
 
        <b>internal readonly struct</b> <a id="2c0d589d4eb80755" href="../../R/2c0d589d4eb80755.html" target="n" data-glyph="110,1" class="t t"><span id="955d68955e3a59a9">AstAnalysisContext</span></a>
        {
            <b>internal</b> <a id="3c39964eeee4e393" href="../../R/3c39964eeee4e393.html" target="n" data-glyph="74,2" class="t constructor">AstAnalysisContext</a>(<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r19 rd" class="r19 r">tokenAtCursor</span>, <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r20 rd" class="r20 r">tokenBeforeCursor</span>, <span class="i">List</span>&lt;<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <span id="r21 rd" class="r21 r">relatedAsts</span>, <b>int</b> <span id="r22 rd" class="r22 r">replacementIndex</span>)
            {
                <a href="#14d88f770c521f4c" class="i field">TokenAtCursor</a> = <span class="r19 r">tokenAtCursor</span>;
                <a href="#a9bc4c10cf736ddd" class="i field">TokenBeforeCursor</a> = <span class="r20 r">tokenBeforeCursor</span>;
                <a href="#151b1883f212cd47" class="i field">RelatedAsts</a> = <span class="r21 r">relatedAsts</span>;
                <a href="#dfc5bc435a6a2b39" class="i field">ReplacementIndex</a> = <span class="r22 r">replacementIndex</span>;
            }
 
            <b>internal readonly</b> <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <a id="14d88f770c521f4c" href="../../R/14d88f770c521f4c.html" target="n" data-glyph="44,2" class="i field">TokenAtCursor</a>;
            <b>internal readonly</b> <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <a id="a9bc4c10cf736ddd" href="../../R/a9bc4c10cf736ddd.html" target="n" data-glyph="44,2" class="i field">TokenBeforeCursor</a>;
            <b>internal readonly</b> <span class="i">List</span>&lt;<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <a id="151b1883f212cd47" href="../../R/151b1883f212cd47.html" target="n" data-glyph="44,2" class="i field">RelatedAsts</a>;
            <b>internal readonly int</b> <a id="dfc5bc435a6a2b39" href="../../R/dfc5bc435a6a2b39.html" target="n" data-glyph="44,2" class="i field">ReplacementIndex</a>;
        }
 
        <b>internal static</b> <a href="#2c0d589d4eb80755" class="t t">AstAnalysisContext</a> <a id="a575fa6d7fb93e32" href="../../R/a575fa6d7fb93e32.html" target="n" data-glyph="74,1" class="i method">ExtractAstContext</a>(<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r23 rd" class="r23 r">inputAst</span>, <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[] <span id="r24 rd" class="r24 r">inputTokens</span>, <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r25 rd" class="r25 r">cursor</span>)
        {
            <b>bool</b> <span id="r26 rd" class="r26 r">adjustLineAndColumn</span> = <b>false</b>;
            <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r27 rd" class="r27 r">positionForAstSearch</span> = <span class="r25 r">cursor</span>;
 
            <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r28 rd" class="r28 r">tokenBeforeCursor</span> = <b>null</b>;
            <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r29 rd" class="r29 r">tokenAtCursor</span> = <span class="i">InterstingTokenAtCursorOrDefault</span>(<span class="r24 r">inputTokens</span>, <span class="r25 r">cursor</span>);
            <b>if</b> (<span class="r29 r">tokenAtCursor</span> == <b>null</b>)
            {
                <span class="r28 r">tokenBeforeCursor</span> = <span class="i">InterstingTokenBeforeCursorOrDefault</span>(<span class="r24 r">inputTokens</span>, <span class="r25 r">cursor</span>);
                <b>if</b> (<span class="r28 r">tokenBeforeCursor</span> != <b>null</b>)
                {
                    <span class="r27 r">positionForAstSearch</span> = <span class="r28 r">tokenBeforeCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#b8cb5655f70ff8ee" class="i property">EndScriptPosition</a>;
                    <span class="r26 r">adjustLineAndColumn</span> = <b>true</b>;
                }
            }
            <b>else</b>
            {
                <a href="../parser/token.cs.html#7be5d7d2cd2a65ac" class="k">var</a> <span id="r30 rd" class="r30 r">stringExpandableToken</span> = <span class="r29 r">tokenAtCursor</span> <b>as</b> <a href="../parser/token.cs.html#7be5d7d2cd2a65ac" class="t t">StringExpandableToken</a>;
                <b>if</b> (<span class="r30 r">stringExpandableToken</span>?.<a href="../parser/token.cs.html#6847b32dc0516c6a" class="i property">NestedTokens</a> != <b>null</b>)
                {
                    <span class="r29 r">tokenAtCursor</span> = <span class="i">InterstingTokenAtCursorOrDefault</span>(<span class="r30 r">stringExpandableToken</span>.<a href="../parser/token.cs.html#6847b32dc0516c6a" class="i property">NestedTokens</a>, <span class="r25 r">cursor</span>) ?? <span class="r30 r">stringExpandableToken</span>;
                }
            }
 
            <b>int</b> <span id="r31 rd" class="r31 r">replacementIndex</span> = <span class="r26 r">adjustLineAndColumn</span> ? <span class="r25 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> : 0;
            <span class="i">List</span>&lt;<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <span id="r32 rd" class="r32 r">relatedAsts</span> = <a href="../parser/AstVisitor.cs.html#5298c9a8d6287f90" class="t t">AstSearcher</a>.<span class="i">FindAll</span>(
                <span class="r23 r">inputAst</span>,
                <span id="r33 rd" class="r33 r">ast</span> =&gt; <span class="i">IsCursorWithinOrJustAfterExtent</span>(<span class="r27 r">positionForAstSearch</span>, <span class="r33 r">ast</span>.<span class="i">Extent</span>),
                <span class="i">searchNestedScriptBlocks</span>: <b>true</b>).<span class="i">ToList</span>();
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r29 r">tokenAtCursor</span> == <b>null</b> || <span class="r28 r">tokenBeforeCursor</span> == <b>null</b>, <span class="s">&quot;Only one of these tokens can be non-null&quot;</span>);
 
            <b>return</b> <b>new</b> <a href="#3c39964eeee4e393" class="t constructor">AstAnalysisContext</a>(<span class="r29 r">tokenAtCursor</span>, <span class="r28 r">tokenBeforeCursor</span>, <span class="r32 r">relatedAsts</span>, <span class="r31 r">replacementIndex</span>);
        }
 
        <b>internal</b> <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <a id="5452d99f44be1bf2" href="../../R/5452d99f44be1bf2.html" target="n" data-glyph="74,1" class="i method">CreateCompletionContext</a>(<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r34 rd" class="r34 r">powerShell</span>)
        {
            <a href="../parser/TypeInferenceVisitor.cs.html#475e6219e3f308ae" class="k">var</a> <span id="r35 rd" class="r35 r">typeInferenceContext</span> = <b>new</b> <a href="../parser/TypeInferenceVisitor.cs.html#9549b3774b6eb924" class="t constructor">TypeInferenceContext</a>(<span class="r34 r">powerShell</span>);
            <b>return</b> <a href="#b6e1caaa2cf8862e" class="i method">InitializeCompletionContext</a>(<span class="r35 r">typeInferenceContext</span>);
        }
 
        <b>internal</b> <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <a id="42424c2673799b2f" href="../../R/42424c2673799b2f.html" target="n" data-glyph="74,1" class="i method">CreateCompletionContext</a>(<a href="../parser/TypeInferenceVisitor.cs.html#475e6219e3f308ae" class="t t">TypeInferenceContext</a> <span id="r36 rd" class="r36 r">typeInferenceContext</span>)
        {
            <b>return</b> <a href="#b6e1caaa2cf8862e" class="i method">InitializeCompletionContext</a>(<span class="r36 r">typeInferenceContext</span>);
        }
 
        <b>private</b> <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <a id="b6e1caaa2cf8862e" href="../../R/b6e1caaa2cf8862e.html" target="n" data-glyph="76,1" class="i method">InitializeCompletionContext</a>(<a href="../parser/TypeInferenceVisitor.cs.html#475e6219e3f308ae" class="t t">TypeInferenceContext</a> <span id="r37 rd" class="r37 r">typeInferenceContext</span>)
        {
            <a href="#2c0d589d4eb80755" class="k">var</a> <span id="r38 rd" class="r38 r">astContext</span> = <a href="#a575fa6d7fb93e32" class="i method">ExtractAstContext</a>(<a href="#1994043b9b09d1fe" class="i field">_ast</a>, <a href="#2b2e6f8adffb2817" class="i field">_tokens</a>, <a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a>);
 
            <b>if</b> (<span class="r37 r">typeInferenceContext</span>.<a href="../parser/TypeInferenceVisitor.cs.html#30a83fe0baf97acf" class="i property">CurrentTypeDefinitionAst</a> == <b>null</b>)
            {
                <span class="r37 r">typeInferenceContext</span>.<a href="../parser/TypeInferenceVisitor.cs.html#30a83fe0baf97acf" class="i property">CurrentTypeDefinitionAst</a> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<span class="i">GetAncestorTypeDefinitionAst</span>(<span class="r38 r">astContext</span>.<a href="#151b1883f212cd47" class="i field">RelatedAsts</a>.<span class="i">Last</span>());
            }
 
            <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r39 rd" class="r39 r">executionContext</span> = <span class="r37 r">typeInferenceContext</span>.<a href="../parser/TypeInferenceVisitor.cs.html#30f31c72b9cad077" class="i property">ExecutionContext</a>;
 
            <b>return</b> <b>new</b> <span class="t">CompletionContext</span>
            {
                <a href="#f3f4d193708c896f" class="i property">Options</a> = <a href="#868c6de52bceecc5" class="i field">_options</a>,
                <a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a> = <a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a>,
                <a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> = <span class="r38 r">astContext</span>.<a href="#14d88f770c521f4c" class="i field">TokenAtCursor</a>,
                <a href="#13e001aeea27aaa6" class="i property">TokenBeforeCursor</a> = <span class="r38 r">astContext</span>.<a href="#a9bc4c10cf736ddd" class="i field">TokenBeforeCursor</a>,
                <a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a> = <span class="r38 r">astContext</span>.<a href="#151b1883f212cd47" class="i field">RelatedAsts</a>,
                <a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r38 r">astContext</span>.<a href="#dfc5bc435a6a2b39" class="i field">ReplacementIndex</a>,
                <a href="#4055c622a2008ac8" class="i property">ExecutionContext</a> = <span class="r39 r">executionContext</span>,
                <a href="#95d0769179a8633b" class="i property">TypeInferenceContext</a> = <span class="r37 r">typeInferenceContext</span>,
                <a href="#f944e077619447e4" class="i property">Helper</a> = <span class="r37 r">typeInferenceContext</span>.<a href="../parser/TypeInferenceVisitor.cs.html#17fe250986da5799" class="i property">Helper</a>,
                <a href="#d7d397e503f13ffb" class="i property">CustomArgumentCompleters</a> = <span class="r39 r">executionContext</span>.<a href="../ExecutionContext.cs.html#7dcc004d95b8908e" class="i property">CustomArgumentCompleters</a>,
                <a href="#e6b0eb9fc41f5838" class="i property">NativeArgumentCompleters</a> = <span class="r39 r">executionContext</span>.<a href="../ExecutionContext.cs.html#2ad8d70b6a762159" class="i property">NativeArgumentCompleters</a>,
            };
        }
 
        <b>private static</b> <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <a id="be8d3386c2a8345e" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InterstingTokenAtCursorOrDefault</a>(<span class="i">IReadOnlyList</span>&lt;<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>&gt; <span id="r40 rd" class="r40 r">tokens</span>, <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r41 rd" class="r41 r">cursorPosition</span>)
        {
            <b>for</b> (<b>int</b> <span id="r42 rd" class="r42 r">i</span> = <span class="r40 r">tokens</span>.<span class="i">Count</span> - 1; <span class="r42 r">i</span> &gt;= 0; --<span class="r42 r">i</span>)
            {
                <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r43 rd" class="r43 r">token</span> = <span class="r40 r">tokens</span>[<span class="r42 r">i</span>];
                <b>if</b> (<a href="#3ed3a5ced7abae07" class="i method">IsCursorWithinOrJustAfterExtent</a>(<span class="r41 r">cursorPosition</span>, <span class="r43 r">token</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>) &amp;&amp; <a href="#231a6db287114e0a" class="i method">IsInterestingToken</a>(<span class="r43 r">token</span>))
                {
                    <b>return</b> <span class="r43 r">token</span>;
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private static</b> <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <a id="25eb0989012a1797" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InterstingTokenBeforeCursorOrDefault</a>(<span class="i">IReadOnlyList</span>&lt;<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>&gt; <span id="r44 rd" class="r44 r">tokens</span>, <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r45 rd" class="r45 r">cursorPosition</span>)
        {
            <b>for</b> (<b>int</b> <span id="r46 rd" class="r46 r">i</span> = <span class="r44 r">tokens</span>.<span class="i">Count</span> - 1; <span class="r46 r">i</span> &gt;= 0; --<span class="r46 r">i</span>)
            {
                <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r47 rd" class="r47 r">token</span> = <span class="r44 r">tokens</span>[<span class="r46 r">i</span>];
                <b>if</b> (<a href="#ede1024ee569b083" class="i method">IsCursorAfterExtent</a>(<span class="r45 r">cursorPosition</span>, <span class="r47 r">token</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>) &amp;&amp; <a href="#231a6db287114e0a" class="i method">IsInterestingToken</a>(<span class="r47 r">token</span>))
                {
                    <b>return</b> <span class="r47 r">token</span>;
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private static</b> <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <a id="3d52b2d6828a0083" href="../../R/3d52b2d6828a0083.html" target="n" data-glyph="76,1" class="i method">GetLastAstAtCursor</a>(<a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a> <span id="r48 rd" class="r48 r">scriptBlockAst</span>, <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r49 rd" class="r49 r">cursorPosition</span>)
        {
            <b>var</b> <span id="r50 rd" class="r50 r">asts</span> = <a href="../parser/AstVisitor.cs.html#5298c9a8d6287f90" class="t t">AstSearcher</a>.<span class="i">FindAll</span>(<span class="r48 r">scriptBlockAst</span>, <span id="r51 rd" class="r51 r">ast</span> =&gt; <span class="i">IsCursorRightAfterExtent</span>(<span class="r49 r">cursorPosition</span>, <span class="r51 r">ast</span>.<span class="i">Extent</span>), <span class="i">searchNestedScriptBlocks</span>: <b>true</b>);
            <b>return</b> <span class="r50 r">asts</span>.<span class="i">LastOrDefault</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Special Cases
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if we should complete file names for &quot;switch -file&quot;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="a94d312d6538ce53" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompleteAgainstSwitchFile</a>(<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r52 rd" class="r52 r">lastAst</span>, <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r53 rd" class="r53 r">tokenBeforeCursor</span>)
        {
            <span class="i">Tuple</span>&lt;<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>, <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <span id="r54 rd" class="r54 r">fileConditionTuple</span>;
 
            <a href="../parser/ast.cs.html#e02a155b7afded8b" class="k">var</a> <span id="r55 rd" class="r55 r">errorStatement</span> = <span class="r52 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#e02a155b7afded8b" class="t t">ErrorStatementAst</a>;
            <b>if</b> (<span class="r55 r">errorStatement</span> != <b>null</b> &amp;&amp; <span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#989775977d1f1960" class="i property">Flags</a> != <b>null</b> &amp;&amp; <span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a> != <b>null</b> &amp;&amp; <span class="r53 r">tokenBeforeCursor</span> != <b>null</b> &amp;&amp;
                <span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a>.<span class="i">Equals</span>(<a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#16bd62526b80a3f2" class="i field">Switch</a>) &amp;&amp; <span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#989775977d1f1960" class="i property">Flags</a>.<span class="i">TryGetValue</span>(<span class="s">&quot;file&quot;</span>, <b>out</b> <span class="r54 r">fileConditionTuple</span>))
            {
                <span class="c">// Handle &quot;switch -file &lt;tab&gt;&quot;</span>
                <b>return</b> <span class="r54 r">fileConditionTuple</span>.<span class="i">Item1</span>.<span class="i">Extent</span>.<span class="i">EndOffset</span> == <span class="r53 r">tokenBeforeCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>;
            }
 
            <b>if</b> (<span class="r52 r">lastAst</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a> <b>is</b> <a href="../parser/ast.cs.html#f4da818a29387c5d" class="t t">CommandExpressionAst</a>)
            {
                <span class="c">// Handle &quot;switch -file m&lt;tab&gt;&quot; or &quot;switch -file *.ps1&lt;tab&gt;&quot;</span>
                <b>if</b> (!(<span class="r52 r">lastAst</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a> <b>is</b> <a href="../parser/ast.cs.html#785915ec8547ce9f" class="t t">PipelineAst</a> <span id="r56 rd" class="r56 r">pipeline</span>))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <span class="r55 r">errorStatement</span> = <span class="r56 r">pipeline</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a> <b>as</b> <a href="../parser/ast.cs.html#e02a155b7afded8b" class="t t">ErrorStatementAst</a>;
                <b>if</b> (<span class="r55 r">errorStatement</span> == <b>null</b> || <span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a> == <b>null</b> || <span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#989775977d1f1960" class="i property">Flags</a> == <b>null</b>)
                {
                    <b>return</b> <b>false</b>;
                }
 
                <b>return</b> (<span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a>.<span class="i">Equals</span>(<a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#16bd62526b80a3f2" class="i field">Switch</a>) &amp;&amp;
                        <span class="r55 r">errorStatement</span>.<a href="../parser/ast.cs.html#989775977d1f1960" class="i property">Flags</a>.<span class="i">TryGetValue</span>(<span class="s">&quot;file&quot;</span>, <b>out</b> <span class="r54 r">fileConditionTuple</span>) &amp;&amp; <span class="r54 r">fileConditionTuple</span>.<span class="i">Item2</span> == <span class="r56 r">pipeline</span>);
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static bool</b> <a id="e6ee7479193c42f0" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompleteOperator</a>(<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r57 rd" class="r57 r">tokenAtCursor</span>, <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r58 rd" class="r58 r">lastAst</span>)
        {
            <b>if</b> (<span class="r57 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#069476ae2e7b4442" class="i field">Minus</a>)
            {
                <b>return</b> <span class="r58 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#f3e3848ef2eae593" class="t t">BinaryExpressionAst</a>;
            }
            <b>else</b> <b>if</b> (<span class="r57 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#c3ec93ee8b22aa7f" class="i field">Parameter</a>)
            {
                <b>if</b> (<span class="r58 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a>)
                    <b>return</b> <span class="r58 r">lastAst</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a> <b>is</b> <a href="../parser/ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static bool</b> <a id="cf16c46ffe12c8bc" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompleteAgainstStatementFlags</a>(<a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r59 rd" class="r59 r">scriptAst</span>, <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r60 rd" class="r60 r">lastAst</span>, <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r61 rd" class="r61 r">token</span>, <b>out</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a> <span id="r62 rd" class="r62 r">kind</span>)
        {
            <span class="r62 r">kind</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#109dbe127dd9cac0" class="i field">Unknown</a>;
 
            <span class="c">// Handle &quot;switch -f&lt;tab&gt;&quot;</span>
            <a href="../parser/ast.cs.html#e02a155b7afded8b" class="k">var</a> <span id="r63 rd" class="r63 r">errorStatement</span> = <span class="r60 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#e02a155b7afded8b" class="t t">ErrorStatementAst</a>;
            <b>if</b> (<span class="r63 r">errorStatement</span> != <b>null</b> &amp;&amp; <span class="r63 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a> != <b>null</b>)
            {
                <b>switch</b> (<span class="r63 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a>)
                {
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#16bd62526b80a3f2" class="i field">Switch</a>:
                        <span class="r62 r">kind</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#16bd62526b80a3f2" class="i field">Switch</a>;
                        <b>return</b> <b>true</b>;
                    <b>default</b>:
                        <b>break</b>;
                }
            }
 
            <span class="c">// Handle &quot;switch -&lt;tab&gt;&quot;. Skip cases like &quot;switch ($a) {} -&lt;tab&gt; &quot;</span>
            <a href="../parser/ast.cs.html#6f963589327835a4" class="k">var</a> <span id="r64 rd" class="r64 r">scriptBlockAst</span> = <span class="r59 r">scriptAst</span> <b>as</b> <a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a>;
            <b>if</b> (<span class="r61 r">token</span> != <b>null</b> &amp;&amp; <span class="r61 r">token</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#069476ae2e7b4442" class="i field">Minus</a> &amp;&amp; <span class="r64 r">scriptBlockAst</span> != <b>null</b>)
            {
                <b>var</b> <span id="r65 rd" class="r65 r">asts</span> = <a href="../parser/AstVisitor.cs.html#5298c9a8d6287f90" class="t t">AstSearcher</a>.<span class="i">FindAll</span>(<span class="r64 r">scriptBlockAst</span>, <span id="r66 rd" class="r66 r">ast</span> =&gt; <span class="i">IsCursorAfterExtent</span>(<span class="r61 r">token</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#88220ab61fd15a4b" class="i property">StartScriptPosition</a>, <span class="r66 r">ast</span>.<span class="i">Extent</span>), <span class="i">searchNestedScriptBlocks</span>: <b>true</b>);
 
                <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r67 rd" class="r67 r">last</span> = <span class="r65 r">asts</span>.<span class="i">LastOrDefault</span>();
                <span class="r63 r">errorStatement</span> = <b>null</b>;
 
                <b>while</b> (<span class="r67 r">last</span> != <b>null</b>)
                {
                    <span class="r63 r">errorStatement</span> = <span class="r67 r">last</span> <b>as</b> <a href="../parser/ast.cs.html#e02a155b7afded8b" class="t t">ErrorStatementAst</a>;
                    <b>if</b> (<span class="r63 r">errorStatement</span> != <b>null</b>) { <b>break</b>; }
 
                    <span class="r67 r">last</span> = <span class="r67 r">last</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a>;
                }
 
                <b>if</b> (<span class="r63 r">errorStatement</span> != <b>null</b> &amp;&amp; <span class="r63 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a> != <b>null</b>)
                {
                    <b>switch</b> (<span class="r63 r">errorStatement</span>.<a href="../parser/ast.cs.html#e07360799fb872a6" class="i property">Kind</a>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a>)
                    {
                        <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#16bd62526b80a3f2" class="i field">Switch</a>:
 
                            <span class="i">Tuple</span>&lt;<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>, <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <span id="r68 rd" class="r68 r">value</span>;
                            <b>if</b> (<span class="r63 r">errorStatement</span>.<a href="../parser/ast.cs.html#989775977d1f1960" class="i property">Flags</a> != <b>null</b> &amp;&amp; <span class="r63 r">errorStatement</span>.<a href="../parser/ast.cs.html#989775977d1f1960" class="i property">Flags</a>.<span class="i">TryGetValue</span>(<a href="../parser/Parser.cs.html#bbf5e856fb3215c5" class="t t">Parser</a>.<a href="../parser/Parser.cs.html#d9090e2972c2cdfd" class="i field">VERBATIM_ARGUMENT</a>, <b>out</b> <span class="r68 r">value</span>))
                            {
                                <b>if</b> (<span class="i">IsTokenTheSame</span>(<span class="r68 r">value</span>.<span class="i">Item1</span>, <span class="r61 r">token</span>))
                                {
                                    <span class="r62 r">kind</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#16bd62526b80a3f2" class="i field">Switch</a>;
                                    <b>return</b> <b>true</b>;
                                }
                            }
 
                            <b>break</b>;
 
                        <b>default</b>:
                            <b>break</b>;
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static bool</b> <a id="3b1754605b394d82" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsTokenTheSame</a>(<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r69 rd" class="r69 r">x</span>, <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a> <span id="r70 rd" class="r70 r">y</span>)
        {
            <b>if</b> (<span class="r69 r">x</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <span class="r70 r">y</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> &amp;&amp; <span class="r69 r">x</span>.<a href="../parser/token.cs.html#f9d0ded14a71a369" class="i property">TokenFlags</a> == <span class="r70 r">y</span>.<a href="../parser/token.cs.html#f9d0ded14a71a369" class="i property">TokenFlags</a> &amp;&amp;
                <span class="r69 r">x</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#cc356dc28b41997d" class="i property">StartLineNumber</a> == <span class="r70 r">y</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#cc356dc28b41997d" class="i property">StartLineNumber</a> &amp;&amp;
                <span class="r69 r">x</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#8fcbdc214acf2f0f" class="i property">StartColumnNumber</a> == <span class="r70 r">y</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#8fcbdc214acf2f0f" class="i property">StartColumnNumber</a> &amp;&amp;
                <span class="r69 r">x</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ccd649a5269e237d" class="i property">EndLineNumber</a> == <span class="r70 r">y</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ccd649a5269e237d" class="i property">EndLineNumber</a> &amp;&amp;
                <span class="r69 r">x</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#155675f601d14734" class="i property">EndColumnNumber</a> == <span class="r70 r">y</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#155675f601d14734" class="i property">EndColumnNumber</a>)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Special Cases
 
        <b>internal</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="5cf3c5e39f65b543" href="../../R/5cf3c5e39f65b543.html" target="n" data-glyph="74,1" class="i method">GetResults</a>(<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r71 rd" class="r71 r">powerShell</span>, <b>out int</b> <span id="r72 rd" class="r72 r">replacementIndex</span>, <b>out int</b> <span id="r73 rd" class="r73 r">replacementLength</span>)
        {
            <a href="#f4bb7b26e8be6324" class="k">var</a> <span id="r74 rd" class="r74 r">completionContext</span> = <a href="#5452d99f44be1bf2" class="i method">CreateCompletionContext</a>(<span class="r71 r">powerShell</span>);
 
            <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>? <span id="r75 rd" class="r75 r">previousLanguageMode</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="c">// Tab expansion is called from a trusted function - we should apply ConstrainedLanguage if necessary.</span>
                <b>if</b> (<span class="r74 r">completionContext</span>.<a href="#4055c622a2008ac8" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#6ec645dc27615492" class="i property">HasRunspaceEverUsedConstrainedLanguageMode</a>)
                {
                    <span class="r75 r">previousLanguageMode</span> = <span class="r74 r">completionContext</span>.<a href="#4055c622a2008ac8" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>;
                    <span class="r74 r">completionContext</span>.<a href="#4055c622a2008ac8" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>;
                }
 
                <b>return</b> <a href="#2a694a198ee5aa3c" class="i method">GetResultHelper</a>(<span class="r74 r">completionContext</span>, <b>out</b> <span class="r72 r">replacementIndex</span>, <b>out</b> <span class="r73 r">replacementLength</span>, <b>false</b>);
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r75 r">previousLanguageMode</span>.<span class="i">HasValue</span>)
                {
                    <span class="r74 r">completionContext</span>.<a href="#4055c622a2008ac8" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <span class="r75 r">previousLanguageMode</span>.<span class="i">Value</span>;
                }
            }
        }
 
        <b>internal</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="2a694a198ee5aa3c" href="../../R/2a694a198ee5aa3c.html" target="n" data-glyph="74,1" class="i method">GetResultHelper</a>(<a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r76 rd" class="r76 r">completionContext</span>, <b>out int</b> <span id="r77 rd" class="r77 r">replacementIndex</span>, <b>out int</b> <span id="r78 rd" class="r78 r">replacementLength</span>, <b>bool</b> <span id="r79 rd" class="r79 r">isQuotedString</span>)
        {
            <span class="r77 r">replacementIndex</span> = -1;
            <span class="r78 r">replacementLength</span> = -1;
 
            <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="k">var</a> <span id="r80 rd" class="r80 r">tokenAtCursor</span> = <span class="r76 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>;
            <b>var</b> <span id="r81 rd" class="r81 r">lastAst</span> = <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Last</span>();
            <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r82 rd" class="r82 r">result</span> = <b>null</b>;
            <b>if</b> (<span class="r80 r">tokenAtCursor</span> != <b>null</b>)
            {
                <span class="r77 r">replacementIndex</span> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#88220ab61fd15a4b" class="i property">StartScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                <span class="r78 r">replacementLength</span> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#b8cb5655f70ff8ee" class="i property">EndScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> - <span class="r77 r">replacementIndex</span>;
 
                <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r77 r">replacementIndex</span>;
                <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span>;
 
                <b>switch</b> (<span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a>)
                {
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#8b5a9c54e2029553" class="i field">Variable</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#4fc017e5ff76f173" class="i field">SplattedVariable</a>:
                        <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = ((<a href="../parser/token.cs.html#cb1e7cc3b0285414" class="t t">VariableToken</a>)<span class="r80 r">tokenAtCursor</span>).<a href="../parser/token.cs.html#d5a3911ea8b02b43" class="i property">VariablePath</a>.<a href="../VariablePath.cs.html#45529674e4735f30" class="i property">UserPath</a>;
                        <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#2e1c9f0c9f032eaa" class="i method">CompleteVariable</a>(<span class="r76 r">completionContext</span>);
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#79806bba953290ee" class="i field">Multiply</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#1aeb1084525225c9" class="i field">Generic</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#3d9a9ff2e958417f" class="i field">MinusMinus</a>: <span class="c">// for native commands &#39;--&#39;</span>
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#7ad757fcc8d67426" class="i field">Identifier</a>:
                        <span class="r82 r">result</span> = <a href="#4eb1450f768f18ec" class="i method">GetResultForIdentifier</a>(<span class="r76 r">completionContext</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>, <span class="r79 r">isQuotedString</span>);
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#c3ec93ee8b22aa7f" class="i field">Parameter</a>:
                        <span class="c">// When it&#39;s the content of a quoted string, we only handle variable/member completion</span>
                        <b>if</b> (<span class="r79 r">isQuotedString</span>)
                            <b>break</b>;
 
                        <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
                        <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="k">var</a> <span id="r83 rd" class="r83 r">cmdAst</span> = <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>as</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a>;
                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a> &amp;&amp; <span class="r83 r">cmdAst</span> != <b>null</b> &amp;&amp; <span class="r83 r">cmdAst</span>.<a href="../parser/ast.cs.html#f3fdfe686fb0ef19" class="i property">CommandElements</a>.<span class="i">Count</span> == 1)
                        {
                            <span class="r82 r">result</span> = <a href="#b47688d1e87210f0" class="i method">CompleteFileNameAsCommand</a>(<span class="r76 r">completionContext</span>);
                            <b>break</b>;
                        }
 
                        <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a> <span id="r84 rd" class="r84 r">statementKind</span>;
                        <b>if</b> (<span class="i">CompleteAgainstStatementFlags</span>(<b>null</b>, <span class="r81 r">lastAst</span>, <b>null</b>, <b>out</b> <span class="r84 r">statementKind</span>))
                        {
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#edc9a29b37eca791" class="i method">CompleteStatementFlags</a>(<span class="r84 r">statementKind</span>, <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a>);
                            <b>break</b>;
                        }
 
                        <b>if</b> (<span class="i">CompleteOperator</span>(<span class="r80 r">tokenAtCursor</span>, <span class="r81 r">lastAst</span>))
                        {
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#c445882fd2905d76" class="i method">CompleteOperator</a>(<span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a>);
                            <b>break</b>;
                        }
 
                        <span class="c">// Handle scenarios like this: dir -path:&lt;tab&gt;</span>
                        <b>if</b> (<span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a>.<span class="i">EndsWith</span>(<span class="s">&#39;:&#39;</span>))
                        {
                            <span class="r77 r">replacementIndex</span> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#b8cb5655f70ff8ee" class="i property">EndScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                            <span class="r78 r">replacementLength</span> = 0;
 
                            <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <b>string</b>.<span class="i">Empty</span>;
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f46bcd6b9210bb57" class="i method">CompleteCommandArgument</a>(<span class="r76 r">completionContext</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#ab1ad2c5a684cb16" class="i method">CompleteCommandParameter</a>(<span class="r76 r">completionContext</span>);
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ba396ba04fe0fde5" class="i field">ColonColon</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#97da13a8bbbf83e2" class="i field">QuestionDot</a>:
                        <span class="r77 r">replacementIndex</span> += <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>.<span class="i">Length</span>;
                        <span class="r78 r">replacementLength</span> = 0;
                        <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#c5cd3c69e6ecde2e" class="i method">CompleteMember</a>(<span class="r76 r">completionContext</span>, <span class="r85 r">@static</span>: <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ba396ba04fe0fde5" class="i field">ColonColon</a>);
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#1be92d0c82164308" class="i field">Comment</a>:
                        <span class="c">// When it&#39;s the content of a quoted string, we only handle variable/member completion</span>
                        <b>if</b> (<span class="r79 r">isQuotedString</span>)
                            <b>break</b>;
 
                        <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
                        <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#55990c3b8b42a076" class="i method">CompleteComment</a>(<span class="r76 r">completionContext</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>);
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#4e0d26e8d7050abc" class="i field">StringExpandable</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#0c560abdae080116" class="i field">StringLiteral</a>:
                        <span class="c">// Search to see if we&#39;re looking at an assignment</span>
                        <b>if</b> (<span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#f4da818a29387c5d" class="t t">CommandExpressionAst</a>
                            &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#da5f345864f42e06" class="t t">AssignmentStatementAst</a> <span id="r86 rd" class="r86 r">assignmentAst</span>)
                        {
                            <span class="c">// Handle scenarios like `$ErrorActionPreference = &#39;&lt;tab&gt;`</span>
                            <b>if</b> (<a href="#58ba07aafea0b2e7" class="i method">TryGetCompletionsForVariableAssignment</a>(<span class="r76 r">completionContext</span>, <span class="r86 r">assignmentAst</span>, <b>out</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r87 rd" class="r87 r">completions</span>))
                            {
                                <b>return</b> <span class="r87 r">completions</span>;
                            }
                        }
 
                        <span class="r82 r">result</span> = <a href="#f540d20e5d2bad7a" class="i method">GetResultForString</a>(<span class="r76 r">completionContext</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>, <span class="r79 r">isQuotedString</span>);
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#e50e68a5c0f39895" class="i field">RBracket</a>:
                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#bf258955590d49b7" class="t t">TypeExpressionAst</a>)
                        {
                            <a href="../parser/ast.cs.html#bf258955590d49b7" class="k">var</a> <span id="r88 rd" class="r88 r">targetExpr</span> = (<a href="../parser/ast.cs.html#bf258955590d49b7" class="t t">TypeExpressionAst</a>)<span class="r81 r">lastAst</span>;
                            <b>var</b> <span id="r89 rd" class="r89 r">memberResult</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;();
 
                            <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f848645913a53ddb" class="i method">CompleteMemberHelper</a>(
                                <b>true</b>,
                                <span class="s">&quot;*&quot;</span>,
                                <span class="r88 r">targetExpr</span>,
                                <span class="r76 r">completionContext</span>, <span class="r89 r">memberResult</span>);
 
                            <b>if</b> (<span class="r89 r">memberResult</span>.<span class="i">Count</span> &gt; 0)
                            {
                                <span class="r77 r">replacementIndex</span>++;
                                <span class="r78 r">replacementLength</span> = 0;
                                <span class="r82 r">result</span> = (<b>from</b> <span class="i">entry</span> <b>in</b> <span class="r89 r">memberResult</span>
                                          <b>let</b> <span class="i">completionText</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ba396ba04fe0fde5" class="i field">ColonColon</a>.<a href="../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() + <span class="i">entry</span>.<span class="i">CompletionText</span>
                                          <b>select</b> <b>new</b> <span class="t">CompletionResult</span>(<span class="i">completionText</span>, <span class="i">entry</span>.<span class="i">ListItemText</span>, <span class="i">entry</span>.<span class="i">ResultType</span>, <span class="i">entry</span>.<span class="i">ToolTip</span>)).<span class="i">ToList</span>();
                            }
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#214bb2e1d5690022" class="i field">Comma</a>:
                        <span class="c">// Handle array elements such as dir .\cd,&lt;tab&gt; || dir -Path: .\cd,&lt;tab&gt;</span>
                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#bdf2b3276843e0c2" class="t t">ErrorExpressionAst</a> &amp;&amp;
                            (<span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> || <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a>))
                        {
                            <span class="r77 r">replacementIndex</span> += <span class="r78 r">replacementLength</span>;
                            <span class="r78 r">replacementLength</span> = 0;
 
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f46bcd6b9210bb57" class="i method">CompleteCommandArgument</a>(<span class="r76 r">completionContext</span>);
                        }
                        <b>else</b> <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a>)
                        {
                            <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r77 r">replacementIndex</span> += <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>.<span class="i">Length</span>;
                            <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span> = 0;
                            <span class="r82 r">result</span> = <a href="#125c3b60ea714b38" class="i method">GetResultForAttributeArgument</a>(<span class="r76 r">completionContext</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>);
                        }
                        <b>else</b>
                        {
                            <span class="c">//</span>
                            <span class="c">// Handle auto completion for enum/dependson property of DSC resource,</span>
                            <span class="c">// cursor is right after &#39;,&#39;</span>
                            <span class="c">//</span>
                            <span class="c">// Configuration config</span>
                            <span class="c">// {</span>
                            <span class="c">//     User test</span>
                            <span class="c">//     {</span>
                            <span class="c">//         DependsOn=@(&#39;[user]x&#39;,|)</span>
                            <span class="c">//</span>
                            <b>bool</b> <span id="r90 rd" class="r90 r">unused</span>;
                            <span class="r82 r">result</span> = <span class="i">GetResultForEnumPropertyValueOfDSCResource</span>(<span class="r76 r">completionContext</span>, <b>string</b>.<span class="i">Empty</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>, <b>out</b> <span class="r90 r">unused</span>);
                        }
 
                        <b>break</b>;
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ad46aed3b80ba825" class="i field">AtCurly</a>:
                        <span class="c">// Handle scenarios such as &#39;Sort-Object @{&lt;tab&gt;&#39; and  &#39;gci | Format-Table @{&#39;</span>
                        <span class="r82 r">result</span> = <a href="#8880d3486a4d50f6" class="i method">GetResultForHashtable</a>(<span class="r76 r">completionContext</span>);
                        <span class="r77 r">replacementIndex</span> += 2;
                        <span class="r78 r">replacementLength</span> = 0;
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#63d62c6d035bda20" class="i field">Semi</a>:
                        <span class="c">// Handle scenarios such as &#39;gci | Format-Table @{Label=...;&lt;tab&gt;&#39;</span>
                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a>)
                        {
                            <span class="r82 r">result</span> = <a href="#8880d3486a4d50f6" class="i method">GetResultForHashtable</a>(<span class="r76 r">completionContext</span>);
                            <span class="r77 r">replacementIndex</span> += 1;
                            <span class="r78 r">replacementLength</span> = 0;
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#4ed416f347b26a1b" class="i field">Number</a>:
                        <span class="c">// Handle scenarios such as Get-Process -Id 5&lt;tab&gt; || Get-Process -Id 5210, 3&lt;tab&gt; || Get-Process -Id: 5210, 3&lt;tab&gt;</span>
                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#ebd8ad798cde7861" class="t t">ConstantExpressionAst</a> &amp;&amp;
                            (<span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> || <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a> ||
                            (<span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#0e44bc9125134006" class="t t">ArrayLiteralAst</a> &amp;&amp;
                             (<span class="r81 r">lastAst</span>.<span class="i">Parent</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> || <span class="r81 r">lastAst</span>.<span class="i">Parent</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a>))))
                        {
                            <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f46bcd6b9210bb57" class="i method">CompleteCommandArgument</a>(<span class="r76 r">completionContext</span>);
 
                            <span class="r77 r">replacementIndex</span> = <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a>;
                            <span class="r78 r">replacementLength</span> = <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a>;
                        }
                        <b>else</b> <b>if</b> (<span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#f4da818a29387c5d" class="t t">CommandExpressionAst</a>
                            &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#da5f345864f42e06" class="t t">AssignmentStatementAst</a> <span id="r91 rd" class="r91 r">assignmentAst2</span>)
                        {
                            <span class="c">// Handle scenarios like &#39;[ValidateSet(11,22)][int]$i = 11; $i = 2&lt;tab&gt;&#39;</span>
                            <b>if</b> (<a href="#58ba07aafea0b2e7" class="i method">TryGetCompletionsForVariableAssignment</a>(<span class="r76 r">completionContext</span>, <span class="r91 r">assignmentAst2</span>, <b>out</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r92 rd" class="r92 r">completions</span>))
                            {
                                <span class="r82 r">result</span> = <span class="r92 r">completions</span>;
                            }
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#e5f4f5a7b13ffa10" class="i field">Redirection</a>:
                        <span class="c">// Handle file name completion after the redirection operator: gps &gt;&lt;tab&gt; || gps &gt;&gt;&lt;tab&gt; || dir con 2&gt;&lt;tab&gt; || dir con 2&gt;&gt;&lt;tab&gt;</span>
                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#bdf2b3276843e0c2" class="t t">ErrorExpressionAst</a> &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#2288e8fa779a0d57" class="t t">FileRedirectionAst</a>)
                        {
                            <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <b>string</b>.<span class="i">Empty</span>;
                            <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = (<span class="r77 r">replacementIndex</span> += <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>.<span class="i">Length</span>);
                            <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span> = 0;
                            <span class="r82 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;(<a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#729d5ec1cd6162b7" class="i method">CompleteFilename</a>(<span class="r76 r">completionContext</span>));
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#069476ae2e7b4442" class="i field">Minus</a>:
                        <span class="c">// Handle operator completion: 55 -&lt;tab&gt; || &quot;string&quot; -&lt;tab&gt; || (Get-Something) -&lt;tab&gt;</span>
                        <b>if</b> (<span class="i">CompleteOperator</span>(<span class="r80 r">tokenAtCursor</span>, <span class="r81 r">lastAst</span>))
                        {
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<span class="i">CompleteOperator</span>(<b>string</b>.<span class="i">Empty</span>);
                            <b>break</b>;
                        }
 
                        <span class="c">// Handle the flag completion for statements, such as the switch statement</span>
                        <b>if</b> (<span class="i">CompleteAgainstStatementFlags</span>(<span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>[0], <b>null</b>, <span class="r80 r">tokenAtCursor</span>, <b>out</b> <span class="r84 r">statementKind</span>))
                        {
                            <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
                            <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#edc9a29b37eca791" class="i method">CompleteStatementFlags</a>(<span class="r84 r">statementKind</span>, <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a>);
                            <b>break</b>;
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#e7868dd662d25e11" class="i field">DynamicKeyword</a>:
                        {
                            <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r93 rd" class="r93 r">keywordAst</span>;
                            <a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a> <span id="r94 rd" class="r94 r">configureAst</span> = <span class="i">GetAncestorConfigurationAstAndKeywordAst</span>(
                                <span class="r76 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>, <span class="r81 r">lastAst</span>, <b>out</b> <span class="r93 r">keywordAst</span>);
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r94 r">configureAst</span> != <b>null</b>, <span class="s">&quot;ConfigurationDefinitionAst should never be null&quot;</span>);
                            <b>bool</b> <span id="r95 rd" class="r95 r">matched</span> = <b>false</b>;
                            <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>.<span class="i">Trim</span>();
                            <span class="c">// Current token is within ConfigurationDefinitionAst or DynamicKeywordStatementAst</span>
                            <b>return</b> <a href="#589c7c95078733af" class="i method">GetResultForIdentifierInConfiguration</a>(<span class="r76 r">completionContext</span>, <span class="r94 r">configureAst</span>, <b>null</b>, <b>out</b> <span class="r95 r">matched</span>);
                        }
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#d78e08594ff6b79a" class="i field">Equals</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#cf388c7cb0667161" class="i field">AtParen</a>:
                    <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#9784d220b8ac50f2" class="i field">LParen</a>:
                        {
                            <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a>)
                            {
                                <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r77 r">replacementIndex</span> += <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>.<span class="i">Length</span>;
                                <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span> = 0;
                                <span class="r82 r">result</span> = <a href="#125c3b60ea714b38" class="i method">GetResultForAttributeArgument</a>(<span class="r76 r">completionContext</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>);
                            }
                            <b>else</b> <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a> <span id="r96 rd" class="r96 r">hashTableAst</span> &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is not</b> <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> &amp;&amp; <a href="#0ed5f3bc6f836d3c" class="i method">CheckForPendingAssignment</a>(<span class="r96 r">hashTableAst</span>))
                            {
                                <span class="c">// Handle scenarios such as &#39;gci | Format-Table @{Label=&lt;tab&gt;&#39; if incomplete parsing of the assignment.</span>
                                <b>return</b> <b>null</b>;
                            }
                            <b>else</b> <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#da5f345864f42e06" class="t t">AssignmentStatementAst</a> <span id="r97 rd" class="r97 r">assignmentAst2</span>)
                            {
                                <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r77 r">replacementIndex</span> += <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>.<span class="i">Length</span>;
                                <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span> = 0;
 
                                <span class="c">// Handle scenarios like &#39;$ErrorActionPreference =&lt;tab&gt;&#39;</span>
                                <b>if</b> (<a href="#58ba07aafea0b2e7" class="i method">TryGetCompletionsForVariableAssignment</a>(<span class="r76 r">completionContext</span>, <span class="r97 r">assignmentAst2</span>, <b>out</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r98 rd" class="r98 r">completions</span>))
                                {
                                    <b>return</b> <span class="r98 r">completions</span>;
                                }
                            }
                            <b>else</b>
                            {
                                <span class="c">// Handle scenarios such as &#39;configuration foo { File ab { Attributes =&#39;</span>
                                <span class="c">// (auto completion for enum/dependson property of DSC resource),</span>
                                <span class="c">// cursor is right after &#39;=&#39;, &#39;(&#39; or &#39;@(&#39;</span>
                                <span class="c">//</span>
                                <span class="c">// Configuration config</span>
                                <span class="c">// {</span>
                                <span class="c">//     User test</span>
                                <span class="c">//     {</span>
                                <span class="c">//         DependsOn=|</span>
                                <span class="c">//         DependsOn=@(|)</span>
                                <span class="c">//         DependsOn=(|</span>
                                <span class="c">//</span>
                                <b>bool</b> <span id="r99 rd" class="r99 r">unused</span>;
                                <span class="r82 r">result</span> = <span class="i">GetResultForEnumPropertyValueOfDSCResource</span>(<span class="r76 r">completionContext</span>, <b>string</b>.<span class="i">Empty</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>, <b>out</b> <span class="r99 r">unused</span>);
                            }
 
                            <b>break</b>;
                        }
                    <b>default</b>:
                        <b>if</b> ((<span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f9d0ded14a71a369" class="i property">TokenFlags</a> &amp; <a href="../parser/token.cs.html#fb1c35b7167e0165" class="t t">TokenFlags</a>.<a href="../parser/token.cs.html#bffc83c32a1428ea" class="i field">Keyword</a>) != 0)
                        {
                            <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
 
                            <span class="c">// Handle the file name completion</span>
                            <span class="r82 r">result</span> = <a href="#b47688d1e87210f0" class="i method">CompleteFileNameAsCommand</a>(<span class="r76 r">completionContext</span>);
 
                            <span class="c">// Handle the command name completion</span>
                            <b>var</b> <span id="r100 rd" class="r100 r">commandNameResult</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#8ad3630ff3ff385a" class="i method">CompleteCommand</a>(<span class="r76 r">completionContext</span>);
                            <b>if</b> (<span class="r100 r">commandNameResult</span> != <b>null</b> &amp;&amp; <span class="r100 r">commandNameResult</span>.<span class="i">Count</span> &gt; 0)
                            {
                                <span class="r82 r">result</span>.<span class="i">AddRange</span>(<span class="r100 r">commandNameResult</span>);
                            }
                        }
                        <b>else</b>
                        {
                            <span class="r77 r">replacementIndex</span> = -1;
                            <span class="r78 r">replacementLength</span> = -1;
                        }
 
                        <b>break</b>;
                }
            }
            <b>else</b>
            {
                <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r101 rd" class="r101 r">cursor</span> = <span class="r76 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>;
                <b>bool</b> <span id="r102 rd" class="r102 r">isCursorLineEmpty</span> = <b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r101 r">cursor</span>.<a href="../parser/Position.cs.html#5498933e478f6930" class="i property">Line</a>);
                <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="k">var</a> <span id="r103 rd" class="r103 r">tokenBeforeCursor</span> = <span class="r76 r">completionContext</span>.<a href="#13e001aeea27aaa6" class="i property">TokenBeforeCursor</a>;
                <b>bool</b> <span id="r104 rd" class="r104 r">isLineContinuationBeforeCursor</span> = <b>false</b>;
                <b>if</b> (<span class="r103 r">tokenBeforeCursor</span> != <b>null</b>)
                {
                    <span class="c">//</span>
                    <span class="c">// Handle following scenario, cursor is in next line and after a command call,</span>
                    <span class="c">// we need to skip the command call autocompletion if there is no backtick character</span>
                    <span class="c">// in the end of the previous line, since backtick means command call continues to the next line</span>
                    <span class="c">//</span>
                    <span class="c">// Configuration config</span>
                    <span class="c">// {</span>
                    <span class="c">//     User test</span>
                    <span class="c">//     {</span>
                    <span class="c">//         DependsOn=zzz</span>
                    <span class="c">//         |</span>
                    <span class="c">//</span>
                    <span class="r104 r">isLineContinuationBeforeCursor</span> = <span class="r76 r">completionContext</span>.<a href="#13e001aeea27aaa6" class="i property">TokenBeforeCursor</a>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#756695ee247bdc4d" class="i field">LineContinuation</a>;
                }
 
                <b>bool</b> <span id="r105 rd" class="r105 r">skipAutoCompleteForCommandCall</span> = <span class="r102 r">isCursorLineEmpty</span> &amp;&amp; !<span class="r104 r">isLineContinuationBeforeCursor</span>;
                <b>bool</b> <span id="r106 rd" class="r106 r">lastAstIsExpressionAst</span> = <span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a>;
                <b>if</b> (!<span class="r79 r">isQuotedString</span> &amp;&amp;
                    !<span class="r105 r">skipAutoCompleteForCommandCall</span> &amp;&amp;
                    (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a> || <span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> ||
                    (<span class="r106 r">lastAstIsExpressionAst</span> &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a>) ||
                    (<span class="r106 r">lastAstIsExpressionAst</span> &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a>) ||
                    (<span class="r106 r">lastAstIsExpressionAst</span> &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#0e44bc9125134006" class="t t">ArrayLiteralAst</a> &amp;&amp;
                    (<span class="r81 r">lastAst</span>.<span class="i">Parent</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> || <span class="r81 r">lastAst</span>.<span class="i">Parent</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a>))))
                {
                    <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <b>string</b>.<span class="i">Empty</span>;
 
                    <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="k">var</a> <span id="r107 rd" class="r107 r">hashTableAst</span> = <span class="r81 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a>;
 
                    <span class="c">// Do not do any tab completion if we have a hash table</span>
                    <span class="c">// and an assignment is pending.  For cases like:</span>
                    <span class="c">//   new-object System.Drawing.Point -prop @{ X=  -&gt; Tab should not complete</span>
                    <span class="c">// Note: This check works when all statements preceding the last are complete,</span>
                    <span class="c">//       but if a preceding statement is incomplete this test fails because</span>
                    <span class="c">//       the Ast mixes the statements due to incomplete parsing.</span>
                    <span class="c">//   e.g.,</span>
                    <span class="c">//   new-object System.Drawing.Point -prop @{ X = 100; Y =      &lt;- Incomplete line</span>
                    <span class="c">//   new-object new-object System.Drawing.Point -prop @{ X =    &lt;- Tab will yield hash properties.</span>
                    <b>if</b> (<span class="r107 r">hashTableAst</span> != <b>null</b> &amp;&amp;
                        <a href="#0ed5f3bc6f836d3c" class="i method">CheckForPendingAssignment</a>(<span class="r107 r">hashTableAst</span>))
                    {
                        <b>return</b> <span class="r82 r">result</span>;
                    }
 
                    <b>if</b> (<span class="r107 r">hashTableAst</span> != <b>null</b>)
                    {
                        <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r77 r">replacementIndex</span> = <span class="r76 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                        <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span> = 0;
                        <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#dffbec9e850a0d5a" class="i method">CompleteHashtableKey</a>(<span class="r76 r">completionContext</span>, <span class="r107 r">hashTableAst</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f46bcd6b9210bb57" class="i method">CompleteCommandArgument</a>(<span class="r76 r">completionContext</span>);
                        <span class="r77 r">replacementIndex</span> = <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a>;
                        <span class="r78 r">replacementLength</span> = <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a>;
                    }
                }
                <b>else</b> <b>if</b> (!<span class="r79 r">isQuotedString</span>)
                {
                    <span class="c">//</span>
                    <span class="c">// Handle completion of empty line within configuration statement</span>
                    <span class="c">// Ignore the auto completion if there is a backtick character in previous line</span>
                    <span class="c">//</span>
                    <b>bool</b> <span id="r108 rd" class="r108 r">cursorAtLineContinuation</span>;
                    <b>if</b> ((<span class="r80 r">tokenAtCursor</span> != <b>null</b> &amp;&amp; <span class="r80 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#756695ee247bdc4d" class="i field">LineContinuation</a>) ||
                        (<span class="r103 r">tokenBeforeCursor</span> != <b>null</b> &amp;&amp; <span class="r103 r">tokenBeforeCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#756695ee247bdc4d" class="i field">LineContinuation</a>))
                        <span class="r108 r">cursorAtLineContinuation</span> = <b>true</b>;
                    <b>else</b>
                        <span class="r108 r">cursorAtLineContinuation</span> = <b>false</b>;
                    <b>if</b> (<span class="r102 r">isCursorLineEmpty</span> &amp;&amp; !<span class="r108 r">cursorAtLineContinuation</span>)
                    {
                        <span class="c">//</span>
                        <span class="c">// Handle following scenario, both Configuration and DSC resource &#39;User&#39; are not complete</span>
                        <span class="c">// Check Hashtable first, and then fallback to configuration</span>
                        <span class="c">//</span>
                        <span class="c">// Configuration config</span>
                        <span class="c">// {</span>
                        <span class="c">//     User test</span>
                        <span class="c">//     {</span>
                        <span class="c">//         DependsOn=&#39;&#39;</span>
                        <span class="c">//         |</span>
                        <span class="r82 r">result</span> = <a href="#8880d3486a4d50f6" class="i method">GetResultForHashtable</a>(<span class="r76 r">completionContext</span>);
                        <b>if</b> (<span class="r82 r">result</span> == <b>null</b> || <span class="r82 r">result</span>.<span class="i">Count</span> == 0)
                        {
                            <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r109 rd" class="r109 r">keywordAst</span>;
                            <a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a> <span id="r110 rd" class="r110 r">configAst</span> = <span class="i">GetAncestorConfigurationAstAndKeywordAst</span>(<span class="r101 r">cursor</span>, <span class="r81 r">lastAst</span>, <b>out</b> <span class="r109 r">keywordAst</span>);
                            <b>if</b> (<span class="r110 r">configAst</span> != <b>null</b>)
                            {
                                <b>bool</b> <span id="r111 rd" class="r111 r">matched</span>;
                                <span class="r82 r">result</span> = <a href="#589c7c95078733af" class="i method">GetResultForIdentifierInConfiguration</a>(<span class="r76 r">completionContext</span>, <span class="r110 r">configAst</span>, <span class="r109 r">keywordAst</span>, <b>out</b> <span class="r111 r">matched</span>);
                            }
                        }
                    }
                    <b>else</b> <b>if</b> (<span class="r76 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> == <b>null</b>)
                    {
                        <b>if</b> (<span class="r103 r">tokenBeforeCursor</span> != <b>null</b>)
                        {
                            <span class="c">//</span>
                            <span class="c">// Handle auto completion for enum/dependson property of DSC resource,</span>
                            <span class="c">// cursor is after &#39;=&#39;, &#39;,&#39;, &#39;(&#39;, or &#39;@(&#39;</span>
                            <span class="c">//</span>
                            <span class="c">// Configuration config</span>
                            <span class="c">// {</span>
                            <span class="c">//     User test</span>
                            <span class="c">//     {</span>
                            <span class="c">//         DependsOn= |</span>
                            <span class="c">//         DependsOn=@(&#39;[user]x&#39;, |)</span>
                            <span class="c">//         DependsOn=@( |)</span>
                            <span class="c">//         DependsOn=(|</span>
                            <span class="c">//</span>
                            <b>switch</b> (<span class="r103 r">tokenBeforeCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a>)
                            {
                                <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#d78e08594ff6b79a" class="i field">Equals</a>:
                                <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#214bb2e1d5690022" class="i field">Comma</a>:
                                <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#cf388c7cb0667161" class="i field">AtParen</a>:
                                <b>case</b> <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#9784d220b8ac50f2" class="i field">LParen</a>:
                                    {
                                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#da5f345864f42e06" class="t t">AssignmentStatementAst</a> <span id="r112 rd" class="r112 r">assignmentAst</span>)
                                        {
                                            <span class="c">// Handle scenarios like &#39;$ErrorActionPreference = &lt;tab&gt;&#39;</span>
                                            <b>if</b> (<a href="#58ba07aafea0b2e7" class="i method">TryGetCompletionsForVariableAssignment</a>(<span class="r76 r">completionContext</span>, <span class="r112 r">assignmentAst</span>, <b>out</b> <span class="r82 r">result</span>))
                                            {
                                                <b>break</b>;
                                            }
                                        }
 
                                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a>)
                                        {
                                            <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span> = 0;
                                            <span class="r82 r">result</span> = <a href="#125c3b60ea714b38" class="i method">GetResultForAttributeArgument</a>(<span class="r76 r">completionContext</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>);
                                            <b>break</b>;
                                        }
 
                                        <b>bool</b> <span id="r113 rd" class="r113 r">unused</span>;
                                        <span class="r82 r">result</span> = <span class="i">GetResultForEnumPropertyValueOfDSCResource</span>(<span class="r76 r">completionContext</span>, <b>string</b>.<span class="i">Empty</span>, <b>ref</b> <span class="r77 r">replacementIndex</span>, <b>ref</b> <span class="r78 r">replacementLength</span>, <b>out</b> <span class="r113 r">unused</span>);
                                        <b>break</b>;
                                    }
                                <b>default</b>:
                                    <b>break</b>;
                            }
                        }
                    }
 
                    <b>if</b> (<span class="r82 r">result</span> != <b>null</b> &amp;&amp; <span class="r82 r">result</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r77 r">replacementIndex</span> = <span class="r76 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                        <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r78 r">replacementLength</span> = 0;
                    }
                    <b>else</b>
                    {
                        <b>bool</b> <span id="r114 rd" class="r114 r">needFileCompletion</span> = <b>false</b>;
                        <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#bdf2b3276843e0c2" class="t t">ErrorExpressionAst</a> &amp;&amp; <span class="r81 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#2288e8fa779a0d57" class="t t">FileRedirectionAst</a>)
                        {
                            <span class="c">// Handle file name completion after redirection operator: gps &gt; &lt;tab&gt;</span>
                            <span class="r114 r">needFileCompletion</span> = <b>true</b>;
                        }
                        <b>else</b> <b>if</b> (<span class="r81 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#e02a155b7afded8b" class="t t">ErrorStatementAst</a> &amp;&amp; <span class="i">CompleteAgainstSwitchFile</span>(<span class="r81 r">lastAst</span>, <span class="r76 r">completionContext</span>.<a href="#13e001aeea27aaa6" class="i property">TokenBeforeCursor</a>))
                        {
                            <span class="c">// Handle file name completion after &quot;switch -file&quot;: switch -file &lt;tab&gt;</span>
                            <span class="r114 r">needFileCompletion</span> = <b>true</b>;
                        }
 
                        <b>if</b> (<span class="r114 r">needFileCompletion</span>)
                        {
                            <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <b>string</b>.<span class="i">Empty</span>;
                            <span class="r82 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;(<a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#729d5ec1cd6162b7" class="i method">CompleteFilename</a>(<span class="r76 r">completionContext</span>));
 
                            <span class="r77 r">replacementIndex</span> = <span class="r76 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a>;
                            <span class="r78 r">replacementLength</span> = <span class="r76 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a>;
                        }
                    }
                }
            }
 
            <b>if</b> (<span class="r82 r">result</span> == <b>null</b> || <span class="r82 r">result</span>.<span class="i">Count</span> == 0)
            {
                <b>var</b> <span id="r115 rd" class="r115 r">typeAst</span> = <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">OfType</span>&lt;<a href="../parser/ast.cs.html#bf258955590d49b7" class="t t">TypeExpressionAst</a>&gt;().<span class="i">FirstOrDefault</span>();
                <a href="../parser/ast.cs.html#83b43c1855a09e15" class="t t">TypeName</a> <span id="r116 rd" class="r116 r">typeNameToComplete</span> = <b>null</b>;
                <b>if</b> (<span class="r115 r">typeAst</span> != <b>null</b>)
                {
                    <span class="r116 r">typeNameToComplete</span> = <span class="i">FindTypeNameToComplete</span>(<span class="r115 r">typeAst</span>.<span class="i">TypeName</span>, <a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a>);
                }
                <b>else</b>
                {
                    <b>var</b> <span id="r117 rd" class="r117 r">typeConstraintAst</span> = <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">OfType</span>&lt;<a href="../parser/ast.cs.html#34b9d5dbbaca964d" class="t t">TypeConstraintAst</a>&gt;().<span class="i">FirstOrDefault</span>();
                    <b>if</b> (<span class="r117 r">typeConstraintAst</span> != <b>null</b>)
                    {
                        <span class="r116 r">typeNameToComplete</span> = <span class="i">FindTypeNameToComplete</span>(<span class="r117 r">typeConstraintAst</span>.<span class="i">TypeName</span>, <a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a>);
                    }
                }
 
                <b>if</b> (<span class="r116 r">typeNameToComplete</span> != <b>null</b>)
                {
                    <span class="c">// See if the typename to complete really is within the typename, and if so, which one, in the case of generics.</span>
 
                    <span class="r77 r">replacementIndex</span> = <span class="r116 r">typeNameToComplete</span>.<a href="../parser/ast.cs.html#1ce6d6f63fe6922f" class="i property">Extent</a>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a>;
                    <span class="r78 r">replacementLength</span> = <span class="r116 r">typeNameToComplete</span>.<a href="../parser/ast.cs.html#1ce6d6f63fe6922f" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a> - <span class="r77 r">replacementIndex</span>;
                    <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r116 r">typeNameToComplete</span>.<a href="../parser/ast.cs.html#5d27e8e58d692064" class="i property">FullName</a>;
                    <span class="r82 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#57017baf59ddb34d" class="i method">CompleteType</a>(<span class="r76 r">completionContext</span>);
                }
            }
 
            <b>if</b> (<span class="r82 r">result</span> == <b>null</b> || <span class="r82 r">result</span>.<span class="i">Count</span> == 0)
            {
                <span class="r82 r">result</span> = <a href="#8880d3486a4d50f6" class="i method">GetResultForHashtable</a>(<span class="r76 r">completionContext</span>);
            }
 
            <b>if</b> (<span class="r82 r">result</span> == <b>null</b> || <span class="r82 r">result</span>.<span class="i">Count</span> == 0)
            {
                <span class="c">// Handle special file completion scenarios: .\+file.txt -&gt; +&lt;tab&gt;</span>
                <b>string</b> <span id="r118 rd" class="r118 r">input</span> = <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>[0].<span class="i">Extent</span>.<span class="i">Text</span>;
                <b>if</b> (<span class="i">Regex</span>.<span class="i">IsMatch</span>(<span class="r118 r">input</span>, <span class="s">@&quot;^[\S]+$&quot;</span>) &amp;&amp; <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Count</span> &gt; 0 &amp;&amp; <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>[0] <b>is</b> <a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a>)
                {
                    <span class="r77 r">replacementIndex</span> = <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>[0].<span class="i">Extent</span>.<span class="i">StartScriptPosition</span>.<span class="i">Offset</span>;
                    <span class="r78 r">replacementLength</span> = <span class="r76 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>[0].<span class="i">Extent</span>.<span class="i">EndScriptPosition</span>.<span class="i">Offset</span> - <span class="r77 r">replacementIndex</span>;
 
                    <span class="r76 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r118 r">input</span>;
                    <span class="r82 r">result</span> = <a href="#b47688d1e87210f0" class="i method">CompleteFileNameAsCommand</a>(<span class="r76 r">completionContext</span>);
                }
            }
 
            <b>return</b> <span class="r82 r">result</span>;
        }
 
        <span class="c">// Helper method to auto complete hashtable key</span>
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="8880d3486a4d50f6" href="../../R/8880d3486a4d50f6.html" target="n" data-glyph="76,1" class="i method">GetResultForHashtable</a>(<a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r119 rd" class="r119 r">completionContext</span>)
        {
            <b>var</b> <span id="r120 rd" class="r120 r">lastAst</span> = <span class="r119 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Last</span>();
            <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a> <span id="r121 rd" class="r121 r">tempHashtableAst</span> = <b>null</b>;
            <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r122 rd" class="r122 r">cursor</span> = <span class="r119 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>;
            <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="k">var</a> <span id="r123 rd" class="r123 r">hashTableAst</span> = <span class="r120 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a>;
            <b>if</b> (<span class="r123 r">hashTableAst</span> != <b>null</b>)
            {
                <span class="c">// Check if the cursor within the hashtable</span>
                <b>if</b> (<span class="r122 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &lt; <span class="r123 r">hashTableAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>)
                {
                    <span class="r121 r">tempHashtableAst</span> = <span class="r123 r">hashTableAst</span>;
                }
                <b>else</b> <b>if</b> (<span class="r122 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> == <span class="r123 r">hashTableAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>)
                {
                    <span class="c">// Exclude the scenario that cursor at the end of hashtable, i.e. after &#39;}&#39;</span>
                    <b>if</b> (<span class="r119 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> == <b>null</b> ||
                        <span class="r119 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> != <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#fa7a2db081fa97d8" class="i field">RCurly</a>)
                    {
                        <span class="r121 r">tempHashtableAst</span> = <span class="r123 r">hashTableAst</span>;
                    }
                }
            }
            <b>else</b>
            {
                <span class="c">// Handle property completion on a blank line for DynamicKeyword statement</span>
                <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r124 rd" class="r124 r">lastChildofHashtableAst</span>;
                <span class="r123 r">hashTableAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<span class="i">GetAncestorHashtableAst</span>(<span class="r120 r">lastAst</span>, <b>out</b> <span class="r124 r">lastChildofHashtableAst</span>);
 
                <span class="c">// Check if the hashtable within a DynamicKeyword statement</span>
                <b>if</b> (<span class="r123 r">hashTableAst</span> != <b>null</b>)
                {
                    <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="k">var</a> <span id="r125 rd" class="r125 r">keywordAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../parser/ast.cs.html#4ec2535310b60c23" class="i method">GetAncestorAst</a>&lt;<a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a>&gt;(<span class="r123 r">hashTableAst</span>);
                    <b>if</b> (<span class="r125 r">keywordAst</span> != <b>null</b>)
                    {
                        <span class="c">// Handle only empty line</span>
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r122 r">cursor</span>.<a href="../parser/Position.cs.html#5498933e478f6930" class="i property">Line</a>))
                        {
                            <span class="c">// Check if the cursor outside of last child of hashtable and within the hashtable</span>
                            <b>if</b> (<span class="r122 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &gt; <span class="r124 r">lastChildofHashtableAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a> &amp;&amp;
                                <span class="r122 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &lt;= <span class="r123 r">hashTableAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>)
                            {
                                <span class="r121 r">tempHashtableAst</span> = <span class="r123 r">hashTableAst</span>;
                            }
                        }
                    }
                }
            }
 
            <span class="r123 r">hashTableAst</span> = <span class="r121 r">tempHashtableAst</span>;
            <b>if</b> (<span class="r123 r">hashTableAst</span> != <b>null</b>)
            {
                <span class="r119 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r119 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                <span class="r119 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = 0;
                <b>return</b> <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#dffbec9e850a0d5a" class="i method">CompleteHashtableKey</a>(<span class="r119 r">completionContext</span>, <span class="r123 r">hashTableAst</span>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">// Helper method to look for an incomplete assignment pair in hash table.</span>
        <b>private static bool</b> <a id="0ed5f3bc6f836d3c" href="../../R/0ed5f3bc6f836d3c.html" target="n" data-glyph="76,1" class="i method">CheckForPendingAssignment</a>(<a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a> <span id="r126 rd" class="r126 r">hashTableAst</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r127 rd" class="r127 r">keyValue</span> <b>in</b> <span class="r126 r">hashTableAst</span>.<a href="../parser/ast.cs.html#87313f35bc2b66d9" class="i property">KeyValuePairs</a>)
            {
                <b>if</b> (<span class="r127 r">keyValue</span>.<span class="i">Item2</span> <b>is</b> <a href="../parser/ast.cs.html#e02a155b7afded8b" class="t t">ErrorStatementAst</a>)
                {
                    <span class="c">// This indicates the assignment has not completed.</span>
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static</b> <a href="../parser/ast.cs.html#83b43c1855a09e15" class="t t">TypeName</a> <a id="7b63557478b3594a" href="../../R/7b63557478b3594a.html" target="n" data-glyph="74,1" class="i method">FindTypeNameToComplete</a>(<a href="../parser/ast.cs.html#a422e1772da6dbc8" class="t t">ITypeName</a> <span id="r128 rd" class="r128 r">type</span>, <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r129 rd" class="r129 r">cursor</span>)
        {
            <a href="../parser/ast.cs.html#83b43c1855a09e15" class="k">var</a> <span id="r130 rd" class="r130 r">typeName</span> = <span class="r128 r">type</span> <b>as</b> <a href="../parser/ast.cs.html#83b43c1855a09e15" class="t t">TypeName</a>;
            <b>if</b> (<span class="r130 r">typeName</span> != <b>null</b>)
            {
                <span class="c">// If the cursor is at the start offset, it&#39;s not really inside, so return null.</span>
                <span class="c">// If the cursor is at the end offset, it&#39;s not really inside, but it&#39;s just before the cursor,</span>
                <span class="c">// we don want to complete it.</span>
                <b>return</b> (<span class="r129 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &gt; <span class="r128 r">type</span>.<a href="../parser/ast.cs.html#2b8e897172d31016" class="i property">Extent</a>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a> &amp;&amp; <span class="r129 r">cursor</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &lt;= <span class="r128 r">type</span>.<a href="../parser/ast.cs.html#2b8e897172d31016" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>)
                           ? <span class="r130 r">typeName</span>
                           : <b>null</b>;
            }
 
            <a href="../parser/ast.cs.html#d3e3939e37307477" class="k">var</a> <span id="r131 rd" class="r131 r">genericTypeName</span> = <span class="r128 r">type</span> <b>as</b> <a href="../parser/ast.cs.html#d3e3939e37307477" class="t t">GenericTypeName</a>;
            <b>if</b> (<span class="r131 r">genericTypeName</span> != <b>null</b>)
            {
                <span class="r130 r">typeName</span> = <a href="#7b63557478b3594a" class="i method">FindTypeNameToComplete</a>(<span class="r131 r">genericTypeName</span>.<a href="../parser/ast.cs.html#a0e9895f5c1358ce" class="i property">TypeName</a>, <span class="r129 r">cursor</span>);
                <b>if</b> (<span class="r130 r">typeName</span> != <b>null</b>)
                    <b>return</b> <span class="r130 r">typeName</span>;
                <b>foreach</b> (<b>var</b> <span id="r132 rd" class="r132 r">t</span> <b>in</b> <span class="r131 r">genericTypeName</span>.<a href="../parser/ast.cs.html#c3319d29a1b29f46" class="i property">GenericArguments</a>)
                {
                    <span class="r130 r">typeName</span> = <span class="i">FindTypeNameToComplete</span>(<span class="r132 r">t</span>, <span class="r129 r">cursor</span>);
                    <b>if</b> (<span class="r130 r">typeName</span> != <b>null</b>)
                        <b>return</b> <span class="r130 r">typeName</span>;
                }
 
                <b>return</b> <b>null</b>;
            }
 
            <a href="../parser/ast.cs.html#8588eb9308b68261" class="k">var</a> <span id="r133 rd" class="r133 r">arrayTypeName</span> = <span class="r128 r">type</span> <b>as</b> <a href="../parser/ast.cs.html#8588eb9308b68261" class="t t">ArrayTypeName</a>;
            <b>if</b> (<span class="r133 r">arrayTypeName</span> != <b>null</b>)
            {
                <b>return</b> <a href="#7b63557478b3594a" class="i method">FindTypeNameToComplete</a>(<span class="r133 r">arrayTypeName</span>.<a href="../parser/ast.cs.html#0f81729ec1838610" class="i property">ElementType</a>, <span class="r129 r">cursor</span>) ?? <b>null</b>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private static string</b> <a id="c2d014ff737c31c5" href="../../R/c2d014ff737c31c5.html" target="n" data-glyph="76,1" class="i method">GetFirstLineSubString</a>(<b>string</b> <span id="r134 rd" class="r134 r">stringToComplete</span>, <b>out bool</b> <span id="r135 rd" class="r135 r">hasNewLine</span>)
        {
            <span class="r135 r">hasNewLine</span> = <b>false</b>;
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r134 r">stringToComplete</span>))
            {
                <b>var</b> <span id="r136 rd" class="r136 r">index</span> = <span class="r134 r">stringToComplete</span>.<span class="i">IndexOfAny</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#bac08b33e7613991" class="i field">CrLf</a>);
                <b>if</b> (<span class="r136 r">index</span> &gt;= 0)
                {
                    <span class="r134 r">stringToComplete</span> = <span class="r134 r">stringToComplete</span>.<span class="i">Substring</span>(0, <span class="r136 r">index</span>);
                    <span class="r135 r">hasNewLine</span> = <b>true</b>;
                }
            }
 
            <b>return</b> <span class="r134 r">stringToComplete</span>;
        }
 
        <b>private static</b> <span class="i">Tuple</span>&lt;<a href="../parser/ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a>, <a href="../parser/ast.cs.html#9c25dfdd7f4807b0" class="t t">StatementAst</a>&gt; <a id="ae74eb53a02dabc0" href="../../R/ae74eb53a02dabc0.html" target="n" data-glyph="76,1" class="i method">GetHashEntryContainsCursor</a>(
            <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r137 rd" class="r137 r">cursor</span>,
            <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a> <span id="r138 rd" class="r138 r">hashTableAst</span>,
            <b>bool</b> <span id="r139 rd" class="r139 r">isCursorInString</span>)
        {
            <span class="i">Tuple</span>&lt;<a href="../parser/ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a>, <a href="../parser/ast.cs.html#9c25dfdd7f4807b0" class="t t">StatementAst</a>&gt; <span id="r140 rd" class="r140 r">keyValuePairWithCursor</span> = <b>null</b>;
            <b>foreach</b> (<b>var</b> <span id="r141 rd" class="r141 r">kvp</span> <b>in</b> <span class="r138 r">hashTableAst</span>.<a href="../parser/ast.cs.html#87313f35bc2b66d9" class="i property">KeyValuePairs</a>)
            {
                <b>if</b> (<span class="i">IsCursorWithinOrJustAfterExtent</span>(<span class="r137 r">cursor</span>, <span class="r141 r">kvp</span>.<span class="i">Item2</span>.<span class="i">Extent</span>))
                {
                    <span class="r140 r">keyValuePairWithCursor</span> = <span class="r141 r">kvp</span>;
                    <b>break</b>;
                }
 
                <b>if</b> (!<span class="r139 r">isCursorInString</span>)
                {
                    <span class="c">//</span>
                    <span class="c">// Handle following case, cursor is after &#39;=&#39; but before next key value pair,</span>
                    <span class="c">// next key value pair will be treated as kvp.Item2 of &#39;Ensure&#39; key</span>
                    <span class="c">//</span>
                    <span class="c">//    configuration foo</span>
                    <span class="c">//    {</span>
                    <span class="c">//        File foo</span>
                    <span class="c">//        {</span>
                    <span class="c">//            DestinationPath = &quot;\foo.txt&quot;</span>
                    <span class="c">//            Ensure = |</span>
                    <span class="c">//            DependsOn =@(&quot;[User]x&quot;)</span>
                    <span class="c">//        }</span>
                    <span class="c">//    }</span>
                    <span class="c">//</span>
                    <b>if</b> (<span class="r141 r">kvp</span>.<span class="i">Item2</span>.<span class="i">Extent</span>.<span class="i">StartLineNumber</span> &gt; <span class="r141 r">kvp</span>.<span class="i">Item1</span>.<span class="i">Extent</span>.<span class="i">EndLineNumber</span> &amp;&amp;
                        <span class="i">IsCursorAfterExtentAndInTheSameLine</span>(<span class="r137 r">cursor</span>, <span class="r141 r">kvp</span>.<span class="i">Item1</span>.<span class="i">Extent</span>))
                    {
                        <span class="r140 r">keyValuePairWithCursor</span> = <span class="r141 r">kvp</span>;
                        <b>break</b>;
                    }
 
                    <span class="c">//</span>
                    <span class="c">// If cursor is not within a string, then handle following two cases,</span>
                    <span class="c">//</span>
                    <span class="c">//  #1) cursor is after &#39;=&#39;, in the same line of previous key value pair</span>
                    <span class="c">//      configuration test{File testfile{DestinationPath=&#39;c:\test&#39;; Ensure = |</span>
                    <span class="c">//</span>
                    <span class="c">//  #2) cursor is after &#39;=&#39;, in the separate line of previous key value pair</span>
                    <span class="c">//      configuration test{File testfile{DestinationPath=&#39;c:\test&#39;;</span>
                    <span class="c">//        Ensure = |</span>
                    <span class="c">//</span>
                    <b>if</b> (!<span class="i">IsCursorBeforeExtent</span>(<span class="r137 r">cursor</span>, <span class="r141 r">kvp</span>.<span class="i">Item1</span>.<span class="i">Extent</span>) &amp;&amp;
                        <span class="i">IsCursorAfterExtentAndInTheSameLine</span>(<span class="r137 r">cursor</span>, <span class="r141 r">kvp</span>.<span class="i">Item2</span>.<span class="i">Extent</span>))
                    {
                        <span class="r140 r">keyValuePairWithCursor</span> = <span class="r141 r">kvp</span>;
                    }
                }
            }
 
            <b>return</b> <span class="r140 r">keyValuePairWithCursor</span>;
        }
 
        <span class="c">// Pulls the variable out of an assignment&#39;s LHS expression</span>
        <span class="c">// Also brings back the innermost type constraint if there is one</span>
        <b>private static</b> <a href="../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a> <a id="491fbf432a80d4e4" href="../../R/491fbf432a80d4e4.html" target="n" data-glyph="76,1" class="i method">GetVariableFromExpressionAst</a>(
            <a href="../parser/ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r142 rd" class="r142 r">expression</span>,
            <b>ref</b> <span class="i">Type</span> <span id="r143 rd" class="r143 r">typeConstraint</span>,
            <b>ref</b> <a href="../Attributes.cs.html#33a6a027748d30a4" class="t t">ValidateSetAttribute</a> <span id="r144 rd" class="r144 r">setConstraint</span>)
        {
            <b>switch</b> (<span class="r142 r">expression</span>)
            {
                <span class="c">// $x = ...</span>
                <b>case</b> <a href="../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a> <span id="r145 rd" class="r145 r">variableExpression</span>:
                    <b>return</b> <span class="r145 r">variableExpression</span>;
 
                <span class="c">// [type]$x = ...</span>
                <b>case</b> <a href="../parser/ast.cs.html#49daf252fdb62723" class="t t">ConvertExpressionAst</a> <span id="r146 rd" class="r146 r">convertExpression</span>:
                    <span class="r143 r">typeConstraint</span> = <span class="r146 r">convertExpression</span>.<a href="../parser/ast.cs.html#ecb5959c230c5865" class="i property">Type</a>.<a href="../parser/ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a>.<a href="../parser/ast.cs.html#eba83ef9fd0feedd" class="i method">GetReflectionType</a>();
                    <b>return</b> <a href="#491fbf432a80d4e4" class="i method">GetVariableFromExpressionAst</a>(<span class="r146 r">convertExpression</span>.<a href="../parser/ast.cs.html#b2353777e73e35be" class="i property">Child</a>, <b>ref</b> <span class="r143 r">typeConstraint</span>, <b>ref</b> <span class="r144 r">setConstraint</span>);
 
                <span class="c">// [attribute()][type]$x = ...</span>
                <b>case</b> <a href="../parser/ast.cs.html#434eb922ec6ac95b" class="t t">AttributedExpressionAst</a> <span id="r147 rd" class="r147 r">attributedExpressionAst</span>:
 
                    <b>try</b>
                    {
                        <span class="r144 r">setConstraint</span> = <span class="r147 r">attributedExpressionAst</span>.<a href="../parser/ast.cs.html#29f1db02fe3920d7" class="i property">Attribute</a>.<a href="../parser/ast.cs.html#4335717fad9e152b" class="i method">GetAttribute</a>() <b>as</b> <a href="../Attributes.cs.html#33a6a027748d30a4" class="t t">ValidateSetAttribute</a>;
                    }
                    <b>catch</b>
                    {
                        <span class="c">// Do nothing, just prevent fallout from an unsuccessful attribute conversion</span>
                    }
 
                    <b>return</b> <a href="#491fbf432a80d4e4" class="i method">GetVariableFromExpressionAst</a>(<span class="r147 r">attributedExpressionAst</span>.<a href="../parser/ast.cs.html#b2353777e73e35be" class="i property">Child</a>, <b>ref</b> <span class="r143 r">typeConstraint</span>, <b>ref</b> <span class="r144 r">setConstraint</span>);
 
                <span class="c">// Something else, like `MemberExpressionAst` $a.p = &lt;tab&gt; which isn&#39;t currently handled</span>
                <b>default</b>:
                    <b>return</b> <b>null</b>;
            }
        }
 
        <span class="c">// Gets any type constraints or validateset constraints on a given variable</span>
        <b>private static bool</b> <a id="3d0f07124600ef95" href="../../R/3d0f07124600ef95.html" target="n" data-glyph="76,1" class="i method">TryGetTypeConstraintOnVariable</a>(
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r148 rd" class="r148 r">completionContext</span>,
            <b>string</b> <span id="r149 rd" class="r149 r">variableName</span>,
            <b>out</b> <span class="i">Type</span> <span id="r150 rd" class="r150 r">typeConstraint</span>,
            <b>out</b> <a href="../Attributes.cs.html#33a6a027748d30a4" class="t t">ValidateSetAttribute</a> <span id="r151 rd" class="r151 r">setConstraint</span>)
        {
            <span class="r150 r">typeConstraint</span> = <b>null</b>;
            <span class="r151 r">setConstraint</span> = <b>null</b>;
 
            <a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r152 rd" class="r152 r">variable</span> = <span class="r148 r">completionContext</span>.<a href="#4055c622a2008ac8" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateVariableAPIs.cs.html#e8489f28d543d2b6" class="i method">GetVariable</a>(<span class="r149 r">variableName</span>);
 
            <b>if</b> (<span class="r152 r">variable</span> == <b>null</b> || <span class="r152 r">variable</span>.<a href="../ShellVariable.cs.html#5a5702c328974ec4" class="i property">Attributes</a>.<span class="i">Count</span> == 0)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<span class="i">Attribute</span> <span id="r153 rd" class="r153 r">attribute</span> <b>in</b> <span class="r152 r">variable</span>.<a href="../ShellVariable.cs.html#5a5702c328974ec4" class="i property">Attributes</a>)
            {
                <b>if</b> (<span class="r153 r">attribute</span> <b>is</b> <a href="../ArgumentTypeConverterAttribute.cs.html#3116d64966cc38c0" class="t t">ArgumentTypeConverterAttribute</a> <span id="r154 rd" class="r154 r">typeConverterAttribute</span>)
                {
                    <span class="r150 r">typeConstraint</span> = <span class="r154 r">typeConverterAttribute</span>.<a href="../ArgumentTypeConverterAttribute.cs.html#2a8d933c51bd8bb9" class="i property">TargetType</a>;
                    <b>continue</b>;
                }
 
                <b>if</b> (<span class="r153 r">attribute</span> <b>is</b> <a href="../Attributes.cs.html#33a6a027748d30a4" class="t t">ValidateSetAttribute</a> <span id="r155 rd" class="r155 r">validateSetAttribute</span>)
                {
                    <span class="r151 r">setConstraint</span> = <span class="r155 r">validateSetAttribute</span>;
                }
            }
 
            <b>return</b> <span class="r150 r">typeConstraint</span> != <b>null</b> || <span class="r151 r">setConstraint</span> != <b>null</b>;
        }
 
        <b>private static bool</b> <a id="58ba07aafea0b2e7" href="../../R/58ba07aafea0b2e7.html" target="n" data-glyph="76,1" class="i method">TryGetCompletionsForVariableAssignment</a>(
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r156 rd" class="r156 r">completionContext</span>,
            <a href="../parser/ast.cs.html#da5f345864f42e06" class="t t">AssignmentStatementAst</a> <span id="r157 rd" class="r157 r">assignmentAst</span>,
            <b>out</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r158 rd" class="r158 r">completions</span>)
        {
            <b>bool</b> <a id="4b56d1ae73376c6b" href="../../R/4b56d1ae73376c6b.html" target="n" data-glyph="76,2" class="i method">TryGetResultForEnum</a>(<span class="i">Type</span> <span id="r159 rd" class="r159 r">typeConstraint</span>, <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r160 rd" class="r160 r">completionContext</span>, <b>out</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r161 rd" class="r161 r">completions</span>)
            {
                <span class="r161 r">completions</span> = <b>null</b>;
 
                <b>if</b> (<span class="r159 r">typeConstraint</span> != <b>null</b> &amp;&amp; <span class="r159 r">typeConstraint</span>.<span class="i">IsEnum</span>)
                {
                    <span class="r161 r">completions</span> = <a href="#ae97b82f7d6eea1b" class="i method">GetResultForEnum</a>(<span class="r159 r">typeConstraint</span>, <span class="r160 r">completionContext</span>);
                    <b>return</b> <b>true</b>;
                }
 
                <b>return</b> <b>false</b>;
            }
 
            <b>bool</b> <a id="7f4ae9e0cca10067" href="../../R/7f4ae9e0cca10067.html" target="n" data-glyph="76,2" class="i method">TryGetResultForSet</a>(<span class="i">Type</span> <span id="r162 rd" class="r162 r">typeConstraint</span>, <a href="../Attributes.cs.html#33a6a027748d30a4" class="t t">ValidateSetAttribute</a> <span id="r163 rd" class="r163 r">setConstraint</span>, <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r164 rd" class="r164 r">completionContext1</span>, <b>out</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r165 rd" class="r165 r">completions</span>)
            {
                <span class="r165 r">completions</span> = <b>null</b>;
 
                <b>if</b> (<span class="r163 r">setConstraint</span>?.<a href="../Attributes.cs.html#7e92ecc5d5d777ac" class="i property">ValidValues</a> != <b>null</b>)
                {
                    <span class="r165 r">completions</span> = <a href="#b5252ad0fceaa056" class="i method">GetResultForSet</a>(<span class="r162 r">typeConstraint</span>, <span class="r163 r">setConstraint</span>.<a href="../Attributes.cs.html#7e92ecc5d5d777ac" class="i property">ValidValues</a>, <span class="r156 r">completionContext</span>);
                    <b>return</b> <b>true</b>;
                }
 
                <b>return</b> <b>false</b>;
            }
 
            <span class="r158 r">completions</span> = <b>null</b>;
 
            <span class="c">// Try to get the variable from the assignment, plus any type constraint on it</span>
            <span class="i">Type</span> <span id="r166 rd" class="r166 r">typeConstraint</span> = <b>null</b>;
            <a href="../Attributes.cs.html#33a6a027748d30a4" class="t t">ValidateSetAttribute</a> <span id="r167 rd" class="r167 r">setConstraint</span> = <b>null</b>;
            <a href="../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a> <span id="r168 rd" class="r168 r">variableAst</span> = <a href="#491fbf432a80d4e4" class="i method">GetVariableFromExpressionAst</a>(<span class="r157 r">assignmentAst</span>.<a href="../parser/ast.cs.html#737e87d58bda06dc" class="i property">Left</a>, <b>ref</b> <span class="r166 r">typeConstraint</span>, <b>ref</b> <span class="r167 r">setConstraint</span>);
 
            <b>if</b> (<span class="r168 r">variableAst</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// Assignment constraints override any existing ones, so try them first</span>
 
            <span class="c">// Check any [ValidateSet()] constraint first since it&#39;s likely to be narrow</span>
            <b>if</b> (<a href="#7f4ae9e0cca10067" class="i method">TryGetResultForSet</a>(<span class="r166 r">typeConstraint</span>, <span class="r167 r">setConstraint</span>, <span class="r156 r">completionContext</span>, <b>out</b> <span class="r158 r">completions</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// Then try to complete for an enum type</span>
            <b>if</b> (<a href="#4b56d1ae73376c6b" class="i method">TryGetResultForEnum</a>(<span class="r166 r">typeConstraint</span>, <span class="r156 r">completionContext</span>, <b>out</b> <span class="r158 r">completions</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// If the assignment itself was unconstrained, the variable still might be</span>
            <b>if</b> (!<a href="#3d0f07124600ef95" class="i method">TryGetTypeConstraintOnVariable</a>(<span class="r156 r">completionContext</span>, <span class="r168 r">variableAst</span>.<a href="../parser/ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>.<a href="../VariablePath.cs.html#45529674e4735f30" class="i property">UserPath</a>, <b>out</b> <span class="r166 r">typeConstraint</span>, <b>out</b> <span class="r167 r">setConstraint</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// Again try the [ValidateSet()] constraint first</span>
            <b>if</b> (<a href="#7f4ae9e0cca10067" class="i method">TryGetResultForSet</a>(<span class="r166 r">typeConstraint</span>, <span class="r167 r">setConstraint</span>, <span class="r156 r">completionContext</span>, <b>out</b> <span class="r158 r">completions</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// Then try to complete for an enum type again</span>
            <b>if</b> (<a href="#4b56d1ae73376c6b" class="i method">TryGetResultForEnum</a>(<span class="r166 r">typeConstraint</span>, <span class="r156 r">completionContext</span>, <b>out</b> <span class="r158 r">completions</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="b5252ad0fceaa056" href="../../R/b5252ad0fceaa056.html" target="n" data-glyph="76,1" class="i method">GetResultForSet</a>(
            <span class="i">Type</span> <span id="r169 rd" class="r169 r">typeConstraint</span>,
            <span class="i">IList</span>&lt;<b>string</b>&gt; <span id="r170 rd" class="r170 r">validValues</span>,
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r171 rd" class="r171 r">completionContext</span>)
        {
            <b>var</b> <span id="r172 rd" class="r172 r">allValues</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <b>foreach</b> (<b>string</b> <span id="r173 rd" class="r173 r">value</span> <b>in</b> <span class="r170 r">validValues</span>)
            {
                <b>if</b> (<span class="r169 r">typeConstraint</span> != <b>null</b> &amp;&amp; (<span class="r169 r">typeConstraint</span> == <b>typeof</b>(<b>string</b>) || <span class="r169 r">typeConstraint</span>.<span class="i">IsEnum</span>))
                {
                    <span class="r172 r">allValues</span>.<span class="i">Add</span>(<a href="#b4a16598bd0e08a9" class="i method">GetQuotedString</a>(<span class="r173 r">value</span>, <span class="r171 r">completionContext</span>));
                }
                <b>else</b>
                {
                    <span class="r172 r">allValues</span>.<span class="i">Add</span>(<span class="r173 r">value</span>);
                }
            }
 
            <b>return</b> <a href="#6ffb31a17cab356a" class="i method">GetMatchedResults</a>(<span class="r172 r">allValues</span>, <span class="r171 r">completionContext</span>);
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="6ffb31a17cab356a" href="../../R/6ffb31a17cab356a.html" target="n" data-glyph="76,1" class="i method">GetMatchedResults</a>(
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r174 rd" class="r174 r">allValues</span>,
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r175 rd" class="r175 r">completionContext</span>)
        {
            <b>var</b> <span id="r176 rd" class="r176 r">stringToComplete</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<span class="r175 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> != <b>null</b> &amp;&amp; <span class="r175 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a> != <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#d78e08594ff6b79a" class="i field">Equals</a>)
            {
                <span class="r176 r">stringToComplete</span> = <span class="r175 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
            }
 
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r177 rd" class="r177 r">matchedResults</span> = <b>null</b>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r176 r">stringToComplete</span>))
            {
                <b>string</b> <span id="r178 rd" class="r178 r">matchString</span> = <span class="r176 r">stringToComplete</span> + <span class="s">&quot;*&quot;</span>;
                <a href="../regex.cs.html#d450e739ff28e660" class="k">var</a> <span id="r179 rd" class="r179 r">wildcardPattern</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r178 r">matchString</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a>);
 
                <span class="r177 r">matchedResults</span> = <span class="r174 r">allValues</span>.<span class="i">Where</span>(<span id="r180 rd" class="r180 r">r</span> =&gt; <span class="r179 r">wildcardPattern</span>.<span class="i">IsMatch</span>(<span class="r180 r">r</span>));
            }
            <b>else</b>
            {
                <span class="r177 r">matchedResults</span> = <span class="r174 r">allValues</span>;
            }
 
            <b>var</b> <span id="r181 rd" class="r181 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;();
            <b>foreach</b> (<b>var</b> <span id="r182 rd" class="r182 r">match</span> <b>in</b> <span class="r177 r">matchedResults</span>)
            {
                <span class="r181 r">result</span>.<span class="i">Add</span>(<b>new</b> <span class="t">CompletionResult</span>(<span class="r182 r">match</span>));
            }
 
            <b>return</b> <span class="r181 r">result</span>;
        }
 
        <b>private static string</b> <a id="b4a16598bd0e08a9" href="../../R/b4a16598bd0e08a9.html" target="n" data-glyph="76,1" class="i method">GetQuotedString</a>(
            <b>string</b> <span id="r183 rd" class="r183 r">value</span>,
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r184 rd" class="r184 r">completionContext</span>)
        {
            <b>var</b> <span id="r185 rd" class="r185 r">stringToComplete</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<span class="r184 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> != <b>null</b>)
            {
                <span class="r185 r">stringToComplete</span> = <span class="r184 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
            }
 
            <b>var</b> <span id="r186 rd" class="r186 r">quote</span> = <span class="r185 r">stringToComplete</span>.<span class="i">StartsWith</span>(<span class="s">&#39;&quot;&#39;</span>) ? <span class="s">&quot;\&quot;&quot;</span> : <span class="s">&quot;&#39;&quot;</span>;
            <b>return</b> <span class="r186 r">quote</span> + <span class="r183 r">value</span> + <span class="r186 r">quote</span>;
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="ae97b82f7d6eea1b" href="../../R/ae97b82f7d6eea1b.html" target="n" data-glyph="76,1" class="i method">GetResultForEnum</a>(
            <span class="i">Type</span> <span id="r187 rd" class="r187 r">type</span>,
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r188 rd" class="r188 r">completionContext</span>)
        {
            <b>var</b> <span id="r189 rd" class="r189 r">allNames</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <b>foreach</b> (<b>var</b> <span id="r190 rd" class="r190 r">name</span> <b>in</b> <span class="i">Enum</span>.<span class="i">GetNames</span>(<span class="r187 r">type</span>))
            {
                <span class="r189 r">allNames</span>.<span class="i">Add</span>(<span class="i">GetQuotedString</span>(<span class="r190 r">name</span>, <span class="r188 r">completionContext</span>));
            }
 
            <span class="r189 r">allNames</span>.<span class="i">Sort</span>();
 
            <b>return</b> <a href="#6ffb31a17cab356a" class="i method">GetMatchedResults</a>(<span class="r189 r">allNames</span>, <span class="r188 r">completionContext</span>);
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="b2382d9e41238695" href="../../R/b2382d9e41238695.html" target="n" data-glyph="76,1" class="i method">GetResultForEnumPropertyValueOfDSCResource</a>(
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r191 rd" class="r191 r">completionContext</span>,
            <b>string</b> <span id="r192 rd" class="r192 r">stringToComplete</span>,
            <b>ref int</b> <span id="r193 rd" class="r193 r">replacementIndex</span>,
            <b>ref int</b> <span id="r194 rd" class="r194 r">replacementLength</span>,
            <b>out bool</b> <span id="r195 rd" class="r195 r">shouldContinue</span>)
        {
            <span class="r195 r">shouldContinue</span> = <b>true</b>;
            <b>bool</b> <span id="r196 rd" class="r196 r">isCursorInString</span> = <span class="r191 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> <b>is</b> <a href="../parser/token.cs.html#dce06fb5d7448125" class="t t">StringToken</a>;
            <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r197 rd" class="r197 r">result</span> = <b>null</b>;
            <b>var</b> <span id="r198 rd" class="r198 r">lastAst</span> = <span class="r191 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Last</span>();
            <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r199 rd" class="r199 r">lastChildofHashtableAst</span>;
            <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="k">var</a> <span id="r200 rd" class="r200 r">hashTableAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<span class="i">GetAncestorHashtableAst</span>(<span class="r198 r">lastAst</span>, <b>out</b> <span class="r199 r">lastChildofHashtableAst</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r192 r">stringToComplete</span> != <b>null</b>, <span class="s">&quot;stringToComplete should never be null&quot;</span>);
            <span class="c">// Check if the hashtable within a DynamicKeyword statement</span>
            <b>if</b> (<span class="r200 r">hashTableAst</span> != <b>null</b>)
            {
                <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="k">var</a> <span id="r201 rd" class="r201 r">keywordAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../parser/ast.cs.html#4ec2535310b60c23" class="i method">GetAncestorAst</a>&lt;<a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a>&gt;(<span class="r200 r">hashTableAst</span>);
                <b>if</b> (<span class="r201 r">keywordAst</span> != <b>null</b>)
                {
                    <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r202 rd" class="r202 r">cursor</span> = <span class="r191 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>;
                    <b>var</b> <span id="r203 rd" class="r203 r">keyValuePairWithCursor</span> = <a href="#ae74eb53a02dabc0" class="i method">GetHashEntryContainsCursor</a>(<span class="r202 r">cursor</span>, <span class="r200 r">hashTableAst</span>, <span class="r196 r">isCursorInString</span>);
                    <b>if</b> (<span class="r203 r">keyValuePairWithCursor</span> != <b>null</b>)
                    {
                        <a href="../parser/ast.cs.html#e18e1bad255cd022" class="k">var</a> <span id="r204 rd" class="r204 r">propertyNameAst</span> = <span class="r203 r">keyValuePairWithCursor</span>.<span class="i">Item1</span> <b>as</b> <a href="../parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>;
                        <b>if</b> (<span class="r204 r">propertyNameAst</span> != <b>null</b>)
                        {
                            <a href="../parser/tokenizer.cs.html#d3231c99121763c4" class="t t">DynamicKeywordProperty</a> <span id="r205 rd" class="r205 r">property</span>;
                            <b>if</b> (<span class="r201 r">keywordAst</span>.<a href="../parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../parser/tokenizer.cs.html#5381d21bcf0af976" class="i property">Properties</a>.<span class="i">TryGetValue</span>(<span class="r204 r">propertyNameAst</span>.<a href="../parser/ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a>, <b>out</b> <span class="r205 r">property</span>))
                            {
                                <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r206 rd" class="r206 r">existingValues</span> = <b>null</b>;
                                <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r207 rd" class="r207 r">wildcardPattern</span> = <b>null</b>;
                                <b>bool</b> <span id="r208 rd" class="r208 r">isDependsOnProperty</span> = <b>string</b>.<span class="i">Equals</span>(<span class="r205 r">property</span>.<a href="../parser/tokenizer.cs.html#1f6c4268727988c7" class="i property">Name</a>, <span class="s">@&quot;DependsOn&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
                                <b>bool</b> <span id="r209 rd" class="r209 r">hasNewLine</span> = <b>false</b>;
                                <b>string</b> <span id="r210 rd" class="r210 r">stringQuote</span> = (<span class="r191 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> <b>is</b> <a href="../parser/token.cs.html#7be5d7d2cd2a65ac" class="t t">StringExpandableToken</a>) ? <span class="s">&quot;\&quot;&quot;</span> : <span class="s">&quot;&#39;&quot;</span>;
                                <b>if</b> ((<span class="r205 r">property</span>.<a href="../parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a> != <b>null</b> &amp;&amp; <span class="r205 r">property</span>.<a href="../parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a>.<span class="i">Count</span> &gt; 0) || <span class="r208 r">isDependsOnProperty</span>)
                                {
                                    <span class="r195 r">shouldContinue</span> = <b>false</b>;
                                    <span class="r206 r">existingValues</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r205 r">property</span>.<a href="../parser/tokenizer.cs.html#ee8bc84e145d2931" class="i property">TypeConstraint</a>, <span class="s">&quot;StringArray&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                    {
                                        <a href="../parser/ast.cs.html#0e44bc9125134006" class="k">var</a> <span id="r211 rd" class="r211 r">arrayAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<span class="i">GetAncestorAst</span>&lt;<a href="../parser/ast.cs.html#0e44bc9125134006" class="t t">ArrayLiteralAst</a>&gt;(<span class="r198 r">lastAst</span>);
                                        <b>if</b> (<span class="r211 r">arrayAst</span> != <b>null</b> &amp;&amp; <span class="r211 r">arrayAst</span>.<a href="../parser/ast.cs.html#1b2cdef74794d8b9" class="i property">Elements</a>.<span class="i">Count</span> &gt; 0)
                                        {
                                            <b>foreach</b> (<a href="../parser/ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r212 rd" class="r212 r">expression</span> <b>in</b> <span class="r211 r">arrayAst</span>.<a href="../parser/ast.cs.html#1b2cdef74794d8b9" class="i property">Elements</a>)
                                            {
                                                <span class="c">//</span>
                                                <span class="c">// stringAst can be null in following case</span>
                                                <span class="c">//      DependsOn=&#39;[user]x&#39;,|</span>
                                                <span class="c">//</span>
                                                <a href="../parser/ast.cs.html#e18e1bad255cd022" class="k">var</a> <span id="r213 rd" class="r213 r">stringAst</span> = <span class="r212 r">expression</span> <b>as</b> <a href="../parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>;
                                                <b>if</b> (<span class="r213 r">stringAst</span> != <b>null</b> &amp;&amp; <a href="#15755919009fa144" class="i method">IsCursorOutsideOfExtent</a>(<span class="r202 r">cursor</span>, <span class="r212 r">expression</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>))
                                                {
                                                    <span class="r206 r">existingValues</span>.<span class="i">Add</span>(<span class="r213 r">stringAst</span>.<a href="../parser/ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a>);
                                                }
                                            }
                                        }
                                    }
                                    <span class="c">//</span>
                                    <span class="c">// Make sure only auto-complete string value in current line</span>
                                    <span class="c">//</span>
                                    <span class="r192 r">stringToComplete</span> = <a href="#c2d014ff737c31c5" class="i method">GetFirstLineSubString</a>(<span class="r192 r">stringToComplete</span>, <b>out</b> <span class="r209 r">hasNewLine</span>);
                                    <span class="r191 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r192 r">stringToComplete</span>;
                                    <span class="r194 r">replacementLength</span> = <span class="r191 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r192 r">stringToComplete</span>.<span class="i">Length</span>;
                                    <span class="c">//</span>
                                    <span class="c">// Calculate the replacementIndex based on cursor location (relative to the string token)</span>
                                    <span class="c">//</span>
                                    <b>if</b> (<span class="r191 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a> <b>is</b> <a href="../parser/token.cs.html#dce06fb5d7448125" class="t t">StringToken</a>)
                                    {
                                        <span class="r193 r">replacementIndex</span> = <span class="r191 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a> + 1;
                                    }
                                    <b>else</b>
                                    {
                                        <span class="r193 r">replacementIndex</span> = <span class="r191 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> - <span class="r194 r">replacementLength</span>;
                                    }
 
                                    <span class="r191 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r193 r">replacementIndex</span>;
                                    <b>string</b> <span id="r214 rd" class="r214 r">matchString</span> = <span class="r192 r">stringToComplete</span> + <span class="s">&quot;*&quot;</span>;
                                    <span class="r207 r">wildcardPattern</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r214 r">matchString</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a>);
                                    <span class="r197 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;();
                                }
 
                                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r196 r">isCursorInString</span> || (!<span class="r209 r">hasNewLine</span>), <span class="s">&quot;hasNoQuote and hasNewLine cannot be true at the same time&quot;</span>);
                                <b>if</b> (<span class="r205 r">property</span>.<a href="../parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a> != <b>null</b> &amp;&amp; <span class="r205 r">property</span>.<a href="../parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a>.<span class="i">Count</span> &gt; 0)
                                {
                                    <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r215 rd" class="r215 r">orderedValues</span> = <span class="r205 r">property</span>.<a href="../parser/tokenizer.cs.html#1a9d98d2588aa02d" class="i property">ValueMap</a>.<span class="i">Keys</span>.<span class="i">OrderBy</span>(<b>static</b> <span id="r216 rd" class="r216 r">x</span> =&gt; <span class="r216 r">x</span>).<span class="i">Where</span>(<span id="r217 rd" class="r217 r">v</span> =&gt; !<span class="r206 r">existingValues</span>.<span class="i">Contains</span>(<span class="r217 r">v</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>));
                                    <b>var</b> <span id="r218 rd" class="r218 r">matchedResults</span> = <span class="r215 r">orderedValues</span>.<span class="i">Where</span>(<span id="r219 rd" class="r219 r">v</span> =&gt; <span class="r207 r">wildcardPattern</span>.<span class="i">IsMatch</span>(<span class="r219 r">v</span>));
                                    <b>if</b> (<span class="r218 r">matchedResults</span> == <b>null</b> || !<span class="r218 r">matchedResults</span>.<span class="i">Any</span>())
                                    {
                                        <span class="c">// Fallback to all allowed values</span>
                                        <span class="r218 r">matchedResults</span> = <span class="r215 r">orderedValues</span>;
                                    }
 
                                    <b>foreach</b> (<b>var</b> <span id="r220 rd" class="r220 r">value</span> <b>in</b> <span class="r218 r">matchedResults</span>)
                                    {
                                        <b>string</b> <span id="r221 rd" class="r221 r">completionText</span> = <span class="r196 r">isCursorInString</span> ? <span class="r220 r">value</span> : <span class="r210 r">stringQuote</span> + <span class="r220 r">value</span> + <span class="r210 r">stringQuote</span>;
                                        <b>if</b> (<span class="r209 r">hasNewLine</span>)
                                            <span class="r221 r">completionText</span> += <span class="r210 r">stringQuote</span>;
                                        <span class="r197 r">result</span>.<span class="i">Add</span>(<b>new</b> <span class="t">CompletionResult</span>(
                                            <span class="r221 r">completionText</span>,
                                            <span class="r220 r">value</span>,
                                            <a href="CompletionResult.cs.html#3cfd90a9cdb70973" class="t t">CompletionResultType</a>.<a href="CompletionResult.cs.html#c2d33fde95710648" class="i field">Text</a>,
                                            <span class="r220 r">value</span>));
                                    }
                                }
                                <b>else</b> <b>if</b> (<span class="r208 r">isDependsOnProperty</span>)
                                {
                                    <a href="../parser/ast.cs.html#d0b13bd03366725b" class="k">var</a> <span id="r222 rd" class="r222 r">configAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../parser/ast.cs.html#4ec2535310b60c23" class="i method">GetAncestorAst</a>&lt;<a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a>&gt;(<span class="r201 r">keywordAst</span>);
                                    <b>if</b> (<span class="r222 r">configAst</span> != <b>null</b>)
                                    {
                                        <a href="../parser/ast.cs.html#61c97c02c53bf32d" class="k">var</a> <span id="r223 rd" class="r223 r">namedBlockAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../parser/ast.cs.html#4ec2535310b60c23" class="i method">GetAncestorAst</a>&lt;<a href="../parser/ast.cs.html#61c97c02c53bf32d" class="t t">NamedBlockAst</a>&gt;(<span class="r201 r">keywordAst</span>);
                                        <b>if</b> (<span class="r223 r">namedBlockAst</span> != <b>null</b>)
                                        {
                                            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r224 rd" class="r224 r">allResources</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                                            <b>foreach</b> (<b>var</b> <span id="r225 rd" class="r225 r">statementAst</span> <b>in</b> <span class="r223 r">namedBlockAst</span>.<a href="../parser/ast.cs.html#496f71fcd5c4e6a1" class="i property">Statements</a>)
                                            {
                                                <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="k">var</a> <span id="r226 rd" class="r226 r">dynamicKeywordAst</span> = <span class="r225 r">statementAst</span> <b>as</b> <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a>;
                                                <b>if</b> (<span class="r226 r">dynamicKeywordAst</span> != <b>null</b> &amp;&amp;
                                                    <span class="r226 r">dynamicKeywordAst</span> != <span class="r201 r">keywordAst</span> &amp;&amp;
                                                    !<b>string</b>.<span class="i">Equals</span>(<span class="r226 r">dynamicKeywordAst</span>.<a href="../parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>, <span class="s">@&quot;Node&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                                {
                                                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r226 r">dynamicKeywordAst</span>.<a href="../parser/ast.cs.html#3ad30598f32e7b03" class="i property">ElementName</a>))
                                                    {
                                                        <span class="i">StringBuilder</span> <span id="r227 rd" class="r227 r">sb</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="s">&quot;[&quot;</span>, 50);
                                                        <span class="r227 r">sb</span>.<span class="i">Append</span>(<span class="r226 r">dynamicKeywordAst</span>.<a href="../parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../parser/tokenizer.cs.html#b4378cc74685de63" class="i property">Keyword</a>);
                                                        <span class="r227 r">sb</span>.<span class="i">Append</span>(<span class="s">&#39;]&#39;</span>);
                                                        <span class="r227 r">sb</span>.<span class="i">Append</span>(<span class="r226 r">dynamicKeywordAst</span>.<a href="../parser/ast.cs.html#3ad30598f32e7b03" class="i property">ElementName</a>);
                                                        <b>var</b> <span id="r228 rd" class="r228 r">resource</span> = <span class="r227 r">sb</span>.<span class="i">ToString</span>();
                                                        <b>if</b> (!<span class="r206 r">existingValues</span>.<span class="i">Contains</span>(<span class="r228 r">resource</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                                                            !<span class="r224 r">allResources</span>.<span class="i">Contains</span>(<span class="r228 r">resource</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>))
                                                        {
                                                            <span class="r224 r">allResources</span>.<span class="i">Add</span>(<span class="r228 r">resource</span>);
                                                        }
                                                    }
                                                }
                                            }
 
                                            <b>var</b> <span id="r229 rd" class="r229 r">matchedResults</span> = <span class="r224 r">allResources</span>.<span class="i">Where</span>(<span id="r230 rd" class="r230 r">r</span> =&gt; <span class="r207 r">wildcardPattern</span>.<span class="i">IsMatch</span>(<span class="r230 r">r</span>));
                                            <b>if</b> (<span class="r229 r">matchedResults</span> == <b>null</b> || !<span class="r229 r">matchedResults</span>.<span class="i">Any</span>())
                                            {
                                                <span class="c">// Fallback to all allowed values</span>
                                                <span class="r229 r">matchedResults</span> = <span class="r224 r">allResources</span>;
                                            }
 
                                            <b>foreach</b> (<b>var</b> <span id="r231 rd" class="r231 r">resource</span> <b>in</b> <span class="r229 r">matchedResults</span>)
                                            {
                                                <b>string</b> <span id="r232 rd" class="r232 r">completionText</span> = <span class="r196 r">isCursorInString</span> ? <span class="r231 r">resource</span> : <span class="r210 r">stringQuote</span> + <span class="r231 r">resource</span> + <span class="r210 r">stringQuote</span>;
                                                <b>if</b> (<span class="r209 r">hasNewLine</span>)
                                                    <span class="r232 r">completionText</span> += <span class="r210 r">stringQuote</span>;
                                                <span class="r197 r">result</span>.<span class="i">Add</span>(<b>new</b> <span class="t">CompletionResult</span>(
                                                    <span class="r232 r">completionText</span>,
                                                    <span class="r231 r">resource</span>,
                                                    <a href="CompletionResult.cs.html#3cfd90a9cdb70973" class="t t">CompletionResultType</a>.<a href="CompletionResult.cs.html#c2d33fde95710648" class="i field">Text</a>,
                                                    <span class="r231 r">resource</span>));
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r197 r">result</span>;
        }
 
        <b>private</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="f540d20e5d2bad7a" href="../../R/f540d20e5d2bad7a.html" target="n" data-glyph="76,1" class="i method">GetResultForString</a>(<a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r233 rd" class="r233 r">completionContext</span>, <b>ref int</b> <span id="r234 rd" class="r234 r">replacementIndex</span>, <b>ref int</b> <span id="r235 rd" class="r235 r">replacementLength</span>, <b>bool</b> <span id="r236 rd" class="r236 r">isQuotedString</span>)
        {
            <span class="c">// When it&#39;s the content of a quoted string, we only handle variable/member completion</span>
            <b>if</b> (<span class="r236 r">isQuotedString</span>) { <b>return</b> <b>null</b>; }
 
            <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="k">var</a> <span id="r237 rd" class="r237 r">tokenAtCursor</span> = <span class="r233 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>;
            <b>var</b> <span id="r238 rd" class="r238 r">lastAst</span> = <span class="r233 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Last</span>();
 
            <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r239 rd" class="r239 r">result</span> = <b>null</b>;
            <a href="../parser/ast.cs.html#dac25e1530bb8b85" class="k">var</a> <span id="r240 rd" class="r240 r">expandableString</span> = <span class="r238 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#dac25e1530bb8b85" class="t t">ExpandableStringExpressionAst</a>;
            <a href="../parser/ast.cs.html#e18e1bad255cd022" class="k">var</a> <span id="r241 rd" class="r241 r">constantString</span> = <span class="r238 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>;
            <b>if</b> (<span class="r241 r">constantString</span> == <b>null</b> &amp;&amp; <span class="r240 r">expandableString</span> == <b>null</b>) { <b>return</b> <b>null</b>; }
 
            <b>string</b> <span id="r242 rd" class="r242 r">strValue</span> = <span class="r241 r">constantString</span> != <b>null</b> ? <span class="r241 r">constantString</span>.<a href="../parser/ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a> : <span class="r240 r">expandableString</span>.<a href="../parser/ast.cs.html#969f667812636ecf" class="i property">Value</a>;
            <a href="../parser/ast.cs.html#9280da14e6db65ed" class="t t">StringConstantType</a> <span id="r243 rd" class="r243 r">strType</span> = <span class="r241 r">constantString</span> != <b>null</b> ? <span class="r241 r">constantString</span>.<a href="../parser/ast.cs.html#de305f3ed8002148" class="i property">StringConstantType</a> : <span class="r240 r">expandableString</span>.<a href="../parser/ast.cs.html#65d512276737c07d" class="i property">StringConstantType</a>;
            <b>string</b> <span id="r244 rd" class="r244 r">subInput</span> = <b>null</b>;
 
            <b>bool</b> <span id="r245 rd" class="r245 r">shouldContinue</span>;
            <span class="r239 r">result</span> = <a href="#b2382d9e41238695" class="i method">GetResultForEnumPropertyValueOfDSCResource</a>(<span class="r233 r">completionContext</span>, <span class="r242 r">strValue</span>, <b>ref</b> <span class="r234 r">replacementIndex</span>, <b>ref</b> <span class="r235 r">replacementLength</span>, <b>out</b> <span class="r245 r">shouldContinue</span>);
            <b>if</b> (!<span class="r245 r">shouldContinue</span> || (<span class="r239 r">result</span> != <b>null</b> &amp;&amp; <span class="r239 r">result</span>.<span class="i">Count</span> &gt; 0))
            {
                <b>return</b> <span class="r239 r">result</span>;
            }
 
            <b>if</b> (<span class="r243 r">strType</span> == <a href="../parser/ast.cs.html#9280da14e6db65ed" class="t t">StringConstantType</a>.<a href="../parser/ast.cs.html#f67f871ab7fadb8a" class="i field">DoubleQuoted</a>)
            {
                <b>var</b> <span id="r246 rd" class="r246 r">match</span> = <span class="i">Regex</span>.<span class="i">Match</span>(<span class="r242 r">strValue</span>, <span class="s">@&quot;(\$[\w\d]+\.[\w\d\*]*)$&quot;</span>);
                <b>if</b> (<span class="r246 r">match</span>.<span class="i">Success</span>)
                {
                    <span class="r244 r">subInput</span> = <span class="r246 r">match</span>.<span class="i">Groups</span>[1].<span class="i">Value</span>;
                }
                <b>else</b> <b>if</b> ((<span class="r246 r">match</span> = <span class="i">Regex</span>.<span class="i">Match</span>(<span class="r242 r">strValue</span>, <span class="s">@&quot;(\[[\w\d\.]+\]::[\w\d\*]*)$&quot;</span>)).<span class="i">Success</span>)
                {
                    <span class="r244 r">subInput</span> = <span class="r246 r">match</span>.<span class="i">Groups</span>[1].<span class="i">Value</span>;
                }
            }
 
            <span class="c">// Handle variable/member completion</span>
            <b>if</b> (<span class="r244 r">subInput</span> != <b>null</b>)
            {
                <b>int</b> <span id="r247 rd" class="r247 r">stringStartIndex</span> = <span class="r237 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#88220ab61fd15a4b" class="i property">StartScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                <b>int</b> <span id="r248 rd" class="r248 r">cursorIndexInString</span> = <a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> - <span class="r247 r">stringStartIndex</span> - 1;
                <b>if</b> (<span class="r248 r">cursorIndexInString</span> &gt;= <span class="r242 r">strValue</span>.<span class="i">Length</span>)
                    <span class="r248 r">cursorIndexInString</span> = <span class="r242 r">strValue</span>.<span class="i">Length</span>;
 
                <a href="#978ec9faf3baf106" class="k">var</a> <span id="r249 rd" class="r249 r">analysis</span> = <b>new</b> <a href="#b6ce3ec3700571b3" class="t constructor">CompletionAnalysis</a>(<a href="#1994043b9b09d1fe" class="i field">_ast</a>, <a href="#2b2e6f8adffb2817" class="i field">_tokens</a>, <a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a>, <a href="#868c6de52bceecc5" class="i field">_options</a>);
                <a href="#f4bb7b26e8be6324" class="k">var</a> <span id="r250 rd" class="r250 r">subContext</span> = <span class="r249 r">analysis</span>.<a href="#42424c2673799b2f" class="i method">CreateCompletionContext</a>(<span class="r233 r">completionContext</span>.<a href="#95d0769179a8633b" class="i property">TypeInferenceContext</a>);
 
                <b>var</b> <span id="r251 rd" class="r251 r">subResult</span> = <span class="r249 r">analysis</span>.<a href="#2a694a198ee5aa3c" class="i method">GetResultHelper</a>(<span class="r250 r">subContext</span>, <b>out int</b> <span id="r252 rd" class="r252 r">subReplaceIndex</span>, <b>out _</b>, <b>true</b>);
 
                <b>if</b> (<span class="r251 r">subResult</span> != <b>null</b> &amp;&amp; <span class="r251 r">subResult</span>.<span class="i">Count</span> &gt; 0)
                {
                    <span class="r239 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;();
                    <span class="r234 r">replacementIndex</span> = <span class="r247 r">stringStartIndex</span> + 1 + (<span class="r248 r">cursorIndexInString</span> - <span class="r244 r">subInput</span>.<span class="i">Length</span>);
                    <span class="r235 r">replacementLength</span> = <span class="r244 r">subInput</span>.<span class="i">Length</span>;
                    <span class="i">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r253 rd" class="r253 r">prefix</span> = <span class="r244 r">subInput</span>.<span class="i">AsSpan</span>(0, <span class="r252 r">subReplaceIndex</span>);
 
                    <b>foreach</b> (<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a> <span id="r254 rd" class="r254 r">entry</span> <b>in</b> <span class="r251 r">subResult</span>)
                    {
                        <b>string</b> <span id="r255 rd" class="r255 r">completionText</span> = <b>string</b>.<span class="i">Concat</span>(<span class="r253 r">prefix</span>, <span class="r254 r">entry</span>.<a href="CompletionResult.cs.html#536dd0f937b80f9b" class="i property">CompletionText</a>.<span class="i">AsSpan</span>());
                        <b>if</b> (<span class="r254 r">entry</span>.<a href="CompletionResult.cs.html#d35199370d0a5658" class="i property">ResultType</a> == <a href="CompletionResult.cs.html#3cfd90a9cdb70973" class="t t">CompletionResultType</a>.<a href="CompletionResult.cs.html#bad7fb67c06b9e4e" class="i field">Property</a>)
                        {
                            <span class="r255 r">completionText</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#daaf3713e66e6f30" class="i field">DollarParen</a>.<a href="../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() + <span class="r255 r">completionText</span> + <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#33afcffc839d1905" class="i field">RParen</a>.<a href="../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                        }
                        <b>else</b> <b>if</b> (<span class="r254 r">entry</span>.<a href="CompletionResult.cs.html#d35199370d0a5658" class="i property">ResultType</a> == <a href="CompletionResult.cs.html#3cfd90a9cdb70973" class="t t">CompletionResultType</a>.<a href="CompletionResult.cs.html#389017ea02ead55a" class="i field">Method</a>)
                        {
                            <span class="r255 r">completionText</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#daaf3713e66e6f30" class="i field">DollarParen</a>.<a href="../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() + <span class="r255 r">completionText</span>;
                        }
 
                        <span class="r255 r">completionText</span> += <span class="s">&quot;\&quot;&quot;</span>;
                        <span class="r239 r">result</span>.<span class="i">Add</span>(<b>new</b> <a href="CompletionResult.cs.html#ca2afdd6b4929db6" class="t constructor">CompletionResult</a>(<span class="r255 r">completionText</span>, <span class="r254 r">entry</span>.<a href="CompletionResult.cs.html#e734fe4987da07ab" class="i property">ListItemText</a>, <span class="r254 r">entry</span>.<a href="CompletionResult.cs.html#d35199370d0a5658" class="i property">ResultType</a>, <span class="r254 r">entry</span>.<a href="CompletionResult.cs.html#34a44c8b3b89530a" class="i property">ToolTip</a>));
                    }
                }
            }
            <b>else</b>
            {
                <a href="../parser/ast.cs.html#22790ae48f5438c6" class="k">var</a> <span id="r256 rd" class="r256 r">commandElementAst</span> = <span class="r238 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#22790ae48f5438c6" class="t t">CommandElementAst</a>;
                <b>string</b> <span id="r257 rd" class="r257 r">wordToComplete</span> =
                    <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<span class="i">ConcatenateStringPathArguments</span>(<span class="r256 r">commandElementAst</span>, <b>string</b>.<span class="i">Empty</span>, <span class="r233 r">completionContext</span>);
 
                <b>if</b> (<span class="r257 r">wordToComplete</span> != <b>null</b>)
                {
                    <span class="r233 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r257 r">wordToComplete</span>;
 
                    <span class="c">// Handle scenarios like this: cd &#39;c:\windows\win&#39;&lt;tab&gt;</span>
                    <b>if</b> (<span class="r238 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> || <span class="r238 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a>)
                    {
                        <span class="r239 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f46bcd6b9210bb57" class="i method">CompleteCommandArgument</a>(<span class="r233 r">completionContext</span>);
                        <span class="r234 r">replacementIndex</span> = <span class="r233 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a>;
                        <span class="r235 r">replacementLength</span> = <span class="r233 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a>;
                    }
                    <span class="c">// Handle scenarios like this: &quot;c:\wind&quot;&lt;tab&gt;. Treat the StringLiteral/StringExpandable as path/command</span>
                    <b>else</b>
                    {
                        <span class="c">// Handle path/commandname completion for quoted string</span>
                        <span class="r239 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;(<a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#729d5ec1cd6162b7" class="i method">CompleteFilename</a>(<span class="r233 r">completionContext</span>));
 
                        <span class="c">// Try command name completion only if the text contains &#39;-&#39;</span>
                        <b>if</b> (<span class="r257 r">wordToComplete</span>.<span class="i">Contains</span>(<span class="s">&#39;-&#39;</span>))
                        {
                            <b>var</b> <span id="r258 rd" class="r258 r">commandNameResult</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#8ad3630ff3ff385a" class="i method">CompleteCommand</a>(<span class="r233 r">completionContext</span>);
                            <b>if</b> (<span class="r258 r">commandNameResult</span> != <b>null</b> &amp;&amp; <span class="r258 r">commandNameResult</span>.<span class="i">Count</span> &gt; 0)
                            {
                                <span class="r239 r">result</span>.<span class="i">AddRange</span>(<span class="r258 r">commandNameResult</span>);
                            }
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r239 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the configuration statement contains current cursor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r259 r">cursorPosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r260 r">ast</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r261 r">keywordAst</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a> <a id="13b906251e713778" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetAncestorConfigurationAstAndKeywordAst</a>(
            <a href="../parser/Position.cs.html#fb2ad3feb9004d98" class="t t">IScriptPosition</a> <span id="r259 rd" class="r259 r">cursorPosition</span>,
            <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r260 rd" class="r260 r">ast</span>,
            <b>out</b> <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r261 rd" class="r261 r">keywordAst</span>)
        {
            <a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a> <span id="r262 rd" class="r262 r">configureAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../parser/ast.cs.html#19d83a8cef88c290" class="i method">GetAncestorConfigurationDefinitionAstAndDynamicKeywordStatementAst</a>(<span class="r260 r">ast</span>, <b>out</b> <span class="r261 r">keywordAst</span>);
            <span class="c">// Find the configuration statement contains current cursor</span>
            <span class="c">// Note: cursorPosition.Offset &lt; configureAst.Extent.EndOffset means cursor locates inside the configuration</span>
            <span class="c">//       cursorPosition.Offset = configureAst.Extent.EndOffset means cursor locates at the end of the configuration</span>
            <b>while</b> (<span class="r262 r">configureAst</span> != <b>null</b> &amp;&amp; <span class="r259 r">cursorPosition</span>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &gt; <span class="r262 r">configureAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>)
            {
                <span class="r262 r">configureAst</span> = <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>.<a href="../parser/ast.cs.html#4ec2535310b60c23" class="i method">GetAncestorAst</a>&lt;<a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a>&gt;(<span class="r262 r">configureAst</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a>);
            }
 
            <b>return</b> <span class="r262 r">configureAst</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generate auto complete results for identifier within configuration.</span>
        <span class="c">///</span><span class="c"> Results are generated based on DynamicKeywords matches given identifier.</span>
        <span class="c">///</span><span class="c"> For example, following &quot;Fi&quot; matches &quot;File&quot;, and &quot;Us&quot; matches &quot;User&quot;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">     Configuration</span>
        <span class="c">///</span><span class="c">     {</span>
        <span class="c">///</span><span class="c">         Fi^</span>
        <span class="c">///</span><span class="c">         Node(&quot;TargetMachine&quot;)</span>
        <span class="c">///</span><span class="c">         {</span>
        <span class="c">///</span><span class="c">             Us^</span>
        <span class="c">///</span><span class="c">         }</span>
        <span class="c">///</span><span class="c">     }</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r263 r">completionContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r264 r">configureAst</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r265 r">keywordAst</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r266 r">matched</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="589c7c95078733af" href="../../R/589c7c95078733af.html" target="n" data-glyph="76,1" class="i method">GetResultForIdentifierInConfiguration</a>(
            <a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r263 rd" class="r263 r">completionContext</span>,
            <a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a> <span id="r264 rd" class="r264 r">configureAst</span>,
            <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r265 rd" class="r265 r">keywordAst</span>,
            <b>out bool</b> <span id="r266 rd" class="r266 r">matched</span>)
        {
            <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r267 rd" class="r267 r">results</span> = <b>null</b>;
            <span class="r266 r">matched</span> = <b>false</b>;
 
            <span class="i">IEnumerable</span>&lt;<a href="../parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>&gt; <span id="r268 rd" class="r268 r">keywords</span> = <span class="r264 r">configureAst</span>.<a href="../parser/ast.cs.html#965ad4d7acbcd14a" class="i property">DefinedKeywords</a>.<span class="i">Where</span>(
                <span id="r269 rd" class="r269 r">k</span> =&gt; <span class="c">// Node is special case, legal in both Resource and Meta configuration</span>
                    <b>string</b>.<span class="i">Equals</span>(<span class="r269 r">k</span>.<span class="i">Keyword</span>, <span class="s">@&quot;Node&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                    (
                        <span class="c">// Check compatibility between Resource and Configuration Type</span>
                        <span class="r269 r">k</span>.<span class="i">IsCompatibleWithConfigurationType</span>(<span class="r264 r">configureAst</span>.<a href="../parser/ast.cs.html#22d89775bd538a61" class="i property">ConfigurationType</a>) &amp;&amp;
                        !<a href="../parser/tokenizer.cs.html#c72d6f1daa581d48" class="t t">DynamicKeyword</a>.<span class="i">IsHiddenKeyword</span>(<span class="r269 r">k</span>.<span class="i">Keyword</span>) &amp;&amp;
                        !<span class="r269 r">k</span>.<span class="i">IsReservedKeyword</span>
                    )
            );
 
            <b>if</b> (<span class="r265 r">keywordAst</span> != <b>null</b> &amp;&amp; <span class="r263 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> &lt; <span class="r265 r">keywordAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>)
                <span class="r268 r">keywords</span> = <span class="r265 r">keywordAst</span>.<a href="../parser/ast.cs.html#0f0688a599c6de89" class="i property">Keyword</a>.<a href="../parser/tokenizer.cs.html#cffad8c43c76f689" class="i method">GetAllowedKeywords</a>(<span class="r268 r">keywords</span>);
 
            <b>if</b> (<span class="r268 r">keywords</span> != <b>null</b> &amp;&amp; <span class="r268 r">keywords</span>.<span class="i">Any</span>())
            {
                <b>string</b> <span id="r270 rd" class="r270 r">commandName</span> = (<span class="r263 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> ?? <b>string</b>.<span class="i">Empty</span>) + <span class="s">&quot;*&quot;</span>;
                <a href="../regex.cs.html#d450e739ff28e660" class="k">var</a> <span id="r271 rd" class="r271 r">wildcardPattern</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r270 r">commandName</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a>);
 
                <span class="c">// Filter by name</span>
                <b>var</b> <span id="r272 rd" class="r272 r">matchedResults</span> = <span class="r268 r">keywords</span>.<span class="i">Where</span>(<span id="r273 rd" class="r273 r">k</span> =&gt; <span class="r271 r">wildcardPattern</span>.<span class="i">IsMatch</span>(<span class="r273 r">k</span>.<span class="i">Keyword</span>));
                <b>if</b> (<span class="r272 r">matchedResults</span> == <b>null</b> || !<span class="r272 r">matchedResults</span>.<span class="i">Any</span>())
                {
                    <span class="c">// Fallback to all legal keywords in the configuration statement</span>
                    <span class="r272 r">matchedResults</span> = <span class="r268 r">keywords</span>;
                }
                <b>else</b>
                {
                    <span class="r266 r">matched</span> = <b>true</b>;
                }
 
                <b>foreach</b> (<b>var</b> <span id="r274 rd" class="r274 r">keyword</span> <b>in</b> <span class="r272 r">matchedResults</span>)
                {
                    <b>string</b> <span id="r275 rd" class="r275 r">usageString</span> = <b>string</b>.<span class="i">Empty</span>;
                    <a href="../Subsystem/DscSubsystem/ICrossPlatformDsc.cs.html#a3416ac15f89aebb" class="t t">ICrossPlatformDsc</a> <span id="r276 rd" class="r276 r">dscSubsystem</span> = <a href="../Subsystem/SubsystemManager.cs.html#6ddf6a3088da961a" class="t t">SubsystemManager</a>.<a href="../Subsystem/SubsystemManager.cs.html#d2d9d349eedfb603" class="i method">GetSubsystem</a>&lt;<a href="../Subsystem/DscSubsystem/ICrossPlatformDsc.cs.html#a3416ac15f89aebb" class="t t">ICrossPlatformDsc</a>&gt;();
                    <b>if</b> (<span class="r276 r">dscSubsystem</span> != <b>null</b>)
                    {
                        <span class="r275 r">usageString</span> = <span class="r276 r">dscSubsystem</span>.<span class="i">GetDSCResourceUsageString</span>(<span class="r274 r">keyword</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r275 r">usageString</span> = <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">DesiredStateConfiguration</span>.<span class="i n">Internal</span>.<a href="../../DscSupport/CimDSCParser.cs.html#bfd37d71cb227350" class="t t">DscClassCache</a>.<span class="i">GetDSCResourceUsageString</span>(<span class="r274 r">keyword</span>);
                    }
 
                    <b>if</b> (<span class="r267 r">results</span> == <b>null</b>)
                    {
                        <span class="r267 r">results</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;();
                    }
 
                    <span class="r267 r">results</span>.<span class="i">Add</span>(<b>new</b> <span class="t">CompletionResult</span>(
                        <span class="r274 r">keyword</span>.<span class="i">Keyword</span>,
                        <span class="r274 r">keyword</span>.<span class="i">Keyword</span>,
                        <a href="CompletionResult.cs.html#3cfd90a9cdb70973" class="t t">CompletionResultType</a>.<a href="CompletionResult.cs.html#2a21627a4f5c8970" class="i field">DynamicKeyword</a>,
                        <span class="r275 r">usageString</span>));
                }
            }
 
            <b>return</b> <span class="r267 r">results</span>;
        }
 
        <b>private</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="4eb1450f768f18ec" href="../../R/4eb1450f768f18ec.html" target="n" data-glyph="76,1" class="i method">GetResultForIdentifier</a>(<a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r277 rd" class="r277 r">completionContext</span>, <b>ref int</b> <span id="r278 rd" class="r278 r">replacementIndex</span>, <b>ref int</b> <span id="r279 rd" class="r279 r">replacementLength</span>, <b>bool</b> <span id="r280 rd" class="r280 r">isQuotedString</span>)
        {
            <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="k">var</a> <span id="r281 rd" class="r281 r">tokenAtCursor</span> = <span class="r277 r">completionContext</span>.<a href="#63bd97dbd0ed3b94" class="i property">TokenAtCursor</a>;
            <b>var</b> <span id="r282 rd" class="r282 r">lastAst</span> = <span class="r277 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Last</span>();
 
            <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r283 rd" class="r283 r">result</span> = <b>null</b>;
            <b>var</b> <span id="r284 rd" class="r284 r">tokenAtCursorText</span> = <span class="r281 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#8678cd2db79d7b1c" class="i property">Text</a>;
            <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r284 r">tokenAtCursorText</span>;
 
            <a href="../parser/ast.cs.html#e18e1bad255cd022" class="k">var</a> <span id="r285 rd" class="r285 r">strConst</span> = <span class="r282 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>;
            <b>if</b> (<span class="r285 r">strConst</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r285 r">strConst</span>.<a href="../parser/ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a>.<span class="i">Equals</span>(<span class="s">&quot;$&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <b>string</b>.<span class="i">Empty</span>;
                    <b>return</b> <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#2e1c9f0c9f032eaa" class="i method">CompleteVariable</a>(<span class="r277 r">completionContext</span>);
                }
                <b>else</b>
                {
                    <a href="../parser/ast.cs.html#a269e1753cbc4c90" class="t t">UsingStatementAst</a> <span id="r286 rd" class="r286 r">usingState</span> = <span class="r285 r">strConst</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a> <b>as</b> <a href="../parser/ast.cs.html#a269e1753cbc4c90" class="t t">UsingStatementAst</a>;
                    <b>if</b> (<span class="r286 r">usingState</span> != <b>null</b>)
                    {
                        <span class="r277 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r285 r">strConst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a>;
                        <span class="r277 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r285 r">strConst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a> - <span class="r278 r">replacementIndex</span>;
                        <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r285 r">strConst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>;
                        <b>switch</b> (<span class="r286 r">usingState</span>.<a href="../parser/ast.cs.html#4b031903ea1b04ed" class="i property">UsingStatementKind</a>)
                        {
                            <b>case</b> <a href="../parser/ast.cs.html#0837a04517723905" class="t t">UsingStatementKind</a>.<a href="../parser/ast.cs.html#98acf874996a057c" class="i field">Assembly</a>:
                                <b>break</b>;
                            <b>case</b> <a href="../parser/ast.cs.html#0837a04517723905" class="t t">UsingStatementKind</a>.<a href="../parser/ast.cs.html#68fe72ea611e4f8d" class="i field">Command</a>:
                                <b>break</b>;
                            <b>case</b> <a href="../parser/ast.cs.html#0837a04517723905" class="t t">UsingStatementKind</a>.<a href="../parser/ast.cs.html#4e97afe747960a96" class="i field">Module</a>:
                                <b>var</b> <span id="r287 rd" class="r287 r">moduleExtensions</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)
                                {
                                    <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>,
                                    <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>,
                                    <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>,
                                    <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>,
                                    <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>,
                                    <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8de3ad39fcb348d7" class="i field">PowerShellCmdletizationFileExtension</a>
                                };
                                <span class="r283 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f23c14b94c0c013f" class="i method">CompleteFilename</a>(<span class="r277 r">completionContext</span>, <b>false</b>, <span class="r287 r">moduleExtensions</span>).<span class="i">ToList</span>();
                                <b>if</b> (<span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a>.<span class="i">IndexOfAny</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#0702ea1962d7d49b" class="i field">DirectoryOrDrive</a>) != -1)
                                {
                                    <span class="c">// The partial input is a path, then we don&#39;t iterate modules under $ENV:PSModulePath</span>
                                    <b>return</b> <span class="r283 r">result</span>;
                                }
 
                                <b>var</b> <span id="r288 rd" class="r288 r">moduleResults</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f0abd69597cfd93f" class="i method">CompleteModuleName</a>(<span class="r277 r">completionContext</span>, <b>false</b>);
                                <b>if</b> (<span class="r288 r">moduleResults</span> != <b>null</b> &amp;&amp; <span class="r288 r">moduleResults</span>.<span class="i">Count</span> &gt; 0)
                                    <span class="r283 r">result</span>.<span class="i">AddRange</span>(<span class="r288 r">moduleResults</span>);
                                <b>return</b> <span class="r283 r">result</span>;
                            <b>case</b> <a href="../parser/ast.cs.html#0837a04517723905" class="t t">UsingStatementKind</a>.<a href="../parser/ast.cs.html#8c39b25da17c5e31" class="i field">Namespace</a>:
                                <span class="r283 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#d5d16aeb36fae66f" class="i method">CompleteNamespace</a>(<span class="r277 r">completionContext</span>);
                                <b>return</b> <span class="r283 r">result</span>;
                            <b>case</b> <a href="../parser/ast.cs.html#0837a04517723905" class="t t">UsingStatementKind</a>.<a href="../parser/ast.cs.html#32e92208f14046ce" class="i field">Type</a>:
                                <b>break</b>;
                            <b>default</b>:
                                <b>throw</b> <b>new</b> <span class="i">ArgumentOutOfRangeException</span>(<span class="s">&quot;UsingStatementKind&quot;</span>);
                        }
                    }
                }
            }
 
            <span class="r283 r">result</span> = <a href="#125c3b60ea714b38" class="i method">GetResultForAttributeArgument</a>(<span class="r277 r">completionContext</span>, <b>ref</b> <span class="r278 r">replacementIndex</span>, <b>ref</b> <span class="r279 r">replacementLength</span>);
            <b>if</b> (<span class="r283 r">result</span> != <b>null</b>) <b>return</b> <span class="r283 r">result</span>;
 
            <b>if</b> ((<span class="r281 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f9d0ded14a71a369" class="i property">TokenFlags</a> &amp; <a href="../parser/token.cs.html#fb1c35b7167e0165" class="t t">TokenFlags</a>.<a href="../parser/token.cs.html#b71c6dfcf4959b35" class="i field">CommandName</a>) != 0)
            {
                <span class="c">// Handle completion for a path with variable, such as: $PSHOME\ty&lt;tab&gt;</span>
                <b>if</b> (<span class="r277 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Count</span> &gt; 0 &amp;&amp; <span class="r277 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>[0] <b>is</b> <a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a>)
                {
                    <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r289 rd" class="r289 r">cursorAst</span> = <b>null</b>;
                    <a href="../parser/Position.cs.html#ded1553e3f2b51f3" class="k">var</a> <span id="r290 rd" class="r290 r">cursorPosition</span> = (<a href="../parser/Position.cs.html#ded1553e3f2b51f3" class="t t">InternalScriptPosition</a>)<a href="#97fcb2c0e771fbe7" class="i field">_cursorPosition</a>;
                    <b>int</b> <span id="r291 rd" class="r291 r">offsetBeforeCmdName</span> = <span class="r290 r">cursorPosition</span>.<a href="../parser/Position.cs.html#ae983dad2327d7fd" class="i property">Offset</a> - <span class="r284 r">tokenAtCursorText</span>.<span class="i">Length</span>;
                    <b>if</b> (<span class="r291 r">offsetBeforeCmdName</span> &gt;= 0)
                    {
                        <a href="../parser/Position.cs.html#ded1553e3f2b51f3" class="k">var</a> <span id="r292 rd" class="r292 r">cursorBeforeCmdName</span> = <span class="r290 r">cursorPosition</span>.<a href="../parser/Position.cs.html#5e4a9fe01b81c852" class="i method">CloneWithNewOffset</a>(<span class="r291 r">offsetBeforeCmdName</span>);
                        <a href="../parser/ast.cs.html#6f963589327835a4" class="k">var</a> <span id="r293 rd" class="r293 r">scriptBlockAst</span> = (<a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a>)<span class="r277 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>[0];
                        <span class="r289 r">cursorAst</span> = <a href="#3d52b2d6828a0083" class="i method">GetLastAstAtCursor</a>(<span class="r293 r">scriptBlockAst</span>, <span class="r292 r">cursorBeforeCmdName</span>);
                    }
 
                    <b>if</b> (<span class="r289 r">cursorAst</span> != <b>null</b> &amp;&amp;
                        <span class="r289 r">cursorAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ccd649a5269e237d" class="i property">EndLineNumber</a> == <span class="r281 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#cc356dc28b41997d" class="i property">StartLineNumber</a> &amp;&amp;
                        <span class="r289 r">cursorAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#155675f601d14734" class="i property">EndColumnNumber</a> == <span class="r281 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#f26f26676a7c22a1" class="i property">Extent</a>.<a href="../parser/Position.cs.html#8fcbdc214acf2f0f" class="i property">StartColumnNumber</a>)
                    {
                        <b>if</b> (<span class="r284 r">tokenAtCursorText</span>.<span class="i">IndexOfAny</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#182cf4a18b62de18" class="i field">Directory</a>) == 0)
                        {
                            <b>string</b> <span id="r294 rd" class="r294 r">wordToComplete</span> =
                                <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#4cf5560a7b1499c0" class="i method">ConcatenateStringPathArguments</a>(<span class="r289 r">cursorAst</span> <b>as</b> <a href="../parser/ast.cs.html#22790ae48f5438c6" class="t t">CommandElementAst</a>, <span class="r284 r">tokenAtCursorText</span>, <span class="r277 r">completionContext</span>);
                            <b>if</b> (<span class="r294 r">wordToComplete</span> != <b>null</b>)
                            {
                                <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r294 r">wordToComplete</span>;
                                <span class="r283 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;(<a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#729d5ec1cd6162b7" class="i method">CompleteFilename</a>(<span class="r277 r">completionContext</span>));
                                <b>if</b> (<span class="r283 r">result</span>.<span class="i">Count</span> &gt; 0)
                                {
                                    <span class="r278 r">replacementIndex</span> = <span class="r289 r">cursorAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#88220ab61fd15a4b" class="i property">StartScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                                    <span class="r279 r">replacementLength</span> += <span class="r289 r">cursorAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>.<span class="i">Length</span>;
                                }
 
                                <b>return</b> <span class="r283 r">result</span>;
                            }
                            <b>else</b>
                            {
                                <a href="../parser/ast.cs.html#248562b22b336dec" class="k">var</a> <span id="r295 rd" class="r295 r">variableAst</span> = <span class="r289 r">cursorAst</span> <b>as</b> <a href="../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>;
                                <b>string</b> <span id="r296 rd" class="r296 r">fullPath</span> = <span class="r295 r">variableAst</span> != <b>null</b>
                                    ? <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f539e39d020bfd17" class="i method">CombineVariableWithPartialPath</a>(
                                        <span class="r297 r">variableAst</span>: <span class="r295 r">variableAst</span>,
                                        <span class="r298 r">extraText</span>: <span class="r284 r">tokenAtCursorText</span>,
                                        <span class="r299 r">executionContext</span>: <span class="r277 r">completionContext</span>.<a href="#4055c622a2008ac8" class="i property">ExecutionContext</a>)
                                    : <b>null</b>;
 
                                <b>if</b> (<span class="r296 r">fullPath</span> == <b>null</b>) { <b>return</b> <span class="r283 r">result</span>; }
 
                                <span class="c">// Continue trying the filename/commandname completion for scenarios like this: $aa\d&lt;tab&gt;</span>
                                <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r296 r">fullPath</span>;
                                <span class="r278 r">replacementIndex</span> = <span class="r289 r">cursorAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#88220ab61fd15a4b" class="i property">StartScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                                <span class="r279 r">replacementLength</span> += <span class="r289 r">cursorAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>.<span class="i">Length</span>;
 
                                <span class="r277 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r278 r">replacementIndex</span>;
                                <span class="r277 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r279 r">replacementLength</span>;
                            }
                        }
                        <span class="c">// Continue trying the filename/commandname completion for scenarios like this: $aa[get-&lt;tab&gt;</span>
                        <b>else</b> <b>if</b> (<span class="r289 r">cursorAst</span> <b>is not</b> <a href="../parser/ast.cs.html#bdf2b3276843e0c2" class="t t">ErrorExpressionAst</a> || <span class="r289 r">cursorAst</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a> <b>is not</b> <a href="../parser/ast.cs.html#4587e325068530ec" class="t t">IndexExpressionAst</a>)
                        {
                            <b>return</b> <span class="r283 r">result</span>;
                        }
                    }
                }
 
                <span class="c">// When it&#39;s the content of a quoted string, we only handle variable/member completion</span>
                <b>if</b> (<span class="r280 r">isQuotedString</span>) { <b>return</b> <span class="r283 r">result</span>; }
 
                <span class="c">// Handle the StringExpandableToken;</span>
                <a href="../parser/token.cs.html#7be5d7d2cd2a65ac" class="k">var</a> <span id="r300 rd" class="r300 r">strToken</span> = <span class="r281 r">tokenAtCursor</span> <b>as</b> <a href="../parser/token.cs.html#7be5d7d2cd2a65ac" class="t t">StringExpandableToken</a>;
                <b>if</b> (<span class="r300 r">strToken</span> != <b>null</b> &amp;&amp; <span class="r300 r">strToken</span>.<a href="../parser/token.cs.html#6847b32dc0516c6a" class="i property">NestedTokens</a> != <b>null</b> &amp;&amp; <span class="r285 r">strConst</span> != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <b>string</b> <span id="r301 rd" class="r301 r">expandedString</span> = <b>null</b>;
                        <a href="../parser/ast.cs.html#dac25e1530bb8b85" class="k">var</a> <span id="r302 rd" class="r302 r">expandableStringAst</span> = <b>new</b> <a href="../parser/ast.cs.html#d7e6f61cb7780810" class="t constructor">ExpandableStringExpressionAst</a>(<span class="r285 r">strConst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>, <span class="r285 r">strConst</span>.<a href="../parser/ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a>, <a href="../parser/ast.cs.html#9280da14e6db65ed" class="t t">StringConstantType</a>.<a href="../parser/ast.cs.html#7902d7b060b16556" class="i field">BareWord</a>);
                        <b>if</b> (<a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<span class="i">IsPathSafelyExpandable</span>(<span class="i">expandableStringAst</span>: <span class="r302 r">expandableStringAst</span>,
                                                                        <span class="i">extraText</span>: <b>string</b>.<span class="i">Empty</span>,
                                                                        <span class="i">executionContext</span>: <span class="r277 r">completionContext</span>.<a href="#4055c622a2008ac8" class="i property">ExecutionContext</a>,
                                                                        <span class="i">expandedString</span>: <b>out</b> <span class="r301 r">expandedString</span>))
                        {
                            <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r301 r">expandedString</span>;
                        }
                        <b>else</b>
                        {
                            <b>return</b> <span class="r283 r">result</span>;
                        }
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                        <b>return</b> <span class="r283 r">result</span>;
                    }
                }
 
                <span class="c">//</span>
                <span class="c">// Handle completion of DSC resources within Configuration</span>
                <span class="c">//</span>
                <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r303 rd" class="r303 r">keywordAst</span>;
                <a href="../parser/ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a> <span id="r304 rd" class="r304 r">configureAst</span> = <span class="i">GetAncestorConfigurationAstAndKeywordAst</span>(<span class="r277 r">completionContext</span>.<a href="#cf83a017dd6fc3e8" class="i property">CursorPosition</a>, <span class="r282 r">lastAst</span>, <b>out</b> <span class="r303 r">keywordAst</span>);
                <b>bool</b> <span id="r305 rd" class="r305 r">matched</span> = <b>false</b>;
                <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r306 rd" class="r306 r">keywordResult</span> = <b>null</b>;
                <b>if</b> (<span class="r304 r">configureAst</span> != <b>null</b>)
                {
                    <span class="c">// Current token is within ConfigurationDefinitionAst or DynamicKeywordStatementAst</span>
                    <span class="r306 r">keywordResult</span> = <a href="#589c7c95078733af" class="i method">GetResultForIdentifierInConfiguration</a>(<span class="r277 r">completionContext</span>, <span class="r304 r">configureAst</span>, <span class="r303 r">keywordAst</span>, <b>out</b> <span class="r305 r">matched</span>);
                }
 
                <span class="c">// Handle the file completion before command name completion</span>
                <span class="r283 r">result</span> = <a href="#b47688d1e87210f0" class="i method">CompleteFileNameAsCommand</a>(<span class="r277 r">completionContext</span>);
                <span class="c">// Handle the command name completion</span>
                <b>var</b> <span id="r307 rd" class="r307 r">commandNameResult</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#8ad3630ff3ff385a" class="i method">CompleteCommand</a>(<span class="r277 r">completionContext</span>);
 
                <b>if</b> (<span class="r307 r">commandNameResult</span> != <b>null</b> &amp;&amp; <span class="r307 r">commandNameResult</span>.<span class="i">Count</span> &gt; 0)
                {
                    <span class="r283 r">result</span>.<span class="i">AddRange</span>(<span class="r307 r">commandNameResult</span>);
                }
 
                <b>if</b> (<span class="r305 r">matched</span> &amp;&amp; <span class="r306 r">keywordResult</span> != <b>null</b>)
                {
                    <span class="r283 r">result</span>.<span class="i">InsertRange</span>(0, <span class="r306 r">keywordResult</span>);
                }
                <b>else</b> <b>if</b> (!<span class="r305 r">matched</span> &amp;&amp; <span class="r306 r">keywordResult</span> != <b>null</b> &amp;&amp; <span class="r307 r">commandNameResult</span>.<span class="i">Count</span> == 0)
                {
                    <span class="r283 r">result</span>.<span class="i">AddRange</span>(<span class="r306 r">keywordResult</span>);
                }
 
                <b>return</b> <span class="r283 r">result</span>;
            }
 
            <b>var</b> <span id="r308 rd" class="r308 r">isSingleDash</span> = <span class="r284 r">tokenAtCursorText</span>.<span class="i">Length</span> == 1 &amp;&amp; <span class="r284 r">tokenAtCursorText</span>[0].<span class="i">IsDash</span>();
            <b>var</b> <span id="r309 rd" class="r309 r">isDoubleDash</span> = <span class="r284 r">tokenAtCursorText</span>.<span class="i">Length</span> == 2 &amp;&amp; <span class="r284 r">tokenAtCursorText</span>[0].<span class="i">IsDash</span>() &amp;&amp; <span class="r284 r">tokenAtCursorText</span>[1].<span class="i">IsDash</span>();
            <b>var</b> <span id="r310 rd" class="r310 r">isParentCommandOrDynamicKeyword</span> = (<span class="r282 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> || <span class="r282 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a>);
            <b>if</b> ((<span class="r308 r">isSingleDash</span> || <span class="r309 r">isDoubleDash</span>) &amp;&amp; <span class="r310 r">isParentCommandOrDynamicKeyword</span>)
            {
                <span class="c">// When it&#39;s the content of a quoted string, we only handle variable/member completion</span>
                <b>if</b> (<span class="r308 r">isSingleDash</span>)
                {
                    <b>if</b> (<span class="r280 r">isQuotedString</span>) { <b>return</b> <span class="r283 r">result</span>; }
 
                    <b>var</b> <span id="r311 rd" class="r311 r">res</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#ab1ad2c5a684cb16" class="i method">CompleteCommandParameter</a>(<span class="r277 r">completionContext</span>);
                    <b>if</b> (<span class="r311 r">res</span>.<span class="i">Count</span> != 0)
                    {
                        <b>return</b> <span class="r311 r">res</span>;
                    }
                }
 
                <b>return</b> <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f46bcd6b9210bb57" class="i method">CompleteCommandArgument</a>(<span class="r277 r">completionContext</span>);
            }
 
            <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a> <span id="r312 rd" class="r312 r">memberOperator</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#109dbe127dd9cac0" class="i field">Unknown</a>;
            <b>bool</b> <span id="r313 rd" class="r313 r">isMemberCompletion</span> = (<span class="r282 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#a3e8bc64452a67d0" class="t t">MemberExpressionAst</a>);
            <b>bool</b> <span id="r314 rd" class="r314 r">isStatic</span> = <span class="r313 r">isMemberCompletion</span> &amp;&amp; ((<a href="../parser/ast.cs.html#a3e8bc64452a67d0" class="t t">MemberExpressionAst</a>)<span class="r282 r">lastAst</span>.<span class="i">Parent</span>).<a href="../parser/ast.cs.html#b882770eb12defeb" class="i property">Static</a>;
            <b>bool</b> <span id="r315 rd" class="r315 r">isWildcard</span> = <b>false</b>;
 
            <b>if</b> (!<span class="r313 r">isMemberCompletion</span>)
            {
                <span class="c">// Still might be member completion, something like: echo $member.</span>
                <span class="c">// We need to know if the previous element before the token is adjacent because</span>
                <span class="c">// we don&#39;t have a MemberExpressionAst, we might have 2 command arguments.</span>
 
                <b>if</b> (<span class="r284 r">tokenAtCursorText</span>.<span class="i">Equals</span>(<a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>.<a href="../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>(), <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <span class="r312 r">memberOperator</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>;
                    <span class="r313 r">isMemberCompletion</span> = <b>true</b>;
                }
                <b>else</b> <b>if</b> (<span class="r284 r">tokenAtCursorText</span>.<span class="i">Equals</span>(<a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ba396ba04fe0fde5" class="i field">ColonColon</a>.<a href="../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>(), <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <span class="r312 r">memberOperator</span> = <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ba396ba04fe0fde5" class="i field">ColonColon</a>;
                    <span class="r313 r">isMemberCompletion</span> = <b>true</b>;
                }
                <b>else</b> <b>if</b> (<span class="r281 r">tokenAtCursor</span>.<a href="../parser/token.cs.html#520c1782d294a73a" class="i property">Kind</a>.<span class="i">Equals</span>(<a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#79806bba953290ee" class="i field">Multiply</a>) &amp;&amp; <span class="r282 r">lastAst</span> <b>is</b> <a href="../parser/ast.cs.html#f3e3848ef2eae593" class="t t">BinaryExpressionAst</a>)
                {
                    <span class="c">// Handle member completion with wildcard(wildcard is at the end): $a.p*</span>
                    <a href="../parser/ast.cs.html#f3e3848ef2eae593" class="k">var</a> <span id="r316 rd" class="r316 r">binaryExpressionAst</span> = (<a href="../parser/ast.cs.html#f3e3848ef2eae593" class="t t">BinaryExpressionAst</a>)<span class="r282 r">lastAst</span>;
                    <a href="../parser/ast.cs.html#a3e8bc64452a67d0" class="k">var</a> <span id="r317 rd" class="r317 r">memberExpressionAst</span> = <span class="r316 r">binaryExpressionAst</span>.<a href="../parser/ast.cs.html#e19b481693ff50d7" class="i property">Left</a> <b>as</b> <a href="../parser/ast.cs.html#a3e8bc64452a67d0" class="t t">MemberExpressionAst</a>;
                    <a href="../parser/Position.cs.html#bbc751d075344454" class="k">var</a> <span id="r318 rd" class="r318 r">errorPosition</span> = <span class="r316 r">binaryExpressionAst</span>.<a href="../parser/ast.cs.html#df8f322e70353a62" class="i property">ErrorPosition</a>;
 
                    <b>if</b> (<span class="r317 r">memberExpressionAst</span> != <b>null</b> &amp;&amp; <span class="r316 r">binaryExpressionAst</span>.<a href="../parser/ast.cs.html#d9e9940dedef2ba7" class="i property">Operator</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#79806bba953290ee" class="i field">Multiply</a> &amp;&amp;
                        <span class="r318 r">errorPosition</span>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a> == <span class="r317 r">memberExpressionAst</span>.<a href="../parser/ast.cs.html#2c25418a24e5cfa1" class="i property">Member</a>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ca890c6b6bd34ec4" class="i property">EndOffset</a>)
                    {
                        <span class="r314 r">isStatic</span> = <span class="r317 r">memberExpressionAst</span>.<a href="../parser/ast.cs.html#b882770eb12defeb" class="i property">Static</a>;
                        <span class="r312 r">memberOperator</span> = <span class="r314 r">isStatic</span> ? <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ba396ba04fe0fde5" class="i field">ColonColon</a> : <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>;
                        <span class="r313 r">isMemberCompletion</span> = <b>true</b>;
                        <span class="r315 r">isWildcard</span> = <b>true</b>;
 
                        <span class="c">// Member completion will add back the &#39;*&#39;, so pretend it wasn&#39;t there, at least from the &quot;related asts&quot; point of view,</span>
                        <span class="c">// but add the member expression that we are really completing.</span>
                        <span class="r277 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Remove</span>(<span class="r316 r">binaryExpressionAst</span>);
                        <span class="r277 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Add</span>(<span class="r317 r">memberExpressionAst</span>);
 
                        <a href="../parser/ast.cs.html#e18e1bad255cd022" class="k">var</a> <span id="r319 rd" class="r319 r">memberAst</span> = <span class="r317 r">memberExpressionAst</span>.<a href="../parser/ast.cs.html#2c25418a24e5cfa1" class="i property">Member</a> <b>as</b> <a href="../parser/ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>;
                        <b>if</b> (<span class="r319 r">memberAst</span> != <b>null</b>)
                        {
                            <span class="r278 r">replacementIndex</span> = <span class="r319 r">memberAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#88220ab61fd15a4b" class="i property">StartScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                            <span class="r279 r">replacementLength</span> += <span class="r319 r">memberAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>.<span class="i">Length</span>;
                        }
                    }
                }
            }
 
            <b>if</b> (<span class="r313 r">isMemberCompletion</span>)
            {
                <span class="r283 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#c5cd3c69e6ecde2e" class="i method">CompleteMember</a>(<span class="r277 r">completionContext</span>, <span class="r85 r">@static</span>: (<span class="r314 r">isStatic</span> || <span class="r312 r">memberOperator</span> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#ba396ba04fe0fde5" class="i field">ColonColon</a>));
 
                <span class="c">// If the last token was just a &#39;.&#39;, we tried to complete members.  That may</span>
                <span class="c">// have failed because it wasn&#39;t really an attempt to complete a member, in</span>
                <span class="c">// which case we should try to complete as an argument.</span>
                <b>if</b> (<span class="r283 r">result</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>if</b> (!<span class="r315 r">isWildcard</span> &amp;&amp; <span class="r312 r">memberOperator</span> != <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#109dbe127dd9cac0" class="i field">Unknown</a>)
                    {
                        <span class="r278 r">replacementIndex</span> += <span class="r284 r">tokenAtCursorText</span>.<span class="i">Length</span>;
                        <span class="r279 r">replacementLength</span> = 0;
                    }
 
                    <b>return</b> <span class="r283 r">result</span>;
                }
            }
 
            <b>if</b> (<span class="r282 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a>)
            {
                <span class="r283 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#dffbec9e850a0d5a" class="i method">CompleteHashtableKey</a>(<span class="r277 r">completionContext</span>, (<a href="../parser/ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a>)<span class="r282 r">lastAst</span>.<span class="i">Parent</span>);
                <b>if</b> (<span class="r283 r">result</span> != <b>null</b> &amp;&amp; <span class="r283 r">result</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>return</b> <span class="r283 r">result</span>;
                }
            }
 
            <span class="c">// When it&#39;s the content of a quoted string, we only handle variable/member completion</span>
            <b>if</b> (<span class="r280 r">isQuotedString</span>) { <b>return</b> <span class="r283 r">result</span>; }
 
            <b>bool</b> <span id="r320 rd" class="r320 r">needFileCompletion</span> = <b>false</b>;
            <b>if</b> (<span class="r282 r">lastAst</span>.<span class="i">Parent</span> <b>is</b> <a href="../parser/ast.cs.html#2288e8fa779a0d57" class="t t">FileRedirectionAst</a> || <span class="i">CompleteAgainstSwitchFile</span>(<span class="r282 r">lastAst</span>, <span class="r277 r">completionContext</span>.<a href="#13e001aeea27aaa6" class="i property">TokenBeforeCursor</a>))
            {
                <b>string</b> <span id="r321 rd" class="r321 r">wordToComplete</span> =
                    <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<span class="i">ConcatenateStringPathArguments</span>(<span class="r282 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#22790ae48f5438c6" class="t t">CommandElementAst</a>, <b>string</b>.<span class="i">Empty</span>, <span class="r277 r">completionContext</span>);
                <b>if</b> (<span class="r321 r">wordToComplete</span> != <b>null</b>)
                {
                    <span class="r320 r">needFileCompletion</span> = <b>true</b>;
                    <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r321 r">wordToComplete</span>;
                }
            }
            <b>else</b> <b>if</b> (<span class="r284 r">tokenAtCursorText</span>.<span class="i">IndexOfAny</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#182cf4a18b62de18" class="i field">Directory</a>) == 0)
            {
                <a href="../parser/ast.cs.html#dd8dd8a40be8b41f" class="k">var</a> <span id="r322 rd" class="r322 r">command</span> = <span class="r282 r">lastAst</span>.<span class="i">Parent</span> <b>as</b> <a href="../parser/ast.cs.html#dd8dd8a40be8b41f" class="t t">CommandBaseAst</a>;
                <b>if</b> (<span class="r322 r">command</span> != <b>null</b> &amp;&amp; <span class="r322 r">command</span>.<a href="../parser/ast.cs.html#7d87854c277c8363" class="i property">Redirections</a>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="../parser/ast.cs.html#2288e8fa779a0d57" class="k">var</a> <span id="r323 rd" class="r323 r">fileRedirection</span> = <span class="r322 r">command</span>.<a href="../parser/ast.cs.html#7d87854c277c8363" class="i property">Redirections</a>[0] <b>as</b> <a href="../parser/ast.cs.html#2288e8fa779a0d57" class="t t">FileRedirectionAst</a>;
                    <b>if</b> (<span class="r323 r">fileRedirection</span> != <b>null</b> &amp;&amp;
                        <span class="r323 r">fileRedirection</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#ccd649a5269e237d" class="i property">EndLineNumber</a> == <span class="r282 r">lastAst</span>.<span class="i">Extent</span>.<span class="i">StartLineNumber</span> &amp;&amp;
                        <span class="r323 r">fileRedirection</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#155675f601d14734" class="i property">EndColumnNumber</a> == <span class="r282 r">lastAst</span>.<span class="i">Extent</span>.<span class="i">StartColumnNumber</span>)
                    {
                        <b>string</b> <span id="r324 rd" class="r324 r">wordToComplete</span> =
                            <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#4cf5560a7b1499c0" class="i method">ConcatenateStringPathArguments</a>(<span class="r323 r">fileRedirection</span>.<a href="../parser/ast.cs.html#387c7bd2fd1d9d89" class="i property">Location</a>, <span class="r284 r">tokenAtCursorText</span>, <span class="r277 r">completionContext</span>);
 
                        <b>if</b> (<span class="r324 r">wordToComplete</span> != <b>null</b>)
                        {
                            <span class="r320 r">needFileCompletion</span> = <b>true</b>;
                            <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r324 r">wordToComplete</span>;
                            <span class="r278 r">replacementIndex</span> = <span class="r323 r">fileRedirection</span>.<a href="../parser/ast.cs.html#387c7bd2fd1d9d89" class="i property">Location</a>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#88220ab61fd15a4b" class="i property">StartScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a>;
                            <span class="r279 r">replacementLength</span> += <span class="r323 r">fileRedirection</span>.<a href="../parser/ast.cs.html#387c7bd2fd1d9d89" class="i property">Location</a>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#b8cb5655f70ff8ee" class="i property">EndScriptPosition</a>.<a href="../parser/Position.cs.html#cd3280d5f1045b06" class="i property">Offset</a> - <span class="r278 r">replacementIndex</span>;
 
                            <span class="r277 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a> = <span class="r278 r">replacementIndex</span>;
                            <span class="r277 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a> = <span class="r279 r">replacementLength</span>;
                        }
                    }
                }
            }
 
            <b>if</b> (<span class="r320 r">needFileCompletion</span>)
            {
                <b>return</b> <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;(<a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#729d5ec1cd6162b7" class="i method">CompleteFilename</a>(<span class="r277 r">completionContext</span>));
            }
            <b>else</b>
            {
                <b>string</b> <span id="r325 rd" class="r325 r">wordToComplete</span> =
                    <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<span class="i">ConcatenateStringPathArguments</span>(<span class="r282 r">lastAst</span> <b>as</b> <a href="../parser/ast.cs.html#22790ae48f5438c6" class="t t">CommandElementAst</a>, <b>string</b>.<span class="i">Empty</span>, <span class="r277 r">completionContext</span>);
                <b>if</b> (<span class="r325 r">wordToComplete</span> != <b>null</b>)
                {
                    <span class="r277 r">completionContext</span>.<a href="#cf3f9752b9748c9c" class="i property">WordToComplete</a> = <span class="r325 r">wordToComplete</span>;
                }
            }
 
            <span class="r283 r">result</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#f46bcd6b9210bb57" class="i method">CompleteCommandArgument</a>(<span class="r277 r">completionContext</span>);
            <span class="r278 r">replacementIndex</span> = <span class="r277 r">completionContext</span>.<a href="#2d472ecad9988a80" class="i property">ReplacementIndex</a>;
            <span class="r279 r">replacementLength</span> = <span class="r277 r">completionContext</span>.<a href="#c219030db690057a" class="i property">ReplacementLength</a>;
            <b>return</b> <span class="r283 r">result</span>;
        }
 
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="125c3b60ea714b38" href="../../R/125c3b60ea714b38.html" target="n" data-glyph="76,1" class="i method">GetResultForAttributeArgument</a>(<a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r326 rd" class="r326 r">completionContext</span>, <b>ref int</b> <span id="r327 rd" class="r327 r">replacementIndex</span>, <b>ref int</b> <span id="r328 rd" class="r328 r">replacementLength</span>)
        {
            <span class="c">// Attribute member arguments</span>
            <span class="i">Type</span> <span id="r329 rd" class="r329 r">attributeType</span> = <b>null</b>;
            <b>string</b> <span id="r330 rd" class="r330 r">argName</span> = <b>string</b>.<span class="i">Empty</span>;
            <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r331 rd" class="r331 r">argAst</span> = <span class="r326 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Find</span>(<b>static</b> <span id="r332 rd" class="r332 r">ast</span> =&gt; <span class="r332 r">ast</span> <b>is</b> <a href="../parser/ast.cs.html#283d46191e6456a4" class="t t">NamedAttributeArgumentAst</a>);
            <a href="../parser/ast.cs.html#283d46191e6456a4" class="t t">NamedAttributeArgumentAst</a> <span id="r333 rd" class="r333 r">namedArgAst</span> = <span class="r331 r">argAst</span> <b>as</b> <a href="../parser/ast.cs.html#283d46191e6456a4" class="t t">NamedAttributeArgumentAst</a>;
            <b>if</b> (<span class="r331 r">argAst</span> != <b>null</b> &amp;&amp; <span class="r333 r">namedArgAst</span> != <b>null</b>)
            {
                <span class="r329 r">attributeType</span> = ((<a href="../parser/ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a>)<span class="r333 r">namedArgAst</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a>).<a href="../parser/ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a>.<a href="../parser/ast.cs.html#32e4c2eb2fe24684" class="i method">GetReflectionAttributeType</a>();
                <span class="r330 r">argName</span> = <span class="r333 r">namedArgAst</span>.<a href="../parser/ast.cs.html#b9de8a2050ab7312" class="i property">ArgumentName</a>;
                <span class="r327 r">replacementIndex</span> = <span class="r333 r">namedArgAst</span>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a>;
                <span class="r328 r">replacementLength</span> = <span class="r330 r">argName</span>.<span class="i">Length</span>;
            }
            <b>else</b>
            {
                <a href="../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r334 rd" class="r334 r">astAtt</span> = <span class="r326 r">completionContext</span>.<a href="#c4b25a4935fa7b79" class="i property">RelatedAsts</a>.<span class="i">Find</span>(<b>static</b> <span id="r335 rd" class="r335 r">ast</span> =&gt; <span class="r335 r">ast</span> <b>is</b> <a href="../parser/ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a>);
                <a href="../parser/ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a> <span id="r336 rd" class="r336 r">attAst</span> = <span class="r334 r">astAtt</span> <b>as</b> <a href="../parser/ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a>;
                <b>if</b> (<span class="r334 r">astAtt</span> != <b>null</b> &amp;&amp; <span class="r336 r">attAst</span> != <b>null</b>)
                {
                    <span class="r329 r">attributeType</span> = <span class="r336 r">attAst</span>.<a href="../parser/ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a>.<a href="../parser/ast.cs.html#32e4c2eb2fe24684" class="i method">GetReflectionAttributeType</a>();
                }
            }
 
            <b>if</b> (<span class="r329 r">attributeType</span> != <b>null</b>)
            {
                <span class="i">PropertyInfo</span>[] <span id="r337 rd" class="r337 r">propertyInfos</span> = <span class="r329 r">attributeType</span>.<span class="i">GetProperties</span>(<span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>);
                <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <span id="r338 rd" class="r338 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;();
                <b>foreach</b> (<span class="i">PropertyInfo</span> <span id="r339 rd" class="r339 r">property</span> <b>in</b> <span class="r337 r">propertyInfos</span>)
                {
                    <span class="c">// Ignore getter-only properties, including &#39;TypeId&#39; (all attributes inherit it).</span>
                    <b>if</b> (!<span class="r339 r">property</span>.<span class="i">CanWrite</span>) { <b>continue</b>; }
 
                    <b>if</b> (<span class="r339 r">property</span>.<span class="i">Name</span>.<span class="i">StartsWith</span>(<span class="r330 r">argName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r338 r">result</span>.<span class="i">Add</span>(<b>new</b> <span class="t">CompletionResult</span>(<span class="r339 r">property</span>.<span class="i">Name</span>, <span class="r339 r">property</span>.<span class="i">Name</span>, <a href="CompletionResult.cs.html#3cfd90a9cdb70973" class="t t">CompletionResultType</a>.<a href="CompletionResult.cs.html#bad7fb67c06b9e4e" class="i field">Property</a>,
                            <span class="r339 r">property</span>.<span class="i">PropertyType</span>.<span class="i">ToString</span>() + <span class="s">&quot; &quot;</span> + <span class="r339 r">property</span>.<span class="i">Name</span>));
                    }
                }
 
                <b>return</b> <span class="r338 r">result</span>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Complete file name as command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r340 r">completionContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt; <a id="b47688d1e87210f0" href="../../R/b47688d1e87210f0.html" target="n" data-glyph="76,1" class="i method">CompleteFileNameAsCommand</a>(<a href="#f4bb7b26e8be6324" class="t t">CompletionContext</a> <span id="r340 rd" class="r340 r">completionContext</span>)
        {
            <b>var</b> <span id="r341 rd" class="r341 r">addAmpersandIfNecessary</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#c0636828e4dcf26b" class="i method">IsAmpersandNeeded</a>(<span class="r340 r">completionContext</span>, <b>true</b>);
            <b>var</b> <span id="r342 rd" class="r342 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="CompletionResult.cs.html#a4c553f80d9e648c" class="t t">CompletionResult</a>&gt;();
            <b>var</b> <span id="r343 rd" class="r343 r">clearLiteralPathsKey</span> = <b>false</b>;
 
            <b>if</b> (<span class="r340 r">completionContext</span>.<a href="#f3f4d193708c896f" class="i property">Options</a> == <b>null</b>)
            {
                <span class="r340 r">completionContext</span>.<a href="#f3f4d193708c896f" class="i property">Options</a> = <b>new</b> <span class="i">Hashtable</span> { { <span class="s">&quot;LiteralPaths&quot;</span>, <b>true</b> } };
            }
            <b>else</b> <b>if</b> (!<span class="r340 r">completionContext</span>.<a href="#f3f4d193708c896f" class="i property">Options</a>.<span class="i">ContainsKey</span>(<span class="s">&quot;LiteralPaths&quot;</span>))
            {
                <span class="c">// Dont escape &#39;[&#39;,&#39;]&#39;,&#39;`&#39; when the file name is treated as command name</span>
                <span class="r340 r">completionContext</span>.<a href="#f3f4d193708c896f" class="i property">Options</a>.<span class="i">Add</span>(<span class="s">&quot;LiteralPaths&quot;</span>, <b>true</b>);
                <span class="r343 r">clearLiteralPathsKey</span> = <b>true</b>;
            }
 
            <b>try</b>
            {
                <b>var</b> <span id="r344 rd" class="r344 r">fileNameResult</span> = <a href="CompletionCompleters.cs.html#ef47b689fd4f15e2" class="t t">CompletionCompleters</a>.<a href="CompletionCompleters.cs.html#729d5ec1cd6162b7" class="i method">CompleteFilename</a>(<span class="r340 r">completionContext</span>);
                <b>foreach</b> (<b>var</b> <span id="r345 rd" class="r345 r">entry</span> <b>in</b> <span class="r344 r">fileNameResult</span>)
                {
                    <span class="c">// Add &#39;&amp;&#39; to file names that are quoted</span>
                    <b>var</b> <span id="r346 rd" class="r346 r">completionText</span> = <span class="r345 r">entry</span>.<span class="i">CompletionText</span>;
                    <b>var</b> <span id="r347 rd" class="r347 r">len</span> = <span class="r346 r">completionText</span>.<span class="i">Length</span>;
                    <b>if</b> (<span class="r341 r">addAmpersandIfNecessary</span> &amp;&amp; <span class="r347 r">len</span> &gt; 2 &amp;&amp; <span class="r346 r">completionText</span>[0].<span class="i">IsSingleQuote</span>() &amp;&amp; <span class="r346 r">completionText</span>[<span class="r347 r">len</span> - 1].<span class="i">IsSingleQuote</span>())
                    {
                        <span class="r346 r">completionText</span> = <span class="s">&quot;&amp; &quot;</span> + <span class="r346 r">completionText</span>;
                        <span class="r342 r">result</span>.<span class="i">Add</span>(<b>new</b> <span class="t">CompletionResult</span>(<span class="r346 r">completionText</span>, <span class="r345 r">entry</span>.<span class="i">ListItemText</span>, <span class="r345 r">entry</span>.<span class="i">ResultType</span>, <span class="r345 r">entry</span>.<span class="i">ToolTip</span>));
                    }
                    <b>else</b>
                    {
                        <span class="r342 r">result</span>.<span class="i">Add</span>(<span class="r345 r">entry</span>);
                    }
                }
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r343 r">clearLiteralPathsKey</span>)
                    <span class="r340 r">completionContext</span>.<a href="#f3f4d193708c896f" class="i property">Options</a>.<span class="i">Remove</span>(<span class="s">&quot;LiteralPaths&quot;</span>);
            }
 
            <b>return</b> <span class="r342 r">result</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
