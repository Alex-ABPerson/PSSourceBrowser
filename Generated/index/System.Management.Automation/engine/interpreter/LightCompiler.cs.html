<!DOCTYPE html>
<html><head><title>LightCompiler.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(2052);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/interpreter/LightCompiler.cs" target="_top">engine\interpreter\LightCompiler.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">/* ****************************************************************************
 *
 * Copyright (c) Microsoft Corporation.
 *
 * This source code is subject to terms and conditions of the Apache License, Version 2.0. A
 * copy of the license can be found in the License.html file at the root of this distribution. If
 * you cannot locate the Apache License, Version 2.0, please send an email to
 * dlr@microsoft.com. By using this source code in any fashion, you are agreeing to be bound
 * by the terms of the Apache License, Version 2.0.
 *
 * You must not remove this notice, or any other, from this software.
 *
 *
 * ***************************************************************************/</span>
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">CLR2</span>
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>.<span class="i">Expressions</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="t">AstUtils</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Interpreter</span>.<a href="Utilities.cs.html#55b509010bbde4b3" class="t t">Utils</a>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Interpreter</span>
{
    <b>internal sealed class</b> <a id="b49e26e8d9415c16" href="../../R/b49e26e8d9415c16.html" target="n" data-glyph="2,0" class="t t">ExceptionHandler</a>
    {
        <b>public readonly</b> <span class="i">Type</span> <a id="612b9849f1a8eb89" href="../../R/612b9849f1a8eb89.html" target="n" data-glyph="42,1" class="i field">ExceptionType</a>;
        <b>public readonly int</b> <a id="d7cde9b1b2bd9f25" href="../../R/d7cde9b1b2bd9f25.html" target="n" data-glyph="42,1" class="i field">StartIndex</a>;
        <b>public readonly int</b> <a id="86029e35ef92b748" href="../../R/86029e35ef92b748.html" target="n" data-glyph="42,1" class="i field">EndIndex</a>;
        <b>public readonly int</b> <a id="aa07dcc39052c1b6" href="../../R/aa07dcc39052c1b6.html" target="n" data-glyph="42,1" class="i field">LabelIndex</a>;
        <b>public readonly int</b> <a id="b8c5b2f0244537c8" href="../../R/b8c5b2f0244537c8.html" target="n" data-glyph="42,1" class="i field">HandlerStartIndex</a>;
        <b>public readonly int</b> <a id="39c86d69ddcd4a1f" href="../../R/39c86d69ddcd4a1f.html" target="n" data-glyph="42,1" class="i field">HandlerEndIndex</a>;
 
        <b>internal</b> <a href="#8e8656bd8d80df81" class="t t">TryCatchFinallyHandler</a> <a id="c8b479c019c7fd23" href="../../R/c8b479c019c7fd23.html" target="n" data-glyph="44,1" class="i field">Parent</a> = <b>null</b>;
 
        <b>public bool</b> <a id="dfa09c8262a07d3f" href="../../R/dfa09c8262a07d3f.html" target="n" data-glyph="102,1" class="i property">IsFault</a> { <b>get</b> { <b>return</b> <a href="#612b9849f1a8eb89" class="i field">ExceptionType</a> == <b>null</b>; } }
 
        <b>internal</b> <a id="12c83cf0d774e22c" href="../../R/12c83cf0d774e22c.html" target="n" data-glyph="74,1" class="t constructor">ExceptionHandler</a>(<b>int</b> <span id="r0 rd" class="r0 r">start</span>, <b>int</b> <span id="r1 rd" class="r1 r">end</span>, <b>int</b> <span id="r2 rd" class="r2 r">labelIndex</span>, <b>int</b> <span id="r3 rd" class="r3 r">handlerStartIndex</span>, <b>int</b> <span id="r4 rd" class="r4 r">handlerEndIndex</span>, <span class="i">Type</span> <span id="r5 rd" class="r5 r">exceptionType</span>)
        {
            <a href="#d7cde9b1b2bd9f25" class="i field">StartIndex</a> = <span class="r0 r">start</span>;
            <a href="#86029e35ef92b748" class="i field">EndIndex</a> = <span class="r1 r">end</span>;
            <a href="#aa07dcc39052c1b6" class="i field">LabelIndex</a> = <span class="r2 r">labelIndex</span>;
            <a href="#612b9849f1a8eb89" class="i field">ExceptionType</a> = <span class="r5 r">exceptionType</span>;
            <a href="#b8c5b2f0244537c8" class="i field">HandlerStartIndex</a> = <span class="r3 r">handlerStartIndex</span>;
            <a href="#39c86d69ddcd4a1f" class="i field">HandlerEndIndex</a> = <span class="r4 r">handlerEndIndex</span>;
        }
 
        <b>internal void</b> <a id="0cebf4724c950692" href="../../R/0cebf4724c950692.html" target="n" data-glyph="74,1" class="i method">SetParent</a>(<a href="#8e8656bd8d80df81" class="t t">TryCatchFinallyHandler</a> <span id="r6 rd" class="r6 r">tryHandler</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#c8b479c019c7fd23" class="i field">Parent</a> == <b>null</b>);
            <a href="#c8b479c019c7fd23" class="i field">Parent</a> = <span class="r6 r">tryHandler</span>;
        }
 
        <b>public bool</b> <a id="e0018bddee56b618" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Matches</a>(<span class="i">Type</span> <span id="r7 rd" class="r7 r">exceptionType</span>)
        {
            <b>if</b> (<a href="#612b9849f1a8eb89" class="i field">ExceptionType</a> == <b>null</b> || <a href="#612b9849f1a8eb89" class="i field">ExceptionType</a>.<span class="i">IsAssignableFrom</span>(<span class="r7 r">exceptionType</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>public bool</b> <a id="ae59b040b74a6001" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">IsBetterThan</a>(<a href="#b49e26e8d9415c16" class="t t">ExceptionHandler</a> <span id="r8 rd" class="r8 r">other</span>)
        {
            <b>if</b> (<span class="r8 r">other</span> == <b>null</b>) <b>return</b> <b>true</b>;
 
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#d7cde9b1b2bd9f25" class="i field">StartIndex</a> == <span class="r8 r">other</span>.<a href="#d7cde9b1b2bd9f25" class="i field">StartIndex</a> &amp;&amp; <a href="#86029e35ef92b748" class="i field">EndIndex</a> == <span class="r8 r">other</span>.<a href="#86029e35ef92b748" class="i field">EndIndex</a>, <span class="s">&quot;we only need to compare handlers for the same try block&quot;</span>);
            <b>return</b> <a href="#b8c5b2f0244537c8" class="i field">HandlerStartIndex</a> &lt; <span class="r8 r">other</span>.<a href="#b8c5b2f0244537c8" class="i field">HandlerStartIndex</a>;
        }
 
        <b>internal bool</b> <a id="1dd7528b384d01b8" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsInsideTryBlock</a>(<b>int</b> <span id="r9 rd" class="r9 r">index</span>)
        {
            <b>return</b> <span class="r9 r">index</span> &gt;= <a href="#d7cde9b1b2bd9f25" class="i field">StartIndex</a> &amp;&amp; <span class="r9 r">index</span> &lt; <a href="#86029e35ef92b748" class="i field">EndIndex</a>;
        }
 
        <b>internal bool</b> <a id="49921c07e0e8c601" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsInsideCatchBlock</a>(<b>int</b> <span id="r10 rd" class="r10 r">index</span>)
        {
            <b>return</b> <span class="r10 r">index</span> &gt;= <a href="#b8c5b2f0244537c8" class="i field">HandlerStartIndex</a> &amp;&amp; <span class="r10 r">index</span> &lt; <a href="#39c86d69ddcd4a1f" class="i field">HandlerEndIndex</a>;
        }
 
        <b>internal bool</b> <a id="ee6527c2fe4c4483" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsInsideFinallyBlock</a>(<b>int</b> <span id="r11 rd" class="r11 r">index</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#c8b479c019c7fd23" class="i field">Parent</a> != <b>null</b>);
            <b>return</b> <a href="#c8b479c019c7fd23" class="i field">Parent</a>.<a href="#8f6d0bddae35780e" class="i property">IsFinallyBlockExist</a> &amp;&amp; <span class="r11 r">index</span> &gt;= <a href="#c8b479c019c7fd23" class="i field">Parent</a>.<a href="#aef7f43a714d3ec8" class="i field">FinallyStartIndex</a> &amp;&amp; <span class="r11 r">index</span> &lt; <a href="#c8b479c019c7fd23" class="i field">Parent</a>.<a href="#29597b029a63ddde" class="i field">FinallyEndIndex</a>;
        }
 
        <b>public override string</b> <a id="9e8d54f25ff8cb2f" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0} [{1}-{2}] [{3}-&gt;{4}]&quot;</span>,
                (<a href="#dfa09c8262a07d3f" class="i property">IsFault</a> ? <span class="s">&quot;fault&quot;</span> : <span class="s">&quot;catch(&quot;</span> + <a href="#612b9849f1a8eb89" class="i field">ExceptionType</a>.<span class="i">Name</span> + <span class="s">&quot;)&quot;</span>),
                <a href="#d7cde9b1b2bd9f25" class="i field">StartIndex</a>, <a href="#86029e35ef92b748" class="i field">EndIndex</a>,
                <a href="#b8c5b2f0244537c8" class="i field">HandlerStartIndex</a>, <a href="#39c86d69ddcd4a1f" class="i field">HandlerEndIndex</a>
            );
        }
    }
 
    <b>internal sealed class</b> <a id="8e8656bd8d80df81" href="../../R/8e8656bd8d80df81.html" target="n" data-glyph="2,0" class="t t">TryCatchFinallyHandler</a>
    {
        <b>internal readonly int</b> <a id="c00a85ce049eb571" href="../../R/c00a85ce049eb571.html" target="n" data-glyph="44,1" class="i field">TryStartIndex</a> = <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>;
        <b>internal readonly int</b> <a id="ca8ecd3b9683b1b7" href="../../R/ca8ecd3b9683b1b7.html" target="n" data-glyph="44,1" class="i field">TryEndIndex</a> = <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>;
        <b>internal readonly int</b> <a id="aef7f43a714d3ec8" href="../../R/aef7f43a714d3ec8.html" target="n" data-glyph="44,1" class="i field">FinallyStartIndex</a> = <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>;
        <b>internal readonly int</b> <a id="29597b029a63ddde" href="../../R/29597b029a63ddde.html" target="n" data-glyph="44,1" class="i field">FinallyEndIndex</a> = <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>;
        <b>internal readonly int</b> <a id="a78cbdfe407d6d76" href="../../R/a78cbdfe407d6d76.html" target="n" data-glyph="44,1" class="i field">GotoEndTargetIndex</a> = <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>;
 
        <b>private readonly</b> <a href="#b49e26e8d9415c16" class="t t">ExceptionHandler</a>[] <a id="6b88a136ec0a1716" href="../../R/6b88a136ec0a1716.html" target="n" data-glyph="46,1" class="i field">_handlers</a>;
 
        <b>internal bool</b> <a id="8f6d0bddae35780e" href="../../R/8f6d0bddae35780e.html" target="n" data-glyph="104,1" class="i property">IsFinallyBlockExist</a>
        {
            <b>get</b> { <b>return</b> (<a href="#aef7f43a714d3ec8" class="i field">FinallyStartIndex</a> != <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a> &amp;&amp; <a href="#29597b029a63ddde" class="i field">FinallyEndIndex</a> != <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>); }
        }
 
        <b>internal bool</b> <a id="e8893d3abb6fe8e9" href="../../R/e8893d3abb6fe8e9.html" target="n" data-glyph="104,1" class="i property">IsCatchBlockExist</a>
        {
            <b>get</b> { <b>return</b> (<a href="#6b88a136ec0a1716" class="i field">_handlers</a> != <b>null</b>); }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No finally block.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="a258eb42a96fa70f" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">TryCatchFinallyHandler</a>(<b>int</b> <span id="r12 rd" class="r12 r">tryStart</span>, <b>int</b> <span id="r13 rd" class="r13 r">tryEnd</span>, <b>int</b> <span id="r14 rd" class="r14 r">gotoEndTargetIndex</span>, <a href="#b49e26e8d9415c16" class="t t">ExceptionHandler</a>[] <span id="r15 rd" class="r15 r">handlers</span>)
            : <a href="#42666464ffe7c408" class="k">this</a>(<span class="r12 r">tryStart</span>, <span class="r13 r">tryEnd</span>, <span class="r14 r">gotoEndTargetIndex</span>, <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>, <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>, <span class="r15 r">handlers</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r15 r">handlers</span> != <b>null</b>, <span class="s">&quot;catch blocks should exist&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No catch blocks.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="3b06e792eb59c716" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">TryCatchFinallyHandler</a>(<b>int</b> <span id="r16 rd" class="r16 r">tryStart</span>, <b>int</b> <span id="r17 rd" class="r17 r">tryEnd</span>, <b>int</b> <span id="r18 rd" class="r18 r">gotoEndTargetIndex</span>, <b>int</b> <span id="r19 rd" class="r19 r">finallyStart</span>, <b>int</b> <span id="r20 rd" class="r20 r">finallyEnd</span>)
            : <a href="#42666464ffe7c408" class="k">this</a>(<span class="r16 r">tryStart</span>, <span class="r17 r">tryEnd</span>, <span class="r18 r">gotoEndTargetIndex</span>, <span class="r19 r">finallyStart</span>, <span class="r20 r">finallyEnd</span>, <b>null</b>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r19 r">finallyStart</span> != <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a> &amp;&amp; <span class="r20 r">finallyEnd</span> != <a href="Instruction.cs.html#ae0e6be378b87eaa" class="t t">Instruction</a>.<a href="Instruction.cs.html#091955c50bfe55c2" class="i field">UnknownInstrIndex</a>, <span class="s">&quot;finally block should exist&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generic constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="42666464ffe7c408" href="../../R/42666464ffe7c408.html" target="n" data-glyph="74,1" class="t constructor">TryCatchFinallyHandler</a>(<b>int</b> <span id="r21 rd" class="r21 r">tryStart</span>, <b>int</b> <span id="r22 rd" class="r22 r">tryEnd</span>, <b>int</b> <span id="r23 rd" class="r23 r">gotoEndLabelIndex</span>, <b>int</b> <span id="r24 rd" class="r24 r">finallyStart</span>, <b>int</b> <span id="r25 rd" class="r25 r">finallyEnd</span>, <a href="#b49e26e8d9415c16" class="t t">ExceptionHandler</a>[] <span id="r26 rd" class="r26 r">handlers</span>)
        {
            <a href="#c00a85ce049eb571" class="i field">TryStartIndex</a> = <span class="r21 r">tryStart</span>;
            <a href="#ca8ecd3b9683b1b7" class="i field">TryEndIndex</a> = <span class="r22 r">tryEnd</span>;
            <a href="#aef7f43a714d3ec8" class="i field">FinallyStartIndex</a> = <span class="r24 r">finallyStart</span>;
            <a href="#29597b029a63ddde" class="i field">FinallyEndIndex</a> = <span class="r25 r">finallyEnd</span>;
            <a href="#a78cbdfe407d6d76" class="i field">GotoEndTargetIndex</a> = <span class="r23 r">gotoEndLabelIndex</span>;
 
            <a href="#6b88a136ec0a1716" class="i field">_handlers</a> = <span class="r26 r">handlers</span>;
 
            <b>if</b> (<a href="#6b88a136ec0a1716" class="i field">_handlers</a> != <b>null</b>)
            {
                <b>for</b> (<b>int</b> <span id="r27 rd" class="r27 r">index</span> = 0; <span class="r27 r">index</span> &lt; <a href="#6b88a136ec0a1716" class="i field">_handlers</a>.<span class="i">Length</span>; <span class="r27 r">index</span>++)
                {
                    <a href="#b49e26e8d9415c16" class="k">var</a> <span id="r28 rd" class="r28 r">handler</span> = <a href="#6b88a136ec0a1716" class="i field">_handlers</a>[<span class="r27 r">index</span>];
                    <span class="r28 r">handler</span>.<a href="#0cebf4724c950692" class="i method">SetParent</a>(<a href="#8e8656bd8d80df81" class="k">this</a>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Goto the index of the first instruction of the suitable catch block.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal int</b> <a id="c27709fc3aba3fc0" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GotoHandler</a>(<a href="InterpretedFrame.cs.html#48cb4583b6a7ca66" class="t t">InterpretedFrame</a> <span id="r29 rd" class="r29 r">frame</span>, <b>object</b> <span id="r30 rd" class="r30 r">exception</span>, <b>out</b> <a href="#b49e26e8d9415c16" class="t t">ExceptionHandler</a> <span id="r31 rd" class="r31 r">handler</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#6b88a136ec0a1716" class="i field">_handlers</a> != <b>null</b>, <span class="s">&quot;we should have at least one handler if the method gets called&quot;</span>);
            <span class="r31 r">handler</span> = <span class="i">Array</span>.<span class="i">Find</span>(<a href="#6b88a136ec0a1716" class="i field">_handlers</a>, <span id="r32 rd" class="r32 r">t</span> =&gt; <span class="r32 r">t</span>.<span class="i">Matches</span>(<span class="r30 r">exception</span>.<span class="i">GetType</span>()));
            <b>if</b> (<span class="r31 r">handler</span> == <b>null</b>) { <b>return</b> 0; }
 
            <b>return</b> <span class="r29 r">frame</span>.<a href="InterpretedFrame.cs.html#15cf0ce617eebb12" class="i method">Goto</a>(<span class="r31 r">handler</span>.<a href="#aa07dcc39052c1b6" class="i field">LabelIndex</a>, <span class="r30 r">exception</span>, <span class="r33 r">gotoExceptionHandler</span>: <b>true</b>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The re-throw instruction will throw this exception.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="126fd9a43076d93e" href="../../R/126fd9a43076d93e.html" target="n" data-glyph="2,0" class="t t"><span id="31266871a3d24e85">RethrowException</span></a> : <span class="i">SystemException</span>
    {
    }
 
    [<span class="i">Serializable</span>]
    <b>internal class</b> <a id="5695502ad1c2684d" href="../../R/5695502ad1c2684d.html" target="n" data-glyph="2,0" class="t t"><span id="350edde6ca323728">DebugInfo</span></a>
    {
        <span class="c">// TODO: readonly</span>
 
        <b>public int</b> <a id="796fb347f24a2794" href="../../R/796fb347f24a2794.html" target="n" data-glyph="42,1" class="i field">StartLine</a>, <a id="f2796bc380735164" href="../../R/f2796bc380735164.html" target="n" data-glyph="42,1" class="i field">EndLine</a>;
        <b>public int</b> <a id="43e5259100cf9592" href="../../R/43e5259100cf9592.html" target="n" data-glyph="42,1" class="i field">Index</a>;
        <b>public string</b> <a id="4f63b210cbc8a808" href="../../R/4f63b210cbc8a808.html" target="n" data-glyph="42,1" class="i field">FileName</a>;
        <b>public bool</b> <a id="0f9ac13a15ffd396" href="../../R/0f9ac13a15ffd396.html" target="n" data-glyph="42,1" class="i field">IsClear</a>;
        <b>private static readonly</b> <a href="#4968c6cbf8680de5" class="t t">DebugInfoComparer</a> <a id="b936c3447f885331" href="../../R/b936c3447f885331.html" target="n" data-glyph="46,1" class="i field">s_debugComparer</a> = <b>new</b> <span class="t">DebugInfoComparer</span>();
 
        <b>private sealed class</b> <a id="4968c6cbf8680de5" href="../../R/4968c6cbf8680de5.html" target="n" data-glyph="4,1" class="t t"><span id="9aaa651aaa58cf21">DebugInfoComparer</span></a> : <span class="i">IComparer</span>&lt;<a href="#5695502ad1c2684d" class="t t">DebugInfo</a>&gt;
        {
            <span class="c">// We allow comparison between int and DebugInfo here</span>
            <b>int</b> <span class="i">IComparer</span>&lt;<a href="#5695502ad1c2684d" class="t t">DebugInfo</a>&gt;.<a id="3c7fbebdc774998c" href="../../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">Compare</a>(<a href="#5695502ad1c2684d" class="t t">DebugInfo</a> <span id="r34 rd" class="r34 r">d1</span>, <a href="#5695502ad1c2684d" class="t t">DebugInfo</a> <span id="r35 rd" class="r35 r">d2</span>)
            {
                <b>if</b> (<span class="r34 r">d1</span>.<a href="#43e5259100cf9592" class="i field">Index</a> &gt; <span class="r35 r">d2</span>.<a href="#43e5259100cf9592" class="i field">Index</a>) <b>return</b> 1;
                <b>else</b> <b>if</b> (<span class="r34 r">d1</span>.<a href="#43e5259100cf9592" class="i field">Index</a> == <span class="r35 r">d2</span>.<a href="#43e5259100cf9592" class="i field">Index</a>) <b>return</b> 0;
                <b>else</b> <b>return</b> -1;
            }
        }
 
        <b>public static</b> <a href="#5695502ad1c2684d" class="t t">DebugInfo</a> <a id="e3757b5c887458f9" href="../../R/e3757b5c887458f9.html" target="n" data-glyph="72,1" class="i method">GetMatchingDebugInfo</a>(<a href="#5695502ad1c2684d" class="t t">DebugInfo</a>[] <span id="r36 rd" class="r36 r">debugInfos</span>, <b>int</b> <span id="r37 rd" class="r37 r">index</span>)
        {
            <span class="c">// Create a faked DebugInfo to do the search</span>
            <a href="#5695502ad1c2684d" class="t t">DebugInfo</a> <span id="r38 rd" class="r38 r">d</span> = <b>new</b> <span class="t">DebugInfo</span> { <a href="#43e5259100cf9592" class="i field">Index</a> = <span class="r37 r">index</span> };
 
            <span class="c">// to find the closest debug info before the current index</span>
 
            <b>int</b> <span id="r39 rd" class="r39 r">i</span> = <span class="i">Array</span>.<span class="i">BinarySearch</span>&lt;<a href="#5695502ad1c2684d" class="t t">DebugInfo</a>&gt;(<span class="r36 r">debugInfos</span>, <span class="r38 r">d</span>, <a href="#b936c3447f885331" class="i field">s_debugComparer</a>);
            <b>if</b> (<span class="r39 r">i</span> &lt; 0)
            {
                <span class="c">// ~i is the index for the first bigger element</span>
                <span class="c">// if there is no bigger element, ~i is the length of the array</span>
                <span class="r39 r">i</span> = ~<span class="r39 r">i</span>;
                <b>if</b> (<span class="r39 r">i</span> == 0)
                {
                    <b>return</b> <b>null</b>;
                }
                <span class="c">// return the last one that is smaller</span>
                <span class="r39 r">i</span> -= 1;
            }
 
            <b>return</b> <span class="r36 r">debugInfos</span>[<span class="r39 r">i</span>];
        }
 
        <b>public override string</b> <a id="8c607a003ff429b4" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>if</b> (<a href="#0f9ac13a15ffd396" class="i field">IsClear</a>)
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}: clear&quot;</span>, <a href="#43e5259100cf9592" class="i field">Index</a>);
            }
            <b>else</b>
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}: [{1}-{2}] &#39;{3}&#39;&quot;</span>, <a href="#43e5259100cf9592" class="i field">Index</a>, <a href="#796fb347f24a2794" class="i field">StartLine</a>, <a href="#f2796bc380735164" class="i field">EndLine</a>, <a href="#4f63b210cbc8a808" class="i field">FileName</a>);
            }
        }
    }
 
    <span class="c">// TODO:</span>
    [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1815:OverrideEqualsAndOperatorEqualsOnValueTypes&quot;</span>)]
    [<span class="i">Serializable</span>]
    <b>internal readonly struct</b> <a id="f19723e7a4a27157" href="../../R/f19723e7a4a27157.html" target="n" data-glyph="110,0" class="t t"><span id="cdae1960bdd37950">InterpretedFrameInfo</span></a>
    {
        <b>public readonly string</b> <a id="b4bce678c1e2e1de" href="../../R/b4bce678c1e2e1de.html" target="n" data-glyph="42,1" class="i field">MethodName</a>;
 
        <span class="c">// TODO:</span>
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Security&quot;</span>, <span class="s">&quot;CA2104:DoNotDeclareReadOnlyMutableReferenceTypes&quot;</span>)]
        <b>public readonly</b> <a href="#5695502ad1c2684d" class="t t">DebugInfo</a> <a id="bd7b8193c08cadcf" href="../../R/bd7b8193c08cadcf.html" target="n" data-glyph="42,1" class="i field">DebugInfo</a>;
 
        <b>public</b> <a id="6f0aab944fe73898" href="../../R/6f0aab944fe73898.html" target="n" data-glyph="72,1" class="t constructor">InterpretedFrameInfo</a>(<b>string</b> <span id="r40 rd" class="r40 r">methodName</span>, <a href="#5695502ad1c2684d" class="t t">DebugInfo</a> <span id="r41 rd" class="r41 r">info</span>)
        {
            <a href="#b4bce678c1e2e1de" class="i field">MethodName</a> = <span class="r40 r">methodName</span>;
            <a href="#bd7b8193c08cadcf" class="i field">DebugInfo</a> = <span class="r41 r">info</span>;
        }
 
        <b>public override string</b> <a id="8f53163e7b5ccc79" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <a href="#b4bce678c1e2e1de" class="i field">MethodName</a> + (<a href="#bd7b8193c08cadcf" class="i field">DebugInfo</a> != <b>null</b> ? <span class="s">&quot;: &quot;</span> + <a href="#bd7b8193c08cadcf" class="i field">DebugInfo</a> : <b>null</b>);
        }
    }
 
    [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Maintainability&quot;</span>, <span class="s">&quot;CA1506:AvoidExcessiveClassCoupling&quot;</span>)]
    <b>internal sealed class</b> <a id="bee3a40ad9cb3a51" href="../../R/bee3a40ad9cb3a51.html" target="n" data-glyph="2,0" class="t t">LightCompiler</a>
    {
        <b>internal const int</b> <a id="c52f5cd89a9bfc39" href="../../R/c52f5cd89a9bfc39.html" target="n" data-glyph="8,1" class="i field">DefaultCompilationThreshold</a> = 32;
 
        <span class="c">// zero: sync compilation</span>
        <b>private readonly int</b> <a id="5638e0593dc45b08" href="../../R/5638e0593dc45b08.html" target="n" data-glyph="46,1" class="i field">_compilationThreshold</a>;
 
        <b>private readonly</b> <a href="InstructionList.cs.html#4bc9256c53a38dc2" class="t t">InstructionList</a> <a id="e38ff94a87332783" href="../../R/e38ff94a87332783.html" target="n" data-glyph="46,1" class="i field">_instructions</a>;
        <b>private readonly</b> <a href="LocalVariables.cs.html#73129b416b625324" class="t t">LocalVariables</a> <a id="7a9deb329886455f" href="../../R/7a9deb329886455f.html" target="n" data-glyph="46,1" class="i field">_locals</a> = <b>new</b> <a href="LocalVariables.cs.html#154bb91f24da5680" class="t constructor">LocalVariables</a>();
 
        <b>private readonly</b> <span class="i">List</span>&lt;<a href="#5695502ad1c2684d" class="t t">DebugInfo</a>&gt; <a id="7548b5b94c9c87ef" href="../../R/7548b5b94c9c87ef.html" target="n" data-glyph="46,1" class="i field">_debugInfos</a> = <b>new</b> <span class="i">List</span>&lt;<a href="#5695502ad1c2684d" class="t t">DebugInfo</a>&gt;();
        <b>private readonly</b> <a href="Utilities.cs.html#600f1e648b51e109" class="t t">HybridReferenceDictionary</a>&lt;<span class="i">LabelTarget</span>, <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a>&gt; <a id="46b88bfc787ead0e" href="../../R/46b88bfc787ead0e.html" target="n" data-glyph="46,1" class="i field">_treeLabels</a> = <b>new</b> <a href="Utilities.cs.html#29232c1e9100bf17" class="t constructor">HybridReferenceDictionary</a>&lt;<span class="i">LabelTarget</span>, <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a>&gt;();
        <b>private</b> <a href="LabelInfo.cs.html#7f3dd9b110a8be1c" class="t t">LabelScopeInfo</a> <a id="cee41a60058bf341" href="../../R/cee41a60058bf341.html" target="n" data-glyph="46,1" class="i field">_labelBlock</a> = <b>new</b> <a href="LabelInfo.cs.html#5124520a790df828" class="t constructor">LabelScopeInfo</a>(<b>null</b>, <a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#72aad354960d5225" class="i field">Lambda</a>);
 
        <b>private readonly</b> <span class="i">Stack</span>&lt;<span class="i">ParameterExpression</span>&gt; <a id="213ce064becf4d8d" href="../../R/213ce064becf4d8d.html" target="n" data-glyph="46,1" class="i field">_exceptionForRethrowStack</a> = <b>new</b> <span class="i">Stack</span>&lt;<span class="i">ParameterExpression</span>&gt;();
 
        <span class="c">// Set to true to force compilation of this lambda.</span>
        <span class="c">// This disables the interpreter for this lambda. We still need to</span>
        <span class="c">// walk it, however, to resolve variables closed over from the parent</span>
        <span class="c">// lambdas (because they may be interpreted).</span>
        <b>private bool</b> <a id="668e5f6fceeb042f" href="../../R/668e5f6fceeb042f.html" target="n" data-glyph="46,1" class="i field">_forceCompile</a>;
 
        <b>private readonly</b> <a href="#bee3a40ad9cb3a51" class="t t">LightCompiler</a> <a id="0cbffc5e103047cc" href="../../R/0cbffc5e103047cc.html" target="n" data-glyph="46,1" class="i field">_parent</a>;
 
        <b>private static readonly</b> <a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a>[] <a id="da9d9a9b443f3d0d" href="../../R/da9d9a9b443f3d0d.html" target="n" data-glyph="46,1" class="i field">s_emptyLocals</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a>&gt;();
 
        <b>public</b> <a id="5a5c9f16bfc515bd" href="../../R/5a5c9f16bfc515bd.html" target="n" data-glyph="72,1" class="t constructor">LightCompiler</a>(<b>int</b> <span id="r42 rd" class="r42 r">compilationThreshold</span>)
        {
            <a href="#e38ff94a87332783" class="i field">_instructions</a> = <b>new</b> <span class="t">InstructionList</span>();
            <a href="#5638e0593dc45b08" class="i field">_compilationThreshold</a> = <span class="r42 r">compilationThreshold</span> &lt; 0 ? <a href="#c52f5cd89a9bfc39" class="i field">DefaultCompilationThreshold</a> : <span class="r42 r">compilationThreshold</span>;
        }
 
        <b>private</b> <a id="d521b1d9281803f7" href="../../R/d521b1d9281803f7.html" target="n" data-glyph="76,1" class="t constructor">LightCompiler</a>(<a href="#bee3a40ad9cb3a51" class="t t">LightCompiler</a> <span id="r43 rd" class="r43 r">parent</span>)
            : <a href="#5a5c9f16bfc515bd" class="k">this</a>(<span class="r43 r">parent</span>.<a href="#5638e0593dc45b08" class="i field">_compilationThreshold</a>)
        {
            <a href="#0cbffc5e103047cc" class="i field">_parent</a> = <span class="r43 r">parent</span>;
        }
 
        <b>public</b> <a href="InstructionList.cs.html#4bc9256c53a38dc2" class="t t">InstructionList</a> <a id="ee17248c84b78fba" href="../../R/ee17248c84b78fba.html" target="n" data-glyph="102,1" class="i property">Instructions</a>
        {
            <b>get</b> { <b>return</b> <a href="#e38ff94a87332783" class="i field">_instructions</a>; }
        }
 
        <b>public</b> <a href="LocalVariables.cs.html#73129b416b625324" class="t t">LocalVariables</a> <a id="6bf1d8730c4bbd8c" href="../../R/6bf1d8730c4bbd8c.html" target="n" data-glyph="102,1" class="i property">Locals</a>
        {
            <b>get</b> { <b>return</b> <a href="#7a9deb329886455f" class="i field">_locals</a>; }
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="cbd70d0630bc623c" href="../../R/cbd70d0630bc623c.html" target="n" data-glyph="74,1" class="i method">Unbox</a>(<span class="i">Expression</span> <span id="r44 rd" class="r44 r">strongBoxExpression</span>)
        {
            <b>return</b> <span class="i">Expression</span>.<span class="i">Field</span>(<span class="r44 r">strongBoxExpression</span>, <b>typeof</b>(<span class="i">StrongBox</span>&lt;<b>object</b>&gt;).<span class="i">GetField</span>(<span class="s">&quot;Value&quot;</span>));
        }
 
        <b>public</b> <a href="LightDelegateCreator.cs.html#51f9bfb96b7e3043" class="t t">LightDelegateCreator</a> <a id="9c6a537e4450fb2d" href="../../R/9c6a537e4450fb2d.html" target="n" data-glyph="72,1" class="i method">CompileTop</a>(<span class="i">LambdaExpression</span> <span id="r45 rd" class="r45 r">node</span>)
        {
            <b>for</b> (<b>int</b> <span id="r46 rd" class="r46 r">index</span> = 0; <span class="r46 r">index</span> &lt; <span class="r45 r">node</span>.<span class="i">Parameters</span>.<span class="i">Count</span>; <span class="r46 r">index</span>++)
            {
                <b>var</b> <span id="r47 rd" class="r47 r">p</span> = <span class="r45 r">node</span>.<span class="i">Parameters</span>[<span class="r46 r">index</span>];
                <a href="LocalVariables.cs.html#074adbe42b842625" class="k">var</a> <span id="r48 rd" class="r48 r">local</span> = <a href="#7a9deb329886455f" class="i field">_locals</a>.<span class="i">DefineLocal</span>(<span class="r47 r">p</span>, 0);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#1d3d56965946605b" class="i method">EmitInitializeParameter</a>(<span class="r48 r">local</span>.<a href="LocalVariables.cs.html#c9d5745642cc170e" class="i property">Index</a>);
            }
 
            <span class="i">Compile</span>(<span class="r45 r">node</span>.<span class="i">Body</span>);
 
            <span class="c">// pop the result of the last expression:</span>
            <b>if</b> (<span class="r45 r">node</span>.<span class="i">Body</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>) &amp;&amp; <span class="r45 r">node</span>.<span class="i">ReturnType</span> == <b>typeof</b>(<b>void</b>))
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#d9d8cea15cb5918d" class="i method">EmitPop</a>();
            }
 
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#5a7bf73ebd74b3ab" class="i property">CurrentStackDepth</a> == (<span class="r45 r">node</span>.<span class="i">ReturnType</span> != <b>typeof</b>(<b>void</b>) ? 1 : 0));
 
            <b>return</b> <b>new</b> <a href="LightDelegateCreator.cs.html#45fae04ba958d9ac" class="t constructor">LightDelegateCreator</a>(<span class="i">MakeInterpreter</span>(<span class="r45 r">node</span>.<span class="i">Name</span>), <span class="r45 r">node</span>);
        }
 
        <span class="c">// internal LightDelegateCreator CompileTop(LightLambdaExpression node) {</span>
        <span class="c">//    foreach (var p in node.Parameters) {</span>
        <span class="c">//        var local = _locals.DefineLocal(p, 0);</span>
        <span class="c">//        _instructions.EmitInitializeParameter(local.Index);</span>
        <span class="c">//    }</span>
        <span class="c">//</span>
        <span class="c">//    Compile(node.Body);</span>
        <span class="c">//</span>
        <span class="c">//    // pop the result of the last expression:</span>
        <span class="c">//    if (node.Body.Type != typeof(void) &amp;&amp; node.ReturnType == typeof(void)) {</span>
        <span class="c">//        _instructions.EmitPop();</span>
        <span class="c">//    }</span>
        <span class="c">//</span>
        <span class="c">//    Debug.Assert(_instructions.CurrentStackDepth == (node.ReturnType != typeof(void) ? 1 : 0));</span>
        <span class="c">//</span>
        <span class="c">//    return new LightDelegateCreator(MakeInterpreter(node.Name), node);</span>
        <span class="c">// }</span>
 
        <b>private</b> <a href="Interpreter.cs.html#2c0965030a4850cd" class="t t">Interpreter</a> <a id="ac6d8b24524a05ee" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">MakeInterpreter</a>(<b>string</b> <span id="r49 rd" class="r49 r">lambdaName</span>)
        {
            <b>if</b> (<a href="#668e5f6fceeb042f" class="i field">_forceCompile</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>var</b> <span id="r50 rd" class="r50 r">debugInfos</span> = <a href="#7548b5b94c9c87ef" class="i field">_debugInfos</a>.<span class="i">ToArray</span>();
            <b>return</b> <b>new</b> <span class="t">Interpreter</span>(<span class="r49 r">lambdaName</span>, <a href="#7a9deb329886455f" class="i field">_locals</a>, <a href="#a5332099918141bf" class="i method">GetBranchMapping</a>(), <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#35f93453a08e339d" class="i method">ToArray</a>(), <span class="r50 r">debugInfos</span>, <a href="#5638e0593dc45b08" class="i field">_compilationThreshold</a>);
        }
 
        <b>private void</b> <a id="44f6f51b4b035fd0" href="../../R/44f6f51b4b035fd0.html" target="n" data-glyph="76,1" class="i method">CompileConstantExpression</a>(<span class="i">Expression</span> <span id="r51 rd" class="r51 r">expr</span>)
        {
            <b>var</b> <span id="r52 rd" class="r52 r">node</span> = (<span class="i">ConstantExpression</span>)<span class="r51 r">expr</span>;
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLoad</span>(<span class="r52 r">node</span>.<span class="i">Value</span>, <span class="r52 r">node</span>.<span class="i">Type</span>);
        }
 
        <b>private void</b> <a id="21e64bcf0d707ed7" href="../../R/21e64bcf0d707ed7.html" target="n" data-glyph="76,1" class="i method">CompileDefaultExpression</a>(<span class="i">Expression</span> <span id="r53 rd" class="r53 r">expr</span>)
        {
            <span class="i">CompileDefaultExpression</span>(<span class="r53 r">expr</span>.<span class="i">Type</span>);
        }
 
        <b>private void</b> <a id="c0f419103404355b" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompileDefaultExpression</a>(<span class="i">Type</span> <span id="r54 rd" class="r54 r">type</span>)
        {
            <b>if</b> (<span class="r54 r">type</span> != <b>typeof</b>(<b>void</b>))
            {
                <b>if</b> (<span class="r54 r">type</span>.<span class="i">IsValueType</span>)
                {
                    <b>object</b> <span id="r55 rd" class="r55 r">value</span> = <a href="Utilities.cs.html#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>.<a href="Utilities.cs.html#e161c4ba84c71734" class="i method">GetPrimitiveDefaultValue</a>(<span class="r54 r">type</span>);
                    <b>if</b> (<span class="r55 r">value</span> != <b>null</b>)
                    {
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#7ebf38d2a9cc168e" class="i method">EmitLoad</a>(<span class="r55 r">value</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#583b3039ceaa8df6" class="i method">EmitDefaultValue</a>(<span class="r54 r">type</span>);
                    }
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#670909f473746144" class="i method">EmitLoad</a>(<b>null</b>);
                }
            }
        }
 
        <b>private</b> <a href="LocalVariables.cs.html#0bca4d1c1dadd0c2" class="t t">LocalVariable</a> <a id="c2614fe302a8ad78" href="../../R/c2614fe302a8ad78.html" target="n" data-glyph="76,1" class="i method">EnsureAvailableForClosure</a>(<span class="i">ParameterExpression</span> <span id="r56 rd" class="r56 r">expr</span>)
        {
            <a href="LocalVariables.cs.html#0bca4d1c1dadd0c2" class="t t">LocalVariable</a> <span id="r57 rd" class="r57 r">local</span>;
            <b>if</b> (<a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#7863ca2e41ec005c" class="i method">TryGetLocalOrClosure</a>(<span class="r56 r">expr</span>, <b>out</b> <span class="r57 r">local</span>))
            {
                <b>if</b> (!<span class="r57 r">local</span>.<a href="LocalVariables.cs.html#012b15be61366687" class="i property">InClosure</a> &amp;&amp; !<span class="r57 r">local</span>.<a href="LocalVariables.cs.html#6faded9523a907b7" class="i property">IsBoxed</a>)
                {
                    <a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#c49aba2f180f88d4" class="i method">Box</a>(<span class="r56 r">expr</span>, <a href="#e38ff94a87332783" class="i field">_instructions</a>);
                }
 
                <b>return</b> <span class="r57 r">local</span>;
            }
            <b>else</b> <b>if</b> (<a href="#0cbffc5e103047cc" class="i field">_parent</a> != <b>null</b>)
            {
                <a href="#0cbffc5e103047cc" class="i field">_parent</a>.<a href="#c2614fe302a8ad78" class="i method">EnsureAvailableForClosure</a>(<span class="r56 r">expr</span>);
                <b>return</b> <a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#4527c3881d276207" class="i method">AddClosureVariable</a>(<span class="r56 r">expr</span>);
            }
            <b>else</b>
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="s">&quot;unbound variable: &quot;</span> + <span class="r56 r">expr</span>);
            }
        }
 
        <span class="c">// private void EnsureVariable(ParameterExpression variable) {</span>
        <span class="c">//    if (!_locals.ContainsVariable(variable)) {</span>
        <span class="c">//        EnsureAvailableForClosure(variable);</span>
        <span class="c">//    }</span>
        <span class="c">// }</span>
 
        <b>private</b> <a href="LocalVariables.cs.html#0bca4d1c1dadd0c2" class="t t">LocalVariable</a> <a id="ac84bd1484db821a" href="../../R/ac84bd1484db821a.html" target="n" data-glyph="76,1" class="i method">ResolveLocal</a>(<span class="i">ParameterExpression</span> <span id="r58 rd" class="r58 r">variable</span>)
        {
            <a href="LocalVariables.cs.html#0bca4d1c1dadd0c2" class="t t">LocalVariable</a> <span id="r59 rd" class="r59 r">local</span>;
            <b>if</b> (!<a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#7863ca2e41ec005c" class="i method">TryGetLocalOrClosure</a>(<span class="r58 r">variable</span>, <b>out</b> <span class="r59 r">local</span>))
            {
                <span class="r59 r">local</span> = <a href="#c2614fe302a8ad78" class="i method">EnsureAvailableForClosure</a>(<span class="r58 r">variable</span>);
            }
 
            <b>return</b> <span class="r59 r">local</span>;
        }
 
        <b>public void</b> <a id="4cfe94a3ecafc95d" href="../../R/4cfe94a3ecafc95d.html" target="n" data-glyph="72,1" class="i method">CompileGetVariable</a>(<span class="i">ParameterExpression</span> <span id="r60 rd" class="r60 r">variable</span>)
        {
            <a href="LocalVariables.cs.html#0bca4d1c1dadd0c2" class="t t">LocalVariable</a> <span id="r61 rd" class="r61 r">local</span> = <a href="#ac84bd1484db821a" class="i method">ResolveLocal</a>(<span class="r60 r">variable</span>);
 
            <b>if</b> (<span class="r61 r">local</span>.<a href="LocalVariables.cs.html#012b15be61366687" class="i property">InClosure</a>)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#249b53de48b23044" class="i method">EmitLoadLocalFromClosure</a>(<span class="r61 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
            }
            <b>else</b> <b>if</b> (<span class="r61 r">local</span>.<a href="LocalVariables.cs.html#6faded9523a907b7" class="i property">IsBoxed</a>)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#521bf8c32901d561" class="i method">EmitLoadLocalBoxed</a>(<span class="r61 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
            }
            <b>else</b>
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#8e60556c11057af8" class="i method">EmitLoadLocal</a>(<span class="r61 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">SetDebugCookie</span>(<span class="r60 r">variable</span>.<span class="i">Name</span>);
        }
 
        <b>public void</b> <a id="5d9b00c2056b61bc" href="../../R/5d9b00c2056b61bc.html" target="n" data-glyph="72,1" class="i method">CompileGetBoxedVariable</a>(<span class="i">ParameterExpression</span> <span id="r62 rd" class="r62 r">variable</span>)
        {
            <a href="LocalVariables.cs.html#0bca4d1c1dadd0c2" class="t t">LocalVariable</a> <span id="r63 rd" class="r63 r">local</span> = <a href="#ac84bd1484db821a" class="i method">ResolveLocal</a>(<span class="r62 r">variable</span>);
 
            <b>if</b> (<span class="r63 r">local</span>.<a href="LocalVariables.cs.html#012b15be61366687" class="i property">InClosure</a>)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#ca726259cfa4293f" class="i method">EmitLoadLocalFromClosureBoxed</a>(<span class="r63 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
            }
            <b>else</b>
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r63 r">local</span>.<a href="LocalVariables.cs.html#6faded9523a907b7" class="i property">IsBoxed</a>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#8e60556c11057af8" class="i method">EmitLoadLocal</a>(<span class="r63 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">SetDebugCookie</span>(<span class="r62 r">variable</span>.<span class="i">Name</span>);
        }
 
        <b>public void</b> <a id="d99e283fb1e613f0" href="../../R/d99e283fb1e613f0.html" target="n" data-glyph="72,1" class="i method">CompileSetVariable</a>(<span class="i">ParameterExpression</span> <span id="r64 rd" class="r64 r">variable</span>, <b>bool</b> <span id="r65 rd" class="r65 r">isVoid</span>)
        {
            <a href="LocalVariables.cs.html#0bca4d1c1dadd0c2" class="t t">LocalVariable</a> <span id="r66 rd" class="r66 r">local</span> = <a href="#ac84bd1484db821a" class="i method">ResolveLocal</a>(<span class="r64 r">variable</span>);
 
            <b>if</b> (<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#012b15be61366687" class="i property">InClosure</a>)
            {
                <b>if</b> (<span class="r65 r">isVoid</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#489dddd3aed89677" class="i method">EmitStoreLocalToClosure</a>(<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#fecf756ac2d42bec" class="i method">EmitAssignLocalToClosure</a>(<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
                }
            }
            <b>else</b> <b>if</b> (<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#6faded9523a907b7" class="i property">IsBoxed</a>)
            {
                <b>if</b> (<span class="r65 r">isVoid</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#ae40d7cc068fcf08" class="i method">EmitStoreLocalBoxed</a>(<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#be3b45fea6f5f313" class="i method">EmitAssignLocalBoxed</a>(<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
                }
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r65 r">isVoid</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#b9ea584d3c8aa8b1" class="i method">EmitStoreLocal</a>(<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#e73197cdf102bdc8" class="i method">EmitAssignLocal</a>(<span class="r66 r">local</span>.<a href="LocalVariables.cs.html#0d782febaaf14290" class="i field">Index</a>);
                }
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">SetDebugCookie</span>(<span class="r64 r">variable</span>.<span class="i">Name</span>);
        }
 
        <b>public void</b> <a id="9b04fd2f61734671" href="../../R/9b04fd2f61734671.html" target="n" data-glyph="72,1" class="i method">CompileParameterExpression</a>(<span class="i">Expression</span> <span id="r67 rd" class="r67 r">expr</span>)
        {
            <b>var</b> <span id="r68 rd" class="r68 r">node</span> = (<span class="i">ParameterExpression</span>)<span class="r67 r">expr</span>;
            <a href="#4cfe94a3ecafc95d" class="i method">CompileGetVariable</a>(<span class="r68 r">node</span>);
        }
 
        <b>private void</b> <a id="c732c972f20e0412" href="../../R/c732c972f20e0412.html" target="n" data-glyph="76,1" class="i method">CompileBlockExpression</a>(<span class="i">Expression</span> <span id="r69 rd" class="r69 r">expr</span>, <b>bool</b> <span id="r70 rd" class="r70 r">asVoid</span>)
        {
            <b>var</b> <span id="r71 rd" class="r71 r">node</span> = (<span class="i">BlockExpression</span>)<span class="r69 r">expr</span>;
            <b>var</b> <span id="r72 rd" class="r72 r">end</span> = <a href="#b9e9a9f5d9b7e4fd" class="i method">CompileBlockStart</a>(<span class="r71 r">node</span>);
 
            <b>var</b> <span id="r73 rd" class="r73 r">lastExpression</span> = <span class="r71 r">node</span>.<span class="i">Expressions</span>[<span class="r71 r">node</span>.<span class="i">Expressions</span>.<span class="i">Count</span> - 1];
            <span class="i">Compile</span>(<span class="r73 r">lastExpression</span>, <span class="r70 r">asVoid</span>);
            <a href="#eac2ed39d61dd2e8" class="i method">CompileBlockEnd</a>(<span class="r72 r">end</span>);
        }
 
        <b>private</b> <a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a>[] <a id="b9e9a9f5d9b7e4fd" href="../../R/b9e9a9f5d9b7e4fd.html" target="n" data-glyph="76,1" class="i method">CompileBlockStart</a>(<span class="i">BlockExpression</span> <span id="r74 rd" class="r74 r">node</span>)
        {
            <b>var</b> <span id="r75 rd" class="r75 r">start</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
 
            <a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a>[] <span id="r76 rd" class="r76 r">locals</span>;
            <b>var</b> <span id="r77 rd" class="r77 r">variables</span> = <span class="r74 r">node</span>.<span class="i">Variables</span>;
            <b>if</b> (<span class="r77 r">variables</span>.<span class="i">Count</span> != 0)
            {
                <span class="c">// TODO: basic flow analysis so we don&#39;t have to initialize all</span>
                <span class="c">// variables.</span>
                <span class="r76 r">locals</span> = <b>new</b> <a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a>[<span class="r77 r">variables</span>.<span class="i">Count</span>];
                <b>int</b> <span id="r78 rd" class="r78 r">localCnt</span> = 0;
                <b>for</b> (<b>int</b> <span id="r79 rd" class="r79 r">index</span> = 0; <span class="r79 r">index</span> &lt; <span class="r77 r">variables</span>.<span class="i">Count</span>; <span class="r79 r">index</span>++)
                {
                    <b>var</b> <span id="r80 rd" class="r80 r">variable</span> = <span class="r77 r">variables</span>[<span class="r79 r">index</span>];
                    <a href="LocalVariables.cs.html#074adbe42b842625" class="k">var</a> <span id="r81 rd" class="r81 r">local</span> = <a href="#7a9deb329886455f" class="i field">_locals</a>.<span class="i">DefineLocal</span>(<span class="r80 r">variable</span>, <span class="r75 r">start</span>);
                    <span class="r76 r">locals</span>[<span class="r78 r">localCnt</span>++] = <span class="r81 r">local</span>;
 
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitInitializeLocal</span>(<span class="r81 r">local</span>.<a href="LocalVariables.cs.html#c9d5745642cc170e" class="i property">Index</a>, <span class="r80 r">variable</span>.<span class="i">Type</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">SetDebugCookie</span>(<span class="r80 r">variable</span>.<span class="i">Name</span>);
                }
            }
            <b>else</b>
            {
                <span class="r76 r">locals</span> = <a href="#da9d9a9b443f3d0d" class="i field">s_emptyLocals</a>;
            }
 
            <b>for</b> (<b>int</b> <span id="r82 rd" class="r82 r">i</span> = 0; <span class="r82 r">i</span> &lt; <span class="r74 r">node</span>.<span class="i">Expressions</span>.<span class="i">Count</span> - 1; <span class="r82 r">i</span>++)
            {
                <span class="i">CompileAsVoid</span>(<span class="r74 r">node</span>.<span class="i">Expressions</span>[<span class="r82 r">i</span>]);
            }
 
            <b>return</b> <span class="r76 r">locals</span>;
        }
 
        <b>private void</b> <a id="eac2ed39d61dd2e8" href="../../R/eac2ed39d61dd2e8.html" target="n" data-glyph="76,1" class="i method">CompileBlockEnd</a>(<a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a>[] <span id="r83 rd" class="r83 r">locals</span>)
        {
            <b>for</b> (<b>int</b> <span id="r84 rd" class="r84 r">index</span> = 0; <span class="r84 r">index</span> &lt; <span class="r83 r">locals</span>.<span class="i">Length</span>; <span class="r84 r">index</span>++)
            {
                <a href="LocalVariables.cs.html#074adbe42b842625" class="k">var</a> <span id="r85 rd" class="r85 r">local</span> = <span class="r83 r">locals</span>[<span class="r84 r">index</span>];
                <a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#3f225e644a9f0520" class="i method">UndefineLocal</a>(<span class="r85 r">local</span>, <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>);
            }
        }
 
        <b>private void</b> <a id="1713a06f3b6fe507" href="../../R/1713a06f3b6fe507.html" target="n" data-glyph="76,1" class="i method">CompileIndexExpression</a>(<span class="i">Expression</span> <span id="r86 rd" class="r86 r">expr</span>)
        {
            <b>var</b> <span id="r87 rd" class="r87 r">index</span> = (<span class="i">IndexExpression</span>)<span class="r86 r">expr</span>;
 
            <span class="c">// instance:</span>
            <b>if</b> (<span class="r87 r">index</span>.<span class="i">Object</span> != <b>null</b>)
            {
                <span class="i">Compile</span>(<span class="r87 r">index</span>.<span class="i">Object</span>);
            }
 
            <span class="c">// indexes, byref args not allowed.</span>
            <b>for</b> (<b>int</b> <span id="r88 rd" class="r88 r">i</span> = 0; <span class="r88 r">i</span> &lt; <span class="r87 r">index</span>.<span class="i">Arguments</span>.<span class="i">Count</span>; <span class="r88 r">i</span>++)
            {
                <b>var</b> <span id="r89 rd" class="r89 r">arg</span> = <span class="r87 r">index</span>.<span class="i">Arguments</span>[<span class="r88 r">i</span>];
                <span class="i">Compile</span>(<span class="r89 r">arg</span>);
            }
 
            <b>if</b> (<span class="r87 r">index</span>.<span class="i">Indexer</span> != <b>null</b>)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r87 r">index</span>.<span class="i">Indexer</span>.<span class="i">GetMethod</span>);
            }
            <b>else</b> <b>if</b> (<span class="r87 r">index</span>.<span class="i">Arguments</span>.<span class="i">Count</span> != 1)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r87 r">index</span>.<span class="i">Object</span>.<span class="i">Type</span>.<span class="i">GetMethod</span>(<span class="s">&quot;Get&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>));
            }
            <b>else</b>
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitGetArrayItem</span>(<span class="r87 r">index</span>.<span class="i">Object</span>.<span class="i">Type</span>);
            }
        }
 
        <b>private void</b> <a id="af847c340a76311b" href="../../R/af847c340a76311b.html" target="n" data-glyph="76,1" class="i method">CompileIndexAssignment</a>(<span class="i">BinaryExpression</span> <span id="r90 rd" class="r90 r">node</span>, <b>bool</b> <span id="r91 rd" class="r91 r">asVoid</span>)
        {
            <b>var</b> <span id="r92 rd" class="r92 r">index</span> = (<span class="i">IndexExpression</span>)<span class="r90 r">node</span>.<span class="i">Left</span>;
 
            <b>if</b> (!<span class="r91 r">asVoid</span>)
            {
                <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
            }
 
            <span class="c">// instance:</span>
            <b>if</b> (<span class="r92 r">index</span>.<span class="i">Object</span> != <b>null</b>)
            {
                <span class="i">Compile</span>(<span class="r92 r">index</span>.<span class="i">Object</span>);
            }
 
            <span class="c">// indexes, byref args not allowed.</span>
            <b>for</b> (<b>int</b> <span id="r93 rd" class="r93 r">i</span> = 0; <span class="r93 r">i</span> &lt; <span class="r92 r">index</span>.<span class="i">Arguments</span>.<span class="i">Count</span>; <span class="r93 r">i</span>++)
            {
                <b>var</b> <span id="r94 rd" class="r94 r">arg</span> = <span class="r92 r">index</span>.<span class="i">Arguments</span>[<span class="r93 r">i</span>];
                <span class="i">Compile</span>(<span class="r94 r">arg</span>);
            }
 
            <span class="c">// value:</span>
            <span class="i">Compile</span>(<span class="r90 r">node</span>.<span class="i">Right</span>);
 
            <b>if</b> (<span class="r92 r">index</span>.<span class="i">Indexer</span> != <b>null</b>)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r92 r">index</span>.<span class="i">Indexer</span>.<span class="i">SetMethod</span>);
            }
            <b>else</b> <b>if</b> (<span class="r92 r">index</span>.<span class="i">Arguments</span>.<span class="i">Count</span> != 1)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r92 r">index</span>.<span class="i">Object</span>.<span class="i">Type</span>.<span class="i">GetMethod</span>(<span class="s">&quot;Set&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>));
            }
            <b>else</b>
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitSetArrayItem</span>(<span class="r92 r">index</span>.<span class="i">Object</span>.<span class="i">Type</span>);
            }
        }
 
        <b>private void</b> <a id="b97aa63bdde3f354" href="../../R/b97aa63bdde3f354.html" target="n" data-glyph="76,1" class="i method">CompileMemberAssignment</a>(<span class="i">BinaryExpression</span> <span id="r95 rd" class="r95 r">node</span>, <b>bool</b> <span id="r96 rd" class="r96 r">asVoid</span>)
        {
            <b>var</b> <span id="r97 rd" class="r97 r">member</span> = (<span class="i">MemberExpression</span>)<span class="r95 r">node</span>.<span class="i">Left</span>;
 
            <span class="i">PropertyInfo</span> <span id="r98 rd" class="r98 r">pi</span> = <span class="r97 r">member</span>.<span class="i">Member</span> <b>as</b> <span class="i">PropertyInfo</span>;
            <b>if</b> (<span class="r98 r">pi</span> != <b>null</b>)
            {
                <b>var</b> <span id="r99 rd" class="r99 r">method</span> = <span class="r98 r">pi</span>.<span class="i">SetMethod</span>;
                <b>if</b> (<span class="r97 r">member</span>.<span class="i">Expression</span> != <b>null</b>)
                {
                    <span class="i">Compile</span>(<span class="r97 r">member</span>.<span class="i">Expression</span>);
                }
 
                <span class="i">Compile</span>(<span class="r95 r">node</span>.<span class="i">Right</span>);
 
                <b>int</b> <span id="r100 rd" class="r100 r">start</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
                <b>if</b> (!<span class="r96 r">asVoid</span>)
                {
                    <a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a> <span id="r101 rd" class="r101 r">local</span> = <a href="#7a9deb329886455f" class="i field">_locals</a>.<span class="i">DefineLocal</span>(<span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r95 r">node</span>.<span class="i">Right</span>.<span class="i">Type</span>), <span class="r100 r">start</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#e73197cdf102bdc8" class="i method">EmitAssignLocal</a>(<span class="r101 r">local</span>.<a href="LocalVariables.cs.html#c9d5745642cc170e" class="i property">Index</a>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r99 r">method</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#8e60556c11057af8" class="i method">EmitLoadLocal</a>(<span class="r101 r">local</span>.<a href="LocalVariables.cs.html#c9d5745642cc170e" class="i property">Index</a>);
                    <a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#3f225e644a9f0520" class="i method">UndefineLocal</a>(<span class="r101 r">local</span>, <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r99 r">method</span>);
                }
 
                <b>return</b>;
            }
 
            <span class="i">FieldInfo</span> <span id="r102 rd" class="r102 r">fi</span> = <span class="r97 r">member</span>.<span class="i">Member</span> <b>as</b> <span class="i">FieldInfo</span>;
            <b>if</b> (<span class="r102 r">fi</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r97 r">member</span>.<span class="i">Expression</span> != <b>null</b>)
                {
                    <span class="i">Compile</span>(<span class="r97 r">member</span>.<span class="i">Expression</span>);
                }
 
                <span class="i">Compile</span>(<span class="r95 r">node</span>.<span class="i">Right</span>);
 
                <b>int</b> <span id="r103 rd" class="r103 r">start</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
                <b>if</b> (!<span class="r96 r">asVoid</span>)
                {
                    <a href="LocalVariables.cs.html#074adbe42b842625" class="t t">LocalDefinition</a> <span id="r104 rd" class="r104 r">local</span> = <a href="#7a9deb329886455f" class="i field">_locals</a>.<span class="i">DefineLocal</span>(<span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r95 r">node</span>.<span class="i">Right</span>.<span class="i">Type</span>), <span class="r103 r">start</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#e73197cdf102bdc8" class="i method">EmitAssignLocal</a>(<span class="r104 r">local</span>.<a href="LocalVariables.cs.html#c9d5745642cc170e" class="i property">Index</a>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#ebf2d7f5c5e8a84a" class="i method">EmitStoreField</a>(<span class="r102 r">fi</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#8e60556c11057af8" class="i method">EmitLoadLocal</a>(<span class="r104 r">local</span>.<a href="LocalVariables.cs.html#c9d5745642cc170e" class="i property">Index</a>);
                    <a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#3f225e644a9f0520" class="i method">UndefineLocal</a>(<span class="r104 r">local</span>, <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#ebf2d7f5c5e8a84a" class="i method">EmitStoreField</a>(<span class="r102 r">fi</span>);
                }
 
                <b>return</b>;
            }
 
            <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
        }
 
        <b>private void</b> <a id="cd72397b75dfc89e" href="../../R/cd72397b75dfc89e.html" target="n" data-glyph="76,1" class="i method">CompileVariableAssignment</a>(<span class="i">BinaryExpression</span> <span id="r105 rd" class="r105 r">node</span>, <b>bool</b> <span id="r106 rd" class="r106 r">asVoid</span>)
        {
            <a href="#bee3a40ad9cb3a51" class="k">this</a>.<span class="i">Compile</span>(<span class="r105 r">node</span>.<span class="i">Right</span>);
 
            <b>var</b> <span id="r107 rd" class="r107 r">target</span> = (<span class="i">ParameterExpression</span>)<span class="r105 r">node</span>.<span class="i">Left</span>;
            <a href="#d99e283fb1e613f0" class="i method">CompileSetVariable</a>(<span class="r107 r">target</span>, <span class="r106 r">asVoid</span>);
        }
 
        <b>private void</b> <a id="69ec03e31daa87ce" href="../../R/69ec03e31daa87ce.html" target="n" data-glyph="76,1" class="i method">CompileAssignBinaryExpression</a>(<span class="i">Expression</span> <span id="r108 rd" class="r108 r">expr</span>, <b>bool</b> <span id="r109 rd" class="r109 r">asVoid</span>)
        {
            <b>var</b> <span id="r110 rd" class="r110 r">node</span> = (<span class="i">BinaryExpression</span>)<span class="r108 r">expr</span>;
 
            <b>switch</b> (<span class="r110 r">node</span>.<span class="i">Left</span>.<span class="i">NodeType</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Index</span>:
                    <a href="#af847c340a76311b" class="i method">CompileIndexAssignment</a>(<span class="r110 r">node</span>, <span class="r109 r">asVoid</span>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MemberAccess</span>:
                    <a href="#b97aa63bdde3f354" class="i method">CompileMemberAssignment</a>(<span class="r110 r">node</span>, <span class="r109 r">asVoid</span>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Parameter</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Extension</span>:
                    <a href="#cd72397b75dfc89e" class="i method">CompileVariableAssignment</a>(<span class="r110 r">node</span>, <span class="r109 r">asVoid</span>);
                    <b>break</b>;
 
                <b>default</b>:
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="s">&quot;Invalid lvalue for assignment: &quot;</span> + <span class="r110 r">node</span>.<span class="i">Left</span>.<span class="i">NodeType</span>);
            }
        }
 
        <b>private void</b> <a id="362bd11225a3267e" href="../../R/362bd11225a3267e.html" target="n" data-glyph="76,1" class="i method">CompileBinaryExpression</a>(<span class="i">Expression</span> <span id="r111 rd" class="r111 r">expr</span>)
        {
            <b>var</b> <span id="r112 rd" class="r112 r">node</span> = (<span class="i">BinaryExpression</span>)<span class="r111 r">expr</span>;
 
            <b>if</b> (<span class="r112 r">node</span>.<span class="i">Method</span> != <b>null</b>)
            {
                <span class="i">Compile</span>(<span class="r112 r">node</span>.<span class="i">Left</span>);
                <span class="i">Compile</span>(<span class="r112 r">node</span>.<span class="i">Right</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r112 r">node</span>.<span class="i">Method</span>);
            }
            <b>else</b>
            {
                <b>switch</b> (<span class="r112 r">node</span>.<span class="i">NodeType</span>)
                {
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ArrayIndex</span>:
                        <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r112 r">node</span>.<span class="i">Right</span>.<span class="i">Type</span> == <b>typeof</b>(<b>int</b>));
                        <span class="i">Compile</span>(<span class="r112 r">node</span>.<span class="i">Left</span>);
                        <span class="i">Compile</span>(<span class="r112 r">node</span>.<span class="i">Right</span>);
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitGetArrayItem</span>(<span class="r112 r">node</span>.<span class="i">Left</span>.<span class="i">Type</span>);
                        <b>return</b>;
 
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Add</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AddChecked</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Subtract</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">SubtractChecked</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Multiply</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MultiplyChecked</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Divide</span>:
                        <span class="i">CompileArithmetic</span>(<span class="r112 r">node</span>.<span class="i">NodeType</span>, <span class="r112 r">node</span>.<span class="i">Left</span>, <span class="r112 r">node</span>.<span class="i">Right</span>);
                        <b>return</b>;
 
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Equal</span>:
                        <span class="i">CompileEqual</span>(<span class="r112 r">node</span>.<span class="i">Left</span>, <span class="r112 r">node</span>.<span class="i">Right</span>);
                        <b>return</b>;
 
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>:
                        <span class="i">CompileNotEqual</span>(<span class="r112 r">node</span>.<span class="i">Left</span>, <span class="r112 r">node</span>.<span class="i">Right</span>);
                        <b>return</b>;
 
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThan</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThan</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span>:
                        <span class="i">CompileComparison</span>(<span class="r112 r">node</span>.<span class="i">NodeType</span>, <span class="r112 r">node</span>.<span class="i">Left</span>, <span class="r112 r">node</span>.<span class="i">Right</span>);
                        <b>return</b>;
 
                    <b>default</b>:
                        <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>(<span class="r112 r">node</span>.<span class="i">NodeType</span>.<span class="i">ToString</span>());
                }
            }
        }
 
        <b>private void</b> <a id="e0b208add289ab52" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompileEqual</a>(<span class="i">Expression</span> <span id="r113 rd" class="r113 r">left</span>, <span class="i">Expression</span> <span id="r114 rd" class="r114 r">right</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r113 r">left</span>.<span class="i">Type</span> == <span class="r114 r">right</span>.<span class="i">Type</span> ||
                         !<span class="r113 r">left</span>.<span class="i">Type</span>.<span class="i">IsValueType</span> &amp;&amp; !<span class="r114 r">right</span>.<span class="i">Type</span>.<span class="i">IsValueType</span>);
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r113 r">left</span>);
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r114 r">right</span>);
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitEqual</span>(<span class="r113 r">left</span>.<span class="i">Type</span>);
        }
 
        <b>private void</b> <a id="527e866e60c3bf70" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompileNotEqual</a>(<span class="i">Expression</span> <span id="r115 rd" class="r115 r">left</span>, <span class="i">Expression</span> <span id="r116 rd" class="r116 r">right</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r115 r">left</span>.<span class="i">Type</span> == <span class="r116 r">right</span>.<span class="i">Type</span> ||
                         !<span class="r115 r">left</span>.<span class="i">Type</span>.<span class="i">IsValueType</span> &amp;&amp; !<span class="r116 r">right</span>.<span class="i">Type</span>.<span class="i">IsValueType</span>);
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r115 r">left</span>);
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r116 r">right</span>);
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitNotEqual</span>(<span class="r115 r">left</span>.<span class="i">Type</span>);
        }
 
        <b>private void</b> <a id="2f3a55eae3b7b57e" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompileComparison</a>(<span class="i">ExpressionType</span> <span id="r117 rd" class="r117 r">nodeType</span>, <span class="i">Expression</span> <span id="r118 rd" class="r118 r">left</span>, <span class="i">Expression</span> <span id="r119 rd" class="r119 r">right</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r118 r">left</span>.<span class="i">Type</span> == <span class="r119 r">right</span>.<span class="i">Type</span> &amp;&amp; <a href="Utilities.cs.html#a1766c42eb12a5ca" class="t t">TypeUtils</a>.<span class="i">IsNumeric</span>(<span class="r118 r">left</span>.<span class="i">Type</span>));
 
            <span class="c">// TODO:</span>
            <span class="c">// if (TypeUtils.IsNullableType(left.Type) &amp;&amp; liftToNull) ...</span>
 
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r118 r">left</span>);
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r119 r">right</span>);
 
            <b>switch</b> (<span class="r117 r">nodeType</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThan</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLessThan</span>(<span class="r118 r">left</span>.<span class="i">Type</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLessThanOrEqual</span>(<span class="r118 r">left</span>.<span class="i">Type</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThan</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitGreaterThan</span>(<span class="r118 r">left</span>.<span class="i">Type</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitGreaterThanOrEqual</span>(<span class="r118 r">left</span>.<span class="i">Type</span>); <b>break</b>;
                <b>default</b>: <b>throw</b> <a href="Utilities.cs.html#f760db0369027867" class="t t">Assert</a>.<a href="Utilities.cs.html#176abe9780c04116" class="i property">Unreachable</a>;
            }
        }
 
        <b>private void</b> <a id="44fc6aa1dcd58b67" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompileArithmetic</a>(<span class="i">ExpressionType</span> <span id="r120 rd" class="r120 r">nodeType</span>, <span class="i">Expression</span> <span id="r121 rd" class="r121 r">left</span>, <span class="i">Expression</span> <span id="r122 rd" class="r122 r">right</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r121 r">left</span>.<span class="i">Type</span> == <span class="r122 r">right</span>.<span class="i">Type</span> &amp;&amp; <a href="Utilities.cs.html#a1766c42eb12a5ca" class="t t">TypeUtils</a>.<span class="i">IsArithmetic</span>(<span class="r121 r">left</span>.<span class="i">Type</span>));
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r121 r">left</span>);
            <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r122 r">right</span>);
            <b>switch</b> (<span class="r120 r">nodeType</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Add</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitAdd</span>(<span class="r121 r">left</span>.<span class="i">Type</span>, <b>false</b>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AddChecked</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitAdd</span>(<span class="r121 r">left</span>.<span class="i">Type</span>, <b>true</b>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Subtract</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitSub</span>(<span class="r121 r">left</span>.<span class="i">Type</span>, <b>false</b>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">SubtractChecked</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitSub</span>(<span class="r121 r">left</span>.<span class="i">Type</span>, <b>true</b>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Multiply</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitMul</span>(<span class="r121 r">left</span>.<span class="i">Type</span>, <b>false</b>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MultiplyChecked</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitMul</span>(<span class="r121 r">left</span>.<span class="i">Type</span>, <b>true</b>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Divide</span>: <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitDiv</span>(<span class="r121 r">left</span>.<span class="i">Type</span>); <b>break</b>;
                <b>default</b>: <b>throw</b> <a href="Utilities.cs.html#f760db0369027867" class="t t">Assert</a>.<a href="Utilities.cs.html#176abe9780c04116" class="i property">Unreachable</a>;
            }
        }
 
        <b>private void</b> <a id="0d1c0e8a89a609f6" href="../../R/0d1c0e8a89a609f6.html" target="n" data-glyph="76,1" class="i method">CompileConvertUnaryExpression</a>(<span class="i">Expression</span> <span id="r123 rd" class="r123 r">expr</span>)
        {
            <b>var</b> <span id="r124 rd" class="r124 r">node</span> = (<span class="i">UnaryExpression</span>)<span class="r123 r">expr</span>;
            <b>if</b> (<span class="r124 r">node</span>.<span class="i">Method</span> != <b>null</b>)
            {
                <span class="i">Compile</span>(<span class="r124 r">node</span>.<span class="i">Operand</span>);
 
                <span class="c">// We should be able to ignore Int32ToObject</span>
                <b>if</b> (<span class="r124 r">node</span>.<span class="i">Method</span> != <a href="Utilities.cs.html#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>.<a href="Utilities.cs.html#2e7ec655a00075bd" class="i field">Int32ToObjectMethod</a>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r124 r">node</span>.<span class="i">Method</span>);
                }
            }
            <b>else</b> <b>if</b> (<span class="r124 r">node</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>))
            {
                <span class="i">CompileAsVoid</span>(<span class="r124 r">node</span>.<span class="i">Operand</span>);
            }
            <b>else</b>
            {
                <span class="i">Compile</span>(<span class="r124 r">node</span>.<span class="i">Operand</span>);
                <span class="i">CompileConvertToType</span>(<span class="r124 r">node</span>.<span class="i">Operand</span>.<span class="i">Type</span>, <span class="r124 r">node</span>.<span class="i">Type</span>, <span class="r124 r">node</span>.<span class="i">NodeType</span> == <span class="i">ExpressionType</span>.<span class="i">ConvertChecked</span>);
            }
        }
 
        <b>private void</b> <a id="c3a40b2979e318e7" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompileConvertToType</a>(<span class="i">Type</span> <span id="r125 rd" class="r125 r">typeFrom</span>, <span class="i">Type</span> <span id="r126 rd" class="r126 r">typeTo</span>, <b>bool</b> <span id="r127 rd" class="r127 r">isChecked</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r125 r">typeFrom</span> != <b>typeof</b>(<b>void</b>) &amp;&amp; <span class="r126 r">typeTo</span> != <b>typeof</b>(<b>void</b>));
 
            <b>if</b> (<span class="r126 r">typeTo</span> == <span class="r125 r">typeFrom</span>)
            {
                <b>return</b>;
            }
 
            <span class="i">TypeCode</span> <span id="r128 rd" class="r128 r">from</span> = <span class="r125 r">typeFrom</span>.<a href="../../utils/ExtensionMethods.cs.html#6941492779b390f9" class="i method">GetTypeCode</a>();
            <span class="i">TypeCode</span> <span id="r129 rd" class="r129 r">to</span> = <span class="r126 r">typeTo</span>.<a href="../../utils/ExtensionMethods.cs.html#6941492779b390f9" class="i method">GetTypeCode</a>();
            <b>if</b> (<a href="Utilities.cs.html#a1766c42eb12a5ca" class="t t">TypeUtils</a>.<a href="Utilities.cs.html#3630e78b200a4853" class="i method">IsNumeric</a>(<span class="r128 r">from</span>) &amp;&amp; <a href="Utilities.cs.html#a1766c42eb12a5ca" class="t t">TypeUtils</a>.<a href="Utilities.cs.html#3630e78b200a4853" class="i method">IsNumeric</a>(<span class="r129 r">to</span>))
            {
                <b>if</b> (<span class="r127 r">isChecked</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#688f8c48b545cb73" class="i method">EmitNumericConvertChecked</a>(<span class="r128 r">from</span>, <span class="r129 r">to</span>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3698fae1d3f1deb1" class="i method">EmitNumericConvertUnchecked</a>(<span class="r128 r">from</span>, <span class="r129 r">to</span>);
                }
 
                <b>return</b>;
            }
 
            <span class="c">// TODO: Conversions to a super-class or implemented interfaces are no-op.</span>
            <span class="c">// A conversion to a non-implemented interface or an unrelated class, etc. should fail.</span>
            <b>return</b>;
        }
 
        <b>private void</b> <a id="81216f286b14bf67" href="../../R/81216f286b14bf67.html" target="n" data-glyph="76,1" class="i method">CompileNotExpression</a>(<span class="i">UnaryExpression</span> <span id="r130 rd" class="r130 r">node</span>)
        {
            <b>if</b> (<span class="r130 r">node</span>.<span class="i">Operand</span>.<span class="i">Type</span> == <b>typeof</b>(<b>bool</b>))
            {
                <span class="i">Compile</span>(<span class="r130 r">node</span>.<span class="i">Operand</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#85922bfcfe956e17" class="i method">EmitNot</a>();
            }
            <b>else</b>
            {
                <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
            }
        }
 
        <b>private void</b> <a id="f46c04fdfcea3464" href="../../R/f46c04fdfcea3464.html" target="n" data-glyph="76,1" class="i method">CompileUnaryExpression</a>(<span class="i">Expression</span> <span id="r131 rd" class="r131 r">expr</span>)
        {
            <b>var</b> <span id="r132 rd" class="r132 r">node</span> = (<span class="i">UnaryExpression</span>)<span class="r131 r">expr</span>;
 
            <b>if</b> (<span class="r132 r">node</span>.<span class="i">Method</span> != <b>null</b>)
            {
                <span class="i">Compile</span>(<span class="r132 r">node</span>.<span class="i">Operand</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r132 r">node</span>.<span class="i">Method</span>);
            }
            <b>else</b>
            {
                <b>switch</b> (<span class="r132 r">node</span>.<span class="i">NodeType</span>)
                {
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Not</span>:
                        <a href="#81216f286b14bf67" class="i method">CompileNotExpression</a>(<span class="r132 r">node</span>);
                        <b>return</b>;
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">TypeAs</span>:
                        <a href="#d9f46a580b56a022" class="i method">CompileTypeAsExpression</a>(<span class="r132 r">node</span>);
                        <b>return</b>;
                    <b>default</b>:
                        <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>(<span class="r132 r">node</span>.<span class="i">NodeType</span>.<span class="i">ToString</span>());
                }
            }
        }
 
        <b>private void</b> <a id="f50b2f46fec64935" href="../../R/f50b2f46fec64935.html" target="n" data-glyph="76,1" class="i method">CompileAndAlsoBinaryExpression</a>(<span class="i">Expression</span> <span id="r133 rd" class="r133 r">expr</span>)
        {
            <a href="#f12b67945b1383a6" class="i method">CompileLogicalBinaryExpression</a>(<span class="r133 r">expr</span>, <b>true</b>);
        }
 
        <b>private void</b> <a id="a965ac26ea15a7c3" href="../../R/a965ac26ea15a7c3.html" target="n" data-glyph="76,1" class="i method">CompileOrElseBinaryExpression</a>(<span class="i">Expression</span> <span id="r134 rd" class="r134 r">expr</span>)
        {
            <a href="#f12b67945b1383a6" class="i method">CompileLogicalBinaryExpression</a>(<span class="r134 r">expr</span>, <b>false</b>);
        }
 
        <b>private void</b> <a id="f12b67945b1383a6" href="../../R/f12b67945b1383a6.html" target="n" data-glyph="76,1" class="i method">CompileLogicalBinaryExpression</a>(<span class="i">Expression</span> <span id="r135 rd" class="r135 r">expr</span>, <b>bool</b> <span id="r136 rd" class="r136 r">andAlso</span>)
        {
            <b>var</b> <span id="r137 rd" class="r137 r">node</span> = (<span class="i">BinaryExpression</span>)<span class="r135 r">expr</span>;
            <b>if</b> (<span class="r137 r">node</span>.<span class="i">Method</span> != <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
            }
 
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r137 r">node</span>.<span class="i">Left</span>.<span class="i">Type</span> == <span class="r137 r">node</span>.<span class="i">Right</span>.<span class="i">Type</span>);
 
            <b>if</b> (<span class="r137 r">node</span>.<span class="i">Left</span>.<span class="i">Type</span> == <b>typeof</b>(<b>bool</b>))
            {
                <a href="BranchLabel.cs.html#eddd89038e02be60" class="k">var</a> <span id="r138 rd" class="r138 r">elseLabel</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
                <a href="BranchLabel.cs.html#eddd89038e02be60" class="k">var</a> <span id="r139 rd" class="r139 r">endLabel</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
                <span class="i">Compile</span>(<span class="r137 r">node</span>.<span class="i">Left</span>);
                <b>if</b> (<span class="r136 r">andAlso</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#4b5be55eb16d3e45" class="i method">EmitBranchFalse</a>(<span class="r138 r">elseLabel</span>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#481bbb8d59bb1943" class="i method">EmitBranchTrue</a>(<span class="r138 r">elseLabel</span>);
                }
 
                <span class="i">Compile</span>(<span class="r137 r">node</span>.<span class="i">Right</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#682b543c4e9ef431" class="i method">EmitBranch</a>(<span class="r139 r">endLabel</span>, <b>false</b>, <b>true</b>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r138 r">elseLabel</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLoad</span>(!<span class="r136 r">andAlso</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r139 r">endLabel</span>);
                <b>return</b>;
            }
 
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r137 r">node</span>.<span class="i">Left</span>.<span class="i">Type</span> == <b>typeof</b>(<b>bool</b>?));
            <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
        }
 
        <b>private void</b> <a id="8e6175371fde2691" href="../../R/8e6175371fde2691.html" target="n" data-glyph="76,1" class="i method">CompileConditionalExpression</a>(<span class="i">Expression</span> <span id="r140 rd" class="r140 r">expr</span>, <b>bool</b> <span id="r141 rd" class="r141 r">asVoid</span>)
        {
            <b>var</b> <span id="r142 rd" class="r142 r">node</span> = (<span class="i">ConditionalExpression</span>)<span class="r140 r">expr</span>;
            <span class="i">Compile</span>(<span class="r142 r">node</span>.<span class="i">Test</span>);
 
            <b>if</b> (<span class="r142 r">node</span>.<span class="i">IfTrue</span> == <a href="Utilities.cs.html#55b509010bbde4b3" class="t t">AstUtils</a>.<a href="Utilities.cs.html#547d86c412e6b1a1" class="i method">Empty</a>())
            {
                <a href="BranchLabel.cs.html#eddd89038e02be60" class="k">var</a> <span id="r143 rd" class="r143 r">endOfFalse</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#481bbb8d59bb1943" class="i method">EmitBranchTrue</a>(<span class="r143 r">endOfFalse</span>);
                <span class="i">Compile</span>(<span class="r142 r">node</span>.<span class="i">IfFalse</span>, <span class="r141 r">asVoid</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r143 r">endOfFalse</span>);
            }
            <b>else</b>
            {
                <a href="BranchLabel.cs.html#eddd89038e02be60" class="k">var</a> <span id="r144 rd" class="r144 r">endOfTrue</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#4b5be55eb16d3e45" class="i method">EmitBranchFalse</a>(<span class="r144 r">endOfTrue</span>);
                <span class="i">Compile</span>(<span class="r142 r">node</span>.<span class="i">IfTrue</span>, <span class="r141 r">asVoid</span>);
 
                <b>if</b> (<span class="r142 r">node</span>.<span class="i">IfFalse</span> != <a href="Utilities.cs.html#55b509010bbde4b3" class="t t">AstUtils</a>.<a href="Utilities.cs.html#547d86c412e6b1a1" class="i method">Empty</a>())
                {
                    <a href="BranchLabel.cs.html#eddd89038e02be60" class="k">var</a> <span id="r145 rd" class="r145 r">endOfFalse</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitBranch</span>(<span class="r145 r">endOfFalse</span>, <b>false</b>, !<span class="r141 r">asVoid</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r144 r">endOfTrue</span>);
                    <span class="i">Compile</span>(<span class="r142 r">node</span>.<span class="i">IfFalse</span>, <span class="r141 r">asVoid</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r145 r">endOfFalse</span>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r144 r">endOfTrue</span>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Loops
 
        <b>private static void</b> <a id="85557d3d52e4717f" href="../../R/85557d3d52e4717f.html" target="n" data-glyph="76,1" class="i method">CompileLoopExpression</a>(<span class="i">Expression</span> <span id="r146 rd" class="r146 r">expr</span>)
        {
            <span class="c">//    var node = (LoopExpression)expr;</span>
            <span class="c">//    var enterLoop = new EnterLoopInstruction(node, _locals, _compilationThreshold, _instructions.Count);</span>
            <span class="c">//</span>
            <span class="c">//    PushLabelBlock(LabelScopeKind.Statement);</span>
            <span class="c">//    LabelInfo breakLabel = DefineLabel(node.BreakLabel);</span>
            <span class="c">//    LabelInfo continueLabel = DefineLabel(node.ContinueLabel);</span>
            <span class="c">//</span>
            <span class="c">//    _instructions.MarkLabel(continueLabel.GetLabel(this));</span>
            <span class="c">//</span>
            <span class="c">//    // emit loop body:</span>
            <span class="c">//    _instructions.Emit(enterLoop);</span>
            <span class="c">//    CompileAsVoid(node.Body);</span>
            <span class="c">//</span>
            <span class="c">//    // emit loop branch:</span>
            <span class="c">//    _instructions.EmitBranch(continueLabel.GetLabel(this), expr.Type != typeof(void), false);</span>
            <span class="c">//</span>
            <span class="c">//    _instructions.MarkLabel(breakLabel.GetLabel(this));</span>
            <span class="c">//</span>
            <span class="c">//    PopLabelBlock(LabelScopeKind.Statement);</span>
            <span class="c">//</span>
            <span class="c">//    enterLoop.FinishLoop(_instructions.Count);</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>private void</b> <a id="252f0e79de0905ec" href="../../R/252f0e79de0905ec.html" target="n" data-glyph="76,1" class="i method">CompileSwitchExpression</a>(<span class="i">Expression</span> <span id="r147 rd" class="r147 r">expr</span>)
        {
            <b>var</b> <span id="r148 rd" class="r148 r">node</span> = (<span class="i">SwitchExpression</span>)<span class="r147 r">expr</span>;
 
            <span class="c">// Currently only supports int test values, with no method</span>
            <b>if</b> (<span class="r148 r">node</span>.<span class="i">SwitchValue</span>.<span class="i">Type</span> != <b>typeof</b>(<b>int</b>) || <span class="r148 r">node</span>.<span class="i">Comparison</span> != <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
            }
 
            <span class="c">// Test values must be constant</span>
            <b>if</b> (!<span class="r148 r">node</span>.<span class="i">Cases</span>.<span class="i">All</span>(<b>static</b> <span id="r149 rd" class="r149 r">c</span> =&gt; <span class="r149 r">c</span>.<span class="i">TestValues</span>.<span class="i">All</span>(<span id="r150 rd" class="r150 r">t</span> =&gt; <span class="r150 r">t</span> <b>is</b> <span class="i">ConstantExpression</span>)))
            {
                <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
            }
 
            <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <span id="r151 rd" class="r151 r">end</span> = <a href="#1aed6bd7929fa128" class="i method">DefineLabel</a>(<b>null</b>);
            <b>bool</b> <span id="r152 rd" class="r152 r">hasValue</span> = <span class="r148 r">node</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>);
 
            <span class="i">Compile</span>(<span class="r148 r">node</span>.<span class="i">SwitchValue</span>);
            <b>var</b> <span id="r153 rd" class="r153 r">caseDict</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>int</b>, <b>int</b>&gt;();
            <b>int</b> <span id="r154 rd" class="r154 r">switchIndex</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#4d14ed900b51ebc7" class="i method">EmitSwitch</a>(<span class="r153 r">caseDict</span>);
 
            <b>if</b> (<span class="r148 r">node</span>.<span class="i">DefaultBody</span> != <b>null</b>)
            {
                <span class="i">Compile</span>(<span class="r148 r">node</span>.<span class="i">DefaultBody</span>);
            }
            <b>else</b>
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(!<span class="r152 r">hasValue</span>);
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#682b543c4e9ef431" class="i method">EmitBranch</a>(<span class="r151 r">end</span>.<a href="LabelInfo.cs.html#ba81dae42fe13117" class="i method">GetLabel</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>), <b>false</b>, <span class="r152 r">hasValue</span>);
 
            <b>for</b> (<b>int</b> <span id="r155 rd" class="r155 r">i</span> = 0; <span class="r155 r">i</span> &lt; <span class="r148 r">node</span>.<span class="i">Cases</span>.<span class="i">Count</span>; <span class="r155 r">i</span>++)
            {
                <b>var</b> <span id="r156 rd" class="r156 r">switchCase</span> = <span class="r148 r">node</span>.<span class="i">Cases</span>[<span class="r155 r">i</span>];
 
                <b>int</b> <span id="r157 rd" class="r157 r">caseOffset</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a> - <span class="r154 r">switchIndex</span>;
                <b>for</b> (<b>int</b> <span id="r158 rd" class="r158 r">index</span> = 0; <span class="r158 r">index</span> &lt; <span class="r156 r">switchCase</span>.<span class="i">TestValues</span>.<span class="i">Count</span>; <span class="r158 r">index</span>++)
                {
                    <b>var</b> <span id="r159 rd" class="r159 r">testValue</span> = (<span class="i">ConstantExpression</span>)<span class="r156 r">switchCase</span>.<span class="i">TestValues</span>[<span class="r158 r">index</span>];
                    <span class="r153 r">caseDict</span>[(<b>int</b>)<span class="r159 r">testValue</span>.<span class="i">Value</span>] = <span class="r157 r">caseOffset</span>;
                }
 
                <span class="i">Compile</span>(<span class="r156 r">switchCase</span>.<span class="i">Body</span>);
 
                <b>if</b> (<span class="r155 r">i</span> &lt; <span class="r148 r">node</span>.<span class="i">Cases</span>.<span class="i">Count</span> - 1)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#682b543c4e9ef431" class="i method">EmitBranch</a>(<span class="r151 r">end</span>.<a href="LabelInfo.cs.html#ba81dae42fe13117" class="i method">GetLabel</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>), <b>false</b>, <span class="r152 r">hasValue</span>);
                }
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r151 r">end</span>.<a href="LabelInfo.cs.html#ba81dae42fe13117" class="i method">GetLabel</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>));
        }
 
        <b>private void</b> <a id="8e457e1b20121427" href="../../R/8e457e1b20121427.html" target="n" data-glyph="76,1" class="i method">CompileLabelExpression</a>(<span class="i">Expression</span> <span id="r160 rd" class="r160 r">expr</span>)
        {
            <b>var</b> <span id="r161 rd" class="r161 r">node</span> = (<span class="i">LabelExpression</span>)<span class="r160 r">expr</span>;
 
            <span class="c">// If we&#39;re an immediate child of a block, our label will already</span>
            <span class="c">// be defined. If not, we need to define our own block so this</span>
            <span class="c">// label isn&#39;t exposed except to its own child expression.</span>
            <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <span id="r162 rd" class="r162 r">label</span> = <b>null</b>;
 
            <b>if</b> (<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a> == <a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#e3203a1396c3700c" class="i field">Block</a>)
            {
                <a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<span class="i">TryGetLabelInfo</span>(<span class="r161 r">node</span>.<span class="i">Target</span>, <b>out</b> <span class="r162 r">label</span>);
 
                <span class="c">// We&#39;re in a block but didn&#39;t find our label, try switch</span>
                <b>if</b> (<span class="r162 r">label</span> == <b>null</b> &amp;&amp; <a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#ceeabc2099edfd33" class="i field">Parent</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a> == <a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#5e4d313155e731a3" class="i field">Switch</a>)
                {
                    <a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#ceeabc2099edfd33" class="i field">Parent</a>.<span class="i">TryGetLabelInfo</span>(<span class="r161 r">node</span>.<span class="i">Target</span>, <b>out</b> <span class="r162 r">label</span>);
                }
 
                <span class="c">// if we&#39;re in a switch or block, we should&#39;ve found the label</span>
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r162 r">label</span> != <b>null</b>);
            }
 
            <b>if</b> (<span class="r162 r">label</span> == <b>null</b>)
            {
                <span class="r162 r">label</span> = <span class="i">DefineLabel</span>(<span class="r161 r">node</span>.<span class="i">Target</span>);
            }
 
            <b>if</b> (<span class="r161 r">node</span>.<span class="i">DefaultValue</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r161 r">node</span>.<span class="i">Target</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>))
                {
                    <span class="i">CompileAsVoid</span>(<span class="r161 r">node</span>.<span class="i">DefaultValue</span>);
                }
                <b>else</b>
                {
                    <span class="i">Compile</span>(<span class="r161 r">node</span>.<span class="i">DefaultValue</span>);
                }
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r162 r">label</span>.<a href="LabelInfo.cs.html#ba81dae42fe13117" class="i method">GetLabel</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>));
        }
 
        <b>private void</b> <a id="51aabc01e3013ec0" href="../../R/51aabc01e3013ec0.html" target="n" data-glyph="76,1" class="i method">CompileGotoExpression</a>(<span class="i">Expression</span> <span id="r163 rd" class="r163 r">expr</span>)
        {
            <b>var</b> <span id="r164 rd" class="r164 r">node</span> = (<span class="i">GotoExpression</span>)<span class="r163 r">expr</span>;
            <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="k">var</a> <span id="r165 rd" class="r165 r">labelInfo</span> = <span class="i">ReferenceLabel</span>(<span class="r164 r">node</span>.<span class="i">Target</span>);
 
            <b>if</b> (<span class="r164 r">node</span>.<span class="i">Value</span> != <b>null</b>)
            {
                <span class="i">Compile</span>(<span class="r164 r">node</span>.<span class="i">Value</span>);
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#e87a70d9ecac8064" class="i method">EmitGoto</a>(<span class="r165 r">labelInfo</span>.<a href="LabelInfo.cs.html#ba81dae42fe13117" class="i method">GetLabel</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>), <span class="r164 r">node</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>), <span class="r164 r">node</span>.<span class="i">Value</span> != <b>null</b> &amp;&amp; <span class="r164 r">node</span>.<span class="i">Value</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>));
        }
 
        <b>public</b> <a href="BranchLabel.cs.html#eddd89038e02be60" class="t t">BranchLabel</a> <a id="1bce82bff812f7c8" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBranchLabel</a>(<span class="i">LabelTarget</span> <span id="r166 rd" class="r166 r">target</span>)
        {
            <b>return</b> <a href="#bff6eabfa1ce091a" class="i method">ReferenceLabel</a>(<span class="r166 r">target</span>).<a href="LabelInfo.cs.html#ba81dae42fe13117" class="i method">GetLabel</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>);
        }
 
        <b>public void</b> <a id="119a2de7d43af550" href="../../R/119a2de7d43af550.html" target="n" data-glyph="72,1" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a> <span id="r167 rd" class="r167 r">type</span>)
        {
            <a href="#cee41a60058bf341" class="i field">_labelBlock</a> = <b>new</b> <a href="LabelInfo.cs.html#5124520a790df828" class="t constructor">LabelScopeInfo</a>(<a href="#cee41a60058bf341" class="i field">_labelBlock</a>, <span class="r167 r">type</span>);
        }
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA1801:ReviewUnusedParameters&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;kind&quot;</span>)]
        <b>public void</b> <a id="2063b4bb64f206cb" href="../../R/2063b4bb64f206cb.html" target="n" data-glyph="72,1" class="i method">PopLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a> <span id="r168 rd" class="r168 r">kind</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#cee41a60058bf341" class="i field">_labelBlock</a> != <b>null</b> &amp;&amp; <a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a> == <span class="r168 r">kind</span>);
            <a href="#cee41a60058bf341" class="i field">_labelBlock</a> = <a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#ceeabc2099edfd33" class="i field">Parent</a>;
        }
 
        <b>private</b> <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <a id="aecb26b9c60fcb3b" href="../../R/aecb26b9c60fcb3b.html" target="n" data-glyph="76,1" class="i method">EnsureLabel</a>(<span class="i">LabelTarget</span> <span id="r169 rd" class="r169 r">node</span>)
        {
            <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <span id="r170 rd" class="r170 r">result</span>;
            <b>if</b> (!<a href="#46b88bfc787ead0e" class="i field">_treeLabels</a>.<a href="Utilities.cs.html#8c776c95f5b40495" class="i method">TryGetValue</a>(<span class="r169 r">node</span>, <b>out</b> <span class="r170 r">result</span>))
            {
                <a href="#46b88bfc787ead0e" class="i field">_treeLabels</a><a href="Utilities.cs.html#a9fed564f0d45f1a">[</a><span class="r169 r">node</span>] = <span class="r170 r">result</span> = <b>new</b> <a href="LabelInfo.cs.html#49c9573f2b96882f" class="t constructor">LabelInfo</a>(<span class="r169 r">node</span>);
            }
 
            <b>return</b> <span class="r170 r">result</span>;
        }
 
        <b>private</b> <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <a id="bff6eabfa1ce091a" href="../../R/bff6eabfa1ce091a.html" target="n" data-glyph="76,1" class="i method">ReferenceLabel</a>(<span class="i">LabelTarget</span> <span id="r171 rd" class="r171 r">node</span>)
        {
            <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <span id="r172 rd" class="r172 r">result</span> = <a href="#aecb26b9c60fcb3b" class="i method">EnsureLabel</a>(<span class="r171 r">node</span>);
            <span class="r172 r">result</span>.<a href="LabelInfo.cs.html#eab6f53b9e989902" class="i method">Reference</a>(<a href="#cee41a60058bf341" class="i field">_labelBlock</a>);
            <b>return</b> <span class="r172 r">result</span>;
        }
 
        <b>internal</b> <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <a id="1aed6bd7929fa128" href="../../R/1aed6bd7929fa128.html" target="n" data-glyph="74,1" class="i method">DefineLabel</a>(<span class="i">LabelTarget</span> <span id="r173 rd" class="r173 r">node</span>)
        {
            <b>if</b> (<span class="r173 r">node</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <a href="LabelInfo.cs.html#49c9573f2b96882f" class="t constructor">LabelInfo</a>(<b>null</b>);
            }
 
            <a href="LabelInfo.cs.html#fcef8dfd579c4054" class="t t">LabelInfo</a> <span id="r174 rd" class="r174 r">result</span> = <a href="#aecb26b9c60fcb3b" class="i method">EnsureLabel</a>(<span class="r173 r">node</span>);
            <span class="r174 r">result</span>.<a href="LabelInfo.cs.html#bea30e6ec6663635" class="i method">Define</a>(<a href="#cee41a60058bf341" class="i field">_labelBlock</a>);
            <b>return</b> <span class="r174 r">result</span>;
        }
 
        <b>private bool</b> <a id="3c9d31cdc1e8bb21" href="../../R/3c9d31cdc1e8bb21.html" target="n" data-glyph="76,1" class="i method">TryPushLabelBlock</a>(<span class="i">Expression</span> <span id="r175 rd" class="r175 r">node</span>)
        {
            <span class="c">// Anything that is &quot;statement-like&quot; -- e.g. has no associated</span>
            <span class="c">// stack state can be jumped into, with the exception of try-blocks</span>
            <span class="c">// We indicate this by a &quot;Block&quot;</span>
            <span class="c">//</span>
            <span class="c">// Otherwise, we push an &quot;Expression&quot; to indicate that it can&#39;t be</span>
            <span class="c">// jumped into</span>
            <b>switch</b> (<span class="r175 r">node</span>.<span class="i">NodeType</span>)
            {
                <b>default</b>:
                    <b>if</b> (<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a> != <a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#b08846e0533a9c5b" class="i field">Expression</a>)
                    {
                        <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#b08846e0533a9c5b" class="i field">Expression</a>);
                        <b>return</b> <b>true</b>;
                    }
 
                    <b>return</b> <b>false</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Label</span>:
                    <span class="c">// LabelExpression is a bit special, if it&#39;s directly in a</span>
                    <span class="c">// block it becomes associate with the block&#39;s scope. Same</span>
                    <span class="c">// thing if it&#39;s in a switch case body.</span>
                    <b>if</b> (<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a> == <a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#e3203a1396c3700c" class="i field">Block</a>)
                    {
                        <b>var</b> <span id="r176 rd" class="r176 r">label</span> = ((<span class="i">LabelExpression</span>)<span class="r175 r">node</span>).<span class="i">Target</span>;
                        <b>if</b> (<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<span class="i">ContainsTarget</span>(<span class="r176 r">label</span>))
                        {
                            <b>return</b> <b>false</b>;
                        }
 
                        <b>if</b> (<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#ceeabc2099edfd33" class="i field">Parent</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a> == <a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#5e4d313155e731a3" class="i field">Switch</a> &amp;&amp;
                            <a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#ceeabc2099edfd33" class="i field">Parent</a>.<span class="i">ContainsTarget</span>(<span class="r176 r">label</span>))
                        {
                            <b>return</b> <b>false</b>;
                        }
                    }
 
                    <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#e28f597c40679df5" class="i field">Statement</a>);
                    <b>return</b> <b>true</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Block</span>:
                    <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#e3203a1396c3700c" class="i field">Block</a>);
                    <span class="c">// Labels defined immediately in the block are valid for</span>
                    <span class="c">// the whole block.</span>
                    <b>if</b> (<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#ceeabc2099edfd33" class="i field">Parent</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a> != <a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#5e4d313155e731a3" class="i field">Switch</a>)
                    {
                        <a href="#c97de794f2f435e0" class="i method">DefineBlockLabels</a>(<span class="r175 r">node</span>);
                    }
 
                    <b>return</b> <b>true</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Switch</span>:
                    <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#5e4d313155e731a3" class="i field">Switch</a>);
                    <span class="c">// Define labels inside of the switch cases so they are in</span>
                    <span class="c">// scope for the whole switch. This allows &quot;goto case&quot; and</span>
                    <span class="c">// &quot;goto default&quot; to be considered as local jumps.</span>
                    <b>var</b> <span id="r177 rd" class="r177 r">@switch</span> = (<span class="i">SwitchExpression</span>)<span class="r175 r">node</span>;
                    <b>for</b> (<b>int</b> <span id="r178 rd" class="r178 r">index</span> = 0; <span class="r178 r">index</span> &lt; <span class="r177 r">@switch</span>.<span class="i">Cases</span>.<span class="i">Count</span>; <span class="r178 r">index</span>++)
                    {
                        <span class="i">SwitchCase</span> <span id="r179 rd" class="r179 r">c</span> = <span class="r177 r">@switch</span>.<span class="i">Cases</span>[<span class="r178 r">index</span>];
                        <span class="i">DefineBlockLabels</span>(<span class="r179 r">c</span>.<span class="i">Body</span>);
                    }
 
                    <span class="i">DefineBlockLabels</span>(<span class="r177 r">@switch</span>.<span class="i">DefaultBody</span>);
                    <b>return</b> <b>true</b>;
 
                <span class="c">// Remove this when Convert(Void) goes away.</span>
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Convert</span>:
                    <b>if</b> (<span class="r175 r">node</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>))
                    {
                        <span class="c">// treat it as an expression</span>
                        <b>goto</b> <b>default</b>;
                    }
 
                    <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#e28f597c40679df5" class="i field">Statement</a>);
                    <b>return</b> <b>true</b>;
 
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Conditional</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Loop</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Goto</span>:
                    <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#e28f597c40679df5" class="i field">Statement</a>);
                    <b>return</b> <b>true</b>;
            }
        }
 
        <b>private void</b> <a id="c97de794f2f435e0" href="../../R/c97de794f2f435e0.html" target="n" data-glyph="76,1" class="i method">DefineBlockLabels</a>(<span class="i">Expression</span> <span id="r180 rd" class="r180 r">node</span>)
        {
            <b>if</b> (!(<span class="r180 r">node</span> <b>is</b> <span class="i">BlockExpression</span> <span id="r181 rd" class="r181 r">block</span>))
            {
                <b>return</b>;
            }
 
            <b>for</b> (<b>int</b> <span id="r182 rd" class="r182 r">i</span> = 0, <span id="r183 rd" class="r183 r">n</span> = <span class="r181 r">block</span>.<span class="i">Expressions</span>.<span class="i">Count</span>; <span class="r182 r">i</span> &lt; <span class="r183 r">n</span>; <span class="r182 r">i</span>++)
            {
                <span class="i">Expression</span> <span id="r184 rd" class="r184 r">e</span> = <span class="r181 r">block</span>.<span class="i">Expressions</span>[<span class="r182 r">i</span>];
 
                <b>var</b> <span id="r185 rd" class="r185 r">label</span> = <span class="r184 r">e</span> <b>as</b> <span class="i">LabelExpression</span>;
                <b>if</b> (<span class="r185 r">label</span> != <b>null</b>)
                {
                    <span class="i">DefineLabel</span>(<span class="r185 r">label</span>.<span class="i">Target</span>);
                }
            }
        }
 
        <b>private</b> <a href="Utilities.cs.html#600f1e648b51e109" class="t t">HybridReferenceDictionary</a>&lt;<span class="i">LabelTarget</span>, <a href="BranchLabel.cs.html#eddd89038e02be60" class="t t">BranchLabel</a>&gt; <a id="a5332099918141bf" href="../../R/a5332099918141bf.html" target="n" data-glyph="76,1" class="i method">GetBranchMapping</a>()
        {
            <a href="Utilities.cs.html#600f1e648b51e109" class="k">var</a> <span id="r186 rd" class="r186 r">newLabelMapping</span> = <b>new</b> <a href="Utilities.cs.html#b3178f7daffdb4a8" class="t constructor">HybridReferenceDictionary</a>&lt;<span class="i">LabelTarget</span>, <a href="BranchLabel.cs.html#eddd89038e02be60" class="t t">BranchLabel</a>&gt;(<a href="#46b88bfc787ead0e" class="i field">_treeLabels</a>.<a href="Utilities.cs.html#844d9959f4061846" class="i property">Count</a>);
            <b>foreach</b> (<b>var</b> <span id="r187 rd" class="r187 r">kvp</span> <b>in</b> <a href="#46b88bfc787ead0e" class="i field">_treeLabels</a>)
            {
                <span class="r186 r">newLabelMapping</span>[<span class="r187 r">kvp</span>.<span class="i">Key</span>] = <span class="r187 r">kvp</span>.<span class="i">Value</span>.<span class="i">GetLabel</span>(<a href="#bee3a40ad9cb3a51" class="k">this</a>);
            }
 
            <b>return</b> <span class="r186 r">newLabelMapping</span>;
        }
 
        <b>private void</b> <a id="326ccf23d6fb4cd4" href="../../R/326ccf23d6fb4cd4.html" target="n" data-glyph="76,1" class="i method">CompileThrowUnaryExpression</a>(<span class="i">Expression</span> <span id="r188 rd" class="r188 r">expr</span>, <b>bool</b> <span id="r189 rd" class="r189 r">asVoid</span>)
        {
            <b>var</b> <span id="r190 rd" class="r190 r">node</span> = (<span class="i">UnaryExpression</span>)<span class="r188 r">expr</span>;
 
            <b>if</b> (<span class="r190 r">node</span>.<span class="i">Operand</span> == <b>null</b>)
            {
                <span class="i">CompileParameterExpression</span>(<a href="#213ce064becf4d8d" class="i field">_exceptionForRethrowStack</a>.<span class="i">Peek</span>());
                <b>if</b> (<span class="r189 r">asVoid</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#a8c3af02f92ab6a9" class="i method">EmitRethrowVoid</a>();
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#00f1773095eb2ccc" class="i method">EmitRethrow</a>();
                }
            }
            <b>else</b>
            {
                <span class="i">Compile</span>(<span class="r190 r">node</span>.<span class="i">Operand</span>);
                <b>if</b> (<span class="r189 r">asVoid</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#156c43b268d77ffe" class="i method">EmitThrowVoid</a>();
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#297a10eb7aa1bfc4" class="i method">EmitThrow</a>();
                }
            }
        }
 
        <span class="c">// TODO: remove (replace by true fault support)</span>
        <b>private bool</b> <a id="8253e76412c75581" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">EndsWithRethrow</a>(<span class="i">Expression</span> <span id="r191 rd" class="r191 r">expr</span>)
        {
            <b>if</b> (<span class="r191 r">expr</span>.<span class="i">NodeType</span> == <span class="i">ExpressionType</span>.<span class="i">Throw</span>)
            {
                <b>var</b> <span id="r192 rd" class="r192 r">node</span> = (<span class="i">UnaryExpression</span>)<span class="r191 r">expr</span>;
                <b>return</b> <span class="r192 r">node</span>.<span class="i">Operand</span> == <b>null</b>;
            }
 
            <span class="i">BlockExpression</span> <span id="r193 rd" class="r193 r">block</span> = <span class="r191 r">expr</span> <b>as</b> <span class="i">BlockExpression</span>;
            <b>if</b> (<span class="r193 r">block</span> != <b>null</b>)
            {
                <b>return</b> <span class="i">EndsWithRethrow</span>(<span class="r193 r">block</span>.<span class="i">Expressions</span>[<span class="r193 r">block</span>.<span class="i">Expressions</span>.<span class="i">Count</span> - 1]);
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">// TODO: remove (replace by true fault support)</span>
        <b>private void</b> <a id="764cb4458d56ef06" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompileAsVoidRemoveRethrow</a>(<span class="i">Expression</span> <span id="r194 rd" class="r194 r">expr</span>)
        {
            <b>int</b> <span id="r195 rd" class="r195 r">stackDepth</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#5a7bf73ebd74b3ab" class="i property">CurrentStackDepth</a>;
 
            <b>if</b> (<span class="r194 r">expr</span>.<span class="i">NodeType</span> == <span class="i">ExpressionType</span>.<span class="i">Throw</span>)
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(((<span class="i">UnaryExpression</span>)<span class="r194 r">expr</span>).<span class="i">Operand</span> == <b>null</b>);
                <b>return</b>;
            }
 
            <b>var</b> <span id="r196 rd" class="r196 r">node</span> = (<span class="i">BlockExpression</span>)<span class="r194 r">expr</span>;
            <b>var</b> <span id="r197 rd" class="r197 r">end</span> = <a href="#b9e9a9f5d9b7e4fd" class="i method">CompileBlockStart</a>(<span class="r196 r">node</span>);
 
            <span class="i">CompileAsVoidRemoveRethrow</span>(<span class="r196 r">node</span>.<span class="i">Expressions</span>[<span class="r196 r">node</span>.<span class="i">Expressions</span>.<span class="i">Count</span> - 1]);
 
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r195 r">stackDepth</span> == <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#5a7bf73ebd74b3ab" class="i property">CurrentStackDepth</a>);
 
            <a href="#eac2ed39d61dd2e8" class="i method">CompileBlockEnd</a>(<span class="r197 r">end</span>);
        }
 
        <b>private void</b> <a id="164be802588aff2b" href="../../R/164be802588aff2b.html" target="n" data-glyph="76,1" class="i method">CompileTryExpression</a>(<span class="i">Expression</span> <span id="r198 rd" class="r198 r">expr</span>)
        {
            <b>var</b> <span id="r199 rd" class="r199 r">node</span> = (<span class="i">TryExpression</span>)<span class="r198 r">expr</span>;
 
            <a href="BranchLabel.cs.html#eddd89038e02be60" class="t t">BranchLabel</a> <span id="r200 rd" class="r200 r">end</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
            <a href="BranchLabel.cs.html#eddd89038e02be60" class="t t">BranchLabel</a> <span id="r201 rd" class="r201 r">gotoEnd</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
            <b>int</b> <span id="r202 rd" class="r202 r">tryStart</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
 
            <a href="BranchLabel.cs.html#eddd89038e02be60" class="t t">BranchLabel</a> <span id="r203 rd" class="r203 r">startOfFinally</span> = <b>null</b>;
            <b>if</b> (<span class="r199 r">node</span>.<span class="i">Finally</span> != <b>null</b>)
            {
                <span class="r203 r">startOfFinally</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#0aaabb70f022313a" class="i method">EmitEnterTryFinally</a>(<span class="r203 r">startOfFinally</span>);
            }
            <b>else</b>
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#a95a393807cbc929" class="i method">EmitEnterTryCatch</a>();
            }
 
            <span class="i">List</span>&lt;<a href="#b49e26e8d9415c16" class="t t">ExceptionHandler</a>&gt; <span id="r204 rd" class="r204 r">exHandlers</span> = <b>null</b>;
            <a href="ControlFlowInstructions.cs.html#e5d12002e6785f15" class="k">var</a> <span id="r205 rd" class="r205 r">enterTryInstr</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#69d39e2223b89ce6" class="i method">GetInstruction</a>(<span class="r202 r">tryStart</span>) <b>as</b> <a href="ControlFlowInstructions.cs.html#e5d12002e6785f15" class="t t">EnterTryCatchFinallyInstruction</a>;
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r205 r">enterTryInstr</span> != <b>null</b>);
 
            <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#4a9857466b6f6ed4" class="i field">Try</a>);
            <span class="i">Compile</span>(<span class="r199 r">node</span>.<span class="i">Body</span>);
 
            <b>bool</b> <span id="r206 rd" class="r206 r">hasValue</span> = <span class="r199 r">node</span>.<span class="i">Body</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>);
            <b>int</b> <span id="r207 rd" class="r207 r">tryEnd</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
 
            <span class="c">// handlers jump here:</span>
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r201 r">gotoEnd</span>);
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#e87a70d9ecac8064" class="i method">EmitGoto</a>(<span class="r200 r">end</span>, <span class="r206 r">hasValue</span>, <span class="r206 r">hasValue</span>);
 
            <span class="c">// keep the result on the stack:</span>
            <b>if</b> (<span class="r199 r">node</span>.<span class="i">Handlers</span>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r204 r">exHandlers</span> = <b>new</b> <span class="i">List</span>&lt;<a href="#b49e26e8d9415c16" class="t t">ExceptionHandler</a>&gt;();
 
                <span class="c">// TODO: emulates faults (replace by true fault support)</span>
                <b>if</b> (<span class="r199 r">node</span>.<span class="i">Finally</span> == <b>null</b> &amp;&amp; <span class="r199 r">node</span>.<span class="i">Handlers</span>.<span class="i">Count</span> == 1)
                {
                    <b>var</b> <span id="r208 rd" class="r208 r">handler</span> = <span class="r199 r">node</span>.<span class="i">Handlers</span>[0];
                    <b>if</b> (<span class="r208 r">handler</span>.<span class="i">Filter</span> == <b>null</b> &amp;&amp; <span class="r208 r">handler</span>.<span class="i">Test</span> == <b>typeof</b>(<span class="i">Exception</span>) &amp;&amp; <span class="r208 r">handler</span>.<span class="i">Variable</span> == <b>null</b>)
                    {
                        <b>if</b> (<span class="i">EndsWithRethrow</span>(<span class="r208 r">handler</span>.<span class="i">Body</span>))
                        {
                            <b>if</b> (<span class="r206 r">hasValue</span>)
                            {
                                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#a40c81bdfde31b67" class="i method">EmitEnterExceptionHandlerNonVoid</a>();
                            }
                            <b>else</b>
                            {
                                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#514ecf48617a3d61" class="i method">EmitEnterExceptionHandlerVoid</a>();
                            }
 
                            <span class="c">// at this point the stack balance is prepared for the hidden exception variable:</span>
                            <b>int</b> <span id="r209 rd" class="r209 r">handlerLabel</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#58b529360edc4dbd" class="i method">MarkRuntimeLabel</a>();
                            <b>int</b> <span id="r210 rd" class="r210 r">handlerStart</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
 
                            <span class="i">CompileAsVoidRemoveRethrow</span>(<span class="r208 r">handler</span>.<span class="i">Body</span>);
                            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#e0d9036649d3d12f" class="i method">EmitLeaveFault</a>(<span class="r206 r">hasValue</span>);
                            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r200 r">end</span>);
 
                            <span class="r204 r">exHandlers</span>.<span class="i">Add</span>(<b>new</b> <a href="#12c83cf0d774e22c" class="t constructor">ExceptionHandler</a>(<span class="r202 r">tryStart</span>, <span class="r207 r">tryEnd</span>, <span class="r209 r">handlerLabel</span>, <span class="r210 r">handlerStart</span>, <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>, <b>null</b>));
                            <span class="r205 r">enterTryInstr</span>.<a href="ControlFlowInstructions.cs.html#bfd444615dcd7e78" class="i method">SetTryHandler</a>(<b>new</b> <span class="t">TryCatchFinallyHandler</span>(<span class="r202 r">tryStart</span>, <span class="r207 r">tryEnd</span>, <span class="r201 r">gotoEnd</span>.<a href="BranchLabel.cs.html#3587d6433fd71b3e" class="i property">TargetIndex</a>, <span class="r204 r">exHandlers</span>.<span class="i">ToArray</span>()));
                            <a href="#2063b4bb64f206cb" class="i method">PopLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#4a9857466b6f6ed4" class="i field">Try</a>);
                            <b>return</b>;
                        }
                    }
                }
 
                <b>for</b> (<b>int</b> <span id="r211 rd" class="r211 r">index</span> = 0; <span class="r211 r">index</span> &lt; <span class="r199 r">node</span>.<span class="i">Handlers</span>.<span class="i">Count</span>; <span class="r211 r">index</span>++)
                {
                    <b>var</b> <span id="r212 rd" class="r212 r">handler</span> = <span class="r199 r">node</span>.<span class="i">Handlers</span>[<span class="r211 r">index</span>];
                    <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#eeeeeb64a252da43" class="i field">Catch</a>);
 
                    <b>if</b> (<span class="r212 r">handler</span>.<span class="i">Filter</span> != <b>null</b>)
                    {
                        <span class="c">// PushLabelBlock(LabelScopeKind.Filter);</span>
                        <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
                        <span class="c">// PopLabelBlock(LabelScopeKind.Filter);</span>
                    }
 
                    <b>var</b> <span id="r213 rd" class="r213 r">parameter</span> = <span class="r212 r">handler</span>.<span class="i">Variable</span> ?? <span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r212 r">handler</span>.<span class="i">Test</span>);
 
                    <a href="LocalVariables.cs.html#074adbe42b842625" class="k">var</a> <span id="r214 rd" class="r214 r">local</span> = <a href="#7a9deb329886455f" class="i field">_locals</a>.<span class="i">DefineLocal</span>(<span class="r213 r">parameter</span>, <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>);
                    <a href="#213ce064becf4d8d" class="i field">_exceptionForRethrowStack</a>.<span class="i">Push</span>(<span class="r213 r">parameter</span>);
 
                    <span class="c">// add a stack balancing nop instruction (exception handling pushes the current exception):</span>
                    <b>if</b> (<span class="r206 r">hasValue</span>)
                    {
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#a40c81bdfde31b67" class="i method">EmitEnterExceptionHandlerNonVoid</a>();
                    }
                    <b>else</b>
                    {
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#514ecf48617a3d61" class="i method">EmitEnterExceptionHandlerVoid</a>();
                    }
 
                    <span class="c">// at this point the stack balance is prepared for the hidden exception variable:</span>
                    <b>int</b> <span id="r215 rd" class="r215 r">handlerLabel</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#58b529360edc4dbd" class="i method">MarkRuntimeLabel</a>();
                    <b>int</b> <span id="r216 rd" class="r216 r">handlerStart</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
 
                    <span class="i">CompileSetVariable</span>(<span class="r213 r">parameter</span>, <b>true</b>);
                    <span class="i">Compile</span>(<span class="r212 r">handler</span>.<span class="i">Body</span>);
 
                    <a href="#213ce064becf4d8d" class="i field">_exceptionForRethrowStack</a>.<span class="i">Pop</span>();
 
                    <span class="c">// keep the value of the body on the stack:</span>
                    <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r206 r">hasValue</span> == (<span class="r212 r">handler</span>.<span class="i">Body</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>)));
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#b04a7c7c2677e560" class="i method">EmitLeaveExceptionHandler</a>(<span class="r206 r">hasValue</span>, <span class="r201 r">gotoEnd</span>);
 
                    <span class="r204 r">exHandlers</span>.<span class="i">Add</span>(<b>new</b> <span class="t">ExceptionHandler</span>(<span class="r202 r">tryStart</span>, <span class="r207 r">tryEnd</span>, <span class="r215 r">handlerLabel</span>, <span class="r216 r">handlerStart</span>,
                                                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>, <span class="r212 r">handler</span>.<span class="i">Test</span>));
                    <a href="#2063b4bb64f206cb" class="i method">PopLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#eeeeeb64a252da43" class="i field">Catch</a>);
 
                    <a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#3f225e644a9f0520" class="i method">UndefineLocal</a>(<span class="r214 r">local</span>, <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>);
                }
 
                <b>if</b> (<span class="r199 r">node</span>.<span class="i">Fault</span> != <b>null</b>)
                {
                    <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
                }
            }
 
            <b>if</b> (<span class="r199 r">node</span>.<span class="i">Finally</span> != <b>null</b>)
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r203 r">startOfFinally</span> != <b>null</b>);
                <a href="#119a2de7d43af550" class="i method">PushLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#657d85042f0c6d9d" class="i field">Finally</a>);
 
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r203 r">startOfFinally</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#cb43f1cc718ba8cd" class="i method">EmitEnterFinally</a>(<span class="r203 r">startOfFinally</span>);
                <span class="i">CompileAsVoid</span>(<span class="r199 r">node</span>.<span class="i">Finally</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#8d95c0b0b327fd20" class="i method">EmitLeaveFinally</a>();
 
                <span class="r205 r">enterTryInstr</span>.<a href="ControlFlowInstructions.cs.html#bfd444615dcd7e78" class="i method">SetTryHandler</a>(
                    <b>new</b> <span class="t">TryCatchFinallyHandler</span>(<span class="r202 r">tryStart</span>, <span class="r207 r">tryEnd</span>, <span class="r201 r">gotoEnd</span>.<a href="BranchLabel.cs.html#3587d6433fd71b3e" class="i property">TargetIndex</a>,
                        <span class="r203 r">startOfFinally</span>.<a href="BranchLabel.cs.html#3587d6433fd71b3e" class="i property">TargetIndex</a>, <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>,
                        <span class="r204 r">exHandlers</span>?.<span class="i">ToArray</span>()));
                <a href="#2063b4bb64f206cb" class="i method">PopLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#657d85042f0c6d9d" class="i field">Finally</a>);
            }
            <b>else</b>
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r204 r">exHandlers</span> != <b>null</b>);
                <span class="r205 r">enterTryInstr</span>.<a href="ControlFlowInstructions.cs.html#bfd444615dcd7e78" class="i method">SetTryHandler</a>(
                    <b>new</b> <span class="t">TryCatchFinallyHandler</span>(<span class="r202 r">tryStart</span>, <span class="r207 r">tryEnd</span>, <span class="r201 r">gotoEnd</span>.<a href="BranchLabel.cs.html#3587d6433fd71b3e" class="i property">TargetIndex</a>, <span class="r204 r">exHandlers</span>.<span class="i">ToArray</span>()));
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r200 r">end</span>);
 
            <a href="#2063b4bb64f206cb" class="i method">PopLabelBlock</a>(<a href="LabelInfo.cs.html#afb555aa7e7afb57" class="t t">LabelScopeKind</a>.<a href="LabelInfo.cs.html#4a9857466b6f6ed4" class="i field">Try</a>);
        }
 
        <b>private void</b> <a id="dcc2f56da546515b" href="../../R/dcc2f56da546515b.html" target="n" data-glyph="76,1" class="i method">CompileDynamicExpression</a>(<span class="i">Expression</span> <span id="r217 rd" class="r217 r">expr</span>)
        {
            <b>var</b> <span id="r218 rd" class="r218 r">node</span> = (<span class="i">DynamicExpression</span>)<span class="r217 r">expr</span>;
 
            <b>for</b> (<b>int</b> <span id="r219 rd" class="r219 r">index</span> = 0; <span class="r219 r">index</span> &lt; <span class="r218 r">node</span>.<span class="i">Arguments</span>.<span class="i">Count</span>; <span class="r219 r">index</span>++)
            {
                <b>var</b> <span id="r220 rd" class="r220 r">arg</span> = <span class="r218 r">node</span>.<span class="i">Arguments</span>[<span class="r219 r">index</span>];
                <span class="i">Compile</span>(<span class="r220 r">arg</span>);
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitDynamic</span>(<span class="r218 r">node</span>.<span class="i">DelegateType</span>, <span class="r218 r">node</span>.<span class="i">Binder</span>);
        }
 
        <b>private void</b> <a id="682cb433551111c1" href="../../R/682cb433551111c1.html" target="n" data-glyph="76,1" class="i method">CompileMethodCallExpression</a>(<span class="i">Expression</span> <span id="r221 rd" class="r221 r">expr</span>)
        {
            <b>var</b> <span id="r222 rd" class="r222 r">node</span> = (<span class="i">MethodCallExpression</span>)<span class="r221 r">expr</span>;
 
            <b>var</b> <span id="r223 rd" class="r223 r">parameters</span> = <span class="r222 r">node</span>.<span class="i">Method</span>.<span class="i">GetParameters</span>();
 
            <span class="c">// TODO:</span>
            <span class="c">// Support pass by reference.</span>
            <span class="c">// Note that LoopCompiler needs to be updated too.</span>
 
            <span class="c">// force compilation for now for ref types</span>
            <span class="c">// also could be a mutable value type, Delegate.CreateDelegate and MethodInfo.Invoke both can&#39;t handle this, we</span>
            <span class="c">// need to generate code.</span>
            <b>var</b> <span id="r224 rd" class="r224 r">declaringType</span> = <span class="r222 r">node</span>.<span class="i">Method</span>.<span class="i">DeclaringType</span>;
            <b>if</b> (!<span class="r223 r">parameters</span>.<span class="i">TrueForAll</span>(<b>static</b> <span id="r225 rd" class="r225 r">p</span> =&gt; !<span class="r225 r">p</span>.<span class="i">ParameterType</span>.<span class="i">IsByRef</span>) ||
                (!<span class="r222 r">node</span>.<span class="i">Method</span>.<span class="i">IsStatic</span> &amp;&amp; <span class="r224 r">declaringType</span>.<span class="i">IsValueType</span> &amp;&amp; !<span class="r224 r">declaringType</span>.<span class="i">IsPrimitive</span>))
            {
                <a href="#668e5f6fceeb042f" class="i field">_forceCompile</a> = <b>true</b>;
            }
 
            <b>if</b> (!<span class="r222 r">node</span>.<span class="i">Method</span>.<span class="i">IsStatic</span>)
            {
                <span class="i">Compile</span>(<span class="r222 r">node</span>.<span class="i">Object</span>);
            }
 
            <b>for</b> (<b>int</b> <span id="r226 rd" class="r226 r">index</span> = 0; <span class="r226 r">index</span> &lt; <span class="r222 r">node</span>.<span class="i">Arguments</span>.<span class="i">Count</span>; <span class="r226 r">index</span>++)
            {
                <b>var</b> <span id="r227 rd" class="r227 r">arg</span> = <span class="r222 r">node</span>.<span class="i">Arguments</span>[<span class="r226 r">index</span>];
                <span class="i">Compile</span>(<span class="r227 r">arg</span>);
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r222 r">node</span>.<span class="i">Method</span>, <span class="r223 r">parameters</span>);
        }
 
        <b>private void</b> <a id="690b217a225d5f32" href="../../R/690b217a225d5f32.html" target="n" data-glyph="76,1" class="i method">CompileNewExpression</a>(<span class="i">Expression</span> <span id="r228 rd" class="r228 r">expr</span>)
        {
            <b>var</b> <span id="r229 rd" class="r229 r">node</span> = (<span class="i">NewExpression</span>)<span class="r228 r">expr</span>;
 
            <b>if</b> (<span class="r229 r">node</span>.<span class="i">Constructor</span> != <b>null</b>)
            {
                <b>var</b> <span id="r230 rd" class="r230 r">parameters</span> = <span class="r229 r">node</span>.<span class="i">Constructor</span>.<span class="i">GetParameters</span>();
                <b>if</b> (!<span class="r230 r">parameters</span>.<span class="i">TrueForAll</span>(<b>static</b> <span id="r231 rd" class="r231 r">p</span> =&gt; !<span class="r231 r">p</span>.<span class="i">ParameterType</span>.<span class="i">IsByRef</span>))
                {
                    <a href="#668e5f6fceeb042f" class="i field">_forceCompile</a> = <b>true</b>;
                }
            }
 
            <b>if</b> (<span class="r229 r">node</span>.<span class="i">Constructor</span> != <b>null</b>)
            {
                <b>for</b> (<b>int</b> <span id="r232 rd" class="r232 r">index</span> = 0; <span class="r232 r">index</span> &lt; <span class="r229 r">node</span>.<span class="i">Arguments</span>.<span class="i">Count</span>; <span class="r232 r">index</span>++)
                {
                    <b>var</b> <span id="r233 rd" class="r233 r">arg</span> = <span class="r229 r">node</span>.<span class="i">Arguments</span>[<span class="r232 r">index</span>];
                    <a href="#bee3a40ad9cb3a51" class="k">this</a>.<span class="i">Compile</span>(<span class="r233 r">arg</span>);
                }
 
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitNew</span>(<span class="r229 r">node</span>.<span class="i">Constructor</span>);
            }
            <b>else</b>
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r228 r">expr</span>.<span class="i">Type</span>.<span class="i">IsValueType</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitDefaultValue</span>(<span class="r229 r">node</span>.<span class="i">Type</span>);
            }
        }
 
        <b>private void</b> <a id="6b2f758efdabadad" href="../../R/6b2f758efdabadad.html" target="n" data-glyph="76,1" class="i method">CompileMemberExpression</a>(<span class="i">Expression</span> <span id="r234 rd" class="r234 r">expr</span>)
        {
            <b>var</b> <span id="r235 rd" class="r235 r">node</span> = (<span class="i">MemberExpression</span>)<span class="r234 r">expr</span>;
 
            <b>var</b> <span id="r236 rd" class="r236 r">member</span> = <span class="r235 r">node</span>.<span class="i">Member</span>;
            <span class="i">FieldInfo</span> <span id="r237 rd" class="r237 r">fi</span> = <span class="r236 r">member</span> <b>as</b> <span class="i">FieldInfo</span>;
            <b>if</b> (<span class="r237 r">fi</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r237 r">fi</span>.<span class="i">IsLiteral</span>)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLoad</span>(<span class="r237 r">fi</span>.<span class="i">GetValue</span>(<b>null</b>), <span class="r237 r">fi</span>.<span class="i">FieldType</span>);
                }
                <b>else</b> <b>if</b> (<span class="r237 r">fi</span>.<span class="i">IsStatic</span>)
                {
                    <b>if</b> (<span class="r237 r">fi</span>.<span class="i">IsInitOnly</span>)
                    {
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLoad</span>(<span class="r237 r">fi</span>.<span class="i">GetValue</span>(<b>null</b>), <span class="r237 r">fi</span>.<span class="i">FieldType</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#9b791d083dfbfd0c" class="i method">EmitLoadField</a>(<span class="r237 r">fi</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="i">Compile</span>(<span class="r235 r">node</span>.<span class="i">Expression</span>);
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#9b791d083dfbfd0c" class="i method">EmitLoadField</a>(<span class="r237 r">fi</span>);
                }
 
                <b>return</b>;
            }
 
            <span class="i">PropertyInfo</span> <span id="r238 rd" class="r238 r">pi</span> = <span class="r236 r">member</span> <b>as</b> <span class="i">PropertyInfo</span>;
            <b>if</b> (<span class="r238 r">pi</span> != <b>null</b>)
            {
                <b>var</b> <span id="r239 rd" class="r239 r">method</span> = <span class="r238 r">pi</span>.<span class="i">GetMethod</span>;
                <b>if</b> (<span class="r235 r">node</span>.<span class="i">Expression</span> != <b>null</b>)
                {
                    <span class="i">Compile</span>(<span class="r235 r">node</span>.<span class="i">Expression</span>);
                }
 
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitCall</span>(<span class="r239 r">method</span>);
                <b>return</b>;
            }
 
            <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
        }
 
        <b>private void</b> <a id="e146ea6477dc2ce7" href="../../R/e146ea6477dc2ce7.html" target="n" data-glyph="76,1" class="i method">CompileNewArrayExpression</a>(<span class="i">Expression</span> <span id="r240 rd" class="r240 r">expr</span>)
        {
            <b>var</b> <span id="r241 rd" class="r241 r">node</span> = (<span class="i">NewArrayExpression</span>)<span class="r240 r">expr</span>;
 
            <b>for</b> (<b>int</b> <span id="r242 rd" class="r242 r">index</span> = 0; <span class="r242 r">index</span> &lt; <span class="r241 r">node</span>.<span class="i">Expressions</span>.<span class="i">Count</span>; <span class="r242 r">index</span>++)
            {
                <b>var</b> <span id="r243 rd" class="r243 r">arg</span> = <span class="r241 r">node</span>.<span class="i">Expressions</span>[<span class="r242 r">index</span>];
                <span class="i">Compile</span>(<span class="r243 r">arg</span>);
            }
 
            <span class="i">Type</span> <span id="r244 rd" class="r244 r">elementType</span> = <span class="r241 r">node</span>.<span class="i">Type</span>.<span class="i">GetElementType</span>();
            <b>int</b> <span id="r245 rd" class="r245 r">rank</span> = <span class="r241 r">node</span>.<span class="i">Expressions</span>.<span class="i">Count</span>;
 
            <b>if</b> (<span class="r241 r">node</span>.<span class="i">NodeType</span> == <span class="i">ExpressionType</span>.<span class="i">NewArrayInit</span>)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#b0c67f8b30d0ad09" class="i method">EmitNewArrayInit</a>(<span class="r244 r">elementType</span>, <span class="r245 r">rank</span>);
            }
            <b>else</b> <b>if</b> (<span class="r241 r">node</span>.<span class="i">NodeType</span> == <span class="i">ExpressionType</span>.<span class="i">NewArrayBounds</span>)
            {
                <b>if</b> (<span class="r245 r">rank</span> == 1)
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#a327a1c2aad082e1" class="i method">EmitNewArray</a>(<span class="r244 r">elementType</span>);
                }
                <b>else</b>
                {
                    <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#06896b6750090f0d" class="i method">EmitNewArrayBounds</a>(<span class="r244 r">elementType</span>, <span class="r245 r">rank</span>);
                }
            }
            <b>else</b>
            {
                <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
            }
        }
 
        <b>private void</b> <a id="8f3f72dae3a74bb4" href="../../R/8f3f72dae3a74bb4.html" target="n" data-glyph="76,1" class="i method">CompileExtensionExpression</a>(<span class="i">Expression</span> <span id="r246 rd" class="r246 r">expr</span>)
        {
            <a href="Instruction.cs.html#44a3c60caeaca4e2" class="k">var</a> <span id="r247 rd" class="r247 r">instructionProvider</span> = <span class="r246 r">expr</span> <b>as</b> <a href="Instruction.cs.html#44a3c60caeaca4e2" class="t t">IInstructionProvider</a>;
            <b>if</b> (<span class="r247 r">instructionProvider</span> != <b>null</b>)
            {
                <span class="r247 r">instructionProvider</span>.<a href="Instruction.cs.html#96f855dc2097006e" class="i method">AddInstructions</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>);
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r246 r">expr</span>.<span class="i">CanReduce</span>)
            {
                <span class="i">Compile</span>(<span class="r246 r">expr</span>.<span class="i">Reduce</span>());
            }
            <b>else</b>
            {
                <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
            }
        }
 
        <b>private void</b> <a id="8f5cedbbf562f033" href="../../R/8f5cedbbf562f033.html" target="n" data-glyph="76,1" class="i method">CompileDebugInfoExpression</a>(<span class="i">Expression</span> <span id="r248 rd" class="r248 r">expr</span>)
        {
            <b>var</b> <span id="r249 rd" class="r249 r">node</span> = (<span class="i">DebugInfoExpression</span>)<span class="r248 r">expr</span>;
            <b>int</b> <span id="r250 rd" class="r250 r">start</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#24931d1c75ab071c" class="i property">Count</a>;
            <a href="#5695502ad1c2684d" class="k">var</a> <span id="r251 rd" class="r251 r">info</span> = <b>new</b> <span class="t">DebugInfo</span>()
            {
                <a href="#43e5259100cf9592" class="i field">Index</a> = <span class="r250 r">start</span>,
                <a href="#4f63b210cbc8a808" class="i field">FileName</a> = <span class="r249 r">node</span>.<span class="i">Document</span>.<span class="i">FileName</span>,
                <a href="#796fb347f24a2794" class="i field">StartLine</a> = <span class="r249 r">node</span>.<span class="i">StartLine</span>,
                <a href="#f2796bc380735164" class="i field">EndLine</a> = <span class="r249 r">node</span>.<span class="i">EndLine</span>,
                <a href="#0f9ac13a15ffd396" class="i field">IsClear</a> = <span class="r249 r">node</span>.<span class="i">IsClear</span>
            };
            <a href="#7548b5b94c9c87ef" class="i field">_debugInfos</a>.<span class="i">Add</span>(<span class="r251 r">info</span>);
        }
 
        <b>private void</b> <a id="77defff056b62dd1" href="../../R/77defff056b62dd1.html" target="n" data-glyph="76,1" class="i method">CompileRuntimeVariablesExpression</a>(<span class="i">Expression</span> <span id="r252 rd" class="r252 r">expr</span>)
        {
            <span class="c">// Generates IRuntimeVariables for all requested variables</span>
            <b>var</b> <span id="r253 rd" class="r253 r">node</span> = (<span class="i">RuntimeVariablesExpression</span>)<span class="r252 r">expr</span>;
            <b>for</b> (<b>int</b> <span id="r254 rd" class="r254 r">index</span> = 0; <span class="r254 r">index</span> &lt; <span class="r253 r">node</span>.<span class="i">Variables</span>.<span class="i">Count</span>; <span class="r254 r">index</span>++)
            {
                <b>var</b> <span id="r255 rd" class="r255 r">variable</span> = <span class="r253 r">node</span>.<span class="i">Variables</span>[<span class="r254 r">index</span>];
                <span class="i">EnsureAvailableForClosure</span>(<span class="r255 r">variable</span>);
                <span class="i">CompileGetBoxedVariable</span>(<span class="r255 r">variable</span>);
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitNewRuntimeVariables</span>(<span class="r253 r">node</span>.<span class="i">Variables</span>.<span class="i">Count</span>);
        }
 
        <b>private void</b> <a id="0d34900eb621beb0" href="../../R/0d34900eb621beb0.html" target="n" data-glyph="76,1" class="i method">CompileLambdaExpression</a>(<span class="i">Expression</span> <span id="r256 rd" class="r256 r">expr</span>)
        {
            <b>var</b> <span id="r257 rd" class="r257 r">node</span> = (<span class="i">LambdaExpression</span>)<span class="r256 r">expr</span>;
            <a href="#bee3a40ad9cb3a51" class="k">var</a> <span id="r258 rd" class="r258 r">compiler</span> = <b>new</b> <a href="#d521b1d9281803f7" class="t constructor">LightCompiler</a>(<a href="#bee3a40ad9cb3a51" class="k">this</a>);
            <a href="LightDelegateCreator.cs.html#51f9bfb96b7e3043" class="k">var</a> <span id="r259 rd" class="r259 r">creator</span> = <span class="r258 r">compiler</span>.<a href="#9c6a537e4450fb2d" class="i method">CompileTop</a>(<span class="r257 r">node</span>);
 
            <b>if</b> (<span class="r258 r">compiler</span>.<a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#09a00b6afebd5f94" class="i property">ClosureVariables</a> != <b>null</b>)
            {
                <b>foreach</b> (<span class="i">ParameterExpression</span> <span id="r260 rd" class="r260 r">variable</span> <b>in</b> <span class="r258 r">compiler</span>.<a href="#7a9deb329886455f" class="i field">_locals</a>.<a href="LocalVariables.cs.html#09a00b6afebd5f94" class="i property">ClosureVariables</a>.<span class="i">Keys</span>)
                {
                    <a href="#5d9b00c2056b61bc" class="i method">CompileGetBoxedVariable</a>(<span class="r260 r">variable</span>);
                }
            }
 
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#a5260bd0dfa3a797" class="i method">EmitCreateDelegate</a>(<span class="r259 r">creator</span>);
        }
 
        <b>private void</b> <a id="5ea72eba981e91d1" href="../../R/5ea72eba981e91d1.html" target="n" data-glyph="76,1" class="i method">CompileCoalesceBinaryExpression</a>(<span class="i">Expression</span> <span id="r261 rd" class="r261 r">expr</span>)
        {
            <b>var</b> <span id="r262 rd" class="r262 r">node</span> = (<span class="i">BinaryExpression</span>)<span class="r261 r">expr</span>;
 
            <b>if</b> (<a href="Utilities.cs.html#a1766c42eb12a5ca" class="t t">TypeUtils</a>.<span class="i">IsNullableType</span>(<span class="r262 r">node</span>.<span class="i">Left</span>.<span class="i">Type</span>))
            {
                <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
            }
            <b>else</b> <b>if</b> (<span class="r262 r">node</span>.<span class="i">Conversion</span> != <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
            }
            <b>else</b>
            {
                <a href="BranchLabel.cs.html#eddd89038e02be60" class="k">var</a> <span id="r263 rd" class="r263 r">leftNotNull</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#3b80bf3858a8420d" class="i method">MakeLabel</a>();
                <span class="i">Compile</span>(<span class="r262 r">node</span>.<span class="i">Left</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#45124b99e7b8c2b8" class="i method">EmitCoalescingBranch</a>(<span class="r263 r">leftNotNull</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#d9d8cea15cb5918d" class="i method">EmitPop</a>();
                <span class="i">Compile</span>(<span class="r262 r">node</span>.<span class="i">Right</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#07be63eff99979b6" class="i method">MarkLabel</a>(<span class="r263 r">leftNotNull</span>);
            }
        }
 
        <b>private void</b> <a id="c93f8e5c7b06ab57" href="../../R/c93f8e5c7b06ab57.html" target="n" data-glyph="76,1" class="i method">CompileInvocationExpression</a>(<span class="i">Expression</span> <span id="r264 rd" class="r264 r">expr</span>)
        {
            <b>var</b> <span id="r265 rd" class="r265 r">node</span> = (<span class="i">InvocationExpression</span>)<span class="r264 r">expr</span>;
 
            <span class="c">// TODO: LambdaOperand optimization (see compiler)</span>
            <b>if</b> (<b>typeof</b>(<span class="i">LambdaExpression</span>).<span class="i">IsAssignableFrom</span>(<span class="r265 r">node</span>.<span class="i">Expression</span>.<span class="i">Type</span>))
            {
                <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
            }
 
            <span class="c">// TODO: do not create a new Call Expression</span>
            <span class="c">// if (PlatformAdaptationLayer.IsCompactFramework) {</span>
            <span class="c">//    // Workaround for a bug in Compact Framework</span>
            <span class="c">//    Compile(</span>
            <span class="c">//        AstUtils.Convert(</span>
            <span class="c">//            Expression.Call(</span>
            <span class="c">//                node.Expression,</span>
            <span class="c">//                node.Expression.Type.GetMethod(&quot;DynamicInvoke&quot;),</span>
            <span class="c">//                Expression.NewArrayInit(typeof(object), node.Arguments.Map((e) =&gt; AstUtils.Convert(e, typeof(object))))</span>
            <span class="c">//            ),</span>
            <span class="c">//            node.Type</span>
            <span class="c">//        )</span>
            <span class="c">//    );</span>
            <span class="c">// } else {</span>
            <span class="i">CompileMethodCallExpression</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<span class="r265 r">node</span>.<span class="i">Expression</span>, <span class="r265 r">node</span>.<span class="i">Expression</span>.<span class="i">Type</span>.<span class="i">GetMethod</span>(<span class="s">&quot;Invoke&quot;</span>), <span class="r265 r">node</span>.<span class="i">Arguments</span>));
            <span class="c">// }</span>
        }
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA1801:ReviewUnusedParameters&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;expr&quot;</span>)]
        <b>private void</b> <a id="83306a2eca098930" href="../../R/83306a2eca098930.html" target="n" data-glyph="76,1" class="i method">CompileListInitExpression</a>(<span class="i">Expression</span> <span id="r266 rd" class="r266 r">expr</span>)
        {
            <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
        }
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA1801:ReviewUnusedParameters&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;expr&quot;</span>)]
        <b>private void</b> <a id="b11f9a8e318143fa" href="../../R/b11f9a8e318143fa.html" target="n" data-glyph="76,1" class="i method">CompileMemberInitExpression</a>(<span class="i">Expression</span> <span id="r267 rd" class="r267 r">expr</span>)
        {
            <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
        }
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA1801:ReviewUnusedParameters&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;expr&quot;</span>)]
        <b>private void</b> <a id="fc7aebecdeb45513" href="../../R/fc7aebecdeb45513.html" target="n" data-glyph="76,1" class="i method">CompileQuoteUnaryExpression</a>(<span class="i">Expression</span> <span id="r268 rd" class="r268 r">expr</span>)
        {
            <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
        }
 
        <b>private void</b> <a id="2e0971677dbb709c" href="../../R/2e0971677dbb709c.html" target="n" data-glyph="76,1" class="i method">CompileUnboxUnaryExpression</a>(<span class="i">Expression</span> <span id="r269 rd" class="r269 r">expr</span>)
        {
            <b>var</b> <span id="r270 rd" class="r270 r">node</span> = (<span class="i">UnaryExpression</span>)<span class="r269 r">expr</span>;
            <span class="c">// unboxing is a nop:</span>
            <span class="i">Compile</span>(<span class="r270 r">node</span>.<span class="i">Operand</span>);
        }
 
        <b>private void</b> <a id="6fe0da430b203623" href="../../R/6fe0da430b203623.html" target="n" data-glyph="76,1" class="i method">CompileTypeEqualExpression</a>(<span class="i">Expression</span> <span id="r271 rd" class="r271 r">expr</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r271 r">expr</span>.<span class="i">NodeType</span> == <span class="i">ExpressionType</span>.<span class="i">TypeEqual</span>);
            <b>var</b> <span id="r272 rd" class="r272 r">node</span> = (<span class="i">TypeBinaryExpression</span>)<span class="r271 r">expr</span>;
 
            <span class="i">Compile</span>(<span class="r272 r">node</span>.<span class="i">Expression</span>);
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLoad</span>(<span class="r272 r">node</span>.<span class="i">TypeOperand</span>);
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#fd537e2aeb9be332" class="i method">EmitTypeEquals</a>();
        }
 
        <b>private void</b> <a id="d9f46a580b56a022" href="../../R/d9f46a580b56a022.html" target="n" data-glyph="76,1" class="i method">CompileTypeAsExpression</a>(<span class="i">UnaryExpression</span> <span id="r273 rd" class="r273 r">node</span>)
        {
            <span class="i">Compile</span>(<span class="r273 r">node</span>.<span class="i">Operand</span>);
            <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitTypeAs</span>(<span class="r273 r">node</span>.<span class="i">Type</span>);
        }
 
        <b>private void</b> <a id="ab3cfbc10aefafea" href="../../R/ab3cfbc10aefafea.html" target="n" data-glyph="76,1" class="i method">CompileTypeIsExpression</a>(<span class="i">Expression</span> <span id="r274 rd" class="r274 r">expr</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r274 r">expr</span>.<span class="i">NodeType</span> == <span class="i">ExpressionType</span>.<span class="i">TypeIs</span>);
            <b>var</b> <span id="r275 rd" class="r275 r">node</span> = (<span class="i">TypeBinaryExpression</span>)<span class="r274 r">expr</span>;
 
            <span class="i">Compile</span>(<span class="r275 r">node</span>.<span class="i">Expression</span>);
 
            <span class="c">// use TypeEqual for sealed types:</span>
            <b>if</b> (<span class="r275 r">node</span>.<span class="i">TypeOperand</span>.<span class="i">IsSealed</span>)
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitLoad</span>(<span class="r275 r">node</span>.<span class="i">TypeOperand</span>);
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#fd537e2aeb9be332" class="i method">EmitTypeEquals</a>();
            }
            <b>else</b>
            {
                <a href="#e38ff94a87332783" class="i field">_instructions</a>.<span class="i">EmitTypeIs</span>(<span class="r275 r">node</span>.<span class="i">TypeOperand</span>);
            }
        }
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA1801:ReviewUnusedParameters&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;expr&quot;</span>)]
        <b>private void</b> <a id="f99d16cec85ca2f4" href="../../R/f99d16cec85ca2f4.html" target="n" data-glyph="76,1" class="i method">CompileReducibleExpression</a>(<span class="i">Expression</span> <span id="r276 rd" class="r276 r">expr</span>)
        {
            <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>();
        }
 
        <b>internal void</b> <a id="bdd54cc2a99f0ab6" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Compile</a>(<span class="i">Expression</span> <span id="r277 rd" class="r277 r">expr</span>, <b>bool</b> <span id="r278 rd" class="r278 r">asVoid</span>)
        {
            <b>if</b> (<span class="r278 r">asVoid</span>)
            {
                <a href="#b562953d4608d16f" class="i method">CompileAsVoid</a>(<span class="r277 r">expr</span>);
            }
            <b>else</b>
            {
                <a href="#568758ab458febc3" class="i method">Compile</a>(<span class="r277 r">expr</span>);
            }
        }
 
        <b>internal void</b> <a id="b562953d4608d16f" href="../../R/b562953d4608d16f.html" target="n" data-glyph="74,1" class="i method">CompileAsVoid</a>(<span class="i">Expression</span> <span id="r279 rd" class="r279 r">expr</span>)
        {
            <b>bool</b> <span id="r280 rd" class="r280 r">pushLabelBlock</span> = <a href="#3c9d31cdc1e8bb21" class="i method">TryPushLabelBlock</a>(<span class="r279 r">expr</span>);
            <b>int</b> <span id="r281 rd" class="r281 r">startingStackDepth</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#5a7bf73ebd74b3ab" class="i property">CurrentStackDepth</a>;
            <b>switch</b> (<span class="r279 r">expr</span>.<span class="i">NodeType</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Assign</span>:
                    <a href="#69ec03e31daa87ce" class="i method">CompileAssignBinaryExpression</a>(<span class="r279 r">expr</span>, <b>true</b>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Block</span>:
                    <a href="#c732c972f20e0412" class="i method">CompileBlockExpression</a>(<span class="r279 r">expr</span>, <b>true</b>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Throw</span>:
                    <a href="#326ccf23d6fb4cd4" class="i method">CompileThrowUnaryExpression</a>(<span class="r279 r">expr</span>, <b>true</b>);
                    <b>break</b>;
 
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Constant</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Default</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Parameter</span>:
                    <span class="c">// no-op</span>
                    <b>break</b>;
 
                <b>default</b>:
                    <a href="#496cdc161f436625" class="i method">CompileNoLabelPush</a>(<span class="r279 r">expr</span>);
                    <b>if</b> (<span class="r279 r">expr</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>))
                    {
                        <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#d9d8cea15cb5918d" class="i method">EmitPop</a>();
                    }
 
                    <b>break</b>;
            }
 
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#5a7bf73ebd74b3ab" class="i property">CurrentStackDepth</a> == <span class="r281 r">startingStackDepth</span>);
            <b>if</b> (<span class="r280 r">pushLabelBlock</span>)
            {
                <a href="#2063b4bb64f206cb" class="i method">PopLabelBlock</a>(<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a>);
            }
        }
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Maintainability&quot;</span>, <span class="s">&quot;CA1502:AvoidExcessiveComplexity&quot;</span>)]
        <b>private void</b> <a id="496cdc161f436625" href="../../R/496cdc161f436625.html" target="n" data-glyph="76,1" class="i method">CompileNoLabelPush</a>(<span class="i">Expression</span> <span id="r282 rd" class="r282 r">expr</span>)
        {
            <b>int</b> <span id="r283 rd" class="r283 r">startingStackDepth</span> = <a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#5a7bf73ebd74b3ab" class="i property">CurrentStackDepth</a>;
            <b>switch</b> (<span class="r282 r">expr</span>.<span class="i">NodeType</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Add</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AddChecked</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">And</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AndAlso</span>: <a href="#f50b2f46fec64935" class="i method">CompileAndAlsoBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ArrayLength</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ArrayIndex</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Call</span>: <a href="#682cb433551111c1" class="i method">CompileMethodCallExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Coalesce</span>: <a href="#5ea72eba981e91d1" class="i method">CompileCoalesceBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Conditional</span>: <a href="#8e6175371fde2691" class="i method">CompileConditionalExpression</a>(<span class="r282 r">expr</span>, <span class="r282 r">expr</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>)); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Constant</span>: <a href="#44f6f51b4b035fd0" class="i method">CompileConstantExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Convert</span>: <a href="#0d1c0e8a89a609f6" class="i method">CompileConvertUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ConvertChecked</span>: <a href="#0d1c0e8a89a609f6" class="i method">CompileConvertUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Divide</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Equal</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ExclusiveOr</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThan</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Invoke</span>: <a href="#c93f8e5c7b06ab57" class="i method">CompileInvocationExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Lambda</span>: <a href="#0d34900eb621beb0" class="i method">CompileLambdaExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LeftShift</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThan</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ListInit</span>: <a href="#83306a2eca098930" class="i method">CompileListInitExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MemberAccess</span>: <a href="#6b2f758efdabadad" class="i method">CompileMemberExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MemberInit</span>: <a href="#b11f9a8e318143fa" class="i method">CompileMemberInitExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Modulo</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Multiply</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MultiplyChecked</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Negate</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">UnaryPlus</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NegateChecked</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">New</span>: <a href="#690b217a225d5f32" class="i method">CompileNewExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NewArrayInit</span>: <a href="#e146ea6477dc2ce7" class="i method">CompileNewArrayExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NewArrayBounds</span>: <a href="#e146ea6477dc2ce7" class="i method">CompileNewArrayExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Not</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Or</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">OrElse</span>: <a href="#a965ac26ea15a7c3" class="i method">CompileOrElseBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Parameter</span>: <a href="#9b04fd2f61734671" class="i method">CompileParameterExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Power</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Quote</span>: <a href="#fc7aebecdeb45513" class="i method">CompileQuoteUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">RightShift</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Subtract</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">SubtractChecked</span>: <a href="#362bd11225a3267e" class="i method">CompileBinaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">TypeAs</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">TypeIs</span>: <a href="#ab3cfbc10aefafea" class="i method">CompileTypeIsExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Assign</span>: <a href="#69ec03e31daa87ce" class="i method">CompileAssignBinaryExpression</a>(<span class="r282 r">expr</span>, <span class="r282 r">expr</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>)); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Block</span>: <a href="#c732c972f20e0412" class="i method">CompileBlockExpression</a>(<span class="r282 r">expr</span>, <span class="r282 r">expr</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>)); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">DebugInfo</span>: <a href="#8f5cedbbf562f033" class="i method">CompileDebugInfoExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Decrement</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Dynamic</span>: <a href="#dcc2f56da546515b" class="i method">CompileDynamicExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Default</span>: <a href="#21e64bcf0d707ed7" class="i method">CompileDefaultExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Extension</span>: <a href="#8f3f72dae3a74bb4" class="i method">CompileExtensionExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Goto</span>: <a href="#51aabc01e3013ec0" class="i method">CompileGotoExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Increment</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Index</span>: <a href="#1713a06f3b6fe507" class="i method">CompileIndexExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Label</span>: <a href="#8e457e1b20121427" class="i method">CompileLabelExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">RuntimeVariables</span>: <a href="#77defff056b62dd1" class="i method">CompileRuntimeVariablesExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Loop</span>:
                    <a href="#85557d3d52e4717f" class="i method">CompileLoopExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Switch</span>: <a href="#252f0e79de0905ec" class="i method">CompileSwitchExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Throw</span>: <a href="#326ccf23d6fb4cd4" class="i method">CompileThrowUnaryExpression</a>(<span class="r282 r">expr</span>, <span class="r282 r">expr</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>)); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Try</span>: <a href="#164be802588aff2b" class="i method">CompileTryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Unbox</span>: <a href="#2e0971677dbb709c" class="i method">CompileUnboxUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">TypeEqual</span>: <a href="#6fe0da430b203623" class="i method">CompileTypeEqualExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">OnesComplement</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">IsTrue</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">IsFalse</span>: <a href="#f46c04fdfcea3464" class="i method">CompileUnaryExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AddAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AndAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">DivideAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ExclusiveOrAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LeftShiftAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ModuloAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MultiplyAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">OrAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PowerAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">RightShiftAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">SubtractAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AddAssignChecked</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MultiplyAssignChecked</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">SubtractAssignChecked</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PreIncrementAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PreDecrementAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PostIncrementAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PostDecrementAssign</span>:
                    <a href="#f99d16cec85ca2f4" class="i method">CompileReducibleExpression</a>(<span class="r282 r">expr</span>); <b>break</b>;
                <b>default</b>: <b>throw</b> <a href="Utilities.cs.html#f760db0369027867" class="t t">Assert</a>.<a href="Utilities.cs.html#176abe9780c04116" class="i property">Unreachable</a>;
            }
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#e38ff94a87332783" class="i field">_instructions</a>.<a href="InstructionList.cs.html#5a7bf73ebd74b3ab" class="i property">CurrentStackDepth</a> == <span class="r283 r">startingStackDepth</span> + (<span class="r282 r">expr</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>) ? 0 : 1));
        }
 
        <b>public void</b> <a id="568758ab458febc3" href="../../R/568758ab458febc3.html" target="n" data-glyph="72,1" class="i method">Compile</a>(<span class="i">Expression</span> <span id="r284 rd" class="r284 r">expr</span>)
        {
            <b>bool</b> <span id="r285 rd" class="r285 r">pushLabelBlock</span> = <a href="#3c9d31cdc1e8bb21" class="i method">TryPushLabelBlock</a>(<span class="r284 r">expr</span>);
            <a href="#496cdc161f436625" class="i method">CompileNoLabelPush</a>(<span class="r284 r">expr</span>);
            <b>if</b> (<span class="r285 r">pushLabelBlock</span>)
            {
                <a href="#2063b4bb64f206cb" class="i method">PopLabelBlock</a>(<a href="#cee41a60058bf341" class="i field">_labelBlock</a>.<a href="LabelInfo.cs.html#61216f3367654453" class="i field">Kind</a>);
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
