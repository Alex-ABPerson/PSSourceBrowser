<!DOCTYPE html>
<html><head><title>Utilities.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1155);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/interpreter/Utilities.cs" target="_top">engine\interpreter\Utilities.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Dynamic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>.<span class="i">Expressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="t">AstUtils</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Interpreter</span>.<a href="#55b509010bbde4b3" class="t t">Utils</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Interpreter</span>
{
    <b>internal static class</b> <a id="a1766c42eb12a5ca" href="../../R/a1766c42eb12a5ca.html" target="n" data-glyph="2,0" class="t t">TypeUtils</a>
    {
        <b>internal static</b> <span class="i">Type</span> <a id="4ac5284102b0e3c2" href="../../R/4ac5284102b0e3c2.html" target="n" data-glyph="221,1" class="i method">GetNonNullableType</a>(<b>this</b> <span class="i">Type</span> <span id="r0 rd" class="r0 r">type</span>)
        {
            <b>if</b> (<a href="#1a0cc8efe16dc5fb" class="i method">IsNullableType</a>(<span class="r0 r">type</span>))
            {
                <b>return</b> <span class="r0 r">type</span>.<span class="i">GetGenericArguments</span>()[0];
            }
 
            <b>return</b> <span class="r0 r">type</span>;
        }
 
        <b>internal static</b> <span class="i">Type</span> <a id="db4d8d49d08260a2" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetNullableType</a>(<span class="i">Type</span> <span id="r1 rd" class="r1 r">type</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r1 r">type</span> != <b>null</b>, <span class="s">&quot;type cannot be null&quot;</span>);
            <b>if</b> (<span class="r1 r">type</span>.<span class="i">IsValueType</span> &amp;&amp; !<a href="#1a0cc8efe16dc5fb" class="i method">IsNullableType</a>(<span class="r1 r">type</span>))
            {
                <b>return</b> <b>typeof</b>(<span class="i">Nullable</span>&lt;&gt;).<span class="i">MakeGenericType</span>(<span class="r1 r">type</span>);
            }
 
            <b>return</b> <span class="r1 r">type</span>;
        }
 
        <b>internal static bool</b> <a id="1a0cc8efe16dc5fb" href="../../R/1a0cc8efe16dc5fb.html" target="n" data-glyph="74,1" class="i method">IsNullableType</a>(<span class="i">Type</span> <span id="r2 rd" class="r2 r">type</span>)
        {
            <b>return</b> <span class="r2 r">type</span>.<span class="i">IsGenericType</span> &amp;&amp; <span class="r2 r">type</span>.<span class="i">GetGenericTypeDefinition</span>() == <b>typeof</b>(<span class="i">Nullable</span>&lt;&gt;);
        }
 
        <b>internal static bool</b> <a id="367a39ba63f13628" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsBool</a>(<span class="i">Type</span> <span id="r3 rd" class="r3 r">type</span>)
        {
            <b>return</b> <a href="#4ac5284102b0e3c2" class="i method">GetNonNullableType</a>(<span class="r3 r">type</span>) == <b>typeof</b>(<b>bool</b>);
        }
 
        <b>internal static bool</b> <a id="dc0fcf5b9b0186ac" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsNumeric</a>(<span class="i">Type</span> <span id="r4 rd" class="r4 r">type</span>)
        {
            <span class="r4 r">type</span> = <a href="#4ac5284102b0e3c2" class="i method">GetNonNullableType</a>(<span class="r4 r">type</span>);
            <b>if</b> (!<span class="r4 r">type</span>.<span class="i">IsEnum</span>)
            {
                <b>switch</b> (<span class="r4 r">type</span>.<a href="../../utils/ExtensionMethods.cs.html#6941492779b390f9" class="i method">GetTypeCode</a>())
                {
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Char</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">SByte</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Byte</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int16</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int32</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int64</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Double</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Single</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt16</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt32</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt64</span>:
                        <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static bool</b> <a id="3630e78b200a4853" href="../../R/3630e78b200a4853.html" target="n" data-glyph="74,1" class="i method">IsNumeric</a>(<span class="i">TypeCode</span> <span id="r5 rd" class="r5 r">typeCode</span>)
        {
            <b>switch</b> (<span class="r5 r">typeCode</span>)
            {
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Char</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">SByte</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Byte</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int16</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int32</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int64</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Double</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Single</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt16</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt32</span>:
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt64</span>:
                    <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static bool</b> <a id="ca8edd6879cf4be9" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsArithmetic</a>(<span class="i">Type</span> <span id="r6 rd" class="r6 r">type</span>)
        {
            <span class="r6 r">type</span> = <a href="#4ac5284102b0e3c2" class="i method">GetNonNullableType</a>(<span class="r6 r">type</span>);
            <b>if</b> (!<span class="r6 r">type</span>.<span class="i">IsEnum</span>)
            {
                <b>switch</b> (<span class="r6 r">type</span>.<a href="../../utils/ExtensionMethods.cs.html#6941492779b390f9" class="i method">GetTypeCode</a>())
                {
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int16</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int32</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int64</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Double</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">Single</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt16</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt32</span>:
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt64</span>:
                        <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
    }
 
    <b>internal static class</b> <a id="3faf01e80dcf5173" href="../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">ArrayUtils</a>
    {
        <b>internal static</b> <span class="r7 r t">T</span>[] <a id="d0f042574196598c" href="../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">AddLast</a>&lt;<span id="r7 rd t" class="r7 r t">T</span>&gt;(<b>this</b> <span class="i">IList</span>&lt;<span class="r7 r t">T</span>&gt; <span id="r8 rd" class="r8 r">list</span>, <span class="r7 r t">T</span> <span id="r9 rd" class="r9 r">item</span>)
        {
            <span class="r7 r t">T</span>[] <span id="r10 rd" class="r10 r">res</span> = <b>new</b> <span class="r7 r t">T</span>[<span class="r8 r">list</span>.<span class="i">Count</span> + 1];
            <span class="r8 r">list</span>.<span class="i">CopyTo</span>(<span class="r10 r">res</span>, 0);
            <span class="r10 r">res</span>[<span class="r8 r">list</span>.<span class="i">Count</span>] = <span class="r9 r">item</span>;
            <b>return</b> <span class="r10 r">res</span>;
        }
    }
 
    <b>internal static class</b> <a id="942087c2bd4302ae" href="../../R/942087c2bd4302ae.html" target="n" data-glyph="2,0" class="t t">DelegateHelpers</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Generated Maximum Delegate Arity
 
        <span class="c">// *** BEGIN GENERATED CODE ***</span>
        <span class="c">// generated by function: gen_max_delegate_arity from: generate_dynsites.py</span>
 
        <b>private const int</b> <a id="b81c43a0e442f5ea" href="../../R/b81c43a0e442f5ea.html" target="n" data-glyph="10,1" class="i field">MaximumArity</a> = 17;
 
        <span class="c">// *** END GENERATED CODE ***</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Maintainability&quot;</span>, <span class="s">&quot;CA1502:AvoidExcessiveComplexity&quot;</span>)]
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Maintainability&quot;</span>, <span class="s">&quot;CA1506:AvoidExcessiveClassCoupling&quot;</span>)]
        <b>internal static</b> <span class="i">Type</span> <a id="4d8d67e3643ed222" href="../../R/4d8d67e3643ed222.html" target="n" data-glyph="74,1" class="i method">MakeDelegate</a>(<span class="i">Type</span>[] <span id="r11 rd" class="r11 r">types</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r11 r">types</span> != <b>null</b> &amp;&amp; <span class="r11 r">types</span>.<span class="i">Length</span> &gt; 0);
 
            <span class="c">// Can only used predefined delegates if we have no byref types and</span>
            <span class="c">// the arity is small enough to fit in Func&lt;...&gt; or Action&lt;...&gt;</span>
            <b>if</b> (<span class="r11 r">types</span>.<span class="i">Length</span> &gt; <a href="#b81c43a0e442f5ea" class="i field">MaximumArity</a> || <span class="r11 r">types</span>.<span class="i">Any</span>(<b>static</b> <span id="r12 rd" class="r12 r">t</span> =&gt; <span class="r12 r">t</span>.<span class="i">IsByRef</span>))
            {
                <b>throw</b> <a href="#f760db0369027867" class="t t">Assert</a>.<a href="#176abe9780c04116" class="i property">Unreachable</a>;
                <span class="c">// return MakeCustomDelegate(types);</span>
            }
 
            <span class="i">Type</span> <span id="r13 rd" class="r13 r">returnType</span> = <span class="r11 r">types</span>[<span class="r11 r">types</span>.<span class="i">Length</span> - 1];
            <b>if</b> (<span class="r13 r">returnType</span> == <b>typeof</b>(<b>void</b>))
            {
                <span class="i">Array</span>.<span class="i">Resize</span>(<b>ref</b> <span class="r11 r">types</span>, <span class="r11 r">types</span>.<span class="i">Length</span> - 1);
                <b>switch</b> (<span class="r11 r">types</span>.<span class="i">Length</span>)
                {
                    <b>case</b> 0: <b>return</b> <b>typeof</b>(<span class="i">Action</span>);
                    <span class="k preprocess">#</span><span class="k preprocess">region</span> Generated Delegate Action Types
 
                    <span class="c">// *** BEGIN GENERATED CODE ***</span>
                    <span class="c">// generated by function: gen_delegate_action from: generate_dynsites.py</span>
 
                    <b>case</b> 1: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 2: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 3: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 4: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 5: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 6: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 7: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 8: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 9: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 10: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 11: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 12: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 13: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 14: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 15: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 16: <b>return</b> <b>typeof</b>(<span class="i">Action</span>&lt;,,,,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
 
                        <span class="c">// *** END GENERATED CODE ***</span>
 
                        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
                }
            }
            <b>else</b>
            {
                <b>switch</b> (<span class="r11 r">types</span>.<span class="i">Length</span>)
                {
                    <span class="k preprocess">#</span><span class="k preprocess">region</span> Generated Delegate Func Types
 
                    <span class="c">// *** BEGIN GENERATED CODE ***</span>
                    <span class="c">// generated by function: gen_delegate_func from: generate_dynsites.py</span>
 
                    <b>case</b> 1: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 2: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 3: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 4: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 5: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 6: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 7: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 8: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 9: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 10: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 11: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 12: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 13: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 14: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 15: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 16: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
                    <b>case</b> 17: <b>return</b> <b>typeof</b>(<span class="i">Func</span>&lt;,,,,,,,,,,,,,,,,&gt;).<span class="i">MakeGenericType</span>(<span class="r11 r">types</span>);
 
                        <span class="c">// *** END GENERATED CODE ***</span>
 
                        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
                }
            }
 
            <b>throw</b> <a href="#f760db0369027867" class="t t">Assert</a>.<a href="#176abe9780c04116" class="i property">Unreachable</a>;
        }
    }
 
    <b>internal static class</b> <a id="f0537ca64373db8a" href="../../R/f0537ca64373db8a.html" target="n" data-glyph="2,0" class="t t">ScriptingRuntimeHelpers</a>
    {
        <b>internal static object</b> <a id="f44079fcb92b04b5" href="../../R/f44079fcb92b04b5.html" target="n" data-glyph="74,1" class="i method">Int32ToObject</a>(<b>int</b> <span id="r14 rd" class="r14 r">i</span>)
        {
            <b>return</b> <span class="r14 r">i</span>;
        }
 
        <b>internal static object</b> <a id="312946cb4692ebc9" href="../../R/312946cb4692ebc9.html" target="n" data-glyph="74,1" class="i method">BooleanToObject</a>(<b>bool</b> <span id="r15 rd" class="r15 r">b</span>)
        {
            <b>return</b> <span class="r15 r">b</span> ? <a href="#27093d4d0a1e893d" class="i field">True</a> : <a href="#df93817890cf26ad" class="i field">False</a>;
        }
 
        <b>internal static readonly</b> <span class="i">MethodInfo</span> <a id="cb8b12785d412534" href="../../R/cb8b12785d412534.html" target="n" data-glyph="44,1" class="i field">BooleanToObjectMethod</a> = <b>typeof</b>(<a href="#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>).<span class="i">GetMethod</span>(<span class="s">&quot;BooleanToObject&quot;</span>);
        <b>internal static readonly</b> <span class="i">MethodInfo</span> <a id="2e7ec655a00075bd" href="../../R/2e7ec655a00075bd.html" target="n" data-glyph="44,1" class="i field">Int32ToObjectMethod</a> = <b>typeof</b>(<a href="#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>).<span class="i">GetMethod</span>(<span class="s">&quot;Int32ToObject&quot;</span>);
 
        <b>internal static readonly object</b> <a id="27093d4d0a1e893d" href="../../R/27093d4d0a1e893d.html" target="n" data-glyph="44,1" class="i field">True</a> = <b>true</b>;
        <b>internal static readonly object</b> <a id="df93817890cf26ad" href="../../R/df93817890cf26ad.html" target="n" data-glyph="44,1" class="i field">False</a> = <b>false</b>;
 
        <b>internal static object</b> <a id="e161c4ba84c71734" href="../../R/e161c4ba84c71734.html" target="n" data-glyph="74,1" class="i method">GetPrimitiveDefaultValue</a>(<span class="i">Type</span> <span id="r16 rd" class="r16 r">type</span>)
        {
            <b>switch</b> (<span class="r16 r">type</span>.<a href="../../utils/ExtensionMethods.cs.html#6941492779b390f9" class="i method">GetTypeCode</a>())
            {
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Boolean</span>: <b>return</b> <a href="#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>.<a href="#df93817890cf26ad" class="i field">False</a>;
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">SByte</span>: <b>return</b> <b>default</b>(<b>sbyte</b>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Byte</span>: <b>return</b> <b>default</b>(<b>byte</b>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Char</span>: <b>return</b> <b>default</b>(<b>char</b>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int16</span>: <b>return</b> <b>default</b>(<span class="i">Int16</span>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int32</span>: <b>return</b> <a href="#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>.<a href="#f44079fcb92b04b5" class="i method">Int32ToObject</a>(0);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int64</span>: <b>return</b> <b>default</b>(<span class="i">Int64</span>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt16</span>: <b>return</b> <b>default</b>(<span class="i">UInt16</span>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt32</span>: <b>return</b> <b>default</b>(<span class="i">UInt32</span>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt64</span>: <b>return</b> <b>default</b>(<span class="i">UInt64</span>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Single</span>: <b>return</b> <b>default</b>(<span class="i">Single</span>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Double</span>: <b>return</b> <b>default</b>(<b>double</b>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">DateTime</span>: <b>return</b> <b>default</b>(<span class="i">DateTime</span>);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Decimal</span>: <b>return</b> <b>default</b>(<span class="i">Decimal</span>);
                <span class="c">// TypeCode.Empty:  null;</span>
                <span class="c">// TypeCode.Object: default(object) == null;</span>
                <span class="c">// TypeCode.DBNull: default(DBNull) == null;</span>
                <span class="c">// TypeCode.String: default(string) == null;</span>
                <b>default</b>: <b>return</b> <b>null</b>;
            }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Wraps all arguments passed to a dynamic site with more arguments than can be accepted by a Func/Action delegate.</span>
    <span class="c">///</span><span class="c"> The binder generating a rule for such a site should unwrap the arguments first and then perform a binding to them.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="85a052bb8dcc3752" href="../../R/85a052bb8dcc3752.html" target="n" data-glyph="2,0" class="t t">ArgumentArray</a>
    {
        <b>private readonly object</b>[] <a id="ed597b5e2f4adfd9" href="../../R/ed597b5e2f4adfd9.html" target="n" data-glyph="46,1" class="i field">_arguments</a>;
 
        <span class="c">// the index of the first item _arguments that represents an argument:</span>
        <b>private readonly int</b> <a id="88162cfc19dcde24" href="../../R/88162cfc19dcde24.html" target="n" data-glyph="46,1" class="i field">_first</a>;
 
        <span class="c">// the number of items in _arguments that represent the arguments:</span>
 
        <b>internal</b> <a id="3e8a3f6a0c385633" href="../../R/3e8a3f6a0c385633.html" target="n" data-glyph="74,1" class="t constructor">ArgumentArray</a>(<b>object</b>[] <span id="r17 rd" class="r17 r">arguments</span>, <b>int</b> <span id="r18 rd" class="r18 r">first</span>, <b>int</b> <span id="r19 rd" class="r19 r">count</span>)
        {
            <a href="#ed597b5e2f4adfd9" class="i field">_arguments</a> = <span class="r17 r">arguments</span>;
            <a href="#88162cfc19dcde24" class="i field">_first</a> = <span class="r18 r">first</span>;
            <a href="#bdd78cd51107ab08" class="i property">Count</a> = <span class="r19 r">count</span>;
        }
 
        <b>public int</b> <a id="bdd78cd51107ab08" href="../../R/bdd78cd51107ab08.html" target="n" data-glyph="102,1" class="i property">Count</a> { <b>get</b>; }
 
        <b>public object</b> <a id="fe97d03798c5cb9b" href="../../R/fe97d03798c5cb9b.html" target="n" data-glyph="72,1" class="i method">GetArgument</a>(<b>int</b> <span id="r20 rd" class="r20 r">index</span>)
        {
            <span class="c">// ContractUtils.RequiresArrayIndex(_arguments, index, &quot;index&quot;);</span>
            <b>return</b> <a href="#ed597b5e2f4adfd9" class="i field">_arguments</a>[<a href="#88162cfc19dcde24" class="i field">_first</a> + <span class="r20 r">index</span>];
        }
 
        <b>public</b> <span class="i">DynamicMetaObject</span> <a id="da5b74a5cd7ff78f" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetMetaObject</a>(<span class="i">Expression</span> <span id="r21 rd" class="r21 r">parameter</span>, <b>int</b> <span id="r22 rd" class="r22 r">index</span>)
        {
            <b>return</b> <span class="i">DynamicMetaObject</span>.<span class="i">Create</span>(
                <a href="#fe97d03798c5cb9b" class="i method">GetArgument</a>(<span class="r22 r">index</span>),
                <span class="i">Expression</span>.<span class="i">Call</span>(
                    <a href="#2c6988a1b527f0c7" class="i field">s_getArgMethod</a>,
                    <a href="#55b509010bbde4b3" class="t t">AstUtils</a>.<span class="i">Convert</span>(<span class="r21 r">parameter</span>, <b>typeof</b>(<a href="#85a052bb8dcc3752" class="t t">ArgumentArray</a>)),
                    <a href="#55b509010bbde4b3" class="t t">AstUtils</a>.<a href="#2eea3151334bc1dd" class="i method">Constant</a>(<span class="r22 r">index</span>)
                )
            );
        }
 
        <span class="c">// [CLSCompliant(false)]</span>
        <b>public static object</b> <a id="0984b67f72b81fed" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetArg</a>(<a href="#85a052bb8dcc3752" class="t t">ArgumentArray</a> <span id="r23 rd" class="r23 r">array</span>, <b>int</b> <span id="r24 rd" class="r24 r">index</span>)
        {
            <b>return</b> <span class="r23 r">array</span>.<a href="#ed597b5e2f4adfd9" class="i field">_arguments</a>[<span class="r23 r">array</span>.<a href="#88162cfc19dcde24" class="i field">_first</a> + <span class="r24 r">index</span>];
        }
 
        <b>private static readonly</b> <span class="i">MethodInfo</span> <a id="2c6988a1b527f0c7" href="../../R/2c6988a1b527f0c7.html" target="n" data-glyph="46,1" class="i field">s_getArgMethod</a> = <b>new</b> <span class="i">Func</span>&lt;<a href="#85a052bb8dcc3752" class="t t">ArgumentArray</a>, <b>int</b>, <b>object</b>&gt;(<span class="i">GetArg</span>).<span class="i">GetMethodInfo</span>();
    }
 
    <b>internal static class</b> <a id="594c26773322fda8" href="../../R/594c26773322fda8.html" target="n" data-glyph="2,0" class="t t">ExceptionHelpers</a>
    {
        <b>private const string</b> <a id="2afd2b58abed0bf6" href="../../R/2afd2b58abed0bf6.html" target="n" data-glyph="10,1" class="i field">prevStackTraces</a> = <span class="s">&quot;PreviousStackTraces&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Updates an exception before it&#39;s getting re-thrown so</span>
        <span class="c">///</span><span class="c"> we can present a reasonable stack trace to the user.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">Exception</span> <a id="c7772c2653d43c73" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">UpdateForRethrow</a>(<span class="i">Exception</span> <span id="r25 rd" class="r25 r">rethrow</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">SILVERLIGHT</span>
            <span class="i">List</span>&lt;<span class="i">StackTrace</span>&gt; <span id="r26 rd" class="r26 r">prev</span>;
 
            <span class="c">// we don&#39;t have any dynamic stack trace data, capture the data we can</span>
            <span class="c">// from the raw exception object.</span>
            <span class="i">StackTrace</span> <span id="r27 rd" class="r27 r">st</span> = <b>new</b> <span class="i">StackTrace</span>(<span class="r25 r">rethrow</span>, <b>true</b>);
 
            <b>if</b> (!<a href="#c548ef00fa07b1d7" class="i method">TryGetAssociatedStackTraces</a>(<span class="r25 r">rethrow</span>, <b>out</b> <span class="r26 r">prev</span>))
            {
                <span class="r26 r">prev</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">StackTrace</span>&gt;();
                <a href="#5fc07f2864a5247f" class="i method">AssociateStackTraces</a>(<span class="r25 r">rethrow</span>, <span class="r26 r">prev</span>);
            }
 
            <span class="r26 r">prev</span>.<span class="i">Add</span>(<span class="r27 r">st</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>return</b> <span class="r25 r">rethrow</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns all the stack traces associates with an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static</b> <span class="i">IList</span>&lt;<span class="i">StackTrace</span>&gt; <a id="45c10bb7851b4a87" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetExceptionStackTraces</a>(<span class="i">Exception</span> <span id="r28 rd" class="r28 r">rethrow</span>)
        {
            <span class="i">List</span>&lt;<span class="i">StackTrace</span>&gt; <span id="r29 rd" class="r29 r">result</span>;
            <b>return</b> <a href="#c548ef00fa07b1d7" class="i method">TryGetAssociatedStackTraces</a>(<span class="r28 r">rethrow</span>, <b>out</b> <span class="r29 r">result</span>) ? <span class="r29 r">result</span> : <b>null</b>;
        }
 
        <b>private static void</b> <a id="5fc07f2864a5247f" href="../../R/5fc07f2864a5247f.html" target="n" data-glyph="76,1" class="i method">AssociateStackTraces</a>(<span class="i">Exception</span> <span id="r30 rd" class="r30 r">e</span>, <span class="i">List</span>&lt;<span class="i">StackTrace</span>&gt; <span id="r31 rd" class="r31 r">traces</span>)
        {
            <span class="r30 r">e</span>.<span class="i">Data</span>[<a href="#2afd2b58abed0bf6" class="i field">prevStackTraces</a>] = <span class="r31 r">traces</span>;
        }
 
        <b>private static bool</b> <a id="c548ef00fa07b1d7" href="../../R/c548ef00fa07b1d7.html" target="n" data-glyph="76,1" class="i method">TryGetAssociatedStackTraces</a>(<span class="i">Exception</span> <span id="r32 rd" class="r32 r">e</span>, <b>out</b> <span class="i">List</span>&lt;<span class="i">StackTrace</span>&gt; <span id="r33 rd" class="r33 r">traces</span>)
        {
            <span class="r33 r">traces</span> = <span class="r32 r">e</span>.<span class="i">Data</span>[<a href="#2afd2b58abed0bf6" class="i field">prevStackTraces</a>] <b>as</b> <span class="i">List</span>&lt;<span class="i">StackTrace</span>&gt;;
            <b>return</b> <span class="r33 r">traces</span> != <b>null</b>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A hybrid dictionary which compares based upon object identity.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="600f1e648b51e109" href="../../R/600f1e648b51e109.html" target="n" data-glyph="2,0" class="t t">HybridReferenceDictionary</a>&lt;<span id="r34 rd t" class="r34 r t">TKey</span>, <span id="r35 rd t" class="r35 r t">TValue</span>&gt; <b>where</b> <span class="r34 r t">TKey</span> : <b>class</b>
    {
        <b>private</b> <span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;[] <a id="dedecaf13761a19c" href="../../R/dedecaf13761a19c.html" target="n" data-glyph="46,1" class="i field">_keysAndValues</a>;
        <b>private</b> <span class="i">Dictionary</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt; <a id="1ceabfbc1c5ba5fa" href="../../R/1ceabfbc1c5ba5fa.html" target="n" data-glyph="46,1" class="i field">_dict</a>;
        <b>private int</b> <a id="d839ca17082c9ef9" href="../../R/d839ca17082c9ef9.html" target="n" data-glyph="46,1" class="i field">_count</a>;
 
        <b>private const int</b> <a id="fd075ab7aa6aae45" href="../../R/fd075ab7aa6aae45.html" target="n" data-glyph="10,1" class="i field">_arraySize</a> = 10;
 
        <b>public</b> <a id="29232c1e9100bf17" href="../../R/29232c1e9100bf17.html" target="n" data-glyph="72,1" class="t constructor">HybridReferenceDictionary</a>()
        {
        }
 
        <b>public</b> <a id="b3178f7daffdb4a8" href="../../R/b3178f7daffdb4a8.html" target="n" data-glyph="72,1" class="t constructor">HybridReferenceDictionary</a>(<b>int</b> <span id="r36 rd" class="r36 r">initialCapacity</span>)
        {
            <b>if</b> (<span class="r36 r">initialCapacity</span> &gt; <a href="#fd075ab7aa6aae45" class="i field">_arraySize</a>)
            {
                <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;(<span class="r36 r">initialCapacity</span>);
            }
            <b>else</b>
            {
                <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> = <b>new</b> <span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;[<span class="r36 r">initialCapacity</span>];
            }
        }
 
        <b>public bool</b> <a id="8c776c95f5b40495" href="../../R/8c776c95f5b40495.html" target="n" data-glyph="72,1" class="i method">TryGetValue</a>(<span class="r34 r t">TKey</span> <span id="r37 rd" class="r37 r">key</span>, <b>out</b> <span class="r35 r t">TValue</span> <span id="r38 rd" class="r38 r">value</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r37 r">key</span> != <b>null</b>);
 
            <b>if</b> (<a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> != <b>null</b>)
            {
                <b>return</b> <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>.<span class="i">TryGetValue</span>(<span class="r37 r">key</span>, <b>out</b> <span class="r38 r">value</span>);
            }
            <b>else</b> <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> != <b>null</b>)
            {
                <b>for</b> (<b>int</b> <span id="r39 rd" class="r39 r">i</span> = 0; <span class="r39 r">i</span> &lt; <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>.<span class="i">Length</span>; <span class="r39 r">i</span>++)
                {
                    <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r39 r">i</span>].<span class="i">Key</span> == <span class="r37 r">key</span>)
                    {
                        <span class="r38 r">value</span> = <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r39 r">i</span>].<span class="i">Value</span>;
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <span class="r38 r">value</span> = <b>default</b>(<span class="r35 r t">TValue</span>);
            <b>return</b> <b>false</b>;
        }
 
        <b>public bool</b> <a id="d50355ba2481a122" href="../../R/d50355ba2481a122.html" target="n" data-glyph="72,1" class="i method">Remove</a>(<span class="r34 r t">TKey</span> <span id="r40 rd" class="r40 r">key</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r40 r">key</span> != <b>null</b>);
 
            <b>if</b> (<a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> != <b>null</b>)
            {
                <b>return</b> <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>.<span class="i">Remove</span>(<span class="r40 r">key</span>);
            }
            <b>else</b> <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> != <b>null</b>)
            {
                <b>for</b> (<b>int</b> <span id="r41 rd" class="r41 r">i</span> = 0; <span class="r41 r">i</span> &lt; <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>.<span class="i">Length</span>; <span class="r41 r">i</span>++)
                {
                    <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r41 r">i</span>].<span class="i">Key</span> == <span class="r40 r">key</span>)
                    {
                        <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r41 r">i</span>] = <b>new</b> <span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;();
                        <a href="#d839ca17082c9ef9" class="i field">_count</a>--;
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>public bool</b> <a id="e3bc177c470c5b4f" href="../../R/e3bc177c470c5b4f.html" target="n" data-glyph="72,1" class="i method">ContainsKey</a>(<span class="r34 r t">TKey</span> <span id="r42 rd" class="r42 r">key</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r42 r">key</span> != <b>null</b>);
 
            <b>if</b> (<a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> != <b>null</b>)
            {
                <b>return</b> <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>.<span class="i">ContainsKey</span>(<span class="r42 r">key</span>);
            }
            <b>else</b> <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> != <b>null</b>)
            {
                <b>for</b> (<b>int</b> <span id="r43 rd" class="r43 r">i</span> = 0; <span class="r43 r">i</span> &lt; <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>.<span class="i">Length</span>; <span class="r43 r">i</span>++)
                {
                    <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r43 r">i</span>].<span class="i">Key</span> == <span class="r42 r">key</span>)
                    {
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>public int</b> <a id="844d9959f4061846" href="../../R/844d9959f4061846.html" target="n" data-glyph="102,1" class="i property">Count</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> != <b>null</b>)
                {
                    <b>return</b> <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>.<span class="i">Count</span>;
                }
 
                <b>return</b> <a href="#d839ca17082c9ef9" class="i field">_count</a>;
            }
        }
 
        <b>public</b> <span class="i">IEnumerator</span>&lt;<span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;&gt; <a id="0da2322c68f8e4fd" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetEnumerator</a>()
        {
            <b>if</b> (<a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> != <b>null</b>)
            {
                <b>return</b> <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>.<span class="i">GetEnumerator</span>();
            }
 
            <b>return</b> <a href="#2dd1362806b78357" class="i method">GetEnumeratorWorker</a>();
        }
 
        <b>private</b> <span class="i">IEnumerator</span>&lt;<span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;&gt; <a id="2dd1362806b78357" href="../../R/2dd1362806b78357.html" target="n" data-glyph="76,1" class="i method">GetEnumeratorWorker</a>()
        {
            <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> != <b>null</b>)
            {
                <b>for</b> (<b>int</b> <span id="r44 rd" class="r44 r">i</span> = 0; <span class="r44 r">i</span> &lt; <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>.<span class="i">Length</span>; <span class="r44 r">i</span>++)
                {
                    <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r44 r">i</span>].<span class="i">Key</span> != <b>null</b>)
                    {
                        <b>yield</b> <b>return</b> <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r44 r">i</span>];
                    }
                }
            }
        }
 
        <b>public</b> <span class="r35 r t">TValue</span> <a id="a9fed564f0d45f1a" href="../../R/a9fed564f0d45f1a.html" target="n" data-glyph="102,1" class="k">this</a>[<span class="r34 r t">TKey</span> <span id="r45 rd" class="r45 r">key</span>]
        {
            <b>get</b>
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r45 r">key</span> != <b>null</b>);
 
                <span class="r35 r t">TValue</span> <span id="r46 rd" class="r46 r">res</span>;
                <b>if</b> (<a href="#8c776c95f5b40495" class="i method">TryGetValue</a>(<span class="r45 r">key</span>, <b>out</b> <span class="r46 r">res</span>))
                {
                    <b>return</b> <span class="r46 r">res</span>;
                }
 
                <b>throw</b> <b>new</b> <span class="i">KeyNotFoundException</span>();
            }
 
            <b>set</b>
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r45 r">key</span> != <b>null</b>);
 
                <b>if</b> (<a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> != <b>null</b>)
                {
                    <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>[<span class="r45 r">key</span>] = <b>value</b>;
                }
                <b>else</b>
                {
                    <b>int</b> <span id="r47 rd" class="r47 r">index</span>;
                    <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> != <b>null</b>)
                    {
                        <span class="r47 r">index</span> = -1;
                        <b>for</b> (<b>int</b> <span id="r48 rd" class="r48 r">i</span> = 0; <span class="r48 r">i</span> &lt; <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>.<span class="i">Length</span>; <span class="r48 r">i</span>++)
                        {
                            <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r48 r">i</span>].<span class="i">Key</span> == <span class="r45 r">key</span>)
                            {
                                <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r48 r">i</span>] = <b>new</b> <span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;(<span class="r45 r">key</span>, <b>value</b>);
                                <b>return</b>;
                            }
                            <b>else</b> <b>if</b> (<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r48 r">i</span>].<span class="i">Key</span> == <b>null</b>)
                            {
                                <span class="r47 r">index</span> = <span class="r48 r">i</span>;
                            }
                        }
                    }
                    <b>else</b>
                    {
                        <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> = <b>new</b> <span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;[<a href="#fd075ab7aa6aae45" class="i field">_arraySize</a>];
                        <span class="r47 r">index</span> = 0;
                    }
 
                    <b>if</b> (<span class="r47 r">index</span> != -1)
                    {
                        <a href="#d839ca17082c9ef9" class="i field">_count</a>++;
                        <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r47 r">index</span>] = <b>new</b> <span class="i">KeyValuePair</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;(<span class="r45 r">key</span>, <b>value</b>);
                    }
                    <b>else</b>
                    {
                        <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="r34 r t">TKey</span>, <span class="r35 r t">TValue</span>&gt;();
                        <b>for</b> (<b>int</b> <span id="r49 rd" class="r49 r">i</span> = 0; <span class="r49 r">i</span> &lt; <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>.<span class="i">Length</span>; <span class="r49 r">i</span>++)
                        {
                            <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>[<a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r49 r">i</span>].<span class="i">Key</span>] = <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a>[<span class="r49 r">i</span>].<span class="i">Value</span>;
                        }
 
                        <a href="#dedecaf13761a19c" class="i field">_keysAndValues</a> = <b>null</b>;
 
                        <a href="#1ceabfbc1c5ba5fa" class="i field">_dict</a>[<span class="r45 r">key</span>] = <b>value</b>;
                    }
                }
            }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provides a dictionary-like object used for caches which holds onto a maximum</span>
    <span class="c">///</span><span class="c"> number of elements specified at construction time.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> This class is not thread safe.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="e1d181264f26908a" href="../../R/e1d181264f26908a.html" target="n" data-glyph="2,0" class="t t">CacheDict</a>&lt;<span id="r50 rd t" class="r50 r t">TKey</span>, <span id="r51 rd t" class="r51 r t">TValue</span>&gt;
    {
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<span class="r50 r t">TKey</span>, <a href="#6d98a07ec10aafa7" class="t t">KeyInfo</a>&gt; <a id="bf7e13c86f2314a7" href="../../R/bf7e13c86f2314a7.html" target="n" data-glyph="46,1" class="i field">_dict</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="r50 r t">TKey</span>, <a href="#6d98a07ec10aafa7" class="t t">KeyInfo</a>&gt;();
        <b>private readonly</b> <span class="i">LinkedList</span>&lt;<span class="r50 r t">TKey</span>&gt; <a id="3d72433a2511bd16" href="../../R/3d72433a2511bd16.html" target="n" data-glyph="46,1" class="i field">_list</a> = <b>new</b> <span class="i">LinkedList</span>&lt;<span class="r50 r t">TKey</span>&gt;();
        <b>private readonly int</b> <a id="6dad523d3eb64a18" href="../../R/6dad523d3eb64a18.html" target="n" data-glyph="46,1" class="i field">_maxSize</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a dictionary-like object used for caches.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">maxSize</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum number of elements to store.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="e1b2af425f3a2e8f" href="../../R/e1b2af425f3a2e8f.html" target="n" data-glyph="72,1" class="t constructor">CacheDict</a>(<b>int</b> <span id="r52 rd" class="r52 r">maxSize</span>)
        {
            <a href="#6dad523d3eb64a18" class="i field">_maxSize</a> = <span class="r52 r">maxSize</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Tries to get the value associated with &#39;key&#39;, returning true if it&#39;s found and</span>
        <span class="c">///</span><span class="c"> false if it&#39;s not present.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="9b1fd092cd08575a" href="../../R/9b1fd092cd08575a.html" target="n" data-glyph="72,1" class="i method">TryGetValue</a>(<span class="r50 r t">TKey</span> <span id="r53 rd" class="r53 r">key</span>, <b>out</b> <span class="r51 r t">TValue</span> <span id="r54 rd" class="r54 r">value</span>)
        {
            <a href="#6d98a07ec10aafa7" class="t t">KeyInfo</a> <span id="r55 rd" class="r55 r">storedValue</span>;
            <b>if</b> (<a href="#bf7e13c86f2314a7" class="i field">_dict</a>.<span class="i">TryGetValue</span>(<span class="r53 r">key</span>, <b>out</b> <span class="r55 r">storedValue</span>))
            {
                <span class="i">LinkedListNode</span>&lt;<span class="r50 r t">TKey</span>&gt; <span id="r56 rd" class="r56 r">node</span> = <span class="r55 r">storedValue</span>.<a href="#f8487d22d08eb1e2" class="i field">List</a>;
                <b>if</b> (<span class="r56 r">node</span>.<span class="i">Previous</span> != <b>null</b>)
                {
                    <span class="c">// move us to the head of the list...</span>
                    <a href="#3d72433a2511bd16" class="i field">_list</a>.<span class="i">Remove</span>(<span class="r56 r">node</span>);
                    <a href="#3d72433a2511bd16" class="i field">_list</a>.<span class="i">AddFirst</span>(<span class="r56 r">node</span>);
                }
 
                <span class="r54 r">value</span> = <span class="r55 r">storedValue</span>.<a href="#86905bd0be458fb9" class="i field">Value</a>;
                <b>return</b> <b>true</b>;
            }
 
            <span class="r54 r">value</span> = <b>default</b>(<span class="r51 r t">TValue</span>);
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds a new element to the cache, replacing and moving it to the front if the</span>
        <span class="c">///</span><span class="c"> element is already present.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="1d5de035788297ed" href="../../R/1d5de035788297ed.html" target="n" data-glyph="72,1" class="i method">Add</a>(<span class="r50 r t">TKey</span> <span id="r57 rd" class="r57 r">key</span>, <span class="r51 r t">TValue</span> <span id="r58 rd" class="r58 r">value</span>)
        {
            <a href="#6d98a07ec10aafa7" class="t t">KeyInfo</a> <span id="r59 rd" class="r59 r">keyInfo</span>;
            <b>if</b> (<a href="#bf7e13c86f2314a7" class="i field">_dict</a>.<span class="i">TryGetValue</span>(<span class="r57 r">key</span>, <b>out</b> <span class="r59 r">keyInfo</span>))
            {
                <span class="c">// remove original entry from the linked list</span>
                <a href="#3d72433a2511bd16" class="i field">_list</a>.<span class="i">Remove</span>(<span class="r59 r">keyInfo</span>.<a href="#f8487d22d08eb1e2" class="i field">List</a>);
            }
            <b>else</b> <b>if</b> (<a href="#3d72433a2511bd16" class="i field">_list</a>.<span class="i">Count</span> == <a href="#6dad523d3eb64a18" class="i field">_maxSize</a>)
            {
                <span class="c">// we&#39;ve reached capacity, remove the last used element...</span>
                <span class="i">LinkedListNode</span>&lt;<span class="r50 r t">TKey</span>&gt; <span id="r60 rd" class="r60 r">node</span> = <a href="#3d72433a2511bd16" class="i field">_list</a>.<span class="i">Last</span>;
                <a href="#3d72433a2511bd16" class="i field">_list</a>.<span class="i">RemoveLast</span>();
                <b>bool</b> <span id="r61 rd" class="r61 r">res</span> = <a href="#bf7e13c86f2314a7" class="i field">_dict</a>.<span class="i">Remove</span>(<span class="r60 r">node</span>.<span class="i">Value</span>);
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r61 r">res</span>);
            }
 
            <span class="c">// add the new entry to the head of the list and into the dictionary</span>
            <span class="i">LinkedListNode</span>&lt;<span class="r50 r t">TKey</span>&gt; <span id="r62 rd" class="r62 r">listNode</span> = <b>new</b> <span class="i">LinkedListNode</span>&lt;<span class="r50 r t">TKey</span>&gt;(<span class="r57 r">key</span>);
            <a href="#3d72433a2511bd16" class="i field">_list</a>.<span class="i">AddFirst</span>(<span class="r62 r">listNode</span>);
            <a href="#bf7e13c86f2314a7" class="i field">_dict</a>[<span class="r57 r">key</span>] = <b>new</b> <a href="#e1d181264f26908a" class="t t">CacheDict</a>&lt;<span class="r50 r t">TKey</span>, <span class="r51 r t">TValue</span>&gt;.<a href="#f2dae55fbfee8305" class="t constructor">KeyInfo</a>(<span class="r58 r">value</span>, <span class="r62 r">listNode</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the value associated with the given key, or throws KeyNotFoundException</span>
        <span class="c">///</span><span class="c"> if the key is not present.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1065:DoNotRaiseExceptionsInUnexpectedLocations&quot;</span>)]
        <b>public</b> <span class="r51 r t">TValue</span> <a id="2a5b171a284cfc9c" href="../../R/2a5b171a284cfc9c.html" target="n" data-glyph="102,1" class="k">this</a>[<span class="r50 r t">TKey</span> <span id="r63 rd" class="r63 r">key</span>]
        {
            <b>get</b>
            {
                <span class="r51 r t">TValue</span> <span id="r64 rd" class="r64 r">res</span>;
                <b>if</b> (<a href="#9b1fd092cd08575a" class="i method">TryGetValue</a>(<span class="r63 r">key</span>, <b>out</b> <span class="r64 r">res</span>))
                {
                    <b>return</b> <span class="r64 r">res</span>;
                }
 
                <b>throw</b> <b>new</b> <span class="i">KeyNotFoundException</span>();
            }
 
            <b>set</b>
            {
                <a href="#1d5de035788297ed" class="i method">Add</a>(<span class="r63 r">key</span>, <b>value</b>);
            }
        }
 
        <b>private readonly struct</b> <a id="6d98a07ec10aafa7" href="../../R/6d98a07ec10aafa7.html" target="n" data-glyph="112,1" class="t t"><span id="2c266df111e8fdfe">KeyInfo</span></a>
        {
            <b>internal readonly</b> <span class="r51 r t">TValue</span> <a id="86905bd0be458fb9" href="../../R/86905bd0be458fb9.html" target="n" data-glyph="44,2" class="i field">Value</a>;
            <b>internal readonly</b> <span class="i">LinkedListNode</span>&lt;<span class="r50 r t">TKey</span>&gt; <a id="f8487d22d08eb1e2" href="../../R/f8487d22d08eb1e2.html" target="n" data-glyph="44,2" class="i field">List</a>;
 
            <b>internal</b> <a id="f2dae55fbfee8305" href="../../R/f2dae55fbfee8305.html" target="n" data-glyph="74,2" class="t constructor">KeyInfo</a>(<span class="r51 r t">TValue</span> <span id="r65 rd" class="r65 r">value</span>, <span class="i">LinkedListNode</span>&lt;<span class="r50 r t">TKey</span>&gt; <span id="r66 rd" class="r66 r">list</span>)
            {
                <a href="#86905bd0be458fb9" class="i field">Value</a> = <span class="r65 r">value</span>;
                <a href="#f8487d22d08eb1e2" class="i field">List</a> = <span class="r66 r">list</span>;
            }
        }
    }
 
    <b>internal class</b> <a id="f05b0aab4a9289b9" href="../../R/f05b0aab4a9289b9.html" target="n" data-glyph="2,0" class="t t">ThreadLocal</a>&lt;<span id="r67 rd t" class="r67 r t">T</span>&gt;
    {
        <b>private</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[] <a id="c2b406898800ed64" href="../../R/c2b406898800ed64.html" target="n" data-glyph="46,1" class="i field">_stores</a>;                                         <span class="c">// array of storage indexed by managed thread ID</span>
        <b>private static readonly</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[] <a id="87df33d516718ec0" href="../../R/87df33d516718ec0.html" target="n" data-glyph="46,1" class="i field">s_updating</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>&gt;();   <span class="c">// a marker used when updating the array</span>
        <b>private readonly bool</b> <a id="6f483a7e49e8606c" href="../../R/6f483a7e49e8606c.html" target="n" data-glyph="46,1" class="i field">_refCounted</a>;
 
        <b>public</b> <a id="5cefab83ed93e1a9" href="../../R/5cefab83ed93e1a9.html" target="n" data-glyph="72,1" class="t constructor">ThreadLocal</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the caller will guarantee that all cleanup happens as the thread</span>
        <span class="c">///</span><span class="c"> unwinds.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This is typically used in a case where the thread local is surrounded by</span>
        <span class="c">///</span><span class="c"> a try/finally block.  The try block pushes some state, the finally block</span>
        <span class="c">///</span><span class="c"> restores the previous state.  Therefore when the thread exits the thread</span>
        <span class="c">///</span><span class="c"> local is back to it&#39;s original state.  This allows the ThreadLocal object</span>
        <span class="c">///</span><span class="c"> to not check the current owning thread on retrieval.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="fc7eb3dff066c7bd" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ThreadLocal</a>(<b>bool</b> <span id="r68 rd" class="r68 r">refCounted</span>)
        {
            <a href="#6f483a7e49e8606c" class="i field">_refCounted</a> = <span class="r68 r">refCounted</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Public API
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the value for the current thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="r67 r t">T</span> <a id="03c8b2af00078399" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Value</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#2faaceef1d9d41fe" class="i method">GetStorageInfo</a>().<a href="#798a9858acf27b33" class="i field">Value</a>;
            }
 
            <b>set</b>
            {
                <a href="#2faaceef1d9d41fe" class="i method">GetStorageInfo</a>().<a href="#798a9858acf27b33" class="i field">Value</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the current value if its not == null or calls the provided function</span>
        <span class="c">///</span><span class="c"> to create a new value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="r67 r t">T</span> <a id="e7336c53376c078e" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetOrCreate</a>(<span class="i">Func</span>&lt;<span class="r67 r t">T</span>&gt; <span id="r69 rd" class="r69 r">func</span>)
        {
            <a href="#f760db0369027867" class="t t">Assert</a>.<span class="i">NotNull</span>(<span class="r69 r">func</span>);
 
            <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <span id="r70 rd" class="r70 r">si</span> = <a href="#2faaceef1d9d41fe" class="i method">GetStorageInfo</a>();
            <span class="r67 r t">T</span> <span id="r71 rd" class="r71 r">res</span> = <span class="r70 r">si</span>.<a href="#798a9858acf27b33" class="i field">Value</a>;
            <b>if</b> (<span class="r71 r">res</span> == <b>null</b>)
            {
                <span class="r70 r">si</span>.<a href="#798a9858acf27b33" class="i field">Value</a> = <span class="r71 r">res</span> = <span class="r69 r">func</span>();
            }
 
            <b>return</b> <span class="r71 r">res</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calls the provided update function with the current value and</span>
        <span class="c">///</span><span class="c"> replaces the current value with the result of the function.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="r67 r t">T</span> <a id="00e470b6eee94b93" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Update</a>(<span class="i">Func</span>&lt;<span class="r67 r t">T</span>, <span class="r67 r t">T</span>&gt; <span id="r72 rd" class="r72 r">updater</span>)
        {
            <a href="#f760db0369027867" class="t t">Assert</a>.<span class="i">NotNull</span>(<span class="r72 r">updater</span>);
 
            <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <span id="r73 rd" class="r73 r">si</span> = <a href="#2faaceef1d9d41fe" class="i method">GetStorageInfo</a>();
            <b>return</b> <span class="r73 r">si</span>.<a href="#798a9858acf27b33" class="i field">Value</a> = <span class="r72 r">updater</span>(<span class="r73 r">si</span>.<a href="#798a9858acf27b33" class="i field">Value</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Replaces the current value with a new one and returns the old value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <span class="r67 r t">T</span> <a id="9bc75bbfa6c3a211" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Update</a>(<span class="r67 r t">T</span> <span id="r74 rd" class="r74 r">newValue</span>)
        {
            <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <span id="r75 rd" class="r75 r">si</span> = <a href="#2faaceef1d9d41fe" class="i method">GetStorageInfo</a>();
            <span class="r67 r t">var</span> <span id="r76 rd" class="r76 r">oldValue</span> = <span class="r75 r">si</span>.<a href="#798a9858acf27b33" class="i field">Value</a>;
            <span class="r75 r">si</span>.<a href="#798a9858acf27b33" class="i field">Value</a> = <span class="r74 r">newValue</span>;
            <b>return</b> <span class="r76 r">oldValue</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Storage implementation
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the StorageInfo for the current thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <a id="2faaceef1d9d41fe" href="../../R/2faaceef1d9d41fe.html" target="n" data-glyph="72,1" class="i method">GetStorageInfo</a>()
        {
            <b>return</b> <a href="#075d81ce46837712" class="i method">GetStorageInfo</a>(<a href="#c2b406898800ed64" class="i field">_stores</a>);
        }
 
        <b>private</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <a id="075d81ce46837712" href="../../R/075d81ce46837712.html" target="n" data-glyph="76,1" class="i method">GetStorageInfo</a>(<a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[] <span id="r77 rd" class="r77 r">curStorage</span>)
        {
            <b>int</b> <span id="r78 rd" class="r78 r">threadId</span> = <span class="i">Environment</span>.<span class="i">CurrentManagedThreadId</span>;
 
            <span class="c">// fast path if we already have a value in the array</span>
            <b>if</b> (<span class="r77 r">curStorage</span> != <b>null</b> &amp;&amp; <span class="r77 r">curStorage</span>.<span class="i">Length</span> &gt; <span class="r78 r">threadId</span>)
            {
                <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <span id="r79 rd" class="r79 r">res</span> = <span class="r77 r">curStorage</span>[<span class="r78 r">threadId</span>];
 
                <b>if</b> (<span class="r79 r">res</span> != <b>null</b> &amp;&amp; (<a href="#6f483a7e49e8606c" class="i field">_refCounted</a> || <span class="r79 r">res</span>.<a href="#b2ec25810f26a61a" class="i field">Thread</a> == <span class="i">Thread</span>.<span class="i">CurrentThread</span>))
                {
                    <b>return</b> <span class="r79 r">res</span>;
                }
            }
 
            <b>return</b> <a href="#6d1bbc093932151f" class="i method">RetryOrCreateStorageInfo</a>(<span class="r77 r">curStorage</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called when the fast path storage lookup fails. if we encountered the Empty storage</span>
        <span class="c">///</span><span class="c"> during the initial fast check then spin until we hit non-empty storage and try the fast</span>
        <span class="c">///</span><span class="c"> path again.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <a id="6d1bbc093932151f" href="../../R/6d1bbc093932151f.html" target="n" data-glyph="76,1" class="i method">RetryOrCreateStorageInfo</a>(<a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[] <span id="r80 rd" class="r80 r">curStorage</span>)
        {
            <b>if</b> (<span class="r80 r">curStorage</span> == <a href="#87df33d516718ec0" class="i field">s_updating</a>)
            {
                <span class="c">// we need to retry</span>
                <b>while</b> ((<span class="r80 r">curStorage</span> = <a href="#c2b406898800ed64" class="i field">_stores</a>) == <a href="#87df33d516718ec0" class="i field">s_updating</a>)
                {
                    <span class="i">Thread</span>.<span class="i">Sleep</span>(0);
                }
 
                <span class="c">// we now have a non-empty storage info to retry with</span>
                <b>return</b> <a href="#075d81ce46837712" class="i method">GetStorageInfo</a>(<span class="r80 r">curStorage</span>);
            }
 
            <span class="c">// we need to mutate the StorageInfo[] array or create a new StorageInfo</span>
            <b>return</b> <a href="#179a9d536a937b12" class="i method">CreateStorageInfo</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates the StorageInfo for the thread when one isn&#39;t already present.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <a id="179a9d536a937b12" href="../../R/179a9d536a937b12.html" target="n" data-glyph="76,1" class="i method">CreateStorageInfo</a>()
        {
            <span class="c">// we do our own locking, tell hosts this is a bad time to interrupt us.</span>
            <span class="i">Thread</span>.<span class="i">BeginCriticalRegion</span>();
 
            <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[] <span id="r81 rd" class="r81 r">curStorage</span> = <a href="#87df33d516718ec0" class="i field">s_updating</a>;
            <b>try</b>
            {
                <b>int</b> <span id="r82 rd" class="r82 r">threadId</span> = <span class="i">Environment</span>.<span class="i">CurrentManagedThreadId</span>;
                <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a> <span id="r83 rd" class="r83 r">newInfo</span> = <b>new</b> <span class="t">StorageInfo</span>(<span class="i">Thread</span>.<span class="i">CurrentThread</span>);
 
                <span class="c">// set to updating while potentially resizing/mutating, then we&#39;ll</span>
                <span class="c">// set back to the current value.</span>
                <b>while</b> ((<span class="r81 r">curStorage</span> = <span class="i">Interlocked</span>.<span class="i">Exchange</span>(<b>ref</b> <a href="#c2b406898800ed64" class="i field">_stores</a>, <a href="#87df33d516718ec0" class="i field">s_updating</a>)) == <a href="#87df33d516718ec0" class="i field">s_updating</a>)
                {
                    <span class="c">// another thread is already updating...</span>
                    <span class="i">Thread</span>.<span class="i">Sleep</span>(0);
                }
 
                <span class="c">// check and make sure we have a space in the array for our value</span>
                <b>if</b> (<span class="r81 r">curStorage</span> == <b>null</b>)
                {
                    <span class="r81 r">curStorage</span> = <b>new</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[<span class="r82 r">threadId</span> + 1];
                }
                <b>else</b> <b>if</b> (<span class="r81 r">curStorage</span>.<span class="i">Length</span> &lt;= <span class="r82 r">threadId</span>)
                {
                    <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[] <span id="r84 rd" class="r84 r">newStorage</span> = <b>new</b> <a href="#5bda58d84d8eae37" class="t t">StorageInfo</a>[<span class="r82 r">threadId</span> + 1];
                    <b>for</b> (<b>int</b> <span id="r85 rd" class="r85 r">i</span> = 0; <span class="r85 r">i</span> &lt; <span class="r81 r">curStorage</span>.<span class="i">Length</span>; <span class="r85 r">i</span>++)
                    {
                        <span class="c">// leave out the threads that have exited</span>
                        <b>if</b> (<span class="r81 r">curStorage</span>[<span class="r85 r">i</span>] != <b>null</b> &amp;&amp; <span class="r81 r">curStorage</span>[<span class="r85 r">i</span>].<a href="#b2ec25810f26a61a" class="i field">Thread</a>.<span class="i">IsAlive</span>)
                        {
                            <span class="r84 r">newStorage</span>[<span class="r85 r">i</span>] = <span class="r81 r">curStorage</span>[<span class="r85 r">i</span>];
                        }
                    }
 
                    <span class="r81 r">curStorage</span> = <span class="r84 r">newStorage</span>;
                }
 
                <span class="c">// create our StorageInfo in the array, the empty check ensures we&#39;re only here</span>
                <span class="c">// when we need to create.</span>
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r81 r">curStorage</span>[<span class="r82 r">threadId</span>] == <b>null</b> || <span class="r81 r">curStorage</span>[<span class="r82 r">threadId</span>].<a href="#b2ec25810f26a61a" class="i field">Thread</a> != <span class="i">Thread</span>.<span class="i">CurrentThread</span>);
 
                <b>return</b> <span class="r81 r">curStorage</span>[<span class="r82 r">threadId</span>] = <span class="r83 r">newInfo</span>;
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r81 r">curStorage</span> != <a href="#87df33d516718ec0" class="i field">s_updating</a>)
                {
                    <span class="c">// let others access the storage again</span>
                    <span class="i">Interlocked</span>.<span class="i">Exchange</span>(<b>ref</b> <a href="#c2b406898800ed64" class="i field">_stores</a>, <span class="r81 r">curStorage</span>);
                }
 
                <span class="i">Thread</span>.<span class="i">EndCriticalRegion</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper class for storing the value.  We need to track if a ManagedThreadId</span>
        <span class="c">///</span><span class="c"> has been re-used so we also store the thread which owns the value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1034:NestedTypesShouldNotBeVisible&quot;</span>)] <span class="c">// TODO</span>
        <b>internal sealed class</b> <a id="5bda58d84d8eae37" href="../../R/5bda58d84d8eae37.html" target="n" data-glyph="2,1" class="t t">StorageInfo</a>
        {
            <b>internal readonly</b> <span class="i">Thread</span> <a id="b2ec25810f26a61a" href="../../R/b2ec25810f26a61a.html" target="n" data-glyph="44,2" class="i field">Thread</a>;                 <span class="c">// the thread that owns the StorageInfo</span>
            <b>public</b> <span class="r67 r t">T</span> <a id="798a9858acf27b33" href="../../R/798a9858acf27b33.html" target="n" data-glyph="42,2" class="i field">Value</a>;                                <span class="c">// the current value for the owning thread</span>
 
            <b>internal</b> <a id="bbae4f0be29f0b1f" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">StorageInfo</a>(<span class="i">Thread</span> <span id="r86 rd" class="r86 r">curThread</span>)
            {
                <a href="#f760db0369027867" class="t t">Assert</a>.<span class="i">NotNull</span>(<span class="r86 r">curThread</span>);
 
                <a href="#b2ec25810f26a61a" class="i field">Thread</a> = <span class="r86 r">curThread</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <b>internal static class</b> <a id="f760db0369027867" href="../../R/f760db0369027867.html" target="n" data-glyph="2,0" class="t t">Assert</a>
    {
        <b>internal static</b> <span class="i">Exception</span> <a id="176abe9780c04116" href="../../R/176abe9780c04116.html" target="n" data-glyph="104,1" class="i property">Unreachable</a>
        {
            <b>get</b>
            {
                <span class="i">Debug</span>.<span class="i">Fail</span>(<span class="s">&quot;Unreachable&quot;</span>);
                <b>return</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="s">&quot;Code supposed to be unreachable&quot;</span>);
            }
        }
 
        [<span class="i">Conditional</span>(<span class="s">&quot;DEBUG&quot;</span>)]
        <b>public static void</b> <a id="0ee6f56c01666d0c" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NotNull</a>(<b>object</b> <span id="r87 rd" class="r87 r">var</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r87 r">var</span> != <b>null</b>);
        }
 
        [<span class="i">Conditional</span>(<span class="s">&quot;DEBUG&quot;</span>)]
        <b>public static void</b> <a id="9dc7a4ffcfa2084e" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NotNull</a>(<b>object</b> <span id="r88 rd" class="r88 r">var1</span>, <b>object</b> <span id="r89 rd" class="r89 r">var2</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r88 r">var1</span> != <b>null</b> &amp;&amp; <span class="r89 r">var2</span> != <b>null</b>);
        }
 
        [<span class="i">Conditional</span>(<span class="s">&quot;DEBUG&quot;</span>)]
        <b>public static void</b> <a id="e60a991c0ce9fbe1" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NotNull</a>(<b>object</b> <span id="r90 rd" class="r90 r">var1</span>, <b>object</b> <span id="r91 rd" class="r91 r">var2</span>, <b>object</b> <span id="r92 rd" class="r92 r">var3</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r90 r">var1</span> != <b>null</b> &amp;&amp; <span class="r91 r">var2</span> != <b>null</b> &amp;&amp; <span class="r92 r">var3</span> != <b>null</b>);
        }
 
        [<span class="i">Conditional</span>(<span class="s">&quot;DEBUG&quot;</span>)]
        <b>public static void</b> <a id="c33ef391d201cb53" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NotNullItems</a>&lt;<span id="r93 rd t" class="r93 r t">T</span>&gt;(<span class="i">IEnumerable</span>&lt;<span class="r93 r t">T</span>&gt; <span id="r94 rd" class="r94 r">items</span>) <b>where</b> <span class="r93 r t">T</span> : <b>class</b>
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r94 r">items</span> != <b>null</b>);
            <b>foreach</b> (<b>object</b> <span id="r95 rd" class="r95 r">item</span> <b>in</b> <span class="r94 r">items</span>)
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r95 r">item</span> != <b>null</b>);
            }
        }
 
        [<span class="i">Conditional</span>(<span class="s">&quot;DEBUG&quot;</span>)]
        <b>public static void</b> <a id="db3499d421430f4f" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NotEmpty</a>(<b>string</b> <span id="r96 rd" class="r96 r">str</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r96 r">str</span>));
        }
    }
 
    [<span class="i">Flags</span>]
    <b>internal enum</b> <a id="4b9f85886332e3c3" href="../../R/4b9f85886332e3c3.html" target="n" data-glyph="20,0" class="t t"><span id="2205f1d2214d758c">ExpressionAccess</span></a>
    {
        <a id="90e202e6b3e37b28" href="../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">None</a> = 0,
        <a id="f0a61e2f3516b768" href="../../R/f0a61e2f3516b768.html" target="n" data-glyph="24,1" class="i field">Read</a> = 1,
        <a id="092dbaca4ce2eb02" href="../../R/092dbaca4ce2eb02.html" target="n" data-glyph="24,1" class="i field">Write</a> = 2,
        <a id="3a3c9ca07baf7606" href="../../R/../../0000000000.html" target="n" data-glyph="24,1" class="i field">ReadWrite</a> = <a href="#f0a61e2f3516b768" class="i field">Read</a> | <a href="#092dbaca4ce2eb02" class="i field">Write</a>,
    }
 
    <b>internal static class</b> <a id="55b509010bbde4b3" href="../../R/55b509010bbde4b3.html" target="n" data-glyph="2,0" class="t t">Utils</a>
    {
        <b>internal static</b> <span class="i">Expression</span> <a id="2eea3151334bc1dd" href="../../R/2eea3151334bc1dd.html" target="n" data-glyph="74,1" class="i method">Constant</a>(<b>object</b> <span id="r97 rd" class="r97 r">value</span>)
        {
            <b>return</b> <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r97 r">value</span>);
        }
 
        <b>private static readonly</b> <span class="i">DefaultExpression</span> <a id="76db2bee4287f6b1" href="../../R/76db2bee4287f6b1.html" target="n" data-glyph="46,1" class="i field">s_voidInstance</a> = <span class="i">Expression</span>.<span class="i">Empty</span>();
 
        <b>public static</b> <span class="i">DefaultExpression</span> <a id="547d86c412e6b1a1" href="../../R/547d86c412e6b1a1.html" target="n" data-glyph="72,1" class="i method">Empty</a>()
        {
            <b>return</b> <a href="#76db2bee4287f6b1" class="i field">s_voidInstance</a>;
        }
 
        <b>public static</b> <span class="i">Expression</span> <a id="710429eb74d33670" href="../../R/710429eb74d33670.html" target="n" data-glyph="72,1" class="i method">Void</a>(<span class="i">Expression</span> <span id="r98 rd" class="r98 r">expression</span>)
        {
            <span class="c">// ContractUtils.RequiresNotNull(expression, &quot;expression&quot;);</span>
            <b>if</b> (<span class="r98 r">expression</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>))
            {
                <b>return</b> <span class="r98 r">expression</span>;
            }
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Block</span>(<span class="r98 r">expression</span>, <a href="#55b509010bbde4b3" class="t t">Utils</a>.<a href="#547d86c412e6b1a1" class="i method">Empty</a>());
        }
 
        <b>public static</b> <span class="i">DefaultExpression</span> <a id="84d71e90c2da9143" href="../../R/84d71e90c2da9143.html" target="n" data-glyph="72,1" class="i method">Default</a>(<span class="i">Type</span> <span id="r99 rd" class="r99 r">type</span>)
        {
            <b>if</b> (<span class="r99 r">type</span> == <b>typeof</b>(<b>void</b>))
            {
                <b>return</b> <a href="#547d86c412e6b1a1" class="i method">Empty</a>();
            }
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Default</span>(<span class="r99 r">type</span>);
        }
 
        <b>public static</b> <span class="i">Expression</span> <a id="2bc958de9d8241b6" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Convert</a>(<span class="i">Expression</span> <span id="r100 rd" class="r100 r">expression</span>, <span class="i">Type</span> <span id="r101 rd" class="r101 r">type</span>)
        {
            <span class="c">// ContractUtils.RequiresNotNull(expression, &quot;expression&quot;);</span>
 
            <b>if</b> (<span class="r100 r">expression</span>.<span class="i">Type</span> == <span class="r101 r">type</span>)
            {
                <b>return</b> <span class="r100 r">expression</span>;
            }
 
            <b>if</b> (<span class="r100 r">expression</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>))
            {
                <b>return</b> <span class="i">Expression</span>.<span class="i">Block</span>(<span class="r100 r">expression</span>, <a href="#55b509010bbde4b3" class="t t">Utils</a>.<a href="#84d71e90c2da9143" class="i method">Default</a>(<span class="r101 r">type</span>));
            }
 
            <b>if</b> (<span class="r101 r">type</span> == <b>typeof</b>(<b>void</b>))
            {
                <b>return</b> <a href="#710429eb74d33670" class="i method">Void</a>(<span class="r100 r">expression</span>);
            }
 
            <span class="c">// TODO: this is not the right level for this to be at. It should</span>
            <span class="c">// be pushed into languages if they really want this behavior.</span>
            <b>if</b> (<span class="r101 r">type</span> == <b>typeof</b>(<b>object</b>))
            {
                <b>return</b> <a href="#57bed792ae237d82" class="i method">Box</a>(<span class="r100 r">expression</span>);
            }
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r100 r">expression</span>, <span class="r101 r">type</span>);
        }
 
        <b>public static</b> <span class="i">Expression</span> <a id="57bed792ae237d82" href="../../R/57bed792ae237d82.html" target="n" data-glyph="72,1" class="i method">Box</a>(<span class="i">Expression</span> <span id="r102 rd" class="r102 r">expression</span>)
        {
            <span class="i">MethodInfo</span> <span id="r103 rd" class="r103 r">m</span>;
            <b>if</b> (<span class="r102 r">expression</span>.<span class="i">Type</span> == <b>typeof</b>(<b>int</b>))
            {
                <span class="r103 r">m</span> = <a href="#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>.<a href="#2e7ec655a00075bd" class="i field">Int32ToObjectMethod</a>;
            }
            <b>else</b> <b>if</b> (<span class="r102 r">expression</span>.<span class="i">Type</span> == <b>typeof</b>(<b>bool</b>))
            {
                <span class="r103 r">m</span> = <a href="#f0537ca64373db8a" class="t t">ScriptingRuntimeHelpers</a>.<a href="#cb8b12785d412534" class="i field">BooleanToObjectMethod</a>;
            }
            <b>else</b>
            {
                <span class="r103 r">m</span> = <b>null</b>;
            }
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r102 r">expression</span>, <b>typeof</b>(<b>object</b>), <span class="r103 r">m</span>);
        }
 
        <b>public static bool</b> <a id="312a7a36d9d214bd" href="../../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">IsReadWriteAssignment</a>(<b>this</b> <span class="i">ExpressionType</span> <span id="r104 rd" class="r104 r">type</span>)
        {
            <b>switch</b> (<span class="r104 r">type</span>)
            {
                <span class="c">// unary:</span>
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PostDecrementAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PostIncrementAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PreDecrementAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PreIncrementAssign</span>:
 
                <span class="c">// binary - compound:</span>
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AddAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AddAssignChecked</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">AndAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">DivideAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ExclusiveOrAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LeftShiftAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ModuloAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MultiplyAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">MultiplyAssignChecked</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">OrAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">PowerAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">RightShiftAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">SubtractAssign</span>:
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">SubtractAssignChecked</span>:
                    <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
    }
 
    <b>internal static class</b> <a id="7d8e67832d1de728" href="../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">CollectionExtension</a>
    {
        <b>internal static bool</b> <a id="a17c9d5f160d8649" href="../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">TrueForAll</a>&lt;<span id="r105 rd t" class="r105 r t">T</span>&gt;(<b>this</b> <span class="i">IEnumerable</span>&lt;<span class="r105 r t">T</span>&gt; <span id="r106 rd" class="r106 r">collection</span>, <span class="i">Predicate</span>&lt;<span class="r105 r t">T</span>&gt; <span id="r107 rd" class="r107 r">predicate</span>)
        {
            <span class="c">// ContractUtils.RequiresNotNull(collection, &quot;collection&quot;);</span>
            <span class="c">// ContractUtils.RequiresNotNull(predicate, &quot;predicate&quot;);</span>
 
            <b>foreach</b> (<span class="r105 r t">T</span> <span id="r108 rd" class="r108 r">item</span> <b>in</b> <span class="r106 r">collection</span>)
            {
                <b>if</b> (!<span class="r107 r">predicate</span>(<span class="r108 r">item</span>)) <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static</b> <span class="r109 r t">TResult</span>[] <a id="e14af02bfe8e5d24" href="../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">Map</a>&lt;<span id="r110 rd t" class="r110 r t">TSource</span>, <span id="r109 rd t" class="r109 r t">TResult</span>&gt;(<b>this</b> <span class="i">ICollection</span>&lt;<span class="r110 r t">TSource</span>&gt; <span id="r111 rd" class="r111 r">source</span>, <span class="i">Func</span>&lt;<span class="r110 r t">TSource</span>, <span class="r109 r t">TResult</span>&gt; <span id="r112 rd" class="r112 r">selector</span>)
        {
            <b>int</b> <span id="r113 rd" class="r113 r">count</span> = <span class="r111 r">source</span>.<span class="i">Count</span>;
            <span class="r109 r t">TResult</span>[] <span id="r114 rd" class="r114 r">result</span> = <b>new</b> <span class="r109 r t">TResult</span>[<span class="r113 r">count</span>];
            <span class="r113 r">count</span> = 0;
            <b>foreach</b> (<span class="r110 r t">TSource</span> <span id="r115 rd" class="r115 r">t</span> <b>in</b> <span class="r111 r">source</span>)
            {
                <span class="r114 r">result</span>[<span class="r113 r">count</span>++] = <span class="r112 r">selector</span>(<span class="r115 r">t</span>);
            }
 
            <b>return</b> <span class="r114 r">result</span>;
        }
 
        <span class="c">// We could probably improve the hashing here</span>
        <b>internal static int</b> <a id="b9d415ed5ad784d9" href="../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">ListHashCode</a>&lt;<span id="r116 rd t" class="r116 r t">T</span>&gt;(<b>this</b> <span class="i">IEnumerable</span>&lt;<span class="r116 r t">T</span>&gt; <span id="r117 rd" class="r117 r">list</span>)
        {
            <b>var</b> <span id="r118 rd" class="r118 r">cmp</span> = <span class="i">EqualityComparer</span>&lt;<span class="r116 r t">T</span>&gt;.<span class="i">Default</span>;
            <b>int</b> <span id="r119 rd" class="r119 r">h</span> = 6551;
            <b>foreach</b> (<span class="r116 r t">T</span> <span id="r120 rd" class="r120 r">t</span> <b>in</b> <span class="r117 r">list</span>)
            {
                <span class="r119 r">h</span> ^= (<span class="r119 r">h</span> &lt;&lt; 5) ^ <span class="r118 r">cmp</span>.<span class="i">GetHashCode</span>(<span class="r120 r">t</span>);
            }
 
            <b>return</b> <span class="r119 r">h</span>;
        }
 
        <b>internal static bool</b> <a id="b34a5dccfdaf102c" href="../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">ListEquals</a>&lt;<span id="r121 rd t" class="r121 r t">T</span>&gt;(<b>this</b> <span class="i">ICollection</span>&lt;<span class="r121 r t">T</span>&gt; <span id="r122 rd" class="r122 r">first</span>, <span class="i">ICollection</span>&lt;<span class="r121 r t">T</span>&gt; <span id="r123 rd" class="r123 r">second</span>)
        {
            <b>if</b> (<span class="r122 r">first</span>.<span class="i">Count</span> != <span class="r123 r">second</span>.<span class="i">Count</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>var</b> <span id="r124 rd" class="r124 r">cmp</span> = <span class="i">EqualityComparer</span>&lt;<span class="r121 r t">T</span>&gt;.<span class="i">Default</span>;
            <b>var</b> <span id="r125 rd" class="r125 r">f</span> = <span class="r122 r">first</span>.<span class="i">GetEnumerator</span>();
            <b>var</b> <span id="r126 rd" class="r126 r">s</span> = <span class="r123 r">second</span>.<span class="i">GetEnumerator</span>();
            <b>while</b> (<span class="r125 r">f</span>.<span class="i">MoveNext</span>())
            {
                <span class="r126 r">s</span>.<span class="i">MoveNext</span>();
 
                <b>if</b> (!<span class="r124 r">cmp</span>.<span class="i">Equals</span>(<span class="r125 r">f</span>.<span class="i">Current</span>, <span class="r126 r">s</span>.<span class="i">Current</span>))
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>return</b> <b>true</b>;
        }
    }
 
    <b>internal sealed class</b> <a id="8a4dd1b830a3f777" href="../../R/8a4dd1b830a3f777.html" target="n" data-glyph="2,0" class="t t">ListEqualityComparer</a>&lt;<span id="r127 rd t" class="r127 r t">T</span>&gt; : <span class="i">EqualityComparer</span>&lt;<span class="i">ICollection</span>&lt;<span class="r127 r t">T</span>&gt;&gt;
    {
        <b>internal static readonly</b> <a href="#8a4dd1b830a3f777" class="t t">ListEqualityComparer</a>&lt;<span class="r127 r t">T</span>&gt; <a id="e56a22c627e056a1" href="../../R/../../0000000000.html" target="n" data-glyph="44,1" class="i field">Instance</a> = <b>new</b> <a href="#b97b6af4dd85aed2" class="t constructor">ListEqualityComparer</a>&lt;<span class="r127 r t">T</span>&gt;();
 
        <b>private</b> <a id="b97b6af4dd85aed2" href="../../R/b97b6af4dd85aed2.html" target="n" data-glyph="76,1" class="t constructor">ListEqualityComparer</a>() { }
 
        <span class="c">// EqualityComparer&lt;T&gt; handles null and object identity for us</span>
        <b>public override bool</b> <a id="16d8edc47adb3268" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Equals</a>(<span class="i">ICollection</span>&lt;<span class="r127 r t">T</span>&gt; <span id="r128 rd" class="r128 r">x</span>, <span class="i">ICollection</span>&lt;<span class="r127 r t">T</span>&gt; <span id="r129 rd" class="r129 r">y</span>)
        {
            <b>return</b> <span class="r128 r">x</span>.<span class="i">ListEquals</span>(<span class="r129 r">y</span>);
        }
 
        <b>public override int</b> <a id="bab9a2d350600b20" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetHashCode</a>(<span class="i">ICollection</span>&lt;<span class="r127 r t">T</span>&gt; <span id="r130 rd" class="r130 r">obj</span>)
        {
            <b>return</b> <span class="r130 r">obj</span>.<span class="i">ListHashCode</span>();
        }
    }
}
</pre></td></tr></table></div></body></html>
