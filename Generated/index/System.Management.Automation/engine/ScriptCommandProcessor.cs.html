<!DOCTYPE html>
<html><head><title>ScriptCommandProcessor.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(638);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/ScriptCommandProcessor.cs" target="_top">engine\ScriptCommandProcessor.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A common base class for code shared between an interpreted (old) script block and a compiled (new) script block.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal abstract class</b> <a id="d9f57c5c0946b36a" href="../R/d9f57c5c0946b36a.html" target="n" data-glyph="2,0" class="t t">ScriptCommandProcessorBase</a> : <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a>
    {
        <b>protected</b> <a id="37ba241daee615f0" href="../R/37ba241daee615f0.html" target="n" data-glyph="75,1" class="t constructor">ScriptCommandProcessorBase</a>(<a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r0 rd" class="r0 r">scriptBlock</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r1 rd" class="r1 r">context</span>, <b>bool</b> <span id="r2 rd" class="r2 r">useLocalScope</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r3 rd" class="r3 r">origin</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r4 rd" class="r4 r">sessionState</span>)
            : <a href="CommandProcessorBase.cs.html#64e9365f7027b222" class="k">base</a>(<b>new</b> <span class="t">ScriptInfo</span>(<b>string</b>.<span class="i">Empty</span>, <span class="r0 r">scriptBlock</span>, <span class="r1 r">context</span>))
        {
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="#4cdfaaa8bd12da5d" class="i field">_dontUseScopeCommandOrigin</a> = <b>false</b>;
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#0043954ffd6af0aa" class="i field">_fromScriptFile</a> = <b>false</b>;
 
            <a href="#529818453db4f3bd" class="i method">CommonInitialization</a>(<span class="r0 r">scriptBlock</span>, <span class="r1 r">context</span>, <span class="r2 r">useLocalScope</span>, <span class="r3 r">origin</span>, <span class="r4 r">sessionState</span>);
        }
 
        <b>protected</b> <a id="ef9c48e9b2553975" href="../R/ef9c48e9b2553975.html" target="n" data-glyph="75,1" class="t constructor">ScriptCommandProcessorBase</a>(<a href="CommandInfo.cs.html#2ae2bf5bb21a5a53" class="t t">IScriptCommandInfo</a> <span id="r5 rd" class="r5 r">commandInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r6 rd" class="r6 r">context</span>, <b>bool</b> <span id="r7 rd" class="r7 r">useLocalScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r8 rd" class="r8 r">sessionState</span>)
            : <a href="CommandProcessorBase.cs.html#64e9365f7027b222" class="k">base</a>((<a href="CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a>)<span class="r5 r">commandInfo</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r5 r">commandInfo</span> != <b>null</b>, <span class="s">&quot;commandInfo cannot be null&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r5 r">commandInfo</span>.<a href="CommandInfo.cs.html#753af6705016f48b" class="i property">ScriptBlock</a> != <b>null</b>, <span class="s">&quot;scriptblock cannot be null&quot;</span>);
 
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#0043954ffd6af0aa" class="i field">_fromScriptFile</a> = (<a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a> <b>is</b> <a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> || <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a> <b>is</b> <a href="ScriptInfo.cs.html#0ebcce9a1485125a" class="t t">ScriptInfo</a>);
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="#4cdfaaa8bd12da5d" class="i field">_dontUseScopeCommandOrigin</a> = <b>true</b>;
 
            <a href="#529818453db4f3bd" class="i method">CommonInitialization</a>(<span class="r5 r">commandInfo</span>.<a href="CommandInfo.cs.html#753af6705016f48b" class="i property">ScriptBlock</a>, <span class="r6 r">context</span>, <span class="r7 r">useLocalScope</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>, <span class="r8 r">sessionState</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When executing a scriptblock, the command origin needs to be set for the current scope.</span>
        <span class="c">///</span><span class="c"> If this true, then the scope origin will be set to the command origin. If it&#39;s false,</span>
        <span class="c">///</span><span class="c"> then the scope origin will be set to Internal. This allows public functions to call</span>
        <span class="c">///</span><span class="c"> private functions but still see $MyInvocation.CommandOrigin as $true.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="4cdfaaa8bd12da5d" href="../R/4cdfaaa8bd12da5d.html" target="n" data-glyph="45,1" class="i field">_dontUseScopeCommandOrigin</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, then an exit exception will be rethrown to instead of caught and processed...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="36b3d3d8d2028b3a" href="../R/36b3d3d8d2028b3a.html" target="n" data-glyph="45,1" class="i field">_rethrowExitException</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This indicates whether exit is called during the execution of</span>
        <span class="c">///</span><span class="c"> script block.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Exit command can be executed in any of begin/process/end blocks.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If exit is called in one block (for example, begin), any subsequent</span>
        <span class="c">///</span><span class="c"> blocks (for example, process and end) should not be executed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="d8dc508935934aa3" href="../R/d8dc508935934aa3.html" target="n" data-glyph="45,1" class="i field">_exitWasCalled</a>;
 
        <b>protected</b> <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="a8a746d6cf013f9a" href="../R/a8a746d6cf013f9a.html" target="n" data-glyph="45,1" class="i field">_scriptBlock</a>;
 
        <b>private</b> <a href="scriptparameterbindercontroller.cs.html#802627054e79dbd7" class="t t">ScriptParameterBinderController</a> <a id="97a665fa05dd9875" href="../R/97a665fa05dd9875.html" target="n" data-glyph="46,1" class="i field">_scriptParameterBinderController</a>;
 
        <b>internal</b> <a href="scriptparameterbindercontroller.cs.html#802627054e79dbd7" class="t t">ScriptParameterBinderController</a> <a id="eb25724ba0e40567" href="../R/eb25724ba0e40567.html" target="n" data-glyph="104,1" class="i property">ScriptParameterBinderController</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#97a665fa05dd9875" class="i field">_scriptParameterBinderController</a> == <b>null</b>)
                {
                    <span class="c">// Set up the hashtable that will be used to hold all of the bound parameters...</span>
                    <a href="#97a665fa05dd9875" class="i field">_scriptParameterBinderController</a> =
                        <b>new</b> <a href="scriptparameterbindercontroller.cs.html#51bbc09bb40e7b91" class="t constructor">ScriptParameterBinderController</a>(((<a href="CommandInfo.cs.html#2ae2bf5bb21a5a53" class="t t">IScriptCommandInfo</a>)<a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a>).<a href="CommandInfo.cs.html#753af6705016f48b" class="i property">ScriptBlock</a>,
                            <a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>, <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>, <a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>, <a href="CommandProcessorBase.cs.html#fefd69f2b6b9e222" class="i property">CommandScope</a>);
                    <a href="#97a665fa05dd9875" class="i field">_scriptParameterBinderController</a>.<a href="ParameterBinderController.cs.html#0b62798bea43a39e" class="i property">CommandLineParameters</a>.<a href="ParameterBinderBase.cs.html#ab97e37b119045b9" class="i method">UpdateInvocationInfo</a>(<a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>);
                    <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#6bbbff769b24d3a5" class="i property">UnboundArguments</a> = <a href="#97a665fa05dd9875" class="i field">_scriptParameterBinderController</a>.<a href="scriptparameterbindercontroller.cs.html#c2ed0808862967f8" class="i property">DollarArgs</a>;
                }
 
                <b>return</b> <a href="#97a665fa05dd9875" class="i field">_scriptParameterBinderController</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper function for setting up command object and commandRuntime object</span>
        <span class="c">///</span><span class="c"> for script command processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="529818453db4f3bd" href="../R/529818453db4f3bd.html" target="n" data-glyph="75,1" class="i method">CommonInitialization</a>(<a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r9 rd" class="r9 r">scriptBlock</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r10 rd" class="r10 r">context</span>, <b>bool</b> <span id="r11 rd" class="r11 r">useLocalScope</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r12 rd" class="r12 r">origin</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r13 rd" class="r13 r">sessionState</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r10 r">context</span> != <b>null</b>, <span class="s">&quot;execution context cannot be null&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r10 r">context</span>.<a href="ExecutionContext.cs.html#7b897dde7067af78" class="i property">Engine</a> != <b>null</b>, <span class="s">&quot;context.engine cannot be null&quot;</span>);
 
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#1f3fb39371c48d78" class="i property">CommandSessionState</a> = <span class="r13 r">sessionState</span>;
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a> = <span class="r10 r">context</span>;
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="#36b3d3d8d2028b3a" class="i field">_rethrowExitException</a> = <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#da0268d4cb08ef32" class="i property">ScriptCommandProcessorShouldRethrowExit</a>;
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#da0268d4cb08ef32" class="i property">ScriptCommandProcessorShouldRethrowExit</a> = <b>false</b>;
 
            <a href="ScriptCommand.cs.html#087afb10617614ea" class="t t">ScriptCommand</a> <span id="r14 rd" class="r14 r">scriptCommand</span> = <b>new</b> <span class="t">ScriptCommand</span> { <a href="CommandBase.cs.html#1f4a1f38862b466a" class="i property">CommandInfo</a> = <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a> };
 
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a> = <span class="r14 r">scriptCommand</span>;
            <span class="c">// WinBlue: 219115</span>
            <span class="c">// Set the command origin for the new ScriptCommand object since we&#39;re not</span>
            <span class="c">// going through command discovery here where it&#39;s usually set.</span>
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#cfb07a45be8fb7d4" class="i field">CommandOriginInternal</a> = <span class="r12 r">origin</span>;
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#71eb09c6dd471a86" class="i field">commandRuntime</a> = <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a> = <b>new</b> <a href="MshCommandRuntime.cs.html#135a26935c7af90a" class="t constructor">MshCommandRuntime</a>(<a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>, <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a>, <span class="r14 r">scriptCommand</span>);
 
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#fefd69f2b6b9e222" class="i property">CommandScope</a> = <span class="r11 r">useLocalScope</span>
                                    ? <a href="CommandProcessorBase.cs.html#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#27e7de485699a643" class="i method">NewScope</a>(<a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#abf3d4779190c608" class="i property">FromScriptFile</a>)
                                    : <a href="CommandProcessorBase.cs.html#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>;
 
            <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#d3edce8b26f160da" class="i property">UseLocalScope</a> = <span class="r11 r">useLocalScope</span>;
 
            <a href="#a8a746d6cf013f9a" class="i field">_scriptBlock</a> = <span class="r9 r">scriptBlock</span>;
 
            <span class="c">// If the script has been dotted, throw an error if it&#39;s from a different language mode.</span>
            <span class="c">// Unless it was a script loaded through -File, in which case the danger of dotting other</span>
            <span class="c">// language modes (getting internal functions in the user&#39;s state) isn&#39;t a danger</span>
            <b>if</b> ((!<a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#d3edce8b26f160da" class="i property">UseLocalScope</a>) &amp;&amp; (!<a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="#36b3d3d8d2028b3a" class="i field">_rethrowExitException</a>))
            {
                <a href="CommandProcessorBase.cs.html#8219620967fc9f1a" class="i method">ValidateCompatibleLanguageMode</a>(<a href="#a8a746d6cf013f9a" class="i field">_scriptBlock</a>, <span class="r10 r">context</span>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>, <a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if user has requested help (for example passing &quot;-?&quot; parameter for a cmdlet)</span>
        <span class="c">///</span><span class="c"> and if yes, then returns the help target to display.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">helpTarget</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help target to request.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">helpCategory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Help category to request.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if user requested help; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal override bool</b> <a id="78fd048c3a162247" href="../R/78fd048c3a162247.html" target="n" data-glyph="74,1" class="i method">IsHelpRequested</a>(<b>out string</b> <span id="r15 rd" class="r15 r">helpTarget</span>, <b>out</b> <a href="../help/HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a> <span id="r16 rd" class="r16 r">helpCategory</span>)
        {
            <b>if</b> (<a href="CommandProcessorBase.cs.html#5bfa2b362a5e8358" class="i field">arguments</a> != <b>null</b> &amp;&amp; <a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a> != <b>null</b> &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>) &amp;&amp; <a href="#a8a746d6cf013f9a" class="i field">_scriptBlock</a> != <b>null</b>)
            {
                <b>foreach</b> (<a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r17 rd" class="r17 r">parameter</span> <b>in</b> <a href="#d9f57c5c0946b36a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#5bfa2b362a5e8358" class="i field">arguments</a>)
                {
                    <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r17 r">parameter</span> != <b>null</b>, <span class="s">&quot;CommandProcessor.arguments shouldn&#39;t have any null arguments&quot;</span>);
                    <b>if</b> (<span class="r17 r">parameter</span>.<a href="CommandParameter.cs.html#ca8fb4c38d968983" class="i method">IsDashQuestion</a>())
                    {
                        <span class="i">Dictionary</span>&lt;<a href="parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>, <a href="parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[]&gt; <span id="r18 rd" class="r18 r">scriptBlockTokenCache</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<a href="parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a>, <a href="parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[]&gt;();
                        <b>string</b> <span id="r19 rd" class="r19 r">unused</span>;
                        <a href="../help/HelpInfo.cs.html#d64eccc845958c22" class="t t">HelpInfo</a> <span id="r20 rd" class="r20 r">helpInfo</span> = <a href="#a8a746d6cf013f9a" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#e66fc4ae4110c000" class="i method">GetHelpInfo</a>(<span class="r21 r">context</span>: <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>, <span class="r22 r">commandInfo</span>: <a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a>,
                            <span class="r23 r">dontSearchOnRemoteComputer</span>: <b>false</b>, <span class="r24 r">scriptBlockTokenCache</span>: <span class="r18 r">scriptBlockTokenCache</span>, <span class="r25 r">helpFile</span>: <b>out</b> <span class="r19 r">unused</span>, <span class="r26 r">helpUriFromDotLink</span>: <b>out</b> <span class="r19 r">unused</span>);
                        <b>if</b> (<span class="r20 r">helpInfo</span> == <b>null</b>)
                        {
                            <b>break</b>;
                        }
 
                        <span class="r15 r">helpTarget</span> = <span class="r20 r">helpInfo</span>.<a href="../help/HelpInfo.cs.html#aa468d431e2dc4d7" class="i property">Name</a>;
                        <span class="r16 r">helpCategory</span> = <span class="r20 r">helpInfo</span>.<a href="../help/HelpInfo.cs.html#1ef71c37a37a1f15" class="i property">HelpCategory</a>;
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <b>return</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="k">base</a>.<a href="CommandProcessorBase.cs.html#67dd0c69e6a0187b" class="i method">IsHelpRequested</a>(<b>out</b> <span class="r15 r">helpTarget</span>, <b>out</b> <span class="r16 r">helpCategory</span>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class implements a command processor for script related commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> 1. Usage scenarios</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> ScriptCommandProcessor is used for four kinds of commands.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> a. Functions and filters</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> For example,</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c">     function foo($a) {$a}</span>
    <span class="c">///</span><span class="c">     foo &quot;my text&quot;</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Second command is an example of a function invocation.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> In this case, a FunctionInfo object is provided while constructing</span>
    <span class="c">///</span><span class="c"> command processor.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> b. Script File</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> For example,</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c">     . .\my.ps1</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> In this case, a ExternalScriptInfo or ScriptInfo object is provided</span>
    <span class="c">///</span><span class="c"> while constructing command processor.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> c. ScriptBlock</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> For example,</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c">     . {$a = 5}</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> In this case, a ScriptBlock object is provided while constructing command</span>
    <span class="c">///</span><span class="c"> processor.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> d. Script Text</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> This is used internally for directly running a text stream of script.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> 2. Design</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> a. Script block</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> No matter how a script command processor is created, core piece of information</span>
    <span class="c">///</span><span class="c"> is always a ScriptBlock object, which can come from either a FunctionInfo object,</span>
    <span class="c">///</span><span class="c"> a ScriptInfo object, or directly parsed from script text.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> b. Script scope</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> A script block can be executed either in current scope or in a new scope.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> New scope created should be a scope supporting $script: in case the command</span>
    <span class="c">///</span><span class="c"> processor is created from a script file.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> c. Begin/Process/End blocks</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Each script block can have one block of script for begin/process/end. These map</span>
    <span class="c">///</span><span class="c"> to BeginProcessing, ProcessingRecord, and EndProcessing of cmdlet api.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> d. ExitException handling</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> If the command processor is created based on a script file, its exit exception</span>
    <span class="c">///</span><span class="c"> handling is different in the sense that it indicates an exitcode instead of killing</span>
    <span class="c">///</span><span class="c"> current powershell session.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="ca35402ad11c02aa" href="../R/ca35402ad11c02aa.html" target="n" data-glyph="2,0" class="t t">DlrScriptCommandProcessor</a> : <a href="#d9f57c5c0946b36a" class="t t">ScriptCommandProcessorBase</a>
    {
        <b>private readonly</b> <span class="i">ArrayList</span> <a id="6492645f2e194203" href="../R/6492645f2e194203.html" target="n" data-glyph="46,1" class="i field">_input</a> = <b>new</b> <span class="i">ArrayList</span>();
        <b>private readonly object</b> <a id="749677dfc232d2b4" href="../R/749677dfc232d2b4.html" target="n" data-glyph="46,1" class="i field">_dollarUnderbar</a> = <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
        <b>private</b> <b>new</b> <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="f0d5e9f4c82eb3a8" href="../R/f0d5e9f4c82eb3a8.html" target="n" data-glyph="46,1" class="i field">_scriptBlock</a>;
        <b>private</b> <a href="runtime/MutableTuple.cs.html#d4c692d6a8bac31d" class="t t">MutableTuple</a> <a id="5198b5cc4bd5ac7a" href="../R/5198b5cc4bd5ac7a.html" target="n" data-glyph="46,1" class="i field">_localsTuple</a>;
        <b>private bool</b> <a id="6d1af012b2f42681" href="../R/6d1af012b2f42681.html" target="n" data-glyph="46,1" class="i field">_runOptimizedCode</a>;
        <b>private bool</b> <a id="ecd7b4279f5c0358" href="../R/ecd7b4279f5c0358.html" target="n" data-glyph="46,1" class="i field">_argsBound</a>;
        <b>private</b> <a href="parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <a id="c699b39bee8f067f" href="../R/c699b39bee8f067f.html" target="n" data-glyph="46,1" class="i field">_functionContext</a>;
 
        <b>internal</b> <a id="e82f9920af669f7f" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">DlrScriptCommandProcessor</a>(<a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r27 rd" class="r27 r">scriptBlock</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r28 rd" class="r28 r">context</span>, <b>bool</b> <span id="r29 rd" class="r29 r">useNewScope</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r30 rd" class="r30 r">origin</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r31 rd" class="r31 r">sessionState</span>, <b>object</b> <span id="r32 rd" class="r32 r">dollarUnderbar</span>)
            : <a href="#37ba241daee615f0" class="k">base</a>(<span class="r27 r">scriptBlock</span>, <span class="r28 r">context</span>, <span class="r29 r">useNewScope</span>, <span class="r30 r">origin</span>, <span class="r31 r">sessionState</span>)
        {
            <a href="#0feb006d05ece07f" class="i method">Init</a>();
            <a href="#749677dfc232d2b4" class="i field">_dollarUnderbar</a> = <span class="r32 r">dollarUnderbar</span>;
        }
 
        <b>internal</b> <a id="bc8140e230e96c7c" href="../R/bc8140e230e96c7c.html" target="n" data-glyph="74,1" class="t constructor">DlrScriptCommandProcessor</a>(<a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r33 rd" class="r33 r">scriptBlock</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r34 rd" class="r34 r">context</span>, <b>bool</b> <span id="r35 rd" class="r35 r">useNewScope</span>, <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r36 rd" class="r36 r">origin</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r37 rd" class="r37 r">sessionState</span>)
            : <a href="#37ba241daee615f0" class="k">base</a>(<span class="r33 r">scriptBlock</span>, <span class="r34 r">context</span>, <span class="r35 r">useNewScope</span>, <span class="r36 r">origin</span>, <span class="r37 r">sessionState</span>)
        {
            <a href="#0feb006d05ece07f" class="i method">Init</a>();
        }
 
        <b>internal</b> <a id="d0e79f30f5606c66" href="../R/d0e79f30f5606c66.html" target="n" data-glyph="74,1" class="t constructor">DlrScriptCommandProcessor</a>(<a href="FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r38 rd" class="r38 r">functionInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r39 rd" class="r39 r">context</span>, <b>bool</b> <span id="r40 rd" class="r40 r">useNewScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r41 rd" class="r41 r">sessionState</span>)
            : <a href="#ef9c48e9b2553975" class="k">base</a>(<span class="r38 r">functionInfo</span>, <span class="r39 r">context</span>, <span class="r40 r">useNewScope</span>, <span class="r41 r">sessionState</span>)
        {
            <a href="#0feb006d05ece07f" class="i method">Init</a>();
        }
 
        <b>internal</b> <a id="e96e5d179ad16073" href="../R/e96e5d179ad16073.html" target="n" data-glyph="74,1" class="t constructor">DlrScriptCommandProcessor</a>(<a href="ScriptInfo.cs.html#0ebcce9a1485125a" class="t t">ScriptInfo</a> <span id="r42 rd" class="r42 r">scriptInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r43 rd" class="r43 r">context</span>, <b>bool</b> <span id="r44 rd" class="r44 r">useNewScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r45 rd" class="r45 r">sessionState</span>)
            : <a href="#ef9c48e9b2553975" class="k">base</a>(<span class="r42 r">scriptInfo</span>, <span class="r43 r">context</span>, <span class="r44 r">useNewScope</span>, <span class="r45 r">sessionState</span>)
        {
            <a href="#0feb006d05ece07f" class="i method">Init</a>();
        }
 
        <b>internal</b> <a id="bbd598f3d38ec417" href="../R/bbd598f3d38ec417.html" target="n" data-glyph="74,1" class="t constructor">DlrScriptCommandProcessor</a>(<a href="ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r46 rd" class="r46 r">scriptInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r47 rd" class="r47 r">context</span>, <b>bool</b> <span id="r48 rd" class="r48 r">useNewScope</span>, <a href="../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r49 rd" class="r49 r">sessionState</span>)
            : <a href="#ef9c48e9b2553975" class="k">base</a>(<span class="r46 r">scriptInfo</span>, <span class="r47 r">context</span>, <span class="r48 r">useNewScope</span>, <span class="r49 r">sessionState</span>)
        {
            <a href="#0feb006d05ece07f" class="i method">Init</a>();
        }
 
        <b>private void</b> <a id="0feb006d05ece07f" href="../R/0feb006d05ece07f.html" target="n" data-glyph="76,1" class="i method">Init</a>()
        {
            <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a> = <a href="#d9f57c5c0946b36a" class="k">base</a>.<a href="#a8a746d6cf013f9a" class="i field">_scriptBlock</a>;
            <a href="#2c5a865b192b250b" class="i field">_obsoleteAttribute</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#2acf0b78bcba9559" class="i property">ObsoleteAttribute</a>;
            <a href="#6d1af012b2f42681" class="i field">_runOptimizedCode</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#fed28a51bb21935d" class="i method">Compile</a>(<span class="r50 r">optimized</span>: <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>.<a href="ExecutionContext.cs.html#00e6fdde4b76eb15" class="i field">_debuggingMode</a> &lt;= 0 &amp;&amp; <a href="CommandProcessorBase.cs.html#d3edce8b26f160da" class="i property">UseLocalScope</a>);
            <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#74eb29587e65199f" class="i method">MakeLocalsTuple</a>(<a href="#6d1af012b2f42681" class="i field">_runOptimizedCode</a>);
 
            <b>if</b> (<a href="CommandProcessorBase.cs.html#d3edce8b26f160da" class="i property">UseLocalScope</a>)
            {
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="CommandProcessorBase.cs.html#fefd69f2b6b9e222" class="i property">CommandScope</a>.<a href="SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a> == <b>null</b>, <span class="s">&quot;a newly created scope shouldn&#39;t have it&#39;s tuple set.&quot;</span>);
                <a href="CommandProcessorBase.cs.html#fefd69f2b6b9e222" class="i property">CommandScope</a>.<a href="SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a> = <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the ObsoleteAttribute of the current command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override</b> <span class="i">ObsoleteAttribute</span> <a id="d342c2a11d79550b" href="../R/d342c2a11d79550b.html" target="n" data-glyph="104,1" class="i property">ObsoleteAttribute</a>
        {
            <b>get</b> { <b>return</b> <a href="#2c5a865b192b250b" class="i field">_obsoleteAttribute</a>; }
        }
 
        <b>private</b> <span class="i">ObsoleteAttribute</span> <a id="2c5a865b192b250b" href="../R/2c5a865b192b250b.html" target="n" data-glyph="46,1" class="i field">_obsoleteAttribute</a>;
 
        <b>internal override void</b> <a id="15f72472a812f571" href="../R/15f72472a812f571.html" target="n" data-glyph="74,1" class="i method">Prepare</a>(<span class="i">IDictionary</span> <span id="r51 rd" class="r51 r">psDefaultParameterValues</span>)
        {
            <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>.<a href="runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="SpecialVariables.cs.html#80b3b66ce97fc2c9" class="i field">MyInvocation</a>, <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>, <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>);
            <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="lang/scriptblock.cs.html#a3474072505c30d2" class="i method">SetPSScriptRootAndPSCommandPath</a>(<a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>, <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>);
            <a href="#c699b39bee8f067f" class="i field">_functionContext</a> = <b>new</b> <span class="t">FunctionContext</span>
            {
                <a href="parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a> = <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>,
                <a href="parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a> = <a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>,
                <a href="parser/Compiler.cs.html#23a9d5ac6a3b086b" class="i field">_localsTuple</a> = <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>,
                <a href="parser/Compiler.cs.html#4980a1f93a561cb3" class="i field">_scriptBlock</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>,
                <a href="parser/Compiler.cs.html#95a73081cffaa015" class="i field">_file</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="lang/scriptblock.cs.html#20772981d01b9078" class="i property">File</a>,
                <a href="parser/Compiler.cs.html#f9539890beb6e765" class="i field">_debuggerHidden</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#6bbac4f67f789407" class="i property">DebuggerHidden</a>,
                <a href="parser/Compiler.cs.html#f82ab745f95a8791" class="i field">_debuggerStepThrough</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#28f1dfc28a9bfb01" class="i property">DebuggerStepThrough</a>,
                <a href="parser/Compiler.cs.html#354889e302c1693c" class="i field">_sequencePoints</a> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#fa7a45aa6cb804cf" class="i property">SequencePoints</a>,
            };
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Execute BeginProcessing part of command. It sets up the overall scope</span>
        <span class="c">///</span><span class="c"> object for this command and runs the begin clause of the script block if</span>
        <span class="c">///</span><span class="c"> it isn&#39;t empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> a terminating error occurred, or the pipeline was otherwise stopped</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="234a7c986310ad1d" href="../R/234a7c986310ad1d.html" target="n" data-glyph="74,1" class="i method">DoBegin</a>()
        {
            <b>if</b> (!<a href="CommandProcessorBase.cs.html#7b0f1c2306037414" class="i field">RanBeginAlready</a>)
            {
                <a href="CommandProcessorBase.cs.html#7b0f1c2306037414" class="i field">RanBeginAlready</a> = <b>true</b>;
 
                <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#5b263ac9d28348b4" class="i method">LogScriptBlockStart</a>(<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>, <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>.<a href="hostifaces/Connection.cs.html#af7b715fe8b1bee2" class="i property">InstanceId</a>);
 
                <span class="c">// Even if there is no begin, we need to set up the execution scope for this</span>
                <span class="c">// script...</span>
                <a href="CommandProcessorBase.cs.html#2a4698751cbdab79" class="i method">SetCurrentScopeToExecutionScope</a>();
                <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r52 rd" class="r52 r">oldCurrentCommandProcessor</span> = <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>;
                <b>try</b>
                {
                    <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <a href="#ca35402ad11c02aa" class="k">this</a>;
 
                    <b>if</b> (<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#680dd2bf19ec8364" class="i property">HasBeginBlock</a>)
                    {
                        <span class="i">RunClause</span>(<a href="#6d1af012b2f42681" class="i field">_runOptimizedCode</a> ? <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#4466269805a5863e" class="i property">BeginBlock</a> : <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#6052408bb7624a4e" class="i property">UnoptimizedBeginBlock</a>,
                                  <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="#6492645f2e194203" class="i field">_input</a>);
                    }
                }
                <b>finally</b>
                {
                    <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> = <span class="r52 r">oldCurrentCommandProcessor</span>;
                    <a href="CommandProcessorBase.cs.html#1a8d2d2aeb322b3b" class="i method">RestorePreviousScope</a>();
                }
            }
        }
 
        <b>internal override void</b> <a id="b8c9076785367262" href="../R/b8c9076785367262.html" target="n" data-glyph="74,1" class="i method">ProcessRecord</a>()
        {
            <b>if</b> (<a href="#d8dc508935934aa3" class="i field">_exitWasCalled</a>)
            {
                <b>return</b>;
            }
 
            <b>if</b> (!<a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#7b0f1c2306037414" class="i field">RanBeginAlready</a>)
            {
                <a href="CommandProcessorBase.cs.html#7b0f1c2306037414" class="i field">RanBeginAlready</a> = <b>true</b>;
 
                <b>if</b> (<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#680dd2bf19ec8364" class="i property">HasBeginBlock</a>)
                {
                    <span class="i">RunClause</span>(<a href="#6d1af012b2f42681" class="i field">_runOptimizedCode</a> ? <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#4466269805a5863e" class="i property">BeginBlock</a> : <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#6052408bb7624a4e" class="i property">UnoptimizedBeginBlock</a>, <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="#6492645f2e194203" class="i field">_input</a>);
                }
            }
 
            <b>if</b> (<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#5ee5abba7294e48d" class="i property">HasProcessBlock</a>)
            {
                <b>if</b> (!<a href="CommandProcessorBase.cs.html#93abe05c663b0330" class="i method">IsPipelineInputExpected</a>())
                {
                    <span class="i">RunClause</span>(<a href="#6d1af012b2f42681" class="i field">_runOptimizedCode</a> ? <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#46b25735aefff06f" class="i property">ProcessBlock</a> : <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#83941ff41ae9d393" class="i property">UnoptimizedProcessBlock</a>, <b>null</b>, <a href="#6492645f2e194203" class="i field">_input</a>);
                }
                <b>else</b>
                {
                    <a href="#e5e7e2ad9f3f66d3" class="i method">DoProcessRecordWithInput</a>();
                }
            }
            <b>else</b> <b>if</b> (<a href="CommandProcessorBase.cs.html#93abe05c663b0330" class="i method">IsPipelineInputExpected</a>())
            {
                <span class="c">// accumulate the input when working in &quot;synchronous&quot; mode</span>
                <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#0696af7afce6ee9b" class="i property">PipelineIterationInfo</a> != <b>null</b>); <span class="c">// this should have been allocated when the pipe was started</span>
                <b>if</b> (<a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="MshCommandRuntime.cs.html#2a3306bd1f3917ef" class="i property">InputPipe</a>.<a href="Pipe.cs.html#cf2d71634731882c" class="i property">ExternalReader</a> == <b>null</b>)
                {
                    <b>while</b> (<a href="CommandProcessorBase.cs.html#11858c2b783304d7" class="i method">Read</a>())
                    {
                        <span class="c">// accumulate all of the objects and execute at the end.</span>
                        <a href="#6492645f2e194203" class="i field">_input</a>.<span class="i">Add</span>(<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a>);
                    }
                }
            }
        }
 
        <b>internal override void</b> <a id="092fb685bfd2fc3c" href="../R/092fb685bfd2fc3c.html" target="n" data-glyph="74,1" class="i method">Complete</a>()
        {
            <b>try</b>
            {
                <b>if</b> (<a href="#d8dc508935934aa3" class="i field">_exitWasCalled</a>)
                {
                    <b>return</b>;
                }
 
                <span class="c">// process any items that may still be in the input pipeline</span>
                <b>if</b> (<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#5ee5abba7294e48d" class="i property">HasProcessBlock</a> &amp;&amp; <a href="CommandProcessorBase.cs.html#93abe05c663b0330" class="i method">IsPipelineInputExpected</a>())
                {
                    <a href="#e5e7e2ad9f3f66d3" class="i method">DoProcessRecordWithInput</a>();
                }
 
                <b>if</b> (<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#e0cf74ca3d5f266a" class="i property">HasEndBlock</a>)
                {
                    <b>var</b> <span id="r53 rd" class="r53 r">endBlock</span> = <a href="#6d1af012b2f42681" class="i field">_runOptimizedCode</a> ? <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#b6696f8aab4cc825" class="i property">EndBlock</a> : <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#0c428bcdac23053a" class="i property">UnoptimizedEndBlock</a>;
                    <b>if</b> (<a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="MshCommandRuntime.cs.html#2a3306bd1f3917ef" class="i property">InputPipe</a>.<a href="Pipe.cs.html#cf2d71634731882c" class="i property">ExternalReader</a> == <b>null</b>)
                    {
                        <b>if</b> (<a href="CommandProcessorBase.cs.html#93abe05c663b0330" class="i method">IsPipelineInputExpected</a>())
                        {
                            <span class="c">// read any items that may still be in the input pipe</span>
                            <b>while</b> (<a href="CommandProcessorBase.cs.html#11858c2b783304d7" class="i method">Read</a>())
                            {
                                <a href="#6492645f2e194203" class="i field">_input</a>.<span class="i">Add</span>(<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a>);
                            }
                        }
 
                        <span class="c">// run with accumulated input</span>
                        <span class="i">RunClause</span>(<span class="r53 r">endBlock</span>, <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="#6492645f2e194203" class="i field">_input</a>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// run with asynchronously updated $input enumerator</span>
                        <span class="i">RunClause</span>(<span class="r53 r">endBlock</span>, <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="MshCommandRuntime.cs.html#2a3306bd1f3917ef" class="i property">InputPipe</a>.<a href="Pipe.cs.html#cf2d71634731882c" class="i property">ExternalReader</a>.<a href="../utils/IObjectReader.cs.html#bb77876e7e65727c" class="i method">GetReadEnumerator</a>());
                    }
                }
            }
            <b>finally</b>
            {
                <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#0412bd44086911de" class="i method">LogScriptBlockEnd</a>(<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>, <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>.<a href="hostifaces/Connection.cs.html#af7b715fe8b1bee2" class="i property">InstanceId</a>);
            }
        }
 
        <b>private void</b> <a id="e5e7e2ad9f3f66d3" href="../R/e5e7e2ad9f3f66d3.html" target="n" data-glyph="76,1" class="i method">DoProcessRecordWithInput</a>()
        {
            <span class="c">// block for input and execute &quot;process&quot; block for all input objects</span>
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#0696af7afce6ee9b" class="i property">PipelineIterationInfo</a> != <b>null</b>); <span class="c">// this should have been allocated when the pipe was started</span>
            <b>var</b> <span id="r54 rd" class="r54 r">processBlock</span> = <a href="#6d1af012b2f42681" class="i field">_runOptimizedCode</a> ? <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#46b25735aefff06f" class="i property">ProcessBlock</a> : <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="runtime/CompiledScriptBlock.cs.html#83941ff41ae9d393" class="i property">UnoptimizedProcessBlock</a>;
            <b>while</b> (<a href="CommandProcessorBase.cs.html#11858c2b783304d7" class="i method">Read</a>())
            {
                <a href="#6492645f2e194203" class="i field">_input</a>.<span class="i">Add</span>(<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a>);
 
                <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#0696af7afce6ee9b" class="i property">PipelineIterationInfo</a>[<a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#b9401843293d51d4" class="i property">PipelinePosition</a>]++;
 
                <span class="i">RunClause</span>(<span class="r54 r">processBlock</span>, <a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a>, <a href="#6492645f2e194203" class="i field">_input</a>);
 
                <span class="c">// now clear input for next iteration; also makes it clear for the end clause.</span>
                <a href="#6492645f2e194203" class="i field">_input</a>.<span class="i">Clear</span>();
            }
        }
 
        <b>private void</b> <a id="e23d7d208f88bc07" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">RunClause</a>(<span class="i">Action</span>&lt;<a href="parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a>&gt; <span id="r55 rd" class="r55 r">clause</span>, <b>object</b> <span id="r56 rd" class="r56 r">dollarUnderbar</span>, <b>object</b> <span id="r57 rd" class="r57 r">inputToProcess</span>)
        {
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="ExecutionContext.cs.html#3dcd207b1b77d402" class="i method">CheckStackDepth</a>();
 
            <a href="Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r58 rd" class="r58 r">oldErrorOutputPipe</span> = <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
 
            <span class="c">// If the script block has a different language mode than the current,</span>
            <span class="c">// change the language mode.</span>
            <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>? <span id="r59 rd" class="r59 r">oldLanguageMode</span> = <b>null</b>;
            <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>? <span id="r60 rd" class="r60 r">newLanguageMode</span> = <b>null</b>;
            <b>if</b> ((<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a>.<span class="i">HasValue</span>) &amp;&amp;
                (<a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> != <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>))
            {
                <span class="r59 r">oldLanguageMode</span> = <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>;
                <span class="r60 r">newLanguageMode</span> = <a href="#f0d5e9f4c82eb3a8" class="i field">_scriptBlock</a>.<a href="lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a>;
            }
 
            <b>try</b>
            {
                <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="k">var</a> <span id="r61 rd" class="r61 r">oldScopeOrigin</span> = <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a>;
 
                <b>try</b>
                {
                    <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a> =
                        <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="#4cdfaaa8bd12da5d" class="i field">_dontUseScopeCommandOrigin</a> ? <a href="SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a> : <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#6cef80897300e0a9" class="i property">CommandOrigin</a>;
 
                    <span class="c">// Set the language mode. We do this before EnterScope(), so that the language</span>
                    <span class="c">// mode is appropriately applied for evaluation parameter defaults.</span>
                    <b>if</b> (<span class="r60 r">newLanguageMode</span>.<span class="i">HasValue</span>)
                    {
                        <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <span class="r60 r">newLanguageMode</span>.<span class="i">Value</span>;
                    }
 
                    <b>bool</b>? <span id="r62 rd" class="r62 r">oldLangModeTransitionStatus</span> = <b>null</b>;
                    <b>try</b>
                    {
                        <span class="c">// If it&#39;s from ConstrainedLanguage to FullLanguage, indicate the transition before parameter binding takes place.</span>
                        <b>if</b> (<span class="r59 r">oldLanguageMode</span> == <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a> &amp;&amp; <span class="r60 r">newLanguageMode</span> == <a href="SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>)
                        {
                            <span class="r62 r">oldLangModeTransitionStatus</span> = <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#800d673aaa498da6" class="i property">LanguageModeTransitionInParameterBinding</a>;
                            <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#800d673aaa498da6" class="i property">LanguageModeTransitionInParameterBinding</a> = <b>true</b>;
                        }
 
                        <a href="#3a71f45a01ca25bc" class="i method">EnterScope</a>();
                    }
                    <b>finally</b>
                    {
                        <b>if</b> (<span class="r62 r">oldLangModeTransitionStatus</span>.<span class="i">HasValue</span>)
                        {
                            <span class="c">// Revert the transition state to old value after doing the parameter binding</span>
                            <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#800d673aaa498da6" class="i property">LanguageModeTransitionInParameterBinding</a> = <span class="r62 r">oldLangModeTransitionStatus</span>.<span class="i">Value</span>;
                        }
                    }
 
                    <b>if</b> (<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#ed59e3b00feab7b1" class="i property">ErrorMergeTo</a> == <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>.<a href="MshCommandRuntime.cs.html#8b0e9f05387e62ca" class="t t">MergeDataStream</a>.<a href="MshCommandRuntime.cs.html#8ab59ea31f703b82" class="i field">Output</a>)
                    {
                        <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ae9b57da47a77bc5" class="i method">RedirectErrorPipe</a>(<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>);
                    }
                    <b>else</b> <b>if</b> (<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a>.<a href="Pipe.cs.html#f890f797fcc0ee94" class="i property">IsRedirected</a>)
                    {
                        <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ae9b57da47a77bc5" class="i method">RedirectErrorPipe</a>(<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a>);
                    }
 
                    <b>if</b> (<span class="r56 r">dollarUnderbar</span> != <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                    {
                        <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>.<a href="runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="SpecialVariables.cs.html#3599fdc9d261201f" class="i field">Underbar</a>, <span class="r56 r">dollarUnderbar</span>, <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>);
                    }
                    <b>else</b> <b>if</b> (<a href="#749677dfc232d2b4" class="i field">_dollarUnderbar</a> != <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                    {
                        <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>.<a href="runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="SpecialVariables.cs.html#3599fdc9d261201f" class="i field">Underbar</a>, <a href="#749677dfc232d2b4" class="i field">_dollarUnderbar</a>, <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>);
                    }
 
                    <b>if</b> (<span class="r57 r">inputToProcess</span> != <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                    {
                        <b>if</b> (<span class="r57 r">inputToProcess</span> == <b>null</b>)
                        {
                            <span class="r57 r">inputToProcess</span> = <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>.<a href="MshCommandRuntime.cs.html#493d2fff89fbbf4f" class="i field">StaticEmptyArray</a>.<span class="i">GetEnumerator</span>();
                        }
                        <b>else</b>
                        {
                            <span class="i">IList</span> <span id="r63 rd" class="r63 r">list</span> = <span class="r57 r">inputToProcess</span> <b>as</b> <span class="i">IList</span>;
                            <span class="r57 r">inputToProcess</span> = (<span class="r63 r">list</span> != <b>null</b>)
                                                 ? <span class="r63 r">list</span>.<span class="i">GetEnumerator</span>()
                                                 : <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#837b38179d9ca088" class="i method">GetEnumerator</a>(<span class="r57 r">inputToProcess</span>);
                        }
 
                        <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>.<a href="runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="SpecialVariables.cs.html#52526bd30f8a492b" class="i field">Input</a>, <span class="r57 r">inputToProcess</span>, <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>);
                    }
 
                    <span class="r55 r">clause</span>(<a href="#c699b39bee8f067f" class="i field">_functionContext</a>);
                }
                <b>catch</b> (<span class="i">TargetInvocationException</span> <span id="r64 rd" class="r64 r">tie</span>)
                {
                    <span class="c">// DynamicInvoke wraps exceptions, unwrap them here.</span>
                    <b>throw</b> <span class="r64 r">tie</span>.<span class="i">InnerException</span>;
                }
                <b>finally</b>
                {
                    <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#3b12142fb72b35b3" class="i method">RestoreErrorPipe</a>(<span class="r58 r">oldErrorOutputPipe</span>);
 
                    <b>if</b> (<span class="r59 r">oldLanguageMode</span>.<span class="i">HasValue</span>)
                    {
                        <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> = <span class="r59 r">oldLanguageMode</span>.<span class="i">Value</span>;
                    }
 
                    <a href="CommandProcessorBase.cs.html#00c4abcf32dda50f" class="i property">Context</a>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a> = <span class="r61 r">oldScopeOrigin</span>;
                }
            }
            <b>catch</b> (<a href="lang/parserutils.cs.html#79de2587ceb4dc25" class="t t">ExitException</a> <span id="r65 rd" class="r65 r">ee</span>)
            {
                <b>if</b> (!<a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#abf3d4779190c608" class="i property">FromScriptFile</a> || <a href="#36b3d3d8d2028b3a" class="i field">_rethrowExitException</a>)
                {
                    <b>throw</b>;
                }
 
                <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="#d8dc508935934aa3" class="i field">_exitWasCalled</a> = <b>true</b>;
 
                <b>int</b> <span id="r66 rd" class="r66 r">exitCode</span> = (<b>int</b>)<span class="r65 r">ee</span>.<a href="lang/parserutils.cs.html#d1b0e4525b48e0c9" class="i property">Argument</a>;
                <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="SpecialVariables.cs.html#fe9ae54e56fef582" class="i field">LastExitCodeVarPath</a>, <span class="r66 r">exitCode</span>);
 
                <b>if</b> (<span class="r66 r">exitCode</span> != 0)
                    <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a>.<a href="pipeline.cs.html#813a2622f5f1116c" class="i property">ExecutionFailed</a> = <b>true</b>;
            }
            <b>catch</b> (<a href="lang/parserutils.cs.html#a3a2a71cfea9c3b1" class="t t">FlowControlException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r67 rd" class="r67 r">e</span>)
            {
                <a href="CommandProcessorBase.cs.html#44e39dd7927a2328" class="i method">ManageScriptException</a>(<span class="r67 r">e</span>); <span class="c">// always throws</span>
                <span class="c">// This quiets the compiler which wants to see a return value</span>
                <span class="c">// in all codepaths.</span>
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r68 rd" class="r68 r">e</span>)
            {
                <span class="c">// This cmdlet threw an exception, so</span>
                <span class="c">// wrap it and bubble it up.</span>
                <b>throw</b> <a href="CommandProcessorBase.cs.html#2b54af4c46f46a60" class="i method">ManageInvocationException</a>(<span class="r68 r">e</span>);
            }
        }
 
        <b>private void</b> <a id="3a71f45a01ca25bc" href="../R/3a71f45a01ca25bc.html" target="n" data-glyph="76,1" class="i method">EnterScope</a>()
        {
            <b>if</b> (!<a href="#ecd7b4279f5c0358" class="i field">_argsBound</a>)
            {
                <a href="#ecd7b4279f5c0358" class="i field">_argsBound</a> = <b>true</b>;
 
                <span class="c">// Parameter binder may need to write warning messages for obsolete parameters</span>
                <b>using</b> (<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#898174c9e014e567" class="i method">AllowThisCommandToWrite</a>(<b>false</b>))
                {
                    <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="#eb25724ba0e40567" class="i property">ScriptParameterBinderController</a>.<a href="scriptparameterbindercontroller.cs.html#adc0cc6ef1785c7c" class="i method">BindCommandLineParameters</a>(<a href="CommandProcessorBase.cs.html#5bfa2b362a5e8358" class="i field">arguments</a>);
                }
 
                <a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>.<a href="runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="SpecialVariables.cs.html#93a934b8cba4991e" class="i field">PSBoundParameters</a>,
                                                  <a href="#ca35402ad11c02aa" class="k">this</a>.<a href="#eb25724ba0e40567" class="i property">ScriptParameterBinderController</a>.<a href="ParameterBinderController.cs.html#0b62798bea43a39e" class="i property">CommandLineParameters</a>.<a href="ParameterBinderBase.cs.html#a424a7a35309dc44" class="i method">GetValueToBindToPSBoundParameters</a>(), <a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a>);
            }
        }
 
        <b>protected override void</b> <a id="f4adbc1f392fb7e1" href="../R/f4adbc1f392fb7e1.html" target="n" data-glyph="75,1" class="i method">OnSetCurrentScope</a>()
        {
            <span class="c">// When dotting a script, push the locals of automatic variables to</span>
            <span class="c">// the &#39;DottedScopes&#39; of the current scope.</span>
            <b>if</b> (!<a href="CommandProcessorBase.cs.html#d3edce8b26f160da" class="i property">UseLocalScope</a>)
            {
                <a href="CommandProcessorBase.cs.html#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="SessionStateScope.cs.html#240090c569665c17" class="i property">DottedScopes</a>.<span class="i">Push</span>(<a href="#5198b5cc4bd5ac7a" class="i field">_localsTuple</a>);
            }
        }
 
        <b>protected override void</b> <a id="3110223259b0d932" href="../R/3110223259b0d932.html" target="n" data-glyph="75,1" class="i method">OnRestorePreviousScope</a>()
        {
            <span class="c">// When dotting a script, pop the locals of automatic variables from</span>
            <span class="c">// the &#39;DottedScopes&#39; of the current scope.</span>
            <b>if</b> (!<a href="CommandProcessorBase.cs.html#d3edce8b26f160da" class="i property">UseLocalScope</a>)
            {
                <a href="CommandProcessorBase.cs.html#1f3fb39371c48d78" class="i property">CommandSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="SessionStateScope.cs.html#240090c569665c17" class="i property">DottedScopes</a>.<span class="i">Pop</span>();
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
