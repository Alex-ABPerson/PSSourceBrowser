<!DOCTYPE html>
<html><head><title>NativeCommandProcessor.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(2450);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/NativeCommandProcessor.cs" target="_top">engine\NativeCommandProcessor.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 1634, 1691
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">Serialization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Various types of input/output supported by native commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Most native commands only support text. Other formats</span>
    <span class="c">///</span><span class="c"> are supported by minishell</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <b>internal enum</b> <a id="ce832a3a9771e8cc" href="../R/ce832a3a9771e8cc.html" target="n" data-glyph="20,0" class="t t"><span id="2cf19b090c1c3822">NativeCommandIOFormat</span></a>
    {
        <a id="10d22766727410e1" href="../R/10d22766727410e1.html" target="n" data-glyph="24,1" class="i field">Text</a>,
        <a id="17d397776a51ff66" href="../R/17d397776a51ff66.html" target="n" data-glyph="24,1" class="i field">Xml</a>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Different streams produced by minishell output.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal enum</b> <a id="1a2a95181c3c24e6" href="../R/1a2a95181c3c24e6.html" target="n" data-glyph="20,0" class="t t"><span id="9c3da407b127a529">MinishellStream</span></a>
    {
        <a id="8e4e5a8bf4ca3949" href="../R/8e4e5a8bf4ca3949.html" target="n" data-glyph="24,1" class="i field">Output</a>,
        <a id="c3fa9200d2d7861e" href="../R/c3fa9200d2d7861e.html" target="n" data-glyph="24,1" class="i field">Error</a>,
        <a id="c73d449be2277109" href="../R/c73d449be2277109.html" target="n" data-glyph="24,1" class="i field">Verbose</a>,
        <a id="a189f93bb16b3fbf" href="../R/a189f93bb16b3fbf.html" target="n" data-glyph="24,1" class="i field">Warning</a>,
        <a id="1bf9c2a844980805" href="../R/1bf9c2a844980805.html" target="n" data-glyph="24,1" class="i field">Debug</a>,
        <a id="fbd551536f154623" href="../R/fbd551536f154623.html" target="n" data-glyph="24,1" class="i field">Progress</a>,
        <a id="1b928c156cefa801" href="../R/1b928c156cefa801.html" target="n" data-glyph="24,1" class="i field">Information</a>,
        <a id="d6d6b4e487b9d0e3" href="../R/d6d6b4e487b9d0e3.html" target="n" data-glyph="24,1" class="i field">Unknown</a>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Helper class which holds stream names and also provide conversion</span>
    <span class="c">///</span><span class="c"> method.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="6865a4ba1c00e035" href="../R/6865a4ba1c00e035.html" target="n" data-glyph="2,0" class="t t">StringToMinishellStreamConverter</a>
    {
        <b>internal const string</b> <a id="ac7d348ce5e7b8c1" href="../R/ac7d348ce5e7b8c1.html" target="n" data-glyph="8,1" class="i field">OutputStream</a> = <span class="s">&quot;output&quot;</span>;
        <b>internal const string</b> <a id="47dfb8ee43e8f913" href="../R/47dfb8ee43e8f913.html" target="n" data-glyph="8,1" class="i field">ErrorStream</a> = <span class="s">&quot;error&quot;</span>;
        <b>internal const string</b> <a id="69a35495d76fcdf2" href="../R/69a35495d76fcdf2.html" target="n" data-glyph="8,1" class="i field">DebugStream</a> = <span class="s">&quot;debug&quot;</span>;
        <b>internal const string</b> <a id="266a360e54eaecf5" href="../R/266a360e54eaecf5.html" target="n" data-glyph="8,1" class="i field">VerboseStream</a> = <span class="s">&quot;verbose&quot;</span>;
        <b>internal const string</b> <a id="63270cba81e345d6" href="../R/63270cba81e345d6.html" target="n" data-glyph="8,1" class="i field">WarningStream</a> = <span class="s">&quot;warning&quot;</span>;
        <b>internal const string</b> <a id="b5b1d214024e94fb" href="../R/b5b1d214024e94fb.html" target="n" data-glyph="8,1" class="i field">ProgressStream</a> = <span class="s">&quot;progress&quot;</span>;
        <b>internal const string</b> <a id="674eec78db2175a4" href="../R/674eec78db2175a4.html" target="n" data-glyph="8,1" class="i field">InformationStream</a> = <span class="s">&quot;information&quot;</span>;
 
        <b>internal static</b> <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a> <a id="04eabf58be031ba3" href="../R/04eabf58be031ba3.html" target="n" data-glyph="74,1" class="i method">ToMinishellStream</a>(<b>string</b> <span id="r0 rd" class="r0 r">stream</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r0 r">stream</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a> <span id="r1 rd" class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#d6d6b4e487b9d0e3" class="i field">Unknown</a>;
            <b>if</b> (<a href="#ac7d348ce5e7b8c1" class="i field">OutputStream</a>.<span class="i">Equals</span>(<span class="r0 r">stream</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#8e4e5a8bf4ca3949" class="i field">Output</a>;
            }
            <b>else</b> <b>if</b> (<a href="#47dfb8ee43e8f913" class="i field">ErrorStream</a>.<span class="i">Equals</span>(<span class="r0 r">stream</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c3fa9200d2d7861e" class="i field">Error</a>;
            }
            <b>else</b> <b>if</b> (<a href="#69a35495d76fcdf2" class="i field">DebugStream</a>.<span class="i">Equals</span>(<span class="r0 r">stream</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#1bf9c2a844980805" class="i field">Debug</a>;
            }
            <b>else</b> <b>if</b> (<a href="#266a360e54eaecf5" class="i field">VerboseStream</a>.<span class="i">Equals</span>(<span class="r0 r">stream</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c73d449be2277109" class="i field">Verbose</a>;
            }
            <b>else</b> <b>if</b> (<a href="#63270cba81e345d6" class="i field">WarningStream</a>.<span class="i">Equals</span>(<span class="r0 r">stream</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#a189f93bb16b3fbf" class="i field">Warning</a>;
            }
            <b>else</b> <b>if</b> (<a href="#b5b1d214024e94fb" class="i field">ProgressStream</a>.<span class="i">Equals</span>(<span class="r0 r">stream</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#fbd551536f154623" class="i field">Progress</a>;
            }
            <b>else</b> <b>if</b> (<a href="#674eec78db2175a4" class="i field">InformationStream</a>.<span class="i">Equals</span>(<span class="r0 r">stream</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r1 r">ms</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#1b928c156cefa801" class="i field">Information</a>;
            }
 
            <b>return</b> <span class="r1 r">ms</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> An output object from the child process.</span>
    <span class="c">///</span><span class="c"> If it&#39;s from the error stream isError will be true.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="4eaa0973ac21c058" href="../R/4eaa0973ac21c058.html" target="n" data-glyph="2,0" class="t t">ProcessOutputObject</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the data from this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The data</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="1b710b4ec41c1e43" href="../R/1b710b4ec41c1e43.html" target="n" data-glyph="104,1" class="i property">Data</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stream to which data belongs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a> <a id="40dfc75a308ab139" href="../R/40dfc75a308ab139.html" target="n" data-glyph="104,1" class="i property">Stream</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Build an output object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">data</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The data to output.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">stream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Stream to which data belongs.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="f4c102c138279655" href="../R/f4c102c138279655.html" target="n" data-glyph="74,1" class="t constructor">ProcessOutputObject</a>(<b>object</b> <span id="r2 rd" class="r2 r">data</span>, <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a> <span id="r3 rd" class="r3 r">stream</span>)
        {
            <a href="#1b710b4ec41c1e43" class="i property">Data</a> = <span class="r2 r">data</span>;
            <a href="#40dfc75a308ab139" class="i property">Stream</a> = <span class="r3 r">stream</span>;
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">enable</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This exception is used by the NativeCommandProcessor to indicate an error</span>
    <span class="c">///</span><span class="c"> when a native command retuns a non-zero exit code.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Serializable</span>]
    <b>public sealed class</b> <a id="0e8dd66eb0a72853" href="../R/0e8dd66eb0a72853.html" target="n" data-glyph="0,0" class="t t">NativeCommandExitException</a> : <a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>
    {
        <span class="c">// NOTE:</span>
        <span class="c">// When implementing the native error action preference integration,</span>
        <span class="c">// reusing ApplicationFailedException was rejected.</span>
        <span class="c">// Instead of reusing a type already used in another scenario</span>
        <span class="c">// it was decided instead to use a fresh type to avoid conflating the two scenarios:</span>
        <span class="c">// * ApplicationFailedException: PowerShell was not able to complete execution of the application.</span>
        <span class="c">// * NativeCommandExitException: the application completed execution but returned a non-zero exit code.</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#0e8dd66eb0a72853" class="t t">NativeCommandExitException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class with information on the native</span>
        <span class="c">///</span><span class="c"> command, a specified error message and a specified error ID.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The full path of the native command.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">exitCode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The exit code returned by the native command.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">processId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The process ID of the process before it ended.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The error message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">errorId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The PowerShell runtime error ID.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="169be8f09b0d4db4" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">NativeCommandExitException</a>(<b>string</b> <span id="r4 rd" class="r4 r">path</span>, <b>int</b> <span id="r5 rd" class="r5 r">exitCode</span>, <b>int</b> <span id="r6 rd" class="r6 r">processId</span>, <b>string</b> <span id="r7 rd" class="r7 r">message</span>, <b>string</b> <span id="r8 rd" class="r8 r">errorId</span>)
            : <a href="../utils/RuntimeException.cs.html#e4538a388d78c143" class="k">base</a>(<span class="r7 r">message</span>)
        {
            <a href="../utils/RuntimeException.cs.html#f25affe9a215ccc0" class="i method">SetErrorId</a>(<span class="r8 r">errorId</span>);
            <a href="../utils/RuntimeException.cs.html#fca86db33780c155" class="i method">SetErrorCategory</a>(<a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>);
            <a href="#1b70d89b8fdf480b" class="i property">Path</a> = <span class="r4 r">path</span>;
            <a href="#62feac521d70377b" class="i property">ExitCode</a> = <span class="r5 r">exitCode</span>;
            <a href="#bffe9f3b84724076" class="i property">ProcessId</a> = <span class="r6 r">processId</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#0e8dd66eb0a72853" class="t t">NativeCommandExitException</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class with serialized data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private</b> <a id="fde38b4d3c4cf0bb" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">NativeCommandExitException</a>(<span class="i">SerializationInfo</span> <span id="r9 rd" class="r9 r">info</span>, <span class="i">StreamingContext</span> <span id="r10 rd" class="r10 r">context</span>)
            : <a href="../utils/RuntimeException.cs.html#42acad626a5cf24e" class="k">base</a>(<span class="r9 r">info</span>, <span class="r10 r">context</span>)
        {
            <b>if</b> (<span class="r9 r">info</span> <b>is null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../utils/MshArgumentNullException.cs.html#166e605c6cb05157" class="t constructor">PSArgumentNullException</a>(<b>nameof</b>(<span class="r9 r">info</span>));
            }
 
            <a href="#1b70d89b8fdf480b" class="i property">Path</a> = <span class="r9 r">info</span>.<span class="i">GetString</span>(<b>nameof</b>(<a href="#1b70d89b8fdf480b" class="i property">Path</a>));
            <a href="#62feac521d70377b" class="i property">ExitCode</a> = <span class="r9 r">info</span>.<span class="i">GetInt32</span>(<b>nameof</b>(<a href="#62feac521d70377b" class="i property">ExitCode</a>));
            <a href="#bffe9f3b84724076" class="i property">ProcessId</a> = <span class="r9 r">info</span>.<span class="i">GetInt32</span>(<b>nameof</b>(<a href="#bffe9f3b84724076" class="i property">ProcessId</a>));
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serializes the exception data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Serialization information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Streaming context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="d5d100ac65c1d424" href="../R/d5d100ac65c1d424.html" target="n" data-glyph="72,1" class="i method">GetObjectData</a>(<span class="i">SerializationInfo</span> <span id="r11 rd" class="r11 r">info</span>, <span class="i">StreamingContext</span> <span id="r12 rd" class="r12 r">context</span>)
        {
            <b>if</b> (<span class="r11 r">info</span> <b>is null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../utils/MshArgumentNullException.cs.html#166e605c6cb05157" class="t constructor">PSArgumentNullException</a>(<b>nameof</b>(<span class="r11 r">info</span>));
            }
 
            <a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="k">base</a>.<a href="../utils/RuntimeException.cs.html#8377876b053cffbc" class="i method">GetObjectData</a>(<span class="r11 r">info</span>, <span class="r12 r">context</span>);
 
            <span class="r11 r">info</span>.<span class="i">AddValue</span>(<b>nameof</b>(<a href="#1b70d89b8fdf480b" class="i property">Path</a>), <a href="#1b70d89b8fdf480b" class="i property">Path</a>);
            <span class="r11 r">info</span>.<span class="i">AddValue</span>(<b>nameof</b>(<a href="#62feac521d70377b" class="i property">ExitCode</a>), <a href="#62feac521d70377b" class="i property">ExitCode</a>);
            <span class="r11 r">info</span>.<span class="i">AddValue</span>(<b>nameof</b>(<a href="#bffe9f3b84724076" class="i property">ProcessId</a>), <a href="#bffe9f3b84724076" class="i property">ProcessId</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the path of the native command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b>? <a id="1b70d89b8fdf480b" href="../R/1b70d89b8fdf480b.html" target="n" data-glyph="102,1" class="i property">Path</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the exit code returned by the native command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public int</b> <a id="62feac521d70377b" href="../R/62feac521d70377b.html" target="n" data-glyph="102,1" class="i property">ExitCode</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the native command&#39;s process ID.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public int</b> <a id="bffe9f3b84724076" href="../R/bffe9f3b84724076.html" target="n" data-glyph="102,1" class="i property">ProcessId</a> { <b>get</b>; }
 
    }
    <span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">restore</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provides way to create and execute native commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="27173c2526d1ef9a" href="../R/27173c2526d1ef9a.html" target="n" data-glyph="2,0" class="t t">NativeCommandProcessor</a> : <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a>
    {
        <span class="c">// This is the list of files which will trigger Legacy behavior if</span>
        <span class="c">// PSNativeCommandArgumentPassing is set to &quot;Windows&quot;.</span>
        <b>private static readonly</b> <span class="i">IReadOnlySet</span>&lt;<b>string</b>&gt; <a id="9fb93190aa56eabc" href="../R/9fb93190aa56eabc.html" target="n" data-glyph="46,1" class="i field">s_legacyFileExtensions</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)
        {
            <span class="s">&quot;.js&quot;</span>,
            <span class="s">&quot;.wsf&quot;</span>,
            <span class="s">&quot;.cmd&quot;</span>,
            <span class="s">&quot;.bat&quot;</span>,
            <span class="s">&quot;.vbs&quot;</span>,
        };
 
        <span class="c">// The following native commands have non-standard behavior with regard to argument passing,</span>
        <span class="c">// so we use Legacy argument parsing for them when PSNativeCommandArgumentPassing is set to Windows.</span>
        <b>private static readonly</b> <span class="i">IReadOnlySet</span>&lt;<b>string</b>&gt; <a id="8c09114b54723157" href="../R/8c09114b54723157.html" target="n" data-glyph="46,1" class="i field">s_legacyCommands</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)
        {
            <span class="s">&quot;cmd&quot;</span>,
            <span class="s">&quot;cscript&quot;</span>,
            <span class="s">&quot;wscript&quot;</span>,
        };
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctor/native command properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Information about application which is invoked by this instance of</span>
        <span class="c">///</span><span class="c"> NativeCommandProcessor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="ApplicationInfo.cs.html#3fe5acebae74c595" class="t t">ApplicationInfo</a> <a id="526c8b28ea97840e" href="../R/526c8b28ea97840e.html" target="n" data-glyph="46,1" class="i field">_applicationInfo</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes the new instance of NativeCommandProcessor class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">applicationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The information about the application to run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The execution context for this command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">applicationInfo</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">context</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a id="ae2eb0e36af996fb" href="../R/ae2eb0e36af996fb.html" target="n" data-glyph="74,1" class="t constructor">NativeCommandProcessor</a>(<a href="ApplicationInfo.cs.html#3fe5acebae74c595" class="t t">ApplicationInfo</a> <span id="r13 rd" class="r13 r">applicationInfo</span>, <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r14 rd" class="r14 r">context</span>)
            : <a href="CommandProcessorBase.cs.html#64e9365f7027b222" class="k">base</a>(<span class="r13 r">applicationInfo</span>)
        {
            <b>if</b> (<span class="r13 r">applicationInfo</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r13 r">applicationInfo</span>));
            }
 
            <a href="#526c8b28ea97840e" class="i field">_applicationInfo</a> = <span class="r13 r">applicationInfo</span>;
            <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#bb86759713ca670f" class="i field">_context</a> = <span class="r14 r">context</span>;
 
            <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a> = <b>new</b> <span class="t">NativeCommand</span>();
            <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#1f4a1f38862b466a" class="i property">CommandInfo</a> = <span class="r13 r">applicationInfo</span>;
            <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a> = <span class="r14 r">context</span>;
            <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#71eb09c6dd471a86" class="i field">commandRuntime</a> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a> = <b>new</b> <a href="MshCommandRuntime.cs.html#135a26935c7af90a" class="t constructor">MshCommandRuntime</a>(<span class="r14 r">context</span>, <span class="r13 r">applicationInfo</span>, <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>);
 
            <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#fefd69f2b6b9e222" class="i property">CommandScope</a> = <span class="r14 r">context</span>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>;
 
            <span class="c">// provide native command a backpointer to this object.</span>
            <span class="c">// When kill is called on the command object,</span>
            <span class="c">// it calls this NCP back to kill the process...</span>
            ((<a href="NativeCommand.cs.html#5379c2c6be0f9d06" class="t t">NativeCommand</a>)<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>).<a href="NativeCommand.cs.html#51b8679f392f4f28" class="i property">MyCommandProcessor</a> = <a href="#27173c2526d1ef9a" class="k">this</a>;
 
            <span class="c">// Create input writer for providing input to the process.</span>
            <a href="#c969dd4044f5fbca" class="i field">_inputWriter</a> = <b>new</b> <a href="#9be2e041af90bd89" class="t constructor">ProcessInputWriter</a>(<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>);
 
            <a href="#41e610c7c1718309" class="i field">_isTranscribing</a> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#6694b338e46fdead" class="i property">IsTranscribing</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the NativeCommand associated with this command processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="NativeCommand.cs.html#5379c2c6be0f9d06" class="t t">NativeCommand</a> <a id="334b12e5ef3d880e" href="../R/334b12e5ef3d880e.html" target="n" data-glyph="106,1" class="i property">nativeCommand</a>
        {
            <b>get</b>
            {
                <a href="NativeCommand.cs.html#5379c2c6be0f9d06" class="t t">NativeCommand</a> <span id="r15 rd" class="r15 r">command</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a> <b>as</b> <a href="NativeCommand.cs.html#5379c2c6be0f9d06" class="t t">NativeCommand</a>;
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r15 r">command</span> != <b>null</b>, <span class="s">&quot;this.Command is created in the constructor.&quot;</span>);
                <b>return</b> <span class="r15 r">command</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the name of the native command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="9eca51c0812cb595" href="../R/9eca51c0812cb595.html" target="n" data-glyph="106,1" class="i property">NativeCommandName</a>
        {
            <b>get</b>
            {
                <b>string</b> <span id="r16 rd" class="r16 r">name</span> = <a href="#526c8b28ea97840e" class="i field">_applicationInfo</a>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>;
                <b>return</b> <span class="r16 r">name</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets path to the native command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="ca7f636a3bdb6f4b" href="../R/ca7f636a3bdb6f4b.html" target="n" data-glyph="106,1" class="i property">Path</a>
        {
            <b>get</b>
            {
                <b>string</b> <span id="r17 rd" class="r17 r">path</span> = <a href="#526c8b28ea97840e" class="i field">_applicationInfo</a>.<a href="ApplicationInfo.cs.html#fc56d6471804cff1" class="i property">Path</a>;
                <b>return</b> <span class="r17 r">path</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctor/native command properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> parameter binder
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Variable which is set to true when prepare is called.</span>
        <span class="c">///</span><span class="c"> Parameter Binder should only be created after Prepare method is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="814b1598c4e2916a" href="../R/814b1598c4e2916a.html" target="n" data-glyph="46,1" class="i field">_isPreparedCalled</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parameter binder used by this command processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="NativeCommandParameterBinderController.cs.html#cf4121e610547113" class="t t">NativeCommandParameterBinderController</a> <a id="2e8a3026beda8f0c" href="../R/2e8a3026beda8f0c.html" target="n" data-glyph="46,1" class="i field">_nativeParameterBinderController</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets a new instance of a ParameterBinderController using a NativeCommandParameterBinder.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The native command to be run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A new parameter binder controller for the specified command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="ParameterBinderController.cs.html#9e4e49a03a43c579" class="t t">ParameterBinderController</a> <a id="ee3ef87ea8c1b67b" href="../R/ee3ef87ea8c1b67b.html" target="n" data-glyph="74,1" class="i method">NewParameterBinderController</a>(<a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <span id="r18 rd" class="r18 r">command</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#814b1598c4e2916a" class="i field">_isPreparedCalled</a>, <span class="s">&quot;parameter binder should not be created before prepared is called&quot;</span>);
 
            <b>if</b> (<a href="#aacc8a7845cd5382" class="i field">_isMiniShell</a>)
            {
                <a href="#2e8a3026beda8f0c" class="i field">_nativeParameterBinderController</a> =
                    <b>new</b> <a href="MinishellParameterBinderController.cs.html#5536a764d45560e5" class="t constructor">MinishellParameterBinderController</a>(
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#334b12e5ef3d880e" class="i property">nativeCommand</a>);
            }
            <b>else</b>
            {
                <a href="#2e8a3026beda8f0c" class="i field">_nativeParameterBinderController</a> =
                    <b>new</b> <a href="NativeCommandParameterBinderController.cs.html#0ef048877a96374f" class="t constructor">NativeCommandParameterBinderController</a>(
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#334b12e5ef3d880e" class="i property">nativeCommand</a>);
            }
 
            <b>return</b> <a href="#2e8a3026beda8f0c" class="i field">_nativeParameterBinderController</a>;
        }
 
        <b>internal</b> <a href="NativeCommandParameterBinderController.cs.html#cf4121e610547113" class="t t">NativeCommandParameterBinderController</a> <a id="1d75706192c6db39" href="../R/1d75706192c6db39.html" target="n" data-glyph="104,1" class="i property">NativeParameterBinderController</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#2e8a3026beda8f0c" class="i field">_nativeParameterBinderController</a> == <b>null</b>)
                {
                    <a href="#ee3ef87ea8c1b67b" class="i method">NewParameterBinderController</a>(<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>);
                }
 
                <b>return</b> <a href="#2e8a3026beda8f0c" class="i field">_nativeParameterBinderController</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> parameter binder
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> internal overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Prepares the command for execution with the specified CommandParameterInternal.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="ae510559dbbb54f1" href="../R/ae510559dbbb54f1.html" target="n" data-glyph="74,1" class="i method">Prepare</a>(<span class="i">IDictionary</span> <span id="r19 rd" class="r19 r">psDefaultParameterValues</span>)
        {
            <a href="#814b1598c4e2916a" class="i field">_isPreparedCalled</a> = <b>true</b>;
 
            <span class="c">// Check if the application is minishell</span>
            <a href="#aacc8a7845cd5382" class="i field">_isMiniShell</a> = <a href="#f6afefde1d0af780" class="i method">IsMiniShell</a>();
 
            <span class="c">// For minishell parameter binding is done in Complete method because we need</span>
            <span class="c">// to know if output is redirected before we can bind parameters.</span>
            <b>if</b> (!<a href="#aacc8a7845cd5382" class="i field">_isMiniShell</a>)
            {
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#1d75706192c6db39" class="i property">NativeParameterBinderController</a>.<a href="NativeCommandParameterBinderController.cs.html#587fc925df1908cd" class="i method">BindParameters</a>(<a href="CommandProcessorBase.cs.html#5bfa2b362a5e8358" class="i field">arguments</a>);
            }
 
            <b>try</b>
            {
                <a href="#59fd7b05a3713119" class="i method">InitNativeProcess</a>();
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// Do cleanup in case of exception</span>
                <a href="#d01db1922b80b875" class="i method">CleanUp</a>();
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Executes the command. This method assumes that Prepare is already called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="256831fcfd1698b5" href="../R/256831fcfd1698b5.html" target="n" data-glyph="74,1" class="i method">ProcessRecord</a>()
        {
            <b>try</b>
            {
                <b>while</b> (<a href="CommandProcessorBase.cs.html#11858c2b783304d7" class="i method">Read</a>())
                {
                    <a href="#c969dd4044f5fbca" class="i field">_inputWriter</a>.<a href="#5e88cb36e50bab04" class="i method">Add</a>(<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#394e3b79ee75331b" class="i property">CurrentPipelineObject</a>);
                }
 
                <a href="#f6b98eab1f599776" class="i method">ConsumeAvailableNativeProcessOutput</a>(<span class="r20 r">blocking</span>: <b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// Do cleanup in case of exception</span>
                <a href="#d01db1922b80b875" class="i method">CleanUp</a>();
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Process object for the invoked application.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">Process</span> <a id="61f9c2b68a8ad25f" href="../R/61f9c2b68a8ad25f.html" target="n" data-glyph="46,1" class="i field">_nativeProcess</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is used for writing input to the process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="#4492fbb424330899" class="t t">ProcessInputWriter</a> <a id="c969dd4044f5fbca" href="../R/c969dd4044f5fbca.html" target="n" data-glyph="46,1" class="i field">_inputWriter</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is true if this command is to be run &quot;standalone&quot; - that is, with</span>
        <span class="c">///</span><span class="c"> no redirection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="7a3aa7778941cbc5" href="../R/7a3aa7778941cbc5.html" target="n" data-glyph="46,1" class="i field">_runStandAlone</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicate whether we need to consider redirecting the output/error of the current native command.</span>
        <span class="c">///</span><span class="c"> Usually a windows program which is the last command in a pipeline can be executed as &#39;background&#39; -- we don&#39;t need to capture its output/error streams.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="0e8bc12dfe11ce92" href="../R/0e8bc12dfe11ce92.html" target="n" data-glyph="46,1" class="i field">_isRunningInBackground</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicate if we have called &#39;NotifyBeginApplication()&#39; on the host, so that</span>
        <span class="c">///</span><span class="c"> we can call the counterpart &#39;NotifyEndApplication&#39; as appropriate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="6b31ddaf74c1e954" href="../R/6b31ddaf74c1e954.html" target="n" data-glyph="46,1" class="i field">_hasNotifiedBeginApplication</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This output queue helps us keep the output and error (if redirected) order correct.</span>
        <span class="c">///</span><span class="c"> We could do a blocking read in the Complete block instead,</span>
        <span class="c">///</span><span class="c"> but then we would not be able to restore the order reasonable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">BlockingCollection</span>&lt;<a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a>&gt; <a id="9b690a77bda65ce1" href="../R/9b690a77bda65ce1.html" target="n" data-glyph="46,1" class="i field">_nativeProcessOutputQueue</a>;
 
        <b>private static bool</b>? <a id="bfd1c139f3792d7b" href="../R/bfd1c139f3792d7b.html" target="n" data-glyph="46,1" class="i field">s_supportScreenScrape</a> = <b>null</b>;
        <b>private readonly bool</b> <a id="41e610c7c1718309" href="../R/41e610c7c1718309.html" target="n" data-glyph="46,1" class="i field">_isTranscribing</a>;
        <b>private</b> <span class="i n">Host</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#c6f6da6e12de292e" class="t t">Coordinates</a> <a id="9fe4fceac19686f4" href="../R/9fe4fceac19686f4.html" target="n" data-glyph="46,1" class="i field">_startPosition</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object used for synchronization between StopProcessing thread and</span>
        <span class="c">///</span><span class="c"> Pipeline thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly object</b> <a id="63a1e4dcac363ac1" href="../R/63a1e4dcac363ac1.html" target="n" data-glyph="46,1" class="i field">_sync</a> = <b>new</b> <b>object</b>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Executes the native command once all of the input has been gathered.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline is stopping</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/CommandProcessorExceptions.cs.html#cbf9f9dae531f6ae" class="t t">ApplicationFailedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The native command could not be run</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="59fd7b05a3713119" href="../R/59fd7b05a3713119.html" target="n" data-glyph="76,1" class="i method">InitNativeProcess</a>()
        {
            <span class="c">// Figure out if we&#39;re going to run this process &quot;standalone&quot; i.e. without</span>
            <span class="c">// redirecting anything. This is a bit tricky as we always run redirected so</span>
            <span class="c">// we have to see if the redirection is actually being done at the topmost level or not.</span>
 
            <span class="c">// Calculate if input and output are redirected.</span>
            <b>bool</b> <span id="r21 rd" class="r21 r">redirectOutput</span>;
            <b>bool</b> <span id="r22 rd" class="r22 r">redirectError</span>;
            <b>bool</b> <span id="r23 rd" class="r23 r">redirectInput</span>;
 
            <a href="#9fe4fceac19686f4" class="i field">_startPosition</a> = <b>new</b> <span class="i n">Host</span>.<span class="t">Coordinates</span>();
 
            <b>bool</b> <span id="r24 rd" class="r24 r">isWindowsApplication</span> = <a href="#c036720cc1194112" class="i method">IsWindowsApplication</a>(<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>);
            <a href="#d2ed9782e03cce77" class="i method">CalculateIORedirection</a>(<span class="r24 r">isWindowsApplication</span>, <b>out</b> <span class="r21 r">redirectOutput</span>, <b>out</b> <span class="r22 r">redirectError</span>, <b>out</b> <span class="r23 r">redirectInput</span>);
 
            <span class="c">// Find out if it&#39;s the only command in the pipeline.</span>
            <b>bool</b> <span id="r25 rd" class="r25 r">soloCommand</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#7d73dcbb6106b235" class="i property">PipelineLength</a> == 1;
 
            <span class="c">// Get the start info for the process.</span>
            <span class="i">ProcessStartInfo</span> <span id="r26 rd" class="r26 r">startInfo</span> = <a href="#5bb2b615831d3841" class="i method">GetProcessStartInfo</a>(<span class="r21 r">redirectOutput</span>, <span class="r22 r">redirectError</span>, <span class="r23 r">redirectInput</span>, <span class="r25 r">soloCommand</span>);
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <b>string</b> <span id="r27 rd" class="r27 r">commandPath</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>.<span class="i">ToLowerInvariant</span>();
            <b>if</b> (<span class="r27 r">commandPath</span>.<span class="i">EndsWith</span>(<span class="s">&quot;powershell.exe&quot;</span>) || <span class="r27 r">commandPath</span>.<span class="i">EndsWith</span>(<span class="s">&quot;powershell_ise.exe&quot;</span>))
            {
                <span class="c">// if starting Windows PowerShell, need to remove PowerShell specific segments of PSModulePath</span>
                <b>string</b> <span id="r28 rd" class="r28 r">psmodulepath</span> = <a href="Modules/ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="Modules/ModuleIntrinsics.cs.html#8aad16e2b6c26ef3" class="i method">GetWindowsPowerShellModulePath</a>();
                <span class="r26 r">startInfo</span>.<span class="i">Environment</span>[<span class="s">&quot;PSModulePath&quot;</span>] = <span class="r28 r">psmodulepath</span>;
 
                <span class="c">// must set UseShellExecute to false if we modify the environment block</span>
                <span class="r26 r">startInfo</span>.<span class="i">UseShellExecute</span> = <b>false</b>;
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
            <b>if</b> (<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#bc7d7c4d79ef05e4" class="i property">CurrentPipelineStopping</a>)
            {
                <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
            }
 
            <span class="i">Exception</span> <span id="r29 rd" class="r29 r">exceptionToRethrow</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="c">// If this process is being run standalone, tell the host, which might want</span>
                <span class="c">// to save off the window title or other such state as might be tweaked by</span>
                <span class="c">// the native process</span>
                <b>if</b> (<a href="#7a3aa7778941cbc5" class="i field">_runStandAlone</a>)
                {
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#866e294c04bcbe85" class="i method">NotifyBeginApplication</a>();
                    <a href="#6b31ddaf74c1e954" class="i field">_hasNotifiedBeginApplication</a> = <b>true</b>;
 
                    <span class="c">// Also, store the Raw UI coordinates so that we can scrape the screen after</span>
                    <span class="c">// if we are transcribing.</span>
                    <b>if</b> (<a href="#41e610c7c1718309" class="i field">_isTranscribing</a> &amp;&amp; (<a href="#bfd1c139f3792d7b" class="i field">s_supportScreenScrape</a> == <b>true</b>))
                    {
                        <a href="#9fe4fceac19686f4" class="i field">_startPosition</a> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#1096ecedf81a22c3" class="i property">CursorPosition</a>;
                        <a href="#9fe4fceac19686f4" class="i field">_startPosition</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#62aff8c33e5f09b9" class="i property">X</a> = 0;
                    }
                }
 
                <span class="c">// Start the process. If stop has been called, throw exception.</span>
                <span class="c">// Note: if StopProcessing is called which this method has the lock,</span>
                <span class="c">// Stop thread will wait for nativeProcess to start.</span>
                <span class="c">// If StopProcessing gets the lock first, then it will set the stopped</span>
                <span class="c">// flag and this method will throw PipelineStoppedException when it gets</span>
                <span class="c">// the lock.</span>
                <b>lock</b> (<a href="#63a1e4dcac363ac1" class="i field">_sync</a>)
                {
                    <b>if</b> (<a href="#4e4578f1e677f183" class="i field">_stopped</a>)
                    {
                        <b>throw</b> <b>new</b> <a href="../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
                    }
 
                    <b>try</b>
                    {
                        <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a> = <b>new</b> <span class="i">Process</span>() { <span class="i">StartInfo</span> = <span class="r26 r">startInfo</span> };
                        <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">Start</span>();
                    }
                    <b>catch</b> (<span class="i">Win32Exception</span>)
                    {
                        <span class="c">// On Unix platforms, nothing can be further done, so just throw</span>
                        <span class="c">// On headless Windows SKUs, there is no shell to fall back to, so just throw</span>
                        <b>if</b> (!<a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#527d8835d493a8d0" class="i property">IsWindowsDesktop</a>) { <b>throw</b>; }
 
                        <span class="c">// on Windows desktops, see if there is a file association for this command. If so then we&#39;ll use that.</span>
                        <b>string</b> <span id="r30 rd" class="r30 r">executable</span> = <span class="i">FindExecutable</span>(<span class="r26 r">startInfo</span>.<span class="i">FileName</span>);
                        <b>bool</b> <span id="r31 rd" class="r31 r">notDone</span> = <b>true</b>;
                        <span class="c">// check to see what mode we should be in for argument passing</span>
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r30 r">executable</span>))
                        {
                            <span class="r24 r">isWindowsApplication</span> = <a href="#c036720cc1194112" class="i method">IsWindowsApplication</a>(<span class="r30 r">executable</span>);
                            <b>if</b> (!<span class="r24 r">isWindowsApplication</span>)
                            {
                                <span class="c">// Allocate a console if there isn&#39;t one attached already...</span>
                                <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#259a9aa937757010" class="i method">AllocateHiddenConsole</a>();
                            }
 
                            <b>string</b> <span id="r32 rd" class="r32 r">oldArguments</span> = <span class="r26 r">startInfo</span>.<span class="i">Arguments</span>;
                            <b>string</b> <span id="r33 rd" class="r33 r">oldFileName</span> = <span class="r26 r">startInfo</span>.<span class="i">FileName</span>;
                            <span class="c">// Check to see whether this executable should be using Legacy mode argument parsing</span>
                            <b>bool</b> <span id="r34 rd" class="r34 r">useSpecialArgumentPassing</span> = <a href="#190e16452e9189d2" class="i method">UseSpecialArgumentPassing</a>(<span class="r33 r">oldFileName</span>);
                            <b>if</b> (<span class="r34 r">useSpecialArgumentPassing</span>)
                            {
                                <span class="r26 r">startInfo</span>.<span class="i">Arguments</span> = <span class="s">&quot;\&quot;&quot;</span> + <span class="r33 r">oldFileName</span> + <span class="s">&quot;\&quot; &quot;</span> + <span class="r26 r">startInfo</span>.<span class="i">Arguments</span>;
                            }
                            <b>else</b>
                            {
                                <span class="r26 r">startInfo</span>.<span class="i">ArgumentList</span>.<span class="i">Insert</span>(0, <span class="r33 r">oldFileName</span>);
                            }
                            <span class="r26 r">startInfo</span>.<span class="i">FileName</span> = <span class="r30 r">executable</span>;
                            <b>try</b>
                            {
                                <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">Start</span>();
                                <span class="r31 r">notDone</span> = <b>false</b>;
                            }
                            <b>catch</b> (<span class="i">Win32Exception</span>)
                            {
                                <span class="c">// Restore the old filename and arguments to try shell execute last...</span>
                                <b>if</b> (<span class="r34 r">useSpecialArgumentPassing</span>)
                                {
                                    <span class="r26 r">startInfo</span>.<span class="i">Arguments</span> = <span class="r32 r">oldArguments</span>;
                                }
                                <b>else</b>
                                {
                                    <span class="r26 r">startInfo</span>.<span class="i">ArgumentList</span>.<span class="i">RemoveAt</span>(0);
                                }
                                <span class="r26 r">startInfo</span>.<span class="i">FileName</span> = <span class="r33 r">oldFileName</span>;
                            }
                        }
                        <span class="c">// We got here because there was either no executable found for this</span>
                        <span class="c">// file or we tried to launch the exe and it failed. In either case</span>
                        <span class="c">// we will try launching one last time using ShellExecute...</span>
                        <b>if</b> (<span class="r31 r">notDone</span>)
                        {
                            <b>if</b> (<span class="r25 r">soloCommand</span> &amp;&amp; !<span class="r26 r">startInfo</span>.<span class="i">UseShellExecute</span>)
                            {
                                <span class="r26 r">startInfo</span>.<span class="i">UseShellExecute</span> = <b>true</b>;
                                <span class="r26 r">startInfo</span>.<span class="i">RedirectStandardInput</span> = <b>false</b>;
                                <span class="r26 r">startInfo</span>.<span class="i">RedirectStandardOutput</span> = <b>false</b>;
                                <span class="r26 r">startInfo</span>.<span class="i">RedirectStandardError</span> = <b>false</b>;
                                <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">Start</span>();
                            }
                            <b>else</b>
                            {
                                <b>throw</b>;
                            }
                        }
                    }
                }
 
                <b>if</b> (<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#b9401843293d51d4" class="i property">PipelinePosition</a> &lt; <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#7d73dcbb6106b235" class="i property">PipelineLength</a>)
                {
                    <span class="c">// Never background unless you&#39;re at the end of a pipe.</span>
                    <span class="c">// Something like</span>
                    <span class="c">//    ls | notepad | sort.exe</span>
                    <span class="c">// should block until the notepad process is terminated.</span>
                    <a href="#0e8bc12dfe11ce92" class="i field">_isRunningInBackground</a> = <b>false</b>;
                }
                <b>else</b>
                {
                    <a href="#0e8bc12dfe11ce92" class="i field">_isRunningInBackground</a> = <b>true</b>;
                    <b>if</b> (!<span class="r26 r">startInfo</span>.<span class="i">UseShellExecute</span>)
                    {
                        <a href="#0e8bc12dfe11ce92" class="i field">_isRunningInBackground</a> = <span class="r24 r">isWindowsApplication</span>;
                    }
                }
 
                <b>try</b>
                {
                    <span class="c">// If input is redirected, start input to process.</span>
                    <b>if</b> (<span class="r26 r">startInfo</span>.<span class="i">RedirectStandardInput</span>)
                    {
                        <a href="#ce832a3a9771e8cc" class="t t">NativeCommandIOFormat</a> <span id="r35 rd" class="r35 r">inputFormat</span> = <a href="#ce832a3a9771e8cc" class="t t">NativeCommandIOFormat</a>.<a href="#10d22766727410e1" class="i field">Text</a>;
                        <b>if</b> (<a href="#aacc8a7845cd5382" class="i field">_isMiniShell</a>)
                        {
                            <span class="r35 r">inputFormat</span> = ((<a href="MinishellParameterBinderController.cs.html#4eed1ccbae50f5e9" class="t t">MinishellParameterBinderController</a>)<a href="#1d75706192c6db39" class="i property">NativeParameterBinderController</a>).<a href="MinishellParameterBinderController.cs.html#18579ab2721da6d8" class="i property">InputFormat</a>;
                        }
 
                        <b>lock</b> (<a href="#63a1e4dcac363ac1" class="i field">_sync</a>)
                        {
                            <b>if</b> (!<a href="#4e4578f1e677f183" class="i field">_stopped</a>)
                            {
                                <a href="#c969dd4044f5fbca" class="i field">_inputWriter</a>.<span class="i">Start</span>(<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>, <span class="r35 r">inputFormat</span>);
                            }
                        }
                    }
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                    <a href="#9cb6735c35fdf78b" class="i method">StopProcessing</a>();
                    <b>throw</b>;
                }
 
                <b>if</b> (!<a href="#0e8bc12dfe11ce92" class="i field">_isRunningInBackground</a>)
                {
                    <a href="#7de713a61e1c89a8" class="i method">InitOutputQueue</a>();
                }
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r36 rd" class="r36 r">e</span>)
            {
                <span class="r29 r">exceptionToRethrow</span> = <span class="r36 r">e</span>;
            }
            <b>catch</b> (<a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a>)
            {
                <span class="c">// If we&#39;re stopping the process, just rethrow this exception...</span>
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r37 rd" class="r37 r">e</span>)
            {
                <span class="r29 r">exceptionToRethrow</span> = <span class="r37 r">e</span>;
            }
 
            <span class="c">// An exception was thrown while attempting to run the program</span>
            <span class="c">// so wrap and rethrow it here...</span>
            <b>if</b> (<span class="r29 r">exceptionToRethrow</span> != <b>null</b>)
            {
                <span class="c">// It&#39;s a system exception so wrap it in one of ours and re-throw.</span>
                <b>string</b> <span id="r38 rd" class="r38 r">message</span> = <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">ParserStrings</span>.<span class="i">ProgramFailedToExecute</span>,
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#9eca51c0812cb595" class="i property">NativeCommandName</a>, <span class="r29 r">exceptionToRethrow</span>.<span class="i">Message</span>,
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#c6e9275e22dd1db0" class="i property">PositionMessage</a>);
                <a href="../utils/CommandProcessorExceptions.cs.html#cbf9f9dae531f6ae" class="t t">ApplicationFailedException</a> <span id="r39 rd" class="r39 r">appFailedException</span> = <b>new</b> <a href="../utils/CommandProcessorExceptions.cs.html#a42372b6da100d15" class="t constructor">ApplicationFailedException</a>(<span class="r38 r">message</span>, <span class="r29 r">exceptionToRethrow</span>);
 
                <span class="c">// There is no need to set this exception here since this exception will eventually be caught by pipeline processor.</span>
                <span class="c">// this.commandRuntime.PipelineProcessor.ExecutionFailed = true;</span>
 
                <b>throw</b> <span class="r39 r">appFailedException</span>;
            }
        }
 
        <b>private void</b> <a id="7de713a61e1c89a8" href="../R/7de713a61e1c89a8.html" target="n" data-glyph="76,1" class="i method">InitOutputQueue</a>()
        {
            <span class="c">// if output is redirected, start reading output of process in queue.</span>
            <b>if</b> (<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardOutput</span> || <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardError</span>)
            {
                <b>lock</b> (<a href="#63a1e4dcac363ac1" class="i field">_sync</a>)
                {
                    <b>if</b> (!<a href="#4e4578f1e677f183" class="i field">_stopped</a>)
                    {
                        <a href="#9b690a77bda65ce1" class="i field">_nativeProcessOutputQueue</a> = <b>new</b> <span class="i">BlockingCollection</span>&lt;<a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a>&gt;();
                        <span class="c">// we don&#39;t assign the handler to anything, because it&#39;s used only for objects marshaling</span>
                        <b>new</b> <span class="t">ProcessOutputHandler</span>(<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>, <a href="#9b690a77bda65ce1" class="i field">_nativeProcessOutputQueue</a>);
                    }
                }
            }
        }
 
        <b>private</b> <a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a> <a id="e8d01e35c5775d0b" href="../R/e8d01e35c5775d0b.html" target="n" data-glyph="76,1" class="i method">DequeueProcessOutput</a>(<b>bool</b> <span id="r40 rd" class="r40 r">blocking</span>)
        {
            <b>if</b> (<span class="r40 r">blocking</span>)
            {
                <span class="c">// If adding was completed and collection is empty (IsCompleted == true)</span>
                <span class="c">// there is no need to do a blocking Take(), we should just return.</span>
                <b>if</b> (!<a href="#9b690a77bda65ce1" class="i field">_nativeProcessOutputQueue</a>.<span class="i">IsCompleted</span>)
                {
                    <b>try</b>
                    {
                        <span class="c">// If adding is not complete we need a try {} catch {}</span>
                        <span class="c">// to mitigate a concurrent call to CompleteAdding().</span>
                        <b>return</b> <a href="#9b690a77bda65ce1" class="i field">_nativeProcessOutputQueue</a>.<span class="i">Take</span>();
                    }
                    <b>catch</b> (<span class="i">InvalidOperationException</span>)
                    {
                        <span class="c">// It&#39;s a normal situation: another thread can mark collection as CompleteAdding</span>
                        <span class="c">// in a concurrent way and we will rise an exception in Take().</span>
                        <span class="c">// Although it&#39;s a normal situation it&#39;s not the most common path</span>
                        <span class="c">// and will be executed only on the race condtion case.</span>
                    }
                }
 
                <b>return</b> <b>null</b>;
            }
            <b>else</b>
            {
                <a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a> <span id="r41 rd" class="r41 r">record</span> = <b>null</b>;
                <a href="#9b690a77bda65ce1" class="i field">_nativeProcessOutputQueue</a>.<span class="i">TryTake</span>(<b>out</b> <span class="r41 r">record</span>);
                <b>return</b> <span class="r41 r">record</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Read the output from the native process and send it down the line.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="f6b98eab1f599776" href="../R/f6b98eab1f599776.html" target="n" data-glyph="76,1" class="i method">ConsumeAvailableNativeProcessOutput</a>(<b>bool</b> <span id="r20 rd" class="r20 r">blocking</span>)
        {
            <b>if</b> (!<a href="#0e8bc12dfe11ce92" class="i field">_isRunningInBackground</a>)
            {
                <b>if</b> (<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardOutput</span> || <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardError</span>)
                {
                    <a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a> <span id="r42 rd" class="r42 r">record</span>;
                    <b>while</b> ((<span class="r42 r">record</span> = <a href="#e8d01e35c5775d0b" class="i method">DequeueProcessOutput</a>(<span class="r20 r">blocking</span>)) != <b>null</b>)
                    {
                        <b>if</b> (<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#bc7d7c4d79ef05e4" class="i property">CurrentPipelineStopping</a>)
                        {
                            <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#9cb6735c35fdf78b" class="i method">StopProcessing</a>();
                            <b>return</b>;
                        }
 
                        <a href="#213ba7ba32113598" class="i method">ProcessOutputRecord</a>(<span class="r42 r">record</span>);
                    }
                }
            }
        }
 
        <b>internal override void</b> <a id="b8674fc44bf13e62" href="../R/b8674fc44bf13e62.html" target="n" data-glyph="74,1" class="i method">Complete</a>()
        {
            <span class="i">Exception</span> <span id="r43 rd" class="r43 r">exceptionToRethrow</span> = <b>null</b>;
            <b>try</b>
            {
                <b>if</b> (!<a href="#0e8bc12dfe11ce92" class="i field">_isRunningInBackground</a>)
                {
                    <span class="c">// Wait for input writer to finish.</span>
                    <a href="#c969dd4044f5fbca" class="i field">_inputWriter</a>.<a href="#59ca210cd4eec000" class="i method">Done</a>();
 
                    <span class="c">// read all the available output in the blocking way</span>
                    <a href="#f6b98eab1f599776" class="i method">ConsumeAvailableNativeProcessOutput</a>(<span class="r20 r">blocking</span>: <b>true</b>);
                    <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">WaitForExit</span>();
 
                    <span class="c">// Capture screen output if we are transcribing and running stand alone</span>
                    <b>if</b> (<a href="#41e610c7c1718309" class="i field">_isTranscribing</a> &amp;&amp; (<a href="#bfd1c139f3792d7b" class="i field">s_supportScreenScrape</a> == <b>true</b>) &amp;&amp; <a href="#7a3aa7778941cbc5" class="i field">_runStandAlone</a>)
                    {
                        <span class="i n">Host</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#c6f6da6e12de292e" class="t t">Coordinates</a> <span id="r44 rd" class="r44 r">endPosition</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#1096ecedf81a22c3" class="i property">CursorPosition</a>;
                        <span class="r44 r">endPosition</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#62aff8c33e5f09b9" class="i property">X</a> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#fb00d782b83e287c" class="i property">BufferSize</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#cc1bb8de7549bf9d" class="i property">Width</a> - 1;
 
                        <span class="c">// If the end position is before the start position, then capture the entire buffer.</span>
                        <b>if</b> (<span class="r44 r">endPosition</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#168280a926d1b9da" class="i property">Y</a> &lt; <a href="#9fe4fceac19686f4" class="i field">_startPosition</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#168280a926d1b9da" class="i property">Y</a>)
                        {
                            <a href="#9fe4fceac19686f4" class="i field">_startPosition</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#168280a926d1b9da" class="i property">Y</a> = 0;
                        }
 
                        <span class="i n">Host</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r45 rd" class="r45 r">bufferContents</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#02aa83fed0f18b62" class="i method">GetBufferContents</a>(
                            <b>new</b> <span class="i n">Host</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#04eceb4dbc00ca67" class="t constructor">Rectangle</a>(<a href="#9fe4fceac19686f4" class="i field">_startPosition</a>, <span class="r44 r">endPosition</span>));
 
                        <span class="i">StringBuilder</span> <span id="r46 rd" class="r46 r">lineContents</span> = <b>new</b> <span class="i">StringBuilder</span>();
                        <span class="i">StringBuilder</span> <span id="r47 rd" class="r47 r">bufferText</span> = <b>new</b> <span class="i">StringBuilder</span>();
 
                        <b>for</b> (<b>int</b> <span id="r48 rd" class="r48 r">row</span> = 0; <span class="r48 r">row</span> &lt; <span class="r45 r">bufferContents</span>.<span class="i">GetLength</span>(0); <span class="r48 r">row</span>++)
                        {
                            <b>if</b> (<span class="r48 r">row</span> &gt; 0)
                            {
                                <span class="r47 r">bufferText</span>.<span class="i">Append</span>(<span class="i">Environment</span>.<span class="i">NewLine</span>);
                            }
 
                            <span class="r46 r">lineContents</span>.<span class="i">Clear</span>();
                            <b>for</b> (<b>int</b> <span id="r49 rd" class="r49 r">column</span> = 0; <span class="r49 r">column</span> &lt; <span class="r45 r">bufferContents</span>.<span class="i">GetLength</span>(1); <span class="r49 r">column</span>++)
                            {
                                <span class="r46 r">lineContents</span>.<span class="i">Append</span>(<span class="r45 r">bufferContents</span>[<span class="r48 r">row</span>, <span class="r49 r">column</span>].<a href="hostifaces/MshHostRawUserInterface.cs.html#b94f4479d2cd5557" class="i property">Character</a>);
                            }
 
                            <span class="r47 r">bufferText</span>.<span class="i">Append</span>(<span class="r46 r">lineContents</span>.<span class="i">ToString</span>().<span class="i">TrimEnd</span>(<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="Utils.cs.html#7558d85b44c5e428" class="i field">SpaceOrTab</a>));
                        }
 
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<span class="i">TranscribeResult</span>(<span class="r47 r">bufferText</span>.<span class="i">ToString</span>());
                    }
 
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<span class="i">SetVariable</span>(<a href="SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="SpecialVariables.cs.html#fe9ae54e56fef582" class="i field">LastExitCodeVarPath</a>, <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">ExitCode</span>);
                    <b>if</b> (<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">ExitCode</span> == 0)
                    {
                        <b>return</b>;
                    }
 
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#895cb9f77d1d9539" class="i property">PipelineProcessor</a>.<a href="pipeline.cs.html#813a2622f5f1116c" class="i property">ExecutionFailed</a> = <b>true</b>;
 
                    <b>if</b> (!<a href="ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>.<a href="ExperimentalFeature/ExperimentalFeature.cs.html#e292001e34f610da" class="i method">IsEnabled</a>(<a href="ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>.<a href="ExperimentalFeature/ExperimentalFeature.cs.html#4eee14643cf93543" class="i field">PSNativeCommandErrorActionPreferenceFeatureName</a>)
                        || !<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#0aa14c6ccdb7807d" class="i method">GetBooleanPreference</a>(<a href="SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="SpecialVariables.cs.html#ad9b2321887069c1" class="i field">PSNativeCommandUseErrorActionPreferenceVarPath</a>, <span class="r50 r">defaultPref</span>: <b>false</b>, <b>out _</b>))
                    {
                        <b>return</b>;
                    }
 
                    <b>const string</b> <span id="r51 rd" class="r51 r">errorId</span> = <b>nameof</b>(<span class="i">CommandBaseStrings</span>.<span class="i">ProgramExitedWithNonZeroCode</span>);
 
                    <b>string</b> <span id="r52 rd" class="r52 r">errorMsg</span> = <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                        <span class="i">CommandBaseStrings</span>.<span class="i">ProgramExitedWithNonZeroCode</span>,
                        <a href="#9eca51c0812cb595" class="i property">NativeCommandName</a>,
                        <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">ExitCode</span>);
 
                    <a href="#0e8dd66eb0a72853" class="k">var</a> <span id="r53 rd" class="r53 r">exception</span> = <b>new</b> <span class="t">NativeCommandExitException</span>(
                        <a href="#ca7f636a3bdb6f4b" class="i property">Path</a>,
                        <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">ExitCode</span>,
                        <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">Id</span>,
                        <span class="r52 r">errorMsg</span>,
                        <span class="r51 r">errorId</span>);
 
                    <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r54 rd" class="r54 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r53 r">exception</span>, <span class="r51 r">errorId</span>, <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <span class="i">targetObject</span>: <a href="#9eca51c0812cb595" class="i property">NativeCommandName</a>);
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#f530015bdc5f7e2d" class="i method">_WriteErrorSkipAllowCheck</a>(<span class="r54 r">errorRecord</span>);
                }
            }
            <b>catch</b> (<span class="i">Win32Exception</span> <span id="r55 rd" class="r55 r">e</span>)
            {
                <span class="r43 r">exceptionToRethrow</span> = <span class="r55 r">e</span>;
            }
            <b>catch</b> (<a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a>)
            {
                <span class="c">// If we&#39;re stopping the process, just rethrow this exception...</span>
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r56 rd" class="r56 r">e</span>)
            {
                <span class="r43 r">exceptionToRethrow</span> = <span class="r56 r">e</span>;
            }
            <b>finally</b>
            {
                <span class="c">// Do some cleanup</span>
                <a href="#d01db1922b80b875" class="i method">CleanUp</a>();
            }
 
            <span class="c">// An exception was thrown while attempting to run the program</span>
            <span class="c">// so wrap and rethrow it here...</span>
            <b>if</b> (<span class="r43 r">exceptionToRethrow</span> != <b>null</b>)
            {
                <span class="c">// It&#39;s a system exception so wrap it in one of ours and re-throw.</span>
                <b>string</b> <span id="r57 rd" class="r57 r">message</span> = <a href="../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">ParserStrings</span>.<span class="i">ProgramFailedToExecute</span>,
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#9eca51c0812cb595" class="i property">NativeCommandName</a>, <span class="r43 r">exceptionToRethrow</span>.<span class="i">Message</span>,
                    <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#c6e9275e22dd1db0" class="i property">PositionMessage</a>);
                <a href="../utils/CommandProcessorExceptions.cs.html#cbf9f9dae531f6ae" class="t t">ApplicationFailedException</a> <span id="r58 rd" class="r58 r">appFailedException</span> = <b>new</b> <a href="../utils/CommandProcessorExceptions.cs.html#a42372b6da100d15" class="t constructor">ApplicationFailedException</a>(<span class="r57 r">message</span>, <span class="r43 r">exceptionToRethrow</span>);
 
                <span class="c">// There is no need to set this exception here since this exception will eventually be caught by pipeline processor.</span>
                <span class="c">// this.commandRuntime.PipelineProcessor.ExecutionFailed = true;</span>
 
                <b>throw</b> <span class="r58 r">appFailedException</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Process cleanup with Child Process cleanup
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Utility routine to kill a process, discarding non-critical exceptions.</span>
        <span class="c">///</span><span class="c"> This utility makes two passes at killing a process. In the first pass,</span>
        <span class="c">///</span><span class="c"> if the process handle is invalid (as seems to be the case with an ntvdm)</span>
        <span class="c">///</span><span class="c"> then we try to get a fresh handle based on the original process id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">processToKill</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The process to kill.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="78a69d57a7142c6c" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">KillProcess</a>(<span class="i">Process</span> <span id="r59 rd" class="r59 r">processToKill</span>)
        {
            <b>if</b> (<a href="#27173c2526d1ef9a" class="t t">NativeCommandProcessor</a>.<a href="#20e4f9ea3187f2d9" class="i property">IsServerSide</a>)
            {
                <span class="i">Process</span>[] <span id="r60 rd" class="r60 r">currentlyRunningProcs</span> = <span class="i">Process</span>.<span class="i">GetProcesses</span>();
                <a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a>[] <span id="r61 rd" class="r61 r">procsWithParentId</span> = <a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a>.<a href="#5789ebd1d14a7d96" class="i method">Construct</a>(<span class="r60 r">currentlyRunningProcs</span>);
                <a href="#f3f24beab4986225" class="i method">KillProcessAndChildProcesses</a>(<span class="r59 r">processToKill</span>, <span class="r61 r">procsWithParentId</span>);
                <b>return</b>;
            }
 
            <b>try</b>
            {
                <span class="r59 r">processToKill</span>.<span class="i">Kill</span>();
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">ComponentModel</span>.<span class="i">Win32Exception</span>)
            {
                <b>try</b>
                {
                    <span class="c">// For processes running in an NTVDM, trying to kill with</span>
                    <span class="c">// the original handle fails with a Win32 error, so we&#39;ll</span>
                    <span class="c">// use the ID and try to get a new handle...</span>
                    <span class="i">Process</span> <span id="r62 rd" class="r62 r">newHandle</span> = <span class="i">Process</span>.<span class="i">GetProcessById</span>(<span class="r59 r">processToKill</span>.<span class="i">Id</span>);
                    <span class="c">// If the process was not found, we won&#39;t get here...</span>
                    <span class="r62 r">newHandle</span>.<span class="i">Kill</span>();
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Used by remote server to kill a process tree given</span>
        <span class="c">///</span><span class="c"> a process id. Process class does not have ParentId</span>
        <span class="c">///</span><span class="c"> property, so this wrapper uses WMI to get ParentId</span>
        <span class="c">///</span><span class="c"> and wraps the original process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal struct</b> <a id="5bc97bf8306384c9" href="../R/5bc97bf8306384c9.html" target="n" data-glyph="110,1" class="t t"><span id="4a4d382934bd8dcc">ProcessWithParentId</span></a>
        {
            <b>public</b> <span class="i">Process</span> <a id="0e147cc1d51f0d93" href="../R/0e147cc1d51f0d93.html" target="n" data-glyph="42,2" class="i field">OriginalProcessInstance</a>;
            <b>private int</b> <a id="c57767cf0a87b6dd" href="../R/c57767cf0a87b6dd.html" target="n" data-glyph="46,2" class="i field">_parentId</a>;
 
            <b>public int</b> <a id="daacd896653ad35a" href="../R/daacd896653ad35a.html" target="n" data-glyph="102,2" class="i property">ParentId</a>
            {
                <b>get</b>
                {
                    <span class="c">// Construct parent id only once.</span>
                    <b>if</b> (<a href="#c57767cf0a87b6dd" class="i field">_parentId</a> == <b>int</b>.<span class="i">MinValue</span>)
                    {
                        <a href="#422d674a1ffd0d7a" class="i method">ConstructParentId</a>();
                    }
 
                    <b>return</b> <a href="#c57767cf0a87b6dd" class="i field">_parentId</a>;
                }
            }
 
            <b>public</b> <a id="18c9e28c1fb53cf7" href="../R/18c9e28c1fb53cf7.html" target="n" data-glyph="72,2" class="t constructor">ProcessWithParentId</a>(<span class="i">Process</span> <span id="r63 rd" class="r63 r">originalProcess</span>)
            {
                <a href="#0e147cc1d51f0d93" class="i field">OriginalProcessInstance</a> = <span class="r63 r">originalProcess</span>;
                <a href="#c57767cf0a87b6dd" class="i field">_parentId</a> = <b>int</b>.<span class="i">MinValue</span>;
            }
 
            <b>public static</b> <a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a>[] <a id="5789ebd1d14a7d96" href="../R/5789ebd1d14a7d96.html" target="n" data-glyph="72,2" class="i method">Construct</a>(<span class="i">Process</span>[] <span id="r64 rd" class="r64 r">originalProcCollection</span>)
            {
                <a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a>[] <span id="r65 rd" class="r65 r">result</span> = <b>new</b> <a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a>[<span class="r64 r">originalProcCollection</span>.<span class="i">Length</span>];
                <b>for</b> (<b>int</b> <span id="r66 rd" class="r66 r">index</span> = 0; <span class="r66 r">index</span> &lt; <span class="r64 r">originalProcCollection</span>.<span class="i">Length</span>; <span class="r66 r">index</span>++)
                {
                    <span class="r65 r">result</span>[<span class="r66 r">index</span>] = <b>new</b> <a href="#18c9e28c1fb53cf7" class="t constructor">ProcessWithParentId</a>(<span class="r64 r">originalProcCollection</span>[<span class="r66 r">index</span>]);
                }
 
                <b>return</b> <span class="r65 r">result</span>;
            }
 
            <b>private void</b> <a id="422d674a1ffd0d7a" href="../R/422d674a1ffd0d7a.html" target="n" data-glyph="76,2" class="i method">ConstructParentId</a>()
            {
                <b>try</b>
                {
                    <span class="c">// note that we have tried to retrieved parent id once.</span>
                    <span class="c">// retrieving parent id might throw exceptions..so</span>
                    <span class="c">// setting this to -1 so that we dont try again to</span>
                    <span class="c">// get the parent id.</span>
                    <a href="#c57767cf0a87b6dd" class="i field">_parentId</a> = -1;
 
                    <span class="i">Process</span> <span id="r67 rd" class="r67 r">parentProcess</span> = <a href="../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../utils/PsUtils.cs.html#052a0531c6c08051" class="i method">GetParentProcess</a>(<a href="#0e147cc1d51f0d93" class="i field">OriginalProcessInstance</a>);
                    <b>if</b> (<span class="r67 r">parentProcess</span> != <b>null</b>)
                    {
                        <a href="#c57767cf0a87b6dd" class="i field">_parentId</a> = <span class="r67 r">parentProcess</span>.<span class="i">Id</span>;
                    }
                }
                <b>catch</b> (<span class="i">Win32Exception</span>)
                {
                }
                <b>catch</b> (<span class="i">InvalidOperationException</span>)
                {
                }
                <b>catch</b> (<span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">CimException</span>)
                {
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Kills the process tree (process + associated child processes)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">processToKill</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">currentlyRunningProcs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="f3f24beab4986225" href="../R/f3f24beab4986225.html" target="n" data-glyph="76,1" class="i method">KillProcessAndChildProcesses</a>(<span class="i">Process</span> <span id="r68 rd" class="r68 r">processToKill</span>,
            <a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a>[] <span id="r69 rd" class="r69 r">currentlyRunningProcs</span>)
        {
            <b>try</b>
            {
                <span class="c">// Kill children first..</span>
                <b>int</b> <span id="r70 rd" class="r70 r">processId</span> = <span class="r68 r">processToKill</span>.<span class="i">Id</span>;
                <a href="#af0db22361234196" class="i method">KillChildProcesses</a>(<span class="r70 r">processId</span>, <span class="r69 r">currentlyRunningProcs</span>);
 
                <span class="c">// kill the parent after children terminated.</span>
                <span class="r68 r">processToKill</span>.<span class="i">Kill</span>();
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">ComponentModel</span>.<span class="i">Win32Exception</span>)
            {
                <b>try</b>
                {
                    <span class="c">// For processes running in an NTVDM, trying to kill with</span>
                    <span class="c">// the original handle fails with a Win32 error, so we&#39;ll</span>
                    <span class="c">// use the ID and try to get a new handle...</span>
                    <span class="i">Process</span> <span id="r71 rd" class="r71 r">newHandle</span> = <span class="i">Process</span>.<span class="i">GetProcessById</span>(<span class="r68 r">processToKill</span>.<span class="i">Id</span>);
 
                    <span class="c">// If the process was not found, we won&#39;t get here...</span>
                    <span class="r71 r">newHandle</span>.<span class="i">Kill</span>();
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
        }
 
        <b>private static void</b> <a id="af0db22361234196" href="../R/af0db22361234196.html" target="n" data-glyph="76,1" class="i method">KillChildProcesses</a>(<b>int</b> <span id="r72 rd" class="r72 r">parentId</span>, <a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a>[] <span id="r73 rd" class="r73 r">currentlyRunningProcs</span>)
        {
            <b>foreach</b> (<a href="#5bc97bf8306384c9" class="t t">ProcessWithParentId</a> <span id="r74 rd" class="r74 r">proc</span> <b>in</b> <span class="r73 r">currentlyRunningProcs</span>)
            {
                <b>if</b> ((<span class="r74 r">proc</span>.<a href="#daacd896653ad35a" class="i property">ParentId</a> &gt; 0) &amp;&amp; (<span class="r74 r">proc</span>.<a href="#daacd896653ad35a" class="i property">ParentId</a> == <span class="r72 r">parentId</span>))
                {
                    <a href="#f3f24beab4986225" class="i method">KillProcessAndChildProcesses</a>(<span class="r74 r">proc</span>.<a href="#0e147cc1d51f0d93" class="i field">OriginalProcessInstance</a>, <span class="r73 r">currentlyRunningProcs</span>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> checkForConsoleApplication
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the passed in process is a windows application.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">ArchitectureSensitive</span>]
        <b>private static bool</b> <a id="c036720cc1194112" href="../R/c036720cc1194112.html" target="n" data-glyph="76,1" class="i method">IsWindowsApplication</a>(<b>string</b> <span id="r75 rd" class="r75 r">fileName</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return false;
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>if</b> (!<a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#527d8835d493a8d0" class="i property">IsWindowsDesktop</a>) { <b>return</b> <b>false</b>; }
 
            <span class="c">// SHGetFileInfo() does not understand reparse points and returns 0 (&quot;non exe or error&quot;)</span>
            <span class="c">// so we are trying to get a real path before.</span>
            <span class="c">// It is a workaround for Microsoft Store applications.</span>
            <b>string</b> <span id="r76 rd" class="r76 r">realPath</span> = <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="../namespaces/FileSystemProvider.cs.html#916c1750999d4e10" class="t t">InternalSymbolicLinkLinkCodeMethods</a>.<a href="../namespaces/FileSystemProvider.cs.html#8660b3c94688ae73" class="i method">WinInternalGetTarget</a>(<span class="r75 r">fileName</span>);
            <b>if</b> (<span class="r76 r">realPath</span> <b>is not null</b>)
            {
                <span class="r75 r">fileName</span> = <span class="r76 r">realPath</span>;
            }
 
            <a href="#477db6f07bff62b4" class="t t">SHFILEINFO</a> <span id="r77 rd" class="r77 r">shinfo</span> = <b>new</b> <span class="t">SHFILEINFO</span>();
            <span class="i">IntPtr</span> <span id="r78 rd" class="r78 r">type</span> = <a href="#3828590165dc5313" class="i method">SHGetFileInfo</a>(<span class="r75 r">fileName</span>, 0, <b>ref</b> <span class="r77 r">shinfo</span>, (<b>uint</b>)<span class="i">Marshal</span>.<span class="i">SizeOf</span>(<span class="r77 r">shinfo</span>), <a href="#eb81300c163bdb23" class="i field">SHGFI_EXETYPE</a>);
 
            <b>switch</b> ((<b>int</b>)<span class="r78 r">type</span>)
            {
                <b>case</b> 0x0:
                    <span class="c">// 0x0 = not an exe</span>
                    <b>return</b> <b>false</b>;
                <b>case</b> 0x5a4d:
                    <span class="c">// 0x5a4d - DOS .exe or .com file</span>
                    <b>return</b> <b>false</b>;
                <b>case</b> 0x4550:
                    <span class="c">// 0x4550 - windows console app or bat file</span>
                    <b>return</b> <b>false</b>;
                <b>default</b>:
                    <span class="c">// anything else - is a windows program...</span>
                    <b>return</b> <b>true</b>;
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> checkForConsoleApplication
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is set to true when StopProcessing is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="4e4578f1e677f183" href="../R/4e4578f1e677f183.html" target="n" data-glyph="46,1" class="i field">_stopped</a> = <b>false</b>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Routine used to stop this processing on this node...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="9cb6735c35fdf78b" href="../R/9cb6735c35fdf78b.html" target="n" data-glyph="74,1" class="i method">StopProcessing</a>()
        {
            <b>lock</b> (<a href="#63a1e4dcac363ac1" class="i field">_sync</a>)
            {
                <b>if</b> (<a href="#4e4578f1e677f183" class="i field">_stopped</a>) <b>return</b>;
                <a href="#4e4578f1e677f183" class="i field">_stopped</a> = <b>true</b>;
            }
 
            <b>if</b> (<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a> != <b>null</b>)
            {
                <b>if</b> (!<a href="#7a3aa7778941cbc5" class="i field">_runStandAlone</a>)
                {
                    <span class="c">// Stop input writer</span>
                    <a href="#c969dd4044f5fbca" class="i field">_inputWriter</a>.<a href="#1feae3597ace4ddb" class="i method">Stop</a>();
 
                    <span class="i">KillProcess</span>(<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> internal overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Aggressively clean everything up...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="d01db1922b80b875" href="../R/d01db1922b80b875.html" target="n" data-glyph="76,1" class="i method">CleanUp</a>()
        {
            <span class="c">// We need to call &#39;NotifyEndApplication&#39; as appropriate during cleanup</span>
            <b>if</b> (<a href="#6b31ddaf74c1e954" class="i field">_hasNotifiedBeginApplication</a>)
            {
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#0fda743d438f5210" class="i method">NotifyEndApplication</a>();
            }
 
            <b>try</b>
            {
                <b>if</b> (<a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a> != <b>null</b>)
                {
                    <span class="c">// on Unix, we need to kill the process to ensure it terminates as Dispose() merely</span>
                    <span class="c">// closes the redirected streams and the processs does not exit on macOS.  However,</span>
                    <span class="c">// on Windows, a winexe like notepad should continue running so we don&#39;t want to kill it.</span>
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">                    try
                    {
                        _nativeProcess.Kill();
                    }
                    catch
                    {
                        // Ignore all exception since it is cleanup.
                    }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                    <a href="#61f9c2b68a8ad25f" class="i field">_nativeProcess</a>.<span class="i">Dispose</span>();
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
        }
 
        <b>private void</b> <a id="213ba7ba32113598" href="../R/213ba7ba32113598.html" target="n" data-glyph="76,1" class="i method">ProcessOutputRecord</a>(<a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a> <span id="r79 rd" class="r79 r">outputValue</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r79 r">outputValue</span> != <b>null</b>, <span class="s">&quot;only object of type ProcessOutputObject expected&quot;</span>);
 
            <b>if</b> (<span class="r79 r">outputValue</span>.<a href="#40dfc75a308ab139" class="i property">Stream</a> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c3fa9200d2d7861e" class="i field">Error</a>)
            {
                <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r80 rd" class="r80 r">record</span> = <span class="r79 r">outputValue</span>.<a href="#1b710b4ec41c1e43" class="i property">Data</a> <b>as</b> <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>;
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r80 r">record</span> != <b>null</b>, <span class="s">&quot;ProcessReader should ensure that data is ErrorRecord&quot;</span>);
                <span class="r80 r">record</span>.<a href="ErrorPackage.cs.html#14b8261653db7b03" class="i method">SetInvocationInfo</a>(<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>);
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#f530015bdc5f7e2d" class="i method">_WriteErrorSkipAllowCheck</a>(<span class="r80 r">record</span>, <span class="r81 r">isFromNativeStdError</span>: <b>true</b>);
            }
            <b>else</b> <b>if</b> (<span class="r79 r">outputValue</span>.<a href="#40dfc75a308ab139" class="i property">Stream</a> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#8e4e5a8bf4ca3949" class="i field">Output</a>)
            {
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#393b6749b38e4c96" class="i method">_WriteObjectSkipAllowCheck</a>(<span class="r79 r">outputValue</span>.<a href="#1b710b4ec41c1e43" class="i property">Data</a>);
            }
            <b>else</b> <b>if</b> (<span class="r79 r">outputValue</span>.<a href="#40dfc75a308ab139" class="i property">Stream</a> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#1bf9c2a844980805" class="i field">Debug</a>)
            {
                <b>string</b> <span id="r82 rd" class="r82 r">temp</span> = <span class="r79 r">outputValue</span>.<a href="#1b710b4ec41c1e43" class="i property">Data</a> <b>as string</b>;
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r82 r">temp</span> != <b>null</b>, <span class="s">&quot;ProcessReader should ensure that data is string&quot;</span>);
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#9248edb70cbb7387" class="i property">PSHostInternal</a>.<a href="hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#92e834f5f174ffe2" class="i method">WriteDebugLine</a>(<span class="r82 r">temp</span>);
            }
            <b>else</b> <b>if</b> (<span class="r79 r">outputValue</span>.<a href="#40dfc75a308ab139" class="i property">Stream</a> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c73d449be2277109" class="i field">Verbose</a>)
            {
                <b>string</b> <span id="r83 rd" class="r83 r">temp</span> = <span class="r79 r">outputValue</span>.<a href="#1b710b4ec41c1e43" class="i property">Data</a> <b>as string</b>;
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r83 r">temp</span> != <b>null</b>, <span class="s">&quot;ProcessReader should ensure that data is string&quot;</span>);
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#9248edb70cbb7387" class="i property">PSHostInternal</a>.<a href="hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#be9a01fd092f8614" class="i method">WriteVerboseLine</a>(<span class="r83 r">temp</span>);
            }
            <b>else</b> <b>if</b> (<span class="r79 r">outputValue</span>.<a href="#40dfc75a308ab139" class="i property">Stream</a> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#a189f93bb16b3fbf" class="i field">Warning</a>)
            {
                <b>string</b> <span id="r84 rd" class="r84 r">temp</span> = <span class="r79 r">outputValue</span>.<a href="#1b710b4ec41c1e43" class="i property">Data</a> <b>as string</b>;
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r84 r">temp</span> != <b>null</b>, <span class="s">&quot;ProcessReader should ensure that data is string&quot;</span>);
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#9248edb70cbb7387" class="i property">PSHostInternal</a>.<a href="hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#1c7bdddbbd1bab31" class="i method">WriteWarningLine</a>(<span class="r84 r">temp</span>);
            }
            <b>else</b> <b>if</b> (<span class="r79 r">outputValue</span>.<a href="#40dfc75a308ab139" class="i property">Stream</a> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#fbd551536f154623" class="i field">Progress</a>)
            {
                <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r85 rd" class="r85 r">temp</span> = <span class="r79 r">outputValue</span>.<a href="#1b710b4ec41c1e43" class="i property">Data</a> <b>as</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
                <b>if</b> (<span class="r85 r">temp</span> != <b>null</b>)
                {
                    <b>long</b> <span id="r86 rd" class="r86 r">sourceId</span> = 0;
                    <a href="MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r87 rd" class="r87 r">info</span> = <span class="r85 r">temp</span>.<a href="MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;SourceId&quot;</span>];
                    <b>if</b> (<span class="r87 r">info</span> != <b>null</b>)
                    {
                        <span class="r86 r">sourceId</span> = (<b>long</b>)<span class="r87 r">info</span>.<a href="MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>;
                    }
 
                    <span class="r87 r">info</span> = <span class="r85 r">temp</span>.<a href="MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;Record&quot;</span>];
                    <a href="ProgressRecord.cs.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a> <span id="r88 rd" class="r88 r">rec</span> = <b>null</b>;
                    <b>if</b> (<span class="r87 r">info</span> != <b>null</b>)
                    {
                        <span class="r88 r">rec</span> = <span class="r87 r">info</span>.<a href="MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a> <b>as</b> <a href="ProgressRecord.cs.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a>;
                    }
 
                    <b>if</b> (<span class="r88 r">rec</span> != <b>null</b>)
                    {
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#9248edb70cbb7387" class="i property">PSHostInternal</a>.<a href="hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<span class="i">WriteProgress</span>(<span class="r86 r">sourceId</span>, <span class="r88 r">rec</span>);
                    }
                }
            }
            <b>else</b> <b>if</b> (<span class="r79 r">outputValue</span>.<a href="#40dfc75a308ab139" class="i property">Stream</a> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#1b928c156cefa801" class="i field">Information</a>)
            {
                <a href="InformationRecord.cs.html#508a9dbac37ec093" class="t t">InformationRecord</a> <span id="r89 rd" class="r89 r">record</span> = <span class="r79 r">outputValue</span>.<a href="#1b710b4ec41c1e43" class="i property">Data</a> <b>as</b> <a href="InformationRecord.cs.html#508a9dbac37ec093" class="t t">InformationRecord</a>;
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r89 r">record</span> != <b>null</b>, <span class="s">&quot;ProcessReader should ensure that data is InformationRecord&quot;</span>);
                <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#896a3a80d32868f8" class="i method">WriteInformation</a>(<span class="r89 r">record</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get whether we should treat this executable with special handling and use the legacy passing style.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r90 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="190e16452e9189d2" href="../R/190e16452e9189d2.html" target="n" data-glyph="76,1" class="i method">UseSpecialArgumentPassing</a>(<b>string</b> <span id="r90 rd" class="r90 r">filePath</span>) =&gt;
            <a href="#1d75706192c6db39" class="i property">NativeParameterBinderController</a>.<a href="NativeCommandParameterBinderController.cs.html#c09a84c3cbe4e0ad" class="i property">ArgumentPassingStyle</a> <b>switch</b>
            {
                <a href="CommandBase.cs.html#4ada58665c21257f" class="t t">NativeArgumentPassingStyle</a>.<a href="CommandBase.cs.html#50501f6a8c1b4a48" class="i field">Legacy</a> =&gt; <b>true</b>,
                <a href="CommandBase.cs.html#4ada58665c21257f" class="t t">NativeArgumentPassingStyle</a>.<a href="CommandBase.cs.html#6f661de747849cb6" class="i field">Windows</a> =&gt; <a href="#115e41c4773c3fef" class="i method">ShouldUseLegacyPassingStyle</a>(<span class="r90 r">filePath</span>),
                <b>_</b> =&gt; <b>false</b>
            };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the ProcessStartInfo for process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">redirectOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A boolean that indicates that, when true, output from the process is redirected to a stream, and otherwise is sent to stdout.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">redirectError</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A boolean that indicates that, when true, error output from the process is redirected to a stream, and otherwise is sent to stderr.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">redirectInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A boolean that indicates that, when true, input to the process is taken from a stream, and otherwise is taken from stdin.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">soloCommand</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A boolean that indicates, when true, that the command to be executed is not part of a pipeline, and otherwise indicates that is is.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A ProcessStartInfo object which is the base of the native invocation.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">ProcessStartInfo</span> <a id="5bb2b615831d3841" href="../R/5bb2b615831d3841.html" target="n" data-glyph="76,1" class="i method">GetProcessStartInfo</a>(
            <b>bool</b> <span id="r91 rd" class="r91 r">redirectOutput</span>,
            <b>bool</b> <span id="r92 rd" class="r92 r">redirectError</span>,
            <b>bool</b> <span id="r93 rd" class="r93 r">redirectInput</span>,
            <b>bool</b> <span id="r94 rd" class="r94 r">soloCommand</span>)
        {
            <b>var</b> <span id="r95 rd" class="r95 r">startInfo</span> = <b>new</b> <span class="i">ProcessStartInfo</span>
            {
                <span class="i">FileName</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>
            };
 
            <b>if</b> (!<a href="#5891406c5765d0f0" class="i method">IsExecutable</a>(<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>))
            {
                <b>if</b> (<a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#38977c53f94fb1a0" class="i property">IsNanoServer</a> || <a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#aa5ad57a38d993ae" class="i property">IsIoT</a>)
                {
                    <span class="c">// Shell doesn&#39;t exist on headless SKUs, so documents cannot be associated with an application.</span>
                    <span class="c">// Therefore, we cannot run document in this case.</span>
                    <b>throw</b> <a href="lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>,
                        <b>typeof</b>(<a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#848be65db101584d" class="i property">InvocationExtent</a>,
                        <span class="s">&quot;CantActivateDocumentInPowerShellCore&quot;</span>,
                        <span class="i">ParserStrings</span>.<span class="i">CantActivateDocumentInPowerShellCore</span>,
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>);
                }
 
                <span class="c">// We only want to ShellExecute something that is standalone...</span>
                <b>if</b> (!<span class="r94 r">soloCommand</span>)
                {
                    <b>throw</b> <a href="lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>,
                        <b>typeof</b>(<a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#848be65db101584d" class="i property">InvocationExtent</a>,
                        <span class="s">&quot;CantActivateDocumentInPipeline&quot;</span>,
                        <span class="i">ParserStrings</span>.<span class="i">CantActivateDocumentInPipeline</span>,
                        <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>);
                }
 
                <span class="r95 r">startInfo</span>.<span class="i">UseShellExecute</span> = <b>true</b>;
            }
            <b>else</b>
            {
                <span class="r95 r">startInfo</span>.<span class="i">UseShellExecute</span> = <b>false</b>;
                <span class="r95 r">startInfo</span>.<span class="i">RedirectStandardInput</span> = <span class="r93 r">redirectInput</span>;
 
                <b>if</b> (<span class="r91 r">redirectOutput</span>)
                {
                    <span class="r95 r">startInfo</span>.<span class="i">RedirectStandardOutput</span> = <b>true</b>;
                    <span class="r95 r">startInfo</span>.<span class="i">StandardOutputEncoding</span> = <span class="i">Console</span>.<span class="i">OutputEncoding</span>;
                }
 
                <b>if</b> (<span class="r92 r">redirectError</span>)
                {
                    <span class="r95 r">startInfo</span>.<span class="i">RedirectStandardError</span> = <b>true</b>;
                    <span class="r95 r">startInfo</span>.<span class="i">StandardErrorEncoding</span> = <span class="i">Console</span>.<span class="i">OutputEncoding</span>;
                }
            }
 
            <span class="c">// For minishell value of -outoutFormat parameter depends on value of redirectOutput.</span>
            <span class="c">// So we delay the parameter binding. Do parameter binding for minishell now.</span>
            <b>if</b> (<a href="#aacc8a7845cd5382" class="i field">_isMiniShell</a>)
            {
                <a href="MinishellParameterBinderController.cs.html#4eed1ccbae50f5e9" class="t t">MinishellParameterBinderController</a> <span id="r96 rd" class="r96 r">mpc</span> = (<a href="MinishellParameterBinderController.cs.html#4eed1ccbae50f5e9" class="t t">MinishellParameterBinderController</a>)<a href="#1d75706192c6db39" class="i property">NativeParameterBinderController</a>;
                <span class="r96 r">mpc</span>.<span class="i">BindParameters</span>(<a href="CommandProcessorBase.cs.html#5bfa2b362a5e8358" class="i field">arguments</a>, <span class="r95 r">startInfo</span>.<span class="i">RedirectStandardOutput</span>, <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#20e8052a252e9b6d" class="i property">Name</a>);
                <span class="r95 r">startInfo</span>.<span class="i">CreateNoWindow</span> = <span class="r96 r">mpc</span>.<a href="MinishellParameterBinderController.cs.html#15f235a7e0b4ed60" class="i property">NonInteractive</a>;
            }
 
            <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r97 rd" class="r97 r">context</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>;
 
            <span class="c">// We provide the user a way to select the new behavior via a new preference variable</span>
            <b>using</b> (<a href="ParameterBinderBase.cs.html#6a035e6bf95bfc67" class="t t">ParameterBinderBase</a>.<a href="ParameterBinderBase.cs.html#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;BIND NAMED native application line args [{0}]&quot;</span>, <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="#ca7f636a3bdb6f4b" class="i property">Path</a>))
            {
                <span class="c">// We need to check if we&#39;re using legacy argument passing or it&#39;s a special case.</span>
                <b>if</b> (<span class="i">UseSpecialArgumentPassing</span>(<span class="r95 r">startInfo</span>.<span class="i">FileName</span>))
                {
                    <b>using</b> (<a href="ParameterBinderBase.cs.html#6a035e6bf95bfc67" class="t t">ParameterBinderBase</a>.<a href="ParameterBinderBase.cs.html#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<a href="../utils/StructuredTraceSource.cs.html#ff5e86462c8f4f03" class="i method">TraceScope</a>(<span class="s">&quot;BIND argument [{0}]&quot;</span>, <a href="#1d75706192c6db39" class="i property">NativeParameterBinderController</a>.<a href="NativeCommandParameterBinderController.cs.html#ad6710cc61084359" class="i property">Arguments</a>))
                    {
                        <span class="r95 r">startInfo</span>.<span class="i">Arguments</span> = <a href="#1d75706192c6db39" class="i property">NativeParameterBinderController</a>.<a href="NativeCommandParameterBinderController.cs.html#ad6710cc61084359" class="i property">Arguments</a>;
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Use new API for running native application</span>
                    <b>int</b> <span id="r98 rd" class="r98 r">position</span> = 0;
                    <b>foreach</b> (<b>string</b> <span id="r99 rd" class="r99 r">nativeArgument</span> <b>in</b> <a href="#1d75706192c6db39" class="i property">NativeParameterBinderController</a>.<a href="NativeCommandParameterBinderController.cs.html#2f7aa42053511445" class="i property">ArgumentList</a>)
                    {
                        <b>if</b> (<span class="r99 r">nativeArgument</span> != <b>null</b>)
                        {
                            <b>using</b> (<a href="ParameterBinderBase.cs.html#6a035e6bf95bfc67" class="t t">ParameterBinderBase</a>.<a href="ParameterBinderBase.cs.html#53b6cf6cdd8c3311" class="i field">bindingTracer</a>.<span class="i">TraceScope</span>(<span class="s">&quot;BIND cmd line arg [{0}] to position [{1}]&quot;</span>, <span class="r99 r">nativeArgument</span>, <span class="r98 r">position</span>++))
                            {
                                <span class="r95 r">startInfo</span>.<span class="i">ArgumentList</span>.<span class="i">Add</span>(<span class="r99 r">nativeArgument</span>);
                            }
                        }
                    }
                }
            }
 
            <span class="c">// Start command in the current filesystem directory</span>
            <b>string</b> <span id="r100 rd" class="r100 r">rawPath</span> =
                <span class="r97 r">context</span>.<a href="ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="SessionStateLocationAPIs.cs.html#d703e25df0731555" class="i method">GetNamespaceCurrentLocation</a>(
                    <span class="r97 r">context</span>.<a href="ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>).<a href="../namespaces/PathInfo.cs.html#16e3fcd7f95c1bfc" class="i property">ProviderPath</a>;
            <span class="r95 r">startInfo</span>.<span class="i">WorkingDirectory</span> = <a href="regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="regex.cs.html#b15b1eaf2241823c" class="i method">Unescape</a>(<span class="r100 r">rawPath</span>);
 
            <b>return</b> <span class="r95 r">startInfo</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determine if we have a special file which will change the way native argument passing</span>
        <span class="c">///</span><span class="c"> is done on Windows. We use legacy behavior for cmd.exe, .bat, .cmd files.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file to use when checking how to pass arguments.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A boolean indicating what passing style should be used.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="115e41c4773c3fef" href="../R/115e41c4773c3fef.html" target="n" data-glyph="76,1" class="i method">ShouldUseLegacyPassingStyle</a>(<b>string</b> <span id="r101 rd" class="r101 r">filePath</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r101 r">filePath</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <a href="#9fb93190aa56eabc" class="i field">s_legacyFileExtensions</a>.<span class="i">Contains</span>(<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r101 r">filePath</span>))
                || <a href="#8c09114b54723157" class="i field">s_legacyCommands</a>.<span class="i">Contains</span>(<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r101 r">filePath</span>));
        }
 
        <b>private static bool</b> <a id="19eb896eec876116" href="../R/19eb896eec876116.html" target="n" data-glyph="76,1" class="i method">IsDownstreamOutDefault</a>(<a href="Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r102 rd" class="r102 r">downstreamPipe</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r102 r">downstreamPipe</span> != <b>null</b>, <span class="s">&quot;Caller makes sure the passed-in parameter is not null.&quot;</span>);
 
            <span class="c">// Check if the downstream cmdlet is Out-Default, which is the default outputter.</span>
            <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r103 rd" class="r103 r">outputProcessor</span> = <span class="r102 r">downstreamPipe</span>.<a href="Pipe.cs.html#586d8abd020e1d4d" class="i property">DownstreamCmdlet</a>;
            <b>if</b> (<span class="r103 r">outputProcessor</span> != <b>null</b>)
            {
                <span class="c">// We have the test &#39;utscript\Engine\TestOutDefaultRedirection.ps1&#39; to check that a user defined</span>
                <span class="c">// Out-Default function should not cause a native command to be redirected. So here we should only</span>
                <span class="c">// compare the command name to avoid breaking change.</span>
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r103 r">outputProcessor</span>.<a href="CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a>.<a href="CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="s">&quot;Out-Default&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="c">// Verify that this isn&#39;t an Out-Default added for transcribing</span>
                    <b>if</b> (!<span class="r103 r">outputProcessor</span>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#1927782a0117ff76" class="i property">BoundParameters</a>.<span class="i">ContainsKey</span>(<span class="s">&quot;Transcript&quot;</span>))
                    {
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method calculates if input and output of the process are redirected.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">isWindowsApplication</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">redirectOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">redirectError</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">redirectInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="d2ed9782e03cce77" href="../R/d2ed9782e03cce77.html" target="n" data-glyph="76,1" class="i method">CalculateIORedirection</a>(<b>bool</b> <span id="r104 rd" class="r104 r">isWindowsApplication</span>, <b>out bool</b> <span id="r105 rd" class="r105 r">redirectOutput</span>, <b>out bool</b> <span id="r106 rd" class="r106 r">redirectError</span>, <b>out bool</b> <span id="r107 rd" class="r107 r">redirectInput</span>)
        {
            <span class="r107 r">redirectInput</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#9a1646f37a942067" class="i property">ExpectingInput</a>;
            <span class="r105 r">redirectOutput</span> = <b>true</b>;
            <span class="r106 r">redirectError</span> = <b>true</b>;
 
            <span class="c">// Figure out if we&#39;re going to run this process &quot;standalone&quot; i.e. without</span>
            <span class="c">// redirecting anything. This is a bit tricky as we always run redirected so</span>
            <span class="c">// we have to see if the redirection is actually being done at the topmost level or not.</span>
 
            <span class="c">// If we&#39;re eligible to be running standalone, that is, without redirection</span>
            <span class="c">// use our pipeline position to determine if we really want to redirect</span>
            <span class="c">// input and error or not. If we&#39;re first in the pipeline, then we don&#39;t</span>
            <span class="c">// redirect input. If we&#39;re last in the pipeline, we don&#39;t redirect output.</span>
 
            <b>if</b> (<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#b9401843293d51d4" class="i property">PipelinePosition</a> == <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="InvocationInfo.cs.html#7d73dcbb6106b235" class="i property">PipelineLength</a>)
            {
                <span class="c">// If the output pipe is the default outputter, for example, calling the native command from command-line host,</span>
                <span class="c">// then we&#39;re possibly running standalone.</span>
                <span class="c">//</span>
                <span class="c">// If the downstream cmdlet is explicitly Out-Default, for example:</span>
                <span class="c">//    $powershell.AddScript(&#39;ipconfig.exe&#39;)</span>
                <span class="c">//    $powershell.AddCommand(&#39;Out-Default&#39;)</span>
                <span class="c">//    $powershell.Invoke())</span>
                <span class="c">// we should not count it as a redirection.</span>
                <b>if</b> (<a href="#19eb896eec876116" class="i method">IsDownstreamOutDefault</a>(<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>))
                {
                    <span class="r105 r">redirectOutput</span> = <b>false</b>;
                }
            }
 
            <span class="c">// See if the error output stream has been redirected, either through an explicit 2&gt; foo.txt or</span>
            <span class="c">// my merging error into output through 2&gt;&amp;1.</span>
            <b>if</b> (<a href="CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="MshCommandRuntime.cs.html#ed59e3b00feab7b1" class="i property">ErrorMergeTo</a> != <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>.<a href="MshCommandRuntime.cs.html#8b0e9f05387e62ca" class="t t">MergeDataStream</a>.<a href="MshCommandRuntime.cs.html#8ab59ea31f703b82" class="i field">Output</a>)
            {
                <span class="c">// If the error output pipe is the default outputter, for example, calling the native command from command-line host,</span>
                <span class="c">// then we&#39;re possibly running standalone.</span>
                <span class="c">//</span>
                <span class="c">// If the downstream cmdlet is explicitly Out-Default, for example:</span>
                <span class="c">//    $powershell.AddScript(&#39;ipconfig.exe&#39;)</span>
                <span class="c">//    $powershell.AddCommand(&#39;Out-Default&#39;)</span>
                <span class="c">//    $powershell.Invoke())</span>
                <span class="c">// we should not count that as a redirection.</span>
                <b>if</b> (<a href="#19eb896eec876116" class="i method">IsDownstreamOutDefault</a>(<a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#c9b17347b060ac3f" class="i field">commandRuntime</a>.<a href="MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a>))
                {
                    <span class="r106 r">redirectError</span> = <b>false</b>;
                }
            }
 
            <span class="c">// In minishell scenario, if output is redirected</span>
            <span class="c">// then error should also be redirected.</span>
            <b>if</b> (!<span class="r106 r">redirectError</span> &amp;&amp; <span class="r105 r">redirectOutput</span> &amp;&amp; <a href="#aacc8a7845cd5382" class="i field">_isMiniShell</a>)
            {
                <span class="r106 r">redirectError</span> = <b>true</b>;
            }
 
            <span class="c">// Remoting server consideration.</span>
            <span class="c">// Currently, the WinRM is using std io pipes to communicate with PowerShell server.</span>
            <span class="c">// To protect these std io pipes from access from user command, we have replaced the original std io pipes with null pipes.</span>
            <span class="c">// The original std io pipes are taken private, to be used by remoting infrastructure only.</span>
            <span class="c">// Doing so prevents user data to corrupt PowerShell remoting communication data which are encoded in a</span>
            <span class="c">// special format.</span>
            <span class="c">// In the following, we check for this server condition.</span>
            <span class="c">// If it is the server, then we redirect all std io handles for the native command.</span>
 
            <b>if</b> (<a href="#27173c2526d1ef9a" class="t t">NativeCommandProcessor</a>.<a href="#20e4f9ea3187f2d9" class="i property">IsServerSide</a>)
            {
                <span class="r107 r">redirectInput</span> = <b>true</b>;
                <span class="r105 r">redirectOutput</span> = <b>true</b>;
                <span class="r106 r">redirectError</span> = <b>true</b>;
            }
            <b>else</b> <b>if</b> (<a href="../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<a href="../CoreCLR/CorePsPlatform.cs.html#527d8835d493a8d0" class="i property">IsWindowsDesktop</a> &amp;&amp; !<span class="r104 r">isWindowsApplication</span>)
            {
                <span class="c">// On Windows desktops, if the command to run is a console application,</span>
                <span class="c">// then allocate a console if there isn&#39;t one attached already...</span>
                <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#259a9aa937757010" class="i method">AllocateHiddenConsole</a>();
 
                <b>if</b> (<a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#eb4e1cce6baea0fa" class="i property">AlwaysCaptureApplicationIO</a>)
                {
                    <span class="r105 r">redirectOutput</span> = <b>true</b>;
                    <span class="r106 r">redirectError</span> = <b>true</b>;
                }
            }
 
            <a href="#7a3aa7778941cbc5" class="i field">_runStandAlone</a> = !<span class="r107 r">redirectInput</span> &amp;&amp; !<span class="r105 r">redirectOutput</span> &amp;&amp; !<span class="r106 r">redirectError</span>;
 
            <b>if</b> (<a href="#7a3aa7778941cbc5" class="i field">_runStandAlone</a>)
            {
                <b>if</b> (<a href="#bfd1c139f3792d7b" class="i field">s_supportScreenScrape</a> == <b>null</b>)
                {
                    <b>try</b>
                    {
                        <a href="#9fe4fceac19686f4" class="i field">_startPosition</a> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#1096ecedf81a22c3" class="i property">CursorPosition</a>;
                        <span class="i n">Host</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#9e00d99644eab7e7" class="t t">BufferCell</a>[,] <span id="r108 rd" class="r108 r">bufferContents</span> = <a href="#27173c2526d1ef9a" class="k">this</a>.<a href="CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>.<a href="hostifaces/MshHostRawUserInterface.cs.html#02aa83fed0f18b62" class="i method">GetBufferContents</a>(
                            <b>new</b> <span class="i n">Host</span>.<a href="hostifaces/MshHostRawUserInterface.cs.html#04eceb4dbc00ca67" class="t constructor">Rectangle</a>(<a href="#9fe4fceac19686f4" class="i field">_startPosition</a>, <a href="#9fe4fceac19686f4" class="i field">_startPosition</a>));
                        <a href="#bfd1c139f3792d7b" class="i field">s_supportScreenScrape</a> = <b>true</b>;
                    }
                    <b>catch</b> (<span class="i">Exception</span>)
                    {
                        <a href="#bfd1c139f3792d7b" class="i field">s_supportScreenScrape</a> = <b>false</b>;
                    }
                }
 
                <span class="c">// if screen scraping isn&#39;t supported, we enable redirection so that the output is still transcribed</span>
                <span class="c">// as redirected output is always transcribed</span>
                <b>if</b> (<a href="#41e610c7c1718309" class="i field">_isTranscribing</a> &amp;&amp; (<a href="#bfd1c139f3792d7b" class="i field">s_supportScreenScrape</a> == <b>false</b>))
                {
                    <span class="r105 r">redirectOutput</span> = <b>true</b>;
                    <span class="r106 r">redirectError</span> = <b>true</b>;
                    <a href="#7a3aa7778941cbc5" class="i field">_runStandAlone</a> = <b>false</b>;
                }
            }
        }
 
        <span class="c">// On Windows, check the extension list and see if we should try to execute this directly.</span>
        <span class="c">// Otherwise, use the platform library to check executability</span>
        [<span class="i">SuppressMessage</span>(
            <span class="s">&quot;Performance&quot;</span>,
            <span class="s">&quot;CA1822:Mark members as static&quot;</span>,
            <span class="i">Justification</span> = <span class="s">&quot;Accesses instance members in preprocessor branch.&quot;</span>)]
        <b>private bool</b> <a id="5891406c5765d0f0" href="../R/5891406c5765d0f0.html" target="n" data-glyph="76,1" class="i method">IsExecutable</a>(<b>string</b> <span id="r109 rd" class="r109 r">path</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return Platform.NonWindowsIsExecutable(this.Path);
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
 
            <b>string</b> <span id="r110 rd" class="r110 r">myExtension</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r109 r">path</span>);
 
            <b>var</b> <span id="r111 rd" class="r111 r">pathext</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="s">&quot;PATHEXT&quot;</span>);
            <b>string</b>[] <span id="r112 rd" class="r112 r">extensionList</span>;
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r111 r">pathext</span>))
            {
                <span class="r112 r">extensionList</span> = <b>new</b> <b>string</b>[] { <span class="s">&quot;.exe&quot;</span>, <span class="s">&quot;.com&quot;</span>, <span class="s">&quot;.bat&quot;</span>, <span class="s">&quot;.cmd&quot;</span> };
            }
            <b>else</b>
            {
                <span class="r112 r">extensionList</span> = <span class="r111 r">pathext</span>.<span class="i">Split</span>(<a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="Utils.cs.html#13f45855e9b92e58" class="i field">Semicolon</a>);
            }
 
            <b>foreach</b> (<b>string</b> <span id="r113 rd" class="r113 r">extension</span> <b>in</b> <span class="r112 r">extensionList</span>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r113 r">extension</span>, <span class="r110 r">myExtension</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Interop for FindExecutable...
 
        <span class="c">// Constant used to determine the buffer size for a path</span>
        <span class="c">// when looking for an executable. MAX_PATH is defined as 260</span>
        <span class="c">// so this is much larger than what should be permitted</span>
        <b>private const int</b> <a id="543f6ba0628a1423" href="../R/543f6ba0628a1423.html" target="n" data-glyph="10,1" class="i field">MaxExecutablePath</a> = 1024;
 
        <span class="c">// The FindExecutable API is defined in shellapi.h as</span>
        <span class="c">// SHSTDAPI_(HINSTANCE) FindExecutableW(LPCWSTR lpFile, LPCWSTR lpDirectory, __out_ecount(MAX_PATH) LPWSTR lpResult);</span>
        <span class="c">// HINSTANCE is void* so we need to use IntPtr as API return value.</span>
 
        [<span class="i">DllImport</span>(<span class="s">&quot;shell32.dll&quot;</span>, <span class="i">EntryPoint</span> = <span class="s">&quot;FindExecutable&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Globalization&quot;</span>, <span class="s">&quot;CA2101:SpecifyMarshalingForPInvokeStringArguments&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;0&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Globalization&quot;</span>, <span class="s">&quot;CA2101:SpecifyMarshalingForPInvokeStringArguments&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;1&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Globalization&quot;</span>, <span class="s">&quot;CA2101:SpecifyMarshalingForPInvokeStringArguments&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;2&quot;</span>)]
        <b>private static extern</b> <span class="i">IntPtr</span> <a id="dd8faafb315c71a2" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FindExecutableW</a>(
          <b>string</b> <span id="r114 rd" class="r114 r">fileName</span>, <b>string</b> <span id="r115 rd" class="r115 r">directoryPath</span>, <span class="i">StringBuilder</span> <span id="r116 rd" class="r116 r">pathFound</span>);
 
        [<span class="i">ArchitectureSensitive</span>]
        <b>private static string</b> <a id="0a2794bd8aa963ab" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FindExecutable</a>(<b>string</b> <span id="r117 rd" class="r117 r">filename</span>)
        {
            <span class="c">// Preallocate a</span>
            <span class="i">StringBuilder</span> <span id="r118 rd" class="r118 r">objResultBuffer</span> = <b>new</b> <span class="i">StringBuilder</span>(<a href="#543f6ba0628a1423" class="i field">MaxExecutablePath</a>);
            <span class="i">IntPtr</span> <span id="r119 rd" class="r119 r">resultCode</span> = (<span class="i">IntPtr</span>)0;
 
            <b>try</b>
            {
                <span class="r119 r">resultCode</span> = <span class="i">FindExecutableW</span>(<span class="r117 r">filename</span>, <b>string</b>.<span class="i">Empty</span>, <span class="r118 r">objResultBuffer</span>);
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">IndexOutOfRangeException</span> <span id="r120 rd" class="r120 r">e</span>)
            {
                <span class="c">// If we got an index-out-of-range exception here, it&#39;s because</span>
                <span class="c">// of a buffer overrun error so we fail fast instead of</span>
                <span class="c">// continuing to run in an possibly unstable environment....</span>
                <span class="i">Environment</span>.<span class="i">FailFast</span>(<span class="r120 r">e</span>.<span class="i">Message</span>, <span class="r120 r">e</span>);
            }
 
            <span class="c">// If FindExecutable returns a result &gt;= 32, then it succeeded</span>
            <span class="c">// and we return the string that was found, otherwise we</span>
            <span class="c">// return null.</span>
            <b>if</b> ((<b>long</b>)<span class="r119 r">resultCode</span> &gt;= 32)
            {
                <b>return</b> <span class="r118 r">objResultBuffer</span>.<span class="i">ToString</span>();
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Interop for SHGetFileInfo
 
        <b>private const int</b> <a id="ceb81508abc002c5" href="../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">SCS_32BIT_BINARY</a> = 0;  <span class="c">// A 32-bit Windows-based application</span>
        <b>private const int</b> <a id="04b5314379162ad3" href="../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">SCS_DOS_BINARY</a> = 1;  <span class="c">// An MS-DOS - based application</span>
        <b>private const int</b> <a id="05860b0de2aa1874" href="../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">SCS_WOW_BINARY</a> = 2;  <span class="c">// A 16-bit Windows-based application</span>
        <b>private const int</b> <a id="ffed443a4f6df737" href="../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">SCS_PIF_BINARY</a> = 3;  <span class="c">// A PIF file that executes an MS-DOS - based application</span>
        <b>private const int</b> <a id="0deeb4c804d940d9" href="../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">SCS_POSIX_BINARY</a> = 4;  <span class="c">// A POSIX - based application</span>
        <b>private const int</b> <a id="c6ab1ca9ef72a43d" href="../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">SCS_OS216_BINARY</a> = 5;  <span class="c">// A 16-bit OS/2-based application</span>
        <b>private const int</b> <a id="ede904c066ac45c8" href="../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">SCS_64BIT_BINARY</a> = 6;  <span class="c">// A 64-bit Windows-based application.</span>
 
        [<span class="i">StructLayout</span>(<span class="i">LayoutKind</span>.<span class="i">Sequential</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
        <b>private struct</b> <a id="477db6f07bff62b4" href="../R/477db6f07bff62b4.html" target="n" data-glyph="112,1" class="t t"><span id="bcb8e66e54858731">SHFILEINFO</span></a>
        {
            <b>public</b> <span class="i">IntPtr</span> <a id="ccbe4c421ede9aa5" href="../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">hIcon</a>;
            <b>public int</b> <a id="481bb91ef78ce6c0" href="../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">iIcon</a>;
            <b>public uint</b> <a id="23260f01e4f46448" href="../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">dwAttributes</a>;
 
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 260)]
            <b>public string</b> <a id="9c661e0dfc4546e2" href="../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">szDisplayName</a>;
 
            [<span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">ByValTStr</span>, <span class="i">SizeConst</span> = 80)]
            <b>public string</b> <a id="36a7f481169ab54c" href="../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">szTypeName</a>;
        }
 
        <b>private const uint</b> <a id="eb81300c163bdb23" href="../R/eb81300c163bdb23.html" target="n" data-glyph="10,1" class="i field">SHGFI_EXETYPE</a> = 0x000002000; <span class="c">// flag used to ask to return exe type</span>
 
        [<span class="i">DllImport</span>(<span class="s">&quot;shell32.dll&quot;</span>, <span class="i">CharSet</span> = <span class="i">CharSet</span>.<span class="i">Unicode</span>)]
        <b>private static extern</b> <span class="i">IntPtr</span> <a id="3828590165dc5313" href="../R/3828590165dc5313.html" target="n" data-glyph="76,1" class="i method">SHGetFileInfo</a>(<b>string</b> <span id="r121 rd" class="r121 r">pszPath</span>, <b>uint</b> <span id="r122 rd" class="r122 r">dwFileAttributes</span>,
            <b>ref</b> <a href="#477db6f07bff62b4" class="t t">SHFILEINFO</a> <span id="r123 rd" class="r123 r">psfi</span>, <b>uint</b> <span id="r124 rd" class="r124 r">cbSizeFileInfo</span>, <b>uint</b> <span id="r125 rd" class="r125 r">uFlags</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Minishell Interop
 
        <b>private bool</b> <a id="aacc8a7845cd5382" href="../R/aacc8a7845cd5382.html" target="n" data-glyph="46,1" class="i field">_isMiniShell</a> = <b>false</b>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns true if native command being invoked is mini-shell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If any of the argument supplied to native command is script block,</span>
        <span class="c">///</span><span class="c"> we assume it is minishell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="f6afefde1d0af780" href="../R/f6afefde1d0af780.html" target="n" data-glyph="76,1" class="i method">IsMiniShell</a>()
        {
            <b>for</b> (<b>int</b> <span id="r126 rd" class="r126 r">i</span> = 0; <span class="r126 r">i</span> &lt; <a href="CommandProcessorBase.cs.html#5bfa2b362a5e8358" class="i field">arguments</a>.<span class="i">Count</span>; <span class="r126 r">i</span>++)
            {
                <a href="CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <span id="r127 rd" class="r127 r">arg</span> = <a href="CommandProcessorBase.cs.html#5bfa2b362a5e8358" class="i field">arguments</a>[<span class="r126 r">i</span>];
                <b>if</b> (!<span class="r127 r">arg</span>.<a href="CommandParameter.cs.html#6cc67d908afd0fd6" class="i property">ParameterNameSpecified</a>)
                {
                    <b>if</b> (<span class="r127 r">arg</span>.<a href="CommandParameter.cs.html#8b23fe67ce0ebecb" class="i property">ArgumentValue</a> <b>is</b> <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)
                    {
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Minishell Interop
 
        <b>internal static bool</b> <a id="20e4f9ea3187f2d9" href="../R/20e4f9ea3187f2d9.html" target="n" data-glyph="104,1" class="i property">IsServerSide</a> { <b>get</b>; <b>set</b>; }
    }
 
    <b>internal class</b> <a id="0a90c8fb232306f5" href="../R/0a90c8fb232306f5.html" target="n" data-glyph="2,0" class="t t">ProcessOutputHandler</a>
    {
        <b>internal const string</b> <a id="255ce78e8687d843" href="../R/255ce78e8687d843.html" target="n" data-glyph="8,1" class="i field">XmlCliTag</a> = <span class="s">&quot;#&lt; CLIXML&quot;</span>;
 
        <b>private int</b> <a id="518d62f1f7fb9f19" href="../R/518d62f1f7fb9f19.html" target="n" data-glyph="46,1" class="i field">_refCount</a>;
        <b>private readonly</b> <span class="i">BlockingCollection</span>&lt;<a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a>&gt; <a id="1b2ce63ea1253af3" href="../R/1b2ce63ea1253af3.html" target="n" data-glyph="46,1" class="i field">_queue</a>;
        <b>private bool</b> <a id="3639d28b51cd3b39" href="../R/3639d28b51cd3b39.html" target="n" data-glyph="46,1" class="i field">_isFirstOutput</a>;
        <b>private bool</b> <a id="2676be95e5542c12" href="../R/2676be95e5542c12.html" target="n" data-glyph="46,1" class="i field">_isFirstError</a>;
        <b>private bool</b> <a id="5b43ce90854a5dd7" href="../R/5b43ce90854a5dd7.html" target="n" data-glyph="46,1" class="i field">_isXmlCliOutput</a>;
        <b>private bool</b> <a id="c12f34b6e6eea7e0" href="../R/c12f34b6e6eea7e0.html" target="n" data-glyph="46,1" class="i field">_isXmlCliError</a>;
        <b>private readonly string</b> <a id="4222e0a48871304b" href="../R/4222e0a48871304b.html" target="n" data-glyph="46,1" class="i field">_processFileName</a>;
 
        <b>public</b> <a id="5f361086120c9f44" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ProcessOutputHandler</a>(<span class="i">Process</span> <span id="r128 rd" class="r128 r">process</span>, <span class="i">BlockingCollection</span>&lt;<a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a>&gt; <span id="r129 rd" class="r129 r">queue</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r128 r">process</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardOutput</span> || <span class="r128 r">process</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardError</span>, <span class="s">&quot;Caller should redirect at least one stream&quot;</span>);
            <a href="#518d62f1f7fb9f19" class="i field">_refCount</a> = 0;
            <a href="#4222e0a48871304b" class="i field">_processFileName</a> = <span class="r128 r">process</span>.<span class="i">StartInfo</span>.<span class="i">FileName</span>;
            <a href="#1b2ce63ea1253af3" class="i field">_queue</a> = <span class="r129 r">queue</span>;
 
            <span class="c">// we incrementing refCount on the same thread and before running any processing</span>
            <span class="c">// so it&#39;s safe to do it without Interlocked.</span>
            <b>if</b> (<span class="r128 r">process</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardOutput</span>) { <a href="#518d62f1f7fb9f19" class="i field">_refCount</a>++; }
 
            <b>if</b> (<span class="r128 r">process</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardError</span>) { <a href="#518d62f1f7fb9f19" class="i field">_refCount</a>++; }
 
            <span class="c">// once we have _refCount, we can start processing</span>
            <b>if</b> (<span class="r128 r">process</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardOutput</span>)
            {
                <a href="#3639d28b51cd3b39" class="i field">_isFirstOutput</a> = <b>true</b>;
                <a href="#5b43ce90854a5dd7" class="i field">_isXmlCliOutput</a> = <b>false</b>;
                <span class="r128 r">process</span>.<span class="i">OutputDataReceived</span> += <span class="i">OutputHandler</span>;
                <span class="r128 r">process</span>.<span class="i">BeginOutputReadLine</span>();
            }
 
            <b>if</b> (<span class="r128 r">process</span>.<span class="i">StartInfo</span>.<span class="i">RedirectStandardError</span>)
            {
                <a href="#2676be95e5542c12" class="i field">_isFirstError</a> = <b>true</b>;
                <a href="#c12f34b6e6eea7e0" class="i field">_isXmlCliError</a> = <b>false</b>;
                <span class="r128 r">process</span>.<span class="i">ErrorDataReceived</span> += <span class="i">ErrorHandler</span>;
                <span class="r128 r">process</span>.<span class="i">BeginErrorReadLine</span>();
            }
        }
 
        <b>private void</b> <a id="f1afa6ebbb4b1107" href="../R/f1afa6ebbb4b1107.html" target="n" data-glyph="76,1" class="i method">decrementRefCount</a>()
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#518d62f1f7fb9f19" class="i field">_refCount</a> &gt; 0, <span class="s">&quot;RefCount should always be positive, when we are trying to decrement it&quot;</span>);
            <b>if</b> (<span class="i">Interlocked</span>.<span class="i">Decrement</span>(<b>ref</b> <a href="#518d62f1f7fb9f19" class="i field">_refCount</a>) == 0)
            {
                <a href="#1b2ce63ea1253af3" class="i field">_queue</a>.<span class="i">CompleteAdding</span>();
            }
        }
 
        <b>private void</b> <a id="60bc31e8c8f9f84e" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OutputHandler</a>(<b>object</b> <span id="r130 rd" class="r130 r">sender</span>, <span class="i">DataReceivedEventArgs</span> <span id="r131 rd" class="r131 r">outputReceived</span>)
        {
            <b>if</b> (<span class="r131 r">outputReceived</span>.<span class="i">Data</span> != <b>null</b>)
            {
                <b>if</b> (<a href="#3639d28b51cd3b39" class="i field">_isFirstOutput</a>)
                {
                    <a href="#3639d28b51cd3b39" class="i field">_isFirstOutput</a> = <b>false</b>;
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r131 r">outputReceived</span>.<span class="i">Data</span>, <a href="#255ce78e8687d843" class="i field">XmlCliTag</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                    {
                        <a href="#5b43ce90854a5dd7" class="i field">_isXmlCliOutput</a> = <b>true</b>;
                        <b>return</b>;
                    }
                }
 
                <b>if</b> (<a href="#5b43ce90854a5dd7" class="i field">_isXmlCliOutput</a>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r132 rd" class="r132 r">record</span> <b>in</b> <span class="i">DeserializeCliXmlObject</span>(<span class="r131 r">outputReceived</span>.<span class="i">Data</span>, <b>true</b>))
                    {
                        <a href="#1b2ce63ea1253af3" class="i field">_queue</a>.<span class="i">Add</span>(<span class="r132 r">record</span>);
                    }
                }
                <b>else</b>
                {
                    <a href="#1b2ce63ea1253af3" class="i field">_queue</a>.<span class="i">Add</span>(<b>new</b> <span class="t">ProcessOutputObject</span>(<span class="r131 r">outputReceived</span>.<span class="i">Data</span>, <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#8e4e5a8bf4ca3949" class="i field">Output</a>));
                }
            }
            <b>else</b>
            {
                <a href="#f1afa6ebbb4b1107" class="i method">decrementRefCount</a>();
            }
        }
 
        <b>private void</b> <a id="453115d5dc129457" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ErrorHandler</a>(<b>object</b> <span id="r133 rd" class="r133 r">sender</span>, <span class="i">DataReceivedEventArgs</span> <span id="r134 rd" class="r134 r">errorReceived</span>)
        {
            <b>if</b> (<span class="r134 r">errorReceived</span>.<span class="i">Data</span> != <b>null</b>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r134 r">errorReceived</span>.<span class="i">Data</span>, <a href="#255ce78e8687d843" class="i field">XmlCliTag</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <a href="#c12f34b6e6eea7e0" class="i field">_isXmlCliError</a> = <b>true</b>;
                    <b>return</b>;
                }
 
                <b>if</b> (<a href="#c12f34b6e6eea7e0" class="i field">_isXmlCliError</a>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r135 rd" class="r135 r">record</span> <b>in</b> <span class="i">DeserializeCliXmlObject</span>(<span class="r134 r">errorReceived</span>.<span class="i">Data</span>, <b>false</b>))
                    {
                        <a href="#1b2ce63ea1253af3" class="i field">_queue</a>.<span class="i">Add</span>(<span class="r135 r">record</span>);
                    }
                }
                <b>else</b>
                {
                    <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r136 rd" class="r136 r">errorRecord</span>;
                    <b>if</b> (<a href="#2676be95e5542c12" class="i field">_isFirstError</a>)
                    {
                        <a href="#2676be95e5542c12" class="i field">_isFirstError</a> = <b>false</b>;
                        <span class="c">// Produce a regular error record for the first line of the output</span>
                        <span class="r136 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="t">RemoteException</span>(<span class="r134 r">errorReceived</span>.<span class="i">Data</span>), <span class="s">&quot;NativeCommandError&quot;</span>, <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <span class="r134 r">errorReceived</span>.<span class="i">Data</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// Wrap the rest of the output in ErrorRecords with the &quot;NativeCommandErrorMessage&quot; error ID</span>
                        <span class="r136 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="t">RemoteException</span>(<span class="r134 r">errorReceived</span>.<span class="i">Data</span>), <span class="s">&quot;NativeCommandErrorMessage&quot;</span>, <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>);
                    }
 
                    <a href="#1b2ce63ea1253af3" class="i field">_queue</a>.<span class="i">Add</span>(<b>new</b> <a href="#f4c102c138279655" class="t constructor">ProcessOutputObject</a>(<span class="r136 r">errorRecord</span>, <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c3fa9200d2d7861e" class="i field">Error</a>));
                }
            }
            <b>else</b>
            {
                <a href="#f1afa6ebbb4b1107" class="i method">decrementRefCount</a>();
            }
        }
 
        <b>private</b> <span class="i">List</span>&lt;<a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a>&gt; <a id="44d476fc4f62c861" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">DeserializeCliXmlObject</a>(<b>string</b> <span id="r137 rd" class="r137 r">xml</span>, <b>bool</b> <span id="r138 rd" class="r138 r">isOutput</span>)
        {
            <b>var</b> <span id="r139 rd" class="r139 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="#4eaa0973ac21c058" class="t t">ProcessOutputObject</a>&gt;();
            <b>try</b>
            {
                <b>using</b> (<b>var</b> <span id="r140 rd" class="r140 r">streamReader</span> = <b>new</b> <span class="i">MemoryStream</span>(<span class="i">Encoding</span>.<span class="i">UTF8</span>.<span class="i">GetBytes</span>(<span class="r137 r">xml</span>)))
                {
                    <span class="i">XmlReader</span> <span id="r141 rd" class="r141 r">xmlReader</span> = <span class="i">XmlReader</span>.<span class="i">Create</span>(<span class="r140 r">streamReader</span>, <a href="serialization.cs.html#758c46d6a86d6840" class="t t">InternalDeserializer</a>.<a href="serialization.cs.html#68d86b2b9f57584d" class="i property">XmlReaderSettingsForCliXml</a>);
                    <a href="serialization.cs.html#27835b221aec7524" class="t t">Deserializer</a> <span id="r142 rd" class="r142 r">des</span> = <b>new</b> <a href="serialization.cs.html#37284915ff9862dc" class="t constructor">Deserializer</a>(<span class="r141 r">xmlReader</span>);
                    <b>while</b> (!<span class="r142 r">des</span>.<a href="serialization.cs.html#6c4195591a1a2219" class="i method">Done</a>())
                    {
                        <b>string</b> <span id="r143 rd" class="r143 r">streamName</span>;
                        <b>object</b> <span id="r144 rd" class="r144 r">obj</span> = <span class="r142 r">des</span>.<a href="serialization.cs.html#dc4acd0343de04bd" class="i method">Deserialize</a>(<b>out</b> <span class="r143 r">streamName</span>);
 
                        <span class="c">// Decide the stream to which data belongs</span>
                        <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a> <span id="r145 rd" class="r145 r">stream</span> = <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#d6d6b4e487b9d0e3" class="i field">Unknown</a>;
                        <b>if</b> (<span class="r143 r">streamName</span> != <b>null</b>)
                        {
                            <span class="r145 r">stream</span> = <a href="#6865a4ba1c00e035" class="t t">StringToMinishellStreamConverter</a>.<a href="#04eabf58be031ba3" class="i method">ToMinishellStream</a>(<span class="r143 r">streamName</span>);
                        }
 
                        <b>if</b> (<span class="r145 r">stream</span> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#d6d6b4e487b9d0e3" class="i field">Unknown</a>)
                        {
                            <span class="r145 r">stream</span> = <span class="r138 r">isOutput</span> ? <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#8e4e5a8bf4ca3949" class="i field">Output</a> : <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c3fa9200d2d7861e" class="i field">Error</a>;
                        }
 
                        <span class="c">// Null is allowed only in output stream</span>
                        <b>if</b> (<span class="r145 r">stream</span> != <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#8e4e5a8bf4ca3949" class="i field">Output</a> &amp;&amp; <span class="r144 r">obj</span> == <b>null</b>)
                        {
                            <b>continue</b>;
                        }
 
                        <b>if</b> (<span class="r145 r">stream</span> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c3fa9200d2d7861e" class="i field">Error</a>)
                        {
                            <b>if</b> (<span class="r144 r">obj</span> <b>is</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
                            {
                                <span class="r144 r">obj</span> = <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>.<a href="ErrorPackage.cs.html#1232603351a94344" class="i method">FromPSObjectForRemoting</a>(<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r144 r">obj</span>));
                            }
                            <b>else</b>
                            {
                                <b>string</b> <span id="r146 rd" class="r146 r">errorMessage</span> = <b>null</b>;
                                <b>try</b>
                                {
                                    <span class="r146 r">errorMessage</span> = (<b>string</b>)<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r144 r">obj</span>, <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                                }
                                <b>catch</b> (<a href="ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a>)
                                {
                                    <b>continue</b>;
                                }
 
                                <span class="r144 r">obj</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <a href="#25cde8b85ca92099" class="t constructor">RemoteException</a>(<span class="r146 r">errorMessage</span>),
                                                    <span class="s">&quot;NativeCommandError&quot;</span>, <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <span class="r146 r">errorMessage</span>);
                            }
                        }
                        <b>else</b> <b>if</b> (<span class="r145 r">stream</span> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#1b928c156cefa801" class="i field">Information</a>)
                        {
                            <b>if</b> (<span class="r144 r">obj</span> <b>is</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
                            {
                                <span class="r144 r">obj</span> = <a href="InformationRecord.cs.html#508a9dbac37ec093" class="t t">InformationRecord</a>.<a href="InformationRecord.cs.html#b5ca2556774d0119" class="i method">FromPSObjectForRemoting</a>(<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r144 r">obj</span>));
                            }
                            <b>else</b>
                            {
                                <b>string</b> <span id="r147 rd" class="r147 r">messageData</span> = <b>null</b>;
                                <b>try</b>
                                {
                                    <span class="r147 r">messageData</span> = (<b>string</b>)<a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r144 r">obj</span>, <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                                }
                                <b>catch</b> (<a href="ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a>)
                                {
                                    <b>continue</b>;
                                }
 
                                <span class="r144 r">obj</span> = <b>new</b> <a href="InformationRecord.cs.html#ad6024c01523a97e" class="t constructor">InformationRecord</a>(<span class="r147 r">messageData</span>, <b>null</b>);
                            }
                        }
                        <b>else</b> <b>if</b> (<span class="r145 r">stream</span> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#1bf9c2a844980805" class="i field">Debug</a> ||
                                 <span class="r145 r">stream</span> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c73d449be2277109" class="i field">Verbose</a> ||
                                 <span class="r145 r">stream</span> == <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#a189f93bb16b3fbf" class="i field">Warning</a>)
                        {
                            <span class="c">// Convert to string</span>
                            <b>try</b>
                            {
                                <span class="r144 r">obj</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r144 r">obj</span>, <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                            }
                            <b>catch</b> (<a href="ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a>)
                            {
                                <b>continue</b>;
                            }
                        }
 
                        <span class="r139 r">result</span>.<span class="i">Add</span>(<b>new</b> <a href="#f4c102c138279655" class="t constructor">ProcessOutputObject</a>(<span class="r144 r">obj</span>, <span class="r145 r">stream</span>));
                    }
                }
            }
            <b>catch</b> (<span class="i">XmlException</span> <span id="r148 rd" class="r148 r">originalException</span>)
            {
                <b>string</b> <span id="r149 rd" class="r149 r">template</span> = <span class="i">NativeCP</span>.<span class="i">CliXmlError</span>;
                <b>string</b> <span id="r150 rd" class="r150 r">message</span> = <b>string</b>.<span class="i">Format</span>(
                    <b>null</b>,
                    <span class="r149 r">template</span>,
                    <span class="r138 r">isOutput</span> ? <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#8e4e5a8bf4ca3949" class="i field">Output</a> : <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c3fa9200d2d7861e" class="i field">Error</a>,
                    <a href="#4222e0a48871304b" class="i field">_processFileName</a>,
                    <span class="r148 r">originalException</span>.<span class="i">Message</span>);
                <span class="i">XmlException</span> <span id="r151 rd" class="r151 r">newException</span> = <b>new</b> <span class="i">XmlException</span>(
                    <span class="r150 r">message</span>,
                    <span class="r148 r">originalException</span>);
 
                <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r152 rd" class="r152 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                    <span class="r151 r">newException</span>,
                    <span class="s">&quot;ProcessStreamReader_CliXmlError&quot;</span>,
                    <a href="ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="ErrorPackage.cs.html#7aaf68c3bc19e903" class="i field">SyntaxError</a>,
                    <a href="#4222e0a48871304b" class="i field">_processFileName</a>);
                <span class="r139 r">result</span>.<span class="i">Add</span>(<b>new</b> <a href="#f4c102c138279655" class="t constructor">ProcessOutputObject</a>(<span class="r152 r">error</span>, <a href="#1a2a95181c3c24e6" class="t t">MinishellStream</a>.<a href="#c3fa9200d2d7861e" class="i field">Error</a>));
            }
 
            <b>return</b> <span class="r139 r">result</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Helper class to handle writing input to a process.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="4492fbb424330899" href="../R/4492fbb424330899.html" target="n" data-glyph="2,0" class="t t">ProcessInputWriter</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> constructor
 
        <b>private readonly</b> <a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <a id="aa2886b217aa5232" href="../R/aa2886b217aa5232.html" target="n" data-glyph="46,1" class="i field">_command</a>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates an instance of ProcessInputWriter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="9be2e041af90bd89" href="../R/9be2e041af90bd89.html" target="n" data-glyph="74,1" class="t constructor">ProcessInputWriter</a>(<a href="CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <span id="r153 rd" class="r153 r">command</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r153 r">command</span> != <b>null</b>, <span class="s">&quot;Caller should validate the parameter&quot;</span>);
            <a href="#aa2886b217aa5232" class="i field">_command</a> = <span class="r153 r">command</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> constructor
 
        <b>private</b> <a href="lang/scriptblock.cs.html#5e20a8a88cfbe6cb" class="t t">SteppablePipeline</a> <a id="40dbcb38a81daa5f" href="../R/40dbcb38a81daa5f.html" target="n" data-glyph="46,1" class="i field">_pipeline</a>;
        <b>private</b> <a href="serialization.cs.html#13699f4bba06caeb" class="t t">Serializer</a> <a id="084fc982ed7d2846" href="../R/084fc982ed7d2846.html" target="n" data-glyph="46,1" class="i field">_xmlSerializer</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add an object to write to process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r154 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="5e88cb36e50bab04" href="../R/5e88cb36e50bab04.html" target="n" data-glyph="74,1" class="i method">Add</a>(<b>object</b> <span id="r154 rd" class="r154 r">input</span>)
        {
            <b>if</b> (<a href="#a7e29c870afd544c" class="i field">_stopping</a> || <a href="#b19bf14ff979e93a" class="i field">_streamWriter</a> == <b>null</b>)
            {
                <span class="c">// if _streamWriter is already null, then we already called Dispose()</span>
                <span class="c">// so we should just discard the input.</span>
                <b>return</b>;
            }
 
            <b>if</b> (<a href="#53626c12341a72b8" class="i field">_inputFormat</a> == <a href="#ce832a3a9771e8cc" class="t t">NativeCommandIOFormat</a>.<a href="#10d22766727410e1" class="i field">Text</a>)
            {
                <a href="#8deca15e73f11b08" class="i method">AddTextInput</a>(<span class="r154 r">input</span>);
            }
            <b>else</b> <span class="c">// Xml</span>
            {
                <a href="#201ea1e5c236906f" class="i method">AddXmlInput</a>(<span class="r154 r">input</span>);
            }
        }
 
        <b>private void</b> <a id="8deca15e73f11b08" href="../R/8deca15e73f11b08.html" target="n" data-glyph="76,1" class="i method">AddTextInput</a>(<b>object</b> <span id="r155 rd" class="r155 r">input</span>)
        {
            <a href="#f205ef77c19cf35d" class="i method">AddTextInputFromFormattedArray</a>(<a href="#40dbcb38a81daa5f" class="i field">_pipeline</a>.<a href="lang/scriptblock.cs.html#b3b43d4b0d086e62" class="i method">Process</a>(<span class="r155 r">input</span>));
        }
 
        <b>private void</b> <a id="f205ef77c19cf35d" href="../R/f205ef77c19cf35d.html" target="n" data-glyph="76,1" class="i method">AddTextInputFromFormattedArray</a>(<span class="i">Array</span> <span id="r156 rd" class="r156 r">formattedObjects</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r157 rd" class="r157 r">item</span> <b>in</b> <span class="r156 r">formattedObjects</span>)
            {
                <b>string</b> <span id="r158 rd" class="r158 r">line</span> = <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">ToStringParser</span>(<a href="#aa2886b217aa5232" class="i field">_command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r157 r">item</span>);
                <span class="c">// if process is already finished and we are trying to write something to it,</span>
                <span class="c">// we will get IOException</span>
                <b>try</b>
                {
                    <a href="#b19bf14ff979e93a" class="i field">_streamWriter</a>.<span class="i">WriteLine</span>(<span class="r158 r">line</span>);
                }
                <b>catch</b> (<span class="i">IOException</span>)
                {
                    <span class="c">// we are assuming that process is already finished</span>
                    <span class="c">// we should just stop processing at this point</span>
                    <a href="#4492fbb424330899" class="k">this</a>.<a href="#a7ea46991ce68ba2" class="i method">Dispose</a>();
                    <span class="c">// stop foreach execution</span>
                    <b>break</b>;
                }
            }
        }
 
        <b>private void</b> <a id="201ea1e5c236906f" href="../R/201ea1e5c236906f.html" target="n" data-glyph="76,1" class="i method">AddXmlInput</a>(<b>object</b> <span id="r159 rd" class="r159 r">input</span>)
        {
            <b>try</b>
            {
                <a href="#084fc982ed7d2846" class="i field">_xmlSerializer</a>.<a href="serialization.cs.html#cc6dbb8452db3a50" class="i method">Serialize</a>(<span class="r159 r">input</span>);
            }
            <b>catch</b> (<span class="i">IOException</span>)
            {
                <span class="c">// we are assuming that process is already finished</span>
                <span class="c">// we should just stop processing at this point</span>
                <a href="#4492fbb424330899" class="k">this</a>.<a href="#a7ea46991ce68ba2" class="i method">Dispose</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stream to which input is written.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">StreamWriter</span> <a id="b19bf14ff979e93a" href="../R/b19bf14ff979e93a.html" target="n" data-glyph="46,1" class="i field">_streamWriter</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Format of input.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="#ce832a3a9771e8cc" class="t t">NativeCommandIOFormat</a> <a id="53626c12341a72b8" href="../R/53626c12341a72b8.html" target="n" data-glyph="46,1" class="i field">_inputFormat</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start writing input to process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r160 r">process</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> process to which input is written</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r161 r">inputFormat</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="49356d4f39ded887" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Start</a>(<span class="i">Process</span> <span id="r160 rd" class="r160 r">process</span>, <a href="#ce832a3a9771e8cc" class="t t">NativeCommandIOFormat</a> <span id="r161 rd" class="r161 r">inputFormat</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r160 r">process</span> != <b>null</b>, <span class="s">&quot;caller should validate the paramter&quot;</span>);
 
            <span class="c">// Get the encoding for writing to native command. Note we get the Encoding</span>
            <span class="c">// from the current scope so a script or function can use a different encoding</span>
            <span class="c">// than global value.</span>
            <span class="i">Encoding</span> <span id="r162 rd" class="r162 r">pipeEncoding</span> = <a href="#aa2886b217aa5232" class="i field">_command</a>.<a href="CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="SpecialVariables.cs.html#5fc89174cf13dbdd" class="i field">OutputEncodingVarPath</a>) <b>as</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">Encoding</span> ??
                                    <a href="Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="Utils.cs.html#7a7127f6fafd6bca" class="i field">utf8NoBom</a>;
 
            <a href="#b19bf14ff979e93a" class="i field">_streamWriter</a> = <b>new</b> <span class="i">StreamWriter</span>(<span class="r160 r">process</span>.<span class="i">StandardInput</span>.<span class="i">BaseStream</span>, <span class="r162 r">pipeEncoding</span>);
            <a href="#b19bf14ff979e93a" class="i field">_streamWriter</a>.<span class="i">AutoFlush</span> = <b>true</b>;
 
            <a href="#53626c12341a72b8" class="i field">_inputFormat</a> = <span class="r161 r">inputFormat</span>;
 
            <b>if</b> (<a href="#53626c12341a72b8" class="i field">_inputFormat</a> == <a href="#ce832a3a9771e8cc" class="t t">NativeCommandIOFormat</a>.<a href="#17d397776a51ff66" class="i field">Xml</a>)
            {
                <a href="#b19bf14ff979e93a" class="i field">_streamWriter</a>.<span class="i">WriteLine</span>(<a href="#0a90c8fb232306f5" class="t t">ProcessOutputHandler</a>.<a href="#255ce78e8687d843" class="i field">XmlCliTag</a>);
                <a href="#084fc982ed7d2846" class="i field">_xmlSerializer</a> = <b>new</b> <span class="t">Serializer</span>(<span class="i">XmlWriter</span>.<span class="i">Create</span>(<a href="#b19bf14ff979e93a" class="i field">_streamWriter</a>));
            }
            <b>else</b> <span class="c">// Text</span>
            {
                <a href="#40dbcb38a81daa5f" class="i field">_pipeline</a> = <a href="../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="lang/scriptblock.cs.html#adfac0fa7bf5725f" class="i method">Create</a>(<span class="s">&quot;Out-String -Stream&quot;</span>).<a href="lang/scriptblock.cs.html#4c228a80a3ac8bbd" class="i method">GetSteppablePipeline</a>();
                <a href="#40dbcb38a81daa5f" class="i field">_pipeline</a>.<a href="lang/scriptblock.cs.html#1b7416b9d779057b" class="i method">Begin</a>(<b>true</b>);
            }
        }
 
        <b>private bool</b> <a id="a7e29c870afd544c" href="../R/a7e29c870afd544c.html" target="n" data-glyph="46,1" class="i field">_stopping</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop writing input to process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="1feae3597ace4ddb" href="../R/1feae3597ace4ddb.html" target="n" data-glyph="74,1" class="i method">Stop</a>()
        {
            <a href="#a7e29c870afd544c" class="i field">_stopping</a> = <b>true</b>;
        }
 
        <b>internal void</b> <a id="a7ea46991ce68ba2" href="../R/a7ea46991ce68ba2.html" target="n" data-glyph="74,1" class="i method">Dispose</a>()
        {
            <span class="c">// we allow call Dispose() multiply times.</span>
            <span class="c">// For example one time from ProcessRecord() code path,</span>
            <span class="c">// when we detect that process already finished</span>
            <span class="c">// and once from Done() code path.</span>
            <span class="c">// Even though Dispose() could be called multiple times,</span>
            <span class="c">// the calls are on the same thread, so there is no race condition</span>
            <b>if</b> (<a href="#40dbcb38a81daa5f" class="i field">_pipeline</a> != <b>null</b>)
            {
                <a href="#40dbcb38a81daa5f" class="i field">_pipeline</a>.<a href="lang/scriptblock.cs.html#0e4e3778f4e10d63" class="i method">Dispose</a>();
                <a href="#40dbcb38a81daa5f" class="i field">_pipeline</a> = <b>null</b>;
            }
 
            <b>if</b> (<a href="#084fc982ed7d2846" class="i field">_xmlSerializer</a> != <b>null</b>)
            {
                <a href="#084fc982ed7d2846" class="i field">_xmlSerializer</a> = <b>null</b>;
            }
 
            <span class="c">// streamWriter can be null if we didn&#39;t call Start method</span>
            <b>if</b> (<a href="#b19bf14ff979e93a" class="i field">_streamWriter</a> != <b>null</b>)
            {
                <b>try</b>
                {
                    <a href="#b19bf14ff979e93a" class="i field">_streamWriter</a>.<span class="i">Dispose</span>();
                }
                <b>catch</b> (<span class="i">IOException</span>)
                {
                    <span class="c">// on unix, if process is already finished attempt to dispose it will</span>
                    <span class="c">// lead to &quot;Broken pipe&quot; exception.</span>
                    <span class="c">// we are ignoring it here</span>
                }
 
                <a href="#b19bf14ff979e93a" class="i field">_streamWriter</a> = <b>null</b>;
            }
        }
 
        <b>internal void</b> <a id="59ca210cd4eec000" href="../R/59ca210cd4eec000.html" target="n" data-glyph="74,1" class="i method">Done</a>()
        {
            <b>if</b> (<a href="#53626c12341a72b8" class="i field">_inputFormat</a> == <a href="#ce832a3a9771e8cc" class="t t">NativeCommandIOFormat</a>.<a href="#17d397776a51ff66" class="i field">Xml</a>)
            {
                <b>if</b> (<a href="#084fc982ed7d2846" class="i field">_xmlSerializer</a> != <b>null</b>)
                {
                    <a href="#084fc982ed7d2846" class="i field">_xmlSerializer</a>.<a href="serialization.cs.html#bba68ce5b6414f8d" class="i method">Done</a>();
                }
            }
            <b>else</b> <span class="c">// Text</span>
            {
                <span class="c">// if _pipeline == null, we already called Dispose(),</span>
                <span class="c">// for example, because downstream process finished</span>
                <b>if</b> (<a href="#40dbcb38a81daa5f" class="i field">_pipeline</a> != <b>null</b>)
                {
                    <b>var</b> <span id="r163 rd" class="r163 r">finalResults</span> = <a href="#40dbcb38a81daa5f" class="i field">_pipeline</a>.<a href="lang/scriptblock.cs.html#acd4446c9db7bae3" class="i method">End</a>();
                    <a href="#f205ef77c19cf35d" class="i method">AddTextInputFromFormattedArray</a>(<span class="r163 r">finalResults</span>);
                }
            }
 
            <a href="#a7ea46991ce68ba2" class="i method">Dispose</a>();
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Static class that allows you to show and hide the console window</span>
    <span class="c">///</span><span class="c"> associated with this process.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="8ed42b18c1241fe2" href="../R/8ed42b18c1241fe2.html" target="n" data-glyph="2,0" class="t t">ConsoleVisibility</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If set to true, then native commands will always be run redirected...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static bool</b> <a id="eb4e1cce6baea0fa" href="../R/eb4e1cce6baea0fa.html" target="n" data-glyph="102,1" class="i property">AlwaysCaptureApplicationIO</a> { <b>get</b>; <b>set</b>; }
 
        [<span class="i">DllImport</span>(<span class="s">&quot;Kernel32.dll&quot;</span>)]
        <b>internal static extern</b> <span class="i">IntPtr</span> <a id="25ba570682ee6f0e" href="../R/25ba570682ee6f0e.html" target="n" data-glyph="74,1" class="i method">GetConsoleWindow</a>();
 
        <b>internal const int</b> <a id="e09995afb3983c1a" href="../R/e09995afb3983c1a.html" target="n" data-glyph="8,1" class="i field">SW_HIDE</a> = 0;
        <b>internal const int</b> <a id="103f9311e2df4374" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWNORMAL</a> = 1;
        <b>internal const int</b> <a id="3da14dae851c693c" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_NORMAL</a> = 1;
        <b>internal const int</b> <a id="ecd255932e13ebe6" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWMINIMIZED</a> = 2;
        <b>internal const int</b> <a id="0f20026df31fc7a6" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWMAXIMIZED</a> = 3;
        <b>internal const int</b> <a id="7a85f3b0b6132b65" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_MAXIMIZE</a> = 3;
        <b>internal const int</b> <a id="4c443e54c7a89014" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWNOACTIVATE</a> = 4;
        <b>internal const int</b> <a id="3187f0f77dec06c6" href="../R/3187f0f77dec06c6.html" target="n" data-glyph="8,1" class="i field">SW_SHOW</a> = 5;
        <b>internal const int</b> <a id="fde01fc0a6de2f09" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_MINIMIZE</a> = 6;
        <b>internal const int</b> <a id="f1fb1773eb151d01" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWMINNOACTIVE</a> = 7;
        <b>internal const int</b> <a id="85eb4aa5c27a2c06" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWNA</a> = 8;
        <b>internal const int</b> <a id="2f08ab969bc4badd" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_RESTORE</a> = 9;
        <b>internal const int</b> <a id="85755ee96bbc4c65" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_SHOWDEFAULT</a> = 10;
        <b>internal const int</b> <a id="637b1e71c9888099" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_FORCEMINIMIZE</a> = 11;
        <b>internal const int</b> <a id="ac0c7815db7aa9d8" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">SW_MAX</a> = 11;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Code to control the display properties of the a window...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r164 r">hWnd</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The window to show...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r165 r">nCmdShow</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The command to do.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if it was successful.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;user32.dll&quot;</span>)]
        <b>internal static extern bool</b> <a id="2f9b691e2d19dab9" href="../R/2f9b691e2d19dab9.html" target="n" data-glyph="74,1" class="i method">ShowWindow</a>(<span class="i">IntPtr</span> <span id="r164 rd" class="r164 r">hWnd</span>, <b>int</b> <span id="r165 rd" class="r165 r">nCmdShow</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Code to allocate a console...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if a console was created...</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;kernel32.dll&quot;</span>, <span class="i">SetLastError</span> = <b>true</b>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>internal static extern bool</b> <a id="af9aa865b8479647" href="../R/af9aa865b8479647.html" target="n" data-glyph="74,1" class="i method">AllocConsole</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called to save the foreground window before allocating a hidden console window.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A handle to the foreground window.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;user32.dll&quot;</span>)]
        <b>private static extern</b> <span class="i">IntPtr</span> <a id="483f7ed0a2605207" href="../R/483f7ed0a2605207.html" target="n" data-glyph="76,1" class="i method">GetForegroundWindow</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Called to restore the foreground window after allocating a hidden console window.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">hWnd</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A handle to the window that should be activated and brought to the foreground.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the window was brought to the foreground.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">DllImport</span>(<span class="s">&quot;user32.dll&quot;</span>)]
        [<b>return</b>: <span class="i">MarshalAs</span>(<span class="i">UnmanagedType</span>.<span class="i">Bool</span>)]
        <b>private static extern bool</b> <a id="32db9af58ba33f29" href="../R/32db9af58ba33f29.html" target="n" data-glyph="76,1" class="i method">SetForegroundWindow</a>(<span class="i">IntPtr</span> <span id="r166 rd" class="r166 r">hWnd</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If no console window is attached to this process, then allocate one,</span>
        <span class="c">///</span><span class="c"> hide it and return true. If there&#39;s already a console window attached, then</span>
        <span class="c">///</span><span class="c"> just return false.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="259a9aa937757010" href="../R/259a9aa937757010.html" target="n" data-glyph="74,1" class="i method">AllocateHiddenConsole</a>()
        {
            <span class="c">// See if there is already a console attached.</span>
            <span class="i">IntPtr</span> <span id="r167 rd" class="r167 r">hwnd</span> = <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#25ba570682ee6f0e" class="i method">GetConsoleWindow</a>();
            <b>if</b> (<span class="r167 r">hwnd</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// save the foreground window since allocating a console window might remove focus from it</span>
            <span class="i">IntPtr</span> <span id="r168 rd" class="r168 r">savedForeground</span> = <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#483f7ed0a2605207" class="i method">GetForegroundWindow</a>();
 
            <span class="c">// Since there is no console window, allocate and then hide it...</span>
            <span class="c">// Suppress the PreFAST warning about not using Marshal.GetLastWin32Error() to</span>
            <span class="c">// get the error code.</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56523
            <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#af9aa865b8479647" class="i method">AllocConsole</a>();
            <span class="r167 r">hwnd</span> = <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#25ba570682ee6f0e" class="i method">GetConsoleWindow</a>();
 
            <b>bool</b> <span id="r169 rd" class="r169 r">returnValue</span>;
            <b>if</b> (<span class="r167 r">hwnd</span> == <span class="i">IntPtr</span>.<span class="i">Zero</span>)
            {
                <span class="r169 r">returnValue</span> = <b>false</b>;
            }
            <b>else</b>
            {
                <span class="r169 r">returnValue</span> = <b>true</b>;
                <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#2f9b691e2d19dab9" class="i method">ShowWindow</a>(<span class="r167 r">hwnd</span>, <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#e09995afb3983c1a" class="i field">SW_HIDE</a>);
                <a href="#eb4e1cce6baea0fa" class="i property">AlwaysCaptureApplicationIO</a> = <b>true</b>;
            }
 
            <b>if</b> (<span class="r168 r">savedForeground</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span> &amp;&amp; <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#483f7ed0a2605207" class="i method">GetForegroundWindow</a>() != <span class="r168 r">savedForeground</span>)
            {
                <a href="#8ed42b18c1241fe2" class="t t">ConsoleVisibility</a>.<a href="#32db9af58ba33f29" class="i method">SetForegroundWindow</a>(<span class="r168 r">savedForeground</span>);
            }
 
            <b>return</b> <span class="r169 r">returnValue</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is a console attached, then make it visible</span>
        <span class="c">///</span><span class="c"> and allow interactive console applications to be run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="905ed5f34b7132df" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Show</a>()
        {
            <span class="i">IntPtr</span> <span id="r170 rd" class="r170 r">hwnd</span> = <a href="#25ba570682ee6f0e" class="i method">GetConsoleWindow</a>();
            <b>if</b> (<span class="r170 r">hwnd</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
            {
                <a href="#2f9b691e2d19dab9" class="i method">ShowWindow</a>(<span class="r170 r">hwnd</span>, <a href="#3187f0f77dec06c6" class="i field">SW_SHOW</a>);
                <a href="#eb4e1cce6baea0fa" class="i property">AlwaysCaptureApplicationIO</a> = <b>false</b>;
            }
            <b>else</b>
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#4f3f8175dd33a015" class="i method">NewInvalidOperationException</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If there is a console attached, then hide it and always capture</span>
        <span class="c">///</span><span class="c"> output from the child process.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="f3390c03199774d3" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Hide</a>()
        {
            <span class="i">IntPtr</span> <span id="r171 rd" class="r171 r">hwnd</span> = <a href="#25ba570682ee6f0e" class="i method">GetConsoleWindow</a>();
            <b>if</b> (<span class="r171 r">hwnd</span> != <span class="i">IntPtr</span>.<span class="i">Zero</span>)
            {
                <a href="#2f9b691e2d19dab9" class="i method">ShowWindow</a>(<span class="r171 r">hwnd</span>, <a href="#e09995afb3983c1a" class="i field">SW_HIDE</a>);
                <a href="#eb4e1cce6baea0fa" class="i property">AlwaysCaptureApplicationIO</a> = <b>true</b>;
            }
            <b>else</b>
            {
                <b>throw</b> <a href="../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../utils/MshTraceSource.cs.html#4f3f8175dd33a015" class="i method">NewInvalidOperationException</a>();
            }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Exception used to wrap the error coming from</span>
    <span class="c">///</span><span class="c"> remote instance of Msh.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This remote instance of Msh can be in a separate process,</span>
    <span class="c">///</span><span class="c"> appdomain or machine.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    [<span class="i">Serializable</span>]
    [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2240:ImplementISerializableCorrectly&quot;</span>)]
    <b>public class</b> <a id="d56edc1842249736" href="../R/d56edc1842249736.html" target="n" data-glyph="0,0" class="t t">RemoteException</a> : <a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of RemoteException.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="aaa0fa8c5a825db3" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">RemoteException</a>()
            : <a href="../utils/RuntimeException.cs.html#37b0e7a8ab2f77af" class="k">base</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of RemoteException with a specified error message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r172 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The message that describes the error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="25cde8b85ca92099" href="../R/25cde8b85ca92099.html" target="n" data-glyph="72,1" class="t constructor">RemoteException</a>(<b>string</b> <span id="r172 rd" class="r172 r">message</span>)
            : <a href="../utils/RuntimeException.cs.html#e4538a388d78c143" class="k">base</a>(<span class="r172 r">message</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the RemoteException class</span>
        <span class="c">///</span><span class="c"> with a specified error message and a reference to the inner exception</span>
        <span class="c">///</span><span class="c"> that is the cause of this exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r173 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The message that describes the error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">innerException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The exception that is the cause of the current exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="b876155998993586" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">RemoteException</a>(<b>string</b> <span id="r173 rd" class="r173 r">message</span>, <span class="i">Exception</span> <span id="r174 rd" class="r174 r">innerException</span>)
            : <a href="../utils/RuntimeException.cs.html#e550883d468d8c30" class="k">base</a>(<span class="r173 r">message</span>, <span class="r174 r">innerException</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the RemoteException</span>
        <span class="c">///</span><span class="c"> with a specified error message, serialized Exception and</span>
        <span class="c">///</span><span class="c"> serialized InvocationInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The message that describes the error.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">serializedRemoteException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> serialized exception from remote msh</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">serializedRemoteInvocationInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> serialized invocation info from remote msh</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="0b6936c7838fa5eb" href="../R/0b6936c7838fa5eb.html" target="n" data-glyph="74,1" class="t constructor">RemoteException</a>
        (
            <b>string</b> <span id="r175 rd" class="r175 r">message</span>,
            <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r176 rd" class="r176 r">serializedRemoteException</span>,
            <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r177 rd" class="r177 r">serializedRemoteInvocationInfo</span>
        )
            : <a href="../utils/RuntimeException.cs.html#e4538a388d78c143" class="k">base</a>(<span class="r175 r">message</span>)
        {
            <a href="#c24b4278c90c366c" class="i field">_serializedRemoteException</a> = <span class="r176 r">serializedRemoteException</span>;
            <a href="#c1e945ab6f68e027" class="i field">_serializedRemoteInvocationInfo</a> = <span class="r177 r">serializedRemoteInvocationInfo</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ISerializable Members
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#d56edc1842249736" class="t t">RemoteException</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c">  class with serialized data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r178 r">info</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">SerializationInfo</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> that holds the serialized object</span>
        <span class="c">///</span><span class="c"> data about the exception being thrown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">StreamingContext</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> that contains contextual information</span>
        <span class="c">///</span><span class="c"> about the source or destination.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected</b> <a id="4d2c7f3d27239d9f" href="../R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">RemoteException</a>(<span class="i">SerializationInfo</span> <span id="r178 rd" class="r178 r">info</span>, <span class="i">StreamingContext</span> <span id="r179 rd" class="r179 r">context</span>)
            : <a href="../utils/RuntimeException.cs.html#42acad626a5cf24e" class="k">base</a>(<span class="r178 r">info</span>, <span class="r179 r">context</span>)
        {
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        [<span class="i">NonSerialized</span>]
        <b>private readonly</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="c24b4278c90c366c" href="../R/c24b4278c90c366c.html" target="n" data-glyph="46,1" class="i field">_serializedRemoteException</a>;
 
        [<span class="i">NonSerialized</span>]
        <b>private readonly</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="c1e945ab6f68e027" href="../R/c1e945ab6f68e027.html" target="n" data-glyph="46,1" class="i field">_serializedRemoteInvocationInfo</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Original Serialized Exception from remote msh.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">This is the exception which was thrown in remote.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="68770fe9884c0f08" href="../R/68770fe9884c0f08.html" target="n" data-glyph="102,1" class="i property">SerializedRemoteException</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#c24b4278c90c366c" class="i field">_serializedRemoteException</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> InvocationInfo, if any, associated with the SerializedRemoteException.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the serialized InvocationInfo from the remote msh.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public</b> <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="7abf4021cb9bf89a" href="../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">SerializedRemoteInvocationInfo</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#c1e945ab6f68e027" class="i field">_serializedRemoteInvocationInfo</a>;
            }
        }
 
        <b>private</b> <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="7078d75c4abc5741" href="../R/7078d75c4abc5741.html" target="n" data-glyph="46,1" class="i field">_remoteErrorRecord</a>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the remote error record associated with this exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r180 r">remoteError</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="fdd226a4f17722db" href="../R/fdd226a4f17722db.html" target="n" data-glyph="74,1" class="i method">SetRemoteErrorRecord</a>(<a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r180 rd" class="r180 r">remoteError</span>)
        {
            <a href="#7078d75c4abc5741" class="i field">_remoteErrorRecord</a> = <span class="r180 r">remoteError</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ErrorRecord associated with the exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="ae7bb0007ca4088a" href="../R/ae7bb0007ca4088a.html" target="n" data-glyph="102,1" class="i property">ErrorRecord</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#7078d75c4abc5741" class="i field">_remoteErrorRecord</a> != <b>null</b>)
                    <b>return</b> <a href="#7078d75c4abc5741" class="i field">_remoteErrorRecord</a>;
 
                <b>return</b> <a href="../utils/RuntimeException.cs.html#bd88f263eb295545" class="k">base</a>.<a href="../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>;
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
