<!DOCTYPE html>
<html><head><title>VariableAnalysis.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1874);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/parser/VariableAnalysis.cs" target="_top">engine\parser\VariableAnalysis.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>
{
    <b>internal static class</b> <a id="c5d64f9111bc0d20" href="../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">VariablePathExtensions</a>
    {
        <b>internal static bool</b> <a id="e3b11791a094c005" href="../../R/e3b11791a094c005.html" target="n" data-glyph="221,1" class="i method">IsAnyLocal</a>(<b>this</b> <a href="../VariablePath.cs.html#41e5b41974741cc5" class="t t">VariablePath</a> <span id="r0 rd" class="r0 r">variablePath</span>)
        {
            <b>return</b> <span class="r0 r">variablePath</span>.<a href="../VariablePath.cs.html#879182a6ac83bd5f" class="i property">IsUnscopedVariable</a> || <span class="r0 r">variablePath</span>.<a href="../VariablePath.cs.html#c3ed9dfca1006eb8" class="i property">IsLocal</a> || <span class="r0 r">variablePath</span>.<a href="../VariablePath.cs.html#3f742174e4f0a6ad" class="i property">IsPrivate</a>;
        }
    }
 
    <b>internal class</b> <a id="0dc854c4f5ec8516" href="../../R/0dc854c4f5ec8516.html" target="n" data-glyph="2,0" class="t t">VariableAnalysisDetails</a>
    {
        <b>internal</b> <a id="99e004b490007c20" href="../../R/99e004b490007c20.html" target="n" data-glyph="74,1" class="t constructor">VariableAnalysisDetails</a>()
        {
            <a href="#0dc854c4f5ec8516" class="k">this</a>.<a href="#6931599e5e078643" class="i property">AssociatedAsts</a> = <b>new</b> <span class="i">List</span>&lt;<a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt;();
        }
 
        <b>public int</b> <a id="386b698abde1b67a" href="../../R/386b698abde1b67a.html" target="n" data-glyph="102,1" class="i property">BitIndex</a> { <b>get</b>; <b>set</b>; }
 
        <b>public int</b> <a id="8178c740300cf485" href="../../R/8178c740300cf485.html" target="n" data-glyph="102,1" class="i property">LocalTupleIndex</a> { <b>get</b>; <b>set</b>; }
 
        <b>public</b> <span class="i">Type</span> <a id="77f29a3143bdd93f" href="../../R/77f29a3143bdd93f.html" target="n" data-glyph="102,1" class="i property">Type</a> { <b>get</b>; <b>set</b>; }
 
        <b>public string</b> <a id="fe9bdfe1200368c2" href="../../R/fe9bdfe1200368c2.html" target="n" data-glyph="102,1" class="i property">Name</a> { <b>get</b>; <b>set</b>; }
 
        <b>public bool</b> <a id="0ab6ca914ad3b25f" href="../../R/0ab6ca914ad3b25f.html" target="n" data-glyph="102,1" class="i property">Automatic</a> { <b>get</b>; <b>set</b>; }
 
        <b>public bool</b> <a id="c4f7b81749a7941d" href="../../R/c4f7b81749a7941d.html" target="n" data-glyph="102,1" class="i property">PreferenceVariable</a> { <b>get</b>; <b>set</b>; }
 
        <b>public bool</b> <a id="941f00f145b378ab" href="../../R/941f00f145b378ab.html" target="n" data-glyph="102,1" class="i property">Assigned</a> { <b>get</b>; <b>set</b>; }
 
        <b>public</b> <span class="i">List</span>&lt;<a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <a id="6931599e5e078643" href="../../R/6931599e5e078643.html" target="n" data-glyph="102,1" class="i property">AssociatedAsts</a> { <b>get</b>; }
    }
 
    <b>internal sealed class</b> <a id="d7ec29bd535482f0" href="../../R/d7ec29bd535482f0.html" target="n" data-glyph="2,0" class="t t">FindAllVariablesVisitor</a> : <a href="PreOrderVisitor.cs.html#0053fb584ec578aa" class="t t">AstVisitor</a>
    {
        <b>private static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="71840af3d0d81b44" href="../../R/71840af3d0d81b44.html" target="n" data-glyph="46,1" class="i field">s_hashOfPessimizingCmdlets</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <b>private static readonly string</b>[] <a id="98fac161ce34fd54" href="../../R/98fac161ce34fd54.html" target="n" data-glyph="46,1" class="i field">s_pessimizingCmdlets</a> = <b>new</b> <b>string</b>[]
                                                          {
                                                              <span class="s">&quot;New-Variable&quot;</span>,
                                                              <span class="s">&quot;Remove-Variable&quot;</span>,
                                                              <span class="s">&quot;Set-Variable&quot;</span>,
                                                              <span class="s">&quot;Set-PSBreakpoint&quot;</span>,
                                                              <span class="s">&quot;Microsoft.PowerShell.Utility\\New-Variable&quot;</span>,
                                                              <span class="s">&quot;Microsoft.PowerShell.Utility\\Remove-Variable&quot;</span>,
                                                              <span class="s">&quot;Microsoft.PowerShell.Utility\\Set-Variable&quot;</span>,
                                                              <span class="s">&quot;Microsoft.PowerShell.Utility\\Set-PSBreakpoint&quot;</span>,
                                                              <span class="s">&quot;nv&quot;</span>,
                                                              <span class="s">&quot;rv&quot;</span>,
                                                              <span class="s">&quot;sbp&quot;</span>,
                                                              <span class="s">&quot;sv&quot;</span>,
                                                              <span class="s">&quot;set&quot;</span>,
                                                          };
 
        <b>static</b> <a id="35171ebd71fb05c0" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t method">FindAllVariablesVisitor</a>()
        {
            <b>foreach</b> (<b>var</b> <span id="r1 rd" class="r1 r">cmdlet</span> <b>in</b> <a href="#98fac161ce34fd54" class="i field">s_pessimizingCmdlets</a>)
            {
                <a href="#71840af3d0d81b44" class="i field">s_hashOfPessimizingCmdlets</a>.<span class="i">Add</span>(<span class="r1 r">cmdlet</span>);
            }
        }
 
        <b>internal static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a>&gt; <a id="72e6d8f31b8fa5e3" href="../../R/72e6d8f31b8fa5e3.html" target="n" data-glyph="74,1" class="i method">Visit</a>(<a href="ast.cs.html#5cedc9c886fbe837" class="t t">TrapStatementAst</a> <span id="r2 rd" class="r2 r">trap</span>)
        {
            <span class="c">// We disable optimizations for trap because it simplifies what we need to do when invoking</span>
            <span class="c">// the trap, and it&#39;s assumed that the code inside a trap rarely, if ever, actually creates</span>
            <span class="c">// any local variables.</span>
            <a href="#d7ec29bd535482f0" class="k">var</a> <span id="r3 rd" class="r3 r">visitor</span> = <b>new</b> <a href="#7f125b5773f256b4" class="t constructor">FindAllVariablesVisitor</a>(<span class="r4 r">disableOptimizations</span>: <b>true</b>, <span class="r5 r">scriptCmdlet</span>: <b>false</b>);
            <span class="r2 r">trap</span>.<a href="ast.cs.html#f46fffb1c902252d" class="i property">Body</a>.<a href="ast.cs.html#21211804510b17d0" class="i method">InternalVisit</a>(<span class="r3 r">visitor</span>);
            <b>return</b> <span class="r3 r">visitor</span>.<a href="#c9bfc8ad5a14d955" class="i field">_variables</a>;
        }
 
        <span class="c">// Used to analyze an expression that is invoked separately, i.e. a default argument.</span>
        <b>internal static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a>&gt; <a id="9c54ded199222309" href="../../R/9c54ded199222309.html" target="n" data-glyph="74,1" class="i method">Visit</a>(<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r6 rd" class="r6 r">exprAst</span>)
        {
            <span class="c">// We disable optimizations for default expressions because it simplifies what we need to do when</span>
            <span class="c">// invoking the default expression, and it&#39;s assumed that the code inside a trap rarely, if ever,</span>
            <span class="c">// actually creates any local variables.</span>
            <a href="#d7ec29bd535482f0" class="k">var</a> <span id="r7 rd" class="r7 r">visitor</span> = <b>new</b> <a href="#7f125b5773f256b4" class="t constructor">FindAllVariablesVisitor</a>(<span class="r4 r">disableOptimizations</span>: <b>true</b>, <span class="r5 r">scriptCmdlet</span>: <b>false</b>);
            <span class="r6 r">exprAst</span>.<a href="ast.cs.html#2e9232a83bfd248d" class="i method">InternalVisit</a>(<span class="r7 r">visitor</span>);
            <b>return</b> <span class="r7 r">visitor</span>.<a href="#c9bfc8ad5a14d955" class="i field">_variables</a>;
        }
 
        <b>internal static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a>&gt; <a id="70cb6a4d6e8aff92" href="../../R/70cb6a4d6e8aff92.html" target="n" data-glyph="74,1" class="i method">Visit</a>(<a href="ast.cs.html#063cc8bbea9e10f2" class="t t">IParameterMetadataProvider</a> <span id="r8 rd" class="r8 r">ast</span>,
                                                                          <b>bool</b> <span id="r9 rd" class="r9 r">disableOptimizations</span>,
                                                                          <b>bool</b> <span id="r10 rd" class="r10 r">scriptCmdlet</span>,
                                                                          <b>out int</b> <span id="r11 rd" class="r11 r">localsAllocated</span>,
                                                                          <b>out bool</b> <span id="r12 rd" class="r12 r">forceNoOptimizing</span>)
        {
            <a href="#d7ec29bd535482f0" class="k">var</a> <span id="r13 rd" class="r13 r">visitor</span> = <b>new</b> <a href="#7f125b5773f256b4" class="t constructor">FindAllVariablesVisitor</a>(<span class="r9 r">disableOptimizations</span>, <span class="r10 r">scriptCmdlet</span>);
 
            <span class="c">// Visit the body before the parameters so we don&#39;t allocate any tuple slots for parameters</span>
            <span class="c">// if we won&#39;t be optimizing because of a call to new-variable/remove-variable, etc.</span>
 
            <span class="r8 r">ast</span>.<a href="ast.cs.html#b25d4ae40ae3a393" class="i property">Body</a>.<a href="ast.cs.html#360723934e684b68" class="i method">InternalVisit</a>(<span class="r13 r">visitor</span>);
            <span class="r12 r">forceNoOptimizing</span> = <span class="r13 r">visitor</span>.<a href="#bacb1b3ed9f0d26f" class="i field">_disableOptimizations</a>;
 
            <b>if</b> (<span class="r8 r">ast</span>.<a href="ast.cs.html#57fef4bbca7ab95c" class="i property">Parameters</a> != <b>null</b>)
            {
                <span class="r13 r">visitor</span>.<a href="#486eabcb77ac4dc7" class="i method">VisitParameters</a>(<span class="r8 r">ast</span>.<a href="ast.cs.html#57fef4bbca7ab95c" class="i property">Parameters</a>);
            }
 
            <span class="r11 r">localsAllocated</span> = <span class="r13 r">visitor</span>.<a href="#c9bfc8ad5a14d955" class="i field">_variables</a>.<span class="i">Count</span>(<b>static</b> <span id="r14 rd" class="r14 r">details</span> =&gt; <span class="r14 r">details</span>.<span class="i">Value</span>.<span class="i">LocalTupleIndex</span> != <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>);
            <b>return</b> <span class="r13 r">visitor</span>.<a href="#c9bfc8ad5a14d955" class="i field">_variables</a>;
        }
 
        <b>private bool</b> <a id="bacb1b3ed9f0d26f" href="../../R/bacb1b3ed9f0d26f.html" target="n" data-glyph="46,1" class="i field">_disableOptimizations</a>;
 
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a>&gt; <a id="c9bfc8ad5a14d955" href="../../R/c9bfc8ad5a14d955.html" target="n" data-glyph="46,1" class="i field">_variables</a>
            = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <b>private</b> <a id="7f125b5773f256b4" href="../../R/7f125b5773f256b4.html" target="n" data-glyph="76,1" class="t constructor">FindAllVariablesVisitor</a>(<b>bool</b> <span id="r4 rd" class="r4 r">disableOptimizations</span>, <b>bool</b> <span id="r5 rd" class="r5 r">scriptCmdlet</span>)
        {
            <a href="#bacb1b3ed9f0d26f" class="i field">_disableOptimizations</a> = <span class="r4 r">disableOptimizations</span>;
 
            <b>var</b> <span id="r15 rd" class="r15 r">automaticVariables</span> = <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#2e947723b75287da" class="i field">AutomaticVariables</a>;
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#17ef530bb6e96dad" class="i field">Underbar</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#3599fdc9d261201f" class="i field">Underbar</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (0)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#114eb154e0b62af0" class="i field">Args</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#57fd29949d2d5d62" class="i field">Args</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (1)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#e7c9d57b99950a65" class="i field">This</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#314e6b638d8d7ddc" class="i field">This</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (2)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#f1286376db5777e6" class="i field">Input</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#52526bd30f8a492b" class="i field">Input</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (3)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#e4c3391b8e3a9437" class="i field">PSCmdlet</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#37f55176262aac78" class="i field">PSCmdlet</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (4)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#19ec77bcdb2364c8" class="i field">PSBoundParameters</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#93a934b8cba4991e" class="i field">PSBoundParameters</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (5)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#10787de037075005" class="i field">MyInvocation</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#80b3b66ce97fc2c9" class="i field">MyInvocation</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (6)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#3d4b8747790649ee" class="i field">PSScriptRoot</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#1c3db3207a8956e8" class="i field">PSScriptRoot</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (7)&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="i">Array</span>.<span class="i">IndexOf</span>(<span class="r15 r">automaticVariables</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#57e32aac04e8290f" class="i field">PSCommandPath</a>) == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#b00a55abca04b860" class="i field">PSCommandPath</a>,
                               <span class="s">&quot;automaticVariables order is incorrect (8)&quot;</span>);
 
            <b>int</b> <span id="r16 rd" class="r16 r">i</span>;
            <b>for</b> (<span class="r16 r">i</span> = 0; <span class="r16 r">i</span> &lt; <span class="r15 r">automaticVariables</span>.<span class="i">Length</span>; ++<span class="r16 r">i</span>)
            {
                <a href="#ae025a37d879dde0" class="i method">NoteVariable</a>(<span class="r15 r">automaticVariables</span>[<span class="r16 r">i</span>], <span class="r16 r">i</span>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#6729b0cd3aff6afe" class="i field">AutomaticVariableTypes</a>[<span class="r16 r">i</span>], <span class="r17 r">automatic</span>: <b>true</b>);
            }
 
            <b>if</b> (<span class="r5 r">scriptCmdlet</span>)
            {
                <b>var</b> <span id="r18 rd" class="r18 r">preferenceVariables</span> = <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#9116a45d77f35b10" class="i field">PreferenceVariables</a>;
                <b>for</b> (<span class="r16 r">i</span> = 0; <span class="r16 r">i</span> &lt; <span class="r18 r">preferenceVariables</span>.<span class="i">Length</span>; ++<span class="r16 r">i</span>)
                {
                    <span class="i">NoteVariable</span>(<span class="r18 r">preferenceVariables</span>[<span class="r16 r">i</span>], <span class="r16 r">i</span> + (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#d64e69972d70be92" class="i field">NumberOfAutomaticVariables</a>,
                        <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#2ad4ebba0d8352d4" class="i field">PreferenceVariableTypes</a>[<span class="r16 r">i</span>], <span class="i">preferenceVariable</span>: <b>true</b>);
                }
            }
 
            <span class="i">NoteVariable</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#b6629e76bb57ad85" class="i field">Question</a>, <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>, <b>typeof</b>(<b>bool</b>), <span class="i">automatic</span>: <b>true</b>);
        }
 
        <b>private void</b> <a id="486eabcb77ac4dc7" href="../../R/486eabcb77ac4dc7.html" target="n" data-glyph="76,1" class="i method">VisitParameters</a>(<span class="i">ReadOnlyCollection</span>&lt;<a href="ast.cs.html#bf2a2797225b11b5" class="t t">ParameterAst</a>&gt; <span id="r19 rd" class="r19 r">parameters</span>)
        {
            <b>foreach</b> (<a href="ast.cs.html#bf2a2797225b11b5" class="t t">ParameterAst</a> <span id="r20 rd" class="r20 r">t</span> <b>in</b> <span class="r19 r">parameters</span>)
            {
                <a href="ast.cs.html#248562b22b336dec" class="k">var</a> <span id="r21 rd" class="r21 r">variableExpressionAst</span> = <span class="r20 r">t</span>.<a href="ast.cs.html#ba2fe0223eb09f0d" class="i property">Name</a>;
                <a href="../VariablePath.cs.html#41e5b41974741cc5" class="k">var</a> <span id="r22 rd" class="r22 r">varPath</span> = <span class="r21 r">variableExpressionAst</span>.<a href="ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>;
 
                <b>if</b> (<span class="r22 r">varPath</span>.<a href="#e3b11791a094c005" class="i method">IsAnyLocal</a>())
                {
                    <b>var</b> <span id="r23 rd" class="r23 r">variableName</span> = <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#9a7a53876a6e7d32" class="i method">GetUnaliasedVariableName</a>(<span class="r22 r">varPath</span>);
                    <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a> <span id="r24 rd" class="r24 r">analysisDetails</span>;
                    <b>if</b> (<a href="#c9bfc8ad5a14d955" class="i field">_variables</a>.<span class="i">TryGetValue</span>(<span class="r23 r">variableName</span>, <b>out</b> <span class="r24 r">analysisDetails</span>))
                    {
                        <span class="c">// Forget whatever type we deduced in the body, we&#39;ll revisit that type after walking</span>
                        <span class="c">// the flow graph.  We should see the parameter type for the variable first.</span>
                        <span class="r24 r">analysisDetails</span>.<a href="#77f29a3143bdd93f" class="i property">Type</a> = <span class="r20 r">t</span>.<a href="ast.cs.html#a41281d1e358ea79" class="i property">StaticType</a>;
 
                        <span class="c">// If the parameter has no default value, we can&#39;t allocate a strongly typed</span>
                        <span class="c">// slot in the tuple.  This only matters for value types where we allow</span>
                        <span class="c">// comparisons with $null and don&#39;t try to convert the $null value to the</span>
                        <span class="c">// valuetype because the parameter has no value yet.  For example:</span>
                        <span class="c">//     &amp; { param([System.Reflection.MemberTypes]$m) ($null -eq $m) }</span>
 
                        <b>object</b> <span id="r25 rd" class="r25 r">unused</span>;
                        <b>if</b> (!<a href="Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="Compiler.cs.html#78e2d1281fd0bd6c" class="i method">TryGetDefaultParameterValue</a>(<span class="r24 r">analysisDetails</span>.<a href="#77f29a3143bdd93f" class="i property">Type</a>, <b>out</b> <span class="r25 r">unused</span>))
                        {
                            <span class="r24 r">analysisDetails</span>.<a href="#8178c740300cf485" class="i property">LocalTupleIndex</a> = <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
                        }
                    }
                    <b>else</b>
                    {
                        <a href="#ae025a37d879dde0" class="i method">NoteVariable</a>(<span class="r23 r">variableName</span>, <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>, <span class="r20 r">t</span>.<a href="ast.cs.html#a41281d1e358ea79" class="i property">StaticType</a>);
                    }
                }
            }
        }
 
        <span class="c">// Add a variable to the variable dictionary</span>
        <b>private void</b> <a id="ae025a37d879dde0" href="../../R/ae025a37d879dde0.html" target="n" data-glyph="76,1" class="i method">NoteVariable</a>(<b>string</b> <span id="r26 rd" class="r26 r">variableName</span>, <b>int</b> <span id="r27 rd" class="r27 r">index</span>, <span class="i">Type</span> <span id="r28 rd" class="r28 r">type</span>, <b>bool</b> <span id="r17 rd" class="r17 r">automatic</span> = <b>false</b>, <b>bool</b> <span id="r29 rd" class="r29 r">preferenceVariable</span> = <b>false</b>)
        {
            <b>if</b> (!<a href="#c9bfc8ad5a14d955" class="i field">_variables</a>.<span class="i">ContainsKey</span>(<span class="r26 r">variableName</span>))
            {
                <a href="#0dc854c4f5ec8516" class="k">var</a> <span id="r30 rd" class="r30 r">details</span> = <b>new</b> <a href="#99e004b490007c20" class="t constructor">VariableAnalysisDetails</a>
                {
                    <a href="#386b698abde1b67a" class="i property">BitIndex</a> = <a href="#c9bfc8ad5a14d955" class="i field">_variables</a>.<span class="i">Count</span>,
                    <a href="#8178c740300cf485" class="i property">LocalTupleIndex</a> = <span class="r27 r">index</span>,
                    <a href="#fe9bdfe1200368c2" class="i property">Name</a> = <span class="r26 r">variableName</span>,
                    <a href="#77f29a3143bdd93f" class="i property">Type</a> = <span class="r28 r">type</span>,
                    <a href="#0ab6ca914ad3b25f" class="i property">Automatic</a> = <span class="r17 r">automatic</span>,
                    <a href="#c4f7b81749a7941d" class="i property">PreferenceVariable</a> = <span class="r29 r">preferenceVariable</span>,
                    <a href="#941f00f145b378ab" class="i property">Assigned</a> = <b>false</b>,
                };
                <a href="#c9bfc8ad5a14d955" class="i field">_variables</a>.<span class="i">Add</span>(<span class="r26 r">variableName</span>, <span class="r30 r">details</span>);
            }
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="d765462a99068dc8" href="../../R/d765462a99068dc8.html" target="n" data-glyph="72,1" class="i method">VisitDataStatement</a>(<a href="ast.cs.html#37c175482122764b" class="t t">DataStatementAst</a> <span id="r31 rd" class="r31 r">dataStatementAst</span>)
        {
            <b>if</b> (<span class="r31 r">dataStatementAst</span>.<a href="ast.cs.html#9eb92e727e59a7eb" class="i property">Variable</a> != <b>null</b>)
            {
                <a href="#ae025a37d879dde0" class="i method">NoteVariable</a>(<span class="r31 r">dataStatementAst</span>.<a href="ast.cs.html#9eb92e727e59a7eb" class="i property">Variable</a>, <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>, <b>null</b>);
            }
 
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#eaa9a8bac592128a" class="i field">Continue</a>;
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="c2abd0a549d64815" href="../../R/c2abd0a549d64815.html" target="n" data-glyph="72,1" class="i method">VisitSwitchStatement</a>(<a href="ast.cs.html#4d96f6c979a5266e" class="t t">SwitchStatementAst</a> <span id="r32 rd" class="r32 r">switchStatementAst</span>)
        {
            <span class="i">NoteVariable</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#c6964a35f7b6545f" class="i field">@switch</a>, <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>, <b>typeof</b>(<span class="i">IEnumerator</span>));
 
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#eaa9a8bac592128a" class="i field">Continue</a>;
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="761a1ac8ea7331a4" href="../../R/761a1ac8ea7331a4.html" target="n" data-glyph="72,1" class="i method">VisitForEachStatement</a>(<a href="ast.cs.html#9ae6aa2909fef7b0" class="t t">ForEachStatementAst</a> <span id="r33 rd" class="r33 r">forEachStatementAst</span>)
        {
            <span class="i">NoteVariable</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#0b26037366c6e99a" class="i field">@foreach</a>, <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>, <b>typeof</b>(<span class="i">IEnumerator</span>));
 
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#eaa9a8bac592128a" class="i field">Continue</a>;
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="78330c9b55e8bba7" href="../../R/78330c9b55e8bba7.html" target="n" data-glyph="72,1" class="i method">VisitVariableExpression</a>(<a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a> <span id="r34 rd" class="r34 r">variableExpressionAst</span>)
        {
            <a href="../VariablePath.cs.html#41e5b41974741cc5" class="k">var</a> <span id="r35 rd" class="r35 r">varPath</span> = <span class="r34 r">variableExpressionAst</span>.<a href="ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>;
            <b>if</b> (<span class="r35 r">varPath</span>.<a href="#e3b11791a094c005" class="i method">IsAnyLocal</a>())
            {
                <b>if</b> (<span class="r35 r">varPath</span>.<a href="../VariablePath.cs.html#3f742174e4f0a6ad" class="i property">IsPrivate</a>)
                {
                    <span class="c">// TODO: force just this variable to be dynamic, not all variables.</span>
                    <a href="#bacb1b3ed9f0d26f" class="i field">_disableOptimizations</a> = <b>true</b>;
                }
 
                <a href="#ae025a37d879dde0" class="i method">NoteVariable</a>(<a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#9a7a53876a6e7d32" class="i method">GetUnaliasedVariableName</a>(<span class="r35 r">varPath</span>), <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>, <b>null</b>);
            }
 
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#eaa9a8bac592128a" class="i field">Continue</a>;
        }
 
        <b>private int</b> <a id="d1b1673f6fef0931" href="../../R/d1b1673f6fef0931.html" target="n" data-glyph="46,1" class="i field">_runtimeUsingIndex</a>;
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="0158defe120f6023" href="../../R/0158defe120f6023.html" target="n" data-glyph="72,1" class="i method">VisitUsingExpression</a>(<a href="ast.cs.html#42d36b88817a807f" class="t t">UsingExpressionAst</a> <span id="r36 rd" class="r36 r">usingExpressionAst</span>)
        {
            <span class="c">// On the local machine, we may have set the index because of a call to ScriptBlockToPowerShell or Invoke-Command.</span>
            <span class="c">// On the remote machine, the index probably isn&#39;t set yet, so we set it here, mostly to avoid another pass</span>
            <span class="c">// over the ast.  We assert below to ensure we&#39;re setting to the same value in both the local and remote cases.</span>
            <b>if</b> (<span class="r36 r">usingExpressionAst</span>.<a href="ast.cs.html#4ab6dd3c695bb345" class="i property">RuntimeUsingIndex</a> == -1)
            {
                <span class="r36 r">usingExpressionAst</span>.<a href="ast.cs.html#4ab6dd3c695bb345" class="i property">RuntimeUsingIndex</a> = <a href="#d1b1673f6fef0931" class="i field">_runtimeUsingIndex</a>;
            }
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r36 r">usingExpressionAst</span>.<a href="ast.cs.html#4ab6dd3c695bb345" class="i property">RuntimeUsingIndex</a> == <a href="#d1b1673f6fef0931" class="i field">_runtimeUsingIndex</a>, <span class="s">&quot;Logic error in visiting using expressions.&quot;</span>);
            <a href="#d1b1673f6fef0931" class="i field">_runtimeUsingIndex</a> += 1;
 
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#eaa9a8bac592128a" class="i field">Continue</a>;
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="dd790ca90d5ef511" href="../../R/dd790ca90d5ef511.html" target="n" data-glyph="72,1" class="i method">VisitCommand</a>(<a href="ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> <span id="r37 rd" class="r37 r">commandAst</span>)
        {
            <a href="ast.cs.html#e18e1bad255cd022" class="k">var</a> <span id="r38 rd" class="r38 r">commandName</span> = <span class="r37 r">commandAst</span>.<a href="ast.cs.html#f3fdfe686fb0ef19" class="i property">CommandElements</a>[0] <b>as</b> <a href="ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>;
            <b>if</b> (<span class="r38 r">commandName</span> != <b>null</b> &amp;&amp; <a href="#71840af3d0d81b44" class="i field">s_hashOfPessimizingCmdlets</a>.<span class="i">Contains</span>(<span class="r38 r">commandName</span>.<a href="ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a>))
            {
                <span class="c">// TODO: psuedo-bind the command invocation to figure out the variable and only force that variable to be unoptimized</span>
                <a href="#bacb1b3ed9f0d26f" class="i field">_disableOptimizations</a> = <b>true</b>;
            }
 
            <b>if</b> (<span class="r37 r">commandAst</span>.<a href="ast.cs.html#16e18484040f8b6f" class="i property">InvocationOperator</a> == <a href="token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>)
            {
                <span class="c">// For code like:</span>
                <span class="c">//     &amp; { . { [string]$x = &quot;abc&quot; }; $x = 42; $x.GetType() }</span>
                <span class="c">// We expect $x to be of type string, not int.</span>
                <span class="c">// If we optimize, we&#39;ll end up throwing an error because the variable created in dotting is not consistent with the first</span>
                <span class="c">// assignment to $x in the outer scope.  To support this scenario, we&#39;ll disable optimizing when dotting.</span>
                <span class="c">//</span>
                <span class="c">// This is not a complete fix - some cmdlets (like foreach-object) dot scripts.  We don&#39;t want to disable optimizations</span>
                <span class="c">// unnecessarily (foreach-object is used heavily).  This issue rarely comes up in foreach-object, so we&#39;ll live with the</span>
                <span class="c">// errors. (See VariableNotWritableRare for the errors that happen when this issue arises.)</span>
 
                <a href="#bacb1b3ed9f0d26f" class="i field">_disableOptimizations</a> = <b>true</b>;
            }
 
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#eaa9a8bac592128a" class="i field">Continue</a>;
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="1442809f2fd2030a" href="../../R/1442809f2fd2030a.html" target="n" data-glyph="72,1" class="i method">VisitFunctionDefinition</a>(<a href="ast.cs.html#dd61b2a7b388405b" class="t t">FunctionDefinitionAst</a> <span id="r39 rd" class="r39 r">functionDefinitionAst</span>)
        {
            <span class="c">// We don&#39;t want to discover any variables in nested functions - they get their own scope.</span>
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#32db74815e3296ba" class="i field">SkipChildren</a>;
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="a748cee05c2147de" href="../../R/a748cee05c2147de.html" target="n" data-glyph="72,1" class="i method">VisitScriptBlockExpression</a>(<a href="ast.cs.html#5ec0737db546f4f5" class="t t">ScriptBlockExpressionAst</a> <span id="r40 rd" class="r40 r">scriptBlockExpressionAst</span>)
        {
            <span class="c">// We don&#39;t want to discover any variables in script block expressions - they get their own scope.</span>
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#32db74815e3296ba" class="i field">SkipChildren</a>;
        }
 
        <b>public override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="88adc2f2411c8b3b" href="../../R/88adc2f2411c8b3b.html" target="n" data-glyph="72,1" class="i method">VisitTrap</a>(<a href="ast.cs.html#5cedc9c886fbe837" class="t t">TrapStatementAst</a> <span id="r41 rd" class="r41 r">trapStatementAst</span>)
        {
            <span class="c">// We don&#39;t want to discover any variables in traps - they get their own scope.</span>
            <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#32db74815e3296ba" class="i field">SkipChildren</a>;
        }
    }
 
    <b>internal class</b> <a id="3d310869db3a3b73" href="../../R/3d310869db3a3b73.html" target="n" data-glyph="2,0" class="t t"><span id="9e08f5ea92201356">VariableAnalysis</span></a> : <a href="AstVisitor.cs.html#92b75e0afbdd3cf3" class="t t">ICustomAstVisitor2</a>
    {
        <span class="c">// Tuple slots start at index 0.  &gt;= 0 means a variable is allocated in the tuple.  -1 means we haven&#39;t</span>
        <span class="c">// analyzed a specific use of a variable and don&#39;t know what slot it might be assigned to yet.</span>
        <b>internal const int</b> <a id="6aefafdf223b7beb" href="../../R/6aefafdf223b7beb.html" target="n" data-glyph="8,1" class="i field">Unanalyzed</a> = -1;
 
        <span class="c">// In some cases, we want to force a variable to not be allocated in the tuple, but instead use the variable</span>
        <span class="c">// table along with a PSVariable instance.  For example,</span>
        <span class="c">//    1. if a variable&#39;s type might change in the same scope;</span>
        <span class="c">//    2. if there might be any validation attributes or more than one argument conversion</span>
        <span class="c">//    3. if there is one argument conversion but the conversion type cannot be resolved at compile time (it&#39;s</span>
        <span class="c">//       possible that the assembly containing the type would be loaded during runtime)</span>
        <span class="c">// in these cases, we rely on the setter PSVariable.Value to handle those attributes.</span>
        <b>internal const int</b> <a id="1df8fb0284c85f3f" href="../../R/1df8fb0284c85f3f.html" target="n" data-glyph="8,1" class="i field">ForceDynamic</a> = -2;
 
        <b>private sealed class</b> <a id="3550e03a09e9cfa4" href="../../R/3550e03a09e9cfa4.html" target="n" data-glyph="4,1" class="t t">LoopGotoTargets</a>
        {
            <b>internal</b> <a id="fd550302a19d1412" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">LoopGotoTargets</a>(<b>string</b> <span id="r42 rd" class="r42 r">label</span>, <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r43 rd" class="r43 r">breakTarget</span>, <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r44 rd" class="r44 r">continueTarget</span>)
            {
                <a href="#3550e03a09e9cfa4" class="k">this</a>.<a href="#b8a19db62243df26" class="i property">Label</a> = <span class="r42 r">label</span>;
                <a href="#3550e03a09e9cfa4" class="k">this</a>.<a href="#ebe66256bf5afff3" class="i property">BreakTarget</a> = <span class="r43 r">breakTarget</span>;
                <a href="#3550e03a09e9cfa4" class="k">this</a>.<a href="#182e99f07e8ecda2" class="i property">ContinueTarget</a> = <span class="r44 r">continueTarget</span>;
            }
 
            <b>internal string</b> <a id="b8a19db62243df26" href="../../R/b8a19db62243df26.html" target="n" data-glyph="104,2" class="i property">Label</a> { <b>get</b>; }
 
            <b>internal</b> <a href="#6e3c865f32035987" class="t t">Block</a> <a id="ebe66256bf5afff3" href="../../R/ebe66256bf5afff3.html" target="n" data-glyph="104,2" class="i property">BreakTarget</a> { <b>get</b>; }
 
            <b>internal</b> <a href="#6e3c865f32035987" class="t t">Block</a> <a id="182e99f07e8ecda2" href="../../R/182e99f07e8ecda2.html" target="n" data-glyph="104,2" class="i property">ContinueTarget</a> { <b>get</b>; }
        }
 
        <b>private sealed class</b> <a id="6e3c865f32035987" href="../../R/6e3c865f32035987.html" target="n" data-glyph="4,1" class="t t">Block</a>
        {
            <b>internal readonly</b> <span class="i">List</span>&lt;<a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt; <a id="e2c12091c9df3165" href="../../R/e2c12091c9df3165.html" target="n" data-glyph="44,2" class="i field">_asts</a> = <b>new</b> <span class="i">List</span>&lt;<a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a>&gt;();
            <b>private readonly</b> <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt; <a id="b3d6fa7266ec616b" href="../../R/b3d6fa7266ec616b.html" target="n" data-glyph="46,2" class="i field">_successors</a> = <b>new</b> <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt;();
            <b>internal readonly</b> <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt; <a id="b60ac8229217d407" href="../../R/b60ac8229217d407.html" target="n" data-glyph="44,2" class="i field">_predecessors</a> = <b>new</b> <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt;();
 
            <b>internal object</b> <a id="a2231ad0571f8547" href="../../R/a2231ad0571f8547.html" target="n" data-glyph="44,2" class="i field">_visitData</a>;
            <b>internal bool</b> <a id="30b9171ef5e4ac3d" href="../../R/30b9171ef5e4ac3d.html" target="n" data-glyph="44,2" class="i field">_throws</a>;
            <b>internal bool</b> <a id="6aafa57a64bb366a" href="../../R/6aafa57a64bb366a.html" target="n" data-glyph="44,2" class="i field">_returns</a>;
 
            <b>internal bool</b> <a id="07dd5608b5fc05c9" href="../../R/07dd5608b5fc05c9.html" target="n" data-glyph="104,2" class="i property">_unreachable</a> { <b>get</b>; <b>private set</b>; }
 
            <span class="c">// Only Entry block, that can be constructed via NewEntryBlock() is reachable initially.</span>
            <span class="c">// all other blocks are unreachable.</span>
            <span class="c">// reachability of block should be proved with FlowsTo() calls.</span>
            <b>public</b> <a id="49ae3d220ba7b908" href="../../R/49ae3d220ba7b908.html" target="n" data-glyph="72,2" class="t constructor">Block</a>()
            {
                <a href="#6e3c865f32035987" class="k">this</a>.<a href="#07dd5608b5fc05c9" class="i property">_unreachable</a> = <b>true</b>;
            }
 
            <b>public static</b> <a href="#6e3c865f32035987" class="t t">Block</a> <a id="86297fa23d96e165" href="../../R/86297fa23d96e165.html" target="n" data-glyph="72,2" class="i method">NewEntryBlock</a>()
            {
                <b>return</b> <b>new</b> <a href="#dc4a377cf1374c7b" class="t constructor">Block</a>(<span class="r45 r">unreachable</span>: <b>false</b>);
            }
 
            <b>private</b> <a id="dc4a377cf1374c7b" href="../../R/dc4a377cf1374c7b.html" target="n" data-glyph="76,2" class="t constructor">Block</a>(<b>bool</b> <span id="r45 rd" class="r45 r">unreachable</span>)
            {
                <a href="#6e3c865f32035987" class="k">this</a>.<a href="#07dd5608b5fc05c9" class="i property">_unreachable</a> = <span class="r45 r">unreachable</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Tell flow analysis that this block can flow to next block.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">next</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>internal void</b> <a id="71d700731a5cf16e" href="../../R/71d700731a5cf16e.html" target="n" data-glyph="74,2" class="i method">FlowsTo</a>(<a href="#6e3c865f32035987" class="t t">Block</a> <span id="r46 rd" class="r46 r">next</span>)
            {
                <b>if</b> (<a href="#b3d6fa7266ec616b" class="i field">_successors</a>.<span class="i">IndexOf</span>(<span class="r46 r">next</span>) &lt; 0)
                {
                    <b>if</b> (!<a href="#07dd5608b5fc05c9" class="i property">_unreachable</a>)
                    {
                        <span class="r46 r">next</span>.<a href="#07dd5608b5fc05c9" class="i property">_unreachable</a> = <b>false</b>;
                    }
 
                    <a href="#b3d6fa7266ec616b" class="i field">_successors</a>.<span class="i">Add</span>(<span class="r46 r">next</span>);
                    <span class="r46 r">next</span>.<a href="#b60ac8229217d407" class="i field">_predecessors</a>.<span class="i">Add</span>(<a href="#6e3c865f32035987" class="k">this</a>);
                }
            }
 
            <b>internal void</b> <a id="d7083a5c7371c657" href="../../R/d7083a5c7371c657.html" target="n" data-glyph="74,2" class="i method">AddAst</a>(<a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r47 rd" class="r47 r">ast</span>)
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r47 r">ast</span> <b>is</b> <a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a> || <span class="r47 r">ast</span> <b>is</b> <a href="#445b07963beb5395" class="t t">AssignmentTarget</a> || <span class="r47 r">ast</span> <b>is</b> <a href="ast.cs.html#37c175482122764b" class="t t">DataStatementAst</a>,
                    <span class="s">&quot;Only add variables and assignments&quot;</span>);
                <a href="#e2c12091c9df3165" class="i field">_asts</a>.<span class="i">Add</span>(<span class="r47 r">ast</span>);
            }
 
            <b>internal static</b> <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt; <a id="57635106e02f1254" href="../../R/57635106e02f1254.html" target="n" data-glyph="74,2" class="i method">GenerateReverseDepthFirstOrder</a>(<a href="#6e3c865f32035987" class="t t">Block</a> <span id="r48 rd" class="r48 r">block</span>)
            {
                <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt; <span id="r49 rd" class="r49 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt;();
 
                <a href="#4215092403d32f57" class="i method">VisitDepthFirstOrder</a>(<span class="r48 r">block</span>, <span class="r49 r">result</span>);
                <span class="r49 r">result</span>.<span class="i">Reverse</span>();
                <b>for</b> (<b>int</b> <span id="r50 rd" class="r50 r">i</span> = 0; <span class="r50 r">i</span> &lt; <span class="r49 r">result</span>.<span class="i">Count</span>; <span class="r50 r">i</span>++)
                {
                    <span class="r49 r">result</span>[<span class="r50 r">i</span>].<span class="i">_visitData</span> = <b>null</b>;
                }
 
                <b>return</b> <span class="r49 r">result</span>;
            }
 
            <b>private static void</b> <a id="4215092403d32f57" href="../../R/4215092403d32f57.html" target="n" data-glyph="76,2" class="i method">VisitDepthFirstOrder</a>(<a href="#6e3c865f32035987" class="t t">Block</a> <span id="r51 rd" class="r51 r">block</span>, <span class="i">List</span>&lt;<a href="#6e3c865f32035987" class="t t">Block</a>&gt; <span id="r52 rd" class="r52 r">visitData</span>)
            {
                <b>if</b> (<span class="i">ReferenceEquals</span>(<span class="r51 r">block</span>.<a href="#a2231ad0571f8547" class="i field">_visitData</a>, <span class="r52 r">visitData</span>))
                    <b>return</b>;
 
                <span class="r51 r">block</span>.<a href="#a2231ad0571f8547" class="i field">_visitData</a> = <span class="r52 r">visitData</span>;
 
                <b>foreach</b> (<a href="#6e3c865f32035987" class="t t">Block</a> <span id="r53 rd" class="r53 r">succ</span> <b>in</b> <span class="r51 r">block</span>.<a href="#b3d6fa7266ec616b" class="i field">_successors</a>)
                {
                    <a href="#4215092403d32f57" class="i method">VisitDepthFirstOrder</a>(<span class="r53 r">succ</span>, <span class="r52 r">visitData</span>);
                }
 
                <span class="r52 r">visitData</span>.<span class="i">Add</span>(<span class="r51 r">block</span>);
            }
        }
 
        <b>private sealed class</b> <a id="445b07963beb5395" href="../../R/445b07963beb5395.html" target="n" data-glyph="4,1" class="t t">AssignmentTarget</a> : <a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a>
        {
            <b>internal readonly</b> <a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <a id="dbbec484ef9f53f0" href="../../R/dbbec484ef9f53f0.html" target="n" data-glyph="44,2" class="i field">_targetAst</a>;
            <b>internal readonly string</b> <a id="056d29e1846bc590" href="../../R/056d29e1846bc590.html" target="n" data-glyph="44,2" class="i field">_variableName</a>;
            <b>internal readonly</b> <span class="i">Type</span> <a id="63dbfbb14881fc3b" href="../../R/63dbfbb14881fc3b.html" target="n" data-glyph="44,2" class="i field">_type</a>;
 
            <b>public</b> <a id="c55d03475438905e" href="../../R/c55d03475438905e.html" target="n" data-glyph="72,2" class="t constructor">AssignmentTarget</a>(<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r54 rd" class="r54 r">targetExpressionAst</span>)
                : <a href="ast.cs.html#e73f9afcbf27eb4d" class="k">base</a>(<a href="Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>)
            {
                <a href="#445b07963beb5395" class="k">this</a>.<a href="#dbbec484ef9f53f0" class="i field">_targetAst</a> = <span class="r54 r">targetExpressionAst</span>;
            }
 
            <b>public</b> <a id="0df0ca4a02ad5aa2" href="../../R/0df0ca4a02ad5aa2.html" target="n" data-glyph="72,2" class="t constructor">AssignmentTarget</a>(<b>string</b> <span id="r55 rd" class="r55 r">variableName</span>, <span class="i">Type</span> <span id="r56 rd" class="r56 r">type</span>)
                : <a href="ast.cs.html#e73f9afcbf27eb4d" class="k">base</a>(<a href="Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>)
            {
                <a href="#445b07963beb5395" class="k">this</a>.<a href="#056d29e1846bc590" class="i field">_variableName</a> = <span class="r55 r">variableName</span>;
                <a href="#445b07963beb5395" class="k">this</a>.<a href="#63dbfbb14881fc3b" class="i field">_type</a> = <span class="r56 r">type</span>;
            }
 
            <b>public override</b> <a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <a id="1d744beb7b25f4ff" href="../../R/1d744beb7b25f4ff.html" target="n" data-glyph="72,2" class="i method">Copy</a>()
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;This code is unreachable.&quot;</span>);
                <b>return</b> <b>null</b>;
            }
 
            <b>internal override object</b> <a id="132e012fe299cf48" href="../../R/132e012fe299cf48.html" target="n" data-glyph="74,2" class="i method">Accept</a>(<a href="AstVisitor.cs.html#735848148c592aff" class="t t">ICustomAstVisitor</a> <span id="r57 rd" class="r57 r">visitor</span>)
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;This code is unreachable.&quot;</span>);
                <b>return</b> <b>null</b>;
            }
 
            <b>internal override</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a> <a id="ab0b7946f8b890af" href="../../R/ab0b7946f8b890af.html" target="n" data-glyph="74,2" class="i method">InternalVisit</a>(<a href="PreOrderVisitor.cs.html#0053fb584ec578aa" class="t t">AstVisitor</a> <span id="r58 rd" class="r58 r">visitor</span>)
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;This code is unreachable.&quot;</span>);
                <b>return</b> <a href="PreOrderVisitor.cs.html#1a6b8cf9a4c6249a" class="t t">AstVisitAction</a>.<a href="PreOrderVisitor.cs.html#eaa9a8bac592128a" class="i field">Continue</a>;
            }
        }
 
        <b>internal static string</b> <a id="2c3edf72a1dd698b" href="../../R/2c3edf72a1dd698b.html" target="n" data-glyph="74,1" class="i method">GetUnaliasedVariableName</a>(<b>string</b> <span id="r59 rd" class="r59 r">varName</span>)
        {
            <b>return</b> <span class="r59 r">varName</span>.<span class="i">Equals</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#f10afee675f645d4" class="i field">PSItem</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                       ? <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#17ef530bb6e96dad" class="i field">Underbar</a>
                       : <span class="r59 r">varName</span>;
        }
 
        <b>internal static string</b> <a id="9a7a53876a6e7d32" href="../../R/9a7a53876a6e7d32.html" target="n" data-glyph="74,1" class="i method">GetUnaliasedVariableName</a>(<a href="../VariablePath.cs.html#41e5b41974741cc5" class="t t">VariablePath</a> <span id="r60 rd" class="r60 r">varPath</span>)
        {
            <b>return</b> <a href="#2c3edf72a1dd698b" class="i method">GetUnaliasedVariableName</a>(<span class="r60 r">varPath</span>.<a href="../VariablePath.cs.html#4d193f060335d69e" class="i property">UnqualifiedPath</a>);
        }
 
        <span class="c">// At compile time, we know specific variables are allscope and we can&#39;t optimize assignments.  This hashset must remain</span>
        <span class="c">// constant though - it only contains variable names known to _always_ be allscope.  For other names, we need a special</span>
        <span class="c">// check before choosing to run the optimized code or unoptimized (dotted) version which will correctly handle allscope</span>
        <span class="c">// assignments.</span>
        <b>private static readonly</b> <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <b>bool</b>&gt; <a id="8953fb67ea1b9716" href="../../R/8953fb67ea1b9716.html" target="n" data-glyph="46,1" class="i field">s_allScopeVariables</a> = <b>new</b> <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <b>bool</b>&gt;(1, 16, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <b>internal static void</b> <a id="8e94ede12145f811" href="../../R/8e94ede12145f811.html" target="n" data-glyph="74,1" class="i method">NoteAllScopeVariable</a>(<b>string</b> <span id="r61 rd" class="r61 r">variableName</span>)
        {
            <a href="#8953fb67ea1b9716" class="i field">s_allScopeVariables</a>.<span class="i">GetOrAdd</span>(<span class="r61 r">variableName</span>, <b>true</b>);
        }
 
        <b>internal static bool</b> <a id="b8e10947746fe400" href="../../R/b8e10947746fe400.html" target="n" data-glyph="74,1" class="i method">AnyVariablesCouldBeAllScope</a>(<span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt; <span id="r62 rd" class="r62 r">variableNames</span>)
        {
            <b>return</b> <span class="r62 r">variableNames</span>.<span class="i">Any</span>(<b>static</b> <span id="r63 rd" class="r63 r">keyValuePair</span> =&gt; <a href="#8953fb67ea1b9716" class="i field">s_allScopeVariables</a>.<span class="i">ContainsKey</span>(<span class="r63 r">keyValuePair</span>.<span class="i">Key</span>));
        }
 
        <b>private</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a>&gt; <a id="3777bff8931587aa" href="../../R/3777bff8931587aa.html" target="n" data-glyph="46,1" class="i field">_variables</a>;
        <b>private</b> <a href="#6e3c865f32035987" class="t t">Block</a> <a id="9567e6172537c93b" href="../../R/9567e6172537c93b.html" target="n" data-glyph="46,1" class="i field">_entryBlock</a>;
        <b>private</b> <a href="#6e3c865f32035987" class="t t">Block</a> <a id="a4f296ba8c54f850" href="../../R/a4f296ba8c54f850.html" target="n" data-glyph="46,1" class="i field">_exitBlock</a>;
        <b>private</b> <a href="#6e3c865f32035987" class="t t">Block</a> <a id="7e3862b1a111a110" href="../../R/7e3862b1a111a110.html" target="n" data-glyph="46,1" class="i field">_currentBlock</a>;
        <b>private bool</b> <a id="21ee70dec87d175b" href="../../R/21ee70dec87d175b.html" target="n" data-glyph="46,1" class="i field">_disableOptimizations</a>;
        <b>private readonly</b> <span class="i">List</span>&lt;<a href="#3550e03a09e9cfa4" class="t t">LoopGotoTargets</a>&gt; <a id="729fedf9ed3eac7b" href="../../R/729fedf9ed3eac7b.html" target="n" data-glyph="46,1" class="i field">_loopTargets</a> = <b>new</b> <span class="i">List</span>&lt;<a href="#3550e03a09e9cfa4" class="t t">LoopGotoTargets</a>&gt;();
        <b>private int</b> <a id="8ca463555a0221a1" href="../../R/8ca463555a0221a1.html" target="n" data-glyph="46,1" class="i field">_localsAllocated</a>;
 
        <span class="c">// Used to analyze an expression that is invoked separately, i.e. a default argument.</span>
        <b>internal static</b> <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;&gt; <a id="a502acc6e8971360" href="../../R/a502acc6e8971360.html" target="n" data-glyph="74,1" class="i method">AnalyzeExpression</a>(<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r64 rd" class="r64 r">exprAst</span>)
        {
            <b>return</b> (<b>new</b> <span class="t">VariableAnalysis</span>()).<a href="#2dbb809eacb21f2d" class="i method">AnalyzeImpl</a>(<span class="r64 r">exprAst</span>);
        }
 
        <b>private</b> <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;&gt; <a id="2dbb809eacb21f2d" href="../../R/2dbb809eacb21f2d.html" target="n" data-glyph="76,1" class="i method">AnalyzeImpl</a>(<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r65 rd" class="r65 r">exprAst</span>)
        {
            <a href="#3777bff8931587aa" class="i field">_variables</a> = <a href="#d7ec29bd535482f0" class="t t">FindAllVariablesVisitor</a>.<a href="#9c54ded199222309" class="i method">Visit</a>(<span class="r65 r">exprAst</span>);
 
            <span class="c">// We disable optimizations for expression because it simplifies what we need to do when invoking</span>
            <span class="c">// the default argument, and it&#39;s assumed that the code inside a default argument rarely, if ever, actually creates</span>
            <span class="c">// any local variables.</span>
            <a href="#21ee70dec87d175b" class="i field">_disableOptimizations</a> = <b>true</b>;
            <a href="#ea45a3653b1f3052" class="i method">Init</a>();
 
            <a href="#8ca463555a0221a1" class="i field">_localsAllocated</a> = <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#2e947723b75287da" class="i field">AutomaticVariables</a>.<span class="i">Length</span>;
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <a href="#9567e6172537c93b" class="i field">_entryBlock</a>;
            <span class="r65 r">exprAst</span>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>);
 
            <b>return</b> <a href="#9b8be8f83845143b" class="i method">FinishAnalysis</a>();
        }
 
        <b>internal static</b> <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;&gt; <a id="7aada80719bf6a01" href="../../R/7aada80719bf6a01.html" target="n" data-glyph="74,1" class="i method">AnalyzeTrap</a>(<a href="ast.cs.html#5cedc9c886fbe837" class="t t">TrapStatementAst</a> <span id="r66 rd" class="r66 r">trap</span>)
        {
            <b>return</b> (<b>new</b> <span class="t">VariableAnalysis</span>()).<a href="#c5103e33441bb8a5" class="i method">AnalyzeImpl</a>(<span class="r66 r">trap</span>);
        }
 
        <b>private</b> <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;&gt; <a id="c5103e33441bb8a5" href="../../R/c5103e33441bb8a5.html" target="n" data-glyph="76,1" class="i method">AnalyzeImpl</a>(<a href="ast.cs.html#5cedc9c886fbe837" class="t t">TrapStatementAst</a> <span id="r67 rd" class="r67 r">trap</span>)
        {
            <a href="#3777bff8931587aa" class="i field">_variables</a> = <a href="#d7ec29bd535482f0" class="t t">FindAllVariablesVisitor</a>.<a href="#72e6d8f31b8fa5e3" class="i method">Visit</a>(<span class="r67 r">trap</span>);
 
            <span class="c">// We disable optimizations for trap because it simplifies what we need to do when invoking</span>
            <span class="c">// the trap, and it&#39;s assumed that the code inside a trap rarely, if ever, actually creates</span>
            <span class="c">// any local variables.</span>
            <a href="#21ee70dec87d175b" class="i field">_disableOptimizations</a> = <b>true</b>;
            <a href="#ea45a3653b1f3052" class="i method">Init</a>();
 
            <a href="#8ca463555a0221a1" class="i field">_localsAllocated</a> = <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#2e947723b75287da" class="i field">AutomaticVariables</a>.<span class="i">Length</span>;
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <a href="#9567e6172537c93b" class="i field">_entryBlock</a>;
            <span class="r67 r">trap</span>.<a href="ast.cs.html#f46fffb1c902252d" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>);
 
            <b>return</b> <a href="#9b8be8f83845143b" class="i method">FinishAnalysis</a>();
        }
 
        <b>private void</b> <a id="ea45a3653b1f3052" href="../../R/ea45a3653b1f3052.html" target="n" data-glyph="76,1" class="i method">Init</a>()
        {
            <a href="#9567e6172537c93b" class="i field">_entryBlock</a> = <a href="#6e3c865f32035987" class="t t">Block</a>.<a href="#86297fa23d96e165" class="i method">NewEntryBlock</a>();
            <a href="#a4f296ba8c54f850" class="i field">_exitBlock</a> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
        }
 
        <b>internal static</b> <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;&gt; <a id="386b926f805590e8" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Analyze</a>(<a href="ast.cs.html#063cc8bbea9e10f2" class="t t">IParameterMetadataProvider</a> <span id="r68 rd" class="r68 r">ast</span>, <b>bool</b> <span id="r69 rd" class="r69 r">disableOptimizations</span>, <b>bool</b> <span id="r70 rd" class="r70 r">scriptCmdlet</span>)
        {
            <b>return</b> (<b>new</b> <span class="t">VariableAnalysis</span>()).<a href="#e4eee0be9638b68d" class="i method">AnalyzeImpl</a>(<span class="r68 r">ast</span>, <span class="r69 r">disableOptimizations</span>, <span class="r70 r">scriptCmdlet</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Analyze a member function, marking variable references as &quot;dynamic&quot; (so they can be reported as errors)</span>
        <span class="c">///</span><span class="c"> and also analyze the control flow to make sure every block returns (or throws)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r71 r">ast</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="6ae980febb55feeb" href="../../R/6ae980febb55feeb.html" target="n" data-glyph="74,1" class="i method">AnalyzeMemberFunction</a>(<a href="ast.cs.html#0c4f2db9a681a977" class="t t">FunctionMemberAst</a> <span id="r71 rd" class="r71 r">ast</span>)
        {
            <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a> <span id="r72 rd" class="r72 r">va</span> = (<b>new</b> <span class="t">VariableAnalysis</span>());
            <span class="r72 r">va</span>.<a href="#e4eee0be9638b68d" class="i method">AnalyzeImpl</a>(<span class="r71 r">ast</span>, <b>false</b>, <b>false</b>);
            <b>return</b> <span class="r72 r">va</span>.<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>.<a href="#b60ac8229217d407" class="i field">_predecessors</a>.<span class="i">All</span>(<b>static</b> <span id="r73 rd" class="r73 r">b</span> =&gt; <span class="r73 r">b</span>.<span class="i">_returns</span> || <span class="r73 r">b</span>.<span class="i">_throws</span> || <span class="r73 r">b</span>.<span class="i">_unreachable</span>);
        }
 
        <b>private</b> <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;&gt; <a id="e4eee0be9638b68d" href="../../R/e4eee0be9638b68d.html" target="n" data-glyph="76,1" class="i method">AnalyzeImpl</a>(<a href="ast.cs.html#063cc8bbea9e10f2" class="t t">IParameterMetadataProvider</a> <span id="r74 rd" class="r74 r">ast</span>, <b>bool</b> <span id="r75 rd" class="r75 r">disableOptimizations</span>, <b>bool</b> <span id="r76 rd" class="r76 r">scriptCmdlet</span>)
        {
            <a href="#3777bff8931587aa" class="i field">_variables</a> = <a href="#d7ec29bd535482f0" class="t t">FindAllVariablesVisitor</a>.<a href="#70cb6a4d6e8aff92" class="i method">Visit</a>(<span class="r74 r">ast</span>, <span class="r75 r">disableOptimizations</span>, <span class="r76 r">scriptCmdlet</span>, <b>out</b> <a href="#8ca463555a0221a1" class="i field">_localsAllocated</a>, <b>out</b> <a href="#21ee70dec87d175b" class="i field">_disableOptimizations</a>);
            <a href="#ea45a3653b1f3052" class="i method">Init</a>();
 
            <b>if</b> (<span class="r74 r">ast</span>.<a href="ast.cs.html#57fef4bbca7ab95c" class="i property">Parameters</a> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r77 rd" class="r77 r">parameter</span> <b>in</b> <span class="r74 r">ast</span>.<a href="ast.cs.html#57fef4bbca7ab95c" class="i property">Parameters</a>)
                {
                    <b>var</b> <span id="r78 rd" class="r78 r">variablePath</span> = <span class="r77 r">parameter</span>.<span class="i">Name</span>.<span class="i">VariablePath</span>;
                    <b>if</b> (<span class="r78 r">variablePath</span>.<span class="i">IsAnyLocal</span>())
                    {
                        <b>bool</b> <span id="r79 rd" class="r79 r">anyAttributes</span> = <b>false</b>;
                        <b>int</b> <span id="r80 rd" class="r80 r">countConverts</span> = -1; <span class="c">// First convert is really the parameter type, so it doesn&#39;t count</span>
                        <span class="i">Type</span> <span id="r81 rd" class="r81 r">type</span> = <b>null</b>;
                        <b>bool</b> <span id="r82 rd" class="r82 r">anyUnresolvedTypes</span> = <b>false</b>;
                        <b>foreach</b> (<b>var</b> <span id="r83 rd" class="r83 r">paramAst</span> <b>in</b> <span class="r77 r">parameter</span>.<span class="i">Attributes</span>)
                        {
                            <b>if</b> (<span class="r83 r">paramAst</span> <b>is</b> <a href="ast.cs.html#34b9d5dbbaca964d" class="t t">TypeConstraintAst</a>)
                            {
                                <span class="r80 r">countConverts</span> += 1;
                                <b>if</b> (<span class="r81 r">type</span> == <b>null</b>)
                                {
                                    <span class="r81 r">type</span> = <span class="r83 r">paramAst</span>.<span class="i">TypeName</span>.<span class="i">GetReflectionType</span>();
                                    <b>if</b> (<span class="r81 r">type</span> == <b>null</b>)
                                    {
                                        <span class="r82 r">anyUnresolvedTypes</span> = <b>true</b>;
                                    }
                                }
                            }
                            <b>else</b>
                            {
                                <b>var</b> <span id="r84 rd" class="r84 r">attrType</span> = <span class="r83 r">paramAst</span>.<span class="i">TypeName</span>.<span class="i">GetReflectionAttributeType</span>();
                                <b>if</b> (<span class="r84 r">attrType</span> == <b>null</b>)
                                {
                                    <span class="r82 r">anyUnresolvedTypes</span> = <b>true</b>;
                                }
                                <b>else</b> <b>if</b> (<b>typeof</b>(<a href="../Attributes.cs.html#f182d3d1083583da" class="t t">ValidateArgumentsAttribute</a>).<span class="i">IsAssignableFrom</span>(<span class="r84 r">attrType</span>)
                                    || <b>typeof</b>(<a href="../Attributes.cs.html#80472519ecf33cf1" class="t t">ArgumentTransformationAttribute</a>).<span class="i">IsAssignableFrom</span>(<span class="r84 r">attrType</span>))
                                {
                                    <span class="c">// If there are any attributes that have semantic meaning, we need to use a PSVariable.</span>
                                    <span class="r79 r">anyAttributes</span> = <b>true</b>;
                                }
                            }
                        }
 
                        <b>var</b> <span id="r85 rd" class="r85 r">varName</span> = <span class="i">GetUnaliasedVariableName</span>(<span class="r78 r">variablePath</span>);
                        <b>var</b> <span id="r86 rd" class="r86 r">details</span> = <a href="#3777bff8931587aa" class="i field">_variables</a>[<span class="r85 r">varName</span>];
                        <span class="r86 r">details</span>.<span class="i">Assigned</span> = <b>true</b>;
                        <span class="r81 r">type</span> ??= <span class="r86 r">details</span>.<span class="i">Type</span> ?? <b>typeof</b>(<b>object</b>);
 
                        <span class="c">// automatic and preference variables are pre-allocated, so they can&#39;t be unallocated</span>
                        <span class="c">// and forced to be dynamic.</span>
                        <span class="c">// unresolved types can happen at parse time</span>
                        <span class="c">// [ref] parameters are forced to dynamic so that we can assign $null in the parameter</span>
                        <span class="c">// binder w/o conversions kicking in (the setter in MutableTuple will convert $null to PSReference&lt;Null&gt;</span>
                        <span class="c">// but that won&#39;t happen if we create a PSVariable (this is an ugly hack, but it works.)</span>
                        <b>if</b> ((<span class="r79 r">anyAttributes</span> || <span class="r82 r">anyUnresolvedTypes</span> || <span class="r80 r">countConverts</span> &gt; 0 || <b>typeof</b>(<a href="../MshReference.cs.html#7363a2660b89f253" class="t t">PSReference</a>).<span class="i">IsAssignableFrom</span>(<span class="r81 r">type</span>) || <a href="#713cd341c950b6cb" class="i method">MustBeBoxed</a>(<span class="r81 r">type</span>)) &amp;&amp;
                            !<span class="r86 r">details</span>.<span class="i">Automatic</span> &amp;&amp; !<span class="r86 r">details</span>.<span class="i">PreferenceVariable</span>)
                        {
                            <span class="r86 r">details</span>.<span class="i">LocalTupleIndex</span> = <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
                        }
 
                        <a href="#9567e6172537c93b" class="i field">_entryBlock</a>.<a href="#d7083a5c7371c657" class="i method">AddAst</a>(<b>new</b> <a href="#0df0ca4a02ad5aa2" class="t constructor">AssignmentTarget</a>(<span class="r85 r">varName</span>, <span class="r81 r">type</span>));
                    }
                }
            }
 
            <span class="r74 r">ast</span>.<a href="ast.cs.html#b25d4ae40ae3a393" class="i property">Body</a>.<a href="ast.cs.html#d18edcf2ee519956" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
            <b>return</b> <a href="#9b8be8f83845143b" class="i method">FinishAnalysis</a>(<span class="r76 r">scriptCmdlet</span>);
        }
 
        <b>private</b> <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;&gt; <a id="9b8be8f83845143b" href="../../R/9b8be8f83845143b.html" target="n" data-glyph="76,1" class="i method">FinishAnalysis</a>(<b>bool</b> <span id="r87 rd" class="r87 r">scriptCmdlet</span> = <b>false</b>)
        {
            <b>var</b> <span id="r88 rd" class="r88 r">blocks</span> = <a href="#6e3c865f32035987" class="t t">Block</a>.<a href="#57635106e02f1254" class="i method">GenerateReverseDepthFirstOrder</a>(<a href="#9567e6172537c93b" class="i field">_entryBlock</a>);
 
            <span class="c">// The first block has no predecessors, so analyze outside the loop to &quot;prime&quot; the bitarray.</span>
            <b>var</b> <span id="r89 rd" class="r89 r">bitArray</span> = <b>new</b> <span class="i">BitArray</span>(<a href="#3777bff8931587aa" class="i field">_variables</a>.<span class="i">Count</span>);
            <span class="r88 r">blocks</span>[0].<span class="i">_visitData</span> = <span class="r89 r">bitArray</span>;
            <span class="i">AnalyzeBlock</span>(<span class="r89 r">bitArray</span>, <span class="r88 r">blocks</span>[0]);
 
            <b>for</b> (<b>int</b> <span id="r90 rd" class="r90 r">index</span> = 1; <span class="r90 r">index</span> &lt; <span class="r88 r">blocks</span>.<span class="i">Count</span>; <span class="r90 r">index</span>++)
            {
                <b>var</b> <span id="r91 rd" class="r91 r">block</span> = <span class="r88 r">blocks</span>[<span class="r90 r">index</span>];
 
                <span class="r89 r">bitArray</span> = <b>new</b> <span class="i">BitArray</span>(<a href="#3777bff8931587aa" class="i field">_variables</a>.<span class="i">Count</span>);
                <span class="r89 r">bitArray</span>.<span class="i">SetAll</span>(<b>true</b>);
                <span class="r91 r">block</span>.<span class="i">_visitData</span> = <span class="r89 r">bitArray</span>;
 
                <b>int</b> <span id="r92 rd" class="r92 r">predCount</span> = 0;
                <b>foreach</b> (<b>var</b> <span id="r93 rd" class="r93 r">pred</span> <b>in</b> <span class="r91 r">block</span>.<span class="i">_predecessors</span>)
                {
                    <span class="c">// VisitData can be null when the pred occurs because of a continue statement.</span>
                    <b>if</b> (<span class="r93 r">pred</span>.<span class="i">_visitData</span> != <b>null</b>)
                    {
                        <span class="r92 r">predCount</span> += 1;
                        <span class="r89 r">bitArray</span>.<span class="i">And</span>((<span class="i">BitArray</span>)<span class="r93 r">pred</span>.<span class="i">_visitData</span>);
                    }
                }
 
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r92 r">predCount</span> != 0, <span class="s">&quot;If we didn&#39;t and anything, there is a flaw in the logic and incorrect code may be generated.&quot;</span>);
 
                <span class="i">AnalyzeBlock</span>(<span class="r89 r">bitArray</span>, <span class="r91 r">block</span>);
            }
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>.<a href="#b60ac8229217d407" class="i field">_predecessors</a>.<span class="i">All</span>(<span id="r94 rd" class="r94 r">p</span> =&gt; <span class="r94 r">p</span>.<span class="i">_unreachable</span> || <span class="r94 r">p</span>.<span class="i">_visitData</span> <b>is</b> <span class="i">BitArray</span>), <span class="s">&quot;VisitData wasn&#39;t set on a reachable block&quot;</span>);
 
            <b>foreach</b> (<b>var</b> <span id="r95 rd" class="r95 r">details</span> <b>in</b> <a href="#3777bff8931587aa" class="i field">_variables</a>.<span class="i">Values</span>)
            {
                <b>if</b> (<span class="r95 r">details</span>.<span class="i">LocalTupleIndex</span> == <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r96 rd" class="r96 r">ast</span> <b>in</b> <span class="r95 r">details</span>.<span class="i">AssociatedAsts</span>)
                    {
                        <span class="i">FixTupleIndex</span>(<span class="r96 r">ast</span>, <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>);
                        <span class="i">FixAssigned</span>(<span class="r96 r">ast</span>, <span class="r95 r">details</span>);
                    }
                }
            }
 
            <span class="c">// Automatic variables from &#39;SpecialVariables.AutomaticVariables&#39; usually are pre-allocated,</span>
            <span class="c">// but there could be situations where some of them are forced to be dynamic. We need to count</span>
            <span class="c">// them in when creating tuple slots in such cases to make sure we create enough slots.</span>
            <span class="c">// However, $? is not a real automatic variable from &#39;SpecialVariables.AutomaticVariables&#39;</span>
            <span class="c">// even though it&#39;s marked as so, and thus we need to exclude it.</span>
            <b>var</b> <span id="r97 rd" class="r97 r">orderedLocals</span> = (<b>from</b> <span class="i">details</span> <b>in</b> <a href="#3777bff8931587aa" class="i field">_variables</a>.<span class="i">Values</span>
                                 <b>where</b> (<span class="i">details</span>.<span class="i">LocalTupleIndex</span> &gt;= 0 || (<span class="i">details</span>.<span class="i">LocalTupleIndex</span> == <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a> &amp;&amp;
                                                                         <span class="i">details</span>.<span class="i">Automatic</span> &amp;&amp;
                                                                         <span class="i">details</span>.<span class="i">Name</span> != <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#b6629e76bb57ad85" class="i field">Question</a>))
                                 <b>orderby</b> <span class="i">details</span>.<span class="i">LocalTupleIndex</span>
                                 <b>select</b> <span class="i">details</span>).<span class="i">ToArray</span>();
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(!<a href="#21ee70dec87d175b" class="i field">_disableOptimizations</a>
                || <span class="r97 r">orderedLocals</span>.<span class="i">Length</span> == (<b>int</b>)<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#d64e69972d70be92" class="i field">NumberOfAutomaticVariables</a> +
                        (<span class="r87 r">scriptCmdlet</span> ? <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#9116a45d77f35b10" class="i field">PreferenceVariables</a>.<span class="i">Length</span> : 0),
                <span class="s">&quot;analysis is incorrectly allocating number of locals when optimizations are disabled.&quot;</span>);
 
            <b>var</b> <span id="r98 rd" class="r98 r">nameToIndexMap</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>int</b>&gt;(0, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <b>for</b> (<b>int</b> <span id="r99 rd" class="r99 r">i</span> = 0; <span class="r99 r">i</span> &lt; <span class="r97 r">orderedLocals</span>.<span class="i">Length</span>; ++<span class="r99 r">i</span>)
            {
                <b>var</b> <span id="r100 rd" class="r100 r">details</span> = <span class="r97 r">orderedLocals</span>[<span class="r99 r">i</span>];
                <b>var</b> <span id="r101 rd" class="r101 r">name</span> = <span class="r100 r">details</span>.<span class="i">Name</span>;
                <span class="r98 r">nameToIndexMap</span>.<span class="i">Add</span>(<span class="r101 r">name</span>, <span class="r99 r">i</span>);
 
                <b>if</b> (<span class="r100 r">details</span>.<span class="i">LocalTupleIndex</span> != <span class="r99 r">i</span>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r102 rd" class="r102 r">ast</span> <b>in</b> <span class="r100 r">details</span>.<span class="i">AssociatedAsts</span>)
                    {
                        <span class="i">FixTupleIndex</span>(<span class="r102 r">ast</span>, <span class="r99 r">i</span>);
                    }
                }
                <span class="c">// Automatic variables assign the type directly, not relying on any analysis.  For</span>
                <span class="c">// all other variables, we don&#39;t determine the type of the local until we&#39;re done</span>
                <span class="c">// with the analysis.</span>
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r100 r">details</span>.<span class="i">Type</span> != <b>null</b>, <span class="s">&quot;Type should be resolved already&quot;</span>);
            }
 
            <b>var</b> <span id="r103 rd" class="r103 r">tupleType</span> = <a href="../runtime/MutableTuple.cs.html#d4c692d6a8bac31d" class="t t">MutableTuple</a>.<span class="i">MakeTupleType</span>((<b>from</b> <span class="i">l</span> <b>in</b> <span class="r97 r">orderedLocals</span> <b>select</b> <span class="i">l</span>.<span class="i">Type</span>).<span class="i">ToArray</span>());
            <b>return</b> <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r103 r">tupleType</span>, <span class="r98 r">nameToIndexMap</span>);
        }
 
        <b>private static bool</b> <a id="713cd341c950b6cb" href="../../R/713cd341c950b6cb.html" target="n" data-glyph="76,1" class="i method">MustBeBoxed</a>(<span class="i">Type</span> <span id="r104 rd" class="r104 r">type</span>)
        {
            <span class="c">// We need to box mutable value types so that member operations like</span>
            <span class="c">//     $value.Property = 42</span>
            <span class="c">// We make sure we never allocate an instance of such mutable types in the MutableType.</span>
 
            <b>return</b> (<span class="r104 r">type</span>.<span class="i">IsValueType</span> &amp;&amp; <a href="../runtime/Binding/Binders.cs.html#0cc44259d9b27d72" class="t t">PSVariableAssignmentBinder</a>.<a href="../runtime/Binding/Binders.cs.html#b9a42c6bddbe3a42" class="i method">IsValueTypeMutable</a>(<span class="r104 r">type</span>)) &amp;&amp; <b>typeof</b>(<a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>) != <span class="r104 r">type</span>;
        }
 
        <b>private static void</b> <a id="1bba183f8de0abf1" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FixTupleIndex</a>(<a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r105 rd" class="r105 r">ast</span>, <b>int</b> <span id="r106 rd" class="r106 r">newIndex</span>)
        {
            <a href="ast.cs.html#248562b22b336dec" class="k">var</a> <span id="r107 rd" class="r107 r">variableAst</span> = <span class="r105 r">ast</span> <b>as</b> <a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>;
            <b>if</b> (<span class="r107 r">variableAst</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r107 r">variableAst</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> != <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>)
                {
                    <span class="r107 r">variableAst</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> = <span class="r106 r">newIndex</span>;
                }
            }
            <b>else</b>
            {
                <a href="ast.cs.html#37c175482122764b" class="k">var</a> <span id="r108 rd" class="r108 r">dataStatementAst</span> = <span class="r105 r">ast</span> <b>as</b> <a href="ast.cs.html#37c175482122764b" class="t t">DataStatementAst</a>;
                <b>if</b> (<span class="r108 r">dataStatementAst</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r108 r">dataStatementAst</span>.<a href="ast.cs.html#5f228d7fc0478b96" class="i property">TupleIndex</a> != <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>)
                    {
                        <span class="r108 r">dataStatementAst</span>.<a href="ast.cs.html#5f228d7fc0478b96" class="i property">TupleIndex</a> = <span class="r106 r">newIndex</span>;
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="3acb65bab97b24ea" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FixAssigned</a>(<a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r109 rd" class="r109 r">ast</span>, <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a> <span id="r110 rd" class="r110 r">details</span>)
        {
            <a href="ast.cs.html#248562b22b336dec" class="k">var</a> <span id="r111 rd" class="r111 r">variableAst</span> = <span class="r109 r">ast</span> <b>as</b> <a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>;
            <b>if</b> (<span class="r111 r">variableAst</span> != <b>null</b> &amp;&amp; <span class="r110 r">details</span>.<a href="#941f00f145b378ab" class="i property">Assigned</a>)
            {
                <span class="r111 r">variableAst</span>.<a href="ast.cs.html#b89fc366bed34f46" class="i property">Assigned</a> = <b>true</b>;
            }
        }
 
        <b>private void</b> <a id="89e72e177df32bfa" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AnalyzeBlock</a>(<span class="i">BitArray</span> <span id="r112 rd" class="r112 r">assignedBitArray</span>, <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r113 rd" class="r113 r">block</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r114 rd" class="r114 r">ast</span> <b>in</b> <span class="r113 r">block</span>.<a href="#e2c12091c9df3165" class="i field">_asts</a>)
            {
                <a href="ast.cs.html#248562b22b336dec" class="k">var</a> <span id="r115 rd" class="r115 r">variableExpressionAst</span> = <span class="r114 r">ast</span> <b>as</b> <a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>;
                <b>if</b> (<span class="r115 r">variableExpressionAst</span> != <b>null</b>)
                {
                    <a href="../VariablePath.cs.html#41e5b41974741cc5" class="k">var</a> <span id="r116 rd" class="r116 r">varPath</span> = <span class="r115 r">variableExpressionAst</span>.<a href="ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>;
                    <b>if</b> (<span class="r116 r">varPath</span>.<a href="#e3b11791a094c005" class="i method">IsAnyLocal</a>())
                    {
                        <b>var</b> <span id="r117 rd" class="r117 r">varName</span> = <a href="#9a7a53876a6e7d32" class="i method">GetUnaliasedVariableName</a>(<span class="r116 r">varPath</span>);
                        <b>var</b> <span id="r118 rd" class="r118 r">details</span> = <a href="#3777bff8931587aa" class="i field">_variables</a>[<span class="r117 r">varName</span>];
                        <b>if</b> (<span class="r118 r">details</span>.<span class="i">Automatic</span>)
                        {
                            <span class="r115 r">variableExpressionAst</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> = <span class="r118 r">details</span>.<span class="i">LocalTupleIndex</span>;
                            <span class="r115 r">variableExpressionAst</span>.<a href="ast.cs.html#9290d5785ce9caf6" class="i property">Automatic</a> = <b>true</b>;
                        }
                        <b>else</b>
                        {
                            <span class="r115 r">variableExpressionAst</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> = <span class="r112 r">assignedBitArray</span>[<span class="r118 r">details</span>.<span class="i">BitIndex</span>] &amp;&amp; !<span class="r118 r">details</span>.<span class="i">PreferenceVariable</span>
                                                                   ? <span class="r118 r">details</span>.<span class="i">LocalTupleIndex</span>
                                                                   : <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
                        }
                    }
 
                    <b>continue</b>;
                }
 
                <a href="#445b07963beb5395" class="k">var</a> <span id="r119 rd" class="r119 r">assignmentTarget</span> = <span class="r114 r">ast</span> <b>as</b> <a href="#445b07963beb5395" class="t t">AssignmentTarget</a>;
                <b>if</b> (<span class="r119 r">assignmentTarget</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r119 r">assignmentTarget</span>.<a href="#dbbec484ef9f53f0" class="i field">_targetAst</a> != <b>null</b>)
                    {
                        <a href="#48438454fb1b7f1e" class="i method">CheckLHSAssign</a>(<span class="r119 r">assignmentTarget</span>.<a href="#dbbec484ef9f53f0" class="i field">_targetAst</a>, <span class="r112 r">assignedBitArray</span>);
                    }
                    <b>else</b>
                    {
                        <a href="#80a6d97811066b23" class="i method">CheckLHSAssignVar</a>(<span class="r119 r">assignmentTarget</span>.<a href="#056d29e1846bc590" class="i field">_variableName</a>, <span class="r112 r">assignedBitArray</span>, <span class="r119 r">assignmentTarget</span>.<a href="#63dbfbb14881fc3b" class="i field">_type</a>);
                    }
 
                    <b>continue</b>;
                }
 
                <a href="ast.cs.html#37c175482122764b" class="k">var</a> <span id="r120 rd" class="r120 r">dataStatementAst</span> = <span class="r114 r">ast</span> <b>as</b> <a href="ast.cs.html#37c175482122764b" class="t t">DataStatementAst</a>;
                <b>if</b> (<span class="r120 r">dataStatementAst</span> != <b>null</b>)
                {
                    <a href="#0dc854c4f5ec8516" class="k">var</a> <span id="r121 rd" class="r121 r">details</span> = <span class="i">CheckLHSAssignVar</span>(<span class="r120 r">dataStatementAst</span>.<a href="ast.cs.html#9eb92e727e59a7eb" class="i property">Variable</a>, <span class="r112 r">assignedBitArray</span>, <b>typeof</b>(<b>object</b>));
                    <span class="r120 r">dataStatementAst</span>.<a href="ast.cs.html#5f228d7fc0478b96" class="i property">TupleIndex</a> = <span class="r121 r">details</span>.<a href="#8178c740300cf485" class="i property">LocalTupleIndex</a>;
                    <span class="r121 r">details</span>.<a href="#6931599e5e078643" class="i property">AssociatedAsts</a>.<span class="i">Add</span>(<span class="r120 r">dataStatementAst</span>);
                    <b>continue</b>;
                }
 
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Unexpected type in list of ASTs&quot;</span>);
            }
        }
 
        <b>private void</b> <a id="48438454fb1b7f1e" href="../../R/48438454fb1b7f1e.html" target="n" data-glyph="76,1" class="i method">CheckLHSAssign</a>(<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r122 rd" class="r122 r">lhs</span>, <span class="i">BitArray</span> <span id="r123 rd" class="r123 r">assignedBitArray</span>)
        {
            <a href="ast.cs.html#49daf252fdb62723" class="k">var</a> <span id="r124 rd" class="r124 r">convertExpr</span> = <span class="r122 r">lhs</span> <b>as</b> <a href="ast.cs.html#49daf252fdb62723" class="t t">ConvertExpressionAst</a>;
            <span class="i">Type</span> <span id="r125 rd" class="r125 r">convertType</span> = <b>null</b>;
            <b>if</b> (<span class="r124 r">convertExpr</span> != <b>null</b>)
            {
                <span class="r122 r">lhs</span> = <span class="r124 r">convertExpr</span>.<a href="ast.cs.html#b2353777e73e35be" class="i property">Child</a>;
                <span class="r125 r">convertType</span> = <span class="r124 r">convertExpr</span>.<a href="ast.cs.html#cfcdb8043e5844cc" class="i property">StaticType</a>;
            }
 
            <a href="ast.cs.html#248562b22b336dec" class="k">var</a> <span id="r126 rd" class="r126 r">varExpr</span> = <span class="r122 r">lhs</span> <b>as</b> <a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>;
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r126 r">varExpr</span> != <b>null</b>, <span class="s">&quot;unexpected ast type on lhs&quot;</span>);
 
            <a href="../VariablePath.cs.html#41e5b41974741cc5" class="k">var</a> <span id="r127 rd" class="r127 r">varPath</span> = <span class="r126 r">varExpr</span>.<a href="ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>;
            <b>if</b> (<span class="r127 r">varPath</span>.<a href="#e3b11791a094c005" class="i method">IsAnyLocal</a>())
            {
                <b>var</b> <span id="r128 rd" class="r128 r">varName</span> = <a href="#9a7a53876a6e7d32" class="i method">GetUnaliasedVariableName</a>(<span class="r127 r">varPath</span>);
                <b>if</b> (<span class="r125 r">convertType</span> == <b>null</b> &amp;&amp;
                    (<span class="r128 r">varName</span>.<span class="i">Equals</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#0b26037366c6e99a" class="i field">@foreach</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                     <span class="r128 r">varName</span>.<span class="i">Equals</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#c6964a35f7b6545f" class="i field">@switch</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <span class="c">// $switch/$foreach are normally typed as IEnumerator, but if the values are directly</span>
                    <span class="c">// assigned (as opposed to implicitly assigned which goes directly to CheckLHSAssignVar),</span>
                    <span class="c">// then force the type to object.</span>
                    <span class="r125 r">convertType</span> = <b>typeof</b>(<b>object</b>);
                }
 
                <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a> <span id="r129 rd" class="r129 r">analysisDetails</span> = <a href="#80a6d97811066b23" class="i method">CheckLHSAssignVar</a>(<span class="r128 r">varName</span>, <span class="r123 r">assignedBitArray</span>, <span class="r125 r">convertType</span>);
 
                <span class="r129 r">analysisDetails</span>.<a href="#6931599e5e078643" class="i property">AssociatedAsts</a>.<span class="i">Add</span>(<span class="r126 r">varExpr</span>);
                <span class="r129 r">analysisDetails</span>.<a href="#941f00f145b378ab" class="i property">Assigned</a> = <b>true</b>;
                <span class="r126 r">varExpr</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> = <span class="r129 r">analysisDetails</span>.<a href="#8178c740300cf485" class="i property">LocalTupleIndex</a>;
                <span class="r126 r">varExpr</span>.<a href="ast.cs.html#9290d5785ce9caf6" class="i property">Automatic</a> = <span class="r129 r">analysisDetails</span>.<a href="#0ab6ca914ad3b25f" class="i property">Automatic</a>;
            }
            <b>else</b>
            {
                <span class="r126 r">varExpr</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> = <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
            }
        }
 
        <b>private</b> <a href="#0dc854c4f5ec8516" class="t t">VariableAnalysisDetails</a> <a id="80a6d97811066b23" href="../../R/80a6d97811066b23.html" target="n" data-glyph="76,1" class="i method">CheckLHSAssignVar</a>(<b>string</b> <span id="r130 rd" class="r130 r">variableName</span>, <span class="i">BitArray</span> <span id="r131 rd" class="r131 r">assignedBitArray</span>, <span class="i">Type</span> <span id="r132 rd" class="r132 r">convertType</span>)
        {
            <b>var</b> <span id="r133 rd" class="r133 r">analysisDetails</span> = <a href="#3777bff8931587aa" class="i field">_variables</a>[<span class="r130 r">variableName</span>];
            <b>if</b> (<span class="r133 r">analysisDetails</span>.<span class="i">LocalTupleIndex</span> == <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>)
            {
                <span class="r133 r">analysisDetails</span>.<span class="i">LocalTupleIndex</span> = <a href="#21ee70dec87d175b" class="i field">_disableOptimizations</a> || <a href="#8953fb67ea1b9716" class="i field">s_allScopeVariables</a>.<span class="i">ContainsKey</span>(<span class="r130 r">variableName</span>)
                                                      ? <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>
                                                      : <a href="#8ca463555a0221a1" class="i field">_localsAllocated</a>++;
            }
 
            <b>if</b> (<span class="r132 r">convertType</span> != <b>null</b> &amp;&amp; <a href="#713cd341c950b6cb" class="i method">MustBeBoxed</a>(<span class="r132 r">convertType</span>))
            {
                <span class="r133 r">analysisDetails</span>.<span class="i">LocalTupleIndex</span> = <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
            }
 
            <b>var</b> <span id="r134 rd" class="r134 r">type</span> = <span class="r133 r">analysisDetails</span>.<span class="i">Type</span>;
            <b>if</b> (<span class="r134 r">type</span> == <b>null</b>)
            {
                <span class="r133 r">analysisDetails</span>.<span class="i">Type</span> = <span class="r132 r">convertType</span> ?? <b>typeof</b>(<b>object</b>);
            }
            <b>else</b>
            {
                <b>if</b> (!<span class="r131 r">assignedBitArray</span>[<span class="r133 r">analysisDetails</span>.<span class="i">BitIndex</span>] &amp;&amp; <span class="r132 r">convertType</span> == <b>null</b>)
                {
                    <span class="c">// The variable has not been assigned in the current flow control path, but has been on some other</span>
                    <span class="c">// path (because the type was already assigned.)  Make sure they are compatible by forcing a type comparison.</span>
                    <span class="r132 r">convertType</span> = <b>typeof</b>(<b>object</b>);
                }
 
                <b>if</b> (<span class="r132 r">convertType</span> != <b>null</b> &amp;&amp; !<span class="r132 r">convertType</span>.<span class="i">Equals</span>(<span class="r134 r">type</span>))
                {
                    <b>if</b> (<span class="r133 r">analysisDetails</span>.<span class="i">Automatic</span> || <span class="r133 r">analysisDetails</span>.<span class="i">PreferenceVariable</span>)
                    {
                        <span class="c">// Can&#39;t be dynamic, but we were optimistic that we could strongly type the automatic</span>
                        <span class="c">// and it turns out we can&#39;t.</span>
                        <span class="r133 r">analysisDetails</span>.<span class="i">Type</span> = <b>typeof</b>(<b>object</b>);
                    }
                    <b>else</b>
                    {
                        <span class="r133 r">analysisDetails</span>.<span class="i">LocalTupleIndex</span> = <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
                    }
                }
            }
 
            <span class="r131 r">assignedBitArray</span>.<span class="i">Set</span>(<span class="r133 r">analysisDetails</span>.<span class="i">BitIndex</span>, <b>true</b>);
 
            <b>return</b> <span class="r133 r">analysisDetails</span>;
        }
 
        <b>public object</b> <a id="cc5993d59fc0d957" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitErrorStatement</a>(<a href="ast.cs.html#e02a155b7afded8b" class="t t">ErrorStatementAst</a> <span id="r135 rd" class="r135 r">errorStatementAst</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="22213dfaf0e4f088" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitErrorExpression</a>(<a href="ast.cs.html#bdf2b3276843e0c2" class="t t">ErrorExpressionAst</a> <span id="r136 rd" class="r136 r">errorExpressionAst</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="b20df5da13bc7531" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitScriptBlock</a>(<a href="ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a> <span id="r137 rd" class="r137 r">scriptBlockAst</span>)
        {
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <a href="#9567e6172537c93b" class="i field">_entryBlock</a>;
 
            <b>if</b> (<span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#4549d1761658a004" class="i property">DynamicParamBlock</a> != <b>null</b>)
            {
                <span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#4549d1761658a004" class="i property">DynamicParamBlock</a>.<a href="ast.cs.html#86c7adf75f108f3e" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#08794a618a2d04ac" class="i property">BeginBlock</a> != <b>null</b>)
            {
                <span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#08794a618a2d04ac" class="i property">BeginBlock</a>.<a href="ast.cs.html#86c7adf75f108f3e" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#8940fb8f9b3e6444" class="i property">ProcessBlock</a> != <b>null</b>)
            {
                <span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#8940fb8f9b3e6444" class="i property">ProcessBlock</a>.<a href="ast.cs.html#86c7adf75f108f3e" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#958e631868900aba" class="i property">EndBlock</a> != <b>null</b>)
            {
                <span class="r137 r">scriptBlockAst</span>.<a href="ast.cs.html#958e631868900aba" class="i property">EndBlock</a>.<a href="ast.cs.html#86c7adf75f108f3e" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>);
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="91c5cfc0dc6ad548" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitParamBlock</a>(<a href="ast.cs.html#be95362bdc5e7d07" class="t t">ParamBlockAst</a> <span id="r138 rd" class="r138 r">paramBlockAst</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="f940e94a5d5dedb3" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitNamedBlock</a>(<a href="ast.cs.html#61c97c02c53bf32d" class="t t">NamedBlockAst</a> <span id="r139 rd" class="r139 r">namedBlockAst</span>)
        {
            <span class="c">// Don&#39;t visit traps - they get their own scope</span>
            <b>return</b> <a href="#85cb399167f40e58" class="i method">VisitStatementBlock</a>(<span class="r139 r">namedBlockAst</span>.<a href="ast.cs.html#496f71fcd5c4e6a1" class="i property">Statements</a>);
        }
 
        <b>public object</b> <a id="ba72598c2fb5c102" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitTypeConstraint</a>(<a href="ast.cs.html#34b9d5dbbaca964d" class="t t">TypeConstraintAst</a> <span id="r140 rd" class="r140 r">typeConstraintAst</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Code is unreachable&quot;</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="0d7cce9a0c47694a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitAttribute</a>(<a href="ast.cs.html#f576d1d6cbb736a0" class="t t">AttributeAst</a> <span id="r141 rd" class="r141 r">attributeAst</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Code is unreachable&quot;</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="cc9280ba4e8ce8fc" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitNamedAttributeArgument</a>(<a href="ast.cs.html#283d46191e6456a4" class="t t">NamedAttributeArgumentAst</a> <span id="r142 rd" class="r142 r">namedAttributeArgumentAst</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Code is unreachable&quot;</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="7ff4234c0d2ee15a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitParameter</a>(<a href="ast.cs.html#bf2a2797225b11b5" class="t t">ParameterAst</a> <span id="r143 rd" class="r143 r">parameterAst</span>)
        {
            <span class="c">// Nothing to do now, we&#39;ve already allocated parameters in the first pass looking for all variable naems.</span>
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Code is unreachable&quot;</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="a97dc2251ca59695" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitFunctionDefinition</a>(<a href="ast.cs.html#dd61b2a7b388405b" class="t t">FunctionDefinitionAst</a> <span id="r144 rd" class="r144 r">functionDefinitionAst</span>)
        {
            <span class="c">// Don&#39;t recurse into the function definition, it&#39;s variables are distinct from the script block</span>
            <span class="c">// we&#39;re currently analyzing.</span>
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="13aecc10f2e1e968" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitStatementBlock</a>(<a href="ast.cs.html#268644c84b225866" class="t t">StatementBlockAst</a> <span id="r145 rd" class="r145 r">statementBlockAst</span>)
        {
            <span class="c">// Don&#39;t visit traps - they get their own scope</span>
            <b>return</b> <a href="#85cb399167f40e58" class="i method">VisitStatementBlock</a>(<span class="r145 r">statementBlockAst</span>.<a href="ast.cs.html#2d53956b12d128eb" class="i property">Statements</a>);
        }
 
        <b>private object</b> <a id="85cb399167f40e58" href="../../R/85cb399167f40e58.html" target="n" data-glyph="76,1" class="i method">VisitStatementBlock</a>(<span class="i">ReadOnlyCollection</span>&lt;<a href="ast.cs.html#9c25dfdd7f4807b0" class="t t">StatementAst</a>&gt; <span id="r146 rd" class="r146 r">statements</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r147 rd" class="r147 r">stmt</span> <b>in</b> <span class="r146 r">statements</span>)
            {
                <span class="r147 r">stmt</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="50763b699b59b505" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitIfStatement</a>(<a href="ast.cs.html#5371982d66a6137d" class="t t">IfStatementAst</a> <span id="r148 rd" class="r148 r">ifStmtAst</span>)
        {
            <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r149 rd" class="r149 r">afterStmt</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <b>if</b> (<span class="r148 r">ifStmtAst</span>.<a href="ast.cs.html#6cff2184cfb69977" class="i property">ElseClause</a> == <b>null</b>)
            {
                <span class="c">// There is no else, flow can go straight to afterStmt.</span>
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r149 r">afterStmt</span>);
            }
 
            <b>int</b> <span id="r150 rd" class="r150 r">clauseCount</span> = <span class="r148 r">ifStmtAst</span>.<a href="ast.cs.html#7467cf9a24b469f1" class="i property">Clauses</a>.<span class="i">Count</span>;
            <b>for</b> (<b>int</b> <span id="r151 rd" class="r151 r">i</span> = 0; <span class="r151 r">i</span> &lt; <span class="r150 r">clauseCount</span>; <span class="r151 r">i</span>++)
            {
                <b>var</b> <span id="r152 rd" class="r152 r">clause</span> = <span class="r148 r">ifStmtAst</span>.<a href="ast.cs.html#7467cf9a24b469f1" class="i property">Clauses</a>[<span class="r151 r">i</span>];
                <b>bool</b> <span id="r153 rd" class="r153 r">isLastClause</span> = (<span class="r151 r">i</span> == (<span class="r150 r">clauseCount</span> - 1) &amp;&amp; <span class="r148 r">ifStmtAst</span>.<a href="ast.cs.html#6cff2184cfb69977" class="i property">ElseClause</a> == <b>null</b>);
                <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r154 rd" class="r154 r">clauseBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
                <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r155 rd" class="r155 r">nextBlock</span> = <span class="r153 r">isLastClause</span> ? <span class="r149 r">afterStmt</span> : <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
                <span class="r152 r">clause</span>.<span class="i">Item1</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r154 r">clauseBlock</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r155 r">nextBlock</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r154 r">clauseBlock</span>;
 
                <span class="r152 r">clause</span>.<span class="i">Item2</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r149 r">afterStmt</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r155 r">nextBlock</span>;
            }
 
            <b>if</b> (<span class="r148 r">ifStmtAst</span>.<a href="ast.cs.html#6cff2184cfb69977" class="i property">ElseClause</a> != <b>null</b>)
            {
                <span class="r148 r">ifStmtAst</span>.<a href="ast.cs.html#6cff2184cfb69977" class="i property">ElseClause</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r149 r">afterStmt</span>);
            }
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r149 r">afterStmt</span>;
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="6614fa2b45c3c4ab" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitTernaryExpression</a>(<a href="ast.cs.html#75320d2e9ca587ab" class="t t">TernaryExpressionAst</a> <span id="r156 rd" class="r156 r">ternaryExpressionAst</span>)
        {
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r157 rd" class="r157 r">ifTrue</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r158 rd" class="r158 r">ifFalse</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r159 rd" class="r159 r">after</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <span class="r156 r">ternaryExpressionAst</span>.<a href="ast.cs.html#8fe864cc3d568de7" class="i property">Condition</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r157 r">ifTrue</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r158 r">ifFalse</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r157 r">ifTrue</span>;
 
            <span class="r156 r">ternaryExpressionAst</span>.<a href="ast.cs.html#c679b2d23aba3af3" class="i property">IfTrue</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r159 r">after</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r158 r">ifFalse</span>;
 
            <span class="r156 r">ternaryExpressionAst</span>.<a href="ast.cs.html#6aa8ec2dcb9934c3" class="i property">IfFalse</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r159 r">after</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r159 r">after</span>;
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="2948703c3d5aeb8e" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitTrap</a>(<a href="ast.cs.html#5cedc9c886fbe837" class="t t">TrapStatementAst</a> <span id="r160 rd" class="r160 r">trapStatementAst</span>)
        {
            <span class="r160 r">trapStatementAst</span>.<a href="ast.cs.html#f46fffb1c902252d" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="56ee559cf3d46c70" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitSwitchStatement</a>(<a href="ast.cs.html#4d96f6c979a5266e" class="t t">SwitchStatementAst</a> <span id="r161 rd" class="r161 r">switchStatementAst</span>)
        {
            <b>var</b> <span id="r162 rd" class="r162 r">details</span> = <a href="#3777bff8931587aa" class="i field">_variables</a>[<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#c6964a35f7b6545f" class="i field">@switch</a>];
            <b>if</b> (<span class="r162 r">details</span>.<span class="i">LocalTupleIndex</span> == <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a> &amp;&amp; !<a href="#21ee70dec87d175b" class="i field">_disableOptimizations</a>)
            {
                <span class="r162 r">details</span>.<span class="i">LocalTupleIndex</span> = <a href="#8ca463555a0221a1" class="i field">_localsAllocated</a>++;
            }
 
            <span class="i">Action</span> <span id="r163 rd" class="r163 r">generateCondition</span> = () =&gt;
            {
                <span class="r161 r">switchStatementAst</span>.<a href="ast.cs.html#933ad75377815bca" class="i property">Condition</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                <span class="c">// $switch is set after evaluating the condition.</span>
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#d7083a5c7371c657" class="i method">AddAst</a>(<b>new</b> <span class="t">AssignmentTarget</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#c6964a35f7b6545f" class="i field">@switch</a>, <b>typeof</b>(<span class="i">IEnumerator</span>)));
            };
 
            <span class="i">Action</span> <span id="r164 rd" class="r164 r">switchBodyGenerator</span> = () =&gt;
            {
                <b>bool</b> <span id="r165 rd" class="r165 r">hasDefault</span> = (<span class="r161 r">switchStatementAst</span>.<a href="ast.cs.html#c977933db5bdc245" class="i property">Default</a> != <b>null</b>);
                <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r166 rd" class="r166 r">afterStmt</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
                <b>int</b> <span id="r167 rd" class="r167 r">clauseCount</span> = <span class="r161 r">switchStatementAst</span>.<a href="ast.cs.html#297d524de4c5c69a" class="i property">Clauses</a>.<span class="i">Count</span>;
                <b>for</b> (<b>int</b> <span id="r168 rd" class="r168 r">i</span> = 0; <span class="r168 r">i</span> &lt; <span class="r167 r">clauseCount</span>; <span class="r168 r">i</span>++)
                {
                    <b>var</b> <span id="r169 rd" class="r169 r">clause</span> = <span class="r161 r">switchStatementAst</span>.<a href="ast.cs.html#297d524de4c5c69a" class="i property">Clauses</a>[<span class="r168 r">i</span>];
                    <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r170 rd" class="r170 r">clauseBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
                    <b>bool</b> <span id="r171 rd" class="r171 r">isLastClause</span> = (<span class="r168 r">i</span> == (<span class="r167 r">clauseCount</span> - 1) &amp;&amp; !<span class="r165 r">hasDefault</span>);
                    <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r172 rd" class="r172 r">nextBlock</span> = <span class="r171 r">isLastClause</span> ? <span class="r166 r">afterStmt</span> : <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
                    <span class="r169 r">clause</span>.<span class="i">Item1</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                    <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r172 r">nextBlock</span>);
                    <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r170 r">clauseBlock</span>);
                    <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r170 r">clauseBlock</span>;
 
                    <span class="r169 r">clause</span>.<span class="i">Item2</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                    <b>if</b> (!<span class="r171 r">isLastClause</span>)
                    {
                        <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r172 r">nextBlock</span>);
                        <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r172 r">nextBlock</span>;
                    }
                }
 
                <b>if</b> (<span class="r165 r">hasDefault</span>)
                {
                    <span class="c">// If any clause was executed, we skip the default, so there is always a branch over the default.</span>
                    <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r166 r">afterStmt</span>);
                    <span class="r161 r">switchStatementAst</span>.<a href="ast.cs.html#c977933db5bdc245" class="i property">Default</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
                }
 
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r166 r">afterStmt</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r166 r">afterStmt</span>;
            };
 
            <a href="#b5ae313999c5803f" class="i method">GenerateWhileLoop</a>(<span class="r161 r">switchStatementAst</span>.<a href="ast.cs.html#6e78c18e515b91da" class="i property">Label</a>, <span class="r163 r">generateCondition</span>, <span class="r164 r">switchBodyGenerator</span>);
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="da50b0fbaedf0951" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitDataStatement</a>(<a href="ast.cs.html#37c175482122764b" class="t t">DataStatementAst</a> <span id="r173 rd" class="r173 r">dataStatementAst</span>)
        {
            <span class="r173 r">dataStatementAst</span>.<a href="ast.cs.html#75dab9efd3d1b59e" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>if</b> (<span class="r173 r">dataStatementAst</span>.<a href="ast.cs.html#9eb92e727e59a7eb" class="i property">Variable</a> != <b>null</b>)
            {
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#d7083a5c7371c657" class="i method">AddAst</a>(<span class="r173 r">dataStatementAst</span>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private void</b> <a id="b5ae313999c5803f" href="../../R/b5ae313999c5803f.html" target="n" data-glyph="76,1" class="i method">GenerateWhileLoop</a>(<b>string</b> <span id="r174 rd" class="r174 r">loopLabel</span>,
                                       <span class="i">Action</span> <span id="r175 rd" class="r175 r">generateCondition</span>,
                                       <span class="i">Action</span> <span id="r176 rd" class="r176 r">generateLoopBody</span>,
                                       <a href="ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r177 rd" class="r177 r">continueAction</span> = <b>null</b>)
        {
            <span class="c">// We model the flow graph like this (if continueAction is null, the first part is slightly different):</span>
            <span class="c">//    goto L</span>
            <span class="c">//    :ContinueTarget</span>
            <span class="c">//        continueAction</span>
            <span class="c">//    :L</span>
            <span class="c">//    if (condition)</span>
            <span class="c">//    {</span>
            <span class="c">//        loop body</span>
            <span class="c">//        // break -&gt; goto BreakTarget</span>
            <span class="c">//        // continue -&gt; goto ContinueTarget</span>
            <span class="c">//        goto ContinueTarget</span>
            <span class="c">//    }</span>
            <span class="c">//    :BreakTarget</span>
 
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r178 rd" class="r178 r">continueBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <b>if</b> (<span class="r177 r">continueAction</span> != <b>null</b>)
            {
                <a href="#6e3c865f32035987" class="k">var</a> <span id="r179 rd" class="r179 r">blockAfterContinue</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
                <span class="c">// Represent the goto over the condition before the first iteration.</span>
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r179 r">blockAfterContinue</span>);
 
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r178 r">continueBlock</span>;
                <span class="r177 r">continueAction</span>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r179 r">blockAfterContinue</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r179 r">blockAfterContinue</span>;
            }
            <b>else</b>
            {
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r178 r">continueBlock</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r178 r">continueBlock</span>;
            }
 
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r180 rd" class="r180 r">bodyBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r181 rd" class="r181 r">breakBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <span class="c">// Condition can be null from an uncommon for loop: for() {}</span>
 
            <b>if</b> (<span class="r175 r">generateCondition</span> != <b>null</b>)
            {
                <span class="r175 r">generateCondition</span>();
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r181 r">breakBlock</span>);
            }
 
            <a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Add</span>(<b>new</b> <span class="t">LoopGotoTargets</span>(<span class="r174 r">loopLabel</span> ?? <b>string</b>.<span class="i">Empty</span>, <span class="r181 r">breakBlock</span>, <span class="r178 r">continueBlock</span>));
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r180 r">bodyBlock</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r180 r">bodyBlock</span>;
            <span class="r176 r">generateLoopBody</span>();
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r178 r">continueBlock</span>);
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r181 r">breakBlock</span>;
 
            <a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">RemoveAt</span>(<a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Count</span> - 1);
        }
 
        <b>private void</b> <a id="669fa435fd680abf" href="../../R/669fa435fd680abf.html" target="n" data-glyph="76,1" class="i method">GenerateDoLoop</a>(<a href="ast.cs.html#931b3c793b175596" class="t t">LoopStatementAst</a> <span id="r182 rd" class="r182 r">loopStatement</span>)
        {
            <span class="c">// We model the flow graph like this:</span>
            <span class="c">//    :RepeatTarget</span>
            <span class="c">//       loop body</span>
            <span class="c">//       // break -&gt; goto BreakTarget</span>
            <span class="c">//       // continue -&gt; goto ContinueTarget</span>
            <span class="c">//    :ContinueTarget</span>
            <span class="c">//    if (condition)</span>
            <span class="c">//    {</span>
            <span class="c">//        goto RepeatTarget</span>
            <span class="c">//    }</span>
            <span class="c">//    :BreakTarget</span>
 
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r183 rd" class="r183 r">continueBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r184 rd" class="r184 r">bodyBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r185 rd" class="r185 r">breakBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r186 rd" class="r186 r">gotoRepeatTargetBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Add</span>(<b>new</b> <span class="t">LoopGotoTargets</span>(<span class="r182 r">loopStatement</span>.<a href="ast.cs.html#6e78c18e515b91da" class="i property">Label</a> ?? <b>string</b>.<span class="i">Empty</span>, <span class="r185 r">breakBlock</span>, <span class="r183 r">continueBlock</span>));
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r184 r">bodyBlock</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r184 r">bodyBlock</span>;
 
            <span class="r182 r">loopStatement</span>.<a href="ast.cs.html#246ea985df627fa9" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r183 r">continueBlock</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r183 r">continueBlock</span>;
 
            <span class="r182 r">loopStatement</span>.<a href="ast.cs.html#933ad75377815bca" class="i property">Condition</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r185 r">breakBlock</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r186 r">gotoRepeatTargetBlock</span>);
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r186 r">gotoRepeatTargetBlock</span>;
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r184 r">bodyBlock</span>);
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r185 r">breakBlock</span>;
 
            <a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">RemoveAt</span>(<a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Count</span> - 1);
        }
 
        <b>public object</b> <a id="6e44999843409370" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitForEachStatement</a>(<a href="ast.cs.html#9ae6aa2909fef7b0" class="t t">ForEachStatementAst</a> <span id="r187 rd" class="r187 r">forEachStatementAst</span>)
        {
            <b>var</b> <span id="r188 rd" class="r188 r">foreachDetails</span> = <a href="#3777bff8931587aa" class="i field">_variables</a>[<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#0b26037366c6e99a" class="i field">@foreach</a>];
            <b>if</b> (<span class="r188 r">foreachDetails</span>.<span class="i">LocalTupleIndex</span> == <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a> &amp;&amp; !<a href="#21ee70dec87d175b" class="i field">_disableOptimizations</a>)
            {
                <span class="r188 r">foreachDetails</span>.<span class="i">LocalTupleIndex</span> = <a href="#8ca463555a0221a1" class="i field">_localsAllocated</a>++;
            }
 
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r189 rd" class="r189 r">afterFor</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <span class="i">Action</span> <span id="r190 rd" class="r190 r">generateCondition</span> = () =&gt;
            {
                <span class="r187 r">forEachStatementAst</span>.<a href="ast.cs.html#933ad75377815bca" class="i property">Condition</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                <span class="c">// The loop might not be executed, so add flow around the loop.</span>
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r189 r">afterFor</span>);
 
                <span class="c">// $foreach and the iterator variable are set after evaluating the condition.</span>
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#d7083a5c7371c657" class="i method">AddAst</a>(<b>new</b> <span class="t">AssignmentTarget</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#0b26037366c6e99a" class="i field">@foreach</a>, <b>typeof</b>(<span class="i">IEnumerator</span>)));
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#d7083a5c7371c657" class="i method">AddAst</a>(<b>new</b> <a href="#c55d03475438905e" class="t constructor">AssignmentTarget</a>(<span class="r187 r">forEachStatementAst</span>.<a href="ast.cs.html#913a1ea5efca1400" class="i property">Variable</a>));
            };
 
            <span class="i">GenerateWhileLoop</span>(<span class="r187 r">forEachStatementAst</span>.<a href="ast.cs.html#6e78c18e515b91da" class="i property">Label</a>, <span class="r190 r">generateCondition</span>, () =&gt; <span class="r187 r">forEachStatementAst</span>.<a href="ast.cs.html#246ea985df627fa9" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>));
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r189 r">afterFor</span>);
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r189 r">afterFor</span>;
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="2013c076de3cb9c6" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitDoWhileStatement</a>(<a href="ast.cs.html#b2d1fe560ff56deb" class="t t">DoWhileStatementAst</a> <span id="r191 rd" class="r191 r">doWhileStatementAst</span>)
        {
            <a href="#669fa435fd680abf" class="i method">GenerateDoLoop</a>(<span class="r191 r">doWhileStatementAst</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="3a3a5236c850051d" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitDoUntilStatement</a>(<a href="ast.cs.html#d641b5faf306abeb" class="t t">DoUntilStatementAst</a> <span id="r192 rd" class="r192 r">doUntilStatementAst</span>)
        {
            <a href="#669fa435fd680abf" class="i method">GenerateDoLoop</a>(<span class="r192 r">doUntilStatementAst</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="96d8c4804e91da84" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitForStatement</a>(<a href="ast.cs.html#4ca51f16f7c100d4" class="t t">ForStatementAst</a> <span id="r193 rd" class="r193 r">forStatementAst</span>)
        {
            <b>if</b> (<span class="r193 r">forStatementAst</span>.<a href="ast.cs.html#942ba53dacb0f05a" class="i property">Initializer</a> != <b>null</b>)
            {
                <span class="r193 r">forStatementAst</span>.<a href="ast.cs.html#942ba53dacb0f05a" class="i property">Initializer</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>var</b> <span id="r194 rd" class="r194 r">generateCondition</span> = <span class="r193 r">forStatementAst</span>.<a href="ast.cs.html#933ad75377815bca" class="i property">Condition</a> != <b>null</b>
                ? () =&gt; <span class="r193 r">forStatementAst</span>.<a href="ast.cs.html#933ad75377815bca" class="i property">Condition</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>)
                : (<span class="i">Action</span>)<b>null</b>;
 
            <span class="i">GenerateWhileLoop</span>(<span class="r193 r">forStatementAst</span>.<a href="ast.cs.html#6e78c18e515b91da" class="i property">Label</a>, <span class="r194 r">generateCondition</span>, () =&gt; <span class="r193 r">forStatementAst</span>.<a href="ast.cs.html#246ea985df627fa9" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>),
                              <span class="r193 r">forStatementAst</span>.<a href="ast.cs.html#48de440e240c2649" class="i property">Iterator</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="4f59aa0d83539d96" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitWhileStatement</a>(<a href="ast.cs.html#4e9a52b62ed8b2b1" class="t t">WhileStatementAst</a> <span id="r195 rd" class="r195 r">whileStatementAst</span>)
        {
            <span class="i">GenerateWhileLoop</span>(<span class="r195 r">whileStatementAst</span>.<a href="ast.cs.html#6e78c18e515b91da" class="i property">Label</a>,
                              () =&gt; <span class="r195 r">whileStatementAst</span>.<a href="ast.cs.html#933ad75377815bca" class="i property">Condition</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>),
                              () =&gt; <span class="r195 r">whileStatementAst</span>.<a href="ast.cs.html#246ea985df627fa9" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>));
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="4e4f567760db3464" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitCatchClause</a>(<a href="ast.cs.html#fafbccc59f688c0e" class="t t">CatchClauseAst</a> <span id="r196 rd" class="r196 r">catchClauseAst</span>)
        {
            <span class="r196 r">catchClauseAst</span>.<a href="ast.cs.html#efd5374afedb9514" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="7f32dcdff69af2fe" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitTryStatement</a>(<a href="ast.cs.html#9827b5d12d62be7f" class="t t">TryStatementAst</a> <span id="r197 rd" class="r197 r">tryStatementAst</span>)
        {
            <span class="c">// We don&#39;t attempt to accurately model flow in a try catch because every statement</span>
            <span class="c">// can flow to each catch.  Instead, we&#39;ll assume the try block is not executed (because the very first statement</span>
            <span class="c">// may throw), and have the data flow assume the block before the try is all that can reach the catches and finally.</span>
 
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r198 rd" class="r198 r">blockBeforeTry</span> = <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>;
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <span class="r198 r">blockBeforeTry</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#7e3862b1a111a110" class="i field">_currentBlock</a>);
 
            <span class="r197 r">tryStatementAst</span>.<a href="ast.cs.html#591cd17e760ea038" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
            <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r199 rd" class="r199 r">lastBlockInTry</span> = <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>;
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r200 rd" class="r200 r">finallyFirstBlock</span> = <span class="r197 r">tryStatementAst</span>.<a href="ast.cs.html#56a1309fed36b070" class="i property">Finally</a> == <b>null</b> ? <b>null</b> : <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
            <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r201 rd" class="r201 r">finallyLastBlock</span> = <b>null</b>;
 
            <span class="c">// This is the first block after all the catches and finally (if present).</span>
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r202 rd" class="r202 r">afterTry</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <b>bool</b> <span id="r203 rd" class="r203 r">isCatchAllPresent</span> = <b>false</b>;
 
            <b>foreach</b> (<b>var</b> <span id="r204 rd" class="r204 r">catchAst</span> <b>in</b> <span class="r197 r">tryStatementAst</span>.<a href="ast.cs.html#29d08ecdd9ce8b5a" class="i property">CatchClauses</a>)
            {
                <b>if</b> (<span class="r204 r">catchAst</span>.<span class="i">IsCatchAll</span>)
                {
                    <span class="r203 r">isCatchAllPresent</span> = <b>true</b>;
                }
 
                <span class="c">// Any statement in the try block could throw and reach the catch, so assume the worst (from a data</span>
                <span class="c">// flow perspective) and make the predecessor to the catch the block before entering the try.</span>
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
                <span class="r198 r">blockBeforeTry</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#7e3862b1a111a110" class="i field">_currentBlock</a>);
                <span class="r204 r">catchAst</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r200 r">finallyFirstBlock</span> ?? <span class="r202 r">afterTry</span>);
            }
 
            <b>if</b> (<span class="r200 r">finallyFirstBlock</span> != <b>null</b>)
            {
                <span class="r199 r">lastBlockInTry</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r200 r">finallyFirstBlock</span>);
 
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r200 r">finallyFirstBlock</span>;
                <span class="r197 r">tryStatementAst</span>.<a href="ast.cs.html#56a1309fed36b070" class="i property">Finally</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r202 r">afterTry</span>);
 
                <span class="r201 r">finallyLastBlock</span> = <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>;
 
                <span class="c">// For finally block, there are 2 cases: when try-body throw and when it doesn&#39;t.</span>
                <span class="c">// For these two cases value of &#39;finallyLastBlock._throws&#39; would be different.</span>
                <b>if</b> (!<span class="r203 r">isCatchAllPresent</span>)
                {
                    <span class="c">// This flow exist only, if there is no catch for all exceptions.</span>
                    <span class="r198 r">blockBeforeTry</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r200 r">finallyFirstBlock</span>);
 
                    <a href="#6e3c865f32035987" class="k">var</a> <span id="r205 rd" class="r205 r">rethrowAfterFinallyBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
                    <span class="r201 r">finallyLastBlock</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r205 r">rethrowAfterFinallyBlock</span>);
                    <span class="r205 r">rethrowAfterFinallyBlock</span>.<a href="#30b9171ef5e4ac3d" class="i field">_throws</a> = <b>true</b>;
                    <span class="r205 r">rethrowAfterFinallyBlock</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>);
                }
 
                <span class="c">// This flow always exists.</span>
                <span class="r201 r">finallyLastBlock</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r202 r">afterTry</span>);
            }
            <b>else</b>
            {
                <span class="r199 r">lastBlockInTry</span>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r202 r">afterTry</span>);
            }
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r202 r">afterTry</span>;
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private void</b> <a id="1b3b473b6d9cc3d0" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BreakOrContinue</a>(<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r206 rd" class="r206 r">label</span>, <span class="i">Func</span>&lt;<a href="#3550e03a09e9cfa4" class="t t">LoopGotoTargets</a>, <a href="#6e3c865f32035987" class="t t">Block</a>&gt; <span id="r207 rd" class="r207 r">fieldSelector</span>)
        {
            <a href="#6e3c865f32035987" class="t t">Block</a> <span id="r208 rd" class="r208 r">targetBlock</span> = <b>null</b>;
            <b>if</b> (<span class="r206 r">label</span> != <b>null</b>)
            {
                <span class="r206 r">label</span>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
                <b>if</b> (<a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="ast.cs.html#e18e1bad255cd022" class="k">var</a> <span id="r209 rd" class="r209 r">labelStrAst</span> = <span class="r206 r">label</span> <b>as</b> <a href="ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a>;
                    <b>if</b> (<span class="r209 r">labelStrAst</span> != <b>null</b>)
                    {
                        <span class="r208 r">targetBlock</span> = (<b>from</b> <span class="i">t</span> <b>in</b> <a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>
                                       <b>where</b> <span class="i">t</span>.<span class="i">Label</span>.<span class="i">Equals</span>(<span class="r209 r">labelStrAst</span>.<a href="ast.cs.html#a6dc72732a1c7e0d" class="i property">Value</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                                       <b>select</b> <span class="r207 r">fieldSelector</span>(<span class="i">t</span>)).<span class="i">LastOrDefault</span>();
                    }
                }
            }
            <b>else</b> <b>if</b> (<a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r208 r">targetBlock</span> = <span class="r207 r">fieldSelector</span>(<a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Last</span>());
            }
 
            <b>if</b> (<span class="r208 r">targetBlock</span> == <b>null</b>)
            {
                <span class="c">// We need to report an error about bad break statement here</span>
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#30b9171ef5e4ac3d" class="i field">_throws</a> = <b>true</b>;
            }
            <b>else</b>
            {
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r208 r">targetBlock</span>);
            }
 
            <span class="c">// The next block is unreachable, but is necessary to keep the flow graph correct.</span>
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
        }
 
        <b>public object</b> <a id="17f30146db7408bf" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitBreakStatement</a>(<a href="ast.cs.html#410610c8cad1e99b" class="t t">BreakStatementAst</a> <span id="r210 rd" class="r210 r">breakStatementAst</span>)
        {
            <span class="i">BreakOrContinue</span>(<span class="r210 r">breakStatementAst</span>.<a href="ast.cs.html#d09d51ee2cd8ffec" class="i property">Label</a>, <b>static</b> <span id="r211 rd" class="r211 r">t</span> =&gt; <span class="r211 r">t</span>.<span class="i">BreakTarget</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="9eb24ec159b5f98f" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitContinueStatement</a>(<a href="ast.cs.html#f8a733d027117fbc" class="t t">ContinueStatementAst</a> <span id="r212 rd" class="r212 r">continueStatementAst</span>)
        {
            <span class="i">BreakOrContinue</span>(<span class="r212 r">continueStatementAst</span>.<a href="ast.cs.html#2085acb39f31fba8" class="i property">Label</a>, <b>static</b> <span id="r213 rd" class="r213 r">t</span> =&gt; <span class="r213 r">t</span>.<span class="i">ContinueTarget</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>private</b> <a href="#6e3c865f32035987" class="t t">Block</a> <a id="66081c75737755a5" href="../../R/66081c75737755a5.html" target="n" data-glyph="76,1" class="i method">ControlFlowStatement</a>(<a href="ast.cs.html#86812479028959b8" class="t t">PipelineBaseAst</a> <span id="r214 rd" class="r214 r">pipelineAst</span>)
        {
            <b>if</b> (<span class="r214 r">pipelineAst</span> != <b>null</b>)
            {
                <span class="r214 r">pipelineAst</span>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<a href="#a4f296ba8c54f850" class="i field">_exitBlock</a>);
            <a href="#6e3c865f32035987" class="k">var</a> <span id="r215 rd" class="r215 r">lastBlockInStatement</span> = <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>;
 
            <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
 
            <b>return</b> <span class="r215 r">lastBlockInStatement</span>;
        }
 
        <b>public object</b> <a id="c999ae8835724ced" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitReturnStatement</a>(<a href="ast.cs.html#ba60713bd71ce457" class="t t">ReturnStatementAst</a> <span id="r216 rd" class="r216 r">returnStatementAst</span>)
        {
            <a href="#66081c75737755a5" class="i method">ControlFlowStatement</a>(<span class="r216 r">returnStatementAst</span>.<a href="ast.cs.html#5b77ce523f7a0a91" class="i property">Pipeline</a>).<a href="#6aafa57a64bb366a" class="i field">_returns</a> = <b>true</b>;
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="0da4caf10da4c9c0" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitExitStatement</a>(<a href="ast.cs.html#c410ad4dd51f9687" class="t t">ExitStatementAst</a> <span id="r217 rd" class="r217 r">exitStatementAst</span>)
        {
            <a href="#66081c75737755a5" class="i method">ControlFlowStatement</a>(<span class="r217 r">exitStatementAst</span>.<a href="ast.cs.html#5677dd38c48037f7" class="i property">Pipeline</a>).<a href="#30b9171ef5e4ac3d" class="i field">_throws</a> = <b>true</b>;
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="eb6332823b2acad6" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitThrowStatement</a>(<a href="ast.cs.html#07e9c4f5bce4153b" class="t t">ThrowStatementAst</a> <span id="r218 rd" class="r218 r">throwStatementAst</span>)
        {
            <span class="c">// Even if we are in try-catch, we still can safely assume that flow can go to exit from here.</span>
            <span class="c">// Additional exit point would not affect correctness of analysis: we handle throwing of any statement inside try-body in VisitTryStatement.</span>
            <a href="#66081c75737755a5" class="i method">ControlFlowStatement</a>(<span class="r218 r">throwStatementAst</span>.<a href="ast.cs.html#4e6ffefc40942042" class="i property">Pipeline</a>).<a href="#30b9171ef5e4ac3d" class="i field">_throws</a> = <b>true</b>;
            <b>return</b> <b>null</b>;
        }
 
        <b>private static</b> <span class="i">IEnumerable</span>&lt;<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a>&gt; <a id="cfcb3fedfcd29a55" href="../../R/cfcb3fedfcd29a55.html" target="n" data-glyph="76,1" class="i method">GetAssignmentTargets</a>(<a href="ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a> <span id="r219 rd" class="r219 r">expressionAst</span>)
        {
            <a href="ast.cs.html#a9797c05604b61e8" class="k">var</a> <span id="r220 rd" class="r220 r">parenExpr</span> = <span class="r219 r">expressionAst</span> <b>as</b> <a href="ast.cs.html#a9797c05604b61e8" class="t t">ParenExpressionAst</a>;
            <b>if</b> (<span class="r220 r">parenExpr</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r221 rd" class="r221 r">e</span> <b>in</b> <a href="#cfcb3fedfcd29a55" class="i method">GetAssignmentTargets</a>(<span class="r220 r">parenExpr</span>.<a href="ast.cs.html#021e323175cb804d" class="i property">Pipeline</a>.<a href="ast.cs.html#158661f5f6c8db6d" class="i method">GetPureExpression</a>()))
                {
                    <b>yield</b> <b>return</b> <span class="r221 r">e</span>;
                }
            }
            <b>else</b>
            {
                <a href="ast.cs.html#0e44bc9125134006" class="k">var</a> <span id="r222 rd" class="r222 r">arrayLiteral</span> = <span class="r219 r">expressionAst</span> <b>as</b> <a href="ast.cs.html#0e44bc9125134006" class="t t">ArrayLiteralAst</a>;
                <b>if</b> (<span class="r222 r">arrayLiteral</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r223 rd" class="r223 r">e</span> <b>in</b> <span class="r222 r">arrayLiteral</span>.<a href="ast.cs.html#1b2cdef74794d8b9" class="i property">Elements</a>.<span class="i">SelectMany</span>(<span class="i">GetAssignmentTargets</span>))
                    {
                        <b>yield</b> <b>return</b> <span class="r223 r">e</span>;
                    }
                }
                <b>else</b>
                {
                    <b>yield</b> <b>return</b> <span class="r219 r">expressionAst</span>;
                }
            }
        }
 
        <b>public object</b> <a id="06501b2f7e29de59" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitAssignmentStatement</a>(<a href="ast.cs.html#da5f345864f42e06" class="t t">AssignmentStatementAst</a> <span id="r224 rd" class="r224 r">assignmentStatementAst</span>)
        {
            <span class="r224 r">assignmentStatementAst</span>.<a href="ast.cs.html#ca8f4cbe093f3036" class="i property">Right</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
            <b>foreach</b> (<b>var</b> <span id="r225 rd" class="r225 r">assignTarget</span> <b>in</b> <a href="#cfcb3fedfcd29a55" class="i method">GetAssignmentTargets</a>(<span class="r224 r">assignmentStatementAst</span>.<a href="ast.cs.html#737e87d58bda06dc" class="i property">Left</a>))
            {
                <b>bool</b> <span id="r226 rd" class="r226 r">anyAttributes</span> = <b>false</b>;
                <b>int</b> <span id="r227 rd" class="r227 r">convertCount</span> = 0;
                <a href="ast.cs.html#49daf252fdb62723" class="t t">ConvertExpressionAst</a> <span id="r228 rd" class="r228 r">convertAst</span> = <b>null</b>;
                <b>var</b> <span id="r229 rd" class="r229 r">leftAst</span> = <span class="r225 r">assignTarget</span>;
                <b>while</b> (<span class="r229 r">leftAst</span> <b>is</b> <a href="ast.cs.html#434eb922ec6ac95b" class="t t">AttributedExpressionAst</a>)
                {
                    <span class="r227 r">convertCount</span> += 1;
                    <span class="r228 r">convertAst</span> = <span class="r229 r">leftAst</span> <b>as</b> <a href="ast.cs.html#49daf252fdb62723" class="t t">ConvertExpressionAst</a>;
                    <b>if</b> (<span class="r228 r">convertAst</span> == <b>null</b>)
                    {
                        <span class="r226 r">anyAttributes</span> = <b>true</b>;
                    }
 
                    <span class="r229 r">leftAst</span> = ((<a href="ast.cs.html#434eb922ec6ac95b" class="t t">AttributedExpressionAst</a>)<span class="r229 r">leftAst</span>).<a href="ast.cs.html#b2353777e73e35be" class="i property">Child</a>;
                }
 
                <b>if</b> (<span class="r229 r">leftAst</span> <b>is</b> <a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>)
                {
                    <span class="c">// Two below if statements are similar, but there is a difference:</span>
                    <span class="c">// The first one tells us about the dynamic nature of the local type.</span>
                    <span class="c">// The second one tells us about the assignment, that happens in this block.</span>
                    <span class="c">// Potentially there could be more complicated cases like [int[]]($a, $b) = (1,2)</span>
                    <span class="c">// We don&#39;t handle them at all in the variable analysis.</span>
 
                    <b>if</b> (<span class="r226 r">anyAttributes</span> || <span class="r227 r">convertCount</span> &gt; 1 ||
                        (<span class="r228 r">convertAst</span> != <b>null</b> &amp;&amp; <span class="r228 r">convertAst</span>.<a href="ast.cs.html#ecb5959c230c5865" class="i property">Type</a>.<a href="ast.cs.html#eae1f2f74db44d11" class="i property">TypeName</a>.<a href="ast.cs.html#eba83ef9fd0feedd" class="i method">GetReflectionType</a>() == <b>null</b>))
                    {
                        <a href="../VariablePath.cs.html#41e5b41974741cc5" class="k">var</a> <span id="r230 rd" class="r230 r">varPath</span> = ((<a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>)<span class="r229 r">leftAst</span>).<a href="ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>;
                        <b>if</b> (<span class="r230 r">varPath</span>.<a href="#e3b11791a094c005" class="i method">IsAnyLocal</a>())
                        {
                            <b>var</b> <span id="r231 rd" class="r231 r">details</span> = <a href="#3777bff8931587aa" class="i field">_variables</a>[<a href="#9a7a53876a6e7d32" class="i method">GetUnaliasedVariableName</a>(<span class="r230 r">varPath</span>)];
                            <span class="r231 r">details</span>.<span class="i">LocalTupleIndex</span> = <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
                        }
                    }
 
                    <b>if</b> (!<span class="r226 r">anyAttributes</span> &amp;&amp; <span class="r227 r">convertCount</span> &lt;= 1)
                    {
                        <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#d7083a5c7371c657" class="i method">AddAst</a>(<b>new</b> <span class="t">AssignmentTarget</span>(<span class="r225 r">assignTarget</span>));
                    }
                }
                <b>else</b>
                {
                    <span class="c">// We&#39;re not assigning to a simple variable, so visit the left so that variable references get</span>
                    <span class="c">// marked with their proper tuple slots.</span>
                    <span class="r225 r">assignTarget</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="406ea1f2905ca7a3" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitPipeline</a>(<a href="ast.cs.html#785915ec8547ce9f" class="t t">PipelineAst</a> <span id="r232 rd" class="r232 r">pipelineAst</span>)
        {
            <b>bool</b> <span id="r233 rd" class="r233 r">invokesCommand</span> = <b>false</b>;
            <b>foreach</b> (<b>var</b> <span id="r234 rd" class="r234 r">command</span> <b>in</b> <span class="r232 r">pipelineAst</span>.<a href="ast.cs.html#edccd333bf2ee4d5" class="i property">PipelineElements</a>)
            {
                <span class="r234 r">command</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
                <b>if</b> (<span class="r234 r">command</span> <b>is</b> <a href="ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a>)
                {
                    <span class="r233 r">invokesCommand</span> = <b>true</b>;
                }
 
                <b>foreach</b> (<b>var</b> <span id="r235 rd" class="r235 r">redir</span> <b>in</b> <span class="r234 r">command</span>.<span class="i">Redirections</span>)
                {
                    <span class="r235 r">redir</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
                }
            }
 
            <span class="c">// Because non-local gotos are supported, we must model them in the flow graph.  We can&#39;t detect them</span>
            <span class="c">// in general, so we must be pessimistic and assume any command invocation could result in non-local</span>
            <span class="c">// break or continue, so add the appropriate edges to our graph.  These edges occur after visiting</span>
            <span class="c">// the command elements because command arguments could create new blocks, and we won&#39;t have executed</span>
            <span class="c">// the command yet.</span>
            <b>if</b> (<span class="r233 r">invokesCommand</span> &amp;&amp; <a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>.<span class="i">Count</span> &gt; 0)
            {
                <b>foreach</b> (<b>var</b> <span id="r236 rd" class="r236 r">loopTarget</span> <b>in</b> <a href="#729fedf9ed3eac7b" class="i field">_loopTargets</a>)
                {
                    <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<span class="i">FlowsTo</span>(<span class="r236 r">loopTarget</span>.<span class="i">BreakTarget</span>);
                    <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<span class="i">FlowsTo</span>(<span class="r236 r">loopTarget</span>.<span class="i">ContinueTarget</span>);
                }
 
                <span class="c">// The rest of the block is potentially unreachable, so split the current block.</span>
                <a href="#6e3c865f32035987" class="k">var</a> <span id="r237 rd" class="r237 r">newBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r237 r">newBlock</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r237 r">newBlock</span>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="4955651d01e948ec" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitCommand</a>(<a href="ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a> <span id="r238 rd" class="r238 r">commandAst</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r239 rd" class="r239 r">element</span> <b>in</b> <span class="r238 r">commandAst</span>.<a href="ast.cs.html#f3fdfe686fb0ef19" class="i property">CommandElements</a>)
            {
                <span class="r239 r">element</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="4c018de9bd26b65f" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitCommandExpression</a>(<a href="ast.cs.html#f4da818a29387c5d" class="t t">CommandExpressionAst</a> <span id="r240 rd" class="r240 r">commandExpressionAst</span>)
        {
            <span class="r240 r">commandExpressionAst</span>.<a href="ast.cs.html#5e5388d1f86139f7" class="i property">Expression</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="871eb0dfa014573b" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitCommandParameter</a>(<a href="ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a> <span id="r241 rd" class="r241 r">commandParameterAst</span>)
        {
            <b>if</b> (<span class="r241 r">commandParameterAst</span>.<a href="ast.cs.html#21fa828caf096206" class="i property">Argument</a> != <b>null</b>)
            {
                <span class="r241 r">commandParameterAst</span>.<a href="ast.cs.html#21fa828caf096206" class="i property">Argument</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="d21ce5b50e372e2c" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitFileRedirection</a>(<a href="ast.cs.html#2288e8fa779a0d57" class="t t">FileRedirectionAst</a> <span id="r242 rd" class="r242 r">fileRedirectionAst</span>)
        {
            <span class="r242 r">fileRedirectionAst</span>.<a href="ast.cs.html#387c7bd2fd1d9d89" class="i property">Location</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="79d9dcc3f8aea1ce" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitMergingRedirection</a>(<a href="ast.cs.html#57ad2a29a39e91e6" class="t t">MergingRedirectionAst</a> <span id="r243 rd" class="r243 r">mergingRedirectionAst</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="d829367942895ac9" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitBinaryExpression</a>(<a href="ast.cs.html#f3e3848ef2eae593" class="t t">BinaryExpressionAst</a> <span id="r244 rd" class="r244 r">binaryExpressionAst</span>)
        {
            <b>if</b> (<span class="r244 r">binaryExpressionAst</span>.<a href="ast.cs.html#d9e9940dedef2ba7" class="i property">Operator</a> == <a href="token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="token.cs.html#14e331a4180e8cfa" class="i field">And</a> || <span class="r244 r">binaryExpressionAst</span>.<a href="ast.cs.html#d9e9940dedef2ba7" class="i property">Operator</a> == <a href="token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="token.cs.html#eacefffd17e34bf2" class="i field">Or</a>)
            {
                <span class="c">// Logical and/or are short circuit operators, so we need to simulate the control flow.  The</span>
                <span class="c">// left operand is always evaluated, visit it&#39;s expression in the current block.</span>
                <span class="r244 r">binaryExpressionAst</span>.<a href="ast.cs.html#e19b481693ff50d7" class="i property">Left</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                <span class="c">// The right operand is conditionally evaluated.  We aren&#39;t generating any code here, just</span>
                <span class="c">// modeling the flow graph, so we just visit the right operand in a new block, and have</span>
                <span class="c">// both the current and new blocks flow to a post-expression block.</span>
                <a href="#6e3c865f32035987" class="k">var</a> <span id="r245 rd" class="r245 r">targetBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
                <a href="#6e3c865f32035987" class="k">var</a> <span id="r246 rd" class="r246 r">nextBlock</span> = <b>new</b> <a href="#49ae3d220ba7b908" class="t constructor">Block</a>();
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r245 r">targetBlock</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r246 r">nextBlock</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r246 r">nextBlock</span>;
 
                <span class="r244 r">binaryExpressionAst</span>.<a href="ast.cs.html#c43edc792b1ee433" class="i property">Right</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
 
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#71d700731a5cf16e" class="i method">FlowsTo</a>(<span class="r245 r">targetBlock</span>);
                <a href="#7e3862b1a111a110" class="i field">_currentBlock</a> = <span class="r245 r">targetBlock</span>;
            }
            <b>else</b>
            {
                <span class="r244 r">binaryExpressionAst</span>.<a href="ast.cs.html#e19b481693ff50d7" class="i property">Left</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
                <span class="r244 r">binaryExpressionAst</span>.<a href="ast.cs.html#c43edc792b1ee433" class="i property">Right</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="83b50beeecf059eb" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitUnaryExpression</a>(<a href="ast.cs.html#ee62c8a99269d267" class="t t">UnaryExpressionAst</a> <span id="r247 rd" class="r247 r">unaryExpressionAst</span>)
        {
            <span class="r247 r">unaryExpressionAst</span>.<a href="ast.cs.html#ca72754d5d4d5410" class="i property">Child</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="ed5349ea52053e23" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitConvertExpression</a>(<a href="ast.cs.html#49daf252fdb62723" class="t t">ConvertExpressionAst</a> <span id="r248 rd" class="r248 r">convertExpressionAst</span>)
        {
            <span class="r248 r">convertExpressionAst</span>.<a href="ast.cs.html#b2353777e73e35be" class="i property">Child</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="5ab34f2aa0cf2b2b" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitConstantExpression</a>(<a href="ast.cs.html#ebd8ad798cde7861" class="t t">ConstantExpressionAst</a> <span id="r249 rd" class="r249 r">constantExpressionAst</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="b45faa21387b4312" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitStringConstantExpression</a>(<a href="ast.cs.html#e18e1bad255cd022" class="t t">StringConstantExpressionAst</a> <span id="r250 rd" class="r250 r">stringConstantExpressionAst</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="1a1929e700e46d84" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitSubExpression</a>(<a href="ast.cs.html#e6552a77ab32112a" class="t t">SubExpressionAst</a> <span id="r251 rd" class="r251 r">subExpressionAst</span>)
        {
            <span class="r251 r">subExpressionAst</span>.<a href="ast.cs.html#ec0bda1def565114" class="i property">SubExpression</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="d3c469a59bcb5cd2" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitUsingExpression</a>(<a href="ast.cs.html#42d36b88817a807f" class="t t">UsingExpressionAst</a> <span id="r252 rd" class="r252 r">usingExpressionAst</span>)
        {
            <span class="c">// The SubExpression is not visited, we treat this expression like it is a constant that is replaced</span>
            <span class="c">// before the script block is executed</span>
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="fd052d8b5388a2a3" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitVariableExpression</a>(<a href="ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a> <span id="r253 rd" class="r253 r">variableExpressionAst</span>)
        {
            <a href="../VariablePath.cs.html#41e5b41974741cc5" class="k">var</a> <span id="r254 rd" class="r254 r">varPath</span> = <span class="r253 r">variableExpressionAst</span>.<a href="ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>;
            <b>if</b> (<span class="r254 r">varPath</span>.<a href="#e3b11791a094c005" class="i method">IsAnyLocal</a>())
            {
                <b>var</b> <span id="r255 rd" class="r255 r">details</span> = <a href="#3777bff8931587aa" class="i field">_variables</a>[<a href="#9a7a53876a6e7d32" class="i method">GetUnaliasedVariableName</a>(<span class="r254 r">varPath</span>)];
 
                <span class="c">// If the variable has already been allocated, we don&#39;t need to visit it again later.</span>
                <b>if</b> (<span class="r255 r">details</span>.<span class="i">LocalTupleIndex</span> != <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#6aefafdf223b7beb" class="i field">Unanalyzed</a>)
                {
                    <span class="r253 r">variableExpressionAst</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> = <span class="r255 r">details</span>.<span class="i">PreferenceVariable</span> ? <a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a> : <span class="r255 r">details</span>.<span class="i">LocalTupleIndex</span>;
                    <span class="r253 r">variableExpressionAst</span>.<a href="ast.cs.html#9290d5785ce9caf6" class="i property">Automatic</a> = <span class="r255 r">details</span>.<span class="i">Automatic</span>;
                }
                <b>else</b>
                {
                    <span class="c">// Save the variable reference in the current block so it can be marked later with</span>
                    <span class="c">// the allocated tuple index if the variable is assigned in all paths to this reference.</span>
                    <a href="#7e3862b1a111a110" class="i field">_currentBlock</a>.<a href="#d7083a5c7371c657" class="i method">AddAst</a>(<span class="r253 r">variableExpressionAst</span>);
                }
 
                <span class="c">// Either way - if we later discover an inconsistency and need to force this reference to be dynamic,</span>
                <span class="c">// keep track of the ast so that it is possible.</span>
                <span class="r255 r">details</span>.<span class="i">AssociatedAsts</span>.<span class="i">Add</span>(<span class="r253 r">variableExpressionAst</span>);
            }
            <b>else</b>
            {
                <span class="r253 r">variableExpressionAst</span>.<a href="ast.cs.html#d2fd06bce4ae1ac6" class="i property">TupleIndex</a> = <a href="#3d310869db3a3b73" class="t t">VariableAnalysis</a>.<a href="#1df8fb0284c85f3f" class="i field">ForceDynamic</a>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="d8431fc2ca273954" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitTypeExpression</a>(<a href="ast.cs.html#bf258955590d49b7" class="t t">TypeExpressionAst</a> <span id="r256 rd" class="r256 r">typeExpressionAst</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="a32d97445fc452be" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitMemberExpression</a>(<a href="ast.cs.html#a3e8bc64452a67d0" class="t t">MemberExpressionAst</a> <span id="r257 rd" class="r257 r">memberExpressionAst</span>)
        {
            <span class="r257 r">memberExpressionAst</span>.<a href="ast.cs.html#22340c1f7f19ecba" class="i property">Expression</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <span class="r257 r">memberExpressionAst</span>.<a href="ast.cs.html#2c25418a24e5cfa1" class="i property">Member</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="242c9a2f61ee85fc" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitInvokeMemberExpression</a>(<a href="ast.cs.html#be11dcb1e53f56b8" class="t t">InvokeMemberExpressionAst</a> <span id="r258 rd" class="r258 r">invokeMemberExpressionAst</span>)
        {
            <span class="r258 r">invokeMemberExpressionAst</span>.<a href="ast.cs.html#22340c1f7f19ecba" class="i property">Expression</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <span class="r258 r">invokeMemberExpressionAst</span>.<a href="ast.cs.html#2c25418a24e5cfa1" class="i property">Member</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>if</b> (<span class="r258 r">invokeMemberExpressionAst</span>.<a href="ast.cs.html#0f1554608efc28f3" class="i property">Arguments</a> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r259 rd" class="r259 r">arg</span> <b>in</b> <span class="r258 r">invokeMemberExpressionAst</span>.<a href="ast.cs.html#0f1554608efc28f3" class="i property">Arguments</a>)
                {
                    <span class="r259 r">arg</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="774315b5e7a2cf64" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitArrayExpression</a>(<a href="ast.cs.html#6bb067a9fcfafabf" class="t t">ArrayExpressionAst</a> <span id="r260 rd" class="r260 r">arrayExpressionAst</span>)
        {
            <span class="r260 r">arrayExpressionAst</span>.<a href="ast.cs.html#ccfc39397cd3e8e5" class="i property">SubExpression</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="6411b4944aa4b325" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitArrayLiteral</a>(<a href="ast.cs.html#0e44bc9125134006" class="t t">ArrayLiteralAst</a> <span id="r261 rd" class="r261 r">arrayLiteralAst</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r262 rd" class="r262 r">element</span> <b>in</b> <span class="r261 r">arrayLiteralAst</span>.<a href="ast.cs.html#1b2cdef74794d8b9" class="i property">Elements</a>)
            {
                <span class="r262 r">element</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="ee0ac483c2546e2c" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitHashtable</a>(<a href="ast.cs.html#fd6e450f68cfd52b" class="t t">HashtableAst</a> <span id="r263 rd" class="r263 r">hashtableAst</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r264 rd" class="r264 r">pair</span> <b>in</b> <span class="r263 r">hashtableAst</span>.<a href="ast.cs.html#87313f35bc2b66d9" class="i property">KeyValuePairs</a>)
            {
                <span class="r264 r">pair</span>.<span class="i">Item1</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
                <span class="r264 r">pair</span>.<span class="i">Item2</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="f1ac3813d65f8e60" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitScriptBlockExpression</a>(<a href="ast.cs.html#5ec0737db546f4f5" class="t t">ScriptBlockExpressionAst</a> <span id="r265 rd" class="r265 r">scriptBlockExpressionAst</span>)
        {
            <span class="c">// Don&#39;t recurse into the script block, it&#39;s variables are distinct from the script block</span>
            <span class="c">// we&#39;re currently analyzing.</span>
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="a28ec9ad5bafffbc" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitParenExpression</a>(<a href="ast.cs.html#a9797c05604b61e8" class="t t">ParenExpressionAst</a> <span id="r266 rd" class="r266 r">parenExpressionAst</span>)
        {
            <span class="r266 r">parenExpressionAst</span>.<a href="ast.cs.html#021e323175cb804d" class="i property">Pipeline</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="2af14fd134e094a9" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitExpandableStringExpression</a>(<a href="ast.cs.html#dac25e1530bb8b85" class="t t">ExpandableStringExpressionAst</a> <span id="r267 rd" class="r267 r">expandableStringExpressionAst</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r268 rd" class="r268 r">expr</span> <b>in</b> <span class="r267 r">expandableStringExpressionAst</span>.<a href="ast.cs.html#7a52821c53f08528" class="i property">NestedExpressions</a>)
            {
                <span class="r268 r">expr</span>.<span class="i">Accept</span>(<a href="#3d310869db3a3b73" class="k">this</a>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="80abd95fb3d9bd84" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitIndexExpression</a>(<a href="ast.cs.html#4587e325068530ec" class="t t">IndexExpressionAst</a> <span id="r269 rd" class="r269 r">indexExpressionAst</span>)
        {
            <span class="r269 r">indexExpressionAst</span>.<a href="ast.cs.html#4340a50f115f7fdd" class="i property">Target</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <span class="r269 r">indexExpressionAst</span>.<a href="ast.cs.html#2e5c6ad17318d78c" class="i property">Index</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="f739c39a127e6804" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitAttributedExpression</a>(<a href="ast.cs.html#434eb922ec6ac95b" class="t t">AttributedExpressionAst</a> <span id="r270 rd" class="r270 r">attributedExpressionAst</span>)
        {
            <span class="r270 r">attributedExpressionAst</span>.<a href="ast.cs.html#b2353777e73e35be" class="i property">Child</a>.<a href="ast.cs.html#71efa3501b9475f2" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="3e1a6f1962a514a2" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitBlockStatement</a>(<a href="ast.cs.html#0a993ec4b360d318" class="t t">BlockStatementAst</a> <span id="r271 rd" class="r271 r">blockStatementAst</span>)
        {
            <span class="r271 r">blockStatementAst</span>.<a href="ast.cs.html#13f21b494b2d40ba" class="i property">Body</a>.<a href="ast.cs.html#320e0abd734f9b5f" class="i method">Accept</a>(<a href="#3d310869db3a3b73" class="k">this</a>);
            <b>return</b> <b>null</b>;
        }
 
        <b>public object</b> <a id="e2ebab729b575b38" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitTypeDefinition</a>(<a href="ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r272 rd" class="r272 r">typeDefinitionAst</span>) =&gt; <b>null</b>;
 
        <b>public object</b> <a id="b03c78d06ad8a1ae" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitPropertyMember</a>(<a href="ast.cs.html#88ad8abafd061e97" class="t t">PropertyMemberAst</a> <span id="r273 rd" class="r273 r">propertyMemberAst</span>) =&gt; <b>null</b>;
 
        <b>public object</b> <a id="fc023e2323ca8f46" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitFunctionMember</a>(<a href="ast.cs.html#0c4f2db9a681a977" class="t t">FunctionMemberAst</a> <span id="r274 rd" class="r274 r">functionMemberAst</span>) =&gt; <b>null</b>;
 
        <b>public object</b> <a id="4e21c2b0c4cfa0f8" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitBaseCtorInvokeMemberExpression</a>(<a href="ast.cs.html#93dc2e4429de8e4e" class="t t">BaseCtorInvokeMemberExpressionAst</a> <span id="r275 rd" class="r275 r">baseCtorInvokeMemberExpressionAst</span>) =&gt; <b>null</b>;
 
        <b>public object</b> <a id="460d0cc4f0ad204a" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitUsingStatement</a>(<a href="ast.cs.html#a269e1753cbc4c90" class="t t">UsingStatementAst</a> <span id="r276 rd" class="r276 r">usingStatement</span>) =&gt; <b>null</b>;
 
        <b>public object</b> <a id="2f05ad0cace04492" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitConfigurationDefinition</a>(<a href="ast.cs.html#d0b13bd03366725b" class="t t">ConfigurationDefinitionAst</a> <span id="r277 rd" class="r277 r">configurationDefinitionAst</span>) =&gt; <b>null</b>;
 
        <b>public object</b> <a id="51adade0013c7796" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">VisitDynamicKeywordStatement</a>(<a href="ast.cs.html#2c7580ec5eda8932" class="t t">DynamicKeywordStatementAst</a> <span id="r278 rd" class="r278 r">dynamicKeywordAst</span>) =&gt; <b>null</b>;
    }
}
</pre></td></tr></table></div></body></html>
