<!DOCTYPE html>
<html><head><title>MiscOps.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(3535);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/runtime/Operations/MiscOps.cs" target="_top">engine\runtime\Operations\MiscOps.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Specialized</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<span class="i n">Internal</span>.<span class="i n">Format</span>;
 
<span class="c">// ReSharper disable UnusedMember.Global</span>
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <b>internal static class</b> <a id="533f892ba25eaa2f" href="../../../R/533f892ba25eaa2f.html" target="n" data-glyph="2,0" class="t t">PipelineOps</a>
    {
        <b>private static</b> <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="31714ae20113b57b" href="../../../R/31714ae20113b57b.html" target="n" data-glyph="76,1" class="i method">AddCommand</a>(<a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r0 rd" class="r0 r">pipe</span>,
                                                       <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>[] <span id="r1 rd" class="r1 r">commandElements</span>,
                                                       <a href="../../parser/ast.cs.html#dd8dd8a40be8b41f" class="t t">CommandBaseAst</a> <span id="r2 rd" class="r2 r">commandBaseAst</span>,
                                                       <a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a>[] <span id="r3 rd" class="r3 r">redirections</span>,
                                                       <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r4 rd" class="r4 r">context</span>)
        {
            <a href="../../parser/ast.cs.html#a310aaa1e0374ddd" class="k">var</a> <span id="r5 rd" class="r5 r">commandAst</span> = <span class="r2 r">commandBaseAst</span> <b>as</b> <a href="../../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a>;
            <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="k">var</a> <span id="r6 rd" class="r6 r">invocationToken</span> = <span class="r5 r">commandAst</span> != <b>null</b> ? <span class="r5 r">commandAst</span>.<a href="../../parser/ast.cs.html#16e18484040f8b6f" class="i property">InvocationOperator</a> : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#109dbe127dd9cac0" class="i field">Unknown</a>;
            <b>bool</b> <span id="r7 rd" class="r7 r">dotSource</span> = <span class="r6 r">invocationToken</span> == <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>;
            <a href="../../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r8 rd" class="r8 r">commandSessionState</span> = <b>null</b>;
            <b>int</b> <span id="r9 rd" class="r9 r">commandIndex</span> = 0;
 
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r1 r">commandElements</span>[0].<a href="../../CommandParameter.cs.html#f6c863f6ae765a95" class="i property">ArgumentSpecified</a> &amp;&amp; !<span class="r1 r">commandElements</span>[0].<a href="../../CommandParameter.cs.html#6cc67d908afd0fd6" class="i property">ParameterNameSpecified</a>,
                <span class="s">&quot;Compiler will pass first parameter as an argument.&quot;</span>);
            <a href="../../Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="k">var</a> <span id="r10 rd" class="r10 r">mi</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r1 r">commandElements</span>[0].<a href="../../CommandParameter.cs.html#8b23fe67ce0ebecb" class="i property">ArgumentValue</a>) <b>as</b> <a href="../../Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>;
            <b>if</b> (<span class="r10 r">mi</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r10 r">mi</span>.<a href="../../Modules/PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> == <a href="../../Modules/PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="../../Modules/PSModuleInfo.cs.html#1c66a8819a72670d" class="i field">Binary</a> &amp;&amp; <span class="r10 r">mi</span>.<a href="../../Modules/PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <b>null</b>, <span class="s">&quot;CantInvokeInBinaryModule&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">CantInvokeInBinaryModule</span>, <span class="r10 r">mi</span>.<a href="../../Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
                }
                <b>else</b> <b>if</b> (<span class="r10 r">mi</span>.<a href="../../Modules/PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <b>null</b>, <span class="s">&quot;CantInvokeInNonImportedModule&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">CantInvokeInNonImportedModule</span>, <span class="r10 r">mi</span>.<a href="../../Modules/PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
                }
                <b>else</b> <b>if</b> (((<span class="r6 r">invocationToken</span> == <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#ed112ae477a73c36" class="i field">Ampersand</a>) || (<span class="r6 r">invocationToken</span> == <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>)) &amp;&amp; (<span class="r10 r">mi</span>.<a href="../../Modules/PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a> != <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>))
                {
                    <span class="c">// Disallow FullLanguage &quot;&amp; (Get-Module MyModule) MyPrivateFn&quot; from ConstrainedLanguage because it always</span>
                    <span class="c">// runs &quot;internal&quot; origin and so has access to all functions, including non-exported functions.</span>
                    <span class="c">// Otherwise we end up leaking non-exported functions that run in FullLanguage.</span>
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <b>null</b>,
                        <span class="s">&quot;CantInvokeCallOperatorAcrossLanguageBoundaries&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">CantInvokeCallOperatorAcrossLanguageBoundaries</span>);
                }
 
                <span class="r8 r">commandSessionState</span> = <span class="r10 r">mi</span>.<a href="../../Modules/PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>;
                <span class="r9 r">commandIndex</span> += 1;
            }
 
            <b>object</b> <span id="r11 rd" class="r11 r">command</span>;
            <a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r12 rd" class="r12 r">commandExtent</span>;
            <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="k">var</a> <span id="r13 rd" class="r13 r">cpiCommand</span> = <span class="r1 r">commandElements</span>[<span class="r9 r">commandIndex</span>];
            <b>if</b> (<span class="r13 r">cpiCommand</span>.<a href="../../CommandParameter.cs.html#6cc67d908afd0fd6" class="i property">ParameterNameSpecified</a>)
            {
                <span class="r11 r">command</span> = <span class="r13 r">cpiCommand</span>.<a href="../../CommandParameter.cs.html#e4b21d1937e05e60" class="i property">ParameterText</a>;
                <span class="r12 r">commandExtent</span> = <span class="r13 r">cpiCommand</span>.<a href="../../CommandParameter.cs.html#d12a5051b2b93c45" class="i property">ParameterExtent</a>;
                <b>if</b> (<span class="r13 r">cpiCommand</span>.<a href="../../CommandParameter.cs.html#f6c863f6ae765a95" class="i property">ArgumentSpecified</a>)
                {
                    <span class="c">// BUG: we&#39;ve seen something like:</span>
                    <span class="c">//     &amp; (gmo Module) -foo: bar</span>
                    <span class="c">// The command is -foo:, and bar is an argument, but both are in commandElements[commandIndex],</span>
                    <span class="c">// so we won&#39;t add &#39;bar&#39; as an argument.</span>
                }
            }
            <b>else</b>
            {
                <span class="r11 r">command</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r13 r">cpiCommand</span>.<a href="../../CommandParameter.cs.html#8b23fe67ce0ebecb" class="i property">ArgumentValue</a>);
                <span class="r12 r">commandExtent</span> = <span class="r13 r">cpiCommand</span>.<a href="../../CommandParameter.cs.html#fc3e49e933e2e0d8" class="i property">ArgumentExtent</a>;
            }
 
            <b>string</b> <span id="r14 rd" class="r14 r">invocationName</span> = (<span class="r7 r">dotSource</span>) ? <span class="s">&quot;.&quot;</span> : <span class="r6 r">invocationToken</span> == <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#ed112ae477a73c36" class="i field">Ampersand</a> ? <span class="s">&quot;&amp;&quot;</span> : <b>null</b>;
            <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r15 rd" class="r15 r">commandProcessor</span>;
            <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="k">var</a> <span id="r16 rd" class="r16 r">scriptBlock</span> = <span class="r11 r">command</span> <b>as</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>;
            <b>if</b> (<span class="r16 r">scriptBlock</span> != <b>null</b>)
            {
                <span class="r15 r">commandProcessor</span> = <a href="../../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<span class="i">CreateCommandProcessorForScript</span>(<span class="r16 r">scriptBlock</span>, <span class="r4 r">context</span>, !<span class="r7 r">dotSource</span>, <span class="r8 r">commandSessionState</span>);
            }
            <b>else</b>
            {
                <a href="../../CommandInfo.cs.html#71babe57a99ca852" class="k">var</a> <span id="r17 rd" class="r17 r">commandInfo</span> = <span class="r11 r">command</span> <b>as</b> <a href="../../CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a>;
                <b>if</b> (<span class="r17 r">commandInfo</span> != <b>null</b>)
                {
                    <span class="r15 r">commandProcessor</span> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<span class="i">LookupCommandProcessor</span>(<span class="r17 r">commandInfo</span>, <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../../SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a>, !<span class="r7 r">dotSource</span>, <span class="r8 r">commandSessionState</span>);
                }
                <b>else</b>
                {
                    <b>var</b> <span id="r18 rd" class="r18 r">commandName</span> = <span class="r11 r">command</span> <b>as string</b> ?? <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e87c4fc15a3f59f5" class="i method">ToStringParser</a>(<span class="r4 r">context</span>, <span class="r11 r">command</span>);
                    <span class="r14 r">invocationName</span> ??= <span class="r18 r">commandName</span>;
 
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r18 r">commandName</span>))
                    {
                        <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(
                            <span class="r11 r">command</span>,
                            <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                            <span class="r12 r">commandExtent</span>,
                            <span class="s">&quot;BadExpression&quot;</span>,
                            <span class="i">ParserStrings</span>.<span class="i">BadExpression</span>,
                            <span class="r7 r">dotSource</span> ? <span class="s">&quot;.&quot;</span> : <span class="s">&quot;&amp;&quot;</span>);
                    }
 
                    <b>try</b>
                    {
                        <span class="c">// See if we need to resolve the command in a different session state</span>
                        <span class="c">// as will be the case with modules...</span>
                        <span class="c">// BUGBUG - this can be cleaned up by fixing the overload on execution context (but not easily.)</span>
                        <b>if</b> (<span class="r8 r">commandSessionState</span> != <b>null</b>)
                        {
                            <a href="../../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r19 rd" class="r19 r">oldSessionState</span> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
                            <b>try</b>
                            {
                                <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r8 r">commandSessionState</span>;
                                <span class="r15 r">commandProcessor</span> = <span class="r4 r">context</span>.<span class="i">CreateCommand</span>(<span class="r18 r">commandName</span>, <span class="r7 r">dotSource</span>);
                            }
                            <b>finally</b>
                            {
                                <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r19 r">oldSessionState</span>;
                            }
                        }
                        <b>else</b>
                        {
                            <span class="r15 r">commandProcessor</span> = <span class="r4 r">context</span>.<span class="i">CreateCommand</span>(<span class="r18 r">commandName</span>, <span class="r7 r">dotSource</span>);
                        }
                    }
                    <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r20 rd" class="r20 r">rte</span>)
                    {
                        <span class="c">// CreateCommand doesn&#39;t have the context to set InvocationInfo properly</span>
                        <span class="c">// so we&#39;ll do it here instead...</span>
                        <b>if</b> (<span class="r20 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#fd1ac7b3462d4426" class="i property">InvocationInfo</a> == <b>null</b>)
                        {
                            <a href="../../InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r21 rd" class="r21 r">invocationInfo</span> = <b>new</b> <a href="../../InvocationInfo.cs.html#05f8dff4c341ddae" class="t constructor">InvocationInfo</a>(<b>null</b>, <span class="r12 r">commandExtent</span>, <span class="r4 r">context</span>)
                            { <a href="../../InvocationInfo.cs.html#57f452abf157b50b" class="i property">InvocationName</a> = <span class="r14 r">invocationName</span> };
                            <span class="r20 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#14b8261653db7b03" class="i method">SetInvocationInfo</a>(<span class="r21 r">invocationInfo</span>);
                        }
 
                        <b>throw</b>;
                    }
                }
            }
 
            <a href="../../CommandBase.cs.html#26cb3aadccaa58ac" class="t t">InternalCommand</a> <span id="r22 rd" class="r22 r">cmd</span> = <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>;
            <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d3edce8b26f160da" class="i property">UseLocalScope</a> = !<span class="r7 r">dotSource</span> &amp;&amp;
                                             (<span class="r22 r">cmd</span> <b>is</b> <a href="../../ScriptCommand.cs.html#087afb10617614ea" class="t t">ScriptCommand</a> || <span class="r22 r">cmd</span> <b>is</b> <a href="../CompiledScriptBlock.cs.html#20151031a0be3c24" class="t t">PSScriptCmdlet</a>);
 
            <b>bool</b> <span id="r23 rd" class="r23 r">isNativeCommand</span> = <span class="r15 r">commandProcessor</span> <b>is</b> <a href="../../NativeCommandProcessor.cs.html#27173c2526d1ef9a" class="t t">NativeCommandProcessor</a>;
            <b>for</b> (<b>int</b> <span id="r24 rd" class="r24 r">i</span> = <span class="r9 r">commandIndex</span> + 1; <span class="r24 r">i</span> &lt; <span class="r1 r">commandElements</span>.<span class="i">Length</span>; ++<span class="r24 r">i</span>)
            {
                <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="k">var</a> <span id="r25 rd" class="r25 r">cpi</span> = <span class="r1 r">commandElements</span>[<span class="r24 r">i</span>];
 
                <b>if</b> (<span class="r25 r">cpi</span>.<a href="../../CommandParameter.cs.html#6cc67d908afd0fd6" class="i property">ParameterNameSpecified</a>)
                {
                    <span class="c">// Skip adding the special -- parameter unless we&#39;re invoking a native command.</span>
                    <b>if</b> (<span class="r25 r">cpi</span>.<a href="../../CommandParameter.cs.html#8a262faeff991e7d" class="i property">ParameterName</a>.<span class="i">Equals</span>(<span class="s">&quot;-&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp; !<span class="r23 r">isNativeCommand</span>)
                    {
                        <b>continue</b>;
                    }
                }
 
                <b>if</b> (<span class="r25 r">cpi</span>.<a href="../../CommandParameter.cs.html#2b249fb2fa786816" class="i property">ArgumentToBeSplatted</a>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r26 rd" class="r26 r">splattedCpi</span> <b>in</b> <a href="#d43ab23c781dccc8" class="i method">Splat</a>(<span class="r25 r">cpi</span>.<a href="../../CommandParameter.cs.html#8b23fe67ce0ebecb" class="i property">ArgumentValue</a>, <span class="r25 r">cpi</span>.<a href="../../CommandParameter.cs.html#74477d6db015267b" class="i property">ArgumentAst</a>))
                    {
                        <span class="r15 r">commandProcessor</span>.<span class="i">AddParameter</span>(<span class="r26 r">splattedCpi</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#a862b2435f52bbdf" class="i method">AddParameter</a>(<span class="r25 r">cpi</span>);
                }
            }
 
            <b>string</b> <span id="r27 rd" class="r27 r">helpTarget</span>;
            <a href="../../../help/HelpSystem.cs.html#5ad0a796ad0d8ceb" class="t t">HelpCategory</a> <span id="r28 rd" class="r28 r">helpCategory</span>;
            <b>if</b> (<span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#67dd0c69e6a0187b" class="i method">IsHelpRequested</a>(<b>out</b> <span class="r27 r">helpTarget</span>, <b>out</b> <span class="r28 r">helpCategory</span>))
            {
                <span class="r15 r">commandProcessor</span> = <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a>.<a href="../../CommandProcessorBase.cs.html#55bbbf951649455b" class="i method">CreateGetHelpCommandProcessor</a>(<span class="r4 r">context</span>, <span class="r27 r">helpTarget</span>, <span class="r28 r">helpCategory</span>);
            }
 
            <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="../../CommandBase.cs.html#848be65db101584d" class="i property">InvocationExtent</a> = <span class="r2 r">commandBaseAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>;
            <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="../../CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="../../InvocationInfo.cs.html#36c1c0cc46ab70ad" class="i property">ScriptPosition</a> = <span class="r2 r">commandBaseAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>;
            <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="../../CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="../../InvocationInfo.cs.html#57f452abf157b50b" class="i property">InvocationName</a> = <span class="r14 r">invocationName</span>;
 
            <span class="r0 r">pipe</span>.<a href="../../pipeline.cs.html#b06f99a3f17ecd81" class="i method">Add</a>(<span class="r15 r">commandProcessor</span>);
 
            <b>bool</b> <span id="r29 rd" class="r29 r">redirectedError</span> = <b>false</b>;
            <b>bool</b> <span id="r30 rd" class="r30 r">redirectedWarning</span> = <b>false</b>;
            <b>bool</b> <span id="r31 rd" class="r31 r">redirectedVerbose</span> = <b>false</b>;
            <b>bool</b> <span id="r32 rd" class="r32 r">redirectedDebug</span> = <b>false</b>;
            <b>bool</b> <span id="r33 rd" class="r33 r">redirectedInformation</span> = <b>false</b>;
            <b>if</b> (<span class="r3 r">redirections</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="#51c59304e4c48b1e" class="k">var</a> <span id="r34 rd" class="r34 r">redirection</span> <b>in</b> <span class="r3 r">redirections</span>)
                {
                    <span class="r34 r">redirection</span>.<a href="#8dabaf1cc1f8798c" class="i method">Bind</a>(<span class="r0 r">pipe</span>, <span class="r15 r">commandProcessor</span>, <span class="r4 r">context</span>);
                    <b>switch</b> (<span class="r34 r">redirection</span>.<a href="#c71d9319ffb45955" class="i property">FromStream</a>)
                    {
                        <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>:
                            <span class="r29 r">redirectedError</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>:
                            <span class="r30 r">redirectedWarning</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>:
                            <span class="r31 r">redirectedVerbose</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>:
                            <span class="r32 r">redirectedDebug</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>:
                            <span class="r33 r">redirectedInformation</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>:
                            <span class="r29 r">redirectedError</span> = <b>true</b>;
                            <span class="r30 r">redirectedWarning</span> = <b>true</b>;
                            <span class="r31 r">redirectedVerbose</span> = <b>true</b>;
                            <span class="r32 r">redirectedDebug</span> = <b>true</b>;
                            <span class="r33 r">redirectedInformation</span> = <b>true</b>;
                            <b>break</b>;
                    }
                }
            }
 
            <span class="c">// Pipe redirection can also be specified via the ExecutionContext pipes.</span>
            <b>if</b> (!<span class="r29 r">redirectedError</span>)
            {
                <b>if</b> (<span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> != <b>null</b>)
                {
                    <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
                }
                <b>else</b>
                {
                    <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a>.<a href="../../Pipe.cs.html#244a8e191e44d453" class="i property">ExternalWriter</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#b62a014273263f69" class="i property">ExternalErrorOutput</a>;
                }
            }
 
            <b>if</b> (!<span class="r30 r">redirectedWarning</span> &amp;&amp; (<span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a> != <b>null</b>))
            {
                <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a>;
                <span class="r30 r">redirectedWarning</span> = <b>true</b>;
            }
 
            <b>if</b> (!<span class="r31 r">redirectedVerbose</span> &amp;&amp; (<span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a> != <b>null</b>))
            {
                <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a>;
                <span class="r31 r">redirectedVerbose</span> = <b>true</b>;
            }
 
            <b>if</b> (!<span class="r32 r">redirectedDebug</span> &amp;&amp; (<span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a> != <b>null</b>))
            {
                <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a>;
                <span class="r32 r">redirectedDebug</span> = <b>true</b>;
            }
 
            <b>if</b> (!<span class="r33 r">redirectedInformation</span> &amp;&amp; (<span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a> != <b>null</b>))
            {
                <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a>;
                <span class="r33 r">redirectedInformation</span> = <b>true</b>;
            }
 
            <span class="c">// Warning, Verbose, Debug should pick up any redirection information from its parent command runtime object.</span>
            <b>if</b> (<span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> != <b>null</b> &amp;&amp; <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a> != <b>null</b>)
            {
                <b>if</b> (!<span class="r30 r">redirectedWarning</span> &amp;&amp;
                    <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a> != <b>null</b>)
                {
                    <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a>;
                }
 
                <b>if</b> (!<span class="r31 r">redirectedVerbose</span> &amp;&amp;
                    <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a> != <b>null</b>)
                {
                    <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a>;
                }
 
                <b>if</b> (!<span class="r32 r">redirectedDebug</span> &amp;&amp;
                    <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a> != <b>null</b>)
                {
                    <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a>;
                }
 
                <b>if</b> (!<span class="r33 r">redirectedInformation</span> &amp;&amp;
                    <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a> != <b>null</b>)
                {
                    <span class="r15 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a> = <span class="r4 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a>;
                }
            }
 
            <b>return</b> <span class="r15 r">commandProcessor</span>;
        }
 
        <b>internal static</b> <span class="i">IEnumerable</span>&lt;<a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>&gt; <a id="d43ab23c781dccc8" href="../../../R/d43ab23c781dccc8.html" target="n" data-glyph="74,1" class="i method">Splat</a>(<b>object</b> <span id="r35 rd" class="r35 r">splattedValue</span>, <a href="../../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r36 rd" class="r36 r">splatAst</span>)
        {
            <span class="r35 r">splattedValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r35 r">splattedValue</span>);
 
            <b>var</b> <span id="r37 rd" class="r37 r">markUntrustedData</span> = <b>false</b>;
            <b>if</b> (<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#f3a9373a4fcbee98" class="i property">HasEverUsedConstrainedLanguage</a>)
            {
                <span class="c">// If the value to be splatted is untrusted, then make sure sub-values held by it are</span>
                <span class="c">// also marked as untrusted.</span>
                <span class="r37 r">markUntrustedData</span> = <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#174e087008fa944f" class="i method">IsMarkedAsUntrusted</a>(<span class="r35 r">splattedValue</span>);
            }
 
            <span class="i">IDictionary</span> <span id="r38 rd" class="r38 r">splattedTable</span> = <span class="r35 r">splattedValue</span> <b>as</b> <span class="i">IDictionary</span>;
            <b>if</b> (<span class="r38 r">splattedTable</span> != <b>null</b>)
            {
                <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r39 rd" class="r39 r">de</span> <b>in</b> <span class="r38 r">splattedTable</span>)
                {
                    <b>string</b> <span id="r40 rd" class="r40 r">parameterName</span> = <span class="r39 r">de</span>.<span class="i">Key</span>.<span class="i">ToString</span>();
                    <b>object</b> <span id="r41 rd" class="r41 r">parameterValue</span> = <span class="r39 r">de</span>.<span class="i">Value</span>;
                    <b>string</b> <span id="r42 rd" class="r42 r">parameterText</span> = <a href="#0d07d0b7c6bd229a" class="i method">GetParameterText</a>(<span class="r40 r">parameterName</span>);
 
                    <b>if</b> (<span class="r37 r">markUntrustedData</span>)
                    {
                        <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#6ffdecb5ab5d141e" class="i method">MarkObjectAsUntrusted</a>(<span class="r41 r">parameterValue</span>);
                    }
 
                    <b>yield</b> <b>return</b> <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#b0a57c9e4428f6f3" class="i method">CreateParameterWithArgument</a>(
                        <span class="r43 r">parameterAst</span>: <span class="r36 r">splatAst</span>,
                        <span class="r44 r">parameterName</span>: <span class="r40 r">parameterName</span>,
                        <span class="r45 r">parameterText</span>: <span class="r42 r">parameterText</span>,
                        <span class="r46 r">argumentAst</span>: <span class="r36 r">splatAst</span>,
                        <span class="r47 r">value</span>: <span class="r41 r">parameterValue</span>,
                        <span class="r48 r">spaceAfterParameter</span>: <b>false</b>,
                        <span class="r49 r">fromSplatting</span>: <b>true</b>);
                }
            }
            <b>else</b>
            {
                <span class="i">IEnumerable</span> <span id="r50 rd" class="r50 r">enumerableValue</span> = <span class="r35 r">splattedValue</span> <b>as</b> <span class="i">IEnumerable</span>;
                <b>if</b> (<span class="r50 r">enumerableValue</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>object</b> <span id="r51 rd" class="r51 r">obj</span> <b>in</b> <span class="r50 r">enumerableValue</span>)
                    {
                        <b>if</b> (<span class="r37 r">markUntrustedData</span>)
                        {
                            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#6ffdecb5ab5d141e" class="i method">MarkObjectAsUntrusted</a>(<span class="r51 r">obj</span>);
                        }
 
                        <b>yield</b> <b>return</b> <a href="#4fabf40b359f267a" class="i method">SplatEnumerableElement</a>(<span class="r51 r">obj</span>, <span class="r36 r">splatAst</span>);
                    }
                }
                <b>else</b>
                {
                    <b>yield</b> <b>return</b> <a href="#4fabf40b359f267a" class="i method">SplatEnumerableElement</a>(<span class="r35 r">splattedValue</span>, <span class="r36 r">splatAst</span>);
                }
            }
        }
 
        <b>private static</b> <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <a id="4fabf40b359f267a" href="../../../R/4fabf40b359f267a.html" target="n" data-glyph="76,1" class="i method">SplatEnumerableElement</a>(<b>object</b> <span id="r52 rd" class="r52 r">splattedArgument</span>, <a href="../../parser/ast.cs.html#d47621d83efd14de" class="t t">Ast</a> <span id="r53 rd" class="r53 r">splatAst</span>)
        {
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r54 rd" class="r54 r">psObject</span> = <span class="r52 r">splattedArgument</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r54 r">psObject</span> != <b>null</b>)
            {
                <a href="../../MshMemberInfo.cs.html#13ab3796654e613c" class="k">var</a> <span id="r55 rd" class="r55 r">prop</span> = <span class="r54 r">psObject</span>.<a href="../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../../scriptparameterbindercontroller.cs.html#802627054e79dbd7" class="t t">ScriptParameterBinderController</a>.<a href="../../scriptparameterbindercontroller.cs.html#027781ab5635a7f8" class="i field">NotePropertyNameForSplattingParametersInArgs</a>];
                <b>var</b> <span id="r56 rd" class="r56 r">baseObj</span> = <span class="r54 r">psObject</span>.<a href="../../MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
                <b>if</b> (<span class="r55 r">prop</span> != <b>null</b> &amp;&amp; <span class="r55 r">prop</span>.<a href="../../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a> <b>is string</b> &amp;&amp; <span class="r56 r">baseObj</span> <b>is string</b>)
                {
                    <b>return</b> <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#9eddd36e241d4a79" class="i method">CreateParameter</a>((<b>string</b>)<span class="r55 r">prop</span>.<a href="../../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>, (<b>string</b>)<span class="r56 r">baseObj</span>, <span class="r53 r">splatAst</span>);
                }
            }
 
            <b>return</b> <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#1454f83e9b819690" class="i method">CreateArgument</a>(<span class="r52 r">splattedArgument</span>, <span class="r53 r">splatAst</span>);
        }
 
        <b>private static string</b> <a id="0d07d0b7c6bd229a" href="../../../R/0d07d0b7c6bd229a.html" target="n" data-glyph="76,1" class="i method">GetParameterText</a>(<b>string</b> <span id="r57 rd" class="r57 r">parameterName</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r57 r">parameterName</span> != <b>null</b>, <span class="s">&quot;caller makes sure the parameterName is not null&quot;</span>);
            <b>int</b> <span id="r58 rd" class="r58 r">endPosition</span> = <span class="r57 r">parameterName</span>.<span class="i">Length</span>;
            <b>while</b> ((<span class="r58 r">endPosition</span> &gt; 0) &amp;&amp; <b>char</b>.<span class="i">IsWhiteSpace</span>(<span class="r57 r">parameterName</span>[<span class="r58 r">endPosition</span> - 1]))
            {
                <span class="r58 r">endPosition</span>--;
            }
 
            <b>if</b> (<span class="r58 r">endPosition</span> == 0 || <span class="r57 r">parameterName</span>[<span class="r58 r">endPosition</span> - 1] == <span class="s">&#39;:&#39;</span>)
            {
                <b>return</b> <span class="s">&quot;-&quot;</span> + <span class="r57 r">parameterName</span>;
            }
 
            <b>string</b> <span id="r59 rd" class="r59 r">parameterText</span>;
            <b>if</b> (<span class="r58 r">endPosition</span> == <span class="r57 r">parameterName</span>.<span class="i">Length</span>)
            {
                <span class="r59 r">parameterText</span> = <span class="s">&quot;-&quot;</span> + <span class="r57 r">parameterName</span> + <span class="s">&quot;:&quot;</span>;
            }
            <b>else</b>
            {
                <b>string</b> <span id="r60 rd" class="r60 r">whitespaces</span> = <span class="r57 r">parameterName</span>.<span class="i">Substring</span>(<span class="r58 r">endPosition</span>);
                <span class="r59 r">parameterText</span> = <b>string</b>.<span class="i">Concat</span>(<span class="s">&quot;-&quot;</span>, <span class="r57 r">parameterName</span>.<span class="i">AsSpan</span>(0, <span class="r58 r">endPosition</span>), <span class="s">&quot;:&quot;</span>, <span class="r60 r">whitespaces</span>);
            }
 
            <b>return</b> <span class="r59 r">parameterText</span>;
        }
 
        <b>internal static void</b> <a id="952c96a46349b64c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokePipeline</a>(<b>object</b> <span id="r61 rd" class="r61 r">input</span>,
                                            <b>bool</b> <span id="r62 rd" class="r62 r">ignoreInput</span>,
                                            <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>[][] <span id="r63 rd" class="r63 r">pipeElements</span>,
                                            <a href="../../parser/ast.cs.html#dd8dd8a40be8b41f" class="t t">CommandBaseAst</a>[] <span id="r64 rd" class="r64 r">pipeElementAsts</span>,
                                            <a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a>[][] <span id="r65 rd" class="r65 r">commandRedirections</span>,
                                            <a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r66 rd" class="r66 r">funcContext</span>)
        {
            <a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r67 rd" class="r67 r">pipelineProcessor</span> = <b>new</b> <span class="t">PipelineProcessor</span>();
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r68 rd" class="r68 r">context</span> = <span class="r66 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>;
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r69 rd" class="r69 r">outputPipe</span> = <span class="r66 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
 
            <b>try</b>
            {
                <b>if</b> (<span class="r68 r">context</span>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a> != <b>null</b>)
                {
                    <span class="r68 r">context</span>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a>.<a href="../../EventManager.cs.html#2b06c4e89213cb8c" class="i method">ProcessPendingActions</a>();
                }
 
                <b>if</b> (<span class="r61 r">input</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a> &amp;&amp; !<span class="r62 r">ignoreInput</span>)
                {
                    <span class="c">// We have seen something like:</span>
                    <span class="c">//    $e | measure-object</span>
                    <span class="c">// And $e is AutomationNull.Value.  We want to ensure</span>
                    <span class="c">// measure-object runs w/o sending anything through the pipe,</span>
                    <span class="c">// so we&#39;ll turn the pipe into Out-Null | ...</span>
                    <span class="c">// This cleanly avoids any problems with the pipeline processing</span>
                    <span class="c">// code dealing with null/AutomationNull input going directly to</span>
                    <span class="c">// the first command (e.g. Measure-Object).</span>
                    <a href="#0a029cee0739f6ae" class="i method">AddNoopCommandProcessor</a>(<span class="r67 r">pipelineProcessor</span>, <span class="r68 r">context</span>);
                }
 
                <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r70 rd" class="r70 r">commandProcessor</span> = <b>null</b>;
                <a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a>[] <span id="r71 rd" class="r71 r">commandRedirection</span> = <b>null</b>;
 
                <b>for</b> (<b>int</b> <span id="r72 rd" class="r72 r">i</span> = 0; <span class="r72 r">i</span> &lt; <span class="r63 r">pipeElements</span>.<span class="i">Length</span>; <span class="r72 r">i</span>++)
                {
                    <span class="r71 r">commandRedirection</span> = <span class="r65 r">commandRedirections</span>?[<span class="r72 r">i</span>];
                    <span class="r70 r">commandProcessor</span> = <a href="#31714ae20113b57b" class="i method">AddCommand</a>(<span class="r67 r">pipelineProcessor</span>, <span class="r63 r">pipeElements</span>[<span class="r72 r">i</span>], <span class="r64 r">pipeElementAsts</span>[<span class="r72 r">i</span>],
                                                  <span class="r71 r">commandRedirection</span>, <span class="r68 r">context</span>);
                }
 
                <a href="../../CmdletInfo.cs.html#9492ffc9968f644d" class="k">var</a> <span id="r73 rd" class="r73 r">cmdletInfo</span> = <span class="r70 r">commandProcessor</span>?.<a href="../../CommandProcessorBase.cs.html#b61b3a9315a42a73" class="i property">CommandInfo</a> <b>as</b> <a href="../../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>;
                <b>if</b> (<span class="r73 r">cmdletInfo</span>?.<a href="../../CmdletInfo.cs.html#9ba4328ad01dd7c0" class="i property">ImplementingType</a> == <b>typeof</b>(<a href="../../../FormatAndOutput/out-console/OutConsole.cs.html#f5982690ed7e6594" class="t t">OutNullCommand</a>))
                {
                    <b>var</b> <span id="r74 rd" class="r74 r">commandsCount</span> = <span class="r67 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#0aa8a898bb66d1ac" class="i property">Commands</a>.<span class="i">Count</span>;
                    <b>if</b> (<span class="r74 r">commandsCount</span> == 1)
                    {
                        <span class="c">// Out-Null is the only command, bail without running anything</span>
                        <b>return</b>;
                    }
 
                    <span class="c">// Out-Null is the last command, rewrite command before Out-Null to a null pipe, but</span>
                    <span class="c">// only if it didn&#39;t redirect anything, e.g. `Get-Stuff &gt; o.txt | Out-Null`</span>
                    <b>var</b> <span id="r75 rd" class="r75 r">nextToLastCommand</span> = <span class="r67 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#0aa8a898bb66d1ac" class="i property">Commands</a>[<span class="r74 r">commandsCount</span> - 2];
                    <b>if</b> (!<span class="r75 r">nextToLastCommand</span>.<span class="i">CommandRuntime</span>.<span class="i">OutputPipe</span>.<span class="i">IsRedirected</span>)
                    {
                        <span class="r67 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#0aa8a898bb66d1ac" class="i property">Commands</a>.<span class="i">RemoveAt</span>(<span class="r74 r">commandsCount</span> - 1);
                        <span class="r70 r">commandProcessor</span> = <span class="r75 r">nextToLastCommand</span>;
                        <span class="r75 r">nextToLastCommand</span>.<span class="i">CommandRuntime</span>.<span class="i">OutputPipe</span> = <b>new</b> <a href="../../Pipe.cs.html#c1592456b1ff42b5" class="t constructor">Pipe</a> { <a href="../../Pipe.cs.html#8ef98c4ec55d7204" class="i property">NullPipe</a> = <b>true</b> };
                    }
                }
 
                <b>if</b> (<span class="r70 r">commandProcessor</span> != <b>null</b> &amp;&amp; !<span class="r70 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>.<a href="../../Pipe.cs.html#f890f797fcc0ee94" class="i property">IsRedirected</a>)
                {
                    <span class="r67 r">pipelineProcessor</span>.<span class="i">LinkPipelineSuccessOutput</span>(<span class="r69 r">outputPipe</span> ?? <b>new</b> <a href="../../Pipe.cs.html#99288ee09b9642bb" class="t constructor">Pipe</a>(<b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;()));
 
                    <span class="c">// Fix up merge redirection bindings on last command processor.</span>
                    <b>if</b> (<span class="r71 r">commandRedirection</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a> <span id="r76 rd" class="r76 r">redirection</span> <b>in</b> <span class="r71 r">commandRedirection</span>)
                        {
                            <b>if</b> (<span class="r76 r">redirection</span> <b>is</b> <a href="#0d1f9eedf9f41271" class="t t">MergingRedirection</a>)
                            {
                                <span class="r76 r">redirection</span>.<a href="#8dabaf1cc1f8798c" class="i method">Bind</a>(<span class="r67 r">pipelineProcessor</span>, <span class="r70 r">commandProcessor</span>, <span class="r68 r">context</span>);
                            }
                        }
                    }
                }
 
                <span class="r68 r">context</span>.<a href="../../ExecutionContext.cs.html#59f954936236f028" class="i method">PushPipelineProcessor</a>(<span class="r67 r">pipelineProcessor</span>);
                <b>try</b>
                {
                    <span class="r67 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#8a9a9e1fb869f895" class="i method">SynchronousExecuteEnumerate</a>(<span class="r61 r">input</span>);
                }
                <b>finally</b>
                {
                    <span class="r68 r">context</span>.<a href="../../ExecutionContext.cs.html#e9ca865f4a03c30c" class="i method">PopPipelineProcessor</a>(<b>false</b>);
                }
            }
            <b>finally</b>
            {
                <span class="r68 r">context</span>.<a href="../../ExecutionContext.cs.html#1086e67bac3e5c3a" class="i property">QuestionMarkVariableValue</a> = !<span class="r67 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#813a2622f5f1116c" class="i property">ExecutionFailed</a>;
                <span class="r67 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#3193eaf8bd4e8783" class="i method">Dispose</a>();
            }
        }
 
        <b>internal static void</b> <a id="91cc2739e39105f9" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokePipelineInBackground</a>(
                                            <a href="../../parser/ast.cs.html#86812479028959b8" class="t t">PipelineBaseAst</a> <span id="r77 rd" class="r77 r">pipelineAst</span>,
                                            <a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r78 rd" class="r78 r">funcContext</span>)
        {
            <a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r79 rd" class="r79 r">pipelineProcessor</span> = <b>new</b> <span class="t">PipelineProcessor</span>();
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r80 rd" class="r80 r">context</span> = <span class="r78 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>;
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r81 rd" class="r81 r">outputPipe</span> = <span class="r78 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
 
            <b>try</b>
            {
                <b>if</b> (<span class="r80 r">context</span>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a> != <b>null</b>)
                {
                    <span class="r80 r">context</span>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a>.<a href="../../EventManager.cs.html#2b06c4e89213cb8c" class="i method">ProcessPendingActions</a>();
                }
 
                <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r82 rd" class="r82 r">commandProcessor</span> = <b>null</b>;
 
                <span class="c">// For background jobs rewrite the pipeline as a Start-Job command</span>
                <b>var</b> <span id="r83 rd" class="r83 r">scriptblockBodyString</span> = <span class="r77 r">pipelineAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../../parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>;
                <b>var</b> <span id="r84 rd" class="r84 r">pipelineOffset</span> = <span class="r77 r">pipelineAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../../parser/Position.cs.html#14e0029eb01de3bb" class="i property">StartOffset</a>;
                <b>var</b> <span id="r85 rd" class="r85 r">variables</span> = <span class="r77 r">pipelineAst</span>.<span class="i">FindAll</span>(<b>static</b> <span id="r86 rd" class="r86 r">x</span> =&gt; <span class="r86 r">x</span> <b>is</b> <a href="../../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>, <b>true</b>);
 
                <span class="c">// Used to make sure that the job runs in the current directory</span>
                <b>const string</b> <span id="r87 rd" class="r87 r">cmdPrefix</span> = <span class="s">@&quot;Microsoft.PowerShell.Management\Set-Location -LiteralPath $using:pwd ; &quot;</span>;
 
                <span class="c">// Minimize allocations by initializing the stringbuilder to the size of the source string + prefix + space for ${using:} * 2</span>
                <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">StringBuilder</span> <span id="r88 rd" class="r88 r">updatedScriptblock</span> = <b>new</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">StringBuilder</span>(<span class="r87 r">cmdPrefix</span>.<span class="i">Length</span> + <span class="r83 r">scriptblockBodyString</span>.<span class="i">Length</span> + 18);
                <span class="r88 r">updatedScriptblock</span>.<span class="i">Append</span>(<span class="r87 r">cmdPrefix</span>);
                <b>int</b> <span id="r89 rd" class="r89 r">position</span> = 0;
 
                <span class="c">// Prefix variables in the scriptblock with $using:</span>
                <b>foreach</b> (<b>var</b> <span id="r90 rd" class="r90 r">v</span> <b>in</b> <span class="r85 r">variables</span>)
                {
                    <b>var</b> <span id="r91 rd" class="r91 r">variableName</span> = ((<a href="../../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>)<span class="r90 r">v</span>).<a href="../../parser/ast.cs.html#d094d170ef781837" class="i property">VariablePath</a>.<a href="../../VariablePath.cs.html#45529674e4735f30" class="i property">UserPath</a>;
 
                    <span class="c">// Skip variables that don&#39;t exist</span>
                    <b>if</b> (<span class="r78 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateVariableAPIs.cs.html#e8489f28d543d2b6" class="i method">GetVariable</a>(<span class="r91 r">variableName</span>) == <b>null</b>)
                    {
                        <b>continue</b>;
                    }
 
                    <span class="c">// Skip PowerShell magic variables</span>
                    <b>if</b> (!<span class="i">Regex</span>.<span class="i">Match</span>(
                            <span class="r91 r">variableName</span>,
                            <span class="s">&quot;^(global:){0,1}(PID|PSVersionTable|PSEdition|PSHOME|HOST|TRUE|FALSE|NULL)$&quot;</span>,
                            <span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span> | <span class="i">RegexOptions</span>.<span class="i">CultureInvariant</span>).<span class="i">Success</span>)
                    {
                        <span class="r88 r">updatedScriptblock</span>.<span class="i">Append</span>(<span class="r83 r">scriptblockBodyString</span>.<span class="i">AsSpan</span>(<span class="r89 r">position</span>, <span class="r90 r">v</span>.<span class="i">Extent</span>.<span class="i">StartOffset</span> - <span class="r84 r">pipelineOffset</span> - <span class="r89 r">position</span>));
                        <span class="r88 r">updatedScriptblock</span>.<span class="i">Append</span>(<span class="s">&quot;${using:&quot;</span>);
                        <span class="r88 r">updatedScriptblock</span>.<span class="i">Append</span>(<a href="../../lang/codegen.cs.html#ec5e2f0e22eb2223" class="t t">CodeGeneration</a>.<a href="../../lang/codegen.cs.html#0f0d039735cefa4d" class="i method">EscapeVariableName</a>(<span class="r91 r">variableName</span>));
                        <span class="r88 r">updatedScriptblock</span>.<span class="i">Append</span>(<span class="s">&#39;}&#39;</span>);
                        <span class="r89 r">position</span> = <span class="r90 r">v</span>.<span class="i">Extent</span>.<span class="i">EndOffset</span> - <span class="r84 r">pipelineOffset</span>;
                    }
                }
 
                <span class="r88 r">updatedScriptblock</span>.<span class="i">Append</span>(<span class="r83 r">scriptblockBodyString</span>.<span class="i">AsSpan</span>(<span class="r89 r">position</span>));
                <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="k">var</a> <span id="r92 rd" class="r92 r">sb</span> = <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<span class="i">Create</span>(<span class="r88 r">updatedScriptblock</span>.<span class="i">ToString</span>());
                <a href="../../CmdletInfo.cs.html#9492ffc9968f644d" class="k">var</a> <span id="r93 rd" class="r93 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Start-Job&quot;</span>, <b>typeof</b>(<a href="../../remoting/commands/StartJob.cs.html#43ad6ab12d386a86" class="t t">StartJobCommand</a>));
                <span class="r82 r">commandProcessor</span> = <span class="r80 r">context</span>.<a href="../../ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="../../CommandDiscovery.cs.html#677e20c74f6dea43" class="i method">LookupCommandProcessor</a>(<span class="r93 r">commandInfo</span>, <a href="../../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>, <b>false</b>, <span class="r80 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>);
                <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="k">var</a> <span id="r94 rd" class="r94 r">parameter</span> = <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#b0a57c9e4428f6f3" class="i method">CreateParameterWithArgument</a>(
                    <span class="r43 r">parameterAst</span>: <span class="r77 r">pipelineAst</span>,
                    <span class="s">&quot;ScriptBlock&quot;</span>,
                    <b>null</b>,
                    <span class="r46 r">argumentAst</span>: <span class="r77 r">pipelineAst</span>,
                    <span class="r92 r">sb</span>,
                    <b>false</b>);
                <span class="r82 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#a862b2435f52bbdf" class="i method">AddParameter</a>(<span class="r94 r">parameter</span>);
                <span class="r79 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#b06f99a3f17ecd81" class="i method">Add</a>(<span class="r82 r">commandProcessor</span>);
                <span class="r79 r">pipelineProcessor</span>.<span class="i">LinkPipelineSuccessOutput</span>(<span class="r81 r">outputPipe</span> ?? <b>new</b> <a href="../../Pipe.cs.html#99288ee09b9642bb" class="t constructor">Pipe</a>(<b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;()));
 
                <span class="r80 r">context</span>.<a href="../../ExecutionContext.cs.html#59f954936236f028" class="i method">PushPipelineProcessor</a>(<span class="r79 r">pipelineProcessor</span>);
                <b>try</b>
                {
                    <span class="r79 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#8a9a9e1fb869f895" class="i method">SynchronousExecuteEnumerate</a>(<a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>);
                }
                <b>finally</b>
                {
                    <span class="r80 r">context</span>.<a href="../../ExecutionContext.cs.html#e9ca865f4a03c30c" class="i method">PopPipelineProcessor</a>(<b>false</b>);
                }
            }
            <b>finally</b>
            {
                <span class="r80 r">context</span>.<a href="../../ExecutionContext.cs.html#1086e67bac3e5c3a" class="i property">QuestionMarkVariableValue</a> = !<span class="r79 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#813a2622f5f1116c" class="i property">ExecutionFailed</a>;
                <span class="r79 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#3193eaf8bd4e8783" class="i method">Dispose</a>();
            }
        }
 
        <b>private static void</b> <a id="0a029cee0739f6ae" href="../../../R/0a029cee0739f6ae.html" target="n" data-glyph="76,1" class="i method">AddNoopCommandProcessor</a>(<a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r95 rd" class="r95 r">pipelineProcessor</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r96 rd" class="r96 r">context</span>)
        {
            <a href="../../CmdletInfo.cs.html#9492ffc9968f644d" class="k">var</a> <span id="r97 rd" class="r97 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Out-Null&quot;</span>, <b>typeof</b>(<a href="../../../FormatAndOutput/out-console/OutConsole.cs.html#f5982690ed7e6594" class="t t">OutNullCommand</a>));
            <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="k">var</a> <span id="r98 rd" class="r98 r">commandProcessor</span> = <span class="r96 r">context</span>.<a href="../../ExecutionContext.cs.html#586b706a65389941" class="i property">CommandDiscovery</a>.<a href="../../CommandDiscovery.cs.html#677e20c74f6dea43" class="i method">LookupCommandProcessor</a>(<span class="r97 r">commandInfo</span>,
                                                                                   <span class="r96 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../../SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a>,
                                                                                   <span class="r99 r">useLocalScope</span>: <b>false</b>,
                                                                                   <span class="r100 r">sessionState</span>: <b>null</b>);
            <span class="r95 r">pipelineProcessor</span>.<a href="../../pipeline.cs.html#b06f99a3f17ecd81" class="i method">Add</a>(<span class="r98 r">commandProcessor</span>);
        }
 
        <b>internal static object</b> <a id="0939c04b16b4c534" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CheckAutomationNullInCommandArgument</a>(<b>object</b> <span id="r101 rd" class="r101 r">obj</span>)
        {
            <b>if</b> (<span class="r101 r">obj</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>var</b> <span id="r102 rd" class="r102 r">objAsArray</span> = <span class="r101 r">obj</span> <b>as object</b>[];
            <b>return</b> <span class="r102 r">objAsArray</span> != <b>null</b> ? <a href="#db617cdb502a8c8a" class="i method">CheckAutomationNullInCommandArgumentArray</a>(<span class="r102 r">objAsArray</span>) : <span class="r101 r">obj</span>;
        }
 
        <b>internal static object</b>[] <a id="db617cdb502a8c8a" href="../../../R/db617cdb502a8c8a.html" target="n" data-glyph="74,1" class="i method">CheckAutomationNullInCommandArgumentArray</a>(<b>object</b>[] <span id="r103 rd" class="r103 r">objArray</span>)
        {
            <b>if</b> (<span class="r103 r">objArray</span> != <b>null</b>)
            {
                <b>for</b> (<b>int</b> <span id="r104 rd" class="r104 r">i</span> = 0; <span class="r104 r">i</span> &lt; <span class="r103 r">objArray</span>.<span class="i">Length</span>; ++<span class="r104 r">i</span>)
                {
                    <b>if</b> (<span class="r103 r">objArray</span>[<span class="r104 r">i</span>] == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                    {
                        <span class="r103 r">objArray</span>[<span class="r104 r">i</span>] = <b>null</b>;
                    }
                }
            }
 
            <b>return</b> <span class="r103 r">objArray</span>;
        }
 
        <b>internal static</b> <a href="../../lang/scriptblock.cs.html#5e20a8a88cfbe6cb" class="t t">SteppablePipeline</a> <a id="83ec5f802f317eaa" href="../../../R/83ec5f802f317eaa.html" target="n" data-glyph="74,1" class="i method">GetSteppablePipeline</a>(<a href="../../parser/ast.cs.html#785915ec8547ce9f" class="t t">PipelineAst</a> <span id="r105 rd" class="r105 r">pipelineAst</span>, <a href="../../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a> <span id="r106 rd" class="r106 r">commandOrigin</span>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r107 rd" class="r107 r">scriptBlock</span>, <b>object</b>[] <span id="r108 rd" class="r108 r">args</span>)
        {
            <a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="k">var</a> <span id="r109 rd" class="r109 r">pipelineProcessor</span> = <b>new</b> <span class="t">PipelineProcessor</span>();
            <b>var</b> <span id="r110 rd" class="r110 r">commandTuples</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">Tuple</span>&lt;<a href="../../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a>, <span class="i">List</span>&lt;<a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>&gt;, <span class="i">List</span>&lt;<a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a>&gt;&gt;&gt;();
 
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r111 rd" class="r111 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <b>if</b> (<span class="r111 r">context</span> == <b>null</b>)
            {
                <span class="c">// If ExecutionContext from TLS is null then we are not in powershell engine thread.</span>
                <b>string</b> <span id="r112 rd" class="r112 r">scriptText</span> = <span class="r107 r">scriptBlock</span>.<a href="../CompiledScriptBlock.cs.html#89c5da438a36dbb2" class="i method">ToString</a>();
                <span class="r112 r">scriptText</span> = <a href="../../ErrorPackage.cs.html#37830dc92d4ac970" class="t t">ErrorCategoryInfo</a>.<span class="i">Ellipsize</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentUICulture</span>, <span class="r112 r">scriptText</span>);
 
                <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r113 rd" class="r113 r">e</span> = <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                    <span class="i">ParserStrings</span>.<span class="i">GetSteppablePipelineFromWrongThread</span>,
                    <span class="r112 r">scriptText</span>);
 
                <span class="r113 r">e</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;GetSteppablePipelineFromWrongThread&quot;</span>);
                <b>throw</b> <span class="r113 r">e</span>;
            }
 
            <span class="c">// We try binding the parameter when following conditions are satisfied:</span>
            <span class="c">//   * Arguments are provided</span>
            <span class="c">//   * The ScriptBlock has parameters</span>
            <span class="c">// If the script block has no parameter, RuntimeDefinedParameters.Data will be set to RuntimeDefinedParameterDictionary.EmptyParameterArray</span>
            <b>bool</b> <span id="r114 rd" class="r114 r">useParameter</span> = (<span class="r108 r">args</span> != <b>null</b> &amp;&amp; <span class="r108 r">args</span>.<span class="i">Length</span> &gt; 0) &amp;&amp;
                                <span class="r107 r">scriptBlock</span>.<a href="../CompiledScriptBlock.cs.html#61f3934e64edc598" class="i property">RuntimeDefinedParameters</a>.<a href="../../PseudoParameters.cs.html#188173533cedce98" class="i property">Data</a> !=
                                <a href="../../PseudoParameters.cs.html#d55a14219c7e096c" class="t t">RuntimeDefinedParameterDictionary</a>.<a href="../../PseudoParameters.cs.html#8c8a683808508461" class="i field">EmptyParameterArray</a>;
            <b>try</b>
            {
                <b>if</b> (<span class="r114 r">useParameter</span>)
                {
                    <span class="c">// If any parameters are used, we create a new scope and bind the parameters.</span>
 
                    <a href="../../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r115 rd" class="r115 r">newScope</span> = <span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#27e7de485699a643" class="i method">NewScope</a>(<b>false</b>);
                    <span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> = <span class="r115 r">newScope</span>;
                    <span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../../SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a> = <a href="../../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>;
 
                    <a href="../MutableTuple.cs.html#d4c692d6a8bac31d" class="k">var</a> <span id="r116 rd" class="r116 r">locals</span> = <a href="../MutableTuple.cs.html#d4c692d6a8bac31d" class="t t">MutableTuple</a>.<a href="../MutableTuple.cs.html#32166b6659de79e2" class="i method">MakeTuple</a>(<a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#50f3467ff6c08485" class="i field">DottedLocalsTupleType</a>,
                                                        <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#8a3b323becd5e9eb" class="i field">DottedLocalsNameIndexMap</a>);
                    <b>object</b>[] <span id="r117 rd" class="r117 r">remainingArgs</span> =
                        <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../CompiledScriptBlock.cs.html#15a4814e5820949d" class="i method">BindArgumentsForScriptblockInvoke</a>(
                            (<a href="../../PseudoParameters.cs.html#68fb670c5eb25328" class="t t">RuntimeDefinedParameter</a>[])<span class="r107 r">scriptBlock</span>.<a href="../CompiledScriptBlock.cs.html#61f3934e64edc598" class="i property">RuntimeDefinedParameters</a>.<a href="../../PseudoParameters.cs.html#188173533cedce98" class="i property">Data</a>,
                            <span class="r108 r">args</span>, <span class="r111 r">context</span>, <b>false</b>, <b>null</b>, <span class="r116 r">locals</span>);
                    <span class="r116 r">locals</span>.<a href="../MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="../../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../../SpecialVariables.cs.html#57fd29949d2d5d62" class="i field">Args</a>, <span class="r117 r">remainingArgs</span>, <span class="r111 r">context</span>);
                    <span class="r115 r">newScope</span>.<a href="../../SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a> = <span class="r116 r">locals</span>;
                }
 
                <span class="c">// GetSteppablePipeline() is called on an arbitrary script block with the intention</span>
                <span class="c">// of invoking it. So the trustworthiness is defined by the trustworthiness of the</span>
                <span class="c">// script block&#39;s language mode.</span>
                <b>bool</b> <span id="r118 rd" class="r118 r">isTrusted</span> = <span class="r107 r">scriptBlock</span>.<a href="../../lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
 
                <b>foreach</b> (<b>var</b> <span id="r119 rd" class="r119 r">commandAst</span> <b>in</b> <span class="r105 r">pipelineAst</span>.<a href="../../parser/ast.cs.html#edccd333bf2ee4d5" class="i property">PipelineElements</a>.<span class="i">Cast</span>&lt;<a href="../../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a>&gt;())
                {
                    <b>var</b> <span id="r120 rd" class="r120 r">commandParameters</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>&gt;();
                    <b>foreach</b> (<b>var</b> <span id="r121 rd" class="r121 r">commandElement</span> <b>in</b> <span class="r119 r">commandAst</span>.<span class="i">CommandElements</span>)
                    {
                        <a href="../../parser/ast.cs.html#b97c3b8b32a8faec" class="k">var</a> <span id="r122 rd" class="r122 r">commandParameterAst</span> = <span class="r121 r">commandElement</span> <b>as</b> <a href="../../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a>;
                        <b>if</b> (<span class="r122 r">commandParameterAst</span> != <b>null</b>)
                        {
                            <span class="r120 r">commandParameters</span>.<span class="i">Add</span>(<a href="#9bbe662b6daf5032" class="i method">GetCommandParameter</a>(<span class="r122 r">commandParameterAst</span>, <span class="r118 r">isTrusted</span>, <span class="r111 r">context</span>));
                            <b>continue</b>;
                        }
 
                        <a href="../../parser/ast.cs.html#78a833319fe635b4" class="k">var</a> <span id="r123 rd" class="r123 r">exprAst</span> = (<a href="../../parser/ast.cs.html#78a833319fe635b4" class="t t">ExpressionAst</a>)<span class="r121 r">commandElement</span>;
                        <b>var</b> <span id="r124 rd" class="r124 r">argument</span> = <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#e64c031d9d5607aa" class="i method">GetExpressionValue</a>(<span class="r123 r">exprAst</span>, <span class="r118 r">isTrusted</span>, <span class="r111 r">context</span>);
                        <b>var</b> <span id="r125 rd" class="r125 r">splatting</span> = (<span class="r123 r">exprAst</span> <b>is</b> <a href="../../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a> &amp;&amp; ((<a href="../../parser/ast.cs.html#248562b22b336dec" class="t t">VariableExpressionAst</a>)<span class="r123 r">exprAst</span>).<a href="../../parser/ast.cs.html#7f1485a08eb97fcc" class="i property">Splatted</a>);
                        <span class="r120 r">commandParameters</span>.<span class="i">Add</span>(<a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#1454f83e9b819690" class="i method">CreateArgument</a>(<span class="r124 r">argument</span>, <span class="r123 r">exprAst</span>, <span class="r125 r">splatting</span>));
                    }
 
                    <b>var</b> <span id="r126 rd" class="r126 r">redirections</span> = <b>new</b> <span class="i">List</span>&lt;<a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a>&gt;();
                    <b>foreach</b> (<b>var</b> <span id="r127 rd" class="r127 r">redirection</span> <b>in</b> <span class="r119 r">commandAst</span>.<span class="i">Redirections</span>)
                    {
                        <span class="r126 r">redirections</span>.<span class="i">Add</span>(<span class="i">GetCommandRedirection</span>(<span class="r127 r">redirection</span>, <span class="r118 r">isTrusted</span>, <span class="r111 r">context</span>));
                    }
 
                    <span class="r110 r">commandTuples</span>.<span class="i">Add</span>(<span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r119 r">commandAst</span>, <span class="r120 r">commandParameters</span>, <span class="r126 r">redirections</span>));
                }
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r114 r">useParameter</span>)
                {
                    <span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#729d02bb53189219" class="i method">RemoveScope</a>(<span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>);
                }
            }
 
            <b>foreach</b> (<b>var</b> <span id="r128 rd" class="r128 r">commandTuple</span> <b>in</b> <span class="r110 r">commandTuples</span>)
            {
                <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="k">var</a> <span id="r129 rd" class="r129 r">commandProcessor</span> = <span class="i">AddCommand</span>(<span class="r109 r">pipelineProcessor</span>, <span class="r128 r">commandTuple</span>.<span class="i">Item2</span>.<span class="i">ToArray</span>(), <span class="r128 r">commandTuple</span>.<span class="i">Item1</span>, <span class="r128 r">commandTuple</span>.<span class="i">Item3</span>.<span class="i">ToArray</span>(), <span class="r111 r">context</span>);
                <span class="r129 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="../../CommandBase.cs.html#cfb07a45be8fb7d4" class="i field">CommandOriginInternal</a> = <span class="r106 r">commandOrigin</span>;
                <span class="r129 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#fefd69f2b6b9e222" class="i property">CommandScope</a>.<a href="../../SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a> = <span class="r106 r">commandOrigin</span>;
                <span class="r129 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="../../CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="../../InvocationInfo.cs.html#02c0f35838462a5e" class="i property">CommandOrigin</a> = <span class="r106 r">commandOrigin</span>;
 
                <span class="c">// For nicer error reporting, we want to make it look like errors in the steppable pipeline point back to</span>
                <span class="c">// the caller of the proxy.  We don&#39;t want errors pointing to the script block created in the proxy.</span>
                <span class="c">// Here we assume (in a safe way) that GetSteppablePipeline is called from script.  If that isn&#39;t the case,</span>
                <span class="c">// we won&#39;t crash, but the error reporting might be a little misleading.</span>
                <b>var</b> <span id="r130 rd" class="r130 r">callStack</span> = <span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#3e56b2d709de0d80" class="i property">Debugger</a>.<a href="../../debugger/debugger.cs.html#6e5b14dde8877cdc" class="i method">GetCallStack</a>().<span class="i">ToArray</span>();
                <b>if</b> (<span class="r130 r">callStack</span>.<span class="i">Length</span> &gt; 0 &amp;&amp; <span class="i">Regex</span>.<span class="i">IsMatch</span>(<span class="r130 r">callStack</span>[0].<span class="i">Position</span>.<span class="i">Text</span>, <span class="s">&quot;GetSteppablePipeline&quot;</span>, <span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>))
                {
                    <a href="../../InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="k">var</a> <span id="r131 rd" class="r131 r">myInvocation</span> = <span class="r129 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#f58ee453ebc82f56" class="i property">Command</a>.<a href="../../CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>;
                    <span class="r131 r">myInvocation</span>.<a href="../../InvocationInfo.cs.html#57f452abf157b50b" class="i property">InvocationName</a> = <span class="r130 r">callStack</span>[0].<span class="i">InvocationInfo</span>.<span class="i">InvocationName</span>;
                    <b>if</b> (<span class="r130 r">callStack</span>.<span class="i">Length</span> &gt; 1)
                    {
                        <b>var</b> <span id="r132 rd" class="r132 r">displayPosition</span> = <span class="r130 r">callStack</span>[1].<span class="i">Position</span>;
                        <b>if</b> (<span class="r132 r">displayPosition</span> != <b>null</b> &amp;&amp; <span class="r132 r">displayPosition</span> != <a href="../../parser/Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="../../parser/Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>)
                        {
                            <span class="r131 r">myInvocation</span>.<a href="../../InvocationInfo.cs.html#da1298533340b29e" class="i property">DisplayScriptPosition</a> = <span class="r132 r">displayPosition</span>;
                        }
                    }
                }
 
                <span class="c">// Set the data stream merge properties based on ExecutionContext.</span>
                <b>if</b> (<span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> != <b>null</b> &amp;&amp; <span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a> != <b>null</b>)
                {
                    <span class="r129 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#85b5a830104aaf06" class="i method">SetMergeFromRuntime</a>(<span class="r111 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>);
                }
            }
 
            <b>return</b> <b>new</b> <a href="../../lang/scriptblock.cs.html#b328e97fca1fbdc8" class="t constructor">SteppablePipeline</a>(<span class="r111 r">context</span>, <span class="r109 r">pipelineProcessor</span>);
        }
 
        <b>private static</b> <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a> <a id="9bbe662b6daf5032" href="../../../R/9bbe662b6daf5032.html" target="n" data-glyph="76,1" class="i method">GetCommandParameter</a>(<a href="../../parser/ast.cs.html#b97c3b8b32a8faec" class="t t">CommandParameterAst</a> <span id="r133 rd" class="r133 r">commandParameterAst</span>, <b>bool</b> <span id="r134 rd" class="r134 r">isTrusted</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r135 rd" class="r135 r">context</span>)
        {
            <a href="../../parser/ast.cs.html#78a833319fe635b4" class="k">var</a> <span id="r136 rd" class="r136 r">argumentAst</span> = <span class="r133 r">commandParameterAst</span>.<a href="../../parser/ast.cs.html#21fa828caf096206" class="i property">Argument</a>;
            <a href="../../parser/Position.cs.html#bbc751d075344454" class="k">var</a> <span id="r137 rd" class="r137 r">errorPos</span> = <span class="r133 r">commandParameterAst</span>.<a href="../../parser/ast.cs.html#c02cc0fd1f27d9da" class="i property">ErrorPosition</a>;
 
            <b>if</b> (<span class="r136 r">argumentAst</span> == <b>null</b>)
            {
                <b>return</b> <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#9eddd36e241d4a79" class="i method">CreateParameter</a>(<span class="r133 r">commandParameterAst</span>.<a href="../../parser/ast.cs.html#0a26f1be6b3fd748" class="i property">ParameterName</a>, <span class="r137 r">errorPos</span>.<a href="../../parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>, <span class="r133 r">commandParameterAst</span>);
            }
 
            <b>object</b> <span id="r138 rd" class="r138 r">argumentValue</span> = <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#e64c031d9d5607aa" class="i method">GetExpressionValue</a>(<span class="r136 r">argumentAst</span>, <span class="r134 r">isTrusted</span>, <span class="r135 r">context</span>);
            <b>bool</b> <span id="r139 rd" class="r139 r">spaceAfterParameter</span> = (<span class="r137 r">errorPos</span>.<a href="../../parser/Position.cs.html#ccd649a5269e237d" class="i property">EndLineNumber</a> != <span class="r136 r">argumentAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../../parser/Position.cs.html#cc356dc28b41997d" class="i property">StartLineNumber</a> ||
                                        <span class="r137 r">errorPos</span>.<a href="../../parser/Position.cs.html#155675f601d14734" class="i property">EndColumnNumber</a> != <span class="r136 r">argumentAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>.<a href="../../parser/Position.cs.html#8fcbdc214acf2f0f" class="i property">StartColumnNumber</a>);
            <b>return</b> <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#b0a57c9e4428f6f3" class="i method">CreateParameterWithArgument</a>(<span class="r133 r">commandParameterAst</span>, <span class="r133 r">commandParameterAst</span>.<a href="../../parser/ast.cs.html#0a26f1be6b3fd748" class="i property">ParameterName</a>,
                                                                        <span class="r137 r">errorPos</span>.<a href="../../parser/Position.cs.html#43ce932d9225bc9c" class="i property">Text</a>, <span class="r136 r">argumentAst</span>, <span class="r138 r">argumentValue</span>,
                                                                        <span class="r139 r">spaceAfterParameter</span>);
        }
 
        <b>private static</b> <a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a> <a id="8035db738673c35c" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetCommandRedirection</a>(<a href="../../parser/ast.cs.html#62235daca4a9c495" class="t t">RedirectionAst</a> <span id="r140 rd" class="r140 r">redirectionAst</span>, <b>bool</b> <span id="r141 rd" class="r141 r">isTrusted</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r142 rd" class="r142 r">context</span>)
        {
            <a href="../../parser/ast.cs.html#2288e8fa779a0d57" class="k">var</a> <span id="r143 rd" class="r143 r">fileRedirection</span> = <span class="r140 r">redirectionAst</span> <b>as</b> <a href="../../parser/ast.cs.html#2288e8fa779a0d57" class="t t">FileRedirectionAst</a>;
            <b>if</b> (<span class="r143 r">fileRedirection</span> != <b>null</b>)
            {
                <b>object</b> <span id="r144 rd" class="r144 r">fileName</span> = <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#e64c031d9d5607aa" class="i method">GetExpressionValue</a>(<span class="r143 r">fileRedirection</span>.<a href="../../parser/ast.cs.html#387c7bd2fd1d9d89" class="i property">Location</a>, <span class="r141 r">isTrusted</span>, <span class="r142 r">context</span>);
                <b>return</b> <b>new</b> <span class="t">FileRedirection</span>(<span class="r143 r">fileRedirection</span>.<a href="../../parser/ast.cs.html#54d26a89dbf0384f" class="i property">FromStream</a>, <span class="r143 r">fileRedirection</span>.<a href="../../parser/ast.cs.html#394a80d552aaa2ca" class="i property">Append</a>, <span class="r144 r">fileName</span>.<span class="i">ToString</span>());
            }
 
            <a href="../../parser/ast.cs.html#57ad2a29a39e91e6" class="k">var</a> <span id="r145 rd" class="r145 r">mergingRedirectionAst</span> = (<a href="../../parser/ast.cs.html#57ad2a29a39e91e6" class="t t">MergingRedirectionAst</a>)<span class="r140 r">redirectionAst</span>;
            <b>return</b> <b>new</b> <a href="#15a7e77385afa90a" class="t constructor">MergingRedirection</a>(<span class="r145 r">mergingRedirectionAst</span>.<a href="../../parser/ast.cs.html#54d26a89dbf0384f" class="i property">FromStream</a>, <span class="r145 r">mergingRedirectionAst</span>.<a href="../../parser/ast.cs.html#f0ccba0030de4284" class="i property">ToStream</a>);
        }
 
        <b>internal static object</b> <a id="fc7796c24644bad1" href="../../../R/fc7796c24644bad1.html" target="n" data-glyph="74,1" class="i method">PipelineResult</a>(<span class="i">List</span>&lt;<b>object</b>&gt; <span id="r146 rd" class="r146 r">resultList</span>)
        {
            <b>var</b> <span id="r147 rd" class="r147 r">resultCount</span> = <span class="r146 r">resultList</span>.<span class="i">Count</span>;
            <b>if</b> (<span class="r147 r">resultCount</span> == 0)
            {
                <b>return</b> <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
            }
 
            <b>var</b> <span id="r148 rd" class="r148 r">result</span> = <span class="r147 r">resultCount</span> == 1 ? <span class="r146 r">resultList</span>[0] : <span class="r146 r">resultList</span>.<span class="i">ToArray</span>();
            <span class="c">// Clear the array list so that we don&#39;t write the results of the pipe when flushing the pipe.</span>
            <span class="r146 r">resultList</span>.<span class="i">Clear</span>();
            <b>return</b> <span class="r148 r">result</span>;
        }
 
        <b>internal static void</b> <a id="e834311c89ba081c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">FlushPipe</a>(<a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r149 rd" class="r149 r">oldPipe</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r150 rd" class="r150 r">resultList</span>)
        {
            <b>for</b> (<b>int</b> <span id="r151 rd" class="r151 r">i</span> = 0; <span class="r151 r">i</span> &lt; <span class="r150 r">resultList</span>.<span class="i">Count</span>; <span class="r151 r">i</span>++)
            {
                <span class="r149 r">oldPipe</span>.<span class="i">Add</span>(<span class="r150 r">resultList</span>[<span class="r151 r">i</span>]);
            }
        }
 
        <b>internal static void</b> <a id="bf31096c63ecd821" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ClearPipe</a>(<span class="i">List</span>&lt;<b>object</b>&gt; <span id="r152 rd" class="r152 r">resultList</span>)
        {
            <span class="r152 r">resultList</span>.<span class="i">Clear</span>();
        }
 
        <b>internal static</b> <a href="../../lang/parserutils.cs.html#79de2587ceb4dc25" class="t t">ExitException</a> <a id="adcd2ff71b653bbd" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetExitException</a>(<b>object</b> <span id="r153 rd" class="r153 r">exitCodeObj</span>)
        {
            <b>int</b> <span id="r154 rd" class="r154 r">exitCode</span> = 0;
 
            <b>try</b>
            {
                <b>if</b> (!<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#cf665fbdc4612d9d" class="i method">IsNull</a>(<span class="r153 r">exitCodeObj</span>))
                {
                    <span class="r154 r">exitCode</span> = <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#e27ca21481dc9c96" class="i method">ConvertTo</a>&lt;<b>int</b>&gt;(<span class="r153 r">exitCodeObj</span>, <a href="../../parser/Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="../../parser/Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>);
                }
            }
            <b>catch</b> (<span class="i">Exception</span>) <span class="c">// ignore non-severe exceptions</span>
            {
            }
 
            <b>return</b> <b>new</b> <a href="../../lang/parserutils.cs.html#e341b629da66363d" class="t constructor">ExitException</a>(<span class="r154 r">exitCode</span>);
        }
 
        <b>internal static void</b> <a id="8059fac0aa41a85e" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CheckForInterrupts</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r155 rd" class="r155 r">context</span>)
        {
            <b>if</b> (<span class="r155 r">context</span>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a> != <b>null</b>)
            {
                <span class="r155 r">context</span>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a>.<a href="../../EventManager.cs.html#2b06c4e89213cb8c" class="i method">ProcessPendingActions</a>();
            }
 
            <b>if</b> (<span class="r155 r">context</span>.<a href="../../ExecutionContext.cs.html#bc7d7c4d79ef05e4" class="i property">CurrentPipelineStopping</a>)
            {
                <b>throw</b> <b>new</b> <a href="../../../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
            }
        }
 
        <span class="c">// This is to work around a DLR problem with gotos in try/catch to the end of a lambda.</span>
        <b>internal static void</b> <a id="baa1e262b20380d8" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Nop</a>() { }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Redirections
 
    <b>internal abstract class</b> <a id="51c59304e4c48b1e" href="../../../R/51c59304e4c48b1e.html" target="n" data-glyph="2,0" class="t t">CommandRedirection</a>
    {
        <b>protected</b> <a id="768345e1b3cfe0f3" href="../../../R/768345e1b3cfe0f3.html" target="n" data-glyph="75,1" class="t constructor">CommandRedirection</a>(<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a> <span id="r156 rd" class="r156 r">from</span>)
        {
            <a href="#51c59304e4c48b1e" class="k">this</a>.<a href="#c71d9319ffb45955" class="i property">FromStream</a> = <span class="r156 r">from</span>;
        }
 
        <b>internal</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a> <a id="c71d9319ffb45955" href="../../../R/c71d9319ffb45955.html" target="n" data-glyph="104,1" class="i property">FromStream</a> { <b>get</b>; }
 
        <b>internal abstract void</b> <a id="8dabaf1cc1f8798c" href="../../../R/8dabaf1cc1f8798c.html" target="n" data-glyph="74,1" class="i method">Bind</a>(<a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r157 rd" class="r157 r">pipelineProcessor</span>, <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r158 rd" class="r158 r">commandProcessor</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r159 rd" class="r159 r">context</span>);
 
        <b>internal void</b> <a id="4df9de7dcea6bbd7" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">UnbindForExpression</a>(<a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r160 rd" class="r160 r">funcContext</span>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>[] <span id="r161 rd" class="r161 r">pipes</span>)
        {
            <b>if</b> (<span class="r161 r">pipes</span> == <b>null</b>)
            {
                <span class="c">// The pipes can be null if there was an exception (ideally we&#39;d just call unbind</span>
                <span class="c">// from a fault, but that isn&#39;t supported in a clr dynamic method.</span>
                <b>return</b>;
            }
 
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r162 rd" class="r162 r">context</span> = <span class="r160 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>;
            <b>switch</b> (<a href="#c71d9319ffb45955" class="i property">FromStream</a>)
            {
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>:
                    <span class="r160 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>];
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>];
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>];
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>];
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>];
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>];
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>:
                    <span class="r160 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>];
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>:
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>];
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>:
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>];
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>:
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>];
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>:
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>];
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>:
                    <span class="r162 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a> = <span class="r161 r">pipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>];
                    <b>break</b>;
            }
        }
    }
 
    <b>internal class</b> <a id="0d1f9eedf9f41271" href="../../../R/0d1f9eedf9f41271.html" target="n" data-glyph="2,0" class="t t">MergingRedirection</a> : <a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a>
    {
        <b>internal</b> <a id="15a7e77385afa90a" href="../../../R/15a7e77385afa90a.html" target="n" data-glyph="74,1" class="t constructor">MergingRedirection</a>(<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a> <span id="r163 rd" class="r163 r">from</span>, <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a> <span id="r164 rd" class="r164 r">to</span>)
            : <a href="#768345e1b3cfe0f3" class="k">base</a>(<span class="r163 r">from</span>)
        {
            <b>if</b> (<span class="r164 r">to</span> != <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>)
            {
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r164 r">to</span>, <b>typeof</b>(<span class="i">ArgumentException</span>),
                                               <b>null</b>, <span class="s">&quot;RedirectionStreamCanOnlyMergeToOutputStream&quot;</span>,
                                               <span class="i">ParserStrings</span>.<span class="i">RedirectionStreamCanOnlyMergeToOutputStream</span>);
            }
 
            <span class="c">// this.ToStream = to;</span>
        }
 
        <b>public override string</b> <a id="3d4c396596913487" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <a href="#c71d9319ffb45955" class="i property">FromStream</a> == <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>
                       ? <span class="s">&quot;*&gt;&amp;1&quot;</span>
                       : <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}&gt;&amp;1&quot;</span>, (<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>);
        }
 
        <span class="c">// private RedirectionStream ToStream { get; set; }</span>
 
        <span class="c">// Handle merging redirections for commands, like:</span>
        <span class="c">//   dir 2&gt;&amp;1</span>
        <span class="c">// A more realistic example:</span>
        <span class="c">//   dir 2&gt;&amp;1 &gt; out</span>
        <b>internal override void</b> <a id="ee6d9cfaa21ddc4d" href="../../../R/ee6d9cfaa21ddc4d.html" target="n" data-glyph="74,1" class="i method">Bind</a>(<a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r165 rd" class="r165 r">pipelineProcessor</span>, <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r166 rd" class="r166 r">commandProcessor</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r167 rd" class="r167 r">context</span>)
        {
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r168 rd" class="r168 r">pipe</span> = <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>;
 
            <b>switch</b> (<a href="#c71d9319ffb45955" class="i property">FromStream</a>)
            {
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>:
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ed59e3b00feab7b1" class="i property">ErrorMergeTo</a> = <a href="../../MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#8b0e9f05387e62ca" class="t t">MergeDataStream</a>.<a href="../../MshCommandRuntime.cs.html#8ab59ea31f703b82" class="i field">Output</a>;
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>:
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>:
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ed59e3b00feab7b1" class="i property">ErrorMergeTo</a> = <a href="../../MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#8b0e9f05387e62ca" class="t t">MergeDataStream</a>.<a href="../../MshCommandRuntime.cs.html#8ab59ea31f703b82" class="i field">Output</a>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>:
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>:
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>:
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>:
                    <span class="r166 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a> = <span class="r168 r">pipe</span>;
                    <b>break</b>;
            }
        }
 
        <span class="c">// Handle merging redirections for expressions, like:</span>
        <span class="c">//   $(write-error) 2&gt;&amp;1</span>
        <span class="c">// A more realistic example:</span>
        <span class="c">//   $(write-error) 2&gt;&amp;1 &gt; out</span>
        <b>internal</b> <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>[] <a id="65449bf903092f5b" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">BindForExpression</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r169 rd" class="r169 r">context</span>, <a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r170 rd" class="r170 r">funcContext</span>)
        {
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>[] <span id="r171 rd" class="r171 r">oldPipes</span> = <b>new</b> <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a> + 1];
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r172 rd" class="r172 r">pipe</span> = <span class="r170 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
 
            <span class="c">// We set the redirection pipe directly in Context because there is no command processor</span>
            <span class="c">// (which indirectly does the same thing as this code.)</span>
 
            <b>switch</b> (<a href="#c71d9319ffb45955" class="i property">FromStream</a>)
            {
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>:
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>] = <span class="r170 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>:
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>] = <span class="r170 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>:
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>:
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>:
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>:
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>:
                    <span class="r171 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a>;
                    <span class="r169 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a> = <span class="r172 r">pipe</span>;
                    <b>break</b>;
            }
 
            <b>return</b> <span class="r171 r">oldPipes</span>;
        }
    }
 
    <b>internal class</b> <a id="c7517235984e3035" href="../../../R/c7517235984e3035.html" target="n" data-glyph="2,0" class="t t">FileRedirection</a> : <a href="#51c59304e4c48b1e" class="t t">CommandRedirection</a>, <span class="i">IDisposable</span>
    {
        <b>internal</b> <a id="1b7b7805d7430284" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">FileRedirection</a>(<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a> <span id="r173 rd" class="r173 r">from</span>, <b>bool</b> <span id="r174 rd" class="r174 r">appending</span>, <b>string</b> <span id="r175 rd" class="r175 r">file</span>)
            : <a href="#768345e1b3cfe0f3" class="k">base</a>(<span class="r173 r">from</span>)
        {
            <a href="#c7517235984e3035" class="k">this</a>.<a href="#bd50f35facc7cf6a" class="i property">File</a> = <span class="r175 r">file</span>;
            <a href="#c7517235984e3035" class="k">this</a>.<a href="#a7b5c59f3d7233cf" class="i property">Appending</a> = <span class="r174 r">appending</span>;
        }
 
        <b>public override string</b> <a id="32d8424e39b09d33" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;{0}&gt; {1}&quot;</span>,
                                 <a href="#c71d9319ffb45955" class="i property">FromStream</a> == <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>
                                     ? <span class="s">&quot;*&quot;</span>
                                     : ((<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>).<span class="i">ToString</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>),
                                 <a href="#bd50f35facc7cf6a" class="i property">File</a>);
        }
 
        <b>internal string</b> <a id="bd50f35facc7cf6a" href="../../../R/bd50f35facc7cf6a.html" target="n" data-glyph="104,1" class="i property">File</a> { <b>get</b>; }
 
        <b>internal bool</b> <a id="a7b5c59f3d7233cf" href="../../../R/a7b5c59f3d7233cf.html" target="n" data-glyph="104,1" class="i property">Appending</a> { <b>get</b>; }
 
        <b>private</b> <a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <a id="dafd560cef107983" href="../../../R/dafd560cef107983.html" target="n" data-glyph="106,1" class="i property">PipelineProcessor</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">// Handle binding file redirection for commands, like:</span>
        <span class="c">//    dir &gt; out</span>
        <b>internal override void</b> <a id="b333e73fa8eefa07" href="../../../R/b333e73fa8eefa07.html" target="n" data-glyph="74,1" class="i method">Bind</a>(<a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r176 rd" class="r176 r">pipelineProcessor</span>, <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r177 rd" class="r177 r">commandProcessor</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r178 rd" class="r178 r">context</span>)
        {
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r179 rd" class="r179 r">pipe</span> = <a href="#3ab2663169d3ec67" class="i method">GetRedirectionPipe</a>(<span class="r178 r">context</span>, <span class="r176 r">pipelineProcessor</span>);
 
            <b>switch</b> (<a href="#c71d9319ffb45955" class="i property">FromStream</a>)
            {
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>:
                    <span class="c">// Since a temp output pipe is going to be used, we should pass along the error and warning variable list.</span>
                    <span class="c">// Normally, context.CurrentCommandProcessor will not be null. But in legacy DRTs from ParserTest.cs,</span>
                    <span class="c">// a scriptblock may be invoked through &#39;DoInvokeReturnAsIs&#39; using .NET reflection. In that case,</span>
                    <span class="c">// context.CurrentCommandProcessor will be null. We don&#39;t try passing along variable lists in such case.</span>
                    <b>if</b> (<span class="r178 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> != <b>null</b>)
                    {
                        <span class="r178 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>.<a href="../../Pipe.cs.html#d3a10eccf3dbe6a9" class="i method">SetVariableListForTemporaryPipe</a>(<span class="r179 r">pipe</span>);
                    }
 
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a> = <span class="r179 r">pipe</span>;
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>:
                    <span class="c">// Since a temp output pipe is going to be used, we should pass along the error and warning variable list.</span>
                    <b>if</b> (<span class="r178 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> != <b>null</b>)
                    {
                        <span class="r178 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>.<a href="../../Pipe.cs.html#d3a10eccf3dbe6a9" class="i method">SetVariableListForTemporaryPipe</a>(<span class="r179 r">pipe</span>);
                    }
 
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a> = <span class="r179 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>:
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#8cfabd8908a77f92" class="i property">ErrorOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>:
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#d00979e144f16d67" class="i property">WarningOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>:
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#ef3e8731176db1bd" class="i property">VerboseOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>:
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#e4845e81eb1192a5" class="i property">DebugOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>:
                    <span class="r177 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#d539d84981be114a" class="i property">CommandRuntime</a>.<a href="../../MshCommandRuntime.cs.html#3a61ae91cdf1e0bc" class="i property">InformationOutputPipe</a> = <span class="r179 r">pipe</span>;
                    <b>break</b>;
            }
        }
 
        <span class="c">// Handle binding file redirections for expressions, like:</span>
        <span class="c">//     $(write-error blah) 2&gt; out</span>
        <b>internal</b> <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>[] <a id="c22fc7204957079b" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">BindForExpression</a>(<a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r180 rd" class="r180 r">funcContext</span>)
        {
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r181 rd" class="r181 r">context</span> = <span class="r180 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>;
            <span class="c">// GetRedirectionPipe can throw if the filename specified can&#39;t be written to.  In that case,</span>
            <span class="c">// oldPipes is null, and when unbinding, there is nothing to do.</span>
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r182 rd" class="r182 r">pipe</span> = <a href="#3ab2663169d3ec67" class="i method">GetRedirectionPipe</a>(<span class="r181 r">context</span>, <b>null</b>);
            <b>var</b> <span id="r183 rd" class="r183 r">oldPipes</span> = <b>new</b> <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a> + 1];
 
            <b>switch</b> (<a href="#c71d9319ffb45955" class="i property">FromStream</a>)
            {
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#e7ee7b8a1be15429" class="i field">All</a>:
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>] = <span class="r180 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a>;
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a>;
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a>;
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a>;
 
                    <span class="c">// Since a temp output pipe is going to be used, we should pass along the error and warning variable list.</span>
                    <span class="r180 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>.<a href="../../Pipe.cs.html#d3a10eccf3dbe6a9" class="i method">SetVariableListForTemporaryPipe</a>(<span class="r182 r">pipe</span>);
                    <span class="r180 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a> = <span class="r182 r">pipe</span>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>:
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#eef57f42e4c4012c" class="i field">Output</a>] = <span class="r180 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
                    <span class="c">// Since a temp output pipe is going to be used, we should pass along the error and warning variable list.</span>
                    <span class="r180 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>.<a href="../../Pipe.cs.html#d3a10eccf3dbe6a9" class="i method">SetVariableListForTemporaryPipe</a>(<span class="r182 r">pipe</span>);
                    <span class="r180 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a> = <span class="r182 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9d1b0150bfeb2a28" class="i field">Error</a>:
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#f7c802fd607d5b44" class="i field">Warning</a>:
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#80808c8f0c80af72" class="i property">ExpressionWarningOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#9cb9a8aa5616a489" class="i field">Verbose</a>:
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#885314fe59c875ff" class="i property">ExpressionVerboseOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#179346bf2c8c70e8" class="i field">Debug</a>:
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#51dfb51b5ba2cad5" class="i property">ExpressionDebugOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <b>break</b>;
                <b>case</b> <a href="../../parser/ast.cs.html#56e58ab4dc31cf5f" class="t t">RedirectionStream</a>.<a href="../../parser/ast.cs.html#6b317670c1b918f0" class="i field">Information</a>:
                    <span class="r183 r">oldPipes</span>[(<b>int</b>)<a href="#c71d9319ffb45955" class="i property">FromStream</a>] = <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a>;
                    <span class="r181 r">context</span>.<a href="../../ExecutionContext.cs.html#4cee430a38804d69" class="i property">ExpressionInformationOutputPipe</a> = <span class="r182 r">pipe</span>;
                    <b>break</b>;
            }
 
            <b>return</b> <span class="r183 r">oldPipes</span>;
        }
 
        <b>internal</b> <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <a id="3ab2663169d3ec67" href="../../../R/3ab2663169d3ec67.html" target="n" data-glyph="74,1" class="i method">GetRedirectionPipe</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r184 rd" class="r184 r">context</span>, <a href="../../pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r185 rd" class="r185 r">parentPipelineProcessor</span>)
        {
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<a href="#bd50f35facc7cf6a" class="i property">File</a>))
            {
                <b>return</b> <b>new</b> <a href="../../Pipe.cs.html#c1592456b1ff42b5" class="t constructor">Pipe</a> { <a href="../../Pipe.cs.html#8ef98c4ec55d7204" class="i property">NullPipe</a> = <b>true</b> };
            }
 
            <a href="../../CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <span id="r186 rd" class="r186 r">commandProcessor</span> = <span class="r184 r">context</span>.<a href="../../ExecutionContext.cs.html#df39c8180123370b" class="i method">CreateCommand</a>(<span class="s">&quot;out-file&quot;</span>, <b>false</b>);
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r186 r">commandProcessor</span> != <b>null</b>, <span class="s">&quot;CreateCommand returned null&quot;</span>);
 
            <span class="c">// Previously, we mandated Unicode encoding here</span>
            <span class="c">// Now, We can take what ever has been set if PSDefaultParameterValues</span>
            <span class="c">// Unicode is still the default, but now may be overridden</span>
 
            <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="k">var</a> <span id="r187 rd" class="r187 r">cpi</span> = <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#b0a57c9e4428f6f3" class="i method">CreateParameterWithArgument</a>(
                <span class="c">/*parameterAst*/</span><b>null</b>, <span class="s">&quot;Filepath&quot;</span>, <span class="s">&quot;-Filepath:&quot;</span>,
                <span class="c">/*argumentAst*/</span><b>null</b>, <a href="#bd50f35facc7cf6a" class="i property">File</a>,
                <b>false</b>);
            <span class="r186 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#a862b2435f52bbdf" class="i method">AddParameter</a>(<span class="r187 r">cpi</span>);
 
            <b>if</b> (<a href="#c7517235984e3035" class="k">this</a>.<a href="#a7b5c59f3d7233cf" class="i property">Appending</a>)
            {
                <span class="r187 r">cpi</span> = <a href="../../CommandParameter.cs.html#4e36e2c205cfc418" class="t t">CommandParameterInternal</a>.<a href="../../CommandParameter.cs.html#b0a57c9e4428f6f3" class="i method">CreateParameterWithArgument</a>(
                    <span class="c">/*parameterAst*/</span><b>null</b>, <span class="s">&quot;Append&quot;</span>, <span class="s">&quot;-Append:&quot;</span>,
                    <span class="c">/*argumentAst*/</span><b>null</b>, <b>true</b>,
                    <b>false</b>);
                <span class="r186 r">commandProcessor</span>.<a href="../../CommandProcessorBase.cs.html#a862b2435f52bbdf" class="i method">AddParameter</a>(<span class="r187 r">cpi</span>);
            }
 
            <a href="#dafd560cef107983" class="i property">PipelineProcessor</a> = <b>new</b> <span class="t">PipelineProcessor</span>();
            <a href="#dafd560cef107983" class="i property">PipelineProcessor</a>.<a href="../../pipeline.cs.html#b06f99a3f17ecd81" class="i method">Add</a>(<span class="r186 r">commandProcessor</span>);
 
            <b>try</b>
            {
                <a href="#dafd560cef107983" class="i property">PipelineProcessor</a>.<a href="../../pipeline.cs.html#79e7a5ea4cea7c37" class="i method">StartStepping</a>(<b>true</b>);
            }
            <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r188 rd" class="r188 r">rte</span>)
            {
                <span class="c">// If it&#39;s just wrapping an argument exception, build a new exception that</span>
                <span class="c">// is more specific tp the redirection operation...</span>
                <b>if</b> (<span class="r188 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a> <b>is</b> <span class="i n">System</span>.<span class="i">ArgumentException</span>)
                {
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterExceptionWithInnerException</span>(<b>null</b>,
                        <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <b>null</b>, <span class="s">&quot;RedirectionFailed&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">RedirectionFailed</span>,
                            <span class="r188 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>, <a href="#bd50f35facc7cf6a" class="i property">File</a>, <span class="r188 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>.<span class="i">Message</span>);
                }
 
                <b>throw</b>;
            }
 
            <b>if</b> (<span class="r185 r">parentPipelineProcessor</span> != <b>null</b>)
            {
                <span class="c">// I think this is only necessary for calling Dispose on the commands in the redirection pipe.</span>
                <span class="r185 r">parentPipelineProcessor</span>.<a href="../../pipeline.cs.html#498c657664cb737f" class="i method">AddRedirectionPipe</a>(<a href="#dafd560cef107983" class="i property">PipelineProcessor</a>);
            }
 
            <b>return</b> <b>new</b> <a href="../../Pipe.cs.html#b0999d72f5203d02" class="t constructor">Pipe</a>(<span class="r184 r">context</span>, <a href="#dafd560cef107983" class="i property">PipelineProcessor</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> After file redirection is done, we need to call &#39;DoComplete&#39; on the pipeline processor,</span>
        <span class="c">///</span><span class="c"> so that &#39;EndProcessing&#39; of Out-File can be called to wrap up the file write operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remark</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> &#39;StartStepping&#39; is called after creating the pipeline processor.</span>
        <span class="c">///</span><span class="c"> &#39;Step&#39; is called when an object is added to the pipe created with the pipeline processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remark</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="cd9dc75b366f0062" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CallDoCompleteForExpression</a>()
        {
            <span class="c">// The pipe returned from &#39;GetRedirectionPipe&#39; could be a NullPipe</span>
            <b>if</b> (<a href="#dafd560cef107983" class="i property">PipelineProcessor</a> != <b>null</b>)
            {
                <a href="#dafd560cef107983" class="i property">PipelineProcessor</a>.<a href="../../pipeline.cs.html#11bb777c0fdcb4a2" class="i method">DoComplete</a>();
            }
        }
 
        <b>private bool</b> <a id="f5db20b40a690639" href="../../../R/f5db20b40a690639.html" target="n" data-glyph="46,1" class="i field">_disposed</a>;
 
        <b>public void</b> <a id="bcb49da3ee0c30ab" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#7fb627a2867f9995" class="i method">Dispose</a>(<b>true</b>);
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#c7517235984e3035" class="k">this</a>);
        }
 
        <b>private void</b> <a id="7fb627a2867f9995" href="../../../R/7fb627a2867f9995.html" target="n" data-glyph="76,1" class="i method">Dispose</a>(<b>bool</b> <span id="r189 rd" class="r189 r">disposing</span>)
        {
            <b>if</b> (<a href="#f5db20b40a690639" class="i field">_disposed</a>)
                <b>return</b>;
 
            <b>if</b> (<span class="r189 r">disposing</span>)
            {
                <b>if</b> (<a href="#dafd560cef107983" class="i property">PipelineProcessor</a> != <b>null</b>)
                {
                    <a href="#dafd560cef107983" class="i property">PipelineProcessor</a>.<a href="../../pipeline.cs.html#3193eaf8bd4e8783" class="i method">Dispose</a>();
                }
            }
 
            <a href="#f5db20b40a690639" class="i field">_disposed</a> = <b>true</b>;
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Redirections
 
    <b>internal static class</b> <a id="93bd1ee19751b89a" href="../../../R/93bd1ee19751b89a.html" target="n" data-glyph="2,0" class="t t">FunctionOps</a>
    {
        <b>internal static void</b> <a id="ba7808d68da44548" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">DefineFunction</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r190 rd" class="r190 r">context</span>,
                                            <a href="../../parser/ast.cs.html#dd61b2a7b388405b" class="t t">FunctionDefinitionAst</a> <span id="r191 rd" class="r191 r">functionDefinitionAst</span>,
                                            <a href="#70b8e343b58443aa" class="t t">ScriptBlockExpressionWrapper</a> <span id="r192 rd" class="r192 r">scriptBlockExpressionWrapper</span>)
        {
            <b>try</b>
            {
                <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r193 rd" class="r193 r">scriptBlock</span> = <span class="r192 r">scriptBlockExpressionWrapper</span>.<a href="#ab8983550158b80e" class="i method">GetScriptBlock</a>(
                    <span class="r190 r">context</span>, <span class="r191 r">functionDefinitionAst</span>.<a href="../../parser/ast.cs.html#705ac8788be4b00f" class="i property">IsFilter</a>);
 
                <a href="../../ExperimentalFeature/ExperimentalFeature.cs.html#a9ee2c313b8e7ce8" class="k">var</a> <span id="r194 rd" class="r194 r">expAttribute</span> = <span class="r193 r">scriptBlock</span>.<a href="../CompiledScriptBlock.cs.html#91492ca459ac2cd6" class="i property">ExperimentalAttribute</a>;
                <b>if</b> (<span class="r194 r">expAttribute</span> == <b>null</b> || <span class="r194 r">expAttribute</span>.<a href="../../ExperimentalFeature/ExperimentalFeature.cs.html#e2b365fc6cc2f44d" class="i property">ToShow</a>)
                {
                    <span class="r190 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateFunctionAPIs.cs.html#cd563a430161478e" class="i method">SetFunctionRaw</a>(<span class="r191 r">functionDefinitionAst</span>.<a href="../../parser/ast.cs.html#951cc91108156df0" class="i property">Name</a>,
                        <span class="r193 r">scriptBlock</span>, <span class="r190 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../../SessionStateScope.cs.html#84d072e625b581f5" class="i property">ScopeOrigin</a>);
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r195 rd" class="r195 r">exception</span>)
            {
                <b>if</b> (!(<span class="r195 r">exception</span> <b>is</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r196 rd" class="r196 r">rte</span>))
                {
                    <b>throw</b> <a href="#2b2e6cffbdd33d20" class="t t">ExceptionHandlingOps</a>.<a href="#5a3a1336d3429bb1" class="i method">ConvertToRuntimeException</a>(<span class="r195 r">exception</span>, <span class="r191 r">functionDefinitionAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>);
                }
 
                <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r196 r">rte</span>, <span class="r191 r">functionDefinitionAst</span>.<a href="../../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>);
                <b>throw</b>;
            }
        }
    }
 
    <b>internal class</b> <a id="70b8e343b58443aa" href="../../../R/70b8e343b58443aa.html" target="n" data-glyph="2,0" class="t t">ScriptBlockExpressionWrapper</a>
    {
        <b>private</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="5bcb52be7c5dc4ae" href="../../../R/5bcb52be7c5dc4ae.html" target="n" data-glyph="46,1" class="i field">_scriptBlock</a>;
        <b>private readonly</b> <a href="../../parser/ast.cs.html#063cc8bbea9e10f2" class="t t">IParameterMetadataProvider</a> <a id="0f113f4e1c741b27" href="../../../R/0f113f4e1c741b27.html" target="n" data-glyph="46,1" class="i field">_ast</a>;
 
        <b>internal</b> <a id="a58e9f637412d31b" href="../../../R/a58e9f637412d31b.html" target="n" data-glyph="74,1" class="t constructor">ScriptBlockExpressionWrapper</a>(<a href="../../parser/ast.cs.html#063cc8bbea9e10f2" class="t t">IParameterMetadataProvider</a> <span id="r197 rd" class="r197 r">ast</span>)
        {
            <a href="#0f113f4e1c741b27" class="i field">_ast</a> = <span class="r197 r">ast</span>;
        }
 
        <b>internal</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="ab8983550158b80e" href="../../../R/ab8983550158b80e.html" target="n" data-glyph="74,1" class="i method">GetScriptBlock</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r198 rd" class="r198 r">context</span>, <b>bool</b> <span id="r199 rd" class="r199 r">isFilter</span>)
        {
            <span class="c">// We always clone the result, even when creating a new script block, so that the cached</span>
            <span class="c">// value doesn&#39;t hold on to any session state.</span>
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#5bcb52be7c5dc4ae" class="i field">_scriptBlock</a> == <b>null</b> || <a href="#5bcb52be7c5dc4ae" class="i field">_scriptBlock</a>.<a href="../../lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> == <b>null</b>,
                <span class="s">&quot;Cached script block should not hold on to session state&quot;</span>);
 
            <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="k">var</a> <span id="r200 rd" class="r200 r">result</span> = (<a href="#5bcb52be7c5dc4ae" class="i field">_scriptBlock</a> ??= <b>new</b> <a href="../CompiledScriptBlock.cs.html#7c5e468d9c460238" class="t constructor">ScriptBlock</a>(<a href="#0f113f4e1c741b27" class="i field">_ast</a>, <span class="r199 r">isFilter</span>)).<a href="../CompiledScriptBlock.cs.html#13c9ab07535d8eb6" class="i method">Clone</a>();
            <span class="r200 r">result</span>.<a href="../../lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> = <span class="r198 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            <b>return</b> <span class="r200 r">result</span>;
        }
    }
 
    <b>internal static class</b> <a id="f57bbcaaadf6738d" href="../../../R/f57bbcaaadf6738d.html" target="n" data-glyph="2,0" class="t t">HashtableOps</a>
    {
        <b>internal static void</b> <a id="5e3a6deb307c037c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddKeyValuePair</a>(<span class="i">IDictionary</span> <span id="r201 rd" class="r201 r">hashtable</span>, <b>object</b> <span id="r202 rd" class="r202 r">key</span>, <b>object</b> <span id="r203 rd" class="r203 r">value</span>, <a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r204 rd" class="r204 r">errorExtent</span>)
        {
            <span class="r202 r">key</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r202 r">key</span>);
            <b>if</b> (<span class="r202 r">key</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r201 r">hashtable</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r204 r">errorExtent</span>,
                                                               <span class="s">&quot;InvalidNullKey&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidNullKey</span>);
            }
 
            <b>if</b> (<span class="r201 r">hashtable</span>.<span class="i">Contains</span>(<span class="r202 r">key</span>))
            {
                <span class="c">// convert the key to a string for the error message, trimming if it&#39;s to long...</span>
                <span class="c">// we pass a null context here because we&#39;re not too interested in $OFS.</span>
                <b>string</b> <span id="r205 rd" class="r205 r">errorKeyString</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e87c4fc15a3f59f5" class="i method">ToStringParser</a>(<b>null</b>, <span class="r202 r">key</span>);
 
                <b>if</b> (<span class="r205 r">errorKeyString</span>.<span class="i">Length</span> &gt; 40)
                {
                    <span class="r205 r">errorKeyString</span> = <span class="r205 r">errorKeyString</span>.<span class="i">Substring</span>(0, 40) + <a href="../../../FormatAndOutput/common/Utilities/MshObjectUtil.cs.html#fa81a7bc4f9cb4f0" class="t t">PSObjectHelper</a>.<a href="../../../FormatAndOutput/common/Utilities/MshObjectUtil.cs.html#a5549bfa35c48a67" class="i field">Ellipsis</a>;
                }
 
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r201 r">hashtable</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r204 r">errorExtent</span>,
                    <span class="s">&quot;DuplicateKeyInHashLiteral&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">DuplicateKeyInHashLiteral</span>, <span class="r205 r">errorKeyString</span>);
            }
 
            <span class="r201 r">hashtable</span>.<span class="i">Add</span>(<span class="r202 r">key</span>, <span class="r203 r">value</span>);
        }
 
        <b>internal static object</b> <a id="c9a1fca54d345111" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Add</a>(<span class="i">IDictionary</span> <span id="r206 rd" class="r206 r">lvalDict</span>, <span class="i">IDictionary</span> <span id="r207 rd" class="r207 r">rvalDict</span>)
        {
            <span class="i">IDictionary</span> <span id="r208 rd" class="r208 r">newDictionary</span>;
            <b>if</b> (<span class="r206 r">lvalDict</span> <b>is</b> <span class="i">OrderedDictionary</span>)
            {
                <span class="c">// If the left is ordered, assume they want orderedness preserved.</span>
                <span class="r208 r">newDictionary</span> = <b>new</b> <span class="i">OrderedDictionary</span>(<span class="i">StringComparer</span>.<span class="i">CurrentCultureIgnoreCase</span>);
            }
            <b>else</b>
            {
                <span class="r208 r">newDictionary</span> = <b>new</b> <span class="i">Hashtable</span>(<span class="i">StringComparer</span>.<span class="i">CurrentCultureIgnoreCase</span>);
            }
 
            <span class="c">// Add key and values from left hand side...</span>
            <b>foreach</b> (<b>object</b> <span id="r209 rd" class="r209 r">key</span> <b>in</b> <span class="r206 r">lvalDict</span>.<span class="i">Keys</span>)
            {
                <span class="r208 r">newDictionary</span>.<span class="i">Add</span>(<span class="r209 r">key</span>, <span class="r206 r">lvalDict</span>[<span class="r209 r">key</span>]);
            }
 
            <span class="c">// and the right-hand side</span>
            <b>foreach</b> (<b>object</b> <span id="r210 rd" class="r210 r">key</span> <b>in</b> <span class="r207 r">rvalDict</span>.<span class="i">Keys</span>)
            {
                <span class="r208 r">newDictionary</span>.<span class="i">Add</span>(<span class="r210 r">key</span>, <span class="r207 r">rvalDict</span>[<span class="r210 r">key</span>]);
            }
 
            <b>return</b> <span class="r208 r">newDictionary</span>;
        }
    }
 
    <b>internal static class</b> <a id="2b2e6cffbdd33d20" href="../../../R/2b2e6cffbdd33d20.html" target="n" data-glyph="2,0" class="t t">ExceptionHandlingOps</a>
    {
        <b>internal class</b> <a id="442e10289fb2ec35" href="../../../R/442e10289fb2ec35.html" target="n" data-glyph="2,1" class="t t"><span id="e17f9d395c9cfcb9">CatchAll</span></a> { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Represent a handler search result.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private sealed class</b> <a id="59191834d65541d2" href="../../../R/59191834d65541d2.html" target="n" data-glyph="4,1" class="t t">HandlerSearchResult</a>
        {
            <b>internal</b> <a id="c4732e823fab5eda" href="../../../R/c4732e823fab5eda.html" target="n" data-glyph="74,2" class="t constructor">HandlerSearchResult</a>()
            {
                <a href="#94b507217b2232b2" class="i field">Handler</a> = -1;
                <a href="#bd3a12ae964dfa02" class="i field">Rank</a> = <b>int</b>.<span class="i">MaxValue</span>;
                <a href="#2ae8f3b59b5172d2" class="i field">ExceptionToPass</a> = <b>null</b>;
                <a href="#d1f817b4602ee7cc" class="i field">ErrorRecordToPass</a> = <b>null</b>;
            }
 
            <b>internal int</b> <a id="94b507217b2232b2" href="../../../R/94b507217b2232b2.html" target="n" data-glyph="44,2" class="i field">Handler</a>;
            <b>internal int</b> <a id="bd3a12ae964dfa02" href="../../../R/bd3a12ae964dfa02.html" target="n" data-glyph="44,2" class="i field">Rank</a>;
            <b>internal</b> <span class="i">Exception</span> <a id="2ae8f3b59b5172d2" href="../../../R/2ae8f3b59b5172d2.html" target="n" data-glyph="44,2" class="i field">ExceptionToPass</a>;
            <b>internal</b> <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="d1f817b4602ee7cc" href="../../../R/d1f817b4602ee7cc.html" target="n" data-glyph="44,2" class="i field">ErrorRecordToPass</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Rank the exception types based on how specific they are.</span>
        <span class="c">///</span><span class="c"> Smaller ranking number indicates more specific exception type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ranking number for each type represent how many other</span>
        <span class="c">///</span><span class="c"> types from the array derive from it.</span>
        <span class="c">///</span><span class="c"> For example, 0 means no other types in the array derive from</span>
        <span class="c">///</span><span class="c"> the corresponding type, while 3 means there are 3 other types</span>
        <span class="c">///</span><span class="c"> in the array actually derive from the corresponding type.</span>
        <span class="c">///</span><span class="c"> &#39;CatchAll&#39; is considered to be derived by all exception types.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private static int</b>[] <a id="521f41f4581b0528" href="../../../R/521f41f4581b0528.html" target="n" data-glyph="76,1" class="i method">RankExceptionTypes</a>(<span class="i">Type</span>[] <span id="r211 rd" class="r211 r">types</span>)
        {
            <b>int</b>[] <span id="r212 rd" class="r212 r">ranks</span> = <b>new</b> <b>int</b>[<span class="r211 r">types</span>.<span class="i">Length</span>];
            <b>int</b> <span id="r213 rd" class="r213 r">length</span> = <span class="r211 r">types</span>.<span class="i">Length</span>;
 
            <span class="c">// If &#39;CatchAll&#39; is specified, it must be the last catch block.</span>
            <span class="c">// Handle it specially. This can save a few iterations in the</span>
            <span class="c">// &#39;for&#39; loop below, and also avoid some type comparisons.</span>
            <b>if</b> (<span class="r211 r">types</span>[<span class="r213 r">length</span> - 1].<span class="i">Equals</span>(<b>typeof</b>(<a href="#442e10289fb2ec35" class="t t">CatchAll</a>)))
            {
                <span class="r212 r">ranks</span>[<span class="r213 r">length</span> - 1] = <span class="r213 r">length</span> - 1;
                <span class="r213 r">length</span> -= 1;
            }
 
            <span class="c">// For each type check if it&#39;s a sub-class of any types after it.</span>
            <span class="c">// The ordering of the type array guarantees the more specific type comes first.</span>
            <b>for</b> (<b>int</b> <span id="r214 rd" class="r214 r">i</span> = 0; <span class="r214 r">i</span> &lt; <span class="r213 r">length</span> - 1; <span class="r214 r">i</span>++)
            {
                <b>for</b> (<b>int</b> <span id="r215 rd" class="r215 r">j</span> = <span class="r214 r">i</span> + 1; <span class="r215 r">j</span> &lt; <span class="r213 r">length</span>; <span class="r215 r">j</span>++)
                {
                    <b>if</b> (<span class="r211 r">types</span>[<span class="r214 r">i</span>].<span class="i">IsSubclassOf</span>(<span class="r211 r">types</span>[<span class="r215 r">j</span>]))
                        <span class="r212 r">ranks</span>[<span class="r215 r">j</span>]++;
                }
            }
 
            <b>return</b> <span class="r212 r">ranks</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Search for handler by the exception type and process the found result.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="bd336e46a2719005" href="../../../R/bd336e46a2719005.html" target="n" data-glyph="76,1" class="i method">FindAndProcessHandler</a>(<span class="i">Type</span>[] <span id="r216 rd" class="r216 r">types</span>, <b>int</b>[] <span id="r217 rd" class="r217 r">ranks</span>,
                                                  <a href="#59191834d65541d2" class="t t">HandlerSearchResult</a> <span id="r218 rd" class="r218 r">current</span>,
                                                  <span class="i">Exception</span> <span id="r219 rd" class="r219 r">exception</span>,
                                                  <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r220 rd" class="r220 r">errorRecord</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r218 r">current</span> != <b>null</b>, <span class="s">&quot;Caller makes sure &#39;current&#39; is not null.&quot;</span>);
            <b>int</b> <span id="r221 rd" class="r221 r">handler</span> = <span class="i">FindMatchingHandlerByType</span>(<span class="r219 r">exception</span>.<span class="i">GetType</span>(), <span class="r216 r">types</span>);
 
            <span class="c">// If no handler was found, return without changing the current result.</span>
            <b>if</b> (<span class="r221 r">handler</span> == -1) { <b>return</b>; }
 
            <span class="c">// New handler was found.</span>
            <span class="c">//  - If new-rank is less than current-rank -- meaning the new handler is more specific,</span>
            <span class="c">//    then we update the current result with it.</span>
            <span class="c">//  - If new-rank is more than current-rank -- meaning the new handler is less specific,</span>
            <span class="c">//    then we do NOT change the current result.</span>
            <span class="c">//  - If new-rank is equal to current-rank, we do NOT change the current result UNLESS the</span>
            <span class="c">//    current handler is catch-all. (This is to keep the original behavior -- prefer to use</span>
            <span class="c">//    the later found exception as the exception-to-pass-in if all exceptions result in the</span>
            <span class="c">//    catch-all handler.</span>
            <b>int</b> <span id="r222 rd" class="r222 r">rank</span> = <span class="r217 r">ranks</span>[<span class="r221 r">handler</span>];
            <b>if</b> (<span class="r222 r">rank</span> &lt; <span class="r218 r">current</span>.<a href="#bd3a12ae964dfa02" class="i field">Rank</a> ||
                (<span class="r222 r">rank</span> == <span class="r218 r">current</span>.<a href="#bd3a12ae964dfa02" class="i field">Rank</a> &amp;&amp; <span class="r216 r">types</span>[<span class="r218 r">current</span>.<a href="#94b507217b2232b2" class="i field">Handler</a>].<span class="i">Equals</span>(<b>typeof</b>(<a href="#442e10289fb2ec35" class="t t">CatchAll</a>)))
               )
            {
                <span class="r218 r">current</span>.<a href="#94b507217b2232b2" class="i field">Handler</a> = <span class="r221 r">handler</span>;
                <span class="r218 r">current</span>.<a href="#bd3a12ae964dfa02" class="i field">Rank</a> = <span class="r222 r">rank</span>;
                <span class="r218 r">current</span>.<a href="#2ae8f3b59b5172d2" class="i field">ExceptionToPass</a> = <span class="r219 r">exception</span>;
                <span class="r218 r">current</span>.<a href="#d1f817b4602ee7cc" class="i field">ErrorRecordToPass</a> = <span class="r220 r">errorRecord</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the matching handler for the caught exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static int</b> <a id="00a2905784efb62c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">FindMatchingHandler</a>(<a href="../MutableTuple.cs.html#d4c692d6a8bac31d" class="t t">MutableTuple</a> <span id="r223 rd" class="r223 r">tuple</span>, <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r224 rd" class="r224 r">rte</span>, <span class="i">Type</span>[] <span id="r225 rd" class="r225 r">types</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r226 rd" class="r226 r">context</span>)
        {
            <b>bool</b> <span id="r227 rd" class="r227 r">continueToSearch</span> = <b>false</b>;
            <b>int</b>[] <span id="r228 rd" class="r228 r">ranks</span> = <a href="#521f41f4581b0528" class="i method">RankExceptionTypes</a>(<span class="r225 r">types</span>);
            <a href="#59191834d65541d2" class="k">var</a> <span id="r229 rd" class="r229 r">current</span> = <b>new</b> <a href="#c4732e823fab5eda" class="t constructor">HandlerSearchResult</a>();
 
            <b>do</b>
            {
                <span class="c">// Always assume no need to repeat the search for another interation</span>
                <span class="r227 r">continueToSearch</span> = <b>false</b>;
                <span class="c">// The &#39;ErrorRecord&#39; of the current RuntimeException would be passed to $_</span>
                <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r230 rd" class="r230 r">errorRecordToPass</span> = <span class="r224 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>;
 
                <span class="i">Exception</span> <span id="r231 rd" class="r231 r">inner</span> = <span class="r224 r">rte</span>.<span class="i">InnerException</span>;
                <b>if</b> (<span class="r231 r">inner</span> != <b>null</b>)
                {
                    <a href="#bd336e46a2719005" class="i method">FindAndProcessHandler</a>(<span class="r225 r">types</span>, <span class="r228 r">ranks</span>, <span class="r229 r">current</span>, <span class="r231 r">inner</span>, <span class="r230 r">errorRecordToPass</span>);
                }
 
                <span class="c">// If no handler was found (rank = int.MaxValue), or if the handler we found was not</span>
                <span class="c">// the most specific one, then look again, this time using the outer exception.</span>
                <span class="c">// If we found a handler, but not one of the most specific ones (rank != 0), there may</span>
                <span class="c">// be a more specific handler that catches outer but not inner exception.</span>
                <b>if</b> (<span class="r229 r">current</span>.<a href="#bd3a12ae964dfa02" class="i field">Rank</a> &gt; 0)
                {
                    <span class="i">FindAndProcessHandler</span>(<span class="r225 r">types</span>, <span class="r228 r">ranks</span>, <span class="r229 r">current</span>, <span class="r224 r">rte</span>, <span class="r230 r">errorRecordToPass</span>);
                }
 
                <span class="c">// If we still didn&#39;t find one of the most specific handlers (rank != 0), we&#39;ll try unwrapping a few other of our exceptions:</span>
                <span class="c">//     ActionPreferenceStopException - to cover &#39;-ea stop&#39;</span>
                <span class="c">//         try { gci nosuchfile -ea stop } catch [System.Management.Automation.ItemNotFoundException] { &#39;caught&#39; }</span>
                <span class="c">//     CmdletInvocationException - to cover cmdlets like Invoke-Expression</span>
                <b>if</b> (<span class="r229 r">current</span>.<a href="#bd3a12ae964dfa02" class="i field">Rank</a> &gt; 0)
                {
                    <a href="../../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="k">var</a> <span id="r232 rd" class="r232 r">apse</span> = <span class="r224 r">rte</span> <b>as</b> <a href="../../../utils/ExecutionExceptions.cs.html#f896df45dff24981" class="t t">ActionPreferenceStopException</a>;
                    <b>if</b> (<span class="r232 r">apse</span> != <b>null</b>)
                    {
                        <b>var</b> <span id="r233 rd" class="r233 r">exceptionToPass</span> = <span class="r232 r">apse</span>.<a href="../../../utils/ExecutionExceptions.cs.html#81113987450d3603" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>;
 
                        <span class="c">// If it&#39;s again a RuntimeException, we repeat the search using it</span>
                        <span class="r224 r">rte</span> = <span class="r233 r">exceptionToPass</span> <b>as</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>;
                        <b>if</b> (<span class="r224 r">rte</span> != <b>null</b>)
                        {
                            <span class="r227 r">continueToSearch</span> = <b>true</b>;
                        }
                        <b>else</b> <b>if</b> (<span class="r233 r">exceptionToPass</span> != <b>null</b>)
                        {
                            <a href="#bd336e46a2719005" class="i method">FindAndProcessHandler</a>(<span class="r225 r">types</span>, <span class="r228 r">ranks</span>, <span class="r229 r">current</span>, <span class="r233 r">exceptionToPass</span>, <span class="r230 r">errorRecordToPass</span>);
                        }
                    }
                    <b>else</b> <b>if</b> (<span class="r224 r">rte</span> <b>is</b> <a href="../../../utils/ExecutionExceptions.cs.html#7b242746a433b370" class="t t">CmdletInvocationException</a> &amp;&amp; <span class="r231 r">inner</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r231 r">inner</span>.<span class="i">InnerException</span> != <b>null</b>)
                        {
                            <span class="i">FindAndProcessHandler</span>(<span class="r225 r">types</span>, <span class="r228 r">ranks</span>, <span class="r229 r">current</span>, <span class="r231 r">inner</span>.<span class="i">InnerException</span>, <span class="r230 r">errorRecordToPass</span>);
                        }
                    }
                }
            } <b>while</b> (<span class="r227 r">continueToSearch</span>);
 
            <b>if</b> (<span class="r229 r">current</span>.<a href="#94b507217b2232b2" class="i field">Handler</a> != -1)
            {
                <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r234 rd" class="r234 r">errorRecord</span> = <b>new</b> <a href="../../ErrorPackage.cs.html#9d778b0f7802757e" class="t constructor">ErrorRecord</a>(<span class="r229 r">current</span>.<a href="#d1f817b4602ee7cc" class="i field">ErrorRecordToPass</a>, <span class="r229 r">current</span>.<a href="#2ae8f3b59b5172d2" class="i field">ExceptionToPass</a>);
                <span class="r223 r">tuple</span>.<a href="../MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="../../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../../SpecialVariables.cs.html#3599fdc9d261201f" class="i field">Underbar</a>, <span class="r234 r">errorRecord</span>, <span class="r226 r">context</span>);
            }
 
            <b>return</b> <span class="r229 r">current</span>.<a href="#94b507217b2232b2" class="i field">Handler</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the matching handler by the exception type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static int</b> <a id="579dd1f2190dee74" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FindMatchingHandlerByType</a>(<span class="i">Type</span> <span id="r235 rd" class="r235 r">exceptionType</span>, <span class="i">Type</span>[] <span id="r236 rd" class="r236 r">types</span>)
        {
            <b>int</b> <span id="r237 rd" class="r237 r">i</span>;
 
            <span class="c">// pass 1 - exact match (this pass isn&#39;t needed for catch handlers because the ordering</span>
            <span class="c">// guarantees more specific handlers come first.)</span>
            <b>for</b> (<span class="r237 r">i</span> = 0; <span class="r237 r">i</span> &lt; <span class="r236 r">types</span>.<span class="i">Length</span>; ++<span class="r237 r">i</span>)
            {
                <b>if</b> (<span class="r235 r">exceptionType</span>.<span class="i">Equals</span>(<span class="r236 r">types</span>[<span class="r237 r">i</span>]))
                    <b>return</b> <span class="r237 r">i</span>;
            }
 
            <span class="c">// pass 2 - subclass</span>
            <b>for</b> (<span class="r237 r">i</span> = 0; <span class="r237 r">i</span> &lt; <span class="r236 r">types</span>.<span class="i">Length</span>; ++<span class="r237 r">i</span>)
            {
                <b>if</b> (<span class="r235 r">exceptionType</span>.<span class="i">IsSubclassOf</span>(<span class="r236 r">types</span>[<span class="r237 r">i</span>]))
                    <b>return</b> <span class="r237 r">i</span>;
            }
 
            <span class="c">// pass 3 - untyped catchall handler...</span>
            <span class="c">//   if there is more than one (can only happen with traps), return the first.</span>
            <span class="c">//   it might be nice to enforce a single default in strict mode.</span>
            <b>for</b> (<span class="r237 r">i</span> = 0; <span class="r237 r">i</span> &lt; <span class="r236 r">types</span>.<span class="i">Length</span>; ++<span class="r237 r">i</span>)
            {
                <b>if</b> (<span class="r236 r">types</span>[<span class="r237 r">i</span>].<span class="i">Equals</span>(<b>typeof</b>(<a href="#442e10289fb2ec35" class="t t">CatchAll</a>)))
                    <b>return</b> <span class="r237 r">i</span>;
            }
 
            <b>return</b> -1;
        }
 
        <b>internal static bool</b> <a id="26b35c1060c27f5c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SuspendStoppingPipeline</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r238 rd" class="r238 r">context</span>)
        {
            <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a> <span id="r239 rd" class="r239 r">lpl</span> = (<a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>)<span class="r238 r">context</span>.<a href="../../ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>.<a href="../../hostifaces/Connection.cs.html#9db062bececf98bd" class="i method">GetCurrentlyRunningPipeline</a>();
            <b>if</b> (<span class="r239 r">lpl</span> != <b>null</b>)
            {
                <b>bool</b> <span id="r240 rd" class="r240 r">oldIsStopping</span> = <span class="r239 r">lpl</span>.<a href="../../hostifaces/LocalPipeline.cs.html#e26f018d14abb8bd" class="i property">Stopper</a>.<a href="../../hostifaces/LocalPipeline.cs.html#ca074238a7f39694" class="i property">IsStopping</a>;
                <span class="r239 r">lpl</span>.<a href="../../hostifaces/LocalPipeline.cs.html#e26f018d14abb8bd" class="i property">Stopper</a>.<a href="../../hostifaces/LocalPipeline.cs.html#ca074238a7f39694" class="i property">IsStopping</a> = <b>false</b>;
                <b>return</b> <span class="r240 r">oldIsStopping</span>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static void</b> <a id="017652e13fe7b172" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">RestoreStoppingPipeline</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r241 rd" class="r241 r">context</span>, <b>bool</b> <span id="r242 rd" class="r242 r">oldIsStopping</span>)
        {
            <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a> <span id="r243 rd" class="r243 r">lpl</span> = (<a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>)<span class="r241 r">context</span>.<a href="../../ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>.<a href="../../hostifaces/Connection.cs.html#9db062bececf98bd" class="i method">GetCurrentlyRunningPipeline</a>();
            <b>if</b> (<span class="r243 r">lpl</span> != <b>null</b>)
            {
                <span class="r243 r">lpl</span>.<a href="../../hostifaces/LocalPipeline.cs.html#e26f018d14abb8bd" class="i property">Stopper</a>.<a href="../../hostifaces/LocalPipeline.cs.html#ca074238a7f39694" class="i property">IsStopping</a> = <span class="r242 r">oldIsStopping</span>;
            }
        }
 
        <b>internal static void</b> <a id="edfa7fd4ff08fb3c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CheckActionPreference</a>(<a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r244 rd" class="r244 r">funcContext</span>, <span class="i">Exception</span> <span id="r245 rd" class="r245 r">exception</span>)
        {
            <b>if</b> (<span class="r245 r">exception</span> <b>is</b> <span class="i">TargetInvocationException</span>)
            {
                <span class="c">// Always unwrap TargetInvocationException.</span>
                <span class="r245 r">exception</span> = <span class="r245 r">exception</span>.<span class="i">InnerException</span>;
            }
 
            <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="k">var</a> <span id="r246 rd" class="r246 r">rte</span> = <span class="r245 r">exception</span> <b>as</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>;
            <b>if</b> (<span class="r246 r">rte</span> == <b>null</b>)
            {
                <span class="r246 r">rte</span> = <a href="#5a3a1336d3429bb1" class="i method">ConvertToRuntimeException</a>(<span class="r245 r">exception</span>, <span class="r244 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#5ed77de1a1fe863f" class="i property">CurrentPosition</a>);
            }
            <b>else</b>
            {
                <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r246 r">rte</span>, <span class="r244 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#5ed77de1a1fe863f" class="i property">CurrentPosition</a>);
            }
 
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r247 rd" class="r247 r">context</span> = <span class="r244 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>;
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="k">var</a> <span id="r248 rd" class="r248 r">outputPipe</span> = <span class="r244 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>;
 
            <a href="../../parser/Position.cs.html#bbc751d075344454" class="k">var</a> <span id="r249 rd" class="r249 r">extent</span> = <span class="r246 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#fd1ac7b3462d4426" class="i property">InvocationInfo</a>.<a href="../../InvocationInfo.cs.html#36c1c0cc46ab70ad" class="i property">ScriptPosition</a>;
            <a href="#c7c5b369a867fd0c" class="i method">SetErrorVariables</a>(<span class="r249 r">extent</span>, <span class="r246 r">rte</span>, <span class="r247 r">context</span>, <span class="r248 r">outputPipe</span>);
 
            <span class="c">// set $? to false indicating an error</span>
            <span class="r247 r">context</span>.<a href="../../ExecutionContext.cs.html#1086e67bac3e5c3a" class="i property">QuestionMarkVariableValue</a> = <b>false</b>;
 
            <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <span id="r250 rd" class="r250 r">preference</span> = <a href="#2a3245973127cda4" class="i method">GetErrorActionPreference</a>(<span class="r247 r">context</span>);
 
            <span class="c">// If the exception was not rethrown and we are not currently</span>
            <span class="c">// handling an exception, then the exception is new, and we</span>
            <span class="c">// can break on it if requested.</span>
            <b>if</b> (!<span class="r246 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#99bdea55589a9bb4" class="i property">WasRethrown</a> &amp;&amp;
                <span class="r247 r">context</span>.<a href="../../ExecutionContext.cs.html#e379042dcc553e8d" class="i property">CurrentExceptionBeingHandled</a> == <b>null</b> &amp;&amp;
                <span class="r250 r">preference</span> == <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#9aa56fcd5aaa3137" class="i field">Break</a>)
            {
                <span class="r247 r">context</span>.<a href="../../ExecutionContext.cs.html#3e56b2d709de0d80" class="i property">Debugger</a>?.<a href="../../debugger/debugger.cs.html#0ebffcc754a06736" class="i method">Break</a>(<span class="r246 r">rte</span>);
            }
 
            <span class="c">// Item2 in the trap tuples is the action (script) for the trap.</span>
            <span class="c">// A null action script is only used to indicate when exceptions</span>
            <span class="c">// should be thrown up to a higher level, and doesn&#39;t count as an</span>
            <span class="c">// actual trap handler in the function context.</span>
            <b>bool</b> <span id="r251 rd" class="r251 r">anyTrapHandlers</span> = <span class="r244 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#8df161901eca9056" class="i field">_traps</a>.<span class="i">Count</span> &gt; 0 &amp;&amp; <span class="r244 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#8df161901eca9056" class="i field">_traps</a>[<span class="r244 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#8df161901eca9056" class="i field">_traps</a>.<span class="i">Count</span> - 1].<span class="i">Item2</span> != <b>null</b>;
 
            <b>if</b> (<span class="r251 r">anyTrapHandlers</span>)
            {
                <span class="c">// update the action preference according to how the exception is</span>
                <span class="c">// handled in the trap statement(s).</span>
                <span class="r250 r">preference</span> = <a href="#178536324abdb951" class="i method">ProcessTraps</a>(<span class="r244 r">funcContext</span>, <span class="r246 r">rte</span>);
            }
            <b>else</b> <b>if</b> (<a href="#928b8c5e761a2273" class="i method">ExceptionCannotBeStoppedContinuedOrIgnored</a>(<span class="r246 r">rte</span>, <span class="r247 r">context</span>))
            {
                <b>throw</b> <span class="r246 r">rte</span>;
            }
            <b>else</b> <b>if</b> (<span class="r250 r">preference</span> == <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#acaaaa2f0a580cb4" class="i field">Inquire</a> &amp;&amp; !<span class="r246 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#a3e1fa4579675275" class="i property">SuppressPromptInInterpreter</a>)
            {
                <span class="r250 r">preference</span> = <span class="i">InquireForActionPreference</span>(<span class="r246 r">rte</span>.<span class="i">Message</span>, <span class="r247 r">context</span>);
            }
 
            <b>if</b> ((<span class="r250 r">preference</span> == <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#e5c6f06e809b81d8" class="i field">SilentlyContinue</a>) ||
                (<span class="r250 r">preference</span> == <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>))
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r250 r">preference</span> == <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>)
            {
                <span class="c">// The interpreter prompt CommandBaseStrings:InquireHalt</span>
                <span class="c">// should be suppressed when this flag is set.  This will be set</span>
                <span class="c">// when this prompt has already occurred and Break was chosen,</span>
                <span class="c">// or for ActionPreferenceStopException in all cases.</span>
                <span class="r246 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#a3e1fa4579675275" class="i property">SuppressPromptInInterpreter</a> = <b>true</b>;
 
                <b>throw</b> <span class="r246 r">rte</span>;
            }
 
            <b>if</b> (!<span class="r251 r">anyTrapHandlers</span> &amp;&amp; <span class="r246 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a>)
            {
                <b>throw</b> <span class="r246 r">rte</span>;
            }
 
            <b>if</b> (!<a href="#6cf6d108406e3bdf" class="i method">ReportErrorRecord</a>(<span class="r249 r">extent</span>, <span class="r246 r">rte</span>, <span class="r247 r">context</span>))
            {
                <b>throw</b> <span class="r246 r">rte</span>;
            }
        }
 
        <b>private static</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <a id="178536324abdb951" href="../../../R/178536324abdb951.html" target="n" data-glyph="76,1" class="i method">ProcessTraps</a>(<a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r252 rd" class="r252 r">funcContext</span>,
                                                     <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r253 rd" class="r253 r">rte</span>)
        {
            <b>int</b> <span id="r254 rd" class="r254 r">handler</span> = -1;
            <span class="i">Exception</span> <span id="r255 rd" class="r255 r">exception</span> = <b>null</b>;
            <span class="i">Exception</span> <span id="r256 rd" class="r256 r">inner</span> = <span class="r253 r">rte</span>.<span class="i">InnerException</span>;
 
            <b>var</b> <span id="r257 rd" class="r257 r">types</span> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#8df161901eca9056" class="i field">_traps</a>.<span class="i">Last</span>().<span class="i">Item1</span>;
            <b>var</b> <span id="r258 rd" class="r258 r">handlers</span> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#8df161901eca9056" class="i field">_traps</a>.<span class="i">Last</span>().<span class="i">Item2</span>;
 
            <b>if</b> (<span class="r256 r">inner</span> != <b>null</b>)
            {
                <span class="r254 r">handler</span> = <span class="i">FindMatchingHandlerByType</span>(<span class="r256 r">inner</span>.<span class="i">GetType</span>(), <span class="r257 r">types</span>);
                <span class="r255 r">exception</span> = <span class="r256 r">inner</span>;
            }
 
            <span class="c">// If no handler was found, or if the handler we found was the catch all handler,</span>
            <span class="c">// then look again, this time using the outer exception.  If, when looking with the inner,</span>
            <span class="c">// we found the catch all, there may be a handler that catches outer but not inner.</span>
            <b>if</b> (<span class="r254 r">handler</span> == -1 || <span class="r257 r">types</span>[<span class="r254 r">handler</span>].<span class="i">Equals</span>(<b>typeof</b>(<a href="#442e10289fb2ec35" class="t t">CatchAll</a>)))
            {
                <b>int</b> <span id="r259 rd" class="r259 r">outerHandler</span> = <span class="i">FindMatchingHandlerByType</span>(<span class="r253 r">rte</span>.<span class="i">GetType</span>(), <span class="r257 r">types</span>);
                <b>if</b> (<span class="r259 r">outerHandler</span> != <span class="r254 r">handler</span>)
                {
                    <span class="r254 r">handler</span> = <span class="r259 r">outerHandler</span>;
                    <span class="r255 r">exception</span> = <span class="r253 r">rte</span>;
                }
            }
 
            <b>if</b> (<span class="r254 r">handler</span> != -1)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r255 r">exception</span> != <b>null</b>, <span class="s">&quot;Exception object can&#39;t be null.&quot;</span>);
 
                <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r260 rd" class="r260 r">context</span> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>;
 
                <b>try</b>
                {
                    <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r261 rd" class="r261 r">err</span> = <span class="r253 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>;
                    <span class="c">// CurrentCommandProcessor is normally not null, but it is null</span>
                    <span class="c">// when executing some unit tests through reflection.</span>
                    <b>if</b> (<span class="r260 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a> != <b>null</b>)
                    {
                        <span class="r260 r">context</span>.<a href="../../ExecutionContext.cs.html#1146573afe2845c8" class="i property">CurrentCommandProcessor</a>.<a href="../../CommandProcessorBase.cs.html#072501da99fba9ed" class="i method">ForgetScriptException</a>();
                    }
 
                    <b>try</b>
                    {
                        <span class="c">// Invoke the trap statement body, passing in the exception...</span>
                        <a href="../MutableTuple.cs.html#d4c692d6a8bac31d" class="k">var</a> <span id="r262 rd" class="r262 r">locals</span> = <a href="../MutableTuple.cs.html#d4c692d6a8bac31d" class="t t">MutableTuple</a>.<span class="i">MakeTuple</span>(<span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#8df161901eca9056" class="i field">_traps</a>.<span class="i">Last</span>().<span class="i">Item3</span>[<span class="r254 r">handler</span>], <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#8a3b323becd5e9eb" class="i field">DottedLocalsNameIndexMap</a>);
                        <span class="c">// Copy automatic variables into the new scope (not necessarily required because dynamic scoping</span>
                        <span class="c">// would find them in the parent scope, but internal code might avoid dynamic lookup so copy</span>
                        <span class="c">// to be safe.</span>
 
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="../../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../../SpecialVariables.cs.html#3599fdc9d261201f" class="i field">Underbar</a> == 0, <span class="s">&quot;Code below relies on this assertion being true.&quot;</span>);
                        <span class="r262 r">locals</span>.<a href="../MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="../../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../../SpecialVariables.cs.html#3599fdc9d261201f" class="i field">Underbar</a>, <b>new</b> <a href="../../ErrorPackage.cs.html#9d778b0f7802757e" class="t constructor">ErrorRecord</a>(<span class="r261 r">err</span>, <span class="r255 r">exception</span>), <span class="r260 r">context</span>);
                        <b>for</b> (<b>int</b> <span id="r263 rd" class="r263 r">i</span> = 1; <span class="r263 r">i</span> &lt; (<b>int</b>)<a href="../../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../../SpecialVariables.cs.html#d64e69972d70be92" class="i field">NumberOfAutomaticVariables</a>; ++<span class="r263 r">i</span>)
                        {
                            <span class="r262 r">locals</span>.<a href="../MutableTuple.cs.html#e29ef8d980593d33" class="i method">SetValue</a>(<span class="r263 r">i</span>, <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#23a9d5ac6a3b086b" class="i field">_localsTuple</a>.<a href="../MutableTuple.cs.html#cc32e7a36d6c27bd" class="i method">GetValue</a>(<span class="r263 r">i</span>));
                        }
 
                        <a href="../../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r264 rd" class="r264 r">newScope</span> = <span class="r260 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#27e7de485699a643" class="i method">NewScope</a>(<b>false</b>);
                        <span class="r260 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> = <span class="r264 r">newScope</span>;
                        <span class="r264 r">newScope</span>.<a href="../../SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a> = <span class="r262 r">locals</span>;
 
                        <a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="k">var</a> <span id="r265 rd" class="r265 r">trapFuncContext</span> = <b>new</b> <span class="t">FunctionContext</span>
                        {
                            <a href="../../parser/Compiler.cs.html#95a73081cffaa015" class="i field">_file</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#95a73081cffaa015" class="i field">_file</a>,
                            <a href="../../parser/Compiler.cs.html#4980a1f93a561cb3" class="i field">_scriptBlock</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#4980a1f93a561cb3" class="i field">_scriptBlock</a>,
                            <a href="../../parser/Compiler.cs.html#354889e302c1693c" class="i field">_sequencePoints</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#354889e302c1693c" class="i field">_sequencePoints</a>,
                            <a href="../../parser/Compiler.cs.html#f9539890beb6e765" class="i field">_debuggerHidden</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#f9539890beb6e765" class="i field">_debuggerHidden</a>,
                            <a href="../../parser/Compiler.cs.html#f82ab745f95a8791" class="i field">_debuggerStepThrough</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#f82ab745f95a8791" class="i field">_debuggerStepThrough</a>,
                            <a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#86d08ccdd0602a1b" class="i field">_executionContext</a>,
                            <a href="../../parser/Compiler.cs.html#18b1921c6a906819" class="i field">_boundBreakpoints</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#18b1921c6a906819" class="i field">_boundBreakpoints</a>,
                            <a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#6c44d518392049f0" class="i field">_outputPipe</a>,
                            <a href="../../parser/Compiler.cs.html#cc249a58ac34eb70" class="i field">_breakPoints</a> = <span class="r252 r">funcContext</span>.<a href="../../parser/Compiler.cs.html#cc249a58ac34eb70" class="i field">_breakPoints</a>,
                            <a href="../../parser/Compiler.cs.html#23a9d5ac6a3b086b" class="i field">_localsTuple</a> = <span class="r262 r">locals</span>,
                        };
 
                        <span class="r258 r">handlers</span>[<span class="r254 r">handler</span>](<span class="r265 r">trapFuncContext</span>);
                    }
                    <b>catch</b> (<span class="i">TargetInvocationException</span> <span id="r266 rd" class="r266 r">tie</span>)
                    {
                        <b>throw</b> <span class="r266 r">tie</span>.<span class="i">InnerException</span>;
                    }
                    <b>finally</b>
                    {
                        <span class="r260 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#729d02bb53189219" class="i method">RemoveScope</a>(<span class="r260 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>);
                    }
 
                    <b>return</b> <a href="#2b2e6cffbdd33d20" class="t t">ExceptionHandlingOps</a>.<span class="i">QueryForAction</span>(<span class="r253 r">rte</span>, <span class="r255 r">exception</span>.<span class="i">Message</span>, <span class="r260 r">context</span>);
                }
                <b>catch</b> (<a href="../../lang/parserutils.cs.html#bef3416feb6ab79b" class="t t">ContinueException</a>)
                {
                    <span class="c">// Just continue on to the next statement.</span>
                    <b>return</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#e5c6f06e809b81d8" class="i field">SilentlyContinue</a>;
                }
                <b>catch</b> (<a href="../../lang/parserutils.cs.html#8b17292837a7f9fe" class="t t">BreakException</a>)
                {
                    <span class="c">// Terminate this block of statements.</span>
                    <b>return</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>;
                }
                <b>finally</b>
                {
                    <span class="c">// The questionmark variable will always be false when we process a trap, so</span>
                    <span class="c">// set it to false to ensure it didn&#39;t change as a result of anything done</span>
                    <span class="c">// inside the trap</span>
                    <span class="r260 r">context</span>.<a href="../../ExecutionContext.cs.html#1086e67bac3e5c3a" class="i property">QuestionMarkVariableValue</a> = <b>false</b>;
                }
            }
 
            <b>return</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the current error action preference value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r267 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The preference the user selected.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Error action is decided by error action preference. If preference is inquire, we will</span>
        <span class="c">///</span><span class="c"> prompt user for their preference.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <a id="2a3245973127cda4" href="../../../R/2a3245973127cda4.html" target="n" data-glyph="74,1" class="i method">GetErrorActionPreference</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r267 rd" class="r267 r">context</span>)
        {
            <b>return</b> <span class="r267 r">context</span>.<a href="../../ExecutionContext.cs.html#e66ab93387349c55" class="i method">GetEnumPreference</a>(
                <a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#8f0a1d2bb6fc8f1c" class="i field">ErrorActionPreferenceVarPath</a>,
                <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#0d6a3114b77f011d" class="i field">Continue</a>,
                <b>out _</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determine if we should continue or not after an error or exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r268 r">rte</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The RuntimeException which was reported.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r269 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The message to display.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r270 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The preference the user selected.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Error action is decided by error action preference. If preference is inquire, we will</span>
        <span class="c">///</span><span class="c"> prompt user for their preference.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <a id="11dde8579d246942" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">QueryForAction</a>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r268 rd" class="r268 r">rte</span>, <b>string</b> <span id="r269 rd" class="r269 r">message</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r270 rd" class="r270 r">context</span>)
        {
            <span class="c">// 906264 &quot;$ErrorActionPreference=&quot;Inquire&quot; prevents original non-terminating error from being reported to $error&quot;</span>
            <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <span id="r271 rd" class="r271 r">preference</span> =
                <span class="r270 r">context</span>.<a href="../../ExecutionContext.cs.html#e66ab93387349c55" class="i method">GetEnumPreference</a>(
                    <a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#8f0a1d2bb6fc8f1c" class="i field">ErrorActionPreferenceVarPath</a>,
                    <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#0d6a3114b77f011d" class="i field">Continue</a>,
                    <b>out _</b>);
 
            <b>if</b> (<span class="r271 r">preference</span> != <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#acaaaa2f0a580cb4" class="i field">Inquire</a> || <span class="r268 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#a3e1fa4579675275" class="i property">SuppressPromptInInterpreter</a>)
                <b>return</b> <span class="r271 r">preference</span>;
 
            <b>return</b> <a href="#be02f7b04e2728be" class="i method">InquireForActionPreference</a>(<span class="r269 r">message</span>, <span class="r270 r">context</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is a helper function for prompting for user preference.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r272 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r273 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method will allow user to enter suspend mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a> <a id="be02f7b04e2728be" href="../../../R/be02f7b04e2728be.html" target="n" data-glyph="74,1" class="i method">InquireForActionPreference</a>(<b>string</b> <span id="r272 rd" class="r272 r">message</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r273 rd" class="r273 r">context</span>)
        {
            <a href="../../../P/660d078b9d606b70.html#660d078b9d606b70" class="t t">InternalHostUserInterface</a> <span id="r274 rd" class="r274 r">ui</span> = (<a href="../../../P/660d078b9d606b70.html#660d078b9d606b70" class="t t">InternalHostUserInterface</a>)<span class="r273 r">context</span>.<a href="../../ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="../../hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>;
 
            <span class="i">Collection</span>&lt;<a href="../../hostifaces/ChoiceDescription.cs.html#1f38c9f99af41345" class="t t">ChoiceDescription</a>&gt; <span id="r275 rd" class="r275 r">choices</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../../hostifaces/ChoiceDescription.cs.html#1f38c9f99af41345" class="t t">ChoiceDescription</a>&gt;();
 
            <b>string</b> <span id="r276 rd" class="r276 r">continueLabel</span> = <span class="i">ParserStrings</span>.<span class="i">ContinueLabel</span>;
            <b>string</b> <span id="r277 rd" class="r277 r">continueHelpMsg</span> = <span class="i">ParserStrings</span>.<span class="i">ContinueHelpMessage</span>;
            <b>string</b> <span id="r278 rd" class="r278 r">silentlyContinueLabel</span> = <span class="i">ParserStrings</span>.<span class="i">SilentlyContinueLabel</span>;
            <b>string</b> <span id="r279 rd" class="r279 r">silentlyContinueHelpMsg</span> = <span class="i">ParserStrings</span>.<span class="i">SilentlyContinueHelpMessage</span>;
            <b>string</b> <span id="r280 rd" class="r280 r">breakLabel</span> = <span class="i">ParserStrings</span>.<span class="i">BreakLabel</span>;
            <b>string</b> <span id="r281 rd" class="r281 r">breakHelpMsg</span> = <span class="i">ParserStrings</span>.<span class="i">BreakHelpMessage</span>;
            <b>string</b> <span id="r282 rd" class="r282 r">suspendLabel</span> = <span class="i">ParserStrings</span>.<span class="i">SuspendLabel</span>;
            <b>string</b> <span id="r283 rd" class="r283 r">suspendHelpMsg</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">ParserStrings</span>.<span class="i">SuspendHelpMessage</span>);
 
            <span class="r275 r">choices</span>.<span class="i">Add</span>(<b>new</b> <a href="../../hostifaces/ChoiceDescription.cs.html#5f2b1cc3ea4f41a7" class="t constructor">ChoiceDescription</a>(<span class="r276 r">continueLabel</span>, <span class="r277 r">continueHelpMsg</span>));
            <span class="r275 r">choices</span>.<span class="i">Add</span>(<b>new</b> <a href="../../hostifaces/ChoiceDescription.cs.html#5f2b1cc3ea4f41a7" class="t constructor">ChoiceDescription</a>(<span class="r278 r">silentlyContinueLabel</span>, <span class="r279 r">silentlyContinueHelpMsg</span>));
            <span class="r275 r">choices</span>.<span class="i">Add</span>(<b>new</b> <a href="../../hostifaces/ChoiceDescription.cs.html#5f2b1cc3ea4f41a7" class="t constructor">ChoiceDescription</a>(<span class="r280 r">breakLabel</span>, <span class="r281 r">breakHelpMsg</span>));
            <span class="r275 r">choices</span>.<span class="i">Add</span>(<b>new</b> <a href="../../hostifaces/ChoiceDescription.cs.html#5f2b1cc3ea4f41a7" class="t constructor">ChoiceDescription</a>(<span class="r282 r">suspendLabel</span>, <span class="r283 r">suspendHelpMsg</span>));
 
            <b>string</b> <span id="r284 rd" class="r284 r">caption</span> = <span class="i">ParserStrings</span>.<span class="i">ExceptionActionPromptCaption</span>;
 
            <b>bool</b> <span id="r285 rd" class="r285 r">oldQuestionMarkVariableValue</span> = <span class="r273 r">context</span>.<a href="../../ExecutionContext.cs.html#1086e67bac3e5c3a" class="i property">QuestionMarkVariableValue</a>;
 
            <b>int</b> <span id="r286 rd" class="r286 r">choice</span>;
            <b>while</b> ((<span class="r286 r">choice</span> = <span class="r274 r">ui</span>.<a href="../../hostifaces/InternalHostUserInterface.cs.html#e4770e45098941cc" class="i method">PromptForChoice</a>(<span class="r284 r">caption</span>, <span class="r272 r">message</span>, <span class="r275 r">choices</span>, 0)) == 3)
            {
                <span class="r273 r">context</span>.<a href="../../ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="../../hostifaces/InternalHost.cs.html#e8d8d03e1e41d942" class="i method">EnterNestedPrompt</a>();
            }
 
            <span class="r273 r">context</span>.<a href="../../ExecutionContext.cs.html#1086e67bac3e5c3a" class="i property">QuestionMarkVariableValue</a> = <span class="r285 r">oldQuestionMarkVariableValue</span>;
 
            <b>if</b> (<span class="r286 r">choice</span> == 0)
                <b>return</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#0d6a3114b77f011d" class="i field">Continue</a>;
 
            <b>if</b> (<span class="r286 r">choice</span> == 1)
                <b>return</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#e5c6f06e809b81d8" class="i field">SilentlyContinue</a>;
 
            <b>return</b> <a href="../../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../../CommandBase.cs.html#83fefb47b3abc4e7" class="i field">Stop</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set error variables like $error and $stacktrace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r287 r">extent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r288 r">rte</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r289 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r290 r">outputPipe</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The output pipe of the statement.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="c7c5b369a867fd0c" href="../../../R/c7c5b369a867fd0c.html" target="n" data-glyph="74,1" class="i method">SetErrorVariables</a>(<a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r287 rd" class="r287 r">extent</span>, <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r288 rd" class="r288 r">rte</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r289 rd" class="r289 r">context</span>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r290 rd" class="r290 r">outputPipe</span>)
        {
            <b>string</b> <span id="r291 rd" class="r291 r">stack</span> = <b>null</b>;
            <span class="i">Exception</span> <span id="r292 rd" class="r292 r">e</span> = <span class="r288 r">rte</span>;
 
            <b>int</b> <span id="r293 rd" class="r293 r">i</span> = 0;
            <b>while</b> (<span class="r292 r">e</span> != <b>null</b> &amp;&amp; <span class="r293 r">i</span>++ &lt; 10)
            {
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r292 r">e</span>.<span class="i">StackTrace</span>))
                {
                    <span class="r291 r">stack</span> = <span class="r292 r">e</span>.<span class="i">StackTrace</span>;
                }
 
                <span class="r292 r">e</span> = <span class="r292 r">e</span>.<span class="i">InnerException</span>;
            }
 
            <span class="r289 r">context</span>.<a href="../../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#c542202b689ec4cc" class="i field">StackTraceVarPath</a>, <span class="r291 r">stack</span>);
 
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r288 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a> != <b>null</b>, <span class="s">&quot;The runtime exception&#39;s error record was null&quot;</span>);
            <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r288 r">rte</span>, <span class="r287 r">extent</span>);
            <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r294 rd" class="r294 r">errRec</span> = <span class="r288 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<span class="i">WrapException</span>(<span class="r288 r">rte</span>);
 
            <b>if</b> (<span class="r288 r">rte</span> <b>is not</b> <a href="../../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a>)
            {
                <b>if</b> (<span class="r290 r">outputPipe</span> != <b>null</b>)
                {
                    <span class="r290 r">outputPipe</span>.<a href="../../Pipe.cs.html#d6190ce9334ba83f" class="i method">AppendVariableList</a>(<a href="../../Pipe.cs.html#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="../../Pipe.cs.html#fc0efe5038263e2e" class="i field">Error</a>, <span class="r294 r">errRec</span>);
                }
 
                <span class="r289 r">context</span>.<a href="../../ExecutionContext.cs.html#d09d68410776a624" class="i method">AppendDollarError</a>(<span class="r294 r">errRec</span>);
            }
        }
 
        <b>internal static bool</b> <a id="928b8c5e761a2273" href="../../../R/928b8c5e761a2273.html" target="n" data-glyph="74,1" class="i method">ExceptionCannotBeStoppedContinuedOrIgnored</a>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r295 rd" class="r295 r">rte</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r296 rd" class="r296 r">context</span>)
        {
            <b>return</b> <span class="r296 r">context</span>.<a href="../../ExecutionContext.cs.html#1d9a57911a3915e8" class="i property">PropagateExceptionsToEnclosingStatementBlock</a>
                   || <span class="r296 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> == <b>null</b>
                   || <span class="r296 r">context</span>.<a href="../../ExecutionContext.cs.html#bc7d7c4d79ef05e4" class="i property">CurrentPipelineStopping</a>
                   || <span class="r295 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#a3e1fa4579675275" class="i property">SuppressPromptInInterpreter</a>
                   || <span class="r295 r">rte</span> <b>is</b> <a href="../../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Report error into error pipe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r297 r">extent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r298 r">rte</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runtime error to report.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r299 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if it was able to report the error.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="6cf6d108406e3bdf" href="../../../R/6cf6d108406e3bdf.html" target="n" data-glyph="74,1" class="i method">ReportErrorRecord</a>(<a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r297 rd" class="r297 r">extent</span>, <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r298 rd" class="r298 r">rte</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r299 rd" class="r299 r">context</span>)
        {
            <b>if</b> (<span class="r299 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a> == <b>null</b>)
                <b>return</b> <b>false</b>;
 
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r298 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a> != <b>null</b>, <span class="s">&quot;The runtime exception&#39;s error record was null&quot;</span>);
 
            <b>if</b> (<span class="r298 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#fd1ac7b3462d4426" class="i property">InvocationInfo</a> == <b>null</b> &amp;&amp; <span class="r297 r">extent</span> != <b>null</b> &amp;&amp; <span class="r297 r">extent</span> != <a href="../../parser/Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="../../parser/Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>)
                <span class="r298 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#14b8261653db7b03" class="i method">SetInvocationInfo</a>(<b>new</b> <a href="../../InvocationInfo.cs.html#05f8dff4c341ddae" class="t constructor">InvocationInfo</a>(<b>null</b>, <span class="r297 r">extent</span>, <span class="r299 r">context</span>));
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r300 rd" class="r300 r">errorWrap</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r298 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>, <span class="r298 r">rte</span>));
 
            <span class="r300 r">errorWrap</span>.<a href="../../MshObject.cs.html#e3bac6ee3e22d6dc" class="i property">WriteStream</a> = <a href="../../MshObject.cs.html#03e0630da31ec3a9" class="t t">WriteStreamType</a>.<a href="../../MshObject.cs.html#af472c29dba3fb51" class="i field">Error</a>;
 
            <span class="c">// If this is an error pipe for a hosting application (i.e.: no downstream cmdlet),</span>
            <span class="c">// and we are logging, then create a temporary PowerShell to log the error.</span>
            <b>if</b> (<span class="r299 r">context</span>.<a href="../../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="../../hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="../../hostifaces/MshHostUserInterface.cs.html#6694b338e46fdead" class="i property">IsTranscribing</a>)
            {
                <span class="r299 r">context</span>.<a href="../../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="../../hostifaces/InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="../../hostifaces/MshHostUserInterface.cs.html#c83a8ec1928e56c7" class="i method">TranscribeError</a>(<span class="r299 r">context</span>, <span class="r298 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#fd1ac7b3462d4426" class="i property">InvocationInfo</a>, <span class="r300 r">errorWrap</span>);
            }
 
            <span class="r299 r">context</span>.<a href="../../ExecutionContext.cs.html#d0ed5d60dd57b004" class="i property">ShellFunctionErrorOutputPipe</a>.<a href="../../Pipe.cs.html#f66ebe5942cdceab" class="i method">Add</a>(<span class="r300 r">errorWrap</span>);
 
            <span class="c">// set the value of $? here in case it is reset in error reporting.</span>
            <span class="r299 r">context</span>.<a href="../../ExecutionContext.cs.html#1086e67bac3e5c3a" class="i property">QuestionMarkVariableValue</a> = <b>false</b>;
 
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <a id="73cfb673b2fb45a1" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ConvertToException</a>(<b>object</b> <span id="r301 rd" class="r301 r">result</span>, <a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r302 rd" class="r302 r">extent</span>, <b>bool</b> <span id="r303 rd" class="r303 r">rethrow</span>)
        {
            <span class="r301 r">result</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r301 r">result</span>);
 
            <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r304 rd" class="r304 r">runtimeException</span> = <span class="r301 r">result</span> <b>as</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>;
            <b>if</b> (<span class="r304 r">runtimeException</span> != <b>null</b>)
            {
                <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r304 r">runtimeException</span>, <span class="r302 r">extent</span>);
                <span class="r304 r">runtimeException</span>.<a href="../../../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a> = <b>true</b>;
                <span class="r304 r">runtimeException</span>.<a href="../../../utils/RuntimeException.cs.html#99bdea55589a9bb4" class="i property">WasRethrown</a> = <span class="r303 r">rethrow</span>;
                <b>return</b> <span class="r304 r">runtimeException</span>;
            }
 
            <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r305 rd" class="r305 r">er</span> = <span class="r301 r">result</span> <b>as</b> <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>;
            <b>if</b> (<span class="r305 r">er</span> != <b>null</b>)
            {
                <span class="r304 r">runtimeException</span> = <b>new</b> <a href="../../../utils/RuntimeException.cs.html#a0935659dcd5b450" class="t constructor">RuntimeException</a>(<span class="r305 r">er</span>.<a href="../../ErrorPackage.cs.html#cab659be098926dd" class="i method">ToString</a>(), <span class="r305 r">er</span>.<a href="../../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>, <span class="r305 r">er</span>) { <a href="../../../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a> = <b>true</b>, <a href="../../../utils/RuntimeException.cs.html#99bdea55589a9bb4" class="i property">WasRethrown</a> = <span class="r303 r">rethrow</span> };
                <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r304 r">runtimeException</span>, <span class="r302 r">extent</span>);
 
                <b>return</b> <span class="r304 r">runtimeException</span>;
            }
 
            <span class="i">Exception</span> <span id="r306 rd" class="r306 r">exception</span> = <span class="r301 r">result</span> <b>as</b> <span class="i">Exception</span>;
            <b>if</b> (<span class="r306 r">exception</span> != <b>null</b>)
            {
                <span class="r305 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r306 r">exception</span>, <span class="r306 r">exception</span>.<span class="i">Message</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#9aa2436d61de1f73" class="i field">OperationStopped</a>, <b>null</b>);
                <span class="r304 r">runtimeException</span> = <b>new</b> <span class="t">RuntimeException</span>(<span class="r306 r">exception</span>.<span class="i">Message</span>, <span class="r306 r">exception</span>, <span class="r305 r">er</span>) { <a href="../../../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a> = <b>true</b>, <a href="../../../utils/RuntimeException.cs.html#99bdea55589a9bb4" class="i property">WasRethrown</a> = <span class="r303 r">rethrow</span> };
                <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r304 r">runtimeException</span>, <span class="r302 r">extent</span>);
                <b>return</b> <span class="r304 r">runtimeException</span>;
            }
 
            <b>string</b> <span id="r307 rd" class="r307 r">message</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#cf665fbdc4612d9d" class="i method">IsNull</a>(<span class="r301 r">result</span>)
                ? <span class="s">&quot;ScriptHalted&quot;</span>
                : <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#e27ca21481dc9c96" class="i method">ConvertTo</a>&lt;<b>string</b>&gt;(<span class="r301 r">result</span>, <a href="../../parser/Position.cs.html#5892e754643a6045" class="t t">PositionUtilities</a>.<a href="../../parser/Position.cs.html#01bfb713b57f7955" class="i property">EmptyExtent</a>);
            <span class="r306 r">exception</span> = <b>new</b> <a href="../../../utils/RuntimeException.cs.html#e550883d468d8c30" class="t constructor">RuntimeException</a>(<span class="r307 r">message</span>, <b>null</b>);
 
            <span class="r305 r">er</span> = <b>new</b> <a href="../../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r306 r">exception</span>, <span class="r307 r">message</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#9aa2436d61de1f73" class="i field">OperationStopped</a>, <b>null</b>);
            <span class="r304 r">runtimeException</span> = <b>new</b> <a href="../../../utils/RuntimeException.cs.html#a0935659dcd5b450" class="t constructor">RuntimeException</a>(<span class="r307 r">message</span>, <span class="r306 r">exception</span>, <span class="r305 r">er</span>) { <a href="../../../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a> = <b>true</b>, <a href="../../../utils/RuntimeException.cs.html#99bdea55589a9bb4" class="i property">WasRethrown</a> = <span class="r303 r">rethrow</span> };
            <span class="r304 r">runtimeException</span>.<a href="../../../utils/RuntimeException.cs.html#9b2f142e3fc2e683" class="i method">SetTargetObject</a>(<span class="r301 r">result</span>);
            <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r304 r">runtimeException</span>, <span class="r302 r">extent</span>);
 
            <b>return</b> <span class="r304 r">runtimeException</span>;
        }
 
        <b>internal static</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <a id="5a3a1336d3429bb1" href="../../../R/5a3a1336d3429bb1.html" target="n" data-glyph="74,1" class="i method">ConvertToRuntimeException</a>(<span class="i">Exception</span> <span id="r308 rd" class="r308 r">exception</span>, <a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r309 rd" class="r309 r">extent</span>)
        {
            <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r310 rd" class="r310 r">runtimeException</span> = <span class="r308 r">exception</span> <b>as</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>;
            <b>if</b> (<span class="r310 r">runtimeException</span> == <b>null</b>)
            {
                <a href="../../ErrorPackage.cs.html#2d342e12f9600886" class="k">var</a> <span id="r311 rd" class="r311 r">icer</span> = <span class="r308 r">exception</span> <b>as</b> <a href="../../ErrorPackage.cs.html#2d342e12f9600886" class="t t">IContainsErrorRecord</a>;
                <b>var</b> <span id="r312 rd" class="r312 r">er</span> = <span class="r311 r">icer</span> != <b>null</b>
                             ? <span class="r311 r">icer</span>.<a href="../../ErrorPackage.cs.html#cef340f272a30c6b" class="i property">ErrorRecord</a>
                             : <b>new</b> <span class="t">ErrorRecord</span>(<span class="r308 r">exception</span>, <span class="r308 r">exception</span>.<span class="i">GetType</span>().<span class="i">FullName</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#9aa2436d61de1f73" class="i field">OperationStopped</a>, <b>null</b>);
                <span class="r310 r">runtimeException</span> = <b>new</b> <span class="t">RuntimeException</span>(<span class="r308 r">exception</span>.<span class="i">Message</span>, <span class="r308 r">exception</span>, <span class="r312 r">er</span>);
            }
 
            <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">UpdateExceptionErrorRecordPosition</span>(<span class="r310 r">runtimeException</span>, <span class="r309 r">extent</span>);
            <b>return</b> <span class="r310 r">runtimeException</span>;
        }
 
        <b>internal static void</b> <a id="7cc78beaa63a5e6b" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ConvertToArgumentConversionException</a>(<span class="i">Exception</span> <span id="r313 rd" class="r313 r">exception</span>, <b>string</b> <span id="r314 rd" class="r314 r">parameterName</span>, <b>object</b> <span id="r315 rd" class="r315 r">argument</span>, <b>string</b> <span id="r316 rd" class="r316 r">method</span>, <span class="i">Type</span> <span id="r317 rd" class="r317 r">toType</span>)
        {
            <b>throw</b> <b>new</b> <span class="t">MethodException</span>(
                <span class="s">&quot;MethodArgumentConversionInvalidCastArgument&quot;</span>, <span class="r313 r">exception</span>,
                <span class="i">ExtendedTypeSystem</span>.<span class="i">MethodArgumentConversionException</span>, <span class="r314 r">parameterName</span>, <span class="r315 r">argument</span>, <span class="r316 r">method</span>, <span class="r317 r">toType</span>, <span class="r313 r">exception</span>.<span class="i">Message</span>);
        }
 
        <b>internal static void</b> <a id="b965bc2450fa2142" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ConvertToMethodInvocationException</a>(<span class="i">Exception</span> <span id="r318 rd" class="r318 r">exception</span>, <span class="i">Type</span> <span id="r319 rd" class="r319 r">typeToThrow</span>, <b>string</b> <span id="r320 rd" class="r320 r">methodName</span>, <b>int</b> <span id="r321 rd" class="r321 r">numArgs</span>, <span class="i">MemberInfo</span> <span id="r322 rd" class="r322 r">memberInfo</span> = <b>null</b>)
        {
            <b>if</b> (<span class="r318 r">exception</span> <b>is</b> <span class="i">TargetInvocationException</span>)
            {
                <span class="r318 r">exception</span> = <span class="r318 r">exception</span>.<span class="i">InnerException</span>;
            }
 
            <span class="c">// Win8: 178063. Allow flow control related exceptions for PowerShell hosting API</span>
            <b>if</b> ((<span class="r318 r">exception</span> <b>is</b> <a href="../../lang/parserutils.cs.html#a3a2a71cfea9c3b1" class="t t">FlowControlException</a> ||
                <span class="r318 r">exception</span> <b>is</b> <a href="../../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a> ||
                <span class="r318 r">exception</span> <b>is</b> <a href="../../../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a>) &amp;&amp;
                ((<span class="r322 r">memberInfo</span> == <b>null</b>) || ((<span class="r322 r">memberInfo</span>.<span class="i">DeclaringType</span> != <b>typeof</b>(<a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>)) &amp;&amp; (<span class="r322 r">memberInfo</span>.<span class="i">DeclaringType</span> != <b>typeof</b>(<a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>)))))
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r319 r">typeToThrow</span> == <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#4961d7a0f93a8280" class="t t">MethodException</a>))
            {
                <b>if</b> (<span class="r318 r">exception</span> <b>is</b> <a href="../../ExtendedTypeSystemException.cs.html#4961d7a0f93a8280" class="t t">MethodException</a>)
                    <b>return</b>;
 
                <b>throw</b> <b>new</b> <span class="t">MethodInvocationException</span>(
                        <span class="r318 r">exception</span>.<span class="i">GetType</span>().<span class="i">Name</span>,
                        <span class="r318 r">exception</span>,
                        <span class="i">ExtendedTypeSystem</span>.<span class="i">MethodInvocationException</span>,
                        <span class="r320 r">methodName</span>, <span class="r321 r">numArgs</span>, <span class="r318 r">exception</span>.<span class="i">Message</span>);
            }
 
            <b>if</b> (<span class="r320 r">methodName</span>.<span class="i">StartsWith</span>(<span class="s">&quot;set_&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) || <span class="r320 r">methodName</span>.<span class="i">StartsWith</span>(<span class="s">&quot;get_&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
            {
                <span class="r320 r">methodName</span> = <span class="r320 r">methodName</span>.<span class="i">Substring</span>(4);
            }
 
            <b>if</b> (<span class="r319 r">typeToThrow</span> == <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#e0c9773749a65b3c" class="t t">GetValueInvocationException</a>))
            {
                <b>if</b> (<span class="r318 r">exception</span> <b>is</b> <a href="../../ExtendedTypeSystemException.cs.html#396f7c7b826437d7" class="t t">GetValueException</a>)
                    <b>return</b>;
 
                <b>throw</b> <b>new</b> <span class="t">GetValueInvocationException</span>(
                    <span class="s">&quot;ExceptionWhenGetting&quot;</span>,
                    <span class="r318 r">exception</span>,
                    <span class="i">ExtendedTypeSystem</span>.<span class="i">ExceptionWhenGetting</span>,
                    <span class="r320 r">methodName</span>, <span class="r318 r">exception</span>.<span class="i">Message</span>);
            }
 
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r319 r">typeToThrow</span> == <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#a6e4ca1bdc5aff64" class="t t">SetValueInvocationException</a>),
                               <span class="s">&quot;caller to verify exception is expected type&quot;</span>);
            <b>if</b> (<span class="r318 r">exception</span> <b>is</b> <a href="../../ExtendedTypeSystemException.cs.html#8f44bde8a24c50c0" class="t t">SetValueException</a>)
                <b>return</b>;
 
            <b>throw</b> <b>new</b> <span class="t">SetValueInvocationException</span>(
                <span class="s">&quot;ExceptionWhenSetting&quot;</span>,
                <span class="r318 r">exception</span>,
                <span class="i">ExtendedTypeSystem</span>.<span class="i">ExceptionWhenSetting</span>,
                <span class="r320 r">methodName</span>, <span class="r318 r">exception</span>.<span class="i">Message</span>);
        }
    }
 
    <b>internal static class</b> <a id="1953a14dee44eb19" href="../../../R/1953a14dee44eb19.html" target="n" data-glyph="2,0" class="t t">TypeOps</a>
    {
        <b>internal static</b> <span class="i">Type</span> <a id="d4354a46a82a388e" href="../../../R/d4354a46a82a388e.html" target="n" data-glyph="74,1" class="i method">ResolveTypeName</a>(<a href="../../parser/ast.cs.html#a422e1772da6dbc8" class="t t">ITypeName</a> <span id="r323 rd" class="r323 r">typeName</span>, <a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r324 rd" class="r324 r">errorPos</span>)
        {
            <span class="i">Exception</span> <span id="r325 rd" class="r325 r">exception</span>;
            <b>var</b> <span id="r326 rd" class="r326 r">result</span> = <a href="../../parser/TypeResolver.cs.html#f665f2b4b8d028cd" class="t t">TypeResolver</a>.<a href="../../parser/TypeResolver.cs.html#6b551d638ac1965a" class="i method">ResolveITypeName</a>(<span class="r323 r">typeName</span>, <b>out</b> <span class="r325 r">exception</span>);
 
            <b>if</b> (<span class="r326 r">result</span> == <b>null</b>)
            {
                <b>if</b> (<span class="r325 r">exception</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r325 r">exception</span> <b>is</b> <span class="i">InvalidCastException</span> &amp;&amp;
                        <span class="r325 r">exception</span>.<span class="i">InnerException</span> != <b>null</b> &amp;&amp;
                        <span class="r325 r">exception</span>.<span class="i">InnerException</span> <b>is</b> <a href="../../parser/TypeResolver.cs.html#f665f2b4b8d028cd" class="t t">TypeResolver</a>.<a href="../../parser/TypeResolver.cs.html#72137bec408a3b52" class="t t">AmbiguousTypeException</a>)
                    {
                        <b>throw</b> <span class="r325 r">exception</span>;
                    }
 
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r323 r">typeName</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r324 r">errorPos</span>,
                                                                   <span class="s">&quot;TypeNotFoundWithMessage&quot;</span>,
                                                                   <span class="i">ParserStrings</span>.<span class="i">TypeNotFoundWithMessage</span>,
                                                                   <span class="r323 r">typeName</span>.<a href="../../parser/ast.cs.html#15c64a580f477707" class="i property">FullName</a>, <span class="r325 r">exception</span>.<span class="i">Message</span>);
                }
 
                <span class="c">// For better error messages, figure out exactly which type we couldn&#39;t resolve.</span>
                <span class="c">// We recurse and relying on one of the recursive calls to throw, or if none do,</span>
                <span class="c">// then we just throw on the top level typeName.</span>
 
                <a href="../../parser/ast.cs.html#d3e3939e37307477" class="k">var</a> <span id="r327 rd" class="r327 r">genericTypeName</span> = <span class="r323 r">typeName</span> <b>as</b> <a href="../../parser/ast.cs.html#d3e3939e37307477" class="t t">GenericTypeName</a>;
                <b>if</b> (<span class="r327 r">genericTypeName</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r328 rd" class="r328 r">generic</span> = <span class="r327 r">genericTypeName</span>.<a href="../../parser/ast.cs.html#3afbf0ead19c861b" class="i method">GetGenericType</a>(<a href="#d4354a46a82a388e" class="i method">ResolveTypeName</a>(<span class="r327 r">genericTypeName</span>.<a href="../../parser/ast.cs.html#a0e9895f5c1358ce" class="i property">TypeName</a>, <span class="r324 r">errorPos</span>));
                    <b>var</b> <span id="r329 rd" class="r329 r">typeArgs</span> = (<b>from</b> <span class="i">arg</span> <b>in</b> <span class="r327 r">genericTypeName</span>.<a href="../../parser/ast.cs.html#c3319d29a1b29f46" class="i property">GenericArguments</a> <b>select</b> <span class="i">ResolveTypeName</span>(<span class="i">arg</span>, <span class="r324 r">errorPos</span>)).<span class="i">ToArray</span>();
 
                    <b>try</b>
                    {
                        <b>if</b> (<span class="r328 r">generic</span> != <b>null</b> &amp;&amp; <span class="r328 r">generic</span>.<span class="i">ContainsGenericParameters</span>)
                            <span class="r328 r">generic</span>.<span class="i">MakeGenericType</span>(<span class="r329 r">typeArgs</span>);
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r330 rd" class="r330 r">e</span>)
                    {
                        <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r323 r">typeName</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r324 r">errorPos</span>,
                                                                       <span class="s">&quot;TypeNotFoundWithMessage&quot;</span>,
                                                                       <span class="i">ParserStrings</span>.<span class="i">TypeNotFoundWithMessage</span>,
                                                                       <span class="r323 r">typeName</span>.<a href="../../parser/ast.cs.html#15c64a580f477707" class="i property">FullName</a>, <span class="r330 r">e</span>.<span class="i">Message</span>);
                    }
                }
 
                <a href="../../parser/ast.cs.html#8588eb9308b68261" class="k">var</a> <span id="r331 rd" class="r331 r">arrayTypeName</span> = <span class="r323 r">typeName</span> <b>as</b> <a href="../../parser/ast.cs.html#8588eb9308b68261" class="t t">ArrayTypeName</a>;
 
                <b>if</b> (<span class="r331 r">arrayTypeName</span> != <b>null</b>)
                {
                    <a href="#d4354a46a82a388e" class="i method">ResolveTypeName</a>(<span class="r331 r">arrayTypeName</span>.<a href="../../parser/ast.cs.html#0f81729ec1838610" class="i property">ElementType</a>, <span class="r324 r">errorPos</span>);
                }
 
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r323 r">typeName</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r324 r">errorPos</span>,
                                                               <span class="s">&quot;TypeNotFound&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">TypeNotFound</span>,
                                                               <span class="r323 r">typeName</span>.<a href="../../parser/ast.cs.html#15c64a580f477707" class="i property">FullName</a>);
            }
 
            <b>return</b> <span class="r326 r">result</span>;
        }
 
        <b>internal static bool</b> <a id="9a3be7eb209ea0c6" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsInstance</a>(<b>object</b> <span id="r332 rd" class="r332 r">left</span>, <b>object</b> <span id="r333 rd" class="r333 r">right</span>)
        {
            <b>object</b> <span id="r334 rd" class="r334 r">lval</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r332 r">left</span>);
            <b>object</b> <span id="r335 rd" class="r335 r">rval</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r333 r">right</span>);
 
            <span class="i">Type</span> <span id="r336 rd" class="r336 r">rType</span> = <span class="r335 r">rval</span> <b>as</b> <span class="i">Type</span>;
 
            <b>if</b> (<span class="r336 r">rType</span> == <b>null</b>)
            {
                <span class="r336 r">rType</span> = <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#e27ca21481dc9c96" class="i method">ConvertTo</a>&lt;<span class="i">Type</span>&gt;(<span class="r335 r">rval</span>, <b>null</b>);
 
                <b>if</b> (<span class="r336 r">rType</span> == <b>null</b>)
                {
                    <span class="c">// &quot;the right operand of &#39;-is&#39; must be a type&quot;</span>
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r335 r">rval</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <b>null</b>, <span class="s">&quot;IsOperatorRequiresType&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">IsOperatorRequiresType</span>);
                }
            }
 
            <b>if</b> (<span class="r336 r">rType</span> == <b>typeof</b>(<a href="../../MshObject.cs.html#4a84ee8edc4d53a0" class="t t">PSCustomObject</a>) &amp;&amp; <span class="r334 r">lval</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r336 r">rType</span>.<span class="i">IsInstanceOfType</span>(((<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)<span class="r334 r">lval</span>).<a href="../../MshObject.cs.html#d4170653add67c11" class="i property">ImmediateBaseObject</a>), <span class="s">&quot;Unexpect PSObject&quot;</span>);
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<span class="r336 r">rType</span>.<span class="i">Equals</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)) &amp;&amp; <span class="r332 r">left</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <span class="r336 r">rType</span>.<span class="i">IsInstanceOfType</span>(<span class="r334 r">lval</span>);
        }
 
        <b>internal static object</b> <a id="0a589b57b96294bf" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AsOperator</a>(<b>object</b> <span id="r337 rd" class="r337 r">left</span>, <span class="i">Type</span> <span id="r338 rd" class="r338 r">type</span>)
        {
            <b>if</b> (<span class="r338 r">type</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <b>null</b>,
                                                               <span class="s">&quot;AsOperatorRequiresType&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">AsOperatorRequiresType</span>);
            }
 
            <span class="c">// We figure out the exception instead of just executing a conversion because we can avoid an exception which is quite expensive,</span>
            <span class="c">// and people using -as don&#39;t expect it to be expensive.</span>
            <b>bool</b> <span id="r339 rd" class="r339 r">debase</span>;
 
            <span class="c">// ConstrainedLanguage note - Calls to this conversion are done at runtime, so conversions are not cached.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r340 rd" class="r340 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#2b600779afb85e55" class="i method">FigureConversion</a>(<span class="r337 r">left</span>, <span class="r338 r">type</span>, <b>out</b> <span class="r339 r">debase</span>);
            <b>if</b> (<span class="r340 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>try</b>
            {
                <b>if</b> (<span class="r339 r">debase</span>)
                {
                    <b>return</b> <span class="r340 r">conversion</span>.<span class="i">Invoke</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r337 r">left</span>), <span class="r338 r">type</span>, <b>false</b>, (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)<span class="r337 r">left</span>,
                        <span class="i">NumberFormatInfo</span>.<span class="i">InvariantInfo</span>, <b>null</b>);
                }
 
                <b>return</b> <span class="r340 r">conversion</span>.<span class="i">Invoke</span>(<span class="r337 r">left</span>, <span class="r338 r">type</span>, <b>false</b>, <b>null</b>, <span class="i">NumberFormatInfo</span>.<span class="i">InvariantInfo</span>, <b>null</b>);
            }
            <b>catch</b> (<a href="../../ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a>)
            {
                <b>return</b> <b>null</b>;
            }
        }
 
        <b>internal static string</b>[] <a id="9e4b772b40fc12c1" href="../../../R/9e4b772b40fc12c1.html" target="n" data-glyph="74,1" class="i method">GetNamespacesForTypeResolutionState</a>(<span class="i">IEnumerable</span>&lt;<a href="../../parser/ast.cs.html#a269e1753cbc4c90" class="t t">UsingStatementAst</a>&gt; <span id="r341 rd" class="r341 r">usingAsts</span>)
        {
            <b>var</b> <span id="r342 rd" class="r342 r">usedSystem</span> = <b>false</b>;
            <b>var</b> <span id="r343 rd" class="r343 r">namespaces</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
            <b>foreach</b> (<b>var</b> <span id="r344 rd" class="r344 r">usingStmt</span> <b>in</b> <span class="r341 r">usingAsts</span>)
            {
                <b>if</b> (<span class="r344 r">usingStmt</span>.<span class="i">UsingStatementKind</span> == <a href="../../parser/ast.cs.html#0837a04517723905" class="t t">UsingStatementKind</a>.<a href="../../parser/ast.cs.html#8c39b25da17c5e31" class="i field">Namespace</a>)
                {
                    <b>if</b> (!<span class="r342 r">usedSystem</span> &amp;&amp; <span class="r344 r">usingStmt</span>.<span class="i">Name</span>.<span class="i">Value</span>.<span class="i">Equals</span>(<span class="s">&quot;System&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r342 r">usedSystem</span> = <b>true</b>;
                    }
 
                    <span class="r343 r">namespaces</span>.<span class="i">Add</span>(<span class="r344 r">usingStmt</span>.<span class="i">Name</span>.<span class="i">Value</span>);
                }
            }
 
            <b>if</b> (!<span class="r342 r">usedSystem</span>)
            {
                <span class="r343 r">namespaces</span>.<span class="i">Insert</span>(0, <span class="s">&quot;System&quot;</span>);
            }
 
            <b>return</b> <span class="r343 r">namespaces</span>.<span class="i">ToArray</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add types to the current scope.</span>
        <span class="c">///</span><span class="c"> This method called at runtime after types are created at compile time.</span>
        <span class="c">///</span><span class="c"> This method should be called for every ScriptBlockAst that defines types.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> I.e.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> class C1 {}</span>
        <span class="c">///</span><span class="c"> function foo { class C2 {} }</span>
        <span class="c">///</span><span class="c"> 1..10 | ForEach-Object { foo }</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> DefinePowerShellTypes() would be called for two TypeDefinitionAsts at the same time and Types for C1 and C2 would be created at the same assembly.</span>
        <span class="c">///</span><span class="c"> AddPowerShellTypesToTheScope() would be called for root script first and then for foo\C2, once we call function foo.</span>
        <span class="c">///</span><span class="c"> Note that AddPowerShellTypesToTheScope() would be call on every foo call, 10 times.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This method also should be called for &#39;using module&#39; statements. Then added types would have a different name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r345 r">types</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r346 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="fc8cd0b120478535" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddPowerShellTypesToTheScope</a>(<span class="i">Dictionary</span>&lt;<b>string</b>, <a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a>&gt; <span id="r345 rd" class="r345 r">types</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r346 rd" class="r346 r">context</span>)
        {
            <a href="../../parser/TypeResolver.cs.html#55992be0fa5b3b24" class="k">var</a> <span id="r347 rd" class="r347 r">trs</span> = <span class="r346 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../../SessionStateScope.cs.html#bdd9f0dc3f98ba22" class="i property">TypeResolutionState</a>;
 
            <b>foreach</b> (<b>var</b> <span id="r348 rd" class="r348 r">t</span> <b>in</b> <span class="r345 r">types</span>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r348 r">t</span>.<span class="i">Value</span>.<span class="i">Type</span> != <b>null</b>, <span class="s">&quot;TypeDefinitionAst.Type cannot be null&quot;</span>);
                <span class="r346 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<span class="i">AddType</span>(<span class="r348 r">t</span>.<span class="i">Key</span>, <span class="r348 r">t</span>.<span class="i">Value</span>.<span class="i">Type</span>);
            }
 
            <span class="r346 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../../SessionStateScope.cs.html#bdd9f0dc3f98ba22" class="i property">TypeResolutionState</a> = <span class="r347 r">trs</span>.<span class="i">CloneWithAddTypesDefined</span>(<span class="r345 r">types</span>.<span class="i">Keys</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Capture session state for methods defined in PowerShell types, so they know what context to use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r349 r">types</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="f6ed1849099f01b2" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InitPowerShellTypesAtRuntime</a>(<a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a>[] <span id="r349 rd" class="r349 r">types</span>)
        {
            <b>foreach</b> (<a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="k">var</a> <span id="r350 rd" class="r350 r">t</span> <b>in</b> <span class="r349 r">types</span>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r350 r">t</span>.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a> != <b>null</b>, <span class="s">&quot;TypeDefinitionAst.Type cannot be null&quot;</span>);
                <b>if</b> (<span class="r350 r">t</span>.<a href="../../parser/ast.cs.html#db380593e8b5ec71" class="i property">IsClass</a>)
                {
                    <b>var</b> <span id="r351 rd" class="r351 r">helperType</span> =
                        <span class="r350 r">t</span>.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>.<span class="i">Assembly</span>.<span class="i">GetType</span>(<span class="r350 r">t</span>.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>.<span class="i">FullName</span> + <span class="s">&quot;_&lt;staticHelpers&gt;&quot;</span>);
                    <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r351 r">helperType</span> != <b>null</b>, <span class="s">&quot;no corresponding &quot;</span> + <span class="r350 r">t</span>.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>.<span class="i">FullName</span> + <span class="s">&quot;_&lt;staticHelpers&gt; type found&quot;</span>);
                    <b>foreach</b> (<b>var</b> <span id="r352 rd" class="r352 r">p</span> <b>in</b> <span class="r351 r">helperType</span>.<span class="i">GetFields</span>(<span class="i">BindingFlags</span>.<span class="i">Static</span> | <span class="i">BindingFlags</span>.<span class="i">NonPublic</span>))
                    {
                        <b>var</b> <span id="r353 rd" class="r353 r">field</span> = <span class="r352 r">p</span>.<span class="i">GetValue</span>(<b>null</b>);
                        <span class="c">// field can be one of two types: SessionStateKeeper or ScriptBlockMemberMethodWrapper</span>
                        <a href="ClassOps.cs.html#89f66d4565154783" class="k">var</a> <span id="r354 rd" class="r354 r">methodWrapper</span> = <span class="r353 r">field</span> <b>as</b> <a href="ClassOps.cs.html#89f66d4565154783" class="t t">ScriptBlockMemberMethodWrapper</a>;
                        <b>if</b> (<span class="r354 r">methodWrapper</span> != <b>null</b>)
                        {
                            <span class="r354 r">methodWrapper</span>.<a href="ClassOps.cs.html#13a2b5f71ea1c8bb" class="i method">InitAtRuntime</a>();
                        }
                        <b>else</b>
                        {
                            ((<a href="ClassOps.cs.html#af827321341eaffb" class="t t">SessionStateKeeper</a>)<span class="r353 r">field</span>).<a href="ClassOps.cs.html#df794f173bc50004" class="i method">RegisterRunspace</a>();
                        }
                    }
                }
            }
        }
 
        <b>internal static void</b> <a id="02d60f920912d659" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetCurrentTypeResolutionState</a>(<a href="../../parser/TypeResolver.cs.html#55992be0fa5b3b24" class="t t">TypeResolutionState</a> <span id="r355 rd" class="r355 r">trs</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r356 rd" class="r356 r">context</span>)
        {
            <span class="r356 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../../SessionStateScope.cs.html#bdd9f0dc3f98ba22" class="i property">TypeResolutionState</a> = <span class="r355 r">trs</span>;
        }
 
        <b>internal static void</b> <a id="34f0c91f9f7bbf82" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetAssemblyDefiningPSTypes</a>(<a href="../../parser/Compiler.cs.html#aa4ec5dd36f7e2eb" class="t t">FunctionContext</a> <span id="r357 rd" class="r357 r">functionContext</span>, <span class="i">Assembly</span> <span id="r358 rd" class="r358 r">assembly</span>)
        {
            <span class="r357 r">functionContext</span>.<a href="../../parser/Compiler.cs.html#4980a1f93a561cb3" class="i field">_scriptBlock</a>.<a href="../CompiledScriptBlock.cs.html#37830aab9aece092" class="i property">AssemblyDefiningPSTypes</a> = <span class="r358 r">assembly</span>;
        }
    }
 
    <b>internal static class</b> <a id="c0f67e394cf08e0b" href="../../../R/c0f67e394cf08e0b.html" target="n" data-glyph="2,0" class="t t">SwitchOps</a>
    {
        <b>internal static bool</b> <a id="d4ce49b266096758" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ConditionSatisfiedWildcard</a>(<b>bool</b> <span id="r359 rd" class="r359 r">caseSensitive</span>,
                                                        <b>object</b> <span id="r360 rd" class="r360 r">condition</span>,
                                                        <b>string</b> <span id="r361 rd" class="r361 r">str</span>,
                                                        <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r362 rd" class="r362 r">context</span>)
        {
            <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r363 rd" class="r363 r">wildcard</span> = <span class="r360 r">condition</span> <b>as</b> <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>;
            <b>if</b> (<span class="r363 r">wildcard</span> != <b>null</b>)
            {
                <span class="c">// If case sensitivity doesn&#39;t agree between the existing wildcard pattern and the switch mode,</span>
                <span class="c">// make a new wildcard pattern that agrees with the switch.</span>
                <b>if</b> (((<span class="r363 r">wildcard</span>.<a href="../../regex.cs.html#096707bf6bd5d7ad" class="i property">Options</a> &amp; <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>) == 0) != <span class="r359 r">caseSensitive</span>)
                {
                    <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a> <span id="r364 rd" class="r364 r">options</span> = <span class="r359 r">caseSensitive</span> ? <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#b202e40981b139f5" class="i field">None</a> : <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>;
                    <span class="r363 r">wildcard</span> = <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r363 r">wildcard</span>.<a href="../../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>, <span class="r364 r">options</span>);
                }
            }
            <b>else</b>
            {
                <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a> <span id="r365 rd" class="r365 r">options</span> = <span class="r359 r">caseSensitive</span> ? <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#b202e40981b139f5" class="i field">None</a> : <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>;
                <span class="r363 r">wildcard</span> = <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e87c4fc15a3f59f5" class="i method">ToStringParser</a>(<span class="r362 r">context</span>, <span class="r360 r">condition</span>), <span class="r365 r">options</span>);
            }
 
            <b>return</b> <span class="r363 r">wildcard</span>.<a href="../../regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r361 r">str</span>);
        }
 
        <b>internal static bool</b> <a id="040ef070452686ae" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ConditionSatisfiedRegex</a>(<b>bool</b> <span id="r366 rd" class="r366 r">caseSensitive</span>,
                                                     <b>object</b> <span id="r367 rd" class="r367 r">condition</span>,
                                                     <a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r368 rd" class="r368 r">errorPosition</span>,
                                                     <b>string</b> <span id="r369 rd" class="r369 r">str</span>,
                                                     <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r370 rd" class="r370 r">context</span>)
        {
            <b>string</b> <span id="r371 rd" class="r371 r">pattern</span>;
 
            <span class="i">RegexOptions</span> <span id="r372 rd" class="r372 r">options</span> = <span class="r366 r">caseSensitive</span> ? <span class="i">RegexOptions</span>.<span class="i">None</span> : <span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>;
 
            <b>try</b>
            {
                <span class="i">Match</span> <span id="r373 rd" class="r373 r">m</span>;
 
                <span class="i">Regex</span> <span id="r374 rd" class="r374 r">regex</span> = <span class="r367 r">condition</span> <b>as</b> <span class="i">Regex</span>;
                <span class="c">// Check if the regex agrees with the switch w.r.t. case sensitivity, if not,</span>
                <span class="c">// we must build a new regex.</span>
                <b>if</b> (<span class="r374 r">regex</span> != <b>null</b> &amp;&amp; (((<span class="r374 r">regex</span>.<span class="i">Options</span> &amp; <span class="i">RegexOptions</span>.<span class="i">IgnoreCase</span>) != 0) != <span class="r366 r">caseSensitive</span>))
                {
                    <span class="r373 r">m</span> = <span class="r374 r">regex</span>.<span class="i">Match</span>(<span class="r369 r">str</span>);
                }
                <b>else</b>
                {
                    <span class="r371 r">pattern</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e87c4fc15a3f59f5" class="i method">ToStringParser</a>(<span class="r370 r">context</span>, <span class="r367 r">condition</span>);
                    <span class="r373 r">m</span> = <span class="i">Regex</span>.<span class="i">Match</span>(<span class="r369 r">str</span>, <span class="r371 r">pattern</span>, <span class="r372 r">options</span>);
 
                    <b>if</b> (<span class="r373 r">m</span>.<span class="i">Success</span> &amp;&amp; <span class="r373 r">m</span>.<span class="i">Groups</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="c">// We used the static regex method for it&#39;s caching ability, but</span>
                        <span class="c">// we need the group names now.  Fortunately constructing another regex</span>
                        <span class="c">// isn&#39;t slow because it should be in the cache still.</span>
                        <span class="r374 r">regex</span> = <b>new</b> <span class="i">Regex</span>(<span class="r371 r">pattern</span>, <span class="r372 r">options</span>);
                    }
                }
 
                <b>if</b> (<span class="r373 r">m</span>.<span class="i">Success</span>)
                {
                    <span class="i">GroupCollection</span> <span id="r375 rd" class="r375 r">groups</span> = <span class="r373 r">m</span>.<span class="i">Groups</span>;
 
                    <b>if</b> (<span class="r375 r">groups</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r374 r">regex</span> != <b>null</b>, <span class="s">&quot;Logic above ensures regex is not null.&quot;</span>);
 
                        <span class="i">Hashtable</span> <span id="r376 rd" class="r376 r">h</span> = <b>new</b> <span class="i">Hashtable</span>(<span class="i">StringComparer</span>.<span class="i">CurrentCultureIgnoreCase</span>);
 
                        <b>foreach</b> (<b>string</b> <span id="r377 rd" class="r377 r">groupName</span> <b>in</b> <span class="r374 r">regex</span>.<span class="i">GetGroupNames</span>())
                        {
                            <span class="i">Group</span> <span id="r378 rd" class="r378 r">g</span> = <span class="r375 r">groups</span>[<span class="r377 r">groupName</span>];
                            <b>if</b> (<span class="r378 r">g</span>.<span class="i">Success</span>)
                            {
                                <b>int</b> <span id="r379 rd" class="r379 r">keyInt</span>;
 
                                <b>if</b> (<span class="i">Int32</span>.<span class="i">TryParse</span>(<span class="r377 r">groupName</span>, <b>out</b> <span class="r379 r">keyInt</span>))
                                    <span class="r376 r">h</span>.<span class="i">Add</span>(<span class="r379 r">keyInt</span>, <span class="r378 r">g</span>.<span class="i">ToString</span>());
                                <b>else</b>
                                    <span class="r376 r">h</span>.<span class="i">Add</span>(<span class="r377 r">groupName</span>, <span class="r378 r">g</span>.<span class="i">ToString</span>());
                            }
                        }
 
                        <span class="r370 r">context</span>.<span class="i">SetVariable</span>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#76b9b435260c9fd7" class="i field">MatchesVarPath</a>, <span class="r376 r">h</span>);
                    }
                }
 
                <b>return</b> <span class="r373 r">m</span>.<span class="i">Success</span>;
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r380 rd" class="r380 r">ae</span>)
            {
                <span class="c">// ErrorSkipping: Add this error to parser</span>
                <span class="r371 r">pattern</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e87c4fc15a3f59f5" class="i method">ToStringParser</a>(<span class="r370 r">context</span>, <span class="r367 r">condition</span>);
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterExceptionWithInnerException</span>(<span class="r371 r">pattern</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                    <span class="r368 r">errorPosition</span>, <span class="s">&quot;InvalidRegularExpression&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidRegularExpression</span>, <span class="r380 r">ae</span>, <span class="r371 r">pattern</span>);
            }
        }
 
        <b>internal static string</b> <a id="c83300e8d635355e" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ResolveFilePath</a>(<a href="../../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r381 rd" class="r381 r">errorExtent</span>, <b>object</b> <span id="r382 rd" class="r382 r">obj</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r383 rd" class="r383 r">context</span>)
        {
            <b>try</b>
            {
                <span class="i">FileInfo</span> <span id="r384 rd" class="r384 r">file</span> = <span class="r382 r">obj</span> <b>as</b> <span class="i">FileInfo</span>;
                <b>string</b> <span id="r385 rd" class="r385 r">filePath</span> = <span class="r384 r">file</span> != <b>null</b> ? <span class="r384 r">file</span>.<span class="i">FullName</span> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e87c4fc15a3f59f5" class="i method">ToStringParser</a>(<span class="r383 r">context</span>, <span class="r382 r">obj</span>);
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r385 r">filePath</span>))
                {
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r385 r">filePath</span>,
                        <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r381 r">errorExtent</span>, <span class="s">&quot;InvalidFilenameOption&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">InvalidFilenameOption</span>);
                }
 
                <a href="../../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r386 rd" class="r386 r">provider</span>;
                <a href="../../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r387 rd" class="r387 r">sessionState</span> = <b>new</b> <a href="../../SessionStatePublic.cs.html#45f5fbc7afc57ae4" class="t constructor">SessionState</a>(<span class="r383 r">context</span>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>);
 
                <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r388 rd" class="r388 r">filePaths</span> =
                    <span class="r387 r">sessionState</span>.<a href="../../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../../PathInterfaces.cs.html#4931b2e78f6aaef1" class="i method">GetResolvedProviderPathFromPSPath</a>(<span class="r385 r">filePath</span>, <b>out</b> <span class="r386 r">provider</span>);
 
                <span class="c">// Make sure that the path is in the file system - that&#39;s all we can handle currently...</span>
                <b>if</b> (!<span class="r386 r">provider</span>.<a href="../../DataStoreAdapterProvider.cs.html#13e2cce7adaad137" class="i method">NameEquals</a>(<span class="r383 r">context</span>.<a href="../../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
                {
                    <span class="c">// &quot;The current provider ({0}) cannot open a file&quot;</span>
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r385 r">filePath</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r381 r">errorExtent</span>,
                                                                   <span class="s">&quot;FileOpenError&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">FileOpenError</span>,
                                                                   <span class="r386 r">provider</span>.<a href="../../DataStoreAdapterProvider.cs.html#91a8d08ee3ba5a61" class="i property">FullName</a>);
                }
 
                <span class="c">// Make sure at least one file was found...</span>
                <b>if</b> (<span class="r388 r">filePaths</span> == <b>null</b> || <span class="r388 r">filePaths</span>.<span class="i">Count</span> &lt; 1)
                {
                    <span class="c">// &quot;No files matching &#39;{0}&#39; were found..&quot;</span>
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r385 r">filePath</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r381 r">errorExtent</span>,
                                                                   <span class="s">&quot;FileNotFound&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">FileNotFound</span>, <span class="r385 r">filePath</span>);
                }
 
                <b>if</b> (<span class="r388 r">filePaths</span>.<span class="i">Count</span> &gt; 1)
                {
                    <span class="c">// &quot;The path resolved to more than one file; can only process one file at a time.&quot;</span>
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r388 r">filePaths</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="r381 r">errorExtent</span>,
                                                                   <span class="s">&quot;AmbiguousPath&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">AmbiguousPath</span>);
                }
 
                <b>return</b> <span class="r388 r">filePaths</span>[0];
            }
            <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r389 rd" class="r389 r">rte</span>)
            {
                <span class="c">// Add the invocation info to this command...</span>
                <b>if</b> (<span class="r389 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a> != <b>null</b> &amp;&amp; <span class="r389 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#fd1ac7b3462d4426" class="i property">InvocationInfo</a> == <b>null</b>)
                    <span class="r389 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#14b8261653db7b03" class="i method">SetInvocationInfo</a>(<b>new</b> <a href="../../InvocationInfo.cs.html#05f8dff4c341ddae" class="t constructor">InvocationInfo</a>(<b>null</b>, <span class="r381 r">errorExtent</span>, <span class="r383 r">context</span>));
                <b>throw</b>;
            }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Controls the matching behaviour of the Where() operator.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="eae056a893fde0db" href="../../../R/eae056a893fde0db.html" target="n" data-glyph="18,0" class="t t"><span id="dd9d77204696ea0d">WhereOperatorSelectionMode</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return all matches.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="6ebb57f87aea6e54" href="../../../R/6ebb57f87aea6e54.html" target="n" data-glyph="24,1" class="i field">Default</a> = 0,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop processing after the first match.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="c3aac5cc1e458bfd" href="../../../R/c3aac5cc1e458bfd.html" target="n" data-glyph="24,1" class="i field">First</a> = 1,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return the last matching element.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="dab3601ee78f7c04" href="../../../R/dab3601ee78f7c04.html" target="n" data-glyph="24,1" class="i field">Last</a> = 2,       <span class="c">// return last match</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Skip until the condition is true, then return the rest.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="c6101205e463fd37" href="../../../R/c6101205e463fd37.html" target="n" data-glyph="24,1" class="i field">SkipUntil</a> = 3,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return elements until the condition is true then skip the rest.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="d02acf67b31c613c" href="../../../R/d02acf67b31c613c.html" target="n" data-glyph="24,1" class="i field">Until</a> = 4,
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return an array of two elements, first index is matched elements, second index is the remaining elements.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="554e273ed9ab2f13" href="../../../R/554e273ed9ab2f13.html" target="n" data-glyph="24,1" class="i field">Split</a> = 5,
    }
 
    <b>internal static class</b> <a id="3856cc8435546884" href="../../../R/3856cc8435546884.html" target="n" data-glyph="2,0" class="t t">EnumerableOps</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implements the Where(expression) operation on collections.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r390 r">enumerator</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The enumerator over the collection to search.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r391 r">expressionSB</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A ScriptBlock where its result is treated as a boolean, or null to</span>
        <span class="c">///</span><span class="c"> return all collection objects with WhereOperatorSelectionMode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r392 r">selectionMode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the WhereOperatorSelectionMode for operator, defaults to All.</span>
        <span class="c">///</span><span class="c"> This is of type object to allow either enum values or strings to be passed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r393 r">numberToReturn</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The number of elements to return.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static object</b> <a id="469a215b17bc7f15" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Where</a>(<span class="i">IEnumerator</span> <span id="r390 rd" class="r390 r">enumerator</span>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r391 rd" class="r391 r">expressionSB</span>, <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a> <span id="r392 rd" class="r392 r">selectionMode</span>, <b>int</b> <span id="r393 rd" class="r393 r">numberToReturn</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r390 r">enumerator</span> != <b>null</b>, <span class="s">&quot;The Where() operator should never receive a null enumerator value from the runtime.&quot;</span>);
 
            <b>if</b> (<span class="r393 r">numberToReturn</span> &lt; 0)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentOutOfRangeException</span>(<b>nameof</b>(<span class="r393 r">numberToReturn</span>), <span class="r393 r">numberToReturn</span>, <span class="i">ParserStrings</span>.<span class="i">NumberToReturnMustBeGreaterThanZero</span>);
            }
 
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r394 rd" class="r394 r">context</span> = <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>;
 
            <span class="c">// Optimization to speed up the case where there is no condition expression</span>
            <span class="c">// Useful when using selection mode and number to return to do fast list</span>
            <span class="c">// slicing.</span>
            <b>if</b> (<span class="r391 r">expressionSB</span> == <b>null</b>)
            {
                <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#6ebb57f87aea6e54" class="i field">Default</a>)
                {
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">ParserStrings</span>.<span class="i">EmptyExpressionRequiresANonDefaultMode</span>);
                }
 
                <b>var</b> <span id="r395 rd" class="r395 r">rest</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
                <b>object</b> <span id="r396 rd" class="r396 r">current</span> = <b>null</b>;
 
                <b>int</b> <span id="r397 rd" class="r397 r">index</span> = 0;
                <b>if</b> (<span class="r393 r">numberToReturn</span> == 0)
                {
                    <span class="r393 r">numberToReturn</span> = 1;
                }
 
                <span class="c">// Skip the first N elements and return the rest</span>
                <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#c6101205e463fd37" class="i field">SkipUntil</a>)
                {
                    <b>while</b> (<span class="r397 r">index</span> &lt; <span class="r393 r">numberToReturn</span> &amp;&amp; <a href="#6ced3521138ce182" class="i method">MoveNext</a>(<b>null</b>, <span class="r390 r">enumerator</span>))
                    {
                        <span class="r397 r">index</span>++;
                    }
                    <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r394 r">context</span>, <span class="r390 r">enumerator</span>))
                    {
                        <span class="r395 r">rest</span>.<span class="i">Add</span>(<a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r390 r">enumerator</span>));
                    }
 
                    <b>return</b> <span class="r395 r">rest</span>.<span class="i">ToArray</span>();
                }
 
                <span class="c">// Return the last N elements</span>
                <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#dab3601ee78f7c04" class="i field">Last</a>)
                {
                    <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r394 r">context</span>, <span class="r390 r">enumerator</span>))
                    {
                        <span class="r396 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r390 r">enumerator</span>);
                        <b>if</b> (<span class="r393 r">numberToReturn</span> &gt; 1)
                        {
                            <span class="r395 r">rest</span>.<span class="i">Add</span>(<span class="r396 r">current</span>);
                            <b>if</b> (<span class="r395 r">rest</span>.<span class="i">Count</span> &gt; <span class="r393 r">numberToReturn</span>)
                            {
                                <span class="r395 r">rest</span>.<span class="i">RemoveAt</span>(0);
                            }
                        }
                    }
 
                    <b>if</b> (<span class="r393 r">numberToReturn</span> == 1)
                    {
                        <b>return</b> <b>new</b> <b>object</b>[] { <span class="r396 r">current</span> };
                    }
 
                    <b>return</b> <span class="r395 r">rest</span>.<span class="i">ToArray</span>();
                }
 
                <b>object</b>[] <span id="r398 rd" class="r398 r">first</span> = <b>new</b> <b>object</b>[<span class="r393 r">numberToReturn</span>];
                <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r394 r">context</span>, <span class="r390 r">enumerator</span>))
                {
                    <span class="r396 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r390 r">enumerator</span>);
                    <span class="r398 r">first</span>[<span class="r397 r">index</span>++] = <span class="r396 r">current</span>;
                    <b>if</b> (<span class="r397 r">index</span> &gt;= <span class="r393 r">numberToReturn</span>)
                    {
                        <span class="c">// Return the first N elements</span>
                        <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#c3aac5cc1e458bfd" class="i field">First</a> || <span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#d02acf67b31c613c" class="i field">Until</a>)
                        {
                            <b>return</b> <span class="r398 r">first</span>;
                        }
                        <b>else</b>
                        {
                            <b>break</b>;
                        }
                    }
                }
 
                <span class="c">// Return a array of two elements, the first element is the first N elements,</span>
                <span class="c">// the second element is the remainder of the input</span>
                <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#554e273ed9ab2f13" class="i field">Split</a>)
                {
                    <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r394 r">context</span>, <span class="r390 r">enumerator</span>))
                    {
                        <b>var</b> <span id="r399 rd" class="r399 r">e</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r390 r">enumerator</span>);
                        <span class="r395 r">rest</span>.<span class="i">Add</span>(<span class="r399 r">e</span>);
                    }
 
                    <b>return</b> <b>new</b> <b>object</b>[] { <span class="r398 r">first</span>, <span class="r395 r">rest</span>.<span class="i">ToArray</span>() };
                }
 
                <b>return</b> <span class="r398 r">first</span>;
            }
 
            <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r400 rd" class="r400 r">matches</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
            <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r401 rd" class="r401 r">notMatched</span> = <b>null</b>;
            <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#554e273ed9ab2f13" class="i field">Split</a>)
            {
                <span class="r401 r">notMatched</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
            }
 
            <b>var</b> <span id="r402 rd" class="r402 r">resultCollection</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r403 rd" class="r403 r">outputPipe</span> = <b>new</b> <a href="../../Pipe.cs.html#99288ee09b9642bb" class="t constructor">Pipe</a>(<span class="r402 r">resultCollection</span>);
            <b>bool</b> <span id="r404 rd" class="r404 r">returnTheRest</span> = <b>false</b>;
 
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r394 r">context</span>, <span class="r390 r">enumerator</span>))
            {
                <b>var</b> <span id="r405 rd" class="r405 r">ie</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r390 r">enumerator</span>);
 
                <b>if</b> (<span class="r404 r">returnTheRest</span>)
                {
                    <span class="r400 r">matches</span>.<span class="i">Add</span>(<span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>));
                    <b>if</b> (<span class="r393 r">numberToReturn</span> &gt; 0 &amp;&amp; <span class="r400 r">matches</span>.<span class="i">Count</span> &gt;= <span class="r393 r">numberToReturn</span>)
                    {
                        <b>break</b>;
                    }
                    <b>else</b>
                    {
                        <b>continue</b>;
                    }
                }
 
                <span class="r402 r">resultCollection</span>.<span class="i">Clear</span>();
                <span class="r391 r">expressionSB</span>.<a href="../CompiledScriptBlock.cs.html#3dc0ff0ae9ff4d22" class="i method">InvokeWithPipeImpl</a>(<b>false</b>, <b>null</b>, <b>null</b>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../../lang/scriptblock.cs.html#5e78734ffe1c6ed3" class="i field">WriteToCurrentErrorPipe</a>, <span class="r405 r">ie</span>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <span class="r403 r">outputPipe</span>, <b>null</b>);
                <b>bool</b> <span id="r406 rd" class="r406 r">elementMatched</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">IsTrue</span>(<span class="r402 r">resultCollection</span>);
 
                <b>if</b> (<span class="r406 r">elementMatched</span>)
                {
                    <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#d02acf67b31c613c" class="i field">Until</a>)
                    {
                        <b>break</b>;
                    }
                    <b>else</b> <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#dab3601ee78f7c04" class="i field">Last</a>)
                    {
                        <b>if</b> (<span class="r393 r">numberToReturn</span> == 0)
                        {
                            <span class="r393 r">numberToReturn</span> = 1;
                        }
 
                        <b>if</b> (<span class="r400 r">matches</span>.<span class="i">Count</span> &lt; <span class="r393 r">numberToReturn</span>)
                        {
                            <span class="r400 r">matches</span>.<span class="i">Add</span>(<span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>));
                        }
                        <b>else</b>
                        {
                            <b>if</b> (<span class="r393 r">numberToReturn</span> == 1)
                            {
                                <span class="r400 r">matches</span>[0] = <span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>);
                            }
                            <b>else</b>
                            {
                                <span class="c">// Maintains a sliding window</span>
                                <span class="r400 r">matches</span>.<span class="i">RemoveAt</span>(0);
                                <span class="r400 r">matches</span>.<span class="i">Add</span>(<span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>));
                            }
                        }
                    }
                    <b>else</b> <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#c6101205e463fd37" class="i field">SkipUntil</a>)
                    {
                        <span class="r400 r">matches</span>.<span class="i">Add</span>(<span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>));
                        <span class="r404 r">returnTheRest</span> = <b>true</b>;
                    }
                    <b>else</b>
                    {
                        <span class="r400 r">matches</span>.<span class="i">Add</span>(<span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>));
                    }
 
                    <b>if</b> (<span class="r392 r">selectionMode</span> != <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#dab3601ee78f7c04" class="i field">Last</a>)
                    {
                        <b>if</b> (<span class="r393 r">numberToReturn</span> == 0 &amp;&amp; <span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#c3aac5cc1e458bfd" class="i field">First</a>)
                        {
                            <b>break</b>;
                        }
 
                        <span class="c">// If number to return is not 0, First and Any have identical behaviour</span>
                        <b>if</b> (<span class="r393 r">numberToReturn</span> != 0 &amp;&amp; <span class="r393 r">numberToReturn</span> == <span class="r400 r">matches</span>.<span class="i">Count</span>)
                        {
                            <b>break</b>;
                        }
                    }
                }
                <b>else</b> <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#d02acf67b31c613c" class="i field">Until</a>)
                {
                    <span class="c">// no match so in the until case, we add the value until the count is reached</span>
                    <span class="r400 r">matches</span>.<span class="i">Add</span>(<span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>));
                    <b>if</b> (<span class="r393 r">numberToReturn</span> &gt; 0 &amp;&amp; <span class="r400 r">matches</span>.<span class="i">Count</span> &gt;= <span class="r393 r">numberToReturn</span>)
                    {
                        <b>break</b>;
                    }
                }
                <b>else</b> <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#554e273ed9ab2f13" class="i field">Split</a>)
                {
                    <span class="c">// If in split mode, record both matched and noteMatched elements.</span>
                    <span class="r401 r">notMatched</span>.<span class="i">Add</span>(<span class="r405 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r405 r">ie</span>));
                }
            }
 
            <span class="c">// If split was specified, return both sets of objects</span>
            <b>if</b> (<span class="r392 r">selectionMode</span> == <a href="#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="#554e273ed9ab2f13" class="i field">Split</a>)
            {
                <span class="c">// We may have stopped looping before processing the whole collection because</span>
                <span class="c">// reached the max number of matching elements to return. In that case,</span>
                <span class="c">// add remaining elements to the notMatched collection.</span>
                <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r394 r">context</span>, <span class="r390 r">enumerator</span>))
                {
                    <b>var</b> <span id="r407 rd" class="r407 r">ie</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r390 r">enumerator</span>);
                    <span class="r401 r">notMatched</span>.<span class="i">Add</span>(<span class="r407 r">ie</span> == <b>null</b> ? <b>null</b> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r407 r">ie</span>));
                }
 
                <b>return</b> <b>new</b> <b>object</b>[] { <span class="r400 r">matches</span>, <span class="r401 r">notMatched</span> };
            }
 
            <b>return</b> <span class="r400 r">matches</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implements the ForEach() operator.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r408 r">enumerator</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The collection to operate over.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r409 r">expression</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r410 r">arguments</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An object array containing the results of the expression evaluation.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static object</b> <a id="a0a405eb0ae3c72c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ForEach</a>(<span class="i">IEnumerator</span> <span id="r408 rd" class="r408 r">enumerator</span>, <b>object</b> <span id="r409 rd" class="r409 r">expression</span>, <b>object</b>[] <span id="r410 rd" class="r410 r">arguments</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r408 r">enumerator</span> != <b>null</b>, <span class="s">&quot;The ForEach() operator should never receive a null enumerator value from the runtime.&quot;</span>);
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r410 r">arguments</span> != <b>null</b>, <span class="s">&quot;The ForEach() operator should never receive a null value for the &#39;arguments&#39; parameter from the runtime.&quot;</span>);
            <b>if</b> (<span class="r409 r">expression</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r409 r">expression</span>));
            }
 
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r411 rd" class="r411 r">context</span> = <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>;
 
            <span class="c">// If expression argument is a .Net type then convert the collection to that type</span>
            <span class="c">// if the target type is a collection or array, then the result will be a collection of exactly</span>
            <span class="c">// that type. If the target type is not a collection type then return a generic collection of that type.</span>
            <span class="i">Type</span> <span id="r412 rd" class="r412 r">targetType</span> = <span class="r409 r">expression</span> <b>as</b> <span class="i">Type</span>;
            <b>if</b> (<span class="r412 r">targetType</span> != <b>null</b>)
            {
                <b>dynamic</b> <span id="r413 rd" class="r413 r">resultCollection</span> = <b>null</b>;
 
                <b>if</b> (<span class="r412 r">targetType</span>.<span class="i">GetInterface</span>(<span class="s">&quot;System.Collections.ICollection&quot;</span>) != <b>null</b>)
                {
                    <span class="c">// If the target type is an array, accumulate all the elements</span>
                    <span class="c">// then use the PowerShell type converter to turn it into an array</span>
                    <span class="c">// of the correct type.</span>
                    <b>if</b> (<span class="r412 r">targetType</span>.<span class="i">IsArray</span>)
                    {
                        <b>var</b> <span id="r414 rd" class="r414 r">list</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
                        <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<b>null</b>, <span class="r408 r">enumerator</span>))
                        {
                            <b>object</b> <span id="r415 rd" class="r415 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r408 r">enumerator</span>);
                            <span class="r414 r">list</span>.<span class="i">Add</span>(<span class="r415 r">current</span>);
                        }
 
                        <b>return</b> <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r414 r">list</span>, <span class="r412 r">targetType</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                    }
 
                    <span class="c">// If it&#39;s a generic type then make sure it only has one type argument</span>
                    <b>if</b> (<span class="r412 r">targetType</span>.<span class="i">IsGenericType</span>)
                    {
                        <span class="i">Type</span>[] <span id="r416 rd" class="r416 r">ta</span> = <span class="r412 r">targetType</span>.<span class="i">GetGenericArguments</span>();
                        <b>if</b> (<span class="r416 r">ta</span>.<span class="i">Length</span> != 1)
                        {
                            <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r409 r">expression</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                                <b>null</b>, <span class="s">&quot;ForEachBadGenericConversionTypeSpecified&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">ForEachBadGenericConversionTypeSpecified</span>, <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<span class="i">ConvertTo</span>&lt;<b>string</b>&gt;(<span class="r412 r">targetType</span>, <b>null</b>));
                        }
 
                        <span class="r413 r">resultCollection</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">AsPSObject</span>(<span class="i">Activator</span>.<span class="i">CreateInstance</span>(<span class="r412 r">targetType</span>));
                        <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r411 r">context</span>, <span class="r408 r">enumerator</span>))
                        {
                            <b>object</b> <span id="r417 rd" class="r417 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r408 r">enumerator</span>);
                            <span class="c">// Let the PSObject method invocation mechanism take care of</span>
                            <span class="c">// any required conversions, etc.</span>
                            <span class="r413 r">resultCollection</span>.<span class="i">Add</span>(<span class="r417 r">current</span>);
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Target is not a collection so return a Collection&lt;targetType&gt;</span>
                    <span class="i">Type</span> <span id="r418 rd" class="r418 r">resultCollectionType</span> = <b>typeof</b>(<span class="i">Collection</span>&lt;&gt;).<span class="i">MakeGenericType</span>(<span class="r412 r">targetType</span>);
                    <span class="r413 r">resultCollection</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">AsPSObject</span>(<span class="i">Activator</span>.<span class="i">CreateInstance</span>(<span class="r418 r">resultCollectionType</span>));
 
                    <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r411 r">context</span>, <span class="r408 r">enumerator</span>))
                    {
                        <b>object</b> <span id="r419 rd" class="r419 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r408 r">enumerator</span>);
                        <span class="c">// Let the PSObject method invocation mechanism take care of</span>
                        <span class="c">// any required conversions, etc.</span>
                        <span class="r413 r">resultCollection</span>.<span class="i">Add</span>(<span class="r419 r">current</span>);
                    }
                }
 
                <b>if</b> (<span class="r413 r">resultCollection</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r409 r">expression</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <b>null</b>, <span class="s">&quot;ForEachTypeConversionFailed&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">ForEachTypeConversionFailed</span>, <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<span class="i">ConvertTo</span>&lt;<b>string</b>&gt;(<span class="r412 r">targetType</span>, <b>null</b>));
                }
 
                <b>return</b> <span class="r413 r">resultCollection</span>;
            }
 
            <span class="c">// If the expression is a script block, it will be executed in the current scope</span>
            <span class="c">// once on each element.</span>
            <b>var</b> <span id="r420 rd" class="r420 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
            <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r421 rd" class="r421 r">sb</span> = <span class="r409 r">expression</span> <b>as</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>;
            <b>if</b> (<span class="r421 r">sb</span> != <b>null</b>)
            {
                <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r422 rd" class="r422 r">outputPipe</span> = <b>new</b> <span class="t">Pipe</span>(<span class="r420 r">result</span>);
                <b>if</b> (<span class="r421 r">sb</span>.<a href="../CompiledScriptBlock.cs.html#680dd2bf19ec8364" class="i property">HasBeginBlock</a>)
                {
                    <span class="r421 r">sb</span>.<a href="../CompiledScriptBlock.cs.html#278ab6100f6c91e7" class="i method">InvokeWithPipeImpl</a>(<a href="../CompiledScriptBlock.cs.html#34af49554c079f15" class="t t">ScriptBlockClauseToInvoke</a>.<a href="../CompiledScriptBlock.cs.html#85ca98782a255c39" class="i field">Begin</a>, <b>false</b>, <b>null</b>, <b>null</b>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../../lang/scriptblock.cs.html#5e78734ffe1c6ed3" class="i field">WriteToCurrentErrorPipe</a>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <span class="r422 r">outputPipe</span>, <b>null</b>, <span class="r410 r">arguments</span>);
                }
 
                <a href="../CompiledScriptBlock.cs.html#34af49554c079f15" class="t t">ScriptBlockClauseToInvoke</a> <span id="r423 rd" class="r423 r">processClause</span> = (<span class="r421 r">sb</span>.<a href="../CompiledScriptBlock.cs.html#5ee5abba7294e48d" class="i property">HasProcessBlock</a>) ? <a href="../CompiledScriptBlock.cs.html#34af49554c079f15" class="t t">ScriptBlockClauseToInvoke</a>.<a href="../CompiledScriptBlock.cs.html#94c9d79f22dcf339" class="i field">Process</a> : <a href="../CompiledScriptBlock.cs.html#34af49554c079f15" class="t t">ScriptBlockClauseToInvoke</a>.<a href="../CompiledScriptBlock.cs.html#0b20b164588bea50" class="i field">End</a>;
                <b>object</b> <span id="r424 rd" class="r424 r">ie</span> = <b>null</b>;
                <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r411 r">context</span>, <span class="r408 r">enumerator</span>))
                {
                    <span class="r424 r">ie</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r408 r">enumerator</span>);
                    <b>if</b> (<span class="r424 r">ie</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                    {
                        <span class="r421 r">sb</span>.<a href="../CompiledScriptBlock.cs.html#278ab6100f6c91e7" class="i method">InvokeWithPipeImpl</a>(<span class="r423 r">processClause</span>, <b>false</b>, <b>null</b>, <b>null</b>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../../lang/scriptblock.cs.html#5e78734ffe1c6ed3" class="i field">WriteToCurrentErrorPipe</a>, <span class="r424 r">ie</span>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <span class="r422 r">outputPipe</span>, <b>null</b>, <span class="r410 r">arguments</span>);
                    }
                }
 
                <b>if</b> (<span class="r423 r">processClause</span> == <a href="../CompiledScriptBlock.cs.html#34af49554c079f15" class="t t">ScriptBlockClauseToInvoke</a>.<a href="../CompiledScriptBlock.cs.html#94c9d79f22dcf339" class="i field">Process</a> &amp;&amp; <span class="r421 r">sb</span>.<a href="../CompiledScriptBlock.cs.html#e0cf74ca3d5f266a" class="i property">HasEndBlock</a>)
                {
                    <span class="c">// $_ has the same value as it did in the last iteration of the process loop</span>
                    <span class="r421 r">sb</span>.<a href="../CompiledScriptBlock.cs.html#278ab6100f6c91e7" class="i method">InvokeWithPipeImpl</a>(<a href="../CompiledScriptBlock.cs.html#34af49554c079f15" class="t t">ScriptBlockClauseToInvoke</a>.<a href="../CompiledScriptBlock.cs.html#0b20b164588bea50" class="i field">End</a>, <b>false</b>, <b>null</b>, <b>null</b>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../../lang/scriptblock.cs.html#5e78734ffe1c6ed3" class="i field">WriteToCurrentErrorPipe</a>, <span class="r424 r">ie</span>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <span class="r422 r">outputPipe</span>, <b>null</b>, <span class="r410 r">arguments</span>);
                }
            }
            <b>else</b>
            {
                <span class="c">// Deal with member gets, sets and invokes</span>
                <b>string</b> <span id="r425 rd" class="r425 r">name</span> = <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#e27ca21481dc9c96" class="i method">ConvertTo</a>&lt;<b>string</b>&gt;(<span class="r409 r">expression</span>, <b>null</b>);
                <b>var</b> <span id="r426 rd" class="r426 r">numArgs</span> = <span class="r410 r">arguments</span>.<span class="i">Length</span>;
                <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="k">var</a> <span id="r427 rd" class="r427 r">languageMode</span> = <span class="r411 r">context</span>.<a href="../../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a>;
 
                <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r411 r">context</span>, <span class="r408 r">enumerator</span>))
                {
                    <b>object</b> <span id="r428 rd" class="r428 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r408 r">enumerator</span>);
                    <b>object</b> <span id="r429 rd" class="r429 r">basedCurrent</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r428 r">current</span>);
                    <span class="i">Hashtable</span> <span id="r430 rd" class="r430 r">ht</span> = <span class="r429 r">basedCurrent</span> <b>as</b> <span class="i">Hashtable</span>;
                    <b>if</b> (<span class="r430 r">ht</span> != <b>null</b>)
                    {
                        <span class="c">// special case hashtables since we don&#39;t want to hit a method name</span>
                        <b>switch</b> (<span class="r426 r">numArgs</span>)
                        {
                            <b>case</b> 0:
                                <span class="c">// No args so do a set</span>
                                <b>object</b> <span id="r431 rd" class="r431 r">element</span> = <span class="r430 r">ht</span>[<span class="r425 r">name</span>];
                                <span class="r420 r">result</span>.<span class="i">Add</span>(<span class="r431 r">element</span> != <b>null</b> ? <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r431 r">element</span>) : <b>null</b>);
                                <b>break</b>;
 
                            <b>case</b> 1:
                                <span class="c">// 1 args so set as a scalar</span>
                                <span class="r430 r">ht</span>[<span class="r425 r">name</span>] = <span class="r410 r">arguments</span>[0];
                                <b>break</b>;
 
                            <b>default</b>:
                                <span class="c">// more than one arg, just assign as is</span>
                                <span class="r430 r">ht</span>[<span class="r425 r">name</span>] = <span class="r410 r">arguments</span>;
                                <b>break</b>;
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// handle the null case with PowerShell semantics:</span>
                        <span class="c">// - retrieving a property on null adds a null to the result set</span>
                        <span class="c">// - setting a property on null or trying to invoke a method is an error</span>
                        <b>if</b> (<span class="r428 r">current</span> == <b>null</b>)
                        {
                            <b>if</b> (<span class="r410 r">arguments</span>.<span class="i">Length</span> == 0)
                            {
                                <span class="r420 r">result</span>.<span class="i">Add</span>(<b>null</b>);
                            }
                            <b>else</b>
                            {
                                <b>var</b> <span id="r432 rd" class="r432 r">nullRefException</span> = <b>new</b> <span class="i">NullReferenceException</span>();
                                <b>throw</b> <b>new</b> <span class="t">MethodInvocationException</span>(
                                    <span class="r432 r">nullRefException</span>.<span class="i">GetType</span>().<span class="i">Name</span>,
                                    <span class="r432 r">nullRefException</span>,
                                    <span class="i">ExtendedTypeSystem</span>.<span class="i">MethodInvocationException</span>,
                                    <span class="r425 r">name</span>, <span class="r410 r">arguments</span>.<span class="i">Length</span>, <span class="r432 r">nullRefException</span>.<span class="i">Message</span>);
                            }
 
                            <b>continue</b>;
                        }
 
                        <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r433 rd" class="r433 r">ie</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r428 r">current</span>);
                        <b>if</b> (<span class="r433 r">ie</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                        {
                            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r434 rd" class="r434 r">member</span> = <span class="r433 r">ie</span>.<a href="../../MshObject.cs.html#56bc82b240e4291b" class="i property">Members</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="r425 r">name</span>];
 
                            <span class="c">// If the property was not found, check strict mode...</span>
                            <b>if</b> (<span class="r434 r">member</span> == <b>null</b>)
                            {
                                <b>if</b> (<span class="r411 r">context</span>.<a href="../../ExecutionContext.cs.html#11a9985b406aed68" class="i method">IsStrictVersion</a>(2))
                                {
                                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                                        <b>null</b>, <span class="s">&quot;PropertyNotFoundStrict&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotFoundStrict</span>, <span class="r425 r">name</span>);
                                }
 
                                <b>if</b> (<span class="r426 r">numArgs</span> == 0)
                                {
                                    <span class="r420 r">result</span>.<span class="i">Add</span>(<b>null</b>);
                                    <b>continue</b>;
                                }
                                <b>else</b>
                                {
                                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r433 r">ie</span>, <b>typeof</b>(<span class="i">NullReferenceException</span>), <b>null</b>, <span class="s">&quot;ForEachNonexistentMemberReference&quot;</span>,
                                        <span class="i">ParserStrings</span>.<span class="i">ForEachNonexistentMemberReference</span>, <span class="r425 r">name</span>);
                                }
                            }
 
                            <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="k">var</a> <span id="r435 rd" class="r435 r">method</span> = <span class="r434 r">member</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="t t">PSMethodInfo</a>;
                            <b>if</b> (<span class="r435 r">method</span> != <b>null</b>)
                            {
                                <span class="c">// It&#39;s a method so check language modes to see if it&#39;s allowed.</span>
 
                                <span class="c">// Cannot invoke a method in RestrictedLanguage mode</span>
                                <b>if</b> (<span class="r427 r">languageMode</span> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#ea8105287b8c6b25" class="i field">RestrictedLanguage</a>)
                                {
                                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r428 r">current</span>, <b>typeof</b>(<a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a>),
                                        <b>null</b>, <span class="s">&quot;NoMethodInvocationInRestrictedLanguageMode&quot;</span>, <span class="i">InternalCommandStrings</span>.<span class="i">NoMethodInvocationInRestrictedLanguageMode</span>);
                                }
 
                                <span class="c">// In constrained language mode, can only execute methods on certain types.</span>
                                <b>if</b> (<span class="r427 r">languageMode</span> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>)
                                {
                                    <b>if</b> (!<a href="../../parser/TypeResolver.cs.html#5741cea1a14d9f96" class="t t">CoreTypes</a>.<span class="i">Contains</span>(<span class="r429 r">basedCurrent</span>.<span class="i">GetType</span>()))
                                    {
                                        <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r428 r">current</span>, <b>typeof</b>(<a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a>),
                                            <b>null</b>, <span class="s">&quot;MethodInvocationNotSupportedInConstrainedLanguage&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">InvokeMethodConstrainedLanguage</span>);
                                    }
                                }
 
                                <span class="r420 r">result</span>.<span class="i">Add</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r435 r">method</span>.<a href="../../MshMemberInfo.cs.html#f4f9695891d65945" class="i method">Invoke</a>(<span class="r410 r">arguments</span>)));
                            }
                            <b>else</b>
                            {
                                <a href="../../MshMemberInfo.cs.html#13ab3796654e613c" class="k">var</a> <span id="r436 rd" class="r436 r">property</span> = <span class="r434 r">member</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>;
 
                                <b>switch</b> (<span class="r426 r">numArgs</span>)
                                {
                                    <b>case</b> 0:
                                        <span class="c">// No args: do a get</span>
                                        <span class="r420 r">result</span>.<span class="i">Add</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r436 r">property</span>.<a href="../../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>));
                                        <b>break</b>;
 
                                    <b>case</b> 1:
                                        <span class="c">// 1 arg: set as a scalar</span>
                                        <span class="r436 r">property</span>.<a href="../../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a> = <span class="r410 r">arguments</span>[0];
                                        <b>break</b>;
 
                                    <b>default</b>:
                                        <span class="c">// more than one arg, just assign as is</span>
                                        <span class="r436 r">property</span>.<a href="../../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a> = <span class="r410 r">arguments</span>;
                                        <b>break</b>;
                                }
                            }
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r420 r">result</span>;
        }
 
        <b>internal static object</b> <a id="9c3918bea976973d" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SlicingIndex</a>(<b>object</b> <span id="r437 rd" class="r437 r">target</span>, <span class="i">IEnumerator</span> <span id="r438 rd" class="r438 r">indexes</span>, <span class="i">Func</span>&lt;<b>object</b>, <b>object</b>, <b>object</b>&gt; <span id="r439 rd" class="r439 r">indexer</span>)
        {
            <a href="#906468b10c209579" class="k">var</a> <span id="r440 rd" class="r440 r">fakeEnumerator</span> = <span class="r438 r">indexes</span> <b>as</b> <a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a>;
            <b>if</b> (<span class="r440 r">fakeEnumerator</span> != <b>null</b>)
            {
                <span class="c">// We have a non-enumerable object, we&#39;re trying to slice index with it.  It really should have</span>
                <span class="c">// been a single index, so we don&#39;t want to return an array, we just want to return the indexed value.</span>
                <b>return</b> <span class="r439 r">indexer</span>(<span class="r437 r">target</span>, <span class="r440 r">fakeEnumerator</span>.<a href="#95e4cda00e571988" class="i method">GetNonEnumerableObject</a>());
            }
 
            <b>var</b> <span id="r441 rd" class="r441 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<b>null</b>, <span class="r438 r">indexes</span>))
            {
                <b>var</b> <span id="r442 rd" class="r442 r">value</span> = <span class="r439 r">indexer</span>(<span class="r437 r">target</span>, <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r438 r">indexes</span>));
                <b>if</b> (<span class="r442 r">value</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                {
                    <span class="r441 r">result</span>.<span class="i">Add</span>(<span class="r442 r">value</span>);
                }
            }
 
            <b>return</b> <span class="r441 r">result</span>.<span class="i">ToArray</span>();
        }
 
        <b>private static void</b> <a id="c65a97a8bd42ffe7" href="../../../R/c65a97a8bd42ffe7.html" target="n" data-glyph="76,1" class="i method">FlattenResults</a>(<b>object</b> <span id="r443 rd" class="r443 r">o</span>, <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r444 rd" class="r444 r">result</span>)
        {
            <b>var</b> <span id="r445 rd" class="r445 r">e</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#837b38179d9ca088" class="i method">GetEnumerator</a>(<span class="r443 r">o</span>);
            <b>if</b> (<span class="r445 r">e</span> != <b>null</b>)
            {
                <b>while</b> (<span class="r445 r">e</span>.<span class="i">MoveNext</span>())
                {
                    <span class="r443 r">o</span> = <span class="r445 r">e</span>.<span class="i">Current</span>;
                    <b>if</b> (<span class="r443 r">o</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                    {
                        <span class="r444 r">result</span>.<span class="i">Add</span>(<span class="r443 r">o</span>);
                    }
                }
            }
            <b>else</b>
            {
                <span class="r444 r">result</span>.<span class="i">Add</span>(<span class="r443 r">o</span>);
            }
        }
 
        <b>private static void</b> <a id="e6663f79e118cd1c" href="../../../R/e6663f79e118cd1c.html" target="n" data-glyph="76,1" class="i method">PropertyGetterWorker</a>(<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt; <span id="r446 rd" class="r446 r">getMemberBinderSite</span>,
                                                 <span class="i">IEnumerator</span> <span id="r447 rd" class="r447 r">enumerator</span>,
                                                 <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r448 rd" class="r448 r">context</span>,
                                                 <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r449 rd" class="r449 r">result</span>)
        {
            <span class="i">RuntimeHelpers</span>.<span class="i">EnsureSufficientExecutionStack</span>();
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r448 r">context</span>, <span class="r447 r">enumerator</span>))
            {
                <b>var</b> <span id="r450 rd" class="r450 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r447 r">enumerator</span>);
                <b>var</b> <span id="r451 rd" class="r451 r">o</span> = <span class="r446 r">getMemberBinderSite</span>.<span class="i">Target</span>.<span class="i">Invoke</span>(<span class="r446 r">getMemberBinderSite</span>, <span class="r450 r">current</span>);
                <b>if</b> (<span class="r451 r">o</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                {
                    <span class="i">FlattenResults</span>(<span class="r451 r">o</span>, <span class="r449 r">result</span>);
                }
                <b>else</b>
                {
                    <span class="c">// Recurse through collections if current didn&#39;t have the property.</span>
                    <b>var</b> <span id="r452 rd" class="r452 r">nestedEnumerator</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#837b38179d9ca088" class="i method">GetEnumerator</a>(<span class="r450 r">current</span>);
                    <b>if</b> (<span class="r452 r">nestedEnumerator</span> != <b>null</b>)
                    {
                        <a href="#e6663f79e118cd1c" class="i method">PropertyGetterWorker</a>(<span class="r446 r">getMemberBinderSite</span>, <span class="r452 r">nestedEnumerator</span>, <span class="r448 r">context</span>, <span class="r449 r">result</span>);
                    }
                }
            }
        }
 
        <b>internal static object</b> <a id="1edd4cd7d68b6ea7" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">PropertyGetter</a>(<a href="../Binding/Binders.cs.html#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <span id="r453 rd" class="r453 r">binder</span>, <span class="i">IEnumerator</span> <span id="r454 rd" class="r454 r">enumerator</span>)
        {
            <b>var</b> <span id="r455 rd" class="r455 r">getMemberBinderSite</span> = <span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt;.<span class="i">Create</span>(<span class="r453 r">binder</span>);
            <b>var</b> <span id="r456 rd" class="r456 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r457 rd" class="r457 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
 
            <span class="i">PropertyGetterWorker</span>(<span class="r455 r">getMemberBinderSite</span>, <span class="r454 r">enumerator</span>, <span class="r457 r">context</span>, <span class="r456 r">result</span>);
 
            <b>if</b> (<span class="r456 r">result</span>.<span class="i">Count</span> == 1)
            {
                <b>return</b> <span class="r456 r">result</span>[0];
            }
 
            <b>if</b> (<span class="r456 r">result</span>.<span class="i">Count</span> == 0)
            {
                <b>if</b> (<span class="r457 r">context</span>.<a href="../../ExecutionContext.cs.html#11a9985b406aed68" class="i method">IsStrictVersion</a>(2))
                {
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <b>null</b>, <span class="s">&quot;PropertyNotFoundStrict&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotFoundStrict</span>, <span class="r453 r">binder</span>.<span class="i">Name</span>);
                }
 
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r456 r">result</span>.<span class="i">ToArray</span>();
        }
 
        <b>private static void</b> <a id="a82e6f21baeec3e3" href="../../../R/a82e6f21baeec3e3.html" target="n" data-glyph="76,1" class="i method">MethodInvokerWorker</a>(<span class="i">CallSite</span> <span id="r458 rd" class="r458 r">invokeMemberSite</span>,
                                                <span class="i">IEnumerator</span> <span id="r459 rd" class="r459 r">enumerator</span>,
                                                <b>object</b>[] <span id="r460 rd" class="r460 r">args</span>,
                                                <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r461 rd" class="r461 r">context</span>,
                                                <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r462 rd" class="r462 r">result</span>,
                                                <b>ref bool</b> <span id="r463 rd" class="r463 r">foundMethod</span>)
        {
            <span class="i">RuntimeHelpers</span>.<span class="i">EnsureSufficientExecutionStack</span>();
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r461 r">context</span>, <span class="r459 r">enumerator</span>))
            {
                <b>var</b> <span id="r464 rd" class="r464 r">current</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r459 r">enumerator</span>);
 
                <b>try</b>
                {
                    <span class="c">// The following 2 lines contain quite a bit of magic.  We know that invokeMemberSite is a CallSite,</span>
                    <span class="c">// but we don&#39;t know the exact delegate type so we can&#39;t use the usual code site.Target.Invoke.</span>
                    <span class="c">// The Target could be an unbounded number of different types - but we do know is that it will have</span>
                    <span class="c">// a delegate member named Target and we want to invoke that delegate.</span>
                    <span class="c">// We do know it will have a signature like:</span>
                    <span class="c">//     Func&lt;CallSite, object, &lt;unknown number of argument types&gt;, object&gt;</span>
                    <span class="c">// Because we don&#39;t know the number of arguments, we can use DynamicInvoke to call the delegate.</span>
                    <b>dynamic</b> <span id="r465 rd" class="r465 r">site</span> = <span class="r458 r">invokeMemberSite</span>;
                    <b>object</b> <span id="r466 rd" class="r466 r">o</span> = <span class="r465 r">site</span>.<span class="i">Target</span>.<span class="i">DynamicInvoke</span>(<span class="r460 r">args</span>.<span class="i">Prepend</span>(<span class="r464 r">current</span>).<span class="i">Prepend</span>(<span class="r458 r">invokeMemberSite</span>).<span class="i">ToArray</span>());
 
                    <span class="c">// If we get here, we successfully called one method, so set the flag so we don&#39;t report a MissingMethodException.</span>
                    <span class="c">// If there was a method, but it raised an exception, it doesn&#39;t matter that we aren&#39;t setting this flag, we&#39;ll</span>
                    <span class="c">// be reporting the method&#39;s exception anyway, not a MissingMethodException.</span>
                    <span class="r463 r">foundMethod</span> = <b>true</b>;
 
                    <span class="c">// void methods return AutomationNull.Value, so don&#39;t add it</span>
                    <b>if</b> (<span class="r466 r">o</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                    {
                        <a href="#c65a97a8bd42ffe7" class="i method">FlattenResults</a>(<span class="r466 r">o</span>, <span class="r462 r">result</span>);
                    }
                }
                <b>catch</b> (<span class="i">TargetInvocationException</span> <span id="r467 rd" class="r467 r">tie</span>)
                {
                    <span class="c">// If we tried to invoke a method that didn&#39;t exist, then we&#39;ll try enumerating the object and call the method on it&#39;s members.</span>
                    <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r468 rd" class="r468 r">rte</span> = <span class="r467 r">tie</span>.<span class="i">InnerException</span> <b>as</b> <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>;
                    <b>if</b> (<span class="r468 r">rte</span> != <b>null</b> &amp;&amp; <span class="r468 r">rte</span>.<a href="../../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../../ErrorPackage.cs.html#80d40f16f77d32bb" class="i property">FullyQualifiedErrorId</a>.<span class="i">Equals</span>(<a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#f809211b8b82f3f2" class="i field">MethodNotFoundErrorId</a>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                    {
                        <b>var</b> <span id="r469 rd" class="r469 r">nestedEnumerator</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#837b38179d9ca088" class="i method">GetEnumerator</a>(<span class="r464 r">current</span>);
                        <b>if</b> (<span class="r469 r">nestedEnumerator</span> != <b>null</b>)
                        {
                            <a href="#a82e6f21baeec3e3" class="i method">MethodInvokerWorker</a>(<span class="r458 r">invokeMemberSite</span>, <span class="r469 r">nestedEnumerator</span>, <span class="r460 r">args</span>, <span class="r461 r">context</span>, <span class="r462 r">result</span>, <b>ref</b> <span class="r463 r">foundMethod</span>);
                            <b>continue</b>;
                        }
                    }
 
                    <span class="c">// Always unwrap the TargetInvocationException - we are called via a delegate already and anything we throw</span>
                    <span class="c">// will get wrapped in a new TargetInvocationException.</span>
                    <b>throw</b> <span class="r467 r">tie</span>.<span class="i">InnerException</span>;
                }
            }
        }
 
        <span class="c">// Call some method(s) named by binder on all objects from enumerator - applied recursively if an object is itself enumerable</span>
        <span class="c">// and doesn&#39;t have the method.</span>
        <span class="c">// We don&#39;t necessarily call the same method on each object, just the same named method.</span>
        <b>internal static object</b> <a id="df64778aca038b39" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">MethodInvoker</a>(<a href="../Binding/Binders.cs.html#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a> <span id="r470 rd" class="r470 r">binder</span>,
                                             <span class="i">Type</span> <span id="r471 rd" class="r471 r">delegateType</span>,
                                             <span class="i">IEnumerator</span> <span id="r472 rd" class="r472 r">enumerator</span>,
                                             <b>object</b>[] <span id="r473 rd" class="r473 r">args</span>,
                                             <span class="i">Type</span> <span id="r474 rd" class="r474 r">typeForMessage</span>)
        {
            <b>var</b> <span id="r475 rd" class="r475 r">invokeMemberSite</span> = <span class="i">CallSite</span>.<span class="i">Create</span>(<span class="r471 r">delegateType</span>, <span class="r470 r">binder</span>);
            <b>var</b> <span id="r476 rd" class="r476 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r477 rd" class="r477 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
 
            <b>bool</b> <span id="r478 rd" class="r478 r">foundMethod</span> = <b>false</b>;
            <span class="i">MethodInvokerWorker</span>(<span class="r475 r">invokeMemberSite</span>, <span class="r472 r">enumerator</span>, <span class="r473 r">args</span>, <span class="r477 r">context</span>, <span class="r476 r">result</span>, <b>ref</b> <span class="r478 r">foundMethod</span>);
 
            <b>if</b> (<span class="r476 r">result</span>.<span class="i">Count</span> == 1)
            {
                <b>return</b> <span class="r476 r">result</span>[0];
            }
 
            <b>if</b> (!<span class="r478 r">foundMethod</span>)
            {
                <span class="c">// We must have had an empty collection - throw an error.</span>
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <b>null</b>,
                                                               <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#f809211b8b82f3f2" class="i field">MethodNotFoundErrorId</a>,
                                                               <span class="i">ParserStrings</span>.<span class="i">MethodNotFound</span>, <span class="r474 r">typeForMessage</span>.<span class="i">FullName</span>,
                                                               <span class="r470 r">binder</span>.<span class="i">Name</span>);
            }
 
            <b>if</b> (<span class="r476 r">result</span>.<span class="i">Count</span> == 0)
            {
                <span class="c">// All void methods - don&#39;t return a value.</span>
                <b>return</b> <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
            }
 
            <b>return</b> <span class="r476 r">result</span>.<span class="i">ToArray</span>();
        }
 
        <b>internal static object</b> <a id="e56499431a4a0aaf" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Multiply</a>(<span class="i">IEnumerator</span> <span id="r479 rd" class="r479 r">enumerator</span>, <b>uint</b> <span id="r480 rd" class="r480 r">times</span>)
        {
            <a href="#906468b10c209579" class="k">var</a> <span id="r481 rd" class="r481 r">fakeEnumerator</span> = <span class="r479 r">enumerator</span> <b>as</b> <a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a>;
            <b>if</b> (<span class="r481 r">fakeEnumerator</span> != <b>null</b>)
            {
                <span class="c">// We have a non-enumerable object, we&#39;re trying to multiply something to it.  Generate an error</span>
                <span class="c">// (or on the off chance that there is an implicit op, call that).</span>
                <b>return</b> <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#f7842dc94592a663" class="i method">ImplicitOp</a>(<span class="r481 r">fakeEnumerator</span>.<a href="#95e4cda00e571988" class="i method">GetNonEnumerableObject</a>(),
                                            <span class="r480 r">times</span>,
                                            <span class="s">&quot;op_Multiply&quot;</span>, <b>null</b>, <span class="s">&quot;*&quot;</span>);
            }
 
            <b>var</b> <span id="r482 rd" class="r482 r">originalList</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<b>null</b>, <span class="r479 r">enumerator</span>))
            {
                <span class="r482 r">originalList</span>.<span class="i">Add</span>(<a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r479 r">enumerator</span>));
            }
 
            <b>if</b> (<span class="r482 r">originalList</span>.<span class="i">Count</span> == 0)
            {
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CA1825</span> <span class="c">// Avoid zero-length array allocations</span>
                <span class="c">// Don&#39;t use Array.Empty&lt;object&gt;(); always return a new instance.</span>
                <b>return</b> <b>new</b> <b>object</b>[0];
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">CA1825</span> <span class="c">// Avoid zero-length array allocations</span>
            }
 
            <b>return</b> <a href="ArrayOps.cs.html#5cf5725d7bfacd81" class="t t">ArrayOps</a>.<span class="i">Multiply</span>(<span class="r482 r">originalList</span>.<span class="i">ToArray</span>(), <span class="r480 r">times</span>);
        }
 
        <b>internal static</b> <span class="i">IEnumerator</span> <a id="dfc3dc0631eb251d" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetEnumerator</a>(<span class="i">IEnumerable</span> <span id="r483 rd" class="r483 r">enumerable</span>)
        {
            <b>try</b>
            {
                <b>return</b> <span class="r483 r">enumerable</span>.<span class="i">GetEnumerator</span>();
            }
            <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>)
            {
                <span class="c">// Just rethrow runtime exceptions...</span>
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r484 rd" class="r484 r">e</span>)
            {
                <b>throw</b> <b>new</b> <span class="t">ExtendedTypeSystemException</span>(
                    <span class="s">&quot;ExceptionInGetEnumerator&quot;</span>,
                    <span class="r484 r">e</span>,
                    <span class="i">ExtendedTypeSystem</span>.<span class="i">EnumerationException</span>,
                    <span class="r484 r">e</span>.<span class="i">Message</span>);
            }
        }
 
        <span class="c">// Sometimes we need to pretend something is enumerable when it isn&#39;t.  So we wrap the object in a collection and enumerate that.</span>
        <span class="c">// But sometimes we need to behave differently when an object is enumerable or not.  For example:</span>
        <span class="c">//</span>
        <span class="c">//     $o -eq $o</span>
        <span class="c">//</span>
        <span class="c">// If $o is enumerable, this expression will always return $null because we search for values in the LHS that match the RHS.</span>
        <span class="c">// If $o is not enumerable, this expression returns $true.</span>
        <span class="c">//</span>
        <span class="c">// The solution is to pretend the object is enumerable, return a real but custom enumerator.  In places that don&#39;t care</span>
        <span class="c">// about semantics (e.g. when writing to the pipe), the enumerator will work just fine.  In places where we care about</span>
        <span class="c">// language semantics, we can check the type of the enumerator and use the non-enumerable semantics instead.</span>
        <b>internal class</b> <a id="906468b10c209579" href="../../../R/906468b10c209579.html" target="n" data-glyph="2,1" class="t t"><span id="08e6533c994fb7a0">NonEnumerableObjectEnumerator</span></a> : <span class="i">IEnumerator</span>
        {
            <b>internal static</b> <span class="i">IEnumerator</span> <a id="1a21c93f06085e13" href="../../../R/1a21c93f06085e13.html" target="n" data-glyph="74,2" class="i method">Create</a>(<b>object</b> <span id="r485 rd" class="r485 r">obj</span>)
            {
                <b>return</b> <b>new</b> <span class="t">NonEnumerableObjectEnumerator</span>
                {
                    <a href="#67b8bcace2064ebd" class="i field">_obj</a> = <span class="r485 r">obj</span>,
                    <a href="#aa32760af8821a62" class="i field">_realEnumerator</a> = (<b>new</b>[] { <span class="r485 r">obj</span> }).<span class="i">GetEnumerator</span>()
                };
            }
 
            <b>private object</b> <a id="67b8bcace2064ebd" href="../../../R/67b8bcace2064ebd.html" target="n" data-glyph="46,2" class="i field">_obj</a>;
            <b>private</b> <span class="i">IEnumerator</span> <a id="aa32760af8821a62" href="../../../R/aa32760af8821a62.html" target="n" data-glyph="46,2" class="i field">_realEnumerator</a>;
 
            <b>bool</b> <span class="i">IEnumerator</span>.<a id="3ee915f4d27e493c" href="../../../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">MoveNext</a>()
            {
                <b>return</b> <a href="#aa32760af8821a62" class="i field">_realEnumerator</a>.<span class="i">MoveNext</span>();
            }
 
            <b>void</b> <span class="i">IEnumerator</span>.<a id="87d8bd084294aeac" href="../../../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">Reset</a>()
            {
                <a href="#aa32760af8821a62" class="i field">_realEnumerator</a>.<span class="i">Reset</span>();
            }
 
            <b>object</b> <span class="i">IEnumerator</span>.<a id="ad092a71b01f21ac" href="../../../R/../../0000000000.html" target="n" data-glyph="106,2" class="i property">Current</a>
            {
                <b>get</b> { <b>return</b> <a href="#aa32760af8821a62" class="i field">_realEnumerator</a>.<span class="i">Current</span>; }
            }
 
            <b>internal object</b> <a id="95e4cda00e571988" href="../../../R/95e4cda00e571988.html" target="n" data-glyph="74,2" class="i method">GetNonEnumerableObject</a>()
            {
                <b>return</b> <a href="#67b8bcace2064ebd" class="i field">_obj</a>;
            }
        }
 
        <b>internal static</b> <span class="i">IEnumerator</span> <a id="e406640f216c05dd" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetCOMEnumerator</a>(<b>object</b> <span id="r486 rd" class="r486 r">obj</span>)
        {
            <b>object</b> <span id="r487 rd" class="r487 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r486 r">obj</span>);
            <b>try</b>
            {
                <b>var</b> <span id="r488 rd" class="r488 r">enumerator</span> = (<span class="r487 r">targetValue</span> <b>as</b> <span class="i">IEnumerable</span>)?.<span class="i">GetEnumerator</span>();
                <b>if</b> (<span class="r488 r">enumerator</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r488 r">enumerator</span>;
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <b>return</b> <span class="r487 r">targetValue</span> <b>as</b> <span class="i">IEnumerator</span> ?? <a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a>.<a href="#1a21c93f06085e13" class="i method">Create</a>(<span class="r486 r">obj</span>);
        }
 
        <b>internal static</b> <span class="i">IEnumerator</span> <a id="7acde4d18960fcb1" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetGenericEnumerator</a>&lt;<span id="r489 rd t" class="r489 r t">T</span>&gt;(<span class="i">IEnumerable</span>&lt;<span class="r489 r t">T</span>&gt; <span id="r490 rd" class="r490 r">enumerable</span>)
        {
            <b>try</b>
            {
                <b>return</b> <span class="r490 r">enumerable</span>.<span class="i">GetEnumerator</span>();
            }
            <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>)
            {
                <span class="c">// Just rethrow runtime exceptions...</span>
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r491 rd" class="r491 r">e</span>)
            {
                <b>throw</b> <b>new</b> <span class="t">ExtendedTypeSystemException</span>(
                    <span class="s">&quot;ExceptionInGetEnumerator&quot;</span>,
                    <span class="r491 r">e</span>,
                    <span class="i">ExtendedTypeSystem</span>.<span class="i">EnumerationException</span>,
                    <span class="r491 r">e</span>.<span class="i">Message</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A routine used to advance an enumerator and catch errors that might occur</span>
        <span class="c">///</span><span class="c"> performing the operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r492 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context used to see if the pipeline is stopping.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r493 r">enumerator</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">THe enumerator to advance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An error occurred moving to the next element in the enumeration.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the move succeeded.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="6ced3521138ce182" href="../../../R/6ced3521138ce182.html" target="n" data-glyph="74,1" class="i method">MoveNext</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r492 rd" class="r492 r">context</span>, <span class="i">IEnumerator</span> <span id="r493 rd" class="r493 r">enumerator</span>)
        {
            <b>try</b>
            {
                <span class="c">// Check to see if we&#39;re stopping...</span>
                <b>if</b> (<span class="r492 r">context</span> != <b>null</b> &amp;&amp; <span class="r492 r">context</span>.<a href="../../ExecutionContext.cs.html#bc7d7c4d79ef05e4" class="i property">CurrentPipelineStopping</a>)
                    <b>throw</b> <b>new</b> <a href="../../../utils/ExecutionExceptions.cs.html#105b0214d3aab114" class="t constructor">PipelineStoppedException</a>();
 
                <b>return</b> <span class="r493 r">enumerator</span>.<span class="i">MoveNext</span>();
            }
            <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<a href="../../lang/parserutils.cs.html#a3a2a71cfea9c3b1" class="t t">FlowControlException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<a href="../../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r494 rd" class="r494 r">e</span>)
            {
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterExceptionWithInnerException</span>(<span class="r493 r">enumerator</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                    <b>null</b>, <span class="s">&quot;BadEnumeration&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">BadEnumeration</span>, <span class="r494 r">e</span>, <span class="r494 r">e</span>.<span class="i">Message</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wrapper caller for enumerator.Current - handles and republishes errors...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r495 r">enumerator</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The enumerator to read from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static object</b> <a id="25e919160dd3b048" href="../../../R/25e919160dd3b048.html" target="n" data-glyph="74,1" class="i method">Current</a>(<span class="i">IEnumerator</span> <span id="r495 rd" class="r495 r">enumerator</span>)
        {
            <b>try</b>
            {
                <b>return</b> <span class="r495 r">enumerator</span>.<span class="i">Current</span>;
            }
            <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<a href="../../../utils/ExecutionExceptions.cs.html#fa64ade1e4dc44f8" class="t t">ScriptCallDepthException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<a href="../../lang/parserutils.cs.html#a3a2a71cfea9c3b1" class="t t">FlowControlException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r496 rd" class="r496 r">e</span>)
            {
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterExceptionWithInnerException</span>(<span class="r495 r">enumerator</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                    <b>null</b>, <span class="s">&quot;BadEnumeration&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">BadEnumeration</span>, <span class="r496 r">e</span>, <span class="r496 r">e</span>.<span class="i">Message</span>);
            }
        }
 
        <b>internal static object</b> <a id="33dae20d988310b5" href="../../../R/33dae20d988310b5.html" target="n" data-glyph="74,1" class="i method">AddFakeEnumerable</a>(<a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a> <span id="r497 rd" class="r497 r">fakeEnumerator</span>, <b>object</b> <span id="r498 rd" class="r498 r">rhs</span>)
        {
            <span class="c">// We have a non-enumerable object, we&#39;re trying to add something to it.  Generate an error</span>
            <span class="c">// (or on the off chance that there is an implicit op, call that).</span>
            <a href="#906468b10c209579" class="k">var</a> <span id="r499 rd" class="r499 r">fakeEnumerator2</span> = <span class="r498 r">rhs</span> <b>as</b> <a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a>;
            <b>return</b> <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#f7842dc94592a663" class="i method">ImplicitOp</a>(<span class="r497 r">fakeEnumerator</span>.<a href="#95e4cda00e571988" class="i method">GetNonEnumerableObject</a>(),
                                        <span class="r499 r">fakeEnumerator2</span> != <b>null</b> ? <span class="r499 r">fakeEnumerator2</span>.<a href="#95e4cda00e571988" class="i method">GetNonEnumerableObject</a>() : <span class="r498 r">rhs</span>,
                                        <span class="s">&quot;op_Addition&quot;</span>, <b>null</b>, <span class="s">&quot;+&quot;</span>);
        }
 
        <b>internal static object</b> <a id="ae44ef3328ef7138" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddEnumerable</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r500 rd" class="r500 r">context</span>, <span class="i">IEnumerator</span> <span id="r501 rd" class="r501 r">lhs</span>, <span class="i">IEnumerator</span> <span id="r502 rd" class="r502 r">rhs</span>)
        {
            <a href="#906468b10c209579" class="k">var</a> <span id="r503 rd" class="r503 r">fakeEnumerator</span> = <span class="r501 r">lhs</span> <b>as</b> <a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a>;
            <b>if</b> (<span class="r503 r">fakeEnumerator</span> != <b>null</b>)
            {
                <b>return</b> <span class="i">AddFakeEnumerable</span>(<span class="r503 r">fakeEnumerator</span>, <span class="r502 r">rhs</span>);
            }
 
            <b>var</b> <span id="r504 rd" class="r504 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
 
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r500 r">context</span>, <span class="r501 r">lhs</span>))
            {
                <span class="r504 r">result</span>.<span class="i">Add</span>(<a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r501 r">lhs</span>));
            }
 
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r500 r">context</span>, <span class="r502 r">rhs</span>))
            {
                <span class="r504 r">result</span>.<span class="i">Add</span>(<a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r502 r">rhs</span>));
            }
 
            <b>return</b> <span class="r504 r">result</span>.<span class="i">ToArray</span>();
        }
 
        <b>internal static object</b> <a id="dbd39991014fcbea" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddObject</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r505 rd" class="r505 r">context</span>, <span class="i">IEnumerator</span> <span id="r506 rd" class="r506 r">lhs</span>, <b>object</b> <span id="r507 rd" class="r507 r">rhs</span>)
        {
            <a href="#906468b10c209579" class="k">var</a> <span id="r508 rd" class="r508 r">fakeEnumerator</span> = <span class="r506 r">lhs</span> <b>as</b> <a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a>;
            <b>if</b> (<span class="r508 r">fakeEnumerator</span> != <b>null</b>)
            {
                <b>return</b> <a href="#33dae20d988310b5" class="i method">AddFakeEnumerable</a>(<span class="r508 r">fakeEnumerator</span>, <span class="r507 r">rhs</span>);
            }
 
            <b>var</b> <span id="r509 rd" class="r509 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
 
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r505 r">context</span>, <span class="r506 r">lhs</span>))
            {
                <span class="r509 r">result</span>.<span class="i">Add</span>(<a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r506 r">lhs</span>));
            }
 
            <span class="r509 r">result</span>.<span class="i">Add</span>(<span class="r507 r">rhs</span>);
 
            <b>return</b> <span class="r509 r">result</span>.<span class="i">ToArray</span>();
        }
 
        <b>internal static object</b> <a id="21c9050e2820583b" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Compare</a>(<span class="i">IEnumerator</span> <span id="r510 rd" class="r510 r">enumerator</span>, <b>object</b> <span id="r511 rd" class="r511 r">valueToCompareTo</span>, <span class="i">Func</span>&lt;<b>object</b>, <b>object</b>, <b>bool</b>&gt; <span id="r512 rd" class="r512 r">compareDelegate</span>)
        {
            <a href="#906468b10c209579" class="k">var</a> <span id="r513 rd" class="r513 r">fakeEnumerator</span> = <span class="r510 r">enumerator</span> <b>as</b> <a href="#906468b10c209579" class="t t">NonEnumerableObjectEnumerator</a>;
            <b>if</b> (<span class="r513 r">fakeEnumerator</span> != <b>null</b>)
            {
                <b>return</b> <span class="r512 r">compareDelegate</span>(<span class="r513 r">fakeEnumerator</span>.<a href="#95e4cda00e571988" class="i method">GetNonEnumerableObject</a>(), <span class="r511 r">valueToCompareTo</span>) ? <a href="NumericOps.cs.html#a75d534e5fa18108" class="t t">Boxed</a>.<a href="NumericOps.cs.html#1043b53b95ded9f8" class="i field">True</a> : <a href="NumericOps.cs.html#a75d534e5fa18108" class="t t">Boxed</a>.<a href="NumericOps.cs.html#36bb5cda34c8ae7d" class="i field">False</a>;
            }
 
            <b>var</b> <span id="r514 rd" class="r514 r">resultArray</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<b>null</b>, <span class="r510 r">enumerator</span>))
            {
                <b>object</b> <span id="r515 rd" class="r515 r">val</span> = <a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r510 r">enumerator</span>);
                <b>if</b> (<span class="r512 r">compareDelegate</span>(<span class="r515 r">val</span>, <span class="r511 r">valueToCompareTo</span>))
                {
                    <span class="r514 r">resultArray</span>.<span class="i">Add</span>(<span class="r515 r">val</span>);
                }
            }
 
            <b>return</b> <span class="r514 r">resultArray</span>.<span class="i">ToArray</span>();
        }
 
        <b>internal static void</b> <a id="8154494d4bccb800" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">WriteEnumerableToPipe</a>(<span class="i">IEnumerator</span> <span id="r516 rd" class="r516 r">enumerator</span>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r517 rd" class="r517 r">pipe</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r518 rd" class="r518 r">context</span>, <b>bool</b> <span id="r519 rd" class="r519 r">dispose</span>)
        {
            <b>try</b>
            {
                <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<span class="r518 r">context</span>, <span class="r516 r">enumerator</span>))
                {
                    <span class="r517 r">pipe</span>.<a href="../../Pipe.cs.html#f66ebe5942cdceab" class="i method">Add</a>(<a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r516 r">enumerator</span>));
                }
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r519 r">dispose</span>)
                {
                    <b>var</b> <span id="r520 rd" class="r520 r">disposable</span> = <span class="r516 r">enumerator</span> <b>as</b> <span class="i">IDisposable</span>;
                    <b>if</b> (<span class="r520 r">disposable</span> != <b>null</b>)
                    {
                        <span class="r520 r">disposable</span>.<span class="i">Dispose</span>();
                    }
                }
            }
        }
 
        <b>internal static object</b>[] <a id="2eecd39c2ee11435" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ToArray</a>(<span class="i">IEnumerator</span> <span id="r521 rd" class="r521 r">enumerator</span>)
        {
            <b>var</b> <span id="r522 rd" class="r522 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <b>while</b> (<a href="#6ced3521138ce182" class="i method">MoveNext</a>(<b>null</b>, <span class="r521 r">enumerator</span>))
            {
                <span class="r522 r">result</span>.<span class="i">Add</span>(<a href="#25e919160dd3b048" class="i method">Current</a>(<span class="r521 r">enumerator</span>));
            }
 
            <b>return</b> <span class="r522 r">result</span>.<span class="i">ToArray</span>();
        }
 
        <b>internal static object</b>[] <a id="44c6650ef7e8797a" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetSlice</a>(<span class="i">IList</span> <span id="r523 rd" class="r523 r">list</span>, <b>int</b> <span id="r524 rd" class="r524 r">startIndex</span>)
        {
            <b>int</b> <span id="r525 rd" class="r525 r">countElements</span> = <span class="r523 r">list</span>.<span class="i">Count</span> - <span class="r524 r">startIndex</span>;
            <b>object</b>[] <span id="r526 rd" class="r526 r">result</span> = <b>new</b> <b>object</b>[<span class="r525 r">countElements</span>];
 
            <b>int</b> <span id="r527 rd" class="r527 r">i</span> = <span class="r524 r">startIndex</span>;
            <b>int</b> <span id="r528 rd" class="r528 r">j</span> = 0;
            <b>while</b> (<span class="r528 r">j</span> &lt; <span class="r525 r">countElements</span>)
            {
                <span class="r526 r">result</span>[<span class="r528 r">j</span>++] = <span class="r523 r">list</span>[<span class="r527 r">i</span>++];
            }
 
            <b>return</b> <span class="r526 r">result</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
