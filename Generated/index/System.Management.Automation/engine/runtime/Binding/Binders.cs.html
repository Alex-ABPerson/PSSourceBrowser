<!DOCTYPE html>
<html><head><title>Binders.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(7755);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/runtime/Binding/Binders.cs" target="_top">engine\runtime\Binding\Binders.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Specialized</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Data</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Dynamic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>.<span class="i">Expressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>
{
    <span class="c">// Item1 - member name</span>
    <span class="c">// Item2 - class containing dynamic site (for protected/private member access)</span>
    <span class="c">// Item3 - static (true) or instance (false)</span>
    <span class="c">// Item4 - enumerating (true) or not (false)</span>
    <b>using</b> <span class="i">PSGetMemberBinderKeyType</span> = <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Type</span>, <b>bool</b>, <b>bool</b>&gt;;
 
    <span class="c">// Item1 - member name</span>
    <span class="c">// Item2 - class containing dynamic site (for protected/private member access)</span>
    <span class="c">// Item3 - enumerating (true) or not (false)</span>
    <b>using</b> <span class="i">PSSetMemberBinderKeyType</span> = <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">Type</span>, <b>bool</b>&gt;;
 
    <span class="c">// Item1 - member name</span>
    <span class="c">// Item2 - callinfo (# of args and (not used) named arguments)</span>
    <span class="c">// Item3 - property setter (true) or not (false)</span>
    <span class="c">// Item4 - enumerating (true) or not (false)</span>
    <span class="c">// Item5 - invocation constraints (casts used in the invocation expression used to guide overload resolution)</span>
    <span class="c">// Item6 - static (true) or instance (false)</span>
    <span class="c">// Item7 - class containing dynamic site (for protected/private member access)</span>
    <b>using</b> <span class="i">PSInvokeMemberBinderKeyType</span> = <span class="i">Tuple</span>&lt;<b>string</b>, <span class="i">CallInfo</span>, <b>bool</b>, <b>bool</b>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>, <span class="i">Type</span>&gt;;
 
    <span class="c">// Item1 - callinfo (# of args and (not used) named arguments)</span>
    <span class="c">// Item2 - invocation constraints (casts used in the invocation expression used to guide overload resolution)</span>
    <span class="c">// Item3 - property setter (true) or not (false)</span>
    <span class="c">// Item4 - static (true) or instance (false)</span>
    <span class="c">// Item5 - class containing dynamic site (for protected/private member access)</span>
    <b>using</b> <span class="i">PSInvokeDynamicMemberBinderKeyType</span> = <span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>, <b>bool</b>, <span class="i">Type</span>&gt;;
 
    <span class="c">// Item1 - class containing dynamic site (for protected/private member access)</span>
    <span class="c">// Item2 - static (true) or instance (false)</span>
    <b>using</b> <span class="i">PSGetOrSetDynamicMemberBinderKeyType</span> = <span class="i">Tuple</span>&lt;<span class="i">Type</span>, <b>bool</b>&gt;;
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Extension methods for DynamicMetaObject.  Some of these extensions help handle PSObject, both in terms of</span>
    <span class="c">///</span><span class="c"> getting the type or value from a DynamicMetaObject, but also help to generate binding restrictions that</span>
    <span class="c">///</span><span class="c"> account for values that are optionally wrapped in PSObject.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="7da4ecaf3f345047" href="../../../R/7da4ecaf3f345047.html" target="n" data-glyph="2,0" class="t t">DynamicMetaObjectExtensions</a>
    {
        <b>internal static readonly</b> <span class="i">DynamicMetaObject</span> <a id="7a820077c2cd72aa" href="../../../R/7a820077c2cd72aa.html" target="n" data-glyph="44,1" class="i field">FakeError</a>
            = <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>);
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="fd36b193199cb7da" href="../../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">WriteToDebugLog</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r0 rd" class="r0 r">obj</span>, <span class="i">DynamicMetaObjectBinder</span> <span id="r1 rd" class="r1 r">binder</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">ENABLE_BINDER_DEBUG_LOGGING</span>
<span class="e">            if (obj != FakeError)
            {
                System.Diagnostics.Debug.WriteLine(&quot;Binder: {0}\r\n    Restrictions: {2}\r\n    Target: {1}&quot;,
                                                   binder.ToString(),
                                                   obj.Expression.ToDebugString(),
                                                   obj.Restrictions.ToDebugString());
            }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>return</b> <span class="r0 r">obj</span>;
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="c9dfd3fc236ea8a5" href="../../../R/c9dfd3fc236ea8a5.html" target="n" data-glyph="221,1" class="i method">GetSimpleTypeRestriction</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r2 rd" class="r2 r">obj</span>)
        {
            <b>if</b> (<span class="r2 r">obj</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r2 r">obj</span>.<span class="i">Expression</span>, <span class="r2 r">obj</span>.<span class="i">Value</span>);
            }
 
            <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r2 r">obj</span>.<span class="i">Expression</span>, <span class="r2 r">obj</span>.<span class="i">Value</span>.<span class="i">GetType</span>());
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="2e73f4a608880676" href="../../../R/2e73f4a608880676.html" target="n" data-glyph="221,1" class="i method">PSGetMethodArgumentRestriction</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r3 rd" class="r3 r">obj</span>)
        {
            <b>var</b> <span id="r4 rd" class="r4 r">baseValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r3 r">obj</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r4 r">baseValue</span> != <b>null</b> &amp;&amp; <span class="r4 r">baseValue</span>.<span class="i">GetType</span>() == <b>typeof</b>(<b>object</b>[]))
            {
                <b>var</b> <span id="r5 rd" class="r5 r">effectiveArgType</span> = <a href="../../CoreAdapter.cs.html#88aa0312e9fc25c7" class="t t">Adapter</a>.<span class="i">EffectiveArgumentType</span>(<span class="r3 r">obj</span>.<span class="i">Value</span>);
                <b>var</b> <span id="r6 rd" class="r6 r">methodInfo</span> = <span class="r5 r">effectiveArgType</span> != <b>typeof</b>(<b>object</b>[])
                    ? <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#7a1f7f25ac7d66db" class="i field">PSInvokeMemberBinder_IsHomogenousArray</a>.<span class="i">MakeGenericMethod</span>(<span class="r5 r">effectiveArgType</span>.<span class="i">GetElementType</span>())
                    : <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#a521c5ae1d37f3a6" class="i field">PSInvokeMemberBinder_IsHeterogeneousArray</a>;
 
                <span class="i">BindingRestrictions</span> <span id="r7 rd" class="r7 r">restrictions</span>;
                <span class="i">Expression</span> <span id="r8 rd" class="r8 r">test</span>;
                <b>if</b> (<span class="r3 r">obj</span>.<span class="i">Value</span> != <span class="r4 r">baseValue</span>)
                {
                    <span class="c">// Need PSObject...</span>
                    <span class="r7 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r3 r">obj</span>.<span class="i">Expression</span>, <b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>));
 
                    <b>var</b> <span id="r9 rd" class="r9 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<b>object</b>[]));
                    <span class="r8 r">test</span> = <span class="i">Expression</span>.<span class="i">Block</span>(
                        <b>new</b>[] { <span class="r9 r">temp</span> },
                        <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r9 r">temp</span>, <span class="i">Expression</span>.<span class="i">TypeAs</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r3 r">obj</span>.<span class="i">Expression</span>), <b>typeof</b>(<b>object</b>[]))),
                        <span class="i">Expression</span>.<span class="i">AndAlso</span>(
                            <span class="i">Expression</span>.<span class="i">NotEqual</span>(<span class="r9 r">temp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#7f0ebe7c58832085" class="i field">NullObjectArray</a>),
                            <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r6 r">methodInfo</span>, <span class="r9 r">temp</span>)));
                }
                <b>else</b>
                {
                    <span class="r7 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r3 r">obj</span>.<span class="i">Expression</span>, <b>typeof</b>(<b>object</b>[]));
                    <b>var</b> <span id="r10 rd" class="r10 r">arrayExpr</span> = <span class="r3 r">obj</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>[]));
                    <span class="r8 r">test</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r6 r">methodInfo</span>, <span class="r10 r">arrayExpr</span>);
                }
 
                <b>return</b> <span class="r7 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="r8 r">test</span>));
            }
 
            <b>return</b> <span class="r3 r">obj</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="e54bf2b4c07733d1" href="../../../R/e54bf2b4c07733d1.html" target="n" data-glyph="221,1" class="i method">PSGetStaticMemberRestriction</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r11 rd" class="r11 r">obj</span>)
        {
            <b>if</b> (<span class="r11 r">obj</span>.<span class="i">Restrictions</span> != <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>)
            {
                <b>return</b> <span class="r11 r">obj</span>.<span class="i">Restrictions</span>;
            }
 
            <b>if</b> (<span class="r11 r">obj</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r11 r">obj</span>.<span class="i">Expression</span>, <span class="r11 r">obj</span>.<span class="i">Value</span>);
            }
 
            <b>var</b> <span id="r12 rd" class="r12 r">baseValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r11 r">obj</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r12 r">baseValue</span> == <b>null</b>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r11 r">obj</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <span class="s">&quot;PSObject.Base should only return null for AutomationNull.Value&quot;</span>);
                <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r11 r">obj</span>.<span class="i">Expression</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)));
            }
 
            <span class="i">BindingRestrictions</span> <span id="r13 rd" class="r13 r">restrictions</span>;
 
            <b>if</b> (<span class="r12 r">baseValue</span> <b>is</b> <span class="i">Type</span>)
            {
                <b>if</b> (<span class="r11 r">obj</span>.<span class="i">Value</span> == <span class="r12 r">baseValue</span>)
                {
                    <span class="c">//     newObj == oldObj  (if not wrapped in PSObject) or</span>
                    <span class="r13 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r11 r">obj</span>.<span class="i">Expression</span>, <span class="r11 r">obj</span>.<span class="i">Value</span>);
                }
                <b>else</b>
                {
                    <span class="c">//     newObj.GetType() == typeof(PSObject) &amp;&amp; PSObject.Base(newObj) == oldObj</span>
                    <span class="r13 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r11 r">obj</span>.<span class="i">Expression</span>, <span class="r11 r">obj</span>.<span class="i">LimitType</span>);
                    <span class="r13 r">restrictions</span> = <span class="r13 r">restrictions</span>.<span class="i">Merge</span>(
                        <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r11 r">obj</span>.<span class="i">Expression</span>),
                            <span class="r12 r">baseValue</span>));
                }
            }
            <b>else</b> <b>if</b> (<span class="r11 r">obj</span>.<span class="i">Value</span> != <span class="r12 r">baseValue</span>)
            {
                <span class="c">// Binding restriction will look like:</span>
                <span class="c">//     newObj.GetType() == typeof(PSObject) &amp;&amp; PSObject.Base(newObj).GetType() == typeof(oldType)</span>
 
                <span class="r13 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r11 r">obj</span>.<span class="i">Expression</span>),
                    <span class="r12 r">baseValue</span>.<span class="i">GetType</span>());
            }
            <b>else</b>
            {
                <span class="r13 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r11 r">obj</span>.<span class="i">Expression</span>, <span class="r11 r">obj</span>.<span class="i">LimitType</span>);
            }
 
            <b>return</b> <span class="r13 r">restrictions</span>;
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="328412aa1d4c0f48" href="../../../R/328412aa1d4c0f48.html" target="n" data-glyph="221,1" class="i method">PSGetTypeRestriction</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r14 rd" class="r14 r">obj</span>)
        {
            <b>if</b> (<span class="r14 r">obj</span>.<span class="i">Restrictions</span> != <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>)
            {
                <b>return</b> <span class="r14 r">obj</span>.<span class="i">Restrictions</span>;
            }
 
            <b>if</b> (<span class="r14 r">obj</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r14 r">obj</span>.<span class="i">Expression</span>, <span class="r14 r">obj</span>.<span class="i">Value</span>);
            }
 
            <b>var</b> <span id="r15 rd" class="r15 r">baseValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r14 r">obj</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r15 r">baseValue</span> == <b>null</b>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r14 r">obj</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>, <span class="s">&quot;PSObject.Base should only return null for AutomationNull.Value&quot;</span>);
                <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r14 r">obj</span>.<span class="i">Expression</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)));
            }
 
            <span class="c">// The default restriction is a simple type test.  We use this type test even if the object is a PSObject,</span>
            <span class="c">// this way we can avoid calling PSObject.Base in all restriction checks.</span>
            <b>var</b> <span id="r16 rd" class="r16 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r14 r">obj</span>.<span class="i">Expression</span>, <span class="r14 r">obj</span>.<span class="i">LimitType</span>);
 
            <b>if</b> (<span class="r14 r">obj</span>.<span class="i">Value</span> != <span class="r15 r">baseValue</span>)
            {
                <span class="c">// Binding restriction will look like:</span>
                <span class="c">//     newObj.GetType() == typeof(PSObject) &amp;&amp; PSObject.Base(newObj).GetType() == typeof(oldType)</span>
 
                <span class="r16 r">restrictions</span> = <span class="r16 r">restrictions</span>.<span class="i">Merge</span>(
                    <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r14 r">obj</span>.<span class="i">Expression</span>),
                                                           <span class="r15 r">baseValue</span>.<span class="i">GetType</span>()));
            }
            <b>else</b> <b>if</b> (<span class="r15 r">baseValue</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
            {
                <span class="c">// We have an empty custom object.  The restrictions must check this explicitly, otherwise we have</span>
                <span class="c">// a simple type test on PSObject, which obviously tests true for many objects.</span>
                <span class="c">// So we end up with:</span>
                <span class="c">//     newObj.GetType() == typeof(PSObject) &amp;&amp; PSObject.Base(newObj) == newObj</span>
 
                <span class="r16 r">restrictions</span> = <span class="r16 r">restrictions</span>.<span class="i">Merge</span>(
                    <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r14 r">obj</span>.<span class="i">Expression</span>), <span class="r14 r">obj</span>.<span class="i">Expression</span>)));
            }
 
            <b>return</b> <span class="r16 r">restrictions</span>;
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="e7284c368e570df6" href="../../../R/e7284c368e570df6.html" target="n" data-glyph="221,1" class="i method">CombineRestrictions</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r17 rd" class="r17 r">target</span>, <b>params</b> <span class="i">DynamicMetaObject</span>[] <span id="r18 rd" class="r18 r">args</span>)
        {
            <b>var</b> <span id="r19 rd" class="r19 r">restrictions</span> = <span class="r17 r">target</span>.<span class="i">Restrictions</span> == <span class="i">BindingRestrictions</span>.<span class="i">Empty</span> ? <span class="r17 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>() : <span class="r17 r">target</span>.<span class="i">Restrictions</span>;
 
            <b>for</b> (<b>int</b> <span id="r20 rd" class="r20 r">index</span> = 0; <span class="r20 r">index</span> &lt; <span class="r18 r">args</span>.<span class="i">Length</span>; <span class="r20 r">index</span>++)
            {
                <b>var</b> <span id="r21 rd" class="r21 r">r</span> = <span class="r18 r">args</span>[<span class="r20 r">index</span>];
                <span class="r19 r">restrictions</span> =
                    <span class="r19 r">restrictions</span>.<span class="i">Merge</span>(<span class="r21 r">r</span>.<span class="i">Restrictions</span> == <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>
                                           ? <span class="r21 r">r</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()
                                           : <span class="r21 r">r</span>.<span class="i">Restrictions</span>);
            }
 
            <b>return</b> <span class="r19 r">restrictions</span>;
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="232b966c9129c238" href="../../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">CastOrConvertMethodArgument</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r22 rd" class="r22 r">target</span>,
                                                               <span class="i">Type</span> <span id="r23 rd" class="r23 r">parameterType</span>,
                                                               <b>string</b> <span id="r24 rd" class="r24 r">parameterName</span>,
                                                               <b>string</b> <span id="r25 rd" class="r25 r">methodName</span>,
                                                               <b>bool</b> <span id="r26 rd" class="r26 r">allowCastingToByRefLikeType</span>,
                                                               <span class="i">List</span>&lt;<span class="i">ParameterExpression</span>&gt; <span id="r27 rd" class="r27 r">temps</span>,
                                                               <span class="i">List</span>&lt;<span class="i">Expression</span>&gt; <span id="r28 rd" class="r28 r">initTemps</span>)
        {
            <b>if</b> (<span class="r22 r">target</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>return</b> <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <span class="r23 r">parameterType</span>);
            }
 
            <b>var</b> <span id="r29 rd" class="r29 r">argType</span> = <span class="r22 r">target</span>.<span class="i">LimitType</span>;
            <b>if</b> (<span class="r23 r">parameterType</span> == <b>typeof</b>(<b>object</b>) &amp;&amp; <span class="r29 r">argType</span> == <b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>))
            {
                <b>return</b> <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r22 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)));
            }
 
            <span class="c">// If the conversion can&#39;t fail, skip wrapping the conversion in try/catch so we generate less code.</span>
            <b>if</b> (<span class="r23 r">parameterType</span>.<span class="i">IsAssignableFrom</span>(<span class="r29 r">argType</span>))
            {
                <b>return</b> <span class="r22 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r23 r">parameterType</span>);
            }
 
            <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>? <span id="r30 rd" class="r30 r">rank</span> = <b>null</b>;
            <b>if</b> (<span class="r23 r">parameterType</span>.<span class="i">IsByRefLike</span> &amp;&amp; <span class="r26 r">allowCastingToByRefLikeType</span>)
            {
                <b>var</b> <span id="r31 rd" class="r31 r">conversionResult</span> = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<a href="#8cc92418f1a853fa" class="i method">ConvertToByRefLikeTypeViaCasting</a>(<span class="r22 r">target</span>, <span class="r23 r">parameterType</span>);
                <b>if</b> (<span class="r31 r">conversionResult</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r31 r">conversionResult</span>;
                }
 
                <span class="r30 r">rank</span> = <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>;
            }
 
            <b>var</b> <span id="r32 rd" class="r32 r">exceptionParam</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<span class="i">Exception</span>));
            <b>var</b> <span id="r33 rd" class="r33 r">targetTemp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r22 r">target</span>.<span class="i">Expression</span>.<span class="i">Type</span>);
            <b>bool</b> <span id="r34 rd" class="r34 r">debase</span> = <b>false</b>;
 
            <span class="c">// ConstrainedLanguage note - calls to this conversion are covered by the method resolution algorithm</span>
            <span class="c">// (which ignores method arguments with disallowed types)</span>
            <b>var</b> <span id="r35 rd" class="r35 r">conversion</span> = <span class="r30 r">rank</span> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>
                ? <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#bef924d0a850a813" class="i field">NoConversion</a>
                : <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r22 r">target</span>.<span class="i">Value</span>, <span class="r23 r">parameterType</span>, <b>out</b> <span class="r34 r">debase</span>);
            <b>var</b> <span id="r36 rd" class="r36 r">invokeConverter</span> = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r35 r">conversion</span>, <span class="r33 r">targetTemp</span>, <span class="r23 r">parameterType</span>, <span class="r34 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
            <b>var</b> <span id="r37 rd" class="r37 r">expr</span> =
                <span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r33 r">targetTemp</span> },
                    <span class="i">Expression</span>.<span class="i">TryCatch</span>(
                        <span class="i">Expression</span>.<span class="i">Block</span>(
                            <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r33 r">targetTemp</span>, <span class="r22 r">target</span>.<span class="i">Expression</span>),
                            <span class="r36 r">invokeConverter</span>),
                        <span class="i">Expression</span>.<span class="i">Catch</span>(<span class="r32 r">exceptionParam</span>,
                            <span class="i">Expression</span>.<span class="i">Block</span>(
                                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#2b3fe2b6d05918e6" class="i field">ExceptionHandlingOps_ConvertToArgumentConversionException</a>,
                                                <span class="r32 r">exceptionParam</span>,
                                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r24 r">parameterName</span>),
                                                <span class="r33 r">targetTemp</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r25 r">methodName</span>),
                                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r23 r">parameterType</span>, <b>typeof</b>(<span class="i">Type</span>))),
                                <span class="i">Expression</span>.<span class="i">Default</span>(<span class="r36 r">invokeConverter</span>.<span class="i">Type</span>)))));
            <b>var</b> <span id="r38 rd" class="r38 r">tmp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r37 r">expr</span>.<span class="i">Type</span>);
            <span class="r27 r">temps</span>.<span class="i">Add</span>(<span class="r38 r">tmp</span>);
            <span class="r28 r">initTemps</span>.<span class="i">Add</span>(<span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r38 r">tmp</span>, <span class="r37 r">expr</span>));
            <b>return</b> <span class="r38 r">tmp</span>;
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="a45395fd79b0352d" href="../../../R/a45395fd79b0352d.html" target="n" data-glyph="221,1" class="i method">CastOrConvert</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r39 rd" class="r39 r">target</span>, <span class="i">Type</span> <span id="r40 rd" class="r40 r">type</span>)
        {
            <b>if</b> (<span class="r39 r">target</span>.<span class="i">LimitType</span> == <span class="r40 r">type</span>)
            {
                <b>return</b> <span class="r39 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r40 r">type</span>);
            }
 
            <b>bool</b> <span id="r41 rd" class="r41 r">debase</span>;
 
            <span class="c">// ConstrainedLanguage note - calls to this conversion are done by:</span>
            <span class="c">// Switch statements (always to Object), method invocation (protected by InvokeMember binder),</span>
            <span class="c">// and hard-coded casts to integral types.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r42 rd" class="r42 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r39 r">target</span>.<span class="i">Value</span>, <span class="r40 r">type</span>, <b>out</b> <span class="r41 r">debase</span>);
            <b>return</b> <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r42 r">conversion</span>, <span class="r39 r">target</span>.<span class="i">Expression</span>, <span class="r40 r">type</span>, <span class="r41 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="c202c01c5df7d5f0" href="../../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">ThrowRuntimeError</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r43 rd" class="r43 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r44 rd" class="r44 r">args</span>,
                                                            <span class="i">BindingRestrictions</span> <span id="r45 rd" class="r45 r">moreTests</span>, <b>string</b> <span id="r46 rd" class="r46 r">errorID</span>,
                                                            <b>string</b> <span id="r47 rd" class="r47 r">resourceString</span>, <b>params</b> <span class="i">Expression</span>[] <span id="r48 rd" class="r48 r">exceptionArgs</span>)
        {
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#d9379e1339fed7c3" class="i method">ThrowRuntimeError</a>(<span class="r46 r">errorID</span>, <span class="r47 r">resourceString</span>, <span class="r48 r">exceptionArgs</span>),
                                         <span class="r43 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r44 r">args</span>).<span class="i">Merge</span>(<span class="r45 r">moreTests</span>));
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="ddb445513b249f0c" href="../../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">ThrowRuntimeError</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r49 rd" class="r49 r">target</span>, <span class="i">BindingRestrictions</span> <span id="r50 rd" class="r50 r">bindingRestrictions</span>,
                                                            <b>string</b> <span id="r51 rd" class="r51 r">errorID</span>, <b>string</b> <span id="r52 rd" class="r52 r">resourceString</span>, <b>params</b> <span class="i">Expression</span>[] <span id="r53 rd" class="r53 r">exceptionArgs</span>)
        {
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#d9379e1339fed7c3" class="i method">ThrowRuntimeError</a>(<span class="r51 r">errorID</span>, <span class="r52 r">resourceString</span>, <span class="r53 r">exceptionArgs</span>),
                                         <span class="r50 r">bindingRestrictions</span>);
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">ENABLE_BINDER_DEBUG_LOGGING</span>
<span class="e">        internal static string ToDebugString(this BindingRestrictions restrictions)
        {
            return restrictions.ToExpression().ToDebugString();
        }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
    }
 
    <b>internal static class</b> <a id="8d3bcfd8e4450c30" href="../../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">DynamicMetaObjectBinderExtensions</a>
    {
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="f9e1d838173fcfc6" href="../../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">DeferForPSObject</a>(<b>this</b> <span class="i">DynamicMetaObjectBinder</span> <span id="r54 rd" class="r54 r">binder</span>, <span class="i">DynamicMetaObject</span> <span id="r55 rd" class="r55 r">target</span>, <b>bool</b> <span id="r56 rd" class="r56 r">targetIsComObject</span> = <b>false</b>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r55 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <span class="s">&quot;target must be a psobject&quot;</span>);
 
            <span class="i">BindingRestrictions</span> <span id="r57 rd" class="r57 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>;
            <span class="i">Expression</span> <span id="r58 rd" class="r58 r">expr</span> = <a href="#84396dd84d943cd1" class="i method">ProcessOnePSObject</a>(<span class="r55 r">target</span>, <b>ref</b> <span class="r57 r">restrictions</span>, <span class="r59 r">argIsComObject</span>: <span class="r56 r">targetIsComObject</span>);
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<span class="r54 r">binder</span>, <span class="r54 r">binder</span>.<span class="i">ReturnType</span>, <span class="r58 r">expr</span>), <span class="r57 r">restrictions</span>);
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="1607b50692487d68" href="../../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">DeferForPSObject</a>(<b>this</b> <span class="i">DynamicMetaObjectBinder</span> <span id="r60 rd" class="r60 r">binder</span>, <span class="i">DynamicMetaObject</span> <span id="r61 rd" class="r61 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r62 rd" class="r62 r">arg</span>, <b>bool</b> <span id="r63 rd" class="r63 r">targetIsComObject</span> = <b>false</b>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r61 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> || <span class="r62 r">arg</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <span class="s">&quot;At least one arg must be a psobject&quot;</span>);
 
            <span class="i">BindingRestrictions</span> <span id="r64 rd" class="r64 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>;
            <span class="i">Expression</span> <span id="r65 rd" class="r65 r">expr1</span> = <a href="#84396dd84d943cd1" class="i method">ProcessOnePSObject</a>(<span class="r61 r">target</span>, <b>ref</b> <span class="r64 r">restrictions</span>, <span class="r59 r">argIsComObject</span>: <span class="r63 r">targetIsComObject</span>);
            <span class="i">Expression</span> <span id="r66 rd" class="r66 r">expr2</span> = <a href="#84396dd84d943cd1" class="i method">ProcessOnePSObject</a>(<span class="r62 r">arg</span>, <b>ref</b> <span class="r64 r">restrictions</span>, <span class="r59 r">argIsComObject</span>: <b>false</b>);
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<span class="r60 r">binder</span>, <span class="r60 r">binder</span>.<span class="i">ReturnType</span>, <span class="r65 r">expr1</span>, <span class="r66 r">expr2</span>), <span class="r64 r">restrictions</span>);
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="c82a7afaa5836a76" href="../../../R/../../0000000000.html" target="n" data-glyph="221,1" class="i method">DeferForPSObject</a>(<b>this</b> <span class="i">DynamicMetaObjectBinder</span> <span id="r67 rd" class="r67 r">binder</span>, <span class="i">DynamicMetaObject</span>[] <span id="r68 rd" class="r68 r">args</span>, <b>bool</b> <span id="r69 rd" class="r69 r">targetIsComObject</span> = <b>false</b>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r68 r">args</span> != <b>null</b> &amp;&amp; <span class="r68 r">args</span>.<span class="i">Length</span> &gt; 0, <span class="s">&quot;args should not be null or empty&quot;</span>);
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r68 r">args</span>.<span class="i">Any</span>(<span id="r70 rd" class="r70 r">mo</span> =&gt; <span class="r70 r">mo</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>), <span class="s">&quot;At least one arg must be a psobject&quot;</span>);
 
            <span class="i">Expression</span>[] <span id="r71 rd" class="r71 r">exprs</span> = <b>new</b> <span class="i">Expression</span>[<span class="r68 r">args</span>.<span class="i">Length</span>];
            <span class="i">BindingRestrictions</span> <span id="r72 rd" class="r72 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>;
 
            <span class="c">// Target maps to arg[0] of the binder.</span>
            <span class="r71 r">exprs</span>[0] = <a href="#84396dd84d943cd1" class="i method">ProcessOnePSObject</a>(<span class="r68 r">args</span>[0], <b>ref</b> <span class="r72 r">restrictions</span>, <span class="r69 r">targetIsComObject</span>);
            <b>for</b> (<b>int</b> <span id="r73 rd" class="r73 r">i</span> = 1; <span class="r73 r">i</span> &lt; <span class="r68 r">args</span>.<span class="i">Length</span>; <span class="r73 r">i</span>++)
            {
                <span class="r71 r">exprs</span>[<span class="r73 r">i</span>] = <a href="#84396dd84d943cd1" class="i method">ProcessOnePSObject</a>(<span class="r68 r">args</span>[<span class="r73 r">i</span>], <b>ref</b> <span class="r72 r">restrictions</span>, <span class="r59 r">argIsComObject</span>: <b>false</b>);
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<span class="r67 r">binder</span>, <span class="r67 r">binder</span>.<span class="i">ReturnType</span>, <span class="r71 r">exprs</span>), <span class="r72 r">restrictions</span>);
        }
 
        <b>private static</b> <span class="i">Expression</span> <a id="84396dd84d943cd1" href="../../../R/84396dd84d943cd1.html" target="n" data-glyph="76,1" class="i method">ProcessOnePSObject</a>(<span class="i">DynamicMetaObject</span> <span id="r74 rd" class="r74 r">arg</span>, <b>ref</b> <span class="i">BindingRestrictions</span> <span id="r75 rd" class="r75 r">restrictions</span>, <b>bool</b> <span id="r59 rd" class="r59 r">argIsComObject</span> = <b>false</b>)
        {
            <span class="i">Expression</span> <span id="r76 rd" class="r76 r">expr</span> = <b>null</b>;
            <b>object</b> <span id="r77 rd" class="r77 r">baseValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r74 r">arg</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r77 r">baseValue</span> != <span class="r74 r">arg</span>.<span class="i">Value</span>)
            {
                <span class="r76 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r74 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
 
                <b>if</b> (<span class="r59 r">argIsComObject</span>)
                {
                    <span class="c">// The &#39;base&#39; is a COM object, so bake that in the rule.</span>
                    <span class="r75 r">restrictions</span> = <span class="r75 r">restrictions</span>
                        .<span class="i">Merge</span>(<span class="r74 r">arg</span>.<a href="#c9dfd3fc236ea8a5" class="i method">GetSimpleTypeRestriction</a>())
                        .<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#7b916c30b8c14002" class="i field">Utils_IsComObject</a>, <span class="r76 r">expr</span>)));
                }
                <b>else</b>
                {
                    <span class="c">// Use a more general condition for the rule: &#39;arg&#39; is a PSObject and &#39;base != arg&#39;.</span>
                    <span class="r75 r">restrictions</span> = <span class="r75 r">restrictions</span>
                        .<span class="i">Merge</span>(<span class="r74 r">arg</span>.<a href="#c9dfd3fc236ea8a5" class="i method">GetSimpleTypeRestriction</a>())
                        .<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="i">Expression</span>.<span class="i">NotEqual</span>(<span class="r76 r">expr</span>, <span class="r74 r">arg</span>.<span class="i">Expression</span>)));
                }
            }
            <b>else</b>
            {
                <span class="r76 r">expr</span> = <span class="r74 r">arg</span>.<span class="i">Expression</span>;
                <span class="r75 r">restrictions</span> = <span class="r75 r">restrictions</span>.<span class="i">Merge</span>(<span class="r74 r">arg</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <b>return</b> <span class="r76 r">expr</span>;
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="ceefb8376e63f929" href="../../../R/ceefb8376e63f929.html" target="n" data-glyph="221,1" class="i method">UpdateComRestrictionsForPsObject</a>(<b>this</b> <span class="i">DynamicMetaObject</span> <span id="r78 rd" class="r78 r">binder</span>, <span class="i">DynamicMetaObject</span>[] <span id="r79 rd" class="r79 r">args</span>)
        {
            <span class="c">// Add a restriction that prevents PSObject arguments (so that they get based)</span>
            <span class="i">BindingRestrictions</span> <span id="r80 rd" class="r80 r">newRestrictions</span> = <span class="r78 r">binder</span>.<span class="i">Restrictions</span>;
            <span class="r80 r">newRestrictions</span> = <span class="r79 r">args</span>.<span class="i">Aggregate</span>(<span class="r80 r">newRestrictions</span>, (<span id="r81 rd" class="r81 r">current</span>, <span id="r82 rd" class="r82 r">arg</span>) =&gt;
            {
                <b>if</b> (<span class="r82 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsValueType</span>)
                {
                    <b>return</b> <span class="r81 r">current</span>.<span class="i">Merge</span>(<span class="r82 r">arg</span>.<span class="i">GetSimpleTypeRestriction</span>());
                }
                <b>else</b>
                {
                    <b>return</b> <span class="r81 r">current</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">Equal</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r82 r">arg</span>.<span class="i">Expression</span>),
                            <span class="r82 r">arg</span>.<span class="i">Expression</span>)));
                }
            });
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r78 r">binder</span>.<span class="i">Expression</span>, <span class="r80 r">newRestrictions</span>);
        }
    }
 
    <b>internal static class</b> <a id="2cec5a1dbfc5222e" href="../../../R/2cec5a1dbfc5222e.html" target="n" data-glyph="2,0" class="t t">BinderUtils</a>
    {
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="7a7dcbf5c13292cb" href="../../../R/7a7dcbf5c13292cb.html" target="n" data-glyph="74,1" class="i method">GetVersionCheck</a>(<span class="i">DynamicMetaObjectBinder</span> <span id="r83 rd" class="r83 r">binder</span>, <b>int</b> <span id="r84 rd" class="r84 r">expectedVersionNumber</span>)
        {
            <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="i">Expression</span>.<span class="i">Field</span>(<span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r83 r">binder</span>), <span class="s">&quot;_version&quot;</span>),
                                 <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(<span class="r84 r">expectedVersionNumber</span>)));
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="6a24b97403a40c85" href="../../../R/6a24b97403a40c85.html" target="n" data-glyph="74,1" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>()
        {
            <span class="c">// Also add a language mode check to detect toggling between language modes</span>
            <b>if</b> (<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#f3a9373a4fcbee98" class="i property">HasEverUsedConstrainedLanguage</a>)
            {
                <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r85 rd" class="r85 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
 
                <b>var</b> <span id="r86 rd" class="r86 r">tmp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>));
                <b>var</b> <span id="r87 rd" class="r87 r">langModeFromContext</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r86 r">tmp</span>, <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#de071e360a3c75b6" class="i field">ExecutionContext_LanguageMode</a>);
                <b>var</b> <span id="r88 rd" class="r88 r">constrainedLanguageMode</span> = <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>);
 
                <span class="c">// Execution context might be null if we&#39;re called from a thread with no runspace (e.g. a PSObject</span>
                <span class="c">// is used in some C# w/ dynamic). This is sometimes fine, we don&#39;t always need a runspace to access</span>
                <span class="c">// properties.</span>
                <span class="i">Expression</span> <span id="r89 rd" class="r89 r">test</span> = <span class="r85 r">context</span>?.<a href="../../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>
                    ? <span class="i">Expression</span>.<span class="i">AndAlso</span>(
                          <span class="i">Expression</span>.<span class="i">NotEqual</span>(<span class="r86 r">tmp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#7b63a499a59a20bd" class="i field">NullExecutionContext</a>),
                          <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r87 r">langModeFromContext</span>, <span class="r88 r">constrainedLanguageMode</span>))
                    : <span class="i">Expression</span>.<span class="i">OrElse</span>(
                          <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r86 r">tmp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#7b63a499a59a20bd" class="i field">NullExecutionContext</a>),
                          <span class="i">Expression</span>.<span class="i">NotEqual</span>(<span class="r87 r">langModeFromContext</span>, <span class="r88 r">constrainedLanguageMode</span>));
 
                <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                    <span class="i">Expression</span>.<span class="i">Block</span>(
                        <b>new</b>[] { <span class="r86 r">tmp</span> },
                        <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r86 r">tmp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>),
                        <span class="r89 r">test</span>));
            }
 
            <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>;
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="b9c4efdf58739e7f" href="../../../R/b9c4efdf58739e7f.html" target="n" data-glyph="74,1" class="i method">GetOptionalVersionAndLanguageCheckForType</a>(<span class="i">DynamicMetaObjectBinder</span> <span id="r90 rd" class="r90 r">binder</span>, <span class="i">Type</span> <span id="r91 rd" class="r91 r">targetType</span>, <b>int</b> <span id="r92 rd" class="r92 r">expectedVersionNumber</span>)
        {
            <span class="i">BindingRestrictions</span> <span id="r93 rd" class="r93 r">additionalBindingRestrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>;
 
            <span class="c">// If this uses a potentially unsafe type, we also need a version check</span>
            <b>if</b> (!<a href="../../parser/TypeResolver.cs.html#5741cea1a14d9f96" class="t t">CoreTypes</a>.<a href="../../parser/TypeResolver.cs.html#d10504c799ad8de9" class="i method">Contains</a>(<span class="r91 r">targetType</span>))
            {
                <b>if</b> (<span class="r92 r">expectedVersionNumber</span> != -1)
                {
                    <span class="r93 r">additionalBindingRestrictions</span> = <span class="r93 r">additionalBindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#7a7dcbf5c13292cb" class="i method">GetVersionCheck</a>(<span class="r90 r">binder</span>, <span class="r92 r">expectedVersionNumber</span>));
                }
 
                <span class="r93 r">additionalBindingRestrictions</span> = <span class="r93 r">additionalBindingRestrictions</span>.<span class="i">Merge</span>(<a href="#6a24b97403a40c85" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>());
            }
 
            <b>return</b> <span class="r93 r">additionalBindingRestrictions</span>;
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> PowerShell non-standard language binders
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Some classes that implement IEnumerable are not considered as enumerable from the perspective of pipelines,</span>
    <span class="c">///</span><span class="c"> this binder implements those semantics.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> The standard interop ConvertBinder is used to allow third party dynamic objects to get the first chance</span>
    <span class="c">///</span><span class="c"> at the conversion in case they do support enumeration, but do not implement IEnumerable directly.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="e3fd1907f899e2b7" href="../../../R/e3fd1907f899e2b7.html" target="n" data-glyph="2,0" class="t t">PSEnumerableBinder</a> : <span class="i">ConvertBinder</span>
    {
        <b>private static readonly</b> <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a> <a id="1d6837fb0fe1c3b5" href="../../../R/1d6837fb0fe1c3b5.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#fc046fb956c058f7" class="t constructor">PSEnumerableBinder</a>();
 
        <b>internal static</b> <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a> <a id="5b720d77314adf15" href="../../../R/5b720d77314adf15.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#1d6837fb0fe1c3b5" class="i field">s_binder</a>;
        }
 
        <b>private</b> <a id="fc046fb956c058f7" href="../../../R/fc046fb956c058f7.html" target="n" data-glyph="76,1" class="t constructor">PSEnumerableBinder</a>()
            : <b>base</b>(<b>typeof</b>(<span class="i">IEnumerator</span>), <b>false</b>)
        {
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;)(<span class="i">PSObjectStringRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;)(<span class="i">ArrayRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;)(<span class="i">StringRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;)(<span class="i">NotEnumerableRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;)(<span class="i">PSObjectNotEnumerableRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;)(<span class="i">AutomationNullRule</span>));
        }
 
        <b>public override string</b> <a id="7383c76d298e8c81" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <span class="s">&quot;ToEnumerable&quot;</span>;
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="a6785ffab09ceb8b" href="../../../R/a6785ffab09ceb8b.html" target="n" data-glyph="74,1" class="i method">GetRestrictions</a>(<span class="i">DynamicMetaObject</span> <span id="r94 rd" class="r94 r">target</span>)
        {
            <b>return</b> (<span class="r94 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
                ? <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r94 r">target</span>.<span class="i">Expression</span>, <span class="r94 r">target</span>.<span class="i">Value</span>.<span class="i">GetType</span>())
                : <span class="r94 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="e3fee01c5f73cb78" href="../../../R/e3fee01c5f73cb78.html" target="n" data-glyph="76,1" class="i method">NullResult</a>(<span class="i">DynamicMetaObject</span> <span id="r95 rd" class="r95 r">target</span>)
        {
            <span class="c">// The object is not enumerable from PowerShell&#39;s perspective.  Rather than raise an exception, we let the</span>
            <span class="c">// caller check for null and take the appropriate action.</span>
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">MaybeDebase</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>, <b>static</b> <span id="r96 rd" class="r96 r">e</span> =&gt; <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#7a1bf8e3ab612a78" class="i field">NullEnumerator</a>, <span class="r95 r">target</span>),
                <a href="#a6785ffab09ceb8b" class="i method">GetRestrictions</a>(<span class="r95 r">target</span>));
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="f22d53d46a5db0c0" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">MaybeDebase</a>(<span class="i">DynamicMetaObjectBinder</span> <span id="r97 rd" class="r97 r">binder</span>, <span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>&gt; <span id="r98 rd" class="r98 r">generator</span>, <span class="i">DynamicMetaObject</span> <span id="r99 rd" class="r99 r">target</span>)
        {
            <b>if</b> (<span class="r99 r">target</span>.<span class="i">Value</span> <b>is not</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
            {
                <b>return</b> <span class="r98 r">generator</span>(<span class="r99 r">target</span>.<span class="i">Expression</span>);
            }
 
            <b>object</b> <span id="r100 rd" class="r100 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r99 r">target</span>.<span class="i">Value</span>);
 
            <b>var</b> <span id="r101 rd" class="r101 r">tmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>object</b>), <span class="s">&quot;value&quot;</span>);
            <b>return</b> <span class="i">Expression</span>.<span class="i">Block</span>(
                <b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r101 r">tmp</span> },
                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r101 r">tmp</span>, <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r99 r">target</span>.<span class="i">Expression</span>)),
                <span class="i">Expression</span>.<span class="i">Condition</span>(
                    <span class="r100 r">targetValue</span> == <b>null</b> ?
                        (<span class="i">Expression</span>)<span class="i">Expression</span>.<span class="i">AndAlso</span>(<span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r101 r">tmp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>),
                                                       <span class="i">Expression</span>.<span class="i">Not</span>(<span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r99 r">target</span>.<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#84591f5e881dc39e" class="i field">AutomationNullConstant</a>)))
                        : <span class="i">Expression</span>.<span class="i">TypeEqual</span>(<span class="r101 r">tmp</span>, <span class="r100 r">targetValue</span>.<span class="i">GetType</span>()),
                    <span class="r98 r">generator</span>(<span class="r101 r">tmp</span>), <span class="r97 r">binder</span>.<span class="i">GetUpdateExpression</span>(<span class="r97 r">binder</span>.<span class="i">ReturnType</span>)));
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="6c5df6a9fac1a7df" href="../../../R/6c5df6a9fac1a7df.html" target="n" data-glyph="72,1" class="i method">FallbackConvert</a>(<span class="i">DynamicMetaObject</span> <span id="r102 rd" class="r102 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r103 rd" class="r103 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r102 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r102 r">target</span>).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r102 r">target</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;()), <b>typeof</b>(<span class="i">Array</span>).<span class="i">GetMethod</span>(<span class="s">&quot;GetEnumerator&quot;</span>)),
                    <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r102 r">target</span>.<span class="i">Expression</span>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>var</b> <span id="r104 rd" class="r104 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r102 r">target</span>.<span class="i">Value</span>);
 
            <b>if</b> (<span class="r104 r">targetValue</span> == <b>null</b> || <span class="r104 r">targetValue</span> <b>is string</b> || <span class="r104 r">targetValue</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
            {
                <b>return</b> (<span class="r103 r">errorSuggestion</span> ?? <a href="#e3fee01c5f73cb78" class="i method">NullResult</a>(<span class="r102 r">target</span>)).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r104 r">targetValue</span>.<span class="i">GetType</span>().<span class="i">IsArray</span>)
            {
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">MaybeDebase</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>, <b>static</b> <span id="r105 rd" class="r105 r">e</span> =&gt; <span class="i">Expression</span>.<span class="i">Call</span>(<span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r105 r">e</span>, <b>typeof</b>(<span class="i">Array</span>)), <b>typeof</b>(<span class="i">Array</span>).<span class="i">GetMethod</span>(<span class="s">&quot;GetEnumerator&quot;</span>)),
                        <span class="r102 r">target</span>),
                    <a href="#a6785ffab09ceb8b" class="i method">GetRestrictions</a>(<span class="r102 r">target</span>))).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r104 r">targetValue</span> <b>is</b> <span class="i">IDictionary</span> || <span class="r104 r">targetValue</span> <b>is</b> <span class="i">XmlNode</span>)
            {
                <b>return</b> (<span class="r103 r">errorSuggestion</span> ?? <a href="#e3fee01c5f73cb78" class="i method">NullResult</a>(<span class="r102 r">target</span>)).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r104 r">targetValue</span> <b>is</b> <span class="i">DataTable</span>)
            {
                <span class="c">// Generate:</span>
                <span class="c">//</span>
                <span class="c">//  DataRowCollection rows;</span>
                <span class="c">//  DataTable table = (DataTable)obj;</span>
                <span class="c">//  if ((rows = table.Rows) != null)</span>
                <span class="c">//      return rows.GetEnumerator();</span>
                <span class="c">//  else</span>
                <span class="c">//      return null;</span>
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">MaybeDebase</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>, <span id="r106 rd" class="r106 r">e</span> =&gt;
                        {
                            <b>var</b> <span id="r107 rd" class="r107 r">table</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<span class="i">DataTable</span>), <span class="s">&quot;table&quot;</span>);
                            <b>var</b> <span id="r108 rd" class="r108 r">rows</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<span class="i">DataRowCollection</span>), <span class="s">&quot;rows&quot;</span>);
                            <b>return</b> <span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r107 r">table</span>, <span class="r108 r">rows</span> },
                                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r107 r">table</span>, <span class="r106 r">e</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">DataTable</span>))),
                                <span class="i">Expression</span>.<span class="i">Condition</span>(
                                    <span class="i">Expression</span>.<span class="i">NotEqual</span>(<span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r108 r">rows</span>, <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r107 r">table</span>, <span class="s">&quot;Rows&quot;</span>)), <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>),
                                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r108 r">rows</span>, <b>typeof</b>(<span class="i">DataRowCollection</span>).<span class="i">GetMethod</span>(<span class="s">&quot;GetEnumerator&quot;</span>)),
                                    <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#7a1bf8e3ab612a78" class="i field">NullEnumerator</a>));
                        },
                        <span class="r102 r">target</span>),
                    <a href="#a6785ffab09ceb8b" class="i method">GetRestrictions</a>(<span class="r102 r">target</span>))).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>if</b> (<span class="i">Marshal</span>.<span class="i">IsComObject</span>(<span class="r104 r">targetValue</span>))
            {
                <span class="c">// Pretend that all com objects are enumerable, even if they aren&#39;t.  We do this because it&#39;s technically impossible</span>
                <span class="c">// to know if a com object is enumerable without just trying to cast it to IEnumerable.  We could generate a rule like:</span>
                <span class="c">//</span>
                <span class="c">//     if (IsComObject(obj)) { return obj as IEnumerable; } else { UpdateSite; }</span>
                <span class="c">//</span>
                <span class="c">// But code that calls PSEnumerableBinder.IsEnumerable and generate code based on the true/false result of that</span>
                <span class="c">// function wouldn&#39;t work properly.  Instead, we&#39;ll fix things up after the binding decisions are made, see</span>
                <span class="c">// EnumerableOps.NonEnumerableObjectEnumerator for more comments on how this works.</span>
 
                <b>var</b> <span id="r109 rd" class="r109 r">bindingRestrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#7b916c30b8c14002" class="i field">Utils_IsComObject</a>,
                                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r102 r">target</span>.<span class="i">Expression</span>)));
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#e35b74ca507b94da" class="i field">EnumerableOps_GetCOMEnumerator</a>, <span class="r102 r">target</span>.<span class="i">Expression</span>), <span class="r109 r">bindingRestrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>var</b> <span id="r110 rd" class="r110 r">enumerable</span> = <span class="r104 r">targetValue</span> <b>as</b> <span class="i">IEnumerable</span>;
            <b>if</b> (<span class="r110 r">enumerable</span> != <b>null</b>)
            {
                <span class="c">// Normally it&#39;s safe to just call IEnumerable.GetEnumerator, but in some rare cases, the</span>
                <span class="c">// non-generic implementation throws or returns null, so we&#39;ll just avoid that problem and</span>
                <span class="c">// call the generic version if it exists.</span>
 
                <b>foreach</b> (<b>var</b> <span id="r111 rd" class="r111 r">i</span> <b>in</b> <span class="r104 r">targetValue</span>.<span class="i">GetType</span>().<span class="i">GetInterfaces</span>())
                {
                    <b>if</b> (<span class="r111 r">i</span>.<span class="i">IsGenericType</span> &amp;&amp; <span class="r111 r">i</span>.<span class="i">GetGenericTypeDefinition</span>() == <b>typeof</b>(<span class="i">IEnumerable</span>&lt;&gt;))
                    {
                        <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="i">MaybeDebase</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>, <span id="r112 rd" class="r112 r">e</span> =&gt; <span class="i">Expression</span>.<span class="i">Call</span>(
                                <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#390cb5dc6abf2ac0" class="i field">EnumerableOps_GetGenericEnumerator</a>.<span class="i">MakeGenericMethod</span>(<span class="r111 r">i</span>.<span class="i">GetGenericArguments</span>()[0]), <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r112 r">e</span>, <span class="r111 r">i</span>)),
                                <span class="r102 r">target</span>),
                            <a href="#a6785ffab09ceb8b" class="i method">GetRestrictions</a>(<span class="r102 r">target</span>))).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
                    }
                }
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">MaybeDebase</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>, <b>static</b> <span id="r113 rd" class="r113 r">e</span> =&gt; <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4c2cd8582367a5c3" class="i field">EnumerableOps_GetEnumerator</a>, <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r113 r">e</span>, <b>typeof</b>(<span class="i">IEnumerable</span>))),
                        <span class="r102 r">target</span>),
                    <a href="#a6785ffab09ceb8b" class="i method">GetRestrictions</a>(<span class="r102 r">target</span>))).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>var</b> <span id="r114 rd" class="r114 r">enumerator</span> = <span class="r104 r">targetValue</span> <b>as</b> <span class="i">IEnumerator</span>;
            <b>if</b> (<span class="r114 r">enumerator</span> != <b>null</b>)
            {
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">MaybeDebase</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>, <b>static</b> <span id="r115 rd" class="r115 r">e</span> =&gt; <span class="r115 r">e</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IEnumerator</span>)), <span class="r102 r">target</span>),
                    <a href="#a6785ffab09ceb8b" class="i method">GetRestrictions</a>(<span class="r102 r">target</span>))).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
            }
 
            <b>return</b> (<span class="r103 r">errorSuggestion</span> ?? <a href="#e3fee01c5f73cb78" class="i method">NullResult</a>(<span class="r102 r">target</span>)).<span class="i">WriteToDebugLog</span>(<a href="#e3fd1907f899e2b7" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the statically known type is potentially enumerable.  We can avoid some dynamic sites if we know the</span>
        <span class="c">///</span><span class="c"> type is never enumerable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="26849e156e4460e7" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsStaticTypePossiblyEnumerable</a>(<span class="i">Type</span> <span id="r116 rd" class="r116 r">type</span>)
        {
            <b>if</b> (<span class="r116 r">type</span> == <b>typeof</b>(<b>object</b>) || <span class="r116 r">type</span> == <b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>) || <span class="r116 r">type</span>.<span class="i">IsArray</span>)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<span class="r116 r">type</span> == <b>typeof</b>(<b>string</b>) || <b>typeof</b>(<span class="i">IDictionary</span>).<span class="i">IsAssignableFrom</span>(<span class="r116 r">type</span>) || <b>typeof</b>(<span class="i">XmlNode</span>).<span class="i">IsAssignableFrom</span>(<span class="r116 r">type</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<span class="r116 r">type</span>.<span class="i">IsSealed</span> &amp;&amp; !<b>typeof</b>(<span class="i">IEnumerable</span>).<span class="i">IsAssignableFrom</span>(<span class="r116 r">type</span>) &amp;&amp; !<b>typeof</b>(<span class="i">IEnumerator</span>).<span class="i">IsAssignableFrom</span>(<span class="r116 r">type</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">// Binders normally cannot return null, but we want a way to detect if something is enumerable,</span>
        <span class="c">// so we return null if the target is not enumerable.</span>
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="cb5551ef9f16ca1f" href="../../../R/cb5551ef9f16ca1f.html" target="n" data-glyph="74,1" class="i method">IsEnumerable</a>(<span class="i">DynamicMetaObject</span> <span id="r117 rd" class="r117 r">target</span>)
        {
            <a href="#e3fd1907f899e2b7" class="k">var</a> <span id="r118 rd" class="r118 r">binder</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#5b720d77314adf15" class="i method">Get</a>();
            <b>var</b> <span id="r119 rd" class="r119 r">result</span> = <span class="r118 r">binder</span>.<a href="#6c5df6a9fac1a7df" class="i method">FallbackConvert</a>(<span class="r117 r">target</span>, <a href="#7da4ecaf3f345047" class="t t">DynamicMetaObjectExtensions</a>.<a href="#7a820077c2cd72aa" class="i field">FakeError</a>);
            <b>return</b> (<span class="r119 r">result</span> == <a href="#7da4ecaf3f345047" class="t t">DynamicMetaObjectExtensions</a>.<a href="#7a820077c2cd72aa" class="i field">FakeError</a>) ? <b>null</b> : <span class="r119 r">result</span>;
        }
 
        <b>private static</b> <span class="i">IEnumerator</span> <a id="27e9783fbd10c377" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AutomationNullRule</a>(<span class="i">CallSite</span> <span id="r120 rd" class="r120 r">site</span>, <b>object</b> <span id="r121 rd" class="r121 r">obj</span>)
        {
            <b>return</b> <span class="r121 r">obj</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>
                ? <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;().<span class="i">GetEnumerator</span>()
                : ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;&gt;)<span class="r120 r">site</span>).<span class="i">Update</span>(<span class="r120 r">site</span>, <span class="r121 r">obj</span>);
        }
 
        <b>private static</b> <span class="i">IEnumerator</span> <a id="9193c9c3dadaf5ee" href="../../../R/9193c9c3dadaf5ee.html" target="n" data-glyph="76,1" class="i method">NotEnumerableRule</a>(<span class="i">CallSite</span> <span id="r122 rd" class="r122 r">site</span>, <b>object</b> <span id="r123 rd" class="r123 r">obj</span>)
        {
            <b>if</b> (<span class="r123 r">obj</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (<span class="r123 r">obj</span> <b>is not</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>
                &amp;&amp; <span class="r123 r">obj</span> <b>is not</b> <span class="i">IEnumerable</span>
                &amp;&amp; <span class="r123 r">obj</span> <b>is not</b> <span class="i">IEnumerator</span>
                &amp;&amp; <span class="r123 r">obj</span> <b>is not</b> <span class="i">DataTable</span>
                &amp;&amp; !<span class="i">Marshal</span>.<span class="i">IsComObject</span>(<span class="r123 r">obj</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;&gt;)<span class="r122 r">site</span>).<span class="i">Update</span>(<span class="r122 r">site</span>, <span class="r123 r">obj</span>);
        }
 
        <b>private static</b> <span class="i">IEnumerator</span> <a id="82f482fd421d46d2" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">PSObjectNotEnumerableRule</a>(<span class="i">CallSite</span> <span id="r124 rd" class="r124 r">site</span>, <b>object</b> <span id="r125 rd" class="r125 r">obj</span>)
        {
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r126 rd" class="r126 r">psobj</span> = <span class="r125 r">obj</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>return</b> <span class="r126 r">psobj</span> != <b>null</b> &amp;&amp; <span class="r125 r">obj</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>
                ? <a href="#9193c9c3dadaf5ee" class="i method">NotEnumerableRule</a>(<span class="r124 r">site</span>, <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r125 r">obj</span>))
                : ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;&gt;)<span class="r124 r">site</span>).<span class="i">Update</span>(<span class="r124 r">site</span>, <span class="r125 r">obj</span>);
        }
 
        <b>private static</b> <span class="i">IEnumerator</span> <a id="cc0c766c09ec1deb" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ArrayRule</a>(<span class="i">CallSite</span> <span id="r127 rd" class="r127 r">site</span>, <b>object</b> <span id="r128 rd" class="r128 r">obj</span>)
        {
            <b>var</b> <span id="r129 rd" class="r129 r">array</span> = <span class="r128 r">obj</span> <b>as</b> <span class="i">Array</span>;
            <b>if</b> (<span class="r129 r">array</span> != <b>null</b>) <b>return</b> <span class="r129 r">array</span>.<span class="i">GetEnumerator</span>();
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;&gt;)<span class="r127 r">site</span>).<span class="i">Update</span>(<span class="r127 r">site</span>, <span class="r128 r">obj</span>);
        }
 
        <b>private static</b> <span class="i">IEnumerator</span> <a id="567f663d2768e2a6" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StringRule</a>(<span class="i">CallSite</span> <span id="r130 rd" class="r130 r">site</span>, <b>object</b> <span id="r131 rd" class="r131 r">obj</span>)
        {
            <b>return</b> <span class="r131 r">obj</span> <b>is string</b> ? <b>null</b> : ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;&gt;)<span class="r130 r">site</span>).<span class="i">Update</span>(<span class="r130 r">site</span>, <span class="r131 r">obj</span>);
        }
 
        <b>private static</b> <span class="i">IEnumerator</span> <a id="2326548d6f480708" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">PSObjectStringRule</a>(<span class="i">CallSite</span> <span id="r132 rd" class="r132 r">site</span>, <b>object</b> <span id="r133 rd" class="r133 r">obj</span>)
        {
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r134 rd" class="r134 r">psobj</span> = <span class="r133 r">obj</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r134 r">psobj</span> != <b>null</b> &amp;&amp; <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r134 r">psobj</span>) <b>is string</b>) <b>return</b> <b>null</b>;
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <span class="i">IEnumerator</span>&gt;&gt;)<span class="r132 r">site</span>).<span class="i">Update</span>(<span class="r132 r">site</span>, <span class="r133 r">obj</span>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This binder is used for the @() operator.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="6451a9aa35b72f04" href="../../../R/6451a9aa35b72f04.html" target="n" data-glyph="2,0" class="t t">PSToObjectArrayBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <a href="#6451a9aa35b72f04" class="t t">PSToObjectArrayBinder</a> <a id="00737aea760cfb00" href="../../../R/00737aea760cfb00.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#96983c3eec16072c" class="t constructor">PSToObjectArrayBinder</a>();
 
        <b>internal static</b> <a href="#6451a9aa35b72f04" class="t t">PSToObjectArrayBinder</a> <a id="099ce4d32e868b7c" href="../../../R/099ce4d32e868b7c.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#00737aea760cfb00" class="i field">s_binder</a>;
        }
 
        <b>private</b> <a id="96983c3eec16072c" href="../../../R/96983c3eec16072c.html" target="n" data-glyph="76,1" class="t constructor">PSToObjectArrayBinder</a>()
        {
        }
 
        <b>public override string</b> <a id="3975831e2411c66f" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <span class="s">&quot;ToObjectArray&quot;</span>;
        }
 
        <b>public override</b> <span class="i">Type</span> <a id="d91ea4de36afe129" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">ReturnType</a> { <b>get</b> { <b>return</b> <b>typeof</b>(<b>object</b>[]); } }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="55ec08ee595b8040" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r135 rd" class="r135 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r136 rd" class="r136 r">args</span>)
        {
            <b>if</b> (!<span class="r135 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r135 r">target</span>, <span class="r136 r">args</span>);
            }
 
            <b>if</b> (<span class="r135 r">target</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;()),
                    <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r135 r">target</span>.<span class="i">Expression</span>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)).<span class="i">WriteToDebugLog</span>(<a href="#6451a9aa35b72f04" class="k">this</a>);
            }
 
            <b>var</b> <span id="r137 rd" class="r137 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r135 r">target</span>);
            <b>if</b> (<span class="r137 r">enumerable</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="r135 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    <span class="r135 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()).<span class="i">WriteToDebugLog</span>(<a href="#6451a9aa35b72f04" class="k">this</a>);
            }
 
            <b>var</b> <span id="r138 rd" class="r138 r">value</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r135 r">target</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r138 r">value</span> <b>is</b> <span class="i">List</span>&lt;<b>object</b>&gt;)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<span class="i">MaybeDebase</span>(<a href="#6451a9aa35b72f04" class="k">this</a>, <b>static</b> <span id="r139 rd" class="r139 r">e</span> =&gt; <span class="r139 r">e</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">List</span>&lt;<b>object</b>&gt;)), <span class="r135 r">target</span>), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#a3abf685331a16bb" class="i field">ObjectList_ToArray</a>),
                    <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#a6785ffab09ceb8b" class="i method">GetRestrictions</a>(<span class="r135 r">target</span>)).<span class="i">WriteToDebugLog</span>(<a href="#6451a9aa35b72f04" class="k">this</a>);
            }
 
            <span class="c">// It&#39;s enumerable, but not an List&lt;object&gt;.  Call EnumerableOps.ToArray</span>
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#3cd823932b07f5d3" class="i field">EnumerableOps_ToArray</a>, <span class="r137 r">enumerable</span>.<span class="i">Expression</span>),
                <span class="r135 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()).<span class="i">WriteToDebugLog</span>(<a href="#6451a9aa35b72f04" class="k">this</a>);
        }
    }
 
    <b>internal sealed class</b> <a id="419edde3d12cfa53" href="../../../R/419edde3d12cfa53.html" target="n" data-glyph="2,0" class="t t">PSPipeWriterBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <a href="#419edde3d12cfa53" class="t t">PSPipeWriterBinder</a> <a id="657ed0db7cc0d329" href="../../../R/657ed0db7cc0d329.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#5c11fe40de0939d0" class="t constructor">PSPipeWriterBinder</a>();
 
        <b>internal static</b> <a href="#419edde3d12cfa53" class="t t">PSPipeWriterBinder</a> <a id="6673eb761c739fa1" href="../../../R/6673eb761c739fa1.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#657ed0db7cc0d329" class="i field">s_binder</a>;
        }
 
        <b>private</b> <a id="5c11fe40de0939d0" href="../../../R/5c11fe40de0939d0.html" target="n" data-glyph="76,1" class="t constructor">PSPipeWriterBinder</a>()
        {
            <span class="i">CacheTarget</span>((<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;)<span class="i">StringRule</span>);
            <span class="i">CacheTarget</span>((<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;)<span class="i">AutomationNullRule</span>);
            <span class="i">CacheTarget</span>((<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;)<span class="i">BoolRule</span>);
            <span class="i">CacheTarget</span>((<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;)<span class="i">IntRule</span>);
        }
 
        <b>public override string</b> <a id="6eae12ac6b91067f" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <span class="s">&quot;PipelineWriter&quot;</span>;
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="ea2c654c65ff10d7" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r140 rd" class="r140 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r141 rd" class="r141 r">args</span>)
        {
            <span class="c">// args[0] is the pipe</span>
            <span class="c">// args[1] is the execution context, only used if we&#39;re enumerating</span>
 
            <b>if</b> (!<span class="r140 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r140 r">target</span>, <span class="r141 r">args</span>);
            }
 
            <b>if</b> (<span class="r140 r">target</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Block</span>(<b>typeof</b>(<b>void</b>), <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#c72ffa1171395d06" class="i field">PipelineOps_Nop</a>)),
                    <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r140 r">target</span>.<span class="i">Expression</span>, <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>))).<span class="i">WriteToDebugLog</span>(<a href="#419edde3d12cfa53" class="k">this</a>);
            }
 
            <b>var</b> <span id="r142 rd" class="r142 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r140 r">target</span>);
            <b>if</b> (<span class="r142 r">enumerable</span> == <b>null</b>)
            {
                <b>var</b> <span id="r143 rd" class="r143 r">bindingResult</span> = <a href="#0cc44259d9b27d72" class="t t">PSVariableAssignmentBinder</a>.<a href="#db50495b4c0f96e6" class="i method">Get</a>().<span class="i">Bind</span>(<span class="r140 r">target</span>, <span class="i">Array</span>.<span class="i">Empty</span>&lt;<span class="i">DynamicMetaObject</span>&gt;());
                <b>var</b> <span id="r144 rd" class="r144 r">restrictions</span> = <span class="r140 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsValueType</span>
                    ? <span class="r143 r">bindingResult</span>.<span class="i">Restrictions</span>
                    : <span class="r140 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r141 r">args</span>[0].<span class="i">Expression</span>,
                                    <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#ef3aead21a321eba" class="i field">Pipe_Add</a>,
                                    <span class="r143 r">bindingResult</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    <span class="r144 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#419edde3d12cfa53" class="k">this</a>);
            }
 
            <b>bool</b> <span id="r145 rd" class="r145 r">needsToDispose</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r140 r">target</span>.<span class="i">Value</span>) <b>is not</b> <span class="i">IEnumerator</span>;
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#d49591e592e4a683" class="i field">EnumerableOps_WriteEnumerableToPipe</a>,
                                <span class="r142 r">enumerable</span>.<span class="i">Expression</span>,
                                <span class="r141 r">args</span>[0].<span class="i">Expression</span>,
                                <span class="r141 r">args</span>[1].<span class="i">Expression</span>,
                                <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>(<span class="r145 r">needsToDispose</span>)),
                <span class="r142 r">enumerable</span>.<span class="i">Restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#419edde3d12cfa53" class="k">this</a>);
        }
 
        <b>private static void</b> <a id="9e569821107e771f" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BoolRule</a>(<span class="i">CallSite</span> <span id="r146 rd" class="r146 r">site</span>, <b>object</b> <span id="r147 rd" class="r147 r">obj</span>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r148 rd" class="r148 r">pipe</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r149 rd" class="r149 r">context</span>)
        {
            <b>if</b> (<span class="r147 r">obj</span> <b>is bool</b>) { <span class="r148 r">pipe</span>.<a href="../../Pipe.cs.html#f66ebe5942cdceab" class="i method">Add</a>(<span class="r147 r">obj</span>); }
            <b>else</b> { ((<span class="i">CallSite</span>&lt;<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;&gt;)<span class="r146 r">site</span>).<span class="i">Update</span>(<span class="r146 r">site</span>, <span class="r147 r">obj</span>, <span class="r148 r">pipe</span>, <span class="r149 r">context</span>); }
        }
 
        <b>private static void</b> <a id="2bb72921fa829822" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IntRule</a>(<span class="i">CallSite</span> <span id="r150 rd" class="r150 r">site</span>, <b>object</b> <span id="r151 rd" class="r151 r">obj</span>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r152 rd" class="r152 r">pipe</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r153 rd" class="r153 r">context</span>)
        {
            <b>if</b> (<span class="r151 r">obj</span> <b>is int</b>) { <span class="r152 r">pipe</span>.<a href="../../Pipe.cs.html#f66ebe5942cdceab" class="i method">Add</a>(<span class="r151 r">obj</span>); }
            <b>else</b> { ((<span class="i">CallSite</span>&lt;<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;&gt;)<span class="r150 r">site</span>).<span class="i">Update</span>(<span class="r150 r">site</span>, <span class="r151 r">obj</span>, <span class="r152 r">pipe</span>, <span class="r153 r">context</span>); }
        }
 
        <b>private static void</b> <a id="9a19044a5b27c5cb" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StringRule</a>(<span class="i">CallSite</span> <span id="r154 rd" class="r154 r">site</span>, <b>object</b> <span id="r155 rd" class="r155 r">obj</span>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r156 rd" class="r156 r">pipe</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r157 rd" class="r157 r">context</span>)
        {
            <b>if</b> (<span class="r155 r">obj</span> <b>is string</b>) { <span class="r156 r">pipe</span>.<a href="../../Pipe.cs.html#f66ebe5942cdceab" class="i method">Add</a>(<span class="r155 r">obj</span>); }
            <b>else</b> { ((<span class="i">CallSite</span>&lt;<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;&gt;)<span class="r154 r">site</span>).<span class="i">Update</span>(<span class="r154 r">site</span>, <span class="r155 r">obj</span>, <span class="r156 r">pipe</span>, <span class="r157 r">context</span>); }
        }
 
        <b>private static void</b> <a id="f5dc521fe6178a0e" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AutomationNullRule</a>(<span class="i">CallSite</span> <span id="r158 rd" class="r158 r">site</span>, <b>object</b> <span id="r159 rd" class="r159 r">obj</span>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r160 rd" class="r160 r">pipe</span>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r161 rd" class="r161 r">context</span>)
        {
            <b>if</b> (<span class="r159 r">obj</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>) { ((<span class="i">CallSite</span>&lt;<span class="i">Action</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <a href="../../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a>, <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>&gt;&gt;)<span class="r158 r">site</span>).<span class="i">Update</span>(<span class="r158 r">site</span>, <span class="r159 r">obj</span>, <span class="r160 r">pipe</span>, <span class="r161 r">context</span>); }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This binder creates the collection we use to do multi-assignments, e.g.:</span>
    <span class="c">///</span><span class="c">     $x,$y = $z</span>
    <span class="c">///</span><span class="c">     $x,$y,$z = 1,2,3,4,5</span>
    <span class="c">///</span><span class="c"> The target in this binder is the RHS, the result expression is an IList where the Count matches the</span>
    <span class="c">///</span><span class="c"> number of values assigned (_elements) on the left hand side of the assign.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="de8eb85637e55a23" href="../../../R/de8eb85637e55a23.html" target="n" data-glyph="2,0" class="t t">PSArrayAssignmentRHSBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <span class="i">List</span>&lt;<a href="#de8eb85637e55a23" class="t t">PSArrayAssignmentRHSBinder</a>&gt; <a id="be84fc252de09461" href="../../../R/be84fc252de09461.html" target="n" data-glyph="46,1" class="i field">s_binders</a> = <b>new</b> <span class="i">List</span>&lt;<a href="#de8eb85637e55a23" class="t t">PSArrayAssignmentRHSBinder</a>&gt;();
        <b>private readonly int</b> <a id="149034baeb1a94b6" href="../../../R/149034baeb1a94b6.html" target="n" data-glyph="46,1" class="i field">_elements</a>;
 
        <b>internal static</b> <a href="#de8eb85637e55a23" class="t t">PSArrayAssignmentRHSBinder</a> <a id="af68875567a854fc" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Get</a>(<b>int</b> <span id="r162 rd" class="r162 r">i</span>)
        {
            <b>lock</b> (<a href="#be84fc252de09461" class="i field">s_binders</a>)
            {
                <b>while</b> (<a href="#be84fc252de09461" class="i field">s_binders</a>.<span class="i">Count</span> &lt;= <span class="r162 r">i</span>)
                {
                    <a href="#be84fc252de09461" class="i field">s_binders</a>.<span class="i">Add</span>(<b>null</b>);
                }
 
                <b>return</b> <a href="#be84fc252de09461" class="i field">s_binders</a>[<span class="r162 r">i</span>] ?? (<a href="#be84fc252de09461" class="i field">s_binders</a>[<span class="r162 r">i</span>] = <b>new</b> <a href="#619a7e46dfffa7d2" class="t constructor">PSArrayAssignmentRHSBinder</a>(<span class="r162 r">i</span>));
            }
        }
 
        <b>private</b> <a id="619a7e46dfffa7d2" href="../../../R/619a7e46dfffa7d2.html" target="n" data-glyph="76,1" class="t constructor">PSArrayAssignmentRHSBinder</a>(<b>int</b> <span id="r163 rd" class="r163 r">elements</span>)
        {
            <a href="#149034baeb1a94b6" class="i field">_elements</a> = <span class="r163 r">elements</span>;
        }
 
        <b>public override string</b> <a id="443525377aad5ea3" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;MultiAssignRHSBinder {0}&quot;</span>, <a href="#149034baeb1a94b6" class="i field">_elements</a>);
        }
 
        <b>public override</b> <span class="i">Type</span> <a id="dbb4e5d932844768" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">ReturnType</a> { <b>get</b> { <b>return</b> <b>typeof</b>(<span class="i">IList</span>); } }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="7d567cde3fa625a9" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r164 rd" class="r164 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r165 rd" class="r165 r">args</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r165 r">args</span>.<span class="i">Length</span> == 0, <span class="s">&quot;binder doesn&#39;t expect any arguments&quot;</span>);
 
            <b>if</b> (!<span class="r164 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r164 r">target</span>).<span class="i">WriteToDebugLog</span>(<a href="#de8eb85637e55a23" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r164 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r164 r">target</span>.<span class="i">Value</span>) != <span class="r164 r">target</span>.<span class="i">Value</span>))
            {
                <b>return</b> <a href="#de8eb85637e55a23" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r164 r">target</span>).<span class="i">WriteToDebugLog</span>(<a href="#de8eb85637e55a23" class="k">this</a>);
            }
 
            <b>var</b> <span id="r166 rd" class="r166 r">iList</span> = <span class="r164 r">target</span>.<span class="i">Value</span> <b>as</b> <span class="i">IList</span>;
            <b>if</b> (<span class="r166 r">iList</span> != <b>null</b>)
            {
                <span class="c">// 3 possibilities - too few, exact, or too many elements.</span>
 
                <b>var</b> <span id="r167 rd" class="r167 r">getListCountExpr</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r164 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">ICollection</span>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#16793d35fc75692b" class="i field">ICollection_Count</a>);
 
                <b>var</b> <span id="r168 rd" class="r168 r">restrictions</span> = <span class="r164 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>().<span class="i">Merge</span>(
                    <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r167 r">getListCountExpr</span>,
                                                                                  <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<span class="r166 r">iList</span>.<span class="i">Count</span>))));
 
                <b>if</b> (<span class="r166 r">iList</span>.<span class="i">Count</span> == <a href="#149034baeb1a94b6" class="i field">_elements</a>)
                {
                    <span class="c">// Exact, we can use the value as is.</span>
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r164 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IList</span>)), <span class="r168 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#de8eb85637e55a23" class="k">this</a>);
                }
 
                <b>int</b> <span id="r169 rd" class="r169 r">i</span>;
                <span class="i">Expression</span>[] <span id="r170 rd" class="r170 r">newArrayElements</span> = <b>new</b> <span class="i">Expression</span>[<a href="#149034baeb1a94b6" class="i field">_elements</a>];
                <b>var</b> <span id="r171 rd" class="r171 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<span class="i">IList</span>));
                <b>if</b> (<span class="r166 r">iList</span>.<span class="i">Count</span> &lt; <a href="#149034baeb1a94b6" class="i field">_elements</a>)
                {
                    <span class="c">// Too few, create an array with the correct number assigned, fill in null for the extras</span>
 
                    <b>for</b> (<span class="r169 r">i</span> = 0; <span class="r169 r">i</span> &lt; <span class="r166 r">iList</span>.<span class="i">Count</span>; ++<span class="r169 r">i</span>)
                    {
                        <span class="r170 r">newArrayElements</span>[<span class="r169 r">i</span>] =
                            <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r171 r">temp</span>, <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#92fbbf3266e95071" class="i field">IList_get_Item</a>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(<span class="r169 r">i</span>));
                    }
 
                    <b>for</b> (; <span class="r169 r">i</span> &lt; <a href="#149034baeb1a94b6" class="i field">_elements</a>; ++<span class="r169 r">i</span>)
                    {
                        <span class="r170 r">newArrayElements</span>[<span class="r169 r">i</span>] = <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>;
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Too many, create an array with the correct number assigned, and the last element contains</span>
                    <span class="c">// all the extras.</span>
                    <b>for</b> (<span class="r169 r">i</span> = 0; <span class="r169 r">i</span> &lt; <a href="#149034baeb1a94b6" class="i field">_elements</a> - 1; ++<span class="r169 r">i</span>)
                    {
                        <span class="r170 r">newArrayElements</span>[<span class="r169 r">i</span>] =
                            <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r171 r">temp</span>, <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#92fbbf3266e95071" class="i field">IList_get_Item</a>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(<span class="r169 r">i</span>));
                    }
 
                    <span class="r170 r">newArrayElements</span>[<a href="#149034baeb1a94b6" class="i field">_elements</a> - 1] =
                        <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#fc7a0c4c669442af" class="i field">EnumerableOps_GetSlice</a>, <span class="r171 r">temp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<a href="#149034baeb1a94b6" class="i field">_elements</a> - 1)).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                }
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Block</span>(
                        <b>new</b>[] { <span class="r171 r">temp</span> },
                        <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r171 r">temp</span>, <span class="r164 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IList</span>))),
                        <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="r170 r">newArrayElements</span>)),
                    <span class="r168 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#de8eb85637e55a23" class="k">this</a>);
            }
 
            <span class="c">// We have a single element, the rest must be null.</span>
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="i">Enumerable</span>.<span class="i">Repeat</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <a href="#149034baeb1a94b6" class="i field">_elements</a> - 1)
                                                .<span class="i">Prepend</span>(<span class="r164 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))),
                <span class="r164 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>())).<span class="i">WriteToDebugLog</span>(<a href="#de8eb85637e55a23" class="k">this</a>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This binder is used to convert objects to string in specific circumstances, including:</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c">     * The LHS of a format expression.  The arguments (the RHS objects) of the format</span>
    <span class="c">///</span><span class="c">       expression are not converted to string here, that is defered to string.Format which</span>
    <span class="c">///</span><span class="c">       may have some custom formatting to apply.</span>
    <span class="c">///</span><span class="c">     * The objects passed to the format expression as part of an expandable string.  In this</span>
    <span class="c">///</span><span class="c">       case, the format string is generated by the parser, so we know that there is no custom</span>
    <span class="c">///</span><span class="c">       formatting to consider.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="db2e7c67b332caf6" href="../../../R/db2e7c67b332caf6.html" target="n" data-glyph="2,0" class="t t">PSToStringBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a> <a id="89b7243a1193e169" href="../../../R/89b7243a1193e169.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#770b2478cd3fe25e" class="t constructor">PSToStringBinder</a>();
 
        <b>internal static</b> <a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a> <a id="7a771c568a738822" href="../../../R/7a771c568a738822.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#89b7243a1193e169" class="i field">s_binder</a>;
        }
 
        <b>public override</b> <span class="i">Type</span> <a id="91c16c65a1e42925" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">ReturnType</a> { <b>get</b> { <b>return</b> <b>typeof</b>(<b>string</b>); } }
 
        <b>private</b> <a id="770b2478cd3fe25e" href="../../../R/770b2478cd3fe25e.html" target="n" data-glyph="76,1" class="t constructor">PSToStringBinder</a>()
        {
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="4b79e7b2e3e60eb1" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r172 rd" class="r172 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r173 rd" class="r173 r">args</span>)
        {
            <span class="c">// target is the object to convert</span>
            <span class="c">// args[0] is the ExecutionContext, needed to get $OFS, and possibly the type table.</span>
 
            <b>if</b> (!<span class="r172 r">target</span>.<span class="i">HasValue</span> || !<span class="r173 r">args</span>[0].<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r172 r">target</span>, <span class="r173 r">args</span>).<span class="i">WriteToDebugLog</span>(<a href="#db2e7c67b332caf6" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r172 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r172 r">target</span>.<span class="i">Value</span>) != <span class="r172 r">target</span>.<span class="i">Value</span>))
            {
                <b>return</b> <a href="#db2e7c67b332caf6" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r172 r">target</span>, <span class="r173 r">args</span>[0]).<span class="i">WriteToDebugLog</span>(<a href="#db2e7c67b332caf6" class="k">this</a>);
            }
 
            <b>var</b> <span id="r174 rd" class="r174 r">restrictions</span> = <span class="r172 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
            <b>if</b> (<span class="r172 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r172 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>)),
                    <span class="r174 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#db2e7c67b332caf6" class="k">this</a>);
            }
 
            <span class="c">// PSObject.ToStringParser will handle everything, but if you want to speed up conversion to string,</span>
            <span class="c">// add special cases here.</span>
 
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">InvokeToString</span>(<span class="r173 r">args</span>[0].<span class="i">Expression</span>, <span class="r172 r">target</span>.<span class="i">Expression</span>),
                <span class="r174 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#db2e7c67b332caf6" class="k">this</a>);
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="cb599036f41c6a5a" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokeToString</a>(<span class="i">Expression</span> <span id="r175 rd" class="r175 r">context</span>, <span class="i">Expression</span> <span id="r176 rd" class="r176 r">target</span>)
        {
            <b>if</b> (<span class="r176 r">target</span>.<span class="i">Type</span> == <b>typeof</b>(<b>string</b>))
            {
                <b>return</b> <span class="r176 r">target</span>;
            }
 
            <span class="c">// PSObject.ToStringParser will handle everything, but if you want to speed up conversion to string,</span>
            <span class="c">// add special cases here.</span>
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#806767df08e07155" class="i field">PSObject_ToStringParser</a>,
                                   <span class="r175 r">context</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>)),
                                   <span class="r176 r">target</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This binder is used to optimize the conversion of the result.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="41db08c5cb57ba77" href="../../../R/41db08c5cb57ba77.html" target="n" data-glyph="2,0" class="t t">PSPipelineResultToBoolBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <a href="#41db08c5cb57ba77" class="t t">PSPipelineResultToBoolBinder</a> <a id="a9fffad40ff9592a" href="../../../R/a9fffad40ff9592a.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#1271ea6c87cea614" class="t constructor">PSPipelineResultToBoolBinder</a>();
 
        <b>internal static</b> <a href="#41db08c5cb57ba77" class="t t">PSPipelineResultToBoolBinder</a> <a id="3a8ed25018fec703" href="../../../R/3a8ed25018fec703.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#a9fffad40ff9592a" class="i field">s_binder</a>;
        }
 
        <b>private</b> <a id="1271ea6c87cea614" href="../../../R/1271ea6c87cea614.html" target="n" data-glyph="76,1" class="t constructor">PSPipelineResultToBoolBinder</a>()
        {
        }
 
        <b>public override</b> <span class="i">Type</span> <a id="1f1605efb278e1b4" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">ReturnType</a> { <b>get</b> { <b>return</b> <b>typeof</b>(<b>bool</b>); } }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="0d6b529e2b4a6535" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r177 rd" class="r177 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r178 rd" class="r178 r">args</span>)
        {
            <b>if</b> (!<span class="r177 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r177 r">target</span>).<span class="i">WriteToDebugLog</span>(<a href="#41db08c5cb57ba77" class="k">this</a>);
            }
 
            <span class="i">IList</span> <span id="r179 rd" class="r179 r">pipelineResult</span> = <span class="r177 r">target</span>.<span class="i">Value</span> <b>as</b> <span class="i">IList</span>;
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r179 r">pipelineResult</span> != <b>null</b>, <span class="s">&quot;Pipeline result is always an IList&quot;</span>);
 
            <b>var</b> <span id="r180 rd" class="r180 r">ilistExpr</span> = <span class="r177 r">target</span>.<span class="i">Expression</span>;
            <b>if</b> (<b>typeof</b>(<span class="i">IList</span>) != <span class="r180 r">ilistExpr</span>.<span class="i">Type</span>)
            {
                <span class="r180 r">ilistExpr</span> = <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r180 r">ilistExpr</span>, <b>typeof</b>(<span class="i">IList</span>));
            }
 
            <b>var</b> <span id="r181 rd" class="r181 r">countExpr</span> = <span class="i">Expression</span>.<span class="i">Property</span>(
                <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r180 r">ilistExpr</span>, <b>typeof</b>(<span class="i">ICollection</span>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#16793d35fc75692b" class="i field">ICollection_Count</a>);
 
            <span class="i">Expression</span> <span id="r182 rd" class="r182 r">result</span>;
            <span class="i">BindingRestrictions</span> <span id="r183 rd" class="r183 r">restrictions</span>;
            <b>switch</b> (<span class="r179 r">pipelineResult</span>.<span class="i">Count</span>)
            {
                <b>case</b> 0:
                    <span class="r182 r">result</span> = <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>(<b>false</b>);
                    <span class="r183 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r181 r">countExpr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)));
                    <b>break</b>;
                <b>case</b> 1:
                    <span class="r182 r">result</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r180 r">ilistExpr</span>,
                                             <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#92fbbf3266e95071" class="i field">IList_get_Item</a>,
                                             <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)).<span class="i">Convert</span>(<b>typeof</b>(<b>bool</b>));
                    <span class="r183 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r181 r">countExpr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(1)));
                    <b>break</b>;
                <b>default</b>:
                    <span class="r182 r">result</span> = <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>(<b>true</b>);
                    <span class="r183 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">GreaterThan</span>(<span class="r181 r">countExpr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(1)));
                    <b>break</b>;
            }
 
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r182 r">result</span>, <span class="r183 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#41db08c5cb57ba77" class="k">this</a>);
        }
    }
 
    <b>internal sealed class</b> <a id="f6e38f6a1de3f60b" href="../../../R/f6e38f6a1de3f60b.html" target="n" data-glyph="2,0" class="t t">PSInvokeDynamicMemberBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private sealed class</b> <a id="ada7eaec4ab208d5" href="../../../R/../../0000000000.html" target="n" data-glyph="4,1" class="t t"><span id="c4bb99f94add7a25">KeyComparer</span></a> : <span class="i">IEqualityComparer</span>&lt;<span class="i">PSInvokeDynamicMemberBinderKeyType</span>&gt;
        {
            <b>public bool</b> <a id="7c67cf1a879b2c73" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Equals</a>(<span class="i">PSInvokeDynamicMemberBinderKeyType</span> <span id="r184 rd" class="r184 r">x</span>, <span class="i">PSInvokeDynamicMemberBinderKeyType</span> <span id="r185 rd" class="r185 r">y</span>)
            {
                <b>return</b> <span class="r184 r">x</span>.<span class="i">Item1</span>.<span class="i">Equals</span>(<span class="r185 r">y</span>.<span class="i">Item1</span>) &amp;&amp;
                       ((<span class="r184 r">x</span>.<span class="i">Item2</span> == <b>null</b>) ? <span class="r185 r">y</span>.<span class="i">Item2</span> == <b>null</b> : <span class="r184 r">x</span>.<span class="i">Item2</span>.<span class="i">Equals</span>(<span class="r185 r">y</span>.<span class="i">Item2</span>)) &amp;&amp;
                       <span class="r184 r">x</span>.<span class="i">Item3</span> == <span class="r185 r">y</span>.<span class="i">Item3</span> &amp;&amp;
                       <span class="r184 r">x</span>.<span class="i">Item4</span> == <span class="r185 r">y</span>.<span class="i">Item4</span> &amp;&amp;
                       <span class="r184 r">x</span>.<span class="i">Item5</span> == <span class="r185 r">y</span>.<span class="i">Item5</span>;
            }
 
            <b>public int</b> <a id="4ae99dde9d1a1159" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetHashCode</a>(<span class="i">PSInvokeDynamicMemberBinderKeyType</span> <span id="r186 rd" class="r186 r">obj</span>)
            {
                <b>return</b> <span class="r186 r">obj</span>.<span class="i">GetHashCode</span>();
            }
        }
 
        <b>private static readonly</b>
            <span class="i">Dictionary</span>&lt;<span class="i">PSInvokeDynamicMemberBinderKeyType</span>, <a href="#f6e38f6a1de3f60b" class="t t">PSInvokeDynamicMemberBinder</a>&gt; <a id="e7b610413879e43c" href="../../../R/e7b610413879e43c.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a>
            = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">PSInvokeDynamicMemberBinderKeyType</span>, <a href="#f6e38f6a1de3f60b" class="t t">PSInvokeDynamicMemberBinder</a>&gt;(<b>new</b> <span class="t">KeyComparer</span>());
 
        <b>internal static</b> <a href="#f6e38f6a1de3f60b" class="t t">PSInvokeDynamicMemberBinder</a> <a id="fa8157c24f78c2a6" href="../../../R/fa8157c24f78c2a6.html" target="n" data-glyph="74,1" class="i method">Get</a>(<span class="i">CallInfo</span> <span id="r187 rd" class="r187 r">callInfo</span>, <a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r188 rd" class="r188 r">classScopeAst</span>, <b>bool</b> <span id="r189 rd" class="r189 r">@static</span>, <b>bool</b> <span id="r190 rd" class="r190 r">propertySetter</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r191 rd" class="r191 r">constraints</span>)
        {
            <a href="#f6e38f6a1de3f60b" class="t t">PSInvokeDynamicMemberBinder</a> <span id="r192 rd" class="r192 r">result</span>;
 
            <b>var</b> <span id="r193 rd" class="r193 r">classScope</span> = <span class="r188 r">classScopeAst</span>?.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>;
            <b>lock</b> (<a href="#e7b610413879e43c" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r194 rd" class="r194 r">key</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r187 r">callInfo</span>, <span class="r191 r">constraints</span>, <span class="r190 r">propertySetter</span>, <span class="r189 r">@static</span>, <span class="r193 r">classScope</span>);
                <b>if</b> (!<a href="#e7b610413879e43c" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r194 r">key</span>, <b>out</b> <span class="r192 r">result</span>))
                {
                    <span class="r192 r">result</span> = <b>new</b> <span class="t">PSInvokeDynamicMemberBinder</span>(<span class="r187 r">callInfo</span>, <span class="r189 r">@static</span>, <span class="r190 r">propertySetter</span>, <span class="r191 r">constraints</span>, <span class="r193 r">classScope</span>);
                    <a href="#e7b610413879e43c" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r194 r">key</span>, <span class="r192 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r192 r">result</span>;
        }
 
        <b>private readonly</b> <span class="i">CallInfo</span> <a id="8a464771902112f2" href="../../../R/8a464771902112f2.html" target="n" data-glyph="46,1" class="i field">_callInfo</a>;
        <b>private readonly bool</b> <a id="85f4c214e9d5b5c0" href="../../../R/85f4c214e9d5b5c0.html" target="n" data-glyph="46,1" class="i field">_static</a>;
        <b>private readonly bool</b> <a id="893ff641b6368f9e" href="../../../R/893ff641b6368f9e.html" target="n" data-glyph="46,1" class="i field">_propertySetter</a>;
        <b>private readonly</b> <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <a id="c5cfccefc80f58a7" href="../../../R/c5cfccefc80f58a7.html" target="n" data-glyph="46,1" class="i field">_constraints</a>;
        <b>private readonly</b> <span class="i">Type</span> <a id="7746ad1cf6457680" href="../../../R/7746ad1cf6457680.html" target="n" data-glyph="46,1" class="i field">_classScope</a>;
 
        <b>private</b> <a id="cc1bfdff9ec5b1fe" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">PSInvokeDynamicMemberBinder</a>(<span class="i">CallInfo</span> <span id="r195 rd" class="r195 r">callInfo</span>, <b>bool</b> <span id="r196 rd" class="r196 r">@static</span>, <b>bool</b> <span id="r197 rd" class="r197 r">propertySetter</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r198 rd" class="r198 r">constraints</span>, <span class="i">Type</span> <span id="r199 rd" class="r199 r">classScope</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r195 r">callInfo</span> != <b>null</b>, <span class="s">&quot;callers make sure &#39;callInfo&#39; is not null&quot;</span>);
 
            <a href="#8a464771902112f2" class="i field">_callInfo</a> = <span class="r195 r">callInfo</span>;
            <a href="#85f4c214e9d5b5c0" class="i field">_static</a> = <span class="r196 r">@static</span>;
            <a href="#893ff641b6368f9e" class="i field">_propertySetter</a> = <span class="r197 r">propertySetter</span>;
            <a href="#c5cfccefc80f58a7" class="i field">_constraints</a> = <span class="r198 r">constraints</span>;
            <a href="#7746ad1cf6457680" class="i field">_classScope</a> = <span class="r199 r">classScope</span>;
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="4875c2e082ec8f53" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r200 rd" class="r200 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r201 rd" class="r201 r">args</span>)
        {
            <b>if</b> (!<span class="r200 r">target</span>.<span class="i">HasValue</span> || !<span class="r201 r">args</span>[0].<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r200 r">target</span>, <span class="r201 r">args</span>[0]).<span class="i">WriteToDebugLog</span>(<a href="#f6e38f6a1de3f60b" class="k">this</a>);
            }
 
            <b>var</b> <span id="r202 rd" class="r202 r">memberNameArg</span> = <span class="r201 r">args</span>[0];
            <b>object</b> <span id="r203 rd" class="r203 r">memberNameValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r202 r">memberNameArg</span>.<span class="i">Value</span>);
 
            <span class="i">Expression</span> <span id="r204 rd" class="r204 r">bindingStrExpr</span>;
            <b>var</b> <span id="r205 rd" class="r205 r">memberName</span> = <span class="r203 r">memberNameValue</span> <b>as string</b>;
            <b>if</b> (<span class="r205 r">memberName</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r202 r">memberNameArg</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
                {
                    <span class="r204 r">bindingStrExpr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r202 r">memberNameArg</span>.<span class="i">Expression</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
                }
                <b>else</b>
                {
                    <span class="r204 r">bindingStrExpr</span> = <span class="r202 r">memberNameArg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
                }
            }
            <b>else</b>
            {
                <span class="c">// Context is explicitly null here, we don&#39;t want $OFS to influence the property name, or</span>
                <span class="c">// we&#39;d generate code that wouldn&#39;t work consistently, depending on the value of $OFS.</span>
                <span class="r205 r">memberName</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">ToStringParser</span>(<b>null</b>, <span class="r202 r">memberNameArg</span>.<span class="i">Value</span>);
                <span class="r204 r">bindingStrExpr</span> = <a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<span class="i">InvokeToString</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <span class="r202 r">memberNameArg</span>.<span class="i">Expression</span>);
            }
            <span class="c">// Note: Need to create DynamicExpression to support dynamic member invoke, see PSSetDynamicMemberBinder for example</span>
            <b>var</b> <span id="r206 rd" class="r206 r">result</span> = <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<a href="#c69981bfa66f66e3" class="i method">Get</a>(<span class="r205 r">memberName</span>, <a href="#8a464771902112f2" class="i field">_callInfo</a>, <a href="#85f4c214e9d5b5c0" class="i field">_static</a>, <a href="#893ff641b6368f9e" class="i field">_propertySetter</a>, <a href="#c5cfccefc80f58a7" class="i field">_constraints</a>, <a href="#7746ad1cf6457680" class="i field">_classScope</a>).<span class="i">FallbackInvokeMember</span>(<span class="r200 r">target</span>, <span class="r201 r">args</span>.<span class="i">Skip</span>(1).<span class="i">ToArray</span>());
            <span class="i">BindingRestrictions</span> <span id="r207 rd" class="r207 r">restrictions</span> = <span class="r206 r">result</span>.<span class="i">Restrictions</span>;
            <span class="r207 r">restrictions</span> = <span class="r207 r">restrictions</span>.<span class="i">Merge</span>(<span class="r201 r">args</span>[0].<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            <span class="r207 r">restrictions</span> = <span class="r207 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#169ddb8c1dce49f8" class="i field">String_Equals</a>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r205 r">memberName</span>), <span class="r204 r">bindingStrExpr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35b47bde317ce874" class="i field">Ordinal</a>)));
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r206 r">result</span>.<span class="i">Expression</span>, <span class="r207 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#f6e38f6a1de3f60b" class="k">this</a>);
        }
    }
 
    <b>internal class</b> <a id="55a799025ad19a38" href="../../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t"><span id="593a2be616842127">PSDynamicGetOrSetBinderKeyComparer</span></a> : <span class="i">IEqualityComparer</span>&lt;<span class="i">PSGetOrSetDynamicMemberBinderKeyType</span>&gt;
    {
        <b>public bool</b> <a id="08c3ad4b241618c5" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Equals</a>(<span class="i">PSGetOrSetDynamicMemberBinderKeyType</span> <span id="r208 rd" class="r208 r">x</span>, <span class="i">PSGetOrSetDynamicMemberBinderKeyType</span> <span id="r209 rd" class="r209 r">y</span>)
        {
            <b>return</b> <span class="r208 r">x</span>.<span class="i">Item1</span> == <span class="r209 r">y</span>.<span class="i">Item1</span> &amp;&amp; <span class="r208 r">x</span>.<span class="i">Item2</span> == <span class="r209 r">y</span>.<span class="i">Item2</span>;
        }
 
        <b>public int</b> <a id="80a5a8873243416e" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetHashCode</a>(<span class="i">PSGetOrSetDynamicMemberBinderKeyType</span> <span id="r210 rd" class="r210 r">obj</span>)
        {
            <b>return</b> <span class="r210 r">obj</span>.<span class="i">GetHashCode</span>();
        }
    }
 
    <b>internal sealed class</b> <a id="1315cad8e76711f9" href="../../../R/1315cad8e76711f9.html" target="n" data-glyph="2,0" class="t t">PSGetDynamicMemberBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">PSGetOrSetDynamicMemberBinderKeyType</span>, <a href="#1315cad8e76711f9" class="t t">PSGetDynamicMemberBinder</a>&gt; <a id="24b4c264e7d40c0f" href="../../../R/24b4c264e7d40c0f.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> =
            <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">PSGetOrSetDynamicMemberBinderKeyType</span>, <a href="#1315cad8e76711f9" class="t t">PSGetDynamicMemberBinder</a>&gt;(<b>new</b> <span class="t">PSDynamicGetOrSetBinderKeyComparer</span>());
 
        <b>internal static</b> <a href="#1315cad8e76711f9" class="t t">PSGetDynamicMemberBinder</a> <a id="db0a6b7ddb3fd4d9" href="../../../R/db0a6b7ddb3fd4d9.html" target="n" data-glyph="74,1" class="i method">Get</a>(<a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r211 rd" class="r211 r">classScope</span>, <b>bool</b> <span id="r212 rd" class="r212 r">@static</span>)
        {
            <a href="#1315cad8e76711f9" class="t t">PSGetDynamicMemberBinder</a> <span id="r213 rd" class="r213 r">binder</span>;
            <b>lock</b> (<a href="#24b4c264e7d40c0f" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r214 rd" class="r214 r">type</span> = <span class="r211 r">classScope</span>?.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>;
                <b>var</b> <span id="r215 rd" class="r215 r">tuple</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r214 r">type</span>, <span class="r212 r">@static</span>);
                <b>if</b> (!<a href="#24b4c264e7d40c0f" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r215 r">tuple</span>, <b>out</b> <span class="r213 r">binder</span>))
                {
                    <span class="r213 r">binder</span> = <b>new</b> <span class="t">PSGetDynamicMemberBinder</span>(<span class="r214 r">type</span>, <span class="r212 r">@static</span>);
                    <a href="#24b4c264e7d40c0f" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r215 r">tuple</span>, <span class="r213 r">binder</span>);
                }
            }
 
            <b>return</b> <span class="r213 r">binder</span>;
        }
 
        <b>private readonly bool</b> <a id="cc0b7208b2e195ca" href="../../../R/cc0b7208b2e195ca.html" target="n" data-glyph="46,1" class="i field">_static</a>;
        <b>private readonly</b> <span class="i">Type</span> <a id="f918ef2e005dee31" href="../../../R/f918ef2e005dee31.html" target="n" data-glyph="46,1" class="i field">_classScope</a>;
 
        <b>private</b> <a id="073fa21c66992866" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">PSGetDynamicMemberBinder</a>(<span class="i">Type</span> <span id="r216 rd" class="r216 r">classScope</span>, <b>bool</b> <span id="r217 rd" class="r217 r">@static</span>)
        {
            <a href="#cc0b7208b2e195ca" class="i field">_static</a> = <span class="r217 r">@static</span>;
            <a href="#f918ef2e005dee31" class="i field">_classScope</a> = <span class="r216 r">classScope</span>;
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="6776779d628f5b90" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r218 rd" class="r218 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r219 rd" class="r219 r">args</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r219 r">args</span>.<span class="i">Length</span> == 1, <span class="s">&quot;PSGetDynamicMemberBinder::Bind handles one and only one argument&quot;</span>);
            <b>if</b> (!<span class="r218 r">target</span>.<span class="i">HasValue</span> || !<span class="r219 r">args</span>[0].<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r218 r">target</span>, <span class="r219 r">args</span>[0]).<span class="i">WriteToDebugLog</span>(<a href="#1315cad8e76711f9" class="k">this</a>);
            }
 
            <b>var</b> <span id="r220 rd" class="r220 r">memberNameArg</span> = <span class="r219 r">args</span>[0];
            <b>object</b> <span id="r221 rd" class="r221 r">memberNameValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r220 r">memberNameArg</span>.<span class="i">Value</span>);
 
            <span class="i">Expression</span> <span id="r222 rd" class="r222 r">bindingStrExpr</span>;
            <span class="i">BindingRestrictions</span> <span id="r223 rd" class="r223 r">restrictions</span>;
            <b>var</b> <span id="r224 rd" class="r224 r">memberName</span> = <span class="r221 r">memberNameValue</span> <b>as string</b>;
            <b>if</b> (<span class="r224 r">memberName</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r220 r">memberNameArg</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
                {
                    <span class="r222 r">bindingStrExpr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r220 r">memberNameArg</span>.<span class="i">Expression</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
                }
                <b>else</b>
                {
                    <span class="r222 r">bindingStrExpr</span> = <span class="r220 r">memberNameArg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
                }
            }
            <b>else</b> <b>if</b> (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r218 r">target</span>.<span class="i">Value</span>) <b>is</b> <span class="i">IDictionary</span>)
            {
                <span class="c">// We don&#39;t want to convert the member name to a string, we&#39;ll just try indexing the dictionary and nothing else.</span>
                <span class="r223 r">restrictions</span> = <span class="r218 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
                <span class="r223 r">restrictions</span> = <span class="r223 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                    <span class="i">Expression</span>.<span class="i">Not</span>(<span class="i">Expression</span>.<span class="i">TypeIs</span>(<span class="r219 r">args</span>[0].<span class="i">Expression</span>, <b>typeof</b>(<b>string</b>)))));
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#e6291b84399cb9a3" class="i field">PSGetDynamicMemberBinder_GetIDictionaryMember</a>,
                                    <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r218 r">target</span>, <b>typeof</b>(<span class="i">IDictionary</span>)),
                                    <span class="r219 r">args</span>[0].<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    <span class="r223 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#1315cad8e76711f9" class="k">this</a>);
            }
            <b>else</b>
            {
                <span class="c">// Context is explicitly null here, we don&#39;t want $OFS to influence the property name, or</span>
                <span class="c">// we&#39;d generate code that wouldn&#39;t work consistently, depending on the value of $OFS.</span>
                <span class="r224 r">memberName</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">ToStringParser</span>(<b>null</b>, <span class="r220 r">memberNameArg</span>.<span class="i">Value</span>);
                <span class="r222 r">bindingStrExpr</span> = <a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<span class="i">InvokeToString</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <span class="r220 r">memberNameArg</span>.<span class="i">Expression</span>);
            }
 
            <b>var</b> <span id="r225 rd" class="r225 r">result</span> = <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#f97fa109dcbba60d" class="i method">Get</a>(<span class="r224 r">memberName</span>, <a href="#f918ef2e005dee31" class="i field">_classScope</a>, <a href="#cc0b7208b2e195ca" class="i field">_static</a>), <b>typeof</b>(<b>object</b>), <span class="r218 r">target</span>.<span class="i">Expression</span>);
            <span class="r223 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>;
            <span class="r223 r">restrictions</span> = <span class="r223 r">restrictions</span>.<span class="i">Merge</span>(<span class="r219 r">args</span>[0].<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            <span class="r223 r">restrictions</span> = <span class="r223 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#169ddb8c1dce49f8" class="i field">String_Equals</a>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r224 r">memberName</span>), <span class="r222 r">bindingStrExpr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35b47bde317ce874" class="i field">Ordinal</a>)));
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r225 r">result</span>, <span class="r223 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#1315cad8e76711f9" class="k">this</a>);
        }
 
        <b>internal static object</b> <a id="b987d20d8f6becd0" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetIDictionaryMember</a>(<span class="i">IDictionary</span> <span id="r226 rd" class="r226 r">hash</span>, <b>object</b> <span id="r227 rd" class="r227 r">key</span>)
        {
            <b>try</b>
            {
                <span class="r227 r">key</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r227 r">key</span>);
                <b>if</b> (<span class="r226 r">hash</span>.<span class="i">Contains</span>(<span class="r227 r">key</span>))
                {
                    <b>return</b> <span class="r226 r">hash</span>[<span class="r227 r">key</span>];
                }
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
            }
 
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r228 rd" class="r228 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <b>if</b> (<span class="r228 r">context</span>.<a href="../../ExecutionContext.cs.html#11a9985b406aed68" class="i method">IsStrictVersion</a>(2))
            {
                <span class="c">// If the member is undefined and we&#39;re in strict mode, throw an exception...</span>
                <b>throw</b> <b>new</b> <span class="t">PropertyNotFoundException</span>(<span class="s">&quot;PropertyNotFoundStrict&quot;</span>, <b>null</b>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotFoundStrict</span>,
                                                    <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<b>string</b>&gt;(<span class="r227 r">key</span>));
            }
 
            <b>return</b> <b>null</b>;
        }
    }
 
    <b>internal sealed class</b> <a id="c09acad10da15de3" href="../../../R/c09acad10da15de3.html" target="n" data-glyph="2,0" class="t t">PSSetDynamicMemberBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">PSGetOrSetDynamicMemberBinderKeyType</span>, <a href="#c09acad10da15de3" class="t t">PSSetDynamicMemberBinder</a>&gt; <a id="d156626aaca58009" href="../../../R/d156626aaca58009.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> =
            <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">PSGetOrSetDynamicMemberBinderKeyType</span>, <a href="#c09acad10da15de3" class="t t">PSSetDynamicMemberBinder</a>&gt;(<b>new</b> <span class="t">PSDynamicGetOrSetBinderKeyComparer</span>());
 
        <b>internal static</b> <a href="#c09acad10da15de3" class="t t">PSSetDynamicMemberBinder</a> <a id="a8cb678f50d1b667" href="../../../R/a8cb678f50d1b667.html" target="n" data-glyph="74,1" class="i method">Get</a>(<a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r229 rd" class="r229 r">classScope</span>, <b>bool</b> <span id="r230 rd" class="r230 r">@static</span>)
        {
            <a href="#c09acad10da15de3" class="t t">PSSetDynamicMemberBinder</a> <span id="r231 rd" class="r231 r">binder</span>;
            <b>lock</b> (<a href="#d156626aaca58009" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r232 rd" class="r232 r">type</span> = <span class="r229 r">classScope</span>?.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>;
                <b>var</b> <span id="r233 rd" class="r233 r">tuple</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r232 r">type</span>, <span class="r230 r">@static</span>);
                <b>if</b> (!<a href="#d156626aaca58009" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r233 r">tuple</span>, <b>out</b> <span class="r231 r">binder</span>))
                {
                    <span class="r231 r">binder</span> = <b>new</b> <span class="t">PSSetDynamicMemberBinder</span>(<span class="r232 r">type</span>, <span class="r230 r">@static</span>);
                    <a href="#d156626aaca58009" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r233 r">tuple</span>, <span class="r231 r">binder</span>);
                }
            }
 
            <b>return</b> <span class="r231 r">binder</span>;
        }
 
        <b>private readonly bool</b> <a id="13f84a7d0de6f549" href="../../../R/13f84a7d0de6f549.html" target="n" data-glyph="46,1" class="i field">_static</a>;
        <b>private readonly</b> <span class="i">Type</span> <a id="0d95b178fc74e7e1" href="../../../R/0d95b178fc74e7e1.html" target="n" data-glyph="46,1" class="i field">_classScope</a>;
 
        <b>private</b> <a id="bfe7bf24c5e1f7fb" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">PSSetDynamicMemberBinder</a>(<span class="i">Type</span> <span id="r234 rd" class="r234 r">classScope</span>, <b>bool</b> <span id="r235 rd" class="r235 r">@static</span>)
        {
            <a href="#13f84a7d0de6f549" class="i field">_static</a> = <span class="r235 r">@static</span>;
            <a href="#0d95b178fc74e7e1" class="i field">_classScope</a> = <span class="r234 r">classScope</span>;
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="615a6f95db342715" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r236 rd" class="r236 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r237 rd" class="r237 r">args</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r237 r">args</span>.<span class="i">Length</span> == 2, <span class="s">&quot;PSSetDynamicMemberBinder::Bind handles two and only two arguments&quot;</span>);
            <b>if</b> (!<span class="r236 r">target</span>.<span class="i">HasValue</span> || !<span class="r237 r">args</span>[0].<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r236 r">target</span>, <span class="r237 r">args</span>[0]).<span class="i">WriteToDebugLog</span>(<a href="#c09acad10da15de3" class="k">this</a>);
            }
 
            <b>var</b> <span id="r238 rd" class="r238 r">memberNameArg</span> = <span class="r237 r">args</span>[0];
            <b>object</b> <span id="r239 rd" class="r239 r">memberNameValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r238 r">memberNameArg</span>.<span class="i">Value</span>);
 
            <span class="i">Expression</span> <span id="r240 rd" class="r240 r">bindingStrExpr</span>;
            <b>var</b> <span id="r241 rd" class="r241 r">memberName</span> = <span class="r239 r">memberNameValue</span> <b>as string</b>;
            <b>if</b> (<span class="r241 r">memberName</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r238 r">memberNameArg</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
                {
                    <span class="r240 r">bindingStrExpr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r238 r">memberNameArg</span>.<span class="i">Expression</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
                }
                <b>else</b>
                {
                    <span class="r240 r">bindingStrExpr</span> = <span class="r238 r">memberNameArg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
                }
            }
            <b>else</b>
            {
                <span class="c">// Context is explicitly null here, we don&#39;t want $OFS to influence the property name, or</span>
                <span class="c">// we&#39;d generate code that wouldn&#39;t work consistently, depending on the value of $OFS.</span>
                <span class="r241 r">memberName</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">ToStringParser</span>(<b>null</b>, <span class="r238 r">memberNameArg</span>.<span class="i">Value</span>);
                <span class="r240 r">bindingStrExpr</span> = <a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<span class="i">InvokeToString</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <span class="r238 r">memberNameArg</span>.<span class="i">Expression</span>);
            }
 
            <b>var</b> <span id="r242 rd" class="r242 r">result</span> = <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#b33a3e4647e9ce8d" class="t t">PSSetMemberBinder</a>.<a href="#1066416587b6f493" class="i method">Get</a>(<span class="r241 r">memberName</span>, <a href="#0d95b178fc74e7e1" class="i field">_classScope</a>, <a href="#13f84a7d0de6f549" class="i field">_static</a>), <b>typeof</b>(<b>object</b>), <span class="r236 r">target</span>.<span class="i">Expression</span>, <span class="r237 r">args</span>[1].<span class="i">Expression</span>);
            <b>var</b> <span id="r243 rd" class="r243 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>;
            <span class="c">// Note: Optimal restriction is test target type is IDictionary or not</span>
            <span class="r243 r">restrictions</span> = <span class="r243 r">restrictions</span>.<span class="i">Merge</span>(<span class="r237 r">args</span>[0].<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            <span class="r243 r">restrictions</span> = <span class="r243 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#169ddb8c1dce49f8" class="i field">String_Equals</a>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r241 r">memberName</span>), <span class="r240 r">bindingStrExpr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35b47bde317ce874" class="i field">Ordinal</a>)));
 
            <span class="i">Expression</span> <span id="r244 rd" class="r244 r">resultExpr</span>;
            <b>if</b> (<span class="r236 r">target</span>.<span class="i">Value</span> <b>is</b> <span class="i">IDictionary</span>)
            {
                <span class="c">// We should first try:</span>
                <span class="c">//     $target[$arg[0]] = $arg[1]</span>
                <span class="c">// And if that fails, try arg[0] converted to string, setting a property, etc.</span>
 
                <b>var</b> <span id="r245 rd" class="r245 r">exception</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<span class="i">Exception</span>));
                <b>var</b> <span id="r246 rd" class="r246 r">indexResult</span> = <a href="#4efa6869376d725f" class="t t">PSSetIndexBinder</a>.<a href="#f4014536e121a2b0" class="i method">Get</a>(1).<span class="i">FallbackSetIndex</span>(<span class="r236 r">target</span>, <b>new</b>[] { <span class="r237 r">args</span>[0] }, <span class="r237 r">args</span>[1]);
                <span class="r244 r">resultExpr</span> = <span class="i">Expression</span>.<span class="i">TryCatch</span>(
                    <span class="r246 r">indexResult</span>.<span class="i">Expression</span>,
                    <span class="i">Expression</span>.<span class="i">Catch</span>(<span class="r245 r">exception</span>, <span class="r242 r">result</span>));
            }
            <b>else</b>
            {
                <span class="r244 r">resultExpr</span> = <span class="r242 r">result</span>;
            }
 
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r244 r">resultExpr</span>, <span class="r243 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#c09acad10da15de3" class="k">this</a>);
        }
    }
 
    <b>internal sealed class</b> <a id="6a4f21f786cbab8f" href="../../../R/6a4f21f786cbab8f.html" target="n" data-glyph="2,0" class="t t">PSSwitchClauseEvalBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <span class="c">// Increase this cache size if we add a new flag to the switch statement that:</span>
        <span class="c">//    - Influences evaluation of switch elements</span>
        <span class="c">//    - Is commonly used</span>
        <b>private static readonly</b> <a href="#6a4f21f786cbab8f" class="t t">PSSwitchClauseEvalBinder</a>[] <a id="1fd8b264125a911a" href="../../../R/1fd8b264125a911a.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> = <b>new</b> <a href="#6a4f21f786cbab8f" class="t t">PSSwitchClauseEvalBinder</a>[32];
        <b>private readonly</b> <a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a> <a id="9de2c7699ec418ba" href="../../../R/9de2c7699ec418ba.html" target="n" data-glyph="46,1" class="i field">_flags</a>;
 
        <b>internal static</b> <a href="#6a4f21f786cbab8f" class="t t">PSSwitchClauseEvalBinder</a> <a id="d3bbd1d19860c918" href="../../../R/d3bbd1d19860c918.html" target="n" data-glyph="74,1" class="i method">Get</a>(<a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a> <span id="r247 rd" class="r247 r">flags</span>)
        {
            <b>lock</b> (<a href="#1fd8b264125a911a" class="i field">s_binderCache</a>)
            {
                <b>return</b> <a href="#1fd8b264125a911a" class="i field">s_binderCache</a>[(<b>int</b>)<span class="r247 r">flags</span>] ?? (<a href="#1fd8b264125a911a" class="i field">s_binderCache</a>[(<b>int</b>)<span class="r247 r">flags</span>] = <b>new</b> <a href="#05ad6c42a2b1682b" class="t constructor">PSSwitchClauseEvalBinder</a>(<span class="r247 r">flags</span>));
            }
        }
 
        <b>private</b> <a id="05ad6c42a2b1682b" href="../../../R/05ad6c42a2b1682b.html" target="n" data-glyph="76,1" class="t constructor">PSSwitchClauseEvalBinder</a>(<a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a> <span id="r248 rd" class="r248 r">flags</span>)
        {
            <a href="#9de2c7699ec418ba" class="i field">_flags</a> = <span class="r248 r">flags</span>;
        }
 
        <b>public override</b> <span class="i">Type</span> <a id="14ee73a216021a3b" href="../../../R/14ee73a216021a3b.html" target="n" data-glyph="102,1" class="i property">ReturnType</a> { <b>get</b> { <b>return</b> <b>typeof</b>(<b>bool</b>); } }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="47a5b64733a906ab" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r249 rd" class="r249 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r250 rd" class="r250 r">args</span>)
        {
            <span class="c">// target is the condition</span>
            <span class="c">// args[0] is the value to test against the condition</span>
            <span class="c">// args[1] is the execution context to use, if needed</span>
 
            <b>if</b> (!<span class="r249 r">target</span>.<span class="i">HasValue</span> || !<span class="r250 r">args</span>[0].<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r249 r">target</span>, <span class="r250 r">args</span>[0], <span class="r250 r">args</span>[1]).<span class="i">WriteToDebugLog</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>);
            }
 
            <span class="c">// No need to add binding restrictions on either arg, the type of the clause is all that matters.</span>
            <span class="c">// We can skip the restrictions on the arg, the generated code will contain a dynamic site to convert</span>
            <span class="c">// the arg to string if applicable.  If the dynamic site is removed, then arg restrictions must be added.</span>
            <b>var</b> <span id="r251 rd" class="r251 r">targetRestrictions</span> = <span class="r249 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
 
            <span class="c">// If any args are PSObject, we typically call DeferForPSObject, but in this case,</span>
            <span class="c">// we don&#39;t because args[0] should not be unwrapped, which DeferForPSObject would do.</span>
            <b>if</b> (<span class="r249 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
            {
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>, <a href="#6a4f21f786cbab8f" class="k">this</a>.<a href="#14ee73a216021a3b" class="i property">ReturnType</a>,
                                              <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>,
                                                              <span class="r249 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                                              <span class="r250 r">args</span>[0].<span class="i">Expression</span>,
                                              <span class="r250 r">args</span>[1].<span class="i">Expression</span>),
                    <span class="r251 r">targetRestrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r249 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <span class="c">// If the condition is null, the we simply test the value against null.  It seems like</span>
                <span class="c">// this is a silly thing to allow in a switch, maybe it should be disallowed in strict mode.</span>
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r250 r">args</span>[0].<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>),
                    <span class="r249 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>())).<span class="i">WriteToDebugLog</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r249 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)
            {
                <b>var</b> <span id="r252 rd" class="r252 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r249 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)),
                                               <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4f6af0cfeb2c7169" class="i field">ScriptBlock_DoInvokeReturnAsIs</a>,
                    <span class="c">/*useLocalScope=*/</span>         <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>(<b>true</b>),
                    <span class="c">/*errorHandlingBehavior=*/</span> <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../../lang/scriptblock.cs.html#df0061919fb37a15" class="i field">WriteToExternalErrorPipe</a>),
                    <span class="c">/*dollarUnder=*/</span>           <span class="r250 r">args</span>[0].<span class="i">CastOrConvert</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="c">/*input=*/</span>                 <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#84591f5e881dc39e" class="i field">AutomationNullConstant</a>,
                    <span class="c">/*scriptThis=*/</span>            <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#84591f5e881dc39e" class="i field">AutomationNullConstant</a>,
                    <span class="c">/*args=*/</span>                  <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#7f0ebe7c58832085" class="i field">NullObjectArray</a>);
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">Get</span>(<b>typeof</b>(<b>bool</b>)), <b>typeof</b>(<b>bool</b>), <span class="r252 r">call</span>),
                                              <span class="r251 r">targetRestrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>);
            }
 
            <span class="c">// From here on out, arg must be a string.</span>
            <b>var</b> <span id="r253 rd" class="r253 r">executionContext</span> = <span class="r250 r">args</span>[1].<span class="i">Expression</span>;
            <b>var</b> <span id="r254 rd" class="r254 r">argAsString</span> = <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>), <span class="r250 r">args</span>[0].<span class="i">Expression</span>,
                                                        <span class="r253 r">executionContext</span>);
 
            <b>if</b> (<span class="r249 r">target</span>.<span class="i">Value</span> <b>is</b> <span class="i">Regex</span> || (<a href="#9de2c7699ec418ba" class="i field">_flags</a> &amp; <a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a>.<a href="../../parser/ast.cs.html#6c98f78beaa551f0" class="i field">Regex</a>) != 0)
            {
                <b>var</b> <span id="r255 rd" class="r255 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#2b437b06fc777c0b" class="i field">SwitchOps_ConditionSatisfiedRegex</a>,
                    <span class="c">/*caseSensitive=*/</span> <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>((<a href="#9de2c7699ec418ba" class="i field">_flags</a> &amp; <a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a>.<a href="../../parser/ast.cs.html#5612873142e6f4be" class="i field">CaseSensitive</a>) != 0),
                    <span class="c">/*condition=*/</span>     <span class="r249 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="c">/*errorPosition=*/</span> <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#635c2cd971f6dfae" class="i field">NullExtent</a>,
                    <span class="c">/*str=*/</span>           <span class="r254 r">argAsString</span>,
                    <span class="c">/*context=*/</span>       <span class="r253 r">executionContext</span>);
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r255 r">call</span>, <span class="r251 r">targetRestrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r249 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> || (<a href="#9de2c7699ec418ba" class="i field">_flags</a> &amp; <a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a>.<a href="../../parser/ast.cs.html#8c2beda7309b3ae0" class="i field">Wildcard</a>) != 0)
            {
                <b>var</b> <span id="r256 rd" class="r256 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#e544440f7db35cfa" class="i field">SwitchOps_ConditionSatisfiedWildcard</a>,
                    <span class="c">/*caseSensitive=*/</span> <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>((<a href="#9de2c7699ec418ba" class="i field">_flags</a> &amp; <a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a>.<a href="../../parser/ast.cs.html#5612873142e6f4be" class="i field">CaseSensitive</a>) != 0),
                    <span class="c">/*condition=*/</span>     <span class="r249 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="c">/*str=*/</span>           <span class="r254 r">argAsString</span>,
                    <span class="c">/*context=*/</span>       <span class="r253 r">executionContext</span>);
 
                <span class="c">// Binding restrictions must test the target, even if the switch is in -regex mode.</span>
                <span class="c">// If we didn&#39;t add restrictions on the target, we&#39;d incorrectly use this rule when the target</span>
                <span class="c">// is a script block.</span>
                <span class="c">// We can skip the restrictions on the arg, the generated code contains a dynamic site to convert</span>
                <span class="c">// the arg to string, so that site handles any arg type properly.</span>
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r256 r">call</span>, <span class="r251 r">targetRestrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>);
            }
 
            <b>var</b> <span id="r257 rd" class="r257 r">targetAsString</span> = <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>), <span class="r249 r">target</span>.<span class="i">Expression</span>,
                                                           <span class="r253 r">executionContext</span>);
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">CallStringEquals</span>(<span class="r257 r">targetAsString</span>, <span class="r254 r">argAsString</span>, ((<a href="#9de2c7699ec418ba" class="i field">_flags</a> &amp; <a href="../../parser/ast.cs.html#f3ebdce54e14c694" class="t t">SwitchFlags</a>.<a href="../../parser/ast.cs.html#5612873142e6f4be" class="i field">CaseSensitive</a>) == 0)),
                <span class="r251 r">targetRestrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#6a4f21f786cbab8f" class="k">this</a>);
        }
    }
 
    <span class="c">// This class implements the standard binder CreateInstanceBinder, but this binder handles the CallInfo a little differently.</span>
    <span class="c">// The ArgumentNames are not used to invoke a constructor, instead they are used to set properties/fields in the attribute.</span>
    <b>internal sealed class</b> <a id="ba17a6f992bccb93" href="../../../R/ba17a6f992bccb93.html" target="n" data-glyph="2,0" class="t t">PSAttributeGenerator</a> : <span class="i">CreateInstanceBinder</span>
    {
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">CallInfo</span>, <a href="#ba17a6f992bccb93" class="t t">PSAttributeGenerator</a>&gt; <a id="2d5d9966536465c8" href="../../../R/2d5d9966536465c8.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> =
            <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">CallInfo</span>, <a href="#ba17a6f992bccb93" class="t t">PSAttributeGenerator</a>&gt;();
 
        <b>internal static</b> <a href="#ba17a6f992bccb93" class="t t">PSAttributeGenerator</a> <a id="5ae79abef6263745" href="../../../R/5ae79abef6263745.html" target="n" data-glyph="74,1" class="i method">Get</a>(<span class="i">CallInfo</span> <span id="r258 rd" class="r258 r">callInfo</span>)
        {
            <b>lock</b> (<a href="#2d5d9966536465c8" class="i field">s_binderCache</a>)
            {
                <a href="#ba17a6f992bccb93" class="t t">PSAttributeGenerator</a> <span id="r259 rd" class="r259 r">binder</span>;
                <b>if</b> (!<a href="#2d5d9966536465c8" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r258 r">callInfo</span>, <b>out</b> <span class="r259 r">binder</span>))
                {
                    <span class="r259 r">binder</span> = <b>new</b> <a href="#930bf83cc2f87481" class="t constructor">PSAttributeGenerator</a>(<span class="r258 r">callInfo</span>);
                    <a href="#2d5d9966536465c8" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r258 r">callInfo</span>, <span class="r259 r">binder</span>);
                }
 
                <b>return</b> <span class="r259 r">binder</span>;
            }
        }
 
        <b>private</b> <a id="930bf83cc2f87481" href="../../../R/930bf83cc2f87481.html" target="n" data-glyph="76,1" class="t constructor">PSAttributeGenerator</a>(<span class="i">CallInfo</span> <span id="r260 rd" class="r260 r">callInfo</span>)
            : <b>base</b>(<span class="r260 r">callInfo</span>)
        {
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="605134c0e18073dc" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackCreateInstance</a>(<span class="i">DynamicMetaObject</span> <span id="r261 rd" class="r261 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r262 rd" class="r262 r">args</span>, <span class="i">DynamicMetaObject</span> <span id="r263 rd" class="r263 r">errorSuggestion</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r261 r">target</span>.<span class="i">HasValue</span> &amp;&amp; <span class="r261 r">target</span>.<span class="i">Value</span> <b>is</b> <span class="i">Type</span>, <span class="s">&quot;caller to verify arguments&quot;</span>);
            <b>var</b> <span id="r264 rd" class="r264 r">attributeType</span> = (<span class="i">Type</span>)<span class="r261 r">target</span>.<span class="i">Value</span>;
            <b>var</b> <span id="r265 rd" class="r265 r">ctorInfos</span> = <span class="r264 r">attributeType</span>.<span class="i">GetConstructors</span>();
            <b>var</b> <span id="r266 rd" class="r266 r">newConstructors</span> = <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<span class="i">GetMethodInformationArray</span>(<span class="r265 r">ctorInfos</span>);
 
            <span class="c">// We can&#39;t use a type restriction on target, it&#39;s always a System.Type.  So make sure we always use an instance restriction</span>
            <span class="r261 r">target</span> = <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r261 r">target</span>.<span class="i">Expression</span>, <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r261 r">target</span>.<span class="i">Expression</span>, <span class="r261 r">target</span>.<span class="i">Value</span>), <span class="r261 r">target</span>.<span class="i">Value</span>);
 
            <b>string</b> <span id="r267 rd" class="r267 r">errorId</span> = <b>null</b>;
            <b>string</b> <span id="r268 rd" class="r268 r">errorMsg</span> = <b>null</b>;
            <b>bool</b> <span id="r269 rd" class="r269 r">expandParamsOnBest</span>;
            <b>bool</b> <span id="r270 rd" class="r270 r">callNonVirtually</span>;
            <b>var</b> <span id="r271 rd" class="r271 r">positionalArgCount</span> = <span class="i">CallInfo</span>.<span class="i">ArgumentCount</span> - <span class="i">CallInfo</span>.<span class="i">ArgumentNames</span>.<span class="i">Count</span>;
 
            <a href="../../CoreAdapter.cs.html#8ae0c30e474b7c1e" class="k">var</a> <span id="r272 rd" class="r272 r">bestMethod</span> = <a href="../../CoreAdapter.cs.html#88aa0312e9fc25c7" class="t t">Adapter</a>.<span class="i">FindBestMethod</span>(
                <span class="r266 r">newConstructors</span>,
                <span class="i">invocationConstraints</span>: <b>null</b>,
                <span class="i">allowCastingToByRefLikeType</span>: <b>false</b>,
                <span class="r262 r">args</span>.<span class="i">Take</span>(<span class="r271 r">positionalArgCount</span>).<span class="i">Select</span>(<b>static</b> <span id="r273 rd" class="r273 r">arg</span> =&gt; <span class="r273 r">arg</span>.<span class="i">Value</span>).<span class="i">ToArray</span>(),
                <b>ref</b> <span class="r267 r">errorId</span>,
                <b>ref</b> <span class="r268 r">errorMsg</span>,
                <b>out</b> <span class="r269 r">expandParamsOnBest</span>,
                <b>out</b> <span class="r270 r">callNonVirtually</span>);
 
            <b>if</b> (<span class="r272 r">bestMethod</span> == <b>null</b>)
            {
                <b>return</b> <span class="r263 r">errorSuggestion</span> ?? <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Throw</span>(
                        <span class="i">Expression</span>.<span class="i">New</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#1c44fd79df4afcc1" class="i field">MethodException_ctor</a>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r267 r">errorId</span>),
                                       <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r268 r">errorMsg</span>),
                                       <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;.ctor&quot;</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                            <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<span class="r271 r">positionalArgCount</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))),
                        <a href="#ba17a6f992bccb93" class="k">this</a>.<span class="i">ReturnType</span>),
                    <span class="r261 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r262 r">args</span>));
            }
 
            <b>var</b> <span id="r274 rd" class="r274 r">constructorInfo</span> = (<span class="i">ConstructorInfo</span>)<span class="r272 r">bestMethod</span>.<a href="../../CoreAdapter.cs.html#3a0e575988f5a5de" class="i field">method</a>;
            <b>var</b> <span id="r275 rd" class="r275 r">parameterInfo</span> = <span class="r274 r">constructorInfo</span>.<span class="i">GetParameters</span>();
            <b>var</b> <span id="r276 rd" class="r276 r">ctorArgs</span> = <b>new</b> <span class="i">Expression</span>[<span class="r275 r">parameterInfo</span>.<span class="i">Length</span>];
            <b>var</b> <span id="r277 rd" class="r277 r">argIndex</span> = 0;
            <b>for</b> (; <span class="r277 r">argIndex</span> &lt; <span class="r275 r">parameterInfo</span>.<span class="i">Length</span>; ++<span class="r277 r">argIndex</span>)
            {
                <b>var</b> <span id="r278 rd" class="r278 r">resultType</span> = <span class="r275 r">parameterInfo</span>[<span class="r277 r">argIndex</span>].<span class="i">ParameterType</span>;
 
                <span class="c">// The extension method &#39;CustomAttributeExtensions.GetCustomAttributes(ParameterInfo, Type, Boolean)&#39; has inconsistent</span>
                <span class="c">// behavior on its return value in both FullCLR and CoreCLR. According to MSDN, if the attribute cannot be found, it</span>
                <span class="c">// should return an empty collection. However, it returns null in some rare cases [when the parameter isn&#39;t backed by</span>
                <span class="c">// actual metadata].</span>
                <span class="c">// This inconsistent behavior affects OneCore powershell because we are using the extension method here when compiling</span>
                <span class="c">// against CoreCLR. So we need to add a null check until this is fixed in CLR.</span>
                <b>var</b> <span id="r279 rd" class="r279 r">paramArrayAttrs</span> = <span class="r275 r">parameterInfo</span>[<span class="r277 r">argIndex</span>].<span class="i">GetCustomAttributes</span>(<b>typeof</b>(<span class="i">ParamArrayAttribute</span>), <b>true</b>);
                <b>if</b> (<span class="r279 r">paramArrayAttrs</span> != <b>null</b> &amp;&amp; <span class="r279 r">paramArrayAttrs</span>.<span class="i">Length</span> &gt; 0 &amp;&amp; <span class="r269 r">expandParamsOnBest</span>)
                {
                    <b>var</b> <span id="r280 rd" class="r280 r">elementType</span> = <span class="r275 r">parameterInfo</span>[<span class="r277 r">argIndex</span>].<span class="i">ParameterType</span>.<span class="i">GetElementType</span>();
                    <b>var</b> <span id="r281 rd" class="r281 r">paramsArray</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">Expression</span>&gt;();
 
                    <b>int</b> <span id="r282 rd" class="r282 r">ctorArgIndex</span> = <span class="r277 r">argIndex</span>;
                    <b>for</b> (<b>int</b> <span id="r283 rd" class="r283 r">i</span> = <span class="r277 r">argIndex</span>; <span class="r283 r">i</span> &lt; <span class="r271 r">positionalArgCount</span>; ++<span class="r283 r">i</span>, ++<span class="r277 r">argIndex</span>)
                    {
                        <b>bool</b> <span id="r284 rd" class="r284 r">debase</span>;
 
                        <span class="c">// ConstrainedLanguage note - calls to this conversion are done by constructors with params arguments.</span>
                        <span class="c">// Protection against conversions are covered by the method resolution algorithm</span>
                        <span class="c">// (which ignores method arguments with disallowed types)</span>
                        <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r285 rd" class="r285 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r262 r">args</span>[<span class="r277 r">argIndex</span>].<span class="i">Value</span>, <span class="r280 r">elementType</span>, <b>out</b> <span class="r284 r">debase</span>);
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r285 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> != <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>, <span class="s">&quot;FindBestMethod should have failed if there is no conversion&quot;</span>);
 
                        <span class="r281 r">paramsArray</span>.<span class="i">Add</span>(
                            <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r285 r">conversion</span>, <span class="r262 r">args</span>[<span class="r283 r">i</span>].<span class="i">Expression</span>, <span class="r280 r">elementType</span>, <span class="r284 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>));
                    }
 
                    <span class="r276 r">ctorArgs</span>[<span class="r282 r">ctorArgIndex</span>] = <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<span class="r280 r">elementType</span>, <span class="r281 r">paramsArray</span>);
                    <b>break</b>;
                }
                <b>else</b>
                {
                    <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r286 rd" class="r286 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r262 r">args</span>[<span class="r277 r">argIndex</span>].<span class="i">Value</span>, <span class="r278 r">resultType</span>, <b>out bool</b> <span id="r287 rd" class="r287 r">debase</span>);
                    <span class="r276 r">ctorArgs</span>[<span class="r277 r">argIndex</span>] = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r286 r">conversion</span>, <span class="r262 r">args</span>[<span class="r277 r">argIndex</span>].<span class="i">Expression</span>, <span class="r278 r">resultType</span>, <span class="r287 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
                }
            }
 
            <span class="i">Expression</span> <span id="r288 rd" class="r288 r">result</span> = <span class="i">Expression</span>.<span class="i">New</span>(<span class="r274 r">constructorInfo</span>, <span class="r276 r">ctorArgs</span>);
            <b>if</b> (<span class="i">CallInfo</span>.<span class="i">ArgumentNames</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>var</b> <span id="r289 rd" class="r289 r">tmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r288 r">result</span>.<span class="i">Type</span>);
                <b>var</b> <span id="r290 rd" class="r290 r">blockExprs</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">Expression</span>&gt;();
                <b>foreach</b> (<b>var</b> <span id="r291 rd" class="r291 r">name</span> <b>in</b> <span class="i">CallInfo</span>.<span class="i">ArgumentNames</span>)
                {
                    <b>var</b> <span id="r292 rd" class="r292 r">members</span> = <span class="r264 r">attributeType</span>.<span class="i">GetMember</span>(<span class="r291 r">name</span>, <span class="i">MemberTypes</span>.<span class="i">Field</span> | <span class="i">MemberTypes</span>.<span class="i">Property</span>,
                        <span class="i">BindingFlags</span>.<span class="i">IgnoreCase</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">FlattenHierarchy</span>);
                    <b>if</b> (<span class="r292 r">members</span>.<span class="i">Length</span> != 1
                        || (<span class="r292 r">members</span>[0] <b>is not</b> <span class="i">PropertyInfo</span> &amp;&amp; <span class="r292 r">members</span>[0] <b>is not</b> <span class="i">FieldInfo</span>))
                    {
                        <b>return</b> <span class="r261 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r262 r">args</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;PropertyNotFoundForType&quot;</span>,
                                                        <span class="i">ParserStrings</span>.<span class="i">PropertyNotFoundForType</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r291 r">name</span>),
                                                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r264 r">attributeType</span>, <b>typeof</b>(<span class="i">Type</span>)));
                    }
 
                    <b>var</b> <span id="r293 rd" class="r293 r">member</span> = <span class="r292 r">members</span>[0];
                    <span class="i">Expression</span> <span id="r294 rd" class="r294 r">lhs</span>;
                    <span class="i">Type</span> <span id="r295 rd" class="r295 r">propertyType</span>;
                    <b>var</b> <span id="r296 rd" class="r296 r">propertyInfo</span> = <span class="r293 r">member</span> <b>as</b> <span class="i">PropertyInfo</span>;
                    <b>if</b> (<span class="r296 r">propertyInfo</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r296 r">propertyInfo</span>.<span class="i">GetSetMethod</span>() == <b>null</b>)
                        {
                            <b>return</b> <span class="r261 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r262 r">args</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;PropertyIsReadOnly&quot;</span>,
                                                            <span class="i">ParserStrings</span>.<span class="i">PropertyIsReadOnly</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r291 r">name</span>));
                        }
 
                        <span class="r295 r">propertyType</span> = <span class="r296 r">propertyInfo</span>.<span class="i">PropertyType</span>;
                        <span class="r294 r">lhs</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r289 r">tmp</span>.<span class="i">Cast</span>(<span class="r296 r">propertyInfo</span>.<span class="i">DeclaringType</span>), <span class="r296 r">propertyInfo</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r295 r">propertyType</span> = ((<span class="i">FieldInfo</span>)<span class="r293 r">member</span>).<span class="i">FieldType</span>;
                        <span class="r294 r">lhs</span> = <span class="i">Expression</span>.<span class="i">Field</span>(<span class="r289 r">tmp</span>.<span class="i">Cast</span>(<span class="r293 r">member</span>.<span class="i">DeclaringType</span>), (<span class="i">FieldInfo</span>)<span class="r293 r">member</span>);
                    }
 
                    <b>bool</b> <span id="r297 rd" class="r297 r">debase</span>;
 
                    <span class="c">// ConstrainedLanguage note - calls to these property assignment conversions are enforced by the</span>
                    <span class="c">// property assignment binding rules (which disallow property conversions to disallowed types)</span>
                    <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r298 rd" class="r298 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r262 r">args</span>[<span class="r277 r">argIndex</span>].<span class="i">Value</span>, <span class="r295 r">propertyType</span>, <b>out</b> <span class="r297 r">debase</span>);
                    <b>if</b> (<span class="r298 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
                    {
                        <b>return</b> <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r262 r">args</span>[<span class="r277 r">argIndex</span>], <span class="r295 r">propertyType</span>, <a href="#ba17a6f992bccb93" class="k">this</a>, -1,
                            <span class="r262 r">args</span>.<span class="i">Except</span>(<b>new</b> <span class="i">DynamicMetaObject</span>[] { <span class="r262 r">args</span>[<span class="r277 r">argIndex</span>] }).<span class="i">Prepend</span>(<span class="r261 r">target</span>).<span class="i">ToArray</span>());
                    }
 
                    <span class="r290 r">blockExprs</span>.<span class="i">Add</span>(
                        <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r294 r">lhs</span>, <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r298 r">conversion</span>, <span class="r262 r">args</span>[<span class="r277 r">argIndex</span>].<span class="i">Expression</span>, <span class="r295 r">propertyType</span>, <span class="r297 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>)));
                    <span class="r277 r">argIndex</span> += 1;
                }
 
                <span class="c">// We wrap the block of assignments in a try/catch and issue a general error message whenever the assignment fails.</span>
                <b>var</b> <span id="r299 rd" class="r299 r">exception</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<span class="i">Exception</span>));
                <span class="r288 r">result</span> = <span class="i">Expression</span>.<span class="i">Block</span>(
                    <b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r289 r">tmp</span> },
                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r289 r">tmp</span>, <span class="r288 r">result</span>),
                    <span class="i">Expression</span>.<span class="i">TryCatch</span>(
                        <span class="i">Expression</span>.<span class="i">Block</span>(<b>typeof</b>(<b>void</b>), <span class="r290 r">blockExprs</span>),
                        <span class="i">Expression</span>.<span class="i">Catch</span>(
                            <span class="r299 r">exception</span>,
                            <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeErrorWithInnerException</span>(<span class="s">&quot;PropertyAssignmentException&quot;</span>, <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r299 r">exception</span>, <span class="s">&quot;Message&quot;</span>), <span class="r299 r">exception</span>, <b>typeof</b>(<b>void</b>)))),
                    <span class="c">// The result of the block is the object constructed, so the tmp must be the last expr in the block.</span>
                    <span class="r289 r">tmp</span>);
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r288 r">result</span>, <span class="r261 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r262 r">args</span>));
        }
    }
 
    <b>internal sealed class</b> <a id="7a6ccd9565a4ccb0" href="../../../R/7a6ccd9565a4ccb0.html" target="n" data-glyph="2,0" class="t t">PSCustomObjectConverter</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <a href="#7a6ccd9565a4ccb0" class="t t">PSCustomObjectConverter</a> <a id="5ddbd80385a96a27" href="../../../R/5ddbd80385a96a27.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#15967992cb73474b" class="t constructor">PSCustomObjectConverter</a>();
 
        <b>internal static</b> <a href="#7a6ccd9565a4ccb0" class="t t">PSCustomObjectConverter</a> <a id="184d492f98264989" href="../../../R/184d492f98264989.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#5ddbd80385a96a27" class="i field">s_binder</a>;
        }
 
        <b>private</b> <a id="15967992cb73474b" href="../../../R/15967992cb73474b.html" target="n" data-glyph="76,1" class="t constructor">PSCustomObjectConverter</a>()
        {
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="c67b1fd9f3b61375" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r300 rd" class="r300 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r301 rd" class="r301 r">args</span>)
        {
            <b>if</b> (!<span class="r300 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r300 r">target</span>).<span class="i">WriteToDebugLog</span>(<a href="#7a6ccd9565a4ccb0" class="k">this</a>);
            }
 
            <b>var</b> <span id="r302 rd" class="r302 r">baseObjectValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r300 r">target</span>.<span class="i">Value</span>);
            <b>var</b> <span id="r303 rd" class="r303 r">toType</span> = <span class="r302 r">baseObjectValue</span> <b>is</b> <span class="i">OrderedDictionary</span> || <span class="r302 r">baseObjectValue</span> <b>is</b> <span class="i">Hashtable</span>
                ? <b>typeof</b>(<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#f499f4c6b4eece87" class="t t">InternalPSCustomObject</a>)
                : <b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>);
 
            <span class="c">// ConstrainedLanguage note - calls to this conversion only target PSCustomObject / PSObject,</span>
            <span class="c">// which is safe.</span>
            <b>bool</b> <span id="r304 rd" class="r304 r">debase</span>;
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r305 rd" class="r305 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r300 r">target</span>.<span class="i">Value</span>, <span class="r303 r">toType</span>, <b>out</b> <span class="r304 r">debase</span>);
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r305 r">conversion</span>, <span class="r300 r">target</span>.<span class="i">Expression</span>, <span class="r303 r">toType</span>, <span class="r304 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>),
                <span class="r300 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()).<span class="i">WriteToDebugLog</span>(<a href="#7a6ccd9565a4ccb0" class="k">this</a>);
        }
    }
 
    <b>internal sealed class</b> <a id="248d1515946e67ce" href="../../../R/248d1515946e67ce.html" target="n" data-glyph="2,0" class="t t">PSDynamicConvertBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <a href="#248d1515946e67ce" class="t t">PSDynamicConvertBinder</a> <a id="c98146d4c3fceb80" href="../../../R/c98146d4c3fceb80.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#41bd865aac3fedfa" class="t constructor">PSDynamicConvertBinder</a>();
 
        <b>internal static</b> <a href="#248d1515946e67ce" class="t t">PSDynamicConvertBinder</a> <a id="911ee0315415b304" href="../../../R/911ee0315415b304.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#c98146d4c3fceb80" class="i field">s_binder</a>;
        }
 
        <b>private</b> <a id="41bd865aac3fedfa" href="../../../R/41bd865aac3fedfa.html" target="n" data-glyph="76,1" class="t constructor">PSDynamicConvertBinder</a>()
        {
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="56bf1eb80811a437" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r306 rd" class="r306 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r307 rd" class="r307 r">args</span>)
        {
            <span class="c">// target is the type and is never a PSObject</span>
            <span class="c">// arg is the object to be converted</span>
 
            <span class="i">DynamicMetaObject</span> <span id="r308 rd" class="r308 r">arg</span> = <span class="r307 r">args</span>[0];
            <b>if</b> (!<span class="r306 r">target</span>.<span class="i">HasValue</span> || !<span class="r308 r">arg</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r306 r">target</span>, <span class="r308 r">arg</span>).<span class="i">WriteToDebugLog</span>(<a href="#248d1515946e67ce" class="k">this</a>);
            }
 
            <b>var</b> <span id="r309 rd" class="r309 r">toType</span> = <span class="r306 r">target</span>.<span class="i">Value</span> <b>as</b> <span class="i">Type</span>;
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r309 r">toType</span> != <b>null</b>, <span class="s">&quot;target must be a type&quot;</span>);
 
            <b>var</b> <span id="r310 rd" class="r310 r">bindingRestrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r306 r">target</span>.<span class="i">Expression</span>, <span class="r309 r">toType</span>).<span class="i">Merge</span>(<span class="r308 r">arg</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<a href="#eda18cf3e4f03bf5" class="i method">Get</a>(<span class="r309 r">toType</span>), <span class="r309 r">toType</span>, <span class="r308 r">arg</span>.<span class="i">Expression</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                          <span class="r310 r">bindingRestrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#248d1515946e67ce" class="k">this</a>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This binder is used to copy mutable value types when assigning to variables, otherwise just assigning the target object directly.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="0cc44259d9b27d72" href="../../../R/0cc44259d9b27d72.html" target="n" data-glyph="2,0" class="t t">PSVariableAssignmentBinder</a> : <span class="i">DynamicMetaObjectBinder</span>
    {
        <b>private static readonly</b> <a href="#0cc44259d9b27d72" class="t t">PSVariableAssignmentBinder</a> <a id="a52917038cc78300" href="../../../R/a52917038cc78300.html" target="n" data-glyph="46,1" class="i field">s_binder</a> = <b>new</b> <a href="#3a8eb8b8c9897cf5" class="t constructor">PSVariableAssignmentBinder</a>();
        <b>internal static int</b> <a id="6375ed9a6bada9ef" href="../../../R/6375ed9a6bada9ef.html" target="n" data-glyph="44,1" class="i field">s_mutableValueWithInstanceMemberVersion</a>;
 
        <b>internal static</b> <a href="#0cc44259d9b27d72" class="t t">PSVariableAssignmentBinder</a> <a id="db50495b4c0f96e6" href="../../../R/db50495b4c0f96e6.html" target="n" data-glyph="74,1" class="i method">Get</a>()
        {
            <b>return</b> <a href="#a52917038cc78300" class="i field">s_binder</a>;
        }
 
        <b>private</b> <a id="3a8eb8b8c9897cf5" href="../../../R/3a8eb8b8c9897cf5.html" target="n" data-glyph="76,1" class="t constructor">PSVariableAssignmentBinder</a>()
        {
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;)(<span class="i">PSObjectStringRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;)(<span class="i">ObjectRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;)(<span class="i">IntRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;)(<span class="i">EnumRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;)(<span class="i">BoolRule</span>));
            <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;)(<span class="i">NullRule</span>));
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="bf8200dcd25bc997" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Bind</a>(<span class="i">DynamicMetaObject</span> <span id="r311 rd" class="r311 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r312 rd" class="r312 r">args</span>)
        {
            <b>if</b> (!<span class="r311 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r311 r">target</span>);
            }
 
            <b>var</b> <span id="r313 rd" class="r313 r">value</span> = <span class="r311 r">target</span>.<span class="i">Value</span>;
 
            <b>if</b> (<span class="r313 r">value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <span class="r311 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()).<span class="i">WriteToDebugLog</span>(<a href="#0cc44259d9b27d72" class="k">this</a>);
            }
 
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r314 rd" class="r314 r">psobj</span> = <span class="r313 r">value</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r314 r">psobj</span> != <b>null</b>)
            {
                <b>var</b> <span id="r315 rd" class="r315 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r311 r">target</span>.<span class="i">Expression</span>, <span class="r314 r">psobj</span>.<span class="i">GetType</span>());
                <b>var</b> <span id="r316 rd" class="r316 r">expr</span> = <span class="r311 r">target</span>.<span class="i">Expression</span>;
                <b>var</b> <span id="r317 rd" class="r317 r">baseObject</span> = <span class="r314 r">psobj</span>.<a href="../../MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
                <b>var</b> <span id="r318 rd" class="r318 r">baseObjExpr</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r316 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#e1407712ae736ff8" class="i field">PSObject_BaseObject</a>);
                <b>if</b> (<span class="r317 r">baseObject</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r319 rd" class="r319 r">baseObjType</span> = <span class="r317 r">baseObject</span>.<span class="i">GetType</span>();
                    <span class="r315 r">restrictions</span> = <span class="r315 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r318 r">baseObjExpr</span>, <span class="r319 r">baseObjType</span>));
                    <b>if</b> (<span class="r319 r">baseObjType</span>.<span class="i">IsValueType</span>)
                    {
                        <span class="r316 r">expr</span> = <span class="i">GetExprForValueType</span>(<span class="r319 r">baseObjType</span>, <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r318 r">baseObjExpr</span>, <span class="r319 r">baseObjType</span>), <span class="r316 r">expr</span>, <b>ref</b> <span class="r315 r">restrictions</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r315 r">restrictions</span> =
                        <span class="r315 r">restrictions</span>.<span class="i">Merge</span>(
                            <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="i">Expression</span>.<span class="i">Equal</span>(<span class="r318 r">baseObjExpr</span>,
                                                                                          <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>)));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r316 r">expr</span>, <span class="r315 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0cc44259d9b27d72" class="k">this</a>);
            }
 
            <b>var</b> <span id="r320 rd" class="r320 r">type</span> = <span class="r313 r">value</span>.<span class="i">GetType</span>();
            <b>if</b> (<span class="r320 r">type</span>.<span class="i">IsValueType</span>)
            {
                <b>var</b> <span id="r321 rd" class="r321 r">expr</span> = <span class="r311 r">target</span>.<span class="i">Expression</span>;
                <b>var</b> <span id="r322 rd" class="r322 r">restrictions</span> = <span class="r311 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
                <span class="r321 r">expr</span> = <span class="i">GetExprForValueType</span>(<span class="r320 r">type</span>, <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r321 r">expr</span>, <span class="r320 r">type</span>), <span class="r321 r">expr</span>, <b>ref</b> <span class="r322 r">restrictions</span>);
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r321 r">expr</span>, <span class="r322 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0cc44259d9b27d72" class="k">this</a>);
            }
 
            <span class="c">// This rule is meant to cover all classes except PSObject.</span>
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="r311 r">target</span>.<span class="i">Expression</span>, <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                    <span class="i">Expression</span>.<span class="i">AndAlso</span>(
                        <span class="i">Expression</span>.<span class="i">Not</span>(<span class="i">Expression</span>.<span class="i">TypeIs</span>(<span class="r311 r">target</span>.<span class="i">Expression</span>, <b>typeof</b>(<span class="i">ValueType</span>))),
                        <span class="i">Expression</span>.<span class="i">Not</span>(<span class="i">Expression</span>.<span class="i">TypeIs</span>(<span class="r311 r">target</span>.<span class="i">Expression</span>, <b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)))))).<span class="i">WriteToDebugLog</span>(<a href="#0cc44259d9b27d72" class="k">this</a>);
        }
 
        <b>private static</b> <span class="i">Expression</span> <a id="7b021153a6680815" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetExprForValueType</a>(<span class="i">Type</span> <span id="r323 rd" class="r323 r">type</span>,
                                                      <span class="i">Expression</span> <span id="r324 rd" class="r324 r">convertedExpr</span>,
                                                      <span class="i">Expression</span> <span id="r325 rd" class="r325 r">originalExpr</span>,
                                                      <b>ref</b> <span class="i">BindingRestrictions</span> <span id="r326 rd" class="r326 r">restrictions</span>)
        {
            <span class="c">// A binding restriction for value types will be either:</span>
            <span class="c">//    if (obj is SomeValueType)</span>
            <span class="c">// or</span>
            <span class="c">//    if (obj is SomeValueType &amp;&amp; _mutableValueWithInstanceMemberVersion == someVersionNumber)</span>
            <span class="c">//</span>
            <span class="c">// And the expression will be one of 3 possibilities:</span>
            <span class="c">//    * return expr</span>
            <span class="c">//    * tmp = expr; return tmp (make a copy)</span>
            <span class="c">//    * return CopyInstanceMembersOfValueType((T)expr, expr) (make a copy, also copy instance members)</span>
            <span class="c">//</span>
            <span class="c">// If we&#39;ve never seen an instance member for a given type, we can avoid the expensive call to</span>
            <span class="c">// CopyInstanceMembersOfValueType, but if somebody adds an instance member in the future, we need to invalidate</span>
            <span class="c">// previously generated rules.  We do that with the version check.</span>
            <span class="c">//</span>
            <span class="c">// We can skip a version check if we&#39;re already generating the worst case code.  This also avoids regenerating</span>
            <span class="c">// new bindings when the new binding won&#39;t differ from a previous binding.</span>
 
            <span class="i">Expression</span> <span id="r327 rd" class="r327 r">expr</span>;
            <b>bool</b> <span id="r328 rd" class="r328 r">needVersionCheck</span> = <b>true</b>;
            <b>if</b> (<a href="#88e1d080aa39e436" class="i field">s_mutableValueTypesWithInstanceMembers</a>.<span class="i">ContainsKey</span>(<span class="r323 r">type</span>))
            {
                <b>var</b> <span id="r329 rd" class="r329 r">genericMethodInfo</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#3031372c6294ebd9" class="i field">PSVariableAssignmentBinder_CopyInstanceMembersOfValueType</a>.<span class="i">MakeGenericMethod</span>(<b>new</b> <span class="i">Type</span>[] { <span class="r323 r">type</span> });
                <span class="r327 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r329 r">genericMethodInfo</span>, <span class="r324 r">convertedExpr</span>, <span class="r325 r">originalExpr</span>);
                <span class="r328 r">needVersionCheck</span> = <b>false</b>;
            }
            <b>else</b> <b>if</b> (<a href="#b9a42c6bddbe3a42" class="i method">IsValueTypeMutable</a>(<span class="r323 r">type</span>))
            {
                <b>var</b> <span id="r330 rd" class="r330 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r323 r">type</span>);
                <span class="r327 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r330 r">temp</span> },
                                        <span class="c">// The valuetype is mutable, so force a copy by assigning to a temp.</span>
                                        <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r330 r">temp</span>, <span class="r324 r">convertedExpr</span>),
                                        <span class="c">// Box the return value because the dynamic site expects object</span>
                                        <span class="r330 r">temp</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
            }
            <b>else</b>
            {
                <span class="r327 r">expr</span> = <span class="r325 r">originalExpr</span>;
            }
 
            <b>if</b> (<span class="r328 r">needVersionCheck</span>)
            {
                <span class="r326 r">restrictions</span> = <span class="r326 r">restrictions</span>.<span class="i">Merge</span>(<a href="#50936c2e0f205741" class="i method">GetVersionCheck</a>(<a href="#6375ed9a6bada9ef" class="i field">s_mutableValueWithInstanceMemberVersion</a>));
            }
 
            <b>return</b> <span class="r327 r">expr</span>;
        }
 
        <b>private static object</b> <a id="4bd8715ba4b24919" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">EnumRule</a>(<span class="i">CallSite</span> <span id="r331 rd" class="r331 r">site</span>, <b>object</b> <span id="r332 rd" class="r332 r">obj</span>)
        {
            <b>if</b> (<span class="r332 r">obj</span> <b>is</b> <span class="i">Enum</span>) { <b>return</b> <span class="r332 r">obj</span>; }
 
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt;)<span class="r331 r">site</span>).<span class="i">Update</span>(<span class="r331 r">site</span>, <span class="r332 r">obj</span>);
        }
 
        <b>private static object</b> <a id="0c6f1395cf52b911" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BoolRule</a>(<span class="i">CallSite</span> <span id="r333 rd" class="r333 r">site</span>, <b>object</b> <span id="r334 rd" class="r334 r">obj</span>)
        {
            <b>if</b> (<span class="r334 r">obj</span> <b>is bool</b>) { <b>return</b> <span class="r334 r">obj</span>; }
 
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt;)<span class="r333 r">site</span>).<span class="i">Update</span>(<span class="r333 r">site</span>, <span class="r334 r">obj</span>);
        }
 
        <b>private static object</b> <a id="13cb5f14748d0b9f" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IntRule</a>(<span class="i">CallSite</span> <span id="r335 rd" class="r335 r">site</span>, <b>object</b> <span id="r336 rd" class="r336 r">obj</span>)
        {
            <b>if</b> (<span class="r336 r">obj</span> <b>is int</b>) { <b>return</b> <span class="r336 r">obj</span>; }
 
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt;)<span class="r335 r">site</span>).<span class="i">Update</span>(<span class="r335 r">site</span>, <span class="r336 r">obj</span>);
        }
 
        <b>private static object</b> <a id="d6620d19953aa12f" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ObjectRule</a>(<span class="i">CallSite</span> <span id="r337 rd" class="r337 r">site</span>, <b>object</b> <span id="r338 rd" class="r338 r">obj</span>)
        {
            <b>if</b> (<span class="r338 r">obj</span> <b>is not</b> <span class="i">ValueType</span> &amp;&amp; <span class="r338 r">obj</span> <b>is not</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>) { <b>return</b> <span class="r338 r">obj</span>; }
 
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt;)<span class="r337 r">site</span>).<span class="i">Update</span>(<span class="r337 r">site</span>, <span class="r338 r">obj</span>);
        }
 
        <b>private static object</b> <a id="e824de77dcd08e1d" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">PSObjectStringRule</a>(<span class="i">CallSite</span> <span id="r339 rd" class="r339 r">site</span>, <b>object</b> <span id="r340 rd" class="r340 r">obj</span>)
        {
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r341 rd" class="r341 r">psobj</span> = <span class="r340 r">obj</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r341 r">psobj</span> != <b>null</b> &amp;&amp; <span class="r341 r">psobj</span>.<a href="../../MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a> <b>is string</b>) <b>return</b> <span class="r340 r">obj</span>;
            <b>return</b> ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt;)<span class="r339 r">site</span>).<span class="i">Update</span>(<span class="r339 r">site</span>, <span class="r340 r">obj</span>);
        }
 
        <b>private static object</b> <a id="d43dff823751c590" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">NullRule</a>(<span class="i">CallSite</span> <span id="r342 rd" class="r342 r">site</span>, <b>object</b> <span id="r343 rd" class="r343 r">obj</span>)
        {
            <b>return</b> <span class="r343 r">obj</span> == <b>null</b> ? <b>null</b> : ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>object</b>&gt;&gt;)<span class="r342 r">site</span>).<span class="i">Update</span>(<span class="r342 r">site</span>, <span class="r343 r">obj</span>);
        }
 
        <b>internal static bool</b> <a id="b9a42c6bddbe3a42" href="../../../R/b9a42c6bddbe3a42.html" target="n" data-glyph="74,1" class="i method">IsValueTypeMutable</a>(<span class="i">Type</span> <span id="r344 rd" class="r344 r">type</span>)
        {
            <span class="c">// First, check for enums/primitives and compiler-defined attributes.</span>
            <b>if</b> (<span class="r344 r">type</span>.<span class="i">IsPrimitive</span>
                || <span class="r344 r">type</span>.<span class="i">IsEnum</span>
                || <span class="r344 r">type</span>.<span class="i">IsDefined</span>(<b>typeof</b>(<span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>.<span class="i">IsReadOnlyAttribute</span>), <span class="i">inherit</span>: <b>false</b>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// If the builtin attribute is not present, check for a custom attribute from by the compiler. If the</span>
            <span class="c">// library targets netstandard2.0, the compiler can&#39;t be sure the attribute will be provided by the runtime,</span>
            <span class="c">// and defines its own attribute of the same name during compilation. To account for this, we must check the</span>
            <span class="c">// type by name, not by reference.</span>
            <b>foreach</b> (<b>object</b> <span id="r345 rd" class="r345 r">attribute</span> <b>in</b> <span class="r344 r">type</span>.<span class="i">GetCustomAttributes</span>(<span class="i">inherit</span>: <b>false</b>))
            {
                <b>if</b> (<span class="r345 r">attribute</span>.<span class="i">GetType</span>().<span class="i">FullName</span>.<span class="i">Equals</span>(
                    <span class="s">&quot;System.Runtime.CompilerServices.IsReadOnlyAttribute&quot;</span>,
                    <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <span class="c">// Fallback: check all fields (public + private) to verify whether they&#39;re all readonly.</span>
            <span class="c">// If any field is not readonly, the value type is potentially mutable.</span>
            <b>foreach</b> (<b>var</b> <span id="r346 rd" class="r346 r">field</span> <b>in</b> <span class="r344 r">type</span>.<span class="i">GetFields</span>(<span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">NonPublic</span>))
            {
                <b>if</b> (!<span class="r346 r">field</span>.<span class="i">IsInitOnly</span>)
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <span class="c">// If all fields are init-only (read-only), then the value type is immutable.</span>
            <b>return</b> <b>false</b>;
        }
 
        <b>private static readonly</b> <span class="i">ConcurrentDictionary</span>&lt;<span class="i">Type</span>, <b>bool</b>&gt; <a id="88e1d080aa39e436" href="../../../R/88e1d080aa39e436.html" target="n" data-glyph="46,1" class="i field">s_mutableValueTypesWithInstanceMembers</a> =
            <b>new</b> <span class="i">ConcurrentDictionary</span>&lt;<span class="i">Type</span>, <b>bool</b>&gt;();
 
        <b>internal static void</b> <a id="4469aa3e53b4fb7c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">NoteTypeHasInstanceMemberOrTypeName</a>(<span class="i">Type</span> <span id="r347 rd" class="r347 r">type</span>)
        {
            <b>if</b> (!<span class="r347 r">type</span>.<span class="i">IsValueType</span> || !<a href="#b9a42c6bddbe3a42" class="i method">IsValueTypeMutable</a>(<span class="r347 r">type</span>))
            {
                <b>return</b>;
            }
 
            <b>if</b> (<a href="#88e1d080aa39e436" class="i field">s_mutableValueTypesWithInstanceMembers</a>.<span class="i">TryAdd</span>(<span class="r347 r">type</span>, <b>true</b>))
            {
                <a href="#6375ed9a6bada9ef" class="i field">s_mutableValueWithInstanceMemberVersion</a> += 1;
            }
        }
 
        <b>internal static object</b> <a id="0d73892a647cc9ce" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CopyInstanceMembersOfValueType</a>&lt;<span id="r348 rd t" class="r348 r t">T</span>&gt;(<span class="r348 r t">T</span> <span id="r349 rd" class="r349 r">t</span>, <b>object</b> <span id="r350 rd" class="r350 r">boxedT</span>) <b>where</b> <span class="r348 r t">T</span> : <b>struct</b>
        {
            <a href="../../MshMemberInfo.cs.html#d9b894a5fd752b79" class="t t">PSMemberInfoInternalCollection</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt; <span id="r351 rd" class="r351 r">unused1</span>;
            <a href="../../TypeTable.cs.html#d34ed619706e31fc" class="t t">ConsolidatedString</a> <span id="r352 rd" class="r352 r">unused2</span>;
            <b>if</b> (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#364e445adfd28491" class="i method">HasInstanceMembers</a>(<span class="r350 r">boxedT</span>, <b>out</b> <span class="r351 r">unused1</span>) || <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#05391b9ab0d48975" class="i method">HasInstanceTypeName</a>(<span class="r350 r">boxedT</span>, <b>out</b> <span class="r352 r">unused2</span>))
            {
                <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r353 rd" class="r353 r">psobj</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r350 r">boxedT</span>);
                <b>return</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r353 r">psobj</span>.<a href="../../MshObject.cs.html#31124c1d85456adb" class="i method">Copy</a>());
            }
 
            <span class="c">// We want a copy (because the value type is mutable), so return t, not boxedT.</span>
            <b>return</b> <span class="r349 r">t</span>;
        }
 
        <b>internal static</b> <span class="i">BindingRestrictions</span> <a id="50936c2e0f205741" href="../../../R/50936c2e0f205741.html" target="n" data-glyph="74,1" class="i method">GetVersionCheck</a>(<b>int</b> <span id="r354 rd" class="r354 r">expectedVersionNumber</span>)
        {
            <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                <span class="i">Expression</span>.<span class="i">Equal</span>(<span class="i">Expression</span>.<span class="i">Field</span>(<b>null</b>, <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#57bb460934ceda52" class="i field">PSVariableAssignmentBinder__mutableValueWithInstanceMemberVersion</a>),
                                 <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(<span class="r354 r">expectedVersionNumber</span>)));
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> PowerShell non-standard language binders
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Standard binders
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The binder for common binary operators.  PowerShell specific binary operators are handled elsewhere.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="7b0e984617ab5e15" href="../../../R/7b0e984617ab5e15.html" target="n" data-glyph="2,0" class="t t">PSBinaryOperationBinder</a> : <span class="i">BinaryOperationBinder</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors and factory methods
 
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">ExpressionType</span>, <b>bool</b>, <b>bool</b>&gt;, <a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a>&gt; <a id="6994f00e40d08c27" href="../../../R/6994f00e40d08c27.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> =
            <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">ExpressionType</span>, <b>bool</b>, <b>bool</b>&gt;, <a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a>&gt;();
 
        <b>internal static</b> <a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a> <a id="0adc292a0fe88585" href="../../../R/0adc292a0fe88585.html" target="n" data-glyph="74,1" class="i method">Get</a>(<span class="i">ExpressionType</span> <span id="r355 rd" class="r355 r">operation</span>, <b>bool</b> <span id="r356 rd" class="r356 r">ignoreCase</span> = <b>true</b>, <b>bool</b> <span id="r357 rd" class="r357 r">scalarCompare</span> = <b>false</b>)
        {
            <a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a> <span id="r358 rd" class="r358 r">result</span>;
            <b>lock</b> (<a href="#6994f00e40d08c27" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r359 rd" class="r359 r">key</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r355 r">operation</span>, <span class="r356 r">ignoreCase</span>, <span class="r357 r">scalarCompare</span>);
                <b>if</b> (!<a href="#6994f00e40d08c27" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r359 r">key</span>, <b>out</b> <span class="r358 r">result</span>))
                {
                    <span class="r358 r">result</span> = <b>new</b> <a href="#5e1a92810e875e39" class="t constructor">PSBinaryOperationBinder</a>(<span class="r355 r">operation</span>, <span class="r356 r">ignoreCase</span>, <span class="r357 r">scalarCompare</span>);
                    <a href="#6994f00e40d08c27" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r359 r">key</span>, <span class="r358 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r358 r">result</span>;
        }
 
        <b>private readonly bool</b> <a id="7ca32ee40c575f72" href="../../../R/7ca32ee40c575f72.html" target="n" data-glyph="46,1" class="i field">_ignoreCase</a>;
        <b>private readonly bool</b> <a id="833f3087d50e9916" href="../../../R/833f3087d50e9916.html" target="n" data-glyph="46,1" class="i field">_scalarCompare</a>;
        <b>internal int</b> <a id="3e31a789692f9740" href="../../../R/3e31a789692f9740.html" target="n" data-glyph="44,1" class="i field">_version</a>;
 
        <b>private</b> <a id="5e1a92810e875e39" href="../../../R/5e1a92810e875e39.html" target="n" data-glyph="76,1" class="t constructor">PSBinaryOperationBinder</a>(<span class="i">ExpressionType</span> <span id="r360 rd" class="r360 r">operation</span>, <b>bool</b> <span id="r361 rd" class="r361 r">ignoreCase</span>, <b>bool</b> <span id="r362 rd" class="r362 r">scalarCompare</span>)
            : <b>base</b>(<span class="r360 r">operation</span>)
        {
            <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a> = <span class="r361 r">ignoreCase</span>;
            <a href="#833f3087d50e9916" class="i field">_scalarCompare</a> = <span class="r362 r">scalarCompare</span>;
            <a href="#7b0e984617ab5e15" class="k">this</a>.<a href="#3e31a789692f9740" class="i field">_version</a> = 0;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Constructors and factory methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Delegates for enumerable comparisons
 
        <b>private</b> <span class="i">Func</span>&lt;<b>object</b>, <b>object</b>, <b>bool</b>&gt; <a id="ea2b748f88733176" href="../../../R/ea2b748f88733176.html" target="n" data-glyph="46,1" class="i field">_compareDelegate</a>;
 
        <b>private</b> <span class="i">Func</span>&lt;<b>object</b>, <b>object</b>, <b>bool</b>&gt; <a id="9345e572d74a99ae" href="../../../R/9345e572d74a99ae.html" target="n" data-glyph="76,1" class="i method">GetScalarCompareDelegate</a>()
        {
            <b>if</b> (<a href="#ea2b748f88733176" class="i field">_compareDelegate</a> == <b>null</b>)
            {
                <b>var</b> <span id="r363 rd" class="r363 r">lvalExpr</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>object</b>), <span class="s">&quot;lval&quot;</span>);
                <b>var</b> <span id="r364 rd" class="r364 r">rvalExpr</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>object</b>), <span class="s">&quot;rval&quot;</span>);
 
                <b>var</b> <span id="r365 rd" class="r365 r">compareDelegate</span> = <span class="i">Expression</span>.<span class="i">Lambda</span>&lt;<span class="i">Func</span>&lt;<b>object</b>, <b>object</b>, <b>bool</b>&gt;&gt;(
                    <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<span class="i">Get</span>(<span class="i">Operation</span>, <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a>, <span class="i">scalarCompare</span>: <b>true</b>),
                                              <b>typeof</b>(<b>object</b>), <span class="r363 r">lvalExpr</span>, <span class="r364 r">rvalExpr</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>bool</b>)),
                    <span class="r363 r">lvalExpr</span>, <span class="r364 r">rvalExpr</span>).<span class="i">Compile</span>();
                <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#ea2b748f88733176" class="i field">_compareDelegate</a>, <span class="r365 r">compareDelegate</span>, <b>null</b>);
            }
 
            <b>return</b> <a href="#ea2b748f88733176" class="i field">_compareDelegate</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Delegates for enumerable comparisons
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="5c63288488a891a4" href="../../../R/5c63288488a891a4.html" target="n" data-glyph="72,1" class="i method">FallbackBinaryOperation</a>(<span class="i">DynamicMetaObject</span> <span id="r366 rd" class="r366 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r367 rd" class="r367 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r368 rd" class="r368 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r366 r">target</span>.<span class="i">HasValue</span> || !<span class="r367 r">arg</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
            }
 
            <b>if</b> ((<span class="r366 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r366 r">target</span>.<span class="i">Value</span>) != <span class="r366 r">target</span>.<span class="i">Value</span>) ||
                     (<span class="r367 r">arg</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r367 r">arg</span>.<span class="i">Value</span>) != <span class="r367 r">arg</span>.<span class="i">Value</span>))
            {
                <span class="c">// When adding to an array, we don&#39;t want to unwrap the RHS - it&#39;s unnecessary,</span>
                <span class="c">// and in the case of strings, we actually lose instance members on the PSObject.</span>
                <b>if</b> (!(<span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Add</span> &amp;&amp; <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r366 r">target</span>) != <b>null</b>))
                {
                    <span class="c">// Defer when the object is wrapped, but not for empty objects.</span>
                    <b>return</b> <a href="#7b0e984617ab5e15" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                }
            }
 
            <b>switch</b> (<span class="i">Operation</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Add</span>:
                    <b>return</b> <a href="#1dd1b01db0c29968" class="i method">BinaryAdd</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Subtract</span>:
                    <b>return</b> <a href="#11d353f8c22b296c" class="i method">BinarySub</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Multiply</span>:
                    <b>return</b> <a href="#078af314cae7cff6" class="i method">BinaryMultiply</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Divide</span>:
                    <b>return</b> <a href="#dcfd05d9e2525821" class="i method">BinaryDivide</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Modulo</span>:
                    <b>return</b> <a href="#01069711d1d8b1dd" class="i method">BinaryRemainder</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">And</span>:
                    <b>return</b> <a href="#e87973141f9855ef" class="i method">BinaryBitwiseAnd</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Or</span>:
                    <b>return</b> <a href="#9f9a64b413ee1e22" class="i method">BinaryBitwiseOr</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ExclusiveOr</span>:
                    <b>return</b> <a href="#30c775b76e636749" class="i method">BinaryBitwiseXor</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Equal</span>:
                    <b>return</b> <a href="#31b0f4e419eb95b8" class="i method">CompareEQ</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>:
                    <b>return</b> <a href="#fdf1386adc984007" class="i method">CompareNE</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThan</span>:
                    <b>return</b> <a href="#1e29873bb7144378" class="i method">CompareGT</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span>:
                    <b>return</b> <a href="#4ec9838ae4243d8f" class="i method">CompareGE</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThan</span>:
                    <b>return</b> <a href="#31d921be32b4a603" class="i method">CompareLT</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>:
                    <b>return</b> <a href="#d7850b7184a03ee6" class="i method">CompareLE</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LeftShift</span>:
                    <b>return</b> <a href="#8afd7b061904fc00" class="i method">LeftShift</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">RightShift</span>:
                    <b>return</b> <a href="#b9edb9c295f04726" class="i method">RightShift</a>(<span class="r366 r">target</span>, <span class="r367 r">arg</span>, <span class="r368 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
            }
 
            <b>return</b> (<span class="r368 r">errorSuggestion</span> ??
                    <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">CreateThrow</span>(<b>typeof</b>(<b>object</b>), <b>typeof</b>(<a href="../../../utils/MshNotImplementedException.cs.html#ddab2b46a60907f3" class="t t">PSNotImplementedException</a>), <span class="s">&quot;Unimplemented operation&quot;</span>),
                        <span class="r366 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r367 r">arg</span>))).<span class="i">WriteToDebugLog</span>(<a href="#7b0e984617ab5e15" class="k">this</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helpers
 
        <b>public override string</b> <a id="928b2f8a853412ff" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;PSBinaryOperationBinder {0}{1} ver:{2}&quot;</span>, <a href="#0a3e00ae2f31f885" class="i method">GetOperatorText</a>(), <a href="#833f3087d50e9916" class="i field">_scalarCompare</a> ? <span class="s">&quot; scalarOnly&quot;</span> : <b>string</b>.<span class="i">Empty</span>, <a href="#3e31a789692f9740" class="i field">_version</a>);
        }
 
        <b>internal static void</b> <a id="b0329a67974161ce" href="../../../R/b0329a67974161ce.html" target="n" data-glyph="74,1" class="i method">InvalidateCache</a>()
        {
            <span class="c">// Invalidate binders</span>
            <b>lock</b> (<a href="#6994f00e40d08c27" class="i field">s_binderCache</a>)
            {
                <b>foreach</b> (<a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a> <span id="r369 rd" class="r369 r">binder</span> <b>in</b> <a href="#6994f00e40d08c27" class="i field">s_binderCache</a>.<span class="i">Values</span>)
                {
                    <span class="r369 r">binder</span>.<a href="#3e31a789692f9740" class="i field">_version</a> += 1;
                }
            }
        }
 
        <b>private string</b> <a id="0a3e00ae2f31f885" href="../../../R/0a3e00ae2f31f885.html" target="n" data-glyph="76,1" class="i method">GetOperatorText</a>()
        {
            <b>switch</b> (<span class="i">Operation</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Add</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#28a6ab38fe6894ea" class="i field">Plus</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Subtract</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#069476ae2e7b4442" class="i field">Minus</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Multiply</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#79806bba953290ee" class="i field">Multiply</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Divide</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#3173796303cdf797" class="i field">Divide</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Modulo</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#b338c928ef07e8ea" class="i field">Rem</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">And</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#742ab03d28efc2a6" class="i field">Band</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Or</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#9bd33d529c1d4993" class="i field">Bor</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">ExclusiveOr</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#c6229e7399dcf894" class="i field">Bxor</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Equal</span>: <b>return</b> <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a> ? <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#654217947abd11a4" class="i field">Ieq</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#e5bb5a7a24d93ebc" class="i field">Ceq</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>: <b>return</b> <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a> ? <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#82b3fc4a021370b1" class="i field">Ine</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#04b70e3eaa61d27e" class="i field">Cne</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThan</span>: <b>return</b> <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a> ? <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#6c26f085506e329b" class="i field">Igt</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#a58601fe1f113b12" class="i field">Cgt</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span>: <b>return</b> <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a> ? <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#6fefd865f09cf1a8" class="i field">Ige</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#bc8ca8ef43bf7b4f" class="i field">Cge</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThan</span>: <b>return</b> <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a> ? <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#371ecc3ecbaec392" class="i field">Ilt</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#47f2fc75e6daef97" class="i field">Clt</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>: <b>return</b> <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a> ? <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#796d7079962597d7" class="i field">Ile</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>() : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#8740d4da8d485dad" class="i field">Cle</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LeftShift</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#683bd53c88e0d334" class="i field">Shl</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">RightShift</span>: <b>return</b> <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#b807b1f385cda6bc" class="i field">Shr</a>.<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>();
            }
 
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Unexpected operator&quot;</span>);
            <b>return</b> <b>string</b>.<span class="i">Empty</span>;
        }
 
        <b>private static</b> <span class="i">DynamicMetaObject</span> <a id="145910289c0dee1c" href="../../../R/145910289c0dee1c.html" target="n" data-glyph="76,1" class="i method">CallImplicitOp</a>(<b>string</b> <span id="r370 rd" class="r370 r">methodName</span>, <span class="i">DynamicMetaObject</span> <span id="r371 rd" class="r371 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r372 rd" class="r372 r">arg</span>, <b>string</b> <span id="r373 rd" class="r373 r">errorOperator</span>, <span class="i">DynamicMetaObject</span> <span id="r374 rd" class="r374 r">errorSuggestion</span>)
        {
            <span class="c">// We will assume that if we got here with a non-null errorSuggestion and DynamicObject, that we</span>
            <span class="c">// are trying to generate the expression that calls the override to DynamicObject.TryBinaryOperation.</span>
            <span class="c">// We get called twice for the same target object, once with a null errorSuggestion (in which case we&#39;ll have</span>
            <span class="c">// returned the result below), and then a second time with a non-null errorSuggestion, which we return as is.</span>
            <b>if</b> (<span class="r374 r">errorSuggestion</span> != <b>null</b> &amp;&amp; <span class="r371 r">target</span>.<span class="i">Value</span> <b>is</b> <span class="i">DynamicObject</span>)
            {
                <b>return</b> <span class="r374 r">errorSuggestion</span>;
            }
 
            <span class="c">// TODO: use a dynamic call site to invoke the correct method or throw an error.</span>
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#412cbd6e2de9069f" class="i field">ParserOps_ImplicitOp</a>,
                                <span class="r371 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                <span class="r372 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r370 r">methodName</span>),
                                <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#635c2cd971f6dfae" class="i field">NullExtent</a>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r373 r">errorOperator</span>)),
                <span class="r371 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r372 r">arg</span>));
        }
 
        <b>private static bool</b> <a id="944a8743f08e5afa" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsValueNegative</a>(<b>object</b> <span id="r375 rd" class="r375 r">value</span>, <span class="i">TypeCode</span> <span id="r376 rd" class="r376 r">typeCode</span>)
        {
            <b>switch</b> (<span class="r376 r">typeCode</span>)
            {
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">SByte</span>: <b>return</b> (<b>sbyte</b>)<span class="r375 r">value</span> &lt; 0;
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int16</span>: <b>return</b> (<b>short</b>)<span class="r375 r">value</span> &lt; 0;
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int32</span>: <b>return</b> (<b>int</b>)<span class="r375 r">value</span> &lt; 0;
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int64</span>: <b>return</b> (<b>long</b>)<span class="r375 r">value</span> &lt; 0;
            }
 
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Invalid type code for testing negative value&quot;</span>);
            <b>return</b> <b>true</b>;
        }
 
        <b>private static</b> <span class="i">Expression</span> <a id="b983f26d78948d84" href="../../../R/b983f26d78948d84.html" target="n" data-glyph="76,1" class="i method">TypedZero</a>(<span class="i">TypeCode</span> <span id="r377 rd" class="r377 r">typeCode</span>)
        {
            <b>switch</b> (<span class="r377 r">typeCode</span>)
            {
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">SByte</span>: <b>return</b> <span class="i">Expression</span>.<span class="i">Constant</span>((<b>sbyte</b>)0);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int16</span>: <b>return</b> <span class="i">Expression</span>.<span class="i">Constant</span>((<b>short</b>)0);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int32</span>: <b>return</b> <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0);
                <b>case</b> <span class="i">TypeCode</span>.<span class="i">Int64</span>: <b>return</b> <span class="i">Expression</span>.<span class="i">Constant</span>((<b>long</b>)0);
            }
 
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Invalid type code for testing negative value&quot;</span>);
            <b>return</b> <b>null</b>;
        }
 
        <b>private static</b> <span class="i">DynamicMetaObject</span> <a id="fec01d4211608456" href="../../../R/fec01d4211608456.html" target="n" data-glyph="76,1" class="i method">FigureSignedUnsignedInt</a>(<span class="i">DynamicMetaObject</span> <span id="r378 rd" class="r378 r">obj</span>, <span class="i">TypeCode</span> <span id="r379 rd" class="r379 r">typeCode</span>, <span class="i">TypeCode</span> <span id="r380 rd" class="r380 r">currentOpType</span>, <b>out</b> <span class="i">Type</span> <span id="r381 rd" class="r381 r">opImplType</span>, <b>out</b> <span class="i">Type</span> <span id="r382 rd" class="r382 r">argType</span>, <b>out bool</b> <span id="r383 rd" class="r383 r">shouldFallbackToDoubleInCaseOfOverflow</span>)
        {
            <span class="r381 r">opImplType</span> = <b>null</b>;
            <span class="r382 r">argType</span> = <b>null</b>;
            <span class="r383 r">shouldFallbackToDoubleInCaseOfOverflow</span> = <b>false</b>;
 
            <b>if</b> (<span class="i">IsValueNegative</span>(<span class="r378 r">obj</span>.<span class="i">Value</span>, <span class="r379 r">typeCode</span>))
            {
                <b>switch</b> (<span class="r380 r">currentOpType</span>)
                {
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt32</span>:
                        <span class="r381 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#c18bdb3842a92bee" class="t t">LongOps</a>);
                        <span class="r382 r">argType</span> = <b>typeof</b>(<b>long</b>);
                        <b>break</b>;
                    <b>case</b> <span class="i">TypeCode</span>.<span class="i">UInt64</span>:
                        <span class="r381 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#35bf15895a6ae802" class="t t">DecimalOps</a>);
                        <span class="r382 r">argType</span> = <b>typeof</b>(<b>decimal</b>);
                        <span class="c">// multiply operation may overflow within the [decimal] context, i.e. [int64]::minvalue * [uint64]::maxvalue.</span>
                        <span class="c">// if overflow happens, we fallback to the [double] context</span>
                        <span class="r383 r">shouldFallbackToDoubleInCaseOfOverflow</span> = <b>true</b>;
                        <b>break</b>;
 
                    <b>default</b>:
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Need to figure out opImplType only for UIn32 and UInt64&quot;</span>);
                        <b>break</b>;
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r378 r">obj</span>.<span class="i">Expression</span>,
                    <span class="r378 r">obj</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()
                        .<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                            <span class="i">Expression</span>.<span class="i">LessThan</span>(<span class="r378 r">obj</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r378 r">obj</span>.<span class="i">LimitType</span>), <a href="#b983f26d78948d84" class="i method">TypedZero</a>(<span class="r379 r">typeCode</span>)))),
                    <span class="r378 r">obj</span>.<span class="i">Value</span>);
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="r378 r">obj</span>.<span class="i">Expression</span>,
                <span class="r378 r">obj</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()
                    .<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">GreaterThanOrEqual</span>(<span class="r378 r">obj</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r378 r">obj</span>.<span class="i">LimitType</span>), <a href="#b983f26d78948d84" class="i method">TypedZero</a>(<span class="r379 r">typeCode</span>)))),
                <span class="r378 r">obj</span>.<span class="i">Value</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="0aa42430fd87a3f2" href="../../../R/0aa42430fd87a3f2.html" target="n" data-glyph="76,1" class="i method">BinaryNumericOp</a>(<b>string</b> <span id="r384 rd" class="r384 r">methodName</span>, <span class="i">DynamicMetaObject</span> <span id="r385 rd" class="r385 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r386 rd" class="r386 r">arg</span>)
        {
            <span class="c">// The type code comparison and the code generated by this routine only supports primitive types</span>
            <span class="c">// for both operands.</span>
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r385 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumericOrPrimitive</span>() &amp;&amp; <span class="r386 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsNumericOrPrimitive</span>(),
                               <span class="s">&quot;numeric ops are only supported with primitive types&quot;</span>);
 
            <span class="i">Type</span> <span id="r387 rd" class="r387 r">opImplType</span> = <b>null</b>, <span id="r388 rd" class="r388 r">argType</span> = <b>null</b>;
            <b>bool</b> <span id="r389 rd" class="r389 r">fallbackToDoubleInCaseOfOverflow</span> = <b>false</b>;
 
            <span class="i">TypeCode</span> <span id="r390 rd" class="r390 r">leftTypeCode</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetTypeCode</span>(<span class="r385 r">target</span>.<span class="i">LimitType</span>);
            <span class="i">TypeCode</span> <span id="r391 rd" class="r391 r">rightTypeCode</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetTypeCode</span>(<span class="r386 r">arg</span>.<span class="i">LimitType</span>);
            <span class="i">TypeCode</span> <span id="r392 rd" class="r392 r">opTypeCode</span> = (<b>int</b>)<span class="r390 r">leftTypeCode</span> &gt;= (<b>int</b>)<span class="r391 r">rightTypeCode</span> ? <span class="r390 r">leftTypeCode</span> : <span class="r391 r">rightTypeCode</span>;
            <b>if</b> ((<b>int</b>)<span class="r392 r">opTypeCode</span> &lt;= (<b>int</b>)<span class="i">TypeCode</span>.<span class="i">Int32</span>)
            {
                <span class="r387 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#b02fae75dda9e4ee" class="t t">IntOps</a>);
                <span class="r388 r">argType</span> = <b>typeof</b>(<b>int</b>);
            }
            <b>else</b> <b>if</b> ((<b>int</b>)<span class="r392 r">opTypeCode</span> &lt;= (<b>int</b>)<span class="i">TypeCode</span>.<span class="i">UInt32</span>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r392 r">opTypeCode</span> == <span class="i">TypeCode</span>.<span class="i">UInt32</span>, <span class="s">&quot;opType must be UInt32 if it gets in this code path&quot;</span>);
 
                <span class="c">// If one of the operands is signed, we need to promote to long if the value is negative, but</span>
                <span class="c">// we can stay w/ an integer if the value is positive.  Either way, we&#39;ll need a type test.</span>
                <b>if</b> (<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#aabe01c3319c6528" class="i method">IsSignedInteger</a>(<span class="r390 r">leftTypeCode</span>))
                {
                    <span class="r385 r">target</span> = <a href="#fec01d4211608456" class="i method">FigureSignedUnsignedInt</a>(<span class="r385 r">target</span>, <span class="r390 r">leftTypeCode</span>, <span class="r392 r">opTypeCode</span>, <b>out</b> <span class="r387 r">opImplType</span>, <b>out</b> <span class="r388 r">argType</span>, <b>out</b> <span class="r389 r">fallbackToDoubleInCaseOfOverflow</span>);
                }
                <b>else</b> <b>if</b> (<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#aabe01c3319c6528" class="i method">IsSignedInteger</a>(<span class="r391 r">rightTypeCode</span>))
                {
                    <span class="r386 r">arg</span> = <a href="#fec01d4211608456" class="i method">FigureSignedUnsignedInt</a>(<span class="r386 r">arg</span>, <span class="r391 r">rightTypeCode</span>, <span class="r392 r">opTypeCode</span>, <b>out</b> <span class="r387 r">opImplType</span>, <b>out</b> <span class="r388 r">argType</span>, <b>out</b> <span class="r389 r">fallbackToDoubleInCaseOfOverflow</span>);
                }
 
                <b>if</b> (<span class="r387 r">opImplType</span> == <b>null</b>)
                {
                    <span class="r387 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#d676a7b10ccdb747" class="t t">UIntOps</a>);
                    <span class="r388 r">argType</span> = <b>typeof</b>(<b>uint</b>);
                }
            }
            <b>else</b> <b>if</b> ((<b>int</b>)<span class="r392 r">opTypeCode</span> &lt;= (<b>int</b>)<span class="i">TypeCode</span>.<span class="i">Int64</span>)
            {
                <span class="r387 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#c18bdb3842a92bee" class="t t">LongOps</a>);
                <span class="r388 r">argType</span> = <b>typeof</b>(<b>long</b>);
            }
            <b>else</b> <b>if</b> ((<b>int</b>)<span class="r392 r">opTypeCode</span> &lt;= (<b>int</b>)<span class="i">TypeCode</span>.<span class="i">UInt64</span>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r392 r">opTypeCode</span> == <span class="i">TypeCode</span>.<span class="i">UInt64</span>, <span class="s">&quot;opType must be UInt64 if it gets in this code path&quot;</span>);
 
                <b>if</b> (<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#aabe01c3319c6528" class="i method">IsSignedInteger</a>(<span class="r390 r">leftTypeCode</span>))
                {
                    <span class="r385 r">target</span> = <a href="#fec01d4211608456" class="i method">FigureSignedUnsignedInt</a>(<span class="r385 r">target</span>, <span class="r390 r">leftTypeCode</span>, <span class="r392 r">opTypeCode</span>, <b>out</b> <span class="r387 r">opImplType</span>, <b>out</b> <span class="r388 r">argType</span>, <b>out</b> <span class="r389 r">fallbackToDoubleInCaseOfOverflow</span>);
                }
                <b>else</b> <b>if</b> (<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#aabe01c3319c6528" class="i method">IsSignedInteger</a>(<span class="r391 r">rightTypeCode</span>))
                {
                    <span class="r386 r">arg</span> = <a href="#fec01d4211608456" class="i method">FigureSignedUnsignedInt</a>(<span class="r386 r">arg</span>, <span class="r391 r">rightTypeCode</span>, <span class="r392 r">opTypeCode</span>, <b>out</b> <span class="r387 r">opImplType</span>, <b>out</b> <span class="r388 r">argType</span>, <b>out</b> <span class="r389 r">fallbackToDoubleInCaseOfOverflow</span>);
                }
 
                <b>if</b> (<span class="r387 r">opImplType</span> == <b>null</b>)
                {
                    <span class="r387 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#80ae949a3560c488" class="t t">ULongOps</a>);
                    <span class="r388 r">argType</span> = <b>typeof</b>(<b>ulong</b>);
                }
            }
            <b>else</b> <b>if</b> (<span class="r392 r">opTypeCode</span> == <span class="i">TypeCode</span>.<span class="i">Decimal</span>)
            {
                <b>if</b> (<span class="r384 r">methodName</span>.<span class="i">StartsWith</span>(<span class="s">&quot;Compare&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <span class="c">// Casting a double to decimal can overflow.  Instead, we are &quot;smarter&quot; and avoid</span>
                    <span class="c">// the cast, and allow the comparison.  There may be a precision problem with values</span>
                    <span class="c">// near Decimal.MaxValue or Decimal.MinValue, but V2 allowed the comparisons</span>
                    <span class="c">// w/o errors, so we continue to do so.</span>
                    <b>if</b> (<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#f62e8d50a4f37169" class="i method">IsFloating</a>(<span class="r390 r">leftTypeCode</span>))
                    {
                        <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<b>typeof</b>(<a href="../Operations/NumericOps.cs.html#35bf15895a6ae802" class="t t">DecimalOps</a>).<span class="i">GetMethod</span>(<span class="r384 r">methodName</span> + <span class="s">&quot;1&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Static</span>),
                                            <span class="r385 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r385 r">target</span>.<span class="i">LimitType</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>double</b>)),
                                            <span class="r386 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r386 r">arg</span>.<span class="i">LimitType</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>decimal</b>))),
                            <span class="r385 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r386 r">arg</span>));
                    }
 
                    <b>if</b> (<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#f62e8d50a4f37169" class="i method">IsFloating</a>(<span class="r391 r">rightTypeCode</span>))
                    {
                        <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<b>typeof</b>(<a href="../Operations/NumericOps.cs.html#35bf15895a6ae802" class="t t">DecimalOps</a>).<span class="i">GetMethod</span>(<span class="r384 r">methodName</span> + <span class="s">&quot;2&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Static</span>),
                                            <span class="r385 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r385 r">target</span>.<span class="i">LimitType</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>decimal</b>)),
                                            <span class="r386 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r386 r">arg</span>.<span class="i">LimitType</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>double</b>))),
                            <span class="r385 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r386 r">arg</span>));
                    }
                }
 
                <span class="r387 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#35bf15895a6ae802" class="t t">DecimalOps</a>);
                <span class="r388 r">argType</span> = <b>typeof</b>(<b>decimal</b>);
            }
            <b>else</b>
            {
                <span class="r387 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#7042765bb70c6592" class="t t">DoubleOps</a>);
                <span class="r388 r">argType</span> = <b>typeof</b>(<b>double</b>);
            }
 
            <span class="i">Expression</span> <span id="r393 rd" class="r393 r">expr</span> =
                <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r387 r">opImplType</span>.<span class="i">GetMethod</span>(<span class="r384 r">methodName</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Static</span>),
                                <span class="r385 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r385 r">target</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#664379b8310751e4" class="i method">Cast</a>(<span class="r388 r">argType</span>),
                                <span class="r386 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r386 r">arg</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#664379b8310751e4" class="i method">Cast</a>(<span class="r388 r">argType</span>));
 
            <b>if</b> (<span class="r389 r">fallbackToDoubleInCaseOfOverflow</span>)
            {
                <span class="i">Type</span> <span id="r394 rd" class="r394 r">doubleOpType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#7042765bb70c6592" class="t t">DoubleOps</a>);
                <span class="i">Type</span> <span id="r395 rd" class="r395 r">doubleArgType</span> = <b>typeof</b>(<b>double</b>);
                <span class="i">Expression</span> <span id="r396 rd" class="r396 r">fallbackToDoubleExpr</span> =
                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r394 r">doubleOpType</span>.<span class="i">GetMethod</span>(<span class="r384 r">methodName</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Static</span>),
                                <span class="r385 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r385 r">target</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#664379b8310751e4" class="i method">Cast</a>(<span class="r395 r">doubleArgType</span>),
                                <span class="r386 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r386 r">arg</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#664379b8310751e4" class="i method">Cast</a>(<span class="r395 r">doubleArgType</span>));
 
                <b>var</b> <span id="r397 rd" class="r397 r">exception</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <span class="s">&quot;psBinaryNumericOpException&quot;</span>);
                <b>var</b> <span id="r398 rd" class="r398 r">catchExpr</span> =
                    <span class="i">Expression</span>.<span class="i">Catch</span>(
                        <span class="r397 r">exception</span>,
                        <span class="i">Expression</span>.<span class="i">Block</span>(
                            <span class="i">Expression</span>.<span class="i">IfThen</span>(
                                <span class="i">Expression</span>.<span class="i">Not</span>(<span class="i">Expression</span>.<span class="i">TypeIs</span>(<span class="i">Expression</span>.<span class="i">Property</span>(<span class="r397 r">exception</span>, <span class="s">&quot;InnerException&quot;</span>), <b>typeof</b>(<span class="i">OverflowException</span>))),
                                <span class="i">Expression</span>.<span class="i">Rethrow</span>()),
                            <span class="r396 r">fallbackToDoubleExpr</span>)
                        );
 
                <span class="r393 r">expr</span> = <span class="i">Expression</span>.<span class="i">TryCatch</span>(
                           <span class="r393 r">expr</span>,
                           <span class="r398 r">catchExpr</span>);
            }
 
            <b>if</b> (<span class="r385 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>)
            {
                <span class="c">// Make sure the result type is an enum unless we were expecting a bool.</span>
                <b>switch</b> (<span class="i">Operation</span>)
                {
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Equal</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThan</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThan</span>:
                    <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>:
                        <b>break</b>;
                    <b>default</b>:
                        <span class="r393 r">expr</span> = <span class="r393 r">expr</span>.<span class="i">Cast</span>(<span class="r385 r">target</span>.<span class="i">LimitType</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                        <b>break</b>;
                }
            }
 
            <b>if</b> (<span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Equal</span> || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>)
            {
                <span class="r393 r">expr</span> = <span class="i">Expression</span>.<span class="i">TryCatch</span>(<span class="r393 r">expr</span>,
                    <span class="i">Expression</span>.<span class="i">Catch</span>(<b>typeof</b>(<span class="i">InvalidCastException</span>),
                                     <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Equal</span> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a> : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>));
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r393 r">expr</span>, <span class="r385 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r386 r">arg</span>));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="19580eb62c67ad22" href="../../../R/19580eb62c67ad22.html" target="n" data-glyph="76,1" class="i method">BinaryNumericStringOp</a>(<span class="i">DynamicMetaObject</span> <span id="r399 rd" class="r399 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r400 rd" class="r400 r">arg</span>)
        {
            <span class="c">// We can&#39;t determine the operation type at compile time, we&#39;ll need another dynamic site</span>
            <span class="c">// Generate:</span>
            <span class="c">//     tmp = Parser.ScanNumber(arg)</span>
            <span class="c">//     if (tmp == null) { throw new RuntimeError(&quot;BadNumericConstant&quot;) }</span>
            <span class="c">//     dynamic op target tmp</span>
            <span class="c">// For equality comparison operators, if the conversion fails, we shouldn&#39;t raise</span>
            <span class="c">// an exception, so those must be wrapped in try/catch, like:</span>
            <span class="c">//     try { /* as above */ }</span>
            <span class="c">//     catch (InvalidCastException) { true or false (depending on Operation type) }</span>
 
            <span class="i">List</span>&lt;<span class="i">ParameterExpression</span>&gt; <span id="r401 rd" class="r401 r">temps</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">ParameterExpression</span>&gt;();
            <span class="i">List</span>&lt;<span class="i">Expression</span>&gt; <span id="r402 rd" class="r402 r">stmts</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">Expression</span>&gt;();
            <span class="i">Expression</span> <span id="r403 rd" class="r403 r">targetExpr</span> = <span class="r399 r">target</span>.<span class="i">Expression</span>;
            <b>if</b> (<span class="r399 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(
                    <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Subtract</span> || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Divide</span>
                    || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Modulo</span> || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">And</span>
                    || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Or</span> || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">ExclusiveOr</span>
                    || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">LeftShift</span> || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">RightShift</span>,
                    <span class="s">&quot;string lhs not allowed for operation&quot;</span>);
 
                <span class="r403 r">targetExpr</span> = <span class="i">ConvertStringToNumber</span>(<span class="r399 r">target</span>.<span class="i">Expression</span>, <span class="r400 r">arg</span>.<span class="i">LimitType</span>);
            }
 
            <b>var</b> <span id="r404 rd" class="r404 r">argExpr</span> = <span class="r400 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>) ? <span class="i">ConvertStringToNumber</span>(<span class="r400 r">arg</span>.<span class="i">Expression</span>, <span class="r399 r">target</span>.<span class="i">LimitType</span>) : <span class="r400 r">arg</span>.<span class="i">Expression</span>;
 
            <span class="r402 r">stmts</span>.<span class="i">Add</span>(
                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a>.<span class="i">Get</span>(<span class="i">Operation</span>), <b>typeof</b>(<b>object</b>), <span class="r403 r">targetExpr</span>, <span class="r404 r">argExpr</span>));
 
            <span class="i">Expression</span> <span id="r405 rd" class="r405 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(<span class="r401 r">temps</span>, <span class="r402 r">stmts</span>);
            <b>if</b> (<span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Equal</span> || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>)
            {
                <span class="r405 r">expr</span> = <span class="i">Expression</span>.<span class="i">TryCatch</span>(<span class="r405 r">expr</span>,
                    <span class="i">Expression</span>.<span class="i">Catch</span>(<b>typeof</b>(<span class="i">InvalidCastException</span>),
                                     <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Equal</span> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a> : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>));
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r405 r">expr</span>, <span class="r399 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r400 r">arg</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Use the tokenizer to scan a number and convert it to a number of any type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r406 r">expr</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The expression that refers to a string to be converted to a number of any type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r407 r">toType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Primarily used as part of an error message.  If the string is not a number, we want to raise an exception saying the</span>
        <span class="c">///</span><span class="c"> string can&#39;t be converted to this type.  Note that if the string is a valid number, it need not be this type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Expression</span> <a id="407f430a2373f783" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ConvertStringToNumber</a>(<span class="i">Expression</span> <span id="r406 rd" class="r406 r">expr</span>, <span class="i">Type</span> <span id="r407 rd" class="r407 r">toType</span>)
        {
            <b>if</b> (!<span class="r407 r">toType</span>.<a href="../../../utils/ExtensionMethods.cs.html#303e1935bbd20fd8" class="i method">IsNumeric</a>())
            {
                <span class="c">// toType is only mostly for diagnostics, so it doesn&#39;t need to be correct.  If it&#39;s not numeric, we&#39;re</span>
                <span class="c">// doing something like &quot;42&quot; - &quot;10&quot;, and toType is the type of the &quot;other&quot; operand, in this case, it</span>
                <span class="c">// would string.  Fall back to int if Parser.ScanNumber fails.</span>
                <span class="r407 r">toType</span> = <b>typeof</b>(<b>int</b>);
            }
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Call</span>(
                <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#c86601f53d43c91c" class="i field">Parser_ScanNumber</a>,
                <span class="r406 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>)),
                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r407 r">toType</span>, <b>typeof</b>(<span class="i">Type</span>)),
                <span class="i">Expression</span>.<span class="i">Constant</span>(<b>true</b>));
        }
 
        <b>private static</b> <span class="i">DynamicMetaObject</span> <a id="6a4253ae02824a8d" href="../../../R/6a4253ae02824a8d.html" target="n" data-glyph="76,1" class="i method">GetArgAsNumericOrPrimitive</a>(<span class="i">DynamicMetaObject</span> <span id="r408 rd" class="r408 r">arg</span>, <span class="i">Type</span> <span id="r409 rd" class="r409 r">targetType</span>)
        {
            <b>if</b> (<span class="r408 r">arg</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0), <span class="r408 r">arg</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>(), 0);
            }
 
            <b>bool</b> <span id="r410 rd" class="r410 r">boolToDecimal</span> = <b>false</b>;
            <b>if</b> (<span class="r408 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsNumericOrPrimitive</span>() &amp;&amp; !<span class="r408 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>)
            {
                <b>if</b> (!(<span class="r409 r">targetType</span> == <b>typeof</b>(<b>decimal</b>) &amp;&amp; <span class="r408 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>bool</b>)))
                {
                    <b>return</b> <span class="r408 r">arg</span>;
                }
                <span class="c">// All other numeric conversions are simple casts, but bool=&gt;decimal is not supported by LINQ (via Convert), so</span>
                <span class="c">// we must do the conversion ourselves.</span>
                <span class="r410 r">boolToDecimal</span> = <b>true</b>;
            }
 
            <b>bool</b> <span id="r411 rd" class="r411 r">debase</span>;
 
            <span class="c">// ConstrainedLanguage note - calls to this conversion only target numeric types.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r412 rd" class="r412 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r408 r">arg</span>.<span class="i">Value</span>, <span class="r409 r">targetType</span>, <b>out</b> <span class="r411 r">debase</span>);
            <b>if</b> (<span class="r412 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#16af78347d5ada13" class="i field">ImplicitCast</a> || <span class="r410 r">boolToDecimal</span> || <span class="r408 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r412 r">conversion</span>, <span class="r408 r">arg</span>.<span class="i">Expression</span>, <span class="r409 r">targetType</span>, <span class="r411 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>),
                    <span class="r408 r">arg</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private static</b> <span class="i">Type</span> <a id="4640660d3352e97e" href="../../../R/4640660d3352e97e.html" target="n" data-glyph="76,1" class="i method">GetBitwiseOpType</a>(<span class="i">TypeCode</span> <span id="r413 rd" class="r413 r">opTypeCode</span>)
        {
            <span class="i">Type</span> <span id="r414 rd" class="r414 r">opType</span>;
            <b>if</b> ((<b>int</b>)<span class="r413 r">opTypeCode</span> &lt;= (<b>int</b>)<span class="i">TypeCode</span>.<span class="i">Int32</span>) { <span class="r414 r">opType</span> = <b>typeof</b>(<b>int</b>); }
            <b>else</b> <b>if</b> ((<b>int</b>)<span class="r413 r">opTypeCode</span> &lt;= (<b>int</b>)<span class="i">TypeCode</span>.<span class="i">UInt32</span>) { <span class="r414 r">opType</span> = <b>typeof</b>(<b>uint</b>); }
            <b>else</b> <b>if</b> ((<b>int</b>)<span class="r413 r">opTypeCode</span> &lt;= (<b>int</b>)<span class="i">TypeCode</span>.<span class="i">Int64</span>) { <span class="r414 r">opType</span> = <b>typeof</b>(<b>long</b>); }
            <span class="c">// Because we use unsigned for -bnot, to be consistent, we promote to unsigned here too (-band,-bor,-xor)</span>
            <b>else</b> { <span class="r414 r">opType</span> = <b>typeof</b>(<b>ulong</b>); }
 
            <b>return</b> <span class="r414 r">opType</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Helpers
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> &quot;Arithmetic&quot; operations
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="1dd1b01db0c29968" href="../../../R/1dd1b01db0c29968.html" target="n" data-glyph="76,1" class="i method">BinaryAdd</a>(<span class="i">DynamicMetaObject</span> <span id="r415 rd" class="r415 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r416 rd" class="r416 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r417 rd" class="r417 r">errorSuggestion</span>)
        {
            <b>if</b> (<span class="r415 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r416 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r415 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r416 r">arg</span>));
            }
 
            <b>if</b> (<span class="r415 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumericOrPrimitive</span>() &amp;&amp; <span class="r415 r">target</span>.<span class="i">LimitType</span> != <b>typeof</b>(<b>char</b>))
            {
                <b>var</b> <span id="r418 rd" class="r418 r">numericArg</span> = <span class="i">GetArgAsNumericOrPrimitive</span>(<span class="r416 r">arg</span>, <span class="r415 r">target</span>.<span class="i">LimitType</span>);
                <b>if</b> (<span class="r418 r">numericArg</span> != <b>null</b>)
                {
                    <b>return</b> <a href="#0aa42430fd87a3f2" class="i method">BinaryNumericOp</a>(<span class="s">&quot;Add&quot;</span>, <span class="r415 r">target</span>, <span class="r418 r">numericArg</span>);
                }
 
                <b>if</b> (<span class="r416 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
                {
                    <b>return</b> <a href="#19580eb62c67ad22" class="i method">BinaryNumericStringOp</a>(<span class="r415 r">target</span>, <span class="r416 r">arg</span>);
                }
            }
 
            <span class="i">Expression</span> <span id="r419 rd" class="r419 r">lhsStringExpr</span> = <b>null</b>;
            <b>if</b> (<span class="r415 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <span class="r419 r">lhsStringExpr</span> = <span class="r415 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
            }
            <b>else</b> <b>if</b> (<span class="r415 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>char</b>))
            {
                <span class="r419 r">lhsStringExpr</span> =
                    <span class="i">Expression</span>.<span class="i">New</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#fe72c39073e0fc61" class="i field">String_ctor_char_int</a>,
                                   <span class="r415 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>char</b>)),
                                   <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(1));
            }
 
            <b>if</b> (<span class="r419 r">lhsStringExpr</span> != <b>null</b>)
            {
                <span class="c">// For string concatenation, simply add the 2 strings, possibly converting the rhs first.</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#b233abaa53a3fbb9" class="i field">String_Concat_String</a>,
                                    <span class="r419 r">lhsStringExpr</span>,
                                    <a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<span class="i">InvokeToString</span>(
                                        <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>,
                                        <span class="r416 r">arg</span>.<span class="i">Expression</span>)),
                    <span class="r415 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r416 r">arg</span>));
            }
 
            <b>var</b> <span id="r420 rd" class="r420 r">lhsEnumerator</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r415 r">target</span>);
            <b>if</b> (<span class="r420 r">lhsEnumerator</span> != <b>null</b>)
            {
                <span class="c">// target is enumerable, so we&#39;re creating a new array.</span>
 
                <b>var</b> <span id="r421 rd" class="r421 r">rhsEnumerator</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r416 r">arg</span>);
                <span class="i">Expression</span> <span id="r422 rd" class="r422 r">call</span>;
                <b>if</b> (<span class="r421 r">rhsEnumerator</span> != <b>null</b>)
                {
                    <span class="c">// Adding 2 lists</span>
                    <span class="r422 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#1e41b46b4c87ee53" class="i field">EnumerableOps_AddEnumerable</a>,
                                           <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>,
                                           <span class="r420 r">lhsEnumerator</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IEnumerator</span>)),
                                           <span class="r421 r">rhsEnumerator</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IEnumerator</span>)));
                }
                <b>else</b>
                {
                    <span class="c">// Adding 1 item to a list</span>
                    <span class="r422 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#cd51aa4186c89ac0" class="i field">EnumerableOps_AddObject</a>,
                                           <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>,
                                           <span class="r420 r">lhsEnumerator</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IEnumerator</span>)),
                                           <span class="r416 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r422 r">call</span>, <span class="r415 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r416 r">arg</span>));
            }
 
            <b>if</b> (<span class="r415 r">target</span>.<span class="i">Value</span> <b>is</b> <span class="i">IDictionary</span>)
            {
                <b>if</b> (<span class="r416 r">arg</span>.<span class="i">Value</span> <b>is</b> <span class="i">IDictionary</span>)
                {
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#97a19fdbe3466006" class="i field">HashtableOps_Add</a>,
                                        <span class="r415 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IDictionary</span>)),
                                        <span class="r416 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IDictionary</span>))),
                        <span class="r415 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r416 r">arg</span>));
                }
 
                <b>return</b> <span class="r415 r">target</span>.<span class="i">ThrowRuntimeError</span>(<b>new</b> <span class="i">DynamicMetaObject</span>[] { <span class="r416 r">arg</span> }, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>,
                                                <span class="s">&quot;AddHashTableToNonHashTable&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">AddHashTableToNonHashTable</span>);
            }
 
            <b>return</b> <a href="#145910289c0dee1c" class="i method">CallImplicitOp</a>(<span class="s">&quot;op_Addition&quot;</span>, <span class="r415 r">target</span>, <span class="r416 r">arg</span>, <span class="s">&quot;+&quot;</span>, <span class="r417 r">errorSuggestion</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="11d353f8c22b296c" href="../../../R/11d353f8c22b296c.html" target="n" data-glyph="76,1" class="i method">BinarySub</a>(<span class="i">DynamicMetaObject</span> <span id="r423 rd" class="r423 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r424 rd" class="r424 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r425 rd" class="r425 r">errorSuggestion</span>)
        {
            <b>return</b> <a href="#eaab9017ed8feabc" class="i method">BinarySubDivOrRem</a>(<span class="r423 r">target</span>, <span class="r424 r">arg</span>, <span class="r425 r">errorSuggestion</span>, <span class="s">&quot;Sub&quot;</span>, <span class="s">&quot;op_Subtraction&quot;</span>, <span class="s">&quot;-&quot;</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="078af314cae7cff6" href="../../../R/078af314cae7cff6.html" target="n" data-glyph="76,1" class="i method">BinaryMultiply</a>(<span class="i">DynamicMetaObject</span> <span id="r426 rd" class="r426 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r427 rd" class="r427 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r428 rd" class="r428 r">errorSuggestion</span>)
        {
            <b>if</b> (<span class="r426 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <span class="c">// Result is null regardless of the arg.</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <span class="r426 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <b>if</b> (<span class="r426 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>())
            {
                <b>var</b> <span id="r429 rd" class="r429 r">numericArg</span> = <span class="i">GetArgAsNumericOrPrimitive</span>(<span class="r427 r">arg</span>, <span class="r426 r">target</span>.<span class="i">LimitType</span>);
                <b>if</b> (<span class="r429 r">numericArg</span> != <b>null</b>)
                {
                    <b>return</b> <a href="#0aa42430fd87a3f2" class="i method">BinaryNumericOp</a>(<span class="s">&quot;Multiply&quot;</span>, <span class="r426 r">target</span>, <span class="r429 r">numericArg</span>);
                }
 
                <b>if</b> (<span class="r427 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
                {
                    <b>return</b> <a href="#19580eb62c67ad22" class="i method">BinaryNumericStringOp</a>(<span class="r426 r">target</span>, <span class="r427 r">arg</span>);
                }
            }
 
            <b>if</b> (<span class="r426 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <span class="i">Expression</span> <span id="r430 rd" class="r430 r">argExpr</span> = <span class="r427 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>)
                                         ? <span class="i">ConvertStringToNumber</span>(<span class="r427 r">arg</span>.<span class="i">Expression</span>, <b>typeof</b>(<b>int</b>)).<span class="i">Convert</span>(<b>typeof</b>(<b>int</b>))
                                         : <span class="r427 r">arg</span>.<span class="i">CastOrConvert</span>(<b>typeof</b>(<b>int</b>));
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#ed1796e2745d3b16" class="i field">StringOps_Multiply</a>,
                                    <span class="r426 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>)),
                                    <span class="r430 r">argExpr</span>),
                    <span class="r426 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r427 r">arg</span>));
            }
 
            <b>var</b> <span id="r431 rd" class="r431 r">lhsEnumerator</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r426 r">target</span>);
            <b>if</b> (<span class="r431 r">lhsEnumerator</span> != <b>null</b>)
            {
                <span class="i">Expression</span> <span id="r432 rd" class="r432 r">argExpr</span> = <span class="r427 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>)
                                         ? <span class="i">ConvertStringToNumber</span>(<span class="r427 r">arg</span>.<span class="i">Expression</span>, <b>typeof</b>(<b>int</b>)).<span class="i">Convert</span>(<b>typeof</b>(<b>uint</b>))
                                         : <span class="r427 r">arg</span>.<span class="i">CastOrConvert</span>(<b>typeof</b>(<b>uint</b>));
 
                <b>if</b> (<span class="r426 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsArray</span>)
                {
                    <b>var</b> <span id="r433 rd" class="r433 r">elementType</span> = <span class="r426 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetElementType</span>();
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#68c9d45a92da9ef1" class="i field">ArrayOps_Multiply</a>.<span class="i">MakeGenericMethod</span>(<span class="r433 r">elementType</span>),
                                        <span class="r426 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r433 r">elementType</span>.<span class="i">MakeArrayType</span>()),
                                        <span class="r432 r">argExpr</span>),
                        <span class="r426 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r427 r">arg</span>));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#7a845f32cb513c53" class="i field">EnumerableOps_Multiply</a>,
                                    <span class="r431 r">lhsEnumerator</span>.<span class="i">Expression</span>,
                                    <span class="r432 r">argExpr</span>),
                    <span class="r426 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r427 r">arg</span>));
            }
 
            <b>return</b> <a href="#145910289c0dee1c" class="i method">CallImplicitOp</a>(<span class="s">&quot;op_Multiply&quot;</span>, <span class="r426 r">target</span>, <span class="r427 r">arg</span>, <span class="s">&quot;*&quot;</span>, <span class="r428 r">errorSuggestion</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="dcfd05d9e2525821" href="../../../R/dcfd05d9e2525821.html" target="n" data-glyph="76,1" class="i method">BinaryDivide</a>(<span class="i">DynamicMetaObject</span> <span id="r434 rd" class="r434 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r435 rd" class="r435 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r436 rd" class="r436 r">errorSuggestion</span>)
        {
            <b>return</b> <a href="#eaab9017ed8feabc" class="i method">BinarySubDivOrRem</a>(<span class="r434 r">target</span>, <span class="r435 r">arg</span>, <span class="r436 r">errorSuggestion</span>, <span class="s">&quot;Divide&quot;</span>, <span class="s">&quot;op_Division&quot;</span>, <span class="s">&quot;/&quot;</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="01069711d1d8b1dd" href="../../../R/01069711d1d8b1dd.html" target="n" data-glyph="76,1" class="i method">BinaryRemainder</a>(<span class="i">DynamicMetaObject</span> <span id="r437 rd" class="r437 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r438 rd" class="r438 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r439 rd" class="r439 r">errorSuggestion</span>)
        {
            <b>return</b> <a href="#eaab9017ed8feabc" class="i method">BinarySubDivOrRem</a>(<span class="r437 r">target</span>, <span class="r438 r">arg</span>, <span class="r439 r">errorSuggestion</span>, <span class="s">&quot;Remainder&quot;</span>, <span class="s">&quot;op_Modulus&quot;</span>, <span class="s">&quot;%&quot;</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="eaab9017ed8feabc" href="../../../R/eaab9017ed8feabc.html" target="n" data-glyph="76,1" class="i method">BinarySubDivOrRem</a>(<span class="i">DynamicMetaObject</span> <span id="r440 rd" class="r440 r">target</span>,
                                                    <span class="i">DynamicMetaObject</span> <span id="r441 rd" class="r441 r">arg</span>,
                                                    <span class="i">DynamicMetaObject</span> <span id="r442 rd" class="r442 r">errorSuggestion</span>,
                                                    <b>string</b> <span id="r443 rd" class="r443 r">numericOpMethodName</span>,
                                                    <b>string</b> <span id="r444 rd" class="r444 r">implicitOpMethodName</span>,
                                                    <b>string</b> <span id="r445 rd" class="r445 r">errorOperatorText</span>)
        {
            <b>if</b> (<span class="r440 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <span class="c">// if target is null, just use 0</span>
                <span class="r440 r">target</span> = <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0), <span class="r440 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>(), 0);
            }
 
            <b>if</b> (<span class="r440 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumericOrPrimitive</span>())
            {
                <b>var</b> <span id="r446 rd" class="r446 r">numericArg</span> = <span class="i">GetArgAsNumericOrPrimitive</span>(<span class="r441 r">arg</span>, <span class="r440 r">target</span>.<span class="i">LimitType</span>);
                <b>if</b> (<span class="r446 r">numericArg</span> != <b>null</b>)
                {
                    <b>return</b> <a href="#0aa42430fd87a3f2" class="i method">BinaryNumericOp</a>(<span class="r443 r">numericOpMethodName</span>, <span class="r440 r">target</span>, <span class="r446 r">numericArg</span>);
                }
 
                <b>if</b> (<span class="r441 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
                {
                    <b>return</b> <a href="#19580eb62c67ad22" class="i method">BinaryNumericStringOp</a>(<span class="r440 r">target</span>, <span class="r441 r">arg</span>);
                }
            }
 
            <b>if</b> (<span class="r440 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <span class="c">// Left is a string.  We convert it to a number and try binding again.</span>
                <b>return</b> <a href="#19580eb62c67ad22" class="i method">BinaryNumericStringOp</a>(<span class="r440 r">target</span>, <span class="r441 r">arg</span>);
            }
 
            <b>return</b> <a href="#145910289c0dee1c" class="i method">CallImplicitOp</a>(<span class="r444 r">implicitOpMethodName</span>, <span class="r440 r">target</span>, <span class="r441 r">arg</span>, <span class="r445 r">errorOperatorText</span>, <span class="r442 r">errorSuggestion</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="208365d04bf770fb" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">Shift</a>(<span class="i">DynamicMetaObject</span> <span id="r447 rd" class="r447 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r448 rd" class="r448 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r449 rd" class="r449 r">errorSuggestion</span>, <b>string</b> <span id="r450 rd" class="r450 r">userOp</span>, <span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>, <span class="i">Expression</span>&gt; <span id="r451 rd" class="r451 r">exprGenerator</span>)
        {
            <b>if</b> (<span class="r447 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0).<span class="i">Convert</span>(<b>typeof</b>(<b>object</b>)), <span class="r447 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <b>if</b> (<span class="r447 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>) || <span class="r448 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <b>return</b> <a href="#19580eb62c67ad22" class="i method">BinaryNumericStringOp</a>(<span class="r447 r">target</span>, <span class="r448 r">arg</span>);
            }
 
            <b>var</b> <span id="r452 rd" class="r452 r">typeCode</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetTypeCode</span>(<span class="r447 r">target</span>.<span class="i">LimitType</span>);
            <b>if</b> (!<span class="r447 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>())
            {
                <b>return</b> <a href="#145910289c0dee1c" class="i method">CallImplicitOp</a>(<span class="r450 r">userOp</span>, <span class="r447 r">target</span>, <span class="r448 r">arg</span>, <a href="#0a3e00ae2f31f885" class="i method">GetOperatorText</a>(), <span class="r449 r">errorSuggestion</span>);
            }
 
            <b>bool</b> <span id="r453 rd" class="r453 r">debase</span>;
            <b>var</b> <span id="r454 rd" class="r454 r">resultType</span> = <b>typeof</b>(<b>int</b>);
 
            <span class="c">// ConstrainedLanguage note - calls to this conversion only target numeric types.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r455 rd" class="r455 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r448 r">arg</span>.<span class="i">Value</span>, <span class="r454 r">resultType</span>, <b>out</b> <span class="r453 r">debase</span>);
            <b>if</b> (<span class="r455 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
            {
                <b>return</b> <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r448 r">arg</span>, <b>typeof</b>(<b>int</b>), <a href="#7b0e984617ab5e15" class="k">this</a>, <a href="#3e31a789692f9740" class="i field">_version</a>);
            }
 
            <b>var</b> <span id="r456 rd" class="r456 r">numericArg</span> = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r455 r">conversion</span>, <span class="r448 r">arg</span>.<span class="i">Expression</span>, <span class="r454 r">resultType</span>, <span class="r453 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
 
            <b>if</b> (<span class="r452 r">typeCode</span> == <span class="i">TypeCode</span>.<span class="i">Decimal</span> || <span class="r452 r">typeCode</span> == <span class="i">TypeCode</span>.<span class="i">Double</span> || <span class="r452 r">typeCode</span> == <span class="i">TypeCode</span>.<span class="i">Single</span>)
            {
                <b>var</b> <span id="r457 rd" class="r457 r">opType</span> = (<span class="r452 r">typeCode</span> == <span class="i">TypeCode</span>.<span class="i">Decimal</span>) ? <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#35bf15895a6ae802" class="t t">DecimalOps</a>) : <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#7042765bb70c6592" class="t t">DoubleOps</a>);
                <b>var</b> <span id="r458 rd" class="r458 r">castType</span> = (<span class="r452 r">typeCode</span> == <span class="i">TypeCode</span>.<span class="i">Decimal</span>) ? <b>typeof</b>(<b>decimal</b>) : <b>typeof</b>(<b>double</b>);
                <b>var</b> <span id="r459 rd" class="r459 r">methodName</span> = <span class="r450 r">userOp</span>.<span class="i">Substring</span>(3);  <span class="c">// Drop the &#39;op_&#39; prefix to figure out our internal method name.</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r457 r">opType</span>.<span class="i">GetMethod</span>(<span class="r459 r">methodName</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Static</span>), <span class="r447 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r458 r">castType</span>), <span class="r456 r">numericArg</span>),
                    <span class="r447 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r448 r">arg</span>));
            }
 
            <b>var</b> <span id="r460 rd" class="r460 r">targetExpr</span> = <span class="r447 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r447 r">target</span>.<span class="i">LimitType</span>);
            <span class="r456 r">numericArg</span> = <span class="i">Expression</span>.<span class="i">And</span>(<span class="r456 r">numericArg</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r452 r">typeCode</span> &lt; <span class="i">TypeCode</span>.<span class="i">Int64</span> ? 0x1f : 0x3f, <b>typeof</b>(<b>int</b>)));
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="r451 r">exprGenerator</span>(<span class="r460 r">targetExpr</span>, <span class="r456 r">numericArg</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                <span class="r447 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r448 r">arg</span>));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="8afd7b061904fc00" href="../../../R/8afd7b061904fc00.html" target="n" data-glyph="76,1" class="i method">LeftShift</a>(<span class="i">DynamicMetaObject</span> <span id="r461 rd" class="r461 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r462 rd" class="r462 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r463 rd" class="r463 r">errorSuggestion</span>)
        {
            <b>return</b> <span class="i">Shift</span>(<span class="r461 r">target</span>, <span class="r462 r">arg</span>, <span class="r463 r">errorSuggestion</span>, <span class="s">&quot;op_LeftShift&quot;</span>, <span class="i">Expression</span>.<span class="i">LeftShift</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="b9edb9c295f04726" href="../../../R/b9edb9c295f04726.html" target="n" data-glyph="76,1" class="i method">RightShift</a>(<span class="i">DynamicMetaObject</span> <span id="r464 rd" class="r464 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r465 rd" class="r465 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r466 rd" class="r466 r">errorSuggestion</span>)
        {
            <b>return</b> <span class="i">Shift</span>(<span class="r464 r">target</span>, <span class="r465 r">arg</span>, <span class="r466 r">errorSuggestion</span>, <span class="s">&quot;op_RightShift&quot;</span>, <span class="i">Expression</span>.<span class="i">RightShift</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="30c775b76e636749" href="../../../R/30c775b76e636749.html" target="n" data-glyph="76,1" class="i method">BinaryBitwiseXor</a>(<span class="i">DynamicMetaObject</span> <span id="r467 rd" class="r467 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r468 rd" class="r468 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r469 rd" class="r469 r">errorSuggestion</span>)
        {
            <b>return</b> <span class="i">BinaryBitwiseOp</span>(<span class="r467 r">target</span>, <span class="r468 r">arg</span>, <span class="r469 r">errorSuggestion</span>, <span class="i">Expression</span>.<span class="i">ExclusiveOr</span>, <span class="s">&quot;op_ExclusiveOr&quot;</span>, <span class="s">&quot;-bxor&quot;</span>, <span class="s">&quot;BXor&quot;</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="9f9a64b413ee1e22" href="../../../R/9f9a64b413ee1e22.html" target="n" data-glyph="76,1" class="i method">BinaryBitwiseOr</a>(<span class="i">DynamicMetaObject</span> <span id="r470 rd" class="r470 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r471 rd" class="r471 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r472 rd" class="r472 r">errorSuggestion</span>)
        {
            <b>return</b> <span class="i">BinaryBitwiseOp</span>(<span class="r470 r">target</span>, <span class="r471 r">arg</span>, <span class="r472 r">errorSuggestion</span>, <span class="i">Expression</span>.<span class="i">Or</span>, <span class="s">&quot;op_BitwiseOr&quot;</span>, <span class="s">&quot;-bor&quot;</span>, <span class="s">&quot;BOr&quot;</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="e87973141f9855ef" href="../../../R/e87973141f9855ef.html" target="n" data-glyph="76,1" class="i method">BinaryBitwiseAnd</a>(<span class="i">DynamicMetaObject</span> <span id="r473 rd" class="r473 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r474 rd" class="r474 r">arg</span>, <span class="i">DynamicMetaObject</span> <span id="r475 rd" class="r475 r">errorSuggestion</span>)
        {
            <b>return</b> <span class="i">BinaryBitwiseOp</span>(<span class="r473 r">target</span>, <span class="r474 r">arg</span>, <span class="r475 r">errorSuggestion</span>, <span class="i">Expression</span>.<span class="i">And</span>, <span class="s">&quot;op_BitwiseAnd&quot;</span>, <span class="s">&quot;-band&quot;</span>, <span class="s">&quot;BAnd&quot;</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="79dd0dd8599fcd17" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BinaryBitwiseOp</a>(<span class="i">DynamicMetaObject</span> <span id="r476 rd" class="r476 r">target</span>,
                                                  <span class="i">DynamicMetaObject</span> <span id="r477 rd" class="r477 r">arg</span>,
                                                  <span class="i">DynamicMetaObject</span> <span id="r478 rd" class="r478 r">errorSuggestion</span>,
                                                  <span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>, <span class="i">Expression</span>&gt; <span id="r479 rd" class="r479 r">exprGenerator</span>,
                                                  <b>string</b> <span id="r480 rd" class="r480 r">implicitMethodName</span>,
                                                  <b>string</b> <span id="r481 rd" class="r481 r">errorOperatorName</span>,
                                                  <b>string</b> <span id="r482 rd" class="r482 r">methodName</span>)
        {
            <b>if</b> (<span class="r476 r">target</span>.<span class="i">Value</span> == <b>null</b> &amp;&amp; <span class="r477 r">arg</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r476 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r477 r">arg</span>));
            }
 
            <b>var</b> <span id="r483 rd" class="r483 r">targetUnderlyingType</span> = (<span class="r476 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>) ? <span class="i">Enum</span>.<span class="i">GetUnderlyingType</span>(<span class="r476 r">target</span>.<span class="i">LimitType</span>) : <span class="r476 r">target</span>.<span class="i">LimitType</span>;
            <b>var</b> <span id="r484 rd" class="r484 r">argUnderlyingType</span> = (<span class="r477 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>) ? <span class="i">Enum</span>.<span class="i">GetUnderlyingType</span>(<span class="r477 r">arg</span>.<span class="i">LimitType</span>) : <span class="r477 r">arg</span>.<span class="i">LimitType</span>;
 
            <b>if</b> (<span class="r483 r">targetUnderlyingType</span>.<span class="i">IsNumericOrPrimitive</span>() || <span class="r484 r">argUnderlyingType</span>.<span class="i">IsNumericOrPrimitive</span>())
            {
                <span class="i">TypeCode</span> <span id="r485 rd" class="r485 r">leftTypeCode</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetTypeCode</span>(<span class="r483 r">targetUnderlyingType</span>);
                <span class="i">TypeCode</span> <span id="r486 rd" class="r486 r">rightTypeCode</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetTypeCode</span>(<span class="r484 r">argUnderlyingType</span>);
 
                <span class="i">Type</span> <span id="r487 rd" class="r487 r">opType</span>;
                <span class="i">Type</span> <span id="r488 rd" class="r488 r">opImplType</span>;
                <span class="i">Type</span> <span id="r489 rd" class="r489 r">toType</span>;
                <span class="i">TypeCode</span> <span id="r490 rd" class="r490 r">opTypeCode</span> = (<b>int</b>)<span class="r485 r">leftTypeCode</span> &gt;= (<b>int</b>)<span class="r486 r">rightTypeCode</span> ? <span class="r485 r">leftTypeCode</span> : <span class="r486 r">rightTypeCode</span>;
                <span class="i">DynamicMetaObject</span> <span id="r491 rd" class="r491 r">numericTarget</span>;
                <span class="i">DynamicMetaObject</span> <span id="r492 rd" class="r492 r">numericArg</span>;
                <b>if</b> (!<span class="r483 r">targetUnderlyingType</span>.<span class="i">IsNumericOrPrimitive</span>())
                {
                    <span class="r487 r">opType</span> = <a href="#4640660d3352e97e" class="i method">GetBitwiseOpType</a>(<span class="r486 r">rightTypeCode</span>);
                    <span class="r491 r">numericTarget</span> = <a href="#6a4253ae02824a8d" class="i method">GetArgAsNumericOrPrimitive</a>(<span class="r476 r">target</span>, <span class="r487 r">opType</span>);
                    <span class="r492 r">numericArg</span> = <span class="r477 r">arg</span>;
                }
                <b>else</b> <b>if</b> (!<span class="r484 r">argUnderlyingType</span>.<span class="i">IsNumericOrPrimitive</span>())
                {
                    <span class="r487 r">opType</span> = <a href="#4640660d3352e97e" class="i method">GetBitwiseOpType</a>(<span class="r485 r">leftTypeCode</span>);
                    <span class="r491 r">numericTarget</span> = <span class="r476 r">target</span>;
                    <span class="r492 r">numericArg</span> = <a href="#6a4253ae02824a8d" class="i method">GetArgAsNumericOrPrimitive</a>(<span class="r477 r">arg</span>, <span class="r487 r">opType</span>);
                }
                <b>else</b>
                {
                    <span class="r491 r">numericTarget</span> = <span class="r476 r">target</span>;
                    <span class="r492 r">numericArg</span> = <span class="r477 r">arg</span>;
                }
 
                <b>if</b> (<span class="r490 r">opTypeCode</span> == <span class="i">TypeCode</span>.<span class="i">Decimal</span>)
                {
                    <span class="r488 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#35bf15895a6ae802" class="t t">DecimalOps</a>);
                    <span class="r489 r">toType</span> = <b>typeof</b>(<b>decimal</b>);
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r488 r">opImplType</span>.<span class="i">GetMethod</span>(<span class="r482 r">methodName</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Static</span>),
                                <span class="r491 r">numericTarget</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r491 r">numericTarget</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#623da12beb9db704" class="i method">Convert</a>(<span class="r489 r">toType</span>),
                                <span class="r492 r">numericArg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r492 r">numericArg</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#623da12beb9db704" class="i method">Convert</a>(<span class="r489 r">toType</span>)),
                                <span class="r491 r">numericTarget</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r492 r">numericArg</span>));
                }
 
                <b>if</b> (<span class="r490 r">opTypeCode</span> == <span class="i">TypeCode</span>.<span class="i">Double</span> || <span class="r490 r">opTypeCode</span> == <span class="i">TypeCode</span>.<span class="i">Single</span>)
                {
                    <span class="r488 r">opImplType</span> = <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#7042765bb70c6592" class="t t">DoubleOps</a>);
                    <span class="r489 r">toType</span> = <b>typeof</b>(<b>double</b>);
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r488 r">opImplType</span>.<span class="i">GetMethod</span>(<span class="r482 r">methodName</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Static</span>),
                                <span class="r491 r">numericTarget</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r491 r">numericTarget</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#623da12beb9db704" class="i method">Convert</a>(<span class="r489 r">toType</span>),
                                <span class="r492 r">numericArg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r492 r">numericArg</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#623da12beb9db704" class="i method">Convert</a>(<span class="r489 r">toType</span>)),
                                <span class="r491 r">numericTarget</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r492 r">numericArg</span>));
                }
 
                <span class="c">// Figure out the smallest type necessary so we don&#39;t lose information.</span>
                <span class="c">// For uint, V2 promoted to long, but it&#39;s more correct to use uint.</span>
                <span class="c">// For ulong, V2 incorrectly used long, this is fixed here.</span>
                <span class="c">// For float, double, and decimal operands, we used to use long because V2 did.</span>
                <span class="c">// Because we use unsigned for -bnot, to be consistent, we promote to unsigned here too (-band,-bor,-xor)</span>
                <span class="r487 r">opType</span> = <a href="#4640660d3352e97e" class="i method">GetBitwiseOpType</a>((<b>int</b>)<span class="r485 r">leftTypeCode</span> &gt;= (<b>int</b>)<span class="r486 r">rightTypeCode</span> ? <span class="r485 r">leftTypeCode</span> : <span class="r486 r">rightTypeCode</span>);
 
                <b>if</b> (<span class="r491 r">numericTarget</span> != <b>null</b> &amp;&amp; <span class="r492 r">numericArg</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r493 rd" class="r493 r">expr</span> = <span class="r479 r">exprGenerator</span>(<span class="r491 r">numericTarget</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r491 r">numericTarget</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#664379b8310751e4" class="i method">Cast</a>(<span class="r487 r">opType</span>),
                                             <span class="r492 r">numericArg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r492 r">numericArg</span>.<span class="i">LimitType</span>).<a href="../../parser/Compiler.cs.html#664379b8310751e4" class="i method">Cast</a>(<span class="r487 r">opType</span>));
 
                    <b>if</b> (<span class="r476 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>)
                    {
                        <span class="r493 r">expr</span> = <span class="r493 r">expr</span>.<span class="i">Cast</span>(<span class="r476 r">target</span>.<span class="i">LimitType</span>);
                    }
 
                    <span class="r493 r">expr</span> = <span class="r493 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r493 r">expr</span>, <span class="r491 r">numericTarget</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r492 r">numericArg</span>));
                }
            }
 
            <b>if</b> (<span class="r476 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>) || <span class="r477 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <b>return</b> <a href="#19580eb62c67ad22" class="i method">BinaryNumericStringOp</a>(<span class="r476 r">target</span>, <span class="r477 r">arg</span>);
            }
 
            <b>return</b> <a href="#145910289c0dee1c" class="i method">CallImplicitOp</a>(<span class="r480 r">implicitMethodName</span>, <span class="r476 r">target</span>, <span class="r477 r">arg</span>, <span class="r481 r">errorOperatorName</span>, <span class="r478 r">errorSuggestion</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> &quot;Arithmetic&quot; operations
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Comparison operations
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="31b0f4e419eb95b8" href="../../../R/31b0f4e419eb95b8.html" target="n" data-glyph="76,1" class="i method">CompareEQ</a>(<span class="i">DynamicMetaObject</span> <span id="r494 rd" class="r494 r">target</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r495 rd" class="r495 r">arg</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r496 rd" class="r496 r">errorSuggestion</span>)
        {
            <b>if</b> (<span class="r494 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r495 r">arg</span>.<span class="i">Value</span> == <b>null</b> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a> : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a>,
                    <span class="r494 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r495 r">arg</span>));
            }
 
            <b>var</b> <span id="r497 rd" class="r497 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r494 r">target</span>);
            <b>if</b> (<span class="r497 r">enumerable</span> == <b>null</b> &amp;&amp; <span class="r495 r">arg</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a>,
                    <span class="r494 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r495 r">arg</span>));
            }
 
            <b>return</b> <a href="#904d3614a31abd96" class="i method">BinaryComparisonCommon</a>(<span class="r497 r">enumerable</span>, <span class="r494 r">target</span>, <span class="r495 r">arg</span>)
                ?? <a href="#92704d588a4bff96" class="i method">BinaryEqualityComparison</a>(<span class="r494 r">target</span>, <span class="r495 r">arg</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="fdf1386adc984007" href="../../../R/fdf1386adc984007.html" target="n" data-glyph="76,1" class="i method">CompareNE</a>(<span class="i">DynamicMetaObject</span> <span id="r498 rd" class="r498 r">target</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r499 rd" class="r499 r">arg</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r500 rd" class="r500 r">errorSuggestion</span>)
        {
            <b>if</b> (<span class="r498 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r499 r">arg</span>.<span class="i">Value</span> == <b>null</b> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a> : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>,
                    <span class="r498 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r499 r">arg</span>));
            }
 
            <b>var</b> <span id="r501 rd" class="r501 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r498 r">target</span>);
            <b>if</b> (<span class="r501 r">enumerable</span> == <b>null</b> &amp;&amp; <span class="r499 r">arg</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>,
                    <span class="r498 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r499 r">arg</span>));
            }
 
            <b>return</b> <a href="#904d3614a31abd96" class="i method">BinaryComparisonCommon</a>(<span class="r501 r">enumerable</span>, <span class="r498 r">target</span>, <span class="r499 r">arg</span>)
                ?? <a href="#92704d588a4bff96" class="i method">BinaryEqualityComparison</a>(<span class="r498 r">target</span>, <span class="r499 r">arg</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="92704d588a4bff96" href="../../../R/92704d588a4bff96.html" target="n" data-glyph="76,1" class="i method">BinaryEqualityComparison</a>(<span class="i">DynamicMetaObject</span> <span id="r502 rd" class="r502 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r503 rd" class="r503 r">arg</span>)
        {
            <b>var</b> <span id="r504 rd" class="r504 r">toResult</span> = <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">NotEqual</span> ? (<span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>&gt;)<span class="i">Expression</span>.<span class="i">Not</span> : <span id="r505 rd" class="r505 r">e</span> =&gt; <span class="r505 r">e</span>;
            <b>if</b> (<span class="r502 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <b>var</b> <span id="r506 rd" class="r506 r">targetExpr</span> = <span class="r502 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
 
                <span class="c">// Doing a string comparison no matter what.</span>
                <b>var</b> <span id="r507 rd" class="r507 r">argExpr</span> = <span class="r503 r">arg</span>.<span class="i">LimitType</span> != <b>typeof</b>(<b>string</b>)
                                  ? <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>),
                                                              <span class="r503 r">arg</span>.<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>)
                                  : <span class="r503 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r504 r">toResult</span>(<a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">CallStringEquals</span>(<span class="r506 r">targetExpr</span>, <span class="r507 r">argExpr</span>, <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a>)).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="r502 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r503 r">arg</span>));
            }
 
            <b>if</b> (<span class="r502 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>char</b>) &amp;&amp; <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a>)
            {
                <b>if</b> (<span class="r503 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>char</b>))
                {
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(
                            <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Equal</span> ? <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#993ec92d0a5baaf8" class="i field">CharOps_CompareIeq</a> : <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#de842d2f1859b375" class="i field">CharOps_CompareIne</a>,
                            <span class="r502 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>char</b>)),
                            <span class="r503 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>char</b>))),
                        <span class="r502 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>().<span class="i">Merge</span>(<span class="r503 r">arg</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()));
                }
 
                <b>if</b> (<span class="r503 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
                {
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(
                            <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Equal</span> ? <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#8e0e212ec96eb163" class="i field">CharOps_CompareStringIeq</a> : <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#20bde489096ac662" class="i field">CharOps_CompareStringIne</a>,
                            <span class="r502 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>char</b>)),
                            <span class="r503 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>))),
                        <span class="r502 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>().<span class="i">Merge</span>(<span class="r503 r">arg</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()));
                }
            }
 
            <span class="i">Expression</span> <span id="r508 rd" class="r508 r">objectEqualsCall</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r502 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                                          <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#fe4e5e7d2bcc0146" class="i field">Object_Equals</a>,
                                                          <span class="r503 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
            <b>bool</b> <span id="r509 rd" class="r509 r">debase</span>;
            <b>var</b> <span id="r510 rd" class="r510 r">targetType</span> = <span class="r502 r">target</span>.<span class="i">LimitType</span>;
 
            <span class="c">// ConstrainedLanguage note - calls to this conversion are protected by the binding rules below.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r511 rd" class="r511 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r503 r">arg</span>.<span class="i">Value</span>, <span class="r510 r">targetType</span>, <b>out</b> <span class="r509 r">debase</span>);
            <b>if</b> (<span class="r511 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#0c841bf014a77138" class="i field">Identity</a> || <span class="r511 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#6a83ff53b2a840f5" class="i field">Assignable</a>
                || (<span class="r511 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#92e8b910569c4813" class="i field">NullToRef</a> &amp;&amp; <span class="r510 r">targetType</span> != <b>typeof</b>(<a href="../../MshReference.cs.html#7363a2660b89f253" class="t t">PSReference</a>)))
            {
                <span class="c">// In these cases, no actual conversion is happening, and conversion.Converter will just return</span>
                <span class="c">// the value to be converted. So there is no need to convert the value and compare again.</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r504 r">toResult</span>(<span class="r508 r">objectEqualsCall</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r502 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r503 r">arg</span>));
            }
 
            <span class="i">BindingRestrictions</span> <span id="r512 rd" class="r512 r">bindingRestrictions</span> = <span class="r502 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r503 r">arg</span>);
            <span class="r512 r">bindingRestrictions</span> = <span class="r512 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetOptionalVersionAndLanguageCheckForType</span>(<a href="#7b0e984617ab5e15" class="k">this</a>, <span class="r510 r">targetType</span>, <a href="#3e31a789692f9740" class="i field">_version</a>));
 
            <span class="c">// If there is no conversion, then just rely on &#39;objectEqualsCall&#39; which most likely will return false. If we attempted the</span>
            <span class="c">// conversion, we&#39;d need extra code to catch an exception we know will happen just to return false.</span>
            <b>if</b> (<span class="r511 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r504 r">toResult</span>(<span class="r508 r">objectEqualsCall</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r512 r">bindingRestrictions</span>);
            }
 
            <span class="c">// A conversion exists.  Generate:</span>
            <span class="c">//    tmp = target.Equals(arg)</span>
            <span class="c">//    try {</span>
            <span class="c">//        if (!tmp) { tmp = target.Equals(Convert(arg, target.GetType())) }</span>
            <span class="c">//    } catch (InvalidCastException) { tmp = false }</span>
            <span class="c">//    return (operator is -eq/-ceq/-ieq) ? tmp : !tmp</span>
            <b>var</b> <span id="r513 rd" class="r513 r">resultTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>bool</b>));
 
            <span class="i">Expression</span> <span id="r514 rd" class="r514 r">secondEqualsCall</span> =
                <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r502 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#fe4e5e7d2bcc0146" class="i field">Object_Equals</a>,
                                <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r511 r">conversion</span>, <span class="r503 r">arg</span>.<span class="i">Expression</span>, <span class="r510 r">targetType</span>, <span class="r509 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
            <b>var</b> <span id="r515 rd" class="r515 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(
                <b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r513 r">resultTmp</span> },
                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r513 r">resultTmp</span>, <span class="r508 r">objectEqualsCall</span>),
                <span class="i">Expression</span>.<span class="i">IfThen</span>(<span class="i">Expression</span>.<span class="i">Not</span>(<span class="r513 r">resultTmp</span>),
                                  <span class="i">Expression</span>.<span class="i">TryCatch</span>(<span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r513 r">resultTmp</span>, <span class="r514 r">secondEqualsCall</span>),
                                  <span class="i">Expression</span>.<span class="i">Catch</span>(<b>typeof</b>(<span class="i">InvalidCastException</span>),
                                                   <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r513 r">resultTmp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>(<b>false</b>))))),
                <span class="r504 r">toResult</span>(<span class="r513 r">resultTmp</span>));
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r515 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r512 r">bindingRestrictions</span>);
        }
 
        <b>private static</b> <span class="i">Expression</span> <a id="a8fc4a8405508f66" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CompareWithZero</a>(<span class="i">DynamicMetaObject</span> <span id="r516 rd" class="r516 r">target</span>, <span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>, <span class="i">Expression</span>&gt; <span id="r517 rd" class="r517 r">comparer</span>)
        {
            <b>return</b> <span class="r517 r">comparer</span>(<span class="r516 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r516 r">target</span>.<span class="i">LimitType</span>), <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0).<span class="i">Cast</span>(<span class="r516 r">target</span>.<span class="i">LimitType</span>)).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="31d921be32b4a603" href="../../../R/31d921be32b4a603.html" target="n" data-glyph="76,1" class="i method">CompareLT</a>(<span class="i">DynamicMetaObject</span> <span id="r518 rd" class="r518 r">target</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r519 rd" class="r519 r">arg</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r520 rd" class="r520 r">errorSuggestion</span>)
        {
            <b>var</b> <span id="r521 rd" class="r521 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r518 r">target</span>);
            <b>if</b> (<span class="r521 r">enumerable</span> == <b>null</b> &amp;&amp; (<span class="r518 r">target</span>.<span class="i">Value</span> == <b>null</b> || <span class="r519 r">arg</span>.<span class="i">Value</span> == <b>null</b>))
            {
                <span class="i">Expression</span> <span id="r522 rd" class="r522 r">result</span> =
                      <span class="r518 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r518 r">target</span>, <span class="i">Expression</span>.<span class="i">LessThan</span>)
                    : <span class="r519 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r519 r">arg</span>, <span class="i">Expression</span>.<span class="i">GreaterThanOrEqual</span>)
                    : <span class="r519 r">arg</span>.<span class="i">Value</span> != <b>null</b> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>
                    : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a>;
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r522 r">result</span>, <span class="r518 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r519 r">arg</span>));
            }
 
            <b>return</b> <a href="#904d3614a31abd96" class="i method">BinaryComparisonCommon</a>(<span class="r521 r">enumerable</span>, <span class="r518 r">target</span>, <span class="r519 r">arg</span>)
                ?? <span class="i">BinaryComparison</span>(<span class="r518 r">target</span>, <span class="r519 r">arg</span>, <b>static</b> <span id="r523 rd" class="r523 r">e</span> =&gt; <span class="i">Expression</span>.<span class="i">LessThan</span>(<span class="r523 r">e</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="d7850b7184a03ee6" href="../../../R/d7850b7184a03ee6.html" target="n" data-glyph="76,1" class="i method">CompareLE</a>(<span class="i">DynamicMetaObject</span> <span id="r524 rd" class="r524 r">target</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r525 rd" class="r525 r">arg</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r526 rd" class="r526 r">errorSuggestion</span>)
        {
            <b>var</b> <span id="r527 rd" class="r527 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r524 r">target</span>);
            <b>if</b> (<span class="r527 r">enumerable</span> == <b>null</b> &amp;&amp; (<span class="r524 r">target</span>.<span class="i">Value</span> == <b>null</b> || <span class="r525 r">arg</span>.<span class="i">Value</span> == <b>null</b>))
            {
                <span class="i">Expression</span> <span id="r528 rd" class="r528 r">result</span> =
                      <span class="r524 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r524 r">target</span>, <span class="i">Expression</span>.<span class="i">LessThan</span>)
                    : <span class="r525 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r525 r">arg</span>, <span class="i">Expression</span>.<span class="i">GreaterThanOrEqual</span>)
                    : <span class="r524 r">target</span>.<span class="i">Value</span> != <b>null</b> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a>
                    : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>;
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r528 r">result</span>, <span class="r524 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r525 r">arg</span>));
            }
 
            <b>return</b> <a href="#904d3614a31abd96" class="i method">BinaryComparisonCommon</a>(<span class="r527 r">enumerable</span>, <span class="r524 r">target</span>, <span class="r525 r">arg</span>)
                ?? <span class="i">BinaryComparison</span>(<span class="r524 r">target</span>, <span class="r525 r">arg</span>, <b>static</b> <span id="r529 rd" class="r529 r">e</span> =&gt; <span class="i">Expression</span>.<span class="i">LessThanOrEqual</span>(<span class="r529 r">e</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="1e29873bb7144378" href="../../../R/1e29873bb7144378.html" target="n" data-glyph="76,1" class="i method">CompareGT</a>(<span class="i">DynamicMetaObject</span> <span id="r530 rd" class="r530 r">target</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r531 rd" class="r531 r">arg</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r532 rd" class="r532 r">errorSuggestion</span>)
        {
            <span class="c">// Handle a null operand as a special case here unless the target is enumerable or if one of the operands is numeric,</span>
            <span class="c">// in which case null is converted to 0 and regular numeric comparison is done.</span>
            <b>var</b> <span id="r533 rd" class="r533 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r530 r">target</span>);
            <b>if</b> (<span class="r533 r">enumerable</span> == <b>null</b> &amp;&amp; (<span class="r530 r">target</span>.<span class="i">Value</span> == <b>null</b> || <span class="r531 r">arg</span>.<span class="i">Value</span> == <b>null</b>))
            {
                <span class="i">Expression</span> <span id="r534 rd" class="r534 r">result</span> =
                      <span class="r530 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r530 r">target</span>, <span class="i">Expression</span>.<span class="i">GreaterThanOrEqual</span>)
                    : <span class="r531 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r531 r">arg</span>, <span class="i">Expression</span>.<span class="i">LessThan</span>)
                    : <span class="r530 r">target</span>.<span class="i">Value</span> != <b>null</b> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>
                    : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a>;
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r534 r">result</span>, <span class="r530 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r531 r">arg</span>));
            }
 
            <b>return</b> <a href="#904d3614a31abd96" class="i method">BinaryComparisonCommon</a>(<span class="r533 r">enumerable</span>, <span class="r530 r">target</span>, <span class="r531 r">arg</span>)
                ?? <span class="i">BinaryComparison</span>(<span class="r530 r">target</span>, <span class="r531 r">arg</span>, <b>static</b> <span id="r535 rd" class="r535 r">e</span> =&gt; <span class="i">Expression</span>.<span class="i">GreaterThan</span>(<span class="r535 r">e</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="4ec9838ae4243d8f" href="../../../R/4ec9838ae4243d8f.html" target="n" data-glyph="76,1" class="i method">CompareGE</a>(<span class="i">DynamicMetaObject</span> <span id="r536 rd" class="r536 r">target</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r537 rd" class="r537 r">arg</span>,
                                            <span class="i">DynamicMetaObject</span> <span id="r538 rd" class="r538 r">errorSuggestion</span>)
        {
            <span class="c">// Handle a null operand as a special case here unless the target is enumerable or if one of the operands is numeric,</span>
            <span class="c">// in which case null is converted to 0 and regular numeric comparison is done.</span>
            <b>var</b> <span id="r539 rd" class="r539 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r536 r">target</span>);
            <b>if</b> (<span class="r539 r">enumerable</span> == <b>null</b> &amp;&amp; (<span class="r536 r">target</span>.<span class="i">Value</span> == <b>null</b> || <span class="r537 r">arg</span>.<span class="i">Value</span> == <b>null</b>))
            {
                <span class="i">Expression</span> <span id="r540 rd" class="r540 r">result</span> =
                      <span class="r536 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r536 r">target</span>, <span class="i">Expression</span>.<span class="i">GreaterThanOrEqual</span>)
                    : <span class="r537 r">arg</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>() ? <span class="i">CompareWithZero</span>(<span class="r537 r">arg</span>, <span class="i">Expression</span>.<span class="i">LessThan</span>)
                    : <span class="r537 r">arg</span>.<span class="i">Value</span> != <b>null</b> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a>
                    : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a>;
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r540 r">result</span>, <span class="r536 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r537 r">arg</span>));
            }
 
            <b>return</b> <a href="#904d3614a31abd96" class="i method">BinaryComparisonCommon</a>(<span class="r539 r">enumerable</span>, <span class="r536 r">target</span>, <span class="r537 r">arg</span>)
                ?? <span class="i">BinaryComparison</span>(<span class="r536 r">target</span>, <span class="r537 r">arg</span>, <b>static</b> <span id="r541 rd" class="r541 r">e</span> =&gt; <span class="i">Expression</span>.<span class="i">GreaterThanOrEqual</span>(<span class="r541 r">e</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="02e0f899e2ce2903" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">BinaryComparison</a>(<span class="i">DynamicMetaObject</span> <span id="r542 rd" class="r542 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r543 rd" class="r543 r">arg</span>, <span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>&gt; <span id="r544 rd" class="r544 r">toResult</span>)
        {
            <b>if</b> (<span class="r542 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <b>var</b> <span id="r545 rd" class="r545 r">targetExpr</span> = <span class="r542 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
 
                <span class="c">// Doing a string comparison no matter what.</span>
                <b>var</b> <span id="r546 rd" class="r546 r">argExpr</span> = <span class="r543 r">arg</span>.<span class="i">LimitType</span> != <b>typeof</b>(<b>string</b>)
                                  ? <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>),
                                                              <span class="r543 r">arg</span>.<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>)
                                  : <span class="r543 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>string</b>));
 
                <b>var</b> <span id="r547 rd" class="r547 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#e392c062f090aa28" class="i field">StringOps_Compare</a>, <span class="r545 r">targetExpr</span>, <span class="r546 r">argExpr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>,
                                           <a href="#7ca32ee40c575f72" class="i field">_ignoreCase</a>
                                           ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8e856f76e62e2ba5" class="i field">CompareOptionsIgnoreCase</a>
                                           : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a826ebdedc45c1fa" class="i field">CompareOptionsNone</a>);
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r544 r">toResult</span>(<span class="r547 r">expr</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="r542 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r543 r">arg</span>));
            }
 
            <b>bool</b> <span id="r548 rd" class="r548 r">debase</span>;
            <b>var</b> <span id="r549 rd" class="r549 r">targetType</span> = <span class="r542 r">target</span>.<span class="i">LimitType</span>;
 
            <span class="c">// ConstrainedLanguage note - calls to this conversion are protected by the binding rules below.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r550 rd" class="r550 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r543 r">arg</span>.<span class="i">Value</span>, <span class="r549 r">targetType</span>, <b>out</b> <span class="r548 r">debase</span>);
 
            <span class="i">BindingRestrictions</span> <span id="r551 rd" class="r551 r">bindingRestrictions</span> = <span class="r542 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r543 r">arg</span>);
            <span class="r551 r">bindingRestrictions</span> = <span class="r551 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetOptionalVersionAndLanguageCheckForType</span>(<a href="#7b0e984617ab5e15" class="k">this</a>, <span class="r549 r">targetType</span>, <a href="#3e31a789692f9740" class="i field">_version</a>));
 
            <span class="i">Expression</span> <span id="r552 rd" class="r552 r">argConverted</span>;
            <b>if</b> (<span class="r550 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#0c841bf014a77138" class="i field">Identity</a> || <span class="r550 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#6a83ff53b2a840f5" class="i field">Assignable</a>)
            {
                <span class="r552 r">argConverted</span> = <span class="r543 r">arg</span>.<span class="i">Expression</span>;
            }
            <b>else</b> <b>if</b> (<span class="r550 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
            {
                <span class="c">// If there is no conversion, then don&#39;t bother to invoke the converter. We raise the exception directly.</span>
                <b>var</b> <span id="r553 rd" class="r553 r">valueToConvert</span> = <span class="r548 r">debase</span>
                    ? <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r543 r">arg</span>.<span class="i">Expression</span>)
                    : <span class="r543 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                <b>var</b> <span id="r554 rd" class="r554 r">errorMsgTuple</span> = <span class="i">Expression</span>.<span class="i">Call</span>(
                    <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#f7d695c0330a8940" class="i field">LanguagePrimitives_GetInvalidCastMessages</a>,
                    <span class="r553 r">valueToConvert</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r549 r">targetType</span>, <b>typeof</b>(<span class="i">Type</span>)));
 
                <span class="r552 r">argConverted</span> = <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeError</span>(
                    <span class="s">&quot;ComparisonFailure&quot;</span>, <span class="i">ExtendedTypeSystem</span>.<span class="i">ComparisonFailure</span>, <span class="r549 r">targetType</span>,
                    <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>), <span class="r542 r">target</span>.<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>),
                    <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>), <span class="r543 r">arg</span>.<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>),
                    <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r554 r">errorMsgTuple</span>, <span class="s">&quot;Item2&quot;</span>));
            }
            <b>else</b>
            {
                <span class="c">// Invoke the converter. We can raise the exception if the conversion throws InvalidCastException.</span>
                <b>var</b> <span id="r555 rd" class="r555 r">innerException</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<span class="i">InvalidCastException</span>));
                <span class="r552 r">argConverted</span> =
                    <span class="i">Expression</span>.<span class="i">TryCatch</span>(
                        <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r550 r">conversion</span>, <span class="r543 r">arg</span>.<span class="i">Expression</span>, <span class="r549 r">targetType</span>, <span class="r548 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>),
                        <span class="i">Expression</span>.<span class="i">Catch</span>(
                            <span class="r555 r">innerException</span>,
                            <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeErrorWithInnerException</span>(<span class="s">&quot;ComparisonFailure&quot;</span>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">ComparisonFailure</span>), <span class="r555 r">innerException</span>, <span class="r549 r">targetType</span>,
                                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>), <span class="r542 r">target</span>.<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>),
                                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>), <span class="r543 r">arg</span>.<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>),
                                <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r555 r">innerException</span>, <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#786cdc6c563f5cd2" class="i field">Exception_Message</a>))));
            }
 
            <span class="c">// Prefer IComparable&lt;T&gt; over IComparable if possible</span>
            <b>if</b> (<span class="r542 r">target</span>.<span class="i">LimitType</span> == <span class="r543 r">arg</span>.<span class="i">LimitType</span>)
            {
                <b>foreach</b> (<b>var</b> <span id="r556 rd" class="r556 r">i</span> <b>in</b> <span class="r542 r">target</span>.<span class="i">Value</span>.<span class="i">GetType</span>().<span class="i">GetInterfaces</span>())
                {
                    <b>if</b> (<span class="r556 r">i</span>.<span class="i">IsGenericType</span> &amp;&amp; <span class="r556 r">i</span>.<span class="i">GetGenericTypeDefinition</span>() == <b>typeof</b>(<span class="i">IComparable</span>&lt;&gt;))
                    {
                        <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="r544 r">toResult</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r542 r">target</span>.<span class="i">Expression</span>, <span class="r556 r">i</span>),
                                                     <span class="r556 r">i</span>.<span class="i">GetMethod</span>(<span class="s">&quot;CompareTo&quot;</span>),
                                                     <span class="r552 r">argConverted</span>.<span class="i">Cast</span>(<span class="r543 r">arg</span>.<span class="i">LimitType</span>))).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                            <span class="r551 r">bindingRestrictions</span>);
                    }
                }
            }
 
            <b>if</b> (<span class="r542 r">target</span>.<span class="i">Value</span> <b>is</b> <span class="i">IComparable</span>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r544 r">toResult</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<span class="r542 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IComparable</span>)),
                                             <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#332d947d7b69ea95" class="i field">IComparable_CompareTo</a>,
                                             <span class="r552 r">argConverted</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="r551 r">bindingRestrictions</span>);
            }
 
            <b>var</b> <span id="r557 rd" class="r557 r">throwExpr</span> = <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeError</span>(<span class="s">&quot;NotIcomparable&quot;</span>, <span class="i">ExtendedTypeSystem</span>.<span class="i">NotIcomparable</span>, <a href="#7b0e984617ab5e15" class="k">this</a>.<span class="i">ReturnType</span>, <span class="r542 r">target</span>.<span class="i">Expression</span>);
 
            <span class="c">// Try object.Equals.  If the objects compare equal, the result is known (true for -ge or -le, false for -gt or -lt), otherwise</span>
            <span class="c">// throw because the objects can&#39;t be compared in any meaningful way.</span>
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Condition</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r542 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                    <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#fe4e5e7d2bcc0146" class="i field">Object_Equals</a>,
                                    <span class="r543 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    (<span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span> || <span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>)
                        ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#35879747cffe04dc" class="i field">BoxedTrue</a> : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#07397be9f58aa70d" class="i field">BoxedFalse</a>,
                    <span class="r557 r">throwExpr</span>),
                <span class="r551 r">bindingRestrictions</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="904d3614a31abd96" href="../../../R/904d3614a31abd96.html" target="n" data-glyph="76,1" class="i method">BinaryComparisonCommon</a>(<span class="i">DynamicMetaObject</span> <span id="r558 rd" class="r558 r">targetAsEnumerator</span>, <span class="i">DynamicMetaObject</span> <span id="r559 rd" class="r559 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r560 rd" class="r560 r">arg</span>)
        {
            <b>if</b> (<span class="r558 r">targetAsEnumerator</span> != <b>null</b> &amp;&amp; !<a href="#833f3087d50e9916" class="i field">_scalarCompare</a>)
            {
                <span class="c">// If the target is enumerable, the we generate an object[] result with elements matching.</span>
                <span class="c">// The iteration will be done in a pre-compiled method, but the comparison is done with</span>
                <span class="c">// a dynamically generated lambda that uses a binder</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#44b55abb1a05a3f5" class="i field">EnumerableOps_Compare</a>,
                                    <span class="r558 r">targetAsEnumerator</span>.<span class="i">Expression</span>,
                                    <span class="r560 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="#9345e572d74a99ae" class="i method">GetScalarCompareDelegate</a>())),
                    <span class="r558 r">targetAsEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r560 r">arg</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()));
            }
 
            <b>if</b> (<span class="r559 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>())
            {
                <b>var</b> <span id="r561 rd" class="r561 r">numericArg</span> = <span class="i">GetArgAsNumericOrPrimitive</span>(<span class="r560 r">arg</span>, <span class="r559 r">target</span>.<span class="i">LimitType</span>);
                <b>if</b> (<span class="r561 r">numericArg</span> != <b>null</b>)
                {
                    <b>string</b> <span id="r562 rd" class="r562 r">numericMethod</span> = <b>null</b>;
                    <b>switch</b> (<span class="i">Operation</span>)
                    {
                        <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Equal</span>: <span class="r562 r">numericMethod</span> = <span class="s">&quot;CompareEq&quot;</span>; <b>break</b>;
                        <b>case</b> <span class="i">ExpressionType</span>.<span class="i">NotEqual</span>: <span class="r562 r">numericMethod</span> = <span class="s">&quot;CompareNe&quot;</span>; <b>break</b>;
                        <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThan</span>: <span class="r562 r">numericMethod</span> = <span class="s">&quot;CompareGt&quot;</span>; <b>break</b>;
                        <b>case</b> <span class="i">ExpressionType</span>.<span class="i">GreaterThanOrEqual</span>: <span class="r562 r">numericMethod</span> = <span class="s">&quot;CompareGe&quot;</span>; <b>break</b>;
                        <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThan</span>: <span class="r562 r">numericMethod</span> = <span class="s">&quot;CompareLt&quot;</span>; <b>break</b>;
                        <b>case</b> <span class="i">ExpressionType</span>.<span class="i">LessThanOrEqual</span>: <span class="r562 r">numericMethod</span> = <span class="s">&quot;CompareLe&quot;</span>; <b>break</b>;
                    }
 
                    <b>return</b> <a href="#0aa42430fd87a3f2" class="i method">BinaryNumericOp</a>(<span class="r562 r">numericMethod</span>, <span class="r559 r">target</span>, <span class="r561 r">numericArg</span>);
                }
 
                <b>if</b> (<span class="r560 r">arg</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
                {
                    <b>return</b> <a href="#19580eb62c67ad22" class="i method">BinaryNumericStringOp</a>(<span class="r559 r">target</span>, <span class="r560 r">arg</span>);
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Comparison operations
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The binder for unary operators like !, -, or +.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="ee39afdcd24db6ca" href="../../../R/ee39afdcd24db6ca.html" target="n" data-glyph="2,0" class="t t">PSUnaryOperationBinder</a> : <span class="i">UnaryOperationBinder</span>
    {
        <b>private static</b> <a href="#ee39afdcd24db6ca" class="t t">PSUnaryOperationBinder</a> <a id="69b6e240e53c8763" href="../../../R/69b6e240e53c8763.html" target="n" data-glyph="46,1" class="i field">s_notBinder</a>;
        <b>private static</b> <a href="#ee39afdcd24db6ca" class="t t">PSUnaryOperationBinder</a> <a id="ce1397dc75f80b8a" href="../../../R/ce1397dc75f80b8a.html" target="n" data-glyph="46,1" class="i field">s_bnotBinder</a>;
        <b>private static</b> <a href="#ee39afdcd24db6ca" class="t t">PSUnaryOperationBinder</a> <a id="1407452bd062d840" href="../../../R/1407452bd062d840.html" target="n" data-glyph="46,1" class="i field">s_unaryMinus</a>;
        <b>private static</b> <a href="#ee39afdcd24db6ca" class="t t">PSUnaryOperationBinder</a> <a id="7afae874110f27fa" href="../../../R/7afae874110f27fa.html" target="n" data-glyph="46,1" class="i field">s_unaryPlusBinder</a>;
        <b>private static</b> <a href="#ee39afdcd24db6ca" class="t t">PSUnaryOperationBinder</a> <a id="39ecd2d6e0d1b1dc" href="../../../R/39ecd2d6e0d1b1dc.html" target="n" data-glyph="46,1" class="i field">s_incrementBinder</a>;
        <b>private static</b> <a href="#ee39afdcd24db6ca" class="t t">PSUnaryOperationBinder</a> <a id="0cc8318cdd324847" href="../../../R/0cc8318cdd324847.html" target="n" data-glyph="46,1" class="i field">s_decrementBinder</a>;
 
        <b>internal static</b> <a href="#ee39afdcd24db6ca" class="t t">PSUnaryOperationBinder</a> <a id="94baadbffb667154" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Get</a>(<span class="i">ExpressionType</span> <span id="r563 rd" class="r563 r">operation</span>)
        {
            <b>switch</b> (<span class="r563 r">operation</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Not</span>:
                    <b>if</b> (<a href="#69b6e240e53c8763" class="i field">s_notBinder</a> == <b>null</b>)
                        <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#69b6e240e53c8763" class="i field">s_notBinder</a>, <b>new</b> <a href="#d2fd63ea95f29775" class="t constructor">PSUnaryOperationBinder</a>(<span class="r563 r">operation</span>), <b>null</b>);
                    <b>return</b> <a href="#69b6e240e53c8763" class="i field">s_notBinder</a>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">OnesComplement</span>:
                    <b>if</b> (<a href="#ce1397dc75f80b8a" class="i field">s_bnotBinder</a> == <b>null</b>)
                        <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#ce1397dc75f80b8a" class="i field">s_bnotBinder</a>, <b>new</b> <a href="#d2fd63ea95f29775" class="t constructor">PSUnaryOperationBinder</a>(<span class="r563 r">operation</span>), <b>null</b>);
                    <b>return</b> <a href="#ce1397dc75f80b8a" class="i field">s_bnotBinder</a>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">UnaryPlus</span>:
                    <b>if</b> (<a href="#7afae874110f27fa" class="i field">s_unaryPlusBinder</a> == <b>null</b>)
                        <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#7afae874110f27fa" class="i field">s_unaryPlusBinder</a>, <b>new</b> <a href="#d2fd63ea95f29775" class="t constructor">PSUnaryOperationBinder</a>(<span class="r563 r">operation</span>), <b>null</b>);
                    <b>return</b> <a href="#7afae874110f27fa" class="i field">s_unaryPlusBinder</a>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Negate</span>:
                    <b>if</b> (<a href="#1407452bd062d840" class="i field">s_unaryMinus</a> == <b>null</b>)
                        <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#1407452bd062d840" class="i field">s_unaryMinus</a>, <b>new</b> <a href="#d2fd63ea95f29775" class="t constructor">PSUnaryOperationBinder</a>(<span class="r563 r">operation</span>), <b>null</b>);
                    <b>return</b> <a href="#1407452bd062d840" class="i field">s_unaryMinus</a>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Increment</span>:
                    <b>if</b> (<a href="#39ecd2d6e0d1b1dc" class="i field">s_incrementBinder</a> == <b>null</b>)
                        <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#39ecd2d6e0d1b1dc" class="i field">s_incrementBinder</a>, <b>new</b> <a href="#d2fd63ea95f29775" class="t constructor">PSUnaryOperationBinder</a>(<span class="r563 r">operation</span>), <b>null</b>);
                    <b>return</b> <a href="#39ecd2d6e0d1b1dc" class="i field">s_incrementBinder</a>;
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Decrement</span>:
                    <b>if</b> (<a href="#0cc8318cdd324847" class="i field">s_decrementBinder</a> == <b>null</b>)
                        <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#0cc8318cdd324847" class="i field">s_decrementBinder</a>, <b>new</b> <a href="#d2fd63ea95f29775" class="t constructor">PSUnaryOperationBinder</a>(<span class="r563 r">operation</span>), <b>null</b>);
                    <b>return</b> <a href="#0cc8318cdd324847" class="i field">s_decrementBinder</a>;
            }
 
            <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>(<span class="s">&quot;Unimplemented unary operation&quot;</span>);
        }
 
        <b>private</b> <a id="d2fd63ea95f29775" href="../../../R/d2fd63ea95f29775.html" target="n" data-glyph="76,1" class="t constructor">PSUnaryOperationBinder</a>(<span class="i">ExpressionType</span> <span id="r564 rd" class="r564 r">operation</span>) : <b>base</b>(<span class="r564 r">operation</span>)
        {
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="31656ce311e001c9" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackUnaryOperation</a>(<span class="i">DynamicMetaObject</span> <span id="r565 rd" class="r565 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r566 rd" class="r566 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r565 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r565 r">target</span>);
            }
 
            <b>if</b> (<span class="r565 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r565 r">target</span>.<span class="i">Value</span>) != <span class="r565 r">target</span>.<span class="i">Value</span>))
            {
                <b>return</b> <a href="#ee39afdcd24db6ca" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r565 r">target</span>);
            }
 
            <b>switch</b> (<span class="i">Operation</span>)
            {
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Not</span>:
                    <b>return</b> <a href="#418738fa8236bbc0" class="i method">Not</a>(<span class="r565 r">target</span>, <span class="r566 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#ee39afdcd24db6ca" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">OnesComplement</span>:
                    <b>return</b> <a href="#c0e014c91b1e16ba" class="i method">BNot</a>(<span class="r565 r">target</span>, <span class="r566 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#ee39afdcd24db6ca" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">UnaryPlus</span>:
                    <b>return</b> <a href="#c5bddea29ef8ff29" class="i method">UnaryPlus</a>(<span class="r565 r">target</span>, <span class="r566 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#ee39afdcd24db6ca" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Negate</span>:
                    <b>return</b> <a href="#0344ef43ea659570" class="i method">UnaryMinus</a>(<span class="r565 r">target</span>, <span class="r566 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#ee39afdcd24db6ca" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Increment</span>:
                    <b>return</b> <a href="#beab7b2c0d2978ff" class="i method">IncrDecr</a>(<span class="r565 r">target</span>, 1, <span class="r566 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#ee39afdcd24db6ca" class="k">this</a>);
                <b>case</b> <span class="i">ExpressionType</span>.<span class="i">Decrement</span>:
                    <b>return</b> <span class="i">IncrDecr</span>(<span class="r565 r">target</span>, -1, <span class="r566 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#ee39afdcd24db6ca" class="k">this</a>);
            }
 
            <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
        }
 
        <b>public override string</b> <a id="087a3010b2e8999d" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;PSUnaryOperationBinder {0}&quot;</span>, <a href="#ee39afdcd24db6ca" class="k">this</a>.<span class="i">Operation</span>);
        }
 
        <b>internal</b> <span class="i">DynamicMetaObject</span> <a id="418738fa8236bbc0" href="../../../R/418738fa8236bbc0.html" target="n" data-glyph="74,1" class="i method">Not</a>(<span class="i">DynamicMetaObject</span> <span id="r567 rd" class="r567 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r568 rd" class="r568 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r567 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r567 r">target</span>);
            }
 
            <span class="c">// TODO: check op_LogicalNot</span>
 
            <span class="c">// This could generate a dynamic site in the expr, which means we might have the same type test twice.</span>
            <span class="c">// We should do better, but this is the simplest implementation, we can add specific cases to handle more common</span>
            <span class="c">// cases if necessary.</span>
            <b>var</b> <span id="r569 rd" class="r569 r">targetExpr</span> = <span class="r567 r">target</span>.<span class="i">CastOrConvert</span>(<b>typeof</b>(<b>bool</b>));
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Not</span>(<span class="r569 r">targetExpr</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                <span class="r567 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
        }
 
        <b>internal</b> <span class="i">DynamicMetaObject</span> <a id="c0e014c91b1e16ba" href="../../../R/c0e014c91b1e16ba.html" target="n" data-glyph="74,1" class="i method">BNot</a>(<span class="i">DynamicMetaObject</span> <span id="r570 rd" class="r570 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r571 rd" class="r571 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r570 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r570 r">target</span>);
            }
 
            <b>if</b> (<span class="r570 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r570 r">target</span>.<span class="i">Value</span>) != <span class="r570 r">target</span>.<span class="i">Value</span>))
            {
                <b>return</b> <a href="#ee39afdcd24db6ca" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r570 r">target</span>);
            }
 
            <b>if</b> (<span class="r570 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(-1).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r570 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <span class="c">// If the type implements the operator, prefer that.</span>
            <b>var</b> <span id="r572 rd" class="r572 r">method</span> = <span class="r570 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetMethod</span>(<span class="s">&quot;op_OnesComplement&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">Static</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span>, <b>null</b>,
                                                    <b>new</b> <span class="i">Type</span>[] { <span class="r570 r">target</span>.<span class="i">LimitType</span> }, <b>null</b>);
            <b>if</b> (<span class="r572 r">method</span> != <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">OnesComplement</span>(<span class="r570 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r570 r">target</span>.<span class="i">LimitType</span>), <span class="r572 r">method</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="r570 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <span class="c">// Otherwise, do a conversion, as necessary, or throw (and say we can&#39;t convert to int, a better message</span>
            <span class="c">// would be nice, but this error is good enough.)</span>
            <b>if</b> (<span class="r570 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>string</b>))
            {
                <span class="c">// If we have a string, we defer resolving the operation type until after we know the type of the operand,</span>
                <span class="c">// so generate a dynamic site.</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#ee39afdcd24db6ca" class="k">this</a>, <a href="#ee39afdcd24db6ca" class="k">this</a>.<span class="i">ReturnType</span>,
                                              <a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a>.<span class="i">ConvertStringToNumber</span>(<span class="r570 r">target</span>.<span class="i">Expression</span>, <b>typeof</b>(<b>int</b>))),
                    <span class="r570 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <span class="i">Expression</span> <span id="r573 rd" class="r573 r">targetExpr</span> = <b>null</b>;
            <b>if</b> (!<span class="r570 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>())
            {
                <b>var</b> <span id="r574 rd" class="r574 r">resultType</span> = <b>typeof</b>(<b>int</b>);
                <b>bool</b> <span id="r575 rd" class="r575 r">debase</span>;
 
                <span class="c">// ConstrainedLanguage note - calls to this conversion only target numeric types.</span>
                <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r576 rd" class="r576 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r570 r">target</span>.<span class="i">Value</span>, <span class="r574 r">resultType</span>, <b>out</b> <span class="r575 r">debase</span>);
                <b>if</b> (<span class="r576 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> != <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
                {
                    <span class="r573 r">targetExpr</span> = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r576 r">conversion</span>, <span class="r570 r">target</span>.<span class="i">Expression</span>, <span class="r574 r">resultType</span>, <span class="r575 r">debase</span>,
                                                                 <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
                }
                <b>else</b>
                {
                    <span class="r574 r">resultType</span> = <b>typeof</b>(<b>long</b>);
 
                    <span class="c">// ConstrainedLanguage note - calls to this conversion only target numeric types.</span>
                    <span class="r576 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r570 r">target</span>.<span class="i">Value</span>, <span class="r574 r">resultType</span>, <b>out</b> <span class="r575 r">debase</span>);
                    <b>if</b> (<span class="r576 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> != <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
                    {
                        <span class="r573 r">targetExpr</span> = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r576 r">conversion</span>, <span class="r570 r">target</span>.<span class="i">Expression</span>, <span class="r574 r">resultType</span>, <span class="r575 r">debase</span>,
                                                                     <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
                    }
                }
            }
            <b>else</b>
            {
                <b>var</b> <span id="r577 rd" class="r577 r">typeCode</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetTypeCode</span>(<span class="r570 r">target</span>.<span class="i">LimitType</span>);
                <b>if</b> (<span class="r577 r">typeCode</span> &lt; <span class="i">TypeCode</span>.<span class="i">Int32</span>)
                {
                    <span class="r573 r">targetExpr</span> = <span class="r570 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>
                        ? <span class="r570 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="i">Enum</span>.<span class="i">GetUnderlyingType</span>(<span class="r570 r">target</span>.<span class="i">LimitType</span>))
                        : <span class="r570 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r570 r">target</span>.<span class="i">LimitType</span>);
                    <span class="r573 r">targetExpr</span> = <span class="r573 r">targetExpr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>int</b>));
                }
                <b>else</b> <b>if</b> (<span class="r577 r">typeCode</span> &lt;= <span class="i">TypeCode</span>.<span class="i">UInt64</span>)
                {
                    <b>var</b> <span id="r578 rd" class="r578 r">targetConvertType</span> = <span class="r570 r">target</span>.<span class="i">LimitType</span>;
                    <b>if</b> (<span class="r578 r">targetConvertType</span>.<span class="i">IsEnum</span>)
                    {
                        <span class="r578 r">targetConvertType</span> = <span class="i">Enum</span>.<span class="i">GetUnderlyingType</span>(<span class="r578 r">targetConvertType</span>);
                    }
 
                    <span class="r573 r">targetExpr</span> = <span class="r570 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r578 r">targetConvertType</span>);
                }
                <b>else</b>
                {
                    <b>var</b> <span id="r579 rd" class="r579 r">opType</span> = (<span class="r577 r">typeCode</span> == <span class="i">TypeCode</span>.<span class="i">Decimal</span>) ? <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#35bf15895a6ae802" class="t t">DecimalOps</a>) : <b>typeof</b>(<a href="../Operations/NumericOps.cs.html#7042765bb70c6592" class="t t">DoubleOps</a>);
                    <b>var</b> <span id="r580 rd" class="r580 r">castType</span> = (<span class="r577 r">typeCode</span> == <span class="i">TypeCode</span>.<span class="i">Decimal</span>) ? <b>typeof</b>(<b>decimal</b>) : <b>typeof</b>(<b>double</b>);
 
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r579 r">opType</span>.<span class="i">GetMethod</span>(<span class="s">&quot;BNot&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">Static</span> | <span class="i">BindingFlags</span>.<span class="i">NonPublic</span>), <span class="r570 r">target</span>.<span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r580 r">castType</span>)),
                        <span class="r570 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
                }
            }
 
            <b>if</b> (<span class="r573 r">targetExpr</span> != <b>null</b>)
            {
                <span class="i">Expression</span> <span id="r581 rd" class="r581 r">result</span> = <span class="i">Expression</span>.<span class="i">OnesComplement</span>(<span class="r573 r">targetExpr</span>);
                <b>if</b> (<span class="r570 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsEnum</span>)
                {
                    <span class="r581 r">result</span> = <span class="r581 r">result</span>.<span class="i">Cast</span>(<span class="r570 r">target</span>.<span class="i">LimitType</span>);
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r581 r">result</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r570 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <b>return</b> <span class="r571 r">errorSuggestion</span> ?? <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r570 r">target</span>, <b>typeof</b>(<b>int</b>), <a href="#ee39afdcd24db6ca" class="k">this</a>, -1);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="c5bddea29ef8ff29" href="../../../R/c5bddea29ef8ff29.html" target="n" data-glyph="76,1" class="i method">UnaryPlus</a>(<span class="i">DynamicMetaObject</span> <span id="r582 rd" class="r582 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r583 rd" class="r583 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r582 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r582 r">target</span>);
            }
 
            <b>if</b> (<span class="r582 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r582 r">target</span>.<span class="i">Value</span>) != <span class="r582 r">target</span>.<span class="i">Value</span>))
            {
                <b>return</b> <a href="#ee39afdcd24db6ca" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r582 r">target</span>);
            }
 
            <b>if</b> (<span class="r582 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>())
            {
                <b>var</b> <span id="r584 rd" class="r584 r">expr</span> = <span class="r582 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r582 r">target</span>.<span class="i">LimitType</span>);
                <b>if</b> (<span class="r582 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>byte</b>) || <span class="r582 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>sbyte</b>))
                {
                    <span class="c">// promote to int, unary plus doesn&#39;t support byte directly.</span>
                    <span class="r584 r">expr</span> = <span class="r584 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>int</b>));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">UnaryPlus</span>(<span class="r584 r">expr</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="r582 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <span class="c">// Use a nested dynamic site that adds 0.  This won&#39;t change the sign, but it will attempt conversions.  This is slower than it needs</span>
            <span class="c">// to be, but should be hit rarely.</span>
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a>.<span class="i">Get</span>(<span class="i">ExpressionType</span>.<span class="i">Add</span>), <b>typeof</b>(<b>object</b>), <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0), <span class="r582 r">target</span>.<span class="i">Expression</span>),
                                          <span class="r582 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="0344ef43ea659570" href="../../../R/0344ef43ea659570.html" target="n" data-glyph="76,1" class="i method">UnaryMinus</a>(<span class="i">DynamicMetaObject</span> <span id="r585 rd" class="r585 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r586 rd" class="r586 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r585 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r585 r">target</span>);
            }
 
            <b>if</b> (<span class="r585 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r585 r">target</span>.<span class="i">Value</span>) != <span class="r585 r">target</span>.<span class="i">Value</span>))
            {
                <b>return</b> <a href="#ee39afdcd24db6ca" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r585 r">target</span>);
            }
 
            <b>if</b> (<span class="r585 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>())
            {
                <b>var</b> <span id="r587 rd" class="r587 r">expr</span> = <span class="r585 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r585 r">target</span>.<span class="i">LimitType</span>);
                <b>if</b> (<span class="r585 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>byte</b>) || <span class="r585 r">target</span>.<span class="i">LimitType</span> == <b>typeof</b>(<b>sbyte</b>))
                {
                    <span class="c">// promote to int, unary plus doesn&#39;t support byte directly.</span>
                    <span class="r587 r">expr</span> = <span class="r587 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>int</b>));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Negate</span>(<span class="r587 r">expr</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                    <span class="r585 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <span class="c">// Use a nested dynamic site that subtracts from 0.  This won&#39;t change the sign, but it will attempt conversions.  This is slower than it needs</span>
            <span class="c">// to be, but should be hit rarely.</span>
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a>.<span class="i">Get</span>(<span class="i">ExpressionType</span>.<span class="i">Subtract</span>), <b>typeof</b>(<b>object</b>), <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0), <span class="r585 r">target</span>.<span class="i">Expression</span>),
                                          <span class="r585 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="beab7b2c0d2978ff" href="../../../R/beab7b2c0d2978ff.html" target="n" data-glyph="76,1" class="i method">IncrDecr</a>(<span class="i">DynamicMetaObject</span> <span id="r588 rd" class="r588 r">target</span>, <b>int</b> <span id="r589 rd" class="r589 r">valueToAdd</span>, <span class="i">DynamicMetaObject</span> <span id="r590 rd" class="r590 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r588 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r588 r">target</span>);
            }
 
            <b>if</b> (<span class="r588 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r588 r">target</span>.<span class="i">Value</span>) != <span class="r588 r">target</span>.<span class="i">Value</span>))
            {
                <b>return</b> <a href="#ee39afdcd24db6ca" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r588 r">target</span>);
            }
 
            <b>if</b> (<span class="r588 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(<span class="r589 r">valueToAdd</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="r588 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <b>if</b> (<span class="r588 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsNumeric</span>())
            {
                <b>var</b> <span id="r591 rd" class="r591 r">arg</span> = <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(<span class="r589 r">valueToAdd</span>), <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="r589 r">valueToAdd</span>);
                <b>var</b> <span id="r592 rd" class="r592 r">result</span> = <a href="#7b0e984617ab5e15" class="t t">PSBinaryOperationBinder</a>.<span class="i">Get</span>(<span class="i">ExpressionType</span>.<span class="i">Add</span>).<a href="#5c63288488a891a4" class="i method">FallbackBinaryOperation</a>(<span class="r588 r">target</span>, <span class="r591 r">arg</span>, <span class="r590 r">errorSuggestion</span>);
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="r592 r">result</span>.<span class="i">Expression</span>,
                    <span class="r588 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <b>return</b> <span class="r590 r">errorSuggestion</span> ?? <span class="r588 r">target</span>.<span class="i">ThrowRuntimeError</span>(
                <span class="i">Array</span>.<span class="i">Empty</span>&lt;<span class="i">DynamicMetaObject</span>&gt;(),
                <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>,
                <span class="s">&quot;OperatorRequiresNumber&quot;</span>,
                <span class="i">ParserStrings</span>.<span class="i">OperatorRequiresNumber</span>,
                <span class="i">Expression</span>.<span class="i">Constant</span>((<span class="i">Operation</span> == <span class="i">ExpressionType</span>.<span class="i">Increment</span> ? <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#93a18b78948c1c09" class="i field">PlusPlus</a> : <a href="../../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../../parser/token.cs.html#3d9a9ff2e958417f" class="i field">MinusMinus</a>).<a href="../../parser/token.cs.html#7fc630435d0dbb33" class="i method">Text</a>()),
                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r588 r">target</span>.<span class="i">LimitType</span>, <b>typeof</b>(<span class="i">Type</span>)));
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The binder for converting a value, e.g. [int]&quot;42&quot;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="97a1cf18399e4247" href="../../../R/97a1cf18399e4247.html" target="n" data-glyph="2,0" class="t t">PSConvertBinder</a> : <span class="i">ConvertBinder</span>
    {
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">Type</span>, <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>&gt; <a id="1585e09464b178fa" href="../../../R/1585e09464b178fa.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">Type</span>, <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>&gt;();
        <b>internal int</b> <a id="c28a0bd6486c37be" href="../../../R/c28a0bd6486c37be.html" target="n" data-glyph="44,1" class="i field">_version</a>;
 
        <b>public static</b> <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a> <a id="eda18cf3e4f03bf5" href="../../../R/eda18cf3e4f03bf5.html" target="n" data-glyph="72,1" class="i method">Get</a>(<span class="i">Type</span> <span id="r593 rd" class="r593 r">type</span>)
        {
            <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a> <span id="r594 rd" class="r594 r">result</span>;
 
            <b>lock</b> (<a href="#1585e09464b178fa" class="i field">s_binderCache</a>)
            {
                <b>if</b> (!<a href="#1585e09464b178fa" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r593 r">type</span>, <b>out</b> <span class="r594 r">result</span>))
                {
                    <span class="r594 r">result</span> = <b>new</b> <a href="#af62e631959c577d" class="t constructor">PSConvertBinder</a>(<span class="r593 r">type</span>);
                    <a href="#1585e09464b178fa" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r593 r">type</span>, <span class="r594 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r594 r">result</span>;
        }
 
        <b>private</b> <a id="af62e631959c577d" href="../../../R/af62e631959c577d.html" target="n" data-glyph="76,1" class="t constructor">PSConvertBinder</a>(<span class="i">Type</span> <span id="r595 rd" class="r595 r">type</span>)
            : <b>base</b>(<span class="r595 r">type</span>, <span class="c">/*explicit=*/</span><b>false</b>)
        {
            <a href="#97a1cf18399e4247" class="k">this</a>.<a href="#c28a0bd6486c37be" class="i field">_version</a> = 0;
            <b>if</b> (<span class="r595 r">type</span> == <b>typeof</b>(<b>string</b>))
            {
                <span class="i">CacheTarget</span>((<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>string</b>&gt;)(<span class="i">StringToStringRule</span>));
            }
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="7e0ce3fe0a07b38f" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackConvert</a>(<span class="i">DynamicMetaObject</span> <span id="r596 rd" class="r596 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r597 rd" class="r597 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r596 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r596 r">target</span>).<span class="i">WriteToDebugLog</span>(<a href="#97a1cf18399e4247" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r596 r">target</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">Expression</span>.<span class="i">Default</span>(<a href="#97a1cf18399e4247" class="k">this</a>.<span class="i">Type</span>), <span class="r596 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()).<span class="i">WriteToDebugLog</span>(<a href="#97a1cf18399e4247" class="k">this</a>);
            }
 
            <b>bool</b> <span id="r598 rd" class="r598 r">debase</span>;
            <b>var</b> <span id="r599 rd" class="r599 r">resultType</span> = <a href="#97a1cf18399e4247" class="k">this</a>.<span class="i">Type</span>;
 
            <span class="c">// ConstrainedLanguage note - this is the main conversion mechanism. If the runspace has ever used</span>
            <span class="c">// ConstrainedLanguage, then start baking in the language mode to the binding rules.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r600 rd" class="r600 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r596 r">target</span>.<span class="i">Value</span>, <span class="r599 r">resultType</span>, <b>out</b> <span class="r598 r">debase</span>);
 
            <b>if</b> (<span class="r597 r">errorSuggestion</span> != <b>null</b> &amp;&amp; <span class="r596 r">target</span>.<span class="i">Value</span> <b>is</b> <span class="i">DynamicObject</span>)
            {
                <b>return</b> <span class="r597 r">errorSuggestion</span>.<span class="i">WriteToDebugLog</span>(<a href="#97a1cf18399e4247" class="k">this</a>);
            }
 
            <span class="i">BindingRestrictions</span> <span id="r601 rd" class="r601 r">restrictions</span> = <span class="r596 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
            <span class="r601 r">restrictions</span> = <span class="r601 r">restrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetOptionalVersionAndLanguageCheckForType</span>(<a href="#97a1cf18399e4247" class="k">this</a>, <span class="r599 r">resultType</span>, <a href="#c28a0bd6486c37be" class="i field">_version</a>));
 
            <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">InvokeConverter</span>(<span class="r600 r">conversion</span>, <span class="r596 r">target</span>.<span class="i">Expression</span>, <span class="r599 r">resultType</span>, <span class="r598 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>),
                <span class="r601 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#97a1cf18399e4247" class="k">this</a>);
        }
 
        <b>public override string</b> <a id="3f185fa6df34fb41" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;PSConvertBinder [{0}]  ver:{1}&quot;</span>, <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<a href="../../../P/6fbe6ac0a6a7f8d2.html#6fbe6ac0a6a7f8d2" class="t t">ToStringCodeMethods</a>.<span class="i">Type</span>(<a href="#97a1cf18399e4247" class="k">this</a>.<span class="i">Type</span>, <b>true</b>), <a href="#c28a0bd6486c37be" class="i field">_version</a>);
        }
 
        <b>internal static void</b> <a id="1897d5538460e488" href="../../../R/1897d5538460e488.html" target="n" data-glyph="74,1" class="i method">InvalidateCache</a>()
        {
            <span class="c">// Invalidate binders</span>
            <b>lock</b> (<a href="#1585e09464b178fa" class="i field">s_binderCache</a>)
            {
                <b>foreach</b> (<a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a> <span id="r602 rd" class="r602 r">binder</span> <b>in</b> <a href="#1585e09464b178fa" class="i field">s_binderCache</a>.<span class="i">Values</span>)
                {
                    <span class="r602 r">binder</span>.<a href="#c28a0bd6486c37be" class="i field">_version</a> += 1;
                }
            }
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="667d4f187e61ce52" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ThrowNoConversion</a>(<span class="i">DynamicMetaObject</span> <span id="r603 rd" class="r603 r">target</span>, <span class="i">Type</span> <span id="r604 rd" class="r604 r">toType</span>, <span class="i">DynamicMetaObjectBinder</span> <span id="r605 rd" class="r605 r">binder</span>,
            <b>int</b> <span id="r606 rd" class="r606 r">currentVersion</span>, <b>params</b> <span class="i">DynamicMetaObject</span>[] <span id="r607 rd" class="r607 r">args</span>)
        {
            <span class="c">// No conversion, so the result expression raises an error:</span>
            <span class="c">//   throw new PSInvalidCastException(&quot;ConvertToFinalInvalidCastException&quot;, null,</span>
            <span class="c">//       ExtendedTypeSystem.InvalidCastException,</span>
            <span class="c">//       valueToConvert.ToString(), ObjectToTypeNameString(valueToConvert), resultType.ToString());</span>
 
            <span class="i">Expression</span> <span id="r608 rd" class="r608 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#7c6872852f680527" class="i field">LanguagePrimitives_ThrowInvalidCastException</a>,
                                              <span class="r603 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                              <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r604 r">toType</span>, <b>typeof</b>(<span class="i">Type</span>)));
 
            <b>if</b> (<span class="r605 r">binder</span>.<span class="i">ReturnType</span> != <b>typeof</b>(<b>void</b>))
            {
                <span class="r608 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(<span class="r608 r">expr</span>, <span class="i">Expression</span>.<span class="i">Default</span>(<span class="r605 r">binder</span>.<span class="i">ReturnType</span>));
            }
 
            <span class="i">BindingRestrictions</span> <span id="r609 rd" class="r609 r">bindingRestrictions</span> = <span class="r603 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r607 r">args</span>);
            <span class="r609 r">bindingRestrictions</span> = <span class="r609 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#b9c4efdf58739e7f" class="i method">GetOptionalVersionAndLanguageCheckForType</a>(<span class="r605 r">binder</span>, <span class="r604 r">toType</span>, <span class="r606 r">currentVersion</span>));
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r608 r">expr</span>, <span class="r609 r">bindingRestrictions</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Convert argument to a ByRef-like type via implicit or explicit conversion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r610 r">argument</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The argument to be converted to a ByRef-like type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r611 r">resultType</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ByRef-like type to convert to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Expression</span> <a id="8cc92418f1a853fa" href="../../../R/8cc92418f1a853fa.html" target="n" data-glyph="74,1" class="i method">ConvertToByRefLikeTypeViaCasting</a>(<span class="i">DynamicMetaObject</span> <span id="r610 rd" class="r610 r">argument</span>, <span class="i">Type</span> <span id="r611 rd" class="r611 r">resultType</span>)
        {
            <b>var</b> <span id="r612 rd" class="r612 r">baseObject</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r610 r">argument</span>.<span class="i">Value</span>);
 
            <span class="c">// Source value cannot be null or AutomationNull, and it cannot be a pure PSObject.</span>
            <b>if</b> (<span class="r612 r">baseObject</span> != <b>null</b> &amp;&amp; <span class="r612 r">baseObject</span> <b>is not</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
            {
                <span class="i">Type</span> <span id="r613 rd" class="r613 r">fromType</span> = <span class="r612 r">baseObject</span>.<span class="i">GetType</span>();
                <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a> <span id="r614 rd" class="r614 r">rank</span> = <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>;
 
                <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#09a5a9e9100e4d75" class="i method">FigureCastConversion</a>(<span class="r613 r">fromType</span>, <span class="r611 r">resultType</span>, <b>ref</b> <span class="r614 r">rank</span>);
                <b>if</b> (<span class="r614 r">rank</span> != <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
                {
                    <b>var</b> <span id="r615 rd" class="r615 r">valueToConvert</span> = <span class="r612 r">baseObject</span> == <span class="r610 r">argument</span>.<span class="i">Value</span>
                        ? <span class="r610 r">argument</span>.<span class="i">Expression</span>
                        : <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r610 r">argument</span>.<span class="i">Expression</span>);
 
                    <b>return</b> <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r615 r">valueToConvert</span>.<span class="i">Cast</span>(<span class="r613 r">fromType</span>), <span class="r611 r">resultType</span>);
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="4df89784e646b37c" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokeConverter</a>(<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="t t">IConversionData</a> <span id="r616 rd" class="r616 r">conversion</span>,
                                                   <span class="i">Expression</span> <span id="r617 rd" class="r617 r">value</span>,
                                                   <span class="i">Type</span> <span id="r618 rd" class="r618 r">resultType</span>,
                                                   <b>bool</b> <span id="r619 rd" class="r619 r">debase</span>,
                                                   <span class="i">Expression</span> <span id="r620 rd" class="r620 r">formatProvider</span>)
        {
            <span class="i">Expression</span> <span id="r621 rd" class="r621 r">conv</span>;
            <b>if</b> (<span class="r616 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#0c841bf014a77138" class="i field">Identity</a> || <span class="r616 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#6a83ff53b2a840f5" class="i field">Assignable</a>)
            {
                <span class="r621 r">conv</span> = <span class="r619 r">debase</span> ? <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r617 r">value</span>) : <span class="r617 r">value</span>;
            }
            <b>else</b>
            {
                <span class="i">Expression</span> <span id="r622 rd" class="r622 r">valueToConvert</span>, <span id="r623 rd" class="r623 r">valueAsPSObject</span>;
                <b>if</b> (<span class="r619 r">debase</span>)
                {
                    <span class="c">// Caller has verified the value is a PSObject.</span>
                    <span class="r622 r">valueToConvert</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r617 r">value</span>);
                    <span class="r623 r">valueAsPSObject</span> = <span class="r617 r">value</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>));
                }
                <b>else</b>
                {
                    <span class="c">// Caller has verified the value is not a PSObject, or that PSObject.Base should not be called.</span>
                    <span class="c">// If the object is some sort of PSObject, it&#39;s most likely a derived to base conversion.</span>
                    <span class="r622 r">valueToConvert</span> = <span class="r617 r">value</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                    <span class="r623 r">valueAsPSObject</span> = <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#d46c13d14b303a61" class="i field">NullPSObject</a>;
                }
 
                <span class="r621 r">conv</span> = <span class="i">Expression</span>.<span class="i">Call</span>(
                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r616 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#8b52e90c75297a45" class="i property">Converter</a>),
                    <span class="r616 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#8b52e90c75297a45" class="i property">Converter</a>.<span class="i">GetType</span>().<span class="i">GetMethod</span>(<span class="s">&quot;Invoke&quot;</span>),
                    <span class="c">/*valueToConvert=*/</span>         <span class="r622 r">valueToConvert</span>,
                    <span class="c">/*resultType=*/</span>             <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r618 r">resultType</span>, <b>typeof</b>(<span class="i">Type</span>)),
                    <span class="c">/*recurse=*/</span>                <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#8ae9528048f248a7" class="i method">Constant</a>(<b>true</b>),
                    <span class="c">/*originalValueToConvert=*/</span> <span class="r623 r">valueAsPSObject</span>,
                    <span class="c">/*formatProvider=*/</span>         <span class="r620 r">formatProvider</span>,
                    <span class="c">/*backupTable=*/</span>            <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#e15d44a06302fa69" class="i field">NullTypeTable</a>);
            }
 
            <span class="c">// Skip adding the Convert if unnecessary (same type), or impossible (InternalPSCustomObject)</span>
            <b>if</b> (<span class="r621 r">conv</span>.<span class="i">Type</span> == <span class="r618 r">resultType</span> || <span class="r618 r">resultType</span> == <b>typeof</b>(<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#f499f4c6b4eece87" class="t t">InternalPSCustomObject</a>))
            {
                <b>return</b> <span class="r621 r">conv</span>;
            }
 
            <b>if</b> (<span class="r618 r">resultType</span>.<span class="i">IsValueType</span> &amp;&amp; <span class="i">Nullable</span>.<span class="i">GetUnderlyingType</span>(<span class="r618 r">resultType</span>) == <b>null</b>)
            {
                <b>return</b> <span class="i">Expression</span>.<span class="i">Unbox</span>(<span class="r621 r">conv</span>, <span class="r618 r">resultType</span>);
            }
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r621 r">conv</span>, <span class="r618 r">resultType</span>);
        }
 
        <b>private static string</b> <a id="153422844cc9ecff" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StringToStringRule</a>(<span class="i">CallSite</span> <span id="r624 rd" class="r624 r">site</span>, <b>object</b> <span id="r625 rd" class="r625 r">obj</span>)
        {
            <b>var</b> <span id="r626 rd" class="r626 r">str</span> = <span class="r625 r">obj</span> <b>as string</b>;
            <b>return</b> <span class="r626 r">str</span> ?? ((<span class="i">CallSite</span>&lt;<span class="i">Func</span>&lt;<span class="i">CallSite</span>, <b>object</b>, <b>string</b>&gt;&gt;)<span class="r624 r">site</span>).<span class="i">Update</span>(<span class="r624 r">site</span>, <span class="r625 r">obj</span>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The binder to get the value of an indexable object, e.g. $x[1]</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="f5f4b5dd1e81524d" href="../../../R/f5f4b5dd1e81524d.html" target="n" data-glyph="2,0" class="t t">PSGetIndexBinder</a> : <span class="i">GetIndexBinder</span>
    {
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt;, <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>&gt; <a id="486b0cdd18552981" href="../../../R/486b0cdd18552981.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a>
                = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt;, <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>&gt;();
 
        <b>private readonly</b> <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <a id="48a401737feb216c" href="../../../R/48a401737feb216c.html" target="n" data-glyph="46,1" class="i field">_constraints</a>;
        <b>private readonly bool</b> <a id="7ec5b5ccb5d85cb5" href="../../../R/7ec5b5ccb5d85cb5.html" target="n" data-glyph="46,1" class="i field">_allowSlicing</a>;
        <b>internal int</b> <a id="b7d0126f41b32df7" href="../../../R/b7d0126f41b32df7.html" target="n" data-glyph="44,1" class="i field">_version</a>;
 
        <b>public static</b> <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a> <a id="b40e91138efa4156" href="../../../R/b40e91138efa4156.html" target="n" data-glyph="72,1" class="i method">Get</a>(<b>int</b> <span id="r627 rd" class="r627 r">argCount</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r628 rd" class="r628 r">constraints</span>, <b>bool</b> <span id="r629 rd" class="r629 r">allowSlicing</span> = <b>true</b>)
        {
            <b>lock</b> (<a href="#486b0cdd18552981" class="i field">s_binderCache</a>)
            {
                <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a> <span id="r630 rd" class="r630 r">binder</span>;
                <b>var</b> <span id="r631 rd" class="r631 r">tuple</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<b>new</b> <span class="i">CallInfo</span>(<span class="r627 r">argCount</span>), <span class="r628 r">constraints</span>, <span class="r629 r">allowSlicing</span>);
                <b>if</b> (!<a href="#486b0cdd18552981" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r631 r">tuple</span>, <b>out</b> <span class="r630 r">binder</span>))
                {
                    <span class="r630 r">binder</span> = <b>new</b> <span class="t">PSGetIndexBinder</span>(<span class="r631 r">tuple</span>);
                    <a href="#486b0cdd18552981" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r631 r">tuple</span>, <span class="r630 r">binder</span>);
                }
 
                <b>return</b> <span class="r630 r">binder</span>;
            }
        }
 
        <b>private</b> <a id="7d1b26b17e97be9d" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">PSGetIndexBinder</a>(<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt; <span id="r632 rd" class="r632 r">tuple</span>)
            : <b>base</b>(<span class="r632 r">tuple</span>.<span class="i">Item1</span>)
        {
            <a href="#48a401737feb216c" class="i field">_constraints</a> = <span class="r632 r">tuple</span>.<span class="i">Item2</span>;
            <a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a> = <span class="r632 r">tuple</span>.<span class="i">Item3</span>;
            <a href="#f5f4b5dd1e81524d" class="k">this</a>.<a href="#b7d0126f41b32df7" class="i field">_version</a> = 0;
        }
 
        <b>public override string</b> <a id="97678aca076db0bb" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                 <span class="s">&quot;PSGetIndexBinder indexCount={0}{1}{2} ver:{3}&quot;</span>,
                                 <a href="#f5f4b5dd1e81524d" class="k">this</a>.<span class="i">CallInfo</span>.<span class="i">ArgumentCount</span>,
                                 <a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a> ? <b>string</b>.<span class="i">Empty</span> : <span class="s">&quot; slicing disallowed&quot;</span>,
                                 <a href="#48a401737feb216c" class="i field">_constraints</a> == <b>null</b> ? <b>string</b>.<span class="i">Empty</span> : <span class="s">&quot; constraints: &quot;</span> + <a href="#48a401737feb216c" class="i field">_constraints</a>,
                                 <a href="#b7d0126f41b32df7" class="i field">_version</a>);
        }
 
        <b>internal static void</b> <a id="78b1e5e356d06aca" href="../../../R/78b1e5e356d06aca.html" target="n" data-glyph="74,1" class="i method">InvalidateCache</a>()
        {
            <span class="c">// Invalidate binders</span>
            <b>lock</b> (<a href="#486b0cdd18552981" class="i field">s_binderCache</a>)
            {
                <b>foreach</b> (<a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a> <span id="r633 rd" class="r633 r">binder</span> <b>in</b> <a href="#486b0cdd18552981" class="i field">s_binderCache</a>.<span class="i">Values</span>)
                {
                    <span class="r633 r">binder</span>.<a href="#b7d0126f41b32df7" class="i field">_version</a> += 1;
                }
            }
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="408cb8a884839bb0" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackGetIndex</a>(<span class="i">DynamicMetaObject</span> <span id="r634 rd" class="r634 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r635 rd" class="r635 r">indexes</span>, <span class="i">DynamicMetaObject</span> <span id="r636 rd" class="r636 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r634 r">target</span>.<span class="i">HasValue</span> || <span class="r635 r">indexes</span>.<span class="i">Any</span>(<b>static</b> <span id="r637 rd" class="r637 r">mo</span> =&gt; !<span class="r637 r">mo</span>.<span class="i">HasValue</span>))
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r635 r">indexes</span>.<span class="i">Prepend</span>(<span class="r634 r">target</span>).<span class="i">ToArray</span>()).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
            }
 
            <b>if</b> ((<span class="r634 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r634 r">target</span>.<span class="i">Value</span>) != <span class="r634 r">target</span>.<span class="i">Value</span>)) ||
                <span class="r635 r">indexes</span>.<span class="i">Any</span>(<b>static</b> <span id="r638 rd" class="r638 r">mo</span> =&gt; <span class="r638 r">mo</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r638 r">mo</span>.<span class="i">Value</span>) != <span class="r638 r">mo</span>.<span class="i">Value</span>)))
            {
                <b>return</b> <a href="#f5f4b5dd1e81524d" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r635 r">indexes</span>.<span class="i">Prepend</span>(<span class="r634 r">target</span>).<span class="i">ToArray</span>()).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
            }
 
            <span class="c">// Check if this is a COM Object</span>
            <span class="i">DynamicMetaObject</span> <span id="r639 rd" class="r639 r">comResult</span>;
            <b>if</b> (<span class="i n">ComInterop</span>.<a href="../../ComInterop/ComBinder.cs.html#16ed1709a95d9070" class="t t">ComBinder</a>.<span class="i">TryBindGetIndex</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>, <span class="r634 r">target</span>, <span class="r635 r">indexes</span>, <b>out</b> <span class="r639 r">comResult</span>))
            {
                <b>return</b> <span class="r639 r">comResult</span>.<a href="#ceefb8376e63f929" class="i method">UpdateComRestrictionsForPsObject</a>(<span class="r635 r">indexes</span>).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r634 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> (<span class="r636 r">errorSuggestion</span> ??
                        <span class="r634 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r635 r">indexes</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;NullArray&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">NullArray</span>)).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
            }
 
            <span class="c">// A null index is not allowed unless the index is one of the indices used while slicing, in which case we&#39;ll attempt</span>
            <span class="c">// the usual conversions from null to whatever the value being indexed supports.</span>
            <span class="c">// This is oddly inconsistent e.g.:</span>
            <span class="c">//     $a[$null] # error</span>
            <span class="c">//     $a[$null,$null] # no error, result is an empty array</span>
            <span class="c">// The rationale: V1/V2 did it, and when people are slicing, it&#39;s better to return some of the results than none.</span>
            <b>if</b> (<span class="r635 r">indexes</span>.<span class="i">Length</span> == 1 &amp;&amp; <span class="r635 r">indexes</span>[0].<span class="i">Value</span> == <b>null</b> &amp;&amp; <a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a>)
            {
                <b>return</b> (<span class="r636 r">errorSuggestion</span> ??
                        <span class="r634 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r635 r">indexes</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;NullArrayIndex&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">NullArrayIndex</span>)).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r634 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsArray</span>)
            {
                <b>return</b> <a href="#1a95b6c4fac07e17" class="i method">GetIndexArray</a>(<span class="r634 r">target</span>, <span class="r635 r">indexes</span>, <span class="r636 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
            }
 
            <b>var</b> <span id="r640 rd" class="r640 r">defaultMember</span> = <span class="r634 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetCustomAttributes</span>&lt;<span class="i">DefaultMemberAttribute</span>&gt;(<b>true</b>).<span class="i">FirstOrDefault</span>();
            <span class="i">PropertyInfo</span> <span id="r641 rd" class="r641 r">lengthProperty</span> = <b>null</b>;
            <b>foreach</b> (<b>var</b> <span id="r642 rd" class="r642 r">i</span> <b>in</b> <span class="r634 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetInterfaces</span>())
            {
                <b>if</b> (<span class="r642 r">i</span>.<span class="i">IsGenericType</span> &amp;&amp; <span class="r642 r">i</span>.<span class="i">GetGenericTypeDefinition</span>() == <b>typeof</b>(<span class="i">IDictionary</span>&lt;,&gt;))
                {
                    <b>var</b> <span id="r643 rd" class="r643 r">result</span> = <span class="i">GetIndexDictionary</span>(<span class="r634 r">target</span>, <span class="r635 r">indexes</span>, <span class="r642 r">i</span>);
                    <b>if</b> (<span class="r643 r">result</span> != <b>null</b>)
                    {
                        <b>return</b> <span class="r643 r">result</span>.<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
                    }
                }
 
                <span class="c">// If the type explicitly implements an indexer specified by an interface</span>
                <span class="c">// then the DefaultMemberAttribute will not carry over to the implementation.</span>
                <span class="c">// This check will catch those cases.</span>
                <b>if</b> (<span class="r640 r">defaultMember</span> == <b>null</b>)
                {
                    <span class="r640 r">defaultMember</span> = <span class="r642 r">i</span>.<span class="i">GetCustomAttributes</span>&lt;<span class="i">DefaultMemberAttribute</span>&gt;(<span class="i">inherit</span>: <b>false</b>).<span class="i">FirstOrDefault</span>();
                    <b>if</b> (<span class="r640 r">defaultMember</span> != <b>null</b>)
                    {
                        <span class="r641 r">lengthProperty</span> = <span class="r642 r">i</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Count&quot;</span>) ?? <span class="r642 r">i</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Length&quot;</span>);
                    }
                }
            }
 
            <b>if</b> (<span class="r640 r">defaultMember</span> != <b>null</b>)
            {
                <b>return</b> <span class="i">InvokeIndexer</span>(<span class="r634 r">target</span>, <span class="r635 r">indexes</span>, <span class="r636 r">errorSuggestion</span>, <span class="r640 r">defaultMember</span>.<span class="i">MemberName</span>, <span class="r641 r">lengthProperty</span>).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
            }
 
            <b>return</b> <span class="r636 r">errorSuggestion</span> ?? <a href="#72094673b3b88e34" class="i method">CannotIndexTarget</a>(<span class="r634 r">target</span>, <span class="r635 r">indexes</span>).<span class="i">WriteToDebugLog</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="72094673b3b88e34" href="../../../R/72094673b3b88e34.html" target="n" data-glyph="76,1" class="i method">CannotIndexTarget</a>(<span class="i">DynamicMetaObject</span> <span id="r644 rd" class="r644 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r645 rd" class="r645 r">indexes</span>)
        {
            <span class="c">// We want to have</span>
            <span class="c">//    $x[0]</span>
            <span class="c">// Be equivalent to</span>
            <span class="c">//    $x</span>
            <span class="c">// When $x doesn&#39;t have any other way of being indexed.  If the index is anything other than 0, we&#39;ll</span>
            <span class="c">// throw an error.</span>
            <span class="c">//</span>
            <span class="c">// The motivation for this magic is largely driven by the desire to avoid breaking scripts written around</span>
            <span class="c">// workflows.  A workflow that wrote a single object to the pipeline had always returned a collection, so</span>
            <span class="c">// scripts needed to index.  This semantic doesn&#39;t match the script semantics - a single object written is</span>
            <span class="c">// not wrapped in a collection.  The inconsistency had to be addressed, but this code had to be added to</span>
            <span class="c">// avoid breaking partner scripts.</span>
 
            <span class="c">// Add version / language checks</span>
            <span class="i">BindingRestrictions</span> <span id="r646 rd" class="r646 r">bindingRestrictions</span> = <span class="r644 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r645 r">indexes</span>);
 
            <span class="c">// This may be thrown due to a type that was disallowed only due to constrained language.</span>
            <span class="c">// Because of this, we also need a version check</span>
            <span class="r646 r">bindingRestrictions</span> = <span class="r646 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>, <a href="#b7d0126f41b32df7" class="i field">_version</a>));
 
            <span class="c">// Also add a language mode check to detect toggling between language modes</span>
            <span class="r646 r">bindingRestrictions</span> = <span class="r646 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#6a24b97403a40c85" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>());
 
            <b>var</b> <span id="r647 rd" class="r647 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#5195da915115ed33" class="i field">ArrayOps_GetNonIndexable</a>, <span class="r644 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                       <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="r645 r">indexes</span>.<span class="i">Select</span>(<b>static</b> <span id="r648 rd" class="r648 r">d</span> =&gt; <span class="r648 r">d</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))));
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r647 r">call</span>, <span class="r646 r">bindingRestrictions</span>);
        }
 
        <span class="c">// Index a generic dictionary via TryGetValue.  This routine does not handle slicing,</span>
        <span class="c">// we defer to InvokeIndexer to handle slicing (dictionaries also support general indexing.)</span>
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="febe1d3f349b87d9" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetIndexDictionary</a>(<span class="i">DynamicMetaObject</span> <span id="r649 rd" class="r649 r">target</span>,
                                                     <span class="i">DynamicMetaObject</span>[] <span id="r650 rd" class="r650 r">indexes</span>,
                                                     <span class="i">Type</span> <span id="r651 rd" class="r651 r">idictionary</span>)
        {
            <b>if</b> (<span class="r650 r">indexes</span>.<span class="i">Length</span> &gt; 1)
            {
                <span class="c">// Let InvokeIndexer generate the slicing code, we wouldn&#39;t generate anything special here.</span>
                <b>return</b> <b>null</b>;
            }
 
            <b>var</b> <span id="r652 rd" class="r652 r">tryGetValue</span> = <span class="r651 r">idictionary</span>.<span class="i">GetMethod</span>(<span class="s">&quot;TryGetValue&quot;</span>);
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r652 r">tryGetValue</span> != <b>null</b>, <span class="s">&quot;IDictionary&lt;K,V&gt; has TryGetValue&quot;</span>);
 
            <b>var</b> <span id="r653 rd" class="r653 r">parameters</span> = <span class="r652 r">tryGetValue</span>.<span class="i">GetParameters</span>();
            <b>bool</b> <span id="r654 rd" class="r654 r">debase</span>;
            <b>var</b> <span id="r655 rd" class="r655 r">keyType</span> = <span class="r653 r">parameters</span>[0].<span class="i">ParameterType</span>;
 
            <span class="c">// ConstrainedLanguage note - Calls to this conversion are protected by the binding rules below</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r656 rd" class="r656 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r650 r">indexes</span>[0].<span class="i">Value</span>, <span class="r655 r">keyType</span>, <b>out</b> <span class="r654 r">debase</span>);
            <b>if</b> (<span class="r656 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
            {
                <span class="c">// No conversion allows us to call TryGetValue, let InvokeIndexer make the decision (possibly</span>
                <span class="c">// slicing, or possibly just invoke the indexer.</span>
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (<span class="r650 r">indexes</span>[0].<span class="i">LimitType</span>.<span class="i">IsArray</span> &amp;&amp; !<span class="r655 r">keyType</span>.<span class="i">IsArray</span>)
            {
                <span class="c">// There was a conversion, but it&#39;s far more likely (and backwards compatible) that we want to do slicing</span>
                <b>return</b> <b>null</b>;
            }
 
            <span class="i">BindingRestrictions</span> <span id="r657 rd" class="r657 r">bindingRestrictions</span> = <span class="r649 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r650 r">indexes</span>);
            <span class="r657 r">bindingRestrictions</span> = <span class="r657 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetOptionalVersionAndLanguageCheckForType</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>, <span class="r655 r">keyType</span>, <a href="#b7d0126f41b32df7" class="i field">_version</a>));
 
            <b>var</b> <span id="r658 rd" class="r658 r">keyExpr</span> = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r656 r">conversion</span>, <span class="r650 r">indexes</span>[0].<span class="i">Expression</span>, <span class="r655 r">keyType</span>, <span class="r654 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
            <b>var</b> <span id="r659 rd" class="r659 r">outParam</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r653 r">parameters</span>[1].<span class="i">ParameterType</span>.<span class="i">GetElementType</span>(), <span class="s">&quot;outParam&quot;</span>);
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Block</span>(
                    <b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r659 r">outParam</span> },
                    <span class="i">Expression</span>.<span class="i">Condition</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r649 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r651 r">idictionary</span>), <span class="r652 r">tryGetValue</span>, <span class="r658 r">keyExpr</span>, <span class="r659 r">outParam</span>),
                        <span class="r659 r">outParam</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                        <a href="#594e3977d00ff499" class="i method">GetNullResult</a>())),
                <span class="r657 r">bindingRestrictions</span>);
        }
 
        <b>internal static bool</b> <a id="4628eefcd1bfd52e" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CanIndexFromEndWithNegativeIndex</a>(
            <span class="i">DynamicMetaObject</span> <span id="r660 rd" class="r660 r">target</span>,
            <span class="i">MethodInfo</span> <span id="r661 rd" class="r661 r">indexer</span>,
            <span class="i">ParameterInfo</span>[] <span id="r662 rd" class="r662 r">getterParams</span>)
        {
            <span class="c">// PowerShell supports negative indexing for types that meet the following criteria:</span>
            <span class="c">//      - Indexer method accepts one parameter that is typed as int</span>
            <span class="c">//      - The int parameter is not a type argument from a constructed generic type</span>
            <span class="c">//        (this is to exclude indexers for types that could use a negative index as</span>
            <span class="c">//        a valid key like System.Linq.ILookup)</span>
            <span class="c">//      - Declares a &quot;Count&quot; or &quot;Length&quot; property</span>
            <span class="c">//      - Does not inherit from IDictionary&lt;&gt; as that is handled earlier in the binder</span>
            <span class="c">// For those types, generate special code to check for negative indices, otherwise just generate</span>
            <span class="c">// the call. Before we test for the above criteria explicitly, we will determine if the</span>
            <span class="c">// target is of a type known to be compatible. This is done to avoid the call to Module.ResolveMethod</span>
            <span class="c">// when possible.</span>
 
            <b>if</b> (<span class="r662 r">getterParams</span>.<span class="i">Length</span> != 1 || <span class="r662 r">getterParams</span>[0].<span class="i">ParameterType</span> != <b>typeof</b>(<b>int</b>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="i">Type</span> <span id="r663 rd" class="r663 r">limitType</span> = <span class="r660 r">target</span>.<span class="i">LimitType</span>;
            <b>if</b> (<span class="r663 r">limitType</span>.<span class="i">IsArray</span> || <span class="r663 r">limitType</span> == <b>typeof</b>(<b>string</b>) || <span class="r663 r">limitType</span> == <b>typeof</b>(<span class="i">StringBuilder</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<b>typeof</b>(<span class="i">IList</span>).<span class="i">IsAssignableFrom</span>(<span class="r663 r">limitType</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<b>typeof</b>(<span class="i">OrderedDictionary</span>).<span class="i">IsAssignableFrom</span>(<span class="r663 r">limitType</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// target implements IList&lt;T&gt;?</span>
            <b>if</b> (<span class="r663 r">limitType</span>.<span class="i">GetInterfaces</span>().<span class="i">Any</span>(<span id="r664 rd" class="r664 r">i</span> =&gt; <span class="r664 r">i</span>.<span class="i">IsGenericType</span> &amp;&amp; <span class="r664 r">i</span>.<span class="i">GetGenericTypeDefinition</span>() == <b>typeof</b>(<span class="i">IList</span>&lt;&gt;)))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// Get the base method definition of the indexer to determine if the int</span>
            <span class="c">// parameter is a generic type parameter. Module.ResolveMethod is used</span>
            <span class="c">// because the indexer could be a method from a constructed generic type.</span>
            <span class="i">MethodBase</span> <span id="r665 rd" class="r665 r">baseMethod</span> = <span class="r661 r">indexer</span>.<span class="i">Module</span>.<span class="i">ResolveMethod</span>(<span class="r661 r">indexer</span>.<span class="i">MetadataToken</span>);
            <b>return</b> !<span class="r665 r">baseMethod</span>.<span class="i">GetParameters</span>()[0].<span class="i">ParameterType</span>.<span class="i">IsGenericParameter</span>;
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="a1531656ce1c5792" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IndexWithNegativeChecks</a>(
            <span class="i">DynamicMetaObject</span> <span id="r666 rd" class="r666 r">target</span>,
            <span class="i">DynamicMetaObject</span> <span id="r667 rd" class="r667 r">index</span>,
            <span class="i">PropertyInfo</span> <span id="r668 rd" class="r668 r">lengthProperty</span>,
            <span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>, <span class="i">Expression</span>&gt; <span id="r669 rd" class="r669 r">generateIndexOperation</span>)
        {
            <span class="c">// Generate:</span>
            <span class="c">//    try {</span>
            <span class="c">//       len = obj.Length</span>
            <span class="c">//       if (index &lt; 0)</span>
            <span class="c">//           index = index + len</span>
            <span class="c">//       obj[index]</span>
            <span class="c">//    } catch (Exception e) {</span>
            <span class="c">//        if (StrictMode(3)) { throw }</span>
            <span class="c">//        $null</span>
            <span class="c">//    }</span>
 
            <b>var</b> <span id="r670 rd" class="r670 r">targetTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r666 r">target</span>.<span class="i">LimitType</span>, <span class="s">&quot;target&quot;</span>);
            <b>var</b> <span id="r671 rd" class="r671 r">lenTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>int</b>), <span class="s">&quot;len&quot;</span>);
            <b>var</b> <span id="r672 rd" class="r672 r">indexTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>int</b>), <span class="s">&quot;index&quot;</span>);
 
            <span class="i">Expression</span> <span id="r673 rd" class="r673 r">block</span> = <span class="i">Expression</span>.<span class="i">Block</span>(
                <b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r670 r">targetTmp</span>, <span class="r671 r">lenTmp</span>, <span class="r672 r">indexTmp</span> },
                <span class="c">// Save the target because we use it multiple times.</span>
                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r670 r">targetTmp</span>, <span class="r666 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r666 r">target</span>.<span class="i">LimitType</span>)),
                <span class="c">// Save the length because we use it multiple times.</span>
                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r671 r">lenTmp</span>,
                                  <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r670 r">targetTmp</span>, <span class="r668 r">lengthProperty</span>)),
                <span class="c">// Save the index because we use it multiple times</span>
                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r672 r">indexTmp</span>, <span class="r667 r">index</span>.<span class="i">Expression</span>),
                <span class="c">// Adjust the index if it&#39;s negative</span>
                <span class="i">Expression</span>.<span class="i">IfThen</span>(<span class="i">Expression</span>.<span class="i">LessThan</span>(<span class="r672 r">indexTmp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)),
                                  <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r672 r">indexTmp</span>, <span class="i">Expression</span>.<span class="i">Add</span>(<span class="r672 r">indexTmp</span>, <span class="r671 r">lenTmp</span>))),
                <span class="c">// Generate the index operation</span>
                <span class="r669 r">generateIndexOperation</span>(<span class="r670 r">targetTmp</span>, <span class="r672 r">indexTmp</span>));
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="c">// Do the indexing within a try/catch so we can return $null if the index is out of bounds,</span>
                <span class="c">// or if the index cast fails, e.g. $a = @(1); $a[&#39;abc&#39;]</span>
                <a href="#ed1d4c43a96b5b89" class="i method">SafeIndexResult</a>(<span class="r673 r">block</span>),
                <span class="r666 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r667 r">index</span>));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="1a95b6c4fac07e17" href="../../../R/1a95b6c4fac07e17.html" target="n" data-glyph="76,1" class="i method">GetIndexArray</a>(<span class="i">DynamicMetaObject</span> <span id="r674 rd" class="r674 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r675 rd" class="r675 r">indexes</span>, <span class="i">DynamicMetaObject</span> <span id="r676 rd" class="r676 r">errorSuggestion</span>)
        {
            <b>var</b> <span id="r677 rd" class="r677 r">array</span> = (<span class="i">Array</span>)<span class="r674 r">target</span>.<span class="i">Value</span>;
 
            <b>if</b> (<span class="r677 r">array</span>.<span class="i">Rank</span> &gt; 1)
            {
                <b>return</b> <a href="#99fa5557f9e54afe" class="i method">GetIndexMultiDimensionArray</a>(<span class="r674 r">target</span>, <span class="r675 r">indexes</span>, <span class="r676 r">errorSuggestion</span>);
            }
 
            <b>if</b> (<span class="r675 r">indexes</span>.<span class="i">Length</span> &gt; 1)
            {
                <span class="c">// If the binder allows slicing, we&#39;re definitely slicing, otherwise,</span>
                <span class="c">// calling the indexer will fail because there are either too many or too few indices, so</span>
                <span class="c">// throw an error in that case (and not null.)</span>
                <b>return</b> <a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a>
                           ? <a href="#769603c650215092" class="i method">InvokeSlicingIndexer</a>(<span class="r674 r">target</span>, <span class="r675 r">indexes</span>)
                           : (<span class="r676 r">errorSuggestion</span> ?? <a href="#72094673b3b88e34" class="i method">CannotIndexTarget</a>(<span class="r674 r">target</span>, <span class="r675 r">indexes</span>));
            }
 
            <b>var</b> <span id="r678 rd" class="r678 r">slicingResult</span> = <a href="#4fba774ec8e24191" class="i method">CheckForSlicing</a>(<span class="r674 r">target</span>, <span class="r675 r">indexes</span>);
            <b>if</b> (<span class="r678 r">slicingResult</span> != <b>null</b>)
            {
                <b>return</b> <span class="r678 r">slicingResult</span>;
            }
 
            <b>var</b> <span id="r679 rd" class="r679 r">indexAsInt</span> = <span class="i">ConvertIndex</span>(<span class="r675 r">indexes</span>[0], <b>typeof</b>(<b>int</b>));
            <b>if</b> (<span class="r679 r">indexAsInt</span> == <b>null</b>)
            {
                <span class="c">// Calling the indexer will fail because we can&#39;t convert an index to the correct type.</span>
                <b>return</b> <span class="r676 r">errorSuggestion</span> ?? <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r674 r">target</span>, <b>typeof</b>(<b>int</b>), <a href="#f5f4b5dd1e81524d" class="k">this</a>, <a href="#b7d0126f41b32df7" class="i field">_version</a>, <span class="r675 r">indexes</span>);
            }
 
            <b>return</b> <span class="i">IndexWithNegativeChecks</span>(
                <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r674 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r674 r">target</span>.<span class="i">LimitType</span>), <span class="r674 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r679 r">indexAsInt</span>, <span class="r675 r">indexes</span>[0].<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                <span class="r674 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Length&quot;</span>),
                <b>static</b> (<span id="r680 rd" class="r680 r">t</span>, <span id="r681 rd" class="r681 r">i</span>) =&gt; <span class="i">Expression</span>.<span class="i">ArrayIndex</span>(<span class="r680 r">t</span>, <span class="r681 r">i</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="99fa5557f9e54afe" href="../../../R/99fa5557f9e54afe.html" target="n" data-glyph="76,1" class="i method">GetIndexMultiDimensionArray</a>(<span class="i">DynamicMetaObject</span> <span id="r682 rd" class="r682 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r683 rd" class="r683 r">indexes</span>, <span class="i">DynamicMetaObject</span> <span id="r684 rd" class="r684 r">errorSuggestion</span>)
        {
            <span class="c">// We have lots of possibilities here</span>
            <span class="c">//</span>
            <span class="c">//   * single index - enumerable, all ints</span>
            <span class="c">//        - single result, count must match array rank</span>
            <span class="c">//   * single index - enumerable, all enumerable of ints</span>
            <span class="c">//        - slicing, falls back to previous case</span>
            <span class="c">//   * multiple indices - all ints</span>
            <span class="c">//        - single result, must match array rank</span>
            <span class="c">//   * multiple indices - enumerable of ints</span>
            <span class="c">//        - slicing, falls back to first case</span>
            <span class="c">//</span>
            <span class="c">// In script, the above cases look like:</span>
            <span class="c">//     $x = [array]::CreateInstance([int], 3, 3)</span>
            <span class="c">//     $y = 0,0</span>
            <span class="c">//     $z = $y,$y</span>
            <span class="c">//     $x[$y] # case 1</span>
            <span class="c">//     $x[$z] # case 2</span>
            <span class="c">//     $x[1,1] # case 3</span>
            <span class="c">//     $x[(1,1),(0,0)] # case 4</span>
 
            <b>var</b> <span id="r685 rd" class="r685 r">array</span> = (<span class="i">Array</span>)<span class="r682 r">target</span>.<span class="i">Value</span>;
 
            <b>if</b> (<span class="r683 r">indexes</span>.<span class="i">Length</span> == 1)
            {
                <b>var</b> <span id="r686 rd" class="r686 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r683 r">indexes</span>[0]);
                <b>if</b> (<span class="r686 r">enumerable</span> == <b>null</b>)
                {
                    <b>return</b> <span class="r682 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r683 r">indexes</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;NeedMultidimensionalIndex&quot;</span>,
                                                    <span class="i">ParserStrings</span>.<span class="i">NeedMultidimensionalIndex</span>,
                                                    <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<span class="r685 r">array</span>.<span class="i">Rank</span>),
                                                    <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#db2e7c67b332caf6" class="t t">PSToStringBinder</a>.<a href="#7a771c568a738822" class="i method">Get</a>(), <b>typeof</b>(<b>string</b>),
                                                                              <span class="r683 r">indexes</span>[0].<span class="i">Expression</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#ecffc532d73edd94" class="i field">ArrayOps_GetMDArrayValueOrSlice</a>,
                                    <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r682 r">target</span>.<span class="i">Expression</span>, <b>typeof</b>(<span class="i">Array</span>)),
                                    <span class="r683 r">indexes</span>[0].<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    <span class="r682 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r683 r">indexes</span>));
            }
 
            <b>var</b> <span id="r687 rd" class="r687 r">intIndexes</span> = <span class="r683 r">indexes</span>.<span class="i">Select</span>(<b>static</b> <span id="r688 rd" class="r688 r">index</span> =&gt; <span class="i">ConvertIndex</span>(<span class="r688 r">index</span>, <b>typeof</b>(<b>int</b>))).<span class="i">Where</span>(<b>static</b> <span id="r689 rd" class="r689 r">i</span> =&gt; <span class="r689 r">i</span> != <b>null</b>).<span class="i">ToArray</span>();
            <b>if</b> (<span class="r687 r">intIndexes</span>.<span class="i">Length</span> != <span class="r683 r">indexes</span>.<span class="i">Length</span>)
            {
                <b>if</b> (!<a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a>)
                {
                    <b>return</b> <span class="r684 r">errorSuggestion</span> ?? <a href="#72094673b3b88e34" class="i method">CannotIndexTarget</a>(<span class="r682 r">target</span>, <span class="r683 r">indexes</span>);
                }
 
                <b>return</b> <a href="#769603c650215092" class="i method">InvokeSlicingIndexer</a>(<span class="r682 r">target</span>, <span class="r683 r">indexes</span>);
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#92da8e8e3b9aa2b8" class="i field">ArrayOps_GetMDArrayValue</a>,
                                <span class="i">Expression</span>.<span class="i">Convert</span>(<span class="r682 r">target</span>.<span class="i">Expression</span>, <b>typeof</b>(<span class="i">Array</span>)),
                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>int</b>), <span class="r687 r">intIndexes</span>),
                                <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(!<a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a>)),
                <span class="r682 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r683 r">indexes</span>));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="a463a76985dca6f2" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InvokeIndexer</a>(<span class="i">DynamicMetaObject</span> <span id="r690 rd" class="r690 r">target</span>,
                                                <span class="i">DynamicMetaObject</span>[] <span id="r691 rd" class="r691 r">indexes</span>,
                                                <span class="i">DynamicMetaObject</span> <span id="r692 rd" class="r692 r">errorSuggestion</span>,
                                                <b>string</b> <span id="r693 rd" class="r693 r">methodName</span>,
                                                <span class="i">PropertyInfo</span> <span id="r694 rd" class="r694 r">lengthProperty</span>)
        {
            <span class="i">MethodInfo</span> <span id="r695 rd" class="r695 r">getter</span> = <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<span class="i">FindBestMethod</span>(<span class="r690 r">target</span>, <span class="r691 r">indexes</span>, <span class="s">&quot;get_&quot;</span> + <span class="r693 r">methodName</span>, <b>false</b>, <a href="#48a401737feb216c" class="i field">_constraints</a>);
 
            <b>if</b> (<span class="r695 r">getter</span> == <b>null</b>)
            {
                <b>return</b> <a href="#4fba774ec8e24191" class="i method">CheckForSlicing</a>(<span class="r690 r">target</span>, <span class="r691 r">indexes</span>) ?? <span class="r692 r">errorSuggestion</span> ?? <a href="#72094673b3b88e34" class="i method">CannotIndexTarget</a>(<span class="r690 r">target</span>, <span class="r691 r">indexes</span>);
            }
 
            <b>var</b> <span id="r696 rd" class="r696 r">getterParams</span> = <span class="r695 r">getter</span>.<span class="i">GetParameters</span>();
            <b>if</b> (<span class="r696 r">getterParams</span>.<span class="i">Length</span> != <span class="r691 r">indexes</span>.<span class="i">Length</span>)
            {
                <b>if</b> (<span class="r696 r">getterParams</span>.<span class="i">Length</span> == 1 &amp;&amp; <a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a>)
                {
                    <span class="c">// We have a slicing operation.</span>
                    <b>return</b> <a href="#769603c650215092" class="i method">InvokeSlicingIndexer</a>(<span class="r690 r">target</span>, <span class="r691 r">indexes</span>);
                }
 
                <span class="c">// Calling the indexer will fail because there are either too many or too few indices.</span>
                <b>return</b> <span class="r692 r">errorSuggestion</span> ?? <a href="#72094673b3b88e34" class="i method">CannotIndexTarget</a>(<span class="r690 r">target</span>, <span class="r691 r">indexes</span>);
            }
 
            <b>if</b> (<span class="r696 r">getterParams</span>.<span class="i">Length</span> == 1)
            {
                <span class="c">// The getter takes a single argument, so first check if we&#39;re slicing.</span>
                <b>var</b> <span id="r697 rd" class="r697 r">slicingResult</span> = <a href="#4fba774ec8e24191" class="i method">CheckForSlicing</a>(<span class="r690 r">target</span>, <span class="r691 r">indexes</span>);
                <b>if</b> (<span class="r697 r">slicingResult</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r697 r">slicingResult</span>;
                }
            }
 
            <b>if</b> (<span class="r695 r">getter</span>.<span class="i">ReturnType</span>.<span class="i">IsByRefLike</span>)
            {
                <span class="c">// We cannot return a ByRef-like value in PowerShell, so we disallow getting such an indexer.</span>
                <b>return</b> <span class="r692 r">errorSuggestion</span> ?? <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Block</span>(
                        <span class="i">Expression</span>.<span class="i">IfThen</span>(
                            <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#5a5c94283e952580" class="i method">IsStrictMode</a>(3),
                            <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeError</span>(
                                <b>nameof</b>(<span class="i">ParserStrings</span>.<span class="i">CannotIndexWithByRefLikeReturnType</span>),
                                <span class="i">ParserStrings</span>.<span class="i">CannotIndexWithByRefLikeReturnType</span>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r690 r">target</span>.<span class="i">LimitType</span>, <b>typeof</b>(<span class="i">Type</span>)),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r695 r">getter</span>.<span class="i">ReturnType</span>, <b>typeof</b>(<span class="i">Type</span>)))),
                        <a href="#594e3977d00ff499" class="i method">GetNullResult</a>()),
                    <span class="r690 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <span class="i">Expression</span>[] <span id="r698 rd" class="r698 r">indexExprs</span> = <b>new</b> <span class="i">Expression</span>[<span class="r696 r">getterParams</span>.<span class="i">Length</span>];
            <b>for</b> (<b>int</b> <span id="r699 rd" class="r699 r">i</span> = 0; <span class="r699 r">i</span> &lt; <span class="r696 r">getterParams</span>.<span class="i">Length</span>; ++<span class="r699 r">i</span>)
            {
                <b>var</b> <span id="r700 rd" class="r700 r">parameterType</span> = <span class="r696 r">getterParams</span>[<span class="r699 r">i</span>].<span class="i">ParameterType</span>;
                <span class="r698 r">indexExprs</span>[<span class="r699 r">i</span>] = <span class="r700 r">parameterType</span>.<span class="i">IsByRefLike</span>
                    ? <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ConvertToByRefLikeTypeViaCasting</span>(<span class="r691 r">indexes</span>[<span class="r699 r">i</span>], <span class="r700 r">parameterType</span>)
                    : <span class="i">ConvertIndex</span>(<span class="r691 r">indexes</span>[<span class="r699 r">i</span>], <span class="r700 r">parameterType</span>);
 
                <b>if</b> (<span class="r698 r">indexExprs</span>[<span class="r699 r">i</span>] == <b>null</b>)
                {
                    <span class="c">// Calling the indexer will fail because we can&#39;t convert an index to the correct type.</span>
                    <b>return</b> <span class="r692 r">errorSuggestion</span> ?? <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r690 r">target</span>, <span class="r700 r">parameterType</span>, <a href="#f5f4b5dd1e81524d" class="k">this</a>, <a href="#b7d0126f41b32df7" class="i field">_version</a>, <span class="r691 r">indexes</span>);
                }
            }
 
            <b>if</b> (<span class="i">CanIndexFromEndWithNegativeIndex</span>(<span class="r690 r">target</span>, <span class="r695 r">getter</span>, <span class="r696 r">getterParams</span>))
            {
                <b>if</b> (<span class="r694 r">lengthProperty</span> == <b>null</b>)
                {
                    <span class="c">// Count is declared by most supported types, Length will catch some edge cases like strings.</span>
                    <span class="r694 r">lengthProperty</span> = <span class="r690 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Count&quot;</span>) ??
                                     <span class="r690 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Length&quot;</span>);
                }
 
                <b>if</b> (<span class="r694 r">lengthProperty</span> != <b>null</b>)
                {
                    <b>return</b> <span class="i">IndexWithNegativeChecks</span>(
                        <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r690 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r690 r">target</span>.<span class="i">LimitType</span>),
                                              <span class="r690 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                        <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r698 r">indexExprs</span>[0], <span class="r691 r">indexes</span>[0].<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                        <span class="r694 r">lengthProperty</span>,
                        (<span id="r701 rd" class="r701 r">t</span>, <span id="r702 rd" class="r702 r">i</span>) =&gt; <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r701 r">t</span>, <span class="r695 r">getter</span>, <span class="r702 r">i</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
                }
            }
 
            <span class="c">// An indexer may do conversion to an unsafe type, so we need version checks</span>
            <span class="i">BindingRestrictions</span> <span id="r703 rd" class="r703 r">bindingRestrictions</span> = <span class="r690 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r691 r">indexes</span>);
            <span class="r703 r">bindingRestrictions</span> = <span class="r703 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#f5f4b5dd1e81524d" class="k">this</a>, <a href="#b7d0126f41b32df7" class="i field">_version</a>));
 
            <span class="c">// Also add a language mode check to detect toggling between language modes</span>
            <span class="r703 r">bindingRestrictions</span> = <span class="r703 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#6a24b97403a40c85" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>());
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">SafeIndexResult</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<span class="r690 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r695 r">getter</span>.<span class="i">DeclaringType</span>), <span class="r695 r">getter</span>, <span class="r698 r">indexExprs</span>)),
                <span class="r703 r">bindingRestrictions</span>);
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="c4a478132bd61670" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">ConvertIndex</a>(<span class="i">DynamicMetaObject</span> <span id="r704 rd" class="r704 r">index</span>, <span class="i">Type</span> <span id="r705 rd" class="r705 r">resultType</span>)
        {
            <span class="c">// ConstrainedLanguage note - Calls to this conversion are protected by the binding rules that call it.</span>
            <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r706 rd" class="r706 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r704 r">index</span>.<span class="i">Value</span>, <span class="r705 r">resultType</span>, <b>out bool</b> <span id="r707 rd" class="r707 r">debase</span>);
            <b>return</b> <span class="r706 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> == <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>
                       ? <b>null</b>
                       : <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r706 r">conversion</span>, <span class="r704 r">index</span>.<span class="i">Expression</span>, <span class="r705 r">resultType</span>, <span class="r707 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="4fba774ec8e24191" href="../../../R/4fba774ec8e24191.html" target="n" data-glyph="76,1" class="i method">CheckForSlicing</a>(<span class="i">DynamicMetaObject</span> <span id="r708 rd" class="r708 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r709 rd" class="r709 r">indexes</span>)
        {
            <b>if</b> (!<a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (<span class="r709 r">indexes</span>.<span class="i">Length</span> &gt; 1)
            {
                <a href="#f5f4b5dd1e81524d" class="k">var</a> <span id="r710 rd" class="r710 r">nonSlicingBinder</span> = <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<a href="#b40e91138efa4156" class="i method">Get</a>(1, <a href="#48a401737feb216c" class="i field">_constraints</a>, <span class="r629 r">allowSlicing</span>: <b>false</b>);
                <b>var</b> <span id="r711 rd" class="r711 r">expr</span> = <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                    <span class="r709 r">indexes</span>.<span class="i">Select</span>(<span id="r712 rd" class="r712 r">i</span> =&gt; <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<span class="r710 r">nonSlicingBinder</span>, <b>typeof</b>(<b>object</b>), <span class="r708 r">target</span>.<span class="i">Expression</span>, <span class="r712 r">i</span>.<span class="i">Expression</span>)));
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r711 r">expr</span>, <span class="r708 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r709 r">indexes</span>));
            }
 
            <b>var</b> <span id="r713 rd" class="r713 r">enumerableIndex</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r709 r">indexes</span>[0]);
            <b>if</b> (<span class="r713 r">enumerableIndex</span> != <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#8db14ea056a86501" class="i field">EnumerableOps_SlicingIndex</a>,
                                    <span class="r708 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                    <span class="r713 r">enumerableIndex</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">IEnumerator</span>)),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="#c011ac74c0902ef3" class="i method">GetNonSlicingIndexer</a>())),
                    <span class="r708 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r713 r">enumerableIndex</span>));
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="769603c650215092" href="../../../R/769603c650215092.html" target="n" data-glyph="76,1" class="i method">InvokeSlicingIndexer</a>(<span class="i">DynamicMetaObject</span> <span id="r714 rd" class="r714 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r715 rd" class="r715 r">indexes</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a>, <span class="s">&quot;Slicing is not recursive&quot;</span>);
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#2c82148f1c223438" class="i field">ArrayOps_SlicingIndex</a>,
                                <span class="r714 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                                        <span class="r715 r">indexes</span>.<span class="i">Select</span>(<b>static</b> <span id="r716 rd" class="r716 r">dmo</span> =&gt; <span class="r716 r">dmo</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="#c011ac74c0902ef3" class="i method">GetNonSlicingIndexer</a>())),
                <span class="r714 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r715 r">indexes</span>));
        }
 
        <b>private</b> <span class="i">Expression</span> <a id="ed1d4c43a96b5b89" href="../../../R/ed1d4c43a96b5b89.html" target="n" data-glyph="76,1" class="i method">SafeIndexResult</a>(<span class="i">Expression</span> <span id="r717 rd" class="r717 r">expr</span>)
        {
            <b>var</b> <span id="r718 rd" class="r718 r">exception</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<span class="i">Exception</span>));
            <b>return</b> <span class="i">Expression</span>.<span class="i">TryCatch</span>(
                <span class="r717 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                <span class="i">Expression</span>.<span class="i">Catch</span>(
                    <span class="r718 r">exception</span>,
                    <span class="i">Expression</span>.<span class="i">Block</span>(
                        <span class="i">Expression</span>.<span class="i">IfThen</span>(<a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#5a5c94283e952580" class="i method">IsStrictMode</a>(3), <span class="i">Expression</span>.<span class="i">Rethrow</span>()),
                        <a href="#594e3977d00ff499" class="i method">GetNullResult</a>())));
        }
 
        <b>private</b> <span class="i">Expression</span> <a id="594e3977d00ff499" href="../../../R/594e3977d00ff499.html" target="n" data-glyph="76,1" class="i method">GetNullResult</a>()
        {
            <b>return</b> <a href="#7ec5b5ccb5d85cb5" class="i field">_allowSlicing</a> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a> : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#84591f5e881dc39e" class="i field">AutomationNullConstant</a>;
        }
 
        <b>private</b> <span class="i">Func</span>&lt;<b>object</b>, <b>object</b>, <b>object</b>&gt; <a id="c011ac74c0902ef3" href="../../../R/c011ac74c0902ef3.html" target="n" data-glyph="76,1" class="i method">GetNonSlicingIndexer</a>()
        {
            <span class="c">// Rather than cache a single delegate, we create one for each generated rule under the assumption</span>
            <span class="c">// that, although the generated rule may be used in multiple sites, it&#39;s better to have</span>
            <span class="c">// multiple delegates (and hence, multiple nested sites) rather than a single nested site for</span>
            <span class="c">// all non-slicing indexing.</span>
            <b>var</b> <span id="r719 rd" class="r719 r">targetParamExpr</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>object</b>));
            <b>var</b> <span id="r720 rd" class="r720 r">indexParamExpr</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>object</b>));
            <b>return</b> <span class="i">Expression</span>.<span class="i">Lambda</span>&lt;<span class="i">Func</span>&lt;<b>object</b>, <b>object</b>, <b>object</b>&gt;&gt;(
                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<a href="#b40e91138efa4156" class="i method">Get</a>(1, <a href="#48a401737feb216c" class="i field">_constraints</a>, <span class="r629 r">allowSlicing</span>: <b>false</b>), <b>typeof</b>(<b>object</b>), <span class="r719 r">targetParamExpr</span>,
                                          <span class="r720 r">indexParamExpr</span>),
                <span class="r719 r">targetParamExpr</span>, <span class="r720 r">indexParamExpr</span>).<span class="i">Compile</span>();
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The binder for setting the value of an indexable element, like $x[1] = 5.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="4efa6869376d725f" href="../../../R/4efa6869376d725f.html" target="n" data-glyph="2,0" class="t t">PSSetIndexBinder</a> : <span class="i">SetIndexBinder</span>
    {
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt;, <a href="#4efa6869376d725f" class="t t">PSSetIndexBinder</a>&gt; <a id="09db742ba3f41b57" href="../../../R/09db742ba3f41b57.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a>
                = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt;, <a href="#4efa6869376d725f" class="t t">PSSetIndexBinder</a>&gt;();
 
        <b>private readonly</b> <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <a id="9588d7af0e63779d" href="../../../R/9588d7af0e63779d.html" target="n" data-glyph="46,1" class="i field">_constraints</a>;
        <b>internal int</b> <a id="b0e978fb9de22375" href="../../../R/b0e978fb9de22375.html" target="n" data-glyph="44,1" class="i field">_version</a>;
 
        <b>public static</b> <a href="#4efa6869376d725f" class="t t">PSSetIndexBinder</a> <a id="f4014536e121a2b0" href="../../../R/f4014536e121a2b0.html" target="n" data-glyph="72,1" class="i method">Get</a>(<b>int</b> <span id="r721 rd" class="r721 r">argCount</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r722 rd" class="r722 r">constraints</span> = <b>null</b>)
        {
            <b>lock</b> (<a href="#09db742ba3f41b57" class="i field">s_binderCache</a>)
            {
                <a href="#4efa6869376d725f" class="t t">PSSetIndexBinder</a> <span id="r723 rd" class="r723 r">binder</span>;
                <b>var</b> <span id="r724 rd" class="r724 r">tuple</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<b>new</b> <span class="i">CallInfo</span>(<span class="r721 r">argCount</span>), <span class="r722 r">constraints</span>);
                <b>if</b> (!<a href="#09db742ba3f41b57" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r724 r">tuple</span>, <b>out</b> <span class="r723 r">binder</span>))
                {
                    <span class="r723 r">binder</span> = <b>new</b> <span class="t">PSSetIndexBinder</span>(<span class="r724 r">tuple</span>);
                    <a href="#09db742ba3f41b57" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r724 r">tuple</span>, <span class="r723 r">binder</span>);
                }
 
                <b>return</b> <span class="r723 r">binder</span>;
            }
        }
 
        <b>private</b> <a id="6860c4ed70cecde2" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">PSSetIndexBinder</a>(<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt; <span id="r725 rd" class="r725 r">tuple</span>)
            : <b>base</b>(<span class="r725 r">tuple</span>.<span class="i">Item1</span>)
        {
            <a href="#9588d7af0e63779d" class="i field">_constraints</a> = <span class="r725 r">tuple</span>.<span class="i">Item2</span>;
            <a href="#4efa6869376d725f" class="k">this</a>.<a href="#b0e978fb9de22375" class="i field">_version</a> = 0;
        }
 
        <b>public override string</b> <a id="b12f7c554b423271" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;PSSetIndexBinder indexCnt={0}{1} ver:{2}&quot;</span>,
                <span class="i">CallInfo</span>.<span class="i">ArgumentCount</span>, <a href="#9588d7af0e63779d" class="i field">_constraints</a> == <b>null</b> ? <b>string</b>.<span class="i">Empty</span> : <span class="s">&quot; constraints: &quot;</span> + <a href="#9588d7af0e63779d" class="i field">_constraints</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>);
        }
 
        <b>internal static void</b> <a id="4d9ffc6d5940cbcb" href="../../../R/4d9ffc6d5940cbcb.html" target="n" data-glyph="74,1" class="i method">InvalidateCache</a>()
        {
            <span class="c">// Invalidate binders</span>
            <b>lock</b> (<a href="#09db742ba3f41b57" class="i field">s_binderCache</a>)
            {
                <b>foreach</b> (<a href="#4efa6869376d725f" class="t t">PSSetIndexBinder</a> <span id="r726 rd" class="r726 r">binder</span> <b>in</b> <a href="#09db742ba3f41b57" class="i field">s_binderCache</a>.<span class="i">Values</span>)
                {
                    <span class="r726 r">binder</span>.<a href="#b0e978fb9de22375" class="i field">_version</a> += 1;
                }
            }
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="c674c9285d40c859" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackSetIndex</a>(
            <span class="i">DynamicMetaObject</span> <span id="r727 rd" class="r727 r">target</span>,
            <span class="i">DynamicMetaObject</span>[] <span id="r728 rd" class="r728 r">indexes</span>,
            <span class="i">DynamicMetaObject</span> <span id="r729 rd" class="r729 r">value</span>,
            <span class="i">DynamicMetaObject</span> <span id="r730 rd" class="r730 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r727 r">target</span>.<span class="i">HasValue</span> || <span class="r728 r">indexes</span>.<span class="i">Any</span>(<b>static</b> <span id="r731 rd" class="r731 r">mo</span> =&gt; !<span class="r731 r">mo</span>.<span class="i">HasValue</span>) || !<span class="r729 r">value</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r728 r">indexes</span>.<span class="i">Prepend</span>(<span class="r727 r">target</span>).<span class="i">Append</span>(<span class="r729 r">value</span>).<span class="i">ToArray</span>()).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r727 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r727 r">target</span>.<span class="i">Value</span>) != <span class="r727 r">target</span>.<span class="i">Value</span>) ||
                <span class="r728 r">indexes</span>.<span class="i">Any</span>(<b>static</b> <span id="r732 rd" class="r732 r">mo</span> =&gt; <span class="r732 r">mo</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r732 r">mo</span>.<span class="i">Value</span>) != <span class="r732 r">mo</span>.<span class="i">Value</span>)))
            {
                <b>return</b> <a href="#4efa6869376d725f" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r728 r">indexes</span>.<span class="i">Prepend</span>(<span class="r727 r">target</span>).<span class="i">Append</span>(<span class="r729 r">value</span>).<span class="i">ToArray</span>()).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>);
            }
 
            <span class="c">// Check if this is a COM Object</span>
            <span class="i">DynamicMetaObject</span> <span id="r733 rd" class="r733 r">result</span>;
            <b>if</b> (<span class="i n">ComInterop</span>.<a href="../../ComInterop/ComBinder.cs.html#16ed1709a95d9070" class="t t">ComBinder</a>.<span class="i">TryBindSetIndex</span>(<a href="#4efa6869376d725f" class="k">this</a>, <span class="r727 r">target</span>, <span class="r728 r">indexes</span>, <span class="r729 r">value</span>, <b>out</b> <span class="r733 r">result</span>))
            {
                <b>return</b> <span class="r733 r">result</span>.<a href="#ceefb8376e63f929" class="i method">UpdateComRestrictionsForPsObject</a>(<span class="r728 r">indexes</span>).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r727 r">target</span>.<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> (<span class="r730 r">errorSuggestion</span> ??
                        <span class="r727 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r728 r">indexes</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;NullArray&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">NullArray</span>)).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r728 r">indexes</span>.<span class="i">Length</span> == 1 &amp;&amp; <span class="r728 r">indexes</span>[0].<span class="i">Value</span> == <b>null</b>)
            {
                <b>return</b> (<span class="r730 r">errorSuggestion</span> ??
                        <span class="r727 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r728 r">indexes</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;NullArrayIndex&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">NullArrayIndex</span>).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>));
            }
 
            <b>if</b> (<span class="r727 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsArray</span>)
            {
                <b>return</b> <a href="#3bbea5bdb6bfccb6" class="i method">SetIndexArray</a>(<span class="r727 r">target</span>, <span class="r728 r">indexes</span>, <span class="r729 r">value</span>, <span class="r730 r">errorSuggestion</span>).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>);
            }
 
            <b>var</b> <span id="r734 rd" class="r734 r">defaultMember</span> = <span class="r727 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetCustomAttributes</span>&lt;<span class="i">DefaultMemberAttribute</span>&gt;(<b>true</b>).<span class="i">FirstOrDefault</span>();
            <b>if</b> (<span class="r734 r">defaultMember</span> != <b>null</b>)
            {
                <b>return</b> (<span class="i">InvokeIndexer</span>(<span class="r727 r">target</span>, <span class="r728 r">indexes</span>, <span class="r729 r">value</span>, <span class="r730 r">errorSuggestion</span>, <span class="r734 r">defaultMember</span>.<span class="i">MemberName</span>)).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>);
            }
 
            <b>return</b> <span class="r730 r">errorSuggestion</span> ?? <a href="#41e88be5058faae8" class="i method">CannotIndexTarget</a>(<span class="r727 r">target</span>, <span class="r728 r">indexes</span>, <span class="r729 r">value</span>).<span class="i">WriteToDebugLog</span>(<a href="#4efa6869376d725f" class="k">this</a>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="41e88be5058faae8" href="../../../R/41e88be5058faae8.html" target="n" data-glyph="76,1" class="i method">CannotIndexTarget</a>(<span class="i">DynamicMetaObject</span> <span id="r735 rd" class="r735 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r736 rd" class="r736 r">indexes</span>, <span class="i">DynamicMetaObject</span> <span id="r737 rd" class="r737 r">value</span>)
        {
            <span class="i">BindingRestrictions</span> <span id="r738 rd" class="r738 r">bindingRestrictions</span> = <span class="r737 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
            <span class="r738 r">bindingRestrictions</span> = <span class="r738 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>));
 
            <span class="c">// Also add a language mode check to detect toggling between language modes</span>
            <span class="r738 r">bindingRestrictions</span> = <span class="r738 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#6a24b97403a40c85" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>());
 
            <b>return</b> <span class="r735 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r736 r">indexes</span>, <span class="r738 r">bindingRestrictions</span>, <span class="s">&quot;CannotIndex&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">CannotIndex</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r735 r">target</span>.<span class="i">LimitType</span>, <b>typeof</b>(<span class="i">Type</span>)));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="d4d57d006d05a9af" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InvokeIndexer</a>(
            <span class="i">DynamicMetaObject</span> <span id="r739 rd" class="r739 r">target</span>,
            <span class="i">DynamicMetaObject</span>[] <span id="r740 rd" class="r740 r">indexes</span>,
            <span class="i">DynamicMetaObject</span> <span id="r741 rd" class="r741 r">value</span>,
            <span class="i">DynamicMetaObject</span> <span id="r742 rd" class="r742 r">errorSuggestion</span>,
            <b>string</b> <span id="r743 rd" class="r743 r">methodName</span>)
        {
            <span class="i">MethodInfo</span> <span id="r744 rd" class="r744 r">setter</span> = <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<span class="i">FindBestMethod</span>(<span class="r739 r">target</span>, <span class="r740 r">indexes</span>.<span class="i">Append</span>(<span class="r741 r">value</span>), <span class="s">&quot;set_&quot;</span> + <span class="r743 r">methodName</span>, <b>false</b>, <a href="#9588d7af0e63779d" class="i field">_constraints</a>);
 
            <b>if</b> (<span class="r744 r">setter</span> == <b>null</b>)
            {
                <b>return</b> <span class="r742 r">errorSuggestion</span> ?? <a href="#41e88be5058faae8" class="i method">CannotIndexTarget</a>(<span class="r739 r">target</span>, <span class="r740 r">indexes</span>, <span class="r741 r">value</span>);
            }
 
            <b>var</b> <span id="r745 rd" class="r745 r">setterParams</span> = <span class="r744 r">setter</span>.<span class="i">GetParameters</span>();
            <b>int</b> <span id="r746 rd" class="r746 r">paramLength</span> = <span class="r745 r">setterParams</span>.<span class="i">Length</span>;
 
            <b>if</b> (<span class="r746 r">paramLength</span> != <span class="r740 r">indexes</span>.<span class="i">Length</span> + 1)
            {
                <span class="c">// Calling the indexer will fail because there are either too many or too few indices.</span>
                <b>return</b> <span class="r742 r">errorSuggestion</span> ?? <a href="#41e88be5058faae8" class="i method">CannotIndexTarget</a>(<span class="r739 r">target</span>, <span class="r740 r">indexes</span>, <span class="r741 r">value</span>);
            }
 
            <b>if</b> (<span class="r745 r">setterParams</span>[<span class="r746 r">paramLength</span> - 1].<span class="i">ParameterType</span>.<span class="i">IsByRefLike</span>)
            {
                <span class="c">// In theory, it&#39;s possible to call the setter with a value that can be implicitly/explicitly casted to the target ByRef-like type.</span>
                <span class="c">// However, the set-property/set-indexer semantics in PowerShell requires returning the value after the setting operation. We cannot</span>
                <span class="c">// return a ByRef-like value back, so we just disallow setting an indexer that takes a ByRef-like type value.</span>
                <b>return</b> <span class="r742 r">errorSuggestion</span> ?? <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeError</span>(
                        <b>nameof</b>(<span class="i">ParserStrings</span>.<span class="i">CannotIndexWithByRefLikeReturnType</span>),
                        <span class="i">ParserStrings</span>.<span class="i">CannotIndexWithByRefLikeReturnType</span>,
                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r739 r">target</span>.<span class="i">LimitType</span>, <b>typeof</b>(<span class="i">Type</span>)),
                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r745 r">setterParams</span>[<span class="r746 r">paramLength</span> - 1].<span class="i">ParameterType</span>, <b>typeof</b>(<span class="i">Type</span>))),
                    <span class="r739 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
 
            <span class="i">Expression</span>[] <span id="r747 rd" class="r747 r">indexExprs</span> = <b>new</b> <span class="i">Expression</span>[<span class="r746 r">paramLength</span>];
            <b>for</b> (<b>int</b> <span id="r748 rd" class="r748 r">i</span> = 0; <span class="r748 r">i</span> &lt; <span class="r746 r">paramLength</span>; ++<span class="r748 r">i</span>)
            {
                <b>var</b> <span id="r749 rd" class="r749 r">parameterType</span> = <span class="r745 r">setterParams</span>[<span class="r748 r">i</span>].<span class="i">ParameterType</span>;
                <b>var</b> <span id="r750 rd" class="r750 r">argument</span> = (<span class="r748 r">i</span> == <span class="r746 r">paramLength</span> - 1) ? <span class="r741 r">value</span> : <span class="r740 r">indexes</span>[<span class="r748 r">i</span>];
 
                <span class="r747 r">indexExprs</span>[<span class="r748 r">i</span>] = <span class="r749 r">parameterType</span>.<span class="i">IsByRefLike</span>
                    ? <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ConvertToByRefLikeTypeViaCasting</span>(<span class="r750 r">argument</span>, <span class="r749 r">parameterType</span>)
                    : <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<span class="i">ConvertIndex</span>(<span class="r750 r">argument</span>, <span class="r749 r">parameterType</span>);
 
                <b>if</b> (<span class="r747 r">indexExprs</span>[<span class="r748 r">i</span>] == <b>null</b>)
                {
                    <span class="c">// Calling the indexer will fail because we can&#39;t convert an index to the correct type.</span>
                    <b>return</b> <span class="r742 r">errorSuggestion</span> ?? <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r739 r">target</span>, <span class="r749 r">parameterType</span>, <a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>, <span class="r740 r">indexes</span>.<span class="i">Append</span>(<span class="r741 r">value</span>).<span class="i">ToArray</span>());
                }
            }
 
            <b>if</b> (<span class="r746 r">paramLength</span> == 2
                &amp;&amp; <span class="r745 r">setterParams</span>[0].<span class="i">ParameterType</span> == <b>typeof</b>(<b>int</b>)
                &amp;&amp; <span class="r739 r">target</span>.<span class="i">Value</span> <b>is not</b> <span class="i">IDictionary</span>)
            {
                <span class="c">// PowerShell supports negative indexing for some types (specifically, those with a single</span>
                <span class="c">// int parameter to the indexer, and also have either a Length or Count property.)  For</span>
                <span class="c">// those types, generate special code to check for negative indices, otherwise just generate</span>
                <span class="c">// the call.</span>
                <span class="i">PropertyInfo</span> <span id="r751 rd" class="r751 r">lengthProperty</span> = <span class="r739 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Length&quot;</span>) ??
                                              <span class="r739 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Count&quot;</span>);
 
                <b>if</b> (<span class="r751 r">lengthProperty</span> != <b>null</b>)
                {
                    <b>return</b> <span class="i">IndexWithNegativeChecks</span>(
                        <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r739 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r739 r">target</span>.<span class="i">LimitType</span>),
                                              <span class="r739 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                        <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r747 r">indexExprs</span>[0], <span class="r740 r">indexes</span>[0].<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                        <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r747 r">indexExprs</span>[1], <span class="r741 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                        <span class="r751 r">lengthProperty</span>,
                        (<span id="r752 rd" class="r752 r">t</span>, <span id="r753 rd" class="r753 r">i</span>, <span id="r754 rd" class="r754 r">v</span>) =&gt; <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r752 r">t</span>, <span class="r744 r">setter</span>, <span class="r753 r">i</span>, <span class="r754 r">v</span>));
                }
            }
 
            <span class="i">BindingRestrictions</span> <span id="r755 rd" class="r755 r">bindingRestrictions</span> = <span class="r739 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r740 r">indexes</span>).<span class="i">Merge</span>(<span class="r741 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
 
            <span class="c">// Add the version checks and (potentially) language mode checks, as this setter</span>
            <span class="c">// may invoke a conversion to an unsafe type.</span>
            <span class="r755 r">bindingRestrictions</span> = <span class="r755 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>));
 
            <span class="c">// Also add a language mode check to detect toggling between language modes</span>
            <span class="r755 r">bindingRestrictions</span> = <span class="r755 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#6a24b97403a40c85" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>());
 
            <span class="c">// We&#39;ll store the value in a temp so we can return it.  We&#39;ll also replace the expr in our array of arguments</span>
            <span class="c">// to the indexer with the temp so any conversions are executed just once.</span>
            <b>var</b> <span id="r756 rd" class="r756 r">valExpr</span> = <span class="r747 r">indexExprs</span>[<span class="r747 r">indexExprs</span>.<span class="i">Length</span> - 1];
            <b>var</b> <span id="r757 rd" class="r757 r">valTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r756 r">valExpr</span>.<span class="i">Type</span>, <span class="s">&quot;value&quot;</span>);
            <span class="r747 r">indexExprs</span>[<span class="r747 r">indexExprs</span>.<span class="i">Length</span> - 1] = <span class="r757 r">valTmp</span>;
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Block</span>(
                    <b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r757 r">valTmp</span> },
                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r757 r">valTmp</span>, <span class="r756 r">valExpr</span>),
                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r739 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r744 r">setter</span>.<span class="i">DeclaringType</span>), <span class="r744 r">setter</span>, <span class="r747 r">indexExprs</span>),
                    <span class="r757 r">valTmp</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                <span class="r755 r">bindingRestrictions</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="925d904ff8ac67ee" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IndexWithNegativeChecks</a>(
            <span class="i">DynamicMetaObject</span> <span id="r758 rd" class="r758 r">target</span>,
            <span class="i">DynamicMetaObject</span> <span id="r759 rd" class="r759 r">index</span>,
            <span class="i">DynamicMetaObject</span> <span id="r760 rd" class="r760 r">value</span>,
            <span class="i">PropertyInfo</span> <span id="r761 rd" class="r761 r">lengthProperty</span>,
            <span class="i">Func</span>&lt;<span class="i">Expression</span>, <span class="i">Expression</span>, <span class="i">Expression</span>, <span class="i">Expression</span>&gt; <span id="r762 rd" class="r762 r">generateIndexOperation</span>)
        {
            <span class="i">BindingRestrictions</span> <span id="r763 rd" class="r763 r">bindingRestrictions</span> = <span class="r758 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r759 r">index</span>).<span class="i">Merge</span>(<span class="r760 r">value</span>.<span class="i">Restrictions</span>);
 
            <span class="c">// If the target is of an unsafe type for ConstrainedLanguage, we need to pay</span>
            <span class="c">// attention to version and language mode. Otherwise, strongly-typed arrays of unsafe types</span>
            <span class="c">// can be used for type conversion.</span>
            <span class="r763 r">bindingRestrictions</span> = <span class="r763 r">bindingRestrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetOptionalVersionAndLanguageCheckForType</span>(<a href="#4efa6869376d725f" class="k">this</a>, <span class="r758 r">target</span>.<span class="i">LimitType</span>, <a href="#b0e978fb9de22375" class="i field">_version</a>));
 
            <span class="c">// Generate:</span>
            <span class="c">//    len = obj.Length</span>
            <span class="c">//    if (index &lt; 0)</span>
            <span class="c">//        index = index + len</span>
            <span class="c">//    obj[index] = value</span>
            <b>var</b> <span id="r764 rd" class="r764 r">targetTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r758 r">target</span>.<span class="i">LimitType</span>, <span class="s">&quot;target&quot;</span>);
            <b>var</b> <span id="r765 rd" class="r765 r">lenTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>int</b>), <span class="s">&quot;len&quot;</span>);
            <b>var</b> <span id="r766 rd" class="r766 r">valueExpr</span> = <span class="r760 r">value</span>.<span class="i">Expression</span>;
            <b>var</b> <span id="r767 rd" class="r767 r">valTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<span class="r766 r">valueExpr</span>.<span class="i">Type</span>, <span class="s">&quot;value&quot;</span>);
            <b>var</b> <span id="r768 rd" class="r768 r">indexTmp</span> = <span class="i">Expression</span>.<span class="i">Parameter</span>(<b>typeof</b>(<b>int</b>), <span class="s">&quot;index&quot;</span>);
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Block</span>(
                    <b>new</b> <span class="i">ParameterExpression</span>[] { <span class="r764 r">targetTmp</span>, <span class="r767 r">valTmp</span>, <span class="r765 r">lenTmp</span>, <span class="r768 r">indexTmp</span> },
                    <span class="c">// Save the target because we use it multiple times.</span>
                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r764 r">targetTmp</span>, <span class="r758 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r758 r">target</span>.<span class="i">LimitType</span>)),
                    <span class="c">// Save the value because it too is used multiple times, but only to keep the DLR happy</span>
                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r767 r">valTmp</span>, <span class="r766 r">valueExpr</span>),
                    <span class="c">// Save the length because we use it multiple times.</span>
                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r765 r">lenTmp</span>,
                                      <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r764 r">targetTmp</span>, <span class="r761 r">lengthProperty</span>)),
                    <span class="c">// Save the index because we use it multiple times</span>
                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r768 r">indexTmp</span>, <span class="r759 r">index</span>.<span class="i">Expression</span>),
                    <span class="c">// Adjust the index if it&#39;s negative</span>
                    <span class="i">Expression</span>.<span class="i">IfThen</span>(<span class="i">Expression</span>.<span class="i">LessThan</span>(<span class="r768 r">indexTmp</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0)),
                                      <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r768 r">indexTmp</span>, <span class="i">Expression</span>.<span class="i">Add</span>(<span class="r768 r">indexTmp</span>, <span class="r765 r">lenTmp</span>))),
                    <span class="c">// Do the indexing</span>
                    <span class="r762 r">generateIndexOperation</span>(<span class="r764 r">targetTmp</span>, <span class="r768 r">indexTmp</span>, <span class="r767 r">valTmp</span>),
                    <span class="c">// Make sure the result of this operation is the value.  PowerShell won&#39;t use this value</span>
                    <span class="c">// in any way, but the DLR requires it (and in theory, if PSObject uses this binder, other</span>
                    <span class="c">// languages could use this value.)</span>
                    <span class="r767 r">valTmp</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                <span class="r763 r">bindingRestrictions</span>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="3bbea5bdb6bfccb6" href="../../../R/3bbea5bdb6bfccb6.html" target="n" data-glyph="76,1" class="i method">SetIndexArray</a>(<span class="i">DynamicMetaObject</span> <span id="r769 rd" class="r769 r">target</span>,
                                                <span class="i">DynamicMetaObject</span>[] <span id="r770 rd" class="r770 r">indexes</span>,
                                                <span class="i">DynamicMetaObject</span> <span id="r771 rd" class="r771 r">value</span>,
                                                <span class="i">DynamicMetaObject</span> <span id="r772 rd" class="r772 r">errorSuggestion</span>)
        {
            <b>var</b> <span id="r773 rd" class="r773 r">array</span> = (<span class="i">Array</span>)<span class="r769 r">target</span>.<span class="i">Value</span>;
 
            <b>if</b> (<span class="r773 r">array</span>.<span class="i">Rank</span> &gt; 1)
            {
                <b>return</b> <a href="#3036faf51d4e1b9c" class="i method">SetIndexMultiDimensionArray</a>(<span class="r769 r">target</span>, <span class="r770 r">indexes</span>, <span class="r771 r">value</span>, <span class="r772 r">errorSuggestion</span>);
            }
 
            <b>if</b> (<span class="r770 r">indexes</span>.<span class="i">Length</span> &gt; 1)
            {
                <b>return</b> <span class="r772 r">errorSuggestion</span> ??
                       <span class="r769 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r770 r">indexes</span>, <span class="r771 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>(), <span class="s">&quot;ArraySliceAssignmentFailed&quot;</span>,
                                                <span class="i">ParserStrings</span>.<span class="i">ArraySliceAssignmentFailed</span>,
                                                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4f0af9e268afdbc6" class="i field">ArrayOps_IndexStringMessage</a>,
                                                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                                                                        <span class="r770 r">indexes</span>.<span class="i">Select</span>(<b>static</b> <span id="r774 rd" class="r774 r">i</span> =&gt; <span class="r774 r">i</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))))));
            }
 
            <b>var</b> <span id="r775 rd" class="r775 r">intIndex</span> = <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<span class="i">ConvertIndex</span>(<span class="r770 r">indexes</span>[0], <b>typeof</b>(<b>int</b>));
            <b>if</b> (<span class="r775 r">intIndex</span> == <b>null</b>)
            {
                <b>return</b> <span class="r772 r">errorSuggestion</span> ??
                       <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r770 r">indexes</span>[0], <b>typeof</b>(<b>int</b>), <a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>, <span class="r769 r">target</span>, <span class="r771 r">value</span>);
            }
 
            <b>var</b> <span id="r776 rd" class="r776 r">elementType</span> = <span class="r769 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetElementType</span>();
            <b>var</b> <span id="r777 rd" class="r777 r">valueExpr</span> = <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<span class="i">ConvertIndex</span>(<span class="r771 r">value</span>, <span class="r776 r">elementType</span>);
            <b>if</b> (<span class="r777 r">valueExpr</span> == <b>null</b>)
            {
                <b>return</b> <span class="r772 r">errorSuggestion</span> ??
                       <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r771 r">value</span>, <span class="r776 r">elementType</span>, <a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>, <span class="r770 r">indexes</span>.<span class="i">Prepend</span>(<span class="r769 r">target</span>).<span class="i">ToArray</span>());
            }
 
            <b>return</b> <span class="i">IndexWithNegativeChecks</span>(
                <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r769 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r769 r">target</span>.<span class="i">LimitType</span>), <span class="r769 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r775 r">intIndex</span>, <span class="r770 r">indexes</span>[0].<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()),
                <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r777 r">valueExpr</span>, <span class="r771 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()), <span class="r769 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetProperty</span>(<span class="s">&quot;Length&quot;</span>),
                <b>static</b> (<span id="r778 rd" class="r778 r">t</span>, <span id="r779 rd" class="r779 r">i</span>, <span id="r780 rd" class="r780 r">v</span>) =&gt; <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="i">Expression</span>.<span class="i">ArrayAccess</span>(<span class="r778 r">t</span>, <span class="r779 r">i</span>), <span class="r780 r">v</span>));
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="3036faf51d4e1b9c" href="../../../R/3036faf51d4e1b9c.html" target="n" data-glyph="76,1" class="i method">SetIndexMultiDimensionArray</a>(<span class="i">DynamicMetaObject</span> <span id="r781 rd" class="r781 r">target</span>,
                                                              <span class="i">DynamicMetaObject</span>[] <span id="r782 rd" class="r782 r">indexes</span>,
                                                              <span class="i">DynamicMetaObject</span> <span id="r783 rd" class="r783 r">value</span>,
                                                              <span class="i">DynamicMetaObject</span> <span id="r784 rd" class="r784 r">errorSuggestion</span>)
        {
            <b>var</b> <span id="r785 rd" class="r785 r">elementType</span> = <span class="r781 r">target</span>.<span class="i">LimitType</span>.<span class="i">GetElementType</span>();
            <b>var</b> <span id="r786 rd" class="r786 r">valueExpr</span> = <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<span class="i">ConvertIndex</span>(<span class="r783 r">value</span>, <span class="r785 r">elementType</span>);
            <b>if</b> (<span class="r786 r">valueExpr</span> == <b>null</b>)
            {
                <b>return</b> <span class="r784 r">errorSuggestion</span> ??
                       <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r783 r">value</span>, <span class="r785 r">elementType</span>, <a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>, <span class="r782 r">indexes</span>.<span class="i">Prepend</span>(<span class="r781 r">target</span>).<span class="i">ToArray</span>());
            }
 
            <b>if</b> (<span class="r782 r">indexes</span>.<span class="i">Length</span> == 1)
            {
                <b>var</b> <span id="r787 rd" class="r787 r">indexExpr</span> = <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<span class="i">ConvertIndex</span>(<span class="r782 r">indexes</span>[0], <b>typeof</b>(<b>int</b>[]));
                <b>if</b> (<span class="r787 r">indexExpr</span> == <b>null</b>)
                {
                    <b>return</b> <span class="r784 r">errorSuggestion</span> ??
                           <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r782 r">indexes</span>[0], <b>typeof</b>(<b>int</b>[]), <a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>, <b>new</b> <span class="i">DynamicMetaObject</span>[] { <span class="r781 r">target</span>, <span class="r783 r">value</span> });
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#baf71e0e6efe266a" class="i field">ArrayOps_SetMDArrayValue</a>,
                                    <span class="r781 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">Array</span>)),
                                    <span class="r787 r">indexExpr</span>,
                                    <span class="r786 r">valueExpr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    <span class="r781 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r782 r">indexes</span>).<span class="i">Merge</span>(<span class="r783 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()));
            }
 
            <b>var</b> <span id="r788 rd" class="r788 r">array</span> = (<span class="i">Array</span>)<span class="r781 r">target</span>.<span class="i">Value</span>;
 
            <b>if</b> (<span class="r782 r">indexes</span>.<span class="i">Length</span> != <span class="r788 r">array</span>.<span class="i">Rank</span>)
            {
                <b>return</b> <span class="r784 r">errorSuggestion</span> ??
                       <span class="r781 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r782 r">indexes</span>, <span class="r783 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>(), <span class="s">&quot;NeedMultidimensionalIndex&quot;</span>,
                                                <span class="i">ParserStrings</span>.<span class="i">NeedMultidimensionalIndex</span>,
                                                <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<span class="r788 r">array</span>.<span class="i">Rank</span>),
                                                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4f0af9e268afdbc6" class="i field">ArrayOps_IndexStringMessage</a>,
                                                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                                                                        <span class="r782 r">indexes</span>.<span class="i">Select</span>(<b>static</b> <span id="r789 rd" class="r789 r">i</span> =&gt; <span class="r789 r">i</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))))));
            }
 
            <b>var</b> <span id="r790 rd" class="r790 r">indexExprs</span> = <b>new</b> <span class="i">Expression</span>[<span class="r782 r">indexes</span>.<span class="i">Length</span>];
            <b>for</b> (<b>int</b> <span id="r791 rd" class="r791 r">i</span> = 0; <span class="r791 r">i</span> &lt; <span class="r782 r">indexes</span>.<span class="i">Length</span>; <span class="r791 r">i</span>++)
            {
                <span class="r790 r">indexExprs</span>[<span class="r791 r">i</span>] = <a href="#f5f4b5dd1e81524d" class="t t">PSGetIndexBinder</a>.<span class="i">ConvertIndex</span>(<span class="r782 r">indexes</span>[<span class="r791 r">i</span>], <b>typeof</b>(<b>int</b>));
                <b>if</b> (<span class="r790 r">indexExprs</span>[<span class="r791 r">i</span>] == <b>null</b>)
                {
                    <b>return</b> <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">ThrowNoConversion</span>(<span class="r782 r">indexes</span>[<span class="r791 r">i</span>], <b>typeof</b>(<b>int</b>), <a href="#4efa6869376d725f" class="k">this</a>, <a href="#b0e978fb9de22375" class="i field">_version</a>,
                        <span class="r782 r">indexes</span>.<span class="i">Except</span>(<b>new</b> <span class="i">DynamicMetaObject</span>[] { <span class="r782 r">indexes</span>[<span class="r791 r">i</span>] }).<span class="i">Append</span>(<span class="r781 r">target</span>).<span class="i">Append</span>(<span class="r783 r">value</span>).<span class="i">ToArray</span>());
                }
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#baf71e0e6efe266a" class="i field">ArrayOps_SetMDArrayValue</a>,
                                <span class="r781 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<span class="i">Array</span>)),
                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>int</b>), <span class="r790 r">indexExprs</span>),
                                <span class="r786 r">valueExpr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                <span class="r781 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r782 r">indexes</span>).<span class="i">Merge</span>(<span class="r783 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()));
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The binder for getting a member of a class, like $foo.bar or [foo]::bar.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="ef1a94f6eb6abfd5" href="../../../R/ef1a94f6eb6abfd5.html" target="n" data-glyph="2,0" class="t t">PSGetMemberBinder</a> : <span class="i">GetMemberBinder</span>
    {
        <b>private sealed class</b> <a id="b9d9c697c95b03e2" href="../../../R/../../0000000000.html" target="n" data-glyph="4,1" class="t t"><span id="3b030c01acd5da01">KeyComparer</span></a> : <span class="i">IEqualityComparer</span>&lt;<span class="i">PSGetMemberBinderKeyType</span>&gt;
        {
            <b>public bool</b> <a id="964c8c18a09b53d2" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Equals</a>(<span class="i">PSGetMemberBinderKeyType</span> <span id="r792 rd" class="r792 r">x</span>, <span class="i">PSGetMemberBinderKeyType</span> <span id="r793 rd" class="r793 r">y</span>)
            {
                <span class="c">// The non-static binder cache is case-sensitive because sites need the name used per site</span>
                <span class="c">// when the target object is a case-sensitive IDictionary.  Under all other circumstances,</span>
                <span class="c">// binding is case-insensitive.</span>
                <b>var</b> <span id="r794 rd" class="r794 r">stringComparison</span> = <span class="r792 r">x</span>.<span class="i">Item3</span> ? <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span> : <span class="i">StringComparison</span>.<span class="i">Ordinal</span>;
                <b>return</b> <span class="r792 r">x</span>.<span class="i">Item1</span>.<span class="i">Equals</span>(<span class="r793 r">y</span>.<span class="i">Item1</span>, <span class="r794 r">stringComparison</span>) &amp;&amp;
                       <span class="r792 r">x</span>.<span class="i">Item2</span> == <span class="r793 r">y</span>.<span class="i">Item2</span> &amp;&amp;
                       <span class="r792 r">x</span>.<span class="i">Item3</span> == <span class="r793 r">y</span>.<span class="i">Item3</span> &amp;&amp;
                       <span class="r792 r">x</span>.<span class="i">Item4</span> == <span class="r793 r">y</span>.<span class="i">Item4</span>;
            }
 
            <b>public int</b> <a id="3bb3bc3b29dc2c31" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetHashCode</a>(<span class="i">PSGetMemberBinderKeyType</span> <span id="r795 rd" class="r795 r">obj</span>)
            {
                <b>var</b> <span id="r796 rd" class="r796 r">stringComparer</span> = <span class="r795 r">obj</span>.<span class="i">Item3</span> ? <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span> : <span class="i">StringComparer</span>.<span class="i">Ordinal</span>;
                <b>return</b> <a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<span class="i">CombineHashCodes</span>(<span class="r796 r">stringComparer</span>.<span class="i">GetHashCode</span>(<span class="r795 r">obj</span>.<span class="i">Item1</span>),
                    <span class="r795 r">obj</span>.<span class="i">Item2</span> == <b>null</b> ? 0 : <span class="r795 r">obj</span>.<span class="i">Item2</span>.<span class="i">GetHashCode</span>(),
                    <span class="r795 r">obj</span>.<span class="i">Item3</span>.<span class="i">GetHashCode</span>(),
                    <span class="r795 r">obj</span>.<span class="i">Item4</span>.<span class="i">GetHashCode</span>());
            }
        }
 
        <b>private sealed class</b> <a id="30c090cb888dac94" href="../../../R/30c090cb888dac94.html" target="n" data-glyph="4,1" class="t t">ReservedMemberBinder</a> : <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>
        {
            <b>internal</b> <a id="c259b550c95312d7" href="../../../R/c259b550c95312d7.html" target="n" data-glyph="74,2" class="t constructor">ReservedMemberBinder</a>(<b>string</b> <span id="r797 rd" class="r797 r">name</span>, <b>bool</b> <span id="r798 rd" class="r798 r">ignoreCase</span>, <b>bool</b> <span id="r799 rd" class="r799 r">@static</span>) : <a href="#4086d92c917dda47" class="k">base</a>(<span class="r797 r">name</span>, <b>null</b>, <span class="r798 r">ignoreCase</span>, <span class="r799 r">@static</span>, <span class="r800 r">nonEnumerating</span>: <b>false</b>)
            {
            }
 
            <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="9648d79fbfe4b365" href="../../../R/9648d79fbfe4b365.html" target="n" data-glyph="72,2" class="i method">FallbackGetMember</a>(<span class="i">DynamicMetaObject</span> <span id="r801 rd" class="r801 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r802 rd" class="r802 r">errorSuggestion</span>)
            {
                <span class="i">MethodInfo</span> <span id="r803 rd" class="r803 r">mi</span> = <b>null</b>;
                <span class="i">Expression</span> <span id="r804 rd" class="r804 r">targetExpr</span> = <b>null</b>;
                <b>switch</b> (<span class="i">Name</span>)
                {
                    <b>case</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#a761de3805c623a2" class="i field">AdaptedMemberSetName</a>:
                        <span class="r803 r">mi</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#def9780cb2b9823b" class="i field">ReservedNameMembers_GeneratePSAdaptedMemberSet</a>;
                        <span class="r804 r">targetExpr</span> = <span class="r801 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                        <b>break</b>;
                    <b>case</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#296e77f364f31de8" class="i field">BaseObjectMemberSetName</a>:
                        <span class="r803 r">mi</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4e73d310dd1b2509" class="i field">ReservedNameMembers_GeneratePSBaseMemberSet</a>;
                        <span class="r804 r">targetExpr</span> = <span class="r801 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                        <b>break</b>;
                    <b>case</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#82db25e2060c4487" class="i field">ExtendedMemberSetName</a>:
                        <span class="r803 r">mi</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#fc5114a16c3a13f3" class="i field">ReservedNameMembers_GeneratePSExtendedMemberSet</a>;
                        <span class="r804 r">targetExpr</span> = <span class="r801 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                        <b>break</b>;
                    <b>case</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#770510aed20ef9a0" class="i field">PSObjectMemberSetName</a>:
                        <span class="r803 r">mi</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#60400a7f31f75359" class="i field">ReservedNameMembers_GeneratePSObjectMemberSet</a>;
                        <span class="r804 r">targetExpr</span> = <span class="r801 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                        <b>break</b>;
                    <b>case</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#5c67cf178a08cfde" class="i field">PSTypeNames</a>:
                        <span class="r803 r">mi</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#322f6b679fcdc6df" class="i field">ReservedNameMembers_PSTypeNames</a>;
                        <span class="r804 r">targetExpr</span> = <span class="r801 r">target</span>.<span class="i">Expression</span>.<span class="i">Convert</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>));
                        <b>break</b>;
                }
 
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r803 r">mi</span> != <b>null</b>, <span class="s">&quot;ReservedMemberBinder doesn&#39;t support member Name&quot;</span>);
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">WrapGetMemberInTry</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<span class="r803 r">mi</span>, <span class="r804 r">targetExpr</span>)), <span class="r801 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
            }
        }
 
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">PSGetMemberBinderKeyType</span>, <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt; <a id="f9dcd53e2c355cf5" href="../../../R/f9dcd53e2c355cf5.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a>
            = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">PSGetMemberBinderKeyType</span>, <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt;(<b>new</b> <span class="t">KeyComparer</span>());
 
        <span class="c">// Because the non-static binder is case-sensitive, we need a list of all binders for a given</span>
        <span class="c">// name when we discover an instance member or type table member for that given name so we</span>
        <span class="c">// can update each of those binders.</span>
        <b>private static readonly</b> <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt;&gt; <a id="fa18392fdbef8367" href="../../../R/fa18392fdbef8367.html" target="n" data-glyph="46,1" class="i field">s_binderCacheIgnoringCase</a>
            = <b>new</b> <span class="i">ConcurrentDictionary</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt;&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <b>static</b> <a id="d2947ce94e2e27e3" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t method">PSGetMemberBinder</a>()
        {
            <a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="i">Tuple</span>.<span class="i">Create</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#a761de3805c623a2" class="i field">AdaptedMemberSetName</a>, (<span class="i">Type</span>)<b>null</b>, <b>false</b>, <b>false</b>),
                <b>new</b> <a href="#c259b550c95312d7" class="t constructor">ReservedMemberBinder</a>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#a761de3805c623a2" class="i field">AdaptedMemberSetName</a>, <span class="r798 r">ignoreCase</span>: <b>true</b>, <span class="r799 r">@static</span>: <b>false</b>));
            <a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="i">Tuple</span>.<span class="i">Create</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#82db25e2060c4487" class="i field">ExtendedMemberSetName</a>, (<span class="i">Type</span>)<b>null</b>, <b>false</b>, <b>false</b>),
                <b>new</b> <a href="#c259b550c95312d7" class="t constructor">ReservedMemberBinder</a>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#82db25e2060c4487" class="i field">ExtendedMemberSetName</a>, <span class="r798 r">ignoreCase</span>: <b>true</b>, <span class="r799 r">@static</span>: <b>false</b>));
            <a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="i">Tuple</span>.<span class="i">Create</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#296e77f364f31de8" class="i field">BaseObjectMemberSetName</a>, (<span class="i">Type</span>)<b>null</b>, <b>false</b>, <b>false</b>),
                <b>new</b> <a href="#c259b550c95312d7" class="t constructor">ReservedMemberBinder</a>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#296e77f364f31de8" class="i field">BaseObjectMemberSetName</a>, <span class="r798 r">ignoreCase</span>: <b>true</b>, <span class="r799 r">@static</span>: <b>false</b>));
            <a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="i">Tuple</span>.<span class="i">Create</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#770510aed20ef9a0" class="i field">PSObjectMemberSetName</a>, (<span class="i">Type</span>)<b>null</b>, <b>false</b>, <b>false</b>),
                <b>new</b> <a href="#c259b550c95312d7" class="t constructor">ReservedMemberBinder</a>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#770510aed20ef9a0" class="i field">PSObjectMemberSetName</a>, <span class="r798 r">ignoreCase</span>: <b>true</b>, <span class="r799 r">@static</span>: <b>false</b>));
            <a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="i">Tuple</span>.<span class="i">Create</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#5c67cf178a08cfde" class="i field">PSTypeNames</a>, (<span class="i">Type</span>)<b>null</b>, <b>false</b>, <b>false</b>),
                <b>new</b> <a href="#c259b550c95312d7" class="t constructor">ReservedMemberBinder</a>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#5c67cf178a08cfde" class="i field">PSTypeNames</a>, <span class="r798 r">ignoreCase</span>: <b>true</b>, <span class="r799 r">@static</span>: <b>false</b>));
        }
 
        <b>private readonly bool</b> <a id="a3fc9a92870cf7ca" href="../../../R/a3fc9a92870cf7ca.html" target="n" data-glyph="46,1" class="i field">_static</a>;
        <b>private readonly bool</b> <a id="0e03e6bc62be5da1" href="../../../R/0e03e6bc62be5da1.html" target="n" data-glyph="46,1" class="i field">_nonEnumerating</a>;
        <b>private readonly</b> <span class="i">Type</span> <a id="e6e7844fee167917" href="../../../R/e6e7844fee167917.html" target="n" data-glyph="46,1" class="i field">_classScope</a>;
        <b>internal int</b> <a id="017a627d1c63e599" href="../../../R/017a627d1c63e599.html" target="n" data-glyph="44,1" class="i field">_version</a>;
 
        <b>private bool</b> <a id="a6ed952d0d3b81df" href="../../../R/a6ed952d0d3b81df.html" target="n" data-glyph="46,1" class="i field">_hasInstanceMember</a>;
 
        <b>internal bool</b> <a id="3936d148f85730d0" href="../../../R/3936d148f85730d0.html" target="n" data-glyph="104,1" class="i property">HasInstanceMember</a> { <b>get</b> { <b>return</b> <a href="#a6ed952d0d3b81df" class="i field">_hasInstanceMember</a>; } }
 
        <b>internal static void</b> <a id="bad6a11737238f9f" href="../../../R/bad6a11737238f9f.html" target="n" data-glyph="74,1" class="i method">SetHasInstanceMember</a>(<b>string</b> <span id="r805 rd" class="r805 r">memberName</span>)
        {
            <span class="c">// We must invalidate dynamic sites (if any) when the first instance member (for this binder)</span>
            <span class="c">// is created, but we don&#39;t need to invalidate any sites after the first instance member.</span>
            <span class="c">// Before any instance members exist, restrictions might look like:</span>
            <span class="c">//     if (binderVersion == oldBinderVersion &amp;&amp; obj is string) { ... }</span>
            <span class="c">// After an instance member is known to exist, the above test (for an object that has no instance</span>
            <span class="c">// member) will look like:</span>
            <span class="c">//    MemberInfo mi;</span>
            <span class="c">//    if (binderVersion == oldBinderVersion &amp;&amp; !TryGetInstanceMember(obj, memberName, out mi) &amp;&amp; obj is string)</span>
            <span class="c">//    {</span>
            <span class="c">//        return ((string)obj).memberName;</span>
            <span class="c">//    }</span>
            <span class="c">//    else { update site }</span>
            <span class="c">// And if there is an instance member, the generic rule will look like:</span>
            <span class="c">//    MemberInfo mi;</span>
            <span class="c">//    if (binderVersion == oldBinderVersion &amp;&amp; TryGetInstanceMember(obj, memberName, out mi))</span>
            <span class="c">//    {</span>
            <span class="c">//        return mi.Value;</span>
            <span class="c">//    }</span>
            <span class="c">//    else { update site }</span>
            <span class="c">// This way, we can avoid the call to TryGetInstanceMember for binders when we know there aren&#39;t any instance</span>
            <span class="c">// members, yet invalidate those rules once somebody adds an instance member.</span>
 
            <b>var</b> <span id="r806 rd" class="r806 r">binderList</span> = <a href="#fa18392fdbef8367" class="i field">s_binderCacheIgnoringCase</a>.<span class="i">GetOrAdd</span>(<span class="r805 r">memberName</span>, <b>static</b> <span id="r807 rd" class="r807 r">_</span> =&gt; <b>new</b> <span class="i">List</span>&lt;<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt;());
 
            <b>lock</b> (<span class="r806 r">binderList</span>)
            {
                <b>if</b> (<span class="r806 r">binderList</span>.<span class="i">Count</span> == 0)
                {
                    <span class="c">// Force one binder to be created if one hasn&#39;t been created already.</span>
                    <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#f97fa109dcbba60d" class="i method">Get</a>(<span class="r805 r">memberName</span>, (<span class="i">Type</span>)<b>null</b>, <span class="r808 r">@static</span>: <b>false</b>);
                }
 
                <b>foreach</b> (<b>var</b> <span id="r809 rd" class="r809 r">binder</span> <b>in</b> <span class="r806 r">binderList</span>)
                {
                    <b>if</b> (!<span class="r809 r">binder</span>.<span class="i">_hasInstanceMember</span>)
                    {
                        <b>lock</b> (<span class="r809 r">binder</span>)
                        {
                            <b>if</b> (!<span class="r809 r">binder</span>.<span class="i">_hasInstanceMember</span>)
                            {
                                <span class="r809 r">binder</span>.<span class="i">_version</span> += 1;
                                <span class="r809 r">binder</span>.<span class="i">_hasInstanceMember</span> = <b>true</b>;
                            }
                        }
                    }
                }
            }
        }
 
        <b>private bool</b> <a id="040034ae6ae22ff7" href="../../../R/040034ae6ae22ff7.html" target="n" data-glyph="46,1" class="i field">_hasTypeTableMember</a>;
 
        <b>internal static void</b> <a id="8b53c24d60d592fe" href="../../../R/8b53c24d60d592fe.html" target="n" data-glyph="74,1" class="i method">TypeTableMemberAdded</a>(<b>string</b> <span id="r810 rd" class="r810 r">memberName</span>)
        {
            <b>var</b> <span id="r811 rd" class="r811 r">binderList</span> = <a href="#fa18392fdbef8367" class="i field">s_binderCacheIgnoringCase</a>.<span class="i">GetOrAdd</span>(<span class="r810 r">memberName</span>, <b>static</b> <span id="r812 rd" class="r812 r">_</span> =&gt; <b>new</b> <span class="i">List</span>&lt;<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt;());
 
            <b>lock</b> (<span class="r811 r">binderList</span>)
            {
                <b>if</b> (<span class="r811 r">binderList</span>.<span class="i">Count</span> == 0)
                {
                    <span class="c">// Force one binder to be created if one hasn&#39;t been created already.</span>
                    <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#f97fa109dcbba60d" class="i method">Get</a>(<span class="r810 r">memberName</span>, (<span class="i">Type</span>)<b>null</b>, <span class="r808 r">@static</span>: <b>false</b>);
                }
 
                <b>foreach</b> (<b>var</b> <span id="r813 rd" class="r813 r">binder</span> <b>in</b> <span class="r811 r">binderList</span>)
                {
                    <b>lock</b> (<span class="r813 r">binder</span>)
                    {
                        <span class="r813 r">binder</span>.<span class="i">_version</span> += 1;
                        <span class="r813 r">binder</span>.<span class="i">_hasTypeTableMember</span> = <b>true</b>;
                    }
                }
            }
        }
 
        <b>internal static void</b> <a id="a7fcb5c2dbcd9a63" href="../../../R/a7fcb5c2dbcd9a63.html" target="n" data-glyph="74,1" class="i method">TypeTableMemberPossiblyUpdated</a>(<b>string</b> <span id="r814 rd" class="r814 r">memberName</span>)
        {
            <b>var</b> <span id="r815 rd" class="r815 r">binderList</span> = <a href="#fa18392fdbef8367" class="i field">s_binderCacheIgnoringCase</a>.<span class="i">GetOrAdd</span>(<span class="r814 r">memberName</span>, <b>static</b> <span id="r816 rd" class="r816 r">_</span> =&gt; <b>new</b> <span class="i">List</span>&lt;<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt;());
 
            <b>lock</b> (<span class="r815 r">binderList</span>)
            {
                <b>foreach</b> (<b>var</b> <span id="r817 rd" class="r817 r">binder</span> <b>in</b> <span class="r815 r">binderList</span>)
                {
                    <span class="i">Interlocked</span>.<span class="i">Increment</span>(<b>ref</b> <span class="r817 r">binder</span>.<span class="i">_version</span>);
                }
            }
        }
 
        <b>public static</b> <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <a id="1a244dc8a883f132" href="../../../R/1a244dc8a883f132.html" target="n" data-glyph="72,1" class="i method">Get</a>(<b>string</b> <span id="r818 rd" class="r818 r">memberName</span>, <a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r819 rd" class="r819 r">classScope</span>, <b>bool</b> <span id="r820 rd" class="r820 r">@static</span>)
        {
            <b>return</b> <span class="i">Get</span>(<span class="r818 r">memberName</span>, <span class="r819 r">classScope</span>?.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>, <span class="r820 r">@static</span>, <b>false</b>);
        }
 
        <b>public static</b> <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <a id="f97fa109dcbba60d" href="../../../R/f97fa109dcbba60d.html" target="n" data-glyph="72,1" class="i method">Get</a>(<b>string</b> <span id="r821 rd" class="r821 r">memberName</span>, <span class="i">Type</span> <span id="r822 rd" class="r822 r">classScope</span>, <b>bool</b> <span id="r808 rd" class="r808 r">@static</span>)
        {
            <b>return</b> <a href="#2a5c5004bd174f56" class="i method">Get</a>(<span class="r821 r">memberName</span>, <span class="r822 r">classScope</span>, <span class="r808 r">@static</span>, <b>false</b>);
        }
 
        <b>private</b> <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <a id="22f07b16dd404da0" href="../../../R/22f07b16dd404da0.html" target="n" data-glyph="76,1" class="i method">GetNonEnumeratingBinder</a>()
        {
            <b>return</b> <span class="i">Get</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">Name</span>, <a href="#e6e7844fee167917" class="i field">_classScope</a>, <span class="i">@static</span>: <b>false</b>, <span class="i">nonEnumerating</span>: <b>true</b>);
        }
 
        <b>private static</b> <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <a id="2a5c5004bd174f56" href="../../../R/2a5c5004bd174f56.html" target="n" data-glyph="76,1" class="i method">Get</a>(<b>string</b> <span id="r823 rd" class="r823 r">memberName</span>, <span class="i">Type</span> <span id="r824 rd" class="r824 r">classScope</span>, <b>bool</b> <span id="r825 rd" class="r825 r">@static</span>, <b>bool</b> <span id="r826 rd" class="r826 r">nonEnumerating</span>)
        {
            <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <span id="r827 rd" class="r827 r">result</span>;
 
            <b>lock</b> (<a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r828 rd" class="r828 r">tuple</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r823 r">memberName</span>, <span class="r824 r">classScope</span>, <span class="r825 r">@static</span>, <span class="r826 r">nonEnumerating</span>);
                <b>if</b> (!<a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r828 r">tuple</span>, <b>out</b> <span class="r827 r">result</span>))
                {
                    <span class="c">// We might be seeing a reserved name with a different case.  Check for that before</span>
                    <span class="c">// creating a new binder.  For reserved names, we can safely use a single binder for</span>
                    <span class="c">// any case.</span>
                    <b>if</b> (<a href="../../MshMemberInfo.cs.html#7dc9937a68c9af8c" class="t t">PSMemberInfoCollection</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;.<a href="../../MshMemberInfo.cs.html#506da20a55d3f0f7" class="i method">IsReservedName</a>(<span class="r823 r">memberName</span>))
                    {
                        <b>var</b> <span id="r829 rd" class="r829 r">tupleLower</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r823 r">memberName</span>.<span class="i">ToLowerInvariant</span>(), (<span class="i">Type</span>)<b>null</b>, <span class="r825 r">@static</span>, <span class="r826 r">nonEnumerating</span>);
                        <span class="r827 r">result</span> = <a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>[<span class="r829 r">tupleLower</span>];
                    }
                    <b>else</b>
                    {
                        <span class="r827 r">result</span> = <b>new</b> <a href="#4086d92c917dda47" class="t constructor">PSGetMemberBinder</a>(<span class="r823 r">memberName</span>, <span class="r824 r">classScope</span>, <b>true</b>, <span class="r825 r">@static</span>, <span class="r826 r">nonEnumerating</span>);
                        <b>if</b> (!<span class="r825 r">@static</span>)
                        {
                            <b>var</b> <span id="r830 rd" class="r830 r">binderList</span> = <a href="#fa18392fdbef8367" class="i field">s_binderCacheIgnoringCase</a>.<span class="i">GetOrAdd</span>(<span class="r823 r">memberName</span>, <b>static</b> <span id="r831 rd" class="r831 r">_</span> =&gt; <b>new</b> <span class="i">List</span>&lt;<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>&gt;());
                            <b>lock</b> (<span class="r830 r">binderList</span>)
                            {
                                <b>if</b> (<span class="r830 r">binderList</span>.<span class="i">Count</span> &gt; 0)
                                {
                                    <span class="r827 r">result</span>.<a href="#a6ed952d0d3b81df" class="i field">_hasInstanceMember</a> = <span class="r830 r">binderList</span>[0].<span class="i">_hasInstanceMember</span>;
                                    <span class="r827 r">result</span>.<a href="#040034ae6ae22ff7" class="i field">_hasTypeTableMember</a> = <span class="r830 r">binderList</span>[0].<span class="i">_hasTypeTableMember</span>;
                                }
 
                                <span class="r830 r">binderList</span>.<span class="i">Add</span>(<span class="r827 r">result</span>);
 
                                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r830 r">binderList</span>.<span class="i">All</span>(<span id="r832 rd" class="r832 r">b</span> =&gt; <span class="r832 r">b</span>.<span class="i">_hasInstanceMember</span> == <span class="r827 r">result</span>.<a href="#a6ed952d0d3b81df" class="i field">_hasInstanceMember</a>),
                                                   <span class="s">&quot;All binders in the list should have _hasInstanceMember set identically&quot;</span>);
                                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r830 r">binderList</span>.<span class="i">All</span>(<span id="r833 rd" class="r833 r">b</span> =&gt; <span class="r833 r">b</span>.<span class="i">_hasTypeTableMember</span> == <span class="r827 r">result</span>.<a href="#040034ae6ae22ff7" class="i field">_hasTypeTableMember</a>),
                                                   <span class="s">&quot;All binders in the list should have _hasTypeTableMember set identically&quot;</span>);
                            }
                        }
                    }
 
                    <a href="#f9dcd53e2c355cf5" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r828 r">tuple</span>, <span class="r827 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r827 r">result</span>;
        }
 
        <b>private</b> <a id="4086d92c917dda47" href="../../../R/4086d92c917dda47.html" target="n" data-glyph="76,1" class="t constructor">PSGetMemberBinder</a>(<b>string</b> <span id="r834 rd" class="r834 r">name</span>, <span class="i">Type</span> <span id="r835 rd" class="r835 r">classScope</span>, <b>bool</b> <span id="r836 rd" class="r836 r">ignoreCase</span>, <b>bool</b> <span id="r837 rd" class="r837 r">@static</span>, <b>bool</b> <span id="r800 rd" class="r800 r">nonEnumerating</span>)
            : <b>base</b>(<span class="r834 r">name</span>, <span class="r836 r">ignoreCase</span>)
        {
            <a href="#a3fc9a92870cf7ca" class="i field">_static</a> = <span class="r837 r">@static</span>;
            <a href="#e6e7844fee167917" class="i field">_classScope</a> = <span class="r835 r">classScope</span>;
            <a href="#ef1a94f6eb6abfd5" class="k">this</a>.<a href="#017a627d1c63e599" class="i field">_version</a> = 0;
            <a href="#0e03e6bc62be5da1" class="i field">_nonEnumerating</a> = <span class="r800 r">nonEnumerating</span>;
        }
 
        <b>public override string</b> <a id="2ab322f99eb78acc" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;GetMember: {0}{1}{2} ver:{3}&quot;</span>,
                <span class="i">Name</span>, <a href="#a3fc9a92870cf7ca" class="i field">_static</a> ? <span class="s">&quot; static&quot;</span> : <b>string</b>.<span class="i">Empty</span>, <a href="#0e03e6bc62be5da1" class="i field">_nonEnumerating</a> ? <span class="s">&quot; nonEnumerating&quot;</span> : <b>string</b>.<span class="i">Empty</span>, <a href="#017a627d1c63e599" class="i field">_version</a>);
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="82aacde833b57242" href="../../../R/82aacde833b57242.html" target="n" data-glyph="72,1" class="i method">FallbackGetMember</a>(<span class="i">DynamicMetaObject</span> <span id="r838 rd" class="r838 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r839 rd" class="r839 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r838 r">target</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r838 r">target</span>);
            }
 
            <span class="c">// Defer COM objects or arguments wrapped in PSObjects</span>
            <b>if</b> (<span class="r838 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r838 r">target</span>.<span class="i">Value</span>) != <span class="r838 r">target</span>.<span class="i">Value</span>))
            {
                <b>object</b> <span id="r840 rd" class="r840 r">baseObject</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r838 r">target</span>.<span class="i">Value</span>);
                <b>if</b> (<span class="r840 r">baseObject</span> != <b>null</b> &amp;&amp; <span class="i">Marshal</span>.<span class="i">IsComObject</span>(<span class="r840 r">baseObject</span>))
                {
                    <span class="c">// We unwrap only if the &#39;base&#39; is a COM object. It&#39;s unnecessary to unwrap in other cases,</span>
                    <span class="c">// especially in the case of strings, we would lose instance members on the PSObject.</span>
                    <span class="c">// Therefore, we need to use a stricter restriction to make sure PSObject &#39;target&#39; with other</span>
                    <span class="c">// base types doesn&#39;t get unwrapped.</span>
                    <b>return</b> <a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r838 r">target</span>, <span class="i">targetIsComObject</span>: <b>true</b>).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
                }
            }
 
            <span class="c">// Check if this is a COM Object</span>
            <span class="i">DynamicMetaObject</span> <span id="r841 rd" class="r841 r">result</span>;
            <b>if</b> (<span class="i n">ComInterop</span>.<a href="../../ComInterop/ComBinder.cs.html#16ed1709a95d9070" class="t t">ComBinder</a>.<span class="i">TryBindGetMember</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>, <span class="r838 r">target</span>, <b>out</b> <span class="r841 r">result</span>, <span class="i">delayInvocation</span>: <b>false</b>))
            {
                <span class="r841 r">result</span> = <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">WrapGetMemberInTry</span>(<span class="r841 r">result</span>.<span class="i">Expression</span>), <span class="r841 r">result</span>.<span class="i">Restrictions</span>);
                <b>return</b> <span class="r841 r">result</span>.<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
            }
 
            <b>object</b> <span id="r842 rd" class="r842 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r838 r">target</span>.<span class="i">Value</span>);
 
            <b>if</b> (<span class="r842 r">targetValue</span> == <b>null</b>)
            {
                <span class="c">// PSGetTypeRestriction will actually create an instance restriction because the targetValue is null.</span>
                <b>return</b> <a href="#c0d2962aae6ae284" class="i method">PropertyDoesntExist</a>(<span class="r838 r">target</span>, <span class="r838 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>()).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
            }
 
            <span class="i">BindingRestrictions</span> <span id="r843 rd" class="r843 r">restrictions</span>;
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r844 rd" class="r844 r">memberInfo</span>;
            <span class="i">Expression</span> <span id="r845 rd" class="r845 r">expr</span> = <b>null</b>;
            <b>if</b> (<a href="#a6ed952d0d3b81df" class="i field">_hasInstanceMember</a> &amp;&amp; <span class="i">TryGetInstanceMember</span>(<span class="r838 r">target</span>.<span class="i">Value</span>, <span class="i">Name</span>, <b>out</b> <span class="r844 r">memberInfo</span>))
            {
                <span class="c">// If there is an instance member, we generate (roughly) the following:</span>
                <span class="c">//     PSMemberInfo memberInfo;</span>
                <span class="c">//     if (PSGetMemberBinder.TryGetInstanceMember(target.Value, Name, out memberInfo))</span>
                <span class="c">//         return memberInfo.Value;</span>
                <span class="c">//     else</span>
                <span class="c">//         update the site</span>
                <span class="c">// We use a generic method like this because:</span>
                <span class="c">//   * If one object has an instance property with a given name, it&#39;s like many others do as well</span>
                <span class="c">//   * We want to avoid generating new sites for every object with an instance member</span>
                <span class="c">// As an alternative, would could generate the following psuedo-code:</span>
                <span class="c">//     if (target.Value == previousInstance)</span>
                <span class="c">//         return optimized value (depending on the exact PSMemberInfo subclass)</span>
                <span class="c">//     else update the site</span>
                <span class="c">// But the assumption here is that many sites probably performs worse than the dictionary lookup</span>
                <span class="c">// and unoptimized virtual call to PSMemberInfo.Value.</span>
                <span class="c">//</span>
                <span class="c">// The binding restrictions could avoid a version check because it&#39;s never wrong to look for an instance member,</span>
                <span class="c">// but we add the check because the DLR requires a non-empty check when the target implements IDynamicMetaObjectProvider,</span>
                <span class="c">// which PSObject does.  The version check is also marginally useful if we knew we&#39;d never see another</span>
                <span class="c">// instance member with this member name, but we&#39;re not tracking things to make that a useful test.</span>
 
                <b>var</b> <span id="r846 rd" class="r846 r">memberInfoVar</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>));
                <span class="r845 r">expr</span> = <span class="i">Expression</span>.<span class="i">Condition</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#9d70b40f06dc0a2b" class="i field">PSGetMemberBinder_TryGetInstanceMember</a>, <span class="r838 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>), <span class="r846 r">memberInfoVar</span>),
                    <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r846 r">memberInfoVar</span>, <span class="s">&quot;Value&quot;</span>),
                    <a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">GetUpdateExpression</span>(<b>typeof</b>(<b>object</b>)));
                <span class="r845 r">expr</span> = <a href="#1e91dac2e37399ae" class="i method">WrapGetMemberInTry</a>(<span class="r845 r">expr</span>);
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r846 r">memberInfoVar</span> }, <span class="r845 r">expr</span>), <a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>, <a href="#017a627d1c63e599" class="i field">_version</a>))).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
            }
 
            <b>bool</b> <span id="r847 rd" class="r847 r">canOptimize</span>;
            <span class="i">Type</span> <span id="r848 rd" class="r848 r">aliasConversionType</span>;
            <span class="r844 r">memberInfo</span> = <span class="i">GetPSMemberInfo</span>(<span class="r838 r">target</span>, <b>out</b> <span class="r843 r">restrictions</span>, <b>out</b> <span class="r847 r">canOptimize</span>, <b>out</b> <span class="r848 r">aliasConversionType</span>, <span class="i">MemberTypes</span>.<span class="i">Property</span>);
 
            <b>if</b> (!<span class="r847 r">canOptimize</span>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r844 r">memberInfo</span> == <b>null</b>, <span class="s">&quot;We don&#39;t bother returning members if we can&#39;t optimize.&quot;</span>);
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">WrapGetMemberInTry</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#1109ad016629fabc" class="i field">PSGetMemberBinder_GetAdaptedValue</a>,
                                                       <span class="i">GetTargetExpr</span>(<span class="r838 r">target</span>, <b>typeof</b>(<b>object</b>)),
                                                       <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>))),
                    <span class="r843 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r844 r">memberInfo</span> != <b>null</b>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r844 r">memberInfo</span>.<a href="../../MshMemberInfo.cs.html#014ea40b35222be9" class="i field">instance</a> == <b>null</b>, <span class="s">&quot;We shouldn&#39;t be here if a member is already bound.&quot;</span>);
 
                <span class="c">// The most common case - we&#39;re getting some property.  We can optimize many different kinds</span>
                <span class="c">// of property accessors, so we special case each possibility.</span>
                <a href="../../MshMemberInfo.cs.html#13ab3796654e613c" class="k">var</a> <span id="r849 rd" class="r849 r">propertyInfo</span> = <span class="r844 r">memberInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>;
                <b>if</b> (<span class="r849 r">propertyInfo</span> != <b>null</b>)
                {
                    <b>if</b> (!<span class="r849 r">propertyInfo</span>.<a href="../../MshMemberInfo.cs.html#9df67dd88e11e967" class="i property">IsGettable</a>)
                    {
                        <b>return</b> <a href="#c4f897310c444609" class="i method">GenerateGetPropertyException</a>(<span class="r843 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
                    }
 
                    <a href="../../MshMemberInfo.cs.html#3632258af753748e" class="k">var</a> <span id="r850 rd" class="r850 r">property</span> = <span class="r849 r">propertyInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#3632258af753748e" class="t t">PSProperty</a>;
                    <b>if</b> (<span class="r850 r">property</span> != <b>null</b>)
                    {
                        <a href="../../CoreAdapter.cs.html#e42273e13efeb8a7" class="k">var</a> <span id="r851 rd" class="r851 r">adapterData</span> = <span class="r850 r">property</span>.<a href="../../MshMemberInfo.cs.html#d6dbce48987e002d" class="i field">adapterData</a> <b>as</b> <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#e42273e13efeb8a7" class="t t">PropertyCacheEntry</a>;
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r851 r">adapterData</span> != <b>null</b>, <span class="s">&quot;We have an unknown PSProperty that we aren&#39;t correctly optimizing.&quot;</span>);
 
                        <b>if</b> (<span class="r851 r">adapterData</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">DeclaringType</span>.<span class="i">IsGenericTypeDefinition</span> || <span class="r851 r">adapterData</span>.<a href="../../CoreAdapter.cs.html#46125476611507e4" class="i field">propertyType</a>.<span class="i">IsByRefLike</span>)
                        {
                            <span class="c">// We really should throw an error, but accessing property getter</span>
                            <span class="c">// doesn&#39;t throw error in PowerShell since V2, even in strict mode.</span>
                            <span class="r845 r">expr</span> = <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>;
                        }
                        <b>else</b>
                        {
                            <span class="c">// For static property access, the target expr must be null.  For non-static, we must convert</span>
                            <span class="c">// because target.Expression is typeof(object) because this is a dynamic site.</span>
                            <b>var</b> <span id="r852 rd" class="r852 r">targetExpr</span> = <a href="#a3fc9a92870cf7ca" class="i field">_static</a> ? <b>null</b> : <span class="i">GetTargetExpr</span>(<span class="r838 r">target</span>, <span class="r851 r">adapterData</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">DeclaringType</span>);
                            <b>var</b> <span id="r853 rd" class="r853 r">propertyAccessor</span> = <span class="r851 r">adapterData</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a> <b>as</b> <span class="i">PropertyInfo</span>;
                            <b>if</b> (<span class="r853 r">propertyAccessor</span> != <b>null</b>)
                            {
                                <b>if</b> (<span class="r853 r">propertyAccessor</span>.<span class="i">GetMethod</span>.<span class="i">IsFamily</span> &amp;&amp;
                                    (<a href="#e6e7844fee167917" class="i field">_classScope</a> == <b>null</b> || !<a href="#e6e7844fee167917" class="i field">_classScope</a>.<span class="i">IsSubclassOf</span>(<span class="r853 r">propertyAccessor</span>.<span class="i">DeclaringType</span>)))
                                {
                                    <b>return</b> <a href="#c4f897310c444609" class="i method">GenerateGetPropertyException</a>(<span class="r843 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
                                }
 
                                <span class="r845 r">expr</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r852 r">targetExpr</span>, <span class="r853 r">propertyAccessor</span>);
                            }
                            <b>else</b>
                            {
                                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r851 r">adapterData</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a> <b>is</b> <span class="i">FieldInfo</span>,
                                                   <span class="s">&quot;A DotNetAdapter.PropertyCacheEntry has something other than PropertyInfo or FieldInfo.&quot;</span>);
                                <span class="r845 r">expr</span> = <span class="i">Expression</span>.<span class="i">Field</span>(<span class="r852 r">targetExpr</span>, (<span class="i">FieldInfo</span>)<span class="r851 r">adapterData</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>);
                            }
                        }
                    }
 
                    <a href="../../MshMemberInfo.cs.html#b68884f0eb8d8ebb" class="k">var</a> <span id="r854 rd" class="r854 r">scriptProperty</span> = <span class="r849 r">propertyInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#b68884f0eb8d8ebb" class="t t">PSScriptProperty</a>;
                    <b>if</b> (<span class="r854 r">scriptProperty</span> != <b>null</b>)
                    {
                        <span class="r845 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r854 r">scriptProperty</span>, <b>typeof</b>(<a href="../../MshMemberInfo.cs.html#b68884f0eb8d8ebb" class="t t">PSScriptProperty</a>)),
                                               <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#f05e92262c6fc7a9" class="i field">PSScriptProperty_InvokeGetter</a>, <span class="r838 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
                    }
 
                    <a href="../../MshMemberInfo.cs.html#c36513189382c70d" class="k">var</a> <span id="r855 rd" class="r855 r">codeProperty</span> = <span class="r849 r">propertyInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#c36513189382c70d" class="t t">PSCodeProperty</a>;
                    <b>if</b> (<span class="r855 r">codeProperty</span> != <b>null</b>)
                    {
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r855 r">codeProperty</span>.<a href="../../MshMemberInfo.cs.html#41304ac679470f52" class="i property">GetterCodeReference</a> != <b>null</b>, <span class="s">&quot;CodeProperty isn&#39;t gettable, should have generated error code above.&quot;</span>);
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r855 r">codeProperty</span>.<a href="../../MshMemberInfo.cs.html#41304ac679470f52" class="i property">GetterCodeReference</a>.<span class="i">IsStatic</span>, <span class="s">&quot;CodeProperty should be a static method.&quot;</span>);
 
                        <span class="r845 r">expr</span> = <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<span class="i">InvokeMethod</span>(<span class="r855 r">codeProperty</span>.<a href="../../MshMemberInfo.cs.html#41304ac679470f52" class="i property">GetterCodeReference</a>, <b>null</b>, <b>new</b>[] { <span class="r838 r">target</span> },
                            <b>false</b>, <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#f73ea19c23857d11" class="i field">Getter</a>);
                    }
 
                    <a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="k">var</a> <span id="r856 rd" class="r856 r">noteProperty</span> = <span class="r849 r">propertyInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>;
                    <b>if</b> (<span class="r856 r">noteProperty</span> != <b>null</b>)
                    {
                        <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(!<span class="r856 r">noteProperty</span>.<a href="../../MshMemberInfo.cs.html#0781743026b7f86a" class="i property">IsSettable</a>, <span class="s">&quot;If the note is settable, incorrect code is generated.&quot;</span>);
                        <span class="r845 r">expr</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r849 r">propertyInfo</span>, <b>typeof</b>(<a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#e617ae2e1e630dea" class="i field">PSNoteProperty_Value</a>);
                    }
 
                    <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r845 r">expr</span> != <b>null</b>, <span class="s">&quot;Unexpected property type encountered&quot;</span>);
 
                    <b>if</b> (<span class="r848 r">aliasConversionType</span> != <b>null</b>)
                    {
                        <span class="r845 r">expr</span> = <span class="r845 r">expr</span>.<a href="../../parser/Compiler.cs.html#623da12beb9db704" class="i method">Convert</a>(<span class="r848 r">aliasConversionType</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r845 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#12f929af33da7404" class="i field">PSGetMemberBinder_CloneMemberInfo</a>,
                                           <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r844 r">memberInfo</span>, <b>typeof</b>(<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>)),
                                           <span class="r838 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
                }
            }
 
            <b>if</b> (<span class="r842 r">targetValue</span> <b>is</b> <span class="i">IDictionary</span>)
            {
                <span class="i">Type</span> <span id="r857 rd" class="r857 r">genericTypeArg</span> = <b>null</b>;
                <b>bool</b> <span id="r858 rd" class="r858 r">isGeneric</span> = <a href="#b13996cfa580e3d3" class="i method">IsGenericDictionary</a>(<span class="r842 r">targetValue</span>, <b>ref</b> <span class="r857 r">genericTypeArg</span>);
 
                <b>if</b> (!<span class="r858 r">isGeneric</span> || <span class="r857 r">genericTypeArg</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r859 rd" class="r859 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<b>object</b>));
                    <b>if</b> (<span class="r845 r">expr</span> == <b>null</b>)
                    {
                        <span class="c">// If expr is not null, it&#39;s the fallback when no member exists.  If it is null,</span>
                        <span class="c">// the fallback is the result from PropertyDoesntExist.</span>
 
                        <span class="r845 r">expr</span> = (<span class="r839 r">errorSuggestion</span> ?? <a href="#c0d2962aae6ae284" class="i method">PropertyDoesntExist</a>(<span class="r838 r">target</span>, <span class="r843 r">restrictions</span>)).<span class="i">Expression</span>;
                    }
 
                    <b>var</b> <span id="r860 rd" class="r860 r">method</span> = <span class="r858 r">isGeneric</span>
                        ? <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#5806a8f8dd4c6295" class="i field">PSGetMemberBinder_TryGetGenericDictionaryValue</a>.<span class="i">MakeGenericMethod</span>(<span class="r857 r">genericTypeArg</span>)
                        : <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#0c63d64f54deb7cb" class="i field">PSGetMemberBinder_TryGetIDictionaryValue</a>;
                    <span class="r845 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r859 r">temp</span> },
                        <span class="i">Expression</span>.<span class="i">Condition</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r860 r">method</span>, <span class="i">GetTargetExpr</span>(<span class="r838 r">target</span>, <span class="r860 r">method</span>.<span class="i">GetParameters</span>()[0].<span class="i">ParameterType</span>), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>), <span class="r859 r">temp</span>),
                            <span class="r859 r">temp</span>,
                            <span class="r845 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))));
                }
            }
 
            <b>return</b> <span class="r845 r">expr</span> != <b>null</b>
                ? <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="#1e91dac2e37399ae" class="i method">WrapGetMemberInTry</a>(<span class="r845 r">expr</span>), <span class="r843 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>)
                : (<span class="r839 r">errorSuggestion</span> ?? <a href="#c0d2962aae6ae284" class="i method">PropertyDoesntExist</a>(<span class="r838 r">target</span>, <span class="r843 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="c4f897310c444609" href="../../../R/c4f897310c444609.html" target="n" data-glyph="76,1" class="i method">GenerateGetPropertyException</a>(<span class="i">BindingRestrictions</span> <span id="r861 rd" class="r861 r">restrictions</span>)
        {
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeError</span>(<span class="s">&quot;WriteOnlyProperty&quot;</span>, <span class="i">ExtendedTypeSystem</span>.<span class="i">WriteOnlyProperty</span>,
                    <a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">ReturnType</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>)),
                <span class="r861 r">restrictions</span>);
        }
 
        <b>internal static bool</b> <a id="b13996cfa580e3d3" href="../../../R/b13996cfa580e3d3.html" target="n" data-glyph="74,1" class="i method">IsGenericDictionary</a>(<b>object</b> <span id="r862 rd" class="r862 r">value</span>, <b>ref</b> <span class="i">Type</span> <span id="r863 rd" class="r863 r">genericTypeArg</span>)
        {
            <b>bool</b> <span id="r864 rd" class="r864 r">isGeneric</span> = <b>false</b>;
            <b>foreach</b> (<b>var</b> <span id="r865 rd" class="r865 r">i</span> <b>in</b> <span class="r862 r">value</span>.<span class="i">GetType</span>().<span class="i">GetInterfaces</span>())
            {
                <b>if</b> (<span class="r865 r">i</span>.<span class="i">IsGenericType</span> &amp;&amp; <span class="r865 r">i</span>.<span class="i">GetGenericTypeDefinition</span>() == <b>typeof</b>(<span class="i">IDictionary</span>&lt;,&gt;))
                {
                    <span class="r864 r">isGeneric</span> = <b>true</b>;
                    <b>var</b> <span id="r866 rd" class="r866 r">genericArguments</span> = <span class="r865 r">i</span>.<span class="i">GetGenericArguments</span>();
                    <b>if</b> (<span class="r866 r">genericArguments</span>[0] == <b>typeof</b>(<b>string</b>))
                    {
                        <span class="c">// Our generic method for lookup takes IDictionary&lt;string,T&gt;, we need</span>
                        <span class="c">// to remember T.</span>
                        <span class="r863 r">genericTypeArg</span> = <span class="r866 r">genericArguments</span>[1];
                    }
                }
            }
 
            <b>return</b> <span class="r864 r">isGeneric</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the actual value, as an expression, of the object represented by target.  This</span>
        <span class="c">///</span><span class="c"> will get the base object if it&#39;s a psobject, plus correctly handle Nullable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Expression</span> <a id="b2d235f5ef39b2c2" href="../../../R/b2d235f5ef39b2c2.html" target="n" data-glyph="74,1" class="i method">GetTargetExpr</a>(<span class="i">DynamicMetaObject</span> <span id="r867 rd" class="r867 r">target</span>, <span class="i">Type</span> <span id="r868 rd" class="r868 r">castToType</span> = <b>null</b>)
        {
            <b>var</b> <span id="r869 rd" class="r869 r">expr</span> = <span class="r867 r">target</span>.<span class="i">Expression</span>;
            <b>var</b> <span id="r870 rd" class="r870 r">value</span> = <span class="r867 r">target</span>.<span class="i">Value</span>;
 
            <span class="c">// If the target value is actually a deserialized PSObject, we should use the original value</span>
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r871 rd" class="r871 r">psobj</span> = <span class="r870 r">value</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>if</b> (<span class="r871 r">psobj</span> != <b>null</b> &amp;&amp; <span class="r871 r">psobj</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a> &amp;&amp; !<span class="r871 r">psobj</span>.<a href="../../MshObject.cs.html#598b509cd0dd9b32" class="i property">IsDeserialized</a>)
            {
                <span class="r869 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r869 r">expr</span>);
                <span class="r870 r">value</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r870 r">value</span>);
            }
 
            <b>var</b> <span id="r872 rd" class="r872 r">type</span> = <span class="r868 r">castToType</span> ?? ((<span class="r870 r">value</span> != <b>null</b>) ? <span class="r870 r">value</span>.<span class="i">GetType</span>() : <b>typeof</b>(<b>object</b>));
 
            <b>if</b> (<span class="r869 r">expr</span>.<span class="i">Type</span> != <span class="r872 r">type</span>)
            {
                <span class="c">// Unbox value types (or use Nullable&lt;T&gt;.Value) to avoid a copy in case the value is mutated.</span>
                <span class="c">// In case that castToType is System.Object and expr.Type is Nullable&lt;ValueType&gt;, expr.Cast(System.Object) will</span>
                <span class="c">// get the underlying value by default. So &quot;GetTargetExpr(target).Cast(typeof(object))&quot; is actually the same as</span>
                <span class="c">// &quot;GetTargetExpr(target, typeof(object))&quot;.</span>
                <span class="r869 r">expr</span> = <span class="r872 r">type</span>.<span class="i">IsValueType</span>
                           ? (<span class="i">Nullable</span>.<span class="i">GetUnderlyingType</span>(<span class="r869 r">expr</span>.<span class="i">Type</span>) != <b>null</b>
                                  ? (<span class="i">Expression</span>)<span class="i">Expression</span>.<span class="i">Property</span>(<span class="r869 r">expr</span>, <span class="s">&quot;Value&quot;</span>)
                                  : <span class="i">Expression</span>.<span class="i">Unbox</span>(<span class="r869 r">expr</span>, <span class="r872 r">type</span>))
                           : <span class="r869 r">expr</span>.<span class="i">Cast</span>(<span class="r872 r">type</span>);
            }
 
            <b>return</b> <span class="r869 r">expr</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return the binding result when no property exists.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="c0d2962aae6ae284" href="../../../R/c0d2962aae6ae284.html" target="n" data-glyph="76,1" class="i method">PropertyDoesntExist</a>(<span class="i">DynamicMetaObject</span> <span id="r873 rd" class="r873 r">target</span>, <span class="i">BindingRestrictions</span> <span id="r874 rd" class="r874 r">restrictions</span>)
        {
            <span class="c">// If the property does not exist, but the target is enumerable, we&#39;ll turn this expression into roughly the equivalent</span>
            <span class="c">// pipeline:</span>
            <span class="c">//     $x | foreach-object { $_.Property }</span>
            <span class="c">// I say roughly because we&#39;ll actually iterate through $_ if it doesn&#39;t have Property and it is enumerable, and we&#39;ll</span>
            <span class="c">// do this recursively.  This makes it easy to chain property references and not worry if the property returns collections or not, e.g.:</span>
            <span class="c">//     $x.Modules.ModuleName</span>
            <span class="c">// If Modules returns a collection, but you want all the module names of all the modules, then it just works.</span>
            <span class="c">// The _nonEnumerating aspect of this binder is simply a way of avoiding the recursing inside the binder, allowing us to</span>
            <span class="c">// collect the results in the helper method we call.  One alternative to _nonEnumerating is to have the helper method</span>
            <span class="c">// not recurse, but mark it&#39;s return value specially so that recursive calls to the helper can detect that the results</span>
            <span class="c">// need to be flattened.</span>
            <span class="c">// IsEnumerable treats AutomationNull.Value as a zero length array which we don&#39;t want to do here.</span>
            <b>if</b> (!<a href="#0e03e6bc62be5da1" class="i field">_nonEnumerating</a> &amp;&amp; <span class="r873 r">target</span>.<span class="i">Value</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <b>var</b> <span id="r875 rd" class="r875 r">enumerable</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r873 r">target</span>);
                <b>if</b> (<span class="r875 r">enumerable</span> != <b>null</b>)
                {
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#bcfdfc818ba89e99" class="i field">EnumerableOps_PropertyGetter</a>,
                                        <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>.<a href="#22f07b16dd404da0" class="i method">GetNonEnumeratingBinder</a>()),
                                        <span class="r875 r">enumerable</span>.<span class="i">Expression</span>), <span class="r874 r">restrictions</span>);
                }
            }
 
            <span class="c">// As part of our effort to hide how a command can return a singleton or array, we want to allow people to iterate</span>
            <span class="c">// over singletons with the foreach statement (which has worked since V1) and a for loop, for example:</span>
            <span class="c">//     for ($i = 0; $i -lt $x.Length; $i++) { $x[$i] }</span>
            <span class="c">// If $x is a singleton, we want to return 1 for the length so code like this works correctly.</span>
            <span class="c">// We do not want this magic to show up in Get-Member output, tab completion, intellisense, etc.</span>
            <b>if</b> (<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;Length&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) || <span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;Count&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// $null.Count should be 0, anything else should be 1</span>
                <b>var</b> <span id="r876 rd" class="r876 r">resultCount</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r873 r">target</span>.<span class="i">Value</span>) == <b>null</b> ? 0 : 1;
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Condition</span>(
                        <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#5a5c94283e952580" class="i method">IsStrictMode</a>(2),
                        <a href="#e7cd6a26a3f3b40c" class="i method">ThrowPropertyNotFoundStrict</a>(),
                        <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(<span class="r876 r">resultCount</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))), <span class="r874 r">restrictions</span>);
            }
 
            <b>var</b> <span id="r877 rd" class="r877 r">result</span> = <span class="i">Expression</span>.<span class="i">Condition</span>(
                <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<a href="../../parser/Compiler.cs.html#5a5c94283e952580" class="i method">IsStrictMode</a>(2),
                <a href="#e7cd6a26a3f3b40c" class="i method">ThrowPropertyNotFoundStrict</a>(),
                <a href="#0e03e6bc62be5da1" class="i field">_nonEnumerating</a> ? <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#84591f5e881dc39e" class="i field">AutomationNullConstant</a> : <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>);
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r877 r">result</span>, <span class="r874 r">restrictions</span>);
        }
 
        <b>private</b> <span class="i">Expression</span> <a id="e7cd6a26a3f3b40c" href="../../../R/e7cd6a26a3f3b40c.html" target="n" data-glyph="76,1" class="i method">ThrowPropertyNotFoundStrict</a>()
        {
            <b>return</b> <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">CreateThrow</span>(<b>typeof</b>(<b>object</b>), <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#1bf4e08e17b4c044" class="t t">PropertyNotFoundException</a>),
                                        <b>new</b>[] { <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Exception</span>), <b>typeof</b>(<b>string</b>), <b>typeof</b>(<b>object</b>[]) },
                                        <span class="s">&quot;PropertyNotFoundStrict&quot;</span>, <b>null</b>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotFoundStrict</span>,
                                        <b>new</b> <b>object</b>[] { <span class="i">Name</span> });
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="608d3543493e8e93" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">EnsureAllowedInLanguageMode</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r878 rd" class="r878 r">context</span>, <span class="i">DynamicMetaObject</span> <span id="r879 rd" class="r879 r">target</span>, <b>object</b> <span id="r880 rd" class="r880 r">targetValue</span>,
            <b>string</b> <span id="r881 rd" class="r881 r">name</span>, <b>bool</b> <span id="r882 rd" class="r882 r">isStatic</span>, <span class="i">DynamicMetaObject</span>[] <span id="r883 rd" class="r883 r">args</span>, <span class="i">BindingRestrictions</span> <span id="r884 rd" class="r884 r">moreTests</span>, <b>string</b> <span id="r885 rd" class="r885 r">errorID</span>, <b>string</b> <span id="r886 rd" class="r886 r">resourceString</span>)
        {
            <b>if</b> (<span class="r878 r">context</span> != <b>null</b> &amp;&amp; <span class="r878 r">context</span>.<a href="../../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a>)
            {
                <b>if</b> (!<a href="#0b9960b04fe61e1d" class="i method">IsAllowedInConstrainedLanguage</a>(<span class="r880 r">targetValue</span>, <span class="r881 r">name</span>, <span class="r882 r">isStatic</span>))
                {
                    <b>return</b> <span class="r879 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r883 r">args</span>, <span class="r884 r">moreTests</span>, <span class="r885 r">errorID</span>, <span class="r886 r">resourceString</span>);
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>internal static bool</b> <a id="0b9960b04fe61e1d" href="../../../R/0b9960b04fe61e1d.html" target="n" data-glyph="74,1" class="i method">IsAllowedInConstrainedLanguage</a>(<b>object</b> <span id="r887 rd" class="r887 r">targetValue</span>, <b>string</b> <span id="r888 rd" class="r888 r">name</span>, <b>bool</b> <span id="r889 rd" class="r889 r">isStatic</span>)
        {
            <span class="c">// ToString allowed on any type</span>
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r888 r">name</span>, <span class="s">&quot;ToString&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// Otherwise, check if it&#39;s a core type</span>
            <span class="i">Type</span> <span id="r890 rd" class="r890 r">targetType</span> = <span class="r887 r">targetValue</span> <b>as</b> <span class="i">Type</span>;
            <b>if</b> ((!<span class="r889 r">isStatic</span>) || (<span class="r890 r">targetType</span> == <b>null</b>))
            {
                <span class="r890 r">targetType</span> = <span class="r887 r">targetValue</span>.<span class="i">GetType</span>();
            }
 
            <b>return</b> <a href="../../parser/TypeResolver.cs.html#5741cea1a14d9f96" class="t t">CoreTypes</a>.<a href="../../parser/TypeResolver.cs.html#d10504c799ad8de9" class="i method">Contains</a>(<span class="r890 r">targetType</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return the binding restriction that tests that an instance member does not exist, used when the binder</span>
        <span class="c">///</span><span class="c"> knows instance members might exist (because the name was added to some instance), but the object we&#39;re</span>
        <span class="c">///</span><span class="c"> currently binding does not have an instance member with the given member name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">BindingRestrictions</span> <a id="103473f2f2bc1308" href="../../../R/103473f2f2bc1308.html" target="n" data-glyph="74,1" class="i method">NotInstanceMember</a>(<span class="i">DynamicMetaObject</span> <span id="r891 rd" class="r891 r">target</span>)
        {
            <b>var</b> <span id="r892 rd" class="r892 r">memberInfoVar</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>));
            <b>var</b> <span id="r893 rd" class="r893 r">expr</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#9d70b40f06dc0a2b" class="i field">PSGetMemberBinder_TryGetInstanceMember</a>,
                                       <span class="r891 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>), <span class="r892 r">memberInfoVar</span>);
 
            <b>return</b> <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(<span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r892 r">memberInfoVar</span> }, <span class="i">Expression</span>.<span class="i">Not</span>(<span class="r893 r">expr</span>)));
        }
 
        <b>private static</b> <span class="i">Expression</span> <a id="1e91dac2e37399ae" href="../../../R/1e91dac2e37399ae.html" target="n" data-glyph="76,1" class="i method">WrapGetMemberInTry</a>(<span class="i">Expression</span> <span id="r894 rd" class="r894 r">expr</span>)
        {
            <span class="c">// This code ensures that getting a member doesn&#39;t raise an exception.  Mostly this is so that formatting</span>
            <span class="c">// always works.  As currently implemented, this will also affect C# code that uses the dynamic keyword.</span>
            <span class="c">// If we decide that the dynamic keyword should not mask exceptions, then we should create a new binder</span>
            <span class="c">// from PSObject.PSDynamicMetaObject.BindGetMember that passes in a flag so we know not to wrap in a try/catch.</span>
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">TryCatch</span>(
                <span class="r894 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                <span class="i">Expression</span>.<span class="i">Catch</span>(<b>typeof</b>(<a href="../../lang/parserutils.cs.html#4ea179424ce76612" class="t t">TerminateException</a>), <span class="i">Expression</span>.<span class="i">Rethrow</span>(<b>typeof</b>(<b>object</b>))),
                <span class="c">// Not sure if the following catch is necessary, but the interpreter has it.</span>
                <span class="i">Expression</span>.<span class="i">Catch</span>(<b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#4961d7a0f93a8280" class="t t">MethodException</a>), <span class="i">Expression</span>.<span class="i">Rethrow</span>(<b>typeof</b>(<b>object</b>))),
                <span class="c">// This catch is only needed if we have an IDictionary</span>
                <span class="i">Expression</span>.<span class="i">Catch</span>(<b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#1bf4e08e17b4c044" class="t t">PropertyNotFoundException</a>), <span class="i">Expression</span>.<span class="i">Rethrow</span>(<b>typeof</b>(<b>object</b>))),
                <span class="i">Expression</span>.<span class="i">Catch</span>(<b>typeof</b>(<span class="i">Exception</span>), <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resolve the alias, throwing an exception if a cycle is detected while resolving the alias.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <a id="578669b1a81fa370" href="../../../R/578669b1a81fa370.html" target="n" data-glyph="76,1" class="i method">ResolveAlias</a>(<a href="../../MshMemberInfo.cs.html#3a8a82efa05da144" class="t t">PSAliasProperty</a> <span id="r895 rd" class="r895 r">alias</span>, <span class="i">DynamicMetaObject</span> <span id="r896 rd" class="r896 r">target</span>, <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r897 rd" class="r897 r">aliases</span>,
            <span class="i">List</span>&lt;<span class="i">BindingRestrictions</span>&gt; <span id="r898 rd" class="r898 r">aliasRestrictions</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r898 r">aliasRestrictions</span> != <b>null</b>, <span class="s">&quot;aliasRestrictions cannot be null&quot;</span>);
            <b>if</b> (<span class="r897 r">aliases</span> == <b>null</b>)
            {
                <span class="r897 r">aliases</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; { <span class="r895 r">alias</span>.<a href="../../MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a> };
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r897 r">aliases</span>.<span class="i">Contains</span>(<span class="r895 r">alias</span>.<a href="../../MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>))
                {
                    <b>throw</b> <b>new</b> <span class="t">ExtendedTypeSystemException</span>(<span class="s">&quot;CycleInAliasLookup&quot;</span>, <b>null</b>, <span class="i">ExtendedTypeSystem</span>.<span class="i">CycleInAlias</span>, <span class="r895 r">alias</span>.<a href="../../MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>);
                }
 
                <span class="r897 r">aliases</span>.<span class="i">Add</span>(<span class="r895 r">alias</span>.<a href="../../MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>);
            }
 
            <b>bool</b> <span id="r899 rd" class="r899 r">canOptimize</span>;
            <span class="i">Type</span> <span id="r900 rd" class="r900 r">aliasConversionType</span>;
            <span class="i">BindingRestrictions</span> <span id="r901 rd" class="r901 r">restrictions</span>;
            <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <span id="r902 rd" class="r902 r">binder</span> = <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#f97fa109dcbba60d" class="i method">Get</a>(<span class="r895 r">alias</span>.<a href="../../MshMemberInfo.cs.html#47366420aae495a0" class="i property">ReferencedMemberName</a>, <a href="#e6e7844fee167917" class="i field">_classScope</a>, <b>false</b>);
            <span class="c">// if binder has instance member, then GetPSMemberInfo will not be able to resolve that..only FallbackGetMember</span>
            <span class="c">// can resolve that. In that case we simply return without further evaluation.</span>
            <b>if</b> (<span class="r902 r">binder</span>.<a href="#3936d148f85730d0" class="i property">HasInstanceMember</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r903 rd" class="r903 r">result</span> = <span class="r902 r">binder</span>.<span class="i">GetPSMemberInfo</span>(<span class="r896 r">target</span>, <b>out</b> <span class="r901 r">restrictions</span>, <b>out</b> <span class="r899 r">canOptimize</span>, <b>out</b> <span class="r900 r">aliasConversionType</span>,
                                                         <span class="i">MemberTypes</span>.<span class="i">Property</span>, <span class="r897 r">aliases</span>, <span class="r898 r">aliasRestrictions</span>);
            <b>return</b> <span class="r903 r">result</span>;
        }
 
        <b>internal</b> <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <a id="1c3000fc1e16fac3" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetPSMemberInfo</a>(<span class="i">DynamicMetaObject</span> <span id="r904 rd" class="r904 r">target</span>,
                                              <b>out</b> <span class="i">BindingRestrictions</span> <span id="r905 rd" class="r905 r">restrictions</span>,
                                              <b>out bool</b> <span id="r906 rd" class="r906 r">canOptimize</span>,
                                              <b>out</b> <span class="i">Type</span> <span id="r907 rd" class="r907 r">aliasConversionType</span>,
                                              <span class="i">MemberTypes</span> <span id="r908 rd" class="r908 r">memberTypeToOperateOn</span>,
                                              <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r909 rd" class="r909 r">aliases</span> = <b>null</b>,
                                              <span class="i">List</span>&lt;<span class="i">BindingRestrictions</span>&gt; <span id="r910 rd" class="r910 r">aliasRestrictions</span> = <b>null</b>)
        {
            <span class="r907 r">aliasConversionType</span> = <b>null</b>;
            <b>bool</b> <span id="r911 rd" class="r911 r">hasTypeTableMember</span>;
            <b>bool</b> <span id="r912 rd" class="r912 r">hasInstanceMember</span>;
            <span class="i">BindingRestrictions</span> <span id="r913 rd" class="r913 r">versionRestriction</span>;
            <b>lock</b> (<a href="#ef1a94f6eb6abfd5" class="k">this</a>)
            {
                <span class="r913 r">versionRestriction</span> = <a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>, <a href="#017a627d1c63e599" class="i field">_version</a>);
                <span class="r911 r">hasTypeTableMember</span> = <a href="#040034ae6ae22ff7" class="i field">_hasTypeTableMember</a>;
                <span class="r912 r">hasInstanceMember</span> = <a href="#a6ed952d0d3b81df" class="i field">_hasInstanceMember</a>;
            }
 
            <b>if</b> (<a href="#a3fc9a92870cf7ca" class="i field">_static</a>)
            {
                <span class="r905 r">restrictions</span> = <span class="r904 r">target</span>.<a href="#e54bf2b4c07733d1" class="i method">PSGetStaticMemberRestriction</a>();
                <span class="r905 r">restrictions</span> = <span class="r905 r">restrictions</span>.<span class="i">Merge</span>(<span class="r913 r">versionRestriction</span>);
                <span class="r906 r">canOptimize</span> = <b>true</b>;
 
                <b>return</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">GetStaticCLRMember</span>(<span class="r904 r">target</span>.<span class="i">Value</span>, <span class="i">Name</span>);
            }
 
            <span class="r906 r">canOptimize</span> = <b>false</b>;
 
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r914 rd" class="r914 r">unused</span>;
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(!<span class="i">TryGetInstanceMember</span>(<span class="r904 r">target</span>.<span class="i">Value</span>, <span class="i">Name</span>, <b>out</b> <span class="r914 r">unused</span>),
                                <span class="s">&quot;shouldn&#39;t get here if there is an instance member&quot;</span>);
 
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r915 rd" class="r915 r">memberInfo</span> = <b>null</b>;
            <a href="../../TypeTable.cs.html#d34ed619706e31fc" class="t t">ConsolidatedString</a> <span id="r916 rd" class="r916 r">typenames</span> = <b>null</b>;
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r917 rd" class="r917 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <a href="../../../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="k">var</a> <span id="r918 rd" class="r918 r">typeTable</span> = <span class="r917 r">context</span>?.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>;
 
            <b>if</b> (<span class="r911 r">hasTypeTableMember</span>)
            {
                <span class="r916 r">typenames</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">GetTypeNames</span>(<span class="r904 r">target</span>.<span class="i">Value</span>);
                <b>if</b> (<span class="r918 r">typeTable</span> != <b>null</b>)
                {
                    <span class="r915 r">memberInfo</span> = <span class="r918 r">typeTable</span>.<a href="../../TypeTable.cs.html#360ddf05c317b5ab" class="i method">GetMembers</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r916 r">typenames</span>)[<span class="i">Name</span>];
                    <b>if</b> (<span class="r915 r">memberInfo</span> != <b>null</b>)
                    {
                        <span class="r906 r">canOptimize</span> = <b>true</b>;
                    }
                }
            }
 
            <span class="c">// Check if the target value is actually a deserialized PSObject.</span>
            <span class="c">// - If so, we want to use the original value.</span>
            <span class="c">//   Mostly, a deserialized object is a PSObject with an empty immediate base object, and it&#39;s OK to call PSObject.Base()</span>
            <span class="c">//   on it in this case, because the method would just return the original PSObject. But if it&#39;s the deserialized object of</span>
            <span class="c">//   a container object (i.e. an object derived from IEnumerable, IList, or IDictionary), the immediate base object is a</span>
            <span class="c">//   Hashtable or ArrayList. In such case, we sometimes would lose the psadapted/psextended properties that we actually care</span>
            <span class="c">//   by using the base object.</span>
            <span class="c">//</span>
            <span class="c">//   One example is the XmlElement, which derives from IEnumerable. It is serialized/deserialized as a container object, and</span>
            <span class="c">//   the its element properties (i.e. $xmlElement.IP, where IP is actually an attribute name) are stored as psadapted properties</span>
            <span class="c">//   in the top-level PSObject.</span>
            <span class="c">//</span>
            <span class="c">//   See the comments about &#39;three interesting cases&#39; in PSInvokeMemberBinder.FallbackInvokeMember for more info.</span>
            <span class="c">//</span>
            <span class="c">// - If not, we want to use the base object, so that we might generate optimized code.</span>
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r919 rd" class="r919 r">psobj</span> = <span class="r904 r">target</span>.<span class="i">Value</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
            <b>bool</b> <span id="r920 rd" class="r920 r">isTargetDeserializedObject</span> = (<span class="r919 r">psobj</span> != <b>null</b>) &amp;&amp; (<span class="r919 r">psobj</span>.<a href="../../MshObject.cs.html#598b509cd0dd9b32" class="i property">IsDeserialized</a>);
            <b>object</b> <span id="r921 rd" class="r921 r">value</span> = <span class="r920 r">isTargetDeserializedObject</span> ? <span class="r904 r">target</span>.<span class="i">Value</span> : <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r904 r">target</span>.<span class="i">Value</span>);
 
            <a href="../../MshObject.cs.html#16d82eb261f231c0" class="k">var</a> <span id="r922 rd" class="r922 r">adapterSet</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#c3772e5257a3f0e8" class="i method">GetMappedAdapter</a>(<span class="r921 r">value</span>, <span class="r918 r">typeTable</span>);
            <b>if</b> (<span class="r915 r">memberInfo</span> == <b>null</b>)
            {
                <span class="r906 r">canOptimize</span> = <span class="r922 r">adapterSet</span>.<a href="../../MshObject.cs.html#ae0218d7abc2d496" class="i property">OriginalAdapter</a>.<a href="../../CoreAdapter.cs.html#7b7ccffa3fef6396" class="i method">CanSiteBinderOptimize</a>(<span class="r908 r">memberTypeToOperateOn</span>);
                <span class="c">// Don&#39;t bother looking for the member if we&#39;re not going to use it.</span>
                <b>if</b> (<span class="r906 r">canOptimize</span>)
                {
                    <span class="r915 r">memberInfo</span> = <span class="r922 r">adapterSet</span>.<a href="../../MshObject.cs.html#ae0218d7abc2d496" class="i property">OriginalAdapter</a>.<span class="i">BaseGetMember</span>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r921 r">value</span>, <span class="i">Name</span>);
                }
            }
 
            <b>if</b> (<span class="r915 r">memberInfo</span> == <b>null</b> &amp;&amp; <span class="r906 r">canOptimize</span> &amp;&amp; <span class="r922 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a> != <b>null</b>)
            {
                <span class="r915 r">memberInfo</span> = <span class="r922 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a>.<span class="i">BaseGetMember</span>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r921 r">value</span>, <span class="i">Name</span>);
            }
 
            <span class="c">// The member came from the type table or an adapter and isn&#39;t instance based, so the restriction will start</span>
            <span class="c">// with a version check</span>
            <span class="r905 r">restrictions</span> = <span class="r913 r">versionRestriction</span>;
 
            <span class="c">// When returning aliasRestrictions always include the version restriction</span>
            <b>if</b> (<span class="r910 r">aliasRestrictions</span> != <b>null</b>)
            {
                <span class="r910 r">aliasRestrictions</span>.<span class="i">Add</span>(<span class="r913 r">versionRestriction</span>);
            }
 
            <a href="../../MshMemberInfo.cs.html#3a8a82efa05da144" class="k">var</a> <span id="r923 rd" class="r923 r">alias</span> = <span class="r915 r">memberInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#3a8a82efa05da144" class="t t">PSAliasProperty</a>;
            <b>if</b> (<span class="r923 r">alias</span> != <b>null</b>)
            {
                <span class="r907 r">aliasConversionType</span> = <span class="r923 r">alias</span>.<a href="../../MshMemberInfo.cs.html#26cabaf098160925" class="i property">ConversionType</a>;
                <b>if</b> (<span class="r910 r">aliasRestrictions</span> == <b>null</b>)
                {
                    <span class="r910 r">aliasRestrictions</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">BindingRestrictions</span>&gt;();
                }
 
                <span class="r915 r">memberInfo</span> = <a href="#578669b1a81fa370" class="i method">ResolveAlias</a>(<span class="r923 r">alias</span>, <span class="r904 r">target</span>, <span class="r909 r">aliases</span>, <span class="r910 r">aliasRestrictions</span>);
                <b>if</b> (<span class="r915 r">memberInfo</span> == <b>null</b>)
                {
                    <span class="c">// this can happen in the cases where referenced name of the alias property</span>
                    <span class="c">// maps to an adapter that cannot optimize (like ManagementObjectAdapter)</span>
                    <span class="r906 r">canOptimize</span> = <b>false</b>;
                }
 
                <span class="c">// Merge alias restrictions</span>
                <b>foreach</b> (<b>var</b> <span id="r924 rd" class="r924 r">aliasRestriction</span> <b>in</b> <span class="r910 r">aliasRestrictions</span>)
                {
                    <span class="r905 r">restrictions</span> = <span class="r905 r">restrictions</span>.<span class="i">Merge</span>(<span class="r924 r">aliasRestriction</span>);
                }
            }
 
            <b>if</b> (<a href="#e6e7844fee167917" class="i field">_classScope</a> != <b>null</b> &amp;&amp; (<span class="r904 r">target</span>.<span class="i">LimitType</span> == <a href="#e6e7844fee167917" class="i field">_classScope</a> || <span class="r904 r">target</span>.<span class="i">LimitType</span>.<span class="i">IsSubclassOf</span>(<a href="#e6e7844fee167917" class="i field">_classScope</a>)) &amp;&amp; <span class="r922 r">adapterSet</span>.<a href="../../MshObject.cs.html#ae0218d7abc2d496" class="i property">OriginalAdapter</a> == <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#20218854b572ba17" class="i property">DotNetInstanceAdapter</a>)
            {
                <span class="i">List</span>&lt;<span class="i">MethodBase</span>&gt; <span id="r925 rd" class="r925 r">candidateMethods</span> = <b>null</b>;
                <b>foreach</b> (<b>var</b> <span id="r926 rd" class="r926 r">member</span> <b>in</b> <a href="#e6e7844fee167917" class="i field">_classScope</a>.<span class="i">GetMembers</span>(<span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">FlattenHierarchy</span> | <span class="i">BindingFlags</span>.<span class="i">NonPublic</span>))
                {
                    <b>if</b> (<a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="r926 r">member</span>.<span class="i">Name</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>var</b> <span id="r927 rd" class="r927 r">propertyInfo</span> = <span class="r926 r">member</span> <b>as</b> <span class="i">PropertyInfo</span>;
                        <b>if</b> (<span class="r927 r">propertyInfo</span> != <b>null</b>)
                        {
                            <b>var</b> <span id="r928 rd" class="r928 r">getMethod</span> = <span class="r927 r">propertyInfo</span>.<span class="i">GetGetMethod</span>(<span class="i">nonPublic</span>: <b>true</b>);
                            <b>var</b> <span id="r929 rd" class="r929 r">setMethod</span> = <span class="r927 r">propertyInfo</span>.<span class="i">GetSetMethod</span>(<span class="i">nonPublic</span>: <b>true</b>);
 
                            <b>if</b> ((<span class="r928 r">getMethod</span> == <b>null</b> || <span class="r928 r">getMethod</span>.<span class="i">IsFamily</span> || <span class="r928 r">getMethod</span>.<span class="i">IsPublic</span>) &amp;&amp;
                                (<span class="r929 r">setMethod</span> == <b>null</b> || <span class="r929 r">setMethod</span>.<span class="i">IsFamily</span> || <span class="r929 r">setMethod</span>.<span class="i">IsPublic</span>))
                            {
                                <span class="r915 r">memberInfo</span> = <b>new</b> <span class="t">PSProperty</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">Name</span>, <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#20218854b572ba17" class="i property">DotNetInstanceAdapter</a>, <span class="r904 r">target</span>.<span class="i">Value</span>, <b>new</b> <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#062ddd336e6b2596" class="t constructor">PropertyCacheEntry</a>(<span class="r927 r">propertyInfo</span>));
                            }
                        }
                        <b>else</b>
                        {
                            <b>var</b> <span id="r930 rd" class="r930 r">fieldInfo</span> = <span class="r926 r">member</span> <b>as</b> <span class="i">FieldInfo</span>;
                            <b>if</b> (<span class="r930 r">fieldInfo</span> != <b>null</b>)
                            {
                                <b>if</b> (<span class="r930 r">fieldInfo</span>.<span class="i">IsFamily</span>)
                                {
                                    <span class="r915 r">memberInfo</span> = <b>new</b> <span class="t">PSProperty</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">Name</span>, <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#20218854b572ba17" class="i property">DotNetInstanceAdapter</a>, <span class="r904 r">target</span>.<span class="i">Value</span>, <b>new</b> <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#e2913351242647ed" class="t constructor">PropertyCacheEntry</a>(<span class="r930 r">fieldInfo</span>));
                                }
                            }
                            <b>else</b>
                            {
                                <b>var</b> <span id="r931 rd" class="r931 r">methodInfo</span> = <span class="r926 r">member</span> <b>as</b> <span class="i">MethodInfo</span>;
                                <b>if</b> (<span class="r931 r">methodInfo</span> != <b>null</b> &amp;&amp; (<span class="r931 r">methodInfo</span>.<span class="i">IsPublic</span> || <span class="r931 r">methodInfo</span>.<span class="i">IsFamily</span>))
                                {
                                    <b>if</b> (<span class="r925 r">candidateMethods</span> == <b>null</b>)
                                    {
                                        <span class="r925 r">candidateMethods</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">MethodBase</span>&gt;();
                                    }
 
                                    <span class="r925 r">candidateMethods</span>.<span class="i">Add</span>(<span class="r931 r">methodInfo</span>);
                                }
                            }
                        }
                    }
                }
 
                <b>if</b> (<span class="r925 r">candidateMethods</span> != <b>null</b> &amp;&amp; <span class="r925 r">candidateMethods</span>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="k">var</a> <span id="r932 rd" class="r932 r">psMethodInfo</span> = <span class="r915 r">memberInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="t t">PSMethod</a>;
                    <b>if</b> (<span class="r932 r">psMethodInfo</span> != <b>null</b>)
                    {
                        <a href="../../CoreAdapter.cs.html#6dfefa2e34e759ac" class="k">var</a> <span id="r933 rd" class="r933 r">cacheEntry</span> = (<a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#6dfefa2e34e759ac" class="t t">MethodCacheEntry</a>)<span class="r932 r">psMethodInfo</span>.<a href="../../MshMemberInfo.cs.html#90d6e570e2f5700c" class="i field">adapterData</a>;
                        <span class="r925 r">candidateMethods</span>.<span class="i">AddRange</span>(<span class="r933 r">cacheEntry</span>.<a href="../../CoreAdapter.cs.html#faf234dfe054f8ec" class="i field">methodInformationStructures</a>.<span class="i">Select</span>(<b>static</b> <span id="r934 rd" class="r934 r">e</span> =&gt; <span class="r934 r">e</span>.<span class="i">method</span>));
                        <span class="r915 r">memberInfo</span> = <b>null</b>;
                    }
 
                    <b>if</b> (<span class="r915 r">memberInfo</span> != <b>null</b>)
                    {
                        <span class="c">// Ambiguous, it&#39;d be better to report an error other than &quot;can&#39;t find member&quot;, but I&#39;m lazy.</span>
                        <span class="r915 r">memberInfo</span> = <b>null</b>;
                    }
                    <b>else</b>
                    {
                        <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#6dfefa2e34e759ac" class="t t">MethodCacheEntry</a> <span id="r935 rd" class="r935 r">method</span> = <b>new</b> <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<span class="t">MethodCacheEntry</span>(<span class="r925 r">candidateMethods</span>);
                        <span class="r915 r">memberInfo</span> = <a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="t t">PSMethod</a>.<span class="i">Create</span>(<a href="#ef1a94f6eb6abfd5" class="k">this</a>.<span class="i">Name</span>, <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#20218854b572ba17" class="i property">DotNetInstanceAdapter</a>, <b>null</b>, <span class="r935 r">method</span>);
                    }
                }
            }
 
            <b>if</b> (<span class="r912 r">hasInstanceMember</span>)
            {
                <span class="c">// If this binder knows instance members exist, we need to make sure future objects going through this</span>
                <span class="c">// rule ensure they don&#39;t have an instance member.  I don&#39;t expect this rule to be generated or hit frequently.</span>
                <span class="r905 r">restrictions</span> = <span class="r905 r">restrictions</span>.<span class="i">Merge</span>(<a href="#103473f2f2bc1308" class="i method">NotInstanceMember</a>(<span class="r904 r">target</span>));
            }
 
            <span class="c">// We always need a type check, even if we&#39;ll be using the PSTypeNames because our generated code may contain</span>
            <span class="c">// conversions that don&#39;t work for arbitrary types.</span>
            <span class="r905 r">restrictions</span> = <span class="r905 r">restrictions</span>.<span class="i">Merge</span>(<span class="r904 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
 
            <span class="c">// If the target value is actually a deserialized PSObject, add a check to ensure that&#39;s the case. This check</span>
            <span class="c">// should be done after the type check.</span>
            <b>if</b> (<span class="r920 r">isTargetDeserializedObject</span>)
            {
                <span class="r905 r">restrictions</span> = <span class="r905 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                    <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r904 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#37ca152e8a9e51ee" class="i field">PSObject_IsDeserialized</a>)));
            }
 
            <b>if</b> (<span class="r911 r">hasTypeTableMember</span>)
            {
                <span class="c">// We need to make sure the type table we would use to find a member is the same type table that we used here to</span>
                <span class="c">// find (or not find) a member.  If they were different type tables, we could easily get different results.</span>
                <span class="r905 r">restrictions</span> = <span class="r905 r">restrictions</span>.<span class="i">Merge</span>(
                    <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#c7f82df6c45ce2a2" class="i field">PSGetMemberBinder_GetTypeTableFromTLS</a>), <span class="r918 r">typeTable</span>));
 
                <span class="c">// We also need to make sure the pstypename is the same.  It doesn&#39;t matter if we found something in the type table</span>
                <span class="c">// or not - the fact that we might find something in the type table is enough to require a check on the pstypename.</span>
                <span class="r905 r">restrictions</span> = <span class="r905 r">restrictions</span>.<span class="i">Merge</span>(
                        <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#9bbb82d1153782ef" class="i field">PSGetMemberBinder_IsTypeNameSame</a>, <span class="r904 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r916 r">typenames</span>.<a href="../../TypeTable.cs.html#16f0a7b631e4dbc5" class="i property">Key</a>))));
            }
 
            <b>return</b> <span class="r915 r">memberInfo</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Runtime helper methods
 
        <b>internal static</b> <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <a id="1cfe24dbfc85fb41" href="../../../R/1cfe24dbfc85fb41.html" target="n" data-glyph="74,1" class="i method">CloneMemberInfo</a>(<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r936 rd" class="r936 r">memberInfo</span>, <b>object</b> <span id="r937 rd" class="r937 r">obj</span>)
        {
            <span class="r936 r">memberInfo</span> = <span class="r936 r">memberInfo</span>.<a href="../../MshMemberInfo.cs.html#6a5051f6dba6b0e5" class="i method">Copy</a>();
            <span class="r936 r">memberInfo</span>.<a href="../../MshMemberInfo.cs.html#09e08aadb1e26459" class="i method">ReplicateInstance</a>(<span class="r937 r">obj</span>);
            <b>return</b> <span class="r936 r">memberInfo</span>;
        }
 
        <b>internal static object</b> <a id="4a844010f744d771" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetAdaptedValue</a>(<b>object</b> <span id="r938 rd" class="r938 r">obj</span>, <b>string</b> <span id="r939 rd" class="r939 r">member</span>)
        {
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r940 rd" class="r940 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r941 rd" class="r941 r">memberInfo</span> = <b>null</b>;
 
            <b>if</b> ((<span class="r940 r">context</span> != <b>null</b>) &amp;&amp; (<span class="r940 r">context</span>.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a> != <b>null</b>))
            {
                <a href="../../TypeTable.cs.html#d34ed619706e31fc" class="t t">ConsolidatedString</a> <span id="r942 rd" class="r942 r">typenames</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#0dfe59c032d463c4" class="i method">GetTypeNames</a>(<span class="r938 r">obj</span>);
                <span class="r941 r">memberInfo</span> = <span class="r940 r">context</span>.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>.<a href="../../TypeTable.cs.html#360ddf05c317b5ab" class="i method">GetMembers</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r942 r">typenames</span>)[<span class="r939 r">member</span>];
                <b>if</b> (<span class="r941 r">memberInfo</span> != <b>null</b>)
                {
                    <span class="r941 r">memberInfo</span> = <a href="#1cfe24dbfc85fb41" class="i method">CloneMemberInfo</a>(<span class="r941 r">memberInfo</span>, <span class="r938 r">obj</span>);
                }
            }
 
            <a href="../../MshObject.cs.html#16d82eb261f231c0" class="k">var</a> <span id="r943 rd" class="r943 r">adapterSet</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#c3772e5257a3f0e8" class="i method">GetMappedAdapter</a>(<span class="r938 r">obj</span>, <span class="r940 r">context</span>?.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>);
            <b>if</b> (<span class="r941 r">memberInfo</span> == <b>null</b>)
            {
                <span class="r941 r">memberInfo</span> = <span class="r943 r">adapterSet</span>.<a href="../../MshObject.cs.html#ae0218d7abc2d496" class="i property">OriginalAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r938 r">obj</span>, <span class="r939 r">member</span>);
            }
 
            <b>if</b> (<span class="r941 r">memberInfo</span> == <b>null</b> &amp;&amp; <span class="r943 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a> != <b>null</b>)
            {
                <span class="r941 r">memberInfo</span> = <span class="r943 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r938 r">obj</span>, <span class="r939 r">member</span>);
            }
 
            <b>if</b> (<span class="r941 r">memberInfo</span> != <b>null</b>)
            {
                <b>return</b> <span class="r941 r">memberInfo</span>.<a href="../../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>;
            }
 
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r939 r">member</span>, <span class="s">&quot;Length&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) || <b>string</b>.<span class="i">Equals</span>(<span class="r939 r">member</span>, <span class="s">&quot;Count&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> 1;
            }
 
            <b>if</b> (<span class="r940 r">context</span> != <b>null</b> &amp;&amp; <span class="r940 r">context</span>.<a href="../../ExecutionContext.cs.html#11a9985b406aed68" class="i method">IsStrictVersion</a>(2))
            {
                <span class="c">// If the member is undefined and we&#39;re in strict mode, throw an exception...</span>
                <b>throw</b> <b>new</b> <span class="t">PropertyNotFoundException</span>(<span class="s">&quot;PropertyNotFoundStrict&quot;</span>, <b>null</b>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotFoundStrict</span>,
                                                    <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<b>string</b>&gt;(<span class="r939 r">member</span>));
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>internal static bool</b> <a id="481129b12cebcc9d" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsTypeNameSame</a>(<b>object</b> <span id="r944 rd" class="r944 r">value</span>, <b>string</b> <span id="r945 rd" class="r945 r">typeName</span>)
        {
            <b>return</b> <span class="r944 r">value</span> != <b>null</b> &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#0dfe59c032d463c4" class="i method">GetTypeNames</a>(<span class="r944 r">value</span>).<a href="../../TypeTable.cs.html#16f0a7b631e4dbc5" class="i property">Key</a>, <span class="r945 r">typeName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
        }
 
        <b>internal static</b> <a href="../../../P/a09d9b2cb7b1f0db.html#a09d9b2cb7b1f0db" class="t t">TypeTable</a> <a id="f782b1f53bb6bc30" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetTypeTableFromTLS</a>()
        {
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r946 rd" class="r946 r">executionContext</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <b>return</b> <span class="r946 r">executionContext</span>?.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>;
        }
 
        <b>internal static bool</b> <a id="c481ec977bf84cbc" href="../../../R/c481ec977bf84cbc.html" target="n" data-glyph="74,1" class="i method">TryGetInstanceMember</a>(<b>object</b> <span id="r947 rd" class="r947 r">value</span>, <b>string</b> <span id="r948 rd" class="r948 r">memberName</span>, <b>out</b> <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r949 rd" class="r949 r">memberInfo</span>)
        {
            <a href="../../MshMemberInfo.cs.html#d9b894a5fd752b79" class="t t">PSMemberInfoInternalCollection</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt; <span id="r950 rd" class="r950 r">instanceMembers</span>;
            <span class="r949 r">memberInfo</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#364e445adfd28491" class="i method">HasInstanceMembers</a>(<span class="r947 r">value</span>, <b>out</b> <span class="r950 r">instanceMembers</span>) ? <span class="r950 r">instanceMembers</span><a href="../../MshMemberInfo.cs.html#fe158918a7413959">[</a><span class="r948 r">memberName</span>] : <b>null</b>;
 
            <b>return</b> (<span class="r949 r">memberInfo</span> != <b>null</b>);
        }
 
        <b>internal static bool</b> <a id="bb811a48a0440a8b" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">TryGetIDictionaryValue</a>(<span class="i">IDictionary</span> <span id="r951 rd" class="r951 r">hash</span>, <b>string</b> <span id="r952 rd" class="r952 r">memberName</span>, <b>out object</b> <span id="r953 rd" class="r953 r">value</span>)
        {
            <b>try</b>
            {
                <b>if</b> (<span class="r951 r">hash</span>.<span class="i">Contains</span>(<span class="r952 r">memberName</span>))
                {
                    <span class="r953 r">value</span> = <span class="r951 r">hash</span>[<span class="r952 r">memberName</span>];
                    <b>return</b> <b>true</b>;
                }
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span>)
            {
                <span class="c">// Ignore invalid operation exception, it can happen if the dictionary</span>
                <span class="c">// has keys that can&#39;t be compared to property.</span>
            }
 
            <span class="r953 r">value</span> = <b>null</b>;
            <b>return</b> <b>false</b>;
        }
 
        <b>internal static bool</b> <a id="d03db931285f842b" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">TryGetGenericDictionaryValue</a>&lt;<span id="r954 rd t" class="r954 r t">T</span>&gt;(<span class="i">IDictionary</span>&lt;<b>string</b>, <span class="r954 r t">T</span>&gt; <span id="r955 rd" class="r955 r">hash</span>, <b>string</b> <span id="r956 rd" class="r956 r">memberName</span>, <b>out object</b> <span id="r957 rd" class="r957 r">value</span>)
        {
            <span class="r954 r t">T</span> <span id="r958 rd" class="r958 r">result</span>;
            <b>if</b> (<span class="r955 r">hash</span>.<span class="i">TryGetValue</span>(<span class="r956 r">memberName</span>, <b>out</b> <span class="r958 r">result</span>))
            {
                <span class="r957 r">value</span> = <span class="r958 r">result</span>;
                <b>return</b> <b>true</b>;
            }
 
            <span class="r957 r">value</span> = <b>null</b>;
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Runtime helper methods
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The binder for setting a member, like $foo.bar = 1 or [foo]::bar = 1.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="b33a3e4647e9ce8d" href="../../../R/b33a3e4647e9ce8d.html" target="n" data-glyph="2,0" class="t t">PSSetMemberBinder</a> : <span class="i">SetMemberBinder</span>
    {
        <b>private sealed class</b> <a id="ae76145dd49be3a6" href="../../../R/../../0000000000.html" target="n" data-glyph="4,1" class="t t"><span id="b8b62f5901593806">KeyComparer</span></a> : <span class="i">IEqualityComparer</span>&lt;<span class="i">PSSetMemberBinderKeyType</span>&gt;
        {
            <b>public bool</b> <a id="5dc021624f47a888" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Equals</a>(<span class="i">PSSetMemberBinderKeyType</span> <span id="r959 rd" class="r959 r">x</span>, <span class="i">PSSetMemberBinderKeyType</span> <span id="r960 rd" class="r960 r">y</span>)
            {
                <span class="c">// The non-static binder cache is case-sensitive because sites need the name used per site</span>
                <span class="c">// when the target object is a case-sensitive IDictionary.  Under all other circumstances,</span>
                <span class="c">// binding is case-insensitive.</span>
                <b>var</b> <span id="r961 rd" class="r961 r">stringComparison</span> = <span class="r959 r">x</span>.<span class="i">Item3</span> ? <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span> : <span class="i">StringComparison</span>.<span class="i">Ordinal</span>;
                <b>return</b> <span class="r959 r">x</span>.<span class="i">Item1</span>.<span class="i">Equals</span>(<span class="r960 r">y</span>.<span class="i">Item1</span>, <span class="r961 r">stringComparison</span>) &amp;&amp;
                       <span class="r959 r">x</span>.<span class="i">Item2</span> == <span class="r960 r">y</span>.<span class="i">Item2</span> &amp;&amp;
                       <span class="r959 r">x</span>.<span class="i">Item3</span> == <span class="r960 r">y</span>.<span class="i">Item3</span>;
            }
 
            <b>public int</b> <a id="d49a22bbe759d4f8" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetHashCode</a>(<span class="i">PSSetMemberBinderKeyType</span> <span id="r962 rd" class="r962 r">obj</span>)
            {
                <b>var</b> <span id="r963 rd" class="r963 r">stringComparer</span> = <span class="r962 r">obj</span>.<span class="i">Item3</span> ? <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span> : <span class="i">StringComparer</span>.<span class="i">Ordinal</span>;
                <b>return</b> <a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<span class="i">CombineHashCodes</span>(<span class="r963 r">stringComparer</span>.<span class="i">GetHashCode</span>(<span class="r962 r">obj</span>.<span class="i">Item1</span>),
                    <span class="r962 r">obj</span>.<span class="i">Item2</span> == <b>null</b> ? 0 : <span class="r962 r">obj</span>.<span class="i">Item2</span>.<span class="i">GetHashCode</span>(),
                    <span class="r962 r">obj</span>.<span class="i">Item3</span>.<span class="i">GetHashCode</span>());
            }
        }
 
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">PSSetMemberBinderKeyType</span>, <a href="#b33a3e4647e9ce8d" class="t t">PSSetMemberBinder</a>&gt; <a id="2168a1171973bd30" href="../../../R/2168a1171973bd30.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a>
            = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">PSSetMemberBinderKeyType</span>, <a href="#b33a3e4647e9ce8d" class="t t">PSSetMemberBinder</a>&gt;(<b>new</b> <span class="t">KeyComparer</span>());
 
        <b>private readonly bool</b> <a id="36cb3893a030049b" href="../../../R/36cb3893a030049b.html" target="n" data-glyph="46,1" class="i field">_static</a>;
        <b>private readonly</b> <span class="i">Type</span> <a id="7cab5f6229d97520" href="../../../R/7cab5f6229d97520.html" target="n" data-glyph="46,1" class="i field">_classScope</a>;
        <b>private readonly</b> <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <a id="c5c2eb9ae7cf4c3d" href="../../../R/c5c2eb9ae7cf4c3d.html" target="n" data-glyph="46,1" class="i field">_getMemberBinder</a>;
 
        <b>public static</b> <a href="#b33a3e4647e9ce8d" class="t t">PSSetMemberBinder</a> <a id="eafd84b96ec1230d" href="../../../R/eafd84b96ec1230d.html" target="n" data-glyph="72,1" class="i method">Get</a>(<b>string</b> <span id="r964 rd" class="r964 r">memberName</span>, <a href="../../parser/ast.cs.html#d7f0bc21c0f10879" class="t t">TypeDefinitionAst</a> <span id="r965 rd" class="r965 r">classScopeAst</span>, <b>bool</b> <span id="r966 rd" class="r966 r">@static</span>)
        {
            <b>var</b> <span id="r967 rd" class="r967 r">classScope</span> = <span class="r965 r">classScopeAst</span>?.<a href="../../parser/ast.cs.html#238185060b3af590" class="i property">Type</a>;
            <b>return</b> <span class="i">Get</span>(<span class="r964 r">memberName</span>, <span class="r967 r">classScope</span>, <span class="r966 r">@static</span>);
        }
 
        <b>public static</b> <a href="#b33a3e4647e9ce8d" class="t t">PSSetMemberBinder</a> <a id="1066416587b6f493" href="../../../R/1066416587b6f493.html" target="n" data-glyph="72,1" class="i method">Get</a>(<b>string</b> <span id="r968 rd" class="r968 r">memberName</span>, <span class="i">Type</span> <span id="r969 rd" class="r969 r">classScope</span>, <b>bool</b> <span id="r970 rd" class="r970 r">@static</span>)
        {
            <a href="#b33a3e4647e9ce8d" class="t t">PSSetMemberBinder</a> <span id="r971 rd" class="r971 r">result</span>;
 
            <b>lock</b> (<a href="#2168a1171973bd30" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r972 rd" class="r972 r">tuple</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r968 r">memberName</span>, <span class="r969 r">classScope</span>, <span class="r970 r">@static</span>);
                <b>if</b> (!<a href="#2168a1171973bd30" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r972 r">tuple</span>, <b>out</b> <span class="r971 r">result</span>))
                {
                    <span class="r971 r">result</span> = <b>new</b> <a href="#12bf7343dea259dd" class="t constructor">PSSetMemberBinder</a>(<span class="r968 r">memberName</span>, <b>true</b>, <span class="r970 r">@static</span>, <span class="r969 r">classScope</span>);
                    <a href="#2168a1171973bd30" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r972 r">tuple</span>, <span class="r971 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r971 r">result</span>;
        }
 
        <b>public</b> <a id="12bf7343dea259dd" href="../../../R/12bf7343dea259dd.html" target="n" data-glyph="72,1" class="t constructor">PSSetMemberBinder</a>(<b>string</b> <span id="r973 rd" class="r973 r">name</span>, <b>bool</b> <span id="r974 rd" class="r974 r">ignoreCase</span>, <b>bool</b> <span id="r975 rd" class="r975 r">@static</span>, <span class="i">Type</span> <span id="r976 rd" class="r976 r">classScope</span>)
            : <b>base</b>(<span class="r973 r">name</span>, <span class="r974 r">ignoreCase</span>)
        {
            <a href="#36cb3893a030049b" class="i field">_static</a> = <span class="r975 r">@static</span>;
            <a href="#7cab5f6229d97520" class="i field">_classScope</a> = <span class="r976 r">classScope</span>;
            <a href="#c5c2eb9ae7cf4c3d" class="i field">_getMemberBinder</a> = <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#f97fa109dcbba60d" class="i method">Get</a>(<span class="r973 r">name</span>, <a href="#7cab5f6229d97520" class="i field">_classScope</a>, <span class="r975 r">@static</span>);
        }
 
        <b>public override string</b> <a id="cfe26b05e4ee1888" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;SetMember: {0}{1} ver:{2}&quot;</span>, <a href="#36cb3893a030049b" class="i field">_static</a> ? <span class="s">&quot;static &quot;</span> : <b>string</b>.<span class="i">Empty</span>, <span class="i">Name</span>, <a href="#c5c2eb9ae7cf4c3d" class="i field">_getMemberBinder</a>.<a href="#017a627d1c63e599" class="i field">_version</a>);
        }
 
        <b>private static</b> <span class="i">Expression</span> <a id="ccf7ed341f36563d" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetTransformedExpression</a>(<span class="i">IEnumerable</span>&lt;<a href="../../Attributes.cs.html#80472519ecf33cf1" class="t t">ArgumentTransformationAttribute</a>&gt; <span id="r977 rd" class="r977 r">transformationAttributes</span>, <span class="i">Expression</span> <span id="r978 rd" class="r978 r">originalExpression</span>)
        {
            <b>if</b> (<span class="r977 r">transformationAttributes</span> == <b>null</b>)
            {
                <b>return</b> <span class="r978 r">originalExpression</span>;
            }
 
            <b>var</b> <span id="r979 rd" class="r979 r">attributesArray</span> = <span class="r977 r">transformationAttributes</span>.<span class="i">ToArray</span>();
            <b>if</b> (<span class="r979 r">attributesArray</span>.<span class="i">Length</span> == 0)
            {
                <b>return</b> <span class="r978 r">originalExpression</span>;
            }
 
            <span class="i">Expression</span> <span id="r980 rd" class="r980 r">transformedExpression</span> = <span class="r978 r">originalExpression</span>.<span class="i">Convert</span>(<b>typeof</b>(<b>object</b>));
            <b>var</b> <span id="r981 rd" class="r981 r">engineIntrinsicsTempVar</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<a href="../../EngineIntrinsics.cs.html#e9f6dd7d61246066" class="t t">EngineIntrinsics</a>));
            <span class="c">// apply transformation attributes from right to left</span>
            <b>for</b> (<b>int</b> <span id="r982 rd" class="r982 r">i</span> = <span class="r979 r">attributesArray</span>.<span class="i">Length</span> - 1; <span class="r982 r">i</span> &gt;= 0; <span class="r982 r">i</span>--)
            {
                <span class="r980 r">transformedExpression</span> = <span class="i">Expression</span>.<span class="i">Call</span>(<span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r979 r">attributesArray</span>[<span class="r982 r">i</span>]),
                                                <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#05239b78c88ac1a4" class="i field">ArgumentTransformationAttribute_Transform</a>,
                                                <span class="r981 r">engineIntrinsicsTempVar</span>,
                                                <span class="r980 r">transformedExpression</span>);
            }
 
            <b>return</b> <span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r981 r">engineIntrinsicsTempVar</span> },
                <span class="i">Expression</span>.<span class="i">Assign</span>(
                    <span class="r981 r">engineIntrinsicsTempVar</span>,
                    <span class="i">Expression</span>.<span class="i">Property</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#a5a9149c45a2dbfc" class="i field">GetExecutionContextFromTLS</a>,
                                        <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#f42ef04bf2478e6a" class="i field">ExecutionContext_EngineIntrinsics</a>)),
                <span class="r980 r">transformedExpression</span>);
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="8393ffb1426e6712" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackSetMember</a>(<span class="i">DynamicMetaObject</span> <span id="r983 rd" class="r983 r">target</span>, <span class="i">DynamicMetaObject</span> <span id="r984 rd" class="r984 r">value</span>, <span class="i">DynamicMetaObject</span> <span id="r985 rd" class="r985 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r983 r">target</span>.<span class="i">HasValue</span> || !<span class="r984 r">value</span>.<span class="i">HasValue</span>)
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r983 r">target</span>, <span class="r984 r">value</span>);
            }
 
            <span class="c">// Defer COM objects or arguments wrapped in PSObjects</span>
            <b>if</b> ((<span class="r983 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r983 r">target</span>.<span class="i">Value</span>) != <span class="r983 r">target</span>.<span class="i">Value</span>)) ||
                (<span class="r984 r">value</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r984 r">value</span>.<span class="i">Value</span>) != <span class="r984 r">value</span>.<span class="i">Value</span>)))
            {
                <b>object</b> <span id="r986 rd" class="r986 r">baseObject</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r983 r">target</span>.<span class="i">Value</span>);
                <b>if</b> (<span class="r986 r">baseObject</span> != <b>null</b> &amp;&amp; <span class="i">Marshal</span>.<span class="i">IsComObject</span>(<span class="r986 r">baseObject</span>))
                {
                    <span class="c">// We unwrap only if the &#39;base&#39; of &#39;target&#39; is a COM object. It&#39;s unnecessary to unwrap in other cases,</span>
                    <span class="c">// especially in the case that &#39;target&#39; is a string, we would lose instance members on the PSObject.</span>
                    <span class="c">// Therefore, we need to use a stricter restriction to make sure PSObject &#39;target&#39; with other base types</span>
                    <span class="c">// doesn&#39;t get unwrapped.</span>
                    <b>return</b> <a href="#b33a3e4647e9ce8d" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r983 r">target</span>, <span class="r984 r">value</span>, <span class="i">targetIsComObject</span>: <b>true</b>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                }
            }
 
            <span class="c">// Check if this is a COM Object</span>
            <span class="i">DynamicMetaObject</span> <span id="r987 rd" class="r987 r">result</span>;
            <b>if</b> (<span class="i n">ComInterop</span>.<a href="../../ComInterop/ComBinder.cs.html#16ed1709a95d9070" class="t t">ComBinder</a>.<span class="i">TryBindSetMember</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>, <span class="r983 r">target</span>, <span class="r984 r">value</span>, <b>out</b> <span class="r987 r">result</span>))
            {
                <b>return</b> <span class="r987 r">result</span>.<a href="#ceefb8376e63f929" class="i method">UpdateComRestrictionsForPsObject</a>(<b>new</b> <span class="i">DynamicMetaObject</span>[] { <span class="r984 r">value</span> }).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
            }
 
            <b>var</b> <span id="r988 rd" class="r988 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r983 r">target</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r988 r">targetValue</span> == <b>null</b>)
            {
                <b>return</b> (<span class="r983 r">target</span>.<span class="i">ThrowRuntimeError</span>(<b>new</b>[] { <span class="r984 r">value</span> }, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;PropertyNotFound&quot;</span>,
                                                 <span class="i">ParserStrings</span>.<span class="i">PropertyNotFound</span>,
                                                 <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>))).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r984 r">value</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <span class="c">// Pretend the value was null (so we actually use null as the expression, but be sure</span>
                <span class="c">// to use a restriction that checks</span>
                <span class="r984 r">value</span> = <b>new</b> <span class="i">DynamicMetaObject</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>, <span class="r984 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>(), <b>null</b>);
            }
 
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r989 rd" class="r989 r">memberInfo</span>;
            <b>if</b> (<a href="#c5c2eb9ae7cf4c3d" class="i field">_getMemberBinder</a>.<a href="#3936d148f85730d0" class="i property">HasInstanceMember</a> &amp;&amp; <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">TryGetInstanceMember</span>(<span class="r983 r">target</span>.<span class="i">Value</span>, <span class="i">Name</span>, <b>out</b> <span class="r989 r">memberInfo</span>))
            {
                <span class="c">// If there is an instance member, we generate (roughly) the following:</span>
                <span class="c">//     PSMemberInfo memberInfo;</span>
                <span class="c">//     if (PSGetMemberBinder.TryGetInstanceMember(target.Value, Name, out memberInfo))</span>
                <span class="c">//         memberInfo.Value = value;</span>
                <span class="c">//     else</span>
                <span class="c">//         update the site</span>
                <span class="c">// We use a generic method like this because:</span>
                <span class="c">//   * If one object has an instance property with a given name, it&#39;s like many others do as well</span>
                <span class="c">//   * We want to avoid generating new sites for every object with an instance member</span>
                <span class="c">// As an alternative, would could generate the following psuedo-code:</span>
                <span class="c">//     if (target.Value == previousInstance)</span>
                <span class="c">//         return optimized value (depending on the exact PSMemberInfo subclass)</span>
                <span class="c">//     else update the site</span>
                <span class="c">// But the assumption here is that many sites probably performs worse than the dictionary lookup</span>
                <span class="c">// and unoptimized virtual call to PSMemberInfo.Value.</span>
                <span class="c">//</span>
                <span class="c">// The binding restrictions could avoid a version check because it&#39;s never wrong to look for an instance member,</span>
                <span class="c">// but we add the check because the DLR requires a non-empty check when the target implements IDynamicMetaObjectProvider,</span>
                <span class="c">// which PSObject does.  The version check is also marginally useful if we knew we&#39;d never see another</span>
                <span class="c">// instance member with this member name, but we&#39;re not tracking things to make that a useful test.</span>
 
                <b>var</b> <span id="r990 rd" class="r990 r">memberInfoVar</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>));
                <b>var</b> <span id="r991 rd" class="r991 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<b>object</b>));
                <b>var</b> <span id="r992 rd" class="r992 r">expr</span> = <span class="i">Expression</span>.<span class="i">Condition</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#9d70b40f06dc0a2b" class="i field">PSGetMemberBinder_TryGetInstanceMember</a>,
                                    <span class="r983 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>), <span class="r990 r">memberInfoVar</span>),
                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="i">Expression</span>.<span class="i">Property</span>(<span class="r990 r">memberInfoVar</span>, <span class="s">&quot;Value&quot;</span>), <span class="r984 r">value</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    <a href="#b33a3e4647e9ce8d" class="k">this</a>.<span class="i">GetUpdateExpression</span>(<b>typeof</b>(<b>object</b>)));
                <b>var</b> <span id="r993 rd" class="r993 r">bindingRestrictions</span> = <a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#c5c2eb9ae7cf4c3d" class="i field">_getMemberBinder</a>, <a href="#c5c2eb9ae7cf4c3d" class="i field">_getMemberBinder</a>.<a href="#017a627d1c63e599" class="i field">_version</a>)
                    .<span class="i">Merge</span>(<span class="r984 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r990 r">memberInfoVar</span>, <span class="r991 r">temp</span> }, <span class="r992 r">expr</span>),
                    <span class="r993 r">bindingRestrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r988 r">targetValue</span> <b>is</b> <span class="i">IDictionary</span>)
            {
                <span class="c">// We never look for properties in the underlying object, we always try to add the key.</span>
                <span class="i">Type</span> <span id="r994 rd" class="r994 r">genericTypeArg</span> = <b>null</b>;
                <b>bool</b> <span id="r995 rd" class="r995 r">isGeneric</span> = <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b13996cfa580e3d3" class="i method">IsGenericDictionary</a>(<span class="r988 r">targetValue</span>, <b>ref</b> <span class="r994 r">genericTypeArg</span>);
 
                <b>if</b> (!<span class="r995 r">isGeneric</span> || <span class="r994 r">genericTypeArg</span> != <b>null</b>)
                {
                    <span class="c">// If it&#39;s a generic, we must convert our value to genericTypeArg.</span>
                    <b>var</b> <span id="r996 rd" class="r996 r">hashType</span> = <span class="r995 r">isGeneric</span>
                        ? <b>typeof</b>(<span class="i">IDictionary</span>&lt;,&gt;).<span class="i">MakeGenericType</span>(<b>typeof</b>(<b>string</b>), <span class="r994 r">genericTypeArg</span>)
                        : <b>typeof</b>(<span class="i">IDictionary</span>);
                    <b>var</b> <span id="r997 rd" class="r997 r">mi</span> = <span class="r996 r">hashType</span>.<span class="i">GetMethod</span>(<span class="s">&quot;set_Item&quot;</span>);
 
                    <b>var</b> <span id="r998 rd" class="r998 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r994 r">genericTypeArg</span> ?? <b>typeof</b>(<b>object</b>));
 
                    <b>bool</b> <span id="r999 rd" class="r999 r">debase</span>;
                    <span class="i">Type</span> <span id="r1000 rd" class="r1000 r">elementType</span> = <span class="r998 r">temp</span>.<span class="i">Type</span>;
 
                    <span class="c">// ConstrainedLanguage note - Calls to this conversion are protected by the binding rules below</span>
                    <a href="../../LanguagePrimitives.cs.html#4cbbe0ec8ab6946f" class="k">var</a> <span id="r1001 rd" class="r1001 r">conversion</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">FigureConversion</span>(<span class="r984 r">value</span>.<span class="i">Value</span>, <span class="r1000 r">elementType</span>, <b>out</b> <span class="r999 r">debase</span>);
                    <b>if</b> (<span class="r1001 r">conversion</span>.<a href="../../LanguagePrimitives.cs.html#fcaf7d7aa628a092" class="i property">Rank</a> != <a href="../../LanguagePrimitives.cs.html#7366d8a93041350f" class="t t">ConversionRank</a>.<a href="../../LanguagePrimitives.cs.html#c8e6b7371e1dec03" class="i field">None</a>)
                    {
                        <b>var</b> <span id="r1002 rd" class="r1002 r">valueExpr</span> = <a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">InvokeConverter</span>(<span class="r1001 r">conversion</span>, <span class="r984 r">value</span>.<span class="i">Expression</span>, <span class="r1000 r">elementType</span>,
                                                                        <span class="r999 r">debase</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#1a63ed7b35442a0a" class="i field">InvariantCulture</a>);
                        <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r998 r">temp</span> },
                                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r998 r">temp</span>, <span class="r1002 r">valueExpr</span>),
                                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r983 r">target</span>, <span class="r996 r">hashType</span>), <span class="r997 r">mi</span>,
                                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>), <span class="r1002 r">valueExpr</span>),
                                <span class="r1002 r">valueExpr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                            <span class="r983 r">target</span>.<a href="#e7284c368e570df6" class="i method">CombineRestrictions</a>(<span class="r984 r">value</span>)).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                    }
                }
            }
 
            <span class="i">BindingRestrictions</span> <span id="r1003 rd" class="r1003 r">restrictions</span>;
            <b>bool</b> <span id="r1004 rd" class="r1004 r">canOptimize</span>;
            <span class="i">Type</span> <span id="r1005 rd" class="r1005 r">aliasConversionType</span>;
            <span class="r989 r">memberInfo</span> = <a href="#c5c2eb9ae7cf4c3d" class="i field">_getMemberBinder</a>.<span class="i">GetPSMemberInfo</span>(<span class="r983 r">target</span>, <b>out</b> <span class="r1003 r">restrictions</span>, <b>out</b> <span class="r1004 r">canOptimize</span>, <b>out</b> <span class="r1005 r">aliasConversionType</span>, <span class="i">MemberTypes</span>.<span class="i">Property</span>);
 
            <span class="r1003 r">restrictions</span> = <span class="r1003 r">restrictions</span>.<span class="i">Merge</span>(<span class="r984 r">value</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>());
 
            <span class="c">// If the process has ever used ConstrainedLanguage, then we need to add the language mode</span>
            <span class="c">// to the binding restrictions, and check whether it is allowed. We can&#39;t limit</span>
            <span class="c">// the language check to unsafe types, as a safe type might have an unsafe method.</span>
            <b>if</b> (<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#f3a9373a4fcbee98" class="i property">HasEverUsedConstrainedLanguage</a>)
            {
                <span class="r1003 r">restrictions</span> = <span class="r1003 r">restrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#6a24b97403a40c85" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>());
 
                <span class="c">// Validate that this is allowed in the current language mode</span>
                <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r1006 rd" class="r1006 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
                <span class="i">DynamicMetaObject</span> <span id="r1007 rd" class="r1007 r">runtimeError</span> = <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">EnsureAllowedInLanguageMode</span>(
                    <span class="r1006 r">context</span>, <span class="r983 r">target</span>, <span class="r988 r">targetValue</span>, <span class="i">Name</span>, <a href="#36cb3893a030049b" class="i field">_static</a>, <b>new</b>[] { <span class="r984 r">value</span> }, <span class="r1003 r">restrictions</span>,
                    <span class="s">&quot;PropertySetterNotSupportedInConstrainedLanguage&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">PropertySetConstrainedLanguage</span>);
                <b>if</b> (<span class="r1007 r">runtimeError</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r1007 r">runtimeError</span>.<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                }
            }
 
            <b>if</b> (!<span class="r1004 r">canOptimize</span>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r989 r">memberInfo</span> == <b>null</b>, <span class="s">&quot;We don&#39;t bother returning members if we can&#39;t optimize.&quot;</span>);
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#a9003d6e24f537e1" class="i field">PSSetMemberBinder_SetAdaptedValue</a>,
                                    <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r983 r">target</span>, <b>typeof</b>(<b>object</b>)),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>),
                                    <span class="r984 r">value</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                    <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r989 r">memberInfo</span> == <b>null</b>)
            {
                <b>return</b> (<span class="r985 r">errorSuggestion</span> ?? <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeError</span>(<span class="s">&quot;PropertyAssignmentException&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotFound</span>, <a href="#b33a3e4647e9ce8d" class="k">this</a>.<span class="i">ReturnType</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>)),
                    <span class="r1003 r">restrictions</span>)).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
            }
 
            <a href="../../MshMemberInfo.cs.html#13ab3796654e613c" class="k">var</a> <span id="r1008 rd" class="r1008 r">psPropertyInfo</span> = <span class="r989 r">memberInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a>;
            <b>if</b> (<span class="r1008 r">psPropertyInfo</span> != <b>null</b>)
            {
                <b>if</b> (!<span class="r1008 r">psPropertyInfo</span>.<a href="../../MshMemberInfo.cs.html#794d03c9459171a6" class="i property">IsSettable</a>)
                {
                    <b>return</b> <a href="#f92845238a529f20" class="i method">GeneratePropertyAssignmentException</a>(<span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                }
 
                <a href="../../MshMemberInfo.cs.html#3632258af753748e" class="k">var</a> <span id="r1009 rd" class="r1009 r">psProperty</span> = <span class="r1008 r">psPropertyInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#3632258af753748e" class="t t">PSProperty</a>;
                <b>if</b> (<span class="r1009 r">psProperty</span> != <b>null</b>)
                {
                    <a href="../../CoreAdapter.cs.html#e42273e13efeb8a7" class="k">var</a> <span id="r1010 rd" class="r1010 r">data</span> = <span class="r1009 r">psProperty</span>.<a href="../../MshMemberInfo.cs.html#d6dbce48987e002d" class="i field">adapterData</a> <b>as</b> <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#e42273e13efeb8a7" class="t t">PropertyCacheEntry</a>;
                    <b>if</b> (<span class="r1010 r">data</span> != <b>null</b>)
                    {
                        <span class="i">Expression</span> <span id="r1011 rd" class="r1011 r">expr</span>;
 
                        <b>if</b> (<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">DeclaringType</span>.<span class="i">IsGenericTypeDefinition</span>)
                        {
                            <span class="i">Expression</span> <span id="r1012 rd" class="r1012 r">innerException</span> = <span class="i">Expression</span>.<span class="i">New</span>(
                                <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4287f2a124c4e87d" class="i field">SetValueException_ctor</a>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;PropertyAssignmentException&quot;</span>),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotInvokeStaticMethodOnUninstantiatedGenericType</span>),
                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">DeclaringType</span>.<span class="i">FullName</span>)));
 
                            <span class="r1011 r">expr</span> = <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeErrorWithInnerException</span>(
                                <span class="s">&quot;PropertyAssignmentException&quot;</span>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotInvokeStaticMethodOnUninstantiatedGenericType</span>),
                                <span class="r1012 r">innerException</span>,
                                <a href="#b33a3e4647e9ce8d" class="k">this</a>.<span class="i">ReturnType</span>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">DeclaringType</span>.<span class="i">FullName</span>));
 
                            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1011 r">expr</span>, <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                        }
 
                        <b>if</b> (<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#46125476611507e4" class="i field">propertyType</a>.<span class="i">IsByRefLike</span>)
                        {
                            <span class="c">// In theory, it&#39;s possible to call the setter with a value that can be implicitly/explicitly casted to the target ByRef-like type.</span>
                            <span class="c">// However, the set-property/set-indexer semantics in PowerShell requires returning the value after the setting operation. We cannot</span>
                            <span class="c">// return a ByRef-like value back, so we just disallow setting a member that takes a ByRef-like type value.</span>
                            <span class="r1011 r">expr</span> = <span class="i">Expression</span>.<span class="i">Throw</span>(
                                <span class="i">Expression</span>.<span class="i">New</span>(
                                    <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4287f2a124c4e87d" class="i field">SetValueException_ctor</a>,
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<b>nameof</b>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotAccessByRefLikePropertyOrField</span>)),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotAccessByRefLikePropertyOrField</span>),
                                    <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(
                                        <b>typeof</b>(<b>object</b>),
                                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">Name</span>),
                                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#46125476611507e4" class="i field">propertyType</a>, <b>typeof</b>(<span class="i">Type</span>)))),
                                <a href="#b33a3e4647e9ce8d" class="k">this</a>.<span class="i">ReturnType</span>);
 
                            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1011 r">expr</span>, <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                        }
 
                        <b>var</b> <span id="r1013 rd" class="r1013 r">propertyInfo</span> = <span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a> <b>as</b> <span class="i">PropertyInfo</span>;
                        <span class="i">Expression</span> <span id="r1014 rd" class="r1014 r">lhs</span>;
                        <span class="i">Type</span> <span id="r1015 rd" class="r1015 r">lhsType</span>;
 
                        <span class="c">// Populate transformation attributes.</span>
                        <span class="c">// Order of attributes is the same as order provided by user in the code</span>
                        <span class="c">// We assume that GetCustomAttributes implemented that way.</span>
                        <span class="i">IEnumerable</span>&lt;<a href="../../Attributes.cs.html#80472519ecf33cf1" class="t t">ArgumentTransformationAttribute</a>&gt; <span id="r1016 rd" class="r1016 r">argumentTransformationAttributes</span> =
                            <span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">GetCustomAttributes</span>&lt;<a href="../../Attributes.cs.html#80472519ecf33cf1" class="t t">ArgumentTransformationAttribute</a>&gt;();
                        <b>bool</b> <span id="r1017 rd" class="r1017 r">transformationNeeded</span> = <span class="r1016 r">argumentTransformationAttributes</span>.<span class="i">Any</span>();
 
                        <span class="c">// For static property access, the target expr must be null.  For non-static, we must convert</span>
                        <span class="c">// because target.Expression is typeof(object) because this is a dynamic site.</span>
                        <b>var</b> <span id="r1018 rd" class="r1018 r">targetExpr</span> = <a href="#36cb3893a030049b" class="i field">_static</a> ? <b>null</b> : <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r983 r">target</span>, <span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>.<span class="i">DeclaringType</span>);
                        <b>if</b> (<span class="r1013 r">propertyInfo</span> != <b>null</b>)
                        {
                            <b>if</b> (<span class="r1013 r">propertyInfo</span>.<span class="i">SetMethod</span>.<span class="i">IsFamily</span> &amp;&amp;
                                (<a href="#7cab5f6229d97520" class="i field">_classScope</a> == <b>null</b> || !<a href="#7cab5f6229d97520" class="i field">_classScope</a>.<span class="i">IsSubclassOf</span>(<span class="r1013 r">propertyInfo</span>.<span class="i">DeclaringType</span>)))
                            {
                                <b>return</b> <a href="#f92845238a529f20" class="i method">GeneratePropertyAssignmentException</a>(<span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                            }
 
                            <span class="r1015 r">lhsType</span> = <span class="r1013 r">propertyInfo</span>.<span class="i">PropertyType</span>;
                            <span class="r1014 r">lhs</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r1018 r">targetExpr</span>, <span class="r1013 r">propertyInfo</span>);
                        }
                        <b>else</b>
                        {
                            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a> <b>is</b> <span class="i">FieldInfo</span>,
                                                <span class="s">&quot;A DotNetAdapter.PropertyCacheEntry has something other than PropertyInfo or FieldInfo.&quot;</span>);
                            <b>var</b> <span id="r1019 rd" class="r1019 r">fieldInfo</span> = (<span class="i">FieldInfo</span>)<span class="r1010 r">data</span>.<a href="../../CoreAdapter.cs.html#588c19f161433e56" class="i field">member</a>;
                            <span class="r1015 r">lhsType</span> = <span class="r1019 r">fieldInfo</span>.<span class="i">FieldType</span>;
                            <span class="r1014 r">lhs</span> = <span class="i">Expression</span>.<span class="i">Field</span>(<span class="r1018 r">targetExpr</span>, <span class="r1019 r">fieldInfo</span>);
                        }
 
                        <b>var</b> <span id="r1020 rd" class="r1020 r">nullableUnderlyingType</span> = <span class="i">Nullable</span>.<span class="i">GetUnderlyingType</span>(<span class="r1015 r">lhsType</span>);
                        <b>if</b> (<span class="r1020 r">nullableUnderlyingType</span> != <b>null</b>)
                        {
                            <b>if</b> (<span class="r984 r">value</span>.<span class="i">Value</span> == <b>null</b>)
                            {
                                <span class="r1011 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(
                                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1014 r">lhs</span>, <span class="i">GetTransformedExpression</span>(<span class="r1016 r">argumentTransformationAttributes</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <span class="r1015 r">lhsType</span>))),
                                    <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>);
                            }
                            <b>else</b>
                            {
                                <b>var</b> <span id="r1021 rd" class="r1021 r">tmp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r1020 r">nullableUnderlyingType</span>);
                                <span class="i">Expression</span> <span id="r1022 rd" class="r1022 r">assignmentExpression</span>;
                                <b>if</b> (<span class="r1017 r">transformationNeeded</span>)
                                {
                                    <b>var</b> <span id="r1023 rd" class="r1023 r">transformedExpr</span> = <span class="i">GetTransformedExpression</span>(<span class="r1016 r">argumentTransformationAttributes</span>, <span class="r984 r">value</span>.<span class="i">Expression</span>);
                                    <span class="r1022 r">assignmentExpression</span> = <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<span class="i">Get</span>(<span class="r1020 r">nullableUnderlyingType</span>), <span class="r1020 r">nullableUnderlyingType</span>, <span class="r1023 r">transformedExpr</span>);
                                }
                                <b>else</b>
                                {
                                    <span class="r1022 r">assignmentExpression</span> = <span class="r984 r">value</span>.<span class="i">CastOrConvert</span>(<span class="r1020 r">nullableUnderlyingType</span>);
                                }
 
                                <span class="r1011 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(
                                    <b>new</b>[] { <span class="r1021 r">tmp</span> },
                                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1021 r">tmp</span>, <span class="r1022 r">assignmentExpression</span>),
                                    <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1014 r">lhs</span>, <span class="i">Expression</span>.<span class="i">New</span>(<span class="r1015 r">lhsType</span>.<span class="i">GetConstructor</span>(<b>new</b>[] { <span class="r1020 r">nullableUnderlyingType</span> }), <span class="r1021 r">tmp</span>)),
                                    <span class="r1021 r">tmp</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
                            }
                        }
                        <b>else</b>
                        {
                            <b>var</b> <span id="r1024 rd" class="r1024 r">tmp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r1015 r">lhsType</span>);
                            <span class="i">Expression</span> <span id="r1025 rd" class="r1025 r">assignedValue</span>;
                            <b>if</b> (<span class="r1017 r">transformationNeeded</span>)
                            {
                                <span class="r1025 r">assignedValue</span> = <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#97a1cf18399e4247" class="t t">PSConvertBinder</a>.<a href="#eda18cf3e4f03bf5" class="i method">Get</a>(<span class="r1015 r">lhsType</span>), <span class="r1015 r">lhsType</span>,
                                   <span class="i">GetTransformedExpression</span>(<span class="r1016 r">argumentTransformationAttributes</span>, <span class="r984 r">value</span>.<span class="i">Expression</span>));
                            }
                            <b>else</b>
                            {
                                <span class="r1025 r">assignedValue</span> = (<span class="r1015 r">lhsType</span> == <b>typeof</b>(<b>object</b>) &amp;&amp; <span class="r984 r">value</span>.<span class="i">LimitType</span> == <b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>))
                                                           ? <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r984 r">value</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)))
                                                           : <span class="r984 r">value</span>.<a href="#a45395fd79b0352d" class="i method">CastOrConvert</a>(<span class="r1015 r">lhsType</span>);
                            }
 
                            <span class="r1011 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(
                                <b>new</b>[] { <span class="r1024 r">tmp</span> },
                                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1024 r">tmp</span>, <span class="r1025 r">assignedValue</span>),
                                <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1014 r">lhs</span>, <span class="r1024 r">tmp</span>),
                                <span class="r1024 r">tmp</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
                        }
 
                        <b>var</b> <span id="r1026 rd" class="r1026 r">e</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<span class="i">Exception</span>));
                        <span class="r1011 r">expr</span> = <span class="i">Expression</span>.<span class="i">TryCatch</span>(<span class="r1011 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                            <span class="i">Expression</span>.<span class="i">Catch</span>(<span class="r1026 r">e</span>,
                                <span class="i">Expression</span>.<span class="i">Block</span>(
                                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#333c817a08775c10" class="i field">ExceptionHandlingOps_ConvertToMethodInvocationException</a>,
                                                    <span class="r1026 r">e</span>,
                                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#a6e4ca1bdc5aff64" class="t t">SetValueInvocationException</a>), <b>typeof</b>(<span class="i">Type</span>)),
                                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>),
                                                    <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#9f6df0bb7efa2829" class="i method">Constant</a>(0),
                                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">MemberInfo</span>))),
                                    <span class="i">Expression</span>.<span class="i">Rethrow</span>(<b>typeof</b>(<b>object</b>)))));
                        <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1011 r">expr</span>, <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                    }
                }
 
                <a href="../../MshMemberInfo.cs.html#c36513189382c70d" class="k">var</a> <span id="r1027 rd" class="r1027 r">codeProperty</span> = <span class="r1008 r">psPropertyInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#c36513189382c70d" class="t t">PSCodeProperty</a>;
                <b>if</b> (<span class="r1027 r">codeProperty</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r1028 rd" class="r1028 r">setterMethod</span> = <span class="r1027 r">codeProperty</span>.<a href="../../MshMemberInfo.cs.html#a7928fdfd9f46d3b" class="i property">SetterCodeReference</a>;
                    <b>var</b> <span id="r1029 rd" class="r1029 r">parameters</span> = <span class="r1028 r">setterMethod</span>.<span class="i">GetParameters</span>();
                    <b>var</b> <span id="r1030 rd" class="r1030 r">propertyType</span> = <span class="r1029 r">parameters</span>[<span class="r1029 r">parameters</span>.<span class="i">Length</span> - 1].<span class="i">ParameterType</span>;
 
                    <b>if</b> (<span class="r1030 r">propertyType</span>.<span class="i">IsByRefLike</span>)
                    {
                        <b>var</b> <span id="r1031 rd" class="r1031 r">expr</span> = <span class="i">Expression</span>.<span class="i">Throw</span>(
                            <span class="i">Expression</span>.<span class="i">New</span>(
                                <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4287f2a124c4e87d" class="i field">SetValueException_ctor</a>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<b>nameof</b>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotAccessByRefLikePropertyOrField</span>)),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotAccessByRefLikePropertyOrField</span>),
                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(
                                    <b>typeof</b>(<b>object</b>),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1027 r">codeProperty</span>.<a href="../../MshMemberInfo.cs.html#02d8236d3d236301" class="i property">Name</a>),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1030 r">propertyType</span>, <b>typeof</b>(<span class="i">Type</span>)))),
                            <a href="#b33a3e4647e9ce8d" class="k">this</a>.<span class="i">ReturnType</span>);
 
                        <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1031 r">expr</span>, <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                    }
 
                    <b>var</b> <span id="r1032 rd" class="r1032 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<b>object</b>));
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Block</span>(
                            <b>new</b>[] { <span class="r1032 r">temp</span> },
                            <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1032 r">temp</span>, <span class="r984 r">value</span>.<span class="i">CastOrConvert</span>(<span class="r1032 r">temp</span>.<span class="i">Type</span>)),
                            <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<span class="i">InvokeMethod</span>(
                                <span class="r1028 r">setterMethod</span>,
                                <span class="i">target</span>: <b>null</b>,
                                <b>new</b>[] { <span class="r983 r">target</span>, <span class="r984 r">value</span> },
                                <span class="i">expandParameters</span>: <b>false</b>,
                                <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#cdfe26e93c3e7526" class="i field">Setter</a>),
                            <span class="r1032 r">temp</span>),
                        <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                }
 
                <a href="../../MshMemberInfo.cs.html#b68884f0eb8d8ebb" class="k">var</a> <span id="r1033 rd" class="r1033 r">scriptProperty</span> = <span class="r1008 r">psPropertyInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#b68884f0eb8d8ebb" class="t t">PSScriptProperty</a>;
                <b>if</b> (<span class="r1033 r">scriptProperty</span> != <b>null</b>)
                {
                    <span class="c">// Invoke Setter</span>
 
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1033 r">scriptProperty</span>, <b>typeof</b>(<a href="../../MshMemberInfo.cs.html#b68884f0eb8d8ebb" class="t t">PSScriptProperty</a>)),
                                        <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#efe53272332c15db" class="i field">PSScriptProperty_InvokeSetter</a>,
                                        <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b2d235f5ef39b2c2" class="i method">GetTargetExpr</a>(<span class="r983 r">target</span>), <span class="r984 r">value</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                        <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
                }
 
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;The property we&#39;re trying to set was unexpected.&quot;</span>);
            }
 
            <b>if</b> (<span class="r985 r">errorSuggestion</span> != <b>null</b>)
            {
                <b>return</b> <span class="r985 r">errorSuggestion</span>.<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
            }
 
            <span class="c">// If we get here, the property isn&#39;t settable.  Call SetAdaptedValue, which will eventually call the setter and raise an exception</span>
            <span class="c">// with a suitable error message.</span>
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#a9003d6e24f537e1" class="i field">PSSetMemberBinder_SetAdaptedValue</a>,
                                <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r983 r">target</span>, <b>typeof</b>(<b>object</b>)), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>),
                                <span class="r984 r">value</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                <span class="r1003 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b33a3e4647e9ce8d" class="k">this</a>);
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="f92845238a529f20" href="../../../R/f92845238a529f20.html" target="n" data-glyph="76,1" class="i method">GeneratePropertyAssignmentException</a>(<span class="i">BindingRestrictions</span> <span id="r1034 rd" class="r1034 r">restrictions</span>)
        {
            <span class="i">Expression</span> <span id="r1035 rd" class="r1035 r">innerException</span> = <span class="i">Expression</span>.<span class="i">New</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4287f2a124c4e87d" class="i field">SetValueException_ctor</a>,
                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;PropertyAssignmentException&quot;</span>),
                <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ParserStrings</span>.<span class="i">PropertyIsReadOnly</span>),
                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>)));
            <b>var</b> <span id="r1036 rd" class="r1036 r">expr</span> = <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeErrorWithInnerException</span>(<span class="s">&quot;PropertyAssignmentException&quot;</span>,
                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ParserStrings</span>.<span class="i">PropertyIsReadOnly</span>), <span class="r1035 r">innerException</span>,
                <a href="#b33a3e4647e9ce8d" class="k">this</a>.<span class="i">ReturnType</span>, <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>));
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1036 r">expr</span>, <span class="r1034 r">restrictions</span>);
        }
 
        <b>internal static object</b> <a id="f26355606298b7f7" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">SetAdaptedValue</a>(<b>object</b> <span id="r1037 rd" class="r1037 r">obj</span>, <b>string</b> <span id="r1038 rd" class="r1038 r">member</span>, <b>object</b> <span id="r1039 rd" class="r1039 r">value</span>)
        {
            <b>try</b>
            {
                <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r1040 rd" class="r1040 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
                <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r1041 rd" class="r1041 r">memberInfo</span> = <b>null</b>;
 
                <b>if</b> ((<span class="r1040 r">context</span> != <b>null</b>) &amp;&amp; (<span class="r1040 r">context</span>.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a> != <b>null</b>))
                {
                    <a href="../../TypeTable.cs.html#d34ed619706e31fc" class="t t">ConsolidatedString</a> <span id="r1042 rd" class="r1042 r">typenames</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#0dfe59c032d463c4" class="i method">GetTypeNames</a>(<span class="r1037 r">obj</span>);
                    <span class="r1041 r">memberInfo</span> = <span class="r1040 r">context</span>.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>.<a href="../../TypeTable.cs.html#360ddf05c317b5ab" class="i method">GetMembers</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r1042 r">typenames</span>)[<span class="r1038 r">member</span>];
                    <b>if</b> (<span class="r1041 r">memberInfo</span> != <b>null</b>)
                    {
                        <span class="r1041 r">memberInfo</span> = <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#1cfe24dbfc85fb41" class="i method">CloneMemberInfo</a>(<span class="r1041 r">memberInfo</span>, <span class="r1037 r">obj</span>);
                    }
                }
 
                <a href="../../MshObject.cs.html#16d82eb261f231c0" class="k">var</a> <span id="r1043 rd" class="r1043 r">adapterSet</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#c3772e5257a3f0e8" class="i method">GetMappedAdapter</a>(<span class="r1037 r">obj</span>, <span class="r1040 r">context</span>?.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>);
                <b>if</b> (<span class="r1041 r">memberInfo</span> == <b>null</b>)
                {
                    <span class="r1041 r">memberInfo</span> = <span class="r1043 r">adapterSet</span>.<a href="../../MshObject.cs.html#ae0218d7abc2d496" class="i property">OriginalAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r1037 r">obj</span>, <span class="r1038 r">member</span>);
                }
 
                <b>if</b> (<span class="r1041 r">memberInfo</span> == <b>null</b> &amp;&amp; <span class="r1043 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a> != <b>null</b>)
                {
                    <span class="r1041 r">memberInfo</span> = <span class="r1043 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r1037 r">obj</span>, <span class="r1038 r">member</span>);
                }
 
                <b>if</b> (<span class="r1041 r">memberInfo</span> != <b>null</b>)
                {
                    <span class="r1041 r">memberInfo</span>.<a href="../../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a> = <span class="r1039 r">value</span>;
                }
                <b>else</b>
                {
                    <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<b>null</b>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                                                                   <b>null</b>, <span class="s">&quot;PropertyAssignmentException&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">PropertyNotFound</span>, <span class="r1038 r">member</span>);
                }
 
                <b>return</b> <span class="r1039 r">value</span>;
            }
            <b>catch</b> (<a href="../../ExtendedTypeSystemException.cs.html#8f44bde8a24c50c0" class="t t">SetValueException</a>)
            {
                <b>throw</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r1044 rd" class="r1044 r">e</span>)
            {
                <a href="../Operations/MiscOps.cs.html#2b2e6cffbdd33d20" class="t t">ExceptionHandlingOps</a>.<span class="i">ConvertToMethodInvocationException</span>(<span class="r1044 r">e</span>, <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#a6e4ca1bdc5aff64" class="t t">SetValueInvocationException</a>), <span class="r1038 r">member</span>, 0);
                <b>throw</b>;
            }
        }
 
        <b>internal static void</b> <a id="ba4541a8fbb6beec" href="../../../R/ba4541a8fbb6beec.html" target="n" data-glyph="74,1" class="i method">InvalidateCache</a>()
        {
            <span class="c">// Invalidate regular binders</span>
            <b>lock</b> (<a href="#2168a1171973bd30" class="i field">s_binderCache</a>)
            {
                <b>foreach</b> (<a href="#b33a3e4647e9ce8d" class="t t">PSSetMemberBinder</a> <span id="r1045 rd" class="r1045 r">binder</span> <b>in</b> <a href="#2168a1171973bd30" class="i field">s_binderCache</a>.<span class="i">Values</span>)
                {
                    <span class="r1045 r">binder</span>.<a href="#c5c2eb9ae7cf4c3d" class="i field">_getMemberBinder</a>.<a href="#017a627d1c63e599" class="i field">_version</a> += 1;
                }
            }
        }
    }
 
    <b>internal class</b> <a id="aa6b58b1e8149a2f" href="../../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">PSInvokeBinder</a> : <span class="i">InvokeBinder</span>
    {
        <b>internal</b> <a id="8d2b26ac79274d1e" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">PSInvokeBinder</a>(<span class="i">CallInfo</span> <span id="r1046 rd" class="r1046 r">callInfo</span>) : <b>base</b>(<span class="r1046 r">callInfo</span>)
        {
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="c34508288ff52666" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackInvoke</a>(<span class="i">DynamicMetaObject</span> <span id="r1047 rd" class="r1047 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1048 rd" class="r1048 r">args</span>, <span class="i">DynamicMetaObject</span> <span id="r1049 rd" class="r1049 r">errorSuggestion</span>)
        {
            <b>return</b> <span class="r1049 r">errorSuggestion</span> ?? <span class="r1047 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r1048 r">args</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;CannotInvoke&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">CannotInvoke</span>);
        }
    }
 
    <b>internal sealed class</b> <a id="0e3dce2a001305f0" href="../../../R/0e3dce2a001305f0.html" target="n" data-glyph="2,0" class="t t">PSInvokeMemberBinder</a> : <span class="i">InvokeMemberBinder</span>
    {
        <b>internal enum</b> <a id="caab5d926251a58a" href="../../../R/caab5d926251a58a.html" target="n" data-glyph="20,1" class="t t"><span id="4978d2c2d6d73e0d">MethodInvocationType</span></a>
        {
            <a id="dbd5ee8f8c01b054" href="../../../R/dbd5ee8f8c01b054.html" target="n" data-glyph="24,2" class="i field">Ordinary</a>,
            <a id="cdfe26e93c3e7526" href="../../../R/cdfe26e93c3e7526.html" target="n" data-glyph="24,2" class="i field">Setter</a>,
            <a id="f73ea19c23857d11" href="../../../R/f73ea19c23857d11.html" target="n" data-glyph="24,2" class="i field">Getter</a>,
            <a id="24150beef32edfa9" href="../../../R/24150beef32edfa9.html" target="n" data-glyph="24,2" class="i field">BaseCtor</a>,
            <a id="e186aaea1ddc6b7d" href="../../../R/e186aaea1ddc6b7d.html" target="n" data-glyph="24,2" class="i field">NonVirtual</a>,
        }
 
        <b>private sealed class</b> <a id="91b71055e1f6ed40" href="../../../R/../../0000000000.html" target="n" data-glyph="4,1" class="t t"><span id="5b7851ee12607b74">KeyComparer</span></a> : <span class="i">IEqualityComparer</span>&lt;<span class="i">PSInvokeMemberBinderKeyType</span>&gt;
        {
            <b>public bool</b> <a id="2f8e401fab710b18" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Equals</a>(<span class="i">PSInvokeMemberBinderKeyType</span> <span id="r1050 rd" class="r1050 r">x</span>, <span class="i">PSInvokeMemberBinderKeyType</span> <span id="r1051 rd" class="r1051 r">y</span>)
            {
                <b>return</b> <span class="r1050 r">x</span>.<span class="i">Item1</span>.<span class="i">Equals</span>(<span class="r1051 r">y</span>.<span class="i">Item1</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                       &amp;&amp; <span class="r1050 r">x</span>.<span class="i">Item2</span>.<span class="i">Equals</span>(<span class="r1051 r">y</span>.<span class="i">Item2</span>)
                       &amp;&amp; <span class="r1050 r">x</span>.<span class="i">Item3</span> == <span class="r1051 r">y</span>.<span class="i">Item3</span>
                       &amp;&amp; <span class="r1050 r">x</span>.<span class="i">Item4</span> == <span class="r1051 r">y</span>.<span class="i">Item4</span>
                       &amp;&amp; ((<span class="r1050 r">x</span>.<span class="i">Item5</span> == <b>null</b>) ? (<span class="r1051 r">y</span>.<span class="i">Item5</span> == <b>null</b>) : <span class="r1050 r">x</span>.<span class="i">Item5</span>.<span class="i">Equals</span>(<span class="r1051 r">y</span>.<span class="i">Item5</span>))
                       &amp;&amp; <span class="r1050 r">x</span>.<span class="i">Item6</span> == <span class="r1051 r">y</span>.<span class="i">Item6</span>
                       &amp;&amp; <span class="r1050 r">x</span>.<span class="i">Item7</span> == <span class="r1051 r">y</span>.<span class="i">Item7</span>;
            }
 
            <b>public int</b> <a id="f62adf24a5c69576" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetHashCode</a>(<span class="i">PSInvokeMemberBinderKeyType</span> <span id="r1052 rd" class="r1052 r">obj</span>)
            {
                <b>return</b> <a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<span class="i">CombineHashCodes</span>(
                    <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>.<span class="i">GetHashCode</span>(<span class="r1052 r">obj</span>.<span class="i">Item1</span>),
                    <span class="r1052 r">obj</span>.<span class="i">Item2</span>.<span class="i">GetHashCode</span>(),
                    <span class="r1052 r">obj</span>.<span class="i">Item3</span>.<span class="i">GetHashCode</span>(),
                    <span class="r1052 r">obj</span>.<span class="i">Item4</span>.<span class="i">GetHashCode</span>(),
                    <span class="r1052 r">obj</span>.<span class="i">Item5</span> == <b>null</b> ? 0 : <span class="r1052 r">obj</span>.<span class="i">Item5</span>.<span class="i">GetHashCode</span>(),
                    <span class="r1052 r">obj</span>.<span class="i">Item6</span>.<span class="i">GetHashCode</span>(),
                    <span class="r1052 r">obj</span>.<span class="i">Item7</span> == <b>null</b> ? 0 : <span class="r1052 r">obj</span>.<span class="i">Item7</span>.<span class="i">GetHashCode</span>());
            }
        }
 
        <b>private static readonly</b>
            <span class="i">Dictionary</span>&lt;<span class="i">PSInvokeMemberBinderKeyType</span>, <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>&gt; <a id="ecccc74425f28bfc" href="../../../R/ecccc74425f28bfc.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">PSInvokeMemberBinderKeyType</span>, <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>&gt;(<b>new</b> <span class="t">KeyComparer</span>());
 
        <b>internal readonly</b> <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <a id="e03fcdc93e1b20b4" href="../../../R/e03fcdc93e1b20b4.html" target="n" data-glyph="44,1" class="i field">_invocationConstraints</a>;
        <b>internal readonly</b> <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a> <a id="a17331156d5f2d73" href="../../../R/a17331156d5f2d73.html" target="n" data-glyph="44,1" class="i field">_getMemberBinder</a>;
 
        <b>private</b> <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a> <a id="c5c5a7cdd1119258" href="../../../R/c5c5a7cdd1119258.html" target="n" data-glyph="76,1" class="i method">GetNonEnumeratingBinder</a>()
        {
            <b>return</b> <span class="i">Get</span>(<span class="i">Name</span>, <a href="#792295fa595296b8" class="i field">_classScope</a>, <span class="i">CallInfo</span>, <span class="i">@static</span>: <b>false</b>, <span class="i">propertySetter</span>: <a href="#16b5cbb796280618" class="i field">_propertySetter</a>, <span class="i">nonEnumerating</span>: <b>true</b>, <span class="i">constraints</span>: <a href="#e03fcdc93e1b20b4" class="i field">_invocationConstraints</a>);
        }
 
        <b>public static</b> <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a> <a id="c69981bfa66f66e3" href="../../../R/c69981bfa66f66e3.html" target="n" data-glyph="72,1" class="i method">Get</a>(<b>string</b> <span id="r1053 rd" class="r1053 r">memberName</span>, <span class="i">CallInfo</span> <span id="r1054 rd" class="r1054 r">callInfo</span>, <b>bool</b> <span id="r1055 rd" class="r1055 r">@static</span>, <b>bool</b> <span id="r1056 rd" class="r1056 r">propertySetter</span>,
                                               <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1057 rd" class="r1057 r">constraints</span>, <span class="i">Type</span> <span id="r1058 rd" class="r1058 r">classScope</span>)
        {
            <b>return</b> <a href="#f128f416363e6783" class="i method">Get</a>(<span class="r1053 r">memberName</span>, <span class="r1058 r">classScope</span>, <span class="r1054 r">callInfo</span>, <span class="r1055 r">@static</span>, <span class="r1056 r">propertySetter</span>, <span class="r1059 r">nonEnumerating</span>: <b>false</b>, <span class="r1060 r">constraints</span>: <span class="r1057 r">constraints</span>);
        }
 
        <b>private static</b> <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a> <a id="f128f416363e6783" href="../../../R/f128f416363e6783.html" target="n" data-glyph="76,1" class="i method">Get</a>(<b>string</b> <span id="r1061 rd" class="r1061 r">memberName</span>, <span class="i">Type</span> <span id="r1062 rd" class="r1062 r">classScope</span>, <span class="i">CallInfo</span> <span id="r1063 rd" class="r1063 r">callInfo</span>, <b>bool</b> <span id="r1064 rd" class="r1064 r">@static</span>, <b>bool</b> <span id="r1065 rd" class="r1065 r">propertySetter</span>,
                                                <b>bool</b> <span id="r1059 rd" class="r1059 r">nonEnumerating</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1060 rd" class="r1060 r">constraints</span>)
        {
            <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a> <span id="r1066 rd" class="r1066 r">result</span>;
 
            <b>lock</b> (<a href="#ecccc74425f28bfc" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r1067 rd" class="r1067 r">key</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r1061 r">memberName</span>, <span class="r1063 r">callInfo</span>, <span class="r1065 r">propertySetter</span>, <span class="r1059 r">nonEnumerating</span>, <span class="r1060 r">constraints</span>, <span class="r1064 r">@static</span>, <span class="r1062 r">classScope</span>);
                <b>if</b> (!<a href="#ecccc74425f28bfc" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r1067 r">key</span>, <b>out</b> <span class="r1066 r">result</span>))
                {
                    <span class="r1066 r">result</span> = <b>new</b> <a href="#7729b81deac5d850" class="t constructor">PSInvokeMemberBinder</a>(<span class="r1061 r">memberName</span>, <b>true</b>, <span class="r1064 r">@static</span>, <span class="r1065 r">propertySetter</span>, <span class="r1059 r">nonEnumerating</span>, <span class="r1063 r">callInfo</span>, <span class="r1060 r">constraints</span>, <span class="r1062 r">classScope</span>);
                    <a href="#ecccc74425f28bfc" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r1067 r">key</span>, <span class="r1066 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r1066 r">result</span>;
        }
 
        <b>private readonly bool</b> <a id="7edcfd888f3532d5" href="../../../R/7edcfd888f3532d5.html" target="n" data-glyph="46,1" class="i field">_static</a>;
        <b>private readonly bool</b> <a id="16b5cbb796280618" href="../../../R/16b5cbb796280618.html" target="n" data-glyph="46,1" class="i field">_propertySetter</a>;
        <b>private readonly bool</b> <a id="b9e3d5a317faa8a6" href="../../../R/b9e3d5a317faa8a6.html" target="n" data-glyph="46,1" class="i field">_nonEnumerating</a>;
        <b>private readonly</b> <span class="i">Type</span> <a id="792295fa595296b8" href="../../../R/792295fa595296b8.html" target="n" data-glyph="46,1" class="i field">_classScope</a>;
 
        <b>private</b> <a id="7729b81deac5d850" href="../../../R/7729b81deac5d850.html" target="n" data-glyph="76,1" class="t constructor">PSInvokeMemberBinder</a>(<b>string</b> <span id="r1068 rd" class="r1068 r">name</span>,
                                     <b>bool</b> <span id="r1069 rd" class="r1069 r">ignoreCase</span>,
                                     <b>bool</b> <span id="r1070 rd" class="r1070 r">@static</span>,
                                     <b>bool</b> <span id="r1071 rd" class="r1071 r">propertySetter</span>,
                                     <b>bool</b> <span id="r1072 rd" class="r1072 r">nonEnumerating</span>,
                                     <span class="i">CallInfo</span> <span id="r1073 rd" class="r1073 r">callInfo</span>,
                                     <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1074 rd" class="r1074 r">invocationConstraints</span>,
                                     <span class="i">Type</span> <span id="r1075 rd" class="r1075 r">classScope</span>)
            : <b>base</b>(<span class="r1068 r">name</span>, <span class="r1069 r">ignoreCase</span>, <span class="r1073 r">callInfo</span>)
        {
            <a href="#7edcfd888f3532d5" class="i field">_static</a> = <span class="r1070 r">@static</span>;
            <a href="#16b5cbb796280618" class="i field">_propertySetter</a> = <span class="r1071 r">propertySetter</span>;
            <a href="#b9e3d5a317faa8a6" class="i field">_nonEnumerating</a> = <span class="r1072 r">nonEnumerating</span>;
            <a href="#0e3dce2a001305f0" class="k">this</a>.<a href="#e03fcdc93e1b20b4" class="i field">_invocationConstraints</a> = <span class="r1074 r">invocationConstraints</span>;
            <a href="#792295fa595296b8" class="i field">_classScope</a> = <span class="r1075 r">classScope</span>;
            <a href="#0e3dce2a001305f0" class="k">this</a>.<a href="#a17331156d5f2d73" class="i field">_getMemberBinder</a> = <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#f97fa109dcbba60d" class="i method">Get</a>(<span class="r1068 r">name</span>, <span class="r1075 r">classScope</span>, <span class="r1070 r">@static</span>);
        }
 
        <b>public override string</b> <a id="4df198f6d1ece4d0" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="s">&quot;PSInvokeMember: {0}{1}{2} ver:{3} args:{4} constraints:&lt;{5}&gt;&quot;</span>, <a href="#7edcfd888f3532d5" class="i field">_static</a> ? <span class="s">&quot;static &quot;</span> : <b>string</b>.<span class="i">Empty</span>, <a href="#16b5cbb796280618" class="i field">_propertySetter</a> ? <span class="s">&quot;propset &quot;</span> : <b>string</b>.<span class="i">Empty</span>,
                <span class="i">Name</span>, <a href="#a17331156d5f2d73" class="i field">_getMemberBinder</a>.<a href="#017a627d1c63e599" class="i field">_version</a>, <span class="i">CallInfo</span>.<span class="i">ArgumentCount</span>, <a href="#e03fcdc93e1b20b4" class="i field">_invocationConstraints</a> != <b>null</b> ? <a href="#e03fcdc93e1b20b4" class="i field">_invocationConstraints</a>.<a href="../../MshMemberInfo.cs.html#315c57da5cc14f92" class="i method">ToString</a>() : <b>string</b>.<span class="i">Empty</span>);
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="2166844a9d0640d8" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackInvokeMember</a>(<span class="i">DynamicMetaObject</span> <span id="r1076 rd" class="r1076 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1077 rd" class="r1077 r">args</span>, <span class="i">DynamicMetaObject</span> <span id="r1078 rd" class="r1078 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r1076 r">target</span>.<span class="i">HasValue</span> || <span class="r1077 r">args</span>.<span class="i">Any</span>(<b>static</b> <span id="r1079 rd" class="r1079 r">arg</span> =&gt; !<span class="r1079 r">arg</span>.<span class="i">HasValue</span>))
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r1077 r">args</span>.<span class="i">Prepend</span>(<span class="r1076 r">target</span>).<span class="i">ToArray</span>());
            }
 
            <span class="c">// Defer COM objects or arguments wrapped in PSObjects</span>
            <b>if</b> ((<span class="r1076 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1076 r">target</span>.<span class="i">Value</span>) != <span class="r1076 r">target</span>.<span class="i">Value</span>)) ||
                <span class="r1077 r">args</span>.<span class="i">Any</span>(<b>static</b> <span id="r1080 rd" class="r1080 r">mo</span> =&gt; <span class="r1080 r">mo</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> &amp;&amp; (<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1080 r">mo</span>.<span class="i">Value</span>) != <span class="r1080 r">mo</span>.<span class="i">Value</span>)))
            {
                <b>object</b> <span id="r1081 rd" class="r1081 r">baseObject</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1076 r">target</span>.<span class="i">Value</span>);
                <b>if</b> (<span class="r1081 r">baseObject</span> != <b>null</b> &amp;&amp; <span class="i">Marshal</span>.<span class="i">IsComObject</span>(<span class="r1081 r">baseObject</span>))
                {
                    <span class="c">// We unwrap only if the &#39;base&#39; of &#39;target&#39; is a COM object. It&#39;s unnecessary to unwrap in other cases,</span>
                    <span class="c">// especially in the case that &#39;target&#39; is a string, we would lose instance members on the PSObject.</span>
                    <span class="c">// Therefore, we need to use a stricter restriction to make sure other type of PSObject &#39;target&#39;</span>
                    <span class="c">// doesn&#39;t get unwrapped.</span>
                    <b>return</b> <a href="#0e3dce2a001305f0" class="k">this</a>.<span class="i">DeferForPSObject</span>(<span class="r1077 r">args</span>.<span class="i">Prepend</span>(<span class="r1076 r">target</span>).<span class="i">ToArray</span>(), <span class="i">targetIsComObject</span>: <b>true</b>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                }
            }
 
            <span class="c">// Check if this is a COM Object</span>
            <span class="i">DynamicMetaObject</span> <span id="r1082 rd" class="r1082 r">result</span>;
            <b>if</b> (<span class="i n">ComInterop</span>.<a href="../../ComInterop/ComBinder.cs.html#16ed1709a95d9070" class="t t">ComBinder</a>.<span class="i">TryBindInvokeMember</span>(<a href="#0e3dce2a001305f0" class="k">this</a>, <a href="#16b5cbb796280618" class="i field">_propertySetter</a>, <span class="r1076 r">target</span>, <span class="r1077 r">args</span>, <b>out</b> <span class="r1082 r">result</span>))
            {
                <b>return</b> <span class="r1082 r">result</span>.<a href="#ceefb8376e63f929" class="i method">UpdateComRestrictionsForPsObject</a>(<span class="r1077 r">args</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <b>var</b> <span id="r1083 rd" class="r1083 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1076 r">target</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r1083 r">targetValue</span> == <b>null</b>)
            {
                <b>if</b> (!<a href="#7edcfd888f3532d5" class="i field">_static</a> &amp;&amp; !<a href="#b9e3d5a317faa8a6" class="i field">_nonEnumerating</a>)
                {
                    <span class="c">// As discussed with Bruce, the Where/ForEach operators should work on $null and return an empty collection.</span>
                    <span class="c">// e.g. $null.Where{&quot;I didn&#39;t run&quot;} should return an empty collection</span>
                    <span class="i">DynamicMetaObject</span> <span id="r1084 rd" class="r1084 r">emptyEnumerator</span> = <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#6f928f7817a7ff84" class="i field">IEnumerable_GetEnumerator</a>),
                        <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r1076 r">target</span>.<span class="i">Expression</span>), <b>null</b>))
                        .<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                    <span class="i">BindingRestrictions</span> <span id="r1085 rd" class="r1085 r">argRestrictions</span> = <span class="r1077 r">args</span>.<span class="i">Aggregate</span>(<span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <b>static</b> (<span id="r1086 rd" class="r1086 r">current</span>, <span id="r1087 rd" class="r1087 r">arg</span>) =&gt; <span class="r1086 r">current</span>.<span class="i">Merge</span>(<span class="r1087 r">arg</span>.<span class="i">PSGetMethodArgumentRestriction</span>()));
 
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="i">Name</span>, <span class="s">&quot;Where&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>return</b> <a href="#5d7340f983651b1d" class="i method">InvokeWhereOnCollection</a>(<span class="r1084 r">emptyEnumerator</span>, <span class="r1077 r">args</span>, <span class="r1085 r">argRestrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                    }
 
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="i">Name</span>, <span class="s">&quot;ForEach&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>return</b> <a href="#a61540d098265df8" class="i method">InvokeForEachOnCollection</a>(<span class="r1084 r">emptyEnumerator</span>, <span class="r1077 r">args</span>, <span class="r1085 r">argRestrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                    }
                }
 
                <b>return</b> <span class="r1076 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r1077 r">args</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;InvokeMethodOnNull&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">InvokeMethodOnNull</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a> <span id="r1088 rd" class="r1088 r">memberInfo</span>;
            <b>if</b> (<a href="#a17331156d5f2d73" class="i field">_getMemberBinder</a>.<a href="#3936d148f85730d0" class="i property">HasInstanceMember</a> &amp;&amp; <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">TryGetInstanceMember</span>(<span class="r1076 r">target</span>.<span class="i">Value</span>, <span class="i">Name</span>, <b>out</b> <span class="r1088 r">memberInfo</span>))
            {
                <span class="c">// If there is an instance member, we generate (roughly) the following:</span>
                <span class="c">//     PSMethodInfo methodInfo;</span>
                <span class="c">//     if (PSInvokeMemberBinder.TryGetInstanceMethod(target.Value, Name, out methodInfoInfo))</span>
                <span class="c">//         return methodInfo.Invoke(target, args);</span>
                <span class="c">//     else</span>
                <span class="c">//         update the site</span>
                <span class="c">// We use a generic method like this because:</span>
                <span class="c">//   * If one object has an instance property with a given name, it&#39;s like many others do as well</span>
                <span class="c">//   * We want to avoid generating new sites for every object with an instance member</span>
                <span class="c">// As an alternative, would could generate the following psuedo-code:</span>
                <span class="c">//     if (target.Value == previousInstance)</span>
                <span class="c">//         return optimized value (depending on the exact PSMemberInfo subclass)</span>
                <span class="c">//     else update the site</span>
                <span class="c">// But the assumption here is that many sites probably performs worse than the dictionary lookup</span>
                <span class="c">// and unoptimized virtual call to PSMemberInfo.Value.</span>
                <span class="c">//</span>
                <span class="c">// The binding restrictions could avoid a version check because it&#39;s never wrong to look for an instance member,</span>
                <span class="c">// but we add the check because the DLR requires a non-empty check when the target implements IDynamicMetaObjectProvider,</span>
                <span class="c">// which PSObject does.  The version check is also marginally useful if we knew we&#39;d never see another</span>
                <span class="c">// instance member with this member name, but we&#39;re not tracking things to make that a useful test.</span>
 
                <b>var</b> <span id="r1089 rd" class="r1089 r">methodInfoVar</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="t t">PSMethodInfo</a>));
                <b>var</b> <span id="r1090 rd" class="r1090 r">expr</span> = <span class="i">Expression</span>.<span class="i">Condition</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#2f601f9a9f86eb4c" class="i field">PSInvokeMemberBinder_TryGetInstanceMethod</a>,
                                    <span class="r1076 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>), <span class="r1089 r">methodInfoVar</span>),
                    <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r1089 r">methodInfoVar</span>, <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#ee9256a1c534a1be" class="i field">PSMethodInfo_Invoke</a>,
                                    <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="r1077 r">args</span>.<span class="i">Select</span>(<b>static</b> <span id="r1091 rd" class="r1091 r">dmo</span> =&gt; <span class="r1091 r">dmo</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))))),
                    <a href="#0e3dce2a001305f0" class="k">this</a>.<span class="i">GetUpdateExpression</span>(<b>typeof</b>(<b>object</b>)));
 
                <b>return</b> (<b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">Expression</span>.<span class="i">Block</span>(<b>new</b>[] { <span class="r1089 r">methodInfoVar</span> }, <span class="r1090 r">expr</span>),
                    <a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetVersionCheck</span>(<a href="#a17331156d5f2d73" class="i field">_getMemberBinder</a>, <a href="#a17331156d5f2d73" class="i field">_getMemberBinder</a>.<a href="#017a627d1c63e599" class="i field">_version</a>))).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <span class="i">BindingRestrictions</span> <span id="r1092 rd" class="r1092 r">restrictions</span>;
            <b>bool</b> <span id="r1093 rd" class="r1093 r">canOptimize</span>;
            <span class="i">Type</span> <span id="r1094 rd" class="r1094 r">aliasConversionType</span>;
            <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="k">var</a> <span id="r1095 rd" class="r1095 r">methodInfo</span> = <a href="#a17331156d5f2d73" class="i field">_getMemberBinder</a>.<span class="i">GetPSMemberInfo</span>(<span class="r1076 r">target</span>, <b>out</b> <span class="r1092 r">restrictions</span>, <b>out</b> <span class="r1093 r">canOptimize</span>, <b>out</b> <span class="r1094 r">aliasConversionType</span>, <span class="i">MemberTypes</span>.<span class="i">Method</span>) <b>as</b> <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="t t">PSMethodInfo</a>;
            <span class="r1092 r">restrictions</span> = <span class="r1077 r">args</span>.<span class="i">Aggregate</span>(<span class="r1092 r">restrictions</span>, <b>static</b> (<span id="r1096 rd" class="r1096 r">current</span>, <span id="r1097 rd" class="r1097 r">arg</span>) =&gt; <span class="r1096 r">current</span>.<span class="i">Merge</span>(<span class="r1097 r">arg</span>.<span class="i">PSGetMethodArgumentRestriction</span>()));
 
            <span class="c">// If the process has ever used ConstrainedLanguage, then we need to add the language mode</span>
            <span class="c">// to the binding restrictions, and check whether it is allowed. We can&#39;t limit</span>
            <span class="c">// the language check to unsafe types, as a safe type might have an unsafe method.</span>
            <b>if</b> (<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#f3a9373a4fcbee98" class="i property">HasEverUsedConstrainedLanguage</a>)
            {
                <span class="r1092 r">restrictions</span> = <span class="r1092 r">restrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<a href="#6a24b97403a40c85" class="i method">GetLanguageModeCheckIfHasEverUsedConstrainedLanguage</a>());
 
                <span class="c">// Validate that this is allowed in the current language mode</span>
                <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r1098 rd" class="r1098 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
                <span class="i">DynamicMetaObject</span> <span id="r1099 rd" class="r1099 r">runtimeError</span> = <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">EnsureAllowedInLanguageMode</span>(
                    <span class="r1098 r">context</span>, <span class="r1076 r">target</span>, <span class="r1083 r">targetValue</span>, <span class="i">Name</span>, <a href="#7edcfd888f3532d5" class="i field">_static</a>, <span class="r1077 r">args</span>, <span class="r1092 r">restrictions</span>,
                    <span class="s">&quot;MethodInvocationNotSupportedInConstrainedLanguage&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">InvokeMethodConstrainedLanguage</span>);
                <b>if</b> (<span class="r1099 r">runtimeError</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r1099 r">runtimeError</span>.<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                }
            }
 
            <b>if</b> (!<span class="r1093 r">canOptimize</span>)
            {
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r1095 r">methodInfo</span> == <b>null</b>, <span class="s">&quot;We don&#39;t bother returning members if we can&#39;t optimize.&quot;</span>);
 
                <span class="i">Expression</span> <span id="r1100 rd" class="r1100 r">call</span>;
                <b>if</b> (<a href="#16b5cbb796280618" class="i field">_propertySetter</a>)
                {
                    <span class="r1100 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(
                        <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#b6b7d5e637a1bef8" class="i field">PSInvokeMemberBinder_InvokeAdaptedSetMember</a>,
                        <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r1076 r">target</span>, <b>typeof</b>(<b>object</b>)),
                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>),
                        <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                                <span class="r1077 r">args</span>.<span class="i">Take</span>(<span class="r1077 r">args</span>.<span class="i">Length</span> - 1).<span class="i">Select</span>(<b>static</b> <span id="r1101 rd" class="r1101 r">arg</span> =&gt; <span class="r1101 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))),
                        <span class="r1077 r">args</span>.<span class="i">Last</span>().<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)));
                }
                <b>else</b>
                {
                    <span class="r1100 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(
                        <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#609b54d8ff8dd30c" class="i field">PSInvokeMemberBinder_InvokeAdaptedMember</a>,
                        <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r1076 r">target</span>, <b>typeof</b>(<b>object</b>)),
                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>),
                        <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                                <span class="r1077 r">args</span>.<span class="i">Select</span>(<b>static</b> <span id="r1102 rd" class="r1102 r">arg</span> =&gt; <span class="r1102 r">arg</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1100 r">call</span>, <span class="r1092 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <span class="c">// If the target value is a PSObject and its base object happens to be a Hashtable or ArrayList,</span>
            <span class="c">// we might have three interesting cases here:</span>
            <span class="c">//  (1) the target value could be a regular PSObject that wraps the Hashtable/ArrayList, i.e. $target = [PSObject]::AsPSObject($hash)</span>
            <span class="c">//  (2) the target value could be a deserialized object (PSObject) with the &#39;IsDeserialized&#39; property to be false, i.e. deserialized Hashtable/ArrayList/Dictionary[string, string]</span>
            <span class="c">//  (3) the target value could be a deserialized object (PSObject) with the &#39;IsDeserialized&#39; property to be true, i.e. deserialized XmlElement</span>
            <span class="c">// For the first two cases, it&#39;s OK to call a .NET method from the base object, such as $target.Add().</span>
            <span class="c">// For the third case, calling a .NET method from the base object is incorrect, because the original type of the deserialized object doesn&#39;t have the method.</span>
            <span class="c">//  example: XmlElement derives from IEnumerable, so it&#39;s treated as a container object when powershell does the serialization -- using an ArrayList to hold</span>
            <span class="c">//  its elements -- but we cannot call Add() on it.</span>
            <span class="c">//</span>
            <span class="c">// We add restriction to do this check only if the methodInfo is a .NET method/parameterizedProperty, otherwise it&#39;s not affected by the above cases, for example, a PSScriptMethod</span>
            <span class="c">// defined in the TypeTable will only get affected by the PSTypeNames.</span>
            <b>if</b> (<span class="r1095 r">methodInfo</span> <b>is</b> <a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="t t">PSMethod</a> || <span class="r1095 r">methodInfo</span> <b>is</b> <a href="../../MshMemberInfo.cs.html#c06615b4d3a255aa" class="t t">PSParameterizedProperty</a>)
            {
                <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="k">var</a> <span id="r1103 rd" class="r1103 r">psObj</span> = <span class="r1076 r">target</span>.<span class="i">Value</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
                <b>if</b> (<span class="r1103 r">psObj</span> != <b>null</b> &amp;&amp; (<span class="r1083 r">targetValue</span>.<span class="i">GetType</span>() == <b>typeof</b>(<span class="i">Hashtable</span>) || <span class="r1083 r">targetValue</span>.<span class="i">GetType</span>() == <b>typeof</b>(<span class="i">ArrayList</span>)))
                {
                    <span class="c">// If we get here, then the target value should have &#39;isDeserialized == false&#39;, otherwise we cannot get a .NET methodInfo</span>
                    <span class="c">// from _getMemberBinder.GetPSMemberInfo(). This is because when &#39;isDeserialized&#39; is true, we use the PSObject to find the</span>
                    <span class="c">// corresponding Adapter -- PSObjectAdapter, which cannot be optimized.</span>
                    <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(!<span class="r1103 r">psObj</span>.<a href="../../MshObject.cs.html#598b509cd0dd9b32" class="i property">IsDeserialized</a>,
                        <span class="s">&quot;isDeserialized should be false, because if not, we cannot get a .NET method/parameterizedProperty from GetPSMemberInfo&quot;</span>);
 
                    <span class="r1092 r">restrictions</span> = <span class="r1092 r">restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">Not</span>(<span class="i">Expression</span>.<span class="i">Property</span>(<span class="r1076 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#37ca152e8a9e51ee" class="i field">PSObject_IsDeserialized</a>))));
                }
            }
 
            <a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="k">var</a> <span id="r1104 rd" class="r1104 r">psMethod</span> = <span class="r1095 r">methodInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="t t">PSMethod</a>;
            <b>if</b> (<span class="r1104 r">psMethod</span> != <b>null</b>)
            {
                <a href="../../CoreAdapter.cs.html#6dfefa2e34e759ac" class="k">var</a> <span id="r1105 rd" class="r1105 r">data</span> = (<a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#6dfefa2e34e759ac" class="t t">MethodCacheEntry</a>)<span class="r1104 r">psMethod</span>.<a href="../../MshMemberInfo.cs.html#90d6e570e2f5700c" class="i field">adapterData</a>;
 
                <b>return</b> <span class="i">InvokeDotNetMethod</span>(<span class="i">CallInfo</span>, <span class="i">Name</span>, <a href="#e03fcdc93e1b20b4" class="i field">_invocationConstraints</a>, <a href="#16b5cbb796280618" class="i field">_propertySetter</a> ? <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#cdfe26e93c3e7526" class="i field">Setter</a> : <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#dbd5ee8f8c01b054" class="i field">Ordinary</a>, <span class="r1076 r">target</span>, <span class="r1077 r">args</span>, <span class="r1092 r">restrictions</span>,
                    <span class="r1105 r">data</span>.<a href="../../CoreAdapter.cs.html#faf234dfe054f8ec" class="i field">methodInformationStructures</a>, <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#4961d7a0f93a8280" class="t t">MethodException</a>)).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <a href="../../MshMemberInfo.cs.html#2332c149036fdcf2" class="k">var</a> <span id="r1106 rd" class="r1106 r">scriptMethod</span> = <span class="r1095 r">methodInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#2332c149036fdcf2" class="t t">PSScriptMethod</a>;
            <b>if</b> (<span class="r1106 r">scriptMethod</span> != <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#77bcdf22030ffdf8" class="i field">PSScriptMethod_InvokeScript</a>,
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1106 r">scriptMethod</span>.<a href="../../MshMemberInfo.cs.html#675a331138fb58fc" class="i property">Script</a>),
                                    <span class="r1076 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                    <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                                            <span class="r1077 r">args</span>.<span class="i">Select</span>(<b>static</b> <span id="r1107 rd" class="r1107 r">e</span> =&gt; <span class="r1107 r">e</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))))),
                    <span class="r1092 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <a href="../../MshMemberInfo.cs.html#17ac6cd59fcbbade" class="k">var</a> <span id="r1108 rd" class="r1108 r">codeMethod</span> = <span class="r1095 r">methodInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#17ac6cd59fcbbade" class="t t">PSCodeMethod</a>;
            <b>if</b> (<span class="r1108 r">codeMethod</span> != <b>null</b>)
            {
                <span class="i">Expression</span> <span id="r1109 rd" class="r1109 r">expr</span> = <span class="i">InvokeMethod</span>(<span class="r1108 r">codeMethod</span>.<a href="../../MshMemberInfo.cs.html#f5eda6f6460d2f0e" class="i property">CodeReference</a>, <b>null</b>, <span class="r1077 r">args</span>.<span class="i">Prepend</span>(<span class="r1076 r">target</span>).<span class="i">ToArray</span>(), <b>false</b>, <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#dbd5ee8f8c01b054" class="i field">Ordinary</a>);
                <b>if</b> (<span class="r1108 r">codeMethod</span>.<a href="../../MshMemberInfo.cs.html#f5eda6f6460d2f0e" class="i property">CodeReference</a>.<span class="i">ReturnType</span> == <b>typeof</b>(<b>void</b>))
                {
                    <span class="r1109 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(<span class="r1109 r">expr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#84591f5e881dc39e" class="i field">AutomationNullConstant</a>);
                }
                <b>else</b>
                {
                    <span class="r1109 r">expr</span> = <span class="r1109 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
                }
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1109 r">expr</span>, <span class="r1092 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <a href="../../MshMemberInfo.cs.html#c06615b4d3a255aa" class="k">var</a> <span id="r1110 rd" class="r1110 r">parameterizedProperty</span> = <span class="r1095 r">methodInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#c06615b4d3a255aa" class="t t">PSParameterizedProperty</a>;
            <b>if</b> (<span class="r1110 r">parameterizedProperty</span> != <b>null</b>)
            {
                <a href="../../CoreAdapter.cs.html#f4ae97dd9b847d8b" class="k">var</a> <span id="r1111 rd" class="r1111 r">p</span> = (<a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#f4ae97dd9b847d8b" class="t t">ParameterizedPropertyCacheEntry</a>)<span class="r1110 r">parameterizedProperty</span>.<a href="../../MshMemberInfo.cs.html#3f0b10b66a386cf5" class="i field">adapterData</a>;
                <b>return</b> <span class="i">InvokeDotNetMethod</span>(<span class="i">CallInfo</span>, <span class="i">Name</span>, <a href="#e03fcdc93e1b20b4" class="i field">_invocationConstraints</a>, <a href="#16b5cbb796280618" class="i field">_propertySetter</a> ? <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#cdfe26e93c3e7526" class="i field">Setter</a> : <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#dbd5ee8f8c01b054" class="i field">Ordinary</a>, <span class="r1076 r">target</span>, <span class="r1077 r">args</span>, <span class="r1092 r">restrictions</span>,
                    <a href="#16b5cbb796280618" class="i field">_propertySetter</a> ? <span class="r1111 r">p</span>.<a href="../../CoreAdapter.cs.html#88a36133c0dc84ef" class="i field">setterInformation</a> : <span class="r1111 r">p</span>.<a href="../../CoreAdapter.cs.html#286d5059f2e36343" class="i field">getterInformation</a>,
                    <a href="#16b5cbb796280618" class="i field">_propertySetter</a> ? <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#a6e4ca1bdc5aff64" class="t t">SetValueInvocationException</a>) : <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#e0c9773749a65b3c" class="t t">GetValueInvocationException</a>)).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <b>if</b> (<span class="r1078 r">errorSuggestion</span> != <b>null</b>)
            {
                <b>return</b> <span class="r1078 r">errorSuggestion</span>.<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
            }
 
            <span class="c">// See comment on PSGetMemberBinder.PropertyDoesntExistCheckSpecialCases - the same applies here for method calls.</span>
            <b>if</b> (!<a href="#7edcfd888f3532d5" class="i field">_static</a> &amp;&amp; !<a href="#b9e3d5a317faa8a6" class="i field">_nonEnumerating</a> &amp;&amp; <span class="r1076 r">target</span>.<span class="i">Value</span> != <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
            {
                <span class="c">// Invoking Where and ForEach operators on collections.</span>
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="i">Name</span>, <span class="s">&quot;Where&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <a href="#5d7340f983651b1d" class="i method">InvokeWhereOnCollection</a>(<span class="r1076 r">target</span>, <span class="r1077 r">args</span>, <span class="r1092 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                }
 
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="i">Name</span>, <span class="s">&quot;ForEach&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <a href="#a61540d098265df8" class="i method">InvokeForEachOnCollection</a>(<span class="r1076 r">target</span>, <span class="r1077 r">args</span>, <span class="r1092 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                }
 
                <b>var</b> <span id="r1112 rd" class="r1112 r">enumerableTarget</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r1076 r">target</span>);
                <b>if</b> (<span class="r1112 r">enumerableTarget</span> != <b>null</b>)
                {
                    <span class="c">// Try calling the method on each member of the collection.</span>
                    <b>return</b> <span class="i">InvokeMemberOnCollection</span>(<span class="r1112 r">enumerableTarget</span>, <span class="r1077 r">args</span>, <span class="r1083 r">targetValue</span>.<span class="i">GetType</span>(), <span class="r1092 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
                }
            }
 
            <b>var</b> <span id="r1113 rd" class="r1113 r">typeForMessage</span> = <a href="#7edcfd888f3532d5" class="i field">_static</a> &amp;&amp; <span class="r1083 r">targetValue</span> <b>is</b> <span class="i">Type</span> ? (<span class="i">Type</span>)<span class="r1083 r">targetValue</span> : <span class="r1083 r">targetValue</span>.<span class="i">GetType</span>();
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">ThrowRuntimeError</span>(<a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#f809211b8b82f3f2" class="i field">MethodNotFoundErrorId</a>, <span class="i">ParserStrings</span>.<span class="i">MethodNotFound</span>,
                                           <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1113 r">typeForMessage</span>.<span class="i">FullName</span>), <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">Name</span>)),
                <span class="r1092 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#0e3dce2a001305f0" class="k">this</a>);
        }
 
        <b>internal static</b> <span class="i">DynamicMetaObject</span> <a id="b8eb04d24780f6ec" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokeDotNetMethod</a>(
            <span class="i">CallInfo</span> <span id="r1114 rd" class="r1114 r">callInfo</span>,
            <b>string</b> <span id="r1115 rd" class="r1115 r">name</span>,
            <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1116 rd" class="r1116 r">psMethodInvocationConstraints</span>,
            <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a> <span id="r1117 rd" class="r1117 r">methodInvocationType</span>,
            <span class="i">DynamicMetaObject</span> <span id="r1118 rd" class="r1118 r">target</span>,
            <span class="i">DynamicMetaObject</span>[] <span id="r1119 rd" class="r1119 r">args</span>,
            <span class="i">BindingRestrictions</span> <span id="r1120 rd" class="r1120 r">restrictions</span>,
            <a href="../../CoreAdapter.cs.html#8ae0c30e474b7c1e" class="t t">MethodInformation</a>[] <span id="r1121 rd" class="r1121 r">mi</span>,
            <span class="i">Type</span> <span id="r1122 rd" class="r1122 r">errorExceptionType</span>)
        {
            <b>bool</b> <span id="r1123 rd" class="r1123 r">expandParamsOnBest</span>;
            <b>bool</b> <span id="r1124 rd" class="r1124 r">callNonVirtually</span>;
            <b>string</b> <span id="r1125 rd" class="r1125 r">errorId</span> = <b>null</b>;
            <b>string</b> <span id="r1126 rd" class="r1126 r">errorMsg</span> = <b>null</b>;
            <b>int</b> <span id="r1127 rd" class="r1127 r">numArgs</span> = <span class="r1119 r">args</span>.<span class="i">Length</span>;
            <b>if</b> (<span class="r1117 r">methodInvocationType</span> == <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#cdfe26e93c3e7526" class="i field">Setter</a>)
            {
                <span class="r1127 r">numArgs</span> -= 1;
            }
 
            <b>object</b>[] <span id="r1128 rd" class="r1128 r">argValues</span> = <b>new</b> <b>object</b>[<span class="r1127 r">numArgs</span>];
            <b>for</b> (<b>int</b> <span id="r1129 rd" class="r1129 r">i</span> = 0; <span class="r1129 r">i</span> &lt; <span class="r1127 r">numArgs</span>; ++<span class="r1129 r">i</span>)
            {
                <b>object</b> <span id="r1130 rd" class="r1130 r">arg</span> = <span class="r1119 r">args</span>[<span class="r1129 r">i</span>].<span class="i">Value</span>;
                <span class="r1128 r">argValues</span>[<span class="r1129 r">i</span>] = <span class="r1130 r">arg</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a> ? <b>null</b> : <span class="r1130 r">arg</span>;
            }
 
            <a href="../../CoreAdapter.cs.html#8ae0c30e474b7c1e" class="k">var</a> <span id="r1131 rd" class="r1131 r">result</span> = <a href="../../CoreAdapter.cs.html#88aa0312e9fc25c7" class="t t">Adapter</a>.<a href="../../CoreAdapter.cs.html#938ac4d3d430f987" class="i method">FindBestMethod</a>(
                <span class="r1121 r">mi</span>,
                <span class="r1116 r">psMethodInvocationConstraints</span>,
                <span class="r1132 r">allowCastingToByRefLikeType</span>: <b>true</b>,
                <span class="r1128 r">argValues</span>,
                <b>ref</b> <span class="r1125 r">errorId</span>,
                <b>ref</b> <span class="r1126 r">errorMsg</span>,
                <b>out</b> <span class="r1123 r">expandParamsOnBest</span>,
                <b>out</b> <span class="r1124 r">callNonVirtually</span>);
 
            <b>if</b> (<span class="r1124 r">callNonVirtually</span> &amp;&amp; <span class="r1117 r">methodInvocationType</span> != <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#24150beef32edfa9" class="i field">BaseCtor</a>)
            {
                <span class="r1117 r">methodInvocationType</span> = <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#e186aaea1ddc6b7d" class="i field">NonVirtual</a>;
            }
 
            <b>if</b> (<span class="r1131 r">result</span> != <b>null</b>)
            {
                <b>var</b> <span id="r1133 rd" class="r1133 r">methodInfo</span> = <span class="r1131 r">result</span>.<a href="../../CoreAdapter.cs.html#3a0e575988f5a5de" class="i field">method</a>;
                <b>var</b> <span id="r1134 rd" class="r1134 r">expr</span> = <a href="#dc958efbc55d17ff" class="i method">InvokeMethod</a>(<span class="r1133 r">methodInfo</span>, <span class="r1118 r">target</span>, <span class="r1119 r">args</span>, <span class="r1123 r">expandParamsOnBest</span>, <span class="r1117 r">methodInvocationType</span>);
                <b>if</b> (<span class="r1134 r">expr</span>.<span class="i">Type</span> == <b>typeof</b>(<b>void</b>))
                {
                    <span class="r1134 r">expr</span> = <span class="i">Expression</span>.<span class="i">Block</span>(<span class="r1134 r">expr</span>, <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#84591f5e881dc39e" class="i field">AutomationNullConstant</a>);
                }
 
                <span class="c">// If we&#39;re calling SteppablePipeline.{Begin|Process|End}, we don&#39;t want</span>
                <span class="c">// to wrap exceptions - this is very much a special case to help error</span>
                <span class="c">// propagation and ensure errors are attributed to the correct code (the</span>
                <span class="c">// cmdlet invoked, not the method call from some proxy.)</span>
                <b>if</b> (<span class="r1133 r">methodInfo</span>.<span class="i">DeclaringType</span> == <b>typeof</b>(<a href="../../lang/scriptblock.cs.html#5e20a8a88cfbe6cb" class="t t">SteppablePipeline</a>)
                    &amp;&amp; (<span class="r1133 r">methodInfo</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;Begin&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                        || <span class="r1133 r">methodInfo</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;Process&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>)
                        || <span class="r1133 r">methodInfo</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;End&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1134 r">expr</span>, <span class="r1120 r">restrictions</span>);
                }
 
                <span class="r1134 r">expr</span> = <span class="r1134 r">expr</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>));
 
                <span class="c">// Likewise, when calling methods in types defined by PowerShell, we don&#39;t</span>
                <span class="c">// want to wrap the exception.</span>
                <b>if</b> (<span class="r1133 r">methodInfo</span>.<span class="i">DeclaringType</span>.<span class="i">Assembly</span>.<span class="i">GetCustomAttributes</span>(<b>typeof</b>(<a href="../../Attributes.cs.html#fab2ad862be5707e" class="t t">DynamicClassImplementationAssemblyAttribute</a>)).<span class="i">Any</span>())
                {
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1134 r">expr</span>, <span class="r1120 r">restrictions</span>);
                }
 
                <b>var</b> <span id="r1135 rd" class="r1135 r">e</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<b>typeof</b>(<span class="i">Exception</span>));
                <span class="r1134 r">expr</span> = <span class="i">Expression</span>.<span class="i">TryCatch</span>(<span class="r1134 r">expr</span>,
                    <span class="i">Expression</span>.<span class="i">Catch</span>(<span class="r1135 r">e</span>,
                        <span class="i">Expression</span>.<span class="i">Block</span>(
                            <span class="r1134 r">expr</span>.<span class="i">Type</span>,
                            <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#333c817a08775c10" class="i field">ExceptionHandlingOps_ConvertToMethodInvocationException</a>,
                                            <span class="r1135 r">e</span>,
                                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1122 r">errorExceptionType</span>, <b>typeof</b>(<span class="i">Type</span>)),
                                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1133 r">methodInfo</span>.<span class="i">Name</span>),
                                            <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<span class="r1119 r">args</span>.<span class="i">Length</span>),
                                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1133 r">methodInfo</span>, <b>typeof</b>(<span class="i">MethodBase</span>))),
                            <span class="i">Expression</span>.<span class="i">Rethrow</span>(<span class="r1134 r">expr</span>.<span class="i">Type</span>))));
 
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="r1134 r">expr</span>, <span class="r1120 r">restrictions</span>);
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">CreateThrow</span>(<b>typeof</b>(<b>object</b>), <span class="r1122 r">errorExceptionType</span>,
                                     <b>new</b>[] { <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Exception</span>), <b>typeof</b>(<b>string</b>), <b>typeof</b>(<b>object</b>[]) },
                                     <span class="r1125 r">errorId</span>, <b>null</b>, <span class="r1126 r">errorMsg</span>, <b>new</b> <b>object</b>[] { <span class="r1115 r">name</span>, <span class="r1114 r">callInfo</span>.<span class="i">ArgumentCount</span> }),
                <span class="r1120 r">restrictions</span>);
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="6adb0b781c7685c3" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackInvoke</a>(<span class="i">DynamicMetaObject</span> <span id="r1136 rd" class="r1136 r">target</span>,
                                                         <span class="i">DynamicMetaObject</span>[] <span id="r1137 rd" class="r1137 r">args</span>,
                                                         <span class="i">DynamicMetaObject</span> <span id="r1138 rd" class="r1138 r">errorSuggestion</span>)
        {
            <b>return</b> (<span class="r1138 r">errorSuggestion</span> ?? <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(
                    <b>new</b> <span class="t">PSInvokeBinder</span>(<span class="i">CallInfo</span>),
                    <b>typeof</b>(<b>object</b>),
                    <span class="r1137 r">args</span>.<span class="i">Prepend</span>(<span class="r1136 r">target</span>).<span class="i">Select</span>(<b>static</b> <span id="r1139 rd" class="r1139 r">dmo</span> =&gt; <span class="r1139 r">dmo</span>.<span class="i">Expression</span>)
                ),
                <span class="r1136 r">target</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">Combine</span>(<span class="r1137 r">args</span>))
            ));
        }
 
        <b>internal static</b> <span class="i">MethodInfo</span> <a id="e1ec58c2ab999815" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">FindBestMethod</a>(<span class="i">DynamicMetaObject</span> <span id="r1140 rd" class="r1140 r">target</span>,
                                                  <span class="i">IEnumerable</span>&lt;<span class="i">DynamicMetaObject</span>&gt; <span id="r1141 rd" class="r1141 r">args</span>,
                                                  <b>string</b> <span id="r1142 rd" class="r1142 r">methodName</span>,
                                                  <b>bool</b> <span id="r1143 rd" class="r1143 r">@static</span>,
                                                  <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1144 rd" class="r1144 r">invocationConstraints</span>)
        {
            <span class="i">MethodInfo</span> <span id="r1145 rd" class="r1145 r">result</span> = <b>null</b>;
 
            <a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="k">var</a> <span id="r1146 rd" class="r1146 r">psMethod</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#20218854b572ba17" class="i property">DotNetInstanceAdapter</a>.<a href="../../CoreAdapter.cs.html#37b1315c558998d3" class="i method">GetDotNetMethod</a>&lt;<a href="../../MshMemberInfo.cs.html#678ebc1a7c5bc189" class="t t">PSMethod</a>&gt;(<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1140 r">target</span>.<span class="i">Value</span>), <span class="r1142 r">methodName</span>);
            <b>if</b> (<span class="r1146 r">psMethod</span> != <b>null</b>)
            {
                <a href="../../CoreAdapter.cs.html#6dfefa2e34e759ac" class="k">var</a> <span id="r1147 rd" class="r1147 r">data</span> = (<a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#6dfefa2e34e759ac" class="t t">MethodCacheEntry</a>)<span class="r1146 r">psMethod</span>.<a href="../../MshMemberInfo.cs.html#90d6e570e2f5700c" class="i field">adapterData</a>;
 
                <b>string</b> <span id="r1148 rd" class="r1148 r">errorId</span> = <b>null</b>;
                <b>string</b> <span id="r1149 rd" class="r1149 r">errorMsg</span> = <b>null</b>;
                <b>bool</b> <span id="r1150 rd" class="r1150 r">expandParameters</span>;
                <b>bool</b> <span id="r1151 rd" class="r1151 r">callNonVirtually</span>;
 
                <a href="../../CoreAdapter.cs.html#8ae0c30e474b7c1e" class="k">var</a> <span id="r1152 rd" class="r1152 r">mi</span> = <a href="../../CoreAdapter.cs.html#88aa0312e9fc25c7" class="t t">Adapter</a>.<span class="i">FindBestMethod</span>(
                    <span class="r1147 r">data</span>.<a href="../../CoreAdapter.cs.html#faf234dfe054f8ec" class="i field">methodInformationStructures</a>,
                    <span class="r1144 r">invocationConstraints</span>,
                    <span class="i">allowCastingToByRefLikeType</span>: <b>true</b>,
                    <span class="r1141 r">args</span>.<span class="i">Select</span>(<b>static</b> <span id="r1153 rd" class="r1153 r">arg</span> =&gt; <span class="r1153 r">arg</span>.<span class="i">Value</span> == <a href="../../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a> ? <b>null</b> : <span class="r1153 r">arg</span>.<span class="i">Value</span>).<span class="i">ToArray</span>(),
                    <b>ref</b> <span class="r1148 r">errorId</span>,
                    <b>ref</b> <span class="r1149 r">errorMsg</span>,
                    <b>out</b> <span class="r1150 r">expandParameters</span>,
                    <b>out</b> <span class="r1151 r">callNonVirtually</span>);
 
                <b>if</b> (<span class="r1152 r">mi</span> != <b>null</b>)
                {
                    <span class="r1145 r">result</span> = (<span class="i">MethodInfo</span>)<span class="r1152 r">mi</span>.<a href="../../CoreAdapter.cs.html#3a0e575988f5a5de" class="i field">method</a>;
                }
            }
 
            <b>return</b> <span class="r1145 r">result</span>;
        }
 
        <b>internal static</b> <span class="i">Expression</span> <a id="dc958efbc55d17ff" href="../../../R/dc958efbc55d17ff.html" target="n" data-glyph="74,1" class="i method">InvokeMethod</a>(<span class="i">MethodBase</span> <span id="r1154 rd" class="r1154 r">mi</span>, <span class="i">DynamicMetaObject</span> <span id="r1155 rd" class="r1155 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1156 rd" class="r1156 r">args</span>, <b>bool</b> <span id="r1157 rd" class="r1157 r">expandParameters</span>, <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a> <span id="r1158 rd" class="r1158 r">invocationType</span>)
        {
            <span class="i">List</span>&lt;<span class="i">ParameterExpression</span>&gt; <span id="r1159 rd" class="r1159 r">temps</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">ParameterExpression</span>&gt;();
            <span class="i">List</span>&lt;<span class="i">Expression</span>&gt; <span id="r1160 rd" class="r1160 r">initTemps</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">Expression</span>&gt;();
            <span class="i">List</span>&lt;<span class="i">Expression</span>&gt; <span id="r1161 rd" class="r1161 r">copyOutTemps</span> = <b>new</b> <span class="i">List</span>&lt;<span class="i">Expression</span>&gt;();
 
            <span class="i">ConstructorInfo</span> <span id="r1162 rd" class="r1162 r">constructorInfo</span> = <b>null</b>;
            <span class="i">MethodInfo</span> <span id="r1163 rd" class="r1163 r">methodInfo</span> = <span class="r1154 r">mi</span> <b>as</b> <span class="i">MethodInfo</span>;
            <b>if</b> (<span class="r1163 r">methodInfo</span> != <b>null</b>)
            {
                <span class="i">Type</span> <span id="r1164 rd" class="r1164 r">returnType</span> = <span class="r1163 r">methodInfo</span>.<span class="i">ReturnType</span>;
                <b>if</b> (<span class="r1164 r">returnType</span>.<span class="i">IsByRefLike</span>)
                {
                    <span class="i">ConstructorInfo</span> <span id="r1165 rd" class="r1165 r">exceptionCtorInfo</span>;
                    <b>switch</b> (<span class="r1158 r">invocationType</span>)
                    {
                        <b>case</b> <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#f73ea19c23857d11" class="i field">Getter</a>:
                            <span class="r1165 r">exceptionCtorInfo</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#f8342ce08ab7434c" class="i field">GetValueException_ctor</a>;
                            <b>break</b>;
                        <b>case</b> <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#cdfe26e93c3e7526" class="i field">Setter</a>:
                            <span class="r1165 r">exceptionCtorInfo</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#4287f2a124c4e87d" class="i field">SetValueException_ctor</a>;
                            <b>break</b>;
                        <b>default</b>:
                            <span class="r1165 r">exceptionCtorInfo</span> = <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#1c44fd79df4afcc1" class="i field">MethodException_ctor</a>;
                            <b>break</b>;
                    }
 
                    <b>return</b> <span class="i">Expression</span>.<span class="i">Throw</span>(
                        <span class="i">Expression</span>.<span class="i">New</span>(
                            <span class="r1165 r">exceptionCtorInfo</span>,
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<b>nameof</b>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotCallMethodWithByRefLikeReturnType</span>)),
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotCallMethodWithByRefLikeReturnType</span>),
                            <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(
                                <b>typeof</b>(<b>object</b>),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1163 r">methodInfo</span>.<span class="i">Name</span>),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1164 r">returnType</span>, <b>typeof</b>(<span class="i">Type</span>)))),
                        <b>typeof</b>(<b>object</b>));
                }
            }
            <b>else</b>
            {
                <span class="r1162 r">constructorInfo</span> = (<span class="i">ConstructorInfo</span>)<span class="r1154 r">mi</span>;
                <span class="i">Type</span> <span id="r1166 rd" class="r1166 r">declaringType</span> = <span class="r1162 r">constructorInfo</span>.<span class="i">DeclaringType</span>;
                <b>if</b> (<span class="r1166 r">declaringType</span>.<span class="i">IsByRefLike</span>)
                {
                    <b>return</b> <span class="i">Expression</span>.<span class="i">Throw</span>(
                        <span class="i">Expression</span>.<span class="i">New</span>(
                            <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#1c44fd79df4afcc1" class="i field">MethodException_ctor</a>,
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<b>nameof</b>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotInstantiateBoxedByRefLikeType</span>)),
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotInstantiateBoxedByRefLikeType</span>),
                            <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(
                                <b>typeof</b>(<b>object</b>),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1166 r">declaringType</span>, <b>typeof</b>(<span class="i">Type</span>)))),
                        <b>typeof</b>(<b>object</b>));
                }
            }
 
            <span class="c">// Invoking a base constructor or a base method (non-virtual call) depends reflection invocation</span>
            <span class="c">// via helper methods, and thus all arguments need to be casted to &#39;object&#39;. The ByRef-like types</span>
            <span class="c">// cannot be boxed and won&#39;t work with reflection.</span>
            <b>bool</b> <span id="r1167 rd" class="r1167 r">allowCastingToByRefLikeType</span> =
                <span class="r1158 r">invocationType</span> != <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#24150beef32edfa9" class="i field">BaseCtor</a> &amp;&amp;
                <span class="r1158 r">invocationType</span> != <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#e186aaea1ddc6b7d" class="i field">NonVirtual</a>;
            <b>var</b> <span id="r1168 rd" class="r1168 r">parameters</span> = <span class="r1154 r">mi</span>.<span class="i">GetParameters</span>();
            <b>var</b> <span id="r1169 rd" class="r1169 r">argExprs</span> = <b>new</b> <span class="i">Expression</span>[<span class="r1168 r">parameters</span>.<span class="i">Length</span>];
 
            <b>for</b> (<b>int</b> <span id="r1170 rd" class="r1170 r">i</span> = 0; <span class="r1170 r">i</span> &lt; <span class="r1168 r">parameters</span>.<span class="i">Length</span>; ++<span class="r1170 r">i</span>)
            {
                <span class="i">Type</span> <span id="r1171 rd" class="r1171 r">parameterType</span> = <span class="r1168 r">parameters</span>[<span class="r1170 r">i</span>].<span class="i">ParameterType</span>;
                <b>string</b> <span id="r1172 rd" class="r1172 r">paramName</span> = <span class="r1168 r">parameters</span>[<span class="r1170 r">i</span>].<span class="i">Name</span>;
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r1172 r">paramName</span>))
                {
                    <span class="r1172 r">paramName</span> = <span class="r1170 r">i</span>.<span class="i">ToString</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                }
 
                <span class="c">// The extension method &#39;CustomAttributeExtensions.GetCustomAttributes(ParameterInfo, Type, Boolean)&#39; has inconsistent</span>
                <span class="c">// behavior on its return value in both FullCLR and CoreCLR. According to MSDN, if the attribute cannot be found, it</span>
                <span class="c">// should return an empty collection. However, it returns null in some rare cases [when the parameter isn&#39;t backed by</span>
                <span class="c">// actual metadata].</span>
                <span class="c">// This inconsistent behavior affects OneCore powershell because we are using the extension method here when compiling</span>
                <span class="c">// against CoreCLR. So we need to add a null check until this is fixed in CLR.</span>
                <b>var</b> <span id="r1173 rd" class="r1173 r">paramArrayAttrs</span> = <span class="r1168 r">parameters</span>[<span class="r1170 r">i</span>].<span class="i">GetCustomAttributes</span>(<b>typeof</b>(<span class="i">ParamArrayAttribute</span>), <b>false</b>);
                <b>if</b> (<span class="r1173 r">paramArrayAttrs</span> != <b>null</b> &amp;&amp; <span class="r1173 r">paramArrayAttrs</span>.<span class="i">Length</span> &gt; 0)
                {
                    <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r1170 r">i</span> == <span class="r1168 r">parameters</span>.<span class="i">Length</span> - 1, <span class="s">&quot;vararg parameter is not the last&quot;</span>);
                    <b>var</b> <span id="r1174 rd" class="r1174 r">paramElementType</span> = <span class="r1171 r">parameterType</span>.<span class="i">GetElementType</span>();
 
                    <b>if</b> (<span class="r1157 r">expandParameters</span>)
                    {
                        <span class="r1169 r">argExprs</span>[<span class="r1170 r">i</span>] = <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(
                            <span class="r1174 r">paramElementType</span>,
                            <span class="r1156 r">args</span>.<span class="i">Skip</span>(<span class="r1170 r">i</span>).<span class="i">Select</span>(
                                <span id="r1175 rd" class="r1175 r">a</span> =&gt; <span class="r1175 r">a</span>.<span class="i">CastOrConvertMethodArgument</span>(
                                    <span class="r1174 r">paramElementType</span>,
                                    <span class="r1172 r">paramName</span>,
                                    <span class="r1154 r">mi</span>.<span class="i">Name</span>,
                                    <span class="i">allowCastingToByRefLikeType</span>: <b>false</b>,
                                    <span class="r1159 r">temps</span>,
                                    <span class="r1160 r">initTemps</span>)));
                    }
                    <b>else</b>
                    {
                        <b>var</b> <span id="r1176 rd" class="r1176 r">arg</span> = <span class="r1156 r">args</span>[<span class="r1170 r">i</span>].<span class="i">CastOrConvertMethodArgument</span>(
                            <span class="r1171 r">parameterType</span>,
                            <span class="r1172 r">paramName</span>,
                            <span class="r1154 r">mi</span>.<span class="i">Name</span>,
                            <span class="i">allowCastingToByRefLikeType</span>: <b>false</b>,
                            <span class="r1159 r">temps</span>,
                            <span class="r1160 r">initTemps</span>);
                        <span class="r1169 r">argExprs</span>[<span class="r1170 r">i</span>] = <span class="r1176 r">arg</span>;
                    }
                }
                <b>else</b> <b>if</b> (<span class="r1170 r">i</span> &gt;= <span class="r1156 r">args</span>.<span class="i">Length</span>)
                {
                    <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<span class="i">Assert</span>(<span class="r1168 r">parameters</span>[<span class="r1170 r">i</span>].<span class="i">IsOptional</span>,
                        <span class="s">&quot;if there are too few arguments, FindBestMethod should only succeed if parameters are optional&quot;</span>);
                    <b>var</b> <span id="r1177 rd" class="r1177 r">argValue</span> = <span class="r1168 r">parameters</span>[<span class="r1170 r">i</span>].<span class="i">DefaultValue</span>;
                    <b>if</b> (<span class="r1177 r">argValue</span> == <b>null</b>)
                    {
                        <span class="r1169 r">argExprs</span>[<span class="r1170 r">i</span>] = <span class="i">Expression</span>.<span class="i">Default</span>(<span class="r1171 r">parameterType</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// We don&#39;t specify the parameter type in the constant expression. Normally the default</span>
                        <span class="c">// argument&#39;s type should match the parameter type, but sometimes it won&#39;t, e.g. with COM,</span>
                        <span class="c">// the default can be System.Reflection.Missing.Value and this value is handled specially.</span>
                        <span class="r1169 r">argExprs</span>[<span class="r1170 r">i</span>] = <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1177 r">argValue</span>);
                    }
                }
                <b>else</b>
                {
                    <b>if</b> (<span class="r1171 r">parameterType</span>.<span class="i">IsByRef</span>)
                    {
                        <b>if</b> (<span class="r1156 r">args</span>[<span class="r1170 r">i</span>].<span class="i">Value</span> <b>is not</b> <a href="../../MshReference.cs.html#7363a2660b89f253" class="t t">PSReference</a>)
                        {
                            <b>return</b> <a href="../../parser/Compiler.cs.html#8bdfc042f41c96c5" class="t t">Compiler</a>.<span class="i">CreateThrow</span>(<b>typeof</b>(<b>object</b>), <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#4961d7a0f93a8280" class="t t">MethodException</a>),
                                     <b>new</b>[] { <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Exception</span>), <b>typeof</b>(<b>string</b>), <b>typeof</b>(<b>object</b>[]) },
                                     <span class="s">&quot;NonRefArgumentToRefParameterMsg&quot;</span>, <b>null</b>, <span class="i">ExtendedTypeSystem</span>.<span class="i">NonRefArgumentToRefParameter</span>,
                                     <b>new</b> <b>object</b>[] { <span class="r1170 r">i</span> + 1, <b>typeof</b>(<a href="../../MshReference.cs.html#7363a2660b89f253" class="t t">PSReference</a>).<span class="i">FullName</span>, <span class="s">&quot;[ref]&quot;</span> });
                        }
 
                        <b>var</b> <span id="r1178 rd" class="r1178 r">temp</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r1171 r">parameterType</span>.<span class="i">GetElementType</span>());
                        <span class="r1159 r">temps</span>.<span class="i">Add</span>(<span class="r1178 r">temp</span>);
                        <b>var</b> <span id="r1179 rd" class="r1179 r">psRefValue</span> = <span class="i">Expression</span>.<span class="i">Property</span>(<span class="r1156 r">args</span>[<span class="r1170 r">i</span>].<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<a href="../../MshReference.cs.html#7363a2660b89f253" class="t t">PSReference</a>)), <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#ae2d8aa8c127cd82" class="i field">PSReference_Value</a>);
                        <span class="r1160 r">initTemps</span>.<span class="i">Add</span>(<span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1178 r">temp</span>, <span class="r1179 r">psRefValue</span>.<span class="i">Convert</span>(<span class="r1178 r">temp</span>.<span class="i">Type</span>)));
                        <span class="r1161 r">copyOutTemps</span>.<span class="i">Add</span>(<span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1179 r">psRefValue</span>, <span class="r1178 r">temp</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))));
                        <span class="r1169 r">argExprs</span>[<span class="r1170 r">i</span>] = <span class="r1178 r">temp</span>;
                    }
                    <b>else</b>
                    {
                        <span class="r1169 r">argExprs</span>[<span class="r1170 r">i</span>] = <span class="r1156 r">args</span>[<span class="r1170 r">i</span>].<span class="i">CastOrConvertMethodArgument</span>(
                            <span class="r1171 r">parameterType</span>,
                            <span class="r1172 r">paramName</span>,
                            <span class="r1154 r">mi</span>.<span class="i">Name</span>,
                            <span class="r1167 r">allowCastingToByRefLikeType</span>,
                            <span class="r1159 r">temps</span>,
                            <span class="r1160 r">initTemps</span>);
                    }
                }
            }
 
            <span class="i">Expression</span> <span id="r1180 rd" class="r1180 r">call</span>;
            <b>if</b> (<span class="r1162 r">constructorInfo</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r1158 r">invocationType</span> == <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#24150beef32edfa9" class="i field">BaseCtor</a>)
                {
                    <b>var</b> <span id="r1181 rd" class="r1181 r">targetExpr</span> = <span class="r1155 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>
                        ? <span class="r1155 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<span class="r1162 r">constructorInfo</span>.<span class="i">DeclaringType</span>)
                        : <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r1155 r">target</span>, <span class="r1162 r">constructorInfo</span>.<span class="i">DeclaringType</span>);
                    <span class="r1180 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(
                        <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#d4b9811c565166fd" class="i field">ClassOps_CallBaseCtor</a>,
                        <span class="r1181 r">targetExpr</span>,
                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1162 r">constructorInfo</span>, <b>typeof</b>(<span class="i">ConstructorInfo</span>)),
                        <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="r1169 r">argExprs</span>.<span class="i">Select</span>(<b>static</b> <span id="r1182 rd" class="r1182 r">x</span> =&gt; <span class="r1182 r">x</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))));
                }
                <b>else</b>
                {
                    <span class="r1180 r">call</span> = <span class="i">Expression</span>.<span class="i">New</span>(<span class="r1162 r">constructorInfo</span>, <span class="r1169 r">argExprs</span>);
                }
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r1158 r">invocationType</span> == <a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#e186aaea1ddc6b7d" class="i field">NonVirtual</a> &amp;&amp; !<span class="r1163 r">methodInfo</span>.<span class="i">IsStatic</span>)
                {
                    <span class="r1180 r">call</span> = <span class="i">Expression</span>.<span class="i">Call</span>(
                        <span class="r1163 r">methodInfo</span>.<span class="i">ReturnType</span> == <b>typeof</b>(<b>void</b>)
                            ? <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#e1bb6c820b85ac75" class="i field">ClassOps_CallVoidMethodNonVirtually</a>
                            : <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#a01cf4e6c7e573fc" class="i field">ClassOps_CallMethodNonVirtually</a>,
                        <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r1155 r">target</span>, <span class="r1163 r">methodInfo</span>.<span class="i">DeclaringType</span>),
                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1163 r">methodInfo</span>, <b>typeof</b>(<span class="i">MethodInfo</span>)),
                        <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="r1169 r">argExprs</span>.<span class="i">Select</span>(<b>static</b> <span id="r1183 rd" class="r1183 r">x</span> =&gt; <span class="r1183 r">x</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))));
                }
                <b>else</b>
                {
                    <span class="r1180 r">call</span> = <span class="r1163 r">methodInfo</span>.<span class="i">IsStatic</span>
                           ? <span class="i">Expression</span>.<span class="i">Call</span>(<span class="r1163 r">methodInfo</span>, <span class="r1169 r">argExprs</span>)
                           : <span class="i">Expression</span>.<span class="i">Call</span>(
                               <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r1155 r">target</span>, <span class="r1163 r">methodInfo</span>.<span class="i">DeclaringType</span>),
                               <span class="r1163 r">methodInfo</span>, <span class="r1169 r">argExprs</span>);
                }
            }
 
            <b>if</b> (<span class="r1159 r">temps</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>if</b> (<span class="r1180 r">call</span>.<span class="i">Type</span> != <b>typeof</b>(<b>void</b>) &amp;&amp; <span class="r1161 r">copyOutTemps</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>var</b> <span id="r1184 rd" class="r1184 r">retValue</span> = <span class="i">Expression</span>.<span class="i">Variable</span>(<span class="r1180 r">call</span>.<span class="i">Type</span>);
                    <span class="r1159 r">temps</span>.<span class="i">Add</span>(<span class="r1184 r">retValue</span>);
                    <span class="r1180 r">call</span> = <span class="i">Expression</span>.<span class="i">Assign</span>(<span class="r1184 r">retValue</span>, <span class="r1180 r">call</span>);
                    <span class="r1161 r">copyOutTemps</span>.<span class="i">Add</span>(<span class="r1184 r">retValue</span>);
                }
 
                <span class="r1180 r">call</span> = <span class="i">Expression</span>.<span class="i">Block</span>(<span class="r1180 r">call</span>.<span class="i">Type</span>, <span class="r1159 r">temps</span>, <span class="r1160 r">initTemps</span>.<span class="i">Append</span>(<span class="r1180 r">call</span>).<span class="i">Concat</span>(<span class="r1161 r">copyOutTemps</span>));
            }
 
            <b>return</b> <span class="r1180 r">call</span>;
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="d98d836790f191a7" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">InvokeMemberOnCollection</a>(<span class="i">DynamicMetaObject</span> <span id="r1185 rd" class="r1185 r">targetEnumerator</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1186 rd" class="r1186 r">args</span>, <span class="i">Type</span> <span id="r1187 rd" class="r1187 r">typeForMessage</span>, <span class="i">BindingRestrictions</span> <span id="r1188 rd" class="r1188 r">restrictions</span>)
        {
            <b>var</b> <span id="r1189 rd" class="r1189 r">d</span> = <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(<a href="#0e3dce2a001305f0" class="k">this</a>, <a href="#0e3dce2a001305f0" class="k">this</a>.<span class="i">ReturnType</span>, <span class="r1186 r">args</span>.<span class="i">Select</span>(<b>static</b> <span id="r1190 rd" class="r1190 r">a</span> =&gt; <span class="r1190 r">a</span>.<span class="i">Expression</span>).<span class="i">Prepend</span>(<a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<a href="../../parser/Compiler.cs.html#03f60a93eeec7a4b" class="i field">NullConstant</a>));
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#c1fd7d22222b7601" class="i field">EnumerableOps_MethodInvoker</a>,
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="#0e3dce2a001305f0" class="k">this</a>.<a href="#c5c5a7cdd1119258" class="i method">GetNonEnumeratingBinder</a>()),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1189 r">d</span>.<span class="i">DelegateType</span>, <b>typeof</b>(<span class="i">Type</span>)),
                                <span class="r1185 r">targetEnumerator</span>.<span class="i">Expression</span>,
                                <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                                        <span class="r1186 r">args</span>.<span class="i">Select</span>(<b>static</b> <span id="r1191 rd" class="r1191 r">a</span> =&gt; <span class="r1191 r">a</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="r1187 r">typeForMessage</span>, <b>typeof</b>(<span class="i">Type</span>))
                                ),
                <span class="r1185 r">targetEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r1188 r">restrictions</span>));
        }
 
        <b>private static</b> <span class="i">DynamicMetaObject</span> <a id="5b104169d00fc8fb" href="../../../R/5b104169d00fc8fb.html" target="n" data-glyph="76,1" class="i method">GetTargetAsEnumerable</a>(<span class="i">DynamicMetaObject</span> <span id="r1192 rd" class="r1192 r">target</span>)
        {
            <b>var</b> <span id="r1193 rd" class="r1193 r">enumerableTarget</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r1192 r">target</span>);
            <b>if</b> (<span class="r1193 r">enumerableTarget</span> == <b>null</b>)
            {
                <span class="c">// Wrap the target in an array.</span>
                <span class="r1193 r">enumerableTarget</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(
                    <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>), <span class="r1192 r">target</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))),
                        <span class="r1192 r">target</span>.<a href="#c9dfd3fc236ea8a5" class="i method">GetSimpleTypeRestriction</a>()));
            }
 
            <b>return</b> <span class="r1193 r">enumerableTarget</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1194 r">target</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The target to operate against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1195 r">args</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">     Arguments to the operator. The first argument must be either a scriptblock</span>
        <span class="c">///</span><span class="c">     or a string representing a &#39;simple where&#39; expression. The second is an enum that controls</span>
        <span class="c">///</span><span class="c">     the matching behaviour returning the first, last or all matching elements.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1196 r">argRestrictions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The binding restrictions for the arguments.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="5d7340f983651b1d" href="../../../R/5d7340f983651b1d.html" target="n" data-glyph="76,1" class="i method">InvokeWhereOnCollection</a>(<span class="i">DynamicMetaObject</span> <span id="r1194 rd" class="r1194 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1195 rd" class="r1195 r">args</span>, <span class="i">BindingRestrictions</span> <span id="r1196 rd" class="r1196 r">argRestrictions</span>)
        {
            <b>var</b> <span id="r1197 rd" class="r1197 r">lhsEnumerator</span> = <a href="#5b104169d00fc8fb" class="i method">GetTargetAsEnumerable</a>(<span class="r1194 r">target</span>);
 
            <b>switch</b> (<span class="r1195 r">args</span>.<span class="i">Length</span>)
            {
                <b>case</b> 1:
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#b001fffaf39caaad" class="i field">EnumerableOps_Where</a>,
                                <span class="r1197 r">lhsEnumerator</span>.<span class="i">Expression</span>,
                                <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b2d235f5ef39b2c2" class="i method">GetTargetExpr</a>(<span class="r1195 r">args</span>[0]).<span class="i">Convert</span>(<b>typeof</b>(<a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<a href="../Operations/MiscOps.cs.html#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="../Operations/MiscOps.cs.html#6ebb57f87aea6e54" class="i field">Default</a>),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(0)),
                            <span class="r1197 r">lhsEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r1196 r">argRestrictions</span>));
                <b>case</b> 2:
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#b001fffaf39caaad" class="i field">EnumerableOps_Where</a>,
                                <span class="r1197 r">lhsEnumerator</span>.<span class="i">Expression</span>,
                                <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b2d235f5ef39b2c2" class="i method">GetTargetExpr</a>(<span class="r1195 r">args</span>[0]).<span class="i">Convert</span>(<b>typeof</b>(<a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)),
                                <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b2d235f5ef39b2c2" class="i method">GetTargetExpr</a>(<span class="r1195 r">args</span>[1]).<span class="i">Convert</span>(<b>typeof</b>(<a href="../Operations/MiscOps.cs.html#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>)),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(0)),
                            <span class="r1197 r">lhsEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r1196 r">argRestrictions</span>));
                <b>case</b> 3:
                    <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#b001fffaf39caaad" class="i field">EnumerableOps_Where</a>,
                            <span class="r1197 r">lhsEnumerator</span>.<span class="i">Expression</span>,
                            <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b2d235f5ef39b2c2" class="i method">GetTargetExpr</a>(<span class="r1195 r">args</span>[0]).<span class="i">Convert</span>(<b>typeof</b>(<a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)),
                            <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b2d235f5ef39b2c2" class="i method">GetTargetExpr</a>(<span class="r1195 r">args</span>[1]).<span class="i">Convert</span>(<b>typeof</b>(<a href="../Operations/MiscOps.cs.html#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>)),
                            <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<a href="#b2d235f5ef39b2c2" class="i method">GetTargetExpr</a>(<span class="r1195 r">args</span>[2]).<span class="i">Convert</span>(<b>typeof</b>(<b>int</b>))),
                        <span class="r1197 r">lhsEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r1196 r">argRestrictions</span>));
                <b>default</b>:
                    {
                        <span class="c">// If the arity is wrong, throw the extended type system exception.</span>
                        <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                            <span class="i">Expression</span>.<span class="i">Throw</span>(
                                <span class="i">Expression</span>.<span class="i">New</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#1c44fd79df4afcc1" class="i field">MethodException_ctor</a>,
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;MethodCountCouldNotFindBest&quot;</span>),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">MethodArgumentCountException</span>),
                                    <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                        <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;.Where({ expression } [, mode [, numberToReturn]])&quot;</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                        <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<span class="r1195 r">args</span>.<span class="i">Length</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))),
                                <a href="#0e3dce2a001305f0" class="k">this</a>.<span class="i">ReturnType</span>),
                            <span class="r1197 r">lhsEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r1196 r">argRestrictions</span>));
                    }
            }
        }
 
        <b>private</b> <span class="i">DynamicMetaObject</span> <a id="a61540d098265df8" href="../../../R/a61540d098265df8.html" target="n" data-glyph="76,1" class="i method">InvokeForEachOnCollection</a>(<span class="i">DynamicMetaObject</span> <span id="r1198 rd" class="r1198 r">targetEnumerator</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1199 rd" class="r1199 r">args</span>, <span class="i">BindingRestrictions</span> <span id="r1200 rd" class="r1200 r">restrictions</span>)
        {
            <span class="r1198 r">targetEnumerator</span> = <a href="#5b104169d00fc8fb" class="i method">GetTargetAsEnumerable</a>(<span class="r1198 r">targetEnumerator</span>);
 
            <b>if</b> (<span class="r1199 r">args</span>.<span class="i">Length</span> &lt; 1)
            {
                <span class="c">// If the arity is wrong, throw the extended type system exception.</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                    <span class="i">Expression</span>.<span class="i">Throw</span>(
                        <span class="i">Expression</span>.<span class="i">New</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#1c44fd79df4afcc1" class="i field">MethodException_ctor</a>,
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;MethodCountCouldNotFindBest&quot;</span>),
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<b>null</b>, <b>typeof</b>(<span class="i">Exception</span>)),
                            <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="i">ExtendedTypeSystem</span>.<span class="i">MethodArgumentCountException</span>),
                            <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;.ForEach(expression [, arguments...])&quot;</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)),
                                <a href="../../parser/Compiler.cs.html#38ca030cfcd33569" class="t t">ExpressionCache</a>.<span class="i">Constant</span>(<span class="r1199 r">args</span>.<span class="i">Length</span>).<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>)))),
                        <a href="#0e3dce2a001305f0" class="k">this</a>.<span class="i">ReturnType</span>),
                    <span class="r1198 r">targetEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r1200 r">restrictions</span>));
            }
 
            <b>var</b> <span id="r1201 rd" class="r1201 r">lhsEnumerator</span> = <a href="#e3fd1907f899e2b7" class="t t">PSEnumerableBinder</a>.<a href="#cb5551ef9f16ca1f" class="i method">IsEnumerable</a>(<span class="r1198 r">targetEnumerator</span>).<span class="i">Expression</span>;
            <span class="i">Expression</span> <span id="r1202 rd" class="r1202 r">argsToPass</span>;
            <b>if</b> (<span class="r1199 r">args</span>.<span class="i">Length</span> &gt; 1)
            {
                <span class="r1202 r">argsToPass</span> = <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>),
                                      <span class="r1199 r">args</span>.<span class="i">Skip</span>(1).<span class="i">Select</span>(<b>static</b> <span id="r1203 rd" class="r1203 r">a</span> =&gt; <span class="r1203 r">a</span>.<span class="i">Expression</span>.<span class="i">Cast</span>(<b>typeof</b>(<b>object</b>))));
            }
            <b>else</b>
            {
                <span class="r1202 r">argsToPass</span> = <span class="i">Expression</span>.<span class="i">NewArrayInit</span>(<b>typeof</b>(<b>object</b>));
            }
 
            <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#8613c6242756ee2f" class="i field">EnumerableOps_ForEach</a>,
                            <span class="r1201 r">lhsEnumerator</span>, <a href="#ef1a94f6eb6abfd5" class="t t">PSGetMemberBinder</a>.<span class="i">GetTargetExpr</span>(<span class="r1199 r">args</span>[0], <b>typeof</b>(<b>object</b>)), <span class="r1202 r">argsToPass</span>),
                <span class="r1198 r">targetEnumerator</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="r1200 r">restrictions</span>));
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Runtime helpers
 
        <b>internal static bool</b> <a id="44163d98d6552964" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsHomogenousArray</a>&lt;<span id="r1204 rd t" class="r1204 r t">T</span>&gt;(<b>object</b>[] <span id="r1205 rd" class="r1205 r">args</span>)
        {
            <b>if</b> (<span class="r1205 r">args</span>.<span class="i">Length</span> == 0)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <span class="r1205 r">args</span>.<span class="i">All</span>(<span id="r1206 rd" class="r1206 r">element</span> =&gt;
                            {
                                <b>var</b> <span id="r1207 rd" class="r1207 r">obj</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1206 r">element</span>);
                                <b>return</b> <span class="r1207 r">obj</span> != <b>null</b> &amp;&amp; <span class="r1207 r">obj</span>.<span class="i">GetType</span>().<span class="i">Equals</span>(<b>typeof</b>(<span class="r1204 r t">T</span>));
                            });
        }
 
        <b>internal static bool</b> <a id="3141468cbbd06aef" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsHeterogeneousArray</a>(<b>object</b>[] <span id="r1208 rd" class="r1208 r">args</span>)
        {
            <b>if</b> (<span class="r1208 r">args</span>.<span class="i">Length</span> == 0)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>var</b> <span id="r1209 rd" class="r1209 r">firstElement</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r1208 r">args</span>[0]);
            <b>if</b> (<span class="r1209 r">firstElement</span> == <b>null</b>)
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>var</b> <span id="r1210 rd" class="r1210 r">firstType</span> = <span class="r1209 r">firstElement</span>.<span class="i">GetType</span>();
            <b>if</b> (<span class="r1210 r">firstType</span>.<span class="i">Equals</span>(<b>typeof</b>(<b>object</b>)))
            {
                <span class="c">// When the effective argument type is object[], it&#39;s for one of 2 reasons</span>
                <span class="c">//     * the array contains elements with different types</span>
                <span class="c">//     * the array contains elements that are all object</span>
                <span class="c">// Arrays of all object is rare, which is why this method is called IsHeterogeneousArray,</span>
                <span class="c">// but we still want to correctly handle object[] full of objects, so we return true</span>
                <span class="c">// for that case as well.</span>
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <span class="r1208 r">args</span>.<span class="i">Skip</span>(1).<span class="i">Any</span>(<span id="r1211 rd" class="r1211 r">element</span> =&gt;
                                    {
                                        <b>var</b> <span id="r1212 rd" class="r1212 r">obj</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1211 r">element</span>);
                                        <b>return</b> <span class="r1212 r">obj</span> == <b>null</b> || !<span class="r1210 r">firstType</span>.<span class="i">Equals</span>(<span class="r1212 r">obj</span>.<span class="i">GetType</span>());
                                    });
        }
 
        <b>internal static object</b> <a id="4f4a6e7562aa1626" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokeAdaptedMember</a>(<b>object</b> <span id="r1213 rd" class="r1213 r">obj</span>, <b>string</b> <span id="r1214 rd" class="r1214 r">methodName</span>, <b>object</b>[] <span id="r1215 rd" class="r1215 r">args</span>)
        {
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r1216 rd" class="r1216 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <a href="../../MshObject.cs.html#16d82eb261f231c0" class="k">var</a> <span id="r1217 rd" class="r1217 r">adapterSet</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#c3772e5257a3f0e8" class="i method">GetMappedAdapter</a>(<span class="r1213 r">obj</span>, <span class="r1216 r">context</span>?.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>);
            <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="k">var</a> <span id="r1218 rd" class="r1218 r">methodInfo</span> = <span class="r1217 r">adapterSet</span>.<a href="../../MshObject.cs.html#ae0218d7abc2d496" class="i property">OriginalAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r1213 r">obj</span>, <span class="r1214 r">methodName</span>) <b>as</b> <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="t t">PSMethodInfo</a>;
            <b>if</b> (<span class="r1218 r">methodInfo</span> == <b>null</b> &amp;&amp; <span class="r1217 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a> != <b>null</b>)
            {
                <span class="r1218 r">methodInfo</span> = <span class="r1217 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt;(<span class="r1213 r">obj</span>, <span class="r1214 r">methodName</span>) <b>as</b> <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="t t">PSMethodInfo</a>;
            }
 
            <b>if</b> (<span class="r1218 r">methodInfo</span> != <b>null</b>)
            {
                <b>return</b> <span class="r1218 r">methodInfo</span>.<a href="../../MshMemberInfo.cs.html#f4f9695891d65945" class="i method">Invoke</a>(<span class="r1215 r">args</span>);
            }
 
            <span class="c">// The object doesn&#39;t have &#39;Where&#39; and &#39;ForEach&#39; methods.</span>
            <span class="c">// As a last resort, we invoke &#39;Where&#39; and &#39;ForEach&#39; operators on singletons like</span>
            <span class="c">//    ([pscustomobject]@{ foo = &#39;bar&#39; }).Foreach({$_})</span>
            <span class="c">//    ([pscustomobject]@{ foo = &#39;bar&#39; }).Where({1})</span>
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r1214 r">methodName</span>, <span class="s">&quot;Where&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>var</b> <span id="r1219 rd" class="r1219 r">enumerator</span> = (<b>new</b> <b>object</b>[] { <span class="r1213 r">obj</span> }).<span class="i">GetEnumerator</span>();
                <b>switch</b> (<span class="r1215 r">args</span>.<span class="i">Length</span>)
                {
                    <b>case</b> 1:
                        <b>return</b> <a href="../Operations/MiscOps.cs.html#3856cc8435546884" class="t t">EnumerableOps</a>.<span class="i">Where</span>(<span class="r1219 r">enumerator</span>, <span class="r1215 r">args</span>[0] <b>as</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>, <a href="../Operations/MiscOps.cs.html#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>.<a href="../Operations/MiscOps.cs.html#6ebb57f87aea6e54" class="i field">Default</a>, 0);
                    <b>case</b> 2:
                        <b>return</b> <a href="../Operations/MiscOps.cs.html#3856cc8435546884" class="t t">EnumerableOps</a>.<span class="i">Where</span>(<span class="r1219 r">enumerator</span>, <span class="r1215 r">args</span>[0] <b>as</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>,
                                                   <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<a href="../Operations/MiscOps.cs.html#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>&gt;(<span class="r1215 r">args</span>[1]), 0);
                    <b>case</b> 3:
                        <b>return</b> <a href="../Operations/MiscOps.cs.html#3856cc8435546884" class="t t">EnumerableOps</a>.<span class="i">Where</span>(<span class="r1219 r">enumerator</span>, <span class="r1215 r">args</span>[0] <b>as</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>,
                                                   <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<a href="../Operations/MiscOps.cs.html#eae056a893fde0db" class="t t">WhereOperatorSelectionMode</a>&gt;(<span class="r1215 r">args</span>[1]), <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<b>int</b>&gt;(<span class="r1215 r">args</span>[2]));
                }
            }
 
            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r1214 r">methodName</span>, <span class="s">&quot;Foreach&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>var</b> <span id="r1220 rd" class="r1220 r">enumerator</span> = (<b>new</b> <b>object</b>[] { <span class="r1213 r">obj</span> }).<span class="i">GetEnumerator</span>();
                <b>return</b> <a href="../Operations/MiscOps.cs.html#3856cc8435546884" class="t t">EnumerableOps</a>.<span class="i">ForEach</span>(<span class="r1220 r">enumerator</span>, <span class="r1215 r">args</span>[0], <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;());
            }
 
            <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r1214 r">methodName</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <b>null</b>,
                <span class="s">&quot;MethodNotFound&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">MethodNotFound</span>, <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#da07f094dc9766c8" class="i method">GetTypeFullName</a>(<span class="r1213 r">obj</span>), <span class="r1214 r">methodName</span>);
        }
 
        <b>internal static object</b> <a id="f5933b1af7ed515e" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">InvokeAdaptedSetMember</a>(<b>object</b> <span id="r1221 rd" class="r1221 r">obj</span>, <b>string</b> <span id="r1222 rd" class="r1222 r">methodName</span>, <b>object</b>[] <span id="r1223 rd" class="r1223 r">args</span>, <b>object</b> <span id="r1224 rd" class="r1224 r">valueToSet</span>)
        {
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r1225 rd" class="r1225 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <a href="../../MshObject.cs.html#16d82eb261f231c0" class="k">var</a> <span id="r1226 rd" class="r1226 r">adapterSet</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#c3772e5257a3f0e8" class="i method">GetMappedAdapter</a>(<span class="r1221 r">obj</span>, <span class="r1225 r">context</span>?.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>);
            <a href="../../MshMemberInfo.cs.html#c06615b4d3a255aa" class="k">var</a> <span id="r1227 rd" class="r1227 r">methodInfo</span> = <span class="r1226 r">adapterSet</span>.<a href="../../MshObject.cs.html#ae0218d7abc2d496" class="i property">OriginalAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#c06615b4d3a255aa" class="t t">PSParameterizedProperty</a>&gt;(<span class="r1221 r">obj</span>, <span class="r1222 r">methodName</span>);
            <b>if</b> (<span class="r1227 r">methodInfo</span> == <b>null</b> &amp;&amp; <span class="r1226 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a> != <b>null</b>)
            {
                <span class="r1227 r">methodInfo</span> = <span class="r1226 r">adapterSet</span>.<a href="../../MshObject.cs.html#6e03ccc45b630635" class="i property">DotNetAdapter</a>.<a href="../../CoreAdapter.cs.html#4a4d5a71feb79697" class="i method">BaseGetMember</a>&lt;<a href="../../MshMemberInfo.cs.html#c06615b4d3a255aa" class="t t">PSParameterizedProperty</a>&gt;(<span class="r1221 r">obj</span>, <span class="r1222 r">methodName</span>);
            }
 
            <b>if</b> (<span class="r1227 r">methodInfo</span> != <b>null</b>)
            {
                <span class="r1227 r">methodInfo</span>.<a href="../../MshMemberInfo.cs.html#b2b8b98e2a7d3564" class="i method">InvokeSet</a>(<span class="r1224 r">valueToSet</span>, <span class="r1223 r">args</span>);
                <b>return</b> <span class="r1224 r">valueToSet</span>;
            }
 
            <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r1222 r">methodName</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <b>null</b>,
                <span class="s">&quot;MethodNotFound&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">MethodNotFound</span>, <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#da07f094dc9766c8" class="i method">GetTypeFullName</a>(<span class="r1221 r">obj</span>), <span class="r1222 r">methodName</span>);
        }
 
        <b>internal static bool</b> <a id="b8589e6713863911" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">TryGetInstanceMethod</a>(<b>object</b> <span id="r1228 rd" class="r1228 r">value</span>, <b>string</b> <span id="r1229 rd" class="r1229 r">memberName</span>, <b>out</b> <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="t t">PSMethodInfo</a> <span id="r1230 rd" class="r1230 r">methodInfo</span>)
        {
            <a href="../../MshMemberInfo.cs.html#d9b894a5fd752b79" class="t t">PSMemberInfoInternalCollection</a>&lt;<a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="t t">PSMemberInfo</a>&gt; <span id="r1231 rd" class="r1231 r">instanceMembers</span>;
            <a href="../../MshMemberInfo.cs.html#fbee845d6706f8da" class="k">var</a> <span id="r1232 rd" class="r1232 r">memberInfo</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#364e445adfd28491" class="i method">HasInstanceMembers</a>(<span class="r1228 r">value</span>, <b>out</b> <span class="r1231 r">instanceMembers</span>) ? <span class="r1231 r">instanceMembers</span><a href="../../MshMemberInfo.cs.html#fe158918a7413959">[</a><span class="r1229 r">memberName</span>] : <b>null</b>;
            <span class="r1230 r">methodInfo</span> = <span class="r1232 r">memberInfo</span> <b>as</b> <a href="../../MshMemberInfo.cs.html#19eeb66bf76c933c" class="t t">PSMethodInfo</a>;
            <b>if</b> (<span class="r1232 r">memberInfo</span> == <b>null</b>)
            {
                <span class="c">// No member, just return false</span>
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<span class="r1230 r">methodInfo</span> == <b>null</b>)
            {
                <span class="c">// Found a member, but it wasn&#39;t a method, throw an exception because we can&#39;t call it.</span>
                <b>throw</b> <a href="../../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r1229 r">memberName</span>, <b>typeof</b>(<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>), <b>null</b>,
                    <span class="s">&quot;MethodNotFound&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">MethodNotFound</span>, <a href="../../lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="../../lang/parserutils.cs.html#da07f094dc9766c8" class="i method">GetTypeFullName</a>(<span class="r1228 r">value</span>), <span class="r1229 r">memberName</span>);
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>internal static void</b> <a id="d2965089b6c26107" href="../../../R/d2965089b6c26107.html" target="n" data-glyph="74,1" class="i method">InvalidateCache</a>()
        {
            <span class="c">// Invalidate regular binders</span>
            <b>lock</b> (<a href="#ecccc74425f28bfc" class="i field">s_binderCache</a>)
            {
                <b>foreach</b> (<a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a> <span id="r1233 rd" class="r1233 r">binder</span> <b>in</b> <a href="#ecccc74425f28bfc" class="i field">s_binderCache</a>.<span class="i">Values</span>)
                {
                    <span class="r1233 r">binder</span>.<a href="#a17331156d5f2d73" class="i field">_getMemberBinder</a>.<a href="#017a627d1c63e599" class="i field">_version</a> += 1;
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <b>internal class</b> <a id="b69e0408238caa22" href="../../../R/b69e0408238caa22.html" target="n" data-glyph="2,0" class="t t">PSCreateInstanceBinder</a> : <span class="i">CreateInstanceBinder</span>
    {
        <b>private readonly</b> <span class="i">CallInfo</span> <a id="b40ff1bcc03dab8a" href="../../../R/b40ff1bcc03dab8a.html" target="n" data-glyph="46,1" class="i field">_callInfo</a>;
        <b>private readonly</b> <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <a id="a8149b1e0076ecd3" href="../../../R/a8149b1e0076ecd3.html" target="n" data-glyph="46,1" class="i field">_constraints</a>;
        <b>private readonly bool</b> <a id="27faa3de320dc536" href="../../../R/27faa3de320dc536.html" target="n" data-glyph="46,1" class="i field">_publicTypeOnly</a>;
        <b>private int</b> <a id="d664bdad9eddf255" href="../../../R/d664bdad9eddf255.html" target="n" data-glyph="46,1" class="i field">_version</a>;
 
        <b>private sealed class</b> <a id="18dd14114fa81989" href="../../../R/../../0000000000.html" target="n" data-glyph="4,1" class="t t"><span id="7fc791ef5d2579e5">KeyComparer</span></a> : <span class="i">IEqualityComparer</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt;&gt;
        {
            <b>public bool</b> <a id="1285436e608cbe17" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Equals</a>(<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt; <span id="r1234 rd" class="r1234 r">x</span>,
                               <span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt; <span id="r1235 rd" class="r1235 r">y</span>)
            {
                <b>return</b> <span class="r1234 r">x</span>.<span class="i">Item1</span>.<span class="i">Equals</span>(<span class="r1235 r">y</span>.<span class="i">Item1</span>)
                       &amp;&amp; ((<span class="r1234 r">x</span>.<span class="i">Item2</span> == <b>null</b>) ? (<span class="r1235 r">y</span>.<span class="i">Item2</span> == <b>null</b>) : <span class="r1234 r">x</span>.<span class="i">Item2</span>.<span class="i">Equals</span>(<span class="r1235 r">y</span>.<span class="i">Item2</span>))
                       &amp;&amp; <span class="r1234 r">x</span>.<span class="i">Item3</span> == <span class="r1235 r">y</span>.<span class="i">Item3</span>;
            }
 
            <b>public int</b> <a id="a84f72c3ad90d244" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetHashCode</a>(<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt; <span id="r1236 rd" class="r1236 r">obj</span>)
            {
                <b>return</b> <span class="r1236 r">obj</span>.<span class="i">GetHashCode</span>();
            }
        }
 
        <b>private static readonly</b>
            <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt;, <a href="#b69e0408238caa22" class="t t">PSCreateInstanceBinder</a>&gt;
            <a id="88294cb23dcc9b99" href="../../../R/88294cb23dcc9b99.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> =
                <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>, <b>bool</b>&gt;, <a href="#b69e0408238caa22" class="t t">PSCreateInstanceBinder</a>&gt;(<b>new</b> <span class="t">KeyComparer</span>());
 
        <b>public static</b> <a href="#b69e0408238caa22" class="t t">PSCreateInstanceBinder</a> <a id="5f3d565cf1fbe2b5" href="../../../R/5f3d565cf1fbe2b5.html" target="n" data-glyph="72,1" class="i method">Get</a>(<span class="i">CallInfo</span> <span id="r1237 rd" class="r1237 r">callInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1238 rd" class="r1238 r">constraints</span>, <b>bool</b> <span id="r1239 rd" class="r1239 r">publicTypeOnly</span> = <b>false</b>)
        {
            <a href="#b69e0408238caa22" class="t t">PSCreateInstanceBinder</a> <span id="r1240 rd" class="r1240 r">result</span>;
 
            <b>lock</b> (<a href="#88294cb23dcc9b99" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r1241 rd" class="r1241 r">key</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r1237 r">callInfo</span>, <span class="r1238 r">constraints</span>, <span class="r1239 r">publicTypeOnly</span>);
                <b>if</b> (!<a href="#88294cb23dcc9b99" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r1241 r">key</span>, <b>out</b> <span class="r1240 r">result</span>))
                {
                    <span class="r1240 r">result</span> = <b>new</b> <a href="#c8955b441f8532b1" class="t constructor">PSCreateInstanceBinder</a>(<span class="r1237 r">callInfo</span>, <span class="r1238 r">constraints</span>, <span class="r1239 r">publicTypeOnly</span>);
                    <a href="#88294cb23dcc9b99" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r1241 r">key</span>, <span class="r1240 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r1240 r">result</span>;
        }
 
        <b>internal static void</b> <a id="fa11d29e2e7f51bf" href="../../../R/fa11d29e2e7f51bf.html" target="n" data-glyph="74,1" class="i method">InvalidateCache</a>()
        {
            <span class="c">// Invalidate binders</span>
            <b>lock</b> (<a href="#88294cb23dcc9b99" class="i field">s_binderCache</a>)
            {
                <b>foreach</b> (<b>var</b> <span id="r1242 rd" class="r1242 r">binder</span> <b>in</b> <a href="#88294cb23dcc9b99" class="i field">s_binderCache</a>.<span class="i">Values</span>)
                {
                    <span class="r1242 r">binder</span>.<span class="i">_version</span> += 1;
                }
            }
        }
 
        <b>internal</b> <a id="c8955b441f8532b1" href="../../../R/c8955b441f8532b1.html" target="n" data-glyph="74,1" class="t constructor">PSCreateInstanceBinder</a>(<span class="i">CallInfo</span> <span id="r1243 rd" class="r1243 r">callInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1244 rd" class="r1244 r">constraints</span>, <b>bool</b> <span id="r1245 rd" class="r1245 r">publicTypeOnly</span>)
            : <b>base</b>(<span class="r1243 r">callInfo</span>)
        {
            <a href="#27faa3de320dc536" class="i field">_publicTypeOnly</a> = <span class="r1245 r">publicTypeOnly</span>;
            <a href="#b40ff1bcc03dab8a" class="i field">_callInfo</a> = <span class="r1243 r">callInfo</span>;
            <a href="#a8149b1e0076ecd3" class="i field">_constraints</a> = <span class="r1244 r">constraints</span>;
        }
 
        <b>public override string</b> <a id="827a33eb9145947c" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="s">&quot;PSCreateInstanceBinder: ver:{0} args:{1} constraints:&lt;{2}&gt;&quot;</span>, <a href="#d664bdad9eddf255" class="i field">_version</a>, <a href="#b40ff1bcc03dab8a" class="i field">_callInfo</a>.<span class="i">ArgumentCount</span>, <a href="#a8149b1e0076ecd3" class="i field">_constraints</a> != <b>null</b> ? <a href="#a8149b1e0076ecd3" class="i field">_constraints</a>.<a href="../../MshMemberInfo.cs.html#315c57da5cc14f92" class="i method">ToString</a>() : <b>string</b>.<span class="i">Empty</span>);
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="8a556cfac47ecfc0" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackCreateInstance</a>(<span class="i">DynamicMetaObject</span> <span id="r1246 rd" class="r1246 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1247 rd" class="r1247 r">args</span>, <span class="i">DynamicMetaObject</span> <span id="r1248 rd" class="r1248 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r1246 r">target</span>.<span class="i">HasValue</span> || <span class="r1247 r">args</span>.<span class="i">Any</span>(<b>static</b> <span id="r1249 rd" class="r1249 r">arg</span> =&gt; !<span class="r1249 r">arg</span>.<span class="i">HasValue</span>))
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r1247 r">args</span>.<span class="i">Prepend</span>(<span class="r1246 r">target</span>).<span class="i">ToArray</span>());
            }
 
            <b>var</b> <span id="r1250 rd" class="r1250 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">Base</span>(<span class="r1246 r">target</span>.<span class="i">Value</span>);
            <b>if</b> (<span class="r1250 r">targetValue</span> == <b>null</b>)
            {
                <b>return</b> <span class="r1246 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r1247 r">args</span>, <span class="i">BindingRestrictions</span>.<span class="i">Empty</span>, <span class="s">&quot;InvokeMethodOnNull&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">InvokeMethodOnNull</span>).<span class="i">WriteToDebugLog</span>(<a href="#b69e0408238caa22" class="k">this</a>);
            }
 
            <b>var</b> <span id="r1251 rd" class="r1251 r">instanceType</span> = <span class="r1250 r">targetValue</span> <b>as</b> <span class="i">Type</span> ?? <span class="r1250 r">targetValue</span>.<span class="i">GetType</span>();
 
            <span class="i">BindingRestrictions</span> <span id="r1252 rd" class="r1252 r">restrictions</span>;
            <b>if</b> (<span class="r1251 r">instanceType</span>.<span class="i">IsByRefLike</span>)
            {
                <span class="c">// ByRef-like types are not boxable and should be used only on stack</span>
                <span class="r1252 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                    <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#c516aa9258d6469b" class="i field">PSCreateInstanceBinder_IsTargetTypeByRefLike</a>, <span class="r1246 r">target</span>.<span class="i">Expression</span>));
 
                <b>return</b> <span class="r1246 r">target</span>.<span class="i">ThrowRuntimeError</span>(
                    <span class="r1252 r">restrictions</span>,
                    <b>nameof</b>(<span class="i">ExtendedTypeSystem</span>.<span class="i">CannotInstantiateBoxedByRefLikeType</span>),
                    <span class="i">ExtendedTypeSystem</span>.<span class="i">CannotInstantiateBoxedByRefLikeType</span>,
                    <span class="i">Expression</span>.<span class="i">Call</span>(
                        <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#8ed43e8480240c4c" class="i field">PSCreateInstanceBinder_GetTargetTypeName</a>,
                        <span class="r1246 r">target</span>.<span class="i">Expression</span>)).<span class="i">WriteToDebugLog</span>(<a href="#b69e0408238caa22" class="k">this</a>);
            }
 
            <b>if</b> (<a href="#27faa3de320dc536" class="i field">_publicTypeOnly</a> &amp;&amp; !<a href="../../parser/TypeResolver.cs.html#f665f2b4b8d028cd" class="t t">TypeResolver</a>.<span class="i">IsPublic</span>(<span class="r1251 r">instanceType</span>))
            {
                <span class="c">// If &#39;publicTypeOnly&#39; specified, we only support creating instance for public types.</span>
                <span class="r1252 r">restrictions</span> = <span class="i">BindingRestrictions</span>.<span class="i">GetExpressionRestriction</span>(
                        <span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#aa6e9cbe951d2396" class="i field">PSCreateInstanceBinder_IsTargetTypeNonPublic</a>, <span class="r1246 r">target</span>.<span class="i">Expression</span>));
 
                <b>return</b> <span class="r1246 r">target</span>.<span class="i">ThrowRuntimeError</span>(
                    <span class="r1252 r">restrictions</span>,
                    <b>nameof</b>(<span class="i">ParserStrings</span>.<span class="i">MethodNotFound</span>),
                    <span class="i">ParserStrings</span>.<span class="i">MethodNotFound</span>,
                    <span class="i">Expression</span>.<span class="i">Call</span>(
                        <a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#8ed43e8480240c4c" class="i field">PSCreateInstanceBinder_GetTargetTypeName</a>,
                        <span class="r1246 r">target</span>.<span class="i">Expression</span>),
                    <span class="i">Expression</span>.<span class="i">Constant</span>(<span class="s">&quot;new&quot;</span>)).<span class="i">WriteToDebugLog</span>(<a href="#b69e0408238caa22" class="k">this</a>);
            }
 
            <b>var</b> <span id="r1253 rd" class="r1253 r">ctors</span> = <span class="r1251 r">instanceType</span>.<span class="i">GetConstructors</span>();
            <span class="r1252 r">restrictions</span> = <span class="i">ReferenceEquals</span>(<span class="r1251 r">instanceType</span>, <span class="r1250 r">targetValue</span>)
                               ? (<span class="r1246 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>)
                                     ? <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="i">Expression</span>.<span class="i">Call</span>(<a href="../../parser/Compiler.cs.html#7281bb41069e8d62" class="t t">CachedReflectionInfo</a>.<a href="../../parser/Compiler.cs.html#95ba8d8e80c2ae2b" class="i field">PSObject_Base</a>, <span class="r1246 r">target</span>.<span class="i">Expression</span>), <span class="r1251 r">instanceType</span>)
                                     : <span class="i">BindingRestrictions</span>.<span class="i">GetInstanceRestriction</span>(<span class="r1246 r">target</span>.<span class="i">Expression</span>, <span class="r1251 r">instanceType</span>)
                               : <span class="r1246 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
            <span class="r1252 r">restrictions</span> = <span class="r1252 r">restrictions</span>.<span class="i">Merge</span>(<a href="#2cec5a1dbfc5222e" class="t t">BinderUtils</a>.<span class="i">GetOptionalVersionAndLanguageCheckForType</span>(<a href="#b69e0408238caa22" class="k">this</a>, <span class="r1251 r">instanceType</span>, <a href="#d664bdad9eddf255" class="i field">_version</a>));
            <b>if</b> (<span class="r1253 r">ctors</span>.<span class="i">Length</span> == 0 &amp;&amp; <a href="#b40ff1bcc03dab8a" class="i field">_callInfo</a>.<span class="i">ArgumentCount</span> == 0 &amp;&amp; <span class="r1251 r">instanceType</span>.<span class="i">IsValueType</span>)
            {
                <span class="c">// No ctors, just call the default ctor</span>
                <b>return</b> <b>new</b> <span class="i">DynamicMetaObject</span>(<span class="i">Expression</span>.<span class="i">New</span>(<span class="r1251 r">instanceType</span>).<span class="i">Cast</span>(<a href="#b69e0408238caa22" class="k">this</a>.<span class="i">ReturnType</span>), <span class="r1252 r">restrictions</span>).<span class="i">WriteToDebugLog</span>(<a href="#b69e0408238caa22" class="k">this</a>);
            }
 
            <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="k">var</a> <span id="r1254 rd" class="r1254 r">context</span> = <a href="../../hostifaces/LocalPipeline.cs.html#4ecb13103c10f113" class="t t">LocalPipeline</a>.<a href="../../hostifaces/LocalPipeline.cs.html#d3eaa3d3391ed484" class="i method">GetExecutionContextFromTLS</a>();
            <b>if</b> (<span class="r1254 r">context</span> != <b>null</b> &amp;&amp; <span class="r1254 r">context</span>.<a href="../../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a> &amp;&amp; !<a href="../../parser/TypeResolver.cs.html#5741cea1a14d9f96" class="t t">CoreTypes</a>.<span class="i">Contains</span>(<span class="r1251 r">instanceType</span>))
            {
                <b>return</b> <span class="r1246 r">target</span>.<span class="i">ThrowRuntimeError</span>(<span class="r1252 r">restrictions</span>, <span class="s">&quot;CannotCreateTypeConstrainedLanguage&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">CannotCreateTypeConstrainedLanguage</span>).<span class="i">WriteToDebugLog</span>(<a href="#b69e0408238caa22" class="k">this</a>);
            }
 
            <span class="r1252 r">restrictions</span> = <span class="r1247 r">args</span>.<span class="i">Aggregate</span>(<span class="r1252 r">restrictions</span>, <b>static</b> (<span id="r1255 rd" class="r1255 r">current</span>, <span id="r1256 rd" class="r1256 r">arg</span>) =&gt; <span class="r1255 r">current</span>.<span class="i">Merge</span>(<span class="r1256 r">arg</span>.<span class="i">PSGetMethodArgumentRestriction</span>()));
            <b>var</b> <span id="r1257 rd" class="r1257 r">newConstructors</span> = <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<span class="i">GetMethodInformationArray</span>(<span class="r1253 r">ctors</span>);
            <b>return</b> <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<span class="i">InvokeDotNetMethod</span>(<a href="#b40ff1bcc03dab8a" class="i field">_callInfo</a>, <span class="s">&quot;new&quot;</span>, <a href="#a8149b1e0076ecd3" class="i field">_constraints</a>, <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#dbd5ee8f8c01b054" class="i field">Ordinary</a>,
                                                           <span class="r1246 r">target</span>, <span class="r1247 r">args</span>, <span class="r1252 r">restrictions</span>, <span class="r1257 r">newConstructors</span>, <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#4961d7a0f93a8280" class="t t">MethodException</a>)).<span class="i">WriteToDebugLog</span>(<a href="#b69e0408238caa22" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the target type is ByRef-like.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="5e31b4efd55ba85f" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsTargetTypeByRefLike</a>(<b>object</b> <span id="r1258 rd" class="r1258 r">target</span>)
        {
            <b>var</b> <span id="r1259 rd" class="r1259 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r1258 r">target</span>);
            <b>if</b> (<span class="r1259 r">targetValue</span> == <b>null</b>) { <b>return</b> <b>false</b>; }
 
            <b>var</b> <span id="r1260 rd" class="r1260 r">instanceType</span> = <span class="r1259 r">targetValue</span> <b>as</b> <span class="i">Type</span> ?? <span class="r1259 r">targetValue</span>.<span class="i">GetType</span>();
            <b>return</b> <span class="r1260 r">instanceType</span>.<span class="i">IsByRefLike</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the target type is not public.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="cceb2b5b7cd54f1d" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">IsTargetTypeNonPublic</a>(<b>object</b> <span id="r1261 rd" class="r1261 r">target</span>)
        {
            <b>var</b> <span id="r1262 rd" class="r1262 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r1261 r">target</span>);
            <b>if</b> (<span class="r1262 r">targetValue</span> == <b>null</b>) { <b>return</b> <b>false</b>; }
 
            <b>var</b> <span id="r1263 rd" class="r1263 r">instanceType</span> = <span class="r1262 r">targetValue</span> <b>as</b> <span class="i">Type</span> ?? <span class="r1262 r">targetValue</span>.<span class="i">GetType</span>();
            <b>return</b> !<a href="../../parser/TypeResolver.cs.html#f665f2b4b8d028cd" class="t t">TypeResolver</a>.<span class="i">IsPublic</span>(<span class="r1263 r">instanceType</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return the full name of the target type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="3d3090dbd89887b2" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetTargetTypeName</a>(<b>object</b> <span id="r1264 rd" class="r1264 r">target</span>)
        {
            <b>var</b> <span id="r1265 rd" class="r1265 r">targetValue</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r1264 r">target</span>);
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r1265 r">targetValue</span> != <b>null</b>, <span class="s">&quot;caller makes sure target is not null&quot;</span>);
 
            <b>var</b> <span id="r1266 rd" class="r1266 r">instanceType</span> = <span class="r1265 r">targetValue</span> <b>as</b> <span class="i">Type</span> ?? <span class="r1265 r">targetValue</span>.<span class="i">GetType</span>();
            <b>return</b> <span class="r1266 r">instanceType</span>.<span class="i">FullName</span>;
        }
    }
 
    <b>internal class</b> <a id="ea209d8b05b0d799" href="../../../R/ea209d8b05b0d799.html" target="n" data-glyph="2,0" class="t t">PSInvokeBaseCtorBinder</a> : <span class="i">InvokeMemberBinder</span>
    {
        <b>private readonly</b> <span class="i">CallInfo</span> <a id="d8ec28a1015f786e" href="../../../R/d8ec28a1015f786e.html" target="n" data-glyph="46,1" class="i field">_callInfo</a>;
        <b>private readonly</b> <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <a id="b0dd73279cc92c21" href="../../../R/b0dd73279cc92c21.html" target="n" data-glyph="46,1" class="i field">_constraints</a>;
 
        <b>private sealed class</b> <a id="200d05176269ebac" href="../../../R/../../0000000000.html" target="n" data-glyph="4,1" class="t t"><span id="0491193ff2bd8870">KeyComparer</span></a> : <span class="i">IEqualityComparer</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt;&gt;
        {
            <b>public bool</b> <a id="0a9138547fe936d4" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Equals</a>(<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt; <span id="r1267 rd" class="r1267 r">x</span>,
                               <span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt; <span id="r1268 rd" class="r1268 r">y</span>)
            {
                <b>return</b> <span class="r1267 r">x</span>.<span class="i">Item1</span>.<span class="i">Equals</span>(<span class="r1268 r">y</span>.<span class="i">Item1</span>)
                       &amp;&amp; ((<span class="r1267 r">x</span>.<span class="i">Item2</span> == <b>null</b>) ? (<span class="r1268 r">y</span>.<span class="i">Item2</span> == <b>null</b>) : <span class="r1267 r">x</span>.<span class="i">Item2</span>.<span class="i">Equals</span>(<span class="r1268 r">y</span>.<span class="i">Item2</span>));
            }
 
            <b>public int</b> <a id="1fbf4d3a4108ee72" href="../../../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetHashCode</a>(<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt; <span id="r1269 rd" class="r1269 r">obj</span>)
            {
                <b>return</b> <span class="r1269 r">obj</span>.<span class="i">GetHashCode</span>();
            }
        }
 
        <b>private static readonly</b>
            <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt;, <a href="#ea209d8b05b0d799" class="t t">PSInvokeBaseCtorBinder</a>&gt;
            <a id="df7a8a9d5a7aa2c6" href="../../../R/df7a8a9d5a7aa2c6.html" target="n" data-glyph="46,1" class="i field">s_binderCache</a> =
                <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">Tuple</span>&lt;<span class="i">CallInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a>&gt;, <a href="#ea209d8b05b0d799" class="t t">PSInvokeBaseCtorBinder</a>&gt;(<b>new</b> <span class="t">KeyComparer</span>());
 
        <b>public static</b> <a href="#ea209d8b05b0d799" class="t t">PSInvokeBaseCtorBinder</a> <a id="5ad01a4a81f20728" href="../../../R/5ad01a4a81f20728.html" target="n" data-glyph="72,1" class="i method">Get</a>(<span class="i">CallInfo</span> <span id="r1270 rd" class="r1270 r">callInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1271 rd" class="r1271 r">constraints</span>)
        {
            <a href="#ea209d8b05b0d799" class="t t">PSInvokeBaseCtorBinder</a> <span id="r1272 rd" class="r1272 r">result</span>;
 
            <b>lock</b> (<a href="#df7a8a9d5a7aa2c6" class="i field">s_binderCache</a>)
            {
                <b>var</b> <span id="r1273 rd" class="r1273 r">key</span> = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r1270 r">callInfo</span>, <span class="r1271 r">constraints</span>);
                <b>if</b> (!<a href="#df7a8a9d5a7aa2c6" class="i field">s_binderCache</a>.<span class="i">TryGetValue</span>(<span class="r1273 r">key</span>, <b>out</b> <span class="r1272 r">result</span>))
                {
                    <span class="r1272 r">result</span> = <b>new</b> <a href="#cef5cb0fa779720c" class="t constructor">PSInvokeBaseCtorBinder</a>(<span class="r1270 r">callInfo</span>, <span class="r1271 r">constraints</span>);
                    <a href="#df7a8a9d5a7aa2c6" class="i field">s_binderCache</a>.<span class="i">Add</span>(<span class="r1273 r">key</span>, <span class="r1272 r">result</span>);
                }
            }
 
            <b>return</b> <span class="r1272 r">result</span>;
        }
 
        <b>internal</b> <a id="cef5cb0fa779720c" href="../../../R/cef5cb0fa779720c.html" target="n" data-glyph="74,1" class="t constructor">PSInvokeBaseCtorBinder</a>(<span class="i">CallInfo</span> <span id="r1274 rd" class="r1274 r">callInfo</span>, <a href="../../MshMemberInfo.cs.html#27663bce603069bd" class="t t">PSMethodInvocationConstraints</a> <span id="r1275 rd" class="r1275 r">constraints</span>)
            : <b>base</b>(<span class="s">&quot;.ctor&quot;</span>, <b>false</b>, <span class="r1274 r">callInfo</span>)
        {
            <a href="#d8ec28a1015f786e" class="i field">_callInfo</a> = <span class="r1274 r">callInfo</span>;
            <a href="#b0dd73279cc92c21" class="i field">_constraints</a> = <span class="r1275 r">constraints</span>;
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="a3b819f05bf993a2" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackInvokeMember</a>(<span class="i">DynamicMetaObject</span> <span id="r1276 rd" class="r1276 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1277 rd" class="r1277 r">args</span>, <span class="i">DynamicMetaObject</span> <span id="r1278 rd" class="r1278 r">errorSuggestion</span>)
        {
            <b>if</b> (!<span class="r1276 r">target</span>.<span class="i">HasValue</span> || <span class="r1277 r">args</span>.<span class="i">Any</span>(<b>static</b> <span id="r1279 rd" class="r1279 r">arg</span> =&gt; !<span class="r1279 r">arg</span>.<span class="i">HasValue</span>))
            {
                <b>return</b> <span class="i">Defer</span>(<span class="r1277 r">args</span>.<span class="i">Prepend</span>(<span class="r1276 r">target</span>).<span class="i">ToArray</span>());
            }
 
            <b>var</b> <span id="r1280 rd" class="r1280 r">ctors</span> = <a href="#b0dd73279cc92c21" class="i field">_constraints</a>.<a href="../../MshMemberInfo.cs.html#c5767ba0e1e84dc7" class="i property">MethodTargetType</a>.<span class="i">GetConstructors</span>(<span class="i">BindingFlags</span>.<span class="i">Instance</span> | <span class="i">BindingFlags</span>.<span class="i">Public</span> | <span class="i">BindingFlags</span>.<span class="i">NonPublic</span>);
 
            <b>var</b> <span id="r1281 rd" class="r1281 r">restrictions</span> = <span class="r1276 r">target</span>.<span class="i">Value</span> <b>is</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>
                ? <span class="i">BindingRestrictions</span>.<span class="i">GetTypeRestriction</span>(<span class="r1276 r">target</span>.<span class="i">Expression</span>, <span class="r1276 r">target</span>.<span class="i">Value</span>.<span class="i">GetType</span>())
                : <span class="r1276 r">target</span>.<a href="#328412aa1d4c0f48" class="i method">PSGetTypeRestriction</a>();
            <span class="r1281 r">restrictions</span> = <span class="r1277 r">args</span>.<span class="i">Aggregate</span>(<span class="r1281 r">restrictions</span>, <b>static</b> (<span id="r1282 rd" class="r1282 r">current</span>, <span id="r1283 rd" class="r1283 r">arg</span>) =&gt; <span class="r1282 r">current</span>.<span class="i">Merge</span>(<span class="r1283 r">arg</span>.<span class="i">PSGetMethodArgumentRestriction</span>()));
            <b>var</b> <span id="r1284 rd" class="r1284 r">newConstructors</span> = <a href="../../CoreAdapter.cs.html#27353615475f6dbc" class="t t">DotNetAdapter</a>.<span class="i">GetMethodInformationArray</span>(<span class="r1280 r">ctors</span>.<span class="i">Where</span>(<b>static</b> <span id="r1285 rd" class="r1285 r">c</span> =&gt; <span class="r1285 r">c</span>.<span class="i">IsPublic</span> || <span class="r1285 r">c</span>.<span class="i">IsFamily</span>).<span class="i">ToArray</span>());
            <b>return</b> <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<span class="i">InvokeDotNetMethod</span>(<a href="#d8ec28a1015f786e" class="i field">_callInfo</a>, <span class="s">&quot;new&quot;</span>, <a href="#b0dd73279cc92c21" class="i field">_constraints</a>, <a href="#0e3dce2a001305f0" class="t t">PSInvokeMemberBinder</a>.<a href="#caab5d926251a58a" class="t t">MethodInvocationType</a>.<a href="#24150beef32edfa9" class="i field">BaseCtor</a>,
                                                           <span class="r1276 r">target</span>, <span class="r1277 r">args</span>, <span class="r1281 r">restrictions</span>, <span class="r1284 r">newConstructors</span>, <b>typeof</b>(<a href="../../ExtendedTypeSystemException.cs.html#4961d7a0f93a8280" class="t t">MethodException</a>));
        }
 
        <b>public override</b> <span class="i">DynamicMetaObject</span> <a id="6766c60d884040dd" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FallbackInvoke</a>(<span class="i">DynamicMetaObject</span> <span id="r1286 rd" class="r1286 r">target</span>, <span class="i">DynamicMetaObject</span>[] <span id="r1287 rd" class="r1287 r">args</span>, <span class="i">DynamicMetaObject</span> <span id="r1288 rd" class="r1288 r">errorSuggestion</span>)
        {
            <b>return</b> (<span class="r1288 r">errorSuggestion</span> ?? <b>new</b> <span class="i">DynamicMetaObject</span>(
                <span class="i">DynamicExpression</span>.<span class="i">Dynamic</span>(
                    <b>new</b> <span class="t">PSInvokeBinder</span>(<span class="i">CallInfo</span>),
                    <b>typeof</b>(<b>object</b>),
                    <span class="r1287 r">args</span>.<span class="i">Prepend</span>(<span class="r1286 r">target</span>).<span class="i">Select</span>(<b>static</b> <span id="r1289 rd" class="r1289 r">dmo</span> =&gt; <span class="r1289 r">dmo</span>.<span class="i">Expression</span>)
                ),
                <span class="r1286 r">target</span>.<span class="i">Restrictions</span>.<span class="i">Merge</span>(<span class="i">BindingRestrictions</span>.<span class="i">Combine</span>(<span class="r1287 r">args</span>))
            ));
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Standard binders
}
</pre></td></tr></table></div></body></html>
