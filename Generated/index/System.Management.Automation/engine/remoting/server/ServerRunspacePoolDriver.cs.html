<!DOCTYPE html>
<html><head><title>ServerRunspacePoolDriver.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(2837);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/server/ServerRunspacePoolDriver.cs" target="_top">engine\remoting\server\ServerRunspacePoolDriver.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>.<span class="i n">Server</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Security</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>.<span class="i">Principal</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Interface exposing driver single thread invoke enter/exit</span>
    <span class="c">///</span><span class="c"> nested pipeline.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">enable</span>
    <b>internal interface</b> <a id="074cec5d5aeffa31" href="../../../R/074cec5d5aeffa31.html" target="n" data-glyph="50,0" class="t t">IRSPDriverInvoke</a>
    {
        <b>void</b> <a id="a1bf394f83373b32" href="../../../R/a1bf394f83373b32.html" target="n" data-glyph="72,1" class="i method">EnterNestedPipeline</a>();
 
        <b>void</b> <a id="f8279313a177348d" href="../../../R/f8279313a177348d.html" target="n" data-glyph="72,1" class="i method">ExitNestedPipeline</a>();
 
        <b>bool</b> <a id="b9a284d74aa0dc53" href="../../../R/b9a284d74aa0dc53.html" target="n" data-glyph="72,1" class="i method">HandleStopSignal</a>();
    }
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">restore</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class wraps a RunspacePoolInternal object. It is used to function</span>
    <span class="c">///</span><span class="c"> as a server side runspacepool.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="a13c57c874abb0c5" href="../../../R/a13c57c874abb0c5.html" target="n" data-glyph="2,0" class="t t">ServerRunspacePoolDriver</a> : <a href="#074cec5d5aeffa31" class="t t">IRSPDriverInvoke</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Members
 
        <span class="c">// local runspace pool at the server</span>
 
        <span class="c">// Optional initial location of the PowerShell session</span>
        <b>private readonly string</b> <a id="4d7ffc9dc7b5a4cd" href="../../../R/4d7ffc9dc7b5a4cd.html" target="n" data-glyph="46,1" class="i field">_initialLocation</a>;
 
        <span class="c">// Script to run after a RunspacePool/Runspace is created in this session.</span>
        <b>private readonly</b> <a href="../fanin/InitialSessionStateProvider.cs.html#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a> <a id="898d33ebebcf0ca0" href="../../../R/898d33ebebcf0ca0.html" target="n" data-glyph="46,1" class="i field">_configData</a>;
 
        <span class="c">// application private data to send back to the client in when we get into &quot;opened&quot; state</span>
        <b>private</b> <a href="../../serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a> <a id="e8fec38b1ef85728" href="../../../R/e8fec38b1ef85728.html" target="n" data-glyph="46,1" class="i field">_applicationPrivateData</a>;
 
        <span class="c">// the client runspacepool&#39;s guid that is</span>
        <span class="c">// associated with this runspace pool driver</span>
 
        <span class="c">// data structure handler object to handle all communications</span>
        <span class="c">// with the client</span>
 
        <span class="c">// powershell&#39;s associated with this runspace pool</span>
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<span class="i">Guid</span>, <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a>&gt; <a id="e9cb9d4bb93612e3" href="../../../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">_associatedShells</a>
            = <b>new</b> <span class="i">Dictionary</span>&lt;<span class="i">Guid</span>, <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a>&gt;();
 
        <span class="c">// remote host associated with this runspacepool</span>
        <b>private readonly</b> <a href="ServerRemoteHost.cs.html#1186c46a3c18ebd3" class="t t">ServerDriverRemoteHost</a> <a id="4b5f84eedc1e775b" href="../../../R/4b5f84eedc1e775b.html" target="n" data-glyph="46,1" class="i field">_remoteHost</a>;
 
        <b>private bool</b> <a id="0640cfbab71fb3fe" href="../../../R/0640cfbab71fb3fe.html" target="n" data-glyph="46,1" class="i field">_isClosed</a>;
 
        <span class="c">// server capability reported to the client during negotiation (not the actual capability)</span>
        <b>private readonly</b> <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#410d0e97ea446fd9" class="t t">RemoteSessionCapability</a> <a id="32ce733721db5ecb" href="../../../R/32ce733721db5ecb.html" target="n" data-glyph="46,1" class="i field">_serverCapability</a>;
        <b>private</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="b5ed0c16d100e0f5" href="../../../R/b5ed0c16d100e0f5.html" target="n" data-glyph="46,1" class="i field">_rsToUseForSteppablePipeline</a>;
 
        <span class="c">// steppable pipeline event subscribers exist per-session</span>
        <b>private readonly</b> <a href="ServerSteppablePipelineSubscriber.cs.html#8acd85db57a60851" class="t t">ServerSteppablePipelineSubscriber</a> <a id="905aa642df7f7d8f" href="../../../R/905aa642df7f7d8f.html" target="n" data-glyph="46,1" class="i field">_eventSubscriber</a> = <b>new</b> <span class="t">ServerSteppablePipelineSubscriber</span>();
        <b>private</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<b>object</b>&gt; <a id="8561034009021897" href="../../../R/8561034009021897.html" target="n" data-glyph="46,1" class="i field">_inputCollection</a>; <span class="c">// PowerShell driver input collection</span>
 
        <span class="c">// Object to invoke nested PowerShell drivers on single pipeline worker thread.</span>
        <b>private readonly</b> <a href="#71cff3c534cadd9b" class="t t">PowerShellDriverInvoker</a> <a id="41dab6a3fd8a67df" href="../../../R/41dab6a3fd8a67df.html" target="n" data-glyph="46,1" class="i field">_driverNestedInvoker</a>;
 
        <span class="c">// Remote wrapper for script debugger.</span>
        <b>private</b> <a href="#659f74f76b5af7db" class="t t">ServerRemoteDebugger</a> <a id="bf7e26964a89d17a" href="../../../R/bf7e26964a89d17a.html" target="n" data-glyph="46,1" class="i field">_serverRemoteDebugger</a>;
 
        <span class="c">// Version of PowerShell client.</span>
        <b>private readonly</b> <span class="i">Version</span> <a id="4916cfd61743e47c" href="../../../R/4916cfd61743e47c.html" target="n" data-glyph="46,1" class="i field">_clientPSVersion</a>;
 
        <span class="c">// Optional endpoint configuration name.</span>
        <span class="c">// Used in OutOfProc scenarios that do not support PSSession endpoint configuration.</span>
        <span class="c">// Results in a configured remote runspace pushed onto driver host.</span>
        <b>private readonly string</b> <a id="f844c62b2f4d0502" href="../../../R/f844c62b2f4d0502.html" target="n" data-glyph="46,1" class="i field">_configurationName</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Event that get raised when the RunspacePool is closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">EventHandler</span>&lt;<span class="i">EventArgs</span>&gt; <a id="e53bfede6ec58c5e" href="../../../R/e53bfede6ec58c5e.html" target="n" data-glyph="44,1" class="i field">Closed</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Members
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the runspace pool driver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">clientRunspacePoolId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Client runspace pool id to associate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">transportManager</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Transport manager associated with this</span>
        <span class="c">///</span><span class="c"> runspace pool driver.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">maxRunspaces</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Maximum runspaces to open.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">minRunspaces</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Minimum runspaces to open.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">threadOptions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Threading options for the runspaces in the pool.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">apartmentState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Apartment state for the runspaces in the pool.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">hostInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Host information about client side host.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">configData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Contains:</span>
        <span class="c">///</span><span class="c"> 1. Script to run after a RunspacePool/Runspace is created in this session.</span>
        <span class="c">///</span><span class="c"> For RunspacePool case, every newly created Runspace (in the pool) will run</span>
        <span class="c">///</span><span class="c"> this script.</span>
        <span class="c">///</span><span class="c"> 2. ThreadOptions for RunspacePool/Runspace</span>
        <span class="c">///</span><span class="c"> 3. ThreadApartment for RunspacePool/Runspace</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">initialSessionState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Configuration of the runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">applicationPrivateData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Application private data.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">isAdministrator</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if the driver is being created by an administrator.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">serverCapability</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Server capability reported to the client during negotiation (not the actual capability).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">psClientVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Client PowerShell version.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">configurationName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Optional endpoint configuration name to create a pushed configured runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">initialLocation</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Optional initial location of the powershell.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="cee8f6c1f5eb3a9a" href="../../../R/cee8f6c1f5eb3a9a.html" target="n" data-glyph="74,1" class="t constructor">ServerRunspacePoolDriver</a>(
            <span class="i">Guid</span> <span id="r0 rd" class="r0 r">clientRunspacePoolId</span>,
            <b>int</b> <span id="r3 rd" class="r3 r">minRunspaces</span>,
            <b>int</b> <span id="r2 rd" class="r2 r">maxRunspaces</span>,
            <a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a> <span id="r4 rd" class="r4 r">threadOptions</span>,
            <span class="i">ApartmentState</span> <span id="r5 rd" class="r5 r">apartmentState</span>,
            <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#4fc7c4b336de518c" class="t t">HostInfo</a> <span id="r6 rd" class="r6 r">hostInfo</span>,
            <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r8 rd" class="r8 r">initialSessionState</span>,
            <a href="../../serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a> <span id="r9 rd" class="r9 r">applicationPrivateData</span>,
            <a href="../fanin/InitialSessionStateProvider.cs.html#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a> <span id="r7 rd" class="r7 r">configData</span>,
            <a href="../fanin/BaseTransportManager.cs.html#18630eb940dac0a0" class="t t">AbstractServerSessionTransportManager</a> <span id="r1 rd" class="r1 r">transportManager</span>,
            <b>bool</b> <span id="r10 rd" class="r10 r">isAdministrator</span>,
            <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#410d0e97ea446fd9" class="t t">RemoteSessionCapability</a> <span id="r11 rd" class="r11 r">serverCapability</span>,
            <span class="i">Version</span> <span id="r12 rd" class="r12 r">psClientVersion</span>,
            <b>string</b> <span id="r13 rd" class="r13 r">configurationName</span>,
            <b>string</b> <span id="r14 rd" class="r14 r">initialLocation</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r7 r">configData</span> != <b>null</b>, <span class="s">&quot;ConfigurationData cannot be null&quot;</span>);
 
            <a href="#32ce733721db5ecb" class="i field">_serverCapability</a> = <span class="r11 r">serverCapability</span>;
            <a href="#4916cfd61743e47c" class="i field">_clientPSVersion</a> = <span class="r12 r">psClientVersion</span>;
 
            <a href="#f844c62b2f4d0502" class="i field">_configurationName</a> = <span class="r13 r">configurationName</span>;
            <a href="#4d7ffc9dc7b5a4cd" class="i field">_initialLocation</a> = <span class="r14 r">initialLocation</span>;
 
            <span class="c">// Create a new server host and associate for host call</span>
            <span class="c">// integration</span>
            <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a> = <b>new</b> <span class="t">ServerDriverRemoteHost</span>(
                <span class="r0 r">clientRunspacePoolId</span>, <span class="i">Guid</span>.<span class="i">Empty</span>, <span class="r6 r">hostInfo</span>, <span class="r1 r">transportManager</span>, <b>null</b>);
 
            <a href="#898d33ebebcf0ca0" class="i field">_configData</a> = <span class="r7 r">configData</span>;
            <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a> = <span class="r9 r">applicationPrivateData</span>;
            <a href="#02717dc375abd3bb" class="i property">RunspacePool</a> = <a href="../../hostifaces/ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="../../hostifaces/ConnectionFactory.cs.html#2cf4e303c72a33f9" class="i method">CreateRunspacePool</a>(
                  <span class="r3 r">minRunspaces</span>, <span class="r2 r">maxRunspaces</span>, <span class="r8 r">initialSessionState</span>, <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>);
 
            <span class="c">// Set ThreadOptions for this RunspacePool</span>
            <span class="c">// The default server settings is to make new commands execute in the calling thread...this saves</span>
            <span class="c">// thread switching time and thread pool pressure on the service.</span>
            <span class="c">// Users can override the server settings only if they are administrators</span>
            <a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a> <span id="r15 rd" class="r15 r">serverThreadOptions</span> = <span class="r7 r">configData</span>.<a href="../fanin/InitialSessionStateProvider.cs.html#b0375b4c4385e974" class="i field">ShellThreadOptions</a> ?? <a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>.<a href="../../hostifaces/Connection.cs.html#1eea8c0b04b31e81" class="i field">UseCurrentThread</a>;
            <b>if</b> (<span class="r4 r">threadOptions</span> == <a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>.<a href="../../hostifaces/Connection.cs.html#84e3ebfc04cbd4e5" class="i field">Default</a> || <span class="r4 r">threadOptions</span> == <span class="r15 r">serverThreadOptions</span>)
            {
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#4d933f8550b5ef22" class="i property">ThreadOptions</a> = <span class="r15 r">serverThreadOptions</span>;
            }
            <b>else</b>
            {
                <b>if</b> (!<span class="r10 r">isAdministrator</span>)
                {
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../common/remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">MustBeAdminToOverrideThreadOptions</span>));
                }
 
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#4d933f8550b5ef22" class="i property">ThreadOptions</a> = <span class="r4 r">threadOptions</span>;
            }
 
            <span class="c">// Set Thread ApartmentState for this RunspacePool</span>
            <span class="i">ApartmentState</span> <span id="r16 rd" class="r16 r">serverApartmentState</span> = <span class="r7 r">configData</span>.<a href="../fanin/InitialSessionStateProvider.cs.html#c3ef9251121d712c" class="i field">ShellThreadApartmentState</a> ?? <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#8d461e5a29a5440d" class="i field">DefaultApartmentState</a>;
 
            <b>if</b> (<span class="r5 r">apartmentState</span> == <span class="i">ApartmentState</span>.<span class="i">Unknown</span> || <span class="r5 r">apartmentState</span> == <span class="r16 r">serverApartmentState</span>)
            {
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#e96b2efb9719a701" class="i property">ApartmentState</a> = <span class="r16 r">serverApartmentState</span>;
            }
            <b>else</b>
            {
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#e96b2efb9719a701" class="i property">ApartmentState</a> = <span class="r5 r">apartmentState</span>;
            }
 
            <span class="c">// If we have a runspace pool with a single runspace then we can run nested pipelines on</span>
            <span class="c">// on it in a single pipeline invoke thread.</span>
            <b>if</b> (<span class="r2 r">maxRunspaces</span> == 1 &amp;&amp;
                (<a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#4d933f8550b5ef22" class="i property">ThreadOptions</a> == <a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>.<a href="../../hostifaces/Connection.cs.html#84e3ebfc04cbd4e5" class="i field">Default</a> ||
                 <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#4d933f8550b5ef22" class="i property">ThreadOptions</a> == <a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>.<a href="../../hostifaces/Connection.cs.html#1eea8c0b04b31e81" class="i field">UseCurrentThread</a>))
            {
                <a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a> = <b>new</b> <a href="#b351b8d660f5eb64" class="t constructor">PowerShellDriverInvoker</a>();
            }
 
            <a href="#4bfa83b8eb92f06f" class="i property">InstanceId</a> = <span class="r0 r">clientRunspacePoolId</span>;
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a> = <b>new</b> <a href="ServerRemotingProtocol2.cs.html#52ff8105828cda74" class="t constructor">ServerRunspacePoolDataStructureHandler</a>(<a href="#a13c57c874abb0c5" class="k">this</a>, <span class="r1 r">transportManager</span>);
 
            <span class="c">// handle the StateChanged event of the runspace pool</span>
            <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#e81fb7a9266008ab" class="i">StateChanged</a> += <span class="i">HandleRunspacePoolStateChanged</span>;
 
            <span class="c">// listen for events on the runspace pool</span>
            <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#12b18eb6ea299c91" class="i">ForwardEvent</a> += <span class="i">HandleRunspacePoolForwardEvent</span>;
 
            <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#fa15860e7d49bbee" class="i">RunspaceCreated</a> += <span class="i">HandleRunspaceCreated</span>;
 
            <span class="c">// register for all the events from the data structure handler</span>
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#07f70d7701183a55" class="i">CreateAndInvokePowerShell</a> += <span class="i">HandleCreateAndInvokePowerShell</span>;
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#9cb87f6ce81f4781" class="i">GetCommandMetadata</a> += <span class="i">HandleGetCommandMetadata</span>;
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#ec38642f3daebd0b" class="i">HostResponseReceived</a> += <span class="i">HandleHostResponseReceived</span>;
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#26dc24aa6a255ba7" class="i">SetMaxRunspacesReceived</a> += <span class="i">HandleSetMaxRunspacesReceived</span>;
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#c74ca275ccc29f44" class="i">SetMinRunspacesReceived</a> += <span class="i">HandleSetMinRunspacesReceived</span>;
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#05c3fba8b29b35ff" class="i">GetAvailableRunspacesReceived</a> += <span class="i">HandleGetAvailableRunspacesReceived</span>;
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#f1ebe33397f48ba6" class="i">ResetRunspaceState</a> += <span class="i">HandleResetRunspaceState</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Constructors
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Data structure handler for communicating with client.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="ServerRemotingProtocol2.cs.html#009d06bea79ad646" class="t t">ServerRunspacePoolDataStructureHandler</a> <a id="8c8ba41ef94b9086" href="../../../R/8c8ba41ef94b9086.html" target="n" data-glyph="104,1" class="i property">DataStructureHandler</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The server host associated with the runspace pool.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="ServerRemoteHost.cs.html#ecbb655f955c09fc" class="t t">ServerRemoteHost</a> <a id="4549b5f9b57aa1af" href="../../../R/4549b5f9b57aa1af.html" target="n" data-glyph="104,1" class="i property">ServerRemoteHost</a>
        {
            <b>get</b> { <b>return</b> <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The client runspacepool id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Guid</span> <a id="4bfa83b8eb92f06f" href="../../../R/4bfa83b8eb92f06f.html" target="n" data-glyph="104,1" class="i property">InstanceId</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The local runspace pool associated with</span>
        <span class="c">///</span><span class="c"> this driver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <a id="02717dc375abd3bb" href="../../../R/02717dc375abd3bb.html" target="n" data-glyph="104,1" class="i property">RunspacePool</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Start the RunspacePoolDriver. This will open the</span>
        <span class="c">///</span><span class="c"> underlying RunspacePool.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="c5a99501baf2b762" href="../../../R/c5a99501baf2b762.html" target="n" data-glyph="74,1" class="i method">Start</a>()
        {
            <span class="c">// open the runspace pool</span>
            <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#60da411b81c3454e" class="i method">Open</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Send application private data to client</span>
        <span class="c">///</span><span class="c"> will be called during runspace creation</span>
        <span class="c">///</span><span class="c"> and each time a new client connects to the server session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="571695c450993617" href="../../../R/571695c450993617.html" target="n" data-glyph="74,1" class="i method">SendApplicationPrivateDataToClient</a>()
        {
            <span class="c">// Include Debug mode information.</span>
            <b>if</b> (<a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a> == <b>null</b>)
            {
                <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a> = <b>new</b> <a href="../../serialization.cs.html#8d1ee4ea90ea9904" class="t constructor">PSPrimitiveDictionary</a>();
            }
 
            <b>if</b> (<a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> != <b>null</b>)
            {
                <span class="c">// Current debug mode.</span>
                <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a> <span id="r17 rd" class="r17 r">debugMode</span> = <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="../../debugger/debugger.cs.html#cb370f0b35bef91f" class="i property">DebugMode</a>;
                <b>if</b> (<a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<span class="i">ContainsKey</span>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#46a1c160f1d054dc" class="i field">DebugModeSetting</a>))
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a><a href="../../serialization.cs.html#ef1aa37a4f65ba77">[</a><a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#46a1c160f1d054dc" class="i field">DebugModeSetting</a>] = (<b>int</b>)<span class="r17 r">debugMode</span>;
                }
                <b>else</b>
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<a href="../../serialization.cs.html#8bd61569911c5a84" class="i method">Add</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#46a1c160f1d054dc" class="i field">DebugModeSetting</a>, (<b>int</b>)<span class="r17 r">debugMode</span>);
                }
 
                <span class="c">// Current debug state.</span>
                <b>bool</b> <span id="r18 rd" class="r18 r">inBreakpoint</span> = <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#d42eeb2b7e0c5d95" class="i property">InBreakpoint</a>;
                <b>if</b> (<a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<span class="i">ContainsKey</span>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#76c2c2baeca66c2e" class="i field">DebugStopState</a>))
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a><a href="../../serialization.cs.html#ef1aa37a4f65ba77">[</a><a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#76c2c2baeca66c2e" class="i field">DebugStopState</a>] = <span class="r18 r">inBreakpoint</span>;
                }
                <b>else</b>
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<a href="../../serialization.cs.html#ae1dcc27af8941d0" class="i method">Add</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#76c2c2baeca66c2e" class="i field">DebugStopState</a>, <span class="r18 r">inBreakpoint</span>);
                }
 
                <span class="c">// Current debug breakpoint count.</span>
                <b>int</b> <span id="r19 rd" class="r19 r">breakpointCount</span> = <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#daa87d41d976afc8" class="i method">GetBreakpointCount</a>();
                <b>if</b> (<a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<span class="i">ContainsKey</span>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#31fa1e5da6bfb371" class="i field">DebugBreakpointCount</a>))
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a><a href="../../serialization.cs.html#ef1aa37a4f65ba77">[</a><a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#31fa1e5da6bfb371" class="i field">DebugBreakpointCount</a>] = <span class="r19 r">breakpointCount</span>;
                }
                <b>else</b>
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<a href="../../serialization.cs.html#8bd61569911c5a84" class="i method">Add</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#31fa1e5da6bfb371" class="i field">DebugBreakpointCount</a>, <span class="r19 r">breakpointCount</span>);
                }
 
                <span class="c">// Current debugger BreakAll option setting.</span>
                <b>bool</b> <span id="r20 rd" class="r20 r">breakAll</span> = <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#103705e9ed88fa16" class="i property">IsDebuggerSteppingEnabled</a>;
                <b>if</b> (<a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<span class="i">ContainsKey</span>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#95446cab5697e706" class="i field">BreakAllSetting</a>))
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a><a href="../../serialization.cs.html#ef1aa37a4f65ba77">[</a><a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#95446cab5697e706" class="i field">BreakAllSetting</a>] = <span class="r20 r">breakAll</span>;
                }
                <b>else</b>
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<a href="../../serialization.cs.html#ae1dcc27af8941d0" class="i method">Add</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#95446cab5697e706" class="i field">BreakAllSetting</a>, <span class="r20 r">breakAll</span>);
                }
 
                <span class="c">// Current debugger PreserveUnhandledBreakpoints setting.</span>
                <a href="../../debugger/debugger.cs.html#b3fa2b471807788d" class="t t">UnhandledBreakpointProcessingMode</a> <span id="r21 rd" class="r21 r">bpMode</span> = <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#e19d4ce806846ef8" class="i property">UnhandledBreakpointMode</a>;
                <b>if</b> (<a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<span class="i">ContainsKey</span>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#2d5564777b060192" class="i field">UnhandledBreakpointModeSetting</a>))
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a><a href="../../serialization.cs.html#ef1aa37a4f65ba77">[</a><a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#2d5564777b060192" class="i field">UnhandledBreakpointModeSetting</a>] = (<b>int</b>)<span class="r21 r">bpMode</span>;
                }
                <b>else</b>
                {
                    <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>.<a href="../../serialization.cs.html#8bd61569911c5a84" class="i method">Add</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#2d5564777b060192" class="i field">UnhandledBreakpointModeSetting</a>, (<b>int</b>)<span class="r21 r">bpMode</span>);
                }
            }
 
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#6fccfbc477a8007e" class="i method">SendApplicationPrivateDataToClient</a>(<a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a>, <a href="#32ce733721db5ecb" class="i field">_serverCapability</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dispose the runspace pool driver and release all its resources.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="610231f03882fa7f" href="../../../R/610231f03882fa7f.html" target="n" data-glyph="74,1" class="i method">Close</a>()
        {
            <b>if</b> (!<a href="#0640cfbab71fb3fe" class="i field">_isClosed</a>)
            {
                <a href="#0640cfbab71fb3fe" class="i field">_isClosed</a> = <b>true</b>;
 
                <b>if</b> ((<a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a> != <b>null</b>) &amp;&amp; (<a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#8bbe1942c514c66e" class="i property">IsRunspacePushed</a>))
                {
                    <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r22 rd" class="r22 r">runspaceToDispose</span> = <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#93e694613df6a4a0" class="i property">PushedRunspace</a>;
                    <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#4bfdbda58ed475b7" class="i method">PopRunspace</a>();
                    <b>if</b> (<span class="r22 r">runspaceToDispose</span> != <b>null</b>)
                    {
                        <span class="r22 r">runspaceToDispose</span>.<a href="../../hostifaces/Connection.cs.html#47cd985e55a9f99c" class="i method">Dispose</a>();
                    }
                }
 
                <a href="#7d2a263867232a70" class="i method">DisposeRemoteDebugger</a>();
 
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#1689eedd988353b0" class="i method">Close</a>();
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#e81fb7a9266008ab" class="i">StateChanged</a> -= <span class="i">HandleRunspacePoolStateChanged</span>;
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#12b18eb6ea299c91" class="i">ForwardEvent</a> -= <span class="i">HandleRunspacePoolForwardEvent</span>;
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#3db8df3e6fc80b2b" class="i method">Dispose</a>();
                <a href="#02717dc375abd3bb" class="i property">RunspacePool</a> = <b>null</b>;
 
                <b>if</b> (<a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a> != <b>null</b>)
                {
                    <a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a>.<a href="../../hostifaces/Connection.cs.html#e7b6aa3b7b07847b" class="i method">Close</a>();
                    <a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a>.<a href="../../hostifaces/Connection.cs.html#47cd985e55a9f99c" class="i method">Dispose</a>();
                    <a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a> = <b>null</b>;
                }
 
                <a href="#e53bfede6ec58c5e" class="i field">Closed</a>.<span class="i">SafeInvoke</span>(<a href="#a13c57c874abb0c5" class="k">this</a>, <span class="i">EventArgs</span>.<span class="i">Empty</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal Methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IRSPDriverInvoke interface methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method blocks the current thread execution and starts a</span>
        <span class="c">///</span><span class="c"> new Invoker pump that will handle invoking client side nested commands.</span>
        <span class="c">///</span><span class="c"> This method returns after ExitNestedPipeline is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="21ff597576dda497" href="../../../R/21ff597576dda497.html" target="n" data-glyph="72,1" class="i method">EnterNestedPipeline</a>()
        {
            <b>if</b> (<a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="t">PSNotSupportedException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">NestedPipelineNotSupported</span>);
            }
 
            <a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a>.<a href="#174c24858bbae921" class="i method">PushInvoker</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes current nested command Invoker pump and allows parent command</span>
        <span class="c">///</span><span class="c"> to continue running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="84ef49edfe9bef62" href="../../../R/84ef49edfe9bef62.html" target="n" data-glyph="72,1" class="i method">ExitNestedPipeline</a>()
        {
            <b>if</b> (<a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="t">PSNotSupportedException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">NestedPipelineNotSupported</span>);
            }
 
            <a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a>.<a href="#46fae0a4afbada28" class="i method">PopInvoker</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If script execution is currently in debugger stopped mode, this will</span>
        <span class="c">///</span><span class="c"> release the debugger and terminate script execution, or if processing</span>
        <span class="c">///</span><span class="c"> a debug command will stop the debug command.</span>
        <span class="c">///</span><span class="c"> This is used to implement the remote stop signal and ensures a command</span>
        <span class="c">///</span><span class="c"> will stop even when in debug stop mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="dcccbc73ffa245c9" href="../../../R/dcccbc73ffa245c9.html" target="n" data-glyph="72,1" class="i method">HandleStopSignal</a>()
        {
            <b>if</b> (<a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> != <b>null</b>)
            {
                <b>return</b> <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#529b18299d83faa1" class="i method">HandleStopSignal</a>();
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceCreated eventhandler. This is used to set TypeTable for TransportManager.</span>
        <span class="c">///</span><span class="c"> TransportManager needs TypeTable for Serializing/Deserializing objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">args</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="9db857b901ec6bd8" href="../../../R/9db857b901ec6bd8.html" target="n" data-glyph="76,1" class="i method">HandleRunspaceCreatedForTypeTable</a>(<b>object</b> <span id="r23 rd" class="r23 r">sender</span>, <a href="../../hostifaces/RunspacePool.cs.html#63e95a292a76e722" class="t t">RunspaceCreatedEventArgs</a> <span id="r24 rd" class="r24 r">args</span>)
        {
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#e84d23a4699638c5" class="i property">TypeTable</a> = <span class="r24 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#e05f19c7ccf4ea74" class="i property">TypeTable</a>;
            <a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a> = <span class="r24 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>;
 
            <a href="#833fde48cd28916e" class="i method">SetupRemoteDebugger</a>(<a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#f844c62b2f4d0502" class="i field">_configurationName</a>))
            {
                <span class="c">// Client is requesting a configured session.</span>
                <span class="c">// Create a configured remote runspace and push onto host stack.</span>
                <b>if</b> ((<a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a> != <b>null</b>) &amp;&amp; !(<a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#8bbe1942c514c66e" class="i property">IsRunspacePushed</a>))
                {
                    <span class="c">// Let exceptions propagate.</span>
                    <a href="../client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r25 rd" class="r25 r">remoteRunspace</span> = <a href="../../hostifaces/HostUtilities.cs.html#38cb736539b5d994" class="t t">HostUtilities</a>.<a href="../../hostifaces/HostUtilities.cs.html#7ef420994d57cfdc" class="i method">CreateConfiguredRunspace</a>(<a href="#f844c62b2f4d0502" class="i field">_configurationName</a>, <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>);
                    <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#854baaba2ef8914a" class="i property">PropagatePop</a> = <b>true</b>;
                    <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#62e50bac6513bdc9" class="i method">PushRunspace</a>(<span class="r25 r">remoteRunspace</span>);
                }
            }
        }
 
        <b>private void</b> <a id="833fde48cd28916e" href="../../../R/833fde48cd28916e.html" target="n" data-glyph="76,1" class="i method">SetupRemoteDebugger</a>(<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r26 rd" class="r26 r">runspace</span>)
        {
            <a href="../../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r27 rd" class="r27 r">cmdletInfo</span> = <span class="r26 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="../../SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="../../MshCmdlet.cs.html#f14de699060a0394" class="i method">GetCmdlet</a>(<a href="#659f74f76b5af7db" class="t t">ServerRemoteDebugger</a>.<a href="#568f5c2973faeac4" class="i field">SetPSBreakCommandText</a>);
            <b>if</b> (<span class="r27 r">cmdletInfo</span> == <b>null</b>)
            {
                <b>if</b> ((<span class="r26 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> != <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>) &amp;&amp;
                    (!<span class="r26 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#7a174c9b85c175bf" class="i property">UseFullLanguageModeInDebugger</a>))
                {
                    <b>return</b>;
                }
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r27 r">cmdletInfo</span>.<a href="../../CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> != <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>)
                {
                    <b>return</b>;
                }
            }
 
            <span class="c">// Remote debugger is created only when client version is PSVersion (4.0)</span>
            <span class="c">// or greater, and remote session supports debugging.</span>
            <b>if</b> ((<a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a> != <b>null</b>) &amp;&amp;
                (<a href="#4916cfd61743e47c" class="i field">_clientPSVersion</a> != <b>null</b> &amp;&amp; <a href="#4916cfd61743e47c" class="i field">_clientPSVersion</a> &gt;= <a href="../../PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="../../PSVersionInfo.cs.html#348dbcd31d88b8f0" class="i property">PSV4Version</a>) &amp;&amp;
                (<span class="r26 r">runspace</span> != <b>null</b> &amp;&amp; <span class="r26 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#d6610640d00b19f5" class="i property">Debugger</a> != <b>null</b>))
            {
                <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> = <b>new</b> <a href="#43f7b894c00e7b5e" class="t constructor">ServerRemoteDebugger</a>(<a href="#a13c57c874abb0c5" class="k">this</a>, <span class="r26 r">runspace</span>, <span class="r26 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#d6610640d00b19f5" class="i property">Debugger</a>);
                <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#47c9fb23cb0613c9" class="i property">ServerDebugger</a> = <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>;
            }
        }
 
        <b>private void</b> <a id="7d2a263867232a70" href="../../../R/7d2a263867232a70.html" target="n" data-glyph="76,1" class="i method">DisposeRemoteDebugger</a>()
        {
            <b>if</b> (<a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> != <b>null</b>)
            {
                <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#58c557c973139d5d" class="i method">Dispose</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invokes a script.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">cmdToRun</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">args</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="7e6516038ad98b69" href="../../../R/7e6516038ad98b69.html" target="n" data-glyph="76,1" class="i method">InvokeScript</a>(<a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r28 rd" class="r28 r">cmdToRun</span>, <a href="../../hostifaces/RunspacePool.cs.html#63e95a292a76e722" class="t t">RunspaceCreatedEventArgs</a> <span id="r29 rd" class="r29 r">args</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r28 r">cmdToRun</span> != <b>null</b>, <span class="s">&quot;cmdToRun shouldn&#39;t be null&quot;</span>);
 
            <span class="c">// Don&#39;t invoke initialization script as trusted (CommandOrigin == Internal) if the system is in lock down mode.</span>
            <span class="r28 r">cmdToRun</span>.<a href="../../hostifaces/Command.cs.html#73389144dc40bfb1" class="i property">CommandOrigin</a> = (<a href="../../../security/wldpNativeMethods.cs.html#6b51558a7a8cde26" class="t t">SystemPolicy</a>.<a href="../../../security/wldpNativeMethods.cs.html#2c0da8883146dab2" class="i method">GetSystemLockdownPolicy</a>() == <a href="../../../security/wldpNativeMethods.cs.html#9f0915f7b351778e" class="t t">SystemEnforcementMode</a>.<a href="../../../security/wldpNativeMethods.cs.html#5d74206001d0b817" class="i field">Enforce</a>) ? <a href="../../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../../SecurityManagerBase.cs.html#66a89eb31c003ba5" class="i field">Runspace</a> : <a href="../../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>;
 
            <span class="r28 r">cmdToRun</span>.<a href="../../hostifaces/Command.cs.html#1d4f6e54a09e8991" class="i method">MergeMyResults</a>(<a href="../../hostifaces/Command.cs.html#b4c8a564cfb76454" class="t t">PipelineResultTypes</a>.<a href="../../hostifaces/Command.cs.html#4934ee6f6f8db020" class="i field">Error</a>, <a href="../../hostifaces/Command.cs.html#b4c8a564cfb76454" class="t t">PipelineResultTypes</a>.<a href="../../hostifaces/Command.cs.html#c8d2233323d43e84" class="i field">Output</a>);
            <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r30 rd" class="r30 r">powershell</span> = <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../../hostifaces/PowerShell.cs.html#40345bc4625ff918" class="i method">Create</a>();
            <span class="r30 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#f68f5b3ba7949aa4" class="i method">AddCommand</a>(<span class="r28 r">cmdToRun</span>).<a href="../../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;out-default&quot;</span>);
 
            <b>return</b> <a href="#be265fd9570df5ea" class="i method">InvokePowerShell</a>(<span class="r30 r">powershell</span>, <span class="r29 r">args</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invokes a PowerShell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">powershell</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">args</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="be265fd9570df5ea" href="../../../R/be265fd9570df5ea.html" target="n" data-glyph="76,1" class="i method">InvokePowerShell</a>(<a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r31 rd" class="r31 r">powershell</span>, <a href="../../hostifaces/RunspacePool.cs.html#63e95a292a76e722" class="t t">RunspaceCreatedEventArgs</a> <span id="r32 rd" class="r32 r">args</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<span class="r31 r">powershell</span> != <b>null</b>, <span class="s">&quot;powershell shouldn&#39;t be null&quot;</span>);
 
            <span class="c">// run the startup script on the runspace&#39;s host</span>
            <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#4fc7c4b336de518c" class="t t">HostInfo</a> <span id="r33 rd" class="r33 r">hostInfo</span> = <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#a0dd7cdadaf12138" class="i property">HostInfo</a>;
            <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r34 rd" class="r34 r">driver</span> = <b>new</b> <span class="t">ServerPowerShellDriver</span>(
                <span class="r31 r">powershell</span>,
                <b>null</b>,
                <b>true</b>,
                <span class="i">Guid</span>.<span class="i">Empty</span>,
                <a href="#a13c57c874abb0c5" class="k">this</a>.<a href="#4bfa83b8eb92f06f" class="i property">InstanceId</a>,
                <a href="#a13c57c874abb0c5" class="k">this</a>,
                <span class="r32 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#7483ec8556438ee9" class="i property">ApartmentState</a>,
                <span class="r33 r">hostInfo</span>,
                <a href="../../hostifaces/PowerShell.cs.html#3a466dc47c692c8e" class="t t">RemoteStreamOptions</a>.<a href="../../hostifaces/PowerShell.cs.html#4d6d0ddb7d2d677d" class="i field">AddInvocationInfo</a>,
                <b>false</b>,
                <span class="r32 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>);
 
            <span class="i">IAsyncResult</span> <span id="r35 rd" class="r35 r">asyncResult</span> = <span class="r34 r">driver</span>.<a href="ServerPowerShellDriver.cs.html#a712659a5bf2b683" class="i method">Start</a>();
 
            <span class="c">// if there was an exception running the script..this may throw..this will</span>
            <span class="c">// result in the runspace getting closed/broken.</span>
            <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r36 rd" class="r36 r">results</span> = <span class="r31 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#e6f659e0f52c6eca" class="i method">EndInvoke</a>(<span class="r35 r">asyncResult</span>);
 
            <span class="c">// find out if there are any error records reported. If there is one, report the error..</span>
            <span class="c">// this will result in the runspace getting closed/broken.</span>
            <span class="i">ArrayList</span> <span id="r37 rd" class="r37 r">errorList</span> = (<span class="i">ArrayList</span>)<span class="r31 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#ccf57242c9d46642" class="i property">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#ade98325afa63ad9" class="i property">GetExecutionContext</a>.<a href="../../ExecutionContext.cs.html#9f5bde284d161965" class="i property">DollarErrorVariable</a>;
            <b>if</b> (<span class="r37 r">errorList</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>string</b> <span id="r38 rd" class="r38 r">exceptionThrown</span>;
                <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r39 rd" class="r39 r">lastErrorRecord</span> = <span class="r37 r">errorList</span>[0] <b>as</b> <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>;
                <b>if</b> (<span class="r39 r">lastErrorRecord</span> != <b>null</b>)
                {
                    <span class="r38 r">exceptionThrown</span> = <span class="r39 r">lastErrorRecord</span>.<a href="../../ErrorPackage.cs.html#cab659be098926dd" class="i method">ToString</a>();
                }
                <b>else</b>
                {
                    <span class="i">Exception</span> <span id="r40 rd" class="r40 r">lastException</span> = <span class="r37 r">errorList</span>[0] <b>as</b> <span class="i">Exception</span>;
                    <b>if</b> (<span class="r40 r">lastException</span> != <b>null</b>)
                    {
                        <span class="r38 r">exceptionThrown</span> = <span class="r40 r">lastException</span>.<span class="i">Message</span> ?? <b>string</b>.<span class="i">Empty</span>;
                    }
                    <b>else</b>
                    {
                        <span class="r38 r">exceptionThrown</span> = <b>string</b>.<span class="i">Empty</span>;
                    }
                }
 
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">StartupScriptThrewTerminatingError</span>, <span class="r38 r">exceptionThrown</span>);
            }
 
            <b>return</b> <span class="r36 r">results</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Raised by RunspacePool whenever a new runspace is created. This is used</span>
        <span class="c">///</span><span class="c"> by the driver to run startup script as well as set personal folder</span>
        <span class="c">///</span><span class="c"> as the current working directory.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">args</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Runspace that was created by the RunspacePool.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="f3c433b6d46e32b8" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleRunspaceCreated</a>(<b>object</b> <span id="r41 rd" class="r41 r">sender</span>, <a href="../../hostifaces/RunspacePool.cs.html#63e95a292a76e722" class="t t">RunspaceCreatedEventArgs</a> <span id="r42 rd" class="r42 r">args</span>)
        {
            <a href="#a13c57c874abb0c5" class="k">this</a>.<a href="#4549b5f9b57aa1af" class="i property">ServerRemoteHost</a>.<a href="ServerRemoteHost.cs.html#a181afe04897bdb3" class="i property">Runspace</a> = <span class="r42 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>;
 
            <span class="c">// If the system lockdown policy says &quot;Enforce&quot;, do so (unless it&#39;s in the</span>
            <span class="c">// more restrictive NoLanguage mode)</span>
            <a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../../Utils.cs.html#dbcc27a19c6d4943" class="i method">EnforceSystemLockDownLanguageMode</a>(<span class="r42 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>);
 
            <span class="c">// Set the current location to MyDocuments folder for this runspace.</span>
            <span class="c">// This used to be set to the Personal folder but was changed to MyDocuments folder for</span>
            <span class="c">// compatibility with PowerShell on Nano Server for PowerShell V5.</span>
            <span class="c">// This is needed because in the remoting scenario, Environment.CurrentDirectory</span>
            <span class="c">// always points to System Folder (%windir%\system32) irrespective of the</span>
            <span class="c">// user as %HOMEDRIVE% and %HOMEPATH% are not available for the logon process.</span>
            <span class="c">// Doing this here than AutomationEngine as I dont want to introduce a dependency</span>
            <span class="c">// on Remoting in PowerShell engine</span>
            <b>try</b>
            {
                <b>string</b> <span id="r43 rd" class="r43 r">personalfolder</span> = <a href="../../../CoreCLR/CorePsPlatform.cs.html#693813241122eb45" class="t t">Platform</a>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">MyDocuments</span>);
                <span class="r42 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateLocationAPIs.cs.html#835b1a1f702b8a81" class="i method">SetLocation</a>(<span class="r43 r">personalfolder</span>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// SetLocation API can call 3rd party code and so there is no telling what exception may be thrown.</span>
                <span class="c">// Setting location is not critical and is expected not to work with some account types, so we want</span>
                <span class="c">// to ignore all but critical errors.</span>
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<a href="#4d7ffc9dc7b5a4cd" class="i field">_initialLocation</a>))
            {
                <a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="k">var</a> <span id="r44 rd" class="r44 r">setLocationCommand</span> = <b>new</b> <a href="../../hostifaces/Command.cs.html#6c075592cf04e686" class="t constructor">Command</a>(<span class="s">&quot;Set-Location&quot;</span>);
                <span class="r44 r">setLocationCommand</span>.<a href="../../hostifaces/Command.cs.html#ba1074ca05aadff5" class="i property">Parameters</a>.<span class="i">Add</span>(<b>new</b> <a href="../../hostifaces/Parameter.cs.html#2cdbc5f4adc8e89b" class="t constructor">CommandParameter</a>(<span class="s">&quot;LiteralPath&quot;</span>, <a href="#4d7ffc9dc7b5a4cd" class="i field">_initialLocation</a>));
                <a href="#7e6516038ad98b69" class="i method">InvokeScript</a>(<span class="r44 r">setLocationCommand</span>, <span class="r42 r">args</span>);
            }
 
            <span class="c">// Run startup scripts</span>
            <a href="#3e1c329b95e6529c" class="i method">InvokeStartupScripts</a>(<span class="r42 r">args</span>);
 
            <span class="c">// Now that the server side runspace is set up allow the secondary handler to run.</span>
            <a href="#9db857b901ec6bd8" class="i method">HandleRunspaceCreatedForTypeTable</a>(<span class="r41 r">sender</span>, <span class="r42 r">args</span>);
        }
 
        <b>private void</b> <a id="3e1c329b95e6529c" href="../../../R/3e1c329b95e6529c.html" target="n" data-glyph="76,1" class="i method">InvokeStartupScripts</a>(<a href="../../hostifaces/RunspacePool.cs.html#63e95a292a76e722" class="t t">RunspaceCreatedEventArgs</a> <span id="r45 rd" class="r45 r">args</span>)
        {
            <a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r46 rd" class="r46 r">cmdToRun</span> = <b>null</b>;
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#898d33ebebcf0ca0" class="i field">_configData</a>.<a href="../fanin/InitialSessionStateProvider.cs.html#a7bf3717cdc232b3" class="i field">StartupScript</a>))
            {
                <span class="c">// build the startup script..merge output / error.</span>
                <span class="r46 r">cmdToRun</span> = <b>new</b> <a href="../../hostifaces/Command.cs.html#7daa1db0ede574c4" class="t constructor">Command</a>(<a href="#898d33ebebcf0ca0" class="i field">_configData</a>.<a href="../fanin/InitialSessionStateProvider.cs.html#a7bf3717cdc232b3" class="i field">StartupScript</a>, <b>false</b>, <b>false</b>);
            }
            <b>else</b> <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#898d33ebebcf0ca0" class="i field">_configData</a>.<a href="../fanin/InitialSessionStateProvider.cs.html#7e90765aaa5c5332" class="i field">InitializationScriptForOutOfProcessRunspace</a>))
            {
                <span class="r46 r">cmdToRun</span> = <b>new</b> <a href="../../hostifaces/Command.cs.html#7daa1db0ede574c4" class="t constructor">Command</a>(<a href="#898d33ebebcf0ca0" class="i field">_configData</a>.<a href="../fanin/InitialSessionStateProvider.cs.html#7e90765aaa5c5332" class="i field">InitializationScriptForOutOfProcessRunspace</a>, <b>true</b>, <b>false</b>);
            }
 
            <b>if</b> (<span class="r46 r">cmdToRun</span> != <b>null</b>)
            {
                <a href="#7e6516038ad98b69" class="i method">InvokeScript</a>(<span class="r46 r">cmdToRun</span>, <span class="r45 r">args</span>);
 
                <span class="c">// if startup script set $PSApplicationPrivateData, then use that value as ApplicationPrivateData</span>
                <span class="c">// instead of using results from PSSessionConfiguration.GetApplicationPrivateData()</span>
                <b>if</b> (<a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#a7f9e215f0cbb1ce" class="i property">RunspacePoolStateInfo</a>.<a href="../common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a> == <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../../hostifaces/RunspacePool.cs.html#3403f57e932b5ec3" class="i field">Opening</a>)
                {
                    <b>object</b> <span id="r47 rd" class="r47 r">privateDataVariable</span> = <span class="r45 r">args</span>.<a href="../../hostifaces/RunspacePool.cs.html#5a5c34cb0339fb34" class="i property">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#c43f0c90447752e8" class="i property">SessionStateProxy</a>.<a href="../../hostifaces/Connection.cs.html#b5bceaae9ec5aba0" class="i property">PSVariable</a>.<a href="../../VariableInterfaces.cs.html#20b9dd22f81d2a1c" class="i method">GetValue</a>(<span class="s">&quot;global:PSApplicationPrivateData&quot;</span>);
                    <b>if</b> (<span class="r47 r">privateDataVariable</span> != <b>null</b>)
                    {
                        <a href="#e8fec38b1ef85728" class="i field">_applicationPrivateData</a> = (<a href="../../serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a>)<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                            <span class="r47 r">privateDataVariable</span>,
                            <b>typeof</b>(<a href="../../serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a>),
                            <b>true</b>,
                            <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                            <b>null</b>);
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler to the runspace pool state changed events.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this events.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">arguments which describe the</span>
        <span class="c">///</span><span class="c"> RunspacePool&#39;s StateChanged event</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="abcf6644e72bfd81" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleRunspacePoolStateChanged</a>(<b>object</b> <span id="r48 rd" class="r48 r">sender</span>,
                            <a href="../../hostifaces/RunspacePool.cs.html#ff0d60fc9c4fde6c" class="t t">RunspacePoolStateChangedEventArgs</a> <span id="r49 rd" class="r49 r">eventArgs</span>)
        {
            <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a> <span id="r50 rd" class="r50 r">state</span> = <span class="r49 r">eventArgs</span>.<a href="../../hostifaces/RunspacePool.cs.html#5c91747fcd8ee469" class="i property">RunspacePoolStateInfo</a>.<a href="../common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a>;
            <span class="i">Exception</span> <span id="r51 rd" class="r51 r">reason</span> = <span class="r49 r">eventArgs</span>.<a href="../../hostifaces/RunspacePool.cs.html#5c91747fcd8ee469" class="i property">RunspacePoolStateInfo</a>.<a href="../common/RunspacePoolStateInfo.cs.html#dcad0aee1f0be83d" class="i property">Reason</a>;
 
            <b>switch</b> (<span class="r50 r">state</span>)
            {
                <b>case</b> <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../../hostifaces/RunspacePool.cs.html#48a121178c7c288f" class="i field">Broken</a>:
                <b>case</b> <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../../hostifaces/RunspacePool.cs.html#2b6027539b9d1816" class="i field">Closing</a>:
                <b>case</b> <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../../hostifaces/RunspacePool.cs.html#494904731e18b593" class="i field">Closed</a>:
                    {
                        <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#31f21b7dd4e21b61" class="i method">SendStateInfoToClient</a>(<b>new</b> <a href="../common/RunspacePoolStateInfo.cs.html#c7dae263df1aded0" class="t constructor">RunspacePoolStateInfo</a>(<span class="r50 r">state</span>, <span class="r51 r">reason</span>));
                    }
 
                    <b>break</b>;
 
                <b>case</b> <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../../hostifaces/RunspacePool.cs.html#13cbf83371c004e0" class="i field">Opened</a>:
                    {
                        <a href="#571695c450993617" class="i method">SendApplicationPrivateDataToClient</a>();
                        <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#31f21b7dd4e21b61" class="i method">SendStateInfoToClient</a>(<b>new</b> <a href="../common/RunspacePoolStateInfo.cs.html#c7dae263df1aded0" class="t constructor">RunspacePoolStateInfo</a>(<span class="r50 r">state</span>, <span class="r51 r">reason</span>));
                    }
 
                    <b>break</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler to the runspace pool psevents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="75ab75946078f825" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleRunspacePoolForwardEvent</a>(<b>object</b> <span id="r52 rd" class="r52 r">sender</span>, <a href="../../EventManager.cs.html#7210411b2f4a8407" class="t t">PSEventArgs</a> <span id="r53 rd" class="r53 r">e</span>)
        {
            <b>if</b> (<span class="r53 r">e</span>.<a href="../../EventManager.cs.html#d46e9434510d399e" class="i property">ForwardEvent</a>)
            {
                <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#debf8979c9406af0" class="i method">SendPSEventArgsToClient</a>(<span class="r53 r">e</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handle the invocation of powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">_</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing this event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="38cb4ecd63930dde" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleCreateAndInvokePowerShell</a>(<b>object</b> <span id="r54 rd" class="r54 r">_</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemotingDataObject.cs.html#ca4629603c976aab" class="t t">RemoteDataObject</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <span id="r55 rd" class="r55 r">eventArgs</span>)
        {
            <a href="../common/WireDataFormat/RemotingDataObject.cs.html#ca4629603c976aab" class="t t">RemoteDataObject</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r56 rd" class="r56 r">data</span> = <span class="r55 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
 
            <span class="c">// it is sufficient to just construct the powershell</span>
            <span class="c">// driver, the local powershell on server side is</span>
            <span class="c">// invoked from within the driver</span>
            <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#4fc7c4b336de518c" class="t t">HostInfo</a> <span id="r57 rd" class="r57 r">hostInfo</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#930a3e874da40152" class="i method">GetHostInfo</a>(<span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
 
            <span class="i">ApartmentState</span> <span id="r58 rd" class="r58 r">apartmentState</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#c6e3f1b322a08163" class="i method">GetApartmentState</a>(<span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
 
            <a href="../../hostifaces/PowerShell.cs.html#3a466dc47c692c8e" class="t t">RemoteStreamOptions</a> <span id="r59 rd" class="r59 r">streamOptions</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#15573fad77d72377" class="i method">GetRemoteStreamOptions</a>(<span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
            <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r60 rd" class="r60 r">powershell</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#16573ea7d7071ccb" class="i method">GetPowerShell</a>(<span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
            <b>bool</b> <span id="r61 rd" class="r61 r">noInput</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#de44bed8c407ba2a" class="i method">GetNoInput</a>(<span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
            <b>bool</b> <span id="r62 rd" class="r62 r">addToHistory</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#f943310df99606a9" class="i method">GetAddToHistory</a>(<span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
            <b>bool</b> <span id="r63 rd" class="r63 r">isNested</span> = <b>false</b>;
 
            <span class="c">// The server would&#39;ve dropped the protocol version of an older client was connecting</span>
            <b>if</b> (<a href="#32ce733721db5ecb" class="i field">_serverCapability</a>.<a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#e0172342f9aadac0" class="i property">ProtocolVersion</a> &gt;= <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#fd42c50dee2d8244" class="i field">ProtocolVersionWin8RTM</a>)
            {
                <span class="r63 r">isNested</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#67c6c2848047f6cb" class="i method">GetIsNested</a>(<span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
            }
 
            <span class="c">// Perform pre-processing of command for over the wire debugging commands.</span>
            <b>if</b> (<a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> != <b>null</b>)
            {
                <a href="#5e7a879cd14ffc46" class="t t">DebuggerCommandArgument</a> <span id="r64 rd" class="r64 r">commandArgument</span>;
                <b>bool</b> <span id="r65 rd" class="r65 r">terminateImmediate</span> = <b>false</b>;
                <span class="i">Collection</span>&lt;<b>object</b>&gt; <span id="r66 rd" class="r66 r">preProcessOutput</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>object</b>&gt;();
 
                <b>try</b>
                {
                    <a href="#f91bdc97bea49ede" class="k">var</a> <span id="r67 rd" class="r67 r">result</span> = <a href="#f4f79331599657e8" class="i method">PreProcessDebuggerCommand</a>(<span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>, <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>, <span class="r66 r">preProcessOutput</span>, <b>out</b> <span class="r64 r">commandArgument</span>);
 
                    <b>switch</b> (<span class="r67 r">result</span>)
                    {
                        <b>case</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#065a90a917c574a5" class="i field">SetDebuggerAction</a>:
                            <span class="c">// Run this directly on the debugger and terminate the remote command.</span>
                            <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<span class="i">SetDebuggerAction</span>(<span class="r64 r">commandArgument</span>.<a href="#7b288ddcb30f56c7" class="i property">ResumeAction</a>.<span class="i">Value</span>);
                            <span class="r65 r">terminateImmediate</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#ca2da481843b0854" class="i field">SetDebugMode</a>:
                            <span class="c">// Set debug mode directly and terminate remote command.</span>
                            <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<span class="i">SetDebugMode</span>(<span class="r64 r">commandArgument</span>.<a href="#644b50168e60cef1" class="i property">Mode</a>.<span class="i">Value</span>);
                            <span class="r65 r">terminateImmediate</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#fff7bb29e42382c7" class="i field">SetDebuggerStepMode</a>:
                            <span class="c">// Enable debugger and set to step action, then terminate remote command.</span>
                            <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<span class="i">SetDebuggerStepMode</span>(<span class="r64 r">commandArgument</span>.<a href="#064ad77b89da4b95" class="i property">DebuggerStepEnabled</a>.<span class="i">Value</span>);
                            <span class="r65 r">terminateImmediate</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#2f15e49fc0f0bece" class="i field">SetPreserveUnhandledBreakpointMode</a>:
                            <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#e19d4ce806846ef8" class="i property">UnhandledBreakpointMode</a> = <span class="r64 r">commandArgument</span>.<a href="#44343435cc7b3e20" class="i property">UnhandledBreakpointMode</a>.<span class="i">Value</span>;
                            <span class="r65 r">terminateImmediate</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#33133eac8e3be7db" class="i field">ValidNotProcessed</a>:
                            <span class="r65 r">terminateImmediate</span> = <b>true</b>;
                            <b>break</b>;
 
                        <b>case</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#85dbb0400eecc5dd" class="i field">BreakpointManagement</a>:
                            <span class="r65 r">terminateImmediate</span> = <b>true</b>;
                            <b>break</b>;
                    }
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r68 rd" class="r68 r">ex</span>)
                {
                    <span class="r65 r">terminateImmediate</span> = <b>true</b>;
 
                    <span class="r66 r">preProcessOutput</span>.<span class="i">Add</span>(
                        <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<span class="i">AsPSObject</span>(<span class="r68 r">ex</span>));
                }
 
                <span class="c">// If we don&#39;t want to run or queue a command to run in the server session then</span>
                <span class="c">// terminate the command here by making it a No Op.</span>
                <b>if</b> (<span class="r65 r">terminateImmediate</span>)
                {
                    <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r69 rd" class="r69 r">noOpDriver</span> = <b>new</b> <a href="ServerPowerShellDriver.cs.html#d30703a851584f60" class="t constructor">ServerPowerShellDriver</a>(
                        <span class="r60 r">powershell</span>,
                        <b>null</b>,
                        <span class="r61 r">noInput</span>,
                        <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                        <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                        <a href="#a13c57c874abb0c5" class="k">this</a>,
                        <span class="r58 r">apartmentState</span>,
                        <span class="r57 r">hostInfo</span>,
                        <span class="r59 r">streamOptions</span>,
                        <span class="r62 r">addToHistory</span>,
                        <b>null</b>);
 
                    <span class="r69 r">noOpDriver</span>.<span class="i">RunNoOpCommand</span>(<span class="r66 r">preProcessOutput</span>);
                    <b>return</b>;
                }
            }
 
            <b>if</b> (<a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#8bbe1942c514c66e" class="i property">IsRunspacePushed</a>)
            {
                <span class="c">// If we have a pushed runspace then execute there.</span>
                <span class="c">// Ensure debugger is enabled to the original mode it was set to.</span>
                <b>if</b> (<a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> != <b>null</b>)
                {
                    <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#9df35e992ceafa8d" class="i method">CheckDebuggerState</a>();
                }
 
                <a href="#43c31c9996d06d09" class="i method">StartPowerShellCommandOnPushedRunspace</a>(
                    <span class="r60 r">powershell</span>,
                    <b>null</b>,
                    <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                    <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                    <span class="r57 r">hostInfo</span>,
                    <span class="r59 r">streamOptions</span>,
                    <span class="r61 r">noInput</span>,
                    <span class="r62 r">addToHistory</span>);
 
                <b>return</b>;
            }
            <b>else</b> <b>if</b> (<span class="r63 r">isNested</span>)
            {
                <b>if</b> (<a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#849db6668a9907c9" class="i method">GetMaxRunspaces</a>() == 1)
                {
                    <b>if</b> (<a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a> != <b>null</b> &amp;&amp; <a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a>.<a href="#67927ed865d143e1" class="i property">IsActive</a>)
                    {
                        <b>if</b> (!<a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a>.<a href="#c2a97d3a5f8b1195" class="i property">IsAvailable</a>)
                        {
                            <span class="c">// A nested command is already running.</span>
                            <b>throw</b> <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(
                                <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">CannotInvokeNestedCommandNestedCommandRunning</span>));
                        }
 
                        <span class="c">// Handle as nested pipeline invocation.</span>
                        <span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#ca9abcd81cc054f5" class="i method">SetIsNested</a>(<b>true</b>);
 
                        <span class="c">// Always invoke PowerShell commands on pipeline worker thread</span>
                        <span class="c">// for single runspace case, to support nested invocation requests (debugging scenario).</span>
                        <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r70 rd" class="r70 r">srdriver</span> = <b>new</b> <a href="ServerPowerShellDriver.cs.html#d30703a851584f60" class="t constructor">ServerPowerShellDriver</a>(
                            <span class="r60 r">powershell</span>,
                            <b>null</b>,
                            <span class="r61 r">noInput</span>,
                            <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                            <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                            <a href="#a13c57c874abb0c5" class="k">this</a>,
                            <span class="r58 r">apartmentState</span>,
                            <span class="r57 r">hostInfo</span>,
                            <span class="r59 r">streamOptions</span>,
                            <span class="r62 r">addToHistory</span>,
                            <a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a>);
 
                        <a href="#8561034009021897" class="i field">_inputCollection</a> = <span class="r70 r">srdriver</span>.<a href="ServerPowerShellDriver.cs.html#19184dbef75d3bcb" class="i property">InputCollection</a>;
                        <a href="#41dab6a3fd8a67df" class="i field">_driverNestedInvoker</a>.<a href="#300d22438eda9f1f" class="i method">InvokeDriverAsync</a>(<span class="r70 r">srdriver</span>);
                        <b>return</b>;
                    }
                    <b>else</b> <b>if</b> (<a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> != <b>null</b> &amp;&amp;
                             <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#d42eeb2b7e0c5d95" class="i property">InBreakpoint</a> &amp;&amp;
                             <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#467c52bb0a6d6c00" class="i property">IsPushed</a>)
                    {
                        <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#704bf689056c2249" class="i method">StartPowerShellCommand</a>(
                            <span class="r60 r">powershell</span>,
                            <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                            <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                            <a href="#a13c57c874abb0c5" class="k">this</a>,
                            <span class="r58 r">apartmentState</span>,
                            <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>,
                            <span class="r57 r">hostInfo</span>,
                            <span class="r59 r">streamOptions</span>,
                            <span class="r62 r">addToHistory</span>);
 
                        <b>return</b>;
                    }
                    <b>else</b> <b>if</b> (<span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 1 &amp;&amp;
                             !<span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">IsScript</span> &amp;&amp;
                             (<span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">CommandText</span>.<span class="i">Contains</span>(<span class="s">&quot;Get-PSDebuggerStopArgs&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                              <span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">CommandText</span>.<span class="i">Contains</span>(<span class="s">&quot;Set-PSDebuggerAction&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                    {
                        <span class="c">// We do not want to invoke debugger commands in the steppable pipeline.</span>
                        <span class="c">// Consider adding IsSteppable message to PSRP to handle this.</span>
                        <span class="c">// This will be caught on the client.</span>
                        <b>throw</b> <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#901b411ac57457e6" class="t constructor">PSInvalidOperationException</a>();
                    }
 
                    <a href="ServerRemotingProtocol2.cs.html#21dc790594e0a9f8" class="t t">ServerPowerShellDataStructureHandler</a> <span id="r71 rd" class="r71 r">psHandler</span> = <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#236558dce2cfa090" class="i method">GetPowerShellDataStructureHandler</a>();
                    <b>if</b> (<span class="r71 r">psHandler</span> != <b>null</b>)
                    {
                        <span class="c">// Have steppable invocation request.</span>
                        <span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#ca9abcd81cc054f5" class="i method">SetIsNested</a>(<b>false</b>);
                        <span class="c">// Execute command concurrently</span>
                        <a href="ServerSteppablePipelineDriver.cs.html#44f68fc925ad7af2" class="t t">ServerSteppablePipelineDriver</a> <span id="r72 rd" class="r72 r">spDriver</span> = <b>new</b> <a href="ServerSteppablePipelineDriver.cs.html#34d873e79c72d1a7" class="t constructor">ServerSteppablePipelineDriver</a>(
                            <span class="r60 r">powershell</span>,
                            <span class="r61 r">noInput</span>,
                            <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                            <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                            <a href="#a13c57c874abb0c5" class="k">this</a>,
                            <span class="r58 r">apartmentState</span>,
                            <span class="r57 r">hostInfo</span>,
                            <span class="r59 r">streamOptions</span>,
                            <span class="r62 r">addToHistory</span>,
                            <a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a>,
                            <a href="#905aa642df7f7d8f" class="i field">_eventSubscriber</a>,
                            <a href="#8561034009021897" class="i field">_inputCollection</a>);
 
                        <span class="r72 r">spDriver</span>.<a href="ServerSteppablePipelineDriver.cs.html#15567f44900bdcdc" class="i method">Start</a>();
                        <b>return</b>;
                    }
                }
 
                <span class="c">// Allow command to run as non-nested and non-stepping.</span>
                <span class="r60 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#ca9abcd81cc054f5" class="i method">SetIsNested</a>(<b>false</b>);
            }
 
            <span class="c">// Invoke command normally.  Ensure debugger is enabled to the</span>
            <span class="c">// original mode it was set to.</span>
            <b>if</b> (<a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a> != <b>null</b>)
            {
                <a href="#bf7e26964a89d17a" class="i field">_serverRemoteDebugger</a>.<a href="#9df35e992ceafa8d" class="i method">CheckDebuggerState</a>();
            }
 
            <span class="c">// Invoke PowerShell on driver runspace pool.</span>
            <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r73 rd" class="r73 r">driver</span> = <b>new</b> <a href="ServerPowerShellDriver.cs.html#d30703a851584f60" class="t constructor">ServerPowerShellDriver</a>(
                <span class="r60 r">powershell</span>,
                <b>null</b>,
                <span class="r61 r">noInput</span>,
                <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                <span class="r56 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                <a href="#a13c57c874abb0c5" class="k">this</a>,
                <span class="r58 r">apartmentState</span>,
                <span class="r57 r">hostInfo</span>,
                <span class="r59 r">streamOptions</span>,
                <span class="r62 r">addToHistory</span>,
                <b>null</b>);
 
            <a href="#8561034009021897" class="i field">_inputCollection</a> = <span class="r73 r">driver</span>.<a href="ServerPowerShellDriver.cs.html#19184dbef75d3bcb" class="i property">InputCollection</a>;
            <span class="r73 r">driver</span>.<a href="ServerPowerShellDriver.cs.html#a712659a5bf2b683" class="i method">Start</a>();
        }
 
        <b>private bool</b>? <a id="81e1f2821877a617" href="../../../R/81e1f2821877a617.html" target="n" data-glyph="46,1" class="i field">_initialSessionStateIncludesGetCommandWithListImportedSwitch</a>;
        <b>private readonly object</b> <a id="d24bd780b5d2c237" href="../../../R/d24bd780b5d2c237.html" target="n" data-glyph="46,1" class="i field">_initialSessionStateIncludesGetCommandWithListImportedSwitchLock</a> = <b>new</b> <b>object</b>();
 
        <b>private bool</b> <a id="bd223de2c1ae3abd" href="../../../R/bd223de2c1ae3abd.html" target="n" data-glyph="76,1" class="i method">DoesInitialSessionStateIncludeGetCommandWithListImportedSwitch</a>()
        {
            <b>if</b> (!<a href="#81e1f2821877a617" class="i field">_initialSessionStateIncludesGetCommandWithListImportedSwitch</a>.<span class="i">HasValue</span>)
            {
                <b>lock</b> (<a href="#d24bd780b5d2c237" class="i field">_initialSessionStateIncludesGetCommandWithListImportedSwitchLock</a>)
                {
                    <b>if</b> (!<a href="#81e1f2821877a617" class="i field">_initialSessionStateIncludesGetCommandWithListImportedSwitch</a>.<span class="i">HasValue</span>)
                    {
                        <b>bool</b> <span id="r74 rd" class="r74 r">newValue</span> = <b>false</b>;
 
                        <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r75 rd" class="r75 r">iss</span> = <a href="#a13c57c874abb0c5" class="k">this</a>.<a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#c9015b9ae57c0705" class="i property">InitialSessionState</a>;
                        <b>if</b> (<span class="r75 r">iss</span> != <b>null</b>)
                        {
                            <span class="i">IEnumerable</span>&lt;<a href="../../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a>&gt; <span id="r76 rd" class="r76 r">publicGetCommandEntries</span> = <span class="r75 r">iss</span>
                                .<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a><a href="../../InitialSessionState.cs.html#8a6a2b8d34f0d716">[</a><span class="s">&quot;Get-Command&quot;</span>]
                                .<span class="i">Where</span>(<b>static</b> <span id="r77 rd" class="r77 r">entry</span> =&gt; <span class="r77 r">entry</span>.<span class="i">Visibility</span> == <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>);
                            <a href="../../InitialSessionState.cs.html#24449f380379f027" class="t t">SessionStateFunctionEntry</a> <span id="r78 rd" class="r78 r">getCommandProxy</span> = <span class="r76 r">publicGetCommandEntries</span>.<span class="i">OfType</span>&lt;<a href="../../InitialSessionState.cs.html#24449f380379f027" class="t t">SessionStateFunctionEntry</a>&gt;().<span class="i">FirstOrDefault</span>();
                            <b>if</b> (<span class="r78 r">getCommandProxy</span> != <b>null</b>)
                            {
                                <b>if</b> (<span class="r78 r">getCommandProxy</span>.<a href="../../InitialSessionState.cs.html#76dc29438cc77053" class="i property">ScriptBlock</a>.<a href="../../runtime/CompiledScriptBlock.cs.html#56719d9b47343722" class="i property">ParameterMetadata</a>.<a href="../../MergedCommandParameterMetadata.cs.html#d586f3508cda9bf3" class="i property">BindableParameters</a>.<span class="i">ContainsKey</span>(<span class="s">&quot;ListImported&quot;</span>))
                                {
                                    <span class="r74 r">newValue</span> = <b>true</b>;
                                }
                            }
                            <b>else</b>
                            {
                                <a href="../../InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a> <span id="r79 rd" class="r79 r">getCommandCmdlet</span> = <span class="r76 r">publicGetCommandEntries</span>.<span class="i">OfType</span>&lt;<a href="../../InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a>&gt;().<span class="i">FirstOrDefault</span>();
                                <b>if</b> ((<span class="r79 r">getCommandCmdlet</span> != <b>null</b>) &amp;&amp; (<span class="r79 r">getCommandCmdlet</span>.<a href="../../InitialSessionState.cs.html#41fc8f2889edf406" class="i property">ImplementingType</a>.<span class="i">Equals</span>(<b>typeof</b>(<span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>.<a href="../../GetCommandCommand.cs.html#ff1a9d86cf34497b" class="t t">GetCommandCommand</a>))))
                                {
                                    <span class="r74 r">newValue</span> = <b>true</b>;
                                }
                            }
                        }
 
                        <a href="#81e1f2821877a617" class="i field">_initialSessionStateIncludesGetCommandWithListImportedSwitch</a> = <span class="r74 r">newValue</span>;
                    }
                }
            }
 
            <b>return</b> <a href="#81e1f2821877a617" class="i field">_initialSessionStateIncludesGetCommandWithListImportedSwitch</a>.<span class="i">Value</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handle the invocation of command discovery pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing this event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="45011bd714289426" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleGetCommandMetadata</a>(<b>object</b> <span id="r80 rd" class="r80 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemotingDataObject.cs.html#ca4629603c976aab" class="t t">RemoteDataObject</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <span id="r81 rd" class="r81 r">eventArgs</span>)
        {
            <a href="../common/WireDataFormat/RemotingDataObject.cs.html#ca4629603c976aab" class="t t">RemoteDataObject</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r82 rd" class="r82 r">data</span> = <span class="r81 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
 
            <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r83 rd" class="r83 r">countingPipeline</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#bb3df76869c2da7a" class="i method">GetCommandDiscoveryPipeline</a>(<span class="r82 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
            <b>if</b> (<a href="#a13c57c874abb0c5" class="k">this</a>.<a href="#bd223de2c1ae3abd" class="i method">DoesInitialSessionStateIncludeGetCommandWithListImportedSwitch</a>())
            {
                <span class="r83 r">countingPipeline</span>.<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;ListImported&quot;</span>, <b>true</b>);
            }
 
            <span class="r83 r">countingPipeline</span>
                .<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;ErrorAction&quot;</span>, <span class="s">&quot;SilentlyContinue&quot;</span>)
                .<a href="../../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Measure-Object&quot;</span>)
                .<a href="../../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Select-Object&quot;</span>)
                .<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Property&quot;</span>, <span class="s">&quot;Count&quot;</span>);
 
            <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r84 rd" class="r84 r">mainPipeline</span> = <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#bb3df76869c2da7a" class="i method">GetCommandDiscoveryPipeline</a>(<span class="r82 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#d13e5d3038741f3e" class="i property">Data</a>);
            <b>if</b> (<a href="#a13c57c874abb0c5" class="k">this</a>.<a href="#bd223de2c1ae3abd" class="i method">DoesInitialSessionStateIncludeGetCommandWithListImportedSwitch</a>())
            {
                <span class="r84 r">mainPipeline</span>.<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;ListImported&quot;</span>, <b>true</b>);
            }
 
            <span class="r84 r">mainPipeline</span>
                .<a href="../../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Select-Object&quot;</span>)
                .<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Property&quot;</span>, <b>new</b> <b>string</b>[] {
                    <span class="s">&quot;Name&quot;</span>, <span class="s">&quot;Namespace&quot;</span>, <span class="s">&quot;HelpUri&quot;</span>, <span class="s">&quot;CommandType&quot;</span>, <span class="s">&quot;ResolvedCommandName&quot;</span>, <span class="s">&quot;OutputType&quot;</span>, <span class="s">&quot;Parameters&quot;</span> });
 
            <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#4fc7c4b336de518c" class="t t">HostInfo</a> <span id="r85 rd" class="r85 r">useRunspaceHost</span> = <b>new</b> <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#460b658813cb9516" class="t constructor">HostInfo</a>(<b>null</b>);
            <span class="r85 r">useRunspaceHost</span>.<a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#ccba904c55d54568" class="i property">UseRunspaceHost</a> = <b>true</b>;
 
            <b>if</b> (<a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#8bbe1942c514c66e" class="i property">IsRunspacePushed</a>)
            {
                <span class="c">// If we have a pushed runspace then execute there.</span>
                <a href="#43c31c9996d06d09" class="i method">StartPowerShellCommandOnPushedRunspace</a>(
                    <span class="r83 r">countingPipeline</span>,
                    <span class="r84 r">mainPipeline</span>,
                    <span class="r82 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                    <span class="r82 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                    <span class="r85 r">useRunspaceHost</span>,
                    0,
                    <b>true</b>,
                    <b>false</b>);
            }
            <b>else</b>
            {
                <span class="c">// Run on usual driver.</span>
                <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r86 rd" class="r86 r">driver</span> = <b>new</b> <span class="t">ServerPowerShellDriver</span>(
                    <span class="r83 r">countingPipeline</span>,
                    <span class="r84 r">mainPipeline</span>,
                    <b>true</b> <span class="c">/* no input */</span>,
                    <span class="r82 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#767aea3474afdc8e" class="i property">PowerShellId</a>,
                    <span class="r82 r">data</span>.<a href="../common/WireDataFormat/RemotingDataObject.cs.html#df5fe91d15e5ba71" class="i property">RunspacePoolId</a>,
                    <a href="#a13c57c874abb0c5" class="k">this</a>,
                    <span class="i">ApartmentState</span>.<span class="i">Unknown</span>,
                    <span class="r85 r">useRunspaceHost</span>,
                    0 <span class="c">/* stream options */</span>,
                    <b>false</b> <span class="c">/* addToHistory */</span>,
                    <b>null</b> <span class="c">/* use default rsPool runspace */</span>);
 
                <span class="r86 r">driver</span>.<a href="ServerPowerShellDriver.cs.html#a712659a5bf2b683" class="i method">Start</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handles host responses.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r88 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing this event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="c925e62f48951e01" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleHostResponseReceived</a>(<b>object</b> <span id="r87 rd" class="r87 r">sender</span>,
            <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#2088d050a88e3ac6" class="t t">RemoteHostResponse</a>&gt; <span id="r88 rd" class="r88 r">eventArgs</span>)
        {
            <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#f7e839b2399b6cb0" class="i property">ServerMethodExecutor</a>.<a href="ServerMethodExecutor.cs.html#826b0e13ea0c9e9d" class="i method">HandleRemoteHostResponseFromClient</a>((<span class="r88 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the maximum runspace of the runspace pool and sends a response back.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r89 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r90 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">contains information about the new maxRunspaces</span>
        <span class="c">///</span><span class="c"> and the callId at the client</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="2152478915b69631" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleSetMaxRunspacesReceived</a>(<b>object</b> <span id="r89 rd" class="r89 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r90 rd" class="r90 r">eventArgs</span>)
        {
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r91 rd" class="r91 r">data</span> = <span class="r90 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
            <b>int</b> <span id="r92 rd" class="r92 r">maxRunspaces</span> = (<b>int</b>)((<a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>)<span class="r91 r">data</span>.<a href="../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#07dae46e70021227" class="i field">MaxRunspaces</a>]).<a href="../../MshMemberInfo.cs.html#0426306a39cc419e" class="i property">Value</a>;
            <b>long</b> <span id="r93 rd" class="r93 r">callId</span> = (<b>long</b>)((<a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>)<span class="r91 r">data</span>.<a href="../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>]).<a href="../../MshMemberInfo.cs.html#0426306a39cc419e" class="i property">Value</a>;
 
            <b>bool</b> <span id="r94 rd" class="r94 r">response</span> = <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#59aa86903613d1b5" class="i method">SetMaxRunspaces</a>(<span class="r92 r">maxRunspaces</span>);
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#1706779012404689" class="i method">SendResponseToClient</a>(<span class="r93 r">callId</span>, <span class="r94 r">response</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the minimum runspace of the runspace pool and sends a response back.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">contains information about the new minRunspaces</span>
        <span class="c">///</span><span class="c"> and the callId at the client</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="4aa6e436a88f6758" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleSetMinRunspacesReceived</a>(<b>object</b> <span id="r95 rd" class="r95 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r96 rd" class="r96 r">eventArgs</span>)
        {
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r97 rd" class="r97 r">data</span> = <span class="r96 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
            <b>int</b> <span id="r98 rd" class="r98 r">minRunspaces</span> = (<b>int</b>)((<a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>)<span class="r97 r">data</span>.<a href="../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#3a081a470ad31112" class="i field">MinRunspaces</a>]).<a href="../../MshMemberInfo.cs.html#0426306a39cc419e" class="i property">Value</a>;
            <b>long</b> <span id="r99 rd" class="r99 r">callId</span> = (<b>long</b>)((<a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>)<span class="r97 r">data</span>.<a href="../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>]).<a href="../../MshMemberInfo.cs.html#0426306a39cc419e" class="i property">Value</a>;
 
            <b>bool</b> <span id="r100 rd" class="r100 r">response</span> = <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#04be81c3d890c8f0" class="i method">SetMinRunspaces</a>(<span class="r98 r">minRunspaces</span>);
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#1706779012404689" class="i method">SendResponseToClient</a>(<span class="r99 r">callId</span>, <span class="r100 r">response</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the available runspaces from the server and sends it across</span>
        <span class="c">///</span><span class="c"> to the client.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Contains information on the callid.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="afca90b59e196987" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleGetAvailableRunspacesReceived</a>(<b>object</b> <span id="r101 rd" class="r101 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r102 rd" class="r102 r">eventArgs</span>)
        {
            <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r103 rd" class="r103 r">data</span> = <span class="r102 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
            <b>long</b> <span id="r104 rd" class="r104 r">callId</span> = (<b>long</b>)((<a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>)<span class="r103 r">data</span>.<a href="../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>]).<a href="../../MshMemberInfo.cs.html#0426306a39cc419e" class="i property">Value</a>;
 
            <b>int</b> <span id="r105 rd" class="r105 r">availableRunspaces</span> = <a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ba4d8f784e84916d" class="i method">GetAvailableRunspaces</a>();
 
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#1706779012404689" class="i method">SendResponseToClient</a>(<span class="r104 r">callId</span>, <span class="r105 r">availableRunspaces</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Forces a state reset on a single runspace pool.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="47ae92a4ac866ea9" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleResetRunspaceState</a>(<b>object</b> <span id="r106 rd" class="r106 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r107 rd" class="r107 r">eventArgs</span>)
        {
            <b>long</b> <span id="r108 rd" class="r108 r">callId</span> = (<b>long</b>)((<a href="../../MshMemberInfo.cs.html#964f2480da01a02c" class="t t">PSNoteProperty</a>)(<span class="r107 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>).<a href="../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><a href="../common/WireDataFormat/EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>]).<a href="../../MshMemberInfo.cs.html#0426306a39cc419e" class="i property">Value</a>;
            <b>bool</b> <span id="r109 rd" class="r109 r">response</span> = <a href="#4dc6385b71cfff9e" class="i method">ResetRunspaceState</a>();
 
            <a href="#8c8ba41ef94b9086" class="i property">DataStructureHandler</a>.<a href="ServerRemotingProtocol2.cs.html#1706779012404689" class="i method">SendResponseToClient</a>(<span class="r108 r">callId</span>, <span class="r109 r">response</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resets the single runspace in the runspace pool.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="4dc6385b71cfff9e" href="../../../R/4dc6385b71cfff9e.html" target="n" data-glyph="76,1" class="i method">ResetRunspaceState</a>()
        {
            <a href="../../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a> <span id="r110 rd" class="r110 r">runspaceToReset</span> = <a href="#b5ed0c16d100e0f5" class="i field">_rsToUseForSteppablePipeline</a> <b>as</b> <a href="../../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a>;
            <b>if</b> ((<span class="r110 r">runspaceToReset</span> == <b>null</b>) || (<a href="#02717dc375abd3bb" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#849db6668a9907c9" class="i method">GetMaxRunspaces</a>() &gt; 1))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>try</b>
            {
                <span class="c">// Local runspace state reset.</span>
                <span class="r110 r">runspaceToReset</span>.<a href="../../hostifaces/LocalConnection.cs.html#33b71c7edb156892" class="i method">ResetRunspaceState</a>();
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Starts the PowerShell command on the currently pushed Runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">powershell</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PowerShell command or script.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">extraPowerShell</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PowerShell command to run after first completes.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">powershellId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PowerShell Id.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">runspacePoolId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">RunspacePool Id.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r115 r">hostInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Host Info.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r116 r">streamOptions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote stream options.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r117 r">noInput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">False when input is provided.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r118 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Add to history.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="43c31c9996d06d09" href="../../../R/43c31c9996d06d09.html" target="n" data-glyph="76,1" class="i method">StartPowerShellCommandOnPushedRunspace</a>(
            <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r111 rd" class="r111 r">powershell</span>,
            <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r112 rd" class="r112 r">extraPowerShell</span>,
            <span class="i">Guid</span> <span id="r113 rd" class="r113 r">powershellId</span>,
            <span class="i">Guid</span> <span id="r114 rd" class="r114 r">runspacePoolId</span>,
            <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#4fc7c4b336de518c" class="t t">HostInfo</a> <span id="r115 rd" class="r115 r">hostInfo</span>,
            <a href="../../hostifaces/PowerShell.cs.html#3a466dc47c692c8e" class="t t">RemoteStreamOptions</a> <span id="r116 rd" class="r116 r">streamOptions</span>,
            <b>bool</b> <span id="r117 rd" class="r117 r">noInput</span>,
            <b>bool</b> <span id="r118 rd" class="r118 r">addToHistory</span>)
        {
            <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r119 rd" class="r119 r">runspace</span> = <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#93e694613df6a4a0" class="i property">PushedRunspace</a>;
 
            <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r120 rd" class="r120 r">driver</span> = <b>new</b> <span class="t">ServerPowerShellDriver</span>(
                <span class="r111 r">powershell</span>,
                <span class="r112 r">extraPowerShell</span>,
                <span class="r117 r">noInput</span>,
                <span class="r113 r">powershellId</span>,
                <span class="r114 r">runspacePoolId</span>,
                <a href="#a13c57c874abb0c5" class="k">this</a>,
                <span class="i">ApartmentState</span>.<span class="i">MTA</span>,
                <span class="r115 r">hostInfo</span>,
                <span class="r116 r">streamOptions</span>,
                <span class="r118 r">addToHistory</span>,
                <span class="r119 r">runspace</span>);
 
            <b>try</b>
            {
                <span class="r120 r">driver</span>.<a href="ServerPowerShellDriver.cs.html#a712659a5bf2b683" class="i method">Start</a>();
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// Pop runspace on error.</span>
                <a href="#4b5f84eedc1e775b" class="i field">_remoteHost</a>.<a href="ServerRemoteHost.cs.html#4bfdbda58ed475b7" class="i method">PopRunspace</a>();
 
                <b>throw</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Remote Debugger Command Helpers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Debugger command pre processing result type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private enum</b> <a id="f91bdc97bea49ede" href="../../../R/f91bdc97bea49ede.html" target="n" data-glyph="22,1" class="t t"><span id="d7b168988f791055">PreProcessCommandResult</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> No debugger pre-processing. &quot;Get&quot; commands use this so that the</span>
            <span class="c">///</span><span class="c"> data they retrieve can be sent back to the caller.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="f7a11d22f351d578" href="../../../R/f7a11d22f351d578.html" target="n" data-glyph="24,2" class="i field">None</a> = 0,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> This is a valid debugger command but was not processed because</span>
            <span class="c">///</span><span class="c"> the debugger state was not correct.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="33133eac8e3be7db" href="../../../R/33133eac8e3be7db.html" target="n" data-glyph="24,2" class="i field">ValidNotProcessed</a>,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> SetDebuggerAction.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="065a90a917c574a5" href="../../../R/065a90a917c574a5.html" target="n" data-glyph="24,2" class="i field">SetDebuggerAction</a>,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> SetDebugMode.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="ca2da481843b0854" href="../../../R/ca2da481843b0854.html" target="n" data-glyph="24,2" class="i field">SetDebugMode</a>,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> SetDebuggerStepMode.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="fff7bb29e42382c7" href="../../../R/fff7bb29e42382c7.html" target="n" data-glyph="24,2" class="i field">SetDebuggerStepMode</a>,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> SetPreserveUnhandledBreakpointMode.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="2f15e49fc0f0bece" href="../../../R/2f15e49fc0f0bece.html" target="n" data-glyph="24,2" class="i field">SetPreserveUnhandledBreakpointMode</a>,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> The PreProcessCommandResult used for managing breakpoints.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="85dbb0400eecc5dd" href="../../../R/85dbb0400eecc5dd.html" target="n" data-glyph="24,2" class="i field">BreakpointManagement</a>,
        }
 
        <b>private sealed class</b> <a id="5e7a879cd14ffc46" href="../../../R/5e7a879cd14ffc46.html" target="n" data-glyph="4,1" class="t t"><span id="943de18c2df70a7c">DebuggerCommandArgument</span></a>
        {
            <b>public</b> <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>? <a id="644b50168e60cef1" href="../../../R/644b50168e60cef1.html" target="n" data-glyph="102,2" class="i property">Mode</a> { <b>get</b>; <b>set</b>; }
 
            <b>public</b> <a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>? <a id="7b288ddcb30f56c7" href="../../../R/7b288ddcb30f56c7.html" target="n" data-glyph="102,2" class="i property">ResumeAction</a> { <b>get</b>; <b>set</b>; }
 
            <b>public bool</b>? <a id="064ad77b89da4b95" href="../../../R/064ad77b89da4b95.html" target="n" data-glyph="102,2" class="i property">DebuggerStepEnabled</a> { <b>get</b>; <b>set</b>; }
 
            <b>public</b> <a href="../../debugger/debugger.cs.html#b3fa2b471807788d" class="t t">UnhandledBreakpointProcessingMode</a>? <a id="44343435cc7b3e20" href="../../../R/44343435cc7b3e20.html" target="n" data-glyph="102,2" class="i property">UnhandledBreakpointMode</a> { <b>get</b>; <b>set</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Pre-processor for debugger commands.</span>
        <span class="c">///</span><span class="c"> Parses special debugger commands and converts to equivalent script for remote execution as needed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">commands</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The PSCommand.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">serverRemoteDebugger</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The debugger that can be used to invoke debug operations via API.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r123 r">preProcessOutput</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A Collection that can be used to send output to the client.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">commandArgument</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command argument.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">PreProcessCommandResult type if preprocessing occurred.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a> <a id="f4f79331599657e8" href="../../../R/f4f79331599657e8.html" target="n" data-glyph="76,1" class="i method">PreProcessDebuggerCommand</a>(
            <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r121 rd" class="r121 r">commands</span>,
            <a href="#659f74f76b5af7db" class="t t">ServerRemoteDebugger</a> <span id="r122 rd" class="r122 r">serverRemoteDebugger</span>,
            <span class="i">Collection</span>&lt;<b>object</b>&gt; <span id="r123 rd" class="r123 r">preProcessOutput</span>,
            <b>out</b> <a href="#5e7a879cd14ffc46" class="t t">DebuggerCommandArgument</a> <span id="r124 rd" class="r124 r">commandArgument</span>)
        {
            <span class="r124 r">commandArgument</span> = <b>new</b> <span class="t">DebuggerCommandArgument</span>();
            <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a> <span id="r125 rd" class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#f7a11d22f351d578" class="i field">None</a>;
 
            <b>if</b> (<span class="r121 r">commands</span>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>.<span class="i">Count</span> == 0 || <span class="r121 r">commands</span>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">IsScript</span>)
            {
                <b>return</b> <span class="r125 r">result</span>;
            }
 
            <b>var</b> <span id="r126 rd" class="r126 r">command</span> = <span class="r121 r">commands</span>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0];
            <b>string</b> <span id="r127 rd" class="r127 r">commandText</span> = <span class="r126 r">command</span>.<span class="i">CommandText</span>;
            <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#1f734cf12f44bf18" class="i field">GetDebuggerStopArgs</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Get-PSDebuggerStopArgs private virtual command.</span>
                <span class="c">// No input parameters.</span>
                <span class="c">// Returns DebuggerStopEventArgs object.</span>
 
                <span class="c">// Evaluate this command only if the debugger is activated.</span>
                <b>if</b> (!<span class="r122 r">serverRemoteDebugger</span>.<a href="#f1b4b894b316fb35" class="i property">IsActive</a>)
                {
                    <b>return</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#33133eac8e3be7db" class="i field">ValidNotProcessed</a>;
                }
 
                <a href="#4b3c126ab62a410a" class="i method">ReplaceVirtualCommandWithScript</a>(<span class="r121 r">commands</span>, <span class="s">&quot;$host.Runspace.Debugger.GetDebuggerStopArgs()&quot;</span>);
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#8c7b0e33df9a112f" class="i field">SetDebuggerAction</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Set-PSDebuggerAction private virtual command.</span>
                <span class="c">// DebuggerResumeAction enum input parameter.</span>
                <span class="c">// Returns void.</span>
 
                <span class="c">// Evaluate this command only if the debugger is activated.</span>
                <b>if</b> (!<span class="r122 r">serverRemoteDebugger</span>.<a href="#f1b4b894b316fb35" class="i property">IsActive</a>)
                {
                    <b>return</b> <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#33133eac8e3be7db" class="i field">ValidNotProcessed</a>;
                }
 
                <b>if</b> ((<span class="r126 r">command</span>.<span class="i">Parameters</span> == <b>null</b>) || (<span class="r126 r">command</span>.<span class="i">Parameters</span>.<span class="i">Count</span> == 0) ||
                    (!<span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;ResumeAction&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="s">&quot;ResumeAction&quot;</span>);
                }
 
                <a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>? <span id="r128 rd" class="r128 r">resumeAction</span> = <b>null</b>;
                <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r129 rd" class="r129 r">resumeObject</span> = <span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Value</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
                <b>if</b> (<span class="r129 r">resumeObject</span> != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <span class="r128 r">resumeAction</span> = (<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>)<span class="r129 r">resumeObject</span>.<a href="../../MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
                    }
                    <b>catch</b> (<span class="i">InvalidCastException</span>)
                    {
                        <span class="c">// Do nothing.</span>
                    }
                }
 
                <span class="r124 r">commandArgument</span>.<a href="#7b288ddcb30f56c7" class="i property">ResumeAction</a> = <span class="r128 r">resumeAction</span> ?? <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="s">&quot;ResumeAction&quot;</span>);
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#065a90a917c574a5" class="i field">SetDebuggerAction</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#c56c21c0237f7823" class="i field">SetDebugMode</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Set-PSDebugMode private virtual command.</span>
                <span class="c">// DebugModes enum input parameter.</span>
                <span class="c">// Returns void.</span>
                <b>if</b> ((<span class="r126 r">command</span>.<span class="i">Parameters</span> == <b>null</b>) || (<span class="r126 r">command</span>.<span class="i">Parameters</span>.<span class="i">Count</span> == 0) ||
                    (!<span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;Mode&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="s">&quot;Mode&quot;</span>);
                }
 
                <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>? <span id="r130 rd" class="r130 r">mode</span> = <b>null</b>;
                <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r131 rd" class="r131 r">modeObject</span> = <span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Value</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
                <b>if</b> (<span class="r131 r">modeObject</span> != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <span class="r130 r">mode</span> = (<a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>)<span class="r131 r">modeObject</span>.<a href="../../MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
                    }
                    <b>catch</b> (<span class="i">InvalidCastException</span>)
                    {
                        <span class="c">// Do nothing.</span>
                    }
                }
 
                <span class="r124 r">commandArgument</span>.<a href="#644b50168e60cef1" class="i property">Mode</a> = <span class="r130 r">mode</span> ?? <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="s">&quot;Mode&quot;</span>);
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#ca2da481843b0854" class="i field">SetDebugMode</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#0c21b82302bcc9d8" class="i field">SetDebuggerStepMode</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Set-PSDebuggerStepMode private virtual command.</span>
                <span class="c">// Boolean Enabled input parameter.</span>
                <span class="c">// Returns void.</span>
                <b>if</b> ((<span class="r126 r">command</span>.<span class="i">Parameters</span> == <b>null</b>) || (<span class="r126 r">command</span>.<span class="i">Parameters</span>.<span class="i">Count</span> == 0) ||
                   (!<span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;Enabled&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="s">&quot;Enabled&quot;</span>);
                }
 
                <b>bool</b> <span id="r132 rd" class="r132 r">enabled</span> = (<b>bool</b>)<span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Value</span>;
                <span class="r124 r">commandArgument</span>.<a href="#064ad77b89da4b95" class="i property">DebuggerStepEnabled</a> = <span class="r132 r">enabled</span>;
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#fff7bb29e42382c7" class="i field">SetDebuggerStepMode</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#242ffb6b28faef29" class="i field">SetUnhandledBreakpointMode</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Set-PSUnhandledBreakpointMode private virtual command.</span>
                <span class="c">// UnhandledBreakpointMode input parameter.</span>
                <span class="c">// Returns void.</span>
                <b>if</b> ((<span class="r126 r">command</span>.<span class="i">Parameters</span> == <b>null</b>) || (<span class="r126 r">command</span>.<span class="i">Parameters</span>.<span class="i">Count</span> == 0) ||
                   (!<span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Name</span>.<span class="i">Equals</span>(<span class="s">&quot;UnhandledBreakpointMode&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="s">&quot;UnhandledBreakpointMode&quot;</span>);
                }
 
                <a href="../../debugger/debugger.cs.html#b3fa2b471807788d" class="t t">UnhandledBreakpointProcessingMode</a>? <span id="r133 rd" class="r133 r">mode</span> = <b>null</b>;
                <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r134 rd" class="r134 r">modeObject</span> = <span class="r126 r">command</span>.<span class="i">Parameters</span>[0].<span class="i">Value</span> <b>as</b> <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
                <b>if</b> (<span class="r134 r">modeObject</span> != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <span class="r133 r">mode</span> = (<a href="../../debugger/debugger.cs.html#b3fa2b471807788d" class="t t">UnhandledBreakpointProcessingMode</a>)<span class="r134 r">modeObject</span>.<a href="../../MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
                    }
                    <b>catch</b> (<span class="i">InvalidCastException</span>)
                    {
                        <span class="c">// Do nothing.</span>
                    }
                }
 
                <span class="r124 r">commandArgument</span>.<a href="#44343435cc7b3e20" class="i property">UnhandledBreakpointMode</a> = <span class="r133 r">mode</span> ?? <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="s">&quot;Mode&quot;</span>);
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#2f15e49fc0f0bece" class="i field">SetPreserveUnhandledBreakpointMode</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#cf39fd7a1c905683" class="i field">GetBreakpoint</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Get-PSBreakpoint private virtual command.</span>
                <span class="c">// Input parameters:</span>
                <span class="c">// [-Id &lt;int&gt;]</span>
                <span class="c">// Returns Breakpoint object(s).</span>
                <span class="i">TryGetParameter</span>&lt;<b>int</b>?&gt;(<span class="r126 r">command</span>, <span class="s">&quot;RunspaceId&quot;</span>, <b>out int</b>? <span id="r135 rd" class="r135 r">runspaceId</span>);
                <b>if</b> (<span class="i">TryGetParameter</span>&lt;<b>int</b>&gt;(<span class="r126 r">command</span>, <span class="s">&quot;Id&quot;</span>, <b>out int</b> <span id="r136 rd" class="r136 r">breakpointId</span>))
                {
                    <span class="r123 r">preProcessOutput</span>.<span class="i">Add</span>(<span class="r122 r">serverRemoteDebugger</span>.<a href="#37bc9ea92ce4a2c5" class="i method">GetBreakpoint</a>(<span class="r136 r">breakpointId</span>, <span class="r135 r">runspaceId</span>));
                }
                <b>else</b>
                {
                    <b>foreach</b> (<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r137 rd" class="r137 r">breakpoint</span> <b>in</b> <span class="r122 r">serverRemoteDebugger</span>.<a href="#5e1e8cbd51d8d217" class="i method">GetBreakpoints</a>(<span class="r135 r">runspaceId</span>))
                    {
                        <span class="r123 r">preProcessOutput</span>.<span class="i">Add</span>(<span class="r137 r">breakpoint</span>);
                    }
                }
 
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#85dbb0400eecc5dd" class="i field">BreakpointManagement</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#3716c680de6cb897" class="i field">SetBreakpoint</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Set-PSBreakpoint private virtual command.</span>
                <span class="c">// Input parameters:</span>
                <span class="c">// -Breakpoint &lt;Breakpoint&gt; or -BreakpointList &lt;IEnumerable&lt;Breakpoint&gt;&gt;</span>
                <span class="c">// [-RunspaceId &lt;int?&gt;]</span>
                <span class="c">// Returns Breakpoint object(s).</span>
                <span class="i">TryGetParameter</span>&lt;<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a>&gt;(<span class="r126 r">command</span>, <span class="s">&quot;Breakpoint&quot;</span>, <b>out</b> <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r138 rd" class="r138 r">breakpoint</span>);
                <span class="i">TryGetParameter</span>&lt;<span class="i">ArrayList</span>&gt;(<span class="r126 r">command</span>, <span class="s">&quot;BreakpointList&quot;</span>, <b>out</b> <span class="i">ArrayList</span> <span id="r139 rd" class="r139 r">breakpoints</span>);
                <b>if</b> (<span class="r138 r">breakpoint</span> == <b>null</b> &amp;&amp; <span class="r139 r">breakpoints</span> == <b>null</b>)
                {
                    <b>throw</b> <b>new</b> <span class="t">PSArgumentException</span>(<span class="i">DebuggerStrings</span>.<span class="i">BreakpointOrBreakpointListNotSpecified</span>);
                }
 
                <span class="i">TryGetParameter</span>&lt;<b>int</b>?&gt;(<span class="r126 r">command</span>, <span class="s">&quot;RunspaceId&quot;</span>, <b>out int</b>? <span id="r140 rd" class="r140 r">runspaceId</span>);
 
                <span class="r121 r">commands</span>.<a href="../../hostifaces/PSCommand.cs.html#15970659c9fe6157" class="i method">Clear</a>();
 
                <span class="c">// Any collection comes through remoting as an ArrayList of Objects so we convert each object</span>
                <span class="c">// into a breakpoint and add it to the list.</span>
                <b>var</b> <span id="r141 rd" class="r141 r">bps</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a>&gt;();
                <b>if</b> (<span class="r139 r">breakpoints</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>object</b> <span id="r142 rd" class="r142 r">obj</span> <b>in</b> <span class="r139 r">breakpoints</span>)
                    {
                        <b>if</b> (!<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#0ba3f8cd03b35aee" class="i method">TryConvertTo</a>&lt;<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a>&gt;(<span class="r142 r">obj</span>, <b>out</b> <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r143 rd" class="r143 r">bp</span>))
                        {
                            <b>throw</b> <b>new</b> <span class="t">PSArgumentException</span>(<span class="i">DebuggerStrings</span>.<span class="i">BreakpointListContainedANonBreakpoint</span>);
                        }
 
                        <span class="r141 r">bps</span>.<span class="i">Add</span>(<span class="r143 r">bp</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r141 r">bps</span>.<span class="i">Add</span>(<span class="r138 r">breakpoint</span>);
                }
 
                <span class="r122 r">serverRemoteDebugger</span>.<span class="i">SetBreakpoints</span>(<span class="r141 r">bps</span>, <span class="r140 r">runspaceId</span>);
 
                <b>foreach</b> (<b>var</b> <span id="r144 rd" class="r144 r">bp</span> <b>in</b> <span class="r141 r">bps</span>)
                {
                    <span class="r123 r">preProcessOutput</span>.<span class="i">Add</span>(<span class="r144 r">bp</span>);
                }
 
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#85dbb0400eecc5dd" class="i field">BreakpointManagement</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#613c530b58312444" class="i field">RemoveBreakpoint</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Remove-PSBreakpoint private virtual command.</span>
                <span class="c">// Input parameters:</span>
                <span class="c">// -Id &lt;int&gt;</span>
                <span class="c">// [-RunspaceId &lt;int?&gt;]</span>
                <span class="c">// Returns bool.</span>
                <b>int</b> <span id="r145 rd" class="r145 r">breakpointId</span> = <span class="i">GetParameter</span>&lt;<b>int</b>&gt;(<span class="r126 r">command</span>, <span class="s">&quot;Id&quot;</span>);
                <span class="i">TryGetParameter</span>&lt;<b>int</b>?&gt;(<span class="r126 r">command</span>, <span class="s">&quot;RunspaceId&quot;</span>, <b>out int</b>? <span id="r146 rd" class="r146 r">runspaceId</span>);
 
                <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r147 rd" class="r147 r">breakpoint</span> = <span class="r122 r">serverRemoteDebugger</span>.<a href="#37bc9ea92ce4a2c5" class="i method">GetBreakpoint</a>(<span class="r145 r">breakpointId</span>, <span class="r146 r">runspaceId</span>);
                <span class="r123 r">preProcessOutput</span>.<span class="i">Add</span>(
                    <span class="r147 r">breakpoint</span> != <b>null</b> &amp;&amp; <span class="r122 r">serverRemoteDebugger</span>.<a href="#7c48d42770487e9b" class="i method">RemoveBreakpoint</a>(<span class="r147 r">breakpoint</span>, <span class="r146 r">runspaceId</span>));
 
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#85dbb0400eecc5dd" class="i field">BreakpointManagement</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#ec6a6ef1145f7cc0" class="i field">EnableBreakpoint</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Enable-PSBreakpoint private virtual command.</span>
                <span class="c">// Input parameters:</span>
                <span class="c">// -Id &lt;int&gt;</span>
                <span class="c">// [-RunspaceId &lt;int?&gt;]</span>
                <span class="c">// Returns Breakpoint object.</span>
                <b>int</b> <span id="r148 rd" class="r148 r">breakpointId</span> = <span class="i">GetParameter</span>&lt;<b>int</b>&gt;(<span class="r126 r">command</span>, <span class="s">&quot;Id&quot;</span>);
                <span class="i">TryGetParameter</span>&lt;<b>int</b>?&gt;(<span class="r126 r">command</span>, <span class="s">&quot;RunspaceId&quot;</span>, <b>out int</b>? <span id="r149 rd" class="r149 r">runspaceId</span>);
 
                <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r150 rd" class="r150 r">bp</span> = <span class="r122 r">serverRemoteDebugger</span>.<a href="#37bc9ea92ce4a2c5" class="i method">GetBreakpoint</a>(<span class="r148 r">breakpointId</span>, <span class="r149 r">runspaceId</span>);
                <b>if</b> (<span class="r150 r">bp</span> != <b>null</b>)
                {
                    <span class="r123 r">preProcessOutput</span>.<span class="i">Add</span>(<span class="r122 r">serverRemoteDebugger</span>.<a href="#48f20692c0601ca6" class="i method">EnableBreakpoint</a>(<span class="r150 r">bp</span>, <span class="r149 r">runspaceId</span>));
                }
 
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#85dbb0400eecc5dd" class="i field">BreakpointManagement</a>;
            }
            <b>else</b> <b>if</b> (<span class="r127 r">commandText</span>.<span class="i">Equals</span>(<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#78b2ba59f74e7676" class="t t">RemoteDebuggingCommands</a>.<a href="../common/WireDataFormat/RemoteDebuggingCapability.cs.html#e194a804a121c067" class="i field">DisableBreakpoint</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// __Disable-PSBreakpoint private virtual command.</span>
                <span class="c">// Input parameters:</span>
                <span class="c">// -Id &lt;int&gt;</span>
                <span class="c">// [-RunspaceId &lt;int?&gt;]</span>
                <span class="c">// Returns Breakpoint object.</span>
                <b>int</b> <span id="r151 rd" class="r151 r">breakpointId</span> = <span class="i">GetParameter</span>&lt;<b>int</b>&gt;(<span class="r126 r">command</span>, <span class="s">&quot;Id&quot;</span>);
                <span class="i">TryGetParameter</span>&lt;<b>int</b>?&gt;(<span class="r126 r">command</span>, <span class="s">&quot;RunspaceId&quot;</span>, <b>out int</b>? <span id="r152 rd" class="r152 r">runspaceId</span>);
 
                <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r153 rd" class="r153 r">bp</span> = <span class="r122 r">serverRemoteDebugger</span>.<a href="#37bc9ea92ce4a2c5" class="i method">GetBreakpoint</a>(<span class="r151 r">breakpointId</span>, <span class="r152 r">runspaceId</span>);
                <b>if</b> (<span class="r153 r">bp</span> != <b>null</b>)
                {
                    <span class="r123 r">preProcessOutput</span>.<span class="i">Add</span>(<span class="r122 r">serverRemoteDebugger</span>.<a href="#272d9debbea626d4" class="i method">DisableBreakpoint</a>(<span class="r153 r">bp</span>, <span class="r152 r">runspaceId</span>));
                }
 
                <span class="r125 r">result</span> = <a href="#f91bdc97bea49ede" class="t t">PreProcessCommandResult</a>.<a href="#85dbb0400eecc5dd" class="i field">BreakpointManagement</a>;
            }
 
            <b>return</b> <span class="r125 r">result</span>;
        }
 
        <b>private static void</b> <a id="4b3c126ab62a410a" href="../../../R/4b3c126ab62a410a.html" target="n" data-glyph="76,1" class="i method">ReplaceVirtualCommandWithScript</a>(<a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r154 rd" class="r154 r">commands</span>, <b>string</b> <span id="r155 rd" class="r155 r">script</span>)
        {
            <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r156 rd" class="r156 r">scriptBlock</span> = <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#adfac0fa7bf5725f" class="i method">Create</a>(<span class="r155 r">script</span>);
            <span class="r156 r">scriptBlock</span>.<a href="../../lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> = <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
            <span class="r154 r">commands</span>.<a href="../../hostifaces/PSCommand.cs.html#15970659c9fe6157" class="i method">Clear</a>();
            <span class="r154 r">commands</span>.<a href="../../hostifaces/PSCommand.cs.html#2a2b7de6778550bd" class="i method">AddCommand</a>(<span class="s">&quot;Invoke-Command&quot;</span>)
                    .<a href="../../hostifaces/PSCommand.cs.html#247ce643c3f840c8" class="i method">AddParameter</a>(<span class="s">&quot;ScriptBlock&quot;</span>, <span class="r156 r">scriptBlock</span>)
                    .<a href="../../hostifaces/PSCommand.cs.html#247ce643c3f840c8" class="i method">AddParameter</a>(<span class="s">&quot;NoNewScope&quot;</span>, <b>true</b>);
        }
 
        <b>private static</b> <span class="r157 r t">T</span> <a id="696733e3db6ce615" href="../../../R/696733e3db6ce615.html" target="n" data-glyph="76,1" class="i method">GetParameter</a>&lt;<span id="r157 rd t" class="r157 r t">T</span>&gt;(<a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r158 rd" class="r158 r">command</span>, <b>string</b> <span id="r159 rd" class="r159 r">parameterName</span>)
        {
            <b>if</b> (<span class="r158 r">command</span>.<a href="../../hostifaces/Command.cs.html#ba1074ca05aadff5" class="i property">Parameters</a>?.<span class="i">Count</span> == 0)
            {
                <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="r159 r">parameterName</span>);
            }
 
            <b>foreach</b> (<a href="../../hostifaces/Parameter.cs.html#4ce3ff8da8a0f8d9" class="t t">CommandParameter</a> <span id="r160 rd" class="r160 r">param</span> <b>in</b> <span class="r158 r">command</span>.<a href="../../hostifaces/Command.cs.html#ba1074ca05aadff5" class="i property">Parameters</a>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r160 r">param</span>.<a href="../../hostifaces/Parameter.cs.html#6ea3f296defa8bc7" class="i property">Name</a>, <span class="r159 r">parameterName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#8b9327b10b12742d" class="i method">ConvertTo</a>&lt;<span class="r157 r t">T</span>&gt;(<span class="r160 r">param</span>.<a href="../../hostifaces/Parameter.cs.html#fcbaca5cbcc738ea" class="i property">Value</a>);
                }
            }
 
            <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="r159 r">parameterName</span>);
        }
 
        <b>private static bool</b> <a id="0eaf7569ff8dfa12" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">TryGetParameter</a>&lt;<span id="r161 rd t" class="r161 r t">T</span>&gt;(<a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r162 rd" class="r162 r">command</span>, <b>string</b> <span id="r163 rd" class="r163 r">parameterName</span>, <b>out</b> <span class="r161 r t">T</span> <span id="r164 rd" class="r164 r">value</span>)
        {
            <b>try</b>
            {
                <span class="r164 r">value</span> = <a href="#696733e3db6ce615" class="i method">GetParameter</a>&lt;<span class="r161 r t">T</span>&gt;(<span class="r162 r">command</span>, <span class="r163 r">parameterName</span>);
                <b>return</b> <b>true</b>;
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r165 rd" class="r165 r">ex</span>) <b>when</b> (
                <span class="r165 r">ex</span> <b>is</b> <a href="../../../utils/MshArgumentException.cs.html#581bd9b947689819" class="t t">PSArgumentException</a> ||
                <span class="r165 r">ex</span> <b>is</b> <span class="i">InvalidCastException</span> ||
                <span class="r165 r">ex</span> <b>is</b> <a href="../../ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a>)
            {
                <span class="r164 r">value</span> = <b>default</b>(<span class="r161 r t">T</span>);
                <b>return</b> <b>false</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Classes
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper class to run ServerPowerShellDriver objects on a single thread.  This is</span>
        <span class="c">///</span><span class="c"> needed to support nested pipeline execution and remote debugging.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private sealed class</b> <a id="71cff3c534cadd9b" href="../../../R/71cff3c534cadd9b.html" target="n" data-glyph="4,1" class="t t">PowerShellDriverInvoker</a>
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Members
 
            <b>private readonly</b> <span class="i">ConcurrentStack</span>&lt;<a href="#b3db0f121c554b28" class="t t">InvokePump</a>&gt; <a id="aa83d8e2d9b1a13c" href="../../../R/aa83d8e2d9b1a13c.html" target="n" data-glyph="46,2" class="i field">_invokePumpStack</a>;
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Constructor.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <a id="b351b8d660f5eb64" href="../../../R/b351b8d660f5eb64.html" target="n" data-glyph="72,2" class="t constructor">PowerShellDriverInvoker</a>()
            {
                <a href="#aa83d8e2d9b1a13c" class="i field">_invokePumpStack</a> = <b>new</b> <span class="i">ConcurrentStack</span>&lt;<a href="#b3db0f121c554b28" class="t t">InvokePump</a>&gt;();
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> IsActive.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public bool</b> <a id="67927ed865d143e1" href="../../../R/67927ed865d143e1.html" target="n" data-glyph="102,2" class="i property">IsActive</a>
            {
                <b>get</b> { <b>return</b> !<a href="#aa83d8e2d9b1a13c" class="i field">_invokePumpStack</a>.<span class="i">IsEmpty</span>; }
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> True if thread is ready to invoke a PowerShell driver.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public bool</b> <a id="c2a97d3a5f8b1195" href="../../../R/c2a97d3a5f8b1195.html" target="n" data-glyph="102,2" class="i property">IsAvailable</a>
            {
                <b>get</b>
                {
                    <a href="#b3db0f121c554b28" class="t t">InvokePump</a> <span id="r166 rd" class="r166 r">pump</span>;
                    <b>if</b> (!<a href="#aa83d8e2d9b1a13c" class="i field">_invokePumpStack</a>.<span class="i">TryPeek</span>(<b>out</b> <span class="r166 r">pump</span>))
                    {
                        <span class="r166 r">pump</span> = <b>null</b>;
                    }
 
                    <b>return</b> (<span class="r166 r">pump</span> != <b>null</b>) &amp;&amp; !(<span class="r166 r">pump</span>.<a href="#322b5c8e59f7eec8" class="i property">IsBusy</a>);
                }
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Public Methods
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Submit a driver object to be invoked.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r167 r">driver</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">ServerPowerShellDriver.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>public void</b> <a id="300d22438eda9f1f" href="../../../R/300d22438eda9f1f.html" target="n" data-glyph="72,2" class="i method">InvokeDriverAsync</a>(<a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r167 rd" class="r167 r">driver</span>)
            {
                <a href="#b3db0f121c554b28" class="t t">InvokePump</a> <span id="r168 rd" class="r168 r">currentPump</span>;
                <b>if</b> (!<a href="#aa83d8e2d9b1a13c" class="i field">_invokePumpStack</a>.<span class="i">TryPeek</span>(<b>out</b> <span class="r168 r">currentPump</span>))
                {
                    <b>throw</b> <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">PowerShellInvokerInvalidState</span>);
                }
 
                <span class="r168 r">currentPump</span>.<a href="#9932b5b80ca938d7" class="i method">Dispatch</a>(<span class="r167 r">driver</span>);
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Blocking call that creates a new pump object and pumps</span>
            <span class="c">///</span><span class="c"> driver invokes until stopped via a PopInvoker call.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public void</b> <a id="174c24858bbae921" href="../../../R/174c24858bbae921.html" target="n" data-glyph="72,2" class="i method">PushInvoker</a>()
            {
                <a href="#b3db0f121c554b28" class="t t">InvokePump</a> <span id="r169 rd" class="r169 r">newPump</span> = <b>new</b> <a href="#7724d5602cdaa207" class="t constructor">InvokePump</a>();
                <a href="#aa83d8e2d9b1a13c" class="i field">_invokePumpStack</a>.<span class="i">Push</span>(<span class="r169 r">newPump</span>);
 
                <span class="c">// Blocking call while new driver invocations are handled on</span>
                <span class="c">// new pump.</span>
                <span class="r169 r">newPump</span>.<a href="#4f1188addd603e4d" class="i method">Start</a>();
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Stops the current driver invoker and restores the previous</span>
            <span class="c">///</span><span class="c"> invoker object on the stack, if any, to handle driver invocations.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public void</b> <a id="46fae0a4afbada28" href="../../../R/46fae0a4afbada28.html" target="n" data-glyph="72,2" class="i method">PopInvoker</a>()
            {
                <a href="#b3db0f121c554b28" class="t t">InvokePump</a> <span id="r170 rd" class="r170 r">oldPump</span>;
                <b>if</b> (<a href="#aa83d8e2d9b1a13c" class="i field">_invokePumpStack</a>.<span class="i">TryPop</span>(<b>out</b> <span class="r170 r">oldPump</span>))
                {
                    <span class="r170 r">oldPump</span>.<a href="#85eb8e490cd9bc9e" class="i method">Stop</a>();
                }
                <b>else</b>
                {
                    <b>throw</b> <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">CannotExitNestedPipeline</span>);
                }
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Private classes
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Class that queues and invokes ServerPowerShellDriver objects</span>
            <span class="c">///</span><span class="c"> in sequence.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>private sealed class</b> <a id="b3db0f121c554b28" href="../../../R/b3db0f121c554b28.html" target="n" data-glyph="4,2" class="t t">InvokePump</a>
            {
                <b>private readonly</b> <span class="i">Queue</span>&lt;<a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a>&gt; <a id="a40e44796189a5c6" href="../../../R/a40e44796189a5c6.html" target="n" data-glyph="46,3" class="i field">_driverInvokeQueue</a>;
                <b>private readonly</b> <span class="i">ManualResetEvent</span> <a id="808a90946790e350" href="../../../R/808a90946790e350.html" target="n" data-glyph="46,3" class="i field">_processDrivers</a>;
                <b>private readonly object</b> <a id="15a3c5f6e677a2b9" href="../../../R/15a3c5f6e677a2b9.html" target="n" data-glyph="46,3" class="i field">_syncObject</a>;
                <b>private bool</b> <a id="e777f6121d6717c3" href="../../../R/e777f6121d6717c3.html" target="n" data-glyph="46,3" class="i field">_stopPump</a>;
                <b>private bool</b> <a id="dde61a26511968ea" href="../../../R/dde61a26511968ea.html" target="n" data-glyph="46,3" class="i field">_isDisposed</a>;
 
                <b>public</b> <a id="7724d5602cdaa207" href="../../../R/7724d5602cdaa207.html" target="n" data-glyph="72,3" class="t constructor">InvokePump</a>()
                {
                    <a href="#a40e44796189a5c6" class="i field">_driverInvokeQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a>&gt;();
                    <a href="#808a90946790e350" class="i field">_processDrivers</a> = <b>new</b> <span class="i">ManualResetEvent</span>(<b>false</b>);
                    <a href="#15a3c5f6e677a2b9" class="i field">_syncObject</a> = <b>new</b> <b>object</b>();
                }
 
                <b>public void</b> <a id="4f1188addd603e4d" href="../../../R/4f1188addd603e4d.html" target="n" data-glyph="72,3" class="i method">Start</a>()
                {
                    <b>try</b>
                    {
                        <b>while</b> (<b>true</b>)
                        {
                            <a href="#808a90946790e350" class="i field">_processDrivers</a>.<span class="i">WaitOne</span>();
 
                            <span class="c">// Synchronously invoke one ServerPowerShellDriver at a time.</span>
                            <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r171 rd" class="r171 r">driver</span> = <b>null</b>;
 
                            <b>lock</b> (<a href="#15a3c5f6e677a2b9" class="i field">_syncObject</a>)
                            {
                                <b>if</b> (<a href="#e777f6121d6717c3" class="i field">_stopPump</a>)
                                {
                                    <b>break</b>;
                                }
 
                                <b>if</b> (<a href="#a40e44796189a5c6" class="i field">_driverInvokeQueue</a>.<span class="i">Count</span> &gt; 0)
                                {
                                    <span class="r171 r">driver</span> = <a href="#a40e44796189a5c6" class="i field">_driverInvokeQueue</a>.<span class="i">Dequeue</span>();
                                }
 
                                <b>if</b> (<a href="#a40e44796189a5c6" class="i field">_driverInvokeQueue</a>.<span class="i">Count</span> == 0)
                                {
                                    <a href="#808a90946790e350" class="i field">_processDrivers</a>.<span class="i">Reset</span>();
                                }
                            }
 
                            <b>if</b> (<span class="r171 r">driver</span> != <b>null</b>)
                            {
                                <b>try</b>
                                {
                                    <a href="#322b5c8e59f7eec8" class="i property">IsBusy</a> = <b>true</b>;
                                    <span class="r171 r">driver</span>.<a href="ServerPowerShellDriver.cs.html#dceac032d52bcb04" class="i method">InvokeMain</a>();
                                }
                                <b>catch</b> (<span class="i">Exception</span>)
                                {
                                }
                                <b>finally</b>
                                {
                                    <a href="#322b5c8e59f7eec8" class="i property">IsBusy</a> = <b>false</b>;
                                }
                            }
                        }
                    }
                    <b>finally</b>
                    {
                        <a href="#dde61a26511968ea" class="i field">_isDisposed</a> = <b>true</b>;
                        <a href="#808a90946790e350" class="i field">_processDrivers</a>.<span class="i">Dispose</span>();
                    }
                }
 
                <b>public void</b> <a id="9932b5b80ca938d7" href="../../../R/9932b5b80ca938d7.html" target="n" data-glyph="72,3" class="i method">Dispatch</a>(<a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r172 rd" class="r172 r">driver</span>)
                {
                    <a href="#14adbc60d51cf9f1" class="i method">CheckDisposed</a>();
 
                    <b>lock</b> (<a href="#15a3c5f6e677a2b9" class="i field">_syncObject</a>)
                    {
                        <a href="#a40e44796189a5c6" class="i field">_driverInvokeQueue</a>.<span class="i">Enqueue</span>(<span class="r172 r">driver</span>);
                        <a href="#808a90946790e350" class="i field">_processDrivers</a>.<span class="i">Set</span>();
                    }
                }
 
                <b>public void</b> <a id="85eb8e490cd9bc9e" href="../../../R/85eb8e490cd9bc9e.html" target="n" data-glyph="72,3" class="i method">Stop</a>()
                {
                    <a href="#14adbc60d51cf9f1" class="i method">CheckDisposed</a>();
 
                    <b>lock</b> (<a href="#15a3c5f6e677a2b9" class="i field">_syncObject</a>)
                    {
                        <a href="#e777f6121d6717c3" class="i field">_stopPump</a> = <b>true</b>;
                        <a href="#808a90946790e350" class="i field">_processDrivers</a>.<span class="i">Set</span>();
                    }
                }
 
                <b>public bool</b> <a id="322b5c8e59f7eec8" href="../../../R/322b5c8e59f7eec8.html" target="n" data-glyph="102,3" class="i property">IsBusy</a> { <b>get</b>; <b>private set</b>; }
 
                <b>private void</b> <a id="14adbc60d51cf9f1" href="../../../R/14adbc60d51cf9f1.html" target="n" data-glyph="76,3" class="i method">CheckDisposed</a>()
                {
                    <b>if</b> (<a href="#dde61a26511968ea" class="i field">_isDisposed</a>)
                    {
                        <b>throw</b> <b>new</b> <span class="i">ObjectDisposedException</span>(<span class="s">&quot;InvokePump&quot;</span>);
                    }
                }
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class wraps the script debugger for a ServerRunspacePoolDriver runspace.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="659f74f76b5af7db" href="../../../R/659f74f76b5af7db.html" target="n" data-glyph="2,0" class="t t">ServerRemoteDebugger</a> : <a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a>, <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Members
 
        <b>private readonly</b> <a href="#074cec5d5aeffa31" class="t t">IRSPDriverInvoke</a> <a id="7b4a675544ac6e62" href="../../../R/7b4a675544ac6e62.html" target="n" data-glyph="46,1" class="i field">_driverInvoker</a>;
        <b>private readonly</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="78c680badad557e7" href="../../../R/78c680badad557e7.html" target="n" data-glyph="46,1" class="i field">_runspace</a>;
        <b>private readonly</b> <a href="../common/ObjectRef.cs.html#2cf76ce673a33ff2" class="t t">ObjectRef</a>&lt;<a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a>&gt; <a id="4a2f92996a494077" href="../../../R/4a2f92996a494077.html" target="n" data-glyph="46,1" class="i field">_wrappedDebugger</a>;
        <b>private bool</b> <a id="a86c63f25f84d09a" href="../../../R/a86c63f25f84d09a.html" target="n" data-glyph="46,1" class="i field">_inDebugMode</a>;
        <b>private</b> <a href="../../debugger/debugger.cs.html#13c865e6481e16a2" class="t t">DebuggerStopEventArgs</a> <a id="cc2745789c4eca6f" href="../../../R/cc2745789c4eca6f.html" target="n" data-glyph="46,1" class="i field">_debuggerStopEventArgs</a>;
 
        <b>private</b> <span class="i">ManualResetEventSlim</span> <a id="57cc92674e472335" href="../../../R/57cc92674e472335.html" target="n" data-glyph="46,1" class="i field">_nestedDebugStopCompleteEvent</a>;
        <b>private bool</b> <a id="00780918ba3c07f8" href="../../../R/00780918ba3c07f8.html" target="n" data-glyph="46,1" class="i field">_nestedDebugging</a>;
        <b>private</b> <span class="i">ManualResetEventSlim</span> <a id="d521bb16ba8b5556" href="../../../R/d521bb16ba8b5556.html" target="n" data-glyph="46,1" class="i field">_processCommandCompleteEvent</a>;
        <b>private</b> <a href="#59303b327cb449bc" class="t t">ThreadCommandProcessing</a> <a id="e4d822da80c08ab3" href="../../../R/e4d822da80c08ab3.html" target="n" data-glyph="46,1" class="i field">_threadCommandProcessing</a>;
 
        <b>private bool</b> <a id="f0041560bf25a0a2" href="../../../R/f0041560bf25a0a2.html" target="n" data-glyph="46,1" class="i field">_raiseStopEventLocally</a>;
 
        <b>internal const string</b> <a id="568f5c2973faeac4" href="../../../R/568f5c2973faeac4.html" target="n" data-glyph="8,1" class="i field">SetPSBreakCommandText</a> = <span class="s">&quot;Set-PSBreakpoint&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor
 
        <b>private</b> <a id="07bc87ac74b0eea4" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="t constructor">ServerRemoteDebugger</a>() { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r173 r">driverInvoker</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">debugger</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="43f7b894c00e7b5e" href="../../../R/43f7b894c00e7b5e.html" target="n" data-glyph="74,1" class="t constructor">ServerRemoteDebugger</a>(
            <a href="#074cec5d5aeffa31" class="t t">IRSPDriverInvoke</a> <span id="r173 rd" class="r173 r">driverInvoker</span>,
            <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r174 rd" class="r174 r">runspace</span>,
            <a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <span id="r175 rd" class="r175 r">debugger</span>)
        {
            <b>if</b> (<span class="r173 r">driverInvoker</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentNullException.cs.html#166e605c6cb05157" class="t constructor">PSArgumentNullException</a>(<b>nameof</b>(<span class="r173 r">driverInvoker</span>));
            }
 
            <b>if</b> (<span class="r174 r">runspace</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentNullException.cs.html#166e605c6cb05157" class="t constructor">PSArgumentNullException</a>(<b>nameof</b>(<span class="r174 r">runspace</span>));
            }
 
            <b>if</b> (<span class="r175 r">debugger</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="../../../utils/MshArgumentNullException.cs.html#166e605c6cb05157" class="t constructor">PSArgumentNullException</a>(<b>nameof</b>(<span class="r175 r">debugger</span>));
            }
 
            <a href="#7b4a675544ac6e62" class="i field">_driverInvoker</a> = <span class="r173 r">driverInvoker</span>;
            <a href="#78c680badad557e7" class="i field">_runspace</a> = <span class="r174 r">runspace</span>;
 
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a> = <b>new</b> <a href="../common/ObjectRef.cs.html#5120d88e7c7e837d" class="t constructor">ObjectRef</a>&lt;<a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a>&gt;(<span class="r175 r">debugger</span>);
 
            <a href="#488c914809175347" class="i method">SetDebuggerCallbacks</a>();
 
            <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#c40205e63f7ff911" class="i property">Name</a> = <span class="s">&quot;RemoteHost&quot;</span>;
            <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#6a2e76958c3789aa" class="i property">InternalDebugger</a> = <a href="#659f74f76b5af7db" class="k">this</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Debugger overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True when debugger is stopped at a breakpoint.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override bool</b> <a id="d42eeb2b7e0c5d95" href="../../../R/d42eeb2b7e0c5d95.html" target="n" data-glyph="102,1" class="i property">InBreakpoint</a>
        {
            <b>get</b> { <b>return</b> <a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds the provided set of breakpoints to the debugger.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">breakpoints</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">List of breakpoints.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="4117739bfb7475c9" href="../../../R/4117739bfb7475c9.html" target="n" data-glyph="72,1" class="i method">SetBreakpoints</a>(<span class="i">IEnumerable</span>&lt;<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a>&gt; <span id="r176 rd" class="r176 r">breakpoints</span>, <b>int</b>? <span id="r177 rd" class="r177 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#843320f23c8b6ab7" class="i method">SetBreakpoints</a>(<span class="r176 r">breakpoints</span>, <span class="r177 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get a breakpoint by id, primarily for Enable/Disable/Remove-PSBreakpoint cmdlets.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r178 r">id</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Id of the breakpoint you want.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The breakpoint with the specified id.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <a id="37bc9ea92ce4a2c5" href="../../../R/37bc9ea92ce4a2c5.html" target="n" data-glyph="72,1" class="i method">GetBreakpoint</a>(<b>int</b> <span id="r178 rd" class="r178 r">id</span>, <b>int</b>? <span id="r179 rd" class="r179 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#b6e003b1e66c5826" class="i method">GetBreakpoint</a>(<span class="r178 r">id</span>, <span class="r179 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns breakpoints on a runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r180 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A list of breakpoints in a runspace.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">List</span>&lt;<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a>&gt; <a id="5e1e8cbd51d8d217" href="../../../R/5e1e8cbd51d8d217.html" target="n" data-glyph="72,1" class="i method">GetBreakpoints</a>(<b>int</b>? <span id="r180 rd" class="r180 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#bece37496a1551b3" class="i method">GetBreakpoints</a>(<span class="r180 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets a command breakpoint in the debugger.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r181 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the command that will trigger the breakpoint. This value may not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r182 r">action</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The action to take when the breakpoint is hit. If null, PowerShell will break into the debugger when the breakpoint is hit.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r183 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the script file where the breakpoint may be hit. If null, the breakpoint may be hit anywhere the command is invoked.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r184 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The command breakpoint that was set.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/Breakpoint.cs.html#36af4b04ff98769a" class="t t">CommandBreakpoint</a> <a id="390660abf27ef87d" href="../../../R/390660abf27ef87d.html" target="n" data-glyph="72,1" class="i method">SetCommandBreakpoint</a>(<b>string</b> <span id="r181 rd" class="r181 r">command</span>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r182 rd" class="r182 r">action</span>, <b>string</b> <span id="r183 rd" class="r183 r">path</span>, <b>int</b>? <span id="r184 rd" class="r184 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#770250464b312a9d" class="i method">SetCommandBreakpoint</a>(<span class="r181 r">command</span>, <span class="r182 r">action</span>, <span class="r183 r">path</span>, <span class="r184 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets a line breakpoint in the debugger.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r185 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the script file where the breakpoint may be hit. This value may not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r186 r">line</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The line in the script file where the breakpoint may be hit. This value must be greater than or equal to 1.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">column</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The column in the script file where the breakpoint may be hit. If 0, the breakpoint will trigger on any statement on the line.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r188 r">action</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The action to take when the breakpoint is hit. If null, PowerShell will break into the debugger when the breakpoint is hit.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r189 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The line breakpoint that was set.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/Breakpoint.cs.html#8289c87b2cf2e5fd" class="t t">LineBreakpoint</a> <a id="6ee59ecd25324740" href="../../../R/6ee59ecd25324740.html" target="n" data-glyph="72,1" class="i method">SetLineBreakpoint</a>(<b>string</b> <span id="r185 rd" class="r185 r">path</span>, <b>int</b> <span id="r186 rd" class="r186 r">line</span>, <b>int</b> <span id="r187 rd" class="r187 r">column</span>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r188 rd" class="r188 r">action</span>, <b>int</b>? <span id="r189 rd" class="r189 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#76c772e72e8f9e60" class="i method">SetLineBreakpoint</a>(<span class="r185 r">path</span>, <span class="r186 r">line</span>, <span class="r187 r">column</span>, <span class="r188 r">action</span>, <span class="r189 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets a variable breakpoint in the debugger.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">variableName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the variable that will trigger the breakpoint. This value may not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r191 r">accessMode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The variable access mode that will trigger the breakpoint.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r192 r">action</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The action to take when the breakpoint is hit. If null, PowerShell will break into the debugger when the breakpoint is hit.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r193 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the script file where the breakpoint may be hit. If null, the breakpoint may be hit anywhere the variable is accessed using the specified access mode.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r194 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The variable breakpoint that was set.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/Breakpoint.cs.html#939ec0f40914ad61" class="t t">VariableBreakpoint</a> <a id="649bd4c589a6876b" href="../../../R/649bd4c589a6876b.html" target="n" data-glyph="72,1" class="i method">SetVariableBreakpoint</a>(<b>string</b> <span id="r190 rd" class="r190 r">variableName</span>, <a href="../../debugger/Breakpoint.cs.html#296231e77d11bcb5" class="t t">VariableAccessMode</a> <span id="r191 rd" class="r191 r">accessMode</span>, <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r192 rd" class="r192 r">action</span>, <b>string</b> <span id="r193 rd" class="r193 r">path</span>, <b>int</b>? <span id="r194 rd" class="r194 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#9563c4fb2f0b68d1" class="i method">SetVariableBreakpoint</a>(<span class="r190 r">variableName</span>, <span class="r191 r">accessMode</span>, <span class="r192 r">action</span>, <span class="r193 r">path</span>, <span class="r194 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes a breakpoint from the debugger.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r195 r">breakpoint</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The breakpoint to remove from the debugger. This value may not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r196 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the breakpoint was removed from the debugger; false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override bool</b> <a id="7c48d42770487e9b" href="../../../R/7c48d42770487e9b.html" target="n" data-glyph="72,1" class="i method">RemoveBreakpoint</a>(<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r195 rd" class="r195 r">breakpoint</span>, <b>int</b>? <span id="r196 rd" class="r196 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#7137c8a1ec351631" class="i method">RemoveBreakpoint</a>(<span class="r195 r">breakpoint</span>, <span class="r196 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Enables a breakpoint in the debugger.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r197 r">breakpoint</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The breakpoint to enable in the debugger. This value may not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r198 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The updated breakpoint if it was found; null if the breakpoint was not found in the debugger.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <a id="48f20692c0601ca6" href="../../../R/48f20692c0601ca6.html" target="n" data-glyph="72,1" class="i method">EnableBreakpoint</a>(<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r197 rd" class="r197 r">breakpoint</span>, <b>int</b>? <span id="r198 rd" class="r198 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#670aef2cabe5355b" class="i method">EnableBreakpoint</a>(<span class="r197 r">breakpoint</span>, <span class="r198 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Disables a breakpoint in the debugger.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r199 r">breakpoint</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The breakpoint to enable in the debugger. This value may not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r200 r">runspaceId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace id of the runspace you want to interact with. A null value will use the current runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The updated breakpoint if it was found; null if the breakpoint was not found in the debugger.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <a id="272d9debbea626d4" href="../../../R/272d9debbea626d4.html" target="n" data-glyph="72,1" class="i method">DisableBreakpoint</a>(<a href="../../debugger/Breakpoint.cs.html#9deaac83de6a8f2c" class="t t">Breakpoint</a> <span id="r199 rd" class="r199 r">breakpoint</span>, <b>int</b>? <span id="r200 rd" class="r200 r">runspaceId</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#a7be3be2de328046" class="i method">DisableBreakpoint</a>(<span class="r199 r">breakpoint</span>, <span class="r200 r">runspaceId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Exits debugger mode with the provided resume action.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r201 r">resumeAction</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">DebuggerResumeAction.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="c4e359db34b672b7" href="../../../R/c4e359db34b672b7.html" target="n" data-glyph="72,1" class="i method">SetDebuggerAction</a>(<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a> <span id="r201 rd" class="r201 r">resumeAction</span>)
        {
            <b>if</b> (!<a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a>)
            {
                <b>throw</b> <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(
                    <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">DebuggerStrings</span>.<span class="i">CannotSetRemoteDebuggerAction</span>));
            }
 
            <a href="#697fb21490ae5cfd" class="i method">ExitDebugMode</a>(<span class="r201 r">resumeAction</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns debugger stop event args if in debugger stop state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">DebuggerStopEventArgs.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/debugger.cs.html#13c865e6481e16a2" class="t t">DebuggerStopEventArgs</a> <a id="564f5e96473358c2" href="../../../R/564f5e96473358c2.html" target="n" data-glyph="72,1" class="i method">GetDebuggerStopArgs</a>()
        {
            <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#0d780deedecb8a4a" class="i method">GetDebuggerStopArgs</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ProcessCommand.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r202 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r203 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Output.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../debugger/debugger.cs.html#279d714bfd5743f3" class="t t">DebuggerCommandResults</a> <a id="3eaa4a2cb6bc74ce" href="../../../R/3eaa4a2cb6bc74ce.html" target="n" data-glyph="72,1" class="i method">ProcessCommand</a>(<a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r202 rd" class="r202 r">command</span>, <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r203 rd" class="r203 r">output</span>)
        {
            <b>if</b> (<a href="#d5a5d13efc580c8c" class="i property">LocalDebugMode</a>)
            {
                <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#f752da7b39207812" class="i method">ProcessCommand</a>(<span class="r202 r">command</span>, <span class="r203 r">output</span>);
            }
 
            <b>if</b> (!<a href="#d42eeb2b7e0c5d95" class="i property">InBreakpoint</a> || (<a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a> != <b>null</b>))
            {
                <b>throw</b> <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(
                    <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">DebuggerStrings</span>.<span class="i">CannotProcessDebuggerCommandNotStopped</span>));
            }
 
            <b>if</b> (<a href="#d521bb16ba8b5556" class="i field">_processCommandCompleteEvent</a> == <b>null</b>)
            {
                <a href="#d521bb16ba8b5556" class="i field">_processCommandCompleteEvent</a> = <b>new</b> <span class="i">ManualResetEventSlim</span>(<b>false</b>);
            }
 
            <a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a> = <b>new</b> <a href="#fbd663ae4ed8609d" class="t constructor">ThreadCommandProcessing</a>(<span class="r202 r">command</span>, <span class="r203 r">output</span>, <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>, <a href="#d521bb16ba8b5556" class="i field">_processCommandCompleteEvent</a>);
            <b>try</b>
            {
                <b>return</b> <a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a>.<a href="#446b2bfd4ff2963b" class="i method">Invoke</a>(<a href="#57cc92674e472335" class="i field">_nestedDebugStopCompleteEvent</a>);
            }
            <b>finally</b>
            {
                <a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a> = <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> StopProcessCommand.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="35b64d9e0b9bba15" href="../../../R/35b64d9e0b9bba15.html" target="n" data-glyph="72,1" class="i method">StopProcessCommand</a>()
        {
            <b>if</b> (<a href="#d5a5d13efc580c8c" class="i property">LocalDebugMode</a>)
            {
                <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#bcb115e0eda53c00" class="i method">StopProcessCommand</a>();
            }
 
            <a href="#59303b327cb449bc" class="t t">ThreadCommandProcessing</a> <span id="r204 rd" class="r204 r">threadCommandProcessing</span> = <a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a>;
            <b>if</b> (<span class="r204 r">threadCommandProcessing</span> != <b>null</b>)
            {
                <span class="r204 r">threadCommandProcessing</span>.<a href="#0b6335835e8fc533" class="i method">Stop</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> SetDebugMode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r205 r">mode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="f35a0133ac630b03" href="../../../R/f35a0133ac630b03.html" target="n" data-glyph="72,1" class="i method">SetDebugMode</a>(<a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a> <span id="r205 rd" class="r205 r">mode</span>)
        {
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#f6349f5fcfadd2ac" class="i method">SetDebugMode</a>(<span class="r205 r">mode</span>);
 
            <a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="k">base</a>.<a href="../../debugger/debugger.cs.html#f6349f5fcfadd2ac" class="i method">SetDebugMode</a>(<span class="r205 r">mode</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True when debugger is active with breakpoints.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override bool</b> <a id="f1b4b894b316fb35" href="../../../R/f1b4b894b316fb35.html" target="n" data-glyph="102,1" class="i property">IsActive</a>
        {
            <b>get</b>
            {
                <b>return</b> (<a href="#d42eeb2b7e0c5d95" class="i property">InBreakpoint</a> || <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#3d31ae79fb4a4117" class="i property">IsActive</a> || <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#564232f4b51d11aa" class="i property">InBreakpoint</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets debugger stepping mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r206 r">enabled</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if stepping is to be enabled.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="791457b5864612ab" href="../../../R/791457b5864612ab.html" target="n" data-glyph="72,1" class="i method">SetDebuggerStepMode</a>(<b>bool</b> <span id="r206 rd" class="r206 r">enabled</span>)
        {
            <span class="c">// Enable both the wrapper and wrapped debuggers for debugging before setting step mode.</span>
            <b>const</b> <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a> <span id="r207 rd" class="r207 r">mode</span> = <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#8f7455ad81a2c081" class="i field">LocalScript</a> | <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#36492991f477f6e1" class="i field">RemoteScript</a>;
            <a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="k">base</a>.<a href="../../debugger/debugger.cs.html#f6349f5fcfadd2ac" class="i method">SetDebugMode</a>(<span class="r207 r">mode</span>);
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#f6349f5fcfadd2ac" class="i method">SetDebugMode</a>(<span class="r207 r">mode</span>);
 
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#e33bfc6122759440" class="i method">SetDebuggerStepMode</a>(<span class="r206 r">enabled</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> InternalProcessCommand.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">output</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal override</b> <a href="../../debugger/debugger.cs.html#bcdf979426ef3d7b" class="t t">DebuggerCommand</a> <a id="a5c6dae98dee317b" href="../../../R/a5c6dae98dee317b.html" target="n" data-glyph="74,1" class="i method">InternalProcessCommand</a>(<b>string</b> <span id="r208 rd" class="r208 r">command</span>, <span class="i">IList</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r209 rd" class="r209 r">output</span>)
        {
            <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#e8d4b0c08ae40f99" class="i method">InternalProcessCommand</a>(<span class="r208 r">command</span>, <span class="r209 r">output</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets up debugger to debug provided job or its child jobs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r210 r">job</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Job object that is either a debuggable job or a container of</span>
        <span class="c">///</span><span class="c"> debuggable child jobs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r211 r">breakAll</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, the debugger automatically invokes a break all when it</span>
        <span class="c">///</span><span class="c"> attaches to the job.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="ad5a32ab8e83a2f3" href="../../../R/ad5a32ab8e83a2f3.html" target="n" data-glyph="74,1" class="i method">DebugJob</a>(<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r210 rd" class="r210 r">job</span>, <b>bool</b> <span id="r211 rd" class="r211 r">breakAll</span>) =&gt;
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#8291d202d10ef146" class="i method">DebugJob</a>(<span class="r210 r">job</span>, <span class="r211 r">breakAll</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes job from debugger job list and pops its</span>
        <span class="c">///</span><span class="c"> debugger from the active debugger stack.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r212 r">job</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Job.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="791e9f4d5ea30cfd" href="../../../R/791e9f4d5ea30cfd.html" target="n" data-glyph="74,1" class="i method">StopDebugJob</a>(<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r212 rd" class="r212 r">job</span>)
        {
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#b20cae9c467a1579" class="i method">StopDebugJob</a>(<span class="r212 r">job</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets up debugger to debug provided Runspace in a nested debug session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r213 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Runspace to debug.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r214 r">breakAll</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When true, this command will invoke a BreakAll when the debugger is</span>
        <span class="c">///</span><span class="c"> first attached.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="4c790878ac9e1ab9" href="../../../R/4c790878ac9e1ab9.html" target="n" data-glyph="74,1" class="i method">DebugRunspace</a>(<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r213 rd" class="r213 r">runspace</span>, <b>bool</b> <span id="r214 rd" class="r214 r">breakAll</span>)
        {
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#911e78d8ca74d76a" class="i method">DebugRunspace</a>(<span class="r213 r">runspace</span>, <span class="r214 r">breakAll</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes the provided Runspace from the nested &quot;active&quot; debugger state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r215 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Runspace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="5162f47ed3a9f3d9" href="../../../R/5162f47ed3a9f3d9.html" target="n" data-glyph="74,1" class="i method">StopDebugRunspace</a>(<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r215 rd" class="r215 r">runspace</span>)
        {
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#48e143f1e8d562d9" class="i method">StopDebugRunspace</a>(<span class="r215 r">runspace</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> IsPushed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override bool</b> <a id="467c52bb0a6d6c00" href="../../../R/467c52bb0a6d6c00.html" target="n" data-glyph="104,1" class="i property">IsPushed</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#970bc0159abf3265" class="i property">IsPushed</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> IsRemote.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override bool</b> <a id="69bf2dbb228ef39a" href="../../../R/69bf2dbb228ef39a.html" target="n" data-glyph="104,1" class="i property">IsRemote</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#a3dd72cb41dcad9b" class="i property">IsRemote</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> IsDebuggerSteppingEnabled.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override bool</b> <a id="103705e9ed88fa16" href="../../../R/103705e9ed88fa16.html" target="n" data-glyph="104,1" class="i property">IsDebuggerSteppingEnabled</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#a7f5757d8dc86cd0" class="i property">IsDebuggerSteppingEnabled</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> UnhandledBreakpointMode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override</b> <a href="../../debugger/debugger.cs.html#b3fa2b471807788d" class="t t">UnhandledBreakpointProcessingMode</a> <a id="e19d4ce806846ef8" href="../../../R/e19d4ce806846ef8.html" target="n" data-glyph="104,1" class="i property">UnhandledBreakpointMode</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#dbd829c531cef2cb" class="i property">UnhandledBreakpointMode</a>;
            }
 
            <b>set</b>
            {
                <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#dbd829c531cef2cb" class="i property">UnhandledBreakpointMode</a> = <b>value</b>;
                <b>if</b> (<b>value</b> == <a href="../../debugger/debugger.cs.html#b3fa2b471807788d" class="t t">UnhandledBreakpointProcessingMode</a>.<a href="../../debugger/debugger.cs.html#e18be175ebce8c0f" class="i field">Ignore</a> &amp;&amp;
                    <a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a>)
                {
                    <span class="c">// Release debugger stop hold.</span>
                    <a href="#697fb21490ae5cfd" class="i method">ExitDebugMode</a>(<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>.<a href="../../debugger/debugger.cs.html#c35cb32c2ab7ed0d" class="i field">Continue</a>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> IsPendingDebugStopEvent.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override bool</b> <a id="92af6eaad0994064" href="../../../R/92af6eaad0994064.html" target="n" data-glyph="104,1" class="i property">IsPendingDebugStopEvent</a>
        {
            <b>get</b> { <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#65fde7239c87ddf3" class="i property">IsPendingDebugStopEvent</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ReleaseSavedDebugStop.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="320ba66b09621201" href="../../../R/320ba66b09621201.html" target="n" data-glyph="74,1" class="i method">ReleaseSavedDebugStop</a>()
        {
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#a15389d72926a6cd" class="i method">ReleaseSavedDebugStop</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns IEnumerable of CallStackFrame objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">IEnumerable</span>&lt;<a href="../../debugger/debugger.cs.html#70d153384f134926" class="t t">CallStackFrame</a>&gt; <a id="c395d81cd3fdf1c5" href="../../../R/c395d81cd3fdf1c5.html" target="n" data-glyph="72,1" class="i method">GetCallStack</a>()
        {
            <b>return</b> <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#03b6be6c2122937e" class="i method">GetCallStack</a>();
        }
 
        <b>internal override void</b> <a id="8a7307eaa4a43c29" href="../../../R/8a7307eaa4a43c29.html" target="n" data-glyph="74,1" class="i method">Break</a>(<b>object</b> <span id="r216 rd" class="r216 r">triggerObject</span> = <b>null</b>)
        {
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#98454a0ebb421f34" class="i method">Break</a>(<span class="r216 r">triggerObject</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dispose.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="58c557c973139d5d" href="../../../R/58c557c973139d5d.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#e717866e2dacc5be" class="i method">RemoveDebuggerCallbacks</a>();
            <b>if</b> (<a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a>)
            {
                <a href="#697fb21490ae5cfd" class="i method">ExitDebugMode</a>(<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>.<a href="../../debugger/debugger.cs.html#9c143ec10eabd6ad" class="i field">Stop</a>);
            }
 
            <b>if</b> (<a href="#57cc92674e472335" class="i field">_nestedDebugStopCompleteEvent</a> != <b>null</b>)
            {
                <a href="#57cc92674e472335" class="i field">_nestedDebugStopCompleteEvent</a>.<span class="i">Dispose</span>();
            }
 
            <b>if</b> (<a href="#d521bb16ba8b5556" class="i field">_processCommandCompleteEvent</a> != <b>null</b>)
            {
                <a href="#d521bb16ba8b5556" class="i field">_processCommandCompleteEvent</a>.<span class="i">Dispose</span>();
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Classes
 
        <b>private sealed class</b> <a id="59303b327cb449bc" href="../../../R/59303b327cb449bc.html" target="n" data-glyph="4,1" class="t t">ThreadCommandProcessing</a>
        {
            <span class="c">// Members</span>
            <b>private readonly</b> <span class="i">ManualResetEventSlim</span> <a id="96d6fe754a12cf90" href="../../../R/96d6fe754a12cf90.html" target="n" data-glyph="46,2" class="i field">_commandCompleteEvent</a>;
            <b>private readonly</b> <a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <a id="e334fcd7e832de3f" href="../../../R/e334fcd7e832de3f.html" target="n" data-glyph="46,2" class="i field">_wrappedDebugger</a>;
            <b>private readonly</b> <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="4bc8076cbf53630d" href="../../../R/4bc8076cbf53630d.html" target="n" data-glyph="46,2" class="i field">_command</a>;
            <b>private readonly</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="6cc0349bcf76f78a" href="../../../R/6cc0349bcf76f78a.html" target="n" data-glyph="46,2" class="i field">_output</a>;
            <b>private</b> <a href="../../debugger/debugger.cs.html#279d714bfd5743f3" class="t t">DebuggerCommandResults</a> <a id="f2d1b3c288c3ee96" href="../../../R/f2d1b3c288c3ee96.html" target="n" data-glyph="46,2" class="i field">_results</a>;
            <b>private</b> <span class="i">Exception</span> <a id="a807a68de4a37a5c" href="../../../R/a807a68de4a37a5c.html" target="n" data-glyph="46,2" class="i field">_exception</a>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <b>private</b> <span class="i">WindowsIdentity</span> <a id="fd22a815f706b35e" href="../../../R/fd22a815f706b35e.html" target="n" data-glyph="46,2" class="i field">_identityToImpersonate</a>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
            <span class="c">// Constructors</span>
            <b>private</b> <a id="e4e1af0401bd4121" href="../../../R/../../0000000000.html" target="n" data-glyph="76,2" class="t constructor">ThreadCommandProcessing</a>() { }
 
            <b>public</b> <a id="fbd663ae4ed8609d" href="../../../R/fbd663ae4ed8609d.html" target="n" data-glyph="72,2" class="t constructor">ThreadCommandProcessing</a>(
                <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r217 rd" class="r217 r">command</span>,
                <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r218 rd" class="r218 r">output</span>,
                <a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <span id="r219 rd" class="r219 r">debugger</span>,
                <span class="i">ManualResetEventSlim</span> <span id="r220 rd" class="r220 r">processCommandCompleteEvent</span>)
            {
                <a href="#4bc8076cbf53630d" class="i field">_command</a> = <span class="r217 r">command</span>;
                <a href="#6cc0349bcf76f78a" class="i field">_output</a> = <span class="r218 r">output</span>;
                <a href="#e334fcd7e832de3f" class="i field">_wrappedDebugger</a> = <span class="r219 r">debugger</span>;
                <a href="#96d6fe754a12cf90" class="i field">_commandCompleteEvent</a> = <span class="r220 r">processCommandCompleteEvent</span>;
            }
 
            <span class="c">// Methods</span>
            <b>public</b> <a href="../../debugger/debugger.cs.html#279d714bfd5743f3" class="t t">DebuggerCommandResults</a> <a id="446b2bfd4ff2963b" href="../../../R/446b2bfd4ff2963b.html" target="n" data-glyph="72,2" class="i method">Invoke</a>(<span class="i">ManualResetEventSlim</span> <span id="r221 rd" class="r221 r">startInvokeEvent</span>)
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                <span class="c">// Get impersonation information to flow if any.</span>
                <a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../../Utils.cs.html#9b44ca7f35bc8c39" class="i method">TryGetWindowsImpersonatedIdentity</a>(<b>out</b> <a href="#fd22a815f706b35e" class="i field">_identityToImpersonate</a>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                <span class="c">// Signal thread to process command.</span>
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<a href="#96d6fe754a12cf90" class="i field">_commandCompleteEvent</a>.<span class="i">IsSet</span>, <span class="s">&quot;Command complete event shoulds always be non-signaled here.&quot;</span>);
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r221 r">startInvokeEvent</span>.<span class="i">IsSet</span>, <span class="s">&quot;The event should always be in non-signaled state here.&quot;</span>);
                <span class="r221 r">startInvokeEvent</span>.<span class="i">Set</span>();
 
                <span class="c">// Wait for completion.</span>
                <a href="#96d6fe754a12cf90" class="i field">_commandCompleteEvent</a>.<span class="i">Wait</span>();
                <a href="#96d6fe754a12cf90" class="i field">_commandCompleteEvent</a>.<span class="i">Reset</span>();
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                <b>if</b> (<a href="#fd22a815f706b35e" class="i field">_identityToImpersonate</a> != <b>null</b>)
                {
                    <a href="#fd22a815f706b35e" class="i field">_identityToImpersonate</a>.<span class="i">Dispose</span>();
                    <a href="#fd22a815f706b35e" class="i field">_identityToImpersonate</a> = <b>null</b>;
                }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                <span class="c">// Propagate exception.</span>
                <b>if</b> (<a href="#a807a68de4a37a5c" class="i field">_exception</a> != <b>null</b>)
                {
                    <b>throw</b> <a href="#a807a68de4a37a5c" class="i field">_exception</a>;
                }
 
                <span class="c">// Return command processing results.</span>
                <b>return</b> <a href="#f2d1b3c288c3ee96" class="i field">_results</a>;
            }
 
            <b>public void</b> <a id="0b6335835e8fc533" href="../../../R/0b6335835e8fc533.html" target="n" data-glyph="72,2" class="i method">Stop</a>()
            {
                <a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <span id="r222 rd" class="r222 r">debugger</span> = <a href="#e334fcd7e832de3f" class="i field">_wrappedDebugger</a>;
                <b>if</b> (<span class="r222 r">debugger</span> != <b>null</b>)
                {
                    <span class="r222 r">debugger</span>.<a href="../../debugger/debugger.cs.html#bcb115e0eda53c00" class="i method">StopProcessCommand</a>();
                }
            }
 
            <b>internal void</b> <a id="3f09cfe00fa89264" href="../../../R/3f09cfe00fa89264.html" target="n" data-glyph="74,2" class="i method">DoInvoke</a>()
            {
                <b>try</b>
                {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                    <b>if</b> (<a href="#fd22a815f706b35e" class="i field">_identityToImpersonate</a> != <b>null</b>)
                    {
                        <a href="#f2d1b3c288c3ee96" class="i field">_results</a> = <span class="i">WindowsIdentity</span>.<span class="i">RunImpersonated</span>(
                            <a href="#fd22a815f706b35e" class="i field">_identityToImpersonate</a>.<span class="i">AccessToken</span>,
                            () =&gt; <a href="#e334fcd7e832de3f" class="i field">_wrappedDebugger</a>.<a href="../../debugger/debugger.cs.html#f752da7b39207812" class="i method">ProcessCommand</a>(<a href="#4bc8076cbf53630d" class="i field">_command</a>, <a href="#6cc0349bcf76f78a" class="i field">_output</a>));
                        <b>return</b>;
                    }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
                    <a href="#f2d1b3c288c3ee96" class="i field">_results</a> = <a href="#e334fcd7e832de3f" class="i field">_wrappedDebugger</a>.<a href="../../debugger/debugger.cs.html#f752da7b39207812" class="i method">ProcessCommand</a>(<a href="#4bc8076cbf53630d" class="i field">_command</a>, <a href="#6cc0349bcf76f78a" class="i field">_output</a>);
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r223 rd" class="r223 r">e</span>)
                {
                    <a href="#a807a68de4a37a5c" class="i field">_exception</a> = <span class="r223 r">e</span>;
                }
                <b>finally</b>
                {
                    <a href="#96d6fe754a12cf90" class="i field">_commandCompleteEvent</a>.<span class="i">Set</span>();
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add Debugger suspend execution callback.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="488c914809175347" href="../../../R/488c914809175347.html" target="n" data-glyph="76,1" class="i method">SetDebuggerCallbacks</a>()
        {
            <b>if</b> (<a href="#78c680badad557e7" class="i field">_runspace</a> != <b>null</b> &amp;&amp;
                <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a> != <b>null</b> &amp;&amp;
                <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> != <b>null</b>)
            {
                <a href="#8e21318259ff23bb" class="i method">SubscribeWrappedDebugger</a>(<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>);
 
                <span class="c">// Register debugger events for remote forwarding.</span>
                <a href="../../EventManager.cs.html#88db4bace82161f0" class="k">var</a> <span id="r224 rd" class="r224 r">eventManager</span> = <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a>;
 
                <b>if</b> (!<span class="r224 r">eventManager</span>.<a href="../../EventManager.cs.html#a66bfc1310dd096f" class="i method">GetEventSubscribers</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#cac79a3f925f2c62" class="i field">RemoteDebuggerStopEvent</a>).<span class="i">GetEnumerator</span>().<span class="i">MoveNext</span>())
                {
                    <span class="r224 r">eventManager</span>.<a href="../../EventManager.cs.html#8ce2bd3a7289f055" class="i method">SubscribeEvent</a>(
                        <span class="r225 r">source</span>: <b>null</b>,
                        <span class="r226 r">eventName</span>: <b>null</b>,
                        <span class="r227 r">sourceIdentifier</span>: <a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#cac79a3f925f2c62" class="i field">RemoteDebuggerStopEvent</a>,
                        <span class="r228 r">data</span>: <b>null</b>,
                        <span class="r229 r">action</span>: <b>null</b>,
                        <span class="r230 r">supportEvent</span>: <b>true</b>,
                        <span class="r231 r">forwardEvent</span>: <b>true</b>);
                }
 
                <b>if</b> (!<span class="r224 r">eventManager</span>.<a href="../../EventManager.cs.html#a66bfc1310dd096f" class="i method">GetEventSubscribers</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#9073ab7796b6f405" class="i field">RemoteDebuggerBreakpointUpdatedEvent</a>).<span class="i">GetEnumerator</span>().<span class="i">MoveNext</span>())
                {
                    <span class="r224 r">eventManager</span>.<a href="../../EventManager.cs.html#8ce2bd3a7289f055" class="i method">SubscribeEvent</a>(
                        <span class="r225 r">source</span>: <b>null</b>,
                        <span class="r226 r">eventName</span>: <b>null</b>,
                        <span class="r227 r">sourceIdentifier</span>: <a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#9073ab7796b6f405" class="i field">RemoteDebuggerBreakpointUpdatedEvent</a>,
                        <span class="r228 r">data</span>: <b>null</b>,
                        <span class="r229 r">action</span>: <b>null</b>,
                        <span class="r230 r">supportEvent</span>: <b>true</b>,
                        <span class="r231 r">forwardEvent</span>: <b>true</b>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Remove the suspend execution callback.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="e717866e2dacc5be" href="../../../R/e717866e2dacc5be.html" target="n" data-glyph="76,1" class="i method">RemoveDebuggerCallbacks</a>()
        {
            <b>if</b> (<a href="#78c680badad557e7" class="i field">_runspace</a> != <b>null</b> &amp;&amp;
                <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a> != <b>null</b> &amp;&amp;
                <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> != <b>null</b>)
            {
                <a href="#5dd670ca5c852762" class="i method">UnsubscribeWrappedDebugger</a>(<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>);
 
                <span class="c">// Unregister debugger events for remote forwarding.</span>
                <a href="../../EventManager.cs.html#88db4bace82161f0" class="k">var</a> <span id="r232 rd" class="r232 r">eventManager</span> = <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a>;
 
                <b>foreach</b> (<b>var</b> <span id="r233 rd" class="r233 r">subscriber</span> <b>in</b> <span class="r232 r">eventManager</span>.<a href="../../EventManager.cs.html#a66bfc1310dd096f" class="i method">GetEventSubscribers</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#cac79a3f925f2c62" class="i field">RemoteDebuggerStopEvent</a>))
                {
                    <span class="r232 r">eventManager</span>.<span class="i">UnsubscribeEvent</span>(<span class="r233 r">subscriber</span>);
                }
 
                <b>foreach</b> (<b>var</b> <span id="r234 rd" class="r234 r">subscriber</span> <b>in</b> <span class="r232 r">eventManager</span>.<a href="../../EventManager.cs.html#a66bfc1310dd096f" class="i method">GetEventSubscribers</a>(<a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#9073ab7796b6f405" class="i field">RemoteDebuggerBreakpointUpdatedEvent</a>))
                {
                    <span class="r232 r">eventManager</span>.<span class="i">UnsubscribeEvent</span>(<span class="r234 r">subscriber</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler for debugger events.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="94f8aa75fb5717d7" href="../../../R/94f8aa75fb5717d7.html" target="n" data-glyph="76,1" class="i method">HandleDebuggerStop</a>(<b>object</b> <span id="r235 rd" class="r235 r">sender</span>, <a href="../../debugger/debugger.cs.html#13c865e6481e16a2" class="t t">DebuggerStopEventArgs</a> <span id="r236 rd" class="r236 r">e</span>)
        {
            <span class="c">// Ignore if we are in restricted mode.</span>
            <b>if</b> (!<a href="#daa9112a93e274cc" class="i method">IsDebuggingSupported</a>()) { <b>return</b>; }
 
            <b>if</b> (<a href="#d5a5d13efc580c8c" class="i property">LocalDebugMode</a>)
            {
                <span class="c">// Forward event locally.</span>
                <a href="../../debugger/debugger.cs.html#19eff05653875667" class="i method">RaiseDebuggerStopEvent</a>(<span class="r236 r">e</span>);
                <b>return</b>;
            }
 
            <b>if</b> ((<a href="../../debugger/debugger.cs.html#cb370f0b35bef91f" class="i property">DebugMode</a> &amp; <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#36492991f477f6e1" class="i field">RemoteScript</a>) != <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#36492991f477f6e1" class="i field">RemoteScript</a>)
            {
                <b>return</b>;
            }
 
            <a href="#cc2745789c4eca6f" class="i field">_debuggerStopEventArgs</a> = <span class="r236 r">e</span>;
            <a href="../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r237 rd" class="r237 r">contextHost</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="c">// Save current context remote host.</span>
                <span class="r237 r">contextHost</span> = <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="../../hostifaces/InternalHost.cs.html#f25431d0ab961179" class="i property">ExternalHost</a>;
 
                <span class="c">// Forward event to remote client.</span>
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#78c680badad557e7" class="i field">_runspace</a> != <b>null</b>, <span class="s">&quot;Runspace cannot be null.&quot;</span>);
                <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a>.<a href="../../EventManager.cs.html#dfff9a097c10a4e8" class="i method">GenerateEvent</a>(
                    <span class="r238 r">sourceIdentifier</span>: <a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#cac79a3f925f2c62" class="i field">RemoteDebuggerStopEvent</a>,
                    <span class="r239 r">sender</span>: <b>null</b>,
                    <span class="r240 r">args</span>: <b>new</b> <b>object</b>[] { <span class="r236 r">e</span> },
                    <span class="r241 r">extraData</span>: <b>null</b>);
 
                <span class="c">//</span>
                <span class="c">// Start the debug mode.  This is a blocking call and will return only</span>
                <span class="c">// after ExitDebugMode() is called.</span>
                <span class="c">//</span>
                <a href="#2264adff1c1e1b4d" class="i method">EnterDebugMode</a>(<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#970bc0159abf3265" class="i property">IsPushed</a>);
 
                <span class="c">// Restore original context remote host.</span>
                <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="../../hostifaces/InternalHost.cs.html#537447f36276d774" class="i method">SetHostRef</a>(<span class="r237 r">contextHost</span>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
            <b>finally</b>
            {
                <a href="#cc2745789c4eca6f" class="i field">_debuggerStopEventArgs</a> = <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> HandleBreakpointUpdated.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r242 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r243 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="a9663e5b20a1f9e1" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleBreakpointUpdated</a>(<b>object</b> <span id="r242 rd" class="r242 r">sender</span>, <a href="../../debugger/debugger.cs.html#6136821c0d0fb181" class="t t">BreakpointUpdatedEventArgs</a> <span id="r243 rd" class="r243 r">e</span>)
        {
            <span class="c">// Ignore if we are in restricted mode.</span>
            <b>if</b> (!<a href="#daa9112a93e274cc" class="i method">IsDebuggingSupported</a>()) { <b>return</b>; }
 
            <b>if</b> (<a href="#d5a5d13efc580c8c" class="i property">LocalDebugMode</a>)
            {
                <span class="c">// Forward event locally.</span>
                <a href="../../debugger/debugger.cs.html#8aab7ff30ec5430c" class="i method">RaiseBreakpointUpdatedEvent</a>(<span class="r243 r">e</span>);
                <b>return</b>;
            }
 
            <b>try</b>
            {
                <span class="c">// Forward event to remote client.</span>
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#78c680badad557e7" class="i field">_runspace</a> != <b>null</b>, <span class="s">&quot;Runspace cannot be null.&quot;</span>);
                <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#67642aa960214ec5" class="i property">Events</a>.<a href="../../EventManager.cs.html#dfff9a097c10a4e8" class="i method">GenerateEvent</a>(
                    <span class="r238 r">sourceIdentifier</span>: <a href="../client/remoterunspace.cs.html#89199d5c3f22d94e" class="t t">RemoteDebugger</a>.<a href="../client/remoterunspace.cs.html#9073ab7796b6f405" class="i field">RemoteDebuggerBreakpointUpdatedEvent</a>,
                    <span class="r239 r">sender</span>: <b>null</b>,
                    <span class="r240 r">args</span>: <b>new</b> <b>object</b>[] { <span class="r243 r">e</span> },
                    <span class="r241 r">extraData</span>: <b>null</b>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
        }
 
        <b>private void</b> <a id="5f305eb126d9467c" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleNestedDebuggingCancelEvent</a>(<b>object</b> <span id="r244 rd" class="r244 r">sender</span>, <span class="i">EventArgs</span> <span id="r245 rd" class="r245 r">e</span>)
        {
            <span class="c">// Forward cancel event from wrapped debugger.</span>
            <a href="../../debugger/debugger.cs.html#ee88acde413c3219" class="i method">RaiseNestedDebuggingCancelEvent</a>();
 
            <span class="c">// Release debugger.</span>
            <b>if</b> (<a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a>)
            {
                <a href="#697fb21490ae5cfd" class="i method">ExitDebugMode</a>(<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>.<a href="../../debugger/debugger.cs.html#c35cb32c2ab7ed0d" class="i field">Continue</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sends a DebuggerStop event to the client and enters a nested pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="2264adff1c1e1b4d" href="../../../R/2264adff1c1e1b4d.html" target="n" data-glyph="76,1" class="i method">EnterDebugMode</a>(<b>bool</b> <span id="r246 rd" class="r246 r">isNestedStop</span>)
        {
            <a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a> = <b>true</b>;
 
            <b>try</b>
            {
                <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#43944a89e7c10e43" class="i field">NestedPromptCounterVarPath</a>, 1);
 
                <b>if</b> (<span class="r246 r">isNestedStop</span>)
                {
                    <span class="c">// Blocking call for nested debugger execution (Debug-Runspace) stop events.</span>
                    <span class="c">// The root debugger never makes two EnterDebugMode calls without an ExitDebugMode.</span>
                    <b>if</b> (<a href="#57cc92674e472335" class="i field">_nestedDebugStopCompleteEvent</a> == <b>null</b>)
                    {
                        <a href="#57cc92674e472335" class="i field">_nestedDebugStopCompleteEvent</a> = <b>new</b> <span class="i">ManualResetEventSlim</span>(<b>false</b>);
                    }
 
                    <a href="#00780918ba3c07f8" class="i field">_nestedDebugging</a> = <b>true</b>;
                    <a href="#c5f6ec71db585915" class="i method">OnEnterDebugMode</a>(<a href="#57cc92674e472335" class="i field">_nestedDebugStopCompleteEvent</a>);
                }
                <b>else</b>
                {
                    <span class="c">// Blocking call.</span>
                    <span class="c">// Process all client commands as nested until nested pipeline is exited at</span>
                    <span class="c">// which point this call returns.</span>
                    <a href="#7b4a675544ac6e62" class="i field">_driverInvoker</a>.<a href="#a1bf394f83373b32" class="i method">EnterNestedPipeline</a>();
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
            <b>finally</b>
            {
                <a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a> = <b>false</b>;
                <a href="#00780918ba3c07f8" class="i field">_nestedDebugging</a> = <b>false</b>;
            }
 
            <span class="c">// Check to see if we should re-raise the stop event locally.</span>
            <b>if</b> (<a href="#f0041560bf25a0a2" class="i field">_raiseStopEventLocally</a>)
            {
                <a href="#f0041560bf25a0a2" class="i field">_raiseStopEventLocally</a> = <b>false</b>;
                <a href="#d5a5d13efc580c8c" class="i property">LocalDebugMode</a> = <b>true</b>;
                <a href="#94f8aa75fb5717d7" class="i method">HandleDebuggerStop</a>(<a href="#659f74f76b5af7db" class="k">this</a>, <a href="#cc2745789c4eca6f" class="i field">_debuggerStopEventArgs</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Blocks DebuggerStop event thread until exit debug mode is</span>
        <span class="c">///</span><span class="c"> received from the client.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="c5f6ec71db585915" href="../../../R/c5f6ec71db585915.html" target="n" data-glyph="76,1" class="i method">OnEnterDebugMode</a>(<span class="i">ManualResetEventSlim</span> <span id="r247 rd" class="r247 r">debugModeCompletedEvent</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<span class="r247 r">debugModeCompletedEvent</span>.<span class="i">IsSet</span>, <span class="s">&quot;Event should always be non-signaled here.&quot;</span>);
 
            <b>while</b> (<b>true</b>)
            {
                <span class="r247 r">debugModeCompletedEvent</span>.<span class="i">Wait</span>();
                <span class="r247 r">debugModeCompletedEvent</span>.<span class="i">Reset</span>();
 
                <b>if</b> (<a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a> != <b>null</b>)
                {
                    <span class="c">// Process command.</span>
                    <a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a>.<a href="#3f09cfe00fa89264" class="i method">DoInvoke</a>();
                    <a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a> = <b>null</b>;
                }
                <b>else</b>
                {
                    <span class="c">// No command to process.  Exit debug mode.</span>
                    <b>break</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Exits the server side nested pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="697fb21490ae5cfd" href="../../../R/697fb21490ae5cfd.html" target="n" data-glyph="76,1" class="i method">ExitDebugMode</a>(<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a> <span id="r248 rd" class="r248 r">resumeAction</span>)
        {
            <a href="#cc2745789c4eca6f" class="i field">_debuggerStopEventArgs</a>.<a href="../../debugger/debugger.cs.html#b6941352f3c2c41c" class="i property">ResumeAction</a> = <span class="r248 r">resumeAction</span>;
 
            <b>try</b>
            {
                <b>if</b> (<a href="#00780918ba3c07f8" class="i field">_nestedDebugging</a>)
                {
                    <span class="c">// Release nested debugger.</span>
                    <a href="#57cc92674e472335" class="i field">_nestedDebugStopCompleteEvent</a>.<span class="i">Set</span>();
                }
                <b>else</b>
                {
                    <span class="c">// Release EnterDebugMode blocking call.</span>
                    <a href="#7b4a675544ac6e62" class="i field">_driverInvoker</a>.<a href="#f8279313a177348d" class="i method">ExitNestedPipeline</a>();
                }
 
                <a href="#78c680badad557e7" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#43944a89e7c10e43" class="i field">NestedPromptCounterVarPath</a>, 0);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
        }
 
        <b>private void</b> <a id="8e21318259ff23bb" href="../../../R/8e21318259ff23bb.html" target="n" data-glyph="76,1" class="i method">SubscribeWrappedDebugger</a>(<a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <span id="r249 rd" class="r249 r">wrappedDebugger</span>)
        {
            <span class="r249 r">wrappedDebugger</span>.<a href="../../debugger/debugger.cs.html#4cf8436684b1ce9c" class="i">DebuggerStop</a> += <span class="i">HandleDebuggerStop</span>;
            <span class="r249 r">wrappedDebugger</span>.<a href="../../debugger/debugger.cs.html#373cb831745ae38e" class="i">BreakpointUpdated</a> += <span class="i">HandleBreakpointUpdated</span>;
            <span class="r249 r">wrappedDebugger</span>.<a href="../../debugger/debugger.cs.html#7269ef04c257bd3a" class="i">NestedDebuggingCancelledEvent</a> += <span class="i">HandleNestedDebuggingCancelEvent</span>;
        }
 
        <b>private void</b> <a id="5dd670ca5c852762" href="../../../R/5dd670ca5c852762.html" target="n" data-glyph="76,1" class="i method">UnsubscribeWrappedDebugger</a>(<a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <span id="r250 rd" class="r250 r">wrappedDebugger</span>)
        {
            <span class="r250 r">wrappedDebugger</span>.<a href="../../debugger/debugger.cs.html#4cf8436684b1ce9c" class="i">DebuggerStop</a> -= <span class="i">HandleDebuggerStop</span>;
            <span class="r250 r">wrappedDebugger</span>.<a href="../../debugger/debugger.cs.html#373cb831745ae38e" class="i">BreakpointUpdated</a> -= <span class="i">HandleBreakpointUpdated</span>;
            <span class="r250 r">wrappedDebugger</span>.<a href="../../debugger/debugger.cs.html#7269ef04c257bd3a" class="i">NestedDebuggingCancelledEvent</a> -= <span class="i">HandleNestedDebuggingCancelEvent</span>;
        }
 
        <b>private bool</b> <a id="daa9112a93e274cc" href="../../../R/daa9112a93e274cc.html" target="n" data-glyph="76,1" class="i method">IsDebuggingSupported</a>()
        {
            <span class="c">// Restriction only occurs on a (non-pushed) local runspace.</span>
            <a href="../../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a> <span id="r251 rd" class="r251 r">localRunspace</span> = <a href="#78c680badad557e7" class="i field">_runspace</a> <b>as</b> <a href="../../../P/6fffd57173d247a6.html#6fffd57173d247a6" class="t t">LocalRunspace</a>;
            <b>if</b> (<span class="r251 r">localRunspace</span> != <b>null</b>)
            {
                <a href="../../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r252 rd" class="r252 r">cmdletInfo</span> = <span class="r251 r">localRunspace</span>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../../SessionStateCmdletAPIs.cs.html#d35de093b2cd3f4f" class="i method">GetCmdlet</a>(<a href="#568f5c2973faeac4" class="i field">SetPSBreakCommandText</a>);
                <b>if</b> ((<span class="r252 r">cmdletInfo</span> != <b>null</b>) &amp;&amp; (<span class="r252 r">cmdletInfo</span>.<a href="../../CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> != <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>))
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> HandleStopSignal.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if stop signal is handled.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="529b18299d83faa1" href="../../../R/529b18299d83faa1.html" target="n" data-glyph="74,1" class="i method">HandleStopSignal</a>()
        {
            <span class="c">// If in pushed mode then stop any running command.</span>
            <b>if</b> (<a href="#467c52bb0a6d6c00" class="i property">IsPushed</a> &amp;&amp; (<a href="#e4d822da80c08ab3" class="i field">_threadCommandProcessing</a> != <b>null</b>))
            {
                <a href="#35b64d9e0b9bba15" class="i method">StopProcessCommand</a>();
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// Set debug mode to &quot;None&quot; so that current command can stop and not</span>
            <span class="c">// potentially not respond in a debugger stop.  Use RestoreDebugger() to</span>
            <span class="c">// restore debugger to original mode.</span>
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#f6349f5fcfadd2ac" class="i method">SetDebugMode</a>(<a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#a52ed56edd63c7ff" class="i field">None</a>);
            <b>if</b> (<a href="#d42eeb2b7e0c5d95" class="i property">InBreakpoint</a>)
            {
                <b>try</b>
                {
                    <a href="#c4e359db34b672b7" class="i method">SetDebuggerAction</a>(<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>.<a href="../../debugger/debugger.cs.html#c35cb32c2ab7ed0d" class="i field">Continue</a>);
                }
                <b>catch</b> (<a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a>) { }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">// Sets the wrapped debugger to the same mode as the wrapper</span>
        <span class="c">// server remote debugger, enabling it if remote debugging is enabled.</span>
        <b>internal void</b> <a id="9df35e992ceafa8d" href="../../../R/9df35e992ceafa8d.html" target="n" data-glyph="74,1" class="i method">CheckDebuggerState</a>()
        {
            <b>if</b> ((<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#cb370f0b35bef91f" class="i property">DebugMode</a> == <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#a52ed56edd63c7ff" class="i field">None</a> &amp;&amp;
                (<a href="../../debugger/debugger.cs.html#cb370f0b35bef91f" class="i property">DebugMode</a> &amp; <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#36492991f477f6e1" class="i field">RemoteScript</a>) == <a href="../../debugger/debugger.cs.html#7e71da719f103cfd" class="t t">DebugModes</a>.<a href="../../debugger/debugger.cs.html#36492991f477f6e1" class="i field">RemoteScript</a>))
            {
                <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../debugger/debugger.cs.html#f6349f5fcfadd2ac" class="i method">SetDebugMode</a>(<a href="../../debugger/debugger.cs.html#cb370f0b35bef91f" class="i property">DebugMode</a>);
            }
        }
 
        <b>internal void</b> <a id="704bf689056c2249" href="../../../R/704bf689056c2249.html" target="n" data-glyph="74,1" class="i method">StartPowerShellCommand</a>(
            <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r253 rd" class="r253 r">powershell</span>,
            <span class="i">Guid</span> <span id="r254 rd" class="r254 r">powershellId</span>,
            <span class="i">Guid</span> <span id="r255 rd" class="r255 r">runspacePoolId</span>,
            <a href="#a13c57c874abb0c5" class="t t">ServerRunspacePoolDriver</a> <span id="r256 rd" class="r256 r">runspacePoolDriver</span>,
            <span class="i">ApartmentState</span> <span id="r257 rd" class="r257 r">apartmentState</span>,
            <a href="ServerRemoteHost.cs.html#ecbb655f955c09fc" class="t t">ServerRemoteHost</a> <span id="r258 rd" class="r258 r">remoteHost</span>,
            <a href="../common/WireDataFormat/RemoteSessionCapability.cs.html#4fc7c4b336de518c" class="t t">HostInfo</a> <span id="r259 rd" class="r259 r">hostInfo</span>,
            <a href="../../hostifaces/PowerShell.cs.html#3a466dc47c692c8e" class="t t">RemoteStreamOptions</a> <span id="r260 rd" class="r260 r">streamOptions</span>,
            <b>bool</b> <span id="r261 rd" class="r261 r">addToHistory</span>)
        {
            <span class="c">// For nested debugger command processing, invoke command on new local runspace since</span>
            <span class="c">// the root script debugger runspace is unavailable (it is running a PS script).</span>
            <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r262 rd" class="r262 r">runspace</span> = (<span class="r258 r">remoteHost</span> != <b>null</b>) ?
                <a href="../../hostifaces/ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="../../hostifaces/ConnectionFactory.cs.html#68ee9f57341809d0" class="i method">CreateRunspace</a>(<span class="r258 r">remoteHost</span>) : <a href="../../hostifaces/ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="../../hostifaces/ConnectionFactory.cs.html#d1898b5d69d8413b" class="i method">CreateRunspace</a>();
 
            <span class="r262 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#61f55439fb78f2fe" class="i method">Open</a>();
 
            <b>try</b>
            {
                <span class="r253 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#c66682d1287920a2" class="i">InvocationStateChanged</a> += <span class="i">HandlePowerShellInvocationStateChanged</span>;
                <span class="r253 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#ca9abcd81cc054f5" class="i method">SetIsNested</a>(<b>false</b>);
 
                <b>const string</b> <span id="r263 rd" class="r263 r">script</span> = <span class="s">@&quot;
                    param ($Debugger, $Commands, $output)
                    trap { throw $_ }
 
                    $Debugger.ProcessCommand($Commands, $output)
                    &quot;</span>;
 
                <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r264 rd" class="r264 r">output</span> = <b>new</b> <a href="../../hostifaces/PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r265 rd" class="r265 r">Commands</span> = <b>new</b> <a href="../../hostifaces/PSCommand.cs.html#0a3bdaec647d4523" class="t constructor">PSCommand</a>(<span class="r253 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>);
                <span class="r253 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>.<a href="../../hostifaces/PSCommand.cs.html#15970659c9fe6157" class="i method">Clear</a>();
                <span class="r253 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#c97f8d15a2f93e31" class="i method">AddScript</a>(<span class="r263 r">script</span>).<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Debugger&quot;</span>, <a href="#659f74f76b5af7db" class="k">this</a>).<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Commands&quot;</span>, <span class="r265 r">Commands</span>).<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;output&quot;</span>, <span class="r264 r">output</span>);
                <a href="ServerPowerShellDriver.cs.html#01c478dd3d4d317b" class="t t">ServerPowerShellDriver</a> <span id="r266 rd" class="r266 r">driver</span> = <b>new</b> <a href="ServerPowerShellDriver.cs.html#e4fa03ed95a60f62" class="t constructor">ServerPowerShellDriver</a>(
                    <span class="r253 r">powershell</span>,
                    <b>null</b>,
                    <b>true</b>,
                    <span class="r254 r">powershellId</span>,
                    <span class="r255 r">runspacePoolId</span>,
                    <span class="r256 r">runspacePoolDriver</span>,
                    <span class="r257 r">apartmentState</span>,
                    <span class="r259 r">hostInfo</span>,
                    <span class="r260 r">streamOptions</span>,
                    <span class="r261 r">addToHistory</span>,
                    <span class="r262 r">runspace</span>,
                    <span class="r264 r">output</span>);
 
                <span class="r266 r">driver</span>.<a href="ServerPowerShellDriver.cs.html#a712659a5bf2b683" class="i method">Start</a>();
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="r262 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#e7b6aa3b7b07847b" class="i method">Close</a>();
                <span class="r262 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#47cd985e55a9f99c" class="i method">Dispose</a>();
            }
        }
 
        <b>private void</b> <a id="06282b87192ca4a5" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandlePowerShellInvocationStateChanged</a>(<b>object</b> <span id="r267 rd" class="r267 r">sender</span>, <a href="../../hostifaces/PowerShell.cs.html#b125d9adbaf88d43" class="t t">PSInvocationStateChangedEventArgs</a> <span id="r268 rd" class="r268 r">e</span>)
        {
            <b>if</b> (<span class="r268 r">e</span>.<a href="../../hostifaces/PowerShell.cs.html#7ec9f6a06e861118" class="i property">InvocationStateInfo</a>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#89ec15a2a933a2b6" class="i field">Completed</a> ||
                <span class="r268 r">e</span>.<a href="../../hostifaces/PowerShell.cs.html#7ec9f6a06e861118" class="i property">InvocationStateInfo</a>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#6a6866e7df063875" class="i field">Stopped</a> ||
                <span class="r268 r">e</span>.<a href="../../hostifaces/PowerShell.cs.html#7ec9f6a06e861118" class="i property">InvocationStateInfo</a>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#35065a8449cad351" class="i field">Failed</a>)
            {
                <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r269 rd" class="r269 r">powershell</span> = <span class="r267 r">sender</span> <b>as</b> <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>;
                <span class="r269 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#c66682d1287920a2" class="i">InvocationStateChanged</a> -= <span class="i">HandlePowerShellInvocationStateChanged</span>;
 
                <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r270 rd" class="r270 r">runspace</span> = <span class="r269 r">powershell</span>.<a href="../../hostifaces/PowerShell.cs.html#503345e404ed0ddb" class="i method">GetRunspaceConnection</a>() <b>as</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>;
                <span class="r270 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#e7b6aa3b7b07847b" class="i method">Close</a>();
                <span class="r270 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#47cd985e55a9f99c" class="i method">Dispose</a>();
            }
        }
 
        <b>internal int</b> <a id="daa87d41d976afc8" href="../../../R/daa87d41d976afc8.html" target="n" data-glyph="74,1" class="i method">GetBreakpointCount</a>()
        {
            <a href="../../debugger/debugger.cs.html#0d95bb604662e23b" class="t t">ScriptDebugger</a> <span id="r271 rd" class="r271 r">scriptDebugger</span> = <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> <b>as</b> <a href="../../debugger/debugger.cs.html#0d95bb604662e23b" class="t t">ScriptDebugger</a>;
            <b>if</b> (<span class="r271 r">scriptDebugger</span> != <b>null</b>)
            {
                <b>return</b> <span class="r271 r">scriptDebugger</span>.<a href="../../debugger/debugger.cs.html#00ff38e404c12712" class="i method">GetBreakpoints</a>().<span class="i">Count</span>;
            }
            <b>else</b>
            {
                <b>return</b> 0;
            }
        }
 
        <b>internal void</b> <a id="c51125f0992faed4" href="../../../R/c51125f0992faed4.html" target="n" data-glyph="74,1" class="i method">PushDebugger</a>(<a href="../../debugger/debugger.cs.html#9e8f0b396592e65c" class="t t">Debugger</a> <span id="r272 rd" class="r272 r">debugger</span>)
        {
            <b>if</b> (<span class="r272 r">debugger</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r272 r">debugger</span>.<span class="i">Equals</span>(<a href="#659f74f76b5af7db" class="k">this</a>))
            {
                <b>throw</b> <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="i">DebuggerStrings</span>.<span class="i">RemoteServerDebuggerCannotPushSelf</span>);
            }
 
            <b>if</b> (<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#95f316ccb41731c0" class="i property">IsOverridden</a>)
            {
                <b>throw</b> <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="i">DebuggerStrings</span>.<span class="i">RemoteServerDebuggerAlreadyPushed</span>);
            }
 
            <span class="c">// Swap wrapped debugger.</span>
            <a href="#5dd670ca5c852762" class="i method">UnsubscribeWrappedDebugger</a>(<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>);
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#941ac12701f37148" class="i method">Override</a>(<span class="r272 r">debugger</span>);
            <a href="#8e21318259ff23bb" class="i method">SubscribeWrappedDebugger</a>(<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>);
        }
 
        <b>internal void</b> <a id="ddb094267d4f7041" href="../../../R/ddb094267d4f7041.html" target="n" data-glyph="74,1" class="i method">PopDebugger</a>()
        {
            <b>if</b> (!<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#95f316ccb41731c0" class="i property">IsOverridden</a>) { <b>return</b>; }
 
            <span class="c">// Swap wrapped debugger.</span>
            <a href="#5dd670ca5c852762" class="i method">UnsubscribeWrappedDebugger</a>(<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>);
            <a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#654ec503632ba849" class="i method">Revert</a>();
            <a href="#8e21318259ff23bb" class="i method">SubscribeWrappedDebugger</a>(<a href="#4a2f92996a494077" class="i field">_wrappedDebugger</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>);
        }
 
        <b>internal void</b> <a id="30804be080ac34ba" href="../../../R/30804be080ac34ba.html" target="n" data-glyph="74,1" class="i method">ReleaseAndRaiseDebugStopLocal</a>()
        {
            <b>if</b> (<a href="#a86c63f25f84d09a" class="i field">_inDebugMode</a>)
            {
                <span class="c">// Release debugger stop and signal to re-raise locally.</span>
                <a href="#f0041560bf25a0a2" class="i field">_raiseStopEventLocally</a> = <b>true</b>;
                <a href="#697fb21490ae5cfd" class="i method">ExitDebugMode</a>(<a href="../../debugger/debugger.cs.html#470618169485a70e" class="t t">DebuggerResumeAction</a>.<a href="../../debugger/debugger.cs.html#c35cb32c2ab7ed0d" class="i field">Continue</a>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When true, this debugger is being used for local debugging (not remote debugging)</span>
        <span class="c">///</span><span class="c"> via the Debug-Runspace cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="d5a5d13efc580c8c" href="../../../R/d5a5d13efc580c8c.html" target="n" data-glyph="104,1" class="i property">LocalDebugMode</a>
        {
            <b>get</b>;
            <b>set</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
