<!DOCTYPE html>
<html><head><title>RemoteHost.cs</title><link rel="stylesheet" href="../../../../../styles.css"><script src="../../../../../scripts.js"></script></head>
<body class="cB" onload="i(754);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/common/WireDataFormat/RemoteHost.cs" target="_top">engine\remoting\common\WireDataFormat\RemoteHost.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
<b>using</b> <span class="t">InternalHostUserInterface</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>.<span class="i n">Host</span>.<a href="../../../../P/660d078b9d606b70.html#660d078b9d606b70" class="t t">InternalHostUserInterface</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Executes methods; can be encoded and decoded for transmission over the</span>
    <span class="c">///</span><span class="c"> wire.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="8bf334b011b63f92" href="../../../../R/8bf334b011b63f92.html" target="n" data-glyph="2,0" class="t t">RemoteHostCall</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Method name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="cc5bdf3d9d8c8c3c" href="../../../../R/cc5bdf3d9d8c8c3c.html" target="n" data-glyph="104,1" class="i property">MethodName</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#62a8265301fe6e7d" class="i property">Name</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Method id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <a id="ae2b32ca6a58c395" href="../../../../R/ae2b32ca6a58c395.html" target="n" data-glyph="104,1" class="i property">MethodId</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal object</b>[] <a id="dc67498da08dd536" href="../../../../R/dc67498da08dd536.html" target="n" data-glyph="104,1" class="i property">Parameters</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Method info.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a> <a id="5f58bc6ec4a7e884" href="../../../../R/5f58bc6ec4a7e884.html" target="n" data-glyph="46,1" class="i field">_methodInfo</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Call id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly long</b> <a id="18c87bb0366ee00a" href="../../../../R/18c87bb0366ee00a.html" target="n" data-glyph="46,1" class="i field">_callId</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Call id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal long</b> <a id="ed3a8d27765a7622" href="../../../../R/ed3a8d27765a7622.html" target="n" data-glyph="104,1" class="i property">CallId</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#18c87bb0366ee00a" class="i field">_callId</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Computer name to be used in messages.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b> <a id="567eae48a76e5fc5" href="../../../../R/567eae48a76e5fc5.html" target="n" data-glyph="46,1" class="i field">_computerName</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for RemoteHostCall.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="ae7359eca9759275" href="../../../../R/ae7359eca9759275.html" target="n" data-glyph="74,1" class="t constructor">RemoteHostCall</a>(<b>long</b> <span id="r0 rd" class="r0 r">callId</span>, <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <span id="r1 rd" class="r1 r">methodId</span>, <b>object</b>[] <span id="r2 rd" class="r2 r">parameters</span>)
        {
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r2 r">parameters</span> != <b>null</b>, <span class="s">&quot;Expected parameters != null&quot;</span>);
            <a href="#18c87bb0366ee00a" class="i field">_callId</a> = <span class="r0 r">callId</span>;
            <a href="#ae2b32ca6a58c395" class="i property">MethodId</a> = <span class="r1 r">methodId</span>;
            <a href="#dc67498da08dd536" class="i property">Parameters</a> = <span class="r2 r">parameters</span>;
            <a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a> = <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#4ed80f518be319e9" class="i method">LookUp</a>(<span class="r1 r">methodId</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="c6c7649492460ff8" href="../../../../R/c6c7649492460ff8.html" target="n" data-glyph="76,1" class="i method">EncodeParameters</a>(<b>object</b>[] <span id="r3 rd" class="r3 r">parameters</span>)
        {
            <span class="c">// Encode the parameters and wrap the array into an ArrayList and then into a PSObject.</span>
            <span class="i">ArrayList</span> <span id="r4 rd" class="r4 r">parameterList</span> = <b>new</b> <span class="i">ArrayList</span>();
            <b>for</b> (<b>int</b> <span id="r5 rd" class="r5 r">i</span> = 0; <span class="r5 r">i</span> &lt; <span class="r3 r">parameters</span>.<span class="i">Length</span>; ++<span class="r5 r">i</span>)
            {
                <b>object</b> <span id="r6 rd" class="r6 r">parameter</span> = <span class="r3 r">parameters</span>[<span class="r5 r">i</span>] == <b>null</b> ? <b>null</b> : <a href="RemoteHostEncoder.cs.html#f99e89fafaac33f0" class="t t">RemoteHostEncoder</a>.<a href="RemoteHostEncoder.cs.html#7c8e1a4e8e4ec484" class="i method">EncodeObject</a>(<span class="r3 r">parameters</span>[<span class="r5 r">i</span>]);
                <span class="r4 r">parameterList</span>.<span class="i">Add</span>(<span class="r6 r">parameter</span>);
            }
 
            <b>return</b> <b>new</b> <span class="t">PSObject</span>(<span class="r4 r">parameterList</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Decode parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static object</b>[] <a id="e6a0abb5e284f834" href="../../../../R/e6a0abb5e284f834.html" target="n" data-glyph="76,1" class="i method">DecodeParameters</a>(<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r7 rd" class="r7 r">parametersPSObject</span>, <span class="i">Type</span>[] <span id="r8 rd" class="r8 r">parameterTypes</span>)
        {
            <span class="c">// Extract the ArrayList and decode the parameters.</span>
            <span class="i">ArrayList</span> <span id="r9 rd" class="r9 r">parameters</span> = (<span class="i">ArrayList</span>)<span class="r7 r">parametersPSObject</span>.<a href="../../../MshObject.cs.html#d854d13536b70a12" class="i property">BaseObject</a>;
            <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r10 rd" class="r10 r">decodedParameters</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r9 r">parameters</span>.<span class="i">Count</span> == <span class="r8 r">parameterTypes</span>.<span class="i">Length</span>, <span class="s">&quot;Expected parameters.Count == parameterTypes.Length&quot;</span>);
            <b>for</b> (<b>int</b> <span id="r11 rd" class="r11 r">i</span> = 0; <span class="r11 r">i</span> &lt; <span class="r9 r">parameters</span>.<span class="i">Count</span>; ++<span class="r11 r">i</span>)
            {
                <b>object</b> <span id="r12 rd" class="r12 r">parameter</span> = <span class="r9 r">parameters</span>[<span class="r11 r">i</span>] == <b>null</b> ? <b>null</b> : <a href="RemoteHostEncoder.cs.html#f99e89fafaac33f0" class="t t">RemoteHostEncoder</a>.<span class="i">DecodeObject</span>(<span class="r9 r">parameters</span>[<span class="r11 r">i</span>], <span class="r8 r">parameterTypes</span>[<span class="r11 r">i</span>]);
                <span class="r10 r">decodedParameters</span>.<span class="i">Add</span>(<span class="r12 r">parameter</span>);
            }
 
            <b>return</b> <span class="r10 r">decodedParameters</span>.<span class="i">ToArray</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="855168f47ac0d666" href="../../../../R/855168f47ac0d666.html" target="n" data-glyph="74,1" class="i method">Encode</a>()
        {
            <span class="c">// Add all host information as data.</span>
            <a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r13 rd" class="r13 r">data</span> = <a href="EncodeAndDecode.cs.html#88b19073d823ce05" class="t t">RemotingEncoder</a>.<a href="EncodeAndDecode.cs.html#22d9fb1506026254" class="i method">CreateEmptyPSObject</a>();
 
            <span class="c">// Encode the parameters for transport.</span>
            <a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r14 rd" class="r14 r">parametersPSObject</span> = <a href="#c6c7649492460ff8" class="i method">EncodeParameters</a>(<a href="#dc67498da08dd536" class="i property">Parameters</a>);
 
            <span class="c">// Embed everything into the main PSobject.</span>
            <span class="r13 r">data</span>.<a href="../../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../../../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../../../MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>, <a href="#18c87bb0366ee00a" class="i field">_callId</a>));
            <span class="r13 r">data</span>.<a href="../../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../../../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <span class="t">PSNoteProperty</span>(<a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#870eec6850f45e8d" class="i field">MethodId</a>, <a href="#ae2b32ca6a58c395" class="i property">MethodId</a>));
            <span class="r13 r">data</span>.<a href="../../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../../../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../../../MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#c7505e0840c4ff0c" class="i field">MethodParameters</a>, <span class="r14 r">parametersPSObject</span>));
 
            <b>return</b> <span class="r13 r">data</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Decode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#8bf334b011b63f92" class="t t">RemoteHostCall</a> <a id="c603556c125f7c63" href="../../../../R/c603556c125f7c63.html" target="n" data-glyph="74,1" class="i method">Decode</a>(<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r15 rd" class="r15 r">data</span>)
        {
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r15 r">data</span> != <b>null</b>, <span class="s">&quot;Expected data != null&quot;</span>);
 
            <span class="c">// Extract all the fields from data.</span>
            <b>long</b> <span id="r16 rd" class="r16 r">callId</span> = <a href="EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<b>long</b>&gt;(<span class="r15 r">data</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>);
            <a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r17 rd" class="r17 r">parametersPSObject</span> = <a href="EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="r15 r">data</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#c7505e0840c4ff0c" class="i field">MethodParameters</a>);
            <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <span id="r18 rd" class="r18 r">methodId</span> = <a href="EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>&gt;(<span class="r15 r">data</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#870eec6850f45e8d" class="i field">MethodId</a>);
 
            <span class="c">// Look up all the info related to the method.</span>
            <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a> <span id="r19 rd" class="r19 r">methodInfo</span> = <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#4ed80f518be319e9" class="i method">LookUp</a>(<span class="r18 r">methodId</span>);
 
            <span class="c">// Decode the parameters.</span>
            <b>object</b>[] <span id="r20 rd" class="r20 r">parameters</span> = <a href="#e6a0abb5e284f834" class="i method">DecodeParameters</a>(<span class="r17 r">parametersPSObject</span>, <span class="r19 r">methodInfo</span>.<a href="../../host/RemoteHostMethodInfo.cs.html#39b8c938aa79127b" class="i property">ParameterTypes</a>);
 
            <span class="c">// Create and return the RemoteHostCall.</span>
            <b>return</b> <b>new</b> <a href="#ae7359eca9759275" class="t constructor">RemoteHostCall</a>(<span class="r16 r">callId</span>, <span class="r18 r">methodId</span>, <span class="r20 r">parameters</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is void method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="37efb27cec7c978c" href="../../../../R/37efb27cec7c978c.html" target="n" data-glyph="104,1" class="i property">IsVoidMethod</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#c4914134ebd685b7" class="i property">ReturnType</a> == <b>typeof</b>(<b>void</b>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Execute void method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="400d83762dea851d" href="../../../../R/400d83762dea851d.html" target="n" data-glyph="74,1" class="i method">ExecuteVoidMethod</a>(<a href="../../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r21 rd" class="r21 r">clientHost</span>)
        {
            <span class="c">// The clientHost can be null if the user creates a runspace object without providing</span>
            <span class="c">// a host parameter.</span>
            <b>if</b> (<span class="r21 r">clientHost</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <a href="../../client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r22 rd" class="r22 r">remoteRunspaceToClose</span> = <b>null</b>;
            <b>if</b> (<a href="#8bf334b011b63f92" class="k">this</a>.<a href="#2ec0539bd534e4b8" class="i property">IsSetShouldExitOrPopRunspace</a>)
            {
                <span class="r22 r">remoteRunspaceToClose</span> = <a href="#5941d133db56a6fc" class="i method">GetRemoteRunspaceToClose</a>(<span class="r21 r">clientHost</span>);
            }
 
            <b>try</b>
            {
                <b>object</b> <span id="r23 rd" class="r23 r">targetObject</span> = <a href="#8bf334b011b63f92" class="k">this</a>.<a href="#6b9d237738fb3cca" class="i method">SelectTargetObject</a>(<span class="r21 r">clientHost</span>);
                <a href="#9af9fb3c85760c23" class="i property">MyMethodBase</a>.<span class="i">Invoke</span>(<span class="r23 r">targetObject</span>, <a href="#dc67498da08dd536" class="i property">Parameters</a>);
            }
            <b>finally</b>
            {
                <b>if</b> (<span class="r22 r">remoteRunspaceToClose</span> != <b>null</b>)
                {
                    <span class="r22 r">remoteRunspaceToClose</span>.<a href="../../client/remoterunspace.cs.html#93d0f66da676bbe4" class="i method">Close</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get remote runspace to close.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../../client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <a id="5941d133db56a6fc" href="../../../../R/5941d133db56a6fc.html" target="n" data-glyph="76,1" class="i method">GetRemoteRunspaceToClose</a>(<a href="../../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r24 rd" class="r24 r">clientHost</span>)
        {
            <span class="c">// Figure out if we need to close the remote runspace. Return null if we don&#39;t.</span>
 
            <span class="c">// Are we a Start-PSSession enabled host?</span>
            <a href="../../../hostifaces/MshHost.cs.html#8baf67daeba803e8" class="t t">IHostSupportsInteractiveSession</a> <span id="r25 rd" class="r25 r">host</span> = <span class="r24 r">clientHost</span> <b>as</b> <a href="../../../hostifaces/MshHost.cs.html#8baf67daeba803e8" class="t t">IHostSupportsInteractiveSession</a>;
            <b>if</b> (<span class="r25 r">host</span> == <b>null</b> || !<span class="r25 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#dcffa0559e25f71a" class="i property">IsRunspacePushed</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="c">// Now inspect the runspace.</span>
            <a href="../../client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r26 rd" class="r26 r">remoteRunspace</span> = <span class="r25 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#bb0974f45a993c53" class="i property">Runspace</a> <b>as</b> <a href="../../client/remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
            <b>if</b> (<span class="r26 r">remoteRunspace</span> == <b>null</b> || !<span class="r26 r">remoteRunspace</span>.<a href="../../client/remoterunspace.cs.html#a7ae975f02f2273a" class="i property">ShouldCloseOnPop</a>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="c">// At this point it is clear we have to close the remote runspace, so return it.</span>
            <b>return</b> <span class="r26 r">remoteRunspace</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> My method base.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">MethodBase</span> <a id="9af9fb3c85760c23" href="../../../../R/9af9fb3c85760c23.html" target="n" data-glyph="106,1" class="i property">MyMethodBase</a>
        {
            <b>get</b>
            {
                <b>return</b> (<span class="i">MethodBase</span>)<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#ede2db34b58a39e3" class="i property">InterfaceType</a>.<span class="i">GetMethod</span>(<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#62a8265301fe6e7d" class="i property">Name</a>, <a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#39b8c938aa79127b" class="i property">ParameterTypes</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Execute non void method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#2088d050a88e3ac6" class="t t">RemoteHostResponse</a> <a id="803d117187c9d69c" href="../../../../R/803d117187c9d69c.html" target="n" data-glyph="74,1" class="i method">ExecuteNonVoidMethod</a>(<a href="../../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r27 rd" class="r27 r">clientHost</span>)
        {
            <span class="c">// The clientHost can be null if the user creates a runspace object without providing</span>
            <span class="c">// a host parameter.</span>
            <b>if</b> (<span class="r27 r">clientHost</span> == <b>null</b>)
            {
                <b>throw</b> <a href="#b4240fded240f14a" class="t t">RemoteHostExceptions</a>.<a href="#f9e915359dc9e6a8" class="i method">NewNullClientHostException</a>();
            }
 
            <b>object</b> <span id="r28 rd" class="r28 r">targetObject</span> = <a href="#8bf334b011b63f92" class="k">this</a>.<a href="#6b9d237738fb3cca" class="i method">SelectTargetObject</a>(<span class="r27 r">clientHost</span>);
            <a href="#2088d050a88e3ac6" class="t t">RemoteHostResponse</a> <span id="r29 rd" class="r29 r">remoteHostResponse</span> = <a href="#8bf334b011b63f92" class="k">this</a>.<a href="#8c293e74988c8946" class="i method">ExecuteNonVoidMethodOnObject</a>(<span class="r28 r">targetObject</span>);
            <b>return</b> <span class="r29 r">remoteHostResponse</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Execute non void method on object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="#2088d050a88e3ac6" class="t t">RemoteHostResponse</a> <a id="8c293e74988c8946" href="../../../../R/8c293e74988c8946.html" target="n" data-glyph="76,1" class="i method">ExecuteNonVoidMethodOnObject</a>(<b>object</b> <span id="r30 rd" class="r30 r">instance</span>)
        {
            <span class="c">// Create variables to store result of execution.</span>
            <span class="i">Exception</span> <span id="r31 rd" class="r31 r">exception</span> = <b>null</b>;
            <b>object</b> <span id="r32 rd" class="r32 r">returnValue</span> = <b>null</b>;
 
            <span class="c">// Invoke the method and store its return values.</span>
            <b>try</b>
            {
                <b>if</b> (<a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#271ba6d91aea3b3b" class="i field">GetBufferContents</a>)
                {
                    <b>throw</b> <b>new</b> <span class="t">PSRemotingDataStructureException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostGetBufferContents</span>,
                        <a href="#567eae48a76e5fc5" class="i field">_computerName</a>.<span class="i">ToUpper</span>());
                }
 
                <span class="r32 r">returnValue</span> = <a href="#9af9fb3c85760c23" class="i property">MyMethodBase</a>.<span class="i">Invoke</span>(<span class="r30 r">instance</span>, <a href="#dc67498da08dd536" class="i property">Parameters</a>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r33 rd" class="r33 r">e</span>)
            {
                <span class="c">// Catch-all OK, 3rd party callout.</span>
                <span class="r31 r">exception</span> = <span class="r33 r">e</span>.<span class="i">InnerException</span>;
            }
 
            <span class="c">// Create a RemoteHostResponse object to store the return value and exceptions.</span>
            <b>return</b> <b>new</b> <a href="#ff858b60698f523e" class="t constructor">RemoteHostResponse</a>(<a href="#18c87bb0366ee00a" class="i field">_callId</a>, <a href="#ae2b32ca6a58c395" class="i property">MethodId</a>, <span class="r32 r">returnValue</span>, <span class="r31 r">exception</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the object that this method should be invoked on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private object</b> <a id="6b9d237738fb3cca" href="../../../../R/6b9d237738fb3cca.html" target="n" data-glyph="76,1" class="i method">SelectTargetObject</a>(<a href="../../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r34 rd" class="r34 r">host</span>)
        {
            <b>if</b> (<span class="r34 r">host</span> == <b>null</b> || <span class="r34 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a> == <b>null</b>) { <b>return</b> <b>null</b>; }
 
            <b>if</b> (<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#ede2db34b58a39e3" class="i property">InterfaceType</a> == <b>typeof</b>(<a href="../../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a>)) { <b>return</b> <span class="r34 r">host</span>; }
 
            <b>if</b> (<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#ede2db34b58a39e3" class="i property">InterfaceType</a> == <b>typeof</b>(<a href="../../../hostifaces/MshHost.cs.html#8baf67daeba803e8" class="t t">IHostSupportsInteractiveSession</a>)) { <b>return</b> <span class="r34 r">host</span>; }
 
            <b>if</b> (<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#ede2db34b58a39e3" class="i property">InterfaceType</a> == <b>typeof</b>(<a href="../../../hostifaces/MshHostUserInterface.cs.html#3fd0cd9d58631820" class="t t">PSHostUserInterface</a>)) { <b>return</b> <span class="r34 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>; }
 
            <b>if</b> (<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#ede2db34b58a39e3" class="i property">InterfaceType</a> == <b>typeof</b>(<a href="../../../hostifaces/MshHostUserInterface.cs.html#47d463f128d96e29" class="t t">IHostUISupportsMultipleChoiceSelection</a>)) { <b>return</b> <span class="r34 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>; }
 
            <b>if</b> (<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#ede2db34b58a39e3" class="i property">InterfaceType</a> == <b>typeof</b>(<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#74913c6687237500" class="t t">PSHostRawUserInterface</a>)) { <b>return</b> <span class="r34 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<a href="../../../hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>; }
 
            <b>throw</b> <a href="#b4240fded240f14a" class="t t">RemoteHostExceptions</a>.<span class="i">NewUnknownTargetClassException</span>(<a href="#5f58bc6ec4a7e884" class="i field">_methodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#ede2db34b58a39e3" class="i property">InterfaceType</a>.<span class="i">ToString</span>());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is set should exit.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="7f50a02a1d5b2a07" href="../../../../R/7f50a02a1d5b2a07.html" target="n" data-glyph="104,1" class="i property">IsSetShouldExit</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#f57e6d9a970a8352" class="i field">SetShouldExit</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is set should exit or pop runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="2ec0539bd534e4b8" href="../../../../R/2ec0539bd534e4b8.html" target="n" data-glyph="104,1" class="i property">IsSetShouldExitOrPopRunspace</a>
        {
            <b>get</b>
            {
                <b>return</b>
                    <a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#f57e6d9a970a8352" class="i field">SetShouldExit</a> ||
                    <a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#61537fe28d0ff3d9" class="i field">PopRunspace</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This message performs various security checks on the</span>
        <span class="c">///</span><span class="c"> remote host call message. If there is a need to modify</span>
        <span class="c">///</span><span class="c"> the message or discard it for security reasons then</span>
        <span class="c">///</span><span class="c"> such modifications will be made here.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">computerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">computer name to use in</span>
        <span class="c">///</span><span class="c"> warning messages</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A collection of remote host calls which will</span>
        <span class="c">///</span><span class="c"> have to be executed before this host call can be</span>
        <span class="c">///</span><span class="c"> executed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Collection</span>&lt;<a href="#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <a id="9a3718f8e6cc8b76" href="../../../../R/9a3718f8e6cc8b76.html" target="n" data-glyph="74,1" class="i method">PerformSecurityChecksOnHostMessage</a>(<b>string</b> <span id="r35 rd" class="r35 r">computerName</span>)
        {
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r35 r">computerName</span>),
                <span class="s">&quot;Computer Name must be passed for use in warning messages&quot;</span>);
            <a href="#567eae48a76e5fc5" class="i field">_computerName</a> = <span class="r35 r">computerName</span>;
            <span class="i">Collection</span>&lt;<a href="#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <span id="r36 rd" class="r36 r">prerequisiteCalls</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt;();
 
            <span class="c">// check if the incoming message is a PromptForCredential message</span>
            <span class="c">// if so, do the following:</span>
            <span class="c">//       (a) prepend &quot;PowerShell Credential Request&quot; in the title</span>
            <span class="c">//       (b) prepend &quot;Message from Server XXXXX&quot; to the text message</span>
            <b>if</b> (<a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#2d54e78fda4aef54" class="i field">PromptForCredential1</a> ||
                <a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#9a7a94dc7b2818b4" class="i field">PromptForCredential2</a>)
            {
                <span class="c">// modify the caption which is _parameters[0]</span>
                <b>string</b> <span id="r37 rd" class="r37 r">modifiedCaption</span> = <a href="#d45e001416599686" class="i method">ModifyCaption</a>((<b>string</b>)<a href="#dc67498da08dd536" class="i property">Parameters</a>[0]);
 
                <span class="c">// modify the message which is _parameters[1]</span>
                <b>string</b> <span id="r38 rd" class="r38 r">modifiedMessage</span> = <a href="#26dc8deb74e2de70" class="i method">ModifyMessage</a>((<b>string</b>)<a href="#dc67498da08dd536" class="i property">Parameters</a>[1], <span class="r35 r">computerName</span>);
 
                <a href="#dc67498da08dd536" class="i property">Parameters</a>[0] = <span class="r37 r">modifiedCaption</span>;
                <a href="#dc67498da08dd536" class="i property">Parameters</a>[1] = <span class="r38 r">modifiedMessage</span>;
            }
 
            <span class="c">// Check if the incoming message is a Prompt message</span>
            <span class="c">// if so, then do the following:</span>
            <span class="c">//        (a) check if any of the field descriptions</span>
            <span class="c">//            correspond to PSCredential</span>
            <span class="c">//        (b) if field descriptions correspond to</span>
            <span class="c">//            PSCredential modify the caption and</span>
            <span class="c">//            message as in the previous case above</span>
            <b>else</b> <b>if</b> (<a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#b3c35fe2153d6573" class="i field">Prompt</a>)
            {
                <span class="c">// check if any of the field descriptions is for type</span>
                <span class="c">// PSCredential</span>
                <b>if</b> (<a href="#dc67498da08dd536" class="i property">Parameters</a>.<span class="i">Length</span> == 3)
                {
                    <span class="i">Collection</span>&lt;<a href="../../../hostifaces/FieldDescription.cs.html#604dc47cb14e8ae1" class="t t">FieldDescription</a>&gt; <span id="r39 rd" class="r39 r">fieldDescs</span> =
                        (<span class="i">Collection</span>&lt;<a href="../../../hostifaces/FieldDescription.cs.html#604dc47cb14e8ae1" class="t t">FieldDescription</a>&gt;)<a href="#dc67498da08dd536" class="i property">Parameters</a>[2];
 
                    <b>bool</b> <span id="r40 rd" class="r40 r">havePSCredential</span> = <b>false</b>;
 
                    <b>foreach</b> (<a href="../../../hostifaces/FieldDescription.cs.html#604dc47cb14e8ae1" class="t t">FieldDescription</a> <span id="r41 rd" class="r41 r">fieldDesc</span> <b>in</b> <span class="r39 r">fieldDescs</span>)
                    {
                        <span class="r41 r">fieldDesc</span>.<a href="../../../hostifaces/FieldDescription.cs.html#fe5984ff144dab1d" class="i property">IsFromRemoteHost</a> = <b>true</b>;
 
                        <span class="i">Type</span> <span id="r42 rd" class="r42 r">fieldType</span> = <a href="../../../../P/660d078b9d606b70.html#660d078b9d606b70" class="t t">InternalHostUserInterface</a>.<a href="../../../hostifaces/InternalHostUserInterface.cs.html#4ae2c8a7909d1304" class="i method">GetFieldType</a>(<span class="r41 r">fieldDesc</span>);
                        <b>if</b> (<span class="r42 r">fieldType</span> != <b>null</b>)
                        {
                            <b>if</b> (<span class="r42 r">fieldType</span> == <b>typeof</b>(<a href="../../../Credential.cs.html#6245dc122e2f1916" class="t t">PSCredential</a>))
                            {
                                <span class="r40 r">havePSCredential</span> = <b>true</b>;
                                <span class="r41 r">fieldDesc</span>.<a href="../../../hostifaces/FieldDescription.cs.html#dfc762e3f81ea072" class="i property">ModifiedByRemotingProtocol</a> = <b>true</b>;
                            }
                            <b>else</b> <b>if</b> (<span class="r42 r">fieldType</span> == <b>typeof</b>(<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecureString</span>))
                            {
                                <span class="r36 r">prerequisiteCalls</span>.<span class="i">Add</span>(<span class="i">ConstructWarningMessageForSecureString</span>(
                                    <span class="r35 r">computerName</span>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostPromptSecureStringPrompt</span>));
                            }
                        }
                    }
 
                    <b>if</b> (<span class="r40 r">havePSCredential</span>)
                    {
                        <span class="c">// modify the caption which is parameter[0]</span>
                        <b>string</b> <span id="r43 rd" class="r43 r">modifiedCaption</span> = <a href="#d45e001416599686" class="i method">ModifyCaption</a>((<b>string</b>)<a href="#dc67498da08dd536" class="i property">Parameters</a>[0]);
 
                        <span class="c">// modify the message which is parameter[1]</span>
                        <b>string</b> <span id="r44 rd" class="r44 r">modifiedMessage</span> = <a href="#26dc8deb74e2de70" class="i method">ModifyMessage</a>((<b>string</b>)<a href="#dc67498da08dd536" class="i property">Parameters</a>[1], <span class="r35 r">computerName</span>);
 
                        <a href="#dc67498da08dd536" class="i property">Parameters</a>[0] = <span class="r43 r">modifiedCaption</span>;
                        <a href="#dc67498da08dd536" class="i property">Parameters</a>[1] = <span class="r44 r">modifiedMessage</span>;
                    }
                }
            }
 
            <span class="c">// Check if the incoming message is a readline as secure string</span>
            <span class="c">// if so do the following:</span>
            <span class="c">//      (a) Specify a warning message that the server is</span>
            <span class="c">//          attempting to read something securely on the client</span>
            <b>else</b> <b>if</b> (<a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#d6d0a2ac7064ebc7" class="i field">ReadLineAsSecureString</a>)
            {
                <span class="r36 r">prerequisiteCalls</span>.<span class="i">Add</span>(<span class="i">ConstructWarningMessageForSecureString</span>(
                                    <span class="r35 r">computerName</span>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostReadLineAsSecureStringPrompt</span>));
            }
 
            <span class="c">// check if the incoming call is GetBufferContents</span>
            <span class="c">// if so do the following:</span>
            <span class="c">//      (a) Specify a warning message that the server is</span>
            <span class="c">//          attempting to read the screen buffer contents</span>
            <span class="c">//          on screen and it has been blocked</span>
            <span class="c">//      (b) Modify the message so that call is not executed</span>
            <b>else</b> <b>if</b> (<a href="#ae2b32ca6a58c395" class="i property">MethodId</a> == <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#271ba6d91aea3b3b" class="i field">GetBufferContents</a>)
            {
                <span class="r36 r">prerequisiteCalls</span>.<span class="i">Add</span>(<a href="#859c0a95ecb0181c" class="i method">ConstructWarningMessageForGetBufferContents</a>(<span class="r35 r">computerName</span>));
            }
 
            <b>return</b> <span class="r36 r">prerequisiteCalls</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Provides the modified caption for the given caption</span>
        <span class="c">///</span><span class="c"> Used in ensuring that remote prompt messages are</span>
        <span class="c">///</span><span class="c"> tagged with &quot;PowerShell Credential Request&quot;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">caption</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Caption to modify.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">New modified caption.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="d45e001416599686" href="../../../../R/d45e001416599686.html" target="n" data-glyph="76,1" class="i method">ModifyCaption</a>(<b>string</b> <span id="r45 rd" class="r45 r">caption</span>)
        {
            <b>string</b> <span id="r46 rd" class="r46 r">pscaption</span> = <span class="i">CredUI</span>.<span class="i">PromptForCredential_DefaultCaption</span>;
 
            <b>if</b> (!<span class="r45 r">caption</span>.<span class="i">Equals</span>(<span class="r46 r">pscaption</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>string</b> <span id="r47 rd" class="r47 r">modifiedCaption</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                    <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostPromptForCredentialModifiedCaption</span>, <span class="r45 r">caption</span>);
 
                <b>return</b> <span class="r47 r">modifiedCaption</span>;
            }
 
            <b>return</b> <span class="r45 r">caption</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Provides the modified message for the given one</span>
        <span class="c">///</span><span class="c"> Used in ensuring that remote prompt messages</span>
        <span class="c">///</span><span class="c"> contain a warning that they originate from a</span>
        <span class="c">///</span><span class="c"> different computer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Original message to modify.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">computerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">computername to include in the</span>
        <span class="c">///</span><span class="c"> message</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Message which contains a warning as well.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="26dc8deb74e2de70" href="../../../../R/26dc8deb74e2de70.html" target="n" data-glyph="76,1" class="i method">ModifyMessage</a>(<b>string</b> <span id="r48 rd" class="r48 r">message</span>, <b>string</b> <span id="r49 rd" class="r49 r">computerName</span>)
        {
            <b>string</b> <span id="r50 rd" class="r50 r">modifiedMessage</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                    <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostPromptForCredentialModifiedMessage</span>,
                        <span class="r49 r">computerName</span>.<span class="i">ToUpper</span>(),
                            <span class="r48 r">message</span>);
 
            <b>return</b> <span class="r50 r">modifiedMessage</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a warning message which displays to the user a</span>
        <span class="c">///</span><span class="c"> warning stating that the remote host computer is</span>
        <span class="c">///</span><span class="c"> actually attempting to read a line as a secure string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">computerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">computer name to include</span>
        <span class="c">///</span><span class="c"> in warning</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">resourceString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Resource string to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A constructed remote host call message</span>
        <span class="c">///</span><span class="c"> which will display the warning.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <a href="#8bf334b011b63f92" class="t t">RemoteHostCall</a> <a id="32bd58621c6c80a4" href="../../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ConstructWarningMessageForSecureString</a>(<b>string</b> <span id="r51 rd" class="r51 r">computerName</span>,
            <b>string</b> <span id="r52 rd" class="r52 r">resourceString</span>)
        {
            <b>string</b> <span id="r53 rd" class="r53 r">warning</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                <span class="r52 r">resourceString</span>,
                    <span class="r51 r">computerName</span>.<span class="i">ToUpper</span>());
 
            <b>return</b> <b>new</b> <a href="#ae7359eca9759275" class="t constructor">RemoteHostCall</a>(<a href="../DispatchTable.cs.html#94d3b488e4e40b16" class="t t">ServerDispatchTable</a>.<a href="../DispatchTable.cs.html#7f54015985f8241e" class="i field">VoidCallId</a>,
                <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#da4028398de5167e" class="i field">WriteWarningLine</a>, <b>new</b> <b>object</b>[] { <span class="r53 r">warning</span> });
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a warning message which displays to the user a</span>
        <span class="c">///</span><span class="c"> warning stating that the remote host computer is</span>
        <span class="c">///</span><span class="c"> attempting to read the host&#39;s buffer contents and that</span>
        <span class="c">///</span><span class="c"> it was suppressed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">computerName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">computer name to include</span>
        <span class="c">///</span><span class="c"> in warning</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A constructed remote host call message</span>
        <span class="c">///</span><span class="c"> which will display the warning.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <a href="#8bf334b011b63f92" class="t t">RemoteHostCall</a> <a id="859c0a95ecb0181c" href="../../../../R/859c0a95ecb0181c.html" target="n" data-glyph="76,1" class="i method">ConstructWarningMessageForGetBufferContents</a>(<b>string</b> <span id="r54 rd" class="r54 r">computerName</span>)
        {
            <b>string</b> <span id="r55 rd" class="r55 r">warning</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostGetBufferContents</span>,
                    <span class="r54 r">computerName</span>.<span class="i">ToUpper</span>());
 
            <b>return</b> <b>new</b> <a href="#ae7359eca9759275" class="t constructor">RemoteHostCall</a>(<a href="../DispatchTable.cs.html#94d3b488e4e40b16" class="t t">ServerDispatchTable</a>.<a href="../DispatchTable.cs.html#7f54015985f8241e" class="i field">VoidCallId</a>,
                <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#da4028398de5167e" class="i field">WriteWarningLine</a>, <b>new</b> <b>object</b>[] { <span class="r55 r">warning</span> });
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Encapsulates the method response semantics. Method responses are generated when</span>
    <span class="c">///</span><span class="c"> RemoteHostCallPacket objects are executed. They can contain both the return values of</span>
    <span class="c">///</span><span class="c"> the execution as well as exceptions that were thrown in the RemoteHostCallPacket</span>
    <span class="c">///</span><span class="c"> execution. They can be encoded and decoded for transporting over the wire. A</span>
    <span class="c">///</span><span class="c"> method response can be used to transport the result of an execution and then to</span>
    <span class="c">///</span><span class="c"> simulate the execution on the other end.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="2088d050a88e3ac6" href="../../../../R/2088d050a88e3ac6.html" target="n" data-glyph="2,0" class="t t">RemoteHostResponse</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Call id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly long</b> <a id="5b034d7b456a04eb" href="../../../../R/5b034d7b456a04eb.html" target="n" data-glyph="46,1" class="i field">_callId</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Call id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal long</b> <a id="f82f8153305d55fc" href="../../../../R/f82f8153305d55fc.html" target="n" data-glyph="104,1" class="i property">CallId</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5b034d7b456a04eb" class="i field">_callId</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Method id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <a id="142cfd99f36eb013" href="../../../../R/142cfd99f36eb013.html" target="n" data-glyph="46,1" class="i field">_methodId</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly object</b> <a id="eef0aff5e07aaeda" href="../../../../R/eef0aff5e07aaeda.html" target="n" data-glyph="46,1" class="i field">_returnValue</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i">Exception</span> <a id="7736ffb8693252c3" href="../../../../R/7736ffb8693252c3.html" target="n" data-glyph="46,1" class="i field">_exception</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for RemoteHostResponse.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="ff858b60698f523e" href="../../../../R/ff858b60698f523e.html" target="n" data-glyph="74,1" class="t constructor">RemoteHostResponse</a>(<b>long</b> <span id="r56 rd" class="r56 r">callId</span>, <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <span id="r57 rd" class="r57 r">methodId</span>, <b>object</b> <span id="r58 rd" class="r58 r">returnValue</span>, <span class="i">Exception</span> <span id="r59 rd" class="r59 r">exception</span>)
        {
            <a href="#5b034d7b456a04eb" class="i field">_callId</a> = <span class="r56 r">callId</span>;
            <a href="#142cfd99f36eb013" class="i field">_methodId</a> = <span class="r57 r">methodId</span>;
            <a href="#eef0aff5e07aaeda" class="i field">_returnValue</a> = <span class="r58 r">returnValue</span>;
            <a href="#7736ffb8693252c3" class="i field">_exception</a> = <span class="r59 r">exception</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Simulate execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="576a4329e3a52e80" href="../../../../R/576a4329e3a52e80.html" target="n" data-glyph="74,1" class="i method">SimulateExecution</a>()
        {
            <b>if</b> (<a href="#7736ffb8693252c3" class="i field">_exception</a> != <b>null</b>)
            {
                <b>throw</b> <a href="#7736ffb8693252c3" class="i field">_exception</a>;
            }
 
            <b>return</b> <a href="#eef0aff5e07aaeda" class="i field">_returnValue</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode and add return value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="2398a9013e717f09" href="../../../../R/2398a9013e717f09.html" target="n" data-glyph="76,1" class="i method">EncodeAndAddReturnValue</a>(<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r60 rd" class="r60 r">psObject</span>, <b>object</b> <span id="r61 rd" class="r61 r">returnValue</span>)
        {
            <span class="c">// Do nothing if the return value is null.</span>
            <b>if</b> (<span class="r61 r">returnValue</span> == <b>null</b>) { <b>return</b>; }
 
            <span class="c">// Otherwise add the property.</span>
            <a href="RemoteHostEncoder.cs.html#f99e89fafaac33f0" class="t t">RemoteHostEncoder</a>.<a href="RemoteHostEncoder.cs.html#23428b9baeef2fd8" class="i method">EncodeAndAddAsProperty</a>(<span class="r60 r">psObject</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#19bea0fdda0f56ab" class="i field">MethodReturnValue</a>, <span class="r61 r">returnValue</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Decode return value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static object</b> <a id="4cf831c82643890c" href="../../../../R/4cf831c82643890c.html" target="n" data-glyph="76,1" class="i method">DecodeReturnValue</a>(<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r62 rd" class="r62 r">psObject</span>, <span class="i">Type</span> <span id="r63 rd" class="r63 r">returnType</span>)
        {
            <b>object</b> <span id="r64 rd" class="r64 r">returnValue</span> = <a href="RemoteHostEncoder.cs.html#f99e89fafaac33f0" class="t t">RemoteHostEncoder</a>.<a href="RemoteHostEncoder.cs.html#8969fd24be9fc354" class="i method">DecodePropertyValue</a>(<span class="r62 r">psObject</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#19bea0fdda0f56ab" class="i field">MethodReturnValue</a>, <span class="r63 r">returnType</span>);
            <b>return</b> <span class="r64 r">returnValue</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode and add exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="0ffc1a2b4e95e40d" href="../../../../R/0ffc1a2b4e95e40d.html" target="n" data-glyph="76,1" class="i method">EncodeAndAddException</a>(<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r65 rd" class="r65 r">psObject</span>, <span class="i">Exception</span> <span id="r66 rd" class="r66 r">exception</span>)
        {
            <a href="RemoteHostEncoder.cs.html#f99e89fafaac33f0" class="t t">RemoteHostEncoder</a>.<span class="i">EncodeAndAddAsProperty</span>(<span class="r65 r">psObject</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#8dbf6f76e9557491" class="i field">MethodException</a>, <span class="r66 r">exception</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Decode exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Exception</span> <a id="f218a1c74937520f" href="../../../../R/f218a1c74937520f.html" target="n" data-glyph="76,1" class="i method">DecodeException</a>(<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r67 rd" class="r67 r">psObject</span>)
        {
            <b>object</b> <span id="r68 rd" class="r68 r">result</span> = <a href="RemoteHostEncoder.cs.html#f99e89fafaac33f0" class="t t">RemoteHostEncoder</a>.<span class="i">DecodePropertyValue</span>(<span class="r67 r">psObject</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#8dbf6f76e9557491" class="i field">MethodException</a>, <b>typeof</b>(<span class="i">Exception</span>));
            <b>if</b> (<span class="r68 r">result</span> == <b>null</b>) { <b>return</b> <b>null</b>; }
 
            <b>if</b> (<span class="r68 r">result</span> <b>is</b> <span class="i">Exception</span>) { <b>return</b> (<span class="i">Exception</span>)<span class="r68 r">result</span>; }
 
            <b>throw</b> <a href="#b4240fded240f14a" class="t t">RemoteHostExceptions</a>.<a href="#3107e507a0ff5c2d" class="i method">NewDecodingFailedException</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <a id="657b141251f02e27" href="../../../../R/657b141251f02e27.html" target="n" data-glyph="74,1" class="i method">Encode</a>()
        {
            <span class="c">// Create a data object and put everything in that and return it.</span>
            <a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r69 rd" class="r69 r">data</span> = <a href="EncodeAndDecode.cs.html#88b19073d823ce05" class="t t">RemotingEncoder</a>.<a href="EncodeAndDecode.cs.html#22d9fb1506026254" class="i method">CreateEmptyPSObject</a>();
            <a href="#2398a9013e717f09" class="i method">EncodeAndAddReturnValue</a>(<span class="r69 r">data</span>, <a href="#eef0aff5e07aaeda" class="i field">_returnValue</a>);
            <a href="#0ffc1a2b4e95e40d" class="i method">EncodeAndAddException</a>(<span class="r69 r">data</span>, <a href="#7736ffb8693252c3" class="i field">_exception</a>);
            <span class="r69 r">data</span>.<a href="../../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../../../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <a href="../../../MshMemberInfo.cs.html#f4e5bccf8ccb9f2a" class="t constructor">PSNoteProperty</a>(<a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>, <a href="#5b034d7b456a04eb" class="i field">_callId</a>));
            <span class="r69 r">data</span>.<a href="../../../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a>.<a href="../../../MshMemberInfo.cs.html#a9e3a2dc56d98237" class="i method">Add</a>(<b>new</b> <span class="t">PSNoteProperty</span>(<a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#870eec6850f45e8d" class="i field">MethodId</a>, <a href="#142cfd99f36eb013" class="i field">_methodId</a>));
            <b>return</b> <span class="r69 r">data</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Decode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#2088d050a88e3ac6" class="t t">RemoteHostResponse</a> <a id="bb70fcce88a4188e" href="../../../../R/bb70fcce88a4188e.html" target="n" data-glyph="74,1" class="i method">Decode</a>(<a href="../../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r70 rd" class="r70 r">data</span>)
        {
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r70 r">data</span> != <b>null</b>, <span class="s">&quot;Expected data != null&quot;</span>);
 
            <span class="c">// Extract all the fields from data.</span>
            <b>long</b> <span id="r71 rd" class="r71 r">callId</span> = <a href="EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<b>long</b>&gt;(<span class="r70 r">data</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#9b48d21fcadf90c0" class="i field">CallId</a>);
            <a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <span id="r72 rd" class="r72 r">methodId</span> = <a href="EncodeAndDecode.cs.html#6f71f8c4cc2ac041" class="t t">RemotingDecoder</a>.<a href="EncodeAndDecode.cs.html#d3fee447c77dfb3b" class="i method">GetPropertyValue</a>&lt;<a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>&gt;(<span class="r70 r">data</span>, <a href="EncodeAndDecode.cs.html#7c9c1b0b95848ffd" class="t t">RemoteDataNameStrings</a>.<a href="EncodeAndDecode.cs.html#870eec6850f45e8d" class="i field">MethodId</a>);
 
            <span class="c">// Decode the return value and the exception.</span>
            <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a> <span id="r73 rd" class="r73 r">methodInfo</span> = <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#4ed80f518be319e9" class="i method">LookUp</a>(<span class="r72 r">methodId</span>);
            <b>object</b> <span id="r74 rd" class="r74 r">returnValue</span> = <a href="#4cf831c82643890c" class="i method">DecodeReturnValue</a>(<span class="r70 r">data</span>, <span class="r73 r">methodInfo</span>.<a href="../../host/RemoteHostMethodInfo.cs.html#c4914134ebd685b7" class="i property">ReturnType</a>);
            <span class="i">Exception</span> <span id="r75 rd" class="r75 r">exception</span> = <a href="#f218a1c74937520f" class="i method">DecodeException</a>(<span class="r70 r">data</span>);
 
            <span class="c">// Use these values to create a RemoteHostResponse and return it.</span>
            <b>return</b> <b>new</b> <a href="#ff858b60698f523e" class="t constructor">RemoteHostResponse</a>(<span class="r71 r">callId</span>, <span class="r72 r">methodId</span>, <span class="r74 r">returnValue</span>, <span class="r75 r">exception</span>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The RemoteHostExceptions class.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="b4240fded240f14a" href="../../../../R/b4240fded240f14a.html" target="n" data-glyph="2,0" class="t t">RemoteHostExceptions</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New remote runspace does not support push runspace exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="897959742a9d68e9" href="../../../../R/897959742a9d68e9.html" target="n" data-glyph="74,1" class="i method">NewRemoteRunspaceDoesNotSupportPushRunspaceException</a>()
        {
            <b>string</b> <span id="r76 rd" class="r76 r">resourceString</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteRunspaceDoesNotSupportPushRunspace</span>);
            <b>return</b> <b>new</b> <a href="../remotingexceptions.cs.html#e37278e46e3f11b6" class="t constructor">PSRemotingDataStructureException</a>(<span class="r76 r">resourceString</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New decoding failed exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="3107e507a0ff5c2d" href="../../../../R/3107e507a0ff5c2d.html" target="n" data-glyph="74,1" class="i method">NewDecodingFailedException</a>()
        {
            <b>string</b> <span id="r77 rd" class="r77 r">resourceString</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostDecodingFailed</span>);
            <b>return</b> <b>new</b> <a href="../remotingexceptions.cs.html#e37278e46e3f11b6" class="t constructor">PSRemotingDataStructureException</a>(<span class="r77 r">resourceString</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New not implemented exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="c1b4e1225a4fe52c" href="../../../../R/c1b4e1225a4fe52c.html" target="n" data-glyph="74,1" class="i method">NewNotImplementedException</a>(<a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <span id="r78 rd" class="r78 r">methodId</span>)
        {
            <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a> <span id="r79 rd" class="r79 r">methodInfo</span> = <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#4ed80f518be319e9" class="i method">LookUp</a>(<span class="r78 r">methodId</span>);
            <b>string</b> <span id="r80 rd" class="r80 r">resourceString</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostMethodNotImplemented</span>, <span class="r79 r">methodInfo</span>.<a href="../../host/RemoteHostMethodInfo.cs.html#62a8265301fe6e7d" class="i property">Name</a>);
            <b>return</b> <b>new</b> <a href="../remotingexceptions.cs.html#1c3f5bfacc2173a7" class="t constructor">PSRemotingDataStructureException</a>(<span class="r80 r">resourceString</span>, <b>new</b> <a href="../../../../utils/MshNotImplementedException.cs.html#7c86d87f06a2f375" class="t constructor">PSNotImplementedException</a>());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New remote host call failed exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="dba791ce4f09e92f" href="../../../../R/dba791ce4f09e92f.html" target="n" data-glyph="74,1" class="i method">NewRemoteHostCallFailedException</a>(<a href="../../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a> <span id="r81 rd" class="r81 r">methodId</span>)
        {
            <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a> <span id="r82 rd" class="r82 r">methodInfo</span> = <a href="../../host/RemoteHostMethodInfo.cs.html#4cf43da831020cec" class="t t">RemoteHostMethodInfo</a>.<a href="../../host/RemoteHostMethodInfo.cs.html#4ed80f518be319e9" class="i method">LookUp</a>(<span class="r81 r">methodId</span>);
            <b>string</b> <span id="r83 rd" class="r83 r">resourceString</span> = <a href="../remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostCallFailed</span>, <span class="r82 r">methodInfo</span>.<a href="../../host/RemoteHostMethodInfo.cs.html#62a8265301fe6e7d" class="i property">Name</a>);
            <b>return</b> <b>new</b> <a href="../remotingexceptions.cs.html#e37278e46e3f11b6" class="t constructor">PSRemotingDataStructureException</a>(<span class="r83 r">resourceString</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New decoding error for error record exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="f02b445df2cc1822" href="../../../../R/f02b445df2cc1822.html" target="n" data-glyph="74,1" class="i method">NewDecodingErrorForErrorRecordException</a>()
        {
            <b>return</b> <b>new</b> <span class="t">PSRemotingDataStructureException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DecodingErrorForErrorRecord</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New remote host data encoding not supported exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="1a58ac29a432c1f9" href="../../../../R/1a58ac29a432c1f9.html" target="n" data-glyph="74,1" class="i method">NewRemoteHostDataEncodingNotSupportedException</a>(<span class="i">Type</span> <span id="r84 rd" class="r84 r">type</span>)
        {
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r84 r">type</span> != <b>null</b>, <span class="s">&quot;Expected type != null&quot;</span>);
            <b>return</b> <b>new</b> <span class="t">PSRemotingDataStructureException</span>(
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostDataEncodingNotSupported</span>,
                <span class="r84 r">type</span>.<span class="i">ToString</span>());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New remote host data decoding not supported exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="a33ff02c30f768e0" href="../../../../R/a33ff02c30f768e0.html" target="n" data-glyph="74,1" class="i method">NewRemoteHostDataDecodingNotSupportedException</a>(<span class="i">Type</span> <span id="r85 rd" class="r85 r">type</span>)
        {
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r85 r">type</span> != <b>null</b>, <span class="s">&quot;Expected type != null&quot;</span>);
            <b>return</b> <b>new</b> <span class="t">PSRemotingDataStructureException</span>(
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostDataDecodingNotSupported</span>,
                <span class="r85 r">type</span>.<span class="i">ToString</span>());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> New unknown target class exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Exception</span> <a id="81bf8fa0c7a39ba4" href="../../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">NewUnknownTargetClassException</a>(<b>string</b> <span id="r86 rd" class="r86 r">className</span>)
        {
            <a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r86 r">className</span> != <b>null</b>, <span class="s">&quot;Expected className != null&quot;</span>);
            <b>return</b> <b>new</b> <span class="t">PSRemotingDataStructureException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">UnknownTargetClass</span>, <span class="r86 r">className</span>);
        }
 
        <b>internal static</b> <span class="i">Exception</span> <a id="f9e915359dc9e6a8" href="../../../../R/f9e915359dc9e6a8.html" target="n" data-glyph="74,1" class="i method">NewNullClientHostException</a>()
        {
            <b>return</b> <b>new</b> <span class="t">PSRemotingDataStructureException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RemoteHostNullClientHost</span>);
        }
    }
}
</pre></td></tr></table></div></body></html>
