<!DOCTYPE html>
<html><head><title>RemoteSessionCapability.cs</title><link rel="stylesheet" href="../../../../../styles.css"><script src="../../../../../scripts.js"></script></head>
<body class="cB" onload="i(462);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/common/WireDataFormat/RemoteSessionCapability.cs" target="_top">engine\remoting\common\WireDataFormat\RemoteSessionCapability.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">Serialization</span>.<span class="i">Formatters</span>.<span class="i">Binary</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class contains information about the capability of one side of the connection. The client</span>
    <span class="c">///</span><span class="c"> side and the server side will have their own capabilities. These two sets of capabilities will</span>
    <span class="c">///</span><span class="c"> be used in a capability negotiation algorithm to determine if it is possible to establish a</span>
    <span class="c">///</span><span class="c"> connection between the client and the server.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="410d0e97ea446fd9" href="../../../../R/410d0e97ea446fd9.html" target="n" data-glyph="2,0" class="t t">RemoteSessionCapability</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> DO NOT REMOVE OR RENAME THESE FIELDS - it will break remoting compatibility with Windows PowerShell
 
        <b>private readonly</b> <span class="i">Version</span> <a id="d9f00b63bf2dfa72" href="../../../../R/d9f00b63bf2dfa72.html" target="n" data-glyph="46,1" class="i field">_psversion</a>;
        <b>private readonly</b> <span class="i">Version</span> <a id="65bb13df0f3071ce" href="../../../../R/65bb13df0f3071ce.html" target="n" data-glyph="46,1" class="i field">_serversion</a>;
        <b>private</b> <span class="i">Version</span> <a id="ff1d507aa7224b7c" href="../../../../R/ff1d507aa7224b7c.html" target="n" data-glyph="46,1" class="i field">_protocolVersion</a>;
        <b>private readonly</b> <a href="EncodeAndDecode.cs.html#45c72046001f69b8" class="t t">RemotingDestination</a> <a id="2ed655dead9fbe52" href="../../../../R/2ed655dead9fbe52.html" target="n" data-glyph="46,1" class="i field">_remotingDestination</a>;
        <b>private static byte</b>[] <a id="812f5b1b75201858" href="../../../../R/812f5b1b75201858.html" target="n" data-glyph="46,1" class="i field">_timeZoneInByteFormat</a>;
        <b>private</b> <span class="i">TimeZoneInfo</span> <a id="5654e1bf5defaf4a" href="../../../../R/5654e1bf5defaf4a.html" target="n" data-glyph="46,1" class="i field">_timeZone</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>internal</b> <span class="i">Version</span> <a id="e0172342f9aadac0" href="../../../../R/e0172342f9aadac0.html" target="n" data-glyph="104,1" class="i property">ProtocolVersion</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ff1d507aa7224b7c" class="i field">_protocolVersion</a>;
            }
 
            <b>set</b>
            {
                <a href="#ff1d507aa7224b7c" class="i field">_protocolVersion</a> = <b>value</b>;
            }
        }
 
        <b>internal</b> <span class="i">Version</span> <a id="51f8c62899f19f35" href="../../../../R/51f8c62899f19f35.html" target="n" data-glyph="104,1" class="i property">PSVersion</a> { <b>get</b> { <b>return</b> <a href="#d9f00b63bf2dfa72" class="i field">_psversion</a>; } }
 
        <b>internal</b> <span class="i">Version</span> <a id="4cbbb234181ff56e" href="../../../../R/4cbbb234181ff56e.html" target="n" data-glyph="104,1" class="i property">SerializationVersion</a> { <b>get</b> { <b>return</b> <a href="#65bb13df0f3071ce" class="i field">_serversion</a>; } }
 
        <b>internal</b> <a href="EncodeAndDecode.cs.html#45c72046001f69b8" class="t t">RemotingDestination</a> <a id="52b37865634e104b" href="../../../../R/52b37865634e104b.html" target="n" data-glyph="104,1" class="i property">RemotingDestination</a> { <b>get</b> { <b>return</b> <a href="#2ed655dead9fbe52" class="i field">_remotingDestination</a>; } }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for RemoteSessionCapability.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">should not be called from outside, use create methods instead</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal</b> <a id="f54dd2d1011c61f5" href="../../../../R/f54dd2d1011c61f5.html" target="n" data-glyph="74,1" class="t constructor">RemoteSessionCapability</a>(<a href="EncodeAndDecode.cs.html#45c72046001f69b8" class="t t">RemotingDestination</a> <span id="r0 rd" class="r0 r">remotingDestination</span>)
        {
            <a href="#ff1d507aa7224b7c" class="i field">_protocolVersion</a> = <a href="EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="EncodeAndDecode.cs.html#c5be07ec763d4c13" class="i field">ProtocolVersion</a>;
            <span class="c">// PS Version 3 is fully backward compatible with Version 2</span>
            <span class="c">// In the remoting protocol sense, nothing is changing between PS3 and PS2</span>
            <span class="c">// For negotiation to succeed with old client/servers we have to use 2.</span>
            <a href="#d9f00b63bf2dfa72" class="i field">_psversion</a> = <b>new</b> <span class="i">Version</span>(2, 0); <span class="c">// PSVersionInfo.PSVersion;</span>
            <a href="#65bb13df0f3071ce" class="i field">_serversion</a> = <a href="../../../PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="../../../PSVersionInfo.cs.html#78365a4f5b1084d8" class="i property">SerializationVersion</a>;
            <a href="#2ed655dead9fbe52" class="i field">_remotingDestination</a> = <span class="r0 r">remotingDestination</span>;
        }
 
        <b>internal</b> <a id="bd631ced49af9931" href="../../../../R/bd631ced49af9931.html" target="n" data-glyph="74,1" class="t constructor">RemoteSessionCapability</a>(<a href="EncodeAndDecode.cs.html#45c72046001f69b8" class="t t">RemotingDestination</a> <span id="r1 rd" class="r1 r">remotingDestination</span>,
            <span class="i">Version</span> <span id="r2 rd" class="r2 r">protocolVersion</span>,
            <span class="i">Version</span> <span id="r3 rd" class="r3 r">psVersion</span>,
            <span class="i">Version</span> <span id="r4 rd" class="r4 r">serVersion</span>)
        {
            <a href="#ff1d507aa7224b7c" class="i field">_protocolVersion</a> = <span class="r2 r">protocolVersion</span>;
            <a href="#d9f00b63bf2dfa72" class="i field">_psversion</a> = <span class="r3 r">psVersion</span>;
            <a href="#65bb13df0f3071ce" class="i field">_serversion</a> = <span class="r4 r">serVersion</span>;
            <a href="#2ed655dead9fbe52" class="i field">_remotingDestination</a> = <span class="r1 r">remotingDestination</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create client capability.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#410d0e97ea446fd9" class="t t">RemoteSessionCapability</a> <a id="b5c8c51440808bd1" href="../../../../R/b5c8c51440808bd1.html" target="n" data-glyph="74,1" class="i method">CreateClientCapability</a>()
        {
            <b>return</b> <b>new</b> <a href="#f54dd2d1011c61f5" class="t constructor">RemoteSessionCapability</a>(<a href="EncodeAndDecode.cs.html#45c72046001f69b8" class="t t">RemotingDestination</a>.<a href="EncodeAndDecode.cs.html#061ac750e6d280da" class="i field">Server</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create server capability.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#410d0e97ea446fd9" class="t t">RemoteSessionCapability</a> <a id="122c7d39b2c7c1c1" href="../../../../R/122c7d39b2c7c1c1.html" target="n" data-glyph="74,1" class="i method">CreateServerCapability</a>()
        {
            <b>return</b> <b>new</b> <a href="#f54dd2d1011c61f5" class="t constructor">RemoteSessionCapability</a>(<a href="EncodeAndDecode.cs.html#45c72046001f69b8" class="t t">RemotingDestination</a>.<a href="EncodeAndDecode.cs.html#5e2f9f14c9ab7c84" class="i field">Client</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is static property which gets Current TimeZone in byte format</span>
        <span class="c">///</span><span class="c"> by using ByteFormatter.</span>
        <span class="c">///</span><span class="c"> This is static to make client generate this only once.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static byte</b>[] <a id="58143058f7ce58ab" href="../../../../R/58143058f7ce58ab.html" target="n" data-glyph="74,1" class="i method">GetCurrentTimeZoneInByteFormat</a>()
        {
            <b>if</b> (<a href="#812f5b1b75201858" class="i field">_timeZoneInByteFormat</a> == <b>null</b>)
            {
                <span class="i">Exception</span> <span id="r5 rd" class="r5 r">e</span> = <b>null</b>;
                <b>try</b>
                {
                    <span class="i">BinaryFormatter</span> <span id="r6 rd" class="r6 r">formatter</span> = <b>new</b> <span class="i">BinaryFormatter</span>();
                    <b>using</b> (<span class="i">MemoryStream</span> <span id="r7 rd" class="r7 r">stream</span> = <b>new</b> <span class="i">MemoryStream</span>())
                    {
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">SYSLIB0011</span>
                        <span class="r6 r">formatter</span>.<span class="i">Serialize</span>(<span class="r7 r">stream</span>, <span class="i">TimeZoneInfo</span>.<span class="i">Local</span>);
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">SYSLIB0011</span>
                        <span class="r7 r">stream</span>.<span class="i">Seek</span>(0, <span class="i">SeekOrigin</span>.<span class="i">Begin</span>);
                        <b>byte</b>[] <span id="r8 rd" class="r8 r">result</span> = <b>new</b> <b>byte</b>[<span class="r7 r">stream</span>.<span class="i">Length</span>];
                        <span class="r7 r">stream</span>.<span class="i">Read</span>(<span class="r8 r">result</span>, 0, (<b>int</b>)<span class="r7 r">stream</span>.<span class="i">Length</span>);
                        <a href="#812f5b1b75201858" class="i field">_timeZoneInByteFormat</a> = <span class="r8 r">result</span>;
                    }
                }
                <b>catch</b> (<span class="i">ArgumentNullException</span> <span id="r9 rd" class="r9 r">ane</span>)
                {
                    <span class="r5 r">e</span> = <span class="r9 r">ane</span>;
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">Serialization</span>.<span class="i">SerializationException</span> <span id="r10 rd" class="r10 r">sre</span>)
                {
                    <span class="r5 r">e</span> = <span class="r10 r">sre</span>;
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r11 rd" class="r11 r">se</span>)
                {
                    <span class="r5 r">e</span> = <span class="r11 r">se</span>;
                }
 
                <span class="c">// if there is any exception serializing the timezone information</span>
                <span class="c">// ignore it and dont try to serialize again.</span>
                <b>if</b> (<span class="r5 r">e</span> != <b>null</b>)
                {
                    <a href="#812f5b1b75201858" class="i field">_timeZoneInByteFormat</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>byte</b>&gt;();
                }
            }
 
            <b>return</b> <a href="#812f5b1b75201858" class="i field">_timeZoneInByteFormat</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the TimeZone of the destination machine. This may be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">TimeZoneInfo</span> <a id="dcfe23b27a67c301" href="../../../../R/dcfe23b27a67c301.html" target="n" data-glyph="104,1" class="i property">TimeZone</a>
        {
            <b>get</b> { <b>return</b> <a href="#5654e1bf5defaf4a" class="i field">_timeZone</a>; }
 
            <b>set</b> { <a href="#5654e1bf5defaf4a" class="i field">_timeZone</a> = <b>value</b>; }
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The HostDefaultDataId enum.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal enum</b> <a id="cb1370165303c88d" href="../../../../R/cb1370165303c88d.html" target="n" data-glyph="20,0" class="t t"><span id="fbecc3562219cd4d">HostDefaultDataId</span></a>
    {
        <a id="1b3e6e0763aa90ab" href="../../../../R/1b3e6e0763aa90ab.html" target="n" data-glyph="24,1" class="i field">ForegroundColor</a>,
        <a id="38f3b68abff4a4e8" href="../../../../R/38f3b68abff4a4e8.html" target="n" data-glyph="24,1" class="i field">BackgroundColor</a>,
        <a id="475a6bfdf55771ca" href="../../../../R/475a6bfdf55771ca.html" target="n" data-glyph="24,1" class="i field">CursorPosition</a>,
        <a id="3d65e9be9f918fda" href="../../../../R/3d65e9be9f918fda.html" target="n" data-glyph="24,1" class="i field">WindowPosition</a>,
        <a id="ccb0336b43f548d3" href="../../../../R/ccb0336b43f548d3.html" target="n" data-glyph="24,1" class="i field">CursorSize</a>,
        <a id="2da3607f069333ce" href="../../../../R/2da3607f069333ce.html" target="n" data-glyph="24,1" class="i field">BufferSize</a>,
        <a id="0e70bc2abf1a85f1" href="../../../../R/0e70bc2abf1a85f1.html" target="n" data-glyph="24,1" class="i field">WindowSize</a>,
        <a id="684b76364087d363" href="../../../../R/684b76364087d363.html" target="n" data-glyph="24,1" class="i field">MaxWindowSize</a>,
        <a id="eee7a8da476e63cb" href="../../../../R/eee7a8da476e63cb.html" target="n" data-glyph="24,1" class="i field">MaxPhysicalWindowSize</a>,
        <a id="ced67296a65b1bf1" href="../../../../R/ced67296a65b1bf1.html" target="n" data-glyph="24,1" class="i field">WindowTitle</a>,
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The HostDefaultData class.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="80e5be2c8462bf2a" href="../../../../R/80e5be2c8462bf2a.html" target="n" data-glyph="2,0" class="t t">HostDefaultData</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="k preprocess">#</span><span class="k preprocess">region</span> DO NOT REMOVE OR RENAME THESE FIELDS - it will break remoting compatibility with Windows PowerShell
 
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>, <b>object</b>&gt; <a id="65c677aec5732f61" href="../../../../R/65c677aec5732f61.html" target="n" data-glyph="46,1" class="i field">data</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Private constructor to force use of Create.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a id="17b3ce18e685be9c" href="../../../../R/17b3ce18e685be9c.html" target="n" data-glyph="76,1" class="t constructor">HostDefaultData</a>()
        {
            <a href="#65c677aec5732f61" class="i field">data</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>, <b>object</b>&gt;();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indexer to provide clean access to data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="a91e6dcee0868311" href="../../../../R/../../0000000000.html" target="n" data-glyph="104,1" class="k">this</a>[<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a> <span id="r12 rd" class="r12 r">id</span>]
        {
            <b>get</b>
            {
                <b>return</b> <a href="#80e5be2c8462bf2a" class="k">this</a>.<a href="#c2d098e5de290024" class="i method">GetValue</a>(<span class="r12 r">id</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Has value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="e17dd41d8d0eeaae" href="../../../../R/e17dd41d8d0eeaae.html" target="n" data-glyph="74,1" class="i method">HasValue</a>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a> <span id="r13 rd" class="r13 r">id</span>)
        {
            <b>return</b> <a href="#65c677aec5732f61" class="i field">data</a>.<span class="i">ContainsKey</span>(<span class="r13 r">id</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="cb793a4c62ecacae" href="../../../../R/cb793a4c62ecacae.html" target="n" data-glyph="74,1" class="i method">SetValue</a>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a> <span id="r14 rd" class="r14 r">id</span>, <b>object</b> <span id="r15 rd" class="r15 r">dataValue</span>)
        {
            <a href="#65c677aec5732f61" class="i field">data</a>[<span class="r14 r">id</span>] = <span class="r15 r">dataValue</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="c2d098e5de290024" href="../../../../R/c2d098e5de290024.html" target="n" data-glyph="74,1" class="i method">GetValue</a>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a> <span id="r16 rd" class="r16 r">id</span>)
        {
            <b>object</b> <span id="r17 rd" class="r17 r">result</span>;
            <a href="#65c677aec5732f61" class="i field">data</a>.<span class="i">TryGetValue</span>(<span class="r16 r">id</span>, <b>out</b> <span class="r17 r">result</span>);
            <b>return</b> <span class="r17 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns null if host is null or if reading RawUI fields fails; otherwise returns a valid object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#80e5be2c8462bf2a" class="t t">HostDefaultData</a> <a id="193084ee380b49d4" href="../../../../R/193084ee380b49d4.html" target="n" data-glyph="74,1" class="i method">Create</a>(<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#74913c6687237500" class="t t">PSHostRawUserInterface</a> <span id="r18 rd" class="r18 r">hostRawUI</span>)
        {
            <b>if</b> (<span class="r18 r">hostRawUI</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="#80e5be2c8462bf2a" class="t t">HostDefaultData</a> <span id="r19 rd" class="r19 r">hostDefaultData</span> = <b>new</b> <a href="#17b3ce18e685be9c" class="t constructor">HostDefaultData</a>();
 
            <span class="c">// Try to get values from the host. Catch-all okay because of 3rd party call-out.</span>
 
            <span class="c">// Set ForegroundColor.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#1b3e6e0763aa90ab" class="i field">ForegroundColor</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#3a17cd9a690cee92" class="i property">ForegroundColor</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set BackgroundColor.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#38f3b68abff4a4e8" class="i field">BackgroundColor</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#e2891a44a8939f10" class="i property">BackgroundColor</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set CursorPosition.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#475a6bfdf55771ca" class="i field">CursorPosition</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#1096ecedf81a22c3" class="i property">CursorPosition</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set WindowPosition.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#3d65e9be9f918fda" class="i field">WindowPosition</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#6a6c144b08b3071f" class="i property">WindowPosition</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set CursorSize.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<a href="#cb793a4c62ecacae" class="i method">SetValue</a>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#ccb0336b43f548d3" class="i field">CursorSize</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#64feebe48377f1bb" class="i property">CursorSize</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set BufferSize.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#2da3607f069333ce" class="i field">BufferSize</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#fb00d782b83e287c" class="i property">BufferSize</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set WindowSize.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#0e70bc2abf1a85f1" class="i field">WindowSize</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#e690f314a36b033e" class="i property">WindowSize</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set MaxWindowSize.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#684b76364087d363" class="i field">MaxWindowSize</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#44f00528e767b9b3" class="i property">MaxWindowSize</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set MaxPhysicalWindowSize.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<span class="i">SetValue</span>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#eee7a8da476e63cb" class="i field">MaxPhysicalWindowSize</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#b695a73a234668c1" class="i property">MaxPhysicalWindowSize</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <span class="c">// Set WindowTitle.</span>
            <b>try</b>
            {
                <span class="r19 r">hostDefaultData</span>.<a href="#cb793a4c62ecacae" class="i method">SetValue</a>(<a href="#cb1370165303c88d" class="t t">HostDefaultDataId</a>.<a href="#ced67296a65b1bf1" class="i field">WindowTitle</a>, <span class="r18 r">hostRawUI</span>.<a href="../../../hostifaces/MshHostRawUserInterface.cs.html#4147d92d53afa5ad" class="i property">WindowTitle</a>);
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
            }
 
            <b>return</b> <span class="r19 r">hostDefaultData</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The HostInfo class.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="4fc7c4b336de518c" href="../../../../R/4fc7c4b336de518c.html" target="n" data-glyph="2,0" class="t t">HostInfo</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Host default data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#80e5be2c8462bf2a" class="t t">HostDefaultData</a> <a id="7599823f156af47c" href="../../../../R/7599823f156af47c.html" target="n" data-glyph="104,1" class="i property">HostDefaultData</a>
        {
            <b>get</b> { <b>return</b> <a href="#4af96667c9aff712" class="i field">_hostDefaultData</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is host null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="2239ebcbdc70c629" href="../../../../R/../../0000000000.html" target="n" data-glyph="104,1" class="i property">IsHostNull</a>
        {
            <b>get</b> { <b>return</b> <a href="#61608898255a7387" class="i field">_isHostNull</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is host ui null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly bool</b> <a id="f4e38f1c2c605763" href="../../../../R/f4e38f1c2c605763.html" target="n" data-glyph="46,1" class="i field">_isHostUINull</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is host ui null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="6204fae495989f90" href="../../../../R/6204fae495989f90.html" target="n" data-glyph="104,1" class="i property">IsHostUINull</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#f4e38f1c2c605763" class="i field">_isHostUINull</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is host raw ui null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly bool</b> <a id="ff5f1c4d9cd108e0" href="../../../../R/ff5f1c4d9cd108e0.html" target="n" data-glyph="46,1" class="i field">_isHostRawUINull</a>;
 
        <b>private readonly bool</b> <a id="61608898255a7387" href="../../../../R/61608898255a7387.html" target="n" data-glyph="46,1" class="i field">_isHostNull</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> DO NOT REMOVE OR RENAME THESE FIELDS - it will break remoting compatibility with Windows PowerShell
 
        <b>private readonly</b> <a href="#80e5be2c8462bf2a" class="t t">HostDefaultData</a> <a id="4af96667c9aff712" href="../../../../R/4af96667c9aff712.html" target="n" data-glyph="46,1" class="i field">_hostDefaultData</a>;
        <b>private bool</b> <a id="ae04806a0da2739b" href="../../../../R/ae04806a0da2739b.html" target="n" data-glyph="46,1" class="i field">_useRunspaceHost</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is host raw ui null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="333493eb19798836" href="../../../../R/333493eb19798836.html" target="n" data-glyph="104,1" class="i property">IsHostRawUINull</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ff5f1c4d9cd108e0" class="i field">_isHostRawUINull</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Use runspace host.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="ccba904c55d54568" href="../../../../R/ccba904c55d54568.html" target="n" data-glyph="104,1" class="i property">UseRunspaceHost</a>
        {
            <b>get</b> { <b>return</b> <a href="#ae04806a0da2739b" class="i field">_useRunspaceHost</a>; }
 
            <b>set</b> { <a href="#ae04806a0da2739b" class="i field">_useRunspaceHost</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for HostInfo.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="460b658813cb9516" href="../../../../R/460b658813cb9516.html" target="n" data-glyph="74,1" class="t constructor">HostInfo</a>(<a href="../../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r20 rd" class="r20 r">host</span>)
        {
            <span class="c">// Set these flags based on investigating the host.</span>
            <a href="#c930f1f6c0659ff5" class="i method">CheckHostChain</a>(<span class="r20 r">host</span>, <b>ref</b> <a href="#61608898255a7387" class="i field">_isHostNull</a>, <b>ref</b> <a href="#f4e38f1c2c605763" class="i field">_isHostUINull</a>, <b>ref</b> <a href="#ff5f1c4d9cd108e0" class="i field">_isHostRawUINull</a>);
 
            <span class="c">// If raw UI is non-null then get the host-info object.</span>
            <b>if</b> (!<a href="#f4e38f1c2c605763" class="i field">_isHostUINull</a> &amp;&amp; !<a href="#ff5f1c4d9cd108e0" class="i field">_isHostRawUINull</a>)
            {
                <a href="#4af96667c9aff712" class="i field">_hostDefaultData</a> = <a href="#80e5be2c8462bf2a" class="t t">HostDefaultData</a>.<a href="#193084ee380b49d4" class="i method">Create</a>(<span class="r20 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<a href="../../../hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check host chain.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="c930f1f6c0659ff5" href="../../../../R/c930f1f6c0659ff5.html" target="n" data-glyph="76,1" class="i method">CheckHostChain</a>(<a href="../../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r21 rd" class="r21 r">host</span>, <b>ref bool</b> <span id="r22 rd" class="r22 r">isHostNull</span>, <b>ref bool</b> <span id="r23 rd" class="r23 r">isHostUINull</span>, <b>ref bool</b> <span id="r24 rd" class="r24 r">isHostRawUINull</span>)
        {
            <span class="c">// Set the defaults.</span>
            <span class="r22 r">isHostNull</span> = <b>true</b>;
            <span class="r23 r">isHostUINull</span> = <b>true</b>;
            <span class="r24 r">isHostRawUINull</span> = <b>true</b>;
 
            <span class="c">// Unwrap the host: remove outer InternalHost object.</span>
            <b>if</b> (<span class="r21 r">host</span> == <b>null</b>)
            {
                <span class="c">// If host is null then the bools are correct. Nothing further to do here.</span>
                <b>return</b>;
            }
            <b>else</b> <b>if</b> (<span class="r21 r">host</span> <b>is</b> <a href="../../../hostifaces/InternalHost.cs.html#83104f2ad59a19df" class="t t">InternalHost</a>)
            {
                <span class="c">// This nesting can only be one level deep.</span>
                <span class="r21 r">host</span> = ((<a href="../../../hostifaces/InternalHost.cs.html#83104f2ad59a19df" class="t t">InternalHost</a>)<span class="r21 r">host</span>).<a href="../../../hostifaces/InternalHost.cs.html#f25431d0ab961179" class="i property">ExternalHost</a>;
            }
 
            <span class="c">// At this point we know for sure that the host is not null.</span>
            <span class="r22 r">isHostNull</span> = <b>false</b>;
 
            <span class="c">// Verify that the UI is not null.</span>
            <b>if</b> (<span class="r21 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a> == <b>null</b>) { <b>return</b>; }
 
            <span class="r23 r">isHostUINull</span> = <b>false</b>;
 
            <span class="c">// Verify that the raw UI is not null.</span>
            <b>if</b> (<span class="r21 r">host</span>.<a href="../../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<a href="../../../hostifaces/MshHostUserInterface.cs.html#9f0fd1e53edb6283" class="i property">RawUI</a> == <b>null</b>) { <b>return</b>; }
 
            <span class="r24 r">isHostRawUINull</span> = <b>false</b>;
        }
    }
}
</pre></td></tr></table></div></body></html>
