<!DOCTYPE html>
<html><head><title>RunspaceRef.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(419);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/client/RunspaceRef.cs" target="_top">engine\remoting\client\RunspaceRef.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<span class="i n">Internal</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provides a reference to a runspace that can be used to temporarily</span>
    <span class="c">///</span><span class="c"> push a remote runspace on top of a local runspace. This is</span>
    <span class="c">///</span><span class="c"> primary used by Start-PSSession. The purpose of this class is to hide</span>
    <span class="c">///</span><span class="c"> the CreatePipeline method and force it to be used as defined in this</span>
    <span class="c">///</span><span class="c"> class.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="3d42c5adde031f71" href="../../../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">RunspaceRef</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Runspace ref.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="../common/ObjectRef.cs.html#2cf76ce673a33ff2" class="t t">ObjectRef</a>&lt;<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>&gt; <a id="755cc488f714f7df" href="../../../R/755cc488f714f7df.html" target="n" data-glyph="46,1" class="i field">_runspaceRef</a>;
        <b>private bool</b> <a id="42d53a16e2142c5d" href="../../../R/42d53a16e2142c5d.html" target="n" data-glyph="46,1" class="i field">_stopInvoke</a>;
        <b>private readonly object</b> <a id="a65a9256db774a80" href="../../../R/a65a9256db774a80.html" target="n" data-glyph="46,1" class="i field">_localSyncObject</a>;
        <b>private static readonly</b> <a href="../commands/InvokeCommandCommand.cs.html#477d8c447d18a1e0" class="t t">RobustConnectionProgress</a> <a id="c24979be49321df0" href="../../../R/c24979be49321df0.html" target="n" data-glyph="46,1" class="i field">s_RCProgress</a> = <b>new</b> <a href="../commands/InvokeCommandCommand.cs.html#2a335b145a11de2b" class="t constructor">RobustConnectionProgress</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for RunspaceRef.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="3505288c9641af49" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">RunspaceRef</a>(<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r0 rd" class="r0 r">runspace</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r0 r">runspace</span> != <b>null</b>, <span class="s">&quot;Expected runspace != null&quot;</span>);
            <a href="#755cc488f714f7df" class="i field">_runspaceRef</a> = <b>new</b> <a href="../common/ObjectRef.cs.html#5120d88e7c7e837d" class="t constructor">ObjectRef</a>&lt;<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>&gt;(<span class="r0 r">runspace</span>);
            <a href="#42d53a16e2142c5d" class="i field">_stopInvoke</a> = <b>false</b>;
            <a href="#a65a9256db774a80" class="i field">_localSyncObject</a> = <b>new</b> <b>object</b>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Revert.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="9e48113465936c50" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Revert</a>()
        {
            <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#654ec503632ba849" class="i method">Revert</a>();
 
            <b>lock</b> (<a href="#a65a9256db774a80" class="i field">_localSyncObject</a>)
            {
                <a href="#42d53a16e2142c5d" class="i field">_stopInvoke</a> = <b>true</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="3644e3d059ae04ce" href="../../../R/../../0000000000.html" target="n" data-glyph="104,1" class="i property">Runspace</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>;
            }
        }
 
        <b>internal</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="79c1e8ea37d5fdff" href="../../../R/../../0000000000.html" target="n" data-glyph="104,1" class="i property">OldRunspace</a>
        {
            <b>get</b> { <b>return</b> <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#846658111665fcf7" class="i property">OldValue</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is runspace overridden.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="830c5f34ebf3eb27" href="../../../R/830c5f34ebf3eb27.html" target="n" data-glyph="104,1" class="i property">IsRunspaceOverridden</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#95f316ccb41731c0" class="i property">IsOverridden</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parse ps command using script block.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="71a47666aebf8801" href="../../../R/71a47666aebf8801.html" target="n" data-glyph="76,1" class="i method">ParsePsCommandUsingScriptBlock</a>(<b>string</b> <span id="r1 rd" class="r1 r">line</span>, <b>bool</b>? <span id="r2 rd" class="r2 r">useLocalScope</span>)
        {
            <b>try</b>
            {
                <span class="c">// Extract execution context from local runspace.</span>
                <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r3 rd" class="r3 r">localRunspace</span> = <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#846658111665fcf7" class="i property">OldValue</a>;
                <a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r4 rd" class="r4 r">context</span> = <span class="r3 r">localRunspace</span>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>;
 
                <span class="c">// This is trusted input as long as we&#39;re in FullLanguage mode</span>
                <span class="c">// and if we are not in a loopback configuration mode, in which case we always force remote script commands</span>
                <span class="c">// to be parsed and evaluated on the remote session (not in the current local session).</span>
                <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r5 rd" class="r5 r">remoteRunspace</span> = <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> <b>as</b> <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
                <b>bool</b> <span id="r6 rd" class="r6 r">isConfiguredLoopback</span> = <span class="r5 r">remoteRunspace</span> != <b>null</b> &amp;&amp; <span class="r5 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#9ee81e5f28211346" class="i property">IsConfiguredLoopBack</a>;
                <b>bool</b> <span id="r7 rd" class="r7 r">isTrustedInput</span> = !<span class="r6 r">isConfiguredLoopback</span> &amp;&amp; (<span class="r3 r">localRunspace</span>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>);
 
                <span class="c">// Create PowerShell from ScriptBlock.</span>
                <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r8 rd" class="r8 r">scriptBlock</span> = <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#7001f03560eb84f2" class="i method">Create</a>(<span class="r4 r">context</span>, <span class="r1 r">line</span>);
                <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r9 rd" class="r9 r">powerShell</span> = <span class="r8 r">scriptBlock</span>.<a href="../../lang/scriptblock.cs.html#4e20741f85928323" class="i method">GetPowerShell</a>(<span class="r4 r">context</span>, <span class="r7 r">isTrustedInput</span>, <span class="r2 r">useLocalScope</span>, <b>null</b>);
                <b>return</b> <span class="r9 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>;
            }
            <b>catch</b> (<a href="../../lang/scriptblock.cs.html#e3ec0b5ce28753ed" class="t t">ScriptBlockToPowerShellNotSupportedException</a>)
            {
            }
            <b>catch</b> (<a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>)
            {
            }
 
            <span class="c">// If parsing failed return null.</span>
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create ps command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="207a5bc8a2fa7956" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreatePsCommand</a>(<b>string</b> <span id="r10 rd" class="r10 r">line</span>, <b>bool</b> <span id="r11 rd" class="r11 r">isScript</span>, <b>bool</b>? <span id="r12 rd" class="r12 r">useNewScope</span>)
        {
            <span class="c">// Fall-back to traditional approach if runspace is not pushed.</span>
            <b>if</b> (!<a href="#3d42c5adde031f71" class="k">this</a>.<a href="#830c5f34ebf3eb27" class="i property">IsRunspaceOverridden</a>)
            {
                <b>return</b> <a href="#5bea6de08b329f43" class="i method">CreatePsCommandNotOverridden</a>(<span class="r10 r">line</span>, <span class="r11 r">isScript</span>, <span class="r12 r">useNewScope</span>);
            }
 
            <span class="c">// Try to parse commands as script-block.</span>
            <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r13 rd" class="r13 r">psCommand</span> = <a href="#71a47666aebf8801" class="i method">ParsePsCommandUsingScriptBlock</a>(<span class="r10 r">line</span>, <span class="r12 r">useNewScope</span>);
 
            <span class="c">// If that didn&#39;t work fall back to traditional approach.</span>
            <b>if</b> (<span class="r13 r">psCommand</span> == <b>null</b>)
            {
                <b>return</b> <a href="#5bea6de08b329f43" class="i method">CreatePsCommandNotOverridden</a>(<span class="r10 r">line</span>, <span class="r11 r">isScript</span>, <span class="r12 r">useNewScope</span>);
            }
 
            <span class="c">// Otherwise return the psCommandCollection we got.</span>
            <b>return</b> <span class="r13 r">psCommand</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates the PSCommand when the runspace is not overridden.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <a id="5bea6de08b329f43" href="../../../R/5bea6de08b329f43.html" target="n" data-glyph="76,1" class="i method">CreatePsCommandNotOverridden</a>(<b>string</b> <span id="r14 rd" class="r14 r">line</span>, <b>bool</b> <span id="r15 rd" class="r15 r">isScript</span>, <b>bool</b>? <span id="r16 rd" class="r16 r">useNewScope</span>)
        {
            <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r17 rd" class="r17 r">command</span> = <b>new</b> <a href="../../hostifaces/PSCommand.cs.html#45c724f1a0c9f07a" class="t constructor">PSCommand</a>();
 
            <b>if</b> (<span class="r15 r">isScript</span>)
            {
                <b>if</b> (<span class="r16 r">useNewScope</span>.<span class="i">HasValue</span>)
                {
                    <span class="r17 r">command</span>.<span class="i">AddScript</span>(<span class="r14 r">line</span>, <span class="r16 r">useNewScope</span>.<span class="i">Value</span>);
                }
                <b>else</b>
                {
                    <span class="r17 r">command</span>.<a href="../../hostifaces/PSCommand.cs.html#432fcb03d95e8672" class="i method">AddScript</a>(<span class="r14 r">line</span>);
                }
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r16 r">useNewScope</span>.<span class="i">HasValue</span>)
                {
                    <span class="r17 r">command</span>.<span class="i">AddCommand</span>(<span class="r14 r">line</span>, <span class="r16 r">useNewScope</span>.<span class="i">Value</span>);
                }
                <b>else</b>
                {
                    <span class="r17 r">command</span>.<a href="../../hostifaces/PSCommand.cs.html#2a2b7de6778550bd" class="i method">AddCommand</a>(<span class="r14 r">line</span>);
                }
            }
 
            <b>return</b> <span class="r17 r">command</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="700f1568431b0f63" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreatePipeline</a>(<b>string</b> <span id="r18 rd" class="r18 r">line</span>, <b>bool</b> <span id="r19 rd" class="r19 r">addToHistory</span>, <b>bool</b> <span id="r20 rd" class="r20 r">useNestedPipelines</span>)
        {
            <span class="c">// This method allows input commands to work against no-language runspaces. If a runspace</span>
            <span class="c">// is pushed, it tries to parse the line using a ScriptBlock object. If a runspace is not</span>
            <span class="c">// pushed, or if the parsing fails, in these cases it reverts to calling CreatePipeline</span>
            <span class="c">// using the unparsed line.</span>
 
            <a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <span id="r21 rd" class="r21 r">pipeline</span> = <b>null</b>;
 
            <span class="c">// In Start-PSSession scenario try to create a pipeline by parsing the line as a script block.</span>
            <b>if</b> (<a href="#3d42c5adde031f71" class="k">this</a>.<a href="#830c5f34ebf3eb27" class="i property">IsRunspaceOverridden</a>)
            {
                <span class="c">// Win8: exit should work to escape from the restrictive session</span>
                <b>if</b> ((<a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> <b>is</b> <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>) &amp;&amp;
                    (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r18 r">line</span>) &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="r18 r">line</span>.<span class="i">Trim</span>(), <span class="s">&quot;exit&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <span class="r18 r">line</span> = <span class="s">&quot;Exit-PSSession&quot;</span>;
                }
 
                <a href="../../hostifaces/PSCommand.cs.html#b9f024f73904cf55" class="t t">PSCommand</a> <span id="r22 rd" class="r22 r">psCommand</span> = <a href="#71a47666aebf8801" class="i method">ParsePsCommandUsingScriptBlock</a>(<span class="r18 r">line</span>, <b>null</b>);
                <b>if</b> (<span class="r22 r">psCommand</span> != <b>null</b>)
                {
                    <span class="r21 r">pipeline</span> = <span class="r20 r">useNestedPipelines</span> ?
                        <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<span class="i">CreateNestedPipeline</span>(<span class="r22 r">psCommand</span>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">CommandText</span>, <span class="r19 r">addToHistory</span>) :
                        <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<span class="i">CreatePipeline</span>(<span class="r22 r">psCommand</span>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>[0].<span class="i">CommandText</span>, <span class="r19 r">addToHistory</span>);
 
                    <span class="r21 r">pipeline</span>.<a href="../../hostifaces/Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>.<span class="i">Clear</span>();
 
                    <b>foreach</b> (<a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r23 rd" class="r23 r">command</span> <b>in</b> <span class="r22 r">psCommand</span>.<a href="../../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>)
                    {
                        <span class="r21 r">pipeline</span>.<a href="../../hostifaces/Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>.<span class="i">Add</span>(<span class="r23 r">command</span>);
                    }
                }
            }
 
            <span class="c">// If that didn&#39;t work out fall-back to the traditional approach.</span>
            <b>if</b> (<span class="r21 r">pipeline</span> == <b>null</b>)
            {
                <span class="r21 r">pipeline</span> = <span class="r20 r">useNestedPipelines</span> ?
                    <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../hostifaces/Connection.cs.html#f2343c85865d3dd2" class="i method">CreateNestedPipeline</a>(<span class="r18 r">line</span>, <span class="r19 r">addToHistory</span>) :
                    <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../hostifaces/Connection.cs.html#03ca63234015a955" class="i method">CreatePipeline</a>(<span class="r18 r">line</span>, <span class="r19 r">addToHistory</span>);
            }
 
            <span class="c">// Add robust connection callback if this is a pushed runspace.</span>
            <a href="remotepipeline.cs.html#018b4ca446b0fea0" class="t t">RemotePipeline</a> <span id="r24 rd" class="r24 r">remotePipeline</span> = <span class="r21 r">pipeline</span> <b>as</b> <a href="remotepipeline.cs.html#018b4ca446b0fea0" class="t t">RemotePipeline</a>;
            <b>if</b> (<a href="#3d42c5adde031f71" class="k">this</a>.<a href="#830c5f34ebf3eb27" class="i property">IsRunspaceOverridden</a> &amp;&amp; <span class="r24 r">remotePipeline</span> != <b>null</b>)
            {
                <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r25 rd" class="r25 r">shell</span> = <span class="r24 r">remotePipeline</span>.<a href="remotepipeline.cs.html#ea6d8045e5ac0559" class="i property">PowerShell</a>;
                <b>if</b> (<span class="r25 r">shell</span>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a> != <b>null</b>)
                {
                    <span class="r25 r">shell</span>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="ClientRemotePowerShell.cs.html#ed43c52261b131fb" class="i">RCConnectionNotification</a> += <span class="i">HandleRCConnectionNotification</span>;
                }
 
                <span class="c">// Add callback to write robust connection errors from stream.</span>
                <span class="r25 r">shell</span>.<a href="../../hostifaces/PowerShell.cs.html#f93842fee257462c" class="i property">ErrorBuffer</a>.<a href="../../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += (<span id="r26 rd" class="r26 r">sender</span>, <span id="r27 rd" class="r27 r">eventArgs</span>) =&gt;
                {
                    <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r28 rd" class="r28 r">remoteRunspace</span> = <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> <b>as</b> <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
                    <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <span id="r29 rd" class="r29 r">erBuffer</span> = <span class="r26 r">sender</span> <b>as</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;;
                    <b>if</b> (<span class="r28 r">remoteRunspace</span> != <b>null</b> &amp;&amp; <span class="r29 r">erBuffer</span> != <b>null</b> &amp;&amp;
                        <span class="r28 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="RemoteRunspacePoolInternal.cs.html#836d29f1e729f0db" class="i property">Host</a> != <b>null</b>)
                    {
                        <span class="i">Collection</span>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <span id="r30 rd" class="r30 r">erRecords</span> = <span class="r29 r">erBuffer</span>.<a href="../../hostifaces/PSDataCollection.cs.html#403be942120e2d89" class="i method">ReadAll</a>();
                        <b>foreach</b> (<b>var</b> <span id="r31 rd" class="r31 r">er</span> <b>in</b> <span class="r30 r">erRecords</span>)
                        {
                            <span class="r28 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="RemoteRunspacePoolInternal.cs.html#836d29f1e729f0db" class="i property">Host</a>.<a href="../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<span class="i">WriteErrorLine</span>(<span class="r31 r">er</span>.<span class="i">ToString</span>());
                        }
                    }
                };
            }
 
            <span class="r21 r">pipeline</span>.<a href="../../hostifaces/Pipeline.cs.html#7faebf4bd8def611" class="i method">SetHistoryString</a>(<span class="r18 r">line</span>);
 
            <b>return</b> <span class="r21 r">pipeline</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="0e671ad01279f9f6" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreatePipeline</a>()
        {
            <b>return</b> <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../hostifaces/Connection.cs.html#1aec41f4f0133089" class="i method">CreatePipeline</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create nested pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="cdf89a6bc90599d5" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreateNestedPipeline</a>()
        {
            <b>return</b> <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../hostifaces/Connection.cs.html#bd3b155c737daaa9" class="i method">CreateNestedPipeline</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Override.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="5fff75ed19f40d4e" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">Override</a>(<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r32 rd" class="r32 r">remoteRunspace</span>)
        {
            <b>bool</b> <span id="r33 rd" class="r33 r">isRunspacePushed</span> = <b>false</b>;
            <a href="#f637e658f3161989" class="i method">Override</a>(<span class="r32 r">remoteRunspace</span>, <b>null</b>, <b>out</b> <span class="r33 r">isRunspacePushed</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Override inside a safe lock.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">remoteRunspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Runspace to override.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">syncObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Object to use in synchronization.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">isRunspacePushed</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Set is runspace pushed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="f637e658f3161989" href="../../../R/f637e658f3161989.html" target="n" data-glyph="74,1" class="i method">Override</a>(<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r34 rd" class="r34 r">remoteRunspace</span>, <b>object</b> <span id="r35 rd" class="r35 r">syncObject</span>, <b>out bool</b> <span id="r36 rd" class="r36 r">isRunspacePushed</span>)
        {
            <b>lock</b> (<a href="#a65a9256db774a80" class="i field">_localSyncObject</a>)
            {
                <a href="#42d53a16e2142c5d" class="i field">_stopInvoke</a> = <b>false</b>;
            }
 
            <b>try</b>
            {
                <b>if</b> (<span class="r35 r">syncObject</span> != <b>null</b>)
                {
                    <b>lock</b> (<span class="r35 r">syncObject</span>)
                    {
                        <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#941ac12701f37148" class="i method">Override</a>(<span class="r34 r">remoteRunspace</span>);
                        <span class="r36 r">isRunspacePushed</span> = <b>true</b>;
                    }
                }
                <b>else</b>
                {
                    <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#941ac12701f37148" class="i method">Override</a>(<span class="r34 r">remoteRunspace</span>);
                    <span class="r36 r">isRunspacePushed</span> = <b>true</b>;
                }
 
                <b>if</b> ((<span class="r34 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#9ab3dedcf11ea947" class="i method">GetCurrentlyRunningPipeline</a>() != <b>null</b>))
                {
                    <span class="c">// Don&#39;t execute command if pushed runspace is already running one.</span>
                    <b>return</b>;
                }
 
                <b>using</b> (<a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r37 rd" class="r37 r">powerShell</span> = <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../../hostifaces/PowerShell.cs.html#40345bc4625ff918" class="i method">Create</a>())
                {
                    <span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Get-Command&quot;</span>);
                    <span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <b>new</b> <b>string</b>[] { <span class="s">&quot;Out-Default&quot;</span>, <span class="s">&quot;Exit-PSSession&quot;</span> });
                    <span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#ccf57242c9d46642" class="i property">Runspace</a> = <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>;
 
                    <b>bool</b> <span id="r38 rd" class="r38 r">isReleaseCandidateBackcompatibilityMode</span> = <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a>.<a href="../../hostifaces/Connection.cs.html#4a6e6e16fd38fa86" class="i method">GetRemoteProtocolVersion</a>() == <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#d19a1042a44001e8" class="t t">RemotingConstants</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#752985e4c2adeccd" class="i field">ProtocolVersionWin7RC</a>;
                    <span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#fe99bb3389416973" class="i property">IsGetCommandMetadataSpecialPipeline</a> = !<span class="r38 r">isReleaseCandidateBackcompatibilityMode</span>;
                    <b>int</b> <span id="r39 rd" class="r39 r">expectedNumberOfResults</span> = <span class="r38 r">isReleaseCandidateBackcompatibilityMode</span> ? 2 : 3;
 
                    <span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="ClientRemotePowerShell.cs.html#fc1dd053c42eadfb" class="i">HostCallReceived</a> += <span class="i">HandleHostCall</span>;
 
                    <span class="i">IAsyncResult</span> <span id="r40 rd" class="r40 r">asyncResult</span> = <span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#136b4e9e4079b11f" class="i method">BeginInvoke</a>();
                    <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r41 rd" class="r41 r">results</span> = <b>new</b> <a href="../../hostifaces/PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
 
                    <b>while</b> (!<a href="#42d53a16e2142c5d" class="i field">_stopInvoke</a>)
                    {
                        <span class="r40 r">asyncResult</span>.<span class="i">AsyncWaitHandle</span>.<span class="i">WaitOne</span>(1000);
 
                        <b>if</b> (<span class="r40 r">asyncResult</span>.<span class="i">IsCompleted</span>)
                        {
                            <span class="r41 r">results</span> = <span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#e6f659e0f52c6eca" class="i method">EndInvoke</a>(<span class="r40 r">asyncResult</span>);
                            <b>break</b>;
                        }
                    }
 
                    <b>if</b> (<span class="r37 r">powerShell</span>.<a href="../../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>.<a href="../../hostifaces/PSDataCollection.cs.html#e7cb43bbebbb4aca" class="i property">Count</a> &gt; 0 || <span class="r41 r">results</span>.<a href="../../hostifaces/PSDataCollection.cs.html#e7cb43bbebbb4aca" class="i property">Count</a> &lt; <span class="r39 r">expectedNumberOfResults</span>)
                    {
                        <b>throw</b> <a href="../common/WireDataFormat/RemoteHost.cs.html#b4240fded240f14a" class="t t">RemoteHostExceptions</a>.<a href="../common/WireDataFormat/RemoteHost.cs.html#897959742a9d68e9" class="i method">NewRemoteRunspaceDoesNotSupportPushRunspaceException</a>();
                    }
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#654ec503632ba849" class="i method">Revert</a>();
                <span class="r36 r">isRunspacePushed</span> = <b>false</b>;
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="6a1cc087dabad6cb" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleHostCall</a>(<b>object</b> <span id="r42 rd" class="r42 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <span id="r43 rd" class="r43 r">eventArgs</span>)
        {
            <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<span class="i n">Internal</span>.<a href="ClientRemotePowerShell.cs.html#b4d2ac017883b31c" class="t t">ClientRemotePowerShell</a>.<a href="ClientRemotePowerShell.cs.html#35b9f812802aafb1" class="i method">ExitHandler</a>(<span class="r42 r">sender</span>, <span class="r43 r">eventArgs</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Robust Connection Support
 
        <b>private void</b> <a id="fca17fe7529c817e" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleRCConnectionNotification</a>(<b>object</b> <span id="r44 rd" class="r44 r">sender</span>, <a href="ClientRemotePowerShell.cs.html#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a> <span id="r45 rd" class="r45 r">e</span>)
        {
            <b>switch</b> (<span class="r45 r">e</span>.<a href="ClientRemotePowerShell.cs.html#3515a0c0c4bbe57e" class="i property">Notification</a>)
            {
                <b>case</b> <a href="ClientRemotePowerShell.cs.html#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="ClientRemotePowerShell.cs.html#fd62f226276704d4" class="i field">NetworkFailureDetected</a>:
                    <span class="i">StartProgressBar</span>(<span class="r44 r">sender</span>.<span class="i">GetHashCode</span>(), <span class="r45 r">e</span>.<a href="ClientRemotePowerShell.cs.html#b0f7c354841ab1c5" class="i property">ComputerName</a>, (<span class="r45 r">e</span>.<a href="ClientRemotePowerShell.cs.html#aba922b0c875714c" class="i property">MaxRetryConnectionTime</a> / 1000));
                    <b>break</b>;
 
                <b>case</b> <a href="ClientRemotePowerShell.cs.html#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="ClientRemotePowerShell.cs.html#f8cbf12c6086459b" class="i field">AutoDisconnectStarting</a>:
                <b>case</b> <a href="ClientRemotePowerShell.cs.html#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="ClientRemotePowerShell.cs.html#b10ca9abe40057c8" class="i field">ConnectionRetrySucceeded</a>:
                    <span class="i">StopProgressBar</span>(<span class="r44 r">sender</span>.<span class="i">GetHashCode</span>());
                    <b>break</b>;
 
                <b>case</b> <a href="ClientRemotePowerShell.cs.html#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="ClientRemotePowerShell.cs.html#0c117990dcafffe1" class="i field">AutoDisconnectSucceeded</a>:
                <b>case</b> <a href="ClientRemotePowerShell.cs.html#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="ClientRemotePowerShell.cs.html#66a1d5afeef67425" class="i field">InternalErrorAbort</a>:
                    <a href="#e931709fcad9a1ae" class="i method">WriteRCFailedError</a>();
                    <span class="i">StopProgressBar</span>(<span class="r44 r">sender</span>.<span class="i">GetHashCode</span>());
                    <b>break</b>;
            }
        }
 
        <b>private void</b> <a id="e931709fcad9a1ae" href="../../../R/e931709fcad9a1ae.html" target="n" data-glyph="76,1" class="i method">WriteRCFailedError</a>()
        {
            <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r46 rd" class="r46 r">remoteRunspace</span> = <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> <b>as</b> <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
            <b>if</b> (<span class="r46 r">remoteRunspace</span> != <b>null</b> &amp;&amp;
                <span class="r46 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="RemoteRunspacePoolInternal.cs.html#836d29f1e729f0db" class="i property">Host</a> != <b>null</b>)
            {
                <span class="r46 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="RemoteRunspacePoolInternal.cs.html#836d29f1e729f0db" class="i property">Host</a>.<a href="../../hostifaces/MshHost.cs.html#f3c3c89a5e9dd42a" class="i property">UI</a>.<a href="../../hostifaces/MshHostUserInterface.cs.html#c90737c2e1ab652f" class="i method">WriteErrorLine</a>(
                    <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RCAutoDisconnectingError</span>,
                    <span class="r46 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#912a4002c4156bbf" class="i property">ConnectionInfo</a>.<a href="../common/RunspaceConnectionInfo.cs.html#64143b41c05cd7ea" class="i property">ComputerName</a>));
            }
        }
 
        <b>private void</b> <a id="8f541da6c178ab3d" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StartProgressBar</a>(
            <b>long</b> <span id="r47 rd" class="r47 r">sourceId</span>,
            <b>string</b> <span id="r48 rd" class="r48 r">computerName</span>,
            <b>int</b> <span id="r49 rd" class="r49 r">totalSeconds</span>)
        {
            <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r50 rd" class="r50 r">remoteRunspace</span> = <a href="#755cc488f714f7df" class="i field">_runspaceRef</a>.<a href="../common/ObjectRef.cs.html#396da730a140e420" class="i property">Value</a> <b>as</b> <a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>;
            <b>if</b> (<span class="r50 r">remoteRunspace</span> != <b>null</b>)
            {
                <a href="#c24979be49321df0" class="i field">s_RCProgress</a>.<a href="../commands/InvokeCommandCommand.cs.html#ff22cf6074e7d25c" class="i method">StartProgress</a>(
                    <span class="r47 r">sourceId</span>,
                    <span class="r48 r">computerName</span>,
                    <span class="r49 r">totalSeconds</span>,
                    <span class="r50 r">remoteRunspace</span>.<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="RemoteRunspacePoolInternal.cs.html#836d29f1e729f0db" class="i property">Host</a>);
            }
        }
 
        <b>private static void</b> <a id="a1d4797eb9dda9e8" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">StopProgressBar</a>(
            <b>long</b> <span id="r51 rd" class="r51 r">sourceId</span>)
        {
            <a href="#c24979be49321df0" class="i field">s_RCProgress</a>.<a href="../commands/InvokeCommandCommand.cs.html#ff9350d940a0d4b7" class="i method">StopProgress</a>(<span class="r51 r">sourceId</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
