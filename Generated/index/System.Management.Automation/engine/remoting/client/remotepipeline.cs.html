<!DOCTYPE html>
<html><head><title>remotepipeline.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(1171);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/client/remotepipeline.cs" target="_top">engine\remoting\client\remotepipeline.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 1634, 1691 <span class="c">// Stops compiler from warning about unknown warnings</span>
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <b>internal class</b> <a id="018b4ca446b0fea0" href="../../../R/018b4ca446b0fea0.html" target="n" data-glyph="2,0" class="t t">RemotePipeline</a> : <a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Members
 
        <b>private</b> <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <a id="cd590a53bdc07dbe" href="../../../R/cd590a53bdc07dbe.html" target="n" data-glyph="46,1" class="i field">_powershell</a>;
        <b>private readonly bool</b> <a id="3188cfc5e2c3bc36" href="../../../R/3188cfc5e2c3bc36.html" target="n" data-glyph="46,1" class="i field">_addToHistory</a>;
        <b>private bool</b> <a id="5b9d2e64a57e4942" href="../../../R/5b9d2e64a57e4942.html" target="n" data-glyph="46,1" class="i field">_isNested</a>;
        <b>private bool</b> <a id="199c9d41084be228" href="../../../R/199c9d41084be228.html" target="n" data-glyph="46,1" class="i field">_isSteppable</a>;
        <b>private readonly</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="2be1c293cacb1e03" href="../../../R/2be1c293cacb1e03.html" target="n" data-glyph="46,1" class="i field">_runspace</a>;
        <b>private readonly object</b> <a id="74c63668400f57d8" href="../../../R/74c63668400f57d8.html" target="n" data-glyph="46,1" class="i field">_syncRoot</a> = <b>new</b> <b>object</b>();
        <b>private bool</b> <a id="5f25a7fe697c69ba" href="../../../R/5f25a7fe697c69ba.html" target="n" data-glyph="46,1" class="i field">_disposed</a> = <b>false</b>;
        <b>private string</b> <a id="549dd738aa2de5cd" href="../../../R/549dd738aa2de5cd.html" target="n" data-glyph="46,1" class="i field">_historyString</a>;
        <b>private</b> <a href="../../hostifaces/Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <a id="0bc549d90f0d16d5" href="../../../R/0bc549d90f0d16d5.html" target="n" data-glyph="46,1" class="i field">_pipelineStateInfo</a> = <b>new</b> <a href="../../hostifaces/Pipeline.cs.html#6c6987102e594a17" class="t constructor">PipelineStateInfo</a>(<a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>);
        <b>private readonly</b> <a href="../../hostifaces/Command.cs.html#8276f51c05ad2fa1" class="t t">CommandCollection</a> <a id="384bca49c089c48c" href="../../../R/384bca49c089c48c.html" target="n" data-glyph="46,1" class="i field">_commands</a> = <b>new</b> <a href="../../hostifaces/Command.cs.html#0901a086d0d4d603" class="t constructor">CommandCollection</a>();
        <b>private readonly string</b> <a id="4fc53d176aa29be8" href="../../../R/4fc53d176aa29be8.html" target="n" data-glyph="46,1" class="i field">_computerName</a>;
        <b>private readonly</b> <span class="i">Guid</span> <a id="bbd95c6fa9037e75" href="../../../R/bbd95c6fa9037e75.html" target="n" data-glyph="46,1" class="i field">_runspaceId</a>;
        <b>private readonly</b> <a href="RemoteRunspacePoolInternal.cs.html#b586ca980bfda5bc" class="t t">ConnectCommandInfo</a> <a id="3b2a93d4feb4a4a6" href="../../../R/3b2a93d4feb4a4a6.html" target="n" data-glyph="46,1" class="i field">_connectCmdInfo</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is queue of all the state change event which have occured for</span>
        <span class="c">///</span><span class="c"> this pipeline. RaisePipelineStateEvents raises event for each</span>
        <span class="c">///</span><span class="c"> item in this queue. We don&#39;t raise the event with in SetPipelineState</span>
        <span class="c">///</span><span class="c"> because often SetPipelineState is called with in a lock.</span>
        <span class="c">///</span><span class="c"> Raising event in lock introduces chances of deadlock in GUI applications.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Queue</span>&lt;<a href="#e800a5b34b679a2f" class="t t">ExecutionEventQueueItem</a>&gt; <a id="925a1146db86496c" href="../../../R/925a1146db86496c.html" target="n" data-glyph="46,1" class="i field">_executionEventQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#e800a5b34b679a2f" class="t t">ExecutionEventQueueItem</a>&gt;();
 
        <b>private sealed class</b> <a id="e800a5b34b679a2f" href="../../../R/e800a5b34b679a2f.html" target="n" data-glyph="4,1" class="t t">ExecutionEventQueueItem</a>
        {
            <b>public</b> <a id="7fc68b9258ad624c" href="../../../R/7fc68b9258ad624c.html" target="n" data-glyph="72,2" class="t constructor">ExecutionEventQueueItem</a>(<a href="../../hostifaces/Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <span id="r0 rd" class="r0 r">pipelineStateInfo</span>, <a href="../../hostifaces/Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r1 rd" class="r1 r">currentAvailability</span>, <a href="../../hostifaces/Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r2 rd" class="r2 r">newAvailability</span>)
            {
                <a href="#e800a5b34b679a2f" class="k">this</a>.<a href="#9ce5ae6ac03d95f3" class="i field">PipelineStateInfo</a> = <span class="r0 r">pipelineStateInfo</span>;
                <a href="#e800a5b34b679a2f" class="k">this</a>.<a href="#8b23e7e459d8d749" class="i field">CurrentRunspaceAvailability</a> = <span class="r1 r">currentAvailability</span>;
                <a href="#e800a5b34b679a2f" class="k">this</a>.<a href="#d6a4151bcb380650" class="i field">NewRunspaceAvailability</a> = <span class="r2 r">newAvailability</span>;
            }
 
            <b>public</b> <a href="../../hostifaces/Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <a id="9ce5ae6ac03d95f3" href="../../../R/9ce5ae6ac03d95f3.html" target="n" data-glyph="42,2" class="i field">PipelineStateInfo</a>;
            <b>public</b> <a href="../../hostifaces/Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="8b23e7e459d8d749" href="../../../R/8b23e7e459d8d749.html" target="n" data-glyph="42,2" class="i field">CurrentRunspaceAvailability</a>;
            <b>public</b> <a href="../../hostifaces/Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="d6a4151bcb380650" href="../../../R/d6a4151bcb380650.html" target="n" data-glyph="42,2" class="i field">NewRunspaceAvailability</a>;
        }
 
        <b>private readonly bool</b> <a id="cb9c01dab422d5ba" href="../../../R/cb9c01dab422d5ba.html" target="n" data-glyph="46,1" class="i field">_performNestedCheck</a> = <b>true</b>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Members
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Private constructor that does most of the work constructing a remote pipeline object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">RemoteRunspace object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">AddToHistory.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">IsNested.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private</b> <a id="f1aef74e7c330b85" href="../../../R/f1aef74e7c330b85.html" target="n" data-glyph="76,1" class="t constructor">RemotePipeline</a>(<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r3 rd" class="r3 r">runspace</span>, <b>bool</b> <span id="r4 rd" class="r4 r">addToHistory</span>, <b>bool</b> <span id="r5 rd" class="r5 r">isNested</span>)
            : <a href="../../hostifaces/Pipeline.cs.html#51363ffeaeaae9e3" class="k">base</a>(<span class="r3 r">runspace</span>)
        {
            <a href="#3188cfc5e2c3bc36" class="i field">_addToHistory</a> = <span class="r4 r">addToHistory</span>;
            <a href="#5b9d2e64a57e4942" class="i field">_isNested</a> = <span class="r5 r">isNested</span>;
            <a href="#199c9d41084be228" class="i field">_isSteppable</a> = <b>false</b>;
            <a href="#2be1c293cacb1e03" class="i field">_runspace</a> = <span class="r3 r">runspace</span>;
            <a href="#4fc53d176aa29be8" class="i field">_computerName</a> = ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#912a4002c4156bbf" class="i property">ConnectionInfo</a>.<a href="../common/RunspaceConnectionInfo.cs.html#64143b41c05cd7ea" class="i property">ComputerName</a>;
            <a href="#bbd95c6fa9037e75" class="i field">_runspaceId</a> = <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#af7b715fe8b1bee2" class="i property">InstanceId</a>;
 
            <span class="c">// Initialize streams</span>
            <a href="#1a0b44b3678aea85" class="i field">_inputCollection</a> = <b>new</b> <a href="../../hostifaces/PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<b>object</b>&gt;();
            <a href="#1a0b44b3678aea85" class="i field">_inputCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#964a56f986986159" class="i property">ReleaseOnEnumeration</a> = <b>true</b>;
 
            <a href="#033cd67046953373" class="i field">_inputStream</a> = <b>new</b> <span class="t">PSDataCollectionStream</span>&lt;<b>object</b>&gt;(<span class="i">Guid</span>.<span class="i">Empty</span>, <a href="#1a0b44b3678aea85" class="i field">_inputCollection</a>);
            <a href="#441b980bef289a0c" class="i field">_outputCollection</a> = <b>new</b> <a href="../../hostifaces/PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
            <a href="#5e5978ea25581111" class="i field">_outputStream</a> = <b>new</b> <span class="t">PSDataCollectionStream</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<span class="i">Guid</span>.<span class="i">Empty</span>, <a href="#441b980bef289a0c" class="i field">_outputCollection</a>);
            <a href="#7bd7310e1e8b37b5" class="i field">_errorCollection</a> = <b>new</b> <a href="../../hostifaces/PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;();
            <a href="#cb69d03f546a1345" class="i field">_errorStream</a> = <b>new</b> <span class="t">PSDataCollectionStream</span>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;(<span class="i">Guid</span>.<span class="i">Empty</span>, <a href="#7bd7310e1e8b37b5" class="i field">_errorCollection</a>);
 
            <span class="c">// Create object stream for method executor objects.</span>
            <a href="#5d6a281a19d5de40" class="i property">MethodExecutorStream</a> = <b>new</b> <a href="../../../utils/ObjectStream.cs.html#9f848b3587e1f797" class="t constructor">ObjectStream</a>();
            <a href="#63fb608d14323ae9" class="i property">IsMethodExecutorStreamEnabled</a> = <b>false</b>;
 
            <a href="../../hostifaces/Pipeline.cs.html#2efce02cbe3b2d6b" class="i method">SetCommandCollection</a>(<a href="#384bca49c089c48c" class="i field">_commands</a>);
 
            <span class="c">// Create event which will be signalled when pipeline execution</span>
            <span class="c">// is completed/failed/stoped.</span>
            <span class="c">// Note:Runspace.Close waits for all the running pipeline</span>
            <span class="c">// to finish.  This Event must be created before pipeline is</span>
            <span class="c">// added to list of running pipelines. This avoids the race condition</span>
            <span class="c">// where Close is called after pipeline is added to list of</span>
            <span class="c">// running pipeline but before event is created.</span>
            <a href="#cf9dafc85fda0d41" class="i property">PipelineFinishedEvent</a> = <b>new</b> <span class="i">ManualResetEvent</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs a remote pipeline for the specified runspace and</span>
        <span class="c">///</span><span class="c"> specified command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Runspace in which to create the pipeline.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command as a string, to be used in pipeline creation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether to add the command to the runspaces history.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether this pipeline is nested.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="715b55e2c4cff8c1" href="../../../R/715b55e2c4cff8c1.html" target="n" data-glyph="74,1" class="t constructor">RemotePipeline</a>(<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r6 rd" class="r6 r">runspace</span>, <b>string</b> <span id="r7 rd" class="r7 r">command</span>, <b>bool</b> <span id="r8 rd" class="r8 r">addToHistory</span>, <b>bool</b> <span id="r9 rd" class="r9 r">isNested</span>)
            : <a href="#f1aef74e7c330b85" class="k">this</a>(<span class="r6 r">runspace</span>, <span class="r8 r">addToHistory</span>, <span class="r9 r">isNested</span>)
        {
            <b>if</b> (<span class="r7 r">command</span> != <b>null</b>)
            {
                <a href="#384bca49c089c48c" class="i field">_commands</a>.<span class="i">Add</span>(<b>new</b> <a href="../../hostifaces/Command.cs.html#12fe527c78833611" class="t constructor">Command</a>(<span class="r7 r">command</span>, <b>true</b>));
            }
 
            <span class="c">// initialize the underlying powershell object</span>
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a> = <b>new</b> <a href="../../hostifaces/PowerShell.cs.html#44ab5d75dd516996" class="t constructor">PowerShell</a>(<a href="#033cd67046953373" class="i field">_inputStream</a>, <a href="#5e5978ea25581111" class="i field">_outputStream</a>, <a href="#cb69d03f546a1345" class="i field">_errorStream</a>,
                ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>);
 
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#ca9abcd81cc054f5" class="i method">SetIsNested</a>(<span class="r9 r">isNested</span>);
 
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#c66682d1287920a2" class="i">InvocationStateChanged</a> += <span class="i">HandleInvocationStateChanged</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructs a remote pipeline object associated with a remote running</span>
        <span class="c">///</span><span class="c"> command but in a disconnected state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Remote runspace associated with running command.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="709351a766991b78" href="../../../R/709351a766991b78.html" target="n" data-glyph="74,1" class="t constructor">RemotePipeline</a>(<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a> <span id="r10 rd" class="r10 r">runspace</span>)
            : <a href="#f1aef74e7c330b85" class="k">this</a>(<span class="r10 r">runspace</span>, <b>false</b>, <b>false</b>)
        {
            <b>if</b> (<span class="r10 r">runspace</span>.<a href="remoterunspace.cs.html#c7d59b1aea27b0c9" class="i property">RemoteCommand</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">PipelineStrings</span>.<span class="i">InvalidRemoteCommand</span>);
            }
 
            <a href="#3b2a93d4feb4a4a6" class="i field">_connectCmdInfo</a> = <span class="r10 r">runspace</span>.<a href="remoterunspace.cs.html#c7d59b1aea27b0c9" class="i property">RemoteCommand</a>;
            <a href="#384bca49c089c48c" class="i field">_commands</a>.<a href="../../hostifaces/Command.cs.html#66864c9c0903c153" class="i method">Add</a>(<a href="#3b2a93d4feb4a4a6" class="i field">_connectCmdInfo</a>.<a href="RemoteRunspacePoolInternal.cs.html#059b4cc2a74508e2" class="i property">Command</a>);
 
            <span class="c">// Beginning state will be disconnected.</span>
            <a href="#fda2ab3610e5b597" class="i method">SetPipelineState</a>(<a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#401ea10f45569c67" class="i field">Disconnected</a>, <b>null</b>);
 
            <span class="c">// Create the underlying powershell object.</span>
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a> = <b>new</b> <a href="../../hostifaces/PowerShell.cs.html#22790b23b927ed56" class="t constructor">PowerShell</a>(<a href="#3b2a93d4feb4a4a6" class="i field">_connectCmdInfo</a>, <a href="#033cd67046953373" class="i field">_inputStream</a>, <a href="#5e5978ea25581111" class="i field">_outputStream</a>, <a href="#cb69d03f546a1345" class="i field">_errorStream</a>,
                ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>);
 
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#c66682d1287920a2" class="i">InvocationStateChanged</a> += <span class="i">HandleInvocationStateChanged</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a cloned pipeline from the specified one.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">pipeline</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Pipeline to clone from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">This constructor is private because this will</span>
        <span class="c">///</span><span class="c"> only be called from the copy method</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private</b> <a id="b410f46fb9869aa1" href="../../../R/b410f46fb9869aa1.html" target="n" data-glyph="76,1" class="t constructor">RemotePipeline</a>(<a href="#018b4ca446b0fea0" class="t t">RemotePipeline</a> <span id="r11 rd" class="r11 r">pipeline</span>)
            : <a href="#715b55e2c4cff8c1" class="k">this</a>(
                (<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<span class="r11 r">pipeline</span>.<a href="#f7d523ebf104ba6c" class="i property">Runspace</a>,
                <span class="r7 r">command</span>: <b>null</b>,
                <span class="r8 r">addToHistory</span>: <b>false</b>,
                <span class="r11 r">pipeline</span>.<a href="#c91ed048849ebfaf" class="i property">IsNested</a>)
        {
            <a href="#199c9d41084be228" class="i field">_isSteppable</a> = <span class="r11 r">pipeline</span>.<a href="#199c9d41084be228" class="i field">_isSteppable</a>;
 
            <span class="c">// NTRAID#Windows Out Of Band Releases-915851-2005/09/13</span>
            <span class="c">// the above comment copied from RemotePipelineBase which</span>
            <span class="c">// originally copied it from PipelineBase</span>
            <b>if</b> (<span class="r11 r">pipeline</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r11 r">pipeline</span>));
            }
 
            <b>if</b> (<span class="r11 r">pipeline</span>.<a href="#5f25a7fe697c69ba" class="i field">_disposed</a>)
            {
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;pipeline&quot;</span>);
            }
 
            <a href="#3188cfc5e2c3bc36" class="i field">_addToHistory</a> = <span class="r11 r">pipeline</span>.<a href="#3188cfc5e2c3bc36" class="i field">_addToHistory</a>;
            <a href="#549dd738aa2de5cd" class="i field">_historyString</a> = <span class="r11 r">pipeline</span>.<a href="#549dd738aa2de5cd" class="i field">_historyString</a>;
            <b>foreach</b> (<a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r12 rd" class="r12 r">command</span> <b>in</b> <span class="r11 r">pipeline</span>.<a href="../../hostifaces/Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>)
            {
                <a href="../../hostifaces/Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r13 rd" class="r13 r">clone</span> = <span class="r12 r">command</span>.<a href="../../hostifaces/Command.cs.html#66d065d201023e25" class="i method">Clone</a>();
 
                <span class="c">// Attach the cloned Command to this pipeline.</span>
                <a href="../../hostifaces/Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>.<span class="i">Add</span>(<span class="r13 r">clone</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Override for creating a copy of pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Pipeline object which is copy of this pipeline</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="7a6bfb9907a46689" href="../../../R/7a6bfb9907a46689.html" target="n" data-glyph="72,1" class="i method">Copy</a>()
        {
            <b>if</b> (<a href="#5f25a7fe697c69ba" class="i field">_disposed</a>)
            {
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;pipeline&quot;</span>);
            }
 
            <b>return</b> (<a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>)<b>new</b> <a href="#b410f46fb9869aa1" class="t constructor">RemotePipeline</a>(<a href="#018b4ca446b0fea0" class="k">this</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Constructors
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the runspace this pipeline is created on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="f7d523ebf104ba6c" href="../../../R/f7d523ebf104ba6c.html" target="n" data-glyph="102,1" class="i property">Runspace</a>
        {
            <b>get</b>
            {
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56503
                <span class="c">// NTRAID#Windows Out Of Band Releases-915851-2005/09/13</span>
                <b>if</b> (<a href="#5f25a7fe697c69ba" class="i field">_disposed</a>)
                {
                    <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;pipeline&quot;</span>);
                }
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> 56503
 
                <b>return</b> <a href="#2be1c293cacb1e03" class="i field">_runspace</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This internal method doesn&#39;t do the _disposed check.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="7238bed80a1fe41f" href="../../../R/7238bed80a1fe41f.html" target="n" data-glyph="74,1" class="i method">GetRunspace</a>()
        {
            <b>return</b> <a href="#2be1c293cacb1e03" class="i field">_runspace</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is this pipeline nested.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override bool</b> <a id="c91ed048849ebfaf" href="../../../R/c91ed048849ebfaf.html" target="n" data-glyph="102,1" class="i property">IsNested</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5b9d2e64a57e4942" class="i field">_isNested</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal method to set the value of IsNested. This is called</span>
        <span class="c">///</span><span class="c"> by serializer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="57f7aa4a90f59ea7" href="../../../R/57f7aa4a90f59ea7.html" target="n" data-glyph="74,1" class="i method">SetIsNested</a>(<b>bool</b> <span id="r14 rd" class="r14 r">isNested</span>)
        {
            <a href="#5b9d2e64a57e4942" class="i field">_isNested</a> = <span class="r14 r">isNested</span>;
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#ca9abcd81cc054f5" class="i method">SetIsNested</a>(<span class="r14 r">isNested</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Internal method to set the value of IsSteppable. This is called</span>
        <span class="c">///</span><span class="c"> during DoConcurrentCheck.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="9e63058fccaf88c7" href="../../../R/9e63058fccaf88c7.html" target="n" data-glyph="74,1" class="i method">SetIsSteppable</a>(<b>bool</b> <span id="r15 rd" class="r15 r">isSteppable</span>)
        {
            <a href="#199c9d41084be228" class="i field">_isSteppable</a> = <span class="r15 r">isSteppable</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Info about current state of the pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This value indicates the state of the pipeline after the change.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../hostifaces/Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <a id="088450944502051f" href="../../../R/088450944502051f.html" target="n" data-glyph="102,1" class="i property">PipelineStateInfo</a>
        {
            <b>get</b>
            {
                <b>lock</b> (<a href="#74c63668400f57d8" class="i field">_syncRoot</a>)
                {
                    <span class="c">// Note:We do not return internal state.</span>
                    <b>return</b> <a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#7d0ccb2943705d92" class="i method">Clone</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the input writer for this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../../utils/IObjectWriter.cs.html#37301df630b2ae9a" class="t t">PipelineWriter</a> <a id="3e5105001b618b83" href="../../../R/3e5105001b618b83.html" target="n" data-glyph="102,1" class="i property">Input</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#033cd67046953373" class="i field">_inputStream</a>.<a href="../../../utils/ObjectStream.cs.html#ec0ff62c4b0a9a49" class="i property">ObjectWriter</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the output reader for this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../../utils/IObjectReader.cs.html#6b2221741902f9bd" class="t t">PipelineReader</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="29d3347675fb48d8" href="../../../R/29d3347675fb48d8.html" target="n" data-glyph="102,1" class="i property">Output</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5e5978ea25581111" class="i field">_outputStream</a>.<a href="../../../utils/ObjectStream.cs.html#4022074bb34dfed9" class="i method">GetPSObjectReaderForPipeline</a>(<a href="#4fc53d176aa29be8" class="i field">_computerName</a>, <a href="#bbd95c6fa9037e75" class="i field">_runspaceId</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the error output reader for this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the non-terminating error stream from the command.</span>
        <span class="c">///</span><span class="c"> In this release, the objects read from this PipelineReader</span>
        <span class="c">///</span><span class="c"> are PSObjects wrapping ErrorRecords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../../utils/IObjectReader.cs.html#6b2221741902f9bd" class="t t">PipelineReader</a>&lt;<b>object</b>&gt; <a id="bac27ff1276c3b0d" href="../../../R/bac27ff1276c3b0d.html" target="n" data-glyph="102,1" class="i property">Error</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#cb69d03f546a1345" class="i field">_errorStream</a>.<a href="../../../utils/ObjectStream.cs.html#3403b6e2c20c9747" class="i method">GetObjectReaderForPipeline</a>(<a href="#4fc53d176aa29be8" class="i field">_computerName</a>, <a href="#bbd95c6fa9037e75" class="i field">_runspaceId</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> String which is added in the history.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">This needs to be internal so that it can be replaced</span>
        <span class="c">///</span><span class="c"> by invoke-cmd to place correct string in history.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="4cc9d603dfce75fc" href="../../../R/../../0000000000.html" target="n" data-glyph="104,1" class="i property">HistoryString</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#549dd738aa2de5cd" class="i field">_historyString</a>;
            }
 
            <b>set</b>
            {
                <a href="#549dd738aa2de5cd" class="i field">_historyString</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Whether the pipeline needs to be added to history of the runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="d76f83141a46d6de" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">AddToHistory</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#3188cfc5e2c3bc36" class="i field">_addToHistory</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> streams
 
        <span class="c">// Stream and Collection go together...a stream wraps</span>
        <span class="c">// a corresponding collection to support</span>
        <span class="c">// streaming behavior of the pipeline.</span>
        <b>private readonly</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="441b980bef289a0c" href="../../../R/441b980bef289a0c.html" target="n" data-glyph="46,1" class="i field">_outputCollection</a>;
        <b>private readonly</b> <a href="../../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="5e5978ea25581111" href="../../../R/5e5978ea25581111.html" target="n" data-glyph="46,1" class="i field">_outputStream</a>;
        <b>private readonly</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <a id="7bd7310e1e8b37b5" href="../../../R/7bd7310e1e8b37b5.html" target="n" data-glyph="46,1" class="i field">_errorCollection</a>;
        <b>private readonly</b> <a href="../../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <a id="cb69d03f546a1345" href="../../../R/cb69d03f546a1345.html" target="n" data-glyph="46,1" class="i field">_errorStream</a>;
        <b>private readonly</b> <a href="../../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<b>object</b>&gt; <a id="1a0b44b3678aea85" href="../../../R/1a0b44b3678aea85.html" target="n" data-glyph="46,1" class="i field">_inputCollection</a>;
        <b>private readonly</b> <a href="../../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<b>object</b>&gt; <a id="033cd67046953373" href="../../../R/033cd67046953373.html" target="n" data-glyph="46,1" class="i field">_inputStream</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stream for providing input to PipelineProcessor. Host will write on</span>
        <span class="c">///</span><span class="c"> ObjectWriter of this stream. PipelineProcessor will read from</span>
        <span class="c">///</span><span class="c"> ObjectReader of this stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="../../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<b>object</b>&gt; <a id="2c28be971772b7ad" href="../../../R/2c28be971772b7ad.html" target="n" data-glyph="105,1" class="i property">InputStream</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#033cd67046953373" class="i field">_inputStream</a>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> streams
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Invoke
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the pipeline asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Results are returned through the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>.<a href="../../hostifaces/Pipeline.cs.html#e61d6d76ceba7ad2" class="i property">Output</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> reader.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="b72918c1cc3c2057" href="../../../R/b72918c1cc3c2057.html" target="n" data-glyph="72,1" class="i method">InvokeAsync</a>()
        {
            <a href="#b1addfcf53f038aa" class="i method">InitPowerShell</a>(<b>false</b>);
            <a href="#7d88f63220449597" class="i method">CoreInvokeAsync</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invokes a remote command and immediately disconnects if</span>
        <span class="c">///</span><span class="c"> transport layer supports it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="ae176187f5e1d174" href="../../../R/ae176187f5e1d174.html" target="n" data-glyph="74,1" class="i method">InvokeAsyncAndDisconnect</a>()
        {
            <span class="c">// Initialize PowerShell invocation with &quot;InvokeAndDisconnect&quot; setting.</span>
            <a href="#b1addfcf53f038aa" class="i method">InitPowerShell</a>(<b>false</b>, <b>true</b>);
            <a href="#7d88f63220449597" class="i method">CoreInvokeAsync</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the pipeline, synchronously, returning the results as an</span>
        <span class="c">///</span><span class="c"> array of objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">an array of input objects to pass to the pipeline.</span>
        <span class="c">///</span><span class="c"> Array may be empty but may not be null</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An array of zero or more result objects.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Caller of synchronous exectute should not close</span>
        <span class="c">///</span><span class="c"> input objectWriter. Synchronous invoke will always close the input</span>
        <span class="c">///</span><span class="c"> objectWriter.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> On Synchronous Invoke if output is throttled and no one is reading from</span>
        <span class="c">///</span><span class="c"> output pipe, Execution will block after buffer is full.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="63aed8dbfbb95066" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Invoke</a>(<span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">IEnumerable</span> <span id="r16 rd" class="r16 r">input</span>)
        {
            <b>if</b> (<span class="r16 r">input</span> == <b>null</b>)
            {
                <a href="#018b4ca446b0fea0" class="k">this</a>.<a href="#2c28be971772b7ad" class="i property">InputStream</a>.<a href="../../../utils/ObjectStream.cs.html#ced0aa52c520ca2b" class="i method">Close</a>();
            }
 
            <a href="#b1addfcf53f038aa" class="i method">InitPowerShell</a>(<b>true</b>);
 
            <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r17 rd" class="r17 r">results</span>;
 
            <b>try</b>
            {
                <span class="r17 r">results</span> = <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<span class="i">Invoke</span>(<span class="r16 r">input</span>);
            }
            <b>catch</b> (<a href="../../hostifaces/RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>)
            {
                <a href="../../hostifaces/Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r18 rd" class="r18 r">e</span> =
                    <b>new</b> <a href="../../hostifaces/Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                    (
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotOpenForPipeline</span>, <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>.<span class="i">ToString</span>()),
                        <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>,
                        <a href="../../hostifaces/Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="../../hostifaces/Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                    );
                <b>throw</b> <span class="r18 r">e</span>;
            }
 
            <b>return</b> <span class="r17 r">results</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Invoke
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Connect
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Connects synchronously to a running command on a remote server.</span>
        <span class="c">///</span><span class="c"> The pipeline object must be in the disconnected state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A collection of result objects.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="34b6aeb6f6faa35e" href="../../../R/34b6aeb6f6faa35e.html" target="n" data-glyph="72,1" class="i method">Connect</a>()
        {
            <a href="#2d1d1289225c91bf" class="i method">InitPowerShellForConnect</a>(<b>true</b>);
 
            <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r19 rd" class="r19 r">results</span>;
 
            <b>try</b>
            {
                <span class="r19 r">results</span> = <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#fe120d91f29f69f6" class="i method">Connect</a>();
            }
            <b>catch</b> (<a href="../../hostifaces/RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>)
            {
                <a href="../../hostifaces/Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r20 rd" class="r20 r">e</span> =
                    <b>new</b> <a href="../../hostifaces/Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                    (
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotOpenForPipelineConnect</span>, <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>.<span class="i">ToString</span>()),
                        <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>,
                        <a href="../../hostifaces/Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="../../hostifaces/Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                    );
 
                <b>throw</b> <span class="r20 r">e</span>;
            }
 
            <span class="c">// PowerShell object will return empty results if it was provided an alternative object to</span>
            <span class="c">// collect output in.  Check to see if the output was collected in a member variable.</span>
            <b>if</b> (<span class="r19 r">results</span>.<span class="i">Count</span> == 0)
            {
                <b>if</b> (<a href="#441b980bef289a0c" class="i field">_outputCollection</a> != <b>null</b> &amp;&amp; <a href="#441b980bef289a0c" class="i field">_outputCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#e7cb43bbebbb4aca" class="i property">Count</a> &gt; 0)
                {
                    <span class="r19 r">results</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<a href="#441b980bef289a0c" class="i field">_outputCollection</a>);
                }
            }
 
            <b>return</b> <span class="r19 r">results</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Connects asynchronously to a running command on a remote server.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="ec400610bd67c95c" href="../../../R/ec400610bd67c95c.html" target="n" data-glyph="72,1" class="i method">ConnectAsync</a>()
        {
            <a href="#2d1d1289225c91bf" class="i method">InitPowerShellForConnect</a>(<b>false</b>);
 
            <b>try</b>
            {
                <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#0ef55487a25fe8f5" class="i method">ConnectAsync</a>();
            }
            <b>catch</b> (<a href="../../hostifaces/RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>)
            {
                <a href="../../hostifaces/Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r21 rd" class="r21 r">e</span> =
                    <b>new</b> <a href="../../hostifaces/Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                    (
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotOpenForPipelineConnect</span>, <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>.<span class="i">ToString</span>()),
                        <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>,
                        <a href="../../hostifaces/Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="../../hostifaces/Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                    );
                <b>throw</b> <span class="r21 r">e</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Stop
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the pipeline synchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="b5de09e211401bf7" href="../../../R/b5de09e211401bf7.html" target="n" data-glyph="72,1" class="i method">Stop</a>()
        {
            <b>bool</b> <span id="r22 rd" class="r22 r">isAlreadyStopping</span> = <b>false</b>;
            <b>if</b> (<a href="#4073c72eed452cd5" class="i method">CanStopPipeline</a>(<b>out</b> <span class="r22 r">isAlreadyStopping</span>))
            {
                <span class="c">// A pipeline can be stopped before it is started.so protecting against that</span>
                <b>if</b> (<a href="#cd590a53bdc07dbe" class="i field">_powershell</a> != <b>null</b>)
                {
                    <span class="i">IAsyncResult</span> <span id="r23 rd" class="r23 r">asyncresult</span> = <b>null</b>;
                    <b>try</b>
                    {
                        <span class="r23 r">asyncresult</span> = <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#23f9dce20b146f19" class="i method">BeginStop</a>(<b>null</b>, <b>null</b>);
                    }
                    <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                    {
                        <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;Pipeline&quot;</span>);
                    }
 
                    <span class="r23 r">asyncresult</span>.<span class="i">AsyncWaitHandle</span>.<span class="i">WaitOne</span>();
                }
            }
 
            <span class="c">// Waits until pipeline completes stop as this is a sync call.</span>
            <a href="#cf9dafc85fda0d41" class="i property">PipelineFinishedEvent</a>.<span class="i">WaitOne</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the pipeline asynchronously.</span>
        <span class="c">///</span><span class="c"> This method calls the BeginStop on the underlying</span>
        <span class="c">///</span><span class="c"> powershell and so any exception will be</span>
        <span class="c">///</span><span class="c"> thrown on the same thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="2867a4744ec680f4" href="../../../R/2867a4744ec680f4.html" target="n" data-glyph="72,1" class="i method">StopAsync</a>()
        {
            <b>bool</b> <span id="r24 rd" class="r24 r">isAlreadyStopping</span>;
            <b>if</b> (<a href="#4073c72eed452cd5" class="i method">CanStopPipeline</a>(<b>out</b> <span class="r24 r">isAlreadyStopping</span>))
            {
                <b>try</b>
                {
                    <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#23f9dce20b146f19" class="i method">BeginStop</a>(<b>null</b>, <b>null</b>);
                }
                <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                {
                    <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;Pipeline&quot;</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies if the pipeline is in a state where it can be stopped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="4073c72eed452cd5" href="../../../R/4073c72eed452cd5.html" target="n" data-glyph="76,1" class="i method">CanStopPipeline</a>(<b>out bool</b> <span id="r25 rd" class="r25 r">isAlreadyStopping</span>)
        {
            <b>bool</b> <span id="r26 rd" class="r26 r">returnResult</span> = <b>false</b>;
            <span class="r25 r">isAlreadyStopping</span> = <b>false</b>;
            <b>lock</b> (<a href="#74c63668400f57d8" class="i field">_syncRoot</a>)
            {
                <span class="c">// SetPipelineState does not raise events..</span>
                <span class="c">// so locking is ok here.</span>
                <b>switch</b> (<a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>)
                {
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>:
                        <a href="#fda2ab3610e5b597" class="i method">SetPipelineState</a>(<a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>, <b>null</b>);
                        <a href="#fda2ab3610e5b597" class="i method">SetPipelineState</a>(<a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>, <b>null</b>);
                        <span class="r26 r">returnResult</span> = <b>false</b>;
                        <b>break</b>;
 
                    <span class="c">// If pipeline execution has failed or completed or</span>
                    <span class="c">// stoped, return silently.</span>
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>:
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#f5734941de01b098" class="i field">Completed</a>:
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a>:
                        <b>return</b> <b>false</b>;
 
                    <span class="c">// If pipeline is in Stopping state, ignore the second</span>
                    <span class="c">// stop.</span>
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>:
                        <span class="r25 r">isAlreadyStopping</span> = <b>true</b>;
                        <b>return</b> <b>false</b>;
 
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#d0f3cf00cd5762f1" class="i field">Running</a>:
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#401ea10f45569c67" class="i field">Disconnected</a>:
                        <a href="#fda2ab3610e5b597" class="i method">SetPipelineState</a>(<a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>, <b>null</b>);
                        <span class="r26 r">returnResult</span> = <b>true</b>;
                        <b>break</b>;
                }
            }
 
            <a href="#ac239301c74ce162" class="i method">RaisePipelineStateEvents</a>();
 
            <b>return</b> <span class="r26 r">returnResult</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Stop
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Events
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Event raised when Pipeline&#39;s state changes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override event</b> <span class="i">EventHandler</span>&lt;<a href="../../hostifaces/Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a>&gt; <a id="7001904b7a393079" href="../../../R/7001904b7a393079.html" target="n" data-glyph="30,1" class="i">StateChanged</a> = <b>null</b>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Events
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Dispose
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Disposes the pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True, when called on Dispose().</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="892fb4bf8a6e5381" href="../../../R/892fb4bf8a6e5381.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r27 rd" class="r27 r">disposing</span>)
        {
            <b>try</b>
            {
                <b>if</b> (<a href="#5f25a7fe697c69ba" class="i field">_disposed</a>)
                {
                    <b>return</b>;
                }
 
                <b>lock</b> (<a href="#74c63668400f57d8" class="i field">_syncRoot</a>)
                {
                    <b>if</b> (<a href="#5f25a7fe697c69ba" class="i field">_disposed</a>)
                    {
                        <b>return</b>;
                    }
 
                    <a href="#5f25a7fe697c69ba" class="i field">_disposed</a> = <b>true</b>;
                }
 
                <b>if</b> (<span class="r27 r">disposing</span>)
                {
                    <span class="c">// wait for the pipeline to stop..this will block</span>
                    <span class="c">// if the pipeline is already stopping.</span>
                    <a href="#b5de09e211401bf7" class="i method">Stop</a>();
                    <span class="c">// _pipelineFinishedEvent.Close();</span>
 
                    <b>if</b> (<a href="#cd590a53bdc07dbe" class="i field">_powershell</a> != <b>null</b>)
                    {
                        <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#18cbb6bfae891ee7" class="i method">Dispose</a>();
                        <a href="#cd590a53bdc07dbe" class="i field">_powershell</a> = <b>null</b>;
                    }
 
                    <a href="#1a0b44b3678aea85" class="i field">_inputCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#17fb91187cc003fd" class="i method">Dispose</a>();
                    <a href="#033cd67046953373" class="i field">_inputStream</a>.<a href="../../../utils/ObjectStream.cs.html#e609f46566bbc0e2" class="i method">Dispose</a>();
                    <a href="#441b980bef289a0c" class="i field">_outputCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#17fb91187cc003fd" class="i method">Dispose</a>();
                    <a href="#5e5978ea25581111" class="i field">_outputStream</a>.<a href="../../../utils/ObjectStream.cs.html#e609f46566bbc0e2" class="i method">Dispose</a>();
                    <a href="#7bd7310e1e8b37b5" class="i field">_errorCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#17fb91187cc003fd" class="i method">Dispose</a>();
                    <a href="#cb69d03f546a1345" class="i field">_errorStream</a>.<a href="../../../utils/ObjectStream.cs.html#e609f46566bbc0e2" class="i method">Dispose</a>();
                    <a href="#5d6a281a19d5de40" class="i property">MethodExecutorStream</a>.<a href="../../../utils/ObjectStream.cs.html#e609f46566bbc0e2" class="i method">Dispose</a>();
                    <a href="#cf9dafc85fda0d41" class="i property">PipelineFinishedEvent</a>.<span class="i">Dispose</span>();
                }
            }
            <b>finally</b>
            {
                <a href="../../hostifaces/Pipeline.cs.html#c607964c20793ea5" class="k">base</a>.<a href="../../hostifaces/Pipeline.cs.html#a3ed04f9600b5bd2" class="i method">Dispose</a>(<span class="r27 r">disposing</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Dispose
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Methods
 
        <b>private void</b> <a id="7d88f63220449597" href="../../../R/7d88f63220449597.html" target="n" data-glyph="76,1" class="i method">CoreInvokeAsync</a>()
        {
            <b>try</b>
            {
                <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#136b4e9e4079b11f" class="i method">BeginInvoke</a>();
            }
            <b>catch</b> (<a href="../../hostifaces/RunspacePool.cs.html#741ffc1755303d69" class="t t">InvalidRunspacePoolStateException</a>)
            {
                <a href="../../hostifaces/Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r28 rd" class="r28 r">e</span> =
                    <b>new</b> <a href="../../hostifaces/Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                    (
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotOpenForPipeline</span>, <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>.<span class="i">ToString</span>()),
                        <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a>,
                        <a href="../../hostifaces/Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="../../hostifaces/Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                    );
                <b>throw</b> <span class="r28 r">e</span>;
            }
        }
 
        <b>private void</b> <a id="70000de3a7870d7b" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleInvocationStateChanged</a>(<b>object</b> <span id="r29 rd" class="r29 r">sender</span>, <a href="../../hostifaces/PowerShell.cs.html#b125d9adbaf88d43" class="t t">PSInvocationStateChangedEventArgs</a> <span id="r30 rd" class="r30 r">e</span>)
        {
            <a href="#fda2ab3610e5b597" class="i method">SetPipelineState</a>((<a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>)<span class="r30 r">e</span>.<a href="../../hostifaces/PowerShell.cs.html#7ec9f6a06e861118" class="i property">InvocationStateInfo</a>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a>, <span class="r30 r">e</span>.<a href="../../hostifaces/PowerShell.cs.html#7ec9f6a06e861118" class="i property">InvocationStateInfo</a>.<a href="../../hostifaces/PowerShell.cs.html#5e4f678af21908e8" class="i property">Reason</a>);
 
            <a href="#ac239301c74ce162" class="i method">RaisePipelineStateEvents</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the new execution state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">reason</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An exception indicating that state change is the result of an error,</span>
        <span class="c">///</span><span class="c"> otherwise; null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the internal execution state information member variable. It</span>
        <span class="c">///</span><span class="c"> also adds PipelineStateInfo to a queue. RaisePipelineStateEvents</span>
        <span class="c">///</span><span class="c"> raises event for each item in this queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private void</b> <a id="fda2ab3610e5b597" href="../../../R/fda2ab3610e5b597.html" target="n" data-glyph="76,1" class="i method">SetPipelineState</a>(<a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a> <span id="r31 rd" class="r31 r">state</span>, <span class="i">Exception</span> <span id="r32 rd" class="r32 r">reason</span>)
        {
            <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a> <span id="r33 rd" class="r33 r">copyState</span> = <span class="r31 r">state</span>;
            <a href="../../hostifaces/Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <span id="r34 rd" class="r34 r">copyStateInfo</span> = <b>null</b>;
 
            <b>lock</b> (<a href="#74c63668400f57d8" class="i field">_syncRoot</a>)
            {
                <b>switch</b> (<a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>)
                {
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#f5734941de01b098" class="i field">Completed</a>:
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a>:
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>:
                        <b>return</b>;
 
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#d0f3cf00cd5762f1" class="i field">Running</a>:
                        {
                            <b>if</b> (<span class="r31 r">state</span> == <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#d0f3cf00cd5762f1" class="i field">Running</a>)
                            {
                                <b>return</b>;
                            }
                        }
 
                        <b>break</b>;
                    <b>case</b> <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>:
                        {
                            <b>if</b> (<span class="r31 r">state</span> == <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#d0f3cf00cd5762f1" class="i field">Running</a> || <span class="r31 r">state</span> == <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>)
                            {
                                <b>return</b>;
                            }
                            <b>else</b>
                            {
                                <span class="r33 r">copyState</span> = <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>;
                            }
                        }
 
                        <b>break</b>;
                }
 
                <a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a> = <b>new</b> <a href="../../hostifaces/Pipeline.cs.html#8a80e8d270916577" class="t constructor">PipelineStateInfo</a>(<span class="r33 r">copyState</span>, <span class="r32 r">reason</span>);
                <span class="r34 r">copyStateInfo</span> = <a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>;
 
                <span class="c">// Add _pipelineStateInfo to _executionEventQueue.</span>
                <span class="c">// RaisePipelineStateEvents will raise event for each item</span>
                <span class="c">// in this queue.</span>
                <span class="c">// Note:We are doing clone here instead of passing the member</span>
                <span class="c">// _pipelineStateInfo because we donot want outside</span>
                <span class="c">// to change pipeline state.</span>
                <a href="../../hostifaces/Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r35 rd" class="r35 r">previousAvailability</span> = <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#c8bea13c75bd3198" class="i property">RunspaceAvailability</a>;
 
                <span class="i">Guid</span>? <span id="r36 rd" class="r36 r">cmdInstanceId</span> = (<a href="#cd590a53bdc07dbe" class="i field">_powershell</a> != <b>null</b>) ? <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#d8c9867186529e49" class="i property">InstanceId</a> : (<span class="i">Guid</span>?)<b>null</b>;
                <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#245028b8feaec094" class="i method">UpdateRunspaceAvailability</a>(<a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>, <b>false</b>, <span class="r36 r">cmdInstanceId</span>);
 
                <a href="#925a1146db86496c" class="i field">_executionEventQueue</a>.<span class="i">Enqueue</span>(
                    <b>new</b> <a href="#7fc68b9258ad624c" class="t constructor">ExecutionEventQueueItem</a>(
                        <a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#7d0ccb2943705d92" class="i method">Clone</a>(),
                        <span class="r35 r">previousAvailability</span>,
                        <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#c8bea13c75bd3198" class="i property">RunspaceAvailability</a>));
            }
 
            <span class="c">// using the copyStateInfo here as this piece of code is</span>
            <span class="c">// outside of lock and _pipelineStateInfo might get changed</span>
            <span class="c">// by two threads running concurrently..so its value is</span>
            <span class="c">// not guaranteed to be the same for this entire method call.</span>
            <span class="c">// copyStateInfo is a local variable.</span>
            <b>if</b> (<span class="r34 r">copyStateInfo</span>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> == <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#f5734941de01b098" class="i field">Completed</a> ||
                <span class="r34 r">copyStateInfo</span>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> == <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a> ||
                <span class="r34 r">copyStateInfo</span>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> == <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>)
            {
                <a href="#def5e2c249262218" class="i method">Cleanup</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Raises events for changes in execution state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="ac239301c74ce162" href="../../../R/ac239301c74ce162.html" target="n" data-glyph="75,1" class="i method">RaisePipelineStateEvents</a>()
        {
            <span class="i">Queue</span>&lt;<a href="#e800a5b34b679a2f" class="t t">ExecutionEventQueueItem</a>&gt; <span id="r37 rd" class="r37 r">tempEventQueue</span> = <b>null</b>;
            <span class="i">EventHandler</span>&lt;<a href="../../hostifaces/Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a>&gt; <span id="r38 rd" class="r38 r">stateChanged</span> = <b>null</b>;
            <b>bool</b> <span id="r39 rd" class="r39 r">runspaceHasAvailabilityChangedSubscribers</span> = <b>false</b>;
 
            <b>lock</b> (<a href="#74c63668400f57d8" class="i field">_syncRoot</a>)
            {
                <span class="r38 r">stateChanged</span> = <a href="#018b4ca446b0fea0" class="k">this</a>.<a href="#7001904b7a393079" class="i">StateChanged</a>;
                <span class="r39 r">runspaceHasAvailabilityChangedSubscribers</span> = <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#d6a5f8848cdbcae5" class="i property">HasAvailabilityChangedSubscribers</a>;
 
                <b>if</b> (<span class="r38 r">stateChanged</span> != <b>null</b> || <span class="r39 r">runspaceHasAvailabilityChangedSubscribers</span>)
                {
                    <span class="r37 r">tempEventQueue</span> = <a href="#925a1146db86496c" class="i field">_executionEventQueue</a>;
                    <a href="#925a1146db86496c" class="i field">_executionEventQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#e800a5b34b679a2f" class="t t">ExecutionEventQueueItem</a>&gt;();
                }
                <b>else</b>
                {
                    <span class="c">// Clear the events if there are no EventHandlers. This</span>
                    <span class="c">// ensures that events do not get called for state</span>
                    <span class="c">// changes prior to their registration.</span>
                    <a href="#925a1146db86496c" class="i field">_executionEventQueue</a>.<span class="i">Clear</span>();
                }
            }
 
            <b>if</b> (<span class="r37 r">tempEventQueue</span> != <b>null</b>)
            {
                <b>while</b> (<span class="r37 r">tempEventQueue</span>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="#e800a5b34b679a2f" class="t t">ExecutionEventQueueItem</a> <span id="r40 rd" class="r40 r">queueItem</span> = <span class="r37 r">tempEventQueue</span>.<span class="i">Dequeue</span>();
 
                    <b>if</b> (<span class="r39 r">runspaceHasAvailabilityChangedSubscribers</span> &amp;&amp; <span class="r40 r">queueItem</span>.<a href="#d6a4151bcb380650" class="i field">NewRunspaceAvailability</a> != <span class="r40 r">queueItem</span>.<a href="#8b23e7e459d8d749" class="i field">CurrentRunspaceAvailability</a>)
                    {
                        <a href="#2be1c293cacb1e03" class="i field">_runspace</a>.<a href="../../hostifaces/Connection.cs.html#d34adcc77325cd0e" class="i method">RaiseAvailabilityChangedEvent</a>(<span class="r40 r">queueItem</span>.<a href="#d6a4151bcb380650" class="i field">NewRunspaceAvailability</a>);
                    }
 
                    <span class="c">// Exception raised in the eventhandler are not error in pipeline.</span>
                    <span class="c">// silently ignore them.</span>
                    <b>if</b> (<span class="r38 r">stateChanged</span> != <b>null</b>)
                    {
                        <b>try</b>
                        {
                            <span class="r38 r">stateChanged</span>(<a href="#018b4ca446b0fea0" class="k">this</a>, <b>new</b> <a href="../../hostifaces/Pipeline.cs.html#30728553fbee21a5" class="t constructor">PipelineStateEventArgs</a>(<span class="r40 r">queueItem</span>.<a href="#9ce5ae6ac03d95f3" class="i field">PipelineStateInfo</a>));
                        }
                        <b>catch</b> (<span class="i">Exception</span>)
                        {
                        }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes the underlying PowerShell object after verifying</span>
        <span class="c">///</span><span class="c"> if the pipeline is in a state where it can be invoked.</span>
        <span class="c">///</span><span class="c"> If invokeAndDisconnect is true then the remote PowerShell</span>
        <span class="c">///</span><span class="c"> command will be immediately disconnected after it begins</span>
        <span class="c">///</span><span class="c"> running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if called from a sync call.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">invokeAndDisconnect</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Invoke and Disconnect.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="b1addfcf53f038aa" href="../../../R/b1addfcf53f038aa.html" target="n" data-glyph="76,1" class="i method">InitPowerShell</a>(<b>bool</b> <span id="r41 rd" class="r41 r">syncCall</span>, <b>bool</b> <span id="r42 rd" class="r42 r">invokeAndDisconnect</span> = <b>false</b>)
        {
            <b>if</b> (<a href="#384bca49c089c48c" class="i field">_commands</a> == <b>null</b> || <a href="#384bca49c089c48c" class="i field">_commands</a>.<span class="i">Count</span> == 0)
            {
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                        <span class="i">RunspaceStrings</span>.<span class="i">NoCommandInPipeline</span>);
            }
 
            <b>if</b> (<a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> != <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>)
            {
                <a href="../../hostifaces/Pipeline.cs.html#37e03f100f9d822e" class="t t">InvalidPipelineStateException</a> <span id="r43 rd" class="r43 r">e</span> =
                    <b>new</b> <a href="../../hostifaces/Pipeline.cs.html#23cc74950974177d" class="t constructor">InvalidPipelineStateException</a>
                    (
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">PipelineReInvokeNotAllowed</span>),
                        <a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>,
                        <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>
                    );
                <b>throw</b> <span class="r43 r">e</span>;
            }
 
            ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#0d361b6b1aca5cf1" class="i method">DoConcurrentCheckAndAddToRunningPipelines</a>(<a href="#018b4ca446b0fea0" class="k">this</a>, <span class="r41 r">syncCall</span>);
 
            <a href="../../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r44 rd" class="r44 r">settings</span> = <b>new</b> <a href="../../hostifaces/PowerShell.cs.html#3f472392b2d45c15" class="t constructor">PSInvocationSettings</a>();
            <span class="r44 r">settings</span>.<a href="../../hostifaces/PowerShell.cs.html#27a80b1485d6fbda" class="i property">AddToHistory</a> = <a href="#3188cfc5e2c3bc36" class="i field">_addToHistory</a>;
            <span class="r44 r">settings</span>.<a href="../../hostifaces/PowerShell.cs.html#14c829f9d290d4cc" class="i property">InvokeAndDisconnect</a> = <span class="r42 r">invokeAndDisconnect</span>;
 
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#7e4a86af41ca75b0" class="i method">InitForRemotePipeline</a>(<a href="#384bca49c089c48c" class="i field">_commands</a>, <a href="#033cd67046953373" class="i field">_inputStream</a>, <a href="#5e5978ea25581111" class="i field">_outputStream</a>, <a href="#cb69d03f546a1345" class="i field">_errorStream</a>, <span class="r44 r">settings</span>, <a href="../../hostifaces/Pipeline.cs.html#b2ec42030f1944f4" class="i property">RedirectShellErrorOutputPipe</a>);
 
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="ClientRemotePowerShell.cs.html#fc1dd053c42eadfb" class="i">HostCallReceived</a> += <span class="i">HandleHostCallReceived</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes the underlying PowerShell object after verifying that it is</span>
        <span class="c">///</span><span class="c"> in a state where it can connect to the remote command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="2d1d1289225c91bf" href="../../../R/2d1d1289225c91bf.html" target="n" data-glyph="76,1" class="i method">InitPowerShellForConnect</a>(<b>bool</b> <span id="r45 rd" class="r45 r">syncCall</span>)
        {
            <b>if</b> (<a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> != <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#401ea10f45569c67" class="i field">Disconnected</a>)
            {
                <b>throw</b> <b>new</b> <a href="../../hostifaces/Pipeline.cs.html#23cc74950974177d" class="t constructor">InvalidPipelineStateException</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">PipelineStrings</span>.<span class="i">PipelineNotDisconnected</span>),
                                                        <a href="#0bc549d90f0d16d5" class="i field">_pipelineStateInfo</a>.<a href="../../hostifaces/Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>,
                                                        <a href="../../hostifaces/Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="../../hostifaces/Pipeline.cs.html#401ea10f45569c67" class="i field">Disconnected</a>);
            }
 
            <span class="c">// The connect may be from the same Pipeline that disconnected and in this case</span>
            <span class="c">// the Pipeline state already exists.  Or this could be a new Pipeline object</span>
            <span class="c">// (connect reconstruction case) and new state is created.</span>
 
            <span class="c">// Check to see if this pipeline already exists in the runspace.</span>
            <a href="#018b4ca446b0fea0" class="t t">RemotePipeline</a> <span id="r46 rd" class="r46 r">currentPipeline</span> = (<a href="#018b4ca446b0fea0" class="t t">RemotePipeline</a>)((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#9ab3dedcf11ea947" class="i method">GetCurrentlyRunningPipeline</a>();
            <b>if</b> (!<span class="i">ReferenceEquals</span>(<span class="r46 r">currentPipeline</span>, <a href="#018b4ca446b0fea0" class="k">this</a>))
            {
                ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#0d361b6b1aca5cf1" class="i method">DoConcurrentCheckAndAddToRunningPipelines</a>(<a href="#018b4ca446b0fea0" class="k">this</a>, <span class="r45 r">syncCall</span>);
            }
 
            <span class="c">// Initialize the PowerShell object if it hasn&#39;t been initialized before.</span>
            <b>if</b> ((<a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>) == <b>null</b> || !<a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="ClientRemotePowerShell.cs.html#4f8237be57be8c4e" class="i property">Initialized</a>)
            {
                <a href="../../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r47 rd" class="r47 r">settings</span> = <b>new</b> <a href="../../hostifaces/PowerShell.cs.html#3f472392b2d45c15" class="t constructor">PSInvocationSettings</a>();
                <span class="r47 r">settings</span>.<a href="../../hostifaces/PowerShell.cs.html#27a80b1485d6fbda" class="i property">AddToHistory</a> = <a href="#3188cfc5e2c3bc36" class="i field">_addToHistory</a>;
 
                <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#c540e09bb34dc15d" class="i method">InitForRemotePipelineConnect</a>(<a href="#033cd67046953373" class="i field">_inputStream</a>, <a href="#5e5978ea25581111" class="i field">_outputStream</a>, <a href="#cb69d03f546a1345" class="i field">_errorStream</a>, <span class="r47 r">settings</span>, <a href="../../hostifaces/Pipeline.cs.html#b2ec42030f1944f4" class="i property">RedirectShellErrorOutputPipe</a>);
 
                <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="ClientRemotePowerShell.cs.html#fc1dd053c42eadfb" class="i">HostCallReceived</a> += <span class="i">HandleHostCallReceived</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handle host call received.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing the host call to invoke.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="8567a2088aa7b32a" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleHostCallReceived</a>(<b>object</b> <span id="r48 rd" class="r48 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <span id="r49 rd" class="r49 r">eventArgs</span>)
        {
            <a href="ClientMethodExecutor.cs.html#6caf7f9a511e4a89" class="t t">ClientMethodExecutor</a>.<a href="ClientMethodExecutor.cs.html#c20fa6e2f3356410" class="i method">Dispatch</a>(
                <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#2f2a1f6f4e814646" class="i property">RemotePowerShell</a>.<a href="ClientRemotePowerShell.cs.html#ed443312f1d49fb1" class="i property">DataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#d4654360189d8f15" class="i property">TransportManager</a>,
                ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="RemoteRunspacePoolInternal.cs.html#836d29f1e729f0db" class="i property">Host</a>,
                <a href="#cb69d03f546a1345" class="i field">_errorStream</a>,
                <a href="#5d6a281a19d5de40" class="i property">MethodExecutorStream</a>,
                <a href="#63fb608d14323ae9" class="i property">IsMethodExecutorStreamEnabled</a>,
                ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#52e4a4fcfd3da6a7" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>,
                <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#d8c9867186529e49" class="i property">InstanceId</a>,
                <span class="r49 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Does the cleanup necessary on pipeline completion.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="def5e2c249262218" href="../../../R/def5e2c249262218.html" target="n" data-glyph="76,1" class="i method">Cleanup</a>()
        {
            <span class="c">// Close the output stream if it is not closed.</span>
            <b>if</b> (<a href="#5e5978ea25581111" class="i field">_outputStream</a>.<a href="../../../utils/ObjectStream.cs.html#0e3474adb94bfb5b" class="i property">IsOpen</a>)
            {
                <b>try</b>
                {
                    <a href="#441b980bef289a0c" class="i field">_outputCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#0a8262d798e33fc6" class="i method">Complete</a>();
                    <a href="#5e5978ea25581111" class="i field">_outputStream</a>.<a href="../../../utils/ObjectStream.cs.html#ced0aa52c520ca2b" class="i method">Close</a>();
                }
                <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                {
                }
            }
 
            <span class="c">// Close the error stream if it is not closed.</span>
            <b>if</b> (<a href="#cb69d03f546a1345" class="i field">_errorStream</a>.<a href="../../../utils/ObjectStream.cs.html#0e3474adb94bfb5b" class="i property">IsOpen</a>)
            {
                <b>try</b>
                {
                    <a href="#7bd7310e1e8b37b5" class="i field">_errorCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#0a8262d798e33fc6" class="i method">Complete</a>();
                    <a href="#cb69d03f546a1345" class="i field">_errorStream</a>.<a href="../../../utils/ObjectStream.cs.html#ced0aa52c520ca2b" class="i method">Close</a>();
                }
                <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                {
                }
            }
 
            <span class="c">// Close the input stream if it is not closed.</span>
            <b>if</b> (<a href="#033cd67046953373" class="i field">_inputStream</a>.<a href="../../../utils/ObjectStream.cs.html#0e3474adb94bfb5b" class="i property">IsOpen</a>)
            {
                <b>try</b>
                {
                    <a href="#1a0b44b3678aea85" class="i field">_inputCollection</a>.<a href="../../hostifaces/PSDataCollection.cs.html#0a8262d798e33fc6" class="i method">Complete</a>();
                    <a href="#033cd67046953373" class="i field">_inputStream</a>.<a href="../../../utils/ObjectStream.cs.html#ced0aa52c520ca2b" class="i method">Close</a>();
                }
                <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                {
                }
            }
 
            <b>try</b>
            {
                <span class="c">// Runspace object maintains a list of pipelines in execution.</span>
                <span class="c">// Remove this pipeline from the list. This method also calls the</span>
                <span class="c">// pipeline finished event.</span>
                ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#265f5f610b55e0aa" class="i method">RemoveFromRunningPipelineList</a>(<a href="#018b4ca446b0fea0" class="k">this</a>);
 
                <a href="#cf9dafc85fda0d41" class="i property">PipelineFinishedEvent</a>.<span class="i">Set</span>();
            }
            <b>catch</b> (<span class="i">ObjectDisposedException</span>)
            {
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Methods/Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ManualResetEvent which is signaled when pipeline execution is</span>
        <span class="c">///</span><span class="c"> completed/failed/stoped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">ManualResetEvent</span> <a id="cf9dafc85fda0d41" href="../../../R/cf9dafc85fda0d41.html" target="n" data-glyph="104,1" class="i property">PipelineFinishedEvent</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is method executor stream enabled.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="63fb608d14323ae9" href="../../../R/63fb608d14323ae9.html" target="n" data-glyph="104,1" class="i property">IsMethodExecutorStreamEnabled</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Method executor stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../../utils/ObjectStream.cs.html#247cf7c4c5dec5a4" class="t t">ObjectStream</a> <a id="5d6a281a19d5de40" href="../../../R/5d6a281a19d5de40.html" target="n" data-glyph="104,1" class="i property">MethodExecutorStream</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if anyother pipeline is executing.</span>
        <span class="c">///</span><span class="c"> In case of nested pipeline, checks that it is called</span>
        <span class="c">///</span><span class="c"> from currently executing pipeline&#39;s thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if method is called from Invoke, false</span>
        <span class="c">///</span><span class="c"> if called from InvokeAsync</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1) A pipeline is already executing. Pipeline cannot execute</span>
        <span class="c">///</span><span class="c"> concurrently.</span>
        <span class="c">///</span><span class="c"> 2) InvokeAsync is called on nested pipeline. Nested pipeline</span>
        <span class="c">///</span><span class="c"> cannot be executed Asynchronously.</span>
        <span class="c">///</span><span class="c"> 3) Attempt is made to invoke a nested pipeline directly. Nested</span>
        <span class="c">///</span><span class="c"> pipeline must be invoked from a running pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="1712c30986703063" href="../../../R/1712c30986703063.html" target="n" data-glyph="74,1" class="i method">DoConcurrentCheck</a>(<b>bool</b> <span id="r50 rd" class="r50 r">syncCall</span>)
        {
            <a href="#018b4ca446b0fea0" class="t t">RemotePipeline</a> <span id="r51 rd" class="r51 r">currentPipeline</span> =
                (<a href="#018b4ca446b0fea0" class="t t">RemotePipeline</a>)((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#9ab3dedcf11ea947" class="i method">GetCurrentlyRunningPipeline</a>();
 
            <b>if</b> (!<a href="#5b9d2e64a57e4942" class="i field">_isNested</a>)
            {
                <b>if</b> (<span class="r51 r">currentPipeline</span> == <b>null</b> &amp;&amp;
                    ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#c9a8dc56926b5fdf" class="i property">RunspaceAvailability</a> != <a href="../../hostifaces/Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a>.<a href="../../hostifaces/Connection.cs.html#aed194b80737a544" class="i field">Busy</a> &amp;&amp;
                    ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#c9a8dc56926b5fdf" class="i property">RunspaceAvailability</a> != <a href="../../hostifaces/Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a>.<a href="../../hostifaces/Connection.cs.html#244d7672812dd8a9" class="i field">RemoteDebug</a>)
                {
                    <span class="c">// We can add a new pipeline to the runspace only if it is</span>
                    <span class="c">// available (not busy).</span>
                    <b>return</b>;
                }
 
                <b>if</b> (<span class="r51 r">currentPipeline</span> == <b>null</b> &amp;&amp;
                    ((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#c7d59b1aea27b0c9" class="i property">RemoteCommand</a> != <b>null</b> &amp;&amp;
                    <a href="#3b2a93d4feb4a4a6" class="i field">_connectCmdInfo</a> != <b>null</b> &amp;&amp;
                    <span class="i">Guid</span>.<span class="i">Equals</span>(((<a href="remoterunspace.cs.html#e2c1bde75e106663" class="t t">RemoteRunspace</a>)<a href="#2be1c293cacb1e03" class="i field">_runspace</a>).<a href="remoterunspace.cs.html#c7d59b1aea27b0c9" class="i property">RemoteCommand</a>.<a href="RemoteRunspacePoolInternal.cs.html#1060192c0e7cff3a" class="i property">CommandId</a>, <a href="#3b2a93d4feb4a4a6" class="i field">_connectCmdInfo</a>.<a href="RemoteRunspacePoolInternal.cs.html#1060192c0e7cff3a" class="i property">CommandId</a>))
                {
                    <span class="c">// Connect case.  We can add a pipeline to a busy runspace when</span>
                    <span class="c">// that pipeline represents the same command as is currently</span>
                    <span class="c">// running.</span>
                    <b>return</b>;
                }
 
                <b>if</b> (<span class="r51 r">currentPipeline</span> != <b>null</b> &amp;&amp;
                         <span class="i">ReferenceEquals</span>(<span class="r51 r">currentPipeline</span>, <a href="#018b4ca446b0fea0" class="k">this</a>))
                {
                    <span class="c">// Reconnect case.  We can add a pipeline to a busy runspace when the</span>
                    <span class="c">// pipeline is the same (reconnecting).</span>
                    <b>return</b>;
                }
 
                <b>if</b> (!<a href="#199c9d41084be228" class="i field">_isSteppable</a>)
                {
                    <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">ConcurrentInvokeNotAllowed</span>);
                }
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#cb9c01dab422d5ba" class="i field">_performNestedCheck</a>)
                {
                    <b>if</b> (<a href="#199c9d41084be228" class="i field">_isSteppable</a>)
                    {
                        <b>return</b>;
                    }
 
                    <b>if</b> (!<span class="r50 r">syncCall</span>)
                    {
                        <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">RunspaceStrings</span>.<span class="i">NestedPipelineInvokeAsync</span>);
                    }
 
                    <b>if</b> (<span class="r51 r">currentPipeline</span> == <b>null</b>)
                    {
                        <b>if</b> (!<a href="#199c9d41084be228" class="i field">_isSteppable</a>)
                        {
                            <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                    <span class="i">RunspaceStrings</span>.<span class="i">NestedPipelineNoParentPipeline</span>);
                        }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The underlying powershell object on which this remote pipeline</span>
        <span class="c">///</span><span class="c"> is created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <a id="ea6d8045e5ac0559" href="../../../R/ea6d8045e5ac0559.html" target="n" data-glyph="104,1" class="i property">PowerShell</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the history string to the specified string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">historyString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">New history string to set to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="26117eb9ebb2e0e0" href="../../../R/26117eb9ebb2e0e0.html" target="n" data-glyph="74,1" class="i method">SetHistoryString</a>(<b>string</b> <span id="r52 rd" class="r52 r">historyString</span>)
        {
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#3b8f81dc833a1a8c" class="i property">HistoryString</a> = <span class="r52 r">historyString</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal Methods/Properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Remote data drain/block methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Blocks data arriving from remote session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="1fb39e53feaa0ec5" href="../../../R/1fb39e53feaa0ec5.html" target="n" data-glyph="74,1" class="i method">SuspendIncomingData</a>()
        {
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#17cbd8cde3486cb7" class="i method">SuspendIncomingData</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resumes data arrive from remote session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="f207fc0aa9c518b7" href="../../../R/f207fc0aa9c518b7.html" target="n" data-glyph="74,1" class="i method">ResumeIncomingData</a>()
        {
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#d3f59b7e5131db2a" class="i method">ResumeIncomingData</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Blocking call that waits until the current remote data</span>
        <span class="c">///</span><span class="c"> queue is empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="2b3259b2cc751fb6" href="../../../R/2b3259b2cc751fb6.html" target="n" data-glyph="74,1" class="i method">DrainIncomingData</a>()
        {
            <a href="#cd590a53bdc07dbe" class="i field">_powershell</a>.<a href="../../hostifaces/PowerShell.cs.html#59ba1b667dcd86e0" class="i method">WaitForServicingComplete</a>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
