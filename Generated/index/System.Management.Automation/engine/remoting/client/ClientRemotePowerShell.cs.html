<!DOCTYPE html>
<html><head><title>ClientRemotePowerShell.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(1017);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/client/ClientRemotePowerShell.cs" target="_top">engine\remoting\client\ClientRemotePowerShell.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<span class="i n">Internal</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> PowerShell client side proxy base which handles invocation</span>
    <span class="c">///</span><span class="c"> of powershell on a remote machine.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="b4d2ac017883b31c" href="../../../R/b4d2ac017883b31c.html" target="n" data-glyph="2,0" class="t t">ClientRemotePowerShell</a> : <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Tracer
 
        [<span class="i">TraceSourceAttribute</span>(<span class="s">&quot;CRPS&quot;</span>, <span class="s">&quot;ClientRemotePowerShell&quot;</span>)]
        <b>private static readonly</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="50a133abd7ca7f4c" href="../../../R/50a133abd7ca7f4c.html" target="n" data-glyph="46,1" class="i field">s_tracer</a> = <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;CRPS&quot;</span>, <span class="s">&quot;ClientRemotePowerShellBase&quot;</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Tracer
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor which creates a client remote powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">shell</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Powershell instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">runspacePool</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The runspace pool associated with</span>
        <span class="c">///</span><span class="c"> this shell</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="963057b3fa7868fe" href="../../../R/963057b3fa7868fe.html" target="n" data-glyph="74,1" class="t constructor">ClientRemotePowerShell</a>(<a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r0 rd" class="r0 r">shell</span>, <a href="RemoteRunspacePoolInternal.cs.html#1aba79be5da56f57" class="t t">RemoteRunspacePoolInternal</a> <span id="r1 rd" class="r1 r">runspacePool</span>)
        {
            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#533961734551583a" class="i field">shell</a> = <span class="r0 r">shell</span>;
            <a href="#abe8d6cf87accd0d" class="i field">clientRunspacePoolId</a> = <span class="r1 r">runspacePool</span>.<a href="../../hostifaces/RunspacePoolInternal.cs.html#76aedcc22e17e7e5" class="i property">InstanceId</a>;
            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#f62c92b12f5e45bc" class="i field">runspacePool</a> = <span class="r1 r">runspacePool</span>;
 
            <span class="c">// retrieve the computer name from the runspacepool</span>
            <span class="c">// information so that it can be used in adding</span>
            <span class="c">// warning to host messages</span>
            <a href="#b05577e0278bfe8c" class="i field">computerName</a> = <span class="r1 r">runspacePool</span>.<a href="RemoteRunspacePoolInternal.cs.html#adb799cd03979b7a" class="i property">ConnectionInfo</a>.<a href="../common/RunspaceConnectionInfo.cs.html#64143b41c05cd7ea" class="i property">ComputerName</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Constructors
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Internal Methods/Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Instance Id associated with this</span>
        <span class="c">///</span><span class="c"> client remote powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Guid</span> <a id="71022daeee1769bc" href="../../../R/71022daeee1769bc.html" target="n" data-glyph="104,1" class="i property">InstanceId</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#c30957a9d4580098" class="i property">PowerShell</a>.<a href="../../hostifaces/PowerShell.cs.html#d8c9867186529e49" class="i property">InstanceId</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PowerShell associated with this ClientRemotePowerShell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <a id="c30957a9d4580098" href="../../../R/c30957a9d4580098.html" target="n" data-glyph="104,1" class="i property">PowerShell</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#533961734551583a" class="i field">shell</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the state information of the client powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">stateInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">State information to set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="1edf9aa38b8f8bcb" href="../../../R/1edf9aa38b8f8bcb.html" target="n" data-glyph="74,1" class="i method">SetStateInfo</a>(<a href="../../hostifaces/PowerShell.cs.html#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r2 rd" class="r2 r">stateInfo</span>)
        {
            <a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#8bc5b0d04eada2b1" class="i method">SetStateChanged</a>(<span class="r2 r">stateInfo</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Whether input is available when this object is created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="c3bd35b8d6fe0404" href="../../../R/c3bd35b8d6fe0404.html" target="n" data-glyph="104,1" class="i property">NoInput</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#5a98078460e94db3" class="i field">noInput</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Input stream associated with this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="0483a730832c385c" href="../../../R/0483a730832c385c.html" target="n" data-glyph="104,1" class="i property">InputStream</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#83ffd50268a8e3a2" class="i field">inputstream</a>;
            }
 
            <b>set</b>
            {
                <a href="#83ffd50268a8e3a2" class="i field">inputstream</a> = <b>value</b>;
 
                <b>if</b> (<a href="#83ffd50268a8e3a2" class="i field">inputstream</a> != <b>null</b> &amp;&amp; (<a href="#83ffd50268a8e3a2" class="i field">inputstream</a>.<a href="../../../utils/ObjectStream.cs.html#eff54ee10bba7a56" class="i property">IsOpen</a> || <a href="#83ffd50268a8e3a2" class="i field">inputstream</a>.<a href="../../../utils/ObjectStream.cs.html#01c58f66ddc41629" class="i property">Count</a> &gt; 0))
                {
                    <a href="#5a98078460e94db3" class="i field">noInput</a> = <b>false</b>;
                }
                <b>else</b>
                {
                    <a href="#5a98078460e94db3" class="i field">noInput</a> = <b>true</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Output stream associated with this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="90c7daa196f501e5" href="../../../R/90c7daa196f501e5.html" target="n" data-glyph="104,1" class="i property">OutputStream</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#7a8a981f52c18f4b" class="i field">outputstream</a>;
            }
 
            <b>set</b>
            {
                <a href="#7a8a981f52c18f4b" class="i field">outputstream</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Data structure handler object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="RemotingProtocol2.cs.html#ef96db27814e82f4" class="t t">ClientPowerShellDataStructureHandler</a> <a id="ed443312f1d49fb1" href="../../../R/ed443312f1d49fb1.html" target="n" data-glyph="104,1" class="i property">DataStructureHandler</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invocation settings associated with this</span>
        <span class="c">///</span><span class="c"> ClientRemotePowerShell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <a id="0a76510a18071d39" href="../../../R/0a76510a18071d39.html" target="n" data-glyph="104,1" class="i property">Settings</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#857d997daa9e7bbb" class="i field">settings</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Close the output, error and other collections</span>
        <span class="c">///</span><span class="c"> associated with the shell, so that the</span>
        <span class="c">///</span><span class="c"> enumerator does not block.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="f4e315560153726d" href="../../../R/f4e315560153726d.html" target="n" data-glyph="74,1" class="i method">UnblockCollections</a>()
        {
            <a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#451d2223ef6050bb" class="i method">ClearRemotePowerShell</a>();
 
            <a href="#7a8a981f52c18f4b" class="i field">outputstream</a>.<a href="../../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
            <a href="#8e324b6d11865c16" class="i field">errorstream</a>.<a href="../../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
            <b>if</b> (<a href="#83ffd50268a8e3a2" class="i field">inputstream</a> != <b>null</b>)
            {
                <a href="#83ffd50268a8e3a2" class="i field">inputstream</a>.<a href="../../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the remote powershell asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">This method will be called from</span>
        <span class="c">///</span><span class="c"> within the lock on PowerShell. Hence no need</span>
        <span class="c">///</span><span class="c"> to lock</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="b23b50ea93dd2ba0" href="../../../R/b23b50ea93dd2ba0.html" target="n" data-glyph="74,1" class="i method">StopAsync</a>()
        {
            <span class="c">// If we are in robust connection retry mode then auto-disconnect this command</span>
            <span class="c">// rather than try to stop it.</span>
            <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a> <span id="r3 rd" class="r3 r">retryStatus</span> = <a href="#81a1bed1ce176875" class="i field">_connectionRetryStatus</a>;
            <b>if</b> ((<span class="r3 r">retryStatus</span> == <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#fd62f226276704d4" class="i field">NetworkFailureDetected</a> ||
                 <span class="r3 r">retryStatus</span> == <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#222c77174f33e437" class="i field">ConnectionRetryAttempt</a>) &amp;&amp;
                <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#f62c92b12f5e45bc" class="i field">runspacePool</a>.<a href="../../hostifaces/RunspacePoolInternal.cs.html#f220504d3677222f" class="i property">RunspacePoolStateInfo</a>.<a href="../common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a> == <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../../hostifaces/RunspacePool.cs.html#13cbf83371c004e0" class="i field">Opened</a>)
            {
                <span class="c">// While in robust connection retry mode, this call forces robust connections</span>
                <span class="c">// to abort retries and go directly to auto-disconnect.</span>
                <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#f62c92b12f5e45bc" class="i field">runspacePool</a>.<a href="RemoteRunspacePoolInternal.cs.html#947e43b07383697b" class="i method">BeginDisconnect</a>(<b>null</b>, <b>null</b>);
                <b>return</b>;
            }
 
            <span class="c">// PowerShell CoreStop would have handled cases</span>
            <span class="c">// for NotStarted, Stopping and already Stopped</span>
            <span class="c">// so at this point, there is no need to make any</span>
            <span class="c">// check. The message simply needs to be sent</span>
            <span class="c">// across to the server</span>
            <a href="#d003ab5791b5d712" class="i field">stopCalled</a> = <b>true</b>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#2142258b25ca28cd" class="i method">SendStopPowerShellMessage</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="3663f71166889a90" href="../../../R/3663f71166889a90.html" target="n" data-glyph="74,1" class="i method">SendInput</a>()
        {
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#fdd76101fb249e43" class="i method">SendInput</a>(<a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#83ffd50268a8e3a2" class="i field">inputstream</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This event is raised, when a host call is for a remote pipeline</span>
        <span class="c">///</span><span class="c"> which this remote powershell wraps.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal event</b> <span class="i">EventHandler</span>&lt;<a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt;&gt; <a id="fc1dd053c42eadfb" href="../../../R/fc1dd053c42eadfb.html" target="n" data-glyph="32,1" class="i">HostCallReceived</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize the client remote powershell instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">inputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Input for execution.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">errorstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">error stream to which</span>
        <span class="c">///</span><span class="c"> data needs to be written to</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">informationalBuffers</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">informational buffers</span>
        <span class="c">///</span><span class="c"> which will hold debug, verbose and warning messages</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">settings</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">settings based on which this powershell</span>
        <span class="c">///</span><span class="c"> needs to be executed</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">outputstream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">output stream to which data</span>
        <span class="c">///</span><span class="c"> needs to be written to</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="86db8930303b5c9a" href="../../../R/86db8930303b5c9a.html" target="n" data-glyph="74,1" class="i method">Initialize</a>(
            <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r4 rd" class="r4 r">inputstream</span>, <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r8 rd" class="r8 r">outputstream</span>,
                 <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r5 rd" class="r5 r">errorstream</span>, <a href="../../hostifaces/PSDataCollection.cs.html#b80567add938623b" class="t t">PSInformationalBuffers</a> <span id="r6 rd" class="r6 r">informationalBuffers</span>,
                        <a href="../../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r7 rd" class="r7 r">settings</span>)
        {
            <a href="#a6f61bb23a04b321" class="i field">initialized</a> = <b>true</b>;
            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#75e49a341e8ac5b9" class="i field">informationalBuffers</a> = <span class="r6 r">informationalBuffers</span>;
            <a href="#0483a730832c385c" class="i property">InputStream</a> = <span class="r4 r">inputstream</span>;
            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#8e324b6d11865c16" class="i field">errorstream</a> = <span class="r5 r">errorstream</span>;
            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#7a8a981f52c18f4b" class="i field">outputstream</a> = <span class="r8 r">outputstream</span>;
            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#857d997daa9e7bbb" class="i field">settings</a> = <span class="r7 r">settings</span>;
 
            <b>if</b> (<span class="r7 r">settings</span> == <b>null</b> || <span class="r7 r">settings</span>.<a href="../../hostifaces/PowerShell.cs.html#2088d9ba09399d1e" class="i property">Host</a> == <b>null</b>)
            {
                <a href="#19c366f0f9eb14f4" class="i field">hostToUse</a> = <a href="#f62c92b12f5e45bc" class="i field">runspacePool</a>.<a href="RemoteRunspacePoolInternal.cs.html#836d29f1e729f0db" class="i property">Host</a>;
            }
            <b>else</b>
            {
                <a href="#19c366f0f9eb14f4" class="i field">hostToUse</a> = <span class="r7 r">settings</span>.<a href="../../hostifaces/PowerShell.cs.html#2088d9ba09399d1e" class="i property">Host</a>;
            }
 
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a> = <a href="#f62c92b12f5e45bc" class="i field">runspacePool</a>.<a href="RemoteRunspacePoolInternal.cs.html#6629c704c27c6e09" class="i property">DataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#6fe92268c28aa446" class="i method">CreatePowerShellDataStructureHandler</a>(<a href="#b4d2ac017883b31c" class="k">this</a>);
 
            <span class="c">// register for events from the data structure handler</span>
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#ef5c7524bb659078" class="i">InvocationStateInfoReceived</a> += <span class="i">HandleInvocationStateInfoReceived</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#97826a5b80db389d" class="i">OutputReceived</a> += <span class="i">HandleOutputReceived</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#743c4d5ca42b19f7" class="i">ErrorReceived</a> += <span class="i">HandleErrorReceived</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#53ad87a815f6bf93" class="i">InformationalMessageReceived</a> += <span class="i">HandleInformationalMessageReceived</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#d69edffc081d58a7" class="i">HostCallReceived</a> += <span class="i">HandleHostCallReceived</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#abc36726071eb735" class="i">ClosedNotificationFromRunspacePool</a> += <span class="i">HandleCloseNotificationFromRunspacePool</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#478180bef6c04e8a" class="i">BrokenNotificationFromRunspacePool</a> += <span class="i">HandleBrokenNotificationFromRunspacePool</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#102c8d30d1adaadd" class="i">ConnectCompleted</a> += <span class="i">HandleConnectCompleted</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#f33f2d79dc5a0e4a" class="i">ReconnectCompleted</a> += <span class="i">HandleConnectCompleted</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#a1ee4a583ed95c45" class="i">RobustConnectionNotification</a> += <span class="i">HandleRobustConnectionNotification</span>;
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#923f3e397ef11ba8" class="i">CloseCompleted</a> += <span class="i">HandleCloseCompleted</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Do any clean up operation per initialization here.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="9622f9b2a2b49e85" href="../../../R/9622f9b2a2b49e85.html" target="n" data-glyph="74,1" class="i method">Clear</a>()
        {
            <a href="#a6f61bb23a04b321" class="i field">initialized</a> = <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If this client remote powershell has been initialized.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="4f8237be57be8c4e" href="../../../R/4f8237be57be8c4e.html" target="n" data-glyph="104,1" class="i property">Initialized</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a6f61bb23a04b321" class="i field">initialized</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="35b9f812802aafb1" href="../../../R/35b9f812802aafb1.html" target="n" data-glyph="74,1" class="i method">ExitHandler</a>(<b>object</b> <span id="r9 rd" class="r9 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <span id="r10 rd" class="r10 r">eventArgs</span>)
        {
            <a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a> <span id="r11 rd" class="r11 r">hostcall</span> = <span class="r10 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
 
            <b>if</b> (<span class="r11 r">hostcall</span>.<a href="../common/WireDataFormat/RemoteHost.cs.html#2ec0539bd534e4b8" class="i property">IsSetShouldExitOrPopRunspace</a>)
            {
                <b>return</b>;
            }
 
            <span class="c">// use the method from the RemotePowerShell to indeed execute this call</span>
            <a href="#b4d2ac017883b31c" class="t t">ClientRemotePowerShell</a> <span id="r12 rd" class="r12 r">remotePowerShell</span> = (<a href="#b4d2ac017883b31c" class="t t">ClientRemotePowerShell</a>)<span class="r9 r">sender</span>;
 
            <span class="r12 r">remotePowerShell</span>.<a href="#e0a97b148b8296bf" class="i method">ExecuteHostCall</a>(<span class="r11 r">hostcall</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Attempts to reconnect or connect to a running command on a remote server,</span>
        <span class="c">///</span><span class="c"> which will resume events and data collection from the server.</span>
        <span class="c">///</span><span class="c"> If connectCmdInfo parameter is null then a reconnection is attempted and</span>
        <span class="c">///</span><span class="c"> it is assumed that the current client state is unchanged since disconnection.</span>
        <span class="c">///</span><span class="c"> If connectCmdInfo parameter is non-null then a connection is attempted to</span>
        <span class="c">///</span><span class="c"> the specified remote running command.</span>
        <span class="c">///</span><span class="c"> This is an asynchronous call and results will be reported in the ReconnectCompleted</span>
        <span class="c">///</span><span class="c"> or the ConnectCompleted call back as appropriate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">connectCmdInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">ConnectCommandInfo specifying remote command.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="c5b1963ce07409c4" href="../../../R/c5b1963ce07409c4.html" target="n" data-glyph="74,1" class="i method">ConnectAsync</a>(<a href="RemoteRunspacePoolInternal.cs.html#b586ca980bfda5bc" class="t t">ConnectCommandInfo</a> <span id="r13 rd" class="r13 r">connectCmdInfo</span>)
        {
            <b>if</b> (<span class="r13 r">connectCmdInfo</span> == <b>null</b>)
            {
                <span class="c">// Attempt to do a reconnect with the current PSRP client state.</span>
                <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#9fd63afdd81cecca" class="i method">ReconnectAsync</a>();
            }
            <b>else</b>
            {
                <span class="c">// First add this command DS handler to the remote runspace pool list.</span>
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#04184898f9307df6" class="i property">RunspacePool</a> != <b>null</b>, <span class="s">&quot;Invalid runspace pool for this powershell object.&quot;</span>);
                <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#04184898f9307df6" class="i property">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#ae1c1c4ae8a5c648" class="i property">RemoteRunspacePoolInternal</a>.<a href="RemoteRunspacePoolInternal.cs.html#8aa83b594b0d44c9" class="i method">AddRemotePowerShellDSHandler</a>(
                                            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#71022daeee1769bc" class="i property">InstanceId</a>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>);
 
                <span class="c">// Now do the asynchronous connect.</span>
                <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#a9fa9f162d3db021" class="i method">ConnectAsync</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This event is fired when this PowerShell object receives a robust connection</span>
        <span class="c">///</span><span class="c"> notification from the transport.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal event</b> <span class="i">EventHandler</span>&lt;<a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a>&gt; <a id="ed43c52261b131fb" href="../../../R/ed43c52261b131fb.html" target="n" data-glyph="32,1" class="i">RCConnectionNotification</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Current remote connection retry status.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a> <a id="f77c67364d15dbbd" href="../../../R/f77c67364d15dbbd.html" target="n" data-glyph="104,1" class="i property">ConnectionRetryStatus</a>
        {
            <b>get</b> { <b>return</b> <a href="#81a1bed1ce176875" class="i field">_connectionRetryStatus</a>; }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Internal Methods/Properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Methods
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An error record is received from the powershell at the</span>
        <span class="c">///</span><span class="c"> server side. It is added to the error collection of the</span>
        <span class="c">///</span><span class="c"> client powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing this event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="045f67e4f32e0161" href="../../../R/045f67e4f32e0161.html" target="n" data-glyph="76,1" class="i method">HandleErrorReceived</a>(<b>object</b> <span id="r14 rd" class="r14 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt; <span id="r15 rd" class="r15 r">eventArgs</span>)
        {
            <b>using</b> (<a href="#50a133abd7ca7f4c" class="i field">s_tracer</a>.<a href="../../../utils/StructuredTraceSource.cs.html#a7463a7f51bc0952" class="i method">TraceEventHandlers</a>())
            {
                <a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#87033b28ad23f4b2" class="i method">SetHadErrors</a>(<b>true</b>);
                <a href="#8e324b6d11865c16" class="i field">errorstream</a>.<a href="../../../utils/ObjectStream.cs.html#c3e6a49bad4b1dfe" class="i method">Write</a>(<span class="r15 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An output object is received from the powershell at the</span>
        <span class="c">///</span><span class="c"> server side. It is added to the output collection of the</span>
        <span class="c">///</span><span class="c"> client powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing this event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="ad74284f103d3076" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleOutputReceived</a>(<b>object</b> <span id="r16 rd" class="r16 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<b>object</b>&gt; <span id="r17 rd" class="r17 r">eventArgs</span>)
        {
            <b>using</b> (<a href="#50a133abd7ca7f4c" class="i field">s_tracer</a>.<a href="../../../utils/StructuredTraceSource.cs.html#a7463a7f51bc0952" class="i method">TraceEventHandlers</a>())
            {
                <b>object</b> <span id="r18 rd" class="r18 r">data</span> = <span class="r17 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
 
                <b>try</b>
                {
                    <a href="#7a8a981f52c18f4b" class="i field">outputstream</a>.<a href="../../../utils/ObjectStream.cs.html#c3e6a49bad4b1dfe" class="i method">Write</a>(<span class="r18 r">data</span>);
                }
                <b>catch</b> (<a href="../../ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a> <span id="r19 rd" class="r19 r">e</span>)
                {
                    <a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#8bc5b0d04eada2b1" class="i method">SetStateChanged</a>(<b>new</b> <span class="t">PSInvocationStateInfo</span>(<a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#35065a8449cad351" class="i field">Failed</a>, <span class="r19 r">e</span>));
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The invocation state of the server powershell has changed.</span>
        <span class="c">///</span><span class="c"> The state of the client powershell is reflected accordingly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing this event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="1c09c6d0208f8cb3" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleInvocationStateInfoReceived</a>(<b>object</b> <span id="r20 rd" class="r20 r">sender</span>,
            <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../../hostifaces/PowerShell.cs.html#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt; <span id="r21 rd" class="r21 r">eventArgs</span>)
        {
            <b>using</b> (<a href="#50a133abd7ca7f4c" class="i field">s_tracer</a>.<a href="../../../utils/StructuredTraceSource.cs.html#a7463a7f51bc0952" class="i method">TraceEventHandlers</a>())
            {
                <a href="../../hostifaces/PowerShell.cs.html#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r22 rd" class="r22 r">stateInfo</span> = <span class="r21 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
 
                <span class="c">// we should not receive any transient state from</span>
                <span class="c">// the server</span>
                <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!(<span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#7142407e9e49cf13" class="i field">Running</a> ||
                           <span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#a9d235bf0dc5bfce" class="i field">Stopping</a>),
                           <span class="s">&quot;Transient states should not be received from the server&quot;</span>);
 
                <b>if</b> (<span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#55f5ed5d1c0f010a" class="i field">Disconnected</a>)
                {
                    <a href="#1edf9aa38b8f8bcb" class="i method">SetStateInfo</a>(<span class="r22 r">stateInfo</span>);
                }
                <b>else</b> <b>if</b> (<span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#6a6866e7df063875" class="i field">Stopped</a> ||
                         <span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#35065a8449cad351" class="i field">Failed</a> ||
                         <span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#89ec15a2a933a2b6" class="i field">Completed</a>)
                {
                    <span class="c">// Special case for failure error due to ErrorCode==-2144108453 (no ShellId found).</span>
                    <span class="c">// In this case terminate session since there is no longer a shell to communicate</span>
                    <span class="c">// with.</span>
                    <b>bool</b> <span id="r23 rd" class="r23 r">terminateSession</span> = <b>false</b>;
                    <b>if</b> (<span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#35065a8449cad351" class="i field">Failed</a>)
                    {
                        <a href="../common/remotingexceptions.cs.html#0bb8687f97d91059" class="t t">PSRemotingTransportException</a> <span id="r24 rd" class="r24 r">remotingTransportException</span> = <span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#5e4f678af21908e8" class="i property">Reason</a> <b>as</b> <a href="../common/remotingexceptions.cs.html#0bb8687f97d91059" class="t t">PSRemotingTransportException</a>;
                        <span class="r23 r">terminateSession</span> = (<span class="r24 r">remotingTransportException</span> != <b>null</b>) &amp;&amp;
                                           (<span class="r24 r">remotingTransportException</span>.<a href="../common/remotingexceptions.cs.html#f96218464c4b7244" class="i property">ErrorCode</a> == <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>.<span class="i n">Client</span>.<a href="../fanin/WSManNativeAPI.cs.html#46dd878f72638b32" class="t t">WSManNativeApi</a>.<a href="../fanin/WSManNativeAPI.cs.html#1512da0c98e3c02b" class="i field">ERROR_WSMAN_TARGETSESSION_DOESNOTEXIST</a>);
                    }
 
                    <span class="c">// if state is completed or failed or stopped,</span>
                    <span class="c">// then the collections need to be closed as</span>
                    <span class="c">// well, else the enumerator will block</span>
                    <a href="#f4e315560153726d" class="i method">UnblockCollections</a>();
 
                    <b>if</b> (<a href="#d003ab5791b5d712" class="i field">stopCalled</a> || <span class="r23 r">terminateSession</span>)
                    {
                        <span class="c">// Reset stop called flag.</span>
                        <a href="#d003ab5791b5d712" class="i field">stopCalled</a> = <b>false</b>;
 
                        <span class="c">// if a Stop method has been called, then powershell</span>
                        <span class="c">// would have already raised a Stopping event, after</span>
                        <span class="c">// which only a Stopped should be raised</span>
                        <a href="#af419c3445016461" class="i field">_stateInfoQueue</a>.<span class="i">Enqueue</span>(<b>new</b> <a href="../../hostifaces/PowerShell.cs.html#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#6a6866e7df063875" class="i field">Stopped</a>,
                            <span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#5e4f678af21908e8" class="i property">Reason</a>));
 
                        <span class="c">// If the stop call failed due to network problems then close the runspace</span>
                        <span class="c">// since it is now unusable.</span>
                        <a href="#8f370b816ec1d71d" class="i method">CheckAndCloseRunspaceAfterStop</a>(<span class="r22 r">stateInfo</span>.<a href="../../hostifaces/PowerShell.cs.html#5e4f678af21908e8" class="i property">Reason</a>);
                    }
                    <b>else</b>
                    {
                        <a href="#af419c3445016461" class="i field">_stateInfoQueue</a>.<span class="i">Enqueue</span>(<span class="r22 r">stateInfo</span>);
                    }
                    <span class="c">// calling close async only after making sure all the internal members are prepared</span>
                    <span class="c">// to handle close complete.</span>
                    <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#4db2ec6f0f51c664" class="i method">CloseConnectionAsync</a>(<b>null</b>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper method to check any error condition after a stop call</span>
        <span class="c">///</span><span class="c"> and close the remote runspace/pool if the stop call failed due</span>
        <span class="c">///</span><span class="c"> to network outage problems.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">ex</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Exception.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="8f370b816ec1d71d" href="../../../R/8f370b816ec1d71d.html" target="n" data-glyph="76,1" class="i method">CheckAndCloseRunspaceAfterStop</a>(<span class="i">Exception</span> <span id="r25 rd" class="r25 r">ex</span>)
        {
            <a href="../common/remotingexceptions.cs.html#0bb8687f97d91059" class="t t">PSRemotingTransportException</a> <span id="r26 rd" class="r26 r">transportException</span> = <span class="r25 r">ex</span> <b>as</b> <a href="../common/remotingexceptions.cs.html#0bb8687f97d91059" class="t t">PSRemotingTransportException</a>;
            <b>if</b> (<span class="r26 r">transportException</span> != <b>null</b> &amp;&amp;
                (<span class="r26 r">transportException</span>.<a href="../common/remotingexceptions.cs.html#f96218464c4b7244" class="i property">ErrorCode</a> == <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>.<span class="i n">Client</span>.<a href="../fanin/WSManNativeAPI.cs.html#46dd878f72638b32" class="t t">WSManNativeApi</a>.<a href="../fanin/WSManNativeAPI.cs.html#42bce97949b29c7f" class="i field">ERROR_WSMAN_SENDDATA_CANNOT_CONNECT</a> ||
                 <span class="r26 r">transportException</span>.<a href="../common/remotingexceptions.cs.html#f96218464c4b7244" class="i property">ErrorCode</a> == <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>.<span class="i n">Client</span>.<a href="../fanin/WSManNativeAPI.cs.html#46dd878f72638b32" class="t t">WSManNativeApi</a>.<a href="../fanin/WSManNativeAPI.cs.html#555c2ee01109d2c5" class="i field">ERROR_WSMAN_SENDDATA_CANNOT_COMPLETE</a> ||
                 <span class="r26 r">transportException</span>.<a href="../common/remotingexceptions.cs.html#f96218464c4b7244" class="i property">ErrorCode</a> == <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>.<span class="i n">Client</span>.<a href="../fanin/WSManNativeAPI.cs.html#46dd878f72638b32" class="t t">WSManNativeApi</a>.<a href="../fanin/WSManNativeAPI.cs.html#1512da0c98e3c02b" class="i field">ERROR_WSMAN_TARGETSESSION_DOESNOTEXIST</a>))
            {
                <b>object</b> <span id="r27 rd" class="r27 r">rsObject</span> = <a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#503345e404ed0ddb" class="i method">GetRunspaceConnection</a>();
                <b>if</b> (<span class="r27 r">rsObject</span> <b>is</b> <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>)
                {
                    <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r28 rd" class="r28 r">runspace</span> = (<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>)<span class="r27 r">rsObject</span>;
                    <b>if</b> (<span class="r28 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a> == <a href="../../hostifaces/Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="../../hostifaces/Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                    {
                        <b>try</b>
                        {
                            <span class="r28 r">runspace</span>.<a href="../../hostifaces/Connection.cs.html#e7b6aa3b7b07847b" class="i method">Close</a>();
                        }
                        <b>catch</b> (<a href="../common/remotingexceptions.cs.html#0bb8687f97d91059" class="t t">PSRemotingTransportException</a>)
                        { }
                    }
                }
                <b>else</b> <b>if</b> (<span class="r27 r">rsObject</span> <b>is</b> <a href="../../hostifaces/RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)
                {
                    <a href="../../hostifaces/RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a> <span id="r29 rd" class="r29 r">runspacePool</span> = (<a href="../../hostifaces/RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>)<span class="r27 r">rsObject</span>;
                    <b>if</b> (<span class="r29 r">runspacePool</span>.<a href="../../hostifaces/RunspacePool.cs.html#a7f9e215f0cbb1ce" class="i property">RunspacePoolStateInfo</a>.<a href="../common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a> == <a href="../../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../../hostifaces/RunspacePool.cs.html#13cbf83371c004e0" class="i field">Opened</a>)
                    {
                        <b>try</b>
                        {
                            <span class="r29 r">runspacePool</span>.<a href="../../hostifaces/RunspacePool.cs.html#1689eedd988353b0" class="i method">Close</a>();
                        }
                        <b>catch</b> (<a href="../common/remotingexceptions.cs.html#0bb8687f97d91059" class="t t">PSRemotingTransportException</a>)
                        { }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler for handling any informational message received</span>
        <span class="c">///</span><span class="c"> from the server side.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Arguments describing this event.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="9ca5bdc78975506e" href="../../../R/9ca5bdc78975506e.html" target="n" data-glyph="76,1" class="i method">HandleInformationalMessageReceived</a>(<b>object</b> <span id="r30 rd" class="r30 r">sender</span>,
            <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="RemotingProtocol2.cs.html#e44e8a34c9f4b3f9" class="t t">InformationalMessage</a>&gt; <span id="r31 rd" class="r31 r">eventArgs</span>)
        {
            <b>using</b> (<a href="#50a133abd7ca7f4c" class="i field">s_tracer</a>.<a href="../../../utils/StructuredTraceSource.cs.html#a7463a7f51bc0952" class="i method">TraceEventHandlers</a>())
            {
                <a href="RemotingProtocol2.cs.html#e44e8a34c9f4b3f9" class="t t">InformationalMessage</a> <span id="r32 rd" class="r32 r">infoMessage</span> = <span class="r31 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>;
 
                <b>switch</b> (<span class="r32 r">infoMessage</span>.<a href="RemotingProtocol2.cs.html#ef6a16ccbbc1fc04" class="i property">DataType</a>)
                {
                    <b>case</b> <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#296cbb5be87abd08" class="t t">RemotingDataType</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#9305a742d83a6da8" class="i field">PowerShellDebug</a>:
                        {
                            <a href="#75e49a341e8ac5b9" class="i field">informationalBuffers</a>.<a href="../../hostifaces/PSDataCollection.cs.html#37771eca1a6570ee" class="i method">AddDebug</a>((<a href="../../hostifaces/InformationalRecord.cs.html#8954d4e40287d3de" class="t t">DebugRecord</a>)<span class="r32 r">infoMessage</span>.<a href="RemotingProtocol2.cs.html#69bb4026b2b467e6" class="i property">Message</a>);
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#296cbb5be87abd08" class="t t">RemotingDataType</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#1036eaaa6058e728" class="i field">PowerShellVerbose</a>:
                        {
                            <a href="#75e49a341e8ac5b9" class="i field">informationalBuffers</a>.<a href="../../hostifaces/PSDataCollection.cs.html#ec3de9fc214e0f9a" class="i method">AddVerbose</a>((<a href="../../hostifaces/InformationalRecord.cs.html#5d56339940b0040b" class="t t">VerboseRecord</a>)<span class="r32 r">infoMessage</span>.<a href="RemotingProtocol2.cs.html#69bb4026b2b467e6" class="i property">Message</a>);
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#296cbb5be87abd08" class="t t">RemotingDataType</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#df7036213bef9576" class="i field">PowerShellWarning</a>:
                        {
                            <a href="#75e49a341e8ac5b9" class="i field">informationalBuffers</a>.<a href="../../hostifaces/PSDataCollection.cs.html#3a6800a0b37b69e0" class="i method">AddWarning</a>((<a href="../../hostifaces/InformationalRecord.cs.html#59cd69dde48b9557" class="t t">WarningRecord</a>)<span class="r32 r">infoMessage</span>.<a href="RemotingProtocol2.cs.html#69bb4026b2b467e6" class="i property">Message</a>);
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#296cbb5be87abd08" class="t t">RemotingDataType</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#b701f1d4d5503ca9" class="i field">PowerShellProgress</a>:
                        {
                            <a href="../../ProgressRecord.cs.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a> <span id="r33 rd" class="r33 r">progress</span> = (<a href="../../ProgressRecord.cs.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a>)<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r32 r">infoMessage</span>.<a href="RemotingProtocol2.cs.html#69bb4026b2b467e6" class="i property">Message</a>,
                                <b>typeof</b>(<a href="../../ProgressRecord.cs.html#d79b27687c6ed8c8" class="t t">ProgressRecord</a>), <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                            <a href="#75e49a341e8ac5b9" class="i field">informationalBuffers</a>.<a href="../../hostifaces/PSDataCollection.cs.html#aa3c19985b179abd" class="i method">AddProgress</a>(<span class="r33 r">progress</span>);
                        }
 
                        <b>break</b>;
 
                    <b>case</b> <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#296cbb5be87abd08" class="t t">RemotingDataType</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#752bf1e010416aa1" class="i field">PowerShellInformationStream</a>:
                        {
                            <a href="#75e49a341e8ac5b9" class="i field">informationalBuffers</a>.<a href="../../hostifaces/PSDataCollection.cs.html#cfff1673f621713b" class="i method">AddInformation</a>((<a href="../../InformationRecord.cs.html#508a9dbac37ec093" class="t t">InformationRecord</a>)<span class="r32 r">infoMessage</span>.<a href="RemotingProtocol2.cs.html#69bb4026b2b467e6" class="i property">Message</a>);
                        }
 
                        <b>break</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="eeeab88688cb6609" href="../../../R/eeeab88688cb6609.html" target="n" data-glyph="76,1" class="i method">HandleHostCallReceived</a>(<b>object</b> <span id="r34 rd" class="r34 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <span id="r35 rd" class="r35 r">eventArgs</span>)
        {
            <b>using</b> (<a href="#50a133abd7ca7f4c" class="i field">s_tracer</a>.<a href="../../../utils/StructuredTraceSource.cs.html#a7463a7f51bc0952" class="i method">TraceEventHandlers</a>())
            {
                <span class="i">Collection</span>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <span id="r36 rd" class="r36 r">prerequisiteCalls</span> =
                    <span class="r35 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>.<a href="../common/WireDataFormat/RemoteHost.cs.html#9a3718f8e6cc8b76" class="i method">PerformSecurityChecksOnHostMessage</a>(<a href="#b05577e0278bfe8c" class="i field">computerName</a>);
 
                <b>if</b> (<a href="#fc1dd053c42eadfb" class="i">HostCallReceived</a> != <b>null</b>)
                {
                    <span class="c">// raise events for all prerequisite calls</span>
                    <b>if</b> (<span class="r36 r">prerequisiteCalls</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a> <span id="r37 rd" class="r37 r">hostcall</span> <b>in</b> <span class="r36 r">prerequisiteCalls</span>)
                        {
                            <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt; <span id="r38 rd" class="r38 r">args</span> =
                                <b>new</b> <a href="../common/misc.cs.html#79fd22f37cbd3e2d" class="t constructor">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt;(<span class="r37 r">hostcall</span>);
 
                            <a href="#fc1dd053c42eadfb" class="i">HostCallReceived</a>.<span class="i">SafeInvoke</span>(<a href="#b4d2ac017883b31c" class="k">this</a>, <span class="r38 r">args</span>);
                        }
                    }
 
                    <a href="#fc1dd053c42eadfb" class="i">HostCallReceived</a>.<span class="i">SafeInvoke</span>(<a href="#b4d2ac017883b31c" class="k">this</a>, <span class="r35 r">eventArgs</span>);
                }
                <b>else</b>
                {
                    <span class="c">// execute any prerequisite calls before</span>
                    <span class="c">// executing this host call</span>
                    <b>if</b> (<span class="r36 r">prerequisiteCalls</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a> <span id="r39 rd" class="r39 r">hostcall</span> <b>in</b> <span class="r36 r">prerequisiteCalls</span>)
                        {
                            <a href="#e0a97b148b8296bf" class="i method">ExecuteHostCall</a>(<span class="r39 r">hostcall</span>);
                        }
                    }
 
                    <a href="#e0a97b148b8296bf" class="i method">ExecuteHostCall</a>(<span class="r35 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handler for ConnectCompleted and ReconnectCompleted events from the</span>
        <span class="c">///</span><span class="c"> PSRP layer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this event, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Event arguments.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="c51a0b1932f5371c" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleConnectCompleted</a>(<b>object</b> <span id="r40 rd" class="r40 r">sender</span>, <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<span class="i">Exception</span>&gt; <span id="r41 rd" class="r41 r">e</span>)
        {
            <span class="c">// After initial connect/reconnect set state to &quot;Running&quot;.  Later events</span>
            <span class="c">// will update state to appropriate command execution state.</span>
            <a href="#1edf9aa38b8f8bcb" class="i method">SetStateInfo</a>(<b>new</b> <a href="../../hostifaces/PowerShell.cs.html#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#7142407e9e49cf13" class="i field">Running</a>, <b>null</b>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is need for the state change events that resulted in closing the underlying</span>
        <span class="c">///</span><span class="c"> datastructure handler. We cannot send the state back to the upper layers until</span>
        <span class="c">///</span><span class="c"> close is completed from the datastructure/transport layer. We have to send</span>
        <span class="c">///</span><span class="c"> the terminal state only when we know that underlying datastructure/transport</span>
        <span class="c">///</span><span class="c"> is closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">args</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="eaee1d3e7b2282f9" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleCloseCompleted</a>(<b>object</b> <span id="r42 rd" class="r42 r">sender</span>, <span class="i">EventArgs</span> <span id="r43 rd" class="r43 r">args</span>)
        {
            <span class="c">// if state is completed or failed or stopped,</span>
            <span class="c">// then the collections need to be closed as</span>
            <span class="c">// well, else the enumerator will block</span>
            <a href="#f4e315560153726d" class="i method">UnblockCollections</a>();
 
            <span class="c">// close the transport manager when CreateCloseAckPacket is received</span>
            <span class="c">// otherwise may have race conditions in Server.OutOfProcessMediator</span>
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#1689f772ee97a7bc" class="i method">RaiseRemoveAssociationEvent</a>();
 
            <b>if</b> (<a href="#af419c3445016461" class="i field">_stateInfoQueue</a>.<span class="i">Count</span> == 0)
            {
                <span class="c">// If shell state is not finished on client side and queue is empty</span>
                <span class="c">// then set state to stopped unless the current state is Disconnected</span>
                <span class="c">// in which case transition state to failed.</span>
                <b>if</b> (!<a href="#8085f2c195a192a5" class="i method">IsFinished</a>(<a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a>))
                {
                    <span class="c">// If RemoteSessionStateEventArgs are provided then use them to set the</span>
                    <span class="c">// session close reason when setting finished state.</span>
                    <a href="../common/misc.cs.html#7e5c4afe334f8fc9" class="t t">RemoteSessionStateEventArgs</a> <span id="r44 rd" class="r44 r">sessionEventArgs</span> = <span class="r43 r">args</span> <b>as</b> <a href="../common/misc.cs.html#7e5c4afe334f8fc9" class="t t">RemoteSessionStateEventArgs</a>;
                    <span class="i">Exception</span> <span id="r45 rd" class="r45 r">closeReason</span> = <span class="r44 r">sessionEventArgs</span>?.<a href="../common/misc.cs.html#973536ebdade9102" class="i property">SessionStateInfo</a>.<a href="../common/misc.cs.html#91101c327c02f6db" class="i property">Reason</a>;
                    <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <span id="r46 rd" class="r46 r">finishedState</span> = (<a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#39b81acd3aeb1582" class="i property">InvocationStateInfo</a>.<a href="../../hostifaces/PowerShell.cs.html#7a70ff5163d0f044" class="i property">State</a> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#55f5ed5d1c0f010a" class="i field">Disconnected</a>) ?
                        <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#35065a8449cad351" class="i field">Failed</a> : <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#6a6866e7df063875" class="i field">Stopped</a>;
 
                    <a href="#1edf9aa38b8f8bcb" class="i method">SetStateInfo</a>(<b>new</b> <a href="../../hostifaces/PowerShell.cs.html#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<span class="r46 r">finishedState</span>, <span class="r45 r">closeReason</span>));
                }
            }
            <b>else</b>
            {
                <span class="c">// Apply queued state changes.</span>
                <b>while</b> (<a href="#af419c3445016461" class="i field">_stateInfoQueue</a>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="../../hostifaces/PowerShell.cs.html#42e325836d1ae967" class="t t">PSInvocationStateInfo</a> <span id="r47 rd" class="r47 r">stateInfo</span> = <a href="#af419c3445016461" class="i field">_stateInfoQueue</a>.<span class="i">Dequeue</span>();
                    <a href="#1edf9aa38b8f8bcb" class="i method">SetStateInfo</a>(<span class="r47 r">stateInfo</span>);
                }
            }
        }
 
        <b>private static bool</b> <a id="8085f2c195a192a5" href="../../../R/8085f2c195a192a5.html" target="n" data-glyph="76,1" class="i method">IsFinished</a>(<a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a> <span id="r48 rd" class="r48 r">state</span>)
        {
            <b>return</b> (<span class="r48 r">state</span> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#89ec15a2a933a2b6" class="i field">Completed</a> ||
                    <span class="r48 r">state</span> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#35065a8449cad351" class="i field">Failed</a> ||
                    <span class="r48 r">state</span> == <a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#6a6866e7df063875" class="i field">Stopped</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Execute the specified host call.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">hostcall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Host call to execute.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="e0a97b148b8296bf" href="../../../R/e0a97b148b8296bf.html" target="n" data-glyph="76,1" class="i method">ExecuteHostCall</a>(<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a> <span id="r49 rd" class="r49 r">hostcall</span>)
        {
            <b>if</b> (<span class="r49 r">hostcall</span>.<a href="../common/WireDataFormat/RemoteHost.cs.html#37efb27cec7c978c" class="i property">IsVoidMethod</a>)
            {
                <b>if</b> (<span class="r49 r">hostcall</span>.<a href="../common/WireDataFormat/RemoteHost.cs.html#2ec0539bd534e4b8" class="i property">IsSetShouldExitOrPopRunspace</a>)
                {
                    <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#533961734551583a" class="i field">shell</a>.<a href="../../hostifaces/PowerShell.cs.html#451d2223ef6050bb" class="i method">ClearRemotePowerShell</a>();
                }
 
                <span class="r49 r">hostcall</span>.<a href="../common/WireDataFormat/RemoteHost.cs.html#400d83762dea851d" class="i method">ExecuteVoidMethod</a>(<a href="#19c366f0f9eb14f4" class="i field">hostToUse</a>);
            }
            <b>else</b>
            {
                <a href="../common/WireDataFormat/RemoteHost.cs.html#2088d050a88e3ac6" class="t t">RemoteHostResponse</a> <span id="r50 rd" class="r50 r">remoteHostResponse</span> = <span class="r49 r">hostcall</span>.<a href="../common/WireDataFormat/RemoteHost.cs.html#803d117187c9d69c" class="i method">ExecuteNonVoidMethod</a>(<a href="#19c366f0f9eb14f4" class="i field">hostToUse</a>);
                <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#018723f865f89d32" class="i method">SendHostResponseToServer</a>(<span class="r50 r">remoteHostResponse</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="5ff74a5bb4b3700e" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleCloseNotificationFromRunspacePool</a>(<b>object</b> <span id="r51 rd" class="r51 r">sender</span>,
            <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<span class="i">Exception</span>&gt; <span id="r52 rd" class="r52 r">eventArgs</span>)
        {
            <span class="c">// RunspacePool is closed...so going to set the state of PowerShell</span>
            <span class="c">// to stopped here.</span>
 
            <span class="c">// if state is completed or failed or stopped,</span>
            <span class="c">// then the collections need to be closed as</span>
            <span class="c">// well, else the enumerator will block</span>
            <a href="#f4e315560153726d" class="i method">UnblockCollections</a>();
 
            <span class="c">// Since this is a terminal state..close the transport manager.</span>
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#1689f772ee97a7bc" class="i method">RaiseRemoveAssociationEvent</a>();
 
            <span class="c">// RunspacePool is closed...so going to set the state of PowerShell</span>
            <span class="c">// to stopped here.</span>
            <a href="#1edf9aa38b8f8bcb" class="i method">SetStateInfo</a>(<b>new</b> <a href="../../hostifaces/PowerShell.cs.html#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#6a6866e7df063875" class="i field">Stopped</a>,
                <span class="r52 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>));
 
            <span class="c">// Not calling dataStructureHandler.CloseConnection() as this must</span>
            <span class="c">// have already been called by RunspacePool.Close()</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handles notification from RunspacePool indicating</span>
        <span class="c">///</span><span class="c"> that the pool is broken. This sets the state of</span>
        <span class="c">///</span><span class="c"> all the powershell objects associated with the</span>
        <span class="c">///</span><span class="c"> runspace pool to Failed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sender of this information, unused.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">eventArgs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">arguments describing this event</span>
        <span class="c">///</span><span class="c"> contains information on the reason associated with the</span>
        <span class="c">///</span><span class="c"> runspace pool entering a Broken state</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="e3cf38655a724f0f" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleBrokenNotificationFromRunspacePool</a>(<b>object</b> <span id="r53 rd" class="r53 r">sender</span>,
            <a href="../common/misc.cs.html#16d1e16a7ed9f8cc" class="t t">RemoteDataEventArgs</a>&lt;<span class="i">Exception</span>&gt; <span id="r54 rd" class="r54 r">eventArgs</span>)
        {
            <span class="c">// RunspacePool is closed...so going to set the state of PowerShell</span>
            <span class="c">// to stopped here.</span>
 
            <span class="c">// if state is completed or failed or stopped,</span>
            <span class="c">// then the collections need to be closed as</span>
            <span class="c">// well, else the enumerator will block</span>
            <a href="#f4e315560153726d" class="i method">UnblockCollections</a>();
 
            <span class="c">// Since this is a terminal state..close the transport manager.</span>
            <a href="#d55dc992e0cb7f30" class="i field">dataStructureHandler</a>.<a href="RemotingProtocol2.cs.html#1689f772ee97a7bc" class="i method">RaiseRemoveAssociationEvent</a>();
            <b>if</b> (<a href="#d003ab5791b5d712" class="i field">stopCalled</a>)
            {
                <span class="c">// Reset stop called flag.</span>
                <a href="#d003ab5791b5d712" class="i field">stopCalled</a> = <b>false</b>;
 
                <span class="c">// if a Stop method has been called, then powershell</span>
                <span class="c">// would have already raised a Stopping event, after</span>
                <span class="c">// which only a Stopped should be raised</span>
                <a href="#1edf9aa38b8f8bcb" class="i method">SetStateInfo</a>(<b>new</b> <a href="../../hostifaces/PowerShell.cs.html#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#6a6866e7df063875" class="i field">Stopped</a>,
                    <span class="r54 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>));
            }
            <b>else</b>
            {
                <a href="#1edf9aa38b8f8bcb" class="i method">SetStateInfo</a>(<b>new</b> <a href="../../hostifaces/PowerShell.cs.html#db44bd87590c83f5" class="t constructor">PSInvocationStateInfo</a>(<a href="../../hostifaces/PowerShell.cs.html#24cc37ccdc118b7a" class="t t">PSInvocationState</a>.<a href="../../hostifaces/PowerShell.cs.html#35065a8449cad351" class="i field">Failed</a>,
                <span class="r54 r">eventArgs</span>.<a href="../common/misc.cs.html#0896dbbd394ce2e6" class="i property">Data</a>));
            }
 
            <span class="c">// Not calling dataStructureHandler.CloseConnection() as this must</span>
            <span class="c">// have already been called by RunspacePool.Close()</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Handles a robust connection layer notification from the transport</span>
        <span class="c">///</span><span class="c"> manager.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">sender</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r56 r">e</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="59c3eb08f5e9e347" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleRobustConnectionNotification</a>(
            <b>object</b> <span id="r55 rd" class="r55 r">sender</span>,
            <a href="../fanin/BaseTransportManager.cs.html#598698ed70e51507" class="t t">ConnectionStatusEventArgs</a> <span id="r56 rd" class="r56 r">e</span>)
        {
            <span class="c">// Create event arguments and warnings/errors for this robust connection notification.</span>
            <a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a> <span id="r57 rd" class="r57 r">connectionRetryStatusArgs</span> = <b>null</b>;
            <a href="../../hostifaces/InformationalRecord.cs.html#59cd69dde48b9557" class="t t">WarningRecord</a> <span id="r58 rd" class="r58 r">warningRecord</span> = <b>null</b>;
            <a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r59 rd" class="r59 r">errorRecord</span> = <b>null</b>;
            <b>int</b> <span id="r60 rd" class="r60 r">maxRetryConnectionTimeMSecs</span> = <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#f62c92b12f5e45bc" class="i field">runspacePool</a>.<a href="RemoteRunspacePoolInternal.cs.html#53c4363b38e872a7" class="i property">MaxRetryConnectionTime</a>;
            <b>int</b> <span id="r61 rd" class="r61 r">maxRetryConnectionTimeMinutes</span> = <span class="r60 r">maxRetryConnectionTimeMSecs</span> / 60000;
            <b>switch</b> (<span class="r56 r">e</span>.<a href="../fanin/BaseTransportManager.cs.html#40c02c7ffd5fa7d4" class="i property">Notification</a>)
            {
                <b>case</b> <a href="../fanin/BaseTransportManager.cs.html#6ddc495529412646" class="t t">ConnectionStatus</a>.<a href="../fanin/BaseTransportManager.cs.html#db376fd8c7fe0b9b" class="i field">NetworkFailureDetected</a>:
                    <span class="r58 r">warningRecord</span> = <b>new</b> <a href="../../hostifaces/InformationalRecord.cs.html#dcad78b02a1ab129" class="t constructor">WarningRecord</a>(
                        <a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a>.<a href="#d70446d0cc27d2b3" class="i field">FQIDNetworkFailureDetected</a>,
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RCNetworkFailureDetected</span>,
                        <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <span class="r61 r">maxRetryConnectionTimeMinutes</span>));
 
                    <span class="r57 r">connectionRetryStatusArgs</span> =
                        <b>new</b> <a href="#57a9b30d0a205ea9" class="t constructor">PSConnectionRetryStatusEventArgs</a>(<a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#fd62f226276704d4" class="i field">NetworkFailureDetected</a>,
                            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <span class="r60 r">maxRetryConnectionTimeMSecs</span>, <span class="r58 r">warningRecord</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../fanin/BaseTransportManager.cs.html#6ddc495529412646" class="t t">ConnectionStatus</a>.<a href="../fanin/BaseTransportManager.cs.html#06149a477ad4b60b" class="i field">ConnectionRetryAttempt</a>:
                    <span class="r58 r">warningRecord</span> = <b>new</b> <a href="../../hostifaces/InformationalRecord.cs.html#dcad78b02a1ab129" class="t constructor">WarningRecord</a>(
                        <a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a>.<a href="#95a7f1c204cf5f6b" class="i field">FQIDConnectionRetryAttempt</a>,
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RCConnectionRetryAttempt</span>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>));
 
                    <span class="r57 r">connectionRetryStatusArgs</span> =
                        <b>new</b> <a href="#57a9b30d0a205ea9" class="t constructor">PSConnectionRetryStatusEventArgs</a>(<a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#222c77174f33e437" class="i field">ConnectionRetryAttempt</a>,
                            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <span class="r60 r">maxRetryConnectionTimeMSecs</span>, <span class="r58 r">warningRecord</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../fanin/BaseTransportManager.cs.html#6ddc495529412646" class="t t">ConnectionStatus</a>.<a href="../fanin/BaseTransportManager.cs.html#f19577a101577365" class="i field">ConnectionRetrySucceeded</a>:
                    <span class="r58 r">warningRecord</span> = <b>new</b> <a href="../../hostifaces/InformationalRecord.cs.html#dcad78b02a1ab129" class="t constructor">WarningRecord</a>(
                        <a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a>.<a href="#0d62c9ae6770bc41" class="i field">FQIDConnectionRetrySucceeded</a>,
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RCReconnectSucceeded</span>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>));
 
                    <span class="r57 r">connectionRetryStatusArgs</span> =
                        <b>new</b> <a href="#57a9b30d0a205ea9" class="t constructor">PSConnectionRetryStatusEventArgs</a>(<a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#b10ca9abe40057c8" class="i field">ConnectionRetrySucceeded</a>,
                            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <span class="r61 r">maxRetryConnectionTimeMinutes</span>, <span class="r58 r">warningRecord</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../fanin/BaseTransportManager.cs.html#6ddc495529412646" class="t t">ConnectionStatus</a>.<a href="../fanin/BaseTransportManager.cs.html#f0d6555b08ab5f74" class="i field">AutoDisconnectStarting</a>:
                    {
                        <span class="r58 r">warningRecord</span> = <b>new</b> <a href="../../hostifaces/InformationalRecord.cs.html#dcad78b02a1ab129" class="t constructor">WarningRecord</a>(
                            <a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a>.<a href="#9d4c4fa7427b411d" class="i field">FQIDAutoDisconnectStarting</a>,
                            <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RCAutoDisconnectingWarning</span>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>));
 
                        <span class="r57 r">connectionRetryStatusArgs</span> =
                            <b>new</b> <a href="#57a9b30d0a205ea9" class="t constructor">PSConnectionRetryStatusEventArgs</a>(<a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#f8cbf12c6086459b" class="i field">AutoDisconnectStarting</a>,
                                <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <span class="r61 r">maxRetryConnectionTimeMinutes</span>, <span class="r58 r">warningRecord</span>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <a href="../fanin/BaseTransportManager.cs.html#6ddc495529412646" class="t t">ConnectionStatus</a>.<a href="../fanin/BaseTransportManager.cs.html#de98a76dc253e5fe" class="i field">AutoDisconnectSucceeded</a>:
                    <span class="r58 r">warningRecord</span> = <b>new</b> <a href="../../hostifaces/InformationalRecord.cs.html#dcad78b02a1ab129" class="t constructor">WarningRecord</a>(
                        <a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a>.<a href="#3b7f95b0e50b02f6" class="i field">FQIDAutoDisconnectSucceeded</a>,
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RCAutoDisconnected</span>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>));
 
                    <span class="r57 r">connectionRetryStatusArgs</span> =
                        <b>new</b> <a href="#57a9b30d0a205ea9" class="t constructor">PSConnectionRetryStatusEventArgs</a>(<a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#0c117990dcafffe1" class="i field">AutoDisconnectSucceeded</a>,
                            <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <span class="r61 r">maxRetryConnectionTimeMinutes</span>, <span class="r58 r">warningRecord</span>);
                    <b>break</b>;
 
                <b>case</b> <a href="../fanin/BaseTransportManager.cs.html#6ddc495529412646" class="t t">ConnectionStatus</a>.<a href="../fanin/BaseTransportManager.cs.html#8c22e95737ef7dd8" class="i field">InternalErrorAbort</a>:
                    {
                        <b>string</b> <span id="r62 rd" class="r62 r">msg</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">RCInternalError</span>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>);
                        <a href="../../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r63 rd" class="r63 r">reason</span> = <b>new</b> <a href="../../../utils/RuntimeException.cs.html#e4538a388d78c143" class="t constructor">RuntimeException</a>(<span class="r62 r">msg</span>);
                        <span class="r59 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r63 r">reason</span>,
                            <a href="#e9fb8c6747e35270" class="t t">PSConnectionRetryStatusEventArgs</a>.<a href="#05dbde5ad5cf9e57" class="i field">FQIDNetworkOrDisconnectFailed</a>,
                            <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <a href="#b4d2ac017883b31c" class="k">this</a>);
 
                        <span class="r57 r">connectionRetryStatusArgs</span> =
                            <b>new</b> <a href="#57a9b30d0a205ea9" class="t constructor">PSConnectionRetryStatusEventArgs</a>(<a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#66a1d5afeef67425" class="i field">InternalErrorAbort</a>,
                                <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <span class="r61 r">maxRetryConnectionTimeMinutes</span>, <span class="r59 r">errorRecord</span>);
                    }
 
                    <b>break</b>;
            }
 
            <b>if</b> (<span class="r57 r">connectionRetryStatusArgs</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// Update connection status.</span>
            <a href="#81a1bed1ce176875" class="i field">_connectionRetryStatus</a> = <span class="r57 r">connectionRetryStatusArgs</span>.<a href="#3515a0c0c4bbe57e" class="i property">Notification</a>;
 
            <b>if</b> (<span class="r58 r">warningRecord</span> != <b>null</b>)
            {
                <a href="RemotingErrorRecord.cs.html#9c4f2a126825e985" class="t t">RemotingWarningRecord</a> <span id="r64 rd" class="r64 r">remotingWarningRecord</span> = <b>new</b> <a href="RemotingErrorRecord.cs.html#325f57c418d0559f" class="t constructor">RemotingWarningRecord</a>(
                    <span class="r58 r">warningRecord</span>,
                    <b>new</b> <a href="RemotingErrorRecord.cs.html#7cf40752461163ee" class="t constructor">OriginInfo</a>(<a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#71022daeee1769bc" class="i property">InstanceId</a>));
 
                <span class="c">// Add warning record to information channel.</span>
                <a href="#9ca5bdc78975506e" class="i method">HandleInformationalMessageReceived</a>(<a href="#b4d2ac017883b31c" class="k">this</a>,
                    <b>new</b> <a href="../common/misc.cs.html#79fd22f37cbd3e2d" class="t constructor">RemoteDataEventArgs</a>&lt;<a href="RemotingProtocol2.cs.html#e44e8a34c9f4b3f9" class="t t">InformationalMessage</a>&gt;(
                        <b>new</b> <a href="RemotingProtocol2.cs.html#ae90857a05f652f4" class="t constructor">InformationalMessage</a>(<span class="r64 r">remotingWarningRecord</span>, <a href="../common/WireDataFormat/EncodeAndDecode.cs.html#296cbb5be87abd08" class="t t">RemotingDataType</a>.<a href="../common/WireDataFormat/EncodeAndDecode.cs.html#df7036213bef9576" class="i field">PowerShellWarning</a>)));
 
                <span class="c">// Write warning to host.</span>
                <a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a> <span id="r65 rd" class="r65 r">writeWarning</span> = <b>new</b> <span class="t">RemoteHostCall</span>(
                    -100,
                    <a href="../host/RemoteHostMethodInfo.cs.html#de0cdb3501b9855e" class="t t">RemoteHostMethodId</a>.<a href="../host/RemoteHostMethodInfo.cs.html#da4028398de5167e" class="i field">WriteWarningLine</a>,
                    <b>new</b> <b>object</b>[] { <span class="r58 r">warningRecord</span>.<a href="../../hostifaces/InformationalRecord.cs.html#4b46c95702707b8a" class="i property">Message</a> });
 
                <b>try</b>
                {
                    <a href="#eeeab88688cb6609" class="i method">HandleHostCallReceived</a>(<a href="#b4d2ac017883b31c" class="k">this</a>,
                        <b>new</b> <a href="../common/misc.cs.html#79fd22f37cbd3e2d" class="t constructor">RemoteDataEventArgs</a>&lt;<a href="../common/WireDataFormat/RemoteHost.cs.html#8bf334b011b63f92" class="t t">RemoteHostCall</a>&gt;(<span class="r65 r">writeWarning</span>));
                }
                <b>catch</b> (<a href="../../../utils/MshNotImplementedException.cs.html#ddab2b46a60907f3" class="t t">PSNotImplementedException</a>)
                { }
            }
 
            <b>if</b> (<span class="r59 r">errorRecord</span> != <b>null</b>)
            {
                <a href="RemotingErrorRecord.cs.html#6c773c1aec04d13e" class="t t">RemotingErrorRecord</a> <span id="r66 rd" class="r66 r">remotingErrorRecord</span> = <b>new</b> <a href="RemotingErrorRecord.cs.html#8a136e54d763669f" class="t constructor">RemotingErrorRecord</a>(
                    <span class="r59 r">errorRecord</span>,
                    <b>new</b> <a href="RemotingErrorRecord.cs.html#7cf40752461163ee" class="t constructor">OriginInfo</a>(<a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#b05577e0278bfe8c" class="i field">computerName</a>, <a href="#b4d2ac017883b31c" class="k">this</a>.<a href="#71022daeee1769bc" class="i property">InstanceId</a>));
 
                <span class="c">// Add error record to error channel, will also be written to host.</span>
                <a href="#045f67e4f32e0161" class="i method">HandleErrorReceived</a>(<a href="#b4d2ac017883b31c" class="k">this</a>,
                    <b>new</b> <a href="../common/misc.cs.html#79fd22f37cbd3e2d" class="t constructor">RemoteDataEventArgs</a>&lt;<a href="../../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;(<span class="r66 r">remotingErrorRecord</span>));
            }
 
            <span class="c">// Raise event.</span>
            <a href="#ed43c52261b131fb" class="i">RCConnectionNotification</a>.<span class="i">SafeInvoke</span>(<a href="#b4d2ac017883b31c" class="k">this</a>, <span class="r57 r">connectionRetryStatusArgs</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Protected Members
 
        <b>protected</b> <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="83ffd50268a8e3a2" href="../../../R/83ffd50268a8e3a2.html" target="n" data-glyph="45,1" class="i field">inputstream</a>;
        <b>protected</b> <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="8e324b6d11865c16" href="../../../R/8e324b6d11865c16.html" target="n" data-glyph="45,1" class="i field">errorstream</a>;
        <b>protected</b> <a href="../../hostifaces/PSDataCollection.cs.html#b80567add938623b" class="t t">PSInformationalBuffers</a> <a id="75e49a341e8ac5b9" href="../../../R/75e49a341e8ac5b9.html" target="n" data-glyph="45,1" class="i field">informationalBuffers</a>;
        <b>protected</b> <a href="../../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <a id="533961734551583a" href="../../../R/533961734551583a.html" target="n" data-glyph="45,1" class="i field">shell</a>;
        <b>protected</b> <span class="i">Guid</span> <a id="abe8d6cf87accd0d" href="../../../R/abe8d6cf87accd0d.html" target="n" data-glyph="45,1" class="i field">clientRunspacePoolId</a>;
        <b>protected bool</b> <a id="5a98078460e94db3" href="../../../R/5a98078460e94db3.html" target="n" data-glyph="45,1" class="i field">noInput</a>;
        <b>protected</b> <a href="../../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <a id="857d997daa9e7bbb" href="../../../R/857d997daa9e7bbb.html" target="n" data-glyph="45,1" class="i field">settings</a>;
        <b>protected</b> <a href="../../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="7a8a981f52c18f4b" href="../../../R/7a8a981f52c18f4b.html" target="n" data-glyph="45,1" class="i field">outputstream</a>;
        <b>protected string</b> <a id="b05577e0278bfe8c" href="../../../R/b05577e0278bfe8c.html" target="n" data-glyph="45,1" class="i field">computerName</a>;
        <b>protected</b> <a href="RemotingProtocol2.cs.html#ef96db27814e82f4" class="t t">ClientPowerShellDataStructureHandler</a> <a id="d55dc992e0cb7f30" href="../../../R/d55dc992e0cb7f30.html" target="n" data-glyph="45,1" class="i field">dataStructureHandler</a>;
        <b>protected bool</b> <a id="d003ab5791b5d712" href="../../../R/d003ab5791b5d712.html" target="n" data-glyph="45,1" class="i field">stopCalled</a> = <b>false</b>;
        <b>protected</b> <a href="../../hostifaces/MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <a id="19c366f0f9eb14f4" href="../../../R/19c366f0f9eb14f4.html" target="n" data-glyph="45,1" class="i field">hostToUse</a>;
        <b>protected</b> <a href="RemoteRunspacePoolInternal.cs.html#1aba79be5da56f57" class="t t">RemoteRunspacePoolInternal</a> <a id="f62c92b12f5e45bc" href="../../../R/f62c92b12f5e45bc.html" target="n" data-glyph="45,1" class="i field">runspacePool</a>;
 
        <b>protected const string</b> <a id="39ed6ebcf938c550" href="../../../R/../../0000000000.html" target="n" data-glyph="9,1" class="i field">WRITE_DEBUG_LINE</a> = <span class="s">&quot;WriteDebugLine&quot;</span>;
        <b>protected const string</b> <a id="d77a5e3b85f5e0cc" href="../../../R/../../0000000000.html" target="n" data-glyph="9,1" class="i field">WRITE_VERBOSE_LINE</a> = <span class="s">&quot;WriteVerboseLine&quot;</span>;
        <b>protected const string</b> <a id="1bb2121b0d538246" href="../../../R/../../0000000000.html" target="n" data-glyph="9,1" class="i field">WRITE_WARNING_LINE</a> = <span class="s">&quot;WriteWarningLine&quot;</span>;
        <b>protected const string</b> <a id="80f85c571f9a035b" href="../../../R/../../0000000000.html" target="n" data-glyph="9,1" class="i field">WRITE_PROGRESS</a> = <span class="s">&quot;WriteProgress&quot;</span>;
 
        <b>protected bool</b> <a id="a6f61bb23a04b321" href="../../../R/a6f61bb23a04b321.html" target="n" data-glyph="45,1" class="i field">initialized</a> = <b>false</b>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This queue is for the state change events that resulted in closing the underlying</span>
        <span class="c">///</span><span class="c"> datastructure handler. We cannot send the state back to the upper layers until</span>
        <span class="c">///</span><span class="c"> close is completed from the datastructure/transport layer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i">Queue</span>&lt;<a href="../../hostifaces/PowerShell.cs.html#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt; <a id="af419c3445016461" href="../../../R/af419c3445016461.html" target="n" data-glyph="46,1" class="i field">_stateInfoQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="../../hostifaces/PowerShell.cs.html#42e325836d1ae967" class="t t">PSInvocationStateInfo</a>&gt;();
 
        <b>private</b> <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a> <a id="81a1bed1ce176875" href="../../../R/81a1bed1ce176875.html" target="n" data-glyph="46,1" class="i field">_connectionRetryStatus</a> = <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a>.<a href="#87b2c2caad361d9a" class="i field">None</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Protected Members
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Public interface for dispose.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="245a7ee35136c31b" href="../../../R/245a7ee35136c31b.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#a376e6d737df8e33" class="i method">Dispose</a>(<b>true</b>);
 
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#b4d2ac017883b31c" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Release all resources.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true, release all managed resources.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="a376e6d737df8e33" href="../../../R/a376e6d737df8e33.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r67 rd" class="r67 r">disposing</span>)
        {
            <b>if</b> (<span class="r67 r">disposing</span>)
            {
                <span class="c">// inputstream.Dispose();</span>
                <span class="c">// outputstream.Dispose();</span>
                <span class="c">// errorstream.Dispose();</span>
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> IDisposable
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> PSConnectionRetryStatusEventArgs
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Robust Connection notifications.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal enum</b> <a id="79de75994075e7b1" href="../../../R/79de75994075e7b1.html" target="n" data-glyph="20,0" class="t t"><span id="4badd0ae2f61c23a">PSConnectionRetryStatus</span></a>
    {
        <a id="87b2c2caad361d9a" href="../../../R/87b2c2caad361d9a.html" target="n" data-glyph="24,1" class="i field">None</a> = 0,
        <a id="fd62f226276704d4" href="../../../R/fd62f226276704d4.html" target="n" data-glyph="24,1" class="i field">NetworkFailureDetected</a> = 1,
        <a id="222c77174f33e437" href="../../../R/222c77174f33e437.html" target="n" data-glyph="24,1" class="i field">ConnectionRetryAttempt</a> = 2,
        <a id="b10ca9abe40057c8" href="../../../R/b10ca9abe40057c8.html" target="n" data-glyph="24,1" class="i field">ConnectionRetrySucceeded</a> = 3,
        <a id="f8cbf12c6086459b" href="../../../R/f8cbf12c6086459b.html" target="n" data-glyph="24,1" class="i field">AutoDisconnectStarting</a> = 4,
        <a id="0c117990dcafffe1" href="../../../R/0c117990dcafffe1.html" target="n" data-glyph="24,1" class="i field">AutoDisconnectSucceeded</a> = 5,
        <a id="66a1d5afeef67425" href="../../../R/66a1d5afeef67425.html" target="n" data-glyph="24,1" class="i field">InternalErrorAbort</a> = 6
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> PSConnectionRetryStatusEventArgs.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="e9fb8c6747e35270" href="../../../R/e9fb8c6747e35270.html" target="n" data-glyph="2,0" class="t t">PSConnectionRetryStatusEventArgs</a> : <span class="i">EventArgs</span>
    {
        <b>internal const string</b> <a id="d70446d0cc27d2b3" href="../../../R/d70446d0cc27d2b3.html" target="n" data-glyph="8,1" class="i field">FQIDNetworkFailureDetected</a> = <span class="s">&quot;PowerShellNetworkFailureDetected&quot;</span>;
        <b>internal const string</b> <a id="95a7f1c204cf5f6b" href="../../../R/95a7f1c204cf5f6b.html" target="n" data-glyph="8,1" class="i field">FQIDConnectionRetryAttempt</a> = <span class="s">&quot;PowerShellConnectionRetryAttempt&quot;</span>;
        <b>internal const string</b> <a id="0d62c9ae6770bc41" href="../../../R/0d62c9ae6770bc41.html" target="n" data-glyph="8,1" class="i field">FQIDConnectionRetrySucceeded</a> = <span class="s">&quot;PowerShellConnectionRetrySucceeded&quot;</span>;
        <b>internal const string</b> <a id="9d4c4fa7427b411d" href="../../../R/9d4c4fa7427b411d.html" target="n" data-glyph="8,1" class="i field">FQIDAutoDisconnectStarting</a> = <span class="s">&quot;PowerShellNetworkFailedStartDisconnect&quot;</span>;
        <b>internal const string</b> <a id="3b7f95b0e50b02f6" href="../../../R/3b7f95b0e50b02f6.html" target="n" data-glyph="8,1" class="i field">FQIDAutoDisconnectSucceeded</a> = <span class="s">&quot;PowerShellAutoDisconnectSucceeded&quot;</span>;
        <b>internal const string</b> <a id="05dbde5ad5cf9e57" href="../../../R/05dbde5ad5cf9e57.html" target="n" data-glyph="8,1" class="i field">FQIDNetworkOrDisconnectFailed</a> = <span class="s">&quot;PowerShellNetworkOrDisconnectFailed&quot;</span>;
 
        <b>internal</b> <a id="57a9b30d0a205ea9" href="../../../R/57a9b30d0a205ea9.html" target="n" data-glyph="74,1" class="t constructor">PSConnectionRetryStatusEventArgs</a>(
            <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a> <span id="r68 rd" class="r68 r">notification</span>,
            <b>string</b> <span id="r69 rd" class="r69 r">computerName</span>,
            <b>int</b> <span id="r70 rd" class="r70 r">maxRetryConnectionTime</span>,
            <b>object</b> <span id="r71 rd" class="r71 r">infoRecord</span>)
        {
            <a href="#3515a0c0c4bbe57e" class="i property">Notification</a> = <span class="r68 r">notification</span>;
            <a href="#b0f7c354841ab1c5" class="i property">ComputerName</a> = <span class="r69 r">computerName</span>;
            <a href="#aba922b0c875714c" class="i property">MaxRetryConnectionTime</a> = <span class="r70 r">maxRetryConnectionTime</span>;
            <a href="#11bbc97b0bf5f3a5" class="i property">InformationRecord</a> = <span class="r71 r">infoRecord</span>;
        }
 
        <b>internal</b> <a href="#79de75994075e7b1" class="t t">PSConnectionRetryStatus</a> <a id="3515a0c0c4bbe57e" href="../../../R/3515a0c0c4bbe57e.html" target="n" data-glyph="104,1" class="i property">Notification</a> { <b>get</b>; }
 
        <b>internal string</b> <a id="b0f7c354841ab1c5" href="../../../R/b0f7c354841ab1c5.html" target="n" data-glyph="104,1" class="i property">ComputerName</a> { <b>get</b>; }
 
        <b>internal int</b> <a id="aba922b0c875714c" href="../../../R/aba922b0c875714c.html" target="n" data-glyph="104,1" class="i property">MaxRetryConnectionTime</a> { <b>get</b>; }
 
        <b>internal object</b> <a id="11bbc97b0bf5f3a5" href="../../../R/11bbc97b0bf5f3a5.html" target="n" data-glyph="104,1" class="i property">InformationRecord</a> { <b>get</b>; }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
}
</pre></td></tr></table></div></body></html>
