<!DOCTYPE html>
<html><head><title>InitialSessionStateProvider.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(2894);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/fanin/InitialSessionStateProvider.cs" target="_top">engine\remoting\fanin\InitialSessionStateProvider.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Tracing</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This struct is used to represent contents from configuration xml. The</span>
    <span class="c">///</span><span class="c"> XML is passed to plugins by WSMan API.</span>
    <span class="c">///</span><span class="c"> This helper does not validate XML content as it is already validated</span>
    <span class="c">///</span><span class="c"> by WSMan.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="88c11924f622f7f5" href="../../../R/88c11924f622f7f5.html" target="n" data-glyph="2,0" class="t t"><span id="a4dc2b81e4efcf50">ConfigurationDataFromXML</span></a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Config XML Constants
 
        <b>internal const string</b> <a id="77682a2f82e13908" href="../../../R/77682a2f82e13908.html" target="n" data-glyph="8,1" class="i field">INITPARAMETERSTOKEN</a> = <span class="s">&quot;InitializationParameters&quot;</span>;
        <b>internal const string</b> <a id="f429cf11d694f422" href="../../../R/f429cf11d694f422.html" target="n" data-glyph="8,1" class="i field">PARAMTOKEN</a> = <span class="s">&quot;Param&quot;</span>;
        <b>internal const string</b> <a id="2236435a76e574cc" href="../../../R/2236435a76e574cc.html" target="n" data-glyph="8,1" class="i field">NAMETOKEN</a> = <span class="s">&quot;Name&quot;</span>;
        <b>internal const string</b> <a id="8eca682927b252ee" href="../../../R/8eca682927b252ee.html" target="n" data-glyph="8,1" class="i field">VALUETOKEN</a> = <span class="s">&quot;Value&quot;</span>;
        <b>internal const string</b> <a id="c6bdad55d5b9cfe9" href="../../../R/c6bdad55d5b9cfe9.html" target="n" data-glyph="8,1" class="i field">APPBASETOKEN</a> = <span class="s">&quot;applicationbase&quot;</span>;
        <b>internal const string</b> <a id="a760798ff3d1d31c" href="../../../R/a760798ff3d1d31c.html" target="n" data-glyph="8,1" class="i field">ASSEMBLYTOKEN</a> = <span class="s">&quot;assemblyname&quot;</span>;
        <b>internal const string</b> <a id="5b4979d69407d7e3" href="../../../R/5b4979d69407d7e3.html" target="n" data-glyph="8,1" class="i field">SHELLCONFIGTYPETOKEN</a> = <span class="s">&quot;pssessionconfigurationtypename&quot;</span>;
        <b>internal const string</b> <a id="a5044dd5ccc8fb43" href="../../../R/a5044dd5ccc8fb43.html" target="n" data-glyph="8,1" class="i field">STARTUPSCRIPTTOKEN</a> = <span class="s">&quot;startupscript&quot;</span>;
        <b>internal const string</b> <a id="10b5800d17b0f40c" href="../../../R/10b5800d17b0f40c.html" target="n" data-glyph="8,1" class="i field">MAXRCVDOBJSIZETOKEN</a> = <span class="s">&quot;psmaximumreceivedobjectsizemb&quot;</span>;
        <b>internal const string</b> <a id="c178a6c8ed3a39ae" href="../../../R/c178a6c8ed3a39ae.html" target="n" data-glyph="8,1" class="i field">MAXRCVDOBJSIZETOKEN_CamelCase</a> = <span class="s">&quot;PSMaximumReceivedObjectSizeMB&quot;</span>;
        <b>internal const string</b> <a id="1f07f200d8e7326a" href="../../../R/1f07f200d8e7326a.html" target="n" data-glyph="8,1" class="i field">MAXRCVDCMDSIZETOKEN</a> = <span class="s">&quot;psmaximumreceiveddatasizepercommandmb&quot;</span>;
        <b>internal const string</b> <a id="032fee811b4f0028" href="../../../R/032fee811b4f0028.html" target="n" data-glyph="8,1" class="i field">MAXRCVDCMDSIZETOKEN_CamelCase</a> = <span class="s">&quot;PSMaximumReceivedDataSizePerCommandMB&quot;</span>;
        <b>internal const string</b> <a id="cd5d7a116ed4a287" href="../../../R/cd5d7a116ed4a287.html" target="n" data-glyph="8,1" class="i field">THREADOPTIONSTOKEN</a> = <span class="s">&quot;pssessionthreadoptions&quot;</span>;
        <b>internal const string</b> <a id="49974ff8bb3d2d73" href="../../../R/49974ff8bb3d2d73.html" target="n" data-glyph="8,1" class="i field">THREADAPTSTATETOKEN</a> = <span class="s">&quot;pssessionthreadapartmentstate&quot;</span>;
        <b>internal const string</b> <a id="9e1f1c9b78ebd9a5" href="../../../R/9e1f1c9b78ebd9a5.html" target="n" data-glyph="8,1" class="i field">SESSIONCONFIGTOKEN</a> = <span class="s">&quot;sessionconfigurationdata&quot;</span>;
        <b>internal const string</b> <a id="cfdd5431fae23a53" href="../../../R/cfdd5431fae23a53.html" target="n" data-glyph="8,1" class="i field">PSVERSIONTOKEN</a> = <span class="s">&quot;PSVersion&quot;</span>;
        <b>internal const string</b> <a id="875775f1b987cd71" href="../../../R/875775f1b987cd71.html" target="n" data-glyph="8,1" class="i field">MAXPSVERSIONTOKEN</a> = <span class="s">&quot;MaxPSVersion&quot;</span>;
        <b>internal const string</b> <a id="81d1ce9067cf254b" href="../../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">MODULESTOIMPORT</a> = <span class="s">&quot;ModulesToImport&quot;</span>;
        <b>internal const string</b> <a id="5fc968614585148b" href="../../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">HOSTMODE</a> = <span class="s">&quot;hostmode&quot;</span>;
        <b>internal const string</b> <a id="237cb96005b14339" href="../../../R/237cb96005b14339.html" target="n" data-glyph="8,1" class="i field">CONFIGFILEPATH</a> = <span class="s">&quot;configfilepath&quot;</span>;
        <b>internal const string</b> <a id="b483de7d25f4258e" href="../../../R/b483de7d25f4258e.html" target="n" data-glyph="8,1" class="i field">CONFIGFILEPATH_CamelCase</a> = <span class="s">&quot;ConfigFilePath&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>internal string</b> <a id="a7bf3717cdc232b3" href="../../../R/a7bf3717cdc232b3.html" target="n" data-glyph="44,1" class="i field">StartupScript</a>;
        <span class="c">// this field is used only by an Out-Of-Process (IPC) server process</span>
        <b>internal string</b> <a id="7e90765aaa5c5332" href="../../../R/7e90765aaa5c5332.html" target="n" data-glyph="44,1" class="i field">InitializationScriptForOutOfProcessRunspace</a>;
        <b>internal string</b> <a id="38a4c6d74b2444d4" href="../../../R/38a4c6d74b2444d4.html" target="n" data-glyph="44,1" class="i field">ApplicationBase</a>;
        <b>internal string</b> <a id="2aa41dd088511f7f" href="../../../R/2aa41dd088511f7f.html" target="n" data-glyph="44,1" class="i field">AssemblyName</a>;
        <b>internal string</b> <a id="c372c2bc98d44c13" href="../../../R/c372c2bc98d44c13.html" target="n" data-glyph="44,1" class="i field">EndPointConfigurationTypeName</a>;
        <b>internal</b> <span class="i">Type</span> <a id="19335698991d239d" href="../../../R/19335698991d239d.html" target="n" data-glyph="44,1" class="i field">EndPointConfigurationType</a>;
        <b>internal int</b>? <a id="74fc90d6066465d0" href="../../../R/74fc90d6066465d0.html" target="n" data-glyph="44,1" class="i field">MaxReceivedObjectSizeMB</a>;
        <b>internal int</b>? <a id="2265619ef294f59e" href="../../../R/2265619ef294f59e.html" target="n" data-glyph="44,1" class="i field">MaxReceivedCommandSizeMB</a>;
        <span class="c">// Used to set properties on the RunspacePool created for this shell.</span>
        <b>internal</b> <a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>? <a id="b0375b4c4385e974" href="../../../R/b0375b4c4385e974.html" target="n" data-glyph="44,1" class="i field">ShellThreadOptions</a>;
        <b>internal</b> <span class="i">ApartmentState</span>? <a id="c3ef9251121d712c" href="../../../R/c3ef9251121d712c.html" target="n" data-glyph="44,1" class="i field">ShellThreadApartmentState</a>;
        <b>internal</b> <a href="PSSessionConfigurationData.cs.html#a9929ed8e7a283e6" class="t t">PSSessionConfigurationData</a> <a id="3a0e4593360e8467" href="../../../R/3a0e4593360e8467.html" target="n" data-glyph="44,1" class="i field">SessionConfigurationData</a>;
        <b>internal string</b> <a id="b8bc67c861410599" href="../../../R/b8bc67c861410599.html" target="n" data-glyph="44,1" class="i field">ConfigFilePath</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Using optionName and optionValue updates the current object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">optionName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">optionValue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. &quot;optionName&quot; is not valid in &quot;InitializationParameters&quot; section.</span>
        <span class="c">///</span><span class="c"> 2. &quot;startupscript&quot; must specify a PowerShell script file that ends with extension &quot;.ps1&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="be81cad69ce46816" href="../../../R/be81cad69ce46816.html" target="n" data-glyph="76,1" class="i method">Update</a>(<b>string</b> <span id="r0 rd" class="r0 r">optionName</span>, <b>string</b> <span id="r1 rd" class="r1 r">optionValue</span>)
        {
            <b>switch</b> (<span class="r0 r">optionName</span>.<span class="i">ToLowerInvariant</span>())
            {
                <b>case</b> <a href="#c6bdad55d5b9cfe9" class="i field">APPBASETOKEN</a>:
                    <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#c6bdad55d5b9cfe9" class="i field">APPBASETOKEN</a>, <a href="#38a4c6d74b2444d4" class="i field">ApplicationBase</a>);
                    <span class="c">// this is a folder pointing to application base of the plugin shell</span>
                    <span class="c">// allow the folder path to use environment variables.</span>
                    <a href="#38a4c6d74b2444d4" class="i field">ApplicationBase</a> = <span class="i">Environment</span>.<span class="i">ExpandEnvironmentVariables</span>(<span class="r1 r">optionValue</span>);
                    <b>break</b>;
                <b>case</b> <a href="#a760798ff3d1d31c" class="i field">ASSEMBLYTOKEN</a>:
                    <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#a760798ff3d1d31c" class="i field">ASSEMBLYTOKEN</a>, <a href="#2aa41dd088511f7f" class="i field">AssemblyName</a>);
                    <a href="#2aa41dd088511f7f" class="i field">AssemblyName</a> = <span class="r1 r">optionValue</span>;
                    <b>break</b>;
                <b>case</b> <a href="#5b4979d69407d7e3" class="i field">SHELLCONFIGTYPETOKEN</a>:
                    <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#5b4979d69407d7e3" class="i field">SHELLCONFIGTYPETOKEN</a>, <a href="#c372c2bc98d44c13" class="i field">EndPointConfigurationTypeName</a>);
                    <a href="#c372c2bc98d44c13" class="i field">EndPointConfigurationTypeName</a> = <span class="r1 r">optionValue</span>;
                    <b>break</b>;
                <b>case</b> <a href="#a5044dd5ccc8fb43" class="i field">STARTUPSCRIPTTOKEN</a>:
                    <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#a5044dd5ccc8fb43" class="i field">STARTUPSCRIPTTOKEN</a>, <a href="#a7bf3717cdc232b3" class="i field">StartupScript</a>);
                    <b>if</b> (!<span class="r1 r">optionValue</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.ps1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<a href="#a5044dd5ccc8fb43" class="i field">STARTUPSCRIPTTOKEN</a>,
                            <span class="i">RemotingErrorIdStrings</span>.<span class="i">StartupScriptNotCorrect</span>,
                            <a href="#a5044dd5ccc8fb43" class="i field">STARTUPSCRIPTTOKEN</a>);
                    }
                    <span class="c">// allow the script file to exist in any path..and support</span>
                    <span class="c">// environment variable expansion.</span>
                    <a href="#a7bf3717cdc232b3" class="i field">StartupScript</a> = <span class="i">Environment</span>.<span class="i">ExpandEnvironmentVariables</span>(<span class="r1 r">optionValue</span>);
                    <b>break</b>;
                <b>case</b> <a href="#10b5800d17b0f40c" class="i field">MAXRCVDOBJSIZETOKEN</a>:
                    <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#10b5800d17b0f40c" class="i field">MAXRCVDOBJSIZETOKEN</a>, <a href="#74fc90d6066465d0" class="i field">MaxReceivedObjectSizeMB</a>);
                    <a href="#74fc90d6066465d0" class="i field">MaxReceivedObjectSizeMB</a> = <a href="#0ddea459faae2609" class="i method">GetIntValueInBytes</a>(<span class="r1 r">optionValue</span>);
                    <b>break</b>;
                <b>case</b> <a href="#1f07f200d8e7326a" class="i field">MAXRCVDCMDSIZETOKEN</a>:
                    <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#1f07f200d8e7326a" class="i field">MAXRCVDCMDSIZETOKEN</a>, <a href="#2265619ef294f59e" class="i field">MaxReceivedCommandSizeMB</a>);
                    <a href="#2265619ef294f59e" class="i field">MaxReceivedCommandSizeMB</a> = <a href="#0ddea459faae2609" class="i method">GetIntValueInBytes</a>(<span class="r1 r">optionValue</span>);
                    <b>break</b>;
                <b>case</b> <a href="#cd5d7a116ed4a287" class="i field">THREADOPTIONSTOKEN</a>:
                    <span class="i">AssertValueNotAssigned</span>(<a href="#cd5d7a116ed4a287" class="i field">THREADOPTIONSTOKEN</a>, <a href="#b0375b4c4385e974" class="i field">ShellThreadOptions</a>);
                    <a href="#b0375b4c4385e974" class="i field">ShellThreadOptions</a> = (<a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>)<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                        <span class="r1 r">optionValue</span>, <b>typeof</b>(<a href="../../hostifaces/Connection.cs.html#e3e452d2492397a5" class="t t">PSThreadOptions</a>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                    <b>break</b>;
                <b>case</b> <a href="#49974ff8bb3d2d73" class="i field">THREADAPTSTATETOKEN</a>:
                    <span class="i">AssertValueNotAssigned</span>(<a href="#49974ff8bb3d2d73" class="i field">THREADAPTSTATETOKEN</a>, <a href="#c3ef9251121d712c" class="i field">ShellThreadApartmentState</a>);
                    <a href="#c3ef9251121d712c" class="i field">ShellThreadApartmentState</a> = (<span class="i">ApartmentState</span>)<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                        <span class="r1 r">optionValue</span>, <b>typeof</b>(<span class="i">ApartmentState</span>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                    <b>break</b>;
                <b>case</b> <a href="#9e1f1c9b78ebd9a5" class="i field">SESSIONCONFIGTOKEN</a>:
                    {
                        <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#9e1f1c9b78ebd9a5" class="i field">SESSIONCONFIGTOKEN</a>, <a href="#3a0e4593360e8467" class="i field">SessionConfigurationData</a>);
                        <a href="#3a0e4593360e8467" class="i field">SessionConfigurationData</a> = <a href="PSSessionConfigurationData.cs.html#a9929ed8e7a283e6" class="t t">PSSessionConfigurationData</a>.<a href="PSSessionConfigurationData.cs.html#63a9a4b75b86cbb1" class="i method">Create</a>(<span class="r1 r">optionValue</span>);
                    }
 
                    <b>break</b>;
                <b>case</b> <a href="#237cb96005b14339" class="i field">CONFIGFILEPATH</a>:
                    {
                        <a href="#a2126fe11cd6116f" class="i method">AssertValueNotAssigned</a>(<a href="#237cb96005b14339" class="i field">CONFIGFILEPATH</a>, <a href="#b8bc67c861410599" class="i field">ConfigFilePath</a>);
                        <a href="#b8bc67c861410599" class="i field">ConfigFilePath</a> = <span class="r1 r">optionValue</span>;
                    }
 
                    <b>break</b>;
                <b>default</b>:
                    <span class="c">// we dont need to evaluate PSVersion and other custom authz</span>
                    <span class="c">// related tokens</span>
                    <b>break</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the originalValue is empty. If not throws an exception.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">optionName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">originalValue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. &quot;optionName&quot; is already defined</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="a2126fe11cd6116f" href="../../../R/a2126fe11cd6116f.html" target="n" data-glyph="76,1" class="i method">AssertValueNotAssigned</a>(<b>string</b> <span id="r2 rd" class="r2 r">optionName</span>, <b>object</b> <span id="r3 rd" class="r3 r">originalValue</span>)
        {
            <b>if</b> (<span class="r3 r">originalValue</span> != <b>null</b>)
            {
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<span class="r2 r">optionName</span>,
                    <span class="i">RemotingErrorIdStrings</span>.<span class="i">DuplicateInitializationParameterFound</span>, <span class="r2 r">optionName</span>, <a href="#77682a2f82e13908" class="i field">INITPARAMETERSTOKEN</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts the value specified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">optionValue</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to int.</span>
        <span class="c">///</span><span class="c"> Multiplies the value by 1MB (1024*1024) to get the number in bytes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">optionValueInMB</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If value is specified, specified value as int . otherwise null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static int</b>? <a id="0ddea459faae2609" href="../../../R/0ddea459faae2609.html" target="n" data-glyph="76,1" class="i method">GetIntValueInBytes</a>(<b>string</b> <span id="r4 rd" class="r4 r">optionValueInMB</span>)
        {
            <b>int</b>? <span id="r5 rd" class="r5 r">result</span> = <b>null</b>;
            <b>try</b>
            {
                <b>double</b> <span id="r6 rd" class="r6 r">variableValue</span> = (<b>double</b>)<a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r4 r">optionValueInMB</span>,
                    <b>typeof</b>(<b>double</b>), <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
 
                <span class="r5 r">result</span> = <b>unchecked</b>((<b>int</b>)(<span class="r6 r">variableValue</span> * 1024 * 1024)); <span class="c">// Multiply by 1MB</span>
            }
            <b>catch</b> (<span class="i">InvalidCastException</span>)
            {
            }
 
            <b>if</b> (<span class="r5 r">result</span> &lt; 0)
            {
                <span class="r5 r">result</span> = <b>null</b>;
            }
 
            <b>return</b> <span class="r5 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates the struct from initialization parameters xml.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">initializationParameters</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialization Parameters xml passed by WSMan API. This data is read from the config</span>
        <span class="c">///</span><span class="c"> xml and is in the following format:</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. &quot;optionName&quot; is already defined</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">/*
                  &lt;InitializationParameters&gt;
                    &lt;Param Name=&quot;PSVersion&quot; Value=&quot;2.0&quot; /&gt;
                    &lt;Param Name=&quot;ApplicationBase&quot; Value=&quot;&lt;folder path&gt;&quot; /&gt;
                    ...
                  &lt;/InitializationParameters&gt;
        */</span>
        <span class="c">/* The following extensions have been added in V3 providing the user
         * the ability to pass data to the session configuration for initialization
         *
                &lt;Param Name=&quot;SessionConfigurationData&quot; Value=&quot;&lt;SessionConfigurationData with XML escaping&gt;&quot; /&gt;
         *
         * The session configuration data blob can be defined as under
                    &lt;SessionConfigurationData&gt;
                        &lt;Param Name=&quot;ModulesToImport&quot; Value=&quot;&lt;folder path&gt;&quot; /&gt;
                        &lt;Param Name=&quot;PrivateData&quot; /&gt;
                            &lt;PrivateData&gt;
                            ...
                            &lt;/PrivateData&gt;
                        &lt;/Param&gt;
                    &lt;/SessionConfigurationData&gt;
         */</span>
        <b>internal static</b> <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a> <a id="bf9b9ec03942cff8" href="../../../R/bf9b9ec03942cff8.html" target="n" data-glyph="74,1" class="i method">Create</a>(<b>string</b> <span id="r7 rd" class="r7 r">initializationParameters</span>)
        {
            <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a> <span id="r8 rd" class="r8 r">result</span> = <b>new</b> <span class="t">ConfigurationDataFromXML</span>();
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r7 r">initializationParameters</span>))
            {
                <b>return</b> <span class="r8 r">result</span>;
            }
 
            <span class="i">XmlReaderSettings</span> <span id="r9 rd" class="r9 r">readerSettings</span> = <b>new</b> <span class="i">XmlReaderSettings</span>();
            <span class="r9 r">readerSettings</span>.<span class="i">CheckCharacters</span> = <b>false</b>;
            <span class="r9 r">readerSettings</span>.<span class="i">IgnoreComments</span> = <b>true</b>;
            <span class="r9 r">readerSettings</span>.<span class="i">IgnoreProcessingInstructions</span> = <b>true</b>;
            <span class="r9 r">readerSettings</span>.<span class="i">MaxCharactersInDocument</span> = 10000;
            <span class="r9 r">readerSettings</span>.<span class="i">ConformanceLevel</span> = <span class="i">ConformanceLevel</span>.<span class="i">Fragment</span>;
 
            <b>using</b> (<span class="i">XmlReader</span> <span id="r10 rd" class="r10 r">reader</span> = <span class="i">XmlReader</span>.<span class="i">Create</span>(<b>new</b> <span class="i">StringReader</span>(<span class="r7 r">initializationParameters</span>), <span class="r9 r">readerSettings</span>))
            {
                <span class="c">// read the header &lt;InitializationParameters&gt;</span>
                <b>if</b> (<span class="r10 r">reader</span>.<span class="i">ReadToFollowing</span>(<a href="#77682a2f82e13908" class="i field">INITPARAMETERSTOKEN</a>))
                {
                    <b>bool</b> <span id="r11 rd" class="r11 r">isParamFound</span> = <span class="r10 r">reader</span>.<span class="i">ReadToDescendant</span>(<a href="#f429cf11d694f422" class="i field">PARAMTOKEN</a>);
                    <b>while</b> (<span class="r11 r">isParamFound</span>)
                    {
                        <b>if</b> (!<span class="r10 r">reader</span>.<span class="i">MoveToAttribute</span>(<a href="#2236435a76e574cc" class="i field">NAMETOKEN</a>))
                        {
                            <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<span class="r7 r">initializationParameters</span>,
                                <span class="i">RemotingErrorIdStrings</span>.<span class="i">NoAttributesFoundForParamElement</span>,
                                <a href="#2236435a76e574cc" class="i field">NAMETOKEN</a>, <a href="#8eca682927b252ee" class="i field">VALUETOKEN</a>, <a href="#f429cf11d694f422" class="i field">PARAMTOKEN</a>);
                        }
 
                        <b>string</b> <span id="r12 rd" class="r12 r">optionName</span> = <span class="r10 r">reader</span>.<span class="i">Value</span>;
 
                        <b>if</b> (!<span class="r10 r">reader</span>.<span class="i">MoveToAttribute</span>(<a href="#8eca682927b252ee" class="i field">VALUETOKEN</a>))
                        {
                            <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<span class="r7 r">initializationParameters</span>,
                                                                        <span class="i">RemotingErrorIdStrings</span>.<span class="i">NoAttributesFoundForParamElement</span>,
                                                                        <a href="#2236435a76e574cc" class="i field">NAMETOKEN</a>, <a href="#8eca682927b252ee" class="i field">VALUETOKEN</a>, <a href="#f429cf11d694f422" class="i field">PARAMTOKEN</a>);
                        }
 
                        <b>string</b> <span id="r13 rd" class="r13 r">optionValue</span> = <span class="r10 r">reader</span>.<span class="i">Value</span>;
                        <span class="r8 r">result</span>.<a href="#be81cad69ce46816" class="i method">Update</a>(<span class="r12 r">optionName</span>, <span class="r13 r">optionValue</span>);
 
                        <span class="c">// move to next Param token.</span>
                        <span class="r11 r">isParamFound</span> = <span class="r10 r">reader</span>.<span class="i">ReadToFollowing</span>(<a href="#f429cf11d694f422" class="i field">PARAMTOKEN</a>);
                    }
                }
            }
 
            <span class="c">// assign defaults after parsing the xml content.</span>
            <b>if</b> (<span class="r8 r">result</span>.<a href="#74fc90d6066465d0" class="i field">MaxReceivedObjectSizeMB</a> == <b>null</b>)
            {
                <span class="r8 r">result</span>.<a href="#74fc90d6066465d0" class="i field">MaxReceivedObjectSizeMB</a> = <a href="BaseTransportManager.cs.html#9ccd7ea4a824f9d8" class="t t">BaseTransportManager</a>.<a href="BaseTransportManager.cs.html#f93a293eb909c256" class="i field">MaximumReceivedObjectSize</a>;
            }
 
            <b>if</b> (<span class="r8 r">result</span>.<a href="#2265619ef294f59e" class="i field">MaxReceivedCommandSizeMB</a> == <b>null</b>)
            {
                <span class="r8 r">result</span>.<a href="#2265619ef294f59e" class="i field">MaxReceivedCommandSizeMB</a> = <a href="BaseTransportManager.cs.html#9ccd7ea4a824f9d8" class="t t">BaseTransportManager</a>.<a href="BaseTransportManager.cs.html#7298ea980465451c" class="i field">MaximumReceivedDataSize</a>;
            }
 
            <b>return</b> <span class="r8 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. Unable to load type &quot;{0}&quot; specified in &quot;InitializationParameters&quot; section.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal</b> <a href="#e35ba0e017aa5d6d" class="t t">PSSessionConfiguration</a> <a id="a7514971aab3101e" href="../../../R/a7514971aab3101e.html" target="n" data-glyph="74,1" class="i method">CreateEndPointConfigurationInstance</a>()
        {
            <b>try</b>
            {
                <b>return</b> (<a href="#e35ba0e017aa5d6d" class="t t">PSSessionConfiguration</a>)<span class="i">Activator</span>.<span class="i">CreateInstance</span>(<a href="#19335698991d239d" class="i field">EndPointConfigurationType</a>);
            }
            <b>catch</b> (<span class="i">TypeLoadException</span>)
            {
            }
            <b>catch</b> (<span class="i">ArgumentException</span>)
            {
            }
            <b>catch</b> (<span class="i">MissingMethodException</span>)
            {
            }
            <b>catch</b> (<span class="i">InvalidCastException</span>)
            {
            }
            <b>catch</b> (<span class="i">TargetInvocationException</span>)
            {
            }
 
            <span class="c">// if we are here, that means we are unable to load the type specified</span>
            <span class="c">// in the config xml.. notify the same.</span>
            <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<span class="s">&quot;typeToLoad&quot;</span>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">UnableToLoadType</span>,
                    <a href="#c372c2bc98d44c13" class="i field">EndPointConfigurationTypeName</a>, <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#77682a2f82e13908" class="i field">INITPARAMETERSTOKEN</a>);
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> InitialSessionStateProvider is used by 3rd parties to provide shell configuration</span>
    <span class="c">///</span><span class="c"> on the remote server.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public abstract class</b> <a id="e35ba0e017aa5d6d" href="../../../R/e35ba0e017aa5d6d.html" target="n" data-glyph="0,0" class="t t"><span id="4c4fb148eb386f05">PSSessionConfiguration</span></a> : <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> tracer
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Tracer for Server Remote session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">TraceSourceAttribute</span>(<span class="s">&quot;ServerRemoteSession&quot;</span>, <span class="s">&quot;ServerRemoteSession&quot;</span>)]
        <b>private static readonly</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="1425f710acc4a96a" href="../../../R/1425f710acc4a96a.html" target="n" data-glyph="46,1" class="i field">s_tracer</a> = <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;ServerRemoteSession&quot;</span>, <span class="s">&quot;ServerRemoteSession&quot;</span>);
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> tracer
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> public interfaces
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Derived classes must override this to supply an InitialSessionState</span>
        <span class="c">///</span><span class="c"> to be used to construct a Runspace for the user.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">senderInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> User Identity for which this information is requested</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public abstract</b> <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <a id="4de9a02b9d072544" href="../../../R/4de9a02b9d072544.html" target="n" data-glyph="72,1" class="i method">GetInitialSessionState</a>(<a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r14 rd" class="r14 r">senderInfo</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">sessionConfigurationData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">senderInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">configProviderId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <a id="b5a64b1eebc0b23e" href="../../../R/b5a64b1eebc0b23e.html" target="n" data-glyph="72,1" class="i method">GetInitialSessionState</a>(<a href="PSSessionConfigurationData.cs.html#a9929ed8e7a283e6" class="t t">PSSessionConfigurationData</a> <span id="r15 rd" class="r15 r">sessionConfigurationData</span>,
            <a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r16 rd" class="r16 r">senderInfo</span>, <b>string</b> <span id="r17 rd" class="r17 r">configProviderId</span>)
        {
            <b>throw</b> <b>new</b> <span class="i">NotImplementedException</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Maximum size (in bytes) of a deserialized object received from a remote machine.</span>
        <span class="c">///</span><span class="c"> If null, then the size is unlimited. Default is 10MB.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">senderInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> User Identity for which this information is requested</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual int</b>? <a id="4aef21ff44693f82" href="../../../R/4aef21ff44693f82.html" target="n" data-glyph="72,1" class="i method">GetMaximumReceivedObjectSize</a>(<a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r18 rd" class="r18 r">senderInfo</span>)
        {
            <b>return</b> <a href="BaseTransportManager.cs.html#9ccd7ea4a824f9d8" class="t t">BaseTransportManager</a>.<a href="BaseTransportManager.cs.html#f93a293eb909c256" class="i field">MaximumReceivedObjectSize</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Total data (in bytes) that can be received from a remote machine</span>
        <span class="c">///</span><span class="c"> targeted towards a command. If null, then the size is unlimited.</span>
        <span class="c">///</span><span class="c"> Default is 50MB.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">senderInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> User Identity for which this information is requested</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual int</b>? <a id="c6b8fcbae271bd50" href="../../../R/c6b8fcbae271bd50.html" target="n" data-glyph="72,1" class="i method">GetMaximumReceivedDataSizePerCommand</a>(<a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r19 rd" class="r19 r">senderInfo</span>)
        {
            <b>return</b> <a href="BaseTransportManager.cs.html#9ccd7ea4a824f9d8" class="t t">BaseTransportManager</a>.<a href="BaseTransportManager.cs.html#7298ea980465451c" class="i field">MaximumReceivedDataSize</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Derived classes can override this method to provide application private data</span>
        <span class="c">///</span><span class="c"> that is going to be sent to the client and exposed via</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="../client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a>.<a href="../client/remoterunspaceinfo.cs.html#fafd1c05537097a7" class="i property">ApplicationPrivateData</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#0d77ad561d46f843" class="i method">GetApplicationPrivateData</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>.<a href="../../hostifaces/RunspacePool.cs.html#c1948c2f22e6b527" class="t t">RunspacePool</a>.<a href="../../hostifaces/RunspacePool.cs.html#9e2816b4c51f890c" class="i method">GetApplicationPrivateData</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">senderInfo</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> User Identity for which this information is requested</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Application private data or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">null</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="../../serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a> <a id="d1de4b4ff469b321" href="../../../R/d1de4b4ff469b321.html" target="n" data-glyph="72,1" class="i method">GetApplicationPrivateData</a>(<a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r20 rd" class="r20 r">senderInfo</span>)
        {
            <b>return</b> <b>null</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dispose this configuration object. This will be called when a Runspace/RunspacePool</span>
        <span class="c">///</span><span class="c"> created using InitialSessionState from this object is Closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="9611ceb3ed93d125" href="../../../R/9611ceb3ed93d125.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#002571eaf29f87cc" class="i method">Dispose</a>(<b>true</b>);
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#e35ba0e017aa5d6d" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">isDisposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="002571eaf29f87cc" href="../../../R/002571eaf29f87cc.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r21 rd" class="r21 r">isDisposing</span>)
        {
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> GetInitialSessionState from 3rd party shell ids
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">shellId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">initializationParameters</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialization Parameters xml passed by WSMan API. This data is read from the config</span>
        <span class="c">///</span><span class="c"> xml and is in the following format:</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. Non existent InitialSessionState provider for the shellID</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">/*
                  &lt;InitializationParameters&gt;
                    &lt;Param Name=&quot;PSVersion&quot; Value=&quot;2.0&quot; /&gt;
                    &lt;Param Name=&quot;ApplicationBase&quot; Value=&quot;&lt;folder path&gt;&quot; /&gt;
                    ...
                  &lt;/InitializationParameters&gt;
         */</span>
        <b>internal static</b> <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a> <a id="7896c81980caddc5" href="../../../R/7896c81980caddc5.html" target="n" data-glyph="74,1" class="i method">LoadEndPointConfiguration</a>(<b>string</b> <span id="r22 rd" class="r22 r">shellId</span>,
            <b>string</b> <span id="r23 rd" class="r23 r">initializationParameters</span>)
        {
            <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a> <span id="r24 rd" class="r24 r">configData</span> = <b>null</b>;
 
            <b>if</b> (!<a href="#ab7bd3ab45b6dd64" class="i field">s_ssnStateProviders</a>.<span class="i">ContainsKey</span>(<span class="r23 r">initializationParameters</span>))
            {
                <a href="#94e39a5676624c76" class="i method">LoadRSConfigProvider</a>(<span class="r22 r">shellId</span>, <span class="r23 r">initializationParameters</span>);
            }
 
            <b>lock</b> (<a href="#947d8e3a6cb45a56" class="i field">s_syncObject</a>)
            {
                <b>if</b> (!<a href="#ab7bd3ab45b6dd64" class="i field">s_ssnStateProviders</a>.<span class="i">TryGetValue</span>(<span class="r23 r">initializationParameters</span>, <b>out</b> <span class="r24 r">configData</span>))
                {
                    <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">NonExistentInitialSessionStateProvider</span>, <span class="r22 r">shellId</span>);
                }
            }
 
            <b>return</b> <span class="r24 r">configData</span>;
        }
 
        <b>private static void</b> <a id="94e39a5676624c76" href="../../../R/94e39a5676624c76.html" target="n" data-glyph="76,1" class="i method">LoadRSConfigProvider</a>(<b>string</b> <span id="r25 rd" class="r25 r">shellId</span>, <b>string</b> <span id="r26 rd" class="r26 r">initializationParameters</span>)
        {
            <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a> <span id="r27 rd" class="r27 r">configData</span> = <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#bf9b9ec03942cff8" class="i method">Create</a>(<span class="r26 r">initializationParameters</span>);
 
            <span class="i">Type</span> <span id="r28 rd" class="r28 r">endPointConfigType</span> = <a href="#2e8e690dd92d0382" class="i method">LoadAndAnalyzeAssembly</a>(<span class="r25 r">shellId</span>,
                <span class="r27 r">configData</span>.<a href="#38a4c6d74b2444d4" class="i field">ApplicationBase</a>,
                <span class="r27 r">configData</span>.<a href="#2aa41dd088511f7f" class="i field">AssemblyName</a>,
                <span class="r27 r">configData</span>.<a href="#c372c2bc98d44c13" class="i field">EndPointConfigurationTypeName</a>);
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r28 r">endPointConfigType</span> != <b>null</b>, <span class="s">&quot;EndPointConfiguration type cannot be null&quot;</span>);
            <span class="r27 r">configData</span>.<a href="#19335698991d239d" class="i field">EndPointConfigurationType</a> = <span class="r28 r">endPointConfigType</span>;
            <b>lock</b> (<a href="#947d8e3a6cb45a56" class="i field">s_syncObject</a>)
            {
                <b>if</b> (!<a href="#ab7bd3ab45b6dd64" class="i field">s_ssnStateProviders</a>.<span class="i">ContainsKey</span>(<span class="r26 r">initializationParameters</span>))
                {
                    <a href="#ab7bd3ab45b6dd64" class="i field">s_ssnStateProviders</a>.<span class="i">Add</span>(<span class="r26 r">initializationParameters</span>, <span class="r27 r">configData</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">shellId</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> shellId for which the assembly is getting loaded</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">applicationBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">assemblyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">typeToLoad</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> type which is supplying the configuration.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Type instance representing the EndPointConfiguration to load.</span>
        <span class="c">///</span><span class="c"> This Type can be instantiated when needed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <span class="i">Type</span> <a id="2e8e690dd92d0382" href="../../../R/2e8e690dd92d0382.html" target="n" data-glyph="76,1" class="i method">LoadAndAnalyzeAssembly</a>(<b>string</b> <span id="r29 rd" class="r29 r">shellId</span>, <b>string</b> <span id="r30 rd" class="r30 r">applicationBase</span>,
            <b>string</b> <span id="r31 rd" class="r31 r">assemblyName</span>, <b>string</b> <span id="r32 rd" class="r32 r">typeToLoad</span>)
        {
            <b>if</b> ((<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r31 r">assemblyName</span>) &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r32 r">typeToLoad</span>)) ||
                 (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r31 r">assemblyName</span>) &amp;&amp; <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r32 r">typeToLoad</span>)))
            {
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">TypeNeedsAssembly</span>,
                    <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#a760798ff3d1d31c" class="i field">ASSEMBLYTOKEN</a>,
                    <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#5b4979d69407d7e3" class="i field">SHELLCONFIGTYPETOKEN</a>,
                    <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#77682a2f82e13908" class="i field">INITPARAMETERSTOKEN</a>);
            }
 
            <span class="i">Assembly</span> <span id="r33 rd" class="r33 r">assembly</span> = <b>null</b>;
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r31 r">assemblyName</span>))
            {
                <a href="../../../utils/tracing/PSEtwLog.cs.html#749e795b3c087a72" class="t t">PSEtwLog</a>.<a href="../../../utils/tracing/PSEtwLog.cs.html#daafe1d1950e6098" class="i method">LogAnalyticVerbose</a>(<a href="../common/PSETWTracer.cs.html#609c10dc18364c6e" class="t t">PSEventId</a>.<a href="../common/PSETWTracer.cs.html#e5f56c7014f7009d" class="i field">LoadingPSCustomShellAssembly</a>,
                    <a href="../common/PSETWTracer.cs.html#2dd3393d77ef2dd0" class="t t">PSOpcode</a>.<a href="../common/PSETWTracer.cs.html#a0f7cf0d4987790f" class="i field">Connect</a>, <a href="../common/PSETWTracer.cs.html#6bc0e8b902470481" class="t t">PSTask</a>.<a href="../common/PSETWTracer.cs.html#c682d415f6327c59" class="i field">None</a>, <a href="../common/PSETWTracer.cs.html#d4b75692e500e678" class="t t">PSKeyword</a>.<a href="../common/PSETWTracer.cs.html#c5d4a73b62c859ab" class="i field">Transport</a> | <a href="../common/PSETWTracer.cs.html#d4b75692e500e678" class="t t">PSKeyword</a>.<a href="../common/PSETWTracer.cs.html#a3de02676385c3a4" class="i field">UseAlwaysAnalytic</a>,
                    <span class="r31 r">assemblyName</span>, <span class="r29 r">shellId</span>);
 
                <span class="r33 r">assembly</span> = <a href="#b015a003c3fdd99f" class="i method">LoadSsnStateProviderAssembly</a>(<span class="r30 r">applicationBase</span>, <span class="r31 r">assemblyName</span>);
                <b>if</b> (<span class="r33 r">assembly</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r31 r">assemblyName</span>), <span class="i">RemotingErrorIdStrings</span>.<span class="i">UnableToLoadAssembly</span>,
                        <span class="r31 r">assemblyName</span>, <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#77682a2f82e13908" class="i field">INITPARAMETERSTOKEN</a>);
                }
            }
 
            <span class="c">// configuration xml specified an assembly and typetoload.</span>
            <b>if</b> (<span class="r33 r">assembly</span> != <b>null</b>)
            {
                <b>try</b>
                {
                    <a href="../../../utils/tracing/PSEtwLog.cs.html#749e795b3c087a72" class="t t">PSEtwLog</a>.<a href="../../../utils/tracing/PSEtwLog.cs.html#daafe1d1950e6098" class="i method">LogAnalyticVerbose</a>(<a href="../common/PSETWTracer.cs.html#609c10dc18364c6e" class="t t">PSEventId</a>.<a href="../common/PSETWTracer.cs.html#464f9efc337ee26c" class="i field">LoadingPSCustomShellType</a>,
                        <a href="../common/PSETWTracer.cs.html#2dd3393d77ef2dd0" class="t t">PSOpcode</a>.<a href="../common/PSETWTracer.cs.html#a0f7cf0d4987790f" class="i field">Connect</a>, <a href="../common/PSETWTracer.cs.html#6bc0e8b902470481" class="t t">PSTask</a>.<a href="../common/PSETWTracer.cs.html#c682d415f6327c59" class="i field">None</a>, <a href="../common/PSETWTracer.cs.html#d4b75692e500e678" class="t t">PSKeyword</a>.<a href="../common/PSETWTracer.cs.html#c5d4a73b62c859ab" class="i field">Transport</a> | <a href="../common/PSETWTracer.cs.html#d4b75692e500e678" class="t t">PSKeyword</a>.<a href="../common/PSETWTracer.cs.html#a3de02676385c3a4" class="i field">UseAlwaysAnalytic</a>,
                        <span class="r32 r">typeToLoad</span>, <span class="r29 r">shellId</span>);
 
                    <span class="i">Type</span> <span id="r34 rd" class="r34 r">type</span> = <span class="r33 r">assembly</span>.<span class="i">GetType</span>(<span class="r32 r">typeToLoad</span>, <b>true</b>, <b>true</b>);
                    <b>if</b> (<span class="r34 r">type</span> == <b>null</b>)
                    {
                        <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r32 r">typeToLoad</span>), <span class="i">RemotingErrorIdStrings</span>.<span class="i">UnableToLoadType</span>,
                            <span class="r32 r">typeToLoad</span>, <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#77682a2f82e13908" class="i field">INITPARAMETERSTOKEN</a>);
                    }
 
                    <b>return</b> <span class="r34 r">type</span>;
                }
                <b>catch</b> (<span class="i">ReflectionTypeLoadException</span>)
                {
                }
                <b>catch</b> (<span class="i">TypeLoadException</span>)
                {
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                }
                <b>catch</b> (<span class="i">MissingMethodException</span>)
                {
                }
                <b>catch</b> (<span class="i">InvalidCastException</span>)
                {
                }
                <b>catch</b> (<span class="i">TargetInvocationException</span>)
                {
                }
 
                <span class="c">// if we are here, that means we are unable to load the type specified</span>
                <span class="c">// in the config xml.. notify the same.</span>
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r32 r">typeToLoad</span>), <span class="i">RemotingErrorIdStrings</span>.<span class="i">UnableToLoadType</span>,
                        <span class="r32 r">typeToLoad</span>, <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>.<a href="#77682a2f82e13908" class="i field">INITPARAMETERSTOKEN</a>);
            }
 
            <span class="c">// load the default PowerShell since plugin config</span>
            <span class="c">// did not specify a typename to load.</span>
            <b>return</b> <b>typeof</b>(<a href="#442b12ff62d42c67" class="t t">DefaultRemotePowerShellConfiguration</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the application&#39;s current working directory to </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">applicationBase</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and</span>
        <span class="c">///</span><span class="c"> loads the assembly </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">assemblyName</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. Once the assembly is loaded, the application&#39;s</span>
        <span class="c">///</span><span class="c"> current working directory is set back to the original value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">applicationBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">assemblyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">// TODO: Send the exception message back to the client.</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Reliability&quot;</span>, <span class="s">&quot;CA2001:AvoidCallingProblematicMethods&quot;</span>, <span class="i">MessageId</span> = <span class="s">&quot;System.Reflection.Assembly.LoadFrom&quot;</span>)]
        <b>private static</b> <span class="i">Assembly</span> <a id="b015a003c3fdd99f" href="../../../R/b015a003c3fdd99f.html" target="n" data-glyph="76,1" class="i method">LoadSsnStateProviderAssembly</a>(<b>string</b> <span id="r35 rd" class="r35 r">applicationBase</span>, <b>string</b> <span id="r36 rd" class="r36 r">assemblyName</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r36 r">assemblyName</span>), <span class="s">&quot;AssemblyName cannot be null.&quot;</span>);
 
            <b>string</b> <span id="r37 rd" class="r37 r">originalDirectory</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r35 r">applicationBase</span>))
            {
                <span class="c">// changing current working directory allows CLR loader to load dependent assemblies</span>
                <b>try</b>
                {
                    <span class="r37 r">originalDirectory</span> = <span class="i">Directory</span>.<span class="i">GetCurrentDirectory</span>();
                    <span class="i">Directory</span>.<span class="i">SetCurrentDirectory</span>(<span class="r35 r">applicationBase</span>);
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r38 rd" class="r38 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to change current working directory to {0}: {1}&quot;</span>,
                        <span class="r35 r">applicationBase</span>, <span class="r38 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">PathTooLongException</span> <span id="r39 rd" class="r39 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to change current working directory to {0}: {1}&quot;</span>,
                           <span class="r35 r">applicationBase</span>, <span class="r39 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">FileNotFoundException</span> <span id="r40 rd" class="r40 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to change current working directory to {0}: {1}&quot;</span>,
                        <span class="r35 r">applicationBase</span>, <span class="r40 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">IOException</span> <span id="r41 rd" class="r41 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to change current working directory to {0}: {1}&quot;</span>,
                        <span class="r35 r">applicationBase</span>, <span class="r41 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span> <span id="r42 rd" class="r42 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to change current working directory to {0}: {1}&quot;</span>,
                           <span class="r35 r">applicationBase</span>, <span class="r42 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span> <span id="r43 rd" class="r43 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to change current working directory to {0}: {1}&quot;</span>,
                        <span class="r35 r">applicationBase</span>, <span class="r43 r">e</span>.<span class="i">Message</span>);
                }
            }
 
            <span class="c">// Even if there is error changing current working directory..try to load the assembly</span>
            <span class="c">// This is to allow assembly loading from GAC</span>
            <span class="i">Assembly</span> <span id="r44 rd" class="r44 r">result</span> = <b>null</b>;
            <b>try</b>
            {
                <b>try</b>
                {
                    <span class="r44 r">result</span> = <span class="i">Assembly</span>.<span class="i">Load</span>(<b>new</b> <span class="i">AssemblyName</span>(<span class="r36 r">assemblyName</span>));
                }
                <b>catch</b> (<span class="i">FileLoadException</span> <span id="r45 rd" class="r45 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to load assembly {0}: {1}&quot;</span>, <span class="r36 r">assemblyName</span>, <span class="r45 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">BadImageFormatException</span> <span id="r46 rd" class="r46 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to load assembly {0}: {1}&quot;</span>, <span class="r36 r">assemblyName</span>, <span class="r46 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">FileNotFoundException</span> <span id="r47 rd" class="r47 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to load assembly {0}: {1}&quot;</span>, <span class="r36 r">assemblyName</span>, <span class="r47 r">e</span>.<span class="i">Message</span>);
                }
 
                <b>if</b> (<span class="r44 r">result</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r44 r">result</span>;
                }
 
                <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<a href="../../../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Loading assembly from path {0}&quot;</span>, <span class="r35 r">applicationBase</span>);
                <b>try</b>
                {
                    <b>string</b> <span id="r48 rd" class="r48 r">assemblyPath</span>;
                    <b>if</b> (!<span class="i">Path</span>.<span class="i">IsPathRooted</span>(<span class="r36 r">assemblyName</span>))
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r35 r">applicationBase</span>) &amp;&amp; <span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r35 r">applicationBase</span>))
                        {
                            <span class="r48 r">assemblyPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r35 r">applicationBase</span>, <span class="r36 r">assemblyName</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r48 r">assemblyPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="i">Directory</span>.<span class="i">GetCurrentDirectory</span>(), <span class="r36 r">assemblyName</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// Rooted path of dll is provided.</span>
                        <span class="r48 r">assemblyPath</span> = <span class="r36 r">assemblyName</span>;
                    }
 
                    <span class="r44 r">result</span> = <span class="i">Assembly</span>.<span class="i">LoadFrom</span>(<span class="r48 r">assemblyPath</span>);
                }
                <b>catch</b> (<span class="i">FileLoadException</span> <span id="r49 rd" class="r49 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to load assembly {0}: {1}&quot;</span>, <span class="r36 r">assemblyName</span>, <span class="r49 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">BadImageFormatException</span> <span id="r50 rd" class="r50 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to load assembly {0}: {1}&quot;</span>, <span class="r36 r">assemblyName</span>, <span class="r50 r">e</span>.<span class="i">Message</span>);
                }
                <b>catch</b> (<span class="i">FileNotFoundException</span> <span id="r51 rd" class="r51 r">e</span>)
                {
                    <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceWarning</span>(<span class="s">&quot;Not able to load assembly {0}: {1}&quot;</span>, <span class="r36 r">assemblyName</span>, <span class="r51 r">e</span>.<span class="i">Message</span>);
                }
            }
            <b>finally</b>
            {
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r35 r">applicationBase</span>))
                {
                    <span class="c">// set the application&#39;s directory back to the original directory</span>
                    <span class="i">Directory</span>.<span class="i">SetCurrentDirectory</span>(<span class="r37 r">originalDirectory</span>);
                }
            }
 
            <b>return</b> <span class="r44 r">result</span>;
        }
 
        <span class="c">// TODO: I think this should be moved to Utils..this way all versioning related</span>
        <span class="c">// logic will be in one place.</span>
        <b>private static</b> <span class="i">RegistryKey</span> <a id="24fe6ee3c95ccffa" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetConfigurationProvidersRegistryKey</a>()
        {
            <b>try</b>
            {
                <span class="i">RegistryKey</span> <span id="r52 rd" class="r52 r">monadRootKey</span> = <a href="../../../singleshell/config/MshSnapinInfo.cs.html#b036b8d90fff7faa" class="t t">PSSnapInReader</a>.<a href="../../../singleshell/config/MshSnapinInfo.cs.html#e096581baa29246a" class="i method">GetMonadRootKey</a>();
                <span class="i">RegistryKey</span> <span id="r53 rd" class="r53 r">versionRoot</span> = <a href="../../../singleshell/config/MshSnapinInfo.cs.html#b036b8d90fff7faa" class="t t">PSSnapInReader</a>.<a href="../../../singleshell/config/MshSnapinInfo.cs.html#dd06ce13c1d3a64f" class="i method">GetVersionRootKey</a>(<span class="r52 r">monadRootKey</span>, <a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../../Utils.cs.html#0feba1ef9bf5a9cc" class="i method">GetCurrentMajorVersion</a>());
                <span class="i">RegistryKey</span> <span id="r54 rd" class="r54 r">configProviderKey</span> = <span class="r53 r">versionRoot</span>.<span class="i">OpenSubKey</span>(<a href="#3f70025a5e970a4e" class="i field">configProvidersKeyName</a>);
                <b>return</b> <span class="r54 r">configProviderKey</span>;
            }
            <b>catch</b> (<span class="i">ArgumentException</span>)
            {
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>)
            {
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Read value from the property </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">name</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> for registry </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r56 r">registryKey</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> as string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r56 r">registryKey</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Registry key from which the value is read.</span>
        <span class="c">///</span><span class="c"> Caller should make sure this is not null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the property.</span>
        <span class="c">///</span><span class="c"> Caller should make sure this is not null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">mandatory</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True, if the property should exist.</span>
        <span class="c">///</span><span class="c"> False, otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Value of the property.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private static string</b>
        <a id="73f99470315248c7" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ReadStringValue</a>(<span class="i">RegistryKey</span> <span id="r56 rd" class="r56 r">registryKey</span>, <b>string</b> <span id="r55 rd" class="r55 r">name</span>, <b>bool</b> <span id="r57 rd" class="r57 r">mandatory</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r55 r">name</span>), <span class="s">&quot;caller should validate the name parameter&quot;</span>);
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r56 r">registryKey</span> != <b>null</b>, <span class="s">&quot;Caller should validate the registryKey parameter&quot;</span>);
 
            <b>object</b> <span id="r58 rd" class="r58 r">value</span> = <span class="r56 r">registryKey</span>.<span class="i">GetValue</span>(<span class="r55 r">name</span>);
            <b>if</b> (<span class="r58 r">value</span> == <b>null</b> &amp;&amp; <span class="r57 r">mandatory</span>)
            {
                <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceError</span>(<span class="s">&quot;Mandatory property {0} not specified for registry key {1}&quot;</span>,
                        <span class="r55 r">name</span>, <span class="r56 r">registryKey</span>.<span class="i">Name</span>);
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r55 r">name</span>), <span class="i">RemotingErrorIdStrings</span>.<span class="i">MandatoryValueNotPresent</span>, <span class="r55 r">name</span>, <span class="r56 r">registryKey</span>.<span class="i">Name</span>);
            }
 
            <b>string</b> <span id="r59 rd" class="r59 r">s</span> = <span class="r58 r">value</span> <b>as string</b>;
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r59 r">s</span>) &amp;&amp; <span class="r57 r">mandatory</span>)
            {
                <a href="#1425f710acc4a96a" class="i field">s_tracer</a>.<span class="i">TraceError</span>(<span class="s">&quot;Value is null or empty for mandatory property {0} in {1}&quot;</span>,
                        <span class="r55 r">name</span>, <span class="r56 r">registryKey</span>.<span class="i">Name</span>);
                <b>throw</b> <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<b>nameof</b>(<span class="r55 r">name</span>), <span class="i">RemotingErrorIdStrings</span>.<span class="i">MandatoryValueNotInCorrectFormat</span>, <span class="r55 r">name</span>, <span class="r56 r">registryKey</span>.<span class="i">Name</span>);
            }
 
            <b>return</b> <span class="r59 r">s</span>;
        }
 
        <b>private const string</b> <a id="3f70025a5e970a4e" href="../../../R/3f70025a5e970a4e.html" target="n" data-glyph="10,1" class="i field">configProvidersKeyName</a> = <span class="s">&quot;PSConfigurationProviders&quot;</span>;
        <b>private const string</b> <a id="d44e2d88da0fd44f" href="../../../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">configProviderApplicationBaseKeyName</a> = <span class="s">&quot;ApplicationBase&quot;</span>;
        <b>private const string</b> <a id="365576389d1e20a6" href="../../../R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">configProviderAssemblyNameKeyName</a> = <span class="s">&quot;AssemblyName&quot;</span>;
 
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>&gt; <a id="ab7bd3ab45b6dd64" href="../../../R/ab7bd3ab45b6dd64.html" target="n" data-glyph="46,1" class="i field">s_ssnStateProviders</a> =
            <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#88c11924f622f7f5" class="t t">ConfigurationDataFromXML</a>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <b>private static readonly object</b> <a id="947d8e3a6cb45a56" href="../../../R/947d8e3a6cb45a56.html" target="n" data-glyph="46,1" class="i field">s_syncObject</a> = <b>new</b> <b>object</b>();
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provides Default InitialSessionState.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="442b12ff62d42c67" href="../../../R/442b12ff62d42c67.html" target="n" data-glyph="2,0" class="t t"><span id="3cd9cce747a61ff5">DefaultRemotePowerShellConfiguration</span></a> : <a href="#e35ba0e017aa5d6d" class="t t">PSSessionConfiguration</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">senderInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <a id="90193edde6025bf1" href="../../../R/90193edde6025bf1.html" target="n" data-glyph="72,1" class="i method">GetInitialSessionState</a>(<a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r60 rd" class="r60 r">senderInfo</span>)
        {
            <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r61 rd" class="r61 r">result</span> = <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#904bc85f721c6764" class="i method">CreateDefault2</a>();
            <span class="c">// TODO: Remove this after RDS moved to $using</span>
            <b>if</b> (<span class="r60 r">senderInfo</span>.<a href="PSPrincipal.cs.html#2833f89afefa8821" class="i property">ConnectionString</a> != <b>null</b> &amp;&amp; <span class="r60 r">senderInfo</span>.<a href="PSPrincipal.cs.html#2833f89afefa8821" class="i property">ConnectionString</a>.<span class="i">Contains</span>(<span class="s">&quot;MSP=7a83d074-bb86-4e52-aa3e-6cc73cc066c8&quot;</span>)) { <a href="PSSessionConfigurationData.cs.html#a9929ed8e7a283e6" class="t t">PSSessionConfigurationData</a>.<a href="PSSessionConfigurationData.cs.html#d859a4dc89b8fed8" class="i field">IsServerManager</a> = <b>true</b>; }
 
            <b>return</b> <span class="r61 r">result</span>;
        }
 
        <b>public override</b> <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <a id="927e706d2e2f67b7" href="../../../R/927e706d2e2f67b7.html" target="n" data-glyph="72,1" class="i method">GetInitialSessionState</a>(<a href="PSSessionConfigurationData.cs.html#a9929ed8e7a283e6" class="t t">PSSessionConfigurationData</a> <span id="r62 rd" class="r62 r">sessionConfigurationData</span>, <a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r63 rd" class="r63 r">senderInfo</span>, <b>string</b> <span id="r64 rd" class="r64 r">configProviderId</span>)
        {
            <b>if</b> (<span class="r62 r">sessionConfigurationData</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r62 r">sessionConfigurationData</span>));
 
            <b>if</b> (<span class="r63 r">senderInfo</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r63 r">senderInfo</span>));
 
            <b>if</b> (<span class="r64 r">configProviderId</span> == <b>null</b>)
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r64 r">configProviderId</span>));
 
            <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r65 rd" class="r65 r">sessionState</span> = <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#904bc85f721c6764" class="i method">CreateDefault2</a>();
            <span class="c">// now get all the modules in the specified path and import the same</span>
            <b>if</b> (<span class="r62 r">sessionConfigurationData</span> != <b>null</b> &amp;&amp; <span class="r62 r">sessionConfigurationData</span>.<a href="PSSessionConfigurationData.cs.html#951b2726df7b4965" class="i property">ModulesToImportInternal</a> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r66 rd" class="r66 r">module</span> <b>in</b> <span class="r62 r">sessionConfigurationData</span>.<a href="PSSessionConfigurationData.cs.html#951b2726df7b4965" class="i property">ModulesToImportInternal</a>)
                {
                    <b>var</b> <span id="r67 rd" class="r67 r">moduleName</span> = <span class="r66 r">module</span> <b>as string</b>;
                    <b>if</b> (<span class="r67 r">moduleName</span> != <b>null</b>)
                    {
                        <span class="r67 r">moduleName</span> = <span class="i">Environment</span>.<span class="i">ExpandEnvironmentVariables</span>(<span class="r67 r">moduleName</span>);
 
                        <span class="r65 r">sessionState</span>.<a href="../../InitialSessionState.cs.html#e1bc402ae6a0a4c8" class="i method">ImportPSModule</a>(<b>new</b>[] { <span class="r67 r">moduleName</span> });
                    }
                    <b>else</b>
                    {
                        <a href="../../Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="k">var</a> <span id="r68 rd" class="r68 r">moduleSpec</span> = <span class="r66 r">module</span> <b>as</b> <a href="../../Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>;
                        <b>if</b> (<span class="r68 r">moduleSpec</span> != <b>null</b>)
                        {
                            <b>var</b> <span id="r69 rd" class="r69 r">modulesToImport</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../../Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; { <span class="r68 r">moduleSpec</span> };
                            <span class="r65 r">sessionState</span>.<span class="i">ImportPSModule</span>(<span class="r69 r">modulesToImport</span>);
                        }
                    }
                }
            }
 
            <span class="c">// TODO: Remove this after RDS moved to $using</span>
            <b>if</b> (<span class="r63 r">senderInfo</span>.<a href="PSPrincipal.cs.html#2833f89afefa8821" class="i property">ConnectionString</a> != <b>null</b> &amp;&amp; <span class="r63 r">senderInfo</span>.<a href="PSPrincipal.cs.html#2833f89afefa8821" class="i property">ConnectionString</a>.<span class="i">Contains</span>(<span class="s">&quot;MSP=7a83d074-bb86-4e52-aa3e-6cc73cc066c8&quot;</span>)) { <a href="PSSessionConfigurationData.cs.html#a9929ed8e7a283e6" class="t t">PSSessionConfigurationData</a>.<a href="PSSessionConfigurationData.cs.html#d859a4dc89b8fed8" class="i field">IsServerManager</a> = <b>true</b>; }
 
            <b>return</b> <span class="r65 r">sessionState</span>;
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Declarative Initial Session Configuration
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Specifies type of initial session state to use. Valid values are Empty and Default.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public enum</b> <a id="193eb55ce6b6bb37" href="../../../R/193eb55ce6b6bb37.html" target="n" data-glyph="18,0" class="t t"><span id="f298c671ab42f355">SessionType</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Empty session state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="ad1552dbcd977f30" href="../../../R/ad1552dbcd977f30.html" target="n" data-glyph="24,1" class="i field">Empty</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Restricted remote server.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="7ece31798a0d7d7a" href="../../../R/7ece31798a0d7d7a.html" target="n" data-glyph="24,1" class="i field">RestrictedRemoteServer</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default session state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="cf7ca89ea220b2f6" href="../../../R/cf7ca89ea220b2f6.html" target="n" data-glyph="24,1" class="i field">Default</a>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Configuration type entry.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="f16d9b60d9dee16e" href="../../../R/f16d9b60d9dee16e.html" target="n" data-glyph="2,0" class="t t">ConfigTypeEntry</a>
    {
        <b>internal delegate bool</b> <a id="5311db9dfd1b4200" href="../../../R/5311db9dfd1b4200.html" target="n" data-glyph="14,1" class="t t"><span id="4bc35aa6990ab992">TypeValidationCallback</span></a>(<b>string</b> <span id="r70 rd" class="r70 r">key</span>, <b>object</b> <span id="r71 rd" class="r71 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r72 rd" class="r72 r">cmdlet</span>, <b>string</b> <span id="r73 rd" class="r73 r">path</span>);
 
        <b>internal string</b> <a id="f91fd2c90731073b" href="../../../R/f91fd2c90731073b.html" target="n" data-glyph="44,1" class="i field">Key</a>;
        <b>internal</b> <a href="#5311db9dfd1b4200" class="t t">TypeValidationCallback</a> <a id="7a78ec8a6e3a4454" href="../../../R/7a78ec8a6e3a4454.html" target="n" data-glyph="44,1" class="i field">ValidationCallback</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r74 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">callback</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="03c00203bf3bcd69" href="../../../R/03c00203bf3bcd69.html" target="n" data-glyph="74,1" class="t constructor">ConfigTypeEntry</a>(<b>string</b> <span id="r74 rd" class="r74 r">key</span>, <a href="#5311db9dfd1b4200" class="t t">TypeValidationCallback</a> <span id="r75 rd" class="r75 r">callback</span>)
        {
            <a href="#f16d9b60d9dee16e" class="k">this</a>.<a href="#f91fd2c90731073b" class="i field">Key</a> = <span class="r74 r">key</span>;
            <a href="#f16d9b60d9dee16e" class="k">this</a>.<a href="#7a78ec8a6e3a4454" class="i field">ValidationCallback</a> = <span class="r75 r">callback</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Configuration file constants.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="b1e495f9b52fbd4a" href="../../../R/b1e495f9b52fbd4a.html" target="n" data-glyph="2,0" class="t t">ConfigFileConstants</a>
    {
        <b>internal static readonly string</b> <a id="c5bd5765181feeac" href="../../../R/c5bd5765181feeac.html" target="n" data-glyph="44,1" class="i field">AliasDefinitions</a> = <span class="s">&quot;AliasDefinitions&quot;</span>;
        <b>internal static readonly string</b> <a id="48d829fdc044b6bf" href="../../../R/48d829fdc044b6bf.html" target="n" data-glyph="44,1" class="i field">AliasDescriptionToken</a> = <span class="s">&quot;Description&quot;</span>;
        <b>internal static readonly string</b> <a id="804ab2a2e4c5a748" href="../../../R/804ab2a2e4c5a748.html" target="n" data-glyph="44,1" class="i field">AliasNameToken</a> = <span class="s">&quot;Name&quot;</span>;
        <b>internal static readonly string</b> <a id="2754a8adb9898206" href="../../../R/2754a8adb9898206.html" target="n" data-glyph="44,1" class="i field">AliasOptionsToken</a> = <span class="s">&quot;Options&quot;</span>;
        <b>internal static readonly string</b> <a id="f16404cd063a2837" href="../../../R/f16404cd063a2837.html" target="n" data-glyph="44,1" class="i field">AliasValueToken</a> = <span class="s">&quot;Value&quot;</span>;
        <b>internal static readonly string</b> <a id="681f01148717d80f" href="../../../R/681f01148717d80f.html" target="n" data-glyph="44,1" class="i field">AssembliesToLoad</a> = <span class="s">&quot;AssembliesToLoad&quot;</span>;
        <b>internal static readonly string</b> <a id="2033f34b09a6c367" href="../../../R/2033f34b09a6c367.html" target="n" data-glyph="44,1" class="i field">Author</a> = <span class="s">&quot;Author&quot;</span>;
        <b>internal static readonly string</b> <a id="2b7e6f2a40dd7273" href="../../../R/2b7e6f2a40dd7273.html" target="n" data-glyph="44,1" class="i field">CompanyName</a> = <span class="s">&quot;CompanyName&quot;</span>;
        <b>internal static readonly string</b> <a id="3aca92d1fa3fdcbf" href="../../../R/3aca92d1fa3fdcbf.html" target="n" data-glyph="44,1" class="i field">Copyright</a> = <span class="s">&quot;Copyright&quot;</span>;
        <b>internal static readonly string</b> <a id="c88da021a0546383" href="../../../R/c88da021a0546383.html" target="n" data-glyph="44,1" class="i field">Description</a> = <span class="s">&quot;Description&quot;</span>;
        <b>internal static readonly string</b> <a id="51e0d4975999733d" href="../../../R/51e0d4975999733d.html" target="n" data-glyph="44,1" class="i field">EnforceInputParameterValidation</a> = <span class="s">&quot;EnforceInputParameterValidation&quot;</span>;
        <b>internal static readonly string</b> <a id="bd6ddd7c2df83736" href="../../../R/bd6ddd7c2df83736.html" target="n" data-glyph="44,1" class="i field">EnvironmentVariables</a> = <span class="s">&quot;EnvironmentVariables&quot;</span>;
        <b>internal static readonly string</b> <a id="50f99a9a999d54d8" href="../../../R/50f99a9a999d54d8.html" target="n" data-glyph="44,1" class="i field">ExecutionPolicy</a> = <span class="s">&quot;ExecutionPolicy&quot;</span>;
        <b>internal static readonly string</b> <a id="22f6487e5a94de7f" href="../../../R/22f6487e5a94de7f.html" target="n" data-glyph="44,1" class="i field">FormatsToProcess</a> = <span class="s">&quot;FormatsToProcess&quot;</span>;
        <b>internal static readonly string</b> <a id="e68c4b55a4bdf33a" href="../../../R/e68c4b55a4bdf33a.html" target="n" data-glyph="44,1" class="i field">FunctionDefinitions</a> = <span class="s">&quot;FunctionDefinitions&quot;</span>;
        <b>internal static readonly string</b> <a id="79c9e3e4f7f31db1" href="../../../R/79c9e3e4f7f31db1.html" target="n" data-glyph="44,1" class="i field">FunctionNameToken</a> = <span class="s">&quot;Name&quot;</span>;
        <b>internal static readonly string</b> <a id="f3b742e57550f9ad" href="../../../R/f3b742e57550f9ad.html" target="n" data-glyph="44,1" class="i field">FunctionOptionsToken</a> = <span class="s">&quot;Options&quot;</span>;
        <b>internal static readonly string</b> <a id="b5c2efca914a6039" href="../../../R/b5c2efca914a6039.html" target="n" data-glyph="44,1" class="i field">FunctionValueToken</a> = <span class="s">&quot;ScriptBlock&quot;</span>;
        <b>internal static readonly string</b> <a id="8b4e61e9c62fdd9b" href="../../../R/8b4e61e9c62fdd9b.html" target="n" data-glyph="44,1" class="i field">GMSAAccount</a> = <span class="s">&quot;GroupManagedServiceAccount&quot;</span>;
        <b>internal static readonly string</b> <a id="588d3101f5da21f7" href="../../../R/588d3101f5da21f7.html" target="n" data-glyph="44,1" class="i field">Guid</a> = <span class="s">&quot;GUID&quot;</span>;
        <b>internal static readonly string</b> <a id="cd52cc01a19f4a84" href="../../../R/cd52cc01a19f4a84.html" target="n" data-glyph="44,1" class="i field">LanguageMode</a> = <span class="s">&quot;LanguageMode&quot;</span>;
        <b>internal static readonly string</b> <a id="815af157370a682b" href="../../../R/815af157370a682b.html" target="n" data-glyph="44,1" class="i field">ModulesToImport</a> = <span class="s">&quot;ModulesToImport&quot;</span>;
        <b>internal static readonly string</b> <a id="6004ce4c39182bad" href="../../../R/6004ce4c39182bad.html" target="n" data-glyph="44,1" class="i field">MountUserDrive</a> = <span class="s">&quot;MountUserDrive&quot;</span>;
        <b>internal static readonly string</b> <a id="b5b521e31e7f3529" href="../../../R/b5b521e31e7f3529.html" target="n" data-glyph="44,1" class="i field">PowerShellVersion</a> = <span class="s">&quot;PowerShellVersion&quot;</span>;
        <b>internal static readonly string</b> <a id="791957e7bb634869" href="../../../R/791957e7bb634869.html" target="n" data-glyph="44,1" class="i field">RequiredGroups</a> = <span class="s">&quot;RequiredGroups&quot;</span>;
        <b>internal static readonly string</b> <a id="046aa0715b0841ad" href="../../../R/046aa0715b0841ad.html" target="n" data-glyph="44,1" class="i field">RoleDefinitions</a> = <span class="s">&quot;RoleDefinitions&quot;</span>;
        <b>internal static readonly string</b> <a id="84e5760daabc0a94" href="../../../R/84e5760daabc0a94.html" target="n" data-glyph="44,1" class="i field">SchemaVersion</a> = <span class="s">&quot;SchemaVersion&quot;</span>;
        <b>internal static readonly string</b> <a id="9a5653ee028fb1fc" href="../../../R/9a5653ee028fb1fc.html" target="n" data-glyph="44,1" class="i field">ScriptsToProcess</a> = <span class="s">&quot;ScriptsToProcess&quot;</span>;
        <b>internal static readonly string</b> <a id="a5bcbefb030c8e02" href="../../../R/a5bcbefb030c8e02.html" target="n" data-glyph="44,1" class="i field">SessionType</a> = <span class="s">&quot;SessionType&quot;</span>;
        <b>internal static readonly string</b> <a id="37c0d6feb9f37778" href="../../../R/37c0d6feb9f37778.html" target="n" data-glyph="44,1" class="i field">RoleCapabilities</a> = <span class="s">&quot;RoleCapabilities&quot;</span>;
        <b>internal static readonly string</b> <a id="099a9beea82f9d25" href="../../../R/099a9beea82f9d25.html" target="n" data-glyph="44,1" class="i field">RoleCapabilityFiles</a> = <span class="s">&quot;RoleCapabilityFiles&quot;</span>;
        <b>internal static readonly string</b> <a id="6113c4097d4973ff" href="../../../R/6113c4097d4973ff.html" target="n" data-glyph="44,1" class="i field">RunAsVirtualAccount</a> = <span class="s">&quot;RunAsVirtualAccount&quot;</span>;
        <b>internal static readonly string</b> <a id="e724519e3a7dcc96" href="../../../R/e724519e3a7dcc96.html" target="n" data-glyph="44,1" class="i field">RunAsVirtualAccountGroups</a> = <span class="s">&quot;RunAsVirtualAccountGroups&quot;</span>;
        <b>internal static readonly string</b> <a id="19b003dcfa5ad4bf" href="../../../R/19b003dcfa5ad4bf.html" target="n" data-glyph="44,1" class="i field">TranscriptDirectory</a> = <span class="s">&quot;TranscriptDirectory&quot;</span>;
        <b>internal static readonly string</b> <a id="1a3b227af34ff440" href="../../../R/1a3b227af34ff440.html" target="n" data-glyph="44,1" class="i field">TypesToProcess</a> = <span class="s">&quot;TypesToProcess&quot;</span>;
        <b>internal static readonly string</b> <a id="f44aa5ddaba24fbd" href="../../../R/f44aa5ddaba24fbd.html" target="n" data-glyph="44,1" class="i field">UserDriveMaxSize</a> = <span class="s">&quot;UserDriveMaximumSize&quot;</span>;
        <b>internal static readonly string</b> <a id="97f715e4ffecc7c5" href="../../../R/97f715e4ffecc7c5.html" target="n" data-glyph="44,1" class="i field">VariableDefinitions</a> = <span class="s">&quot;VariableDefinitions&quot;</span>;
        <b>internal static readonly string</b> <a id="2de830f08f62b5e6" href="../../../R/2de830f08f62b5e6.html" target="n" data-glyph="44,1" class="i field">VariableNameToken</a> = <span class="s">&quot;Name&quot;</span>;
        <b>internal static readonly string</b> <a id="9bd2b3372dcf4d80" href="../../../R/9bd2b3372dcf4d80.html" target="n" data-glyph="44,1" class="i field">VariableValueToken</a> = <span class="s">&quot;Value&quot;</span>;
        <b>internal static readonly string</b> <a id="3ae92ee7773a9e6a" href="../../../R/3ae92ee7773a9e6a.html" target="n" data-glyph="44,1" class="i field">VisibleAliases</a> = <span class="s">&quot;VisibleAliases&quot;</span>;
        <b>internal static readonly string</b> <a id="f35a94fa18c56045" href="../../../R/f35a94fa18c56045.html" target="n" data-glyph="44,1" class="i field">VisibleCmdlets</a> = <span class="s">&quot;VisibleCmdlets&quot;</span>;
        <b>internal static readonly string</b> <a id="6a2144eb8017892d" href="../../../R/6a2144eb8017892d.html" target="n" data-glyph="44,1" class="i field">VisibleFunctions</a> = <span class="s">&quot;VisibleFunctions&quot;</span>;
        <b>internal static readonly string</b> <a id="4187c2fa3d874c86" href="../../../R/4187c2fa3d874c86.html" target="n" data-glyph="44,1" class="i field">VisibleProviders</a> = <span class="s">&quot;VisibleProviders&quot;</span>;
        <b>internal static readonly string</b> <a id="691bb9c10d14bdef" href="../../../R/691bb9c10d14bdef.html" target="n" data-glyph="44,1" class="i field">VisibleExternalCommands</a> = <span class="s">&quot;VisibleExternalCommands&quot;</span>;
 
        <b>internal static readonly</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>[] <a id="9152f7ada4cb8df9" href="../../../R/9152f7ada4cb8df9.html" target="n" data-glyph="44,1" class="i field">ConfigFileKeys</a> = <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>[] {
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#c5bd5765181feeac" class="i field">AliasDefinitions</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#c177c22d0d4cbe46" class="i method">AliasDefinitionsTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#681f01148717d80f" class="i field">AssembliesToLoad</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#2033f34b09a6c367" class="i field">Author</a>,                          <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#2b7e6f2a40dd7273" class="i field">CompanyName</a>,                     <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#3aca92d1fa3fdcbf" class="i field">Copyright</a>,                       <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#c88da021a0546383" class="i field">Description</a>,                     <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#51e0d4975999733d" class="i field">EnforceInputParameterValidation</a>, <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#dba380ae0e674837" class="i method">BooleanTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#bd6ddd7c2df83736" class="i field">EnvironmentVariables</a>,            <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#e7daec1e8cbb8e89" class="i method">HashtableTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#50f99a9a999d54d8" class="i field">ExecutionPolicy</a>,                 <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#469083d8e4da3890" class="i method">ExecutionPolicyValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#e68c4b55a4bdf33a" class="i field">FunctionDefinitions</a>,             <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#0b72c0eea968e76d" class="i method">FunctionDefinitionsTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#8b4e61e9c62fdd9b" class="i field">GMSAAccount</a>,                     <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#588d3101f5da21f7" class="i field">Guid</a>,                            <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#cd52cc01a19f4a84" class="i field">LanguageMode</a>,                    <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#15d894334da71440" class="i method">LanguageModeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#815af157370a682b" class="i field">ModulesToImport</a>,                 <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#7e40e925f1156d5b" class="i method">StringOrHashtableArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#6004ce4c39182bad" class="i field">MountUserDrive</a>,                  <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#dba380ae0e674837" class="i method">BooleanTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#b5b521e31e7f3529" class="i field">PowerShellVersion</a>,               <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#791957e7bb634869" class="i field">RequiredGroups</a>,                  <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#e7daec1e8cbb8e89" class="i method">HashtableTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#37c0d6feb9f37778" class="i field">RoleCapabilities</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#099a9beea82f9d25" class="i field">RoleCapabilityFiles</a>,             <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#046aa0715b0841ad" class="i field">RoleDefinitions</a>,                 <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#e7daec1e8cbb8e89" class="i method">HashtableTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#6113c4097d4973ff" class="i field">RunAsVirtualAccount</a>,             <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#dba380ae0e674837" class="i method">BooleanTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#e724519e3a7dcc96" class="i field">RunAsVirtualAccountGroups</a>,       <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#84e5760daabc0a94" class="i field">SchemaVersion</a>,                   <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#a5bcbefb030c8e02" class="i field">SessionType</a>,                     <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#cacddaa70998c9f0" class="i method">ISSValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#19b003dcfa5ad4bf" class="i field">TranscriptDirectory</a>,             <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#3c113659e740d018" class="i method">StringTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>,                  <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#f44aa5ddaba24fbd" class="i field">UserDriveMaxSize</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#cfeb960def911592" class="i method">IntegerTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#97f715e4ffecc7c5" class="i field">VariableDefinitions</a>,             <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#2f85bb3afc739db5" class="i method">VariableDefinitionsTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#3ae92ee7773a9e6a" class="i field">VisibleAliases</a>,                  <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#f35a94fa18c56045" class="i field">VisibleCmdlets</a>,                  <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#6a2144eb8017892d" class="i field">VisibleFunctions</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#4187c2fa3d874c86" class="i field">VisibleProviders</a>,                <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
            <b>new</b> <a href="#03c00203bf3bcd69" class="t constructor">ConfigTypeEntry</a>(<a href="#691bb9c10d14bdef" class="i field">VisibleExternalCommands</a>,         <b>new</b> <a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a>.<span class="t">TypeValidationCallback</span>(<a href="#ae2ab76da4807e67" class="i method">StringArrayTypeValidationCallback</a>)),
        };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if the given key is a valid key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">de</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="a4fd3249bdbcdc27" href="../../../R/a4fd3249bdbcdc27.html" target="n" data-glyph="74,1" class="i method">IsValidKey</a>(<span class="i">DictionaryEntry</span> <span id="r76 rd" class="r76 r">de</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r77 rd" class="r77 r">cmdlet</span>, <b>string</b> <span id="r78 rd" class="r78 r">path</span>)
        {
            <b>bool</b> <span id="r79 rd" class="r79 r">validKey</span> = <b>false</b>;
 
            <b>foreach</b> (<a href="#f16d9b60d9dee16e" class="t t">ConfigTypeEntry</a> <span id="r80 rd" class="r80 r">configEntry</span> <b>in</b> <a href="#9152f7ada4cb8df9" class="i field">ConfigFileKeys</a>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r80 r">configEntry</span>.<a href="#f91fd2c90731073b" class="i field">Key</a>, <span class="r76 r">de</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r79 r">validKey</span> = <b>true</b>;
 
                    <b>if</b> (<span class="r80 r">configEntry</span>.<a href="#7a78ec8a6e3a4454" class="i field">ValidationCallback</a>(<span class="r76 r">de</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="r76 r">de</span>.<span class="i">Value</span>, <span class="r77 r">cmdlet</span>, <span class="r78 r">path</span>))
                    {
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <b>if</b> (!<span class="r79 r">validKey</span>)
            {
                <span class="r77 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCInvalidKey</span>, <span class="r76 r">de</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="r78 r">path</span>));
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r82 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="cacddaa70998c9f0" href="../../../R/cacddaa70998c9f0.html" target="n" data-glyph="76,1" class="i method">ISSValidationCallback</a>(<b>string</b> <span id="r81 rd" class="r81 r">key</span>, <b>object</b> <span id="r82 rd" class="r82 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r83 rd" class="r83 r">cmdlet</span>, <b>string</b> <span id="r84 rd" class="r84 r">path</span>)
        {
            <b>string</b> <span id="r85 rd" class="r85 r">value</span> = <span class="r82 r">obj</span> <b>as string</b>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r85 r">value</span>))
            {
                <b>try</b>
                {
                    <span class="i">Enum</span>.<span class="i">Parse</span>(<b>typeof</b>(<a href="#193eb55ce6b6bb37" class="t t">SessionType</a>), <span class="r85 r">value</span>, <b>true</b>);
 
                    <b>return</b> <b>true</b>;
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                    <span class="c">// Do nothing here</span>
                }
            }
 
            <span class="r83 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeValidEnum</span>, <span class="r81 r">key</span>, <b>typeof</b>(<a href="#193eb55ce6b6bb37" class="t t">SessionType</a>).<span class="i">FullName</span>,
                <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#ca4f496a5bed30f5" class="t t">EnumSingleTypeConverter</a>.<span class="i">EnumValues</span>(<b>typeof</b>(<a href="#193eb55ce6b6bb37" class="t t">SessionType</a>)), <span class="r84 r">path</span>));
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r88 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r89 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="15d894334da71440" href="../../../R/15d894334da71440.html" target="n" data-glyph="76,1" class="i method">LanguageModeValidationCallback</a>(<b>string</b> <span id="r86 rd" class="r86 r">key</span>, <b>object</b> <span id="r87 rd" class="r87 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r88 rd" class="r88 r">cmdlet</span>, <b>string</b> <span id="r89 rd" class="r89 r">path</span>)
        {
            <b>string</b> <span id="r90 rd" class="r90 r">value</span> = <span class="r87 r">obj</span> <b>as string</b>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r90 r">value</span>))
            {
                <b>try</b>
                {
                    <span class="i">Enum</span>.<span class="i">Parse</span>(<b>typeof</b>(<a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>), <span class="r90 r">value</span>, <b>true</b>);
 
                    <b>return</b> <b>true</b>;
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                    <span class="c">// Do nothing here</span>
                }
            }
 
            <span class="r88 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeValidEnum</span>, <span class="r86 r">key</span>, <b>typeof</b>(<a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>).<span class="i">FullName</span>,
                <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#ca4f496a5bed30f5" class="t t">EnumSingleTypeConverter</a>.<span class="i">EnumValues</span>(<b>typeof</b>(<a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>)), <span class="r89 r">path</span>));
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="469083d8e4da3890" href="../../../R/469083d8e4da3890.html" target="n" data-glyph="76,1" class="i method">ExecutionPolicyValidationCallback</a>(<b>string</b> <span id="r91 rd" class="r91 r">key</span>, <b>object</b> <span id="r92 rd" class="r92 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r93 rd" class="r93 r">cmdlet</span>, <b>string</b> <span id="r94 rd" class="r94 r">path</span>)
        {
            <b>string</b> <span id="r95 rd" class="r95 r">value</span> = <span class="r92 r">obj</span> <b>as string</b>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r95 r">value</span>))
            {
                <b>try</b>
                {
                    <span class="i">Enum</span>.<span class="i">Parse</span>(<a href="#78aacc47ea72f6a8" class="t t">DISCUtils</a>.<a href="#c5524d580e4fe459" class="i field">ExecutionPolicyType</a>, <span class="r95 r">value</span>, <b>true</b>);
 
                    <b>return</b> <b>true</b>;
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                    <span class="c">// Do nothing here</span>
                }
            }
 
            <span class="r93 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeValidEnum</span>, <span class="r91 r">key</span>, <a href="#78aacc47ea72f6a8" class="t t">DISCUtils</a>.<a href="#c5524d580e4fe459" class="i field">ExecutionPolicyType</a>.<span class="i">FullName</span>,
                <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../../LanguagePrimitives.cs.html#ca4f496a5bed30f5" class="t t">EnumSingleTypeConverter</a>.<a href="../../LanguagePrimitives.cs.html#7e68d3d58478ec8d" class="i method">EnumValues</a>(<a href="#78aacc47ea72f6a8" class="t t">DISCUtils</a>.<a href="#c5524d580e4fe459" class="i field">ExecutionPolicyType</a>), <span class="r94 r">path</span>));
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r98 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="e7daec1e8cbb8e89" href="../../../R/e7daec1e8cbb8e89.html" target="n" data-glyph="76,1" class="i method">HashtableTypeValidationCallback</a>(<b>string</b> <span id="r96 rd" class="r96 r">key</span>, <b>object</b> <span id="r97 rd" class="r97 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r98 rd" class="r98 r">cmdlet</span>, <b>string</b> <span id="r99 rd" class="r99 r">path</span>)
        {
            <span class="i">Hashtable</span> <span id="r100 rd" class="r100 r">hash</span> = <span class="r97 r">obj</span> <b>as</b> <span class="i">Hashtable</span>;
 
            <b>if</b> (<span class="r100 r">hash</span> == <b>null</b>)
            {
                <span class="r98 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeHashtable</span>, <span class="r96 r">key</span>, <span class="r99 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="c177c22d0d4cbe46" href="../../../R/c177c22d0d4cbe46.html" target="n" data-glyph="76,1" class="i method">AliasDefinitionsTypeValidationCallback</a>(<b>string</b> <span id="r101 rd" class="r101 r">key</span>, <b>object</b> <span id="r102 rd" class="r102 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r103 rd" class="r103 r">cmdlet</span>, <b>string</b> <span id="r104 rd" class="r104 r">path</span>)
        {
            <span class="i">Hashtable</span>[] <span id="r105 rd" class="r105 r">hashtables</span> = <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<a href="#b24ebadf5f6d939f" class="i method">TryGetHashtableArray</a>(<span class="r102 r">obj</span>);
 
            <b>if</b> (<span class="r105 r">hashtables</span> == <b>null</b>)
            {
                <span class="r103 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeHashtableArray</span>, <span class="r101 r">key</span>, <span class="r104 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<span class="i">Hashtable</span> <span id="r106 rd" class="r106 r">hashtable</span> <b>in</b> <span class="r105 r">hashtables</span>)
            {
                <b>if</b> (!<span class="r106 r">hashtable</span>.<span class="i">ContainsKey</span>(<a href="#804ab2a2e4c5a748" class="i field">AliasNameToken</a>))
                {
                    <span class="r103 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustContainKey</span>, <span class="r101 r">key</span>, <a href="#804ab2a2e4c5a748" class="i field">AliasNameToken</a>, <span class="r104 r">path</span>));
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (!<span class="r106 r">hashtable</span>.<span class="i">ContainsKey</span>(<a href="#f16404cd063a2837" class="i field">AliasValueToken</a>))
                {
                    <span class="r103 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustContainKey</span>, <span class="r101 r">key</span>, <a href="#f16404cd063a2837" class="i field">AliasValueToken</a>, <span class="r104 r">path</span>));
                    <b>return</b> <b>false</b>;
                }
 
                <b>foreach</b> (<b>string</b> <span id="r107 rd" class="r107 r">aliasKey</span> <b>in</b> <span class="r106 r">hashtable</span>.<span class="i">Keys</span>)
                {
                    <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r107 r">aliasKey</span>, <a href="#804ab2a2e4c5a748" class="i field">AliasNameToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                       !<b>string</b>.<span class="i">Equals</span>(<span class="r107 r">aliasKey</span>, <a href="#f16404cd063a2837" class="i field">AliasValueToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                       !<b>string</b>.<span class="i">Equals</span>(<span class="r107 r">aliasKey</span>, <a href="#48d829fdc044b6bf" class="i field">AliasDescriptionToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                       !<b>string</b>.<span class="i">Equals</span>(<span class="r107 r">aliasKey</span>, <a href="#2754a8adb9898206" class="i field">AliasOptionsToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r103 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeContainsInvalidKey</span>, <span class="r107 r">aliasKey</span>, <span class="r101 r">key</span>, <span class="r104 r">path</span>));
                        <b>return</b> <b>false</b>;
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="0b72c0eea968e76d" href="../../../R/0b72c0eea968e76d.html" target="n" data-glyph="76,1" class="i method">FunctionDefinitionsTypeValidationCallback</a>(<b>string</b> <span id="r108 rd" class="r108 r">key</span>, <b>object</b> <span id="r109 rd" class="r109 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r110 rd" class="r110 r">cmdlet</span>, <b>string</b> <span id="r111 rd" class="r111 r">path</span>)
        {
            <span class="i">Hashtable</span>[] <span id="r112 rd" class="r112 r">hashtables</span> = <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<a href="#b24ebadf5f6d939f" class="i method">TryGetHashtableArray</a>(<span class="r109 r">obj</span>);
 
            <b>if</b> (<span class="r112 r">hashtables</span> == <b>null</b>)
            {
                <span class="r110 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeHashtableArray</span>, <span class="r108 r">key</span>, <span class="r111 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<span class="i">Hashtable</span> <span id="r113 rd" class="r113 r">hashtable</span> <b>in</b> <span class="r112 r">hashtables</span>)
            {
                <b>if</b> (!<span class="r113 r">hashtable</span>.<span class="i">ContainsKey</span>(<a href="#79c9e3e4f7f31db1" class="i field">FunctionNameToken</a>))
                {
                    <span class="r110 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustContainKey</span>, <span class="r108 r">key</span>, <a href="#79c9e3e4f7f31db1" class="i field">FunctionNameToken</a>, <span class="r111 r">path</span>));
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (!<span class="r113 r">hashtable</span>.<span class="i">ContainsKey</span>(<a href="#b5c2efca914a6039" class="i field">FunctionValueToken</a>))
                {
                    <span class="r110 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustContainKey</span>, <span class="r108 r">key</span>, <a href="#b5c2efca914a6039" class="i field">FunctionValueToken</a>, <span class="r111 r">path</span>));
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (<span class="r113 r">hashtable</span>[<a href="#b5c2efca914a6039" class="i field">FunctionValueToken</a>] <b>is not</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)
                {
                    <span class="r110 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCKeyMustBeScriptBlock</span>, <a href="#b5c2efca914a6039" class="i field">FunctionValueToken</a>, <span class="r108 r">key</span>, <span class="r111 r">path</span>));
                    <b>return</b> <b>false</b>;
                }
 
                <b>foreach</b> (<b>string</b> <span id="r114 rd" class="r114 r">functionKey</span> <b>in</b> <span class="r113 r">hashtable</span>.<span class="i">Keys</span>)
                {
                    <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r114 r">functionKey</span>, <a href="#79c9e3e4f7f31db1" class="i field">FunctionNameToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                        !<b>string</b>.<span class="i">Equals</span>(<span class="r114 r">functionKey</span>, <a href="#b5c2efca914a6039" class="i field">FunctionValueToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                        !<b>string</b>.<span class="i">Equals</span>(<span class="r114 r">functionKey</span>, <a href="#f3b742e57550f9ad" class="i field">FunctionOptionsToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r110 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeContainsInvalidKey</span>, <span class="r114 r">functionKey</span>, <span class="r108 r">key</span>, <span class="r111 r">path</span>));
                        <b>return</b> <b>false</b>;
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r115 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r116 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r117 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r118 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="2f85bb3afc739db5" href="../../../R/2f85bb3afc739db5.html" target="n" data-glyph="76,1" class="i method">VariableDefinitionsTypeValidationCallback</a>(<b>string</b> <span id="r115 rd" class="r115 r">key</span>, <b>object</b> <span id="r116 rd" class="r116 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r117 rd" class="r117 r">cmdlet</span>, <b>string</b> <span id="r118 rd" class="r118 r">path</span>)
        {
            <span class="i">Hashtable</span>[] <span id="r119 rd" class="r119 r">hashtables</span> = <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<a href="#b24ebadf5f6d939f" class="i method">TryGetHashtableArray</a>(<span class="r116 r">obj</span>);
 
            <b>if</b> (<span class="r119 r">hashtables</span> == <b>null</b>)
            {
                <span class="r117 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeHashtableArray</span>, <span class="r115 r">key</span>, <span class="r118 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<span class="i">Hashtable</span> <span id="r120 rd" class="r120 r">hashtable</span> <b>in</b> <span class="r119 r">hashtables</span>)
            {
                <b>if</b> (!<span class="r120 r">hashtable</span>.<span class="i">ContainsKey</span>(<a href="#2de830f08f62b5e6" class="i field">VariableNameToken</a>))
                {
                    <span class="r117 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustContainKey</span>, <span class="r115 r">key</span>, <a href="#2de830f08f62b5e6" class="i field">VariableNameToken</a>, <span class="r118 r">path</span>));
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (!<span class="r120 r">hashtable</span>.<span class="i">ContainsKey</span>(<a href="#9bd2b3372dcf4d80" class="i field">VariableValueToken</a>))
                {
                    <span class="r117 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustContainKey</span>, <span class="r115 r">key</span>, <a href="#9bd2b3372dcf4d80" class="i field">VariableValueToken</a>, <span class="r118 r">path</span>));
                    <b>return</b> <b>false</b>;
                }
 
                <b>foreach</b> (<b>string</b> <span id="r121 rd" class="r121 r">variableKey</span> <b>in</b> <span class="r120 r">hashtable</span>.<span class="i">Keys</span>)
                {
                    <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r121 r">variableKey</span>, <a href="#2de830f08f62b5e6" class="i field">VariableNameToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                        !<b>string</b>.<span class="i">Equals</span>(<span class="r121 r">variableKey</span>, <a href="#9bd2b3372dcf4d80" class="i field">VariableValueToken</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r117 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeContainsInvalidKey</span>, <span class="r121 r">variableKey</span>, <span class="r115 r">key</span>, <span class="r118 r">path</span>));
                        <b>return</b> <b>false</b>;
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies a string type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r123 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="3c113659e740d018" href="../../../R/3c113659e740d018.html" target="n" data-glyph="76,1" class="i method">StringTypeValidationCallback</a>(<b>string</b> <span id="r124 rd" class="r124 r">key</span>, <b>object</b> <span id="r122 rd" class="r122 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r123 rd" class="r123 r">cmdlet</span>, <b>string</b> <span id="r125 rd" class="r125 r">path</span>)
        {
            <b>if</b> (<span class="r122 r">obj</span> <b>is not string</b>)
            {
                <span class="r123 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeString</span>, <span class="r124 r">key</span>, <span class="r125 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies a string array type.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r127 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r128 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r129 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="ae2ab76da4807e67" href="../../../R/ae2ab76da4807e67.html" target="n" data-glyph="76,1" class="i method">StringArrayTypeValidationCallback</a>(<b>string</b> <span id="r128 rd" class="r128 r">key</span>, <b>object</b> <span id="r126 rd" class="r126 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r127 rd" class="r127 r">cmdlet</span>, <b>string</b> <span id="r129 rd" class="r129 r">path</span>)
        {
            <b>if</b> (<a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<a href="#6d03f1c309883dc0" class="i method">TryGetStringArray</a>(<span class="r126 r">obj</span>) == <b>null</b>)
            {
                <span class="r127 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeStringArray</span>, <span class="r128 r">key</span>, <span class="r129 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private static bool</b> <a id="dba380ae0e674837" href="../../../R/dba380ae0e674837.html" target="n" data-glyph="76,1" class="i method">BooleanTypeValidationCallback</a>(<b>string</b> <span id="r130 rd" class="r130 r">key</span>, <b>object</b> <span id="r131 rd" class="r131 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r132 rd" class="r132 r">cmdlet</span>, <b>string</b> <span id="r133 rd" class="r133 r">path</span>)
        {
            <b>if</b> (<span class="r131 r">obj</span> <b>is not bool</b>)
            {
                <span class="r132 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeBoolean</span>, <span class="r130 r">key</span>, <span class="r133 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private static bool</b> <a id="cfeb960def911592" href="../../../R/cfeb960def911592.html" target="n" data-glyph="76,1" class="i method">IntegerTypeValidationCallback</a>(<b>string</b> <span id="r134 rd" class="r134 r">key</span>, <b>object</b> <span id="r135 rd" class="r135 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r136 rd" class="r136 r">cmdlet</span>, <b>string</b> <span id="r137 rd" class="r137 r">path</span>)
        {
            <b>if</b> (<span class="r135 r">obj</span> <b>is not int</b> &amp;&amp; <span class="r135 r">obj</span> <b>is not long</b>)
            {
                <span class="r136 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeInteger</span>, <span class="r134 r">key</span>, <span class="r137 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies that an array contains only string or hashtable elements.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r138 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r139 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r140 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r141 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="7e40e925f1156d5b" href="../../../R/7e40e925f1156d5b.html" target="n" data-glyph="76,1" class="i method">StringOrHashtableArrayTypeValidationCallback</a>(<b>string</b> <span id="r140 rd" class="r140 r">key</span>, <b>object</b> <span id="r138 rd" class="r138 r">obj</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r139 rd" class="r139 r">cmdlet</span>, <b>string</b> <span id="r141 rd" class="r141 r">path</span>)
        {
            <b>if</b> (<a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetObjectsOfType</span>&lt;<b>object</b>&gt;(<span class="r138 r">obj</span>, <b>new</b> <span class="i">Type</span>[] { <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Hashtable</span>) }) == <b>null</b>)
            {
                <span class="r139 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeStringOrHashtableArrayInFile</span>, <span class="r140 r">key</span>, <span class="r141 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> DISC Utilities
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> DISC utilities.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="78aacc47ea72f6a8" href="../../../R/78aacc47ea72f6a8.html" target="n" data-glyph="2,0" class="t t">DISCUtils</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private data
 
        <b>internal static</b> <span class="i">Type</span> <a id="c5524d580e4fe459" href="../../../R/c5524d580e4fe459.html" target="n" data-glyph="44,1" class="i field">ExecutionPolicyType</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> !! NOTE that this list MUST be updated when new capability session configuration properties are added.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static readonly</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt; <a id="7b469b9be06761fc" href="../../../R/7b469b9be06761fc.html" target="n" data-glyph="46,1" class="i field">s_allowedRoleCapabilityKeys</a> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)
        {
            <span class="s">&quot;RoleCapabilities&quot;</span>,
            <span class="s">&quot;RoleCapabilityFiles&quot;</span>,
            <span class="s">&quot;ModulesToImport&quot;</span>,
            <span class="s">&quot;VisibleAliases&quot;</span>,
            <span class="s">&quot;VisibleCmdlets&quot;</span>,
            <span class="s">&quot;VisibleFunctions&quot;</span>,
            <span class="s">&quot;VisibleExternalCommands&quot;</span>,
            <span class="s">&quot;VisibleProviders&quot;</span>,
            <span class="s">&quot;ScriptsToProcess&quot;</span>,
            <span class="s">&quot;AliasDefinitions&quot;</span>,
            <span class="s">&quot;FunctionDefinitions&quot;</span>,
            <span class="s">&quot;VariableDefinitions&quot;</span>,
            <span class="s">&quot;EnvironmentVariables&quot;</span>,
            <span class="s">&quot;TypesToProcess&quot;</span>,
            <span class="s">&quot;FormatsToProcess&quot;</span>,
            <span class="s">&quot;AssembliesToLoad&quot;</span>
        };
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create an ExternalScriptInfo object from a file path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r142 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r143 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r144 r">scriptName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The base name of the script.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The ExternalScriptInfo object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="../../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <a id="cbbec5f551fd0e0c" href="../../../R/cbbec5f551fd0e0c.html" target="n" data-glyph="74,1" class="i method">GetScriptInfoForFile</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r142 rd" class="r142 r">context</span>, <b>string</b> <span id="r143 rd" class="r143 r">fileName</span>, <b>out string</b> <span id="r144 rd" class="r144 r">scriptName</span>)
        {
            <span class="r144 r">scriptName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r143 r">fileName</span>);
            <a href="../../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r145 rd" class="r145 r">scriptInfo</span> = <b>new</b> <a href="../../ExternalScriptInfo.cs.html#0769c91ec3133070" class="t constructor">ExternalScriptInfo</a>(<span class="r144 r">scriptName</span>, <span class="r143 r">fileName</span>, <span class="r142 r">context</span>);
 
            <span class="c">// Skip ShouldRun check for .psd1 files.</span>
            <span class="c">// Use ValidateScriptInfo() for explicitly validating the checkpolicy for psd1 file.</span>
            <span class="c">//</span>
            <b>if</b> (!<span class="r144 r">scriptName</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.psd1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r142 r">context</span>.<a href="../../ExecutionContext.cs.html#d04f29dfc80b1390" class="i property">AuthorizationManager</a>.<a href="../../SecurityManagerBase.cs.html#c0db5055d86375e7" class="i method">ShouldRunInternal</a>(<span class="r145 r">scriptInfo</span>, <a href="../../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>,
                    <span class="r142 r">context</span>.<a href="../../ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>);
 
                <span class="c">// Verify that the PSversion is correct...</span>
                <a href="../../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<a href="../../CommandDiscovery.cs.html#58e17cc89102b795" class="i method">VerifyPSVersion</a>(<span class="r145 r">scriptInfo</span>);
 
                <span class="c">// If we got this far, the check succeeded and we don&#39;t need to check again.</span>
                <span class="r145 r">scriptInfo</span>.<a href="../../ExternalScriptInfo.cs.html#2075d97e6591a1f9" class="i property">SignatureChecked</a> = <b>true</b>;
            }
 
            <b>return</b> <span class="r145 r">scriptInfo</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Loads the configuration file into a hashtable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r146 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r147 r">scriptInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The ExternalScriptInfo object.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Configuration hashtable.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Hashtable</span> <a id="165b977f5f1cf798" href="../../../R/165b977f5f1cf798.html" target="n" data-glyph="74,1" class="i method">LoadConfigFile</a>(<a href="../../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r146 rd" class="r146 r">context</span>, <a href="../../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r147 rd" class="r147 r">scriptInfo</span>)
        {
            <b>object</b> <span id="r148 rd" class="r148 r">result</span>;
            <b>object</b> <span id="r149 rd" class="r149 r">oldPSScriptRoot</span> = <span class="r146 r">context</span>.<a href="../../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>);
            <b>object</b> <span id="r150 rd" class="r150 r">oldPSCommandPath</span> = <span class="r146 r">context</span>.<a href="../../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>);
            <b>try</b>
            {
                <span class="c">// Set the PSScriptRoot variable in the modules session state</span>
                <span class="r146 r">context</span>.<span class="i">SetVariable</span>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>, <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r147 r">scriptInfo</span>.<a href="../../ExternalScriptInfo.cs.html#230a1d73ba5ff5ac" class="i property">Definition</a>));
 
                <span class="r146 r">context</span>.<a href="../../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>, <span class="r147 r">scriptInfo</span>.<a href="../../ExternalScriptInfo.cs.html#230a1d73ba5ff5ac" class="i property">Definition</a>);
 
                <span class="r148 r">result</span> = <a href="../../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r147 r">scriptInfo</span>.<a href="../../ExternalScriptInfo.cs.html#7795a39b7e78fc61" class="i property">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#1a7b06a284505bc5" class="i method">InvokeReturnAsIs</a>());
            }
            <b>finally</b>
            {
                <span class="r146 r">context</span>.<a href="../../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>, <span class="r149 r">oldPSScriptRoot</span>);
                <span class="r146 r">context</span>.<a href="../../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>, <span class="r150 r">oldPSCommandPath</span>);
            }
 
            <b>return</b> <span class="r148 r">result</span> <b>as</b> <span class="i">Hashtable</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies the configuration hashtable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r151 r">table</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Configuration hashtable.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r152 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r153 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if valid, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="3ddabad686bd920d" href="../../../R/3ddabad686bd920d.html" target="n" data-glyph="74,1" class="i method">VerifyConfigTable</a>(<span class="i">Hashtable</span> <span id="r151 rd" class="r151 r">table</span>, <a href="../../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r152 rd" class="r152 r">cmdlet</span>, <b>string</b> <span id="r153 rd" class="r153 r">path</span>)
        {
            <b>bool</b> <span id="r154 rd" class="r154 r">hasSchemaVersion</span> = <b>false</b>;
 
            <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r155 rd" class="r155 r">de</span> <b>in</b> <span class="r151 r">table</span>)
            {
                <b>if</b> (!<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#a4fd3249bdbcdc27" class="i method">IsValidKey</a>(<span class="r155 r">de</span>, <span class="r152 r">cmdlet</span>, <span class="r153 r">path</span>))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <b>if</b> (<span class="r155 r">de</span>.<span class="i">Key</span>.<span class="i">ToString</span>().<span class="i">Equals</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#84e5760daabc0a94" class="i field">SchemaVersion</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r154 r">hasSchemaVersion</span> = <b>true</b>;
                }
            }
 
            <b>if</b> (!<span class="r154 r">hasSchemaVersion</span>)
            {
                <span class="r152 r">cmdlet</span>.<a href="../../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCMissingSchemaVersion</span>, <span class="r153 r">path</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>try</b>
            {
                <a href="#564cb67b7d252b9d" class="i method">ValidateAbsolutePaths</a>(<span class="r152 r">cmdlet</span>.<a href="../../CommandBase.cs.html#5078d443148de142" class="i property">SessionState</a>, <span class="r151 r">table</span>, <span class="r153 r">path</span>);
                <a href="#26973397c620559d" class="i method">ValidateExtensions</a>(<span class="r151 r">table</span>, <span class="r153 r">path</span>);
            }
            <b>catch</b> (<span class="i">InvalidOperationException</span> <span id="r156 rd" class="r156 r">e</span>)
            {
                <span class="r152 r">cmdlet</span>.<span class="i">WriteVerbose</span>(<span class="r156 r">e</span>.<span class="i">Message</span>);
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="504f1c217f711f20" href="../../../R/504f1c217f711f20.html" target="n" data-glyph="76,1" class="i method">ValidatePS1XMLExtension</a>(<b>string</b> <span id="r157 rd" class="r157 r">key</span>, <b>string</b>[] <span id="r158 rd" class="r158 r">paths</span>, <b>string</b> <span id="r159 rd" class="r159 r">filePath</span>)
        {
            <b>if</b> (<span class="r158 r">paths</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>foreach</b> (<b>string</b> <span id="r160 rd" class="r160 r">path</span> <b>in</b> <span class="r158 r">paths</span>)
            {
                <b>try</b>
                {
                    <b>string</b> <span id="r161 rd" class="r161 r">ext</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r160 r">path</span>);
 
                    <b>if</b> (!<span class="r161 r">ext</span>.<span class="i">Equals</span>(<span class="s">&quot;.ps1xml&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCInvalidExtension</span>, <span class="r157 r">key</span>, <span class="r161 r">ext</span>, <span class="s">&quot;.ps1xml&quot;</span>));
                    }
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r162 rd" class="r162 r">argumentException</span>)
                {
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">ErrorParsingTheKeyInPSSessionConfigurationFile</span>, <span class="r157 r">key</span>, <span class="r159 r">filePath</span>), <span class="r162 r">argumentException</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="44d5f0bbad2ae016" href="../../../R/44d5f0bbad2ae016.html" target="n" data-glyph="76,1" class="i method">ValidatePS1OrPSM1Extension</a>(<b>string</b> <span id="r163 rd" class="r163 r">key</span>, <b>string</b>[] <span id="r164 rd" class="r164 r">paths</span>, <b>string</b> <span id="r165 rd" class="r165 r">filePath</span>)
        {
            <b>if</b> (<span class="r164 r">paths</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>foreach</b> (<b>string</b> <span id="r166 rd" class="r166 r">path</span> <b>in</b> <span class="r164 r">paths</span>)
            {
                <b>try</b>
                {
                    <b>string</b> <span id="r167 rd" class="r167 r">ext</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r166 r">path</span>);
 
                    <b>if</b> (!<span class="r167 r">ext</span>.<span class="i">Equals</span>(<a href="../../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../../SessionStateStrings.cs.html#2338784ad03a106f" class="i field">PowerShellScriptFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp;
                        !<span class="r167 r">ext</span>.<span class="i">Equals</span>(<a href="../../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCInvalidExtension</span>, <span class="r163 r">key</span>, <span class="r167 r">ext</span>,
                            <b>string</b>.<span class="i">Join</span>(<span class="s">&quot;, &quot;</span>, <a href="../../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../../SessionStateStrings.cs.html#2338784ad03a106f" class="i field">PowerShellScriptFileExtension</a>, <a href="../../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>)));
                    }
                }
                <b>catch</b> (<span class="i">ArgumentException</span> <span id="r168 rd" class="r168 r">argumentException</span>)
                {
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">ErrorParsingTheKeyInPSSessionConfigurationFile</span>, <span class="r163 r">key</span>, <span class="r165 r">filePath</span>), <span class="r168 r">argumentException</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r169 r">table</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r170 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="26973397c620559d" href="../../../R/26973397c620559d.html" target="n" data-glyph="74,1" class="i method">ValidateExtensions</a>(<span class="i">Hashtable</span> <span id="r169 rd" class="r169 r">table</span>, <b>string</b> <span id="r170 rd" class="r170 r">filePath</span>)
        {
            <b>if</b> (<span class="r169 r">table</span>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>))
            {
                <a href="#504f1c217f711f20" class="i method">ValidatePS1XMLExtension</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>, <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<span class="r169 r">table</span>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>]), <span class="r170 r">filePath</span>);
            }
 
            <b>if</b> (<span class="r169 r">table</span>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>))
            {
                <a href="#504f1c217f711f20" class="i method">ValidatePS1XMLExtension</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>, <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<span class="r169 r">table</span>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>]), <span class="r170 r">filePath</span>);
            }
 
            <b>if</b> (<span class="r169 r">table</span>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>))
            {
                <a href="#44d5f0bbad2ae016" class="i method">ValidatePS1OrPSM1Extension</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>, <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<span class="r169 r">table</span>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>]), <span class="r170 r">filePath</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if all paths are absolute paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r171 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r172 r">table</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r173 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="564cb67b7d252b9d" href="../../../R/564cb67b7d252b9d.html" target="n" data-glyph="74,1" class="i method">ValidateAbsolutePaths</a>(<a href="../../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r171 rd" class="r171 r">state</span>, <span class="i">Hashtable</span> <span id="r172 rd" class="r172 r">table</span>, <b>string</b> <span id="r173 rd" class="r173 r">filePath</span>)
        {
            <b>if</b> (<span class="r172 r">table</span>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>))
            {
                <a href="#f14a0b1ba02500b9" class="i method">ValidateAbsolutePath</a>(<span class="r171 r">state</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>, <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<span class="r172 r">table</span>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>]), <span class="r173 r">filePath</span>);
            }
 
            <b>if</b> (<span class="r172 r">table</span>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>))
            {
                <a href="#f14a0b1ba02500b9" class="i method">ValidateAbsolutePath</a>(<span class="r171 r">state</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>, <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<span class="r172 r">table</span>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>]), <span class="r173 r">filePath</span>);
            }
 
            <b>if</b> (<span class="r172 r">table</span>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>))
            {
                <a href="#f14a0b1ba02500b9" class="i method">ValidateAbsolutePath</a>(<span class="r171 r">state</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>, <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<span class="r172 r">table</span>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>]), <span class="r173 r">filePath</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if a path is an absolute path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">paths</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="f14a0b1ba02500b9" href="../../../R/f14a0b1ba02500b9.html" target="n" data-glyph="74,1" class="i method">ValidateAbsolutePath</a>(<a href="../../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r175 rd" class="r175 r">state</span>, <b>string</b> <span id="r174 rd" class="r174 r">key</span>, <b>string</b>[] <span id="r176 rd" class="r176 r">paths</span>, <b>string</b> <span id="r177 rd" class="r177 r">filePath</span>)
        {
            <b>if</b> (<span class="r176 r">paths</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>string</b> <span id="r178 rd" class="r178 r">driveName</span>;
            <b>foreach</b> (<b>string</b> <span id="r179 rd" class="r179 r">path</span> <b>in</b> <span class="r176 r">paths</span>)
            {
                <b>if</b> (!<span class="r175 r">state</span>.<a href="../../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../../PathInterfaces.cs.html#c3910a3f433a7068" class="i method">IsPSAbsolute</a>(<span class="r179 r">path</span>, <b>out</b> <span class="r178 r">driveName</span>))
                {
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCPathsMustBeAbsolute</span>, <span class="r174 r">key</span>, <span class="r179 r">path</span>, <span class="r177 r">filePath</span>));
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Validates Role Definition hash entries</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> RoleDefinitions = @{</span>
        <span class="c">///</span><span class="c">     &#39;Everyone&#39; = @{</span>
        <span class="c">///</span><span class="c">         &#39;RoIeCapabilities&#39; = &#39;Basic&#39; };</span>
        <span class="c">///</span><span class="c">     &#39;Administrators&#39; = @{</span>
        <span class="c">///</span><span class="c">         &#39;VisibleCmdlets&#39; = &#39;Get-Process&#39;,&#39;Get-Location&#39;; &#39;VisibleFunctions = &#39;TabExpansion2&#39; } }</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r180 r">roleDefinitions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="8cc5075d2c9e9c19" href="../../../R/8cc5075d2c9e9c19.html" target="n" data-glyph="74,1" class="i method">ValidateRoleDefinitions</a>(<span class="i">IDictionary</span> <span id="r180 rd" class="r180 r">roleDefinitions</span>)
        {
            <b>foreach</b> (<b>var</b> <span id="r181 rd" class="r181 r">roleKey</span> <b>in</b> <span class="r180 r">roleDefinitions</span>.<span class="i">Keys</span>)
            {
                <b>if</b> (<span class="r181 r">roleKey</span> <b>is not string</b>)
                {
                    <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="k">var</a> <span id="r182 rd" class="r182 r">invalidOperationEx</span> = <b>new</b> <span class="t">PSInvalidOperationException</span>(
                        <b>string</b>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidRoleKeyType</span>, <span class="r181 r">roleKey</span>.<span class="i">GetType</span>().<span class="i">FullName</span>));
                    <span class="r182 r">invalidOperationEx</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidRoleKeyType&quot;</span>);
                    <b>throw</b> <span class="r182 r">invalidOperationEx</span>;
                }
 
                <span class="c">//</span>
                <span class="c">// Each role capability in the role definition item should contain a hash table with allowed role capability key.</span>
                <span class="c">//</span>
 
                <span class="i">IDictionary</span> <span id="r183 rd" class="r183 r">roleDefinition</span> = <span class="r180 r">roleDefinitions</span>[<span class="r181 r">roleKey</span>] <b>as</b> <span class="i">IDictionary</span>;
                <b>if</b> (<span class="r183 r">roleDefinition</span> == <b>null</b>)
                {
                    <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="k">var</a> <span id="r184 rd" class="r184 r">invalidOperationEx</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(
                        <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidRoleValue</span>, <span class="r181 r">roleKey</span>));
                    <span class="r184 r">invalidOperationEx</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidRoleEntryNotHashtable&quot;</span>);
                    <b>throw</b> <span class="r184 r">invalidOperationEx</span>;
                }
 
                <b>foreach</b> (<b>var</b> <span id="r185 rd" class="r185 r">key</span> <b>in</b> <span class="r183 r">roleDefinition</span>.<span class="i">Keys</span>)
                {
                    <span class="c">// Ensure each role capability key is valid.</span>
                    <b>string</b> <span id="r186 rd" class="r186 r">roleCapabilityKey</span> = <span class="r185 r">key</span> <b>as string</b>;
                    <b>if</b> (<span class="r186 r">roleCapabilityKey</span> == <b>null</b>)
                    {
                        <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="k">var</a> <span id="r187 rd" class="r187 r">invalidOperationEx</span> = <b>new</b> <span class="t">PSInvalidOperationException</span>(
                            <b>string</b>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidRoleCapabilityKeyType</span>, <span class="r185 r">key</span>.<span class="i">GetType</span>().<span class="i">FullName</span>));
                        <span class="r187 r">invalidOperationEx</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidRoleCapabilityKeyType&quot;</span>);
                        <b>throw</b> <span class="r187 r">invalidOperationEx</span>;
                    }
 
                    <b>if</b> (!<a href="#7b469b9be06761fc" class="i field">s_allowedRoleCapabilityKeys</a>.<span class="i">Contains</span>(<span class="r186 r">roleCapabilityKey</span>))
                    {
                        <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="k">var</a> <span id="r188 rd" class="r188 r">invalidOperationEx</span> = <b>new</b> <span class="t">PSInvalidOperationException</span>(
                            <b>string</b>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidRoleCapabilityKey</span>, <span class="r186 r">roleCapabilityKey</span>));
                        <span class="r188 r">invalidOperationEx</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidRoleCapabilityKey&quot;</span>);
                        <b>throw</b> <span class="r188 r">invalidOperationEx</span>;
                    }
                }
            }
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Creates an initial session state based on the configuration language for PSSC files.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal sealed class</b> <a id="fc3ecbf6d041a5ca" href="../../../R/fc3ecbf6d041a5ca.html" target="n" data-glyph="2,0" class="t t">DISCPowerShellConfiguration</a> : <a href="#e35ba0e017aa5d6d" class="t t">PSSessionConfiguration</a>
    {
        <b>private readonly string</b> <a id="b746afdadb3c4679" href="../../../R/b746afdadb3c4679.html" target="n" data-glyph="46,1" class="i field">_configFile</a>;
        <b>private readonly</b> <span class="i">Hashtable</span> <a id="28a5a5119646d21b" href="../../../R/28a5a5119646d21b.html" target="n" data-glyph="46,1" class="i field">_configHash</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the configuration hashtable that results from parsing the specified configuration file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Hashtable</span> <a id="7bf36892a5fa2ca3" href="../../../R/7bf36892a5fa2ca3.html" target="n" data-glyph="104,1" class="i property">ConfigHash</a>
        {
            <b>get</b> { <b>return</b> <a href="#28a5a5119646d21b" class="i field">_configHash</a>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new instance of a Declarative Initial Session State Configuration.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r189 r">configFile</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the .pssc file representing the initial session state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">roleVerifier</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The verifier that PowerShell should call to determine if groups in the Role entry apply to the</span>
        <span class="c">///</span><span class="c"> target session. If you have a WindowsPrincipal for a user, for example, create a Function that</span>
        <span class="c">///</span><span class="c"> checks windowsPrincipal.IsInRole().</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="13640ca6a221c25b" href="../../../R/13640ca6a221c25b.html" target="n" data-glyph="74,1" class="t constructor">DISCPowerShellConfiguration</a>(<b>string</b> <span id="r189 rd" class="r189 r">configFile</span>, <span class="i">Func</span>&lt;<b>string</b>, <b>bool</b>&gt; <span id="r190 rd" class="r190 r">roleVerifier</span>)
        {
            <a href="#b746afdadb3c4679" class="i field">_configFile</a> = <span class="r189 r">configFile</span>;
            <b>if</b> (<span class="r190 r">roleVerifier</span> == <b>null</b>)
            {
                <span class="r190 r">roleVerifier</span> = <b>static</b> (<span id="r191 rd" class="r191 r">role</span>) =&gt; <b>false</b>;
            }
 
            <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r192 rd" class="r192 r">backupRunspace</span> = <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>;
 
            <b>try</b>
            {
                <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a> = <a href="../../hostifaces/ConnectionFactory.cs.html#c5fbe142e4e21218" class="t t">RunspaceFactory</a>.<a href="../../hostifaces/ConnectionFactory.cs.html#d1898b5d69d8413b" class="i method">CreateRunspace</a>();
                <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>.<a href="../../hostifaces/Connection.cs.html#61f55439fb78f2fe" class="i method">Open</a>();
 
                <b>string</b> <span id="r193 rd" class="r193 r">scriptName</span>;
                <a href="../../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r194 rd" class="r194 r">script</span> = <a href="#78aacc47ea72f6a8" class="t t">DISCUtils</a>.<a href="#cbbec5f551fd0e0c" class="i method">GetScriptInfoForFile</a>(<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>,
                    <span class="r189 r">configFile</span>, <b>out</b> <span class="r193 r">scriptName</span>);
 
                <a href="#28a5a5119646d21b" class="i field">_configHash</a> = <a href="#78aacc47ea72f6a8" class="t t">DISCUtils</a>.<a href="#165b977f5f1cf798" class="i method">LoadConfigFile</a>(<a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>.<a href="../../hostifaces/Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>, <span class="r194 r">script</span>);
                <a href="#bb18243db80a6e9c" class="i method">MergeRoleRulesIntoConfigHash</a>(<span class="r190 r">roleVerifier</span>);
                <a href="#36e976eb31bd426c" class="i method">MergeRoleCapabilitiesIntoConfigHash</a>();
 
                <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a>.<a href="../../hostifaces/Connection.cs.html#e7b6aa3b7b07847b" class="i method">Close</a>();
            }
            <b>catch</b> (<a href="../../MshSecurityException.cs.html#4b73a09ff18e1e39" class="t t">PSSecurityException</a> <span id="r195 rd" class="r195 r">e</span>)
            {
                <b>string</b> <span id="r196 rd" class="r196 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidPSSessionConfigurationFilePath</span>, <span class="r189 r">configFile</span>);
                <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r197 rd" class="r197 r">ioe</span> = <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="r196 r">message</span>, <span class="r195 r">e</span>);
                <span class="r197 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidPSSessionConfigurationFilePath&quot;</span>);
 
                <b>throw</b> <span class="r197 r">ioe</span>;
            }
            <b>finally</b>
            {
                <a href="../../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>.<a href="../../hostifaces/Connection.cs.html#efcd2ba43103de17" class="i property">DefaultRunspace</a> = <span class="r192 r">backupRunspace</span>;
            }
        }
 
        <span class="c">// Takes the &quot;Roles&quot; node in the config hash, and merges all that apply into the base configuration.</span>
        <b>private void</b> <a id="bb18243db80a6e9c" href="../../../R/bb18243db80a6e9c.html" target="n" data-glyph="76,1" class="i method">MergeRoleRulesIntoConfigHash</a>(<span class="i">Func</span>&lt;<b>string</b>, <b>bool</b>&gt; <span id="r198 rd" class="r198 r">roleVerifier</span>)
        {
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#046aa0715b0841ad" class="i field">RoleDefinitions</a>))
            {
                <span class="c">// Extract the &#39;Roles&#39; hashtable</span>
                <span class="i">IDictionary</span> <span id="r199 rd" class="r199 r">roleEntry</span> = <a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#046aa0715b0841ad" class="i field">RoleDefinitions</a>] <b>as</b> <span class="i">IDictionary</span>;
                <b>if</b> (<span class="r199 r">roleEntry</span> == <b>null</b>)
                {
                    <b>string</b> <span id="r200 rd" class="r200 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidRoleEntry</span>, <a href="#28a5a5119646d21b" class="i field">_configHash</a>[<span class="s">&quot;Roles&quot;</span>].<span class="i">GetType</span>().<span class="i">FullName</span>);
                    <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r201 rd" class="r201 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r200 r">message</span>);
                    <span class="r201 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidRoleDefinitionNotHashtable&quot;</span>);
                    <b>throw</b> <span class="r201 r">ioe</span>;
                }
 
                <span class="c">// Ensure that role definitions contain valid entries.</span>
                <a href="#78aacc47ea72f6a8" class="t t">DISCUtils</a>.<a href="#8cc5075d2c9e9c19" class="i method">ValidateRoleDefinitions</a>(<span class="r199 r">roleEntry</span>);
 
                <span class="c">// Go through the Roles hashtable</span>
                <b>foreach</b> (<b>object</b> <span id="r202 rd" class="r202 r">role</span> <b>in</b> <span class="r199 r">roleEntry</span>.<span class="i">Keys</span>)
                {
                    <span class="c">// Check if this role applies to the connected user</span>
                    <b>if</b> (<span class="r198 r">roleVerifier</span>(<span class="r202 r">role</span>.<span class="i">ToString</span>()))
                    {
                        <span class="c">// Extract their specific configuration</span>
                        <span class="i">IDictionary</span> <span id="r203 rd" class="r203 r">roleCustomizations</span> = <span class="r199 r">roleEntry</span>[<span class="r202 r">role</span>] <b>as</b> <span class="i">IDictionary</span>;
 
                        <b>if</b> (<span class="r203 r">roleCustomizations</span> == <b>null</b>)
                        {
                            <b>string</b> <span id="r204 rd" class="r204 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidRoleValue</span>, <span class="r202 r">role</span>.<span class="i">ToString</span>());
                            <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r205 rd" class="r205 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r204 r">message</span>);
                            <span class="r205 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidRoleValueNotHashtable&quot;</span>);
                            <b>throw</b> <span class="r205 r">ioe</span>;
                        }
 
                        <a href="#1abc70d518c81816" class="i method">MergeConfigHashIntoConfigHash</a>(<span class="r203 r">roleCustomizations</span>);
                    }
                }
            }
        }
 
        <span class="c">// Takes the &quot;RoleCapabilities&quot; node in the config hash, and merges its values into the base configuration.</span>
        <b>private const string</b> <a id="b00fd8cb2878a528" href="../../../R/b00fd8cb2878a528.html" target="n" data-glyph="10,1" class="i field">PSRCExtension</a> = <span class="s">&quot;.psrc&quot;</span>;
 
        <b>private void</b> <a id="36e976eb31bd426c" href="../../../R/36e976eb31bd426c.html" target="n" data-glyph="76,1" class="i method">MergeRoleCapabilitiesIntoConfigHash</a>()
        {
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r206 rd" class="r206 r">psrcFiles</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#37c0d6feb9f37778" class="i field">RoleCapabilities</a>))
            {
                <b>string</b>[] <span id="r207 rd" class="r207 r">roleCapabilities</span> = <span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#37c0d6feb9f37778" class="i field">RoleCapabilities</a>]);
 
                <b>if</b> (<span class="r207 r">roleCapabilities</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r208 rd" class="r208 r">roleCapability</span> <b>in</b> <span class="r207 r">roleCapabilities</span>)
                    {
                        <b>string</b> <span id="r209 rd" class="r209 r">roleCapabilityPath</span> = <a href="#a5e160b166e0fcbf" class="i method">GetRoleCapabilityPath</a>(<span class="r208 r">roleCapability</span>);
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r209 r">roleCapabilityPath</span>))
                        {
                            <b>string</b> <span id="r210 rd" class="r210 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">CouldNotFindRoleCapability</span>, <span class="r208 r">roleCapability</span>, <span class="r208 r">roleCapability</span> + <a href="#b00fd8cb2878a528" class="i field">PSRCExtension</a>);
                            <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r211 rd" class="r211 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r210 r">message</span>);
                            <span class="r211 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;CouldNotFindRoleCapability&quot;</span>);
                            <b>throw</b> <span class="r211 r">ioe</span>;
                        }
 
                        <span class="r206 r">psrcFiles</span>.<span class="i">Add</span>(<span class="r209 r">roleCapabilityPath</span>);
                    }
                }
            }
 
            <b>if</b> (<a href="#7bf36892a5fa2ca3" class="i property">ConfigHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#099a9beea82f9d25" class="i field">RoleCapabilityFiles</a>))
            {
                <b>string</b>[] <span id="r212 rd" class="r212 r">roleCapabilityFiles</span> = <span class="i">TryGetStringArray</span>(<a href="#7bf36892a5fa2ca3" class="i property">ConfigHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#099a9beea82f9d25" class="i field">RoleCapabilityFiles</a>]);
                <b>if</b> (<span class="r212 r">roleCapabilityFiles</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r213 rd" class="r213 r">roleCapabilityFilePath</span> <b>in</b> <span class="r212 r">roleCapabilityFiles</span>)
                    {
                        <b>if</b> (!<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r213 r">roleCapabilityFilePath</span>).<span class="i">Equals</span>(<a href="#b00fd8cb2878a528" class="i field">PSRCExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>string</b> <span id="r214 rd" class="r214 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">InvalidRoleCapabilityFileExtension</span>, <span class="r213 r">roleCapabilityFilePath</span>);
                            <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r215 rd" class="r215 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r214 r">message</span>);
                            <span class="r215 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidRoleCapabilityFileExtension&quot;</span>);
                            <b>throw</b> <span class="r215 r">ioe</span>;
                        }
 
                        <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r213 r">roleCapabilityFilePath</span>))
                        {
                            <b>string</b> <span id="r216 rd" class="r216 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">CouldNotFindRoleCapabilityFile</span>, <span class="r213 r">roleCapabilityFilePath</span>);
                            <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r217 rd" class="r217 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r216 r">message</span>);
                            <span class="r217 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;CouldNotFindRoleCapabilityFile&quot;</span>);
                            <b>throw</b> <span class="r217 r">ioe</span>;
                        }
 
                        <span class="r206 r">psrcFiles</span>.<span class="i">Add</span>(<span class="r213 r">roleCapabilityFilePath</span>);
                    }
                }
            }
 
            <b>foreach</b> (<b>var</b> <span id="r218 rd" class="r218 r">roleCapabilityFile</span> <b>in</b> <span class="r206 r">psrcFiles</span>)
            {
                <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a> <span id="r219 rd" class="r219 r">roleCapabilityConfiguration</span> = <b>new</b> <span class="t">DISCPowerShellConfiguration</span>(<span class="r218 r">roleCapabilityFile</span>, <b>null</b>);
                <span class="i">IDictionary</span> <span id="r220 rd" class="r220 r">roleCapabilityConfigurationItems</span> = <span class="r219 r">roleCapabilityConfiguration</span>.<a href="#7bf36892a5fa2ca3" class="i property">ConfigHash</a>;
                <a href="#1abc70d518c81816" class="i method">MergeConfigHashIntoConfigHash</a>(<span class="r220 r">roleCapabilityConfigurationItems</span>);
            }
        }
 
        <span class="c">// Merge a role / role capability hashtable into the master configuration hashtable</span>
        <b>private void</b> <a id="1abc70d518c81816" href="../../../R/1abc70d518c81816.html" target="n" data-glyph="76,1" class="i method">MergeConfigHashIntoConfigHash</a>(<span class="i">IDictionary</span> <span id="r221 rd" class="r221 r">childConfigHash</span>)
        {
            <b>foreach</b> (<b>object</b> <span id="r222 rd" class="r222 r">customization</span> <b>in</b> <span class="r221 r">childConfigHash</span>.<span class="i">Keys</span>)
            {
                <b>string</b> <span id="r223 rd" class="r223 r">customizationString</span> = <span class="r222 r">customization</span>.<span class="i">ToString</span>();
 
                <b>var</b> <span id="r224 rd" class="r224 r">customizationValue</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
 
                <span class="c">// First, take all values from the master config table</span>
                <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<span class="r223 r">customizationString</span>))
                {
                    <span class="i">IEnumerable</span> <span id="r225 rd" class="r225 r">existingValueAsCollection</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<span class="r222 r">customization</span>]);
                    <b>if</b> (<span class="r225 r">existingValueAsCollection</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<b>object</b> <span id="r226 rd" class="r226 r">value</span> <b>in</b> <span class="r225 r">existingValueAsCollection</span>)
                        {
                            <span class="r224 r">customizationValue</span>.<span class="i">Add</span>(<span class="r226 r">value</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r224 r">customizationValue</span>.<span class="i">Add</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<span class="r222 r">customization</span>]);
                    }
                }
 
                <span class="c">// Then add the current role&#39;s values</span>
                <span class="i">IEnumerable</span> <span id="r227 rd" class="r227 r">newValueAsCollection</span> = <a href="../../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">GetEnumerable</span>(<span class="r221 r">childConfigHash</span>[<span class="r222 r">customization</span>]);
                <b>if</b> (<span class="r227 r">newValueAsCollection</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>object</b> <span id="r228 rd" class="r228 r">value</span> <b>in</b> <span class="r227 r">newValueAsCollection</span>)
                    {
                        <span class="r224 r">customizationValue</span>.<span class="i">Add</span>(<span class="r228 r">value</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="r224 r">customizationValue</span>.<span class="i">Add</span>(<span class="r221 r">childConfigHash</span>[<span class="r222 r">customization</span>]);
                }
 
                <span class="c">// Now update the config table for this role.</span>
                <a href="#28a5a5119646d21b" class="i field">_configHash</a>[<span class="r222 r">customization</span>] = <span class="r224 r">customizationValue</span>.<span class="i">ToArray</span>();
            }
        }
 
        <b>private static string</b> <a id="a5e160b166e0fcbf" href="../../../R/a5e160b166e0fcbf.html" target="n" data-glyph="76,1" class="i method">GetRoleCapabilityPath</a>(<b>string</b> <span id="r229 rd" class="r229 r">roleCapability</span>)
        {
            <b>string</b> <span id="r230 rd" class="r230 r">moduleName</span> = <span class="s">&quot;*&quot;</span>;
            <b>if</b> (<span class="r229 r">roleCapability</span>.<span class="i">Contains</span>(<span class="s">&#39;\\&#39;</span>))
            {
                <b>string</b>[] <span id="r231 rd" class="r231 r">components</span> = <span class="r229 r">roleCapability</span>.<span class="i">Split</span>(<a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../../Utils.cs.html#247bb446a0dd1494" class="i field">Backslash</a>, 2);
                <span class="r230 r">moduleName</span> = <span class="r231 r">components</span>[0];
                <span class="r229 r">roleCapability</span> = <span class="r231 r">components</span>[1];
            }
 
            <span class="c">// Go through each directory in the module path</span>
            <b>string</b>[] <span id="r232 rd" class="r232 r">modulePaths</span> = <a href="../../Modules/ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="../../Modules/ModuleIntrinsics.cs.html#e115fa8139f74585" class="i method">GetModulePath</a>().<span class="i">Split</span>(<a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../../Utils.cs.html#016bc808c2acadd4" class="i field">PathSeparator</a>);
            <b>foreach</b> (<b>string</b> <span id="r233 rd" class="r233 r">path</span> <b>in</b> <span class="r232 r">modulePaths</span>)
            {
                <b>try</b>
                {
                    <span class="c">// And then each module in that directory</span>
                    <b>foreach</b> (<b>string</b> <span id="r234 rd" class="r234 r">directory</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateDirectories</span>(<span class="r233 r">path</span>, <span class="r230 r">moduleName</span>))
                    {
                        <b>string</b> <span id="r235 rd" class="r235 r">roleCapabilitiesPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r234 r">directory</span>, <span class="s">&quot;RoleCapabilities&quot;</span>);
                        <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r235 r">roleCapabilitiesPath</span>))
                        {
                            <span class="c">// If the role capabilities directory exists, look for .psrc files with the role capability name</span>
                            <b>foreach</b> (<b>string</b> <span id="r236 rd" class="r236 r">roleCapabilityPath</span> <b>in</b> <span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<span class="r235 r">roleCapabilitiesPath</span>, <span class="r229 r">roleCapability</span> + <span class="s">&quot;.psrc&quot;</span>))
                            {
                                <b>return</b> <span class="r236 r">roleCapabilityPath</span>;
                            }
                        }
                    }
                }
                <b>catch</b> (<span class="i">IOException</span>)
                {
                    <span class="c">// Could not enumerate the directories for a broken module path element. Just try the next.</span>
                }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span>)
                {
                    <span class="c">// Could not enumerate the directories for a broken module path element. Just try the next.</span>
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates an initial session state from a configuration file (DISC)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r237 r">senderInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <a id="9189a516bf555054" href="../../../R/9189a516bf555054.html" target="n" data-glyph="72,1" class="i method">GetInitialSessionState</a>(<a href="PSPrincipal.cs.html#eeedcf9113508cb9" class="t t">PSSenderInfo</a> <span id="r237 rd" class="r237 r">senderInfo</span>)
        {
            <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r238 rd" class="r238 r">iss</span> = <b>null</b>;
 
            <span class="c">// Create the initial session state</span>
            <b>string</b> <span id="r239 rd" class="r239 r">initialSessionState</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#a5bcbefb030c8e02" class="i field">SessionType</a>);
            <a href="#193eb55ce6b6bb37" class="t t">SessionType</a> <span id="r240 rd" class="r240 r">sessionType</span> = <a href="#193eb55ce6b6bb37" class="t t">SessionType</a>.<a href="#cf7ca89ea220b2f6" class="i field">Default</a>;
            <b>bool</b> <span id="r241 rd" class="r241 r">cmdletVisibilityApplied</span> = <a href="#77114572936e0bd6" class="i method">IsNonDefaultVisibilitySpecified</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f35a94fa18c56045" class="i field">VisibleCmdlets</a>);
            <b>bool</b> <span id="r242 rd" class="r242 r">functionVisibilityApplied</span> = <a href="#77114572936e0bd6" class="i method">IsNonDefaultVisibilitySpecified</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#6a2144eb8017892d" class="i field">VisibleFunctions</a>);
            <b>bool</b> <span id="r243 rd" class="r243 r">aliasVisibilityApplied</span> = <a href="#77114572936e0bd6" class="i method">IsNonDefaultVisibilitySpecified</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#3ae92ee7773a9e6a" class="i field">VisibleAliases</a>);
            <b>bool</b> <span id="r244 rd" class="r244 r">providerVisibilityApplied</span> = <a href="#77114572936e0bd6" class="i method">IsNonDefaultVisibilitySpecified</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#4187c2fa3d874c86" class="i field">VisibleProviders</a>);
            <b>bool</b> <span id="r245 rd" class="r245 r">processDefaultSessionStateVisibility</span> = <b>false</b>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r239 r">initialSessionState</span>))
            {
                <span class="r240 r">sessionType</span> = (<a href="#193eb55ce6b6bb37" class="t t">SessionType</a>)<span class="i">Enum</span>.<span class="i">Parse</span>(<b>typeof</b>(<a href="#193eb55ce6b6bb37" class="t t">SessionType</a>), <span class="r239 r">initialSessionState</span>, <b>true</b>);
 
                <b>if</b> (<span class="r240 r">sessionType</span> == <a href="#193eb55ce6b6bb37" class="t t">SessionType</a>.<a href="#ad1552dbcd977f30" class="i field">Empty</a>)
                {
                    <span class="r238 r">iss</span> = <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#6aee0258f9ef7599" class="i method">Create</a>();
                }
                <b>else</b> <b>if</b> (<span class="r240 r">sessionType</span> == <a href="#193eb55ce6b6bb37" class="t t">SessionType</a>.<a href="#7ece31798a0d7d7a" class="i field">RestrictedRemoteServer</a>)
                {
                    <span class="r238 r">iss</span> = <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#307c0a1bbe64082c" class="i method">CreateRestricted</a>(<a href="../../CommandMetadata.cs.html#bb52d235a01f7719" class="t t">SessionCapabilities</a>.<a href="../../CommandMetadata.cs.html#b2234cfd6d5d5d27" class="i field">RemoteServer</a>);
                }
                <b>else</b>
                {
                    <span class="r238 r">iss</span> = <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#904bc85f721c6764" class="i method">CreateDefault2</a>();
                    <span class="r245 r">processDefaultSessionStateVisibility</span> = <b>true</b>;
                }
            }
            <b>else</b>
            {
                <span class="r238 r">iss</span> = <a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#904bc85f721c6764" class="i method">CreateDefault2</a>();
                <span class="r245 r">processDefaultSessionStateVisibility</span> = <b>true</b>;
            }
 
            <b>if</b> (<span class="r241 r">cmdletVisibilityApplied</span> || <span class="r242 r">functionVisibilityApplied</span> || <span class="r243 r">aliasVisibilityApplied</span> || <span class="r244 r">providerVisibilityApplied</span> ||
                <a href="#77114572936e0bd6" class="i method">IsNonDefaultVisibilitySpecified</a>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#691bb9c10d14bdef" class="i field">VisibleExternalCommands</a>))
            {
                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#cef2c573c113a1c8" class="i property">DefaultCommandVisibility</a> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
 
                <span class="c">// If visibility is applied on a default runspace then set initial ISS</span>
                <span class="c">// commands visibility to private.</span>
                <b>if</b> (<span class="r245 r">processDefaultSessionStateVisibility</span>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r246 rd" class="r246 r">cmd</span> <b>in</b> <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>)
                    {
                        <span class="r246 r">cmd</span>.<span class="i">Visibility</span> = <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#cef2c573c113a1c8" class="i property">DefaultCommandVisibility</a>;
                    }
                }
            }
 
            <span class="c">// Add providers</span>
            <b>if</b> (<span class="r244 r">providerVisibilityApplied</span>)
            {
                <b>string</b>[] <span id="r247 rd" class="r247 r">providers</span> = <span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#4187c2fa3d874c86" class="i field">VisibleProviders</a>]);
 
                <b>if</b> (<span class="r247 r">providers</span> != <b>null</b>)
                {
                    <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>.<span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r248 rd" class="r248 r">addedProviders</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                    <b>foreach</b> (<b>string</b> <span id="r249 rd" class="r249 r">provider</span> <b>in</b> <span class="r247 r">providers</span>)
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r249 r">provider</span>))
                        {
                            <span class="c">// Look up providers from provider name including wildcards.</span>
                            <b>var</b> <span id="r250 rd" class="r250 r">providersFound</span> = <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#901a2e8b67c4db16" class="i property">Providers</a>.<a href="../../InitialSessionState.cs.html#f4cd69ee4353c4ac" class="i method">LookUpByName</a>(<span class="r249 r">provider</span>);
 
                            <b>foreach</b> (<b>var</b> <span id="r251 rd" class="r251 r">providerFound</span> <b>in</b> <span class="r250 r">providersFound</span>)
                            {
                                <b>if</b> (!<span class="r248 r">addedProviders</span>.<span class="i">Contains</span>(<span class="r251 r">providerFound</span>.<span class="i">Name</span>))
                                {
                                    <span class="r248 r">addedProviders</span>.<span class="i">Add</span>(<span class="r251 r">providerFound</span>.<span class="i">Name</span>);
                                    <span class="r251 r">providerFound</span>.<span class="i">Visibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>;
                                }
                            }
                        }
                    }
                }
            }
 
            <span class="c">// Add assemblies and modules);</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#681f01148717d80f" class="i field">AssembliesToLoad</a>))
            {
                <b>string</b>[] <span id="r252 rd" class="r252 r">assemblies</span> = <span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#681f01148717d80f" class="i field">AssembliesToLoad</a>]);
 
                <b>if</b> (<span class="r252 r">assemblies</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r253 rd" class="r253 r">assembly</span> <b>in</b> <span class="r252 r">assemblies</span>)
                    {
                        <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#501914944d122594" class="i property">Assemblies</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <a href="../../InitialSessionState.cs.html#63e4668395cc229c" class="t constructor">SessionStateAssemblyEntry</a>(<span class="r253 r">assembly</span>));
                    }
                }
            }
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#815af157370a682b" class="i field">ModulesToImport</a>))
            {
                <b>object</b>[] <span id="r254 rd" class="r254 r">modules</span> = <span class="i">TryGetObjectsOfType</span>&lt;<b>object</b>&gt;(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#815af157370a682b" class="i field">ModulesToImport</a>],
                                                               <b>new</b> <span class="i">Type</span>[] { <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Hashtable</span>) });
                <b>if</b> ((<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#815af157370a682b" class="i field">ModulesToImport</a>] != <b>null</b>) &amp;&amp; (<span class="r254 r">modules</span> == <b>null</b>))
                {
                    <b>string</b> <span id="r255 rd" class="r255 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeStringOrHashtableArray</span>,
                        <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#815af157370a682b" class="i field">ModulesToImport</a>);
                    <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r256 rd" class="r256 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r255 r">message</span>);
                    <span class="r256 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidModulesToImportKeyEntries&quot;</span>);
 
                    <b>throw</b> <span class="r256 r">ioe</span>;
                }
 
                <b>if</b> (<span class="r254 r">modules</span> != <b>null</b>)
                {
                    <span class="i">Collection</span>&lt;<a href="../../Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r257 rd" class="r257 r">modulesToImport</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="../../Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;();
                    <b>foreach</b> (<b>object</b> <span id="r258 rd" class="r258 r">module</span> <b>in</b> <span class="r254 r">modules</span>)
                    {
                        <a href="../../Modules/ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r259 rd" class="r259 r">moduleSpec</span> = <b>null</b>;
                        <b>string</b> <span id="r260 rd" class="r260 r">moduleName</span> = <span class="r258 r">module</span> <b>as string</b>;
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r260 r">moduleName</span>))
                        {
                            <span class="r259 r">moduleSpec</span> = <b>new</b> <a href="../../Modules/ModuleSpecification.cs.html#8bf2c91f2abc8759" class="t constructor">ModuleSpecification</a>(<span class="r260 r">moduleName</span>);
                        }
                        <b>else</b>
                        {
                            <span class="i">Hashtable</span> <span id="r261 rd" class="r261 r">moduleHash</span> = <span class="r258 r">module</span> <b>as</b> <span class="i">Hashtable</span>;
                            <b>if</b> (<span class="r261 r">moduleHash</span> != <b>null</b>)
                            {
                                <span class="r259 r">moduleSpec</span> = <b>new</b> <a href="../../Modules/ModuleSpecification.cs.html#e40ff4979fd4b540" class="t constructor">ModuleSpecification</a>(<span class="r261 r">moduleHash</span>);
                            }
                        }
 
                        <span class="c">// Now add the moduleSpec to modulesToImport</span>
                        <b>if</b> (<span class="r259 r">moduleSpec</span> != <b>null</b>)
                        {
                            <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#b79f06e1ca564512" class="i field">CoreModule</a>, <span class="r259 r">moduleSpec</span>.<a href="../../Modules/ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>,
                                              <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <b>if</b> (<span class="r240 r">sessionType</span> == <a href="#193eb55ce6b6bb37" class="t t">SessionType</a>.<a href="#ad1552dbcd977f30" class="i field">Empty</a>)
                                {
                                    <span class="c">// Win8: 627752 Cannot load microsoft.powershell.core module as part of DISC</span>
                                    <span class="c">// Convert Microsoft.PowerShell.Core module -&gt; Microsoft.PowerShell.Core snapin.</span>
                                    <span class="c">// Doing this Import only in SessionType.Empty case, because other cases already do this.</span>
                                    <span class="c">// In V3, Microsoft.PowerShell.Core module is not installed externally.</span>
                                    <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2596e8ca74c2f5f0" class="i method">ImportCorePSSnapIn</a>();
                                }
                                <span class="c">// silently ignore Microsoft.PowerShell.Core for other cases ie., SessionType.RestrictedRemoteServer &amp;&amp; SessionType.Default</span>
                            }
                            <b>else</b>
                            {
                                <span class="r257 r">modulesToImport</span>.<span class="i">Add</span>(<span class="r259 r">moduleSpec</span>);
                            }
                        }
                    }
 
                    <span class="r238 r">iss</span>.<span class="i">ImportPSModule</span>(<span class="r257 r">modulesToImport</span>);
                }
            }
 
            <span class="c">// Define members</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f35a94fa18c56045" class="i field">VisibleCmdlets</a>))
            {
                <b>object</b>[] <span id="r262 rd" class="r262 r">cmdlets</span> = <span class="i">TryGetObjectsOfType</span>&lt;<b>object</b>&gt;(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f35a94fa18c56045" class="i field">VisibleCmdlets</a>],
                                                               <b>new</b> <span class="i">Type</span>[] { <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Hashtable</span>) });
 
                <b>if</b> (<span class="r262 r">cmdlets</span> == <b>null</b>)
                {
                    <b>string</b> <span id="r263 rd" class="r263 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeStringOrHashtableArray</span>,
                        <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f35a94fa18c56045" class="i field">VisibleCmdlets</a>);
                    <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r264 rd" class="r264 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r263 r">message</span>);
                    <span class="r264 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidVisibleCmdletsKeyEntries&quot;</span>);
 
                    <b>throw</b> <span class="r264 r">ioe</span>;
                }
 
                <a href="#9bae01ffbb29f21c" class="i method">ProcessVisibleCommands</a>(<span class="r238 r">iss</span>, <span class="r262 r">cmdlets</span>);
            }
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#c5bd5765181feeac" class="i field">AliasDefinitions</a>))
            {
                <span class="i">Hashtable</span>[] <span id="r265 rd" class="r265 r">aliases</span> = <span class="i">TryGetHashtableArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#c5bd5765181feeac" class="i field">AliasDefinitions</a>]);
 
                <b>if</b> (<span class="r265 r">aliases</span> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">Hashtable</span> <span id="r266 rd" class="r266 r">alias</span> <b>in</b> <span class="r265 r">aliases</span>)
                    {
                        <a href="../../InitialSessionState.cs.html#3164e16488ced1ed" class="t t">SessionStateAliasEntry</a> <span id="r267 rd" class="r267 r">entry</span> = <a href="#aa848a085dae1690" class="i method">CreateSessionStateAliasEntry</a>(<span class="r266 r">alias</span>, <span class="r243 r">aliasVisibilityApplied</span>);
 
                        <b>if</b> (<span class="r267 r">entry</span> != <b>null</b>)
                        {
                            <span class="c">// Indexing iss.Commands with a command that does not exist returns &#39;null&#39;, rather</span>
                            <span class="c">// than some sort of KeyNotFound exception.</span>
                            <b>if</b> (<span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a><a href="../../InitialSessionState.cs.html#8a6a2b8d34f0d716">[</a><span class="r267 r">entry</span>.<a href="../../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>] != <b>null</b>)
                            {
                                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<span class="i">Remove</span>(<span class="r267 r">entry</span>.<a href="../../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>, <b>typeof</b>(<a href="../../InitialSessionState.cs.html#3164e16488ced1ed" class="t t">SessionStateAliasEntry</a>));
                            }
 
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<span class="r267 r">entry</span>);
                        }
                    }
                }
            }
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#3ae92ee7773a9e6a" class="i field">VisibleAliases</a>))
            {
                <b>string</b>[] <span id="r268 rd" class="r268 r">aliases</span> = <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#3ae92ee7773a9e6a" class="i field">VisibleAliases</a>]);
 
                <b>if</b> (<span class="r268 r">aliases</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r269 rd" class="r269 r">alias</span> <b>in</b> <span class="r268 r">aliases</span>)
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r269 r">alias</span>))
                        {
                            <b>bool</b> <span id="r270 rd" class="r270 r">found</span> = <b>false</b>;
 
                            <span class="c">// Look up aliases using alias name including wildcards.</span>
                            <span class="i">Collection</span>&lt;<a href="../../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a>&gt; <span id="r271 rd" class="r271 r">existingEntries</span> = <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#f4cd69ee4353c4ac" class="i method">LookUpByName</a>(<span class="r269 r">alias</span>);
                            <b>foreach</b> (<a href="../../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a> <span id="r272 rd" class="r272 r">existingEntry</span> <b>in</b> <span class="r271 r">existingEntries</span>)
                            {
                                <b>if</b> (<span class="r272 r">existingEntry</span>.<a href="../../InitialSessionState.cs.html#b86d5dd7cdc3f952" class="i property">CommandType</a> == <a href="../../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../../CommandInfo.cs.html#83aa5e1f88cb9bf5" class="i field">Alias</a>)
                                {
                                    <span class="r272 r">existingEntry</span>.<a href="../../InitialSessionState.cs.html#190a59133ab9a4ce" class="i property">Visibility</a> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>;
                                    <span class="r270 r">found</span> = <b>true</b>;
                                }
                            }
 
                            <b>if</b> (!<span class="r270 r">found</span> || <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r269 r">alias</span>))
                            {
                                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#b128cdc6af34af14" class="i property">UnresolvedCommandsToExpose</a>.<span class="i">Add</span>(<span class="r269 r">alias</span>);
                            }
                        }
                    }
                }
            }
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#e68c4b55a4bdf33a" class="i field">FunctionDefinitions</a>))
            {
                <span class="i">Hashtable</span>[] <span id="r273 rd" class="r273 r">functions</span> = <span class="i">TryGetHashtableArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#e68c4b55a4bdf33a" class="i field">FunctionDefinitions</a>]);
 
                <b>if</b> (<span class="r273 r">functions</span> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">Hashtable</span> <span id="r274 rd" class="r274 r">function</span> <b>in</b> <span class="r273 r">functions</span>)
                    {
                        <a href="../../InitialSessionState.cs.html#24449f380379f027" class="t t">SessionStateFunctionEntry</a> <span id="r275 rd" class="r275 r">entry</span> = <a href="#c655304b7a6d0259" class="i method">CreateSessionStateFunctionEntry</a>(<span class="r274 r">function</span>, <span class="r242 r">functionVisibilityApplied</span>);
 
                        <b>if</b> (<span class="r275 r">entry</span> != <b>null</b>)
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<span class="r275 r">entry</span>);
                        }
                    }
                }
            }
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#6a2144eb8017892d" class="i field">VisibleFunctions</a>))
            {
                <b>object</b>[] <span id="r276 rd" class="r276 r">functions</span> = <span class="i">TryGetObjectsOfType</span>&lt;<b>object</b>&gt;(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#6a2144eb8017892d" class="i field">VisibleFunctions</a>],
                                                               <b>new</b> <span class="i">Type</span>[] { <b>typeof</b>(<b>string</b>), <b>typeof</b>(<span class="i">Hashtable</span>) });
 
                <b>if</b> (<span class="r276 r">functions</span> == <b>null</b>)
                {
                    <b>string</b> <span id="r277 rd" class="r277 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCTypeMustBeStringOrHashtableArray</span>,
                        <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#6a2144eb8017892d" class="i field">VisibleFunctions</a>);
                    <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r278 rd" class="r278 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r277 r">message</span>);
                    <span class="r278 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidVisibleFunctionsKeyEntries&quot;</span>);
 
                    <b>throw</b> <span class="r278 r">ioe</span>;
                }
 
                <a href="#9bae01ffbb29f21c" class="i method">ProcessVisibleCommands</a>(<span class="r238 r">iss</span>, <span class="r276 r">functions</span>);
            }
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#97f715e4ffecc7c5" class="i field">VariableDefinitions</a>))
            {
                <span class="i">Hashtable</span>[] <span id="r279 rd" class="r279 r">variables</span> = <span class="i">TryGetHashtableArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#97f715e4ffecc7c5" class="i field">VariableDefinitions</a>]);
 
                <b>if</b> (<span class="r279 r">variables</span> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">Hashtable</span> <span id="r280 rd" class="r280 r">variable</span> <b>in</b> <span class="r279 r">variables</span>)
                    {
                        <b>if</b> (<span class="r280 r">variable</span>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9bd2b3372dcf4d80" class="i field">VariableValueToken</a>) &amp;&amp;
                            <span class="r280 r">variable</span>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9bd2b3372dcf4d80" class="i field">VariableValueToken</a>] <b>is</b> <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>)
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#6495f363726e5904" class="i property">DynamicVariablesToDefine</a>.<span class="i">Add</span>(<span class="r280 r">variable</span>);
                            <b>continue</b>;
                        }
 
                        <a href="../../InitialSessionState.cs.html#e9cb85ffa57e9548" class="t t">SessionStateVariableEntry</a> <span id="r281 rd" class="r281 r">entry</span> = <a href="#c52cee586d0813bc" class="i method">CreateSessionStateVariableEntry</a>(<span class="r280 r">variable</span>, <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#053ed0a367a038fa" class="i property">LanguageMode</a>);
 
                        <b>if</b> (<span class="r281 r">entry</span> != <b>null</b>)
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#fb98d8254252d236" class="i property">Variables</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<span class="r281 r">entry</span>);
                        }
                    }
                }
            }
 
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#bd6ddd7c2df83736" class="i field">EnvironmentVariables</a>))
            {
                <span class="i">Hashtable</span>[] <span id="r282 rd" class="r282 r">variablesList</span> = <span class="i">TryGetHashtableArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#bd6ddd7c2df83736" class="i field">EnvironmentVariables</a>]);
 
                <b>if</b> (<span class="r282 r">variablesList</span> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">Hashtable</span> <span id="r283 rd" class="r283 r">variables</span> <b>in</b> <span class="r282 r">variablesList</span>)
                    {
                        <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r284 rd" class="r284 r">variable</span> <b>in</b> <span class="r283 r">variables</span>)
                        {
                            <a href="../../InitialSessionState.cs.html#e9cb85ffa57e9548" class="t t">SessionStateVariableEntry</a> <span id="r285 rd" class="r285 r">entry</span> = <b>new</b> <span class="t">SessionStateVariableEntry</span>(<span class="r284 r">variable</span>.<span class="i">Key</span>.<span class="i">ToString</span>(), <span class="r284 r">variable</span>.<span class="i">Value</span>.<span class="i">ToString</span>(), <b>null</b>);
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#fd320e175dc61ca2" class="i property">EnvironmentVariables</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<span class="r285 r">entry</span>);
                        }
                    }
                }
            }
 
            <span class="c">// Update type data</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>))
            {
                <b>string</b>[] <span id="r286 rd" class="r286 r">types</span> = <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#1a3b227af34ff440" class="i field">TypesToProcess</a>]);
 
                <b>if</b> (<span class="r286 r">types</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r287 rd" class="r287 r">type</span> <b>in</b> <span class="r286 r">types</span>)
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r287 r">type</span>))
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#0f0c3a5adb4b1776" class="i property">Types</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <a href="../../InitialSessionState.cs.html#6607e0d8b4d498c7" class="t constructor">SessionStateTypeEntry</a>(<span class="r287 r">type</span>));
                        }
                    }
                }
            }
 
            <span class="c">// Update format data</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>))
            {
                <b>string</b>[] <span id="r288 rd" class="r288 r">formats</span> = <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#22f6487e5a94de7f" class="i field">FormatsToProcess</a>]);
 
                <b>if</b> (<span class="r288 r">formats</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r289 rd" class="r289 r">format</span> <b>in</b> <span class="r288 r">formats</span>)
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r289 r">format</span>))
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#4e7657f066102cad" class="i property">Formats</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <a href="../../InitialSessionState.cs.html#96ae628367065642" class="t constructor">SessionStateFormatEntry</a>(<span class="r289 r">format</span>));
                        }
                    }
                }
            }
 
            <span class="c">// Add external commands</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#691bb9c10d14bdef" class="i field">VisibleExternalCommands</a>))
            {
                <b>string</b>[] <span id="r290 rd" class="r290 r">externalCommands</span> = <span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#691bb9c10d14bdef" class="i field">VisibleExternalCommands</a>]);
                <b>if</b> (<span class="r290 r">externalCommands</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r291 rd" class="r291 r">command</span> <b>in</b> <span class="r290 r">externalCommands</span>)
                    {
                        <b>if</b> (<span class="r291 r">command</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.ps1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(
                                <b>new</b> <a href="../../InitialSessionState.cs.html#bb407c7b7c528370" class="t constructor">SessionStateScriptEntry</a>(<span class="r291 r">command</span>, <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>));
                        }
                        <b>else</b>
                        {
                            <b>if</b> (<span class="r291 r">command</span> == <span class="s">&quot;*&quot;</span>)
                            {
                                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(
                                    <b>new</b> <a href="../../InitialSessionState.cs.html#bb407c7b7c528370" class="t constructor">SessionStateScriptEntry</a>(<span class="r291 r">command</span>, <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>));
                            }
 
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(
                                <b>new</b> <a href="../../InitialSessionState.cs.html#383b24c152b1a5cc" class="t constructor">SessionStateApplicationEntry</a>(<span class="r291 r">command</span>, <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>));
                        }
                    }
                }
            }
 
            <span class="c">// Register startup scripts</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>))
            {
                <b>string</b>[] <span id="r292 rd" class="r292 r">startupScripts</span> = <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9a5653ee028fb1fc" class="i field">ScriptsToProcess</a>]);
 
                <b>if</b> (<span class="r292 r">startupScripts</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r293 rd" class="r293 r">script</span> <b>in</b> <span class="r292 r">startupScripts</span>)
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r293 r">script</span>))
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#4074645df9605a16" class="i property">StartupScripts</a>.<span class="i">Add</span>(<span class="r293 r">script</span>);
                        }
                    }
                }
            }
 
            <span class="c">// Now apply visibility logic</span>
            <b>if</b> (<span class="r241 r">cmdletVisibilityApplied</span> || <span class="r242 r">functionVisibilityApplied</span> || <span class="r243 r">aliasVisibilityApplied</span> || <span class="r244 r">providerVisibilityApplied</span>)
            {
                <b>if</b> (<span class="r240 r">sessionType</span> == <a href="#193eb55ce6b6bb37" class="t t">SessionType</a>.<a href="#cf7ca89ea220b2f6" class="i field">Default</a>)
                {
                    <span class="c">// autoloading preference is none, so modules cannot be autoloaded. Since the session type is default,</span>
                    <span class="c">// load PowerShell default modules</span>
                    <span class="r238 r">iss</span>.<span class="i">ImportPSCoreModule</span>(<a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../../InitialSessionState.cs.html#b3b528389a386e63" class="i field">EngineModules</a>.<span class="i">ToArray</span>());
                }
 
                <b>if</b> (<span class="r241 r">cmdletVisibilityApplied</span>)
                {
                    <span class="c">// Import-Module is needed for internal *required modules* processing, so make visibility private.</span>
                    <b>var</b> <span id="r294 rd" class="r294 r">importModuleEntry</span> = <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a><a href="../../InitialSessionState.cs.html#8a6a2b8d34f0d716">[</a><span class="s">&quot;Import-Module&quot;</span>];
                    <b>if</b> (<span class="r294 r">importModuleEntry</span>.<span class="i">Count</span> == 1)
                    {
                        <span class="r294 r">importModuleEntry</span>[0].<span class="i">Visibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
                    }
                }
 
                <b>if</b> (<span class="r243 r">aliasVisibilityApplied</span>)
                {
                    <span class="c">// Import-Module is needed for internal *required modules* processing, so make visibility private.</span>
                    <b>var</b> <span id="r295 rd" class="r295 r">importModuleAliasEntry</span> = <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a><a href="../../InitialSessionState.cs.html#8a6a2b8d34f0d716">[</a><span class="s">&quot;ipmo&quot;</span>];
                    <b>if</b> (<span class="r295 r">importModuleAliasEntry</span>.<span class="i">Count</span> == 1)
                    {
                        <span class="r295 r">importModuleAliasEntry</span>[0].<span class="i">Visibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
                    }
                }
 
                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#cef2c573c113a1c8" class="i property">DefaultCommandVisibility</a> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#fb98d8254252d236" class="i property">Variables</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <span class="t">SessionStateVariableEntry</span>(<a href="../../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../../SpecialVariables.cs.html#4ed03250e91593d9" class="i field">PSModuleAutoLoading</a>, <a href="../../CommandDiscovery.cs.html#c476355d983131b8" class="t t">PSModuleAutoLoadingPreference</a>.<a href="../../CommandDiscovery.cs.html#8d4577abcb2c6b36" class="i field">None</a>, <b>string</b>.<span class="i">Empty</span>, <a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>.<a href="../../ShellVariable.cs.html#76fffaf5453ae116" class="i field">None</a>));
            }
 
            <span class="c">// Set the execution policy</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#50f99a9a999d54d8" class="i field">ExecutionPolicy</a>))
            {
                <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<a href="../../../security/SecuritySupport.cs.html#73c2048fc177fabf" class="t t">ExecutionPolicy</a> <span id="r296 rd" class="r296 r">executionPolicy</span> = (<span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<a href="../../../security/SecuritySupport.cs.html#73c2048fc177fabf" class="t t">ExecutionPolicy</a>)<span class="i">Enum</span>.<span class="i">Parse</span>(
                    <b>typeof</b>(<span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<a href="../../../security/SecuritySupport.cs.html#73c2048fc177fabf" class="t t">ExecutionPolicy</a>), <a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#50f99a9a999d54d8" class="i field">ExecutionPolicy</a>].<span class="i">ToString</span>(), <b>true</b>);
                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#88f2d379b0e326cd" class="i property">ExecutionPolicy</a> = <span class="r296 r">executionPolicy</span>;
            }
 
            <span class="c">// Set the language mode</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#cd52cc01a19f4a84" class="i field">LanguageMode</a>))
            {
                <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a> <span id="r297 rd" class="r297 r">languageMode</span> = (<span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>)<span class="i">Enum</span>.<span class="i">Parse</span>(
                    <b>typeof</b>(<span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>), <a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#cd52cc01a19f4a84" class="i field">LanguageMode</a>].<span class="i">ToString</span>(), <b>true</b>);
                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#053ed0a367a038fa" class="i property">LanguageMode</a> = <span class="r297 r">languageMode</span>;
            }
 
            <span class="c">// Set the transcript directory</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#19b003dcfa5ad4bf" class="i field">TranscriptDirectory</a>))
            {
                <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#91f2e76aef046d1e" class="i property">TranscriptDirectory</a> = <a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#19b003dcfa5ad4bf" class="i field">TranscriptDirectory</a>].<span class="i">ToString</span>();
            }
 
            <span class="c">// Process User Drive</span>
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#6004ce4c39182bad" class="i field">MountUserDrive</a>))
            {
                <b>if</b> (<span class="i">Convert</span>.<span class="i">ToBoolean</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#6004ce4c39182bad" class="i field">MountUserDrive</a>], <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>))
                {
                    <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#50b5fd24b0a675b4" class="i property">UserDriveEnabled</a> = <b>true</b>;
                    <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#d6b8923f60fe362d" class="i property">UserDriveUserName</a> = <span class="r237 r">senderInfo</span>?.<a href="PSPrincipal.cs.html#ac3b737833cbe3e1" class="i property">UserInfo</a>.<a href="PSPrincipal.cs.html#be3c94a41767a974" class="i property">Identity</a>.<a href="PSPrincipal.cs.html#5ec5296e7ff7b744" class="i property">Name</a>;
 
                    <span class="c">// Set user drive max drive if provided.</span>
                    <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f44aa5ddaba24fbd" class="i field">UserDriveMaxSize</a>))
                    {
                        <b>long</b> <span id="r298 rd" class="r298 r">userDriveMaxSize</span> = <span class="i">Convert</span>.<span class="i">ToInt64</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f44aa5ddaba24fbd" class="i field">UserDriveMaxSize</a>]);
                        <b>if</b> (<span class="r298 r">userDriveMaxSize</span> &gt; 0)
                        {
                            <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#260c85af5e497081" class="i property">UserDriveMaximumSize</a> = <span class="r298 r">userDriveMaxSize</span>;
                        }
                    }
 
                    <span class="c">// Input parameter validation enforcement is always true when a User drive is created.</span>
                    <span class="r238 r">iss</span>.<a href="../../InitialSessionState.cs.html#55a5ce7472319152" class="i property">EnforceInputParameterValidation</a> = <b>true</b>;
 
                    <span class="c">// Add function definitions for Copy-Item support.</span>
                    <a href="#86316873a900579b" class="i method">ProcessCopyItemFunctionDefinitions</a>(<span class="r238 r">iss</span>);
                }
            }
 
            <b>return</b> <span class="r238 r">iss</span>;
        }
 
        <span class="c">// Adds Copy-Item remote session helper functions to the ISS.</span>
        <b>private static void</b> <a id="86316873a900579b" href="../../../R/86316873a900579b.html" target="n" data-glyph="76,1" class="i method">ProcessCopyItemFunctionDefinitions</a>(<a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r299 rd" class="r299 r">iss</span>)
        {
            <span class="c">// Copy file to remote helper functions.</span>
            <b>foreach</b> (<b>var</b> <span id="r300 rd" class="r300 r">copyToRemoteFn</span> <b>in</b> <a href="../../../namespaces/FileSystemProvider.cs.html#18b0063a4d2c0d48" class="t t">CopyFileRemoteUtils</a>.<a href="../../../namespaces/FileSystemProvider.cs.html#cfeb8b157f1ad891" class="i method">GetAllCopyToRemoteScriptFunctions</a>())
            {
                <a href="../../InitialSessionState.cs.html#24449f380379f027" class="k">var</a> <span id="r301 rd" class="r301 r">functionEntry</span> = <b>new</b> <a href="../../InitialSessionState.cs.html#bc476ab00cd4640b" class="t constructor">SessionStateFunctionEntry</a>(
                    <span class="r300 r">copyToRemoteFn</span>[<span class="s">&quot;Name&quot;</span>] <b>as string</b>,
                    <span class="r300 r">copyToRemoteFn</span>[<span class="s">&quot;Definition&quot;</span>] <b>as string</b>);
                <span class="r299 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<span class="r301 r">functionEntry</span>);
            }
 
            <span class="c">// Copy file from remote helper functions.</span>
            <b>foreach</b> (<b>var</b> <span id="r302 rd" class="r302 r">copyFromRemoteFn</span> <b>in</b> <a href="../../../namespaces/FileSystemProvider.cs.html#18b0063a4d2c0d48" class="t t">CopyFileRemoteUtils</a>.<a href="../../../namespaces/FileSystemProvider.cs.html#7bb137e0dc664552" class="i method">GetAllCopyFromRemoteScriptFunctions</a>())
            {
                <a href="../../InitialSessionState.cs.html#24449f380379f027" class="k">var</a> <span id="r303 rd" class="r303 r">functionEntry</span> = <b>new</b> <a href="../../InitialSessionState.cs.html#bc476ab00cd4640b" class="t constructor">SessionStateFunctionEntry</a>(
                    <span class="r302 r">copyFromRemoteFn</span>[<span class="s">&quot;Name&quot;</span>] <b>as string</b>,
                    <span class="r302 r">copyFromRemoteFn</span>[<span class="s">&quot;Definition&quot;</span>] <b>as string</b>);
                <span class="r299 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<span class="r303 r">functionEntry</span>);
            }
        }
 
        <b>private static void</b> <a id="9bae01ffbb29f21c" href="../../../R/9bae01ffbb29f21c.html" target="n" data-glyph="76,1" class="i method">ProcessVisibleCommands</a>(<a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r304 rd" class="r304 r">iss</span>, <b>object</b>[] <span id="r305 rd" class="r305 r">commands</span>)
        {
            <span class="c">// A dictionary of: function name -&gt; Parameters</span>
            <span class="c">// Parameters = A dictionary of parameter names -&gt; Modifications</span>
            <span class="c">// Modifications = A dictionary of modification types (ValidatePattern, ValidateSet) to the interim value</span>
            <span class="c">//  for that attribute, as a HashSet of strings. For ValidateSet, this will be used as a collection of strings</span>
            <span class="c">//  directly during proxy generation. For For ValidatePattern, it will be combined into a regex</span>
            <span class="c">//  like: &#39;^(Pattern1|Pattern2|Pattern3)$&#39; during proxy generation.</span>
            <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Hashtable</span>&gt; <span id="r306 rd" class="r306 r">commandModifications</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Hashtable</span>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <span class="c">// Create a hash set of current modules to import so that fully qualified commands can include their</span>
            <span class="c">// module if needed.</span>
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r307 rd" class="r307 r">commandModuleNames</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <b>foreach</b> (<b>var</b> <span id="r308 rd" class="r308 r">moduleSpec</span> <b>in</b> <span class="r304 r">iss</span>.<a href="../../InitialSessionState.cs.html#88f2194fd3b340ef" class="i property">ModuleSpecificationsToImport</a>)
            {
                <span class="r307 r">commandModuleNames</span>.<span class="i">Add</span>(<span class="r308 r">moduleSpec</span>.<span class="i">Name</span>);
            }
 
            <b>foreach</b> (<b>object</b> <span id="r309 rd" class="r309 r">commandObject</span> <b>in</b> <span class="r305 r">commands</span>)
            {
                <b>if</b> (<span class="r309 r">commandObject</span> == <b>null</b>)
                {
                    <b>continue</b>;
                }
 
                <span class="c">// If it&#39;s just a string, this is a visible command</span>
                <b>string</b> <span id="r310 rd" class="r310 r">command</span> = <span class="r309 r">commandObject</span> <b>as string</b>;
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r310 r">command</span>))
                {
                    <a href="#3c356d2b13c6e2c6" class="i method">ProcessVisibleCommand</a>(<span class="r304 r">iss</span>, <span class="r310 r">command</span>, <span class="r307 r">commandModuleNames</span>);
                }
                <b>else</b>
                {
                    <span class="c">// If it&#39;s a hashtable, it represents a customization to a cmdlet.</span>
                    <span class="c">// (I.e.: Exposed parameter with ValidateSet and / or ValidatePattern)</span>
                    <span class="c">// Collect these so that we can post-process them.</span>
                    <span class="i">IDictionary</span> <span id="r311 rd" class="r311 r">commandModification</span> = <span class="r309 r">commandObject</span> <b>as</b> <span class="i">IDictionary</span>;
                    <b>if</b> (<span class="r311 r">commandModification</span> != <b>null</b>)
                    {
                        <a href="#619facf156dd0493" class="i method">ProcessCommandModification</a>(<span class="r306 r">commandModifications</span>, <span class="r311 r">commandModification</span>);
                    }
                }
            }
 
            <span class="c">// Now, save the commandModifications table for post-processing during runspace creation,</span>
            <span class="c">// where we have the command info</span>
            <b>foreach</b> (<b>var</b> <span id="r312 rd" class="r312 r">pair</span> <b>in</b> <span class="r306 r">commandModifications</span>)
            {
                <span class="r304 r">iss</span>.<a href="../../InitialSessionState.cs.html#f99479288a54ef17" class="i property">CommandModifications</a>.<span class="i">Add</span>(<span class="r312 r">pair</span>.<span class="i">Key</span>, <span class="r312 r">pair</span>.<span class="i">Value</span>);
            }
        }
 
        <b>private static void</b> <a id="619facf156dd0493" href="../../../R/619facf156dd0493.html" target="n" data-glyph="76,1" class="i method">ProcessCommandModification</a>(<span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Hashtable</span>&gt; <span id="r313 rd" class="r313 r">commandModifications</span>, <span class="i">IDictionary</span> <span id="r314 rd" class="r314 r">commandModification</span>)
        {
            <b>string</b> <span id="r315 rd" class="r315 r">commandName</span> = <span class="r314 r">commandModification</span>[<span class="s">&quot;Name&quot;</span>] <b>as string</b>;
            <span class="i">Hashtable</span>[] <span id="r316 rd" class="r316 r">parameters</span> = <b>null</b>;
 
            <b>if</b> (<span class="r314 r">commandModification</span>.<span class="i">Contains</span>(<span class="s">&quot;Parameters&quot;</span>))
            {
                <span class="r316 r">parameters</span> = <span class="i">TryGetHashtableArray</span>(<span class="r314 r">commandModification</span>[<span class="s">&quot;Parameters&quot;</span>]);
 
                <b>if</b> (<span class="r316 r">parameters</span> != <b>null</b>)
                {
                    <span class="c">// Validate that the parameter restriction has the right keys</span>
                    <b>foreach</b> (<span class="i">Hashtable</span> <span id="r317 rd" class="r317 r">parameter</span> <b>in</b> <span class="r316 r">parameters</span>)
                    {
                        <b>if</b> (!<span class="r317 r">parameter</span>.<span class="i">ContainsKey</span>(<span class="s">&quot;Name&quot;</span>))
                        {
                            <span class="r316 r">parameters</span> = <b>null</b>;
                            <b>break</b>;
                        }
                    }
                }
            }
 
            <span class="c">// Validate that we got the Name and Parameters keys</span>
            <b>if</b> ((<span class="r315 r">commandName</span> == <b>null</b>) || (<span class="r316 r">parameters</span> == <b>null</b>))
            {
                <b>string</b> <span id="r318 rd" class="r318 r">hashtableKey</span> = <span class="r315 r">commandName</span>;
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r318 r">hashtableKey</span>))
                {
                    <span class="i">IEnumerator</span> <span id="r319 rd" class="r319 r">errorKey</span> = <span class="r314 r">commandModification</span>.<span class="i">Keys</span>.<span class="i">GetEnumerator</span>();
                    <span class="r319 r">errorKey</span>.<span class="i">MoveNext</span>();
 
                    <span class="r318 r">hashtableKey</span> = <span class="r319 r">errorKey</span>.<span class="i">Current</span>.<span class="i">ToString</span>();
                }
 
                <b>string</b> <span id="r320 rd" class="r320 r">message</span> = <a href="../../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">DISCCommandModificationSyntax</span>, <span class="r318 r">hashtableKey</span>);
                <a href="../../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r321 rd" class="r321 r">ioe</span> = <b>new</b> <a href="../../../utils/MshInvalidOperationException.cs.html#de5b942a57457045" class="t constructor">PSInvalidOperationException</a>(<span class="r320 r">message</span>);
                <span class="r321 r">ioe</span>.<a href="../../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;InvalidVisibleCommandKeyEntries&quot;</span>);
 
                <b>throw</b> <span class="r321 r">ioe</span>;
            }
 
            <span class="c">// Ensure we have the hashtable representing the current command being modified</span>
            <span class="i">Hashtable</span> <span id="r322 rd" class="r322 r">parameterModifications</span>;
            <b>if</b> (!<span class="r313 r">commandModifications</span>.<span class="i">TryGetValue</span>(<span class="r315 r">commandName</span>, <b>out</b> <span class="r322 r">parameterModifications</span>))
            {
                <span class="r322 r">parameterModifications</span> = <b>new</b> <span class="i">Hashtable</span>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                <span class="r313 r">commandModifications</span>[<span class="r315 r">commandName</span>] = <span class="r322 r">parameterModifications</span>;
            }
 
            <b>foreach</b> (<span class="i">IDictionary</span> <span id="r323 rd" class="r323 r">parameter</span> <b>in</b> <span class="r316 r">parameters</span>)
            {
                <span class="c">// Ensure we have the hashtable representing the current parameter being modified</span>
                <b>string</b> <span id="r324 rd" class="r324 r">parameterName</span> = <span class="r323 r">parameter</span>[<span class="s">&quot;Name&quot;</span>].<span class="i">ToString</span>();
                <span class="i">Hashtable</span> <span id="r325 rd" class="r325 r">currentParameterModification</span> = <span class="r322 r">parameterModifications</span>[<span class="r324 r">parameterName</span>] <b>as</b> <span class="i">Hashtable</span>;
                <b>if</b> (<span class="r325 r">currentParameterModification</span> == <b>null</b>)
                {
                    <span class="r325 r">currentParameterModification</span> = <b>new</b> <span class="i">Hashtable</span>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                    <span class="r322 r">parameterModifications</span>[<span class="r324 r">parameterName</span>] = <span class="r325 r">currentParameterModification</span>;
                }
 
                <b>foreach</b> (<b>string</b> <span id="r326 rd" class="r326 r">parameterModification</span> <b>in</b> <span class="r323 r">parameter</span>.<span class="i">Keys</span>)
                {
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="s">&quot;Name&quot;</span>, <span class="r326 r">parameterModification</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>continue</b>;
                    }
 
                    <span class="c">// Go through the keys, adding them to the current parameter modification</span>
                    <b>if</b> (!<span class="r325 r">currentParameterModification</span>.<span class="i">Contains</span>(<span class="r326 r">parameterModification</span>))
                    {
                        <span class="r325 r">currentParameterModification</span>[<span class="r326 r">parameterModification</span>] = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                    }
 
                    <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r327 rd" class="r327 r">currentParameterModificationValue</span> = (<span class="i">HashSet</span>&lt;<b>string</b>&gt;)<span class="r325 r">currentParameterModification</span>[<span class="r326 r">parameterModification</span>];
 
                    <b>foreach</b> (<b>string</b> <span id="r328 rd" class="r328 r">parameterModificationValue</span> <b>in</b> <span class="i">TryGetStringArray</span>(<span class="r323 r">parameter</span>[<span class="r326 r">parameterModification</span>]))
                    {
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r328 r">parameterModificationValue</span>))
                        {
                            <span class="r327 r">currentParameterModificationValue</span>.<span class="i">Add</span>(<span class="r328 r">parameterModificationValue</span>);
                        }
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="3c356d2b13c6e2c6" href="../../../R/3c356d2b13c6e2c6.html" target="n" data-glyph="76,1" class="i method">ProcessVisibleCommand</a>(<a href="../../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r329 rd" class="r329 r">iss</span>, <b>string</b> <span id="r330 rd" class="r330 r">command</span>, <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r331 rd" class="r331 r">moduleNames</span>)
        {
            <b>bool</b> <span id="r332 rd" class="r332 r">found</span> = <b>false</b>;
 
            <span class="c">// Defer module restricted command processing to runspace bind time.</span>
            <span class="c">// Module restricted command names are fully qualified with the module name:</span>
            <span class="c">// &lt;ModuleName&gt;\&lt;CommandName&gt;, e.g., PSScheduledJob\*JobTrigger*</span>
            <b>if</b> (<span class="r330 r">command</span>.<span class="i">IndexOf</span>(<span class="s">&#39;\\&#39;</span>) &lt; 0)
            {
                <span class="c">// Look up commands from command name including wildcards.</span>
                <span class="i">Collection</span>&lt;<a href="../../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a>&gt; <span id="r333 rd" class="r333 r">existingEntries</span> = <span class="r329 r">iss</span>.<a href="../../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>.<a href="../../InitialSessionState.cs.html#f4cd69ee4353c4ac" class="i method">LookUpByName</a>(<span class="r330 r">command</span>);
                <b>foreach</b> (<a href="../../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a> <span id="r334 rd" class="r334 r">existingEntry</span> <b>in</b> <span class="r333 r">existingEntries</span>)
                {
                    <b>if</b> ((<span class="r334 r">existingEntry</span>.<a href="../../InitialSessionState.cs.html#b86d5dd7cdc3f952" class="i property">CommandType</a> == <a href="../../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../../CommandInfo.cs.html#e95f2e5deaaf9b93" class="i field">Cmdlet</a>) || (<span class="r334 r">existingEntry</span>.<a href="../../InitialSessionState.cs.html#b86d5dd7cdc3f952" class="i property">CommandType</a> == <a href="../../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../../CommandInfo.cs.html#8a4bdbbd93f182bf" class="i field">Function</a>))
                    {
                        <span class="r334 r">existingEntry</span>.<a href="../../InitialSessionState.cs.html#190a59133ab9a4ce" class="i property">Visibility</a> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>;
                        <span class="r332 r">found</span> = <b>true</b>;
                    }
                }
            }
            <b>else</b>
            {
                <span class="c">// Extract the module name and ensure it is part of the ISS modules to process list.</span>
                <b>string</b> <span id="r335 rd" class="r335 r">moduleName</span>;
                <a href="../../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../../Utils.cs.html#65b18cb655761e08" class="i method">ParseCommandName</a>(<span class="r330 r">command</span>, <b>out</b> <span class="r335 r">moduleName</span>);
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r335 r">moduleName</span>) &amp;&amp; !<span class="r331 r">moduleNames</span>.<span class="i">Contains</span>(<span class="r335 r">moduleName</span>))
                {
                    <span class="r331 r">moduleNames</span>.<span class="i">Add</span>(<span class="r335 r">moduleName</span>);
                    <span class="r329 r">iss</span>.<a href="../../InitialSessionState.cs.html#e1bc402ae6a0a4c8" class="i method">ImportPSModule</a>(<b>new</b> <b>string</b>[] { <span class="r335 r">moduleName</span> });
                }
            }
 
            <b>if</b> (!<span class="r332 r">found</span> || <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r330 r">command</span>))
            {
                <span class="r329 r">iss</span>.<a href="../../InitialSessionState.cs.html#b128cdc6af34af14" class="i property">UnresolvedCommandsToExpose</a>.<span class="i">Add</span>(<span class="r330 r">command</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates an alias entry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../../InitialSessionState.cs.html#3164e16488ced1ed" class="t t">SessionStateAliasEntry</a> <a id="aa848a085dae1690" href="../../../R/aa848a085dae1690.html" target="n" data-glyph="76,1" class="i method">CreateSessionStateAliasEntry</a>(<span class="i">Hashtable</span> <span id="r336 rd" class="r336 r">alias</span>, <b>bool</b> <span id="r337 rd" class="r337 r">isAliasVisibilityDefined</span>)
        {
            <b>string</b> <span id="r338 rd" class="r338 r">name</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r336 r">alias</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#804ab2a2e4c5a748" class="i field">AliasNameToken</a>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r338 r">name</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r339 rd" class="r339 r">value</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r336 r">alias</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f16404cd063a2837" class="i field">AliasValueToken</a>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r339 r">value</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r340 rd" class="r340 r">description</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r336 r">alias</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#48d829fdc044b6bf" class="i field">AliasDescriptionToken</a>);
 
            <a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a> <span id="r341 rd" class="r341 r">options</span> = <a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>.<a href="../../ShellVariable.cs.html#76fffaf5453ae116" class="i field">None</a>;
 
            <b>string</b> <span id="r342 rd" class="r342 r">optionsString</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r336 r">alias</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#2754a8adb9898206" class="i field">AliasOptionsToken</a>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r342 r">optionsString</span>))
            {
                <span class="r341 r">options</span> = (<a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>)<span class="i">Enum</span>.<span class="i">Parse</span>(<b>typeof</b>(<a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>), <span class="r342 r">optionsString</span>, <b>true</b>);
            }
 
            <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a> <span id="r343 rd" class="r343 r">visibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
            <b>if</b> (!<span class="r337 r">isAliasVisibilityDefined</span>)
            {
                <span class="r343 r">visibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>;
            }
 
            <b>return</b> <b>new</b> <a href="../../InitialSessionState.cs.html#99c934c9c34c5ab5" class="t constructor">SessionStateAliasEntry</a>(<span class="r338 r">name</span>, <span class="r339 r">value</span>, <span class="r340 r">description</span>, <span class="r341 r">options</span>, <span class="r343 r">visibility</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a function entry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../../InitialSessionState.cs.html#24449f380379f027" class="t t">SessionStateFunctionEntry</a> <a id="c655304b7a6d0259" href="../../../R/c655304b7a6d0259.html" target="n" data-glyph="76,1" class="i method">CreateSessionStateFunctionEntry</a>(<span class="i">Hashtable</span> <span id="r344 rd" class="r344 r">function</span>, <b>bool</b> <span id="r345 rd" class="r345 r">isFunctionVisibilityDefined</span>)
        {
            <b>string</b> <span id="r346 rd" class="r346 r">name</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r344 r">function</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#79c9e3e4f7f31db1" class="i field">FunctionNameToken</a>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r346 r">name</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r347 rd" class="r347 r">value</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r344 r">function</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#b5c2efca914a6039" class="i field">FunctionValueToken</a>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r347 r">value</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a> <span id="r348 rd" class="r348 r">options</span> = <a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>.<a href="../../ShellVariable.cs.html#76fffaf5453ae116" class="i field">None</a>;
 
            <b>string</b> <span id="r349 rd" class="r349 r">optionsString</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r344 r">function</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#f3b742e57550f9ad" class="i field">FunctionOptionsToken</a>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r349 r">optionsString</span>))
            {
                <span class="r348 r">options</span> = (<a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>)<span class="i">Enum</span>.<span class="i">Parse</span>(<b>typeof</b>(<a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>), <span class="r349 r">optionsString</span>, <b>true</b>);
            }
 
            <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r350 rd" class="r350 r">newFunction</span> = <a href="../../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../../lang/scriptblock.cs.html#adfac0fa7bf5725f" class="i method">Create</a>(<span class="r347 r">value</span>);
            <span class="r350 r">newFunction</span>.<a href="../../lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> = <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
 
            <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a> <span id="r351 rd" class="r351 r">functionVisibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
            <b>if</b> (!<span class="r345 r">isFunctionVisibilityDefined</span>)
            {
                <span class="r351 r">functionVisibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>;
            }
 
            <b>return</b> <b>new</b> <a href="../../InitialSessionState.cs.html#99aaead324190b87" class="t constructor">SessionStateFunctionEntry</a>(<span class="r346 r">name</span>, <span class="r347 r">value</span>, <span class="r348 r">options</span>, <span class="r351 r">functionVisibility</span>, <span class="r350 r">newFunction</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a variable entry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../../InitialSessionState.cs.html#e9cb85ffa57e9548" class="t t">SessionStateVariableEntry</a> <a id="c52cee586d0813bc" href="../../../R/c52cee586d0813bc.html" target="n" data-glyph="76,1" class="i method">CreateSessionStateVariableEntry</a>(<span class="i">Hashtable</span> <span id="r352 rd" class="r352 r">variable</span>, <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a> <span id="r353 rd" class="r353 r">languageMode</span>)
        {
            <b>string</b> <span id="r354 rd" class="r354 r">name</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r352 r">variable</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#2de830f08f62b5e6" class="i field">VariableNameToken</a>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r354 r">name</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r355 rd" class="r355 r">value</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r352 r">variable</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#9bd2b3372dcf4d80" class="i field">VariableValueToken</a>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r355 r">value</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r356 rd" class="r356 r">description</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r352 r">variable</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#48d829fdc044b6bf" class="i field">AliasDescriptionToken</a>);
 
            <a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a> <span id="r357 rd" class="r357 r">options</span> = <a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>.<a href="../../ShellVariable.cs.html#76fffaf5453ae116" class="i field">None</a>;
 
            <b>string</b> <span id="r358 rd" class="r358 r">optionsString</span> = <a href="#22eafb64af11edf1" class="i method">TryGetValue</a>(<span class="r352 r">variable</span>, <a href="#b1e495f9b52fbd4a" class="t t">ConfigFileConstants</a>.<a href="#2754a8adb9898206" class="i field">AliasOptionsToken</a>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r358 r">optionsString</span>))
            {
                <span class="r357 r">options</span> = (<a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>)<span class="i">Enum</span>.<span class="i">Parse</span>(<b>typeof</b>(<a href="../../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>), <span class="r358 r">optionsString</span>, <b>true</b>);
            }
 
            <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a> <span id="r359 rd" class="r359 r">visibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
            <b>if</b> (<span class="r353 r">languageMode</span> == <a href="../../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>)
            {
                <span class="r359 r">visibility</span> = <a href="../../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../../SessionStatePublic.cs.html#74d8ba664c504563" class="i field">Public</a>;
            }
 
            <b>return</b> <b>new</b> <span class="t">SessionStateVariableEntry</span>(<span class="r354 r">name</span>, <span class="r355 r">value</span>, <span class="r356 r">description</span>, <span class="r357 r">options</span>, <b>new</b> <span class="i">Collections</span>.<span class="i">ObjectModel</span>.<span class="i">Collection</span>&lt;<span class="i">Attribute</span>&gt;(), <span class="r359 r">visibility</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Applies the command (cmdlet/function/alias) visibility settings to the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">iss</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r360 r">configFileKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="77114572936e0bd6" href="../../../R/77114572936e0bd6.html" target="n" data-glyph="76,1" class="i method">IsNonDefaultVisibilitySpecified</a>(<b>string</b> <span id="r360 rd" class="r360 r">configFileKey</span>)
        {
            <b>if</b> (<a href="#28a5a5119646d21b" class="i field">_configHash</a>.<span class="i">ContainsKey</span>(<span class="r360 r">configFileKey</span>))
            {
                <b>string</b>[] <span id="r361 rd" class="r361 r">commands</span> =
                    <a href="#fc3ecbf6d041a5ca" class="t t">DISCPowerShellConfiguration</a>.<span class="i">TryGetStringArray</span>(<a href="#28a5a5119646d21b" class="i field">_configHash</a>[<span class="r360 r">configFileKey</span>]);
 
                <b>if</b> ((<span class="r361 r">commands</span> == <b>null</b>) || (<span class="r361 r">commands</span>.<span class="i">Length</span> == 0))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Attempts to get a value from a hashtable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r362 r">table</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r363 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="22eafb64af11edf1" href="../../../R/22eafb64af11edf1.html" target="n" data-glyph="74,1" class="i method">TryGetValue</a>(<span class="i">Hashtable</span> <span id="r362 rd" class="r362 r">table</span>, <b>string</b> <span id="r363 rd" class="r363 r">key</span>)
        {
            <b>if</b> (<span class="r362 r">table</span>.<span class="i">ContainsKey</span>(<span class="r363 r">key</span>))
            {
                <b>return</b> <span class="r362 r">table</span>[<span class="r363 r">key</span>].<span class="i">ToString</span>();
            }
 
            <b>return</b> <b>string</b>.<span class="i">Empty</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Attempts to get a hashtable array from an object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r364 r">hashObj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Hashtable</span>[] <a id="b24ebadf5f6d939f" href="../../../R/b24ebadf5f6d939f.html" target="n" data-glyph="74,1" class="i method">TryGetHashtableArray</a>(<b>object</b> <span id="r364 rd" class="r364 r">hashObj</span>)
        {
            <span class="c">// Scalar case</span>
            <span class="i">Hashtable</span> <span id="r365 rd" class="r365 r">hashtable</span> = <span class="r364 r">hashObj</span> <b>as</b> <span class="i">Hashtable</span>;
 
            <b>if</b> (<span class="r365 r">hashtable</span> != <b>null</b>)
            {
                <b>return</b> <b>new</b>[] { <span class="r365 r">hashtable</span> };
            }
 
            <span class="c">// 1. Direct conversion</span>
            <span class="i">Hashtable</span>[] <span id="r366 rd" class="r366 r">hashArray</span> = <span class="r364 r">hashObj</span> <b>as</b> <span class="i">Hashtable</span>[];
 
            <b>if</b> (<span class="r366 r">hashArray</span> == <b>null</b>)
            {
                <span class="c">// 2. Convert from object array</span>
                <b>object</b>[] <span id="r367 rd" class="r367 r">objArray</span> = <span class="r364 r">hashObj</span> <b>as object</b>[];
 
                <b>if</b> (<span class="r367 r">objArray</span> != <b>null</b>)
                {
                    <span class="r366 r">hashArray</span> = <b>new</b> <span class="i">Hashtable</span>[<span class="r367 r">objArray</span>.<span class="i">Length</span>];
 
                    <b>for</b> (<b>int</b> <span id="r368 rd" class="r368 r">i</span> = 0; <span class="r368 r">i</span> &lt; <span class="r366 r">hashArray</span>.<span class="i">Length</span>; <span class="r368 r">i</span>++)
                    {
                        <b>if</b> (!(<span class="r367 r">objArray</span>[<span class="r368 r">i</span>] <b>is</b> <span class="i">Hashtable</span> <span id="r369 rd" class="r369 r">hash</span>))
                        {
                            <b>return</b> <b>null</b>;
                        }
 
                        <span class="r366 r">hashArray</span>[<span class="r368 r">i</span>] = <span class="r369 r">hash</span>;
                    }
                }
            }
 
            <b>return</b> <span class="r366 r">hashArray</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Attempts to get a string array from a hashtable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r370 r">hashObj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b>[] <a id="6d03f1c309883dc0" href="../../../R/6d03f1c309883dc0.html" target="n" data-glyph="74,1" class="i method">TryGetStringArray</a>(<b>object</b> <span id="r370 rd" class="r370 r">hashObj</span>)
        {
            <b>object</b>[] <span id="r371 rd" class="r371 r">objs</span> = <span class="r370 r">hashObj</span> <b>as object</b>[];
 
            <b>if</b> (<span class="r371 r">objs</span> == <b>null</b>)
            {
                <span class="c">// Scalar case</span>
                <b>object</b> <span id="r372 rd" class="r372 r">obj</span> = <span class="r370 r">hashObj</span> <b>as object</b>;
 
                <b>if</b> (<span class="r372 r">obj</span> != <b>null</b>)
                {
                    <b>return</b> <b>new</b> <b>string</b>[] { <span class="r372 r">obj</span>.<span class="i">ToString</span>() };
                }
                <b>else</b>
                {
                    <b>return</b> <b>null</b>;
                }
            }
 
            <b>string</b>[] <span id="r373 rd" class="r373 r">result</span> = <b>new</b> <b>string</b>[<span class="r371 r">objs</span>.<span class="i">Length</span>];
 
            <b>for</b> (<b>int</b> <span id="r374 rd" class="r374 r">i</span> = 0; <span class="r374 r">i</span> &lt; <span class="r371 r">objs</span>.<span class="i">Length</span>; <span class="r374 r">i</span>++)
            {
                <span class="r373 r">result</span>[<span class="r374 r">i</span>] = <span class="r371 r">objs</span>[<span class="r374 r">i</span>].<span class="i">ToString</span>();
            }
 
            <b>return</b> <span class="r373 r">result</span>;
        }
 
        <b>internal static</b> <span class="r375 r t">T</span>[] <a id="3705544a04cc0d09" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">TryGetObjectsOfType</a>&lt;<span id="r375 rd t" class="r375 r t">T</span>&gt;(<b>object</b> <span id="r376 rd" class="r376 r">hashObj</span>, <span class="i">IEnumerable</span>&lt;<span class="i">Type</span>&gt; <span id="r377 rd" class="r377 r">types</span>) <b>where</b> <span class="r375 r t">T</span> : <b>class</b>
        {
            <b>object</b>[] <span id="r378 rd" class="r378 r">objs</span> = <span class="r376 r">hashObj</span> <b>as object</b>[];
            <b>if</b> (<span class="r378 r">objs</span> == <b>null</b>)
            {
                <span class="c">// Scalar case</span>
                <b>object</b> <span id="r379 rd" class="r379 r">obj</span> = <span class="r376 r">hashObj</span>;
                <b>if</b> (<span class="r379 r">obj</span> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">Type</span> <span id="r380 rd" class="r380 r">type</span> <b>in</b> <span class="r377 r">types</span>)
                    {
                        <b>if</b> (<span class="r379 r">obj</span>.<span class="i">GetType</span>().<span class="i">Equals</span>(<span class="r380 r">type</span>))
                        {
                            <b>return</b> <b>new</b> <span class="r375 r t">T</span>[] { <span class="r379 r">obj</span> <b>as</b> <span class="r375 r t">T</span> };
                        }
                    }
                }
 
                <b>return</b> <b>null</b>;
            }
 
            <span class="r375 r t">T</span>[] <span id="r381 rd" class="r381 r">result</span> = <b>new</b> <span class="r375 r t">T</span>[<span class="r378 r">objs</span>.<span class="i">Length</span>];
            <b>for</b> (<b>int</b> <span id="r382 rd" class="r382 r">i</span> = 0; <span class="r382 r">i</span> &lt; <span class="r378 r">objs</span>.<span class="i">Length</span>; <span class="r382 r">i</span>++)
            {
                <b>int</b> <span id="r383 rd" class="r383 r">i1</span> = <span class="r382 r">i</span>;
                <b>if</b> (<span class="r377 r">types</span>.<span class="i">Any</span>(<span id="r384 rd" class="r384 r">type</span> =&gt; <span class="r378 r">objs</span>[<span class="r383 r">i1</span>].<span class="i">GetType</span>().<span class="i">Equals</span>(<span class="r384 r">type</span>)))
                {
                    <span class="r381 r">result</span>[<span class="r382 r">i</span>] = <span class="r378 r">objs</span>[<span class="r382 r">i</span>] <b>as</b> <span class="r375 r t">T</span>;
                }
                <b>else</b>
                {
                    <b>return</b> <b>null</b>;
                }
            }
 
            <b>return</b> <span class="r381 r">result</span>;
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
}
</pre></td></tr></table></div></body></html>
