<!DOCTYPE html>
<html><head><title>RemoveJob.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(1051);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/remoting/commands/RemoveJob.cs" target="_top">engine\remoting\commands\RemoveJob.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Remoting</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This is the base class for job cmdlet and contains some helper functions.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="6d4a842df78cbd2d" href="../../../R/6d4a842df78cbd2d.html" target="n" data-glyph="0,0" class="t t"><span id="b88847e269618fdb">JobCmdletBase</span></a> : <a href="PSRemotingCmdlet.cs.html#c2668678751e1b82" class="t t">PSRemotingCmdlet</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Strings
 
        <span class="c">// Parametersets used by job cmdlets</span>
        <b>internal const string</b> <a id="1d8e9765284b68f7" href="../../../R/1d8e9765284b68f7.html" target="n" data-glyph="8,1" class="i field">JobParameterSet</a> = <span class="s">&quot;JobParameterSet&quot;</span>;
        <b>internal const string</b> <a id="b9fcc6d73680e09f" href="../../../R/b9fcc6d73680e09f.html" target="n" data-glyph="8,1" class="i field">InstanceIdParameterSet</a> = <span class="s">&quot;InstanceIdParameterSet&quot;</span>;
        <b>internal const string</b> <a id="5b871caa1267d529" href="../../../R/5b871caa1267d529.html" target="n" data-glyph="8,1" class="i field">SessionIdParameterSet</a> = <span class="s">&quot;SessionIdParameterSet&quot;</span>;
        <b>internal const string</b> <a id="f6461d28caff9c5c" href="../../../R/f6461d28caff9c5c.html" target="n" data-glyph="8,1" class="i field">NameParameterSet</a> = <span class="s">&quot;NameParameterSet&quot;</span>;
        <b>internal const string</b> <a id="d0202bf60680c003" href="../../../R/d0202bf60680c003.html" target="n" data-glyph="8,1" class="i field">StateParameterSet</a> = <span class="s">&quot;StateParameterSet&quot;</span>;
        <b>internal const string</b> <a id="eb6b73fef1e8bcc8" href="../../../R/eb6b73fef1e8bcc8.html" target="n" data-glyph="8,1" class="i field">CommandParameterSet</a> = <span class="s">&quot;CommandParameterSet&quot;</span>;
        <b>internal const string</b> <a id="68ab1e0e7742703e" href="../../../R/68ab1e0e7742703e.html" target="n" data-glyph="8,1" class="i field">FilterParameterSet</a> = <span class="s">&quot;FilterParameterSet&quot;</span>;
 
        <span class="c">// common parameter names</span>
        <b>internal const string</b> <a id="44150792b0efa018" href="../../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">JobParameter</a> = <span class="s">&quot;Job&quot;</span>;
        <b>internal const string</b> <a id="7bb9265f1e48fcb9" href="../../../R/7bb9265f1e48fcb9.html" target="n" data-glyph="8,1" class="i field">InstanceIdParameter</a> = <span class="s">&quot;InstanceId&quot;</span>;
        <b>internal const string</b> <a id="b6f0a53c4e58891f" href="../../../R/b6f0a53c4e58891f.html" target="n" data-glyph="8,1" class="i field">SessionIdParameter</a> = <span class="s">&quot;SessionId&quot;</span>;
        <b>internal const string</b> <a id="7440881b9840a029" href="../../../R/7440881b9840a029.html" target="n" data-glyph="8,1" class="i field">NameParameter</a> = <span class="s">&quot;Name&quot;</span>;
        <b>internal const string</b> <a id="753a9b4d836152fe" href="../../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">StateParameter</a> = <span class="s">&quot;State&quot;</span>;
        <b>internal const string</b> <a id="6b950c728bd172f1" href="../../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">CommandParameter</a> = <span class="s">&quot;Command&quot;</span>;
        <b>internal const string</b> <a id="0d8ad18680ecc0a4" href="../../../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">FilterParameter</a> = <span class="s">&quot;Filter&quot;</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Strings
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Job Matches
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the jobs in repository which match matching the specified names.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">writeobject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">if true, method writes the object instead of returning it</span>
        <span class="c">///</span><span class="c"> in list (an empty list is returned).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">writeErrorOnNoMatch</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Write error if no match is found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">checkIfJobCanBeRemoved</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Check if this job can be removed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">recurse</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Recurse and check in child jobs.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of matching jobs.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <a id="f951c3eecc4e85e0" href="../../../R/f951c3eecc4e85e0.html" target="n" data-glyph="74,1" class="i method">FindJobsMatchingByName</a>(
            <b>bool</b> <span id="r3 rd" class="r3 r">recurse</span>,
            <b>bool</b> <span id="r0 rd" class="r0 r">writeobject</span>,
            <b>bool</b> <span id="r1 rd" class="r1 r">writeErrorOnNoMatch</span>,
            <b>bool</b> <span id="r2 rd" class="r2 r">checkIfJobCanBeRemoved</span>)
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r4 rd" class="r4 r">matches</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
            <span class="i">Hashtable</span> <span id="r5 rd" class="r5 r">duplicateDetector</span> = <b>new</b> <span class="i">Hashtable</span>();
 
            <b>if</b> (<a href="#1f9a7ed82f1c6c33" class="i field">_names</a> == <b>null</b>) <b>return</b> <span class="r4 r">matches</span>;
 
            <b>foreach</b> (<b>string</b> <span id="r6 rd" class="r6 r">name</span> <b>in</b> <a href="#1f9a7ed82f1c6c33" class="i field">_names</a>)
            {
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r6 r">name</span>))
                    <b>continue</b>;
 
                <span class="c">// search all jobs in repository.</span>
                <b>bool</b> <span id="r7 rd" class="r7 r">jobFound</span> = <b>false</b>;
                <span class="r5 r">duplicateDetector</span>.<span class="i">Clear</span>();
                <span class="r7 r">jobFound</span> = <span class="i">FindJobsMatchingByNameHelper</span>(<span class="r4 r">matches</span>, <a href="../../CommandBase.cs.html#025e5235224e3234" class="i property">JobRepository</a>.<a href="JobRepository.cs.html#2d8e4e2819a2e8c8" class="i property">Jobs</a>, <span class="r6 r">name</span>,
                                    <span class="r5 r">duplicateDetector</span>, <span class="r3 r">recurse</span>, <span class="r0 r">writeobject</span>, <span class="r2 r">checkIfJobCanBeRemoved</span>);
 
                <span class="c">// search all jobs in JobManager</span>
                <span class="i">List</span>&lt;<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>&gt; <span id="r8 rd" class="r8 r">jobs2</span> = <a href="../../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../client/JobManager.cs.html#bdf47cd16272cc69" class="i method">GetJobsByName</a>(<span class="r6 r">name</span>, <a href="#6d4a842df78cbd2d" class="k">this</a>, <b>false</b>, <span class="r0 r">writeobject</span>, <span class="r3 r">recurse</span>, <b>null</b>);
 
                <b>bool</b> <span id="r9 rd" class="r9 r">job2Found</span> = (<span class="r8 r">jobs2</span> != <b>null</b>) &amp;&amp; (<span class="r8 r">jobs2</span>.<span class="i">Count</span> &gt; 0);
 
                <b>if</b> (<span class="r9 r">job2Found</span>)
                {
                    <b>foreach</b> (<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r10 rd" class="r10 r">job2</span> <b>in</b> <span class="r8 r">jobs2</span>)
                    {
                        <b>if</b> (<span class="i">CheckIfJob2CanBeRemoved</span>(<span class="r2 r">checkIfJobCanBeRemoved</span>, <a href="#7440881b9840a029" class="i field">NameParameter</a>, <span class="r10 r">job2</span>,
                            <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedNameNotCompleted</span>, <span class="r10 r">job2</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>, <span class="r10 r">job2</span>.<a href="../client/Job.cs.html#6332c7ef857bb146" class="i property">Name</a>))
                        {
                            <span class="r4 r">matches</span>.<span class="i">Add</span>(<span class="r10 r">job2</span>);
                        }
                    }
                }
 
                <span class="r7 r">jobFound</span> = <span class="r7 r">jobFound</span> || <span class="r9 r">job2Found</span>;
 
                <span class="c">// if a match is not found, write an error)</span>
                <b>if</b> (<span class="r7 r">jobFound</span> || !<span class="r1 r">writeErrorOnNoMatch</span> || <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r6 r">name</span>)) <b>continue</b>;
 
                <span class="i">Exception</span> <span id="r11 rd" class="r11 r">ex</span> = <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<a href="#7440881b9840a029" class="i field">NameParameter</a>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedNameNotFound</span>, <span class="r6 r">name</span>);
                <a href="../../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <a href="../../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r11 r">ex</span>, <span class="s">&quot;JobWithSpecifiedNameNotFound&quot;</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r6 r">name</span>));
            }
 
            <b>return</b> <span class="r4 r">matches</span>;
        }
 
        <b>private bool</b> <a id="7d7dcf849c0fe26e" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CheckIfJob2CanBeRemoved</a>(<b>bool</b> <span id="r12 rd" class="r12 r">checkForRemove</span>, <b>string</b> <span id="r13 rd" class="r13 r">parameterName</span>, <a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r14 rd" class="r14 r">job2</span>, <b>string</b> <span id="r15 rd" class="r15 r">resourceString</span>, <b>params object</b>[] <span id="r16 rd" class="r16 r">args</span>)
        {
            <b>if</b> (<span class="r12 r">checkForRemove</span>)
            {
                <b>if</b> (<span class="r14 r">job2</span>.<a href="../client/Job.cs.html#d7179d2607549d3b" class="i method">IsFinishedState</a>(<span class="r14 r">job2</span>.<a href="../client/Job.cs.html#896d1d1f27daae5f" class="i property">JobStateInfo</a>.<a href="../client/Job.cs.html#245057a5f4a9ed30" class="i property">State</a>))
                    <b>return</b> <b>true</b>;
 
                <b>string</b> <span id="r17 rd" class="r17 r">message</span> = <a href="../common/remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<a href="../common/remotingexceptions.cs.html#5f4bcb44bc0f3ab2" class="i method">FormatResourceString</a>(<span class="r15 r">resourceString</span>, <span class="r16 r">args</span>);
                <span class="i">Exception</span> <span id="r18 rd" class="r18 r">ex</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="r17 r">message</span>, <span class="r13 r">parameterName</span>);
                <a href="../../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <a href="../../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r18 r">ex</span>, <span class="s">&quot;JobObjectNotFinishedCannotBeRemoved&quot;</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r14 r">job2</span>));
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private bool</b> <a id="09132127e462bb27" href="../../../R/09132127e462bb27.html" target="n" data-glyph="76,1" class="i method">FindJobsMatchingByNameHelper</a>(<span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r19 rd" class="r19 r">matches</span>, <span class="i">IList</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r20 rd" class="r20 r">jobsToSearch</span>, <b>string</b> <span id="r21 rd" class="r21 r">name</span>,
                        <span class="i">Hashtable</span> <span id="r22 rd" class="r22 r">duplicateDetector</span>, <b>bool</b> <span id="r23 rd" class="r23 r">recurse</span>, <b>bool</b> <span id="r24 rd" class="r24 r">writeobject</span>, <b>bool</b> <span id="r25 rd" class="r25 r">checkIfJobCanBeRemoved</span>)
        {
            <a href="../../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r21 r">name</span>), <span class="s">&quot;Caller should ensure that name is not null or empty&quot;</span>);
 
            <b>bool</b> <span id="r26 rd" class="r26 r">jobFound</span> = <b>false</b>;
 
            <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r27 rd" class="r27 r">pattern</span> =
                <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r21 r">name</span>, <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#e7978967739ff542" class="i field">Compiled</a>);
 
            <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r28 rd" class="r28 r">job</span> <b>in</b> <span class="r20 r">jobsToSearch</span>)
            {
                <span class="c">// check if this job has already been searched</span>
                <b>if</b> (<span class="r22 r">duplicateDetector</span>.<span class="i">ContainsKey</span>(<span class="r28 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>))
                {
                    <b>continue</b>;
                }
 
                <span class="r22 r">duplicateDetector</span>.<span class="i">Add</span>(<span class="r28 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>, <span class="r28 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>);
 
                <span class="c">// check if the job is available in any of the</span>
                <span class="c">// top level jobs</span>
 
                <span class="c">// if (string.Equals(job.Name, name, StringComparison.OrdinalIgnoreCase))</span>
                <b>if</b> (<span class="r27 r">pattern</span>.<a href="../../regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r28 r">job</span>.<a href="../client/Job.cs.html#6332c7ef857bb146" class="i property">Name</a>))
                {
                    <span class="r26 r">jobFound</span> = <b>true</b>;
                    <b>if</b> (!<span class="r25 r">checkIfJobCanBeRemoved</span> || <span class="i">CheckJobCanBeRemoved</span>(<span class="r28 r">job</span>, <a href="#7440881b9840a029" class="i field">NameParameter</a>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedNameNotCompleted</span>, <span class="r28 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>, <span class="r28 r">job</span>.<a href="../client/Job.cs.html#6332c7ef857bb146" class="i property">Name</a>))
                    {
                        <b>if</b> (<span class="r24 r">writeobject</span>)
                        {
                            <a href="../../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r28 r">job</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r19 r">matches</span>.<span class="i">Add</span>(<span class="r28 r">job</span>);
                        }
                    }
                    <span class="c">// break;</span>
                }
 
                <span class="c">// check if the job is available in any of the childjobs</span>
                <b>if</b> (<span class="r28 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a> != <b>null</b> &amp;&amp; <span class="r28 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a>.<span class="i">Count</span> &gt; 0 &amp;&amp; <span class="r23 r">recurse</span>)
                {
                    <b>bool</b> <span id="r29 rd" class="r29 r">jobFoundinChildJobs</span> = <a href="#09132127e462bb27" class="i method">FindJobsMatchingByNameHelper</a>(<span class="r19 r">matches</span>, <span class="r28 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a>, <span class="r21 r">name</span>,
                                                    <span class="r22 r">duplicateDetector</span>, <span class="r23 r">recurse</span>, <span class="r24 r">writeobject</span>, <span class="r25 r">checkIfJobCanBeRemoved</span>);
 
                    <b>if</b> (<span class="r29 r">jobFoundinChildJobs</span>)
                    {
                        <span class="r26 r">jobFound</span> = <b>true</b>;
                    }
                }
            }
 
            <b>return</b> <span class="r26 r">jobFound</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the jobs in repository which match the specified instanceid.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">writeobject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">if true, method writes the object instead of returning it</span>
        <span class="c">///</span><span class="c"> in list (an empty list is returned).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">writeErrorOnNoMatch</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Write error if no match is found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">checkIfJobCanBeRemoved</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Check if this job can be removed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">recurse</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Look in all child jobs.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of matching jobs.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <a id="faea27dc9874c464" href="../../../R/faea27dc9874c464.html" target="n" data-glyph="74,1" class="i method">FindJobsMatchingByInstanceId</a>(<b>bool</b> <span id="r33 rd" class="r33 r">recurse</span>, <b>bool</b> <span id="r30 rd" class="r30 r">writeobject</span>, <b>bool</b> <span id="r31 rd" class="r31 r">writeErrorOnNoMatch</span>, <b>bool</b> <span id="r32 rd" class="r32 r">checkIfJobCanBeRemoved</span>)
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r34 rd" class="r34 r">matches</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
 
            <span class="i">Hashtable</span> <span id="r35 rd" class="r35 r">duplicateDetector</span> = <b>new</b> <span class="i">Hashtable</span>();
 
            <b>if</b> (<a href="#60b0a69bf614b6e8" class="i field">_instanceIds</a> == <b>null</b>) <b>return</b> <span class="r34 r">matches</span>;
 
            <b>foreach</b> (<span class="i">Guid</span> <span id="r36 rd" class="r36 r">id</span> <b>in</b> <a href="#60b0a69bf614b6e8" class="i field">_instanceIds</a>)
            {
                <span class="c">// search all jobs in Job repository</span>
                <span class="r35 r">duplicateDetector</span>.<span class="i">Clear</span>();
                <b>bool</b> <span id="r37 rd" class="r37 r">jobFound</span> = <span class="i">FindJobsMatchingByInstanceIdHelper</span>(<span class="r34 r">matches</span>, <a href="../../CommandBase.cs.html#025e5235224e3234" class="i property">JobRepository</a>.<a href="JobRepository.cs.html#2d8e4e2819a2e8c8" class="i property">Jobs</a>, <span class="r36 r">id</span>,
                                    <span class="r35 r">duplicateDetector</span>, <span class="r33 r">recurse</span>, <span class="r30 r">writeobject</span>, <span class="r32 r">checkIfJobCanBeRemoved</span>);
 
                <span class="c">// TODO: optimize this to not search JobManager since matching by InstanceId is unique</span>
                <span class="c">// search all jobs in JobManager</span>
                <a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r38 rd" class="r38 r">job2</span> = <a href="../../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../client/JobManager.cs.html#1665cfdaa5d31251" class="i method">GetJobByInstanceId</a>(<span class="r36 r">id</span>, <a href="#6d4a842df78cbd2d" class="k">this</a>, <b>false</b>, <span class="r30 r">writeobject</span>, <span class="r33 r">recurse</span>);
 
                <b>bool</b> <span id="r39 rd" class="r39 r">job2Found</span> = <span class="r38 r">job2</span> != <b>null</b>;
 
                <b>if</b> (<span class="r39 r">job2Found</span>)
                {
                    <b>if</b> (<span class="i">CheckIfJob2CanBeRemoved</span>(<span class="r32 r">checkIfJobCanBeRemoved</span>, <a href="#7bb9265f1e48fcb9" class="i field">InstanceIdParameter</a>, <span class="r38 r">job2</span>,
                        <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedInstanceIdNotCompleted</span>, <span class="r38 r">job2</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>, <span class="r38 r">job2</span>.<a href="../client/Job.cs.html#958365243a8fc2cd" class="i property">InstanceId</a>))
                    {
                        <span class="r34 r">matches</span>.<span class="i">Add</span>(<span class="r38 r">job2</span>);
                    }
                }
 
                <span class="r37 r">jobFound</span> = <span class="r37 r">jobFound</span> || <span class="r39 r">job2Found</span>;
 
                <b>if</b> (<span class="r37 r">jobFound</span> || !<span class="r31 r">writeErrorOnNoMatch</span>) <b>continue</b>;
 
                <span class="i">Exception</span> <span id="r40 rd" class="r40 r">ex</span> = <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<a href="#7bb9265f1e48fcb9" class="i field">InstanceIdParameter</a>,
                                                                  <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedInstanceIdNotFound</span>,
                                                                  <span class="r36 r">id</span>);
 
                <a href="../../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r40 r">ex</span>, <span class="s">&quot;JobWithSpecifiedInstanceIdNotFound&quot;</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r36 r">id</span>));
            }
 
            <b>return</b> <span class="r34 r">matches</span>;
        }
 
        <b>private bool</b> <a id="0322d4e6456a2bdb" href="../../../R/0322d4e6456a2bdb.html" target="n" data-glyph="76,1" class="i method">FindJobsMatchingByInstanceIdHelper</a>(<span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r41 rd" class="r41 r">matches</span>, <span class="i">IList</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r42 rd" class="r42 r">jobsToSearch</span>, <span class="i">Guid</span> <span id="r43 rd" class="r43 r">instanceId</span>,
                        <span class="i">Hashtable</span> <span id="r44 rd" class="r44 r">duplicateDetector</span>, <b>bool</b> <span id="r45 rd" class="r45 r">recurse</span>, <b>bool</b> <span id="r46 rd" class="r46 r">writeobject</span>, <b>bool</b> <span id="r47 rd" class="r47 r">checkIfJobCanBeRemoved</span>)
        {
            <b>bool</b> <span id="r48 rd" class="r48 r">jobFound</span> = <b>false</b>;
 
            <span class="c">// Most likely users will ask for top level jobs.</span>
            <span class="c">// So in order to be more efficient, first look</span>
            <span class="c">// into the top level jobs and only if a match is</span>
            <span class="c">// not found in the top level jobs, recurse. This</span>
            <span class="c">// will ensure that we get a pretty quick hit when</span>
            <span class="c">// the job tree is more than 2 levels deep</span>
 
            <span class="c">// check if job is found in top level item</span>
            <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r49 rd" class="r49 r">job</span> <b>in</b> <span class="r42 r">jobsToSearch</span>)
            {
                <b>if</b> (<span class="r44 r">duplicateDetector</span>.<span class="i">ContainsKey</span>(<span class="r49 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>))
                {
                    <b>continue</b>;
                }
 
                <span class="r44 r">duplicateDetector</span>.<span class="i">Add</span>(<span class="r49 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>, <span class="r49 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>);
 
                <b>if</b> (<span class="r49 r">job</span>.<a href="../client/Job.cs.html#958365243a8fc2cd" class="i property">InstanceId</a> == <span class="r43 r">instanceId</span>)
                {
                    <span class="r48 r">jobFound</span> = <b>true</b>;
                    <b>if</b> (!<span class="r47 r">checkIfJobCanBeRemoved</span> || <span class="i">CheckJobCanBeRemoved</span>(<span class="r49 r">job</span>, <a href="#7bb9265f1e48fcb9" class="i field">InstanceIdParameter</a>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedInstanceIdNotCompleted</span>, <span class="r49 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>, <span class="r49 r">job</span>.<a href="../client/Job.cs.html#958365243a8fc2cd" class="i property">InstanceId</a>))
                    {
                        <span class="c">// instance id is unique, so once a match is found</span>
                        <span class="c">// you can break</span>
                        <b>if</b> (<span class="r46 r">writeobject</span>)
                        {
                            <a href="../../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r49 r">job</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r41 r">matches</span>.<span class="i">Add</span>(<span class="r49 r">job</span>);
                        }
 
                        <b>break</b>;
                    }
                }
            }
 
            <span class="c">// check if a match is found in the child jobs</span>
            <b>if</b> (!<span class="r48 r">jobFound</span> &amp;&amp; <span class="r45 r">recurse</span>)
            {
                <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r50 rd" class="r50 r">job</span> <b>in</b> <span class="r42 r">jobsToSearch</span>)
                {
                    <b>if</b> (<span class="r50 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a> != <b>null</b> &amp;&amp; <span class="r50 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="r48 r">jobFound</span> = <a href="#0322d4e6456a2bdb" class="i method">FindJobsMatchingByInstanceIdHelper</a>(<span class="r41 r">matches</span>, <span class="r50 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a>, <span class="r43 r">instanceId</span>,
                                        <span class="r44 r">duplicateDetector</span>, <span class="r45 r">recurse</span>, <span class="r46 r">writeobject</span>, <span class="r47 r">checkIfJobCanBeRemoved</span>);
 
                        <b>if</b> (<span class="r48 r">jobFound</span>)
                        {
                            <b>break</b>;
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r48 r">jobFound</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the jobs in repository which match the specified session ids.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">writeobject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">if true, method writes the object instead of returning it</span>
        <span class="c">///</span><span class="c"> in list (an empty list is returned).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">writeErrorOnNoMatch</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Write error if no match is found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">checkIfJobCanBeRemoved</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Check if this job can be removed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">recurse</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Look in child jobs as well.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of matching jobs.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <a id="1bcdf7b70be6c851" href="../../../R/1bcdf7b70be6c851.html" target="n" data-glyph="74,1" class="i method">FindJobsMatchingBySessionId</a>(<b>bool</b> <span id="r54 rd" class="r54 r">recurse</span>, <b>bool</b> <span id="r51 rd" class="r51 r">writeobject</span>, <b>bool</b> <span id="r52 rd" class="r52 r">writeErrorOnNoMatch</span>, <b>bool</b> <span id="r53 rd" class="r53 r">checkIfJobCanBeRemoved</span>)
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r55 rd" class="r55 r">matches</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
 
            <b>if</b> (<a href="#a44e3bfbe015f123" class="i field">_sessionIds</a> == <b>null</b>) <b>return</b> <span class="r55 r">matches</span>;
 
            <span class="i">Hashtable</span> <span id="r56 rd" class="r56 r">duplicateDetector</span> = <b>new</b> <span class="i">Hashtable</span>();
 
            <b>foreach</b> (<b>int</b> <span id="r57 rd" class="r57 r">id</span> <b>in</b> <a href="#a44e3bfbe015f123" class="i field">_sessionIds</a>)
            {
                <span class="c">// check jobs in job repository</span>
                <b>bool</b> <span id="r58 rd" class="r58 r">jobFound</span> = <span class="i">FindJobsMatchingBySessionIdHelper</span>(<span class="r55 r">matches</span>, <a href="../../CommandBase.cs.html#025e5235224e3234" class="i property">JobRepository</a>.<a href="JobRepository.cs.html#2d8e4e2819a2e8c8" class="i property">Jobs</a>, <span class="r57 r">id</span>,
                                    <span class="r56 r">duplicateDetector</span>, <span class="r54 r">recurse</span>, <span class="r51 r">writeobject</span>, <span class="r53 r">checkIfJobCanBeRemoved</span>);
 
                <span class="c">// check jobs in job manager</span>
                <a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r59 rd" class="r59 r">job2</span> = <a href="../../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../client/JobManager.cs.html#b0cf5367ed4b0c54" class="i method">GetJobById</a>(<span class="r57 r">id</span>, <a href="#6d4a842df78cbd2d" class="k">this</a>, <b>false</b>, <span class="r51 r">writeobject</span>, <span class="r54 r">recurse</span>);
                <b>bool</b> <span id="r60 rd" class="r60 r">job2Found</span> = <span class="r59 r">job2</span> != <b>null</b>;
 
                <b>if</b> (<span class="r60 r">job2Found</span>)
                {
                    <b>if</b> (<span class="i">CheckIfJob2CanBeRemoved</span>(<span class="r53 r">checkIfJobCanBeRemoved</span>, <a href="#b6f0a53c4e58891f" class="i field">SessionIdParameter</a>, <span class="r59 r">job2</span>,
                        <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedSessionIdNotCompleted</span>, <span class="r59 r">job2</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>))
                    {
                        <span class="r55 r">matches</span>.<span class="i">Add</span>(<span class="r59 r">job2</span>);
                    }
                }
 
                <span class="r58 r">jobFound</span> = <span class="r58 r">jobFound</span> || <span class="r60 r">job2Found</span>;
 
                <b>if</b> (<span class="r58 r">jobFound</span> || !<span class="r52 r">writeErrorOnNoMatch</span>) <b>continue</b>;
 
                <span class="i">Exception</span> <span id="r61 rd" class="r61 r">ex</span> = <a href="../../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewArgumentException</span>(<a href="#b6f0a53c4e58891f" class="i field">SessionIdParameter</a>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedSessionIdNotFound</span>, <span class="r57 r">id</span>);
                <a href="../../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <a href="../../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r61 r">ex</span>, <span class="s">&quot;JobWithSpecifiedSessionNotFound&quot;</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <span class="r57 r">id</span>));
            }
 
            <b>return</b> <span class="r55 r">matches</span>;
        }
 
        <b>private bool</b> <a id="39de811f5d7e84af" href="../../../R/39de811f5d7e84af.html" target="n" data-glyph="76,1" class="i method">FindJobsMatchingBySessionIdHelper</a>(<span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r62 rd" class="r62 r">matches</span>, <span class="i">IList</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r63 rd" class="r63 r">jobsToSearch</span>, <b>int</b> <span id="r64 rd" class="r64 r">sessionId</span>,
                        <span class="i">Hashtable</span> <span id="r65 rd" class="r65 r">duplicateDetector</span>, <b>bool</b> <span id="r66 rd" class="r66 r">recurse</span>, <b>bool</b> <span id="r67 rd" class="r67 r">writeobject</span>, <b>bool</b> <span id="r68 rd" class="r68 r">checkIfJobCanBeRemoved</span>)
        {
            <b>bool</b> <span id="r69 rd" class="r69 r">jobFound</span> = <b>false</b>;
 
            <span class="c">// Most likely users will ask for top level jobs.</span>
            <span class="c">// So in order to be more efficient, first look</span>
            <span class="c">// into the top level jobs and only if a match is</span>
            <span class="c">// not found in the top level jobs, recurse. This</span>
            <span class="c">// will ensure that we get a pretty quick hit when</span>
            <span class="c">// the job tree is more than 2 levels deep</span>
 
            <span class="c">// check if there is a match in the top level jobs</span>
            <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r70 rd" class="r70 r">job</span> <b>in</b> <span class="r63 r">jobsToSearch</span>)
            {
                <b>if</b> (<span class="r70 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a> == <span class="r64 r">sessionId</span>)
                {
                    <span class="r69 r">jobFound</span> = <b>true</b>;
                    <b>if</b> (!<span class="r68 r">checkIfJobCanBeRemoved</span> || <span class="i">CheckJobCanBeRemoved</span>(<span class="r70 r">job</span>, <a href="#b6f0a53c4e58891f" class="i field">SessionIdParameter</a>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedSessionIdNotCompleted</span>, <span class="r70 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>))
                    {
                        <b>if</b> (<span class="r67 r">writeobject</span>)
                        {
                            <a href="../../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r70 r">job</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r62 r">matches</span>.<span class="i">Add</span>(<span class="r70 r">job</span>);
                        }
 
                        <span class="c">// session id will be unique for every session, so</span>
                        <span class="c">// can break after the first match</span>
                        <b>break</b>;
                    }
                }
            }
 
            <span class="c">// check if there is a match found in the child jobs</span>
            <b>if</b> (!<span class="r69 r">jobFound</span> &amp;&amp; <span class="r66 r">recurse</span>)
            {
                <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r71 rd" class="r71 r">job</span> <b>in</b> <span class="r63 r">jobsToSearch</span>)
                {
                    <b>if</b> (<span class="r71 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a> != <b>null</b> &amp;&amp; <span class="r71 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="r69 r">jobFound</span> = <a href="#39de811f5d7e84af" class="i method">FindJobsMatchingBySessionIdHelper</a>(<span class="r62 r">matches</span>, <span class="r71 r">job</span>.<a href="../client/Job.cs.html#db120f2476b59753" class="i property">ChildJobs</a>, <span class="r64 r">sessionId</span>,
                                        <span class="r65 r">duplicateDetector</span>, <span class="r66 r">recurse</span>, <span class="r67 r">writeobject</span>, <span class="r68 r">checkIfJobCanBeRemoved</span>);
 
                        <b>if</b> (<span class="r69 r">jobFound</span>)
                        {
                            <b>break</b>;
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r69 r">jobFound</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the jobs in repository which match the specified command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">writeobject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">if true, method writes the object instead of returning it</span>
        <span class="c">///</span><span class="c"> in list (an empty list is returned).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of matching jobs.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <a id="0686e7cda13a0368" href="../../../R/0686e7cda13a0368.html" target="n" data-glyph="74,1" class="i method">FindJobsMatchingByCommand</a>(
            <b>bool</b> <span id="r72 rd" class="r72 r">writeobject</span>)
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r73 rd" class="r73 r">matches</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
 
            <b>if</b> (<a href="#dbe61d1c68cc3500" class="i field">_commands</a> == <b>null</b>) <b>return</b> <span class="r73 r">matches</span>;
 
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r74 rd" class="r74 r">jobs</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
 
            <span class="r74 r">jobs</span>.<span class="i">AddRange</span>(<a href="../../CommandBase.cs.html#025e5235224e3234" class="i property">JobRepository</a>.<a href="JobRepository.cs.html#2d8e4e2819a2e8c8" class="i property">Jobs</a>);
 
            <b>foreach</b> (<b>string</b> <span id="r75 rd" class="r75 r">command</span> <b>in</b> <a href="#dbe61d1c68cc3500" class="i field">_commands</a>)
            {
                <span class="i">List</span>&lt;<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>&gt; <span id="r76 rd" class="r76 r">jobs2</span> = <a href="../../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../client/JobManager.cs.html#35d9bbea3aedf81b" class="i method">GetJobsByCommand</a>(<span class="r75 r">command</span>, <a href="#6d4a842df78cbd2d" class="k">this</a>, <b>false</b>, <b>false</b>, <b>false</b>, <b>null</b>);
 
                <b>if</b> (<span class="r76 r">jobs2</span> != <b>null</b>)
                {
                    <b>foreach</b> (<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r77 rd" class="r77 r">job2</span> <b>in</b> <span class="r76 r">jobs2</span>)
                    {
                        <span class="r74 r">jobs</span>.<span class="i">Add</span>(<span class="r77 r">job2</span>);
                    }
                }
 
                <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r78 rd" class="r78 r">job</span> <b>in</b> <span class="r74 r">jobs</span>)
                {
                    <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r79 rd" class="r79 r">commandPattern</span> = <a href="../../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r75 r">command</span>, <a href="../../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
                    <b>string</b> <span id="r80 rd" class="r80 r">jobCommand</span> = <span class="r78 r">job</span>.<a href="../client/Job.cs.html#8cc82c1860b7ef46" class="i property">Command</a>.<span class="i">Trim</span>();
                    <span class="c">// Win8: 469830</span>
                    <span class="c">// Win7 code does not have commandPattern.IsMatch. We added wildcard support for Command parameterset</span>
                    <span class="c">// in Win8 which breaks scenarios where the actual command has wildcards.)</span>
                    <b>if</b> (<span class="r80 r">jobCommand</span>.<span class="i">Equals</span>(<span class="r75 r">command</span>.<span class="i">Trim</span>(), <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) || <span class="r79 r">commandPattern</span>.<a href="../../regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r80 r">jobCommand</span>))
                    {
                        <b>if</b> (<span class="r72 r">writeobject</span>)
                        {
                            <a href="../../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r78 r">job</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r73 r">matches</span>.<span class="i">Add</span>(<span class="r78 r">job</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r73 r">matches</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the jobs in repository which match the specified state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">writeobject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">if true, method writes the object instead of returning it</span>
        <span class="c">///</span><span class="c"> in list (an empty list is returned).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of matching jobs.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <a id="ac0b99f23202da2f" href="../../../R/ac0b99f23202da2f.html" target="n" data-glyph="74,1" class="i method">FindJobsMatchingByState</a>(
            <b>bool</b> <span id="r81 rd" class="r81 r">writeobject</span>)
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r82 rd" class="r82 r">matches</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r83 rd" class="r83 r">jobs</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
 
            <span class="r83 r">jobs</span>.<span class="i">AddRange</span>(<a href="../../CommandBase.cs.html#025e5235224e3234" class="i property">JobRepository</a>.<a href="JobRepository.cs.html#2d8e4e2819a2e8c8" class="i property">Jobs</a>);
 
            <span class="i">List</span>&lt;<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>&gt; <span id="r84 rd" class="r84 r">jobs2</span> = <a href="../../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../client/JobManager.cs.html#5f477407369eeea8" class="i method">GetJobsByState</a>(<a href="#eef62e9c4f2a913e" class="i field">_jobstate</a>, <a href="#6d4a842df78cbd2d" class="k">this</a>, <b>false</b>, <b>false</b>, <b>false</b>, <b>null</b>);
 
            <b>if</b> (<span class="r84 r">jobs2</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r85 rd" class="r85 r">job2</span> <b>in</b> <span class="r84 r">jobs2</span>)
                {
                    <span class="r83 r">jobs</span>.<span class="i">Add</span>(<span class="r85 r">job2</span>);
                }
            }
 
            <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r86 rd" class="r86 r">job</span> <b>in</b> <span class="r83 r">jobs</span>)
            {
                <b>if</b> (<span class="r86 r">job</span>.<a href="../client/Job.cs.html#896d1d1f27daae5f" class="i property">JobStateInfo</a>.<a href="../client/Job.cs.html#245057a5f4a9ed30" class="i property">State</a> != <a href="#eef62e9c4f2a913e" class="i field">_jobstate</a>) <b>continue</b>;
 
                <b>if</b> (<span class="r81 r">writeobject</span>)
                {
                    <a href="../../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r86 r">job</span>);
                }
                <b>else</b>
                {
                    <span class="r82 r">matches</span>.<span class="i">Add</span>(<span class="r86 r">job</span>);
                }
            }
 
            <b>return</b> <span class="r82 r">matches</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Find the jobs which match the specified filter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">writeobject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <a id="53b57784e4b5b29c" href="../../../R/53b57784e4b5b29c.html" target="n" data-glyph="74,1" class="i method">FindJobsMatchingByFilter</a>(<b>bool</b> <span id="r87 rd" class="r87 r">writeobject</span>)
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r88 rd" class="r88 r">matches</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r89 rd" class="r89 r">jobs</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
 
            <span class="c">// add Jobs from JobRepository -- only job property based filters are supported.</span>
            <a href="#57c1afa99dc87b05" class="i method">FindJobsMatchingByFilterHelper</a>(<span class="r89 r">jobs</span>, <a href="../../CommandBase.cs.html#025e5235224e3234" class="i property">JobRepository</a>.<a href="JobRepository.cs.html#2d8e4e2819a2e8c8" class="i property">Jobs</a>);
 
            <b>var</b> <span id="r90 rd" class="r90 r">filterDictionary</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>object</b>&gt;();
            <b>foreach</b> (<b>string</b> <span id="r91 rd" class="r91 r">item</span> <b>in</b> <a href="#2c8fdf000915e06e" class="i field">_filter</a>.<span class="i">Keys</span>)
            {
                <span class="r90 r">filterDictionary</span>.<span class="i">Add</span>(<span class="r91 r">item</span>, <a href="#2c8fdf000915e06e" class="i field">_filter</a>[<span class="r91 r">item</span>]);
            }
 
            <span class="i">List</span>&lt;<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>&gt; <span id="r92 rd" class="r92 r">jobs2</span> = <a href="../../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../client/JobManager.cs.html#099eeaa0d7dcebc0" class="i method">GetJobsByFilter</a>(<span class="r90 r">filterDictionary</span>, <a href="#6d4a842df78cbd2d" class="k">this</a>, <b>false</b>, <b>false</b>, <b>true</b>);
            <b>if</b> (<span class="r92 r">jobs2</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r93 rd" class="r93 r">job2</span> <b>in</b> <span class="r92 r">jobs2</span>)
                {
                    <span class="r89 r">jobs</span>.<span class="i">Add</span>(<span class="r93 r">job2</span>);
                }
            }
 
            <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r94 rd" class="r94 r">job</span> <b>in</b> <span class="r89 r">jobs</span>)
            {
                <b>if</b> (<span class="r87 r">writeobject</span>)
                {
                    <a href="../../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r94 r">job</span>);
                }
                <b>else</b>
                {
                    <span class="r88 r">matches</span>.<span class="i">Add</span>(<span class="r94 r">job</span>);
                }
            }
 
            <b>return</b> <span class="r88 r">matches</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Used to find the v2 jobs that match a given filter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">matches</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">jobsToSearch</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="57c1afa99dc87b05" href="../../../R/57c1afa99dc87b05.html" target="n" data-glyph="76,1" class="i method">FindJobsMatchingByFilterHelper</a>(<span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r95 rd" class="r95 r">matches</span>, <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r96 rd" class="r96 r">jobsToSearch</span>)
        {
            <span class="c">// check that filter only has job properties</span>
            <span class="c">// if so, filter on one at a time using helpers.</span>
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Copies the jobs to list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">jobs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r98 r">writeobject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">if true, method writes the object instead of returning it</span>
        <span class="c">///</span><span class="c"> in list (an empty list is returned).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">checkIfJobCanBeRemoved</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true, only jobs which can be removed will be checked.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <a id="04e45c0550b343e8" href="../../../R/04e45c0550b343e8.html" target="n" data-glyph="74,1" class="i method">CopyJobsToList</a>(<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>[] <span id="r97 rd" class="r97 r">jobs</span>, <b>bool</b> <span id="r98 rd" class="r98 r">writeobject</span>, <b>bool</b> <span id="r99 rd" class="r99 r">checkIfJobCanBeRemoved</span>)
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r100 rd" class="r100 r">matches</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt;();
            <b>if</b> (<span class="r97 r">jobs</span> == <b>null</b>) <b>return</b> <span class="r100 r">matches</span>;
 
            <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r101 rd" class="r101 r">job</span> <b>in</b> <span class="r97 r">jobs</span>)
            {
                <b>if</b> (!<span class="r99 r">checkIfJobCanBeRemoved</span> || <span class="i">CheckJobCanBeRemoved</span>(<span class="r101 r">job</span>, <span class="s">&quot;Job&quot;</span>, <span class="i">RemotingErrorIdStrings</span>.<span class="i">JobWithSpecifiedSessionIdNotCompleted</span>, <span class="r101 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>))
                {
                    <b>if</b> (<span class="r98 r">writeobject</span>)
                    {
                        <a href="../../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r101 r">job</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r100 r">matches</span>.<span class="i">Add</span>(<span class="r101 r">job</span>);
                    }
                }
            }
 
            <b>return</b> <span class="r100 r">matches</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks that this job object can be removed. If not, writes an error record.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">job</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Job object to be removed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">parameterName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of the parameter which is associated with this job object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">resourceString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Resource String in case of error.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">list</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Parameters for resource message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if object should be removed, else false.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="0b4ead4103ad831e" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CheckJobCanBeRemoved</a>(<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r102 rd" class="r102 r">job</span>, <b>string</b> <span id="r103 rd" class="r103 r">parameterName</span>, <b>string</b> <span id="r104 rd" class="r104 r">resourceString</span>, <b>params object</b>[] <span id="r105 rd" class="r105 r">list</span>)
        {
            <b>if</b> (<span class="r102 r">job</span>.<a href="../client/Job.cs.html#d7179d2607549d3b" class="i method">IsFinishedState</a>(<span class="r102 r">job</span>.<a href="../client/Job.cs.html#896d1d1f27daae5f" class="i property">JobStateInfo</a>.<a href="../client/Job.cs.html#245057a5f4a9ed30" class="i property">State</a>))
                <b>return</b> <b>true</b>;
            <b>string</b> <span id="r106 rd" class="r106 r">message</span> = <a href="../common/remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<a href="../common/remotingexceptions.cs.html#5f4bcb44bc0f3ab2" class="i method">FormatResourceString</a>(<span class="r104 r">resourceString</span>, <span class="r105 r">list</span>);
            <span class="i">Exception</span> <span id="r107 rd" class="r107 r">ex</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="r106 r">message</span>, <span class="r103 r">parameterName</span>);
            <a href="../../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <a href="../../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r107 r">ex</span>, <span class="s">&quot;JobObjectNotFinishedCannotBeRemoved&quot;</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r102 r">job</span>));
            <b>return</b> <b>false</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> JobMatches
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the jobs to retrieve.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>, <a href="../../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                  <a href="../../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                  <a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#6d4a842df78cbd2d" class="t t">JobCmdletBase</a>.<a href="#f6461d28caff9c5c" class="i field">NameParameterSet</a>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b>[] <a id="393788a8060c4e92" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Name</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#1f9a7ed82f1c6c33" class="i field">_names</a>;
            }
 
            <b>set</b>
            {
                <a href="#1f9a7ed82f1c6c33" class="i field">_names</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b>[] <a id="1f9a7ed82f1c6c33" href="../../../R/1f9a7ed82f1c6c33.html" target="n" data-glyph="46,1" class="i field">_names</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> InstanceIds for which job</span>
        <span class="c">///</span><span class="c"> need to be obtained.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>, <a href="../../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                   <a href="../../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                   <a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#6d4a842df78cbd2d" class="t t">JobCmdletBase</a>.<a href="#b9fcc6d73680e09f" class="i field">InstanceIdParameterSet</a>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <span class="i">Guid</span>[] <a id="17692f8241a5db42" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">InstanceId</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#60b0a69bf614b6e8" class="i field">_instanceIds</a>;
            }
 
            <b>set</b>
            {
                <a href="#60b0a69bf614b6e8" class="i field">_instanceIds</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Guid</span>[] <a id="60b0a69bf614b6e8" href="../../../R/60b0a69bf614b6e8.html" target="n" data-glyph="46,1" class="i field">_instanceIds</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> SessionId for which job</span>
        <span class="c">///</span><span class="c"> need to be obtained.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>, <a href="../../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                  <a href="../../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                  <a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#6d4a842df78cbd2d" class="t t">JobCmdletBase</a>.<a href="#5b871caa1267d529" class="i field">SessionIdParameterSet</a>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        <b>public virtual int</b>[] <a id="8ba3e3b858bd8111" href="../../../R/8ba3e3b858bd8111.html" target="n" data-glyph="102,1" class="i property">Id</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a44e3bfbe015f123" class="i field">_sessionIds</a>;
            }
 
            <b>set</b>
            {
                <a href="#a44e3bfbe015f123" class="i field">_sessionIds</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private int</b>[] <a id="a44e3bfbe015f123" href="../../../R/a44e3bfbe015f123.html" target="n" data-glyph="46,1" class="i field">_sessionIds</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> All the job objects having this state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                   <a href="../../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="../../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>,
            <a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#d0202bf60680c003" class="i field">StateParameterSet</a>)]
        <b>public virtual</b> <a href="../client/Job.cs.html#fac7cdff9aee3e4f" class="t t">JobState</a> <a id="8623b79731de3a3f" href="../../../R/8623b79731de3a3f.html" target="n" data-glyph="102,1" class="i property">State</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#eef62e9c4f2a913e" class="i field">_jobstate</a>;
            }
 
            <b>set</b>
            {
                <a href="#eef62e9c4f2a913e" class="i field">_jobstate</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="../client/Job.cs.html#fac7cdff9aee3e4f" class="t t">JobState</a> <a id="eef62e9c4f2a913e" href="../../../R/eef62e9c4f2a913e.html" target="n" data-glyph="46,1" class="i field">_jobstate</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> All the job objects having this command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>,
            <a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#eb6b73fef1e8bcc8" class="i field">CommandParameterSet</a>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public virtual string</b>[] <a id="4e81609be76306ab" href="../../../R/4e81609be76306ab.html" target="n" data-glyph="102,1" class="i property">Command</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#dbe61d1c68cc3500" class="i field">_commands</a>;
            }
 
            <b>set</b>
            {
                <a href="#dbe61d1c68cc3500" class="i field">_commands</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private string</b>[] <a id="dbe61d1c68cc3500" href="../../../R/dbe61d1c68cc3500.html" target="n" data-glyph="46,1" class="i field">_commands</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> All the job objects matching the values in filter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                   <a href="../../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="../../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>,
            <a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#68ab1e0e7742703e" class="i field">FilterParameterSet</a>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>)]
        <b>public virtual</b> <span class="i">Hashtable</span> <a id="cc688a83e662b4e4" href="../../../R/cc688a83e662b4e4.html" target="n" data-glyph="102,1" class="i property">Filter</a>
        {
            <b>get</b> { <b>return</b> <a href="#2c8fdf000915e06e" class="i field">_filter</a>; }
 
            <b>set</b> { <a href="#2c8fdf000915e06e" class="i field">_filter</a> = <b>value</b>; }
        }
 
        <b>private</b> <span class="i">Hashtable</span> <a id="2c8fdf000915e06e" href="../../../R/2c8fdf000915e06e.html" target="n" data-glyph="46,1" class="i field">_filter</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> All remoting cmdlets other than Start-PSJob should</span>
        <span class="c">///</span><span class="c"> continue to work even if PowerShell remoting is not</span>
        <span class="c">///</span><span class="c"> enabled. This is because jobs are based out of APIs</span>
        <span class="c">///</span><span class="c"> and there can be other job implementations like</span>
        <span class="c">///</span><span class="c"> eventing or WMI which are not based on PowerShell</span>
        <span class="c">///</span><span class="c"> remoting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="5f9c67344ed0ca78" href="../../../R/5f9c67344ed0ca78.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <a href="../../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<a href="../../CommandDiscovery.cs.html#6942b167a12adddf" class="i method">AutoloadModulesWithJobSourceAdapters</a>(<a href="#6d4a842df78cbd2d" class="k">this</a>.<a href="../../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#6d4a842df78cbd2d" class="k">this</a>.<a href="../../CommandBase.cs.html#6cef80897300e0a9" class="i property">CommandOrigin</a>);
            <span class="c">// intentionally left blank to avoid</span>
            <span class="c">// check being performed in base.BeginProcessing()</span>
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This cmdlet removes the Job object from the runspace</span>
    <span class="c">///</span><span class="c"> wide Job repository.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> Once the Job object is removed, it will not be available</span>
    <span class="c">///</span><span class="c"> through get-psjob command.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="../../../utils/Verbs.cs.html#d056c4b8c99405e5" class="t t">VerbsCommon</a>.<a href="../../../utils/Verbs.cs.html#ac76dfa67303c925" class="i field">Remove</a>, <span class="s">&quot;Job&quot;</span>, <span class="i">SupportsShouldProcess</span> = <b>true</b>, <span class="i">DefaultParameterSetName</span> = <a href="#6d4a842df78cbd2d" class="t t">JobCmdletBase</a>.<a href="#5b871caa1267d529" class="i field">SessionIdParameterSet</a>,
        <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096868&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>), <a href="../../Attributes.cs.html#0f118c29e97e12b3" class="i property">ParameterSetName</a> = <b>new</b> <b>string</b>[] { <a href="#6d4a842df78cbd2d" class="t t">JobCmdletBase</a>.<a href="#1d8e9765284b68f7" class="i field">JobParameterSet</a> })]
    <b>public class</b> <a id="61d072004a97a004" href="../../../R/61d072004a97a004.html" target="n" data-glyph="0,0" class="t t"><span id="c8a580dad34151bf">RemoveJobCommand</span></a> : <a href="#6d4a842df78cbd2d" class="t t">JobCmdletBase</a>, <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Parameters
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Specifies the Jobs objects which need to be</span>
        <span class="c">///</span><span class="c"> removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>,
                   <a href="../../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0,
                   <a href="../../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>,
                   <a href="../../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>,
                   <a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#1d8e9765284b68f7" class="i field">JobParameterSet</a>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public</b> <a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>[] <a id="b0619ab44ce826ab" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Job</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#4b9c6a89cbbba41e" class="i field">_jobs</a>;
            }
 
            <b>set</b>
            {
                <a href="#4b9c6a89cbbba41e" class="i field">_jobs</a> = <b>value</b>;
            }
        }
 
        <b>private</b> <a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>[] <a id="4b9c6a89cbbba41e" href="../../../R/4b9c6a89cbbba41e.html" target="n" data-glyph="46,1" class="i field">_jobs</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If state of the job is running or notstarted, this will forcefully stop it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#b9fcc6d73680e09f" class="i field">InstanceIdParameterSet</a>)]
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#1d8e9765284b68f7" class="i field">JobParameterSet</a>)]
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#f6461d28caff9c5c" class="i field">NameParameterSet</a>)]
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#5b871caa1267d529" class="i field">SessionIdParameterSet</a>)]
        [<span class="i">Parameter</span>(<a href="../../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#61d072004a97a004" class="t t">RemoveJobCommand</a>.<a href="#68ab1e0e7742703e" class="i field">FilterParameterSet</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;F&quot;</span>)]
        <b>public</b> <a href="../../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="8544d4335e8de4a1" href="../../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Force</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#af4d31d776f5c970" class="i field">_force</a>;
            }
 
            <b>set</b>
            {
                <a href="#af4d31d776f5c970" class="i field">_force</a> = <b>value</b>;
            }
        }
 
        <b>private bool</b> <a id="af4d31d776f5c970" href="../../../R/af4d31d776f5c970.html" target="n" data-glyph="46,1" class="i field">_force</a> = <b>false</b>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Overrides
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the job object as per the parameter and removes it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="29a64caea83c12cc" href="../../../R/29a64caea83c12cc.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <span class="i">List</span>&lt;<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>&gt; <span id="r108 rd" class="r108 r">listOfJobsToRemove</span> = <b>null</b>;
 
            <b>switch</b> (<a href="../../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>)
            {
                <b>case</b> <a href="#f6461d28caff9c5c" class="i field">NameParameterSet</a>:
                    {
                        <span class="r108 r">listOfJobsToRemove</span> = <span class="i">FindJobsMatchingByName</span>(<b>false</b>, <b>false</b>, <b>true</b>, !<a href="#af4d31d776f5c970" class="i field">_force</a>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <a href="#b9fcc6d73680e09f" class="i field">InstanceIdParameterSet</a>:
                    {
                        <span class="r108 r">listOfJobsToRemove</span> = <span class="i">FindJobsMatchingByInstanceId</span>(<b>true</b>, <b>false</b>, <b>true</b>, !<a href="#af4d31d776f5c970" class="i field">_force</a>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <a href="#5b871caa1267d529" class="i field">SessionIdParameterSet</a>:
                    {
                        <span class="r108 r">listOfJobsToRemove</span> = <span class="i">FindJobsMatchingBySessionId</span>(<b>true</b>, <b>false</b>, <b>true</b>, !<a href="#af4d31d776f5c970" class="i field">_force</a>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <a href="#eb6b73fef1e8bcc8" class="i field">CommandParameterSet</a>:
                    {
                        <span class="r108 r">listOfJobsToRemove</span> = <a href="#0686e7cda13a0368" class="i method">FindJobsMatchingByCommand</a>(<b>false</b>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <a href="#d0202bf60680c003" class="i field">StateParameterSet</a>:
                    {
                        <span class="r108 r">listOfJobsToRemove</span> = <a href="#ac0b99f23202da2f" class="i method">FindJobsMatchingByState</a>(<b>false</b>);
                    }
 
                    <b>break</b>;
 
                <b>case</b> <a href="#68ab1e0e7742703e" class="i field">FilterParameterSet</a>:
                    {
                        <span class="r108 r">listOfJobsToRemove</span> = <a href="#53b57784e4b5b29c" class="i method">FindJobsMatchingByFilter</a>(<b>false</b>);
                    }
 
                    <b>break</b>;
 
                <b>default</b>:
                    {
                        <span class="r108 r">listOfJobsToRemove</span> = <span class="i">CopyJobsToList</span>(<a href="#4b9c6a89cbbba41e" class="i field">_jobs</a>, <b>false</b>, !<a href="#af4d31d776f5c970" class="i field">_force</a>);
                    }
 
                    <b>break</b>;
            }
 
            <span class="c">// Now actually remove the jobs</span>
            <b>foreach</b> (<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r109 rd" class="r109 r">job</span> <b>in</b> <span class="r108 r">listOfJobsToRemove</span>)
            {
                <b>string</b> <span id="r110 rd" class="r110 r">message</span> = <span class="i">GetMessage</span>(<span class="i">RemotingErrorIdStrings</span>.<span class="i">StopPSJobWhatIfTarget</span>,
                        <span class="r109 r">job</span>.<a href="../client/Job.cs.html#8cc82c1860b7ef46" class="i property">Command</a>, <span class="r109 r">job</span>.<a href="../client/Job.cs.html#aa91c39ac1b0bcec" class="i property">Id</a>);
 
                <b>if</b> (!<a href="../../cmdlet.cs.html#5f125d2ab6d0970d" class="i method">ShouldProcess</a>(<span class="r110 r">message</span>, <a href="../../../utils/Verbs.cs.html#d056c4b8c99405e5" class="t t">VerbsCommon</a>.<a href="../../../utils/Verbs.cs.html#ac76dfa67303c925" class="i field">Remove</a>)) <b>continue</b>;
 
                <a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a> <span id="r111 rd" class="r111 r">job2</span> = <span class="r109 r">job</span> <b>as</b> <a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>;
                <b>if</b> (!<span class="r109 r">job</span>.<a href="../client/Job.cs.html#d7179d2607549d3b" class="i method">IsFinishedState</a>(<span class="r109 r">job</span>.<a href="../client/Job.cs.html#896d1d1f27daae5f" class="i property">JobStateInfo</a>.<a href="../client/Job.cs.html#245057a5f4a9ed30" class="i property">State</a>))
                {
                    <span class="c">// if it is a Job2, then async is supported</span>
                    <span class="c">// stop the job asynchronously</span>
                    <b>if</b> (<span class="r111 r">job2</span> != <b>null</b>)
                    {
                        <a href="#584e3cb7f21ab2b9" class="i field">_cleanUpActions</a>.<span class="i">Add</span>(<span class="r111 r">job2</span>, <span class="i">HandleStopJobCompleted</span>);
                        <span class="r111 r">job2</span>.<a href="../client/Job2.cs.html#0462f78c49dda28a" class="i">StopJobCompleted</a> += <span class="i">HandleStopJobCompleted</span>;
 
                        <b>lock</b> (<a href="#757e09d4cb397e4a" class="i field">_syncObject</a>)
                        {
                            <b>if</b> (!<span class="r111 r">job2</span>.<a href="../client/Job.cs.html#d7179d2607549d3b" class="i method">IsFinishedState</a>(<span class="r111 r">job2</span>.<a href="../client/Job.cs.html#896d1d1f27daae5f" class="i property">JobStateInfo</a>.<a href="../client/Job.cs.html#245057a5f4a9ed30" class="i property">State</a>) &amp;&amp;
                                !<a href="#3bf429e619e19c26" class="i field">_pendingJobs</a>.<span class="i">Contains</span>(<span class="r111 r">job2</span>.<a href="../client/Job.cs.html#958365243a8fc2cd" class="i property">InstanceId</a>))
                            {
                                <a href="#3bf429e619e19c26" class="i field">_pendingJobs</a>.<span class="i">Add</span>(<span class="r111 r">job2</span>.<a href="../client/Job.cs.html#958365243a8fc2cd" class="i property">InstanceId</a>);
                            }
                        }
 
                        <span class="r111 r">job2</span>.<a href="../client/Job2.cs.html#17da884baa3fadf4" class="i method">StopJobAsync</a>();
                    }
                    <b>else</b>
                    {
                        <span class="r109 r">job</span>.<a href="../client/Job.cs.html#5e60404c217f5d42" class="i method">StopJob</a>();
                        <a href="#fbbe719c1b7da351" class="i method">RemoveJobAndDispose</a>(<span class="r109 r">job</span>, <b>false</b>);
                    }
                }
                <b>else</b>
                {
                    <a href="#fbbe719c1b7da351" class="i method">RemoveJobAndDispose</a>(<span class="r109 r">job</span>, <span class="r111 r">job2</span> != <b>null</b>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wait for all the stop jobs to be completed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="5a3e359c9413561c" href="../../../R/5a3e359c9413561c.html" target="n" data-glyph="75,1" class="i method">EndProcessing</a>()
        {
            <b>bool</b> <span id="r112 rd" class="r112 r">haveToWait</span> = <b>false</b>;
            <b>lock</b> (<a href="#757e09d4cb397e4a" class="i field">_syncObject</a>)
            {
                <a href="#305ff9f5b4db2435" class="i field">_needToCheckForWaitingJobs</a> = <b>true</b>;
                <b>if</b> (<a href="#3bf429e619e19c26" class="i field">_pendingJobs</a>.<span class="i">Count</span> &gt; 0)
                    <span class="r112 r">haveToWait</span> = <b>true</b>;
            }
 
            <b>if</b> (<span class="r112 r">haveToWait</span>)
                <a href="#697e34a969677364" class="i field">_waitForJobs</a>.<span class="i">WaitOne</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Release waiting for jobs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="b187a9ecc17922ee" href="../../../R/b187a9ecc17922ee.html" target="n" data-glyph="75,1" class="i method">StopProcessing</a>()
        {
            <a href="#697e34a969677364" class="i field">_waitForJobs</a>.<span class="i">Set</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Overrides
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Methods
        <b>private void</b> <a id="fbbe719c1b7da351" href="../../../R/fbbe719c1b7da351.html" target="n" data-glyph="76,1" class="i method">RemoveJobAndDispose</a>(<a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r113 rd" class="r113 r">job</span>, <b>bool</b> <span id="r114 rd" class="r114 r">jobIsJob2</span>)
        {
            <b>try</b>
            {
                <b>bool</b> <span id="r115 rd" class="r115 r">job2TypeFound</span> = <b>false</b>;
 
                <b>if</b> (<span class="r114 r">jobIsJob2</span>)
                {
                    <span class="r115 r">job2TypeFound</span> = <a href="../../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../client/JobManager.cs.html#f7d214b0d127f694" class="i method">RemoveJob</a>(<span class="r113 r">job</span> <b>as</b> <a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>, <a href="#61d072004a97a004" class="k">this</a>, <b>true</b>, <b>false</b>);
                }
 
                <b>if</b> (!<span class="r115 r">job2TypeFound</span>)
                {
                    <a href="../../CommandBase.cs.html#025e5235224e3234" class="i property">JobRepository</a>.<a href="JobRepository.cs.html#473d130845fed012" class="i method">Remove</a>(<span class="r113 r">job</span>);
                }
 
                <span class="r113 r">job</span>.<a href="../client/Job.cs.html#a1b7a0cd2d734ade" class="i method">Dispose</a>();
            }
            <b>catch</b> (<span class="i">ArgumentException</span> <span id="r116 rd" class="r116 r">ex</span>)
            {
                <b>string</b> <span id="r117 rd" class="r117 r">message</span> = <a href="../common/remotingexceptions.cs.html#53047fc052e9b445" class="t t">PSRemotingErrorInvariants</a>.<span class="i">FormatResourceString</span>(
                                        <span class="i">RemotingErrorIdStrings</span>.<span class="i">CannotRemoveJob</span>);
 
                <span class="i">ArgumentException</span> <span id="r118 rd" class="r118 r">ex2</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="r117 r">message</span>, <span class="r116 r">ex</span>);
                <a href="../../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<span class="r118 r">ex2</span>, <span class="s">&quot;CannotRemoveJob&quot;</span>, <a href="../../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r113 r">job</span>));
            }
        }
 
        <b>private void</b> <a id="6f5d2ff7b791a612" href="../../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HandleStopJobCompleted</a>(<b>object</b> <span id="r119 rd" class="r119 r">sender</span>, <span class="i">AsyncCompletedEventArgs</span> <span id="r120 rd" class="r120 r">eventArgs</span>)
        {
            <a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a> <span id="r121 rd" class="r121 r">job</span> = <span class="r119 r">sender</span> <b>as</b> <a href="../client/Job.cs.html#e1ff43f6998863de" class="t t">Job</a>;
            <a href="#fbbe719c1b7da351" class="i method">RemoveJobAndDispose</a>(<span class="r121 r">job</span>, <b>true</b>);
 
            <b>bool</b> <span id="r122 rd" class="r122 r">releaseWait</span> = <b>false</b>;
            <b>lock</b> (<a href="#757e09d4cb397e4a" class="i field">_syncObject</a>)
            {
                <b>if</b> (<a href="#3bf429e619e19c26" class="i field">_pendingJobs</a>.<span class="i">Contains</span>(<span class="r121 r">job</span>.<a href="../client/Job.cs.html#958365243a8fc2cd" class="i property">InstanceId</a>))
                {
                    <a href="#3bf429e619e19c26" class="i field">_pendingJobs</a>.<span class="i">Remove</span>(<span class="r121 r">job</span>.<a href="../client/Job.cs.html#958365243a8fc2cd" class="i property">InstanceId</a>);
                }
 
                <b>if</b> (<a href="#305ff9f5b4db2435" class="i field">_needToCheckForWaitingJobs</a> &amp;&amp; <a href="#3bf429e619e19c26" class="i field">_pendingJobs</a>.<span class="i">Count</span> == 0)
                    <span class="r122 r">releaseWait</span> = <b>true</b>;
            }
            <span class="c">// end processing has been called</span>
            <span class="c">// set waithandle if this is the last one</span>
            <b>if</b> (<span class="r122 r">releaseWait</span>)
                <a href="#697e34a969677364" class="i field">_waitForJobs</a>.<span class="i">Set</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Methods
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Members
 
        <b>private readonly</b> <span class="i">HashSet</span>&lt;<span class="i">Guid</span>&gt; <a id="3bf429e619e19c26" href="../../../R/3bf429e619e19c26.html" target="n" data-glyph="46,1" class="i field">_pendingJobs</a> = <b>new</b> <span class="i">HashSet</span>&lt;<span class="i">Guid</span>&gt;();
        <b>private readonly</b> <span class="i">ManualResetEvent</span> <a id="697e34a969677364" href="../../../R/697e34a969677364.html" target="n" data-glyph="46,1" class="i field">_waitForJobs</a> = <b>new</b> <span class="i">ManualResetEvent</span>(<b>false</b>);
 
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>, <span class="i">EventHandler</span>&lt;<span class="i">AsyncCompletedEventArgs</span>&gt;&gt; <a id="584e3cb7f21ab2b9" href="../../../R/584e3cb7f21ab2b9.html" target="n" data-glyph="46,1" class="i field">_cleanUpActions</a> =
            <b>new</b> <span class="i">Dictionary</span>&lt;<a href="../client/Job2.cs.html#f76d5e2b49661689" class="t t">Job2</a>, <span class="i">EventHandler</span>&lt;<span class="i">AsyncCompletedEventArgs</span>&gt;&gt;();
 
        <b>private readonly object</b> <a id="757e09d4cb397e4a" href="../../../R/757e09d4cb397e4a.html" target="n" data-glyph="46,1" class="i field">_syncObject</a> = <b>new</b> <b>object</b>();
        <b>private bool</b> <a id="305ff9f5b4db2435" href="../../../R/305ff9f5b4db2435.html" target="n" data-glyph="46,1" class="i field">_needToCheckForWaitingJobs</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Private Members
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Dispose
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="bdc8e6661da176cf" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#67ef2bd0a1a80f08" class="i method">Dispose</a>(<b>true</b>);
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#61d072004a97a004" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r123 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="67ef2bd0a1a80f08" href="../../../R/67ef2bd0a1a80f08.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r123 rd" class="r123 r">disposing</span>)
        {
            <b>if</b> (!<span class="r123 r">disposing</span>) <b>return</b>;
            <b>foreach</b> (<b>var</b> <span id="r124 rd" class="r124 r">pair</span> <b>in</b> <a href="#584e3cb7f21ab2b9" class="i field">_cleanUpActions</a>)
            {
                <span class="r124 r">pair</span>.<span class="i">Key</span>.<span class="i">StopJobCompleted</span> -= <span class="r124 r">pair</span>.<span class="i">Value</span>;
            }
 
            <a href="#697e34a969677364" class="i field">_waitForJobs</a>.<span class="i">Dispose</span>();
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Dispose
    }
}
</pre></td></tr></table></div></body></html>
