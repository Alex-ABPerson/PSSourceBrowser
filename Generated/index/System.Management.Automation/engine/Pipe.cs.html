<!DOCTYPE html>
<html><head><title>Pipe.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(619);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/Pipe.cs" target="_top">engine\Pipe.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Corresponds to -OutputVariable, -ErrorVariable, -WarningVariable, and -InformationVariable.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal enum</b> <a id="30cd58b31f46e170" href="../R/30cd58b31f46e170.html" target="n" data-glyph="20,0" class="t t"><span id="5fe8b11e19de99b4">VariableStreamKind</span></a>
    {
        <a id="f6095cccebfe81e2" href="../R/f6095cccebfe81e2.html" target="n" data-glyph="24,1" class="i field">Output</a>,
        <a id="fc0efe5038263e2e" href="../R/fc0efe5038263e2e.html" target="n" data-glyph="24,1" class="i field">Error</a>,
        <a id="5cc4786026261f99" href="../R/5cc4786026261f99.html" target="n" data-glyph="24,1" class="i field">Warning</a>,
        <a id="4dd342fbd3639cab" href="../R/4dd342fbd3639cab.html" target="n" data-glyph="24,1" class="i field">Information</a>
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Pipe provides a way to stitch two commands.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The Pipe class is not thread-safe, so methods such as</span>
    <span class="c">///</span><span class="c"> AddItems and Retrieve should not be called simultaneously.</span>
    <span class="c">///</span><span class="c"> ExternalReader and ExternalWriter can provide thread-safe buffering.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="59f1a03e60a5aa51" href="../R/59f1a03e60a5aa51.html" target="n" data-glyph="2,0" class="t t">Pipe</a>
    {
        <b>private readonly</b> <a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="bac3119ff9544257" href="../R/bac3119ff9544257.html" target="n" data-glyph="46,1" class="i field">_context</a>;
 
        <span class="c">// If a pipeline object has been added, then</span>
        <span class="c">// write objects to it, stepping one at a time...</span>
        <b>internal</b> <a href="pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <a id="fbc0d30c61d09d17" href="../R/fbc0d30c61d09d17.html" target="n" data-glyph="104,1" class="i property">PipelineProcessor</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the downstream cmdlet in the &quot;streamlet model&quot;</span>
        <span class="c">///</span><span class="c"> which is invoked during each call to Add/AddItems.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="586d8abd020e1d4d" href="../R/586d8abd020e1d4d.html" target="n" data-glyph="104,1" class="i property">DownstreamCmdlet</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a>;
            }
 
            <b>set</b>
            {
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#850a89ccbf8cceac" class="i field">_resultList</a> == <b>null</b>, <span class="s">&quot;Tried to set downstream cmdlet when _resultList not null&quot;</span>);
                <a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a> = <b>value</b>;
            }
        }
 
        <b>private</b> <a href="CommandProcessorBase.cs.html#45a6054a3775cde6" class="t t">CommandProcessorBase</a> <a id="b2ef018eeab6efac" href="../R/b2ef018eeab6efac.html" target="n" data-glyph="46,1" class="i field">_downstreamCmdlet</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the upstream external object source.  If this is set,</span>
        <span class="c">///</span><span class="c"> Retrieve() will attempt to read objects from the upstream source</span>
        <span class="c">///</span><span class="c"> before indicating that the pipe is empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> It is improper to change this once the pipeline has started</span>
        <span class="c">///</span><span class="c"> executing, although the checks for this are in the</span>
        <span class="c">///</span><span class="c"> PipelineProcessor class and not here.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../utils/IObjectReader.cs.html#6b2221741902f9bd" class="t t">PipelineReader</a>&lt;<b>object</b>&gt; <a id="cf2d71634731882c" href="../R/cf2d71634731882c.html" target="n" data-glyph="104,1" class="i property">ExternalReader</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the downstream object recipient.  If this is set,</span>
        <span class="c">///</span><span class="c"> Add() and AddItems() write to this recipient instead of</span>
        <span class="c">///</span><span class="c"> to the internal queue.  This also disables the</span>
        <span class="c">///</span><span class="c"> DownstreamCmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> It is improper to change this once the pipeline has started</span>
        <span class="c">///</span><span class="c"> executing, although the checks for this are in the</span>
        <span class="c">///</span><span class="c"> PipelineProcessor class and not here.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../utils/IObjectWriter.cs.html#37301df630b2ae9a" class="t t">PipelineWriter</a> <a id="244a8e191e44d453" href="../R/244a8e191e44d453.html" target="n" data-glyph="104,1" class="i property">ExternalWriter</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#10c92ed96af106b5" class="i field">_externalWriter</a>;
            }
 
            <b>set</b>
            {
                <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#850a89ccbf8cceac" class="i field">_resultList</a> == <b>null</b>, <span class="s">&quot;Tried to set Pipe ExternalWriter when resultList not null&quot;</span>);
                <a href="#10c92ed96af106b5" class="i field">_externalWriter</a> = <b>value</b>;
            }
        }
 
        <b>private</b> <a href="../utils/IObjectWriter.cs.html#37301df630b2ae9a" class="t t">PipelineWriter</a> <a id="10c92ed96af106b5" href="../R/10c92ed96af106b5.html" target="n" data-glyph="46,1" class="i field">_externalWriter</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> For diagnostic purposes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override string</b> <a id="9047686ce47997d3" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>()
        {
            <b>if</b> (<a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a> != <b>null</b>)
                <b>return</b> <a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a>.<a href="CommandProcessorBase.cs.html#aad5c303a9a24e04" class="i method">ToString</a>();
            <b>return</b> <b>base</b>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> OutBufferCount configures the number of objects to buffer before calling the downstream Cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal int</b> <a id="cb9b892e1f9f06c6" href="../R/cb9b892e1f9f06c6.html" target="n" data-glyph="104,1" class="i property">OutBufferCount</a> { <b>get</b>; <b>set</b>; } = 0;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, then all input added to this pipe will simply be discarded...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="8ef98c4ec55d7204" href="../R/8ef98c4ec55d7204.html" target="n" data-glyph="104,1" class="i property">NullPipe</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#8a2ff5748c88d3bd" class="i field">_nullPipe</a>;
            }
 
            <b>set</b>
            {
                <a href="#16cc5566d759dae9" class="i field">_isRedirected</a> = <b>true</b>;
                <a href="#8a2ff5748c88d3bd" class="i field">_nullPipe</a> = <b>value</b>;
            }
        }
 
        <b>private bool</b> <a id="8a2ff5748c88d3bd" href="../R/8a2ff5748c88d3bd.html" target="n" data-glyph="46,1" class="i field">_nullPipe</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A queue that is shared between commands on either side of the pipe to transfer objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Queue</span>&lt;<b>object</b>&gt; <a id="4f11c2acd3c2ec6b" href="../R/4f11c2acd3c2ec6b.html" target="n" data-glyph="104,1" class="i property">ObjectQueue</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if there are items in this pipe that need processing...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This does not take into account the presence of ExternalInput;</span>
        <span class="c">///</span><span class="c"> it only indicates whether there is currently any data queued up</span>
        <span class="c">///</span><span class="c"> or if there is data in the enumerator...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="5b6f412d40044f40" href="../R/5b6f412d40044f40.html" target="n" data-glyph="104,1" class="i property">Empty</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#47520107ff067a0d" class="i field">_enumeratorToProcess</a> != <b>null</b>)
                    <b>return</b> <a href="#2fd7cc45009d5979" class="i field">_enumeratorToProcessIsEmpty</a>;
 
                <b>if</b> (<a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a> != <b>null</b>)
                    <b>return</b> <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Count</span> == 0;
                <b>return</b> <b>true</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is true if there is someone consuming this pipe already, either through</span>
        <span class="c">///</span><span class="c"> a Pipe object that processes it&#39;s output or there is downstream cmdlet...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="f890f797fcc0ee94" href="../R/f890f797fcc0ee94.html" target="n" data-glyph="104,1" class="i property">IsRedirected</a>
        {
            <b>get</b> { <b>return</b> <a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a> != <b>null</b> || <a href="#16cc5566d759dae9" class="i field">_isRedirected</a>; }
        }
 
        <b>private bool</b> <a id="16cc5566d759dae9" href="../R/16cc5566d759dae9.html" target="n" data-glyph="46,1" class="i field">_isRedirected</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If non-null, output written to the pipe are also added to this list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt; <a id="fd4b6987302cc807" href="../R/fd4b6987302cc807.html" target="n" data-glyph="46,1" class="i field">_outVariableList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If non-null, errors written to the pipe are also added to this list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt; <a id="29f0b653804283cb" href="../R/29f0b653804283cb.html" target="n" data-glyph="46,1" class="i field">_errorVariableList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If non-null, warnings written to the pipe are also added to this list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt; <a id="ac2711557e2c2805" href="../R/ac2711557e2c2805.html" target="n" data-glyph="46,1" class="i field">_warningVariableList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If non-null, information objects written to the pipe are also added to this list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt; <a id="94b2f7727cdff8cc" href="../R/94b2f7727cdff8cc.html" target="n" data-glyph="46,1" class="i field">_informationVariableList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If non-null, the current object being written to the pipe is stored in</span>
        <span class="c">///</span><span class="c"> this variable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <a id="b42698a55caa01f0" href="../R/b42698a55caa01f0.html" target="n" data-glyph="46,1" class="i field">_pipelineVariableObject</a>;
 
        <b>private static void</b> <a id="57125332b7e826a9" href="../R/57125332b7e826a9.html" target="n" data-glyph="76,1" class="i method">AddToVarList</a>(<span class="i">List</span>&lt;<span class="i">IList</span>&gt; <span id="r0 rd" class="r0 r">varList</span>, <b>object</b> <span id="r1 rd" class="r1 r">obj</span>)
        {
            <b>if</b> (<span class="r0 r">varList</span> != <b>null</b> &amp;&amp; <span class="r0 r">varList</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>for</b> (<b>int</b> <span id="r2 rd" class="r2 r">i</span> = 0; <span class="r2 r">i</span> &lt; <span class="r0 r">varList</span>.<span class="i">Count</span>; <span class="r2 r">i</span>++)
                {
                    <span class="r0 r">varList</span>[<span class="r2 r">i</span>].<span class="i">Add</span>(<span class="r1 r">obj</span>);
                }
            }
        }
 
        <b>internal void</b> <a id="d6190ce9334ba83f" href="../R/d6190ce9334ba83f.html" target="n" data-glyph="74,1" class="i method">AppendVariableList</a>(<a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a> <span id="r3 rd" class="r3 r">kind</span>, <b>object</b> <span id="r4 rd" class="r4 r">obj</span>)
        {
            <b>switch</b> (<span class="r3 r">kind</span>)
            {
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#fc0efe5038263e2e" class="i field">Error</a>:
                    <a href="#57125332b7e826a9" class="i method">AddToVarList</a>(<a href="#29f0b653804283cb" class="i field">_errorVariableList</a>, <span class="r4 r">obj</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#5cc4786026261f99" class="i field">Warning</a>:
                    <a href="#57125332b7e826a9" class="i method">AddToVarList</a>(<a href="#ac2711557e2c2805" class="i field">_warningVariableList</a>, <span class="r4 r">obj</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#f6095cccebfe81e2" class="i field">Output</a>:
                    <a href="#57125332b7e826a9" class="i method">AddToVarList</a>(<a href="#fd4b6987302cc807" class="i field">_outVariableList</a>, <span class="r4 r">obj</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#4dd342fbd3639cab" class="i field">Information</a>:
                    <a href="#57125332b7e826a9" class="i method">AddToVarList</a>(<a href="#94b2f7727cdff8cc" class="i field">_informationVariableList</a>, <span class="r4 r">obj</span>);
                    <b>break</b>;
            }
        }
 
        <b>internal void</b> <a id="67b4fe900c383cd4" href="../R/67b4fe900c383cd4.html" target="n" data-glyph="74,1" class="i method">AddVariableList</a>(<a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a> <span id="r5 rd" class="r5 r">kind</span>, <span class="i">IList</span> <span id="r6 rd" class="r6 r">list</span>)
        {
            <b>switch</b> (<span class="r5 r">kind</span>)
            {
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#fc0efe5038263e2e" class="i field">Error</a>:
                    <b>if</b> (<a href="#29f0b653804283cb" class="i field">_errorVariableList</a> == <b>null</b>)
                    {
                        <a href="#29f0b653804283cb" class="i field">_errorVariableList</a> = <b>new</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt;();
                    }
 
                    <a href="#29f0b653804283cb" class="i field">_errorVariableList</a>.<span class="i">Add</span>(<span class="r6 r">list</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#5cc4786026261f99" class="i field">Warning</a>:
                    <b>if</b> (<a href="#ac2711557e2c2805" class="i field">_warningVariableList</a> == <b>null</b>)
                    {
                        <a href="#ac2711557e2c2805" class="i field">_warningVariableList</a> = <b>new</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt;();
                    }
 
                    <a href="#ac2711557e2c2805" class="i field">_warningVariableList</a>.<span class="i">Add</span>(<span class="r6 r">list</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#f6095cccebfe81e2" class="i field">Output</a>:
                    <b>if</b> (<a href="#fd4b6987302cc807" class="i field">_outVariableList</a> == <b>null</b>)
                    {
                        <a href="#fd4b6987302cc807" class="i field">_outVariableList</a> = <b>new</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt;();
                    }
 
                    <a href="#fd4b6987302cc807" class="i field">_outVariableList</a>.<span class="i">Add</span>(<span class="r6 r">list</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#4dd342fbd3639cab" class="i field">Information</a>:
                    <b>if</b> (<a href="#94b2f7727cdff8cc" class="i field">_informationVariableList</a> == <b>null</b>)
                    {
                        <a href="#94b2f7727cdff8cc" class="i field">_informationVariableList</a> = <b>new</b> <span class="i">List</span>&lt;<span class="i">IList</span>&gt;();
                    }
 
                    <a href="#94b2f7727cdff8cc" class="i field">_informationVariableList</a>.<span class="i">Add</span>(<span class="r6 r">list</span>);
                    <b>break</b>;
            }
        }
 
        <b>internal void</b> <a id="a70f5d4297604021" href="../R/a70f5d4297604021.html" target="n" data-glyph="74,1" class="i method">SetPipelineVariable</a>(<a href="ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r7 rd" class="r7 r">pipelineVariable</span>)
        {
            <a href="#b42698a55caa01f0" class="i field">_pipelineVariableObject</a> = <span class="r7 r">pipelineVariable</span>;
        }
 
        <b>internal void</b> <a id="a7aced95b40de013" href="../R/a7aced95b40de013.html" target="n" data-glyph="74,1" class="i method">RemoveVariableList</a>(<a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a> <span id="r8 rd" class="r8 r">kind</span>, <span class="i">IList</span> <span id="r9 rd" class="r9 r">list</span>)
        {
            <b>switch</b> (<span class="r8 r">kind</span>)
            {
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#fc0efe5038263e2e" class="i field">Error</a>:
                    <a href="#29f0b653804283cb" class="i field">_errorVariableList</a>.<span class="i">Remove</span>(<span class="r9 r">list</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#5cc4786026261f99" class="i field">Warning</a>:
                    <a href="#ac2711557e2c2805" class="i field">_warningVariableList</a>.<span class="i">Remove</span>(<span class="r9 r">list</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#f6095cccebfe81e2" class="i field">Output</a>:
                    <a href="#fd4b6987302cc807" class="i field">_outVariableList</a>.<span class="i">Remove</span>(<span class="r9 r">list</span>);
                    <b>break</b>;
                <b>case</b> <a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#4dd342fbd3639cab" class="i field">Information</a>:
                    <a href="#94b2f7727cdff8cc" class="i field">_informationVariableList</a>.<span class="i">Remove</span>(<span class="r9 r">list</span>);
                    <b>break</b>;
            }
        }
 
        <b>internal void</b> <a id="30de0282d42a21cf" href="../R/30de0282d42a21cf.html" target="n" data-glyph="74,1" class="i method">RemovePipelineVariable</a>()
        {
            <b>if</b> (<a href="#b42698a55caa01f0" class="i field">_pipelineVariableObject</a> != <b>null</b>)
            {
                <a href="#b42698a55caa01f0" class="i field">_pipelineVariableObject</a>.<a href="ShellVariable.cs.html#8b1105722178c660" class="i property">Value</a> = <b>null</b>;
                <a href="#b42698a55caa01f0" class="i field">_pipelineVariableObject</a> = <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When a temporary pipe is used in the middle of execution, then we need to pass along</span>
        <span class="c">///</span><span class="c"> the error and warning variable list to hold the errors and warnings get written out</span>
        <span class="c">///</span><span class="c"> while the temporary pipe is being used.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> We don&#39;t need to pass along the out variable list because we don&#39;t care about the output</span>
        <span class="c">///</span><span class="c"> generated in the middle of execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="d3a10eccf3dbe6a9" href="../R/d3a10eccf3dbe6a9.html" target="n" data-glyph="74,1" class="i method">SetVariableListForTemporaryPipe</a>(<a href="#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r10 rd" class="r10 r">tempPipe</span>)
        {
            <a href="#308b3d06eb14bc00" class="i method">CopyVariableToTempPipe</a>(<a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#fc0efe5038263e2e" class="i field">Error</a>, <a href="#29f0b653804283cb" class="i field">_errorVariableList</a>, <span class="r10 r">tempPipe</span>);
            <a href="#308b3d06eb14bc00" class="i method">CopyVariableToTempPipe</a>(<a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#5cc4786026261f99" class="i field">Warning</a>, <a href="#ac2711557e2c2805" class="i field">_warningVariableList</a>, <span class="r10 r">tempPipe</span>);
            <a href="#308b3d06eb14bc00" class="i method">CopyVariableToTempPipe</a>(<a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a>.<a href="#4dd342fbd3639cab" class="i field">Information</a>, <a href="#94b2f7727cdff8cc" class="i field">_informationVariableList</a>, <span class="r10 r">tempPipe</span>);
        }
 
        <b>private static void</b> <a id="308b3d06eb14bc00" href="../R/308b3d06eb14bc00.html" target="n" data-glyph="76,1" class="i method">CopyVariableToTempPipe</a>(<a href="#30cd58b31f46e170" class="t t">VariableStreamKind</a> <span id="r11 rd" class="r11 r">streamKind</span>, <span class="i">List</span>&lt;<span class="i">IList</span>&gt; <span id="r12 rd" class="r12 r">variableList</span>, <a href="#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r13 rd" class="r13 r">tempPipe</span>)
        {
            <b>if</b> (<span class="r12 r">variableList</span> != <b>null</b> &amp;&amp; <span class="r12 r">variableList</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>for</b> (<b>int</b> <span id="r14 rd" class="r14 r">i</span> = 0; <span class="r14 r">i</span> &lt; <span class="r12 r">variableList</span>.<span class="i">Count</span>; <span class="r14 r">i</span>++)
                {
                    <span class="r13 r">tempPipe</span>.<span class="i">AddVariableList</span>(<span class="r11 r">streamKind</span>, <span class="r12 r">variableList</span>[<span class="r14 r">i</span>]);
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> ctor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default constructor - Creates the object queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The initial Queue capacity is 1, but it will grow automatically.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal</b> <a id="c1592456b1ff42b5" href="../R/c1592456b1ff42b5.html" target="n" data-glyph="74,1" class="t constructor">Pipe</a>()
        {
            <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<b>object</b>&gt;();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This overload causes output to be written into a List.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">resultList</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="99288ee09b9642bb" href="../R/99288ee09b9642bb.html" target="n" data-glyph="74,1" class="t constructor">Pipe</a>(<span class="i">List</span>&lt;<b>object</b>&gt; <span id="r15 rd" class="r15 r">resultList</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r15 r">resultList</span> != <b>null</b>, <span class="s">&quot;resultList cannot be null&quot;</span>);
            <a href="#16cc5566d759dae9" class="i field">_isRedirected</a> = <b>true</b>;
            <a href="#850a89ccbf8cceac" class="i field">_resultList</a> = <span class="r15 r">resultList</span>;
        }
 
        <b>private readonly</b> <span class="i">List</span>&lt;<b>object</b>&gt; <a id="850a89ccbf8cceac" href="../R/850a89ccbf8cceac.html" target="n" data-glyph="46,1" class="i field">_resultList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This overload causes output to be</span>
        <span class="c">///</span><span class="c"> written onto an Collection[PSObject] which is more useful</span>
        <span class="c">///</span><span class="c"> in many circumstances than arraylist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">resultCollection</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The collection to write into.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="56f3a3326c359ebb" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">Pipe</a>(<span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>.<span class="i">Collection</span>&lt;<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r16 rd" class="r16 r">resultCollection</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r16 r">resultCollection</span> != <b>null</b>, <span class="s">&quot;resultCollection cannot be null&quot;</span>);
            <a href="#16cc5566d759dae9" class="i field">_isRedirected</a> = <b>true</b>;
            <a href="#5f41d66358534901" class="i field">_resultCollection</a> = <span class="r16 r">resultCollection</span>;
        }
 
        <b>private readonly</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>.<span class="i">Collection</span>&lt;<a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="5f41d66358534901" href="../R/5f41d66358534901.html" target="n" data-glyph="46,1" class="i field">_resultCollection</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This pipe writes into another pipeline processor allowing</span>
        <span class="c">///</span><span class="c"> pipelines to be chained together...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The execution context object for this engine instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">outputPipeline</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The pipeline to write into...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="b0999d72f5203d02" href="../R/b0999d72f5203d02.html" target="n" data-glyph="74,1" class="t constructor">Pipe</a>(<a href="ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r17 rd" class="r17 r">context</span>, <a href="pipeline.cs.html#5e576bcabfa5c82b" class="t t">PipelineProcessor</a> <span id="r18 rd" class="r18 r">outputPipeline</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r18 r">outputPipeline</span> != <b>null</b>, <span class="s">&quot;outputPipeline cannot be null&quot;</span>);
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r18 r">outputPipeline</span> != <b>null</b>, <span class="s">&quot;context cannot be null&quot;</span>);
            <a href="#16cc5566d759dae9" class="i field">_isRedirected</a> = <b>true</b>;
            <a href="#bac3119ff9544257" class="i field">_context</a> = <span class="r17 r">context</span>;
            <a href="#fbc0d30c61d09d17" class="i property">PipelineProcessor</a> = <span class="r18 r">outputPipeline</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Read from an enumerator instead of a pipeline reader...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">enumeratorToProcess</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The enumerator to process...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="a54dd478365464cc" href="../R/a54dd478365464cc.html" target="n" data-glyph="74,1" class="t constructor">Pipe</a>(<span class="i">IEnumerator</span> <span id="r19 rd" class="r19 r">enumeratorToProcess</span>)
        {
            <a href="../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r19 r">enumeratorToProcess</span> != <b>null</b>, <span class="s">&quot;enumeratorToProcess cannot be null&quot;</span>);
            <a href="#47520107ff067a0d" class="i field">_enumeratorToProcess</a> = <span class="r19 r">enumeratorToProcess</span>;
 
            <span class="c">// since there is an enumerator specified, we</span>
            <span class="c">// assume that there is some stuff to read</span>
            <a href="#2fd7cc45009d5979" class="i field">_enumeratorToProcessIsEmpty</a> = <b>false</b>;
        }
 
        <b>private readonly</b> <span class="i">IEnumerator</span> <a id="47520107ff067a0d" href="../R/47520107ff067a0d.html" target="n" data-glyph="46,1" class="i field">_enumeratorToProcess</a>;
        <b>private bool</b> <a id="2fd7cc45009d5979" href="../R/2fd7cc45009d5979.html" target="n" data-glyph="46,1" class="i field">_enumeratorToProcessIsEmpty</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ctor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes an object to the pipe.  This could recursively call to the</span>
        <span class="c">///</span><span class="c"> downstream cmdlet, or write the object to the external output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The object to add to the pipe.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> AutomationNull.Value is ignored</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> a terminating error occurred, or the pipeline was otherwise stopped</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1496d52396952a52" class="t t">PipelineClosedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ExternalWriter stream is closed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="f66ebe5942cdceab" href="../R/f66ebe5942cdceab.html" target="n" data-glyph="74,1" class="i method">Add</a>(<b>object</b> <span id="r20 rd" class="r20 r">obj</span>)
        {
            <b>if</b> (<span class="r20 r">obj</span> == <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                <b>return</b>;
 
            <span class="c">// OutVariable is appended for null pipes so that the following works:</span>
            <span class="c">//     foo -OutVariable bar &gt; $null</span>
            <a href="#57125332b7e826a9" class="i method">AddToVarList</a>(<a href="#fd4b6987302cc807" class="i field">_outVariableList</a>, <span class="r20 r">obj</span>);
 
            <b>if</b> (<a href="#8a2ff5748c88d3bd" class="i field">_nullPipe</a>)
                <b>return</b>;
 
            <span class="c">// Store the current pipeline variable</span>
            <b>if</b> (<a href="#b42698a55caa01f0" class="i field">_pipelineVariableObject</a> != <b>null</b>)
            {
                <a href="#b42698a55caa01f0" class="i field">_pipelineVariableObject</a>.<a href="ShellVariable.cs.html#8b1105722178c660" class="i property">Value</a> = <span class="r20 r">obj</span>;
            }
 
            <a href="#8a30047d81a49911" class="i method">AddToPipe</a>(<span class="r20 r">obj</span>);
        }
 
        <b>internal void</b> <a id="d32c1d6bc732e4c3" href="../R/d32c1d6bc732e4c3.html" target="n" data-glyph="74,1" class="i method">AddWithoutAppendingOutVarList</a>(<b>object</b> <span id="r21 rd" class="r21 r">obj</span>)
        {
            <b>if</b> (<span class="r21 r">obj</span> == <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a> || <a href="#8a2ff5748c88d3bd" class="i field">_nullPipe</a>)
                <b>return</b>;
 
            <a href="#8a30047d81a49911" class="i method">AddToPipe</a>(<span class="r21 r">obj</span>);
        }
 
        <b>private void</b> <a id="8a30047d81a49911" href="../R/8a30047d81a49911.html" target="n" data-glyph="76,1" class="i method">AddToPipe</a>(<b>object</b> <span id="r22 rd" class="r22 r">obj</span>)
        {
            <b>if</b> (<a href="#fbc0d30c61d09d17" class="i property">PipelineProcessor</a> != <b>null</b>)
            {
                <span class="c">// Put the pipeline on the notification stack for stop.</span>
                <a href="#bac3119ff9544257" class="i field">_context</a>.<a href="ExecutionContext.cs.html#59f954936236f028" class="i method">PushPipelineProcessor</a>(<a href="#fbc0d30c61d09d17" class="i property">PipelineProcessor</a>);
                <a href="#fbc0d30c61d09d17" class="i property">PipelineProcessor</a>.<a href="pipeline.cs.html#f434c7211d4ab4d2" class="i method">Step</a>(<span class="r22 r">obj</span>);
                <a href="#bac3119ff9544257" class="i field">_context</a>.<a href="ExecutionContext.cs.html#e9ca865f4a03c30c" class="i method">PopPipelineProcessor</a>(<b>false</b>);
            }
            <b>else</b> <b>if</b> (<a href="#5f41d66358534901" class="i field">_resultCollection</a> != <b>null</b>)
            {
                <a href="#5f41d66358534901" class="i field">_resultCollection</a>.<span class="i">Add</span>(<span class="r22 r">obj</span> != <b>null</b> ? <a href="MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="MshObject.cs.html#e81a321a846beda7" class="i method">AsPSObject</a>(<span class="r22 r">obj</span>) : <b>null</b>);
            }
            <b>else</b> <b>if</b> (<a href="#850a89ccbf8cceac" class="i field">_resultList</a> != <b>null</b>)
            {
                <a href="#850a89ccbf8cceac" class="i field">_resultList</a>.<span class="i">Add</span>(<span class="r22 r">obj</span>);
            }
            <b>else</b> <b>if</b> (<a href="#10c92ed96af106b5" class="i field">_externalWriter</a> != <b>null</b>)
            {
                <a href="#10c92ed96af106b5" class="i field">_externalWriter</a>.<a href="../utils/IObjectWriter.cs.html#4cc65ae0546ff5fb" class="i method">Write</a>(<span class="r22 r">obj</span>);
            }
            <b>else</b> <b>if</b> (<a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a> != <b>null</b>)
            {
                <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Enqueue</span>(<span class="r22 r">obj</span>);
 
                <span class="c">// This is the &quot;streamlet&quot; recursive call</span>
                <b>if</b> (<a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a> != <b>null</b> &amp;&amp; <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Count</span> &gt; <a href="#cb9b892e1f9f06c6" class="i property">OutBufferCount</a>)
                {
                    <a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a>.<a href="CommandProcessorBase.cs.html#b81b6f6845c9c70c" class="i method">DoExecute</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Writes a set of objects to the pipe.  This could recursively</span>
        <span class="c">///</span><span class="c"> call to the downstream cmdlet, or write the objects to the</span>
        <span class="c">///</span><span class="c"> external output.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">objects</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Each of the objects are added to the pipe</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1b159d1cae338f33" class="t t">PipelineStoppedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The pipeline has already been stopped,</span>
        <span class="c">///</span><span class="c"> or a terminating error occurred in a downstream cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../utils/ExecutionExceptions.cs.html#1496d52396952a52" class="t t">PipelineClosedException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The ExternalWriter stream is closed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="423b6c617a52c12a" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">AddItems</a>(<b>object</b> <span id="r23 rd" class="r23 r">objects</span>)
        {
            <span class="c">// Use the extended type system to try and get an enumerator for the object being added.</span>
            <span class="c">// If we get an enumerator, then add the individual elements. If the object isn&#39;t</span>
            <span class="c">// enumerable (i.e. the call returned null) then add the object to the pipe</span>
            <span class="c">// as a single element.</span>
            <span class="i">IEnumerator</span> <span id="r24 rd" class="r24 r">ie</span> = <a href="LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="LanguagePrimitives.cs.html#837b38179d9ca088" class="i method">GetEnumerator</a>(<span class="r23 r">objects</span>);
            <b>try</b>
            {
                <b>if</b> (<span class="r24 r">ie</span> == <b>null</b>)
                {
                    <a href="#f66ebe5942cdceab" class="i method">Add</a>(<span class="r23 r">objects</span>);
                }
                <b>else</b>
                {
                    <b>while</b> (<a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#5cba6b6355dba7e3" class="i method">MoveNext</a>(<a href="#bac3119ff9544257" class="i field">_context</a>, <b>null</b>, <span class="r24 r">ie</span>))
                    {
                        <b>object</b> <span id="r25 rd" class="r25 r">o</span> = <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#4c90bd640fcb396f" class="i method">Current</a>(<b>null</b>, <span class="r24 r">ie</span>);
 
                        <span class="c">// Slip over any instance of AutomationNull.Value in the pipeline...</span>
                        <b>if</b> (<span class="r25 r">o</span> == <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>)
                        {
                            <b>continue</b>;
                        }
 
                        <a href="#f66ebe5942cdceab" class="i method">Add</a>(<span class="r25 r">o</span>);
                    }
                }
            }
            <b>finally</b>
            {
                <span class="c">// If our object came from GetEnumerator (and hence is not IEnumerator), then we need to dispose</span>
                <span class="c">// Otherwise, we don&#39;t own the object, so don&#39;t dispose.</span>
                <b>var</b> <span id="r26 rd" class="r26 r">disposable</span> = <span class="r24 r">ie</span> <b>as</b> <span class="i">IDisposable</span>;
                <b>if</b> (<span class="r26 r">disposable</span> != <b>null</b> &amp;&amp; <span class="r23 r">objects</span> <b>is not</b> <span class="i">IEnumerator</span>)
                {
                    <span class="r26 r">disposable</span>.<span class="i">Dispose</span>();
                }
            }
 
            <b>if</b> (<a href="#10c92ed96af106b5" class="i field">_externalWriter</a> != <b>null</b>)
                <b>return</b>;
 
            <span class="c">// If there are objects waiting for the downstream command</span>
            <span class="c">// call it now</span>
            <b>if</b> (<a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a> != <b>null</b> &amp;&amp; <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a> != <b>null</b> &amp;&amp; <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Count</span> &gt; <a href="#cb9b892e1f9f06c6" class="i property">OutBufferCount</a>)
            {
                <a href="#b2ef018eeab6efac" class="i field">_downstreamCmdlet</a>.<a href="CommandProcessorBase.cs.html#b81b6f6845c9c70c" class="i method">DoExecute</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns an object from the pipe. If pipe is empty returns null.</span>
        <span class="c">///</span><span class="c"> This will try the ExternalReader if there are no queued objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> object that is retrieved, or AutomationNull.Value if none</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="364489802d14033a" href="../R/364489802d14033a.html" target="n" data-glyph="74,1" class="i method">Retrieve</a>()
        {
            <b>if</b> (<a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a> != <b>null</b> &amp;&amp; <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Count</span> != 0)
            {
                <b>return</b> <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Dequeue</span>();
            }
            <b>else</b> <b>if</b> (<a href="#47520107ff067a0d" class="i field">_enumeratorToProcess</a> != <b>null</b>)
            {
                <b>if</b> (<a href="#2fd7cc45009d5979" class="i field">_enumeratorToProcessIsEmpty</a>)
                    <b>return</b> <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
 
                <b>if</b> (!<a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#5cba6b6355dba7e3" class="i method">MoveNext</a>(<a href="#bac3119ff9544257" class="i field">_context</a>, <b>null</b>, <a href="#47520107ff067a0d" class="i field">_enumeratorToProcess</a>))
                {
                    <a href="#2fd7cc45009d5979" class="i field">_enumeratorToProcessIsEmpty</a> = <b>true</b>;
                    <b>return</b> <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
                }
 
                <b>return</b> <a href="lang/parserutils.cs.html#c3c23681c37cee0a" class="t t">ParserOps</a>.<a href="lang/parserutils.cs.html#4c90bd640fcb396f" class="i method">Current</a>(<b>null</b>, <a href="#47520107ff067a0d" class="i field">_enumeratorToProcess</a>);
            }
            <b>else</b> <b>if</b> (<a href="#cf2d71634731882c" class="i property">ExternalReader</a> != <b>null</b>)
            {
                <b>try</b>
                {
                    <b>object</b> <span id="r27 rd" class="r27 r">o</span> = <a href="#cf2d71634731882c" class="i property">ExternalReader</a>.<a href="../utils/IObjectReader.cs.html#44674511beae23a4" class="i method">Read</a>();
                    <b>if</b> (<a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a> == <span class="r27 r">o</span>)
                    {
                        <span class="c">// NOTICE-2004/06/08-JonN 963367</span>
                        <span class="c">// The fix to this bug involves making one last</span>
                        <span class="c">// attempt to read from the pipeline in DoComplete.</span>
                        <span class="c">// We should be sure to not hit the ExternalReader</span>
                        <span class="c">// again if it already reported completion.</span>
                        <a href="#cf2d71634731882c" class="i property">ExternalReader</a> = <b>null</b>;
                    }
 
                    <b>return</b> <span class="r27 r">o</span>;
                }
                <b>catch</b> (<a href="../utils/ExecutionExceptions.cs.html#1496d52396952a52" class="t t">PipelineClosedException</a>)
                {
                    <b>return</b> <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
                }
                <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                {
                    <b>return</b> <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
                }
            }
            <b>else</b>
                <b>return</b> <a href="AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes all the objects from the Pipe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="769aefdecd654591" href="../R/769aefdecd654591.html" target="n" data-glyph="74,1" class="i method">Clear</a>()
        {
            <b>if</b> (<a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a> != <b>null</b>)
                <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Clear</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the currently queued items in the pipe.  Note that this will</span>
        <span class="c">///</span><span class="c"> not block on ExternalInput, and it does not modify the contents of</span>
        <span class="c">///</span><span class="c"> the pipe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Possibly empty array of objects, but not null.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal object</b>[] <a id="76ced3054041695b" href="../R/76ced3054041695b.html" target="n" data-glyph="74,1" class="i method">ToArray</a>()
        {
            <b>if</b> (<a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a> == <b>null</b> || <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">Count</span> == 0)
                <b>return</b> <a href="MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>.<a href="MshCommandRuntime.cs.html#493d2fff89fbbf4f" class="i field">StaticEmptyArray</a>;
 
            <b>return</b> <a href="#4f11c2acd3c2ec6b" class="i property">ObjectQueue</a>.<span class="i">ToArray</span>();
        }
    }
}
</pre></td></tr></table></div></body></html>
