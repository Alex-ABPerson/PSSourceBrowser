<!DOCTYPE html>
<html><head><title>ModuleCmdletBase.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(7450);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/Modules/ModuleCmdletBase.cs" target="_top">engine\Modules\ModuleCmdletBase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Security</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Cmdletization</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<span class="c">//</span>
<span class="c">// Now define the set of commands for manipulating modules.</span>
<span class="c">//</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> ModuleCmdletBase class
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This is the base class for some of the module cmdlets. It contains a number of</span>
    <span class="c">///</span><span class="c"> utility functions for these classes.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="0479f5f00c7dafc1" href="../../R/0479f5f00c7dafc1.html" target="n" data-glyph="0,0" class="t t"><span id="ddbabd340743e87a">ModuleCmdletBase</span></a> : <a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flags defining how a module manifest should be processed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Flags</span>]
        <b>internal enum</b> <a id="2144bdbe01665ed8" href="../../R/2144bdbe01665ed8.html" target="n" data-glyph="20,1" class="t t"><span id="4e12b62bac90d824">ManifestProcessingFlags</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Write errors (otherwise no non-terminating-errors are written)</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="493fa52eb1605135" href="../../R/493fa52eb1605135.html" target="n" data-glyph="24,2" class="i field">WriteErrors</a> = 0x1,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Return null on first error (otherwise we try to process other elements of the manifest)</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="342eb5397fea9175" href="../../R/342eb5397fea9175.html" target="n" data-glyph="24,2" class="i field">NullOnFirstError</a> = 0x2,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Load elements of the manifest (i.e. types/format.ps1xml, nested modules, etc.)</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="4195724a6acb2c06" href="../../R/4195724a6acb2c06.html" target="n" data-glyph="24,2" class="i field">LoadElements</a> = 0x4,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Write warnings.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="38787ceda7c6f53b" href="../../R/38787ceda7c6f53b.html" target="n" data-glyph="24,2" class="i field">WriteWarnings</a> = 0x8,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Force full module manifest processing.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="edee4a6de43d8a5c" href="../../R/edee4a6de43d8a5c.html" target="n" data-glyph="24,2" class="i field">Force</a> = 0x10,
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Ignore PowerShellHostName and PowerShellHostVersion while</span>
            <span class="c">///</span><span class="c"> processing Manifest fields.</span>
            <span class="c">///</span><span class="c"> This is used for GetModule where loading elements does not happen.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <a id="df92b72f166ea948" href="../../R/df92b72f166ea948.html" target="n" data-glyph="24,2" class="i field">IgnoreHostNameAndHostVersion</a> = 0x20,
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Options set during module import.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1815:OverrideEqualsAndOperatorEqualsOnValueTypes&quot;</span>)]
        <b>protected internal struct</b> <a id="2b4569e86558d3e1" href="../../R/2b4569e86558d3e1.html" target="n" data-glyph="111,1" class="t t"><span id="42af1c9ec081ffaf">ImportModuleOptions</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Holds the value of NoClobber parameter in Import-Module</span>
            <span class="c">///</span><span class="c"> This is used when importing modules.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal bool</b> <a id="2c83df2012d40f5a" href="../../R/2c83df2012d40f5a.html" target="n" data-glyph="44,2" class="i field">NoClobber</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> If Scope parameter is Local, this is true.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal bool</b> <a id="7faee609282d78c3" href="../../R/7faee609282d78c3.html" target="n" data-glyph="44,2" class="i field">Local</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Lets nested module import to export all of its functions, regardless of language boundaries.</span>
            <span class="c">///</span><span class="c"> This will be allowed when the manifest explicitly exports functions which will limit all visible module functions.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal bool</b> <a id="c4cfb75775763c63" href="../../R/c4cfb75775763c63.html" target="n" data-glyph="44,2" class="i field">AllowNestedModuleFunctionsToExport</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Flag that controls Export-PSSession -AllowClobber parameter in generating proxy modules from remote sessions.</span>
            <span class="c">///</span><span class="c"> Historically -AllowClobber in these scenarios was set as True.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>internal bool</b> <a id="e8f222097dc3f4dc" href="../../R/e8f222097dc3f4dc.html" target="n" data-glyph="44,2" class="i field">NoClobberExportPSSession</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specified a prefix used to modify names of imported commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="2ce2c96ea123be27" href="../../R/2ce2c96ea123be27.html" target="n" data-glyph="104,1" class="i property">BasePrefix</a> { <b>get</b>; <b>set</b>; } = <b>string</b>.<span class="i">Empty</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flags -force operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="f8d5c3639f6e81cd" href="../../R/f8d5c3639f6e81cd.html" target="n" data-glyph="104,1" class="i property">BaseForce</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flags -global operations (affects what gets returned by TargetSessionState)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="05a013615daefcfa" href="../../R/05a013615daefcfa.html" target="n" data-glyph="104,1" class="i property">BaseGlobal</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If set, CompatiblePSEditions checking will be disabled for modules on the System32 path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="c870fc509e9d03a5" href="../../R/c870fc509e9d03a5.html" target="n" data-glyph="104,1" class="i property">BaseSkipEditionCheck</a> { <b>get</b>; <b>set</b>; }
 
        <b>internal</b> <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <a id="0b3e15d1f51882da" href="../../R/0b3e15d1f51882da.html" target="n" data-glyph="104,1" class="i property">TargetSessionState</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#05a013615daefcfa" class="i property">BaseGlobal</a>)
                {
                    <b>return</b> <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>.<a href="../SessionState.cs.html#e8d61ec8e5e7bb28" class="i property">PublicSessionState</a>;
                }
                <b>else</b>
                {
                    <b>return</b> <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flags -passthru operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="da53dea574e86fa3" href="../../R/da53dea574e86fa3.html" target="n" data-glyph="104,1" class="i property">BasePassThru</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Flags -passthru operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="1088653af525f6b7" href="../../R/1088653af525f6b7.html" target="n" data-glyph="104,1" class="i property">BaseAsCustomObject</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wildcard patterns for the function to import.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlet parameters.&quot;</span>)]
        <b>internal</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="e9585290a055b001" href="../../R/e9585290a055b001.html" target="n" data-glyph="104,1" class="i property">BaseFunctionPatterns</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wildcard patterns for the cmdlets to import.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlet parameters.&quot;</span>)]
        <b>internal</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="5bcde7efb3a971e1" href="../../R/5bcde7efb3a971e1.html" target="n" data-glyph="104,1" class="i property">BaseCmdletPatterns</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wildcard patterns for the variables to import.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlet parameters.&quot;</span>)]
        <b>internal</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="1c7ed22590c269bf" href="../../R/1c7ed22590c269bf.html" target="n" data-glyph="104,1" class="i property">BaseVariablePatterns</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Wildcard patterns for the aliases to import.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2227:CollectionPropertiesShouldBeReadOnly&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlet parameters.&quot;</span>)]
        <b>internal</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="6f55985943d4e435" href="../../R/6f55985943d4e435.html" target="n" data-glyph="104,1" class="i property">BaseAliasPatterns</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The minimum version number to check the module against. Used the underlying property</span>
        <span class="c">///</span><span class="c"> for derived cmdlet parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Version</span> <a id="a3007191d0abebfa" href="../../R/a3007191d0abebfa.html" target="n" data-glyph="104,1" class="i property">BaseMinimumVersion</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The maximum version number to check the module against. Used the underlying property</span>
        <span class="c">///</span><span class="c"> for derived cmdlet parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Version</span> <a id="e9f6992e3534b73f" href="../../R/e9f6992e3534b73f.html" target="n" data-glyph="104,1" class="i property">BaseMaximumVersion</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The version number to check the module against. Used the underlying property</span>
        <span class="c">///</span><span class="c"> for derived cmdlet parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Version</span> <a id="c4cac778c669ec13" href="../../R/c4cac778c669ec13.html" target="n" data-glyph="104,1" class="i property">BaseRequiredVersion</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The Guid to check the module against. Used the underlying property</span>
        <span class="c">///</span><span class="c"> for derived cmdlet parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Guid</span>? <a id="d3b88fd228891169" href="../../R/d3b88fd228891169.html" target="n" data-glyph="104,1" class="i property">BaseGuid</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The arguments to pass to the scriptblock used to create the module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>protected object</b>[] <a id="e1f617f9af7f631a" href="../../R/e1f617f9af7f631a.html" target="n" data-glyph="105,1" class="i property">BaseArgumentList</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Disable warnings on cmdlet and function names that have non-standard verbs</span>
        <span class="c">///</span><span class="c"> or non-standard characters in the noun.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="b9892a02bdac22ec" href="../../R/b9892a02bdac22ec.html" target="n" data-glyph="105,1" class="i property">BaseDisableNameChecking</a> { <b>get</b>; <b>set</b>; } = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add module path to app domain level module path cache if name is not rooted.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="172e9b3e1682c172" href="../../R/172e9b3e1682c172.html" target="n" data-glyph="105,1" class="i property">AddToAppDomainLevelCache</a> { <b>get</b>; <b>set</b>; } = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A handy match all pattern used to initialize various import and export lists...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="3442415c65548b8f" href="../../R/3442415c65548b8f.html" target="n" data-glyph="104,1" class="i property">MatchAll</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#ad3270d8e668f010" class="i field">_matchAll</a> == <b>null</b>)
                {
                    <a href="#ad3270d8e668f010" class="i field">_matchAll</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                    <a href="#ad3270d8e668f010" class="i field">_matchAll</a>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="s">&quot;*&quot;</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                }
 
                <b>return</b> <a href="#ad3270d8e668f010" class="i field">_matchAll</a>;
            }
        }
 
        <b>private</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <a id="ad3270d8e668f010" href="../../R/ad3270d8e668f010.html" target="n" data-glyph="46,1" class="i field">_matchAll</a>;
 
        <span class="c">// The list of commands permitted in a module manifest</span>
        <b>internal static readonly string</b>[] <a id="57d6a39be76f7205" href="../../R/57d6a39be76f7205.html" target="n" data-glyph="44,1" class="i field">PermittedCmdlets</a> = <b>new</b> <b>string</b>[] {
            <span class="s">&quot;Import-LocalizedData&quot;</span>, <span class="s">&quot;ConvertFrom-StringData&quot;</span>, <span class="s">&quot;Write-Host&quot;</span>, <span class="s">&quot;Out-Host&quot;</span>, <span class="s">&quot;Join-Path&quot;</span> };
 
        <b>internal static readonly string</b>[] <a id="df56551ee1dbbfb1" href="../../R/df56551ee1dbbfb1.html" target="n" data-glyph="44,1" class="i field">ModuleManifestMembers</a> = <b>new</b> <b>string</b>[] {
            <span class="s">&quot;ModuleToProcess&quot;</span>,
            <span class="s">&quot;NestedModules&quot;</span>,
            <span class="s">&quot;GUID&quot;</span>,
            <span class="s">&quot;Author&quot;</span>,
            <span class="s">&quot;CompanyName&quot;</span>,
            <span class="s">&quot;Copyright&quot;</span>,
            <span class="s">&quot;ModuleVersion&quot;</span>,
            <span class="s">&quot;Description&quot;</span>,
            <span class="s">&quot;PowerShellVersion&quot;</span>,
            <span class="s">&quot;PowerShellHostName&quot;</span>,
            <span class="s">&quot;PowerShellHostVersion&quot;</span>,
            <span class="s">&quot;CLRVersion&quot;</span>,
            <span class="s">&quot;DotNetFrameworkVersion&quot;</span>,
            <span class="s">&quot;ProcessorArchitecture&quot;</span>,
            <span class="s">&quot;RequiredModules&quot;</span>,
            <span class="s">&quot;TypesToProcess&quot;</span>,
            <span class="s">&quot;FormatsToProcess&quot;</span>,
            <span class="s">&quot;ScriptsToProcess&quot;</span>,
            <span class="s">&quot;PrivateData&quot;</span>,
            <span class="s">&quot;RequiredAssemblies&quot;</span>,
            <span class="s">&quot;ModuleList&quot;</span>,
            <span class="s">&quot;FileList&quot;</span>,
            <span class="s">&quot;FunctionsToExport&quot;</span>,
            <span class="s">&quot;VariablesToExport&quot;</span>,
            <span class="s">&quot;AliasesToExport&quot;</span>,
            <span class="s">&quot;CmdletsToExport&quot;</span>,
            <span class="s">&quot;DscResourcesToExport&quot;</span>,
            <span class="s">&quot;CompatiblePSEditions&quot;</span>,
            <span class="s">&quot;HelpInfoURI&quot;</span>,
            <span class="s">&quot;RootModule&quot;</span>,
            <span class="s">&quot;DefaultCommandPrefix&quot;</span>
        };
 
        <b>private static readonly string</b>[] <a id="c8534f068242aed0" href="../../R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">s_moduleVersionMembers</a> = <b>new</b> <b>string</b>[] {
            <span class="s">&quot;ModuleName&quot;</span>,
            <span class="s">&quot;GUID&quot;</span>,
            <span class="s">&quot;ModuleVersion&quot;</span>
        };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When module manifests lack a CompatiblePSEditions field,</span>
        <span class="c">///</span><span class="c"> they will be treated as if they have this value.</span>
        <span class="c">///</span><span class="c"> The PSModuleInfo will still reflect the lack of value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">IReadOnlyList</span>&lt;<b>string</b>&gt; <a id="48104017c026183b" href="../../R/48104017c026183b.html" target="n" data-glyph="104,1" class="i property">DefaultCompatiblePSEditions</a> { <b>get</b>; } = <b>new</b> <b>string</b>[]
        {
            <span class="s">&quot;Desktop&quot;</span>
        };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A counter for modules that are loaded using WindowsPS compat session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static int</b> <a id="7d80f8891e3a90f5" href="../../R/7d80f8891e3a90f5.html" target="n" data-glyph="44,1" class="i field">s_WindowsPowerShellCompatUsageCounter</a> = 0;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Session name for WindowsPS compat remoting session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const string</b> <a id="980fa20118d9db13" href="../../R/980fa20118d9db13.html" target="n" data-glyph="8,1" class="i field">WindowsPowerShellCompatRemotingSessionName</a> = <span class="s">&quot;WinPSCompatSession&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Synchronization object for creation/cleanup of WindowsPS compat remoting session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static readonly object</b> <a id="53872d744916ac2d" href="../../R/53872d744916ac2d.html" target="n" data-glyph="44,1" class="i field">s_WindowsPowerShellCompatSyncObject</a> = <b>new</b> <b>object</b>();
 
        <b>private readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="3621d1d1cfd4a2ac" href="../../R/3621d1d1cfd4a2ac.html" target="n" data-glyph="46,1" class="i field">_currentlyProcessingModules</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
        <b>internal bool</b> <a id="6f13059a8e0bb1d8" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">LoadUsingModulePath</a>(<b>bool</b> <span id="r0 rd" class="r0 r">found</span>, <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r1 rd" class="r1 r">modulePath</span>, <b>string</b> <span id="r2 rd" class="r2 r">name</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r3 rd" class="r3 r">ss</span>,
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r4 rd" class="r4 r">options</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r5 rd" class="r5 r">manifestProcessingFlags</span>, <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r6 rd" class="r6 r">module</span>)
        {
            <b>return</b> <a href="#3affb28154683a55" class="i method">LoadUsingModulePath</a>(<b>null</b>, <span class="r0 r">found</span>, <span class="r1 r">modulePath</span>, <span class="r2 r">name</span>, <span class="r3 r">ss</span>, <span class="r4 r">options</span>, <span class="r5 r">manifestProcessingFlags</span>, <b>out</b> <span class="r6 r">module</span>);
        }
 
        <b>internal bool</b> <a id="3affb28154683a55" href="../../R/3affb28154683a55.html" target="n" data-glyph="74,1" class="i method">LoadUsingModulePath</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r7 rd" class="r7 r">parentModule</span>, <b>bool</b> <span id="r8 rd" class="r8 r">found</span>, <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r9 rd" class="r9 r">modulePath</span>, <b>string</b> <span id="r10 rd" class="r10 r">name</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r11 rd" class="r11 r">ss</span>,
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r12 rd" class="r12 r">options</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r13 rd" class="r13 r">manifestProcessingFlags</span>, <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r14 rd" class="r14 r">module</span>)
        {
            <b>string</b> <span id="r15 rd" class="r15 r">extension</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r10 r">name</span>);
            <b>string</b> <span id="r16 rd" class="r16 r">fileBaseName</span>;
            <span class="r14 r">module</span> = <b>null</b>;
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r15 r">extension</span>) || !<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#15ae80b6bdf925b0" class="i method">IsPowerShellModuleExtension</a>(<span class="r15 r">extension</span>))
            {
                <span class="r16 r">fileBaseName</span> = <span class="r10 r">name</span>;
                <span class="r15 r">extension</span> = <b>null</b>;
            }
            <b>else</b>
                <span class="r16 r">fileBaseName</span> = <span class="r10 r">name</span>.<span class="i">Substring</span>(0, <span class="r10 r">name</span>.<span class="i">Length</span> - <span class="r15 r">extension</span>.<span class="i">Length</span>);
 
            <span class="c">// Now search using the module path...</span>
            <b>foreach</b> (<b>string</b> <span id="r17 rd" class="r17 r">path</span> <b>in</b> <span class="r9 r">modulePath</span>)
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">                foreach (string folder in Directory.EnumerateDirectories(path))
                {
                    string moduleName = Path.GetFileName(folder);
                    if (string.Equals(moduleName, fileBaseName, StringComparison.OrdinalIgnoreCase))
                    {
                        fileBaseName = moduleName;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <b>string</b> <span id="r18 rd" class="r18 r">qualifiedPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r17 r">path</span>, <span class="r16 r">fileBaseName</span>);
                <span class="r14 r">module</span> = <a href="#1632ecb32d17fa42" class="i method">LoadUsingMultiVersionModuleBase</a>(<span class="r18 r">qualifiedPath</span>, <span class="r13 r">manifestProcessingFlags</span>, <span class="r12 r">options</span>, <b>out</b> <span class="r8 r">found</span>);
                <b>if</b> (!<span class="r8 r">found</span>)
                {
                    <b>if</b> (<span class="r10 r">name</span>.<span class="i">IndexOfAny</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#182cf4a18b62de18" class="i field">Directory</a>) == -1)
                    {
                        <span class="r18 r">qualifiedPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r18 r">qualifiedPath</span>, <span class="r16 r">fileBaseName</span>);
                    }
                    <b>else</b> <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r18 r">qualifiedPath</span>))
                    {
                        <span class="c">// if it points to a directory, add the basename back onto the path...</span>
                        <span class="r18 r">qualifiedPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r18 r">qualifiedPath</span>, <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r16 r">fileBaseName</span>));
                    }
 
                    <span class="r14 r">module</span> = <a href="#ffbbd5f81c5a99f9" class="i method">LoadUsingExtensions</a>(<span class="r7 r">parentModule</span>, <span class="r10 r">name</span>, <span class="r18 r">qualifiedPath</span>, <span class="r15 r">extension</span>, <b>null</b>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="r11 r">ss</span>, <span class="r12 r">options</span>, <span class="r13 r">manifestProcessingFlags</span>, <b>out</b> <span class="r8 r">found</span>);
                }
 
                <b>if</b> (<span class="r8 r">found</span>)
                {
                    <b>break</b>;
                }
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">                    }
                }
 
                if (found)
                {
                    break;
                }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
 
            <b>if</b> (<span class="r8 r">found</span>)
            {
                <span class="c">// Cache the module&#39;s exported commands after importing it, or if the -Refresh flag is used on &quot;Get-Module -List&quot;</span>
                <b>if</b> ((<span class="r14 r">module</span> != <b>null</b>) &amp;&amp; !<span class="r14 r">module</span>.<a href="PSModuleInfo.cs.html#e160146a2d150faf" class="i property">HadErrorsLoading</a>)
                {
                    <a href="AnalysisCache.cs.html#e469d7c6575d3464" class="t t">AnalysisCache</a>.<a href="AnalysisCache.cs.html#5d11fb6947296177" class="i method">CacheModuleExports</a>(<span class="r14 r">module</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                }
            }
 
            <b>return</b> <span class="r8 r">found</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Loads the latest valid version if moduleBase is a multi-versioned module directory.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Module directory path.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The flag that indicate manifest processing option.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">importModuleOptions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">found</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if a module was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="1632ecb32d17fa42" href="../../R/1632ecb32d17fa42.html" target="n" data-glyph="74,1" class="i method">LoadUsingMultiVersionModuleBase</a>(<b>string</b> <span id="r19 rd" class="r19 r">moduleBase</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r20 rd" class="r20 r">manifestProcessingFlags</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r21 rd" class="r21 r">importModuleOptions</span>, <b>out bool</b> <span id="r22 rd" class="r22 r">found</span>)
        {
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r23 rd" class="r23 r">foundModule</span> = <b>null</b>;
            <span class="r22 r">found</span> = <b>false</b>;
 
            <b>foreach</b> (<b>var</b> <span id="r24 rd" class="r24 r">version</span> <b>in</b> <a href="ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="ModuleUtils.cs.html#e87b073165121f32" class="i method">GetModuleVersionSubfolders</a>(<span class="r19 r">moduleBase</span>))
            {
                <span class="c">// Skip the version folder if it is not equal to the required version or does not satisfy the minimum/maximum version criteria</span>
                <b>if</b> (!<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<span class="i">IsVersionMatchingConstraints</span>(<span class="r24 r">version</span>, <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>, <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>, <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>))
                {
                    <b>continue</b>;
                }
 
                <b>var</b> <span id="r25 rd" class="r25 r">qualifiedPathWithVersion</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r19 r">moduleBase</span>,
                                                            <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r24 r">version</span>.<span class="i">ToString</span>(), <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r19 r">moduleBase</span>)));
                <b>string</b> <span id="r26 rd" class="r26 r">manifestPath</span> = <span class="r25 r">qualifiedPathWithVersion</span> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>;
                <b>var</b> <span id="r27 rd" class="r27 r">isValidModuleVersion</span> = <b>false</b>;
                <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r26 r">manifestPath</span>))
                {
                    <span class="r27 r">isValidModuleVersion</span> = <span class="r24 r">version</span>.<span class="i">Equals</span>(<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#038de7273b66a98e" class="i method">GetManifestModuleVersion</a>(<span class="r26 r">manifestPath</span>));
 
                    <b>if</b> (<span class="r27 r">isValidModuleVersion</span>)
                    {
                        <span class="r23 r">foundModule</span> = <span class="i">LoadUsingExtensions</span>(<b>null</b>, <span class="r19 r">moduleBase</span>, <span class="r25 r">qualifiedPathWithVersion</span>,
                                                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>,
                                                            <b>null</b>,
                                                            <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="c">/*SessionState*/</span> <b>null</b>,
                                                            <span class="r21 r">importModuleOptions</span>,
                                                            <span class="r20 r">manifestProcessingFlags</span>,
                                                            <b>out</b> <span class="r22 r">found</span>);
                        <b>if</b> (<span class="r22 r">found</span>)
                        {
                            <b>break</b>;
                        }
                    }
                }
 
                <b>if</b> (!<span class="r27 r">isValidModuleVersion</span>)
                {
                    <span class="i">WriteVerbose</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="i">Modules</span>.<span class="i">SkippingInvalidModuleVersionFolder</span>,
                                                <span class="r24 r">version</span>.<span class="i">ToString</span>(), <span class="r19 r">moduleBase</span>));
                }
            }
 
            <b>return</b> <span class="r23 r">foundModule</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load and execute the manifest psd1 file or a localized manifest psd1 file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Hashtable</span> <a id="8e59c883c9c355c6" href="../../R/8e59c883c9c355c6.html" target="n" data-glyph="76,1" class="i method">LoadModuleManifestData</a>(
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r28 rd" class="r28 r">scriptInfo</span>,
            <b>string</b>[] <span id="r29 rd" class="r29 r">validMembers</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r30 rd" class="r30 r">manifestProcessingFlags</span>,
            <b>ref bool</b> <span id="r31 rd" class="r31 r">containedErrors</span>)
        {
            <b>try</b>
            {
                <b>return</b> <a href="#0923f881497e8310" class="i method">LoadModuleManifestData</a>(<span class="r28 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>, <span class="r28 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#7795a39b7e78fc61" class="i property">ScriptBlock</a>, <span class="r29 r">validMembers</span>, <span class="r30 r">manifestProcessingFlags</span>, <b>ref</b> <span class="r31 r">containedErrors</span>);
            }
            <b>catch</b> (<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r32 rd" class="r32 r">pe</span>)
            {
                <b>if</b> ((<span class="r30 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>) != 0)
                {
                    <b>string</b> <span id="r33 rd" class="r33 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifest</span>, <span class="r28 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>, <span class="r32 r">pe</span>.<span class="i">Message</span>);
                    <span class="i">MissingMemberException</span> <span id="r34 rd" class="r34 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r33 r">message</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r35 rd" class="r35 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r34 r">mm</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r28 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>);
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r35 r">er</span>);
                }
 
                <span class="r31 r">containedErrors</span> = <b>true</b>;
                <b>return</b> <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Extra variables that are allowed to be referenced in module manifest file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static readonly string</b>[] <a id="920c53b0c8ff3718" href="../../R/920c53b0c8ff3718.html" target="n" data-glyph="46,1" class="i field">s_extraAllowedVariables</a> = <b>new</b> <b>string</b>[] { <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#3d4b8747790649ee" class="i field">PSScriptRoot</a>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#ebd54e5bc2887b94" class="i field">PSEdition</a>, <a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#67d517e03a6b8eae" class="i field">EnabledExperimentalFeatures</a> };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load and execute the manifest psd1 file or a localized manifest psd1 file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Hashtable</span> <a id="0923f881497e8310" href="../../R/0923f881497e8310.html" target="n" data-glyph="74,1" class="i method">LoadModuleManifestData</a>(
            <b>string</b> <span id="r36 rd" class="r36 r">moduleManifestPath</span>,
            <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r37 rd" class="r37 r">scriptBlock</span>,
            <b>string</b>[] <span id="r38 rd" class="r38 r">validMembers</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r39 rd" class="r39 r">manifestProcessingFlags</span>,
            <b>ref bool</b> <span id="r40 rd" class="r40 r">containedErrors</span>)
        {
            <b>string</b> <span id="r41 rd" class="r41 r">message</span>;
 
            <b>var</b> <span id="r42 rd" class="r42 r">importingModule</span> = (<span class="r39 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>) != 0;
            <b>var</b> <span id="r43 rd" class="r43 r">writingErrors</span> = (<span class="r39 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>) != 0;
 
            <span class="c">// Load the data file(s) to get the module info...</span>
            <b>try</b>
            {
                <span class="r37 r">scriptBlock</span>.<span class="i">CheckRestrictedLanguage</span>(<a href="#57d6a39be76f7205" class="i field">PermittedCmdlets</a>, <a href="#920c53b0c8ff3718" class="i field">s_extraAllowedVariables</a>, <b>true</b>);
            }
            <b>catch</b> (<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r44 rd" class="r44 r">pe</span>)
            {
                <b>if</b> (<span class="r43 r">writingErrors</span>)
                {
                    <span class="r41 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifest</span>, <span class="r36 r">moduleManifestPath</span>, <span class="r44 r">pe</span>.<span class="i">Message</span>);
                    <span class="i">MissingMemberException</span> <span id="r45 rd" class="r45 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r41 r">message</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r46 rd" class="r46 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r45 r">mm</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r36 r">moduleManifestPath</span>);
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r46 r">er</span>);
                }
 
                <span class="r40 r">containedErrors</span> = <b>true</b>;
                <b>return</b> <b>null</b>;
            }
 
            <b>object</b> <span id="r47 rd" class="r47 r">result</span>;
            <b>object</b> <span id="r48 rd" class="r48 r">oldPSScriptRoot</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>);
            <b>object</b> <span id="r49 rd" class="r49 r">oldPSCommandPath</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>);
            <span class="i">ArrayList</span> <span id="r50 rd" class="r50 r">errors</span> = (<span class="i">ArrayList</span>)<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#471bf3f65f86c699" class="i field">ErrorVarPath</a>);
            <b>int</b> <span id="r51 rd" class="r51 r">oldErrorCount</span> = <span class="r50 r">errors</span>.<span class="i">Count</span>;
 
            <b>try</b>
            {
                <span class="c">// Set the PSScriptRoot variable in the modules session state</span>
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<span class="i">SetVariable</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>, <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r36 r">moduleManifestPath</span>));
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>, <span class="r36 r">moduleManifestPath</span>);
 
                <span class="r47 r">result</span> = <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>.<a href="../MshObject.cs.html#8ae71f08053e5ae1" class="i method">Base</a>(<span class="r37 r">scriptBlock</span>.<a href="../lang/scriptblock.cs.html#1a7b06a284505bc5" class="i method">InvokeReturnAsIs</a>());
            }
            <b>finally</b>
            {
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>, <span class="r48 r">oldPSScriptRoot</span>);
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>, <span class="r49 r">oldPSCommandPath</span>);
 
                <span class="c">// We do not want any exceptions to show up in user&#39;s session state. So, we are removing errors in the finally block.</span>
                <span class="c">// If we&#39;re not loading the manifest (and are examining it), prevent errors from showing up in</span>
                <span class="c">// the user&#39;s session.</span>
                <b>if</b> (!<span class="r42 r">importingModule</span>)
                {
                    <b>while</b> (<span class="r50 r">errors</span>.<span class="i">Count</span> &gt; <span class="r51 r">oldErrorCount</span>) { <span class="r50 r">errors</span>.<span class="i">RemoveAt</span>(0); }
                }
            }
 
            <span class="i">Hashtable</span> <span id="r52 rd" class="r52 r">data</span> = <span class="r47 r">result</span> <b>as</b> <span class="i">Hashtable</span>;
            <b>if</b> (<span class="r52 r">data</span> == <b>null</b>)
            {
                <b>if</b> (<span class="r43 r">writingErrors</span>)
                {
                    <span class="r41 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">EmptyModuleManifest</span>, <span class="r36 r">moduleManifestPath</span>);
                    <span class="i">ArgumentException</span> <span id="r53 rd" class="r53 r">ae</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="r41 r">message</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r54 rd" class="r54 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r53 r">ae</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r36 r">moduleManifestPath</span>);
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r54 r">er</span>);
                }
 
                <span class="r40 r">containedErrors</span> = <b>true</b>;
                <b>return</b> <b>null</b>;
            }
 
            <span class="c">// MSFT:873446 Create a case insensitive comparer based hashtable to help</span>
            <span class="c">// with case-insensitive comparison of keys.</span>
            <span class="r52 r">data</span> = <b>new</b> <span class="i">Hashtable</span>(<span class="r52 r">data</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <b>if</b> (<span class="r38 r">validMembers</span> != <b>null</b> &amp;&amp; !<a href="#82f4980b32767427" class="i method">ValidateManifestHash</a>(<span class="r52 r">data</span>, <span class="r38 r">validMembers</span>, <span class="r36 r">moduleManifestPath</span>, <span class="r39 r">manifestProcessingFlags</span>))
            {
                <span class="r40 r">containedErrors</span> = <b>true</b>;
                <b>if</b> ((<span class="r39 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#342eb5397fea9175" class="i field">NullOnFirstError</a>) != 0)
                    <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r52 r">data</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verify the hash contains only valid members.  Write an error and return false if it is not valid.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="82f4980b32767427" href="../../R/82f4980b32767427.html" target="n" data-glyph="76,1" class="i method">ValidateManifestHash</a>(
            <span class="i">Hashtable</span> <span id="r55 rd" class="r55 r">data</span>,
            <b>string</b>[] <span id="r56 rd" class="r56 r">validMembers</span>,
            <b>string</b> <span id="r57 rd" class="r57 r">moduleManifestPath</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r58 rd" class="r58 r">manifestProcessingFlags</span>)
        {
            <b>bool</b> <span id="r59 rd" class="r59 r">result</span> = <b>true</b>;
 
            <span class="i">StringBuilder</span> <span id="r60 rd" class="r60 r">badKeys</span> = <b>new</b> <span class="i">StringBuilder</span>();
            <b>foreach</b> (<b>string</b> <span id="r61 rd" class="r61 r">s</span> <b>in</b> <span class="r55 r">data</span>.<span class="i">Keys</span>)
            {
                <b>bool</b> <span id="r62 rd" class="r62 r">found</span> = <b>false</b>;
 
                <b>foreach</b> (<b>string</b> <span id="r63 rd" class="r63 r">member</span> <b>in</b> <span class="r56 r">validMembers</span>)
                {
                    <b>if</b> (<span class="r61 r">s</span>.<span class="i">Equals</span>(<span class="r63 r">member</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r62 r">found</span> = <b>true</b>;
                    }
                }
 
                <b>if</b> (!<span class="r62 r">found</span>)
                {
                    <b>if</b> (<span class="r60 r">badKeys</span>.<span class="i">Length</span> &gt; 0)
                        <span class="r60 r">badKeys</span>.<span class="i">Append</span>(<span class="s">&quot;, &quot;</span>);
                    <span class="r60 r">badKeys</span>.<span class="i">Append</span>(<span class="s">&#39;\&#39;&#39;</span>);
                    <span class="r60 r">badKeys</span>.<span class="i">Append</span>(<span class="r61 r">s</span>);
                    <span class="r60 r">badKeys</span>.<span class="i">Append</span>(<span class="s">&#39;\&#39;&#39;</span>);
                }
            }
 
            <b>if</b> (<span class="r60 r">badKeys</span>.<span class="i">Length</span> &gt; 0)
            {
                <span class="r59 r">result</span> = <b>false</b>;
                <b>string</b> <span id="r64 rd" class="r64 r">message</span> = <b>null</b>;
 
                <b>if</b> ((<span class="r58 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>) != 0)
                {
                    <span class="c">// Check for PowerShell Version before checking other keys</span>
                    <span class="c">// If a PowerShellVersion exists and does not match the requirements, then the error is InsufficientPowerShellVersion</span>
                    <span class="c">// Else, the error is InvalidManifestMember</span>
                    <span class="i">Version</span> <span id="r65 rd" class="r65 r">powerShellVersion</span>;
                    <span class="i">Version</span> <span id="r66 rd" class="r66 r">currentPowerShellVersion</span> = <a href="../PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="../PSVersionInfo.cs.html#ad63365ac7690eeb" class="i property">PSVersion</a>;
                    <b>if</b> (<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<span class="i">Version</span>&gt;(<span class="r55 r">data</span>, <span class="r57 r">moduleManifestPath</span>, <span class="s">&quot;PowerShellVersion&quot;</span>, <span class="r58 r">manifestProcessingFlags</span>, <b>out</b> <span class="r65 r">powerShellVersion</span>) &amp;&amp;
                        <span class="r66 r">currentPowerShellVersion</span> &lt; <span class="r65 r">powerShellVersion</span>)
                    {
                        <span class="r64 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleManifestInsufficientPowerShellVersion</span>,
                                                    <span class="r66 r">currentPowerShellVersion</span>,
                                                    <span class="r57 r">moduleManifestPath</span>, <span class="r65 r">powerShellVersion</span>);
                        <span class="i">InvalidOperationException</span> <span id="r67 rd" class="r67 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r64 r">message</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r68 rd" class="r68 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r67 r">ioe</span>, <span class="s">&quot;Modules_InsufficientPowerShellVersion&quot;</span>,
                                                         <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r57 r">moduleManifestPath</span>);
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r68 r">er</span>);
                    }
                    <b>else</b>
                    {
                        <span class="i">StringBuilder</span> <span id="r69 rd" class="r69 r">validMembersString</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="s">&quot;&#39;&quot;</span>);
                        <span class="r69 r">validMembersString</span>.<span class="i">Append</span>(<span class="r56 r">validMembers</span>[0]);
                        <b>for</b> (<b>int</b> <span id="r70 rd" class="r70 r">i</span> = 1; <span class="r70 r">i</span> &lt; <span class="r56 r">validMembers</span>.<span class="i">Length</span>; <span class="r70 r">i</span>++)
                        {
                            <span class="r69 r">validMembersString</span>.<span class="i">Append</span>(<span class="s">&quot;&#39;, &#39;&quot;</span>);
                            <span class="r69 r">validMembersString</span>.<span class="i">Append</span>(<span class="r56 r">validMembers</span>[<span class="r70 r">i</span>]);
                        }
 
                        <span class="r69 r">validMembersString</span>.<span class="i">Append</span>(<span class="s">&#39;\&#39;&#39;</span>);
                        <span class="r64 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifestMember</span>, <span class="r57 r">moduleManifestPath</span>, <span class="r69 r">validMembersString</span>, <span class="r60 r">badKeys</span>);
                        <span class="i">InvalidOperationException</span> <span id="r71 rd" class="r71 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r64 r">message</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r72 rd" class="r72 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r71 r">ioe</span>, <span class="s">&quot;Modules_InvalidManifestMember&quot;</span>,
                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>, <span class="r57 r">moduleManifestPath</span>);
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r72 r">er</span>);
                    }
                }
            }
 
            <b>return</b> <span class="r59 r">result</span>;
        }
 
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="a062afb15bc413ee" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">LoadModuleNamedInManifest</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r73 rd" class="r73 r">parentModule</span>, <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r74 rd" class="r74 r">moduleSpecification</span>, <b>string</b> <span id="r75 rd" class="r75 r">moduleBase</span>, <b>bool</b> <span id="r76 rd" class="r76 r">searchModulePath</span>,
            <b>string</b> <span id="r77 rd" class="r77 r">prefix</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r78 rd" class="r78 r">ss</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r79 rd" class="r79 r">options</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r80 rd" class="r80 r">manifestProcessingFlags</span>, <b>bool</b> <span id="r81 rd" class="r81 r">loadTypes</span>,
            <b>bool</b> <span id="r82 rd" class="r82 r">loadFormats</span>, <b>object</b> <span id="r83 rd" class="r83 r">privateData</span>, <b>out bool</b> <span id="r84 rd" class="r84 r">found</span>, <b>string</b> <span id="r85 rd" class="r85 r">shortModuleName</span>, <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>? <span id="r86 rd" class="r86 r">manifestLanguageMode</span>)
        {
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r87 rd" class="r87 r">module</span> = <b>null</b>;
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r88 rd" class="r88 r">tempModuleInfoFromVerification</span> = <b>null</b>;
            <span class="r84 r">found</span> = <b>false</b>;
            <b>bool</b> <span id="r89 rd" class="r89 r">moduleFileFound</span> = <b>false</b>;
            <b>bool</b> <span id="r90 rd" class="r90 r">wasRooted</span> = <b>false</b>;
            <span class="i">Version</span> <span id="r91 rd" class="r91 r">savedBaseMinimumVersion</span> = <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>;
            <span class="i">Version</span> <span id="r92 rd" class="r92 r">savedBaseMaximumVersion</span> = <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>;
            <span class="i">Version</span> <span id="r93 rd" class="r93 r">savedBaseRequiredVersion</span> = <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>;
            <span class="i">Guid</span>? <span id="r94 rd" class="r94 r">savedBaseGuid</span> = <a href="#d3b88fd228891169" class="i property">BaseGuid</a>;
 
            <b>var</b> <span id="r95 rd" class="r95 r">importingModule</span> = <span class="r80 r">manifestProcessingFlags</span>.<span class="i">HasFlag</span>(<a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>);
            <b>string</b> <span id="r96 rd" class="r96 r">extension</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
            <span class="c">// First check for fully-qualified paths - either absolute or relative</span>
            <b>string</b> <span id="r97 rd" class="r97 r">rootedPath</span> = <a href="#9910dbba4c162701" class="i method">ResolveRootedFilePath</a>(<span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r97 r">rootedPath</span>))
            {
                <span class="r97 r">rootedPath</span> = <span class="i">FixupFileName</span>(<span class="r75 r">moduleBase</span>, <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="r96 r">extension</span>, <span class="r95 r">importingModule</span>);
            }
            <b>else</b>
            {
                <span class="r90 r">wasRooted</span> = <b>true</b>;
            }
 
            <b>try</b>
            {
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#e22e8fa7211ed8e7" class="i method">IncrementModuleNestingDepth</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>, <span class="r97 r">rootedPath</span>);
                <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> = <b>null</b>;
                <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <b>null</b>;
                <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> = <b>null</b>;
                <a href="#d3b88fd228891169" class="i property">BaseGuid</a> = <b>null</b>;
 
                <span class="c">// See if it&#39;s one of the powershell module extensions...</span>
                <b>if</b> (!<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#15ae80b6bdf925b0" class="i method">IsPowerShellModuleExtension</a>(<span class="r96 r">extension</span>))
                {
                    <span class="c">// If the file exits, and it does not have a powershell module extension, we know for sure that the file is not a valid module</span>
                    <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r97 r">rootedPath</span>))
                    {
                        <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r98 rd" class="r98 r">invalidOperation</span> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                                                <span class="i">Modules</span>.<span class="i">ManifestMemberNotValid</span>,
                                                                <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>,
                                                                <span class="s">&quot;NestedModules&quot;</span>,
                                                                <span class="r73 r">parentModule</span>?.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>,
                                                                <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleExtension</span>, <span class="r96 r">extension</span>, <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>),
                                                                                    <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<span class="i">GetModuleName</span>(<span class="r73 r">parentModule</span>?.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>));
                        <span class="r98 r">invalidOperation</span>.<a href="../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;Modules_InvalidModuleExtension&quot;</span>);
                        <b>throw</b> <span class="r98 r">invalidOperation</span>;
                    }
 
                    <span class="r96 r">extension</span> = <b>null</b>;
                }
 
                <span class="c">// Now load the module from the module directory first...</span>
                <b>if</b> (<span class="r96 r">extension</span> == <b>null</b>)
                {
                    <span class="c">// No extension so we&#39;ll have to search using the extensions</span>
                    <span class="c">//</span>
                    <b>if</b> (<a href="#66f0393a5df8e099" class="i method">VerifyIfNestedModuleIsAvailable</a>(<span class="r74 r">moduleSpecification</span>, <span class="r97 r">rootedPath</span>, <span class="c">/*extension*/</span><b>null</b>, <b>out</b> <span class="r88 r">tempModuleInfoFromVerification</span>))
                    {
                        <span class="r87 r">module</span> = <a href="#023c256ff0ced197" class="i method">LoadUsingExtensions</a>(
                            <span class="r73 r">parentModule</span>,
                            <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>,
                            <span class="r99 r">fileBaseName</span>: <span class="r97 r">rootedPath</span>,
                            <span class="r100 r">extension</span>: <b>null</b>,
                            <span class="r75 r">moduleBase</span>, <span class="c">// not using base from tempModuleInfoFromVerification as we are looking under moduleBase directory</span>
                            <span class="r77 r">prefix</span>,
                            <span class="r78 r">ss</span>,
                            <span class="r79 r">options</span>,
                            <span class="r80 r">manifestProcessingFlags</span>,
                            <b>out</b> <span class="r84 r">found</span>,
                            <b>out</b> <span class="r89 r">moduleFileFound</span>);
                    }
 
                    <span class="c">// Win8: 262157 - Import-Module is giving errors while loading Nested Modules. (This is a V2 bug)</span>
                    <span class="c">// NestedModules = &#39;test2&#39; ---&gt; test2 is a directory under current module directory (e.g - Test1)</span>
                    <span class="c">// We also need to look for Test1\Test2\Test2.(psd1/psm1/dll)</span>
                    <span class="c">// With the call above, we are only looking at Test1\Test2.(psd1/psm1/dll)</span>
                    <b>if</b> (!<span class="r84 r">found</span> &amp;&amp; !<span class="r89 r">moduleFileFound</span>)
                    {
                        <b>string</b> <span id="r101 rd" class="r101 r">newRootedPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r97 r">rootedPath</span>, <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                        <b>string</b> <span id="r102 rd" class="r102 r">newModuleBase</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r75 r">moduleBase</span>, <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                        <b>if</b> (<a href="#66f0393a5df8e099" class="i method">VerifyIfNestedModuleIsAvailable</a>(<span class="r74 r">moduleSpecification</span>, <span class="r101 r">newRootedPath</span>, <span class="c">/*extension*/</span><b>null</b>, <b>out</b> <span class="r88 r">tempModuleInfoFromVerification</span>))
                        {
                            <span class="r87 r">module</span> = <a href="#023c256ff0ced197" class="i method">LoadUsingExtensions</a>(
                                <span class="r73 r">parentModule</span>,
                                <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>,
                                <span class="r99 r">fileBaseName</span>: <span class="r101 r">newRootedPath</span>,
                                <span class="r100 r">extension</span>: <b>null</b>,
                                <span class="r102 r">newModuleBase</span>, <span class="c">// not using base from tempModuleInfoFromVerification as we are looking under moduleBase directory</span>
                                <span class="r77 r">prefix</span>,
                                <span class="r78 r">ss</span>,
                                <span class="r79 r">options</span>,
                                <span class="r80 r">manifestProcessingFlags</span>,
                                <b>out</b> <span class="r84 r">found</span>,
                                <b>out</b> <span class="r89 r">moduleFileFound</span>);
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Ok - we have a complete file name so load that...</span>
                    <b>if</b> (<a href="#66f0393a5df8e099" class="i method">VerifyIfNestedModuleIsAvailable</a>(<span class="r74 r">moduleSpecification</span>, <span class="r97 r">rootedPath</span>, <span class="r96 r">extension</span>, <b>out</b> <span class="r88 r">tempModuleInfoFromVerification</span>))
                    {
                        <span class="r87 r">module</span> = <a href="#54b090acde25aca6" class="i method">LoadModule</a>(
                            <span class="r73 r">parentModule</span>,
                            <span class="r97 r">rootedPath</span>, <span class="c">// fileName</span>
                            <span class="r75 r">moduleBase</span>, <span class="c">// not using base from tempModuleInfoFromVerification as we have a complete file name</span>
                            <span class="r77 r">prefix</span>,
                            <span class="r78 r">ss</span>,
                            <span class="r83 r">privateData</span>,
                            <b>ref</b> <span class="r79 r">options</span>,
                            <span class="r80 r">manifestProcessingFlags</span>,
                            <b>out</b> <span class="r84 r">found</span>,
                            <b>out</b> <span class="r89 r">moduleFileFound</span>);
                    }
 
                    <span class="c">// Win8: 262157 - Import-Module is giving errors while loading Nested Modules. (This is a V2 bug)</span>
                    <span class="c">// Only look for the file if the file was not found with the previous search</span>
                    <b>if</b> (!<span class="r84 r">found</span> &amp;&amp; !<span class="r89 r">moduleFileFound</span>)
                    {
                        <b>string</b> <span id="r103 rd" class="r103 r">newRootedPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r97 r">rootedPath</span>, <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                        <b>string</b> <span id="r104 rd" class="r104 r">newModuleBase</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r75 r">moduleBase</span>, <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                        <b>if</b> (<a href="#66f0393a5df8e099" class="i method">VerifyIfNestedModuleIsAvailable</a>(<span class="r74 r">moduleSpecification</span>, <span class="r103 r">newRootedPath</span>, <span class="r96 r">extension</span>, <b>out</b> <span class="r88 r">tempModuleInfoFromVerification</span>))
                        {
                            <span class="r87 r">module</span> = <a href="#54b090acde25aca6" class="i method">LoadModule</a>(
                                <span class="r73 r">parentModule</span>,
                                <span class="r103 r">newRootedPath</span>, <span class="c">// fileName</span>
                                <span class="r104 r">newModuleBase</span>, <span class="c">// not using base from tempModuleInfoFromVerification as we are looking under moduleBase directory</span>
                                <span class="r77 r">prefix</span>,
                                <span class="r78 r">ss</span>,
                                <span class="r83 r">privateData</span>,
                                <b>ref</b> <span class="r79 r">options</span>,
                                <span class="r80 r">manifestProcessingFlags</span>,
                                <b>out</b> <span class="r84 r">found</span>,
                                <b>out</b> <span class="r89 r">moduleFileFound</span>);
                        }
                    }
                }
 
                <span class="c">// The rooted files wasn&#39;t found, so don&#39;t search anymore...</span>
                <b>if</b> (!<span class="r84 r">found</span> &amp;&amp; <span class="r90 r">wasRooted</span>)
                    <b>return</b> <b>null</b>;
 
                <b>if</b> (<span class="r76 r">searchModulePath</span> &amp;&amp; !<span class="r84 r">found</span> &amp;&amp; !<span class="r89 r">moduleFileFound</span>)
                {
                    <b>if</b> (<a href="#66f0393a5df8e099" class="i method">VerifyIfNestedModuleIsAvailable</a>(<span class="r74 r">moduleSpecification</span>, <b>null</b>, <b>null</b>, <b>out</b> <span class="r88 r">tempModuleInfoFromVerification</span>))
                    {
                        <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r105 rd" class="r105 r">modulePath</span> = <b>null</b>;
                        <b>if</b> (<span class="r88 r">tempModuleInfoFromVerification</span> != <b>null</b>)
                        {
                            <b>var</b> <span id="r106 rd" class="r106 r">subdirName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r88 r">tempModuleInfoFromVerification</span>.<a href="PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>);
                            <span class="i">Version</span> <span id="r107 rd" class="r107 r">version</span>;
                            <b>if</b> (<span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r106 r">subdirName</span>, <b>out</b> <span class="r107 r">version</span>))
                            {
                                <b>var</b> <span id="r108 rd" class="r108 r">moduleBaseWithoutVersion</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r88 r">tempModuleInfoFromVerification</span>.<a href="PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>);
 
                                <span class="r105 r">modulePath</span> = <b>new</b> <b>string</b>[]
                                {
                                    <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r108 r">moduleBaseWithoutVersion</span>),
                                    <span class="r108 r">moduleBaseWithoutVersion</span>
                                };
                            }
                            <b>else</b>
                            {
                                <span class="r105 r">modulePath</span> = <b>new</b> <b>string</b>[]
                                {
                                    <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r88 r">tempModuleInfoFromVerification</span>.<a href="PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>),
                                    <span class="r88 r">tempModuleInfoFromVerification</span>.<a href="PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>
                                };
                            }
                        }
                        <b>else</b>
                        {
                            <span class="r105 r">modulePath</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#0f8fb60019d75e2c" class="i method">GetModulePath</a>(<b>false</b>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                        }
 
                        <span class="c">// Otherwise try the module path</span>
                        <span class="r84 r">found</span> = <a href="#3affb28154683a55" class="i method">LoadUsingModulePath</a>(<span class="r73 r">parentModule</span>, <span class="r84 r">found</span>, <span class="r105 r">modulePath</span>,
                                                    <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="r78 r">ss</span>,
                                                    <span class="r79 r">options</span>, <span class="r80 r">manifestProcessingFlags</span>, <b>out</b> <span class="r87 r">module</span>);
                    }
                }
 
                <b>if</b> (<span class="r86 r">manifestLanguageMode</span>.<span class="i">HasValue</span> &amp;&amp; <span class="r84 r">found</span> &amp;&amp; (<span class="r87 r">module</span> != <b>null</b>) &amp;&amp; <span class="r87 r">module</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a>.<span class="i">HasValue</span>)
                {
                    <span class="c">// Check for script module language mode consistency.  All loaded script modules must have the same language mode as the manifest.</span>
                    <span class="c">// If not then this indicates a malformed module and a possible exploit to make trusted private functions visible in a</span>
                    <span class="c">// Constrained Language session.</span>
                    <b>if</b> (<span class="r87 r">module</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a> != <span class="r86 r">manifestLanguageMode</span>)
                    {
                        <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="k">var</a> <span id="r109 rd" class="r109 r">languageModeError</span> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                            <span class="i">Modules</span>.<span class="i">MismatchedLanguageModes</span>,
                            <span class="r87 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r86 r">manifestLanguageMode</span>, <span class="r87 r">module</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a>);
                        <span class="r109 r">languageModeError</span>.<a href="../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;Modules_MismatchedLanguageModes&quot;</span>);
                        <b>throw</b> <span class="r109 r">languageModeError</span>;
                    }
                }
 
                <span class="c">// At this point, we haven&#39;t found an actual module, so try loading it as a</span>
                <span class="c">// PSSnapIn and then finally as an assembly in the GAC...</span>
                <b>if</b> (!<span class="r84 r">found</span> &amp;&amp; (<span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a> == <b>null</b>) &amp;&amp; (<span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> == <b>null</b>) &amp;&amp; (<span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> == <b>null</b>) &amp;&amp; (<span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> == <b>null</b>))
                {
                    <span class="c">// If we are in module analysis and the parent module declares non-wildcarded ExportedCmdlets, then we don&#39;t need to</span>
                    <span class="c">// actually process the binary module.</span>
                    <b>bool</b> <span id="r110 rd" class="r110 r">shouldLoadModule</span> = <b>true</b>;
 
                    <b>if</b> ((<span class="r73 r">parentModule</span> != <b>null</b>) &amp;&amp; !<span class="r95 r">importingModule</span>)
                    {
                        <b>if</b> ((<span class="r73 r">parentModule</span>.<a href="PSModuleInfo.cs.html#7afed1303b45c0b4" class="i property">ExportedCmdlets</a> != <b>null</b>) &amp;&amp; (<span class="r73 r">parentModule</span>.<a href="PSModuleInfo.cs.html#7afed1303b45c0b4" class="i property">ExportedCmdlets</a>.<span class="i">Count</span> &gt; 0))
                        {
                            <span class="r110 r">shouldLoadModule</span> = <b>false</b>;
 
                            <b>foreach</b> (<b>string</b> <span id="r111 rd" class="r111 r">exportedCmdlet</span> <b>in</b> <span class="r73 r">parentModule</span>.<a href="PSModuleInfo.cs.html#7afed1303b45c0b4" class="i property">ExportedCmdlets</a>.<span class="i">Keys</span>)
                            {
                                <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r111 r">exportedCmdlet</span>))
                                {
                                    <span class="r110 r">shouldLoadModule</span> = <b>true</b>;
                                    <b>break</b>;
                                }
                            }
 
                            <span class="r84 r">found</span> = <b>true</b>;
                        }
                    }
 
                    <b>if</b> (<span class="r110 r">shouldLoadModule</span>)
                    {
                        <b>try</b>
                        {
                            <span class="c">// At this point, we are already exhaust all possible ways to load the nested module. The last option is to load it as a binary module/snapin.</span>
                            <span class="r87 r">module</span> = <a href="#7673cdb4a88de68d" class="i method">LoadBinaryModule</a>(
                                <span class="r73 r">parentModule</span>,
                                <span class="r74 r">moduleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>,
                                <span class="r112 r">fileName</span>: <b>null</b>,
                                <span class="r113 r">assemblyToLoad</span>: <b>null</b>,
                                <span class="r75 r">moduleBase</span>,
                                <span class="r78 r">ss</span>,
                                <span class="r79 r">options</span>,
                                <span class="r80 r">manifestProcessingFlags</span>,
                                <span class="r77 r">prefix</span>,
                                <span class="r81 r">loadTypes</span>,
                                <span class="r82 r">loadFormats</span>,
                                <b>out</b> <span class="r84 r">found</span>,
                                <span class="r85 r">shortModuleName</span>,
                                <span class="r114 r">disableFormatUpdates</span>: <b>false</b>);
                        }
                        <b>catch</b> (<span class="i">FileNotFoundException</span>)
                        {
                            <span class="c">// Loading the nested module as a pssnapin or assembly is our last attempt to resolve the nested module.</span>
                            <span class="c">// If we catch &#39;FileNotFoundException&#39;, it simply means that our last attempt failed because we couldn&#39;t find such a pssnapin or assembly.</span>
                            <span class="c">// In this case, we can safely ignore this exception and throw a &#39;Modules_ModuleFileNotFound&#39; error.</span>
                        }
 
                        <b>if</b> ((<span class="r87 r">module</span> != <b>null</b>) &amp;&amp; <span class="r95 r">importingModule</span>)
                        {
                            <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r87 r">module</span>);
                        }
                    }
                }
 
                <b>return</b> <span class="r87 r">module</span>;
            }
            <b>finally</b>
            {
                <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> = <span class="r91 r">savedBaseMinimumVersion</span>;
                <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <span class="r92 r">savedBaseMaximumVersion</span>;
                <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> = <span class="r93 r">savedBaseRequiredVersion</span>;
                <a href="#d3b88fd228891169" class="i property">BaseGuid</a> = <span class="r94 r">savedBaseGuid</span>;
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#04dc5e193949a6d0" class="i method">DecrementModuleNestingCount</a>();
            }
        }
 
        <b>internal</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="c18fe484b0438291" href="../../R/c18fe484b0438291.html" target="n" data-glyph="74,1" class="i method">GetModule</a>(<b>string</b>[] <span id="r115 rd" class="r115 r">names</span>, <b>bool</b> <span id="r116 rd" class="r116 r">all</span>, <b>bool</b> <span id="r117 rd" class="r117 r">refresh</span>)
        {
            <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r118 rd" class="r118 r">modulesToReturn</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
            <span class="c">// Two lists - one to hold Module Paths and one to hold Module Names</span>
            <span class="c">// For Module Paths, we don&#39;t do any path resolution</span>
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r119 rd" class="r119 r">modulePaths</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r120 rd" class="r120 r">moduleNames</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
            <b>if</b> (<span class="r115 r">names</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r121 rd" class="r121 r">n</span> <b>in</b> <span class="r115 r">names</span>)
                {
                    <b>if</b> (<span class="r121 r">n</span>.<span class="i">Contains</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>) || <span class="r121 r">n</span>.<span class="i">Contains</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>))
                    {
                        <span class="r119 r">modulePaths</span>.<span class="i">Add</span>(<span class="r121 r">n</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r120 r">moduleNames</span>.<span class="i">Add</span>(<span class="r121 r">n</span>);
                    }
                }
 
                <span class="r118 r">modulesToReturn</span>.<span class="i">AddRange</span>(<a href="#7b79430aa7715946" class="i method">GetModuleForRootedPaths</a>(<span class="r119 r">modulePaths</span>, <span class="r116 r">all</span>, <span class="r117 r">refresh</span>));
            }
 
            <span class="c">// If no names were passed to this function, then this API will return list of all available modules</span>
            <b>if</b> (<span class="r115 r">names</span> == <b>null</b> || <span class="r120 r">moduleNames</span>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r118 r">modulesToReturn</span>.<span class="i">AddRange</span>(<a href="#0126b19f2b029793" class="i method">GetModuleForNames</a>(<span class="r120 r">moduleNames</span>, <span class="r116 r">all</span>, <span class="r117 r">refresh</span>));
            }
 
            <b>return</b> <span class="r118 r">modulesToReturn</span>;
        }
 
        <b>private</b> <span class="i">IEnumerable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="7b79430aa7715946" href="../../R/7b79430aa7715946.html" target="n" data-glyph="76,1" class="i method">GetModuleForRootedPaths</a>(<span class="i">List</span>&lt;<b>string</b>&gt; <span id="r122 rd" class="r122 r">modulePaths</span>, <b>bool</b> <span id="r123 rd" class="r123 r">all</span>, <b>bool</b> <span id="r124 rd" class="r124 r">refresh</span>)
        {
            <span class="c">// This is to filter out duplicate modules</span>
            <b>var</b> <span id="r125 rd" class="r125 r">modules</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <b>foreach</b> (<b>string</b> <span id="r126 rd" class="r126 r">mp</span> <b>in</b> <span class="r122 r">modulePaths</span>)
            {
                <b>bool</b> <span id="r127 rd" class="r127 r">containsWildCards</span> = <b>false</b>;
 
                <b>string</b> <span id="r128 rd" class="r128 r">modulePath</span> = <span class="r126 r">mp</span>.<span class="i">TrimEnd</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#247bb446a0dd1494" class="i field">Backslash</a>);
 
                <span class="c">// If the given path contains wildcards, we won&#39;t throw error if no match module path is found.</span>
                <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r128 r">modulePath</span>))
                {
                    <span class="r127 r">containsWildCards</span> = <b>true</b>;
                }
 
                <span class="c">// Now we resolve the possible paths in case it is relative path/path contains wildcards</span>
                <b>var</b> <span id="r129 rd" class="r129 r">modulePathCollection</span> = <a href="#66e94f47496102bb" class="i method">GetResolvedPathCollection</a>(<span class="r128 r">modulePath</span>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
 
                <b>if</b> (<span class="r129 r">modulePathCollection</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r130 rd" class="r130 r">resolvedModulePath</span> <b>in</b> <span class="r129 r">modulePathCollection</span>)
                    {
                        <b>string</b> <span id="r131 rd" class="r131 r">moduleName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r130 r">resolvedModulePath</span>);
 
                        <span class="c">// If the given path is a valid module file, we will load the specific file</span>
                        <b>if</b> (!<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r130 r">resolvedModulePath</span>) &amp;&amp; <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<span class="i">IsPowerShellModuleExtension</span>(<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r131 r">moduleName</span>)))
                        {
                            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r132 rd" class="r132 r">module</span> = <a href="#222659eb1c55fa4e" class="i method">CreateModuleInfoForGetModule</a>(<span class="r130 r">resolvedModulePath</span>, <span class="r124 r">refresh</span>);
                            <b>if</b> (<span class="r132 r">module</span> != <b>null</b>)
                            {
                                <b>if</b> (!<span class="r125 r">modules</span>.<span class="i">Contains</span>(<span class="r130 r">resolvedModulePath</span>))
                                {
                                    <span class="r125 r">modules</span>.<span class="i">Add</span>(<span class="r130 r">resolvedModulePath</span>);
                                    <b>yield</b> <b>return</b> <span class="r132 r">module</span>;
                                }
                            }
                        }
                        <b>else</b>
                        {
                            <span class="c">// Given path is a directory, we first check if it is end with module version.</span>
                            <span class="i">Version</span> <span id="r133 rd" class="r133 r">version</span>;
                            <b>if</b> (<span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r131 r">moduleName</span>, <b>out</b> <span class="r133 r">version</span>))
                            {
                                <span class="r131 r">moduleName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="i">Directory</span>.<span class="i">GetParent</span>(<span class="r130 r">resolvedModulePath</span>).<span class="i">Name</span>);
                            }
 
                            <b>var</b> <span id="r134 rd" class="r134 r">availableModuleFiles</span> = <span class="r123 r">all</span>
                                ? <a href="ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="ModuleUtils.cs.html#a6d87fc7b9a33572" class="i method">GetAllAvailableModuleFiles</a>(<span class="r130 r">resolvedModulePath</span>)
                                : <a href="ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="ModuleUtils.cs.html#1d1ec716033276ac" class="i method">GetModuleFilesFromAbsolutePath</a>(<span class="r130 r">resolvedModulePath</span>);
 
                            <b>bool</b> <span id="r135 rd" class="r135 r">foundModule</span> = <b>false</b>;
                            <b>foreach</b> (<b>string</b> <span id="r136 rd" class="r136 r">file</span> <b>in</b> <span class="r134 r">availableModuleFiles</span>)
                            {
                                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r137 rd" class="r137 r">module</span> = <a href="#222659eb1c55fa4e" class="i method">CreateModuleInfoForGetModule</a>(<span class="r136 r">file</span>, <span class="r124 r">refresh</span>);
                                <b>if</b> (<span class="r137 r">module</span> != <b>null</b>)
                                {
                                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r131 r">moduleName</span>, <span class="r137 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                    {
                                        <span class="r135 r">foundModule</span> = <b>true</b>;
                                        <span class="c">// We need to list all versions of the module.</span>
                                        <b>string</b> <span id="r138 rd" class="r138 r">subModulePath</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r136 r">file</span>);
                                        <b>if</b> (!<span class="r125 r">modules</span>.<span class="i">Contains</span>(<span class="r138 r">subModulePath</span>))
                                        {
                                            <span class="r125 r">modules</span>.<span class="i">Add</span>(<span class="r138 r">subModulePath</span>);
                                            <b>yield</b> <b>return</b> <span class="r137 r">module</span>;
                                        }
                                    }
                                }
                            }
 
                            <span class="c">// Write error only if Name has no wild cards</span>
                            <b>if</b> (!<span class="r135 r">foundModule</span> &amp;&amp; !<span class="r127 r">containsWildCards</span>)
                            {
                                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<a href="#0e98366363102cef" class="i method">CreateModuleNotFoundError</a>(<span class="r130 r">resolvedModulePath</span>));
                            }
                        }
                    }
                }
                <b>else</b>
                {
                    <b>if</b> (!<span class="r127 r">containsWildCards</span>)
                    {
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<a href="#0e98366363102cef" class="i method">CreateModuleNotFoundError</a>(<span class="r128 r">modulePath</span>));
                    }
                }
            }
        }
 
        <b>private static</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="0e98366363102cef" href="../../R/0e98366363102cef.html" target="n" data-glyph="76,1" class="i method">CreateModuleNotFoundError</a>(<b>string</b> <span id="r139 rd" class="r139 r">modulePath</span>)
        {
            <b>string</b> <span id="r140 rd" class="r140 r">errorMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleNotFoundForGetModule</span>, <span class="r139 r">modulePath</span>);
            <span class="i">FileNotFoundException</span> <span id="r141 rd" class="r141 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r140 r">errorMessage</span>);
            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r142 rd" class="r142 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r141 r">fnf</span>, <span class="s">&quot;Modules_ModuleNotFoundForGetModule&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r139 r">modulePath</span>);
            <b>return</b> <span class="r142 r">er</span>;
        }
 
        <b>private</b> <span class="i">IEnumerable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="0126b19f2b029793" href="../../R/0126b19f2b029793.html" target="n" data-glyph="76,1" class="i method">GetModuleForNames</a>(<span class="i">List</span>&lt;<b>string</b>&gt; <span id="r143 rd" class="r143 r">names</span>, <b>bool</b> <span id="r144 rd" class="r144 r">all</span>, <b>bool</b> <span id="r145 rd" class="r145 r">refresh</span>)
        {
            <span class="i">IEnumerable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r146 rd" class="r146 r">allModules</span> = <b>null</b>;
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r147 rd" class="r147 r">modulePathSet</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <b>foreach</b> (<b>string</b> <span id="r148 rd" class="r148 r">path</span> <b>in</b> <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#0f8fb60019d75e2c" class="i method">GetModulePath</a>(<b>false</b>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>))
            {
                <b>string</b> <span id="r149 rd" class="r149 r">uniquePath</span> = <span class="r148 r">path</span>.<span class="i">TrimEnd</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#182cf4a18b62de18" class="i field">Directory</a>);
 
                <span class="c">// Ignore repeated module path.</span>
                <b>if</b> (!<span class="r147 r">modulePathSet</span>.<span class="i">Add</span>(<span class="r149 r">uniquePath</span>))
                {
                    <b>continue</b>;
                }
 
                <b>try</b>
                {
                    <span class="i">IEnumerable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r150 rd" class="r150 r">modulesFound</span> = <a href="#d09413109aed5f17" class="i method">GetModulesFromOneModulePath</a>(
                        <span class="r143 r">names</span>, <span class="r149 r">uniquePath</span>, <span class="r144 r">all</span>, <span class="r145 r">refresh</span>).<span class="i">OrderBy</span>(<b>static</b> <span id="r151 rd" class="r151 r">m</span> =&gt; <span class="r151 r">m</span>.<span class="i">Name</span>);
                    <span class="r146 r">allModules</span> = <span class="r146 r">allModules</span> == <b>null</b> ? <span class="r150 r">modulesFound</span> : <span class="r146 r">allModules</span>.<span class="i">Concat</span>(<span class="r150 r">modulesFound</span>);
                }
                <b>catch</b> (<span class="i">Exception</span> <span id="r152 rd" class="r152 r">e</span>) <b>when</b> (<span class="r152 r">e</span> <b>is</b> <span class="i">IOException</span> || <span class="r152 r">e</span> <b>is</b> <span class="i">UnauthorizedAccessException</span>)
                {
                    <span class="c">// ignore directories that can&#39;t be accessed</span>
                    <b>continue</b>;
                }
            }
 
            <span class="c">// Make sure we always return a non-null collection.</span>
            <b>return</b> <span class="r146 r">allModules</span> ?? <span class="i">Array</span>.<span class="i">Empty</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get modules based on the given names and module files.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">IEnumerable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="d09413109aed5f17" href="../../R/d09413109aed5f17.html" target="n" data-glyph="76,1" class="i method">GetModulesFromOneModulePath</a>(<span class="i">List</span>&lt;<b>string</b>&gt; <span id="r153 rd" class="r153 r">names</span>, <b>string</b> <span id="r154 rd" class="r154 r">modulePath</span>, <b>bool</b> <span id="r155 rd" class="r155 r">all</span>, <b>bool</b> <span id="r156 rd" class="r156 r">refresh</span>)
        {
            <b>const</b> <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a> <span id="r157 rd" class="r157 r">options</span> = <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a>;
            <span class="i">IEnumerable</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r158 rd" class="r158 r">namePatterns</span> = <b>null</b>;
            <b>if</b> (<span class="r153 r">names</span> != <b>null</b> &amp;&amp; <span class="r153 r">names</span>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r158 r">namePatterns</span> = <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">CreateWildcardsFromStrings</span>(<span class="r153 r">names</span>, <span class="r157 r">options</span>);
            }
 
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r159 rd" class="r159 r">moduleFiles</span> = <span class="r155 r">all</span>
                ? <a href="ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="ModuleUtils.cs.html#a6d87fc7b9a33572" class="i method">GetAllAvailableModuleFiles</a>(<span class="r154 r">modulePath</span>)
                : <a href="ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="ModuleUtils.cs.html#22019dd71502c60e" class="i method">GetDefaultAvailableModuleFiles</a>(<span class="r154 r">modulePath</span>);
 
            <b>foreach</b> (<b>string</b> <span id="r160 rd" class="r160 r">file</span> <b>in</b> <span class="r159 r">moduleFiles</span>)
            {
                <b>if</b> (<span class="r158 r">namePatterns</span> == <b>null</b> ||
                    <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(
                        <span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r160 r">file</span>), <span class="r158 r">namePatterns</span>, <span class="i">defaultValue</span>: <b>true</b>))
                {
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r161 rd" class="r161 r">module</span> = <a href="#222659eb1c55fa4e" class="i method">CreateModuleInfoForGetModule</a>(<span class="r160 r">file</span>, <span class="r156 r">refresh</span>);
                    <b>if</b> (<span class="r161 r">module</span> == <b>null</b>) { <b>continue</b>; }
 
                    <b>if</b> (<span class="r155 r">all</span> || !<a href="ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="ModuleUtils.cs.html#9a5aff6363569dd5" class="i method">IsModuleInVersionSubdirectory</a>(<span class="r160 r">file</span>, <b>out</b> <span class="i">Version</span> <span id="r162 rd" class="r162 r">directoryVersion</span>) || <span class="r162 r">directoryVersion</span> == <span class="r161 r">module</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>)
                    {
                        <b>yield</b> <b>return</b> <span class="r161 r">module</span>;
                    }
                }
            }
 
            <a href="#cb596716e0059df7" class="i method">ClearAnalysisCaches</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the version type of input string MaximumVersion, translate &quot;*&quot; if there&#39;s any.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">Version</span> <a id="8d9eea57094a20b4" href="../../R/8d9eea57094a20b4.html" target="n" data-glyph="74,1" class="i method">GetMaximumVersion</a>(<b>string</b> <span id="r163 rd" class="r163 r">stringVersion</span>)
        {
            <span class="i">Version</span> <span id="r164 rd" class="r164 r">maxVersion</span>;
            <span class="c">// First, try to convert maxVersion to version directly</span>
            <b>if</b> (<span class="i n">System</span>.<span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r163 r">stringVersion</span>, <b>out</b> <span class="r164 r">maxVersion</span>))
            {
                <b>return</b> <span class="r164 r">maxVersion</span>;
            }
            <b>else</b>
            {
                <span class="c">// If first conversion fails, try to convert * to maximum version</span>
                <b>const string</b> <span id="r165 rd" class="r165 r">maxRange</span> = <span class="s">&quot;999999999&quot;</span>;
                <b>if</b> (<span class="r163 r">stringVersion</span>[<span class="r163 r">stringVersion</span>.<span class="i">Length</span> - 1] == <span class="s">&#39;*&#39;</span>)
                {
                    <span class="r163 r">stringVersion</span> = <span class="r163 r">stringVersion</span>.<span class="i">Substring</span>(0, <span class="r163 r">stringVersion</span>.<span class="i">Length</span> - 1);
                    <span class="r163 r">stringVersion</span> += <span class="r165 r">maxRange</span>;
                    <b>int</b> <span id="r166 rd" class="r166 r">starNum</span> = <span class="r163 r">stringVersion</span>.<span class="i">Count</span>(<b>static</b> <span id="r167 rd" class="r167 r">x</span> =&gt; <span class="r167 r">x</span> == <span class="s">&#39;.&#39;</span>);
                    <b>for</b> (<b>int</b> <span id="r168 rd" class="r168 r">i</span> = 0; <span class="r168 r">i</span> &lt; (3 - <span class="r166 r">starNum</span>); <span class="r168 r">i</span>++)
                    {
                        <span class="r163 r">stringVersion</span> = <span class="r163 r">stringVersion</span> + <span class="s">&#39;.&#39;</span> + <span class="r165 r">maxRange</span>;
                    }
                }
            }
 
            <b>if</b> (<span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r163 r">stringVersion</span>, <b>out</b> <span class="r164 r">maxVersion</span>))
            {
                <b>return</b> <b>new</b> <span class="i">Version</span>(<span class="r163 r">stringVersion</span>);
            }
            <b>else</b>
            {
                <b>string</b> <span id="r169 rd" class="r169 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">MaximumVersionFormatIncorrect</span>, <span class="r163 r">stringVersion</span>);
                <b>throw</b> <b>new</b> <a href="../../utils/MshArgumentException.cs.html#095568dc2e26cb6e" class="t constructor">PSArgumentException</a>(<span class="r169 r">message</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper function for building a module info for Get-Module -List.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r170 r">file</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r171 r">refresh</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if we should update any cached module info for this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="222659eb1c55fa4e" href="../../R/222659eb1c55fa4e.html" target="n" data-glyph="76,1" class="i method">CreateModuleInfoForGetModule</a>(<b>string</b> <span id="r170 rd" class="r170 r">file</span>, <b>bool</b> <span id="r171 rd" class="r171 r">refresh</span>)
        {
            <span class="c">// Ensure we don&#39;t have any recursion in module lookup</span>
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r172 rd" class="r172 r">moduleInfo</span> = <b>null</b>;
            <b>if</b> (<a href="#3621d1d1cfd4a2ac" class="i field">_currentlyProcessingModules</a>.<span class="i">TryGetValue</span>(<span class="r170 r">file</span>, <b>out</b> <span class="r172 r">moduleInfo</span>))
            {
                <b>return</b> <span class="r172 r">moduleInfo</span>;
            }
 
            <a href="#3621d1d1cfd4a2ac" class="i field">_currentlyProcessingModules</a>[<span class="r170 r">file</span>] = <b>null</b>;
 
            <span class="c">// Create a fake module info for this file</span>
            <b>string</b> <span id="r173 rd" class="r173 r">extension</span>;
            <span class="r170 r">file</span> = <span class="r170 r">file</span>.<span class="i">TrimEnd</span>();
 
            <span class="c">// In case the file is a Ngen Assembly.</span>
            <b>if</b> (<span class="r170 r">file</span>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r173 r">extension</span> = <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>;
            }
            <b>else</b>
            {
                <span class="r173 r">extension</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r170 r">file</span>);
            }
 
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r174 rd" class="r174 r">flags</span> = <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#342eb5397fea9175" class="i field">NullOnFirstError</a>;
            <span class="c">// We are creating the ModuleInfo for Get-Module..so ignoring</span>
            <span class="c">// PowerShellHostName and PowerShellHostVersion.</span>
            <span class="r174 r">flags</span> |= <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#df92b72f166ea948" class="i field">IgnoreHostNameAndHostVersion</a>;
            <b>if</b> (<span class="r171 r">refresh</span>) { <span class="r174 r">flags</span> |= <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#edee4a6de43d8a5c" class="i field">Force</a>; }
 
            <b>try</b>
            {
                <b>if</b> (<span class="r173 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>string</b> <span id="r175 rd" class="r175 r">throwAwayScriptName</span>;
                    <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r176 rd" class="r176 r">scriptInfo</span> = <a href="#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r170 r">file</span>, <b>out</b> <span class="r175 r">throwAwayScriptName</span>, <b>true</b>);
 
                    <span class="c">// At this place, we used to check if the module is already loaded. If so, return that.</span>
                    <span class="c">// This was done to fix the issue where we were not getting the ExportedCommands since they are populated only after an import.</span>
                    <span class="c">// But, after the auto-loading feature, we get ExportedCommands even before an import.</span>
                    <span class="c">// Plus, the issue of returning the loaded module was introducing a formatting bug (Win8: 284599).</span>
                    <span class="c">// So, removing that logic.</span>
                    <span class="r172 r">moduleInfo</span> = <a href="#d19d481f41f2025c" class="i method">LoadModuleManifest</a>(
                            <span class="r176 r">scriptInfo</span>,
                            <span class="r174 r">flags</span> <span class="c">/* - don&#39;t write errors, don&#39;t load elements */</span>,
                            <span class="r177 r">minimumVersion</span>: <b>null</b>,
                            <span class="r178 r">maximumVersion</span>: <b>null</b>,
                            <span class="r179 r">requiredVersion</span>: <b>null</b>,
                            <span class="r180 r">requiredModuleGuid</span>: <b>null</b>);
                }
                <b>else</b>
                {
                    <span class="c">// It&#39;s not a module manifest, process the individual module</span>
                    <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r181 rd" class="r181 r">options</span> = <b>new</b> <span class="t">ImportModuleOptions</span>();
                    <b>bool</b> <span id="r182 rd" class="r182 r">found</span> = <b>false</b>;
 
                    <span class="r172 r">moduleInfo</span> = <span class="i">LoadModule</span>(<span class="r170 r">file</span>, <span class="i">moduleBase</span>: <b>null</b>, <span class="i">prefix</span>: <b>string</b>.<span class="i">Empty</span>, <span class="i">ss</span>: <b>null</b>, <b>ref</b> <span class="r181 r">options</span>, <span class="r174 r">flags</span>, <b>out</b> <span class="r182 r">found</span>);
                }
 
                <span class="c">// return fake PSModuleInfo if can&#39;t read the file for any reason</span>
                <b>if</b> (<span class="r172 r">moduleInfo</span> == <b>null</b>)
                {
                    <span class="r172 r">moduleInfo</span> = <b>new</b> <a href="PSModuleInfo.cs.html#59ece63f8f427775" class="t constructor">PSModuleInfo</a>(<span class="r170 r">file</span>, <span class="r183 r">context</span>: <b>null</b>, <span class="r184 r">sessionState</span>: <b>null</b>);
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#e160146a2d150faf" class="i property">HadErrorsLoading</a> = <b>true</b>;     <span class="c">// Prevent analysis cache from caching a bad module.</span>
                }
 
                <b>if</b> (<span class="r173 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>if</b> (<span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                            <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#1c66a8819a72670d" class="i field">Binary</a>);
                        }
                        <b>else</b> <b>if</b> (<span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#15536cea81510839" class="i field">Script</a>);
                        }
                        <b>else</b> <b>if</b> (<span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8de3ad39fcb348d7" class="i field">PowerShellCmdletizationFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#0650c401bbd5c177" class="i field">Cim</a>);
                        }
                        <b>else</b>
                        {
                            <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#0f2bfb43459788ea" class="i field">Manifest</a>);
                        }
 
                        <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> = <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a>;
                    }
                    <b>else</b>
                    {
                        <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#0f2bfb43459788ea" class="i field">Manifest</a>);
                        <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> = <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>;
                    }
                }
                <b>else</b> <b>if</b> (<span class="r173 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                         <span class="r173 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                         <span class="r173 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#1c66a8819a72670d" class="i field">Binary</a>);
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> = <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>;
                }
                <b>else</b> <b>if</b> (<span class="r173 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8de3ad39fcb348d7" class="i field">PowerShellCmdletizationFileExtension</a>))
                {
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#0650c401bbd5c177" class="i field">Cim</a>);
 
                    <b>string</b> <span id="r185 rd" class="r185 r">moduleName</span>;
                    <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r186 rd" class="r186 r">scriptInfo</span> = <a href="#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r170 r">file</span>, <b>out</b> <span class="r185 r">moduleName</span>, <b>true</b>);
                    <b>var</b> <span id="r187 rd" class="r187 r">cmdletizationXmlReader</span> = <b>new</b> <span class="i">StringReader</span>(<span class="r186 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#9f9388511bd97894" class="i property">ScriptContents</a>);
                    <a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#85d28fff05ca47c3" class="k">var</a> <span id="r188 rd" class="r188 r">scriptWriter</span> = <b>new</b> <span class="t">ScriptWriter</span>(
                        <span class="r187 r">cmdletizationXmlReader</span>,
                        <span class="r185 r">moduleName</span>,
                        <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#4c48c474d18556ef" class="i field">DefaultCmdletAdapter</a>,
                        <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../MshCmdlet.cs.html#92387ec2f33e4d8f" class="i property">MyInvocation</a>,
                        <a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#85d28fff05ca47c3" class="t t">ScriptWriter</a>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#881cbfa13f348ccf" class="t t">GenerationOptions</a>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#42cf789515ff4207" class="i field">HelpXml</a>);
                    <span class="r188 r">scriptWriter</span>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#abf54a5ba53e1968" class="i method">PopulatePSModuleInfo</a>(<span class="r172 r">moduleInfo</span>);
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> = <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>;
                }
                <b>else</b>
                {
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#15536cea81510839" class="i field">Script</a>);
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> = <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>;
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// 3rd-part call out, catch-all OK</span>
 
                <span class="c">// return fake PSModuleInfo if can&#39;t read the file for any reason</span>
                <b>if</b> (<span class="r172 r">moduleInfo</span> == <b>null</b>)
                {
                    <span class="r172 r">moduleInfo</span> = <b>new</b> <a href="PSModuleInfo.cs.html#59ece63f8f427775" class="t constructor">PSModuleInfo</a>(<span class="r170 r">file</span>, <b>null</b>, <b>null</b>);
                    <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#e160146a2d150faf" class="i property">HadErrorsLoading</a> = <b>true</b>;     <span class="c">// Prevent analysis cache from caching a bad module.</span>
                }
            }
 
            <b>if</b> (!<span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#e160146a2d150faf" class="i property">HadErrorsLoading</a>)
            {
                <span class="c">// Cache the module&#39;s exported commands</span>
                <a href="AnalysisCache.cs.html#e469d7c6575d3464" class="t t">AnalysisCache</a>.<a href="AnalysisCache.cs.html#5d11fb6947296177" class="i method">CacheModuleExports</a>(<span class="r172 r">moduleInfo</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
            }
            <b>else</b>
            {
                <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b5fe290216e5c03" class="i field">Tracer</a>.<a href="../../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Caching skipped for {0} because it had errors while loading.&quot;</span>, <span class="r172 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
            }
 
            <a href="#3621d1d1cfd4a2ac" class="i field">_currentlyProcessingModules</a>[<span class="r170 r">file</span>] = <span class="r172 r">moduleInfo</span>;
            <b>return</b> <span class="r172 r">moduleInfo</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Routine to process the module manifest data language script.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r189 r">scriptInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The script info for the manifest script.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Processing flags (whether to write errors / load elements).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">minimumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r178 r">maximumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r179 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r180 r">requiredModuleGuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module guid to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="d19d481f41f2025c" href="../../R/d19d481f41f2025c.html" target="n" data-glyph="74,1" class="i method">LoadModuleManifest</a>(
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r189 rd" class="r189 r">scriptInfo</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r190 rd" class="r190 r">manifestProcessingFlags</span>,
            <span class="i">Version</span> <span id="r177 rd" class="r177 r">minimumVersion</span>,
            <span class="i">Version</span> <span id="r178 rd" class="r178 r">maximumVersion</span>,
            <span class="i">Version</span> <span id="r179 rd" class="r179 r">requiredVersion</span>,
            <span class="i">Guid</span>? <span id="r180 rd" class="r180 r">requiredModuleGuid</span>)
        {
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r191 rd" class="r191 r">options</span> = <b>new</b> <span class="t">ImportModuleOptions</span>();
            <b>return</b> <a href="#521cddd2bed306ff" class="i method">LoadModuleManifest</a>(<span class="r189 r">scriptInfo</span>, <span class="r190 r">manifestProcessingFlags</span>, <span class="r177 r">minimumVersion</span>, <span class="r178 r">maximumVersion</span>, <span class="r179 r">requiredVersion</span>, <span class="r180 r">requiredModuleGuid</span>, <b>ref</b> <span class="r191 r">options</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Routine to process the module manifest data language script.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r192 r">scriptInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The script info for the manifest script.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r193 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Processing flags (whether to write errors / load elements).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r194 r">minimumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r195 r">maximumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r196 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r197 r">requiredModuleGuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module guid to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r198 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="521cddd2bed306ff" href="../../R/521cddd2bed306ff.html" target="n" data-glyph="74,1" class="i method">LoadModuleManifest</a>(
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r192 rd" class="r192 r">scriptInfo</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r193 rd" class="r193 r">manifestProcessingFlags</span>,
            <span class="i">Version</span> <span id="r194 rd" class="r194 r">minimumVersion</span>,
            <span class="i">Version</span> <span id="r195 rd" class="r195 r">maximumVersion</span>,
            <span class="i">Version</span> <span id="r196 rd" class="r196 r">requiredVersion</span>,
            <span class="i">Guid</span>? <span id="r197 rd" class="r197 r">requiredModuleGuid</span>,
            <b>ref</b> <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r198 rd" class="r198 r">options</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r192 r">scriptInfo</span> != <b>null</b>, <span class="s">&quot;scriptInfo for module (.psd1) can&#39;t be null&quot;</span>);
            <b>bool</b> <span id="r199 rd" class="r199 r">containedErrors</span> = <b>false</b>;
 
            <span class="i">Hashtable</span> <span id="r200 rd" class="r200 r">data</span> = <b>null</b>;
            <span class="i">Hashtable</span> <span id="r201 rd" class="r201 r">localizedData</span> = <b>null</b>;
            <b>if</b> (!<a href="#bf907ad98e75e913" class="i method">LoadModuleManifestData</a>(<span class="r192 r">scriptInfo</span>, <span class="r193 r">manifestProcessingFlags</span>, <b>out</b> <span class="r200 r">data</span>, <b>out</b> <span class="r201 r">localizedData</span>, <b>ref</b> <span class="r199 r">containedErrors</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <a href="#3305195da9c4dde3" class="i method">LoadModuleManifest</a>(<span class="r192 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>, <span class="r192 r">scriptInfo</span>, <span class="r200 r">data</span>, <span class="r201 r">localizedData</span>, <span class="r193 r">manifestProcessingFlags</span>, <span class="r194 r">minimumVersion</span>, <span class="r195 r">maximumVersion</span>, <span class="r196 r">requiredVersion</span>, <span class="r197 r">requiredModuleGuid</span>, <b>ref</b> <span class="r198 r">options</span>, <b>ref</b> <span class="r199 r">containedErrors</span>);
        }
 
        <b>internal bool</b> <a id="bf907ad98e75e913" href="../../R/bf907ad98e75e913.html" target="n" data-glyph="74,1" class="i method">LoadModuleManifestData</a>(<a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r202 rd" class="r202 r">scriptInfo</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r203 rd" class="r203 r">manifestProcessingFlags</span>, <b>out</b> <span class="i">Hashtable</span> <span id="r204 rd" class="r204 r">data</span>, <b>out</b> <span class="i">Hashtable</span> <span id="r205 rd" class="r205 r">localizedData</span>, <b>ref bool</b> <span id="r206 rd" class="r206 r">containedErrors</span>)
        {
            <span class="c">// load the .psd1 files into hashtables</span>
            <span class="r205 r">localizedData</span> = <b>null</b>;
            <span class="r204 r">data</span> = <a href="#8e59c883c9c355c6" class="i method">LoadModuleManifestData</a>(<span class="r202 r">scriptInfo</span>, <a href="#df56551ee1dbbfb1" class="i field">ModuleManifestMembers</a>, <span class="r203 r">manifestProcessingFlags</span>, <b>ref</b> <span class="r206 r">containedErrors</span>);
            <b>if</b> (<span class="r204 r">data</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r207 rd" class="r207 r">localizedScriptInfo</span> = <a href="#c261b3a6c1d05c37" class="i method">FindLocalizedModuleManifest</a>(<span class="r202 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>);
            <span class="r205 r">localizedData</span> = <b>null</b>;
            <b>if</b> (<span class="r207 r">localizedScriptInfo</span> != <b>null</b>)
            {
                <span class="r205 r">localizedData</span> = <a href="#8e59c883c9c355c6" class="i method">LoadModuleManifestData</a>(<span class="r207 r">localizedScriptInfo</span>, <b>null</b>, <span class="r203 r">manifestProcessingFlags</span>, <b>ref</b> <span class="r206 r">containedErrors</span>);
                <b>if</b> (<span class="r205 r">localizedData</span> == <b>null</b>)
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Helper function to generate fake PSModuleInfo objects from ModuleSpecification objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r208 r">moduleSpecs</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Collection of ModuleSpecification objects.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Collection of fake PSModuleInfo objects.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">IEnumerable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="e8e6d7a2d696e783" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateFakeModuleObject</a>(<span class="i">IEnumerable</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r208 rd" class="r208 r">moduleSpecs</span>)
        {
            <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r209 rd" class="r209 r">moduleSpec</span> <b>in</b> <span class="r208 r">moduleSpecs</span>)
            {
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="k">var</a> <span id="r210 rd" class="r210 r">fakeModuleInfo</span> = <b>new</b> <a href="PSModuleInfo.cs.html#59ece63f8f427775" class="t constructor">PSModuleInfo</a>(<span class="r209 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <b>null</b>);
                <b>if</b> (<span class="r209 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>.<span class="i">HasValue</span>)
                {
                    <span class="r210 r">fakeModuleInfo</span>.<span class="i">SetGuid</span>(<span class="r209 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>.<span class="i">Value</span>);
                }
 
                <span class="r210 r">fakeModuleInfo</span>.<span class="i">SetVersion</span>(<span class="r209 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> ?? <span class="r209 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>);
                <b>yield</b> <b>return</b> <span class="r210 r">fakeModuleInfo</span>;
            }
        }
 
        <b>private static</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="7a17ec1abb9ad6a0" href="../../R/7a17ec1abb9ad6a0.html" target="n" data-glyph="76,1" class="i method">GetErrorRecordIfUnsupportedRootCdxmlAndNestedModuleScenario</a>(
            <span class="i">Hashtable</span> <span id="r211 rd" class="r211 r">data</span>,
            <b>string</b> <span id="r212 rd" class="r212 r">moduleManifestPath</span>,
            <b>string</b> <span id="r213 rd" class="r213 r">rootModulePath</span>)
        {
            <b>if</b> (<span class="r213 r">rootModulePath</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (!<span class="r213 r">rootModulePath</span>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8de3ad39fcb348d7" class="i field">PowerShellCmdletizationFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (!<span class="r211 r">data</span>.<span class="i">ContainsKey</span>(<span class="s">&quot;NestedModules&quot;</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r214 rd" class="r214 r">nameOfRootModuleKey</span> = <span class="r211 r">data</span>.<span class="i">ContainsKey</span>(<span class="s">&quot;ModuleToProcess&quot;</span>) ? <span class="s">&quot;ModuleToProcess&quot;</span> : <span class="s">&quot;RootModule&quot;</span>;
            <b>string</b> <span id="r215 rd" class="r215 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                <span class="i">Modules</span>.<span class="i">CmdletizationDoesSupportRexportingNestedModules</span>,
                <span class="r214 r">nameOfRootModuleKey</span>,
                <span class="r212 r">moduleManifestPath</span>,
                <span class="r213 r">rootModulePath</span>);
            <span class="i">InvalidOperationException</span> <span id="r216 rd" class="r216 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r215 r">message</span>);
            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r217 rd" class="r217 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                <span class="r216 r">ioe</span>,
                <span class="s">&quot;Modules_CmdletizationDoesSupportRexportingNestedModules&quot;</span>,
                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                <span class="r212 r">moduleManifestPath</span>);
 
            <b>return</b> <span class="r217 r">er</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Routine to process the module manifest data language script.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r218 r">moduleManifestPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the manifest file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r219 r">manifestScriptInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The script info for the manifest script.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r220 r">data</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Contents of the module manifest.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r221 r">localizedData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Contents of the localized module manifest.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r222 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Processing flags (whether to write errors / load elements).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r223 r">minimumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r224 r">maximumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r225 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r226 r">requiredModuleGuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module guid to check the manifest against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r227 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r228 r">containedErrors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Tracks if there were errors in the file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="3305195da9c4dde3" href="../../R/3305195da9c4dde3.html" target="n" data-glyph="74,1" class="i method">LoadModuleManifest</a>(
            <b>string</b> <span id="r218 rd" class="r218 r">moduleManifestPath</span>,
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r219 rd" class="r219 r">manifestScriptInfo</span>,
            <span class="i">Hashtable</span> <span id="r220 rd" class="r220 r">data</span>,
            <span class="i">Hashtable</span> <span id="r221 rd" class="r221 r">localizedData</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r222 rd" class="r222 r">manifestProcessingFlags</span>,
            <span class="i">Version</span> <span id="r223 rd" class="r223 r">minimumVersion</span>,
            <span class="i">Version</span> <span id="r224 rd" class="r224 r">maximumVersion</span>,
            <span class="i">Version</span> <span id="r225 rd" class="r225 r">requiredVersion</span>,
            <span class="i">Guid</span>? <span id="r226 rd" class="r226 r">requiredModuleGuid</span>,
            <b>ref</b> <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r227 rd" class="r227 r">options</span>,
            <b>ref bool</b> <span id="r228 rd" class="r228 r">containedErrors</span>)
        {
            <b>string</b> <span id="r229 rd" class="r229 r">message</span>;
 
            <b>var</b> <span id="r230 rd" class="r230 r">bailOnFirstError</span> = <span class="r222 r">manifestProcessingFlags</span>.<span class="i">HasFlag</span>(<a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#342eb5397fea9175" class="i field">NullOnFirstError</a>);
            <b>var</b> <span id="r231 rd" class="r231 r">importingModule</span> = <span class="r222 r">manifestProcessingFlags</span>.<span class="i">HasFlag</span>(<a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>);
            <b>var</b> <span id="r232 rd" class="r232 r">writingErrors</span> = <span class="r222 r">manifestProcessingFlags</span>.<span class="i">HasFlag</span>(<a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>);
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r218 r">moduleManifestPath</span> != <b>null</b>, <span class="s">&quot;moduleManifestPath for module (.psd1) can&#39;t be null&quot;</span>);
            <b>string</b> <span id="r233 rd" class="r233 r">moduleBase</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r218 r">moduleManifestPath</span>);
 
            <b>if</b> ((<span class="r222 r">manifestProcessingFlags</span> &amp;
                 (<a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a> |
                  <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#38787ceda7c6f53b" class="i field">WriteWarnings</a>)) != 0)
            {
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a> = <span class="r218 r">moduleManifestPath</span>;
            }
 
            <span class="c">// START: Check if the ModuleToProcess is already loaded..if it is, ignore the this load manifest</span>
            <span class="c">// call and return</span>
            <b>string</b> <span id="r234 rd" class="r234 r">moduleToProcess</span> = <b>null</b>;
 
            <b>if</b> (!<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<b>string</b>&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;ModuleToProcess&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r234 r">moduleToProcess</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r235 rd" class="r235 r">rootModule</span> = <b>null</b>;
            <b>if</b> (!<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<b>string</b>&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;RootModule&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r235 r">rootModule</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r234 r">moduleToProcess</span>))
            {
                <span class="c">// If we&#39;ve found ourselves, then skip writing the warning and move on.</span>
                <span class="c">// Win8: 297326</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>) ||
                    (!<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>.<span class="i">Equals</span>(<span class="r218 r">moduleManifestPath</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                     !<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>.<span class="i">Equals</span>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#0e5d8bea34e7810f" class="i property">PreviousModuleProcessed</a>,
                         <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <b>if</b> ((<span class="r222 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#38787ceda7c6f53b" class="i field">WriteWarnings</a>) != 0)
                    {
                        <span class="i">WriteWarning</span>(<span class="i">Modules</span>.<span class="i">ModuleToProcessFieldDeprecated</span>);
                    }
                }
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r234 r">moduleToProcess</span>) &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r235 r">rootModule</span>))
            {
                <span class="c">// If we&#39;ve found ourselves, then skip writing the error and move on.</span>
                <span class="c">// Win8 :330612</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>) ||
                    (!<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>.<span class="i">Equals</span>(<span class="r218 r">moduleManifestPath</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                     !<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>.<span class="i">Equals</span>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#0e5d8bea34e7810f" class="i property">PreviousModuleProcessed</a>,
                         <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <span class="c">// Having both ModuleToProcess and RootModule is not allowed</span>
                    <b>if</b> (<span class="r232 r">writingErrors</span>)
                    {
                        <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleManifestCannotContainBothModuleToProcessAndRootModule</span>,
                            <span class="r218 r">moduleManifestPath</span>);
                        <span class="i">InvalidOperationException</span> <span id="r236 rd" class="r236 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r229 r">message</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r237 rd" class="r237 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r236 r">ioe</span>,
                            <span class="s">&quot;Modules_ModuleManifestCannotContainBothModuleToProcessAndRootModule&quot;</span>,
                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r218 r">moduleManifestPath</span>);
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r237 r">er</span>);
                    }
                }
 
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r238 rd" class="r238 r">actualRootModule</span> = <span class="r234 r">moduleToProcess</span> ?? <span class="r235 r">rootModule</span>;
 
            <span class="c">// extract defaultCommandPrefix from the manifest</span>
            <b>string</b> <span id="r239 rd" class="r239 r">defaultCommandPrefix</span> = <b>null</b>;
            <b>if</b> (
                !<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<b>string</b>&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;DefaultCommandPrefix&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r239 r">defaultCommandPrefix</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r240 rd" class="r240 r">resolvedCommandPrefix</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r239 r">defaultCommandPrefix</span>))
            {
                <span class="r240 r">resolvedCommandPrefix</span> = <span class="r239 r">defaultCommandPrefix</span>;
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#2ce2c96ea123be27" class="i property">BasePrefix</a>))
            {
                <span class="r240 r">resolvedCommandPrefix</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#2ce2c96ea123be27" class="i property">BasePrefix</a>;
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r238 r">actualRootModule</span>))
            {
                <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r238 r">actualRootModule</span>))
                {
                    <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r241 rd" class="r241 r">invalidOperation</span> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                        <span class="i">Modules</span>.<span class="i">WildCardNotAllowedInModuleToProcessAndInNestedModules</span>,
                        <span class="r218 r">moduleManifestPath</span>);
                    <span class="r241 r">invalidOperation</span>.<a href="../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;Modules_WildCardNotAllowedInModuleToProcessAndInNestedModules&quot;</span>);
                    <b>throw</b> <span class="r241 r">invalidOperation</span>;
                }
                <span class="c">// See if this module is already loaded. Since the manifest entry may not</span>
                <span class="c">// have an extension and the module table is indexed by full names, we</span>
                <span class="c">// may have search through all the extensions.</span>
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r242 rd" class="r242 r">loadedModule</span> = <b>null</b>;
                <b>string</b> <span id="r243 rd" class="r243 r">rootedPath</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<span class="i">FixupFileName</span>(<span class="r233 r">moduleBase</span>, <span class="r238 r">actualRootModule</span>, <span class="i">extension</span>: <b>null</b>, <span class="r231 r">importingModule</span>);
                <b>string</b> <span id="r244 rd" class="r244 r">mtpExtension</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r243 r">rootedPath</span>);
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r244 r">mtpExtension</span>) &amp;&amp; <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#15ae80b6bdf925b0" class="i method">IsPowerShellModuleExtension</a>(<span class="r244 r">mtpExtension</span>))
                {
                    <a href="#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r243 r">rootedPath</span>, <b>out</b> <span class="r242 r">loadedModule</span>);
                }
                <b>else</b>
                {
                    <b>foreach</b> (<b>string</b> <span id="r245 rd" class="r245 r">extensionToTry</span> <b>in</b> <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#2f61be99d14256e7" class="i field">PSModuleExtensions</a>)
                    {
                        <span class="r243 r">rootedPath</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<span class="i">FixupFileName</span>(<span class="r233 r">moduleBase</span>, <span class="r238 r">actualRootModule</span>, <span class="r245 r">extensionToTry</span>, <span class="r231 r">importingModule</span>);
                        <a href="#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r243 r">rootedPath</span>, <b>out</b> <span class="r242 r">loadedModule</span>);
                        <b>if</b> (<span class="r242 r">loadedModule</span> != <b>null</b>)
                            <b>break</b>;
                    }
                }
 
                <b>if</b> (<span class="r231 r">importingModule</span> &amp;&amp; <a href="#5ee06f3ee1be0ff1" class="i method">DoesAlreadyLoadedModuleSatisfyConstraints</a>(<span class="r242 r">loadedModule</span>))
                {
                    <b>if</b> (!<a href="#f8d5c3639f6e81cd" class="i property">BaseForce</a>)
                    {
                        <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r242 r">loadedModule</span>);
                        <span class="c">// Even if the module has been loaded, import the specified members...</span>
                        <a href="#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r242 r">loadedModule</span>, <span class="r240 r">resolvedCommandPrefix</span>, <span class="r227 r">options</span>);
 
                        <b>return</b> <span class="r242 r">loadedModule</span>;
                    }
                    <span class="c">// remove the module if force is specified  (and if module is already loaded)</span>
                    <b>else</b> <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r243 r">rootedPath</span>))
                    {
                        <a href="#452f85accd76669f" class="i method">RemoveModule</a>(<span class="r242 r">loadedModule</span>);
                    }
                }
            }
 
            <span class="c">// END: Check if the ModuleToProcess is already loaded..</span>
            <b>string</b> <span id="r246 rd" class="r246 r">author</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (!<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;Author&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r246 r">author</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r247 rd" class="r247 r">companyName</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (!<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;CompanyName&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r247 r">companyName</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <b>string</b> <span id="r248 rd" class="r248 r">copyright</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (!<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;Copyright&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r248 r">copyright</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="i">Guid</span>? <span id="r249 rd" class="r249 r">manifestGuid</span>;
            <b>if</b> (!<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;guid&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r249 r">manifestGuid</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="c">// Verify that the module manifest contains the module version information</span>
            <span class="i">Version</span> <span id="r250 rd" class="r250 r">moduleVersion</span>;
            <b>if</b> (
                !<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<span class="i">Version</span>&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;ModuleVersion&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r250 r">moduleVersion</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r250 r">moduleVersion</span> == <b>null</b>)
                {
                    <span class="r228 r">containedErrors</span> = <b>true</b>;
                    <b>if</b> (<span class="r232 r">writingErrors</span>)
                    {
                        <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleManifestMissingModuleVersion</span>, <span class="r218 r">moduleManifestPath</span>);
                        <span class="i">MissingMemberException</span> <span id="r251 rd" class="r251 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r229 r">message</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r252 rd" class="r252 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r251 r">mm</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r218 r">moduleManifestPath</span>);
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r252 r">er</span>);
                    }
 
                    <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                }
                <b>else</b> <b>if</b> (!<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#57239b4bb91959b3" class="i method">AreModuleFieldsMatchingConstraints</a>(
                    <span class="r253 r">moduleGuid</span>: <span class="r249 r">manifestGuid</span>,
                    <span class="r254 r">moduleVersion</span>: <span class="r250 r">moduleVersion</span>,
                    <span class="r255 r">requiredGuid</span>: <span class="r226 r">requiredModuleGuid</span>,
                    <span class="r256 r">requiredVersion</span>: <span class="r225 r">requiredVersion</span>,
                    <span class="r257 r">minimumRequiredVersion</span>: <span class="r223 r">minimumVersion</span>,
                    <span class="r258 r">maximumRequiredVersion</span>: <span class="r224 r">maximumVersion</span>))
                {
                    <b>if</b> (<span class="r230 r">bailOnFirstError</span>)
                    {
                        <b>return</b> <b>null</b>;
                    }
                }
 
                <span class="c">// Verify that the module version from the module manifest is equal to module version folder.</span>
                <span class="i">DirectoryInfo</span> <span id="r259 rd" class="r259 r">parent</span> = <b>null</b>;
                <b>try</b>
                {
                    <span class="r259 r">parent</span> = <span class="i">Directory</span>.<span class="i">GetParent</span>(<span class="r218 r">moduleManifestPath</span>);
                }
                <b>catch</b> (<span class="i">IOException</span>)
                {
                }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span>)
                {
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                }
 
                <span class="i">Version</span> <span id="r260 rd" class="r260 r">moduleVersionFromFolderName</span>;
                <b>if</b> (<span class="r259 r">parent</span> != <b>null</b> &amp;&amp;
                    <span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r259 r">parent</span>.<span class="i">Name</span>, <b>out</b> <span class="r260 r">moduleVersionFromFolderName</span>) &amp;&amp;
                    <span class="r259 r">parent</span>.<span class="i">Parent</span> != <b>null</b> &amp;&amp;
                    <span class="r259 r">parent</span>.<span class="i">Parent</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r218 r">moduleManifestPath</span>)))
                {
                    <b>if</b> (!<span class="r260 r">moduleVersionFromFolderName</span>.<span class="i">Equals</span>(<span class="r250 r">moduleVersion</span>))
                    {
                        <span class="r228 r">containedErrors</span> = <b>true</b>;
                        <b>if</b> (<span class="r232 r">writingErrors</span>)
                        {
                            <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifestVersion</span>, <span class="r218 r">moduleManifestPath</span>,
                                <span class="r250 r">moduleVersion</span>.<span class="i">ToString</span>(), <span class="r259 r">parent</span>.<span class="i">FullName</span>);
                            <b>var</b> <span id="r261 rd" class="r261 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r229 r">message</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r262 rd" class="r262 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r261 r">ioe</span>, <span class="s">&quot;Modules_InvalidModuleManifestVersion&quot;</span>,
                                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r218 r">moduleManifestPath</span>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r262 r">er</span>);
                        }
 
                        <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                    }
                }
            }
 
            <span class="c">// Test that the PowerShellVersion version is valid...</span>
            <span class="i">Version</span> <span id="r263 rd" class="r263 r">powerShellVersion</span>;
            <b>if</b> (
                !<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<span class="i">Version</span>&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;PowerShellVersion&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r263 r">powerShellVersion</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b> <b>if</b> (<span class="r263 r">powerShellVersion</span> != <b>null</b>)
            {
                <span class="i">Version</span> <span id="r264 rd" class="r264 r">currentPowerShellVersion</span> = <a href="../PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="../PSVersionInfo.cs.html#ad63365ac7690eeb" class="i property">PSVersion</a>;
                <b>if</b> (<span class="r264 r">currentPowerShellVersion</span> &lt; <span class="r263 r">powerShellVersion</span>)
                {
                    <span class="r228 r">containedErrors</span> = <b>true</b>;
                    <b>if</b> (<span class="r232 r">writingErrors</span>)
                    {
                        <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleManifestInsufficientPowerShellVersion</span>,
                            <span class="r264 r">currentPowerShellVersion</span>,
                            <span class="r218 r">moduleManifestPath</span>, <span class="r263 r">powerShellVersion</span>);
                        <span class="i">InvalidOperationException</span> <span id="r265 rd" class="r265 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r229 r">message</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r266 rd" class="r266 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r265 r">ioe</span>, <span class="s">&quot;Modules_InsufficientPowerShellVersion&quot;</span>,
                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r218 r">moduleManifestPath</span>);
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r266 r">er</span>);
                    }
 
                    <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                }
            }
 
            <span class="c">// Test that the PowerShellHostVersion version is valid...</span>
            <b>string</b> <span id="r267 rd" class="r267 r">requestedHostName</span>;
            <b>if</b> (
                !<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;PowerShellHostName&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r267 r">requestedHostName</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <span class="c">// Ignore errors related to HostVersion as per the ManifestProcessingFlags</span>
                <span class="c">// doing this at this place because we have to set &quot;containedErrors&quot;</span>
                <b>if</b> (((<span class="r222 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#df92b72f166ea948" class="i field">IgnoreHostNameAndHostVersion</a>) == 0) &amp;&amp;
                    <span class="r230 r">bailOnFirstError</span>)
                    <b>return</b> <b>null</b>;
            }
            <b>else</b> <b>if</b> (<span class="r267 r">requestedHostName</span> != <b>null</b>)
            {
                <b>string</b> <span id="r268 rd" class="r268 r">currentHostName</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="../hostifaces/InternalHost.cs.html#20e8052a252e9b6d" class="i property">Name</a>;
                <b>if</b> (!<b>string</b>.<span class="i">Equals</span>(<span class="r268 r">currentHostName</span>, <span class="r267 r">requestedHostName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r228 r">containedErrors</span> = <b>true</b>;
                    <span class="c">// Ignore errors related to HostVersion as per the ManifestProcessingFlags</span>
                    <span class="c">// doing this at this place because we have to set &quot;containedErrors&quot;</span>
                    <b>if</b> ((<span class="r222 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#df92b72f166ea948" class="i field">IgnoreHostNameAndHostVersion</a>) == 0)
                    {
                        <b>if</b> (<span class="r232 r">writingErrors</span>)
                        {
                            <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidPowerShellHostName</span>,
                                <span class="r268 r">currentHostName</span>, <span class="r218 r">moduleManifestPath</span>, <span class="r267 r">requestedHostName</span>);
                            <span class="i">InvalidOperationException</span> <span id="r269 rd" class="r269 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r229 r">message</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r270 rd" class="r270 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r269 r">ioe</span>, <span class="s">&quot;Modules_InvalidPowerShellHostName&quot;</span>,
                                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r218 r">moduleManifestPath</span>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r270 r">er</span>);
                        }
 
                        <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                    }
                }
            }
 
            <span class="c">// Test that the PowerShellHostVersion version is valid...</span>
            <span class="i">Version</span> <span id="r271 rd" class="r271 r">requestedHostVersion</span>;
            <b>if</b> (
                !<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;PowerShellHostVersion&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r271 r">requestedHostVersion</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <span class="c">// Ignore errors related to HostVersion as per the ManifestProcessingFlags</span>
                <span class="c">// doing this at this place because we have to set &quot;containedErrors&quot;</span>
                <b>if</b> (((<span class="r222 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#df92b72f166ea948" class="i field">IgnoreHostNameAndHostVersion</a>) == 0) &amp;&amp;
                    <span class="r230 r">bailOnFirstError</span>)
                    <b>return</b> <b>null</b>;
            }
            <b>else</b> <b>if</b> (<span class="r271 r">requestedHostVersion</span> != <b>null</b>)
            {
                <span class="i">Version</span> <span id="r272 rd" class="r272 r">currentHostVersion</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="../hostifaces/InternalHost.cs.html#207f67c40acf5ce7" class="i property">Version</a>;
                <b>if</b> (<span class="r272 r">currentHostVersion</span> &lt; <span class="r271 r">requestedHostVersion</span>)
                {
                    <span class="r228 r">containedErrors</span> = <b>true</b>;
                    <span class="c">// Ignore errors related to HostVersion as per the ManifestProcessingFlags</span>
                    <span class="c">// doing this at this place because we have to set &quot;containedErrors&quot;</span>
                    <b>if</b> ((<span class="r222 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#df92b72f166ea948" class="i field">IgnoreHostNameAndHostVersion</a>) == 0)
                    {
                        <b>if</b> (<span class="r232 r">writingErrors</span>)
                        {
                            <b>string</b> <span id="r273 rd" class="r273 r">currentHostName</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="../hostifaces/InternalHost.cs.html#20e8052a252e9b6d" class="i property">Name</a>;
                            <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidPowerShellHostVersion</span>,
                                <span class="r273 r">currentHostName</span>, <span class="r272 r">currentHostVersion</span>, <span class="r218 r">moduleManifestPath</span>, <span class="r271 r">requestedHostVersion</span>);
                            <span class="i">InvalidOperationException</span> <span id="r274 rd" class="r274 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r229 r">message</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r275 rd" class="r275 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r274 r">ioe</span>, <span class="s">&quot;Modules_InsufficientPowerShellHostVersion&quot;</span>,
                                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r218 r">moduleManifestPath</span>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r275 r">er</span>);
                        }
 
                        <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                    }
                }
            }
 
            <span class="c">// Test the required processor architecture</span>
            <span class="i">ProcessorArchitecture</span> <span id="r276 rd" class="r276 r">requiredProcessorArchitecture</span>;
            <b>if</b> (
                !<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;ProcessorArchitecture&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r276 r">requiredProcessorArchitecture</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b> <b>if</b> ((<span class="r276 r">requiredProcessorArchitecture</span> != <span class="i">ProcessorArchitecture</span>.<span class="i">None</span>) &amp;&amp;
                     (<span class="r276 r">requiredProcessorArchitecture</span> != <span class="i">ProcessorArchitecture</span>.<span class="i">MSIL</span>))
            {
                <span class="i">ProcessorArchitecture</span> <span id="r277 rd" class="r277 r">currentArchitecture</span> = <b>typeof</b>(<b>object</b>).<span class="i">Assembly</span>.<span class="i">GetName</span>().<span class="i">ProcessorArchitecture</span>;
 
                <b>if</b> (<span class="r277 r">currentArchitecture</span> != <span class="r276 r">requiredProcessorArchitecture</span>)
                {
                    <span class="r228 r">containedErrors</span> = <b>true</b>;
                    <b>if</b> (<span class="r232 r">writingErrors</span>)
                    {
                        <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidProcessorArchitecture</span>,
                            <span class="r277 r">currentArchitecture</span>, <span class="r218 r">moduleManifestPath</span>, <span class="r276 r">requiredProcessorArchitecture</span>);
                        <span class="i">InvalidOperationException</span> <span id="r278 rd" class="r278 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r229 r">message</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r279 rd" class="r279 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r278 r">ioe</span>, <span class="s">&quot;Modules_InvalidProcessorArchitecture&quot;</span>,
                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r218 r">moduleManifestPath</span>);
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r279 r">er</span>);
                    }
 
                    <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                }
            }
 
            <span class="c">// Test the required CLR version</span>
            <span class="i">Version</span> <span id="r280 rd" class="r280 r">requestedClrVersion</span>;
            <b>if</b> (
                !<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;CLRVersion&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r280 r">requestedClrVersion</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="c">// Test the required .NET Framework version</span>
            <span class="i">Version</span> <span id="r281 rd" class="r281 r">requestedDotNetFrameworkVersion</span>;
            <b>if</b> (
                !<span class="i">GetScalarFromData</span>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;DotNetFrameworkVersion&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r281 r">requestedDotNetFrameworkVersion</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="c">// HelpInfo URI</span>
            <b>string</b> <span id="r282 rd" class="r282 r">helpInfoUri</span> = <b>null</b>;
 
            <a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<b>string</b>&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;HelpInfoURI&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r282 r">helpInfoUri</span>);
 
            <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r283 rd" class="r283 r">requiredModulesLoaded</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
            <span class="c">// In case of Get-Module -List and Test-ModuleManifest, we populate this list with fake PSModuleInfo for each of the required modules specified</span>
            <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r284 rd" class="r284 r">requiredModulesSpecifiedInModuleManifest</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
            <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r285 rd" class="r285 r">requiredModules</span>;
            <b>if</b> (
                !<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;RequiredModules&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r285 r">requiredModules</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b> <b>if</b> ((<span class="r285 r">requiredModules</span> != <b>null</b>))
            {
                <b>if</b> (<span class="r231 r">importingModule</span>)
                {
                    <span class="c">// We need to pass in the moduleInfo of current module so that we can check for cyclic dependency in RequiredModules specification.</span>
                    <span class="c">// When a module A that has a required module B is imported (either explicitly or via auto-loading),</span>
                    <span class="c">// the current scope&#39;s module gets set to module A incorrectly. This leads to issues where the exported commands</span>
                    <span class="c">// of a module that imports module A) get added to module A instead of the actual module that is getting imported.</span>
                    <span class="c">// (Direct cause of Win8:336812)</span>
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r286 rd" class="r286 r">fakeManifestInfo</span> = <b>new</b> <a href="PSModuleInfo.cs.html#59ece63f8f427775" class="t constructor">PSModuleInfo</a>(<span class="r218 r">moduleManifestPath</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <b>null</b>);
                    <b>if</b> (<span class="r249 r">manifestGuid</span>.<span class="i">HasValue</span>)
                    {
                        <span class="r286 r">fakeManifestInfo</span>.<span class="i">SetGuid</span>(<span class="r249 r">manifestGuid</span>.<span class="i">Value</span>);
                    }
 
                    <b>if</b> (<span class="r250 r">moduleVersion</span> != <b>null</b>)
                    {
                        <span class="r286 r">fakeManifestInfo</span>.<a href="PSModuleInfo.cs.html#86de19074268f803" class="i method">SetVersion</a>(<span class="r250 r">moduleVersion</span>);
                    }
 
                    <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r287 rd" class="r287 r">requiredModule</span> <b>in</b> <span class="r285 r">requiredModules</span>)
                    {
                        <span class="c">// The required module name is essentially raw user input.</span>
                        <span class="c">// We must process it so paths work.</span>
                        <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r288 rd" class="r288 r">normalizedRequiredModuleSpec</span> = <span class="r287 r">requiredModule</span>?.<a href="ModuleSpecification.cs.html#d6b1ec71af1547a9" class="i method">WithNormalizedName</a>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r233 r">moduleBase</span>);
 
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r289 rd" class="r289 r">error</span> = <b>null</b>;
                        <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r290 rd" class="r290 r">module</span> = <a href="#574fb17f9e98939f" class="i method">LoadRequiredModule</a>(<span class="r286 r">fakeManifestInfo</span>, <span class="r288 r">normalizedRequiredModuleSpec</span>, <span class="r218 r">moduleManifestPath</span>,
                            <span class="r222 r">manifestProcessingFlags</span>, <span class="r228 r">containedErrors</span>, <b>out</b> <span class="r289 r">error</span>);
                        <b>if</b> (<span class="r290 r">module</span> == <b>null</b> &amp;&amp; <span class="r289 r">error</span> != <b>null</b>)
                        {
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r289 r">error</span>);
                            <b>return</b> <b>null</b>;
                        }
                        <span class="c">// module can be null (in case the RequiredModule has already been added as a snapin.</span>
                        <span class="c">// In that case, we just emit a warning and do not add the snapin to the list of requiredmodules)</span>
                        <b>if</b> (<span class="r290 r">module</span> != <b>null</b>)
                        {
                            <span class="r283 r">requiredModulesLoaded</span>.<span class="i">Add</span>(<span class="r290 r">module</span>);
                        }
                    }
                }
                <b>else</b>
                {
                    <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r291 rd" class="r291 r">fakeRequiredModuleInfo</span> <b>in</b> <span class="i">CreateFakeModuleObject</span>(<span class="r285 r">requiredModules</span>))
                    {
                        <span class="r284 r">requiredModulesSpecifiedInModuleManifest</span>.<span class="i">Add</span>(<span class="r291 r">fakeRequiredModuleInfo</span>);
                    }
                }
            }
 
            <span class="c">// Validate the list of nestedModules...</span>
            <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r292 rd" class="r292 r">tmpNestedModules</span>;
            <b>if</b> (
                !<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;NestedModules&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r292 r">tmpNestedModules</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r293 rd" class="r293 r">nestedModules</span> = <b>new</b> <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;();
 
            <b>if</b> (<span class="r292 r">tmpNestedModules</span> != <b>null</b> &amp;&amp; <span class="r292 r">tmpNestedModules</span>.<span class="i">Length</span> &gt; 0)
            {
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r294 rd" class="r294 r">s</span> <b>in</b> <span class="r292 r">tmpNestedModules</span>)
                {
                    <span class="r294 r">s</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> = <a href="#c656b417b182388e" class="i method">GetAbsolutePath</a>(<span class="r233 r">moduleBase</span>, <span class="r294 r">s</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                    <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r294 r">s</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>))
                    {
                        <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r295 rd" class="r295 r">invalidOperation</span> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                            <span class="i">Modules</span>.<span class="i">WildCardNotAllowedInModuleToProcessAndInNestedModules</span>,
                            <span class="r218 r">moduleManifestPath</span>);
                        <span class="r295 r">invalidOperation</span>.<a href="../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;Modules_WildCardNotAllowedInModuleToProcessAndInNestedModules&quot;</span>);
                        <b>throw</b> <span class="r295 r">invalidOperation</span>;
                    }
 
                    <span class="r293 r">nestedModules</span>.<span class="i">Add</span>(<span class="r294 r">s</span>);
                }
 
                <span class="i">Array</span>.<span class="i">Clear</span>(<span class="r292 r">tmpNestedModules</span>, 0, <span class="r292 r">tmpNestedModules</span>.<span class="i">Length</span>);
            }
 
            <span class="c">// Set the private data member for the module if the manifest contains this member</span>
            <b>object</b> <span id="r296 rd" class="r296 r">privateData</span> = <span class="r220 r">data</span>[<span class="s">&quot;PrivateData&quot;</span>];
 
            <span class="c">// Validate the &#39;ExperimentalFeatures&#39; member of the manifest</span>
            <span class="i">List</span>&lt;<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>&gt; <span id="r297 rd" class="r297 r">expFeatureList</span> = <b>null</b>;
            <b>if</b> (<span class="r296 r">privateData</span> <b>is</b> <span class="i">Hashtable</span> <span id="r298 rd" class="r298 r">hashData</span> &amp;&amp; <span class="r298 r">hashData</span>[<span class="s">&quot;PSData&quot;</span>] <b>is</b> <span class="i">Hashtable</span> <span id="r299 rd" class="r299 r">psData</span>)
            {
                <b>if</b> (!<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>(<span class="r299 r">psData</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;ExperimentalFeatures&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="i">Hashtable</span>[] <span id="r300 rd" class="r300 r">features</span>))
                {
                    <span class="r228 r">containedErrors</span> = <b>true</b>;
                    <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                }
 
                <b>if</b> (<span class="r300 r">features</span> != <b>null</b> &amp;&amp; <span class="r300 r">features</span>.<span class="i">Length</span> &gt; 0)
                {
                    <b>bool</b> <span id="r301 rd" class="r301 r">nameMissingOrEmpty</span> = <b>false</b>;
                    <b>var</b> <span id="r302 rd" class="r302 r">invalidNames</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                    <b>string</b> <span id="r303 rd" class="r303 r">moduleName</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r218 r">moduleManifestPath</span>);
                    <span class="r297 r">expFeatureList</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>&gt;(<span class="r300 r">features</span>.<span class="i">Length</span>);
 
                    <b>foreach</b> (<span class="i">Hashtable</span> <span id="r304 rd" class="r304 r">feature</span> <b>in</b> <span class="r300 r">features</span>)
                    {
                        <b>string</b> <span id="r305 rd" class="r305 r">featureName</span> = <span class="r304 r">feature</span>[<span class="s">&quot;Name&quot;</span>] <b>as string</b>;
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r305 r">featureName</span>))
                        {
                            <span class="r301 r">nameMissingOrEmpty</span> = <b>true</b>;
                        }
                        <b>else</b> <b>if</b> (<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>.<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#078a2c141e5be6d1" class="i method">IsModuleFeatureName</a>(<span class="r305 r">featureName</span>, <span class="r303 r">moduleName</span>))
                        {
                            <b>string</b> <span id="r306 rd" class="r306 r">featureDescription</span> = <span class="r304 r">feature</span>[<span class="s">&quot;Description&quot;</span>] <b>as string</b>;
                            <span class="r297 r">expFeatureList</span>.<span class="i">Add</span>(<b>new</b> <a href="../ExperimentalFeature/ExperimentalFeature.cs.html#76cb8e09a7250dd9" class="t constructor">ExperimentalFeature</a>(<span class="r305 r">featureName</span>, <span class="r306 r">featureDescription</span>, <span class="r218 r">moduleManifestPath</span>,
                                                                       <a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>.<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#e292001e34f610da" class="i method">IsEnabled</a>(<span class="r305 r">featureName</span>)));
                        }
                        <b>else</b>
                        {
                            <span class="r302 r">invalidNames</span>.<span class="i">Add</span>(<span class="r305 r">featureName</span>);
                        }
                    }
 
                    <b>if</b> (<span class="r301 r">nameMissingOrEmpty</span>)
                    {
                        <b>if</b> (<span class="r232 r">writingErrors</span>)
                        {
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">ArgumentException</span>(<span class="i">Modules</span>.<span class="i">ExperimentalFeatureNameMissingOrEmpty</span>),
                                                       <span class="s">&quot;Modules_ExperimentalFeatureNameMissingOrEmpty&quot;</span>,
                                                       <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>, <b>null</b>));
                        }
 
                        <span class="r228 r">containedErrors</span> = <b>true</b>;
                        <b>if</b> (<span class="r230 r">bailOnFirstError</span>) { <b>return</b> <b>null</b>; }
                    }
 
                    <b>if</b> (<span class="r302 r">invalidNames</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>if</b> (<span class="r232 r">writingErrors</span>)
                        {
                            <b>string</b> <span id="r307 rd" class="r307 r">invalidNameStr</span> = <b>string</b>.<span class="i">Join</span>(<span class="s">&quot;, &quot;</span>, <span class="r302 r">invalidNames</span>);
                            <b>string</b> <span id="r308 rd" class="r308 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidExperimentalFeatureName</span>, <span class="r307 r">invalidNameStr</span>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">ArgumentException</span>(<span class="r308 r">errorMsg</span>),
                                                       <span class="s">&quot;Modules_InvalidExperimentalFeatureName&quot;</span>,
                                                       <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>, <b>null</b>));
                        }
 
                        <span class="r228 r">containedErrors</span> = <b>true</b>;
                        <b>if</b> (<span class="r230 r">bailOnFirstError</span>) { <b>return</b> <b>null</b>; }
                    }
                }
            }
 
            <span class="c">// Process all of the exports...</span>
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r309 rd" class="r309 r">exportedFunctions</span>;
            <b>if</b> (
                !<a href="#b862ed2850894194" class="i method">GetListOfWildcardsFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;FunctionsToExport&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r309 r">exportedFunctions</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r310 rd" class="r310 r">exportedVariables</span>;
            <b>if</b> (
                !<a href="#b862ed2850894194" class="i method">GetListOfWildcardsFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;VariablesToExport&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r310 r">exportedVariables</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r311 rd" class="r311 r">exportedAliases</span>;
            <b>if</b> (
                !<a href="#b862ed2850894194" class="i method">GetListOfWildcardsFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;AliasesToExport&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r311 r">exportedAliases</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r312 rd" class="r312 r">exportedCmdlets</span>;
            <b>if</b> (
                !<a href="#b862ed2850894194" class="i method">GetListOfWildcardsFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;CmdletsToExport&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r312 r">exportedCmdlets</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r313 rd" class="r313 r">exportedDscResources</span>;
            <b>if</b> (
                !<a href="#b862ed2850894194" class="i method">GetListOfWildcardsFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;DscResourcesToExport&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r313 r">exportedDscResources</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r314 rd" class="r314 r">iss</span> = <b>null</b>;
            <b>if</b> (<span class="r231 r">importingModule</span>)
            {
                <span class="r314 r">iss</span> = <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#6aee0258f9ef7599" class="i method">Create</a>();
                <b>if</b> (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a> != <b>null</b>)
                {
                    <span class="r314 r">iss</span>.<a href="../InitialSessionState.cs.html#d12e46183b35df33" class="i property">DisableFormatUpdates</a> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#d12e46183b35df33" class="i property">DisableFormatUpdates</a>;
                }
                <span class="c">// We want the processing errors to terminate module import.</span>
                <span class="r314 r">iss</span>.<a href="../InitialSessionState.cs.html#259e8aa509ac9e00" class="i property">ThrowOnRunspaceOpenError</a> = <b>true</b>;
            }
 
            <span class="c">// Indicates the ISS.Bind() should be called...</span>
            <b>bool</b> <span id="r315 rd" class="r315 r">doBind</span> = <b>false</b>;
 
            <span class="c">// Set up to load any required assemblies that have been specified...</span>
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r316 rd" class="r316 r">tmpAssemblyList</span>;
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r317 rd" class="r317 r">assemblyList</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r318 rd" class="r318 r">fixedUpAssemblyPathList</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
            <b>if</b> (
                !<a href="#8cfdef9fa75e1f79" class="i method">GetListOfStringsFromData</a>(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;RequiredAssemblies&quot;</span>, <span class="r222 r">manifestProcessingFlags</span>,
                    <b>out</b> <span class="r316 r">tmpAssemblyList</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r316 r">tmpAssemblyList</span> != <b>null</b> &amp;&amp; <span class="r316 r">tmpAssemblyList</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>foreach</b> (<b>string</b> <span id="r319 rd" class="r319 r">assembly</span> <b>in</b> <span class="r316 r">tmpAssemblyList</span>)
                    {
                        <span class="r317 r">assemblyList</span>.<span class="i">Add</span>(<span class="r319 r">assembly</span>);
                    }
                }
 
                <b>if</b> ((<span class="r317 r">assemblyList</span> != <b>null</b>) &amp;&amp; <span class="r231 r">importingModule</span>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r320 rd" class="r320 r">assembly</span> <b>in</b> <span class="r317 r">assemblyList</span>)
                    {
                        <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r320 r">assembly</span>))
                        {
                            <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r321 rd" class="r321 r">invalidOperation</span> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">Modules</span>.<span class="i">WildCardNotAllowedInRequiredAssemblies</span>,
                                <span class="r218 r">moduleManifestPath</span>);
                            <span class="r321 r">invalidOperation</span>.<a href="../../utils/MshInvalidOperationException.cs.html#06b019caca30c7ed" class="i method">SetErrorId</a>(<span class="s">&quot;Modules_WildCardNotAllowedInRequiredAssemblies&quot;</span>);
                            <b>throw</b> <span class="r321 r">invalidOperation</span>;
                        }
                        <b>else</b>
                        {
                            <b>string</b> <span id="r322 rd" class="r322 r">fileName</span> = <span class="i">FixupFileName</span>(<span class="r233 r">moduleBase</span>, <span class="r320 r">assembly</span>, <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>, <span class="r231 r">importingModule</span>, <b>out bool</b> <span id="r323 rd" class="r323 r">pathIsResolved</span>);
                            <b>if</b> (!<span class="r323 r">pathIsResolved</span>)
                            {
                                <span class="r322 r">fileName</span> = <span class="i">FixupFileName</span>(<span class="r233 r">moduleBase</span>, <span class="r320 r">assembly</span>, <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="r231 r">importingModule</span>);
                            }
 
                            <b>string</b> <span id="r324 rd" class="r324 r">loadMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">LoadingFile</span>, <span class="s">&quot;Assembly&quot;</span>, <span class="r322 r">fileName</span>);
                            <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r324 r">loadMessage</span>);
                            <span class="r314 r">iss</span>.<a href="../InitialSessionState.cs.html#501914944d122594" class="i property">Assemblies</a>.<a href="../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <a href="../InitialSessionState.cs.html#f7e880a795c5c912" class="t constructor">SessionStateAssemblyEntry</a>(<span class="r320 r">assembly</span>, <span class="r322 r">fileName</span>));
                            <span class="r318 r">fixedUpAssemblyPathList</span>.<span class="i">Add</span>(<span class="r322 r">fileName</span>);
 
                            <span class="r322 r">fileName</span> = <span class="i">FixupFileName</span>(<span class="r233 r">moduleBase</span>, <span class="r320 r">assembly</span>, <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>, <span class="r231 r">importingModule</span>);
                            <span class="r324 r">loadMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">LoadingFile</span>, <span class="s">&quot;Executable&quot;</span>, <span class="r322 r">fileName</span>);
                            <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r324 r">loadMessage</span>);
                            <span class="r314 r">iss</span>.<a href="../InitialSessionState.cs.html#501914944d122594" class="i property">Assemblies</a>.<a href="../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <a href="../InitialSessionState.cs.html#f7e880a795c5c912" class="t constructor">SessionStateAssemblyEntry</a>(<span class="r320 r">assembly</span>, <span class="r322 r">fileName</span>));
                            <span class="r318 r">fixedUpAssemblyPathList</span>.<span class="i">Add</span>(<span class="r322 r">fileName</span>);
 
                            <span class="r315 r">doBind</span> = <b>true</b>;
                        }
                    }
                }
            }
 
            <span class="c">// Set up to load any types files that have been specified...</span>
            <b>if</b> (!<a href="#97a01907bee1ce21" class="i method">GetListOfFilesFromData</a>(
                <span class="r220 r">data</span>,
                <span class="r218 r">moduleManifestPath</span>,
                <span class="r325 r">key</span>: <span class="s">&quot;TypesToProcess&quot;</span>,
                <span class="r222 r">manifestProcessingFlags</span>,
                <span class="r233 r">moduleBase</span>,
                <span class="r326 r">extension</span>: <span class="s">&quot;.ps1xml&quot;</span>,
                <span class="r327 r">verifyFilesExist</span>: <b>true</b>,
                <b>out</b> <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r328 rd" class="r328 r">exportedTypeFiles</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b>
            {
                <b>if</b> ((<span class="r328 r">exportedTypeFiles</span> != <b>null</b>) &amp;&amp; <span class="r231 r">importingModule</span>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r329 rd" class="r329 r">fileName</span> <b>in</b> <span class="r328 r">exportedTypeFiles</span>)
                    {
                        <b>string</b> <span id="r330 rd" class="r330 r">loadMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">LoadingFile</span>, <span class="s">&quot;TypesToProcess&quot;</span>, <span class="r329 r">fileName</span>);
                        <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r330 r">loadMessage</span>);
 
                        <b>bool</b> <span id="r331 rd" class="r331 r">isAlreadyLoaded</span> = <b>false</b>;
                        <b>string</b> <span id="r332 rd" class="r332 r">resolvedFileName</span> = <a href="#9910dbba4c162701" class="i method">ResolveRootedFilePath</a>(<span class="r329 r">fileName</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>) ?? <span class="r329 r">fileName</span>;
                        <b>foreach</b> (<b>var</b> <span id="r333 rd" class="r333 r">entry</span> <b>in</b> <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#0f0c3a5adb4b1776" class="i property">Types</a>)
                        {
                            <b>if</b> (<span class="r333 r">entry</span>.<span class="i">FileName</span> == <b>null</b>)
                            {
                                <b>continue</b>;
                            }
 
                            <b>string</b> <span id="r334 rd" class="r334 r">resolvedEntryFileName</span> = <span class="i">ResolveRootedFilePath</span>(<span class="r333 r">entry</span>.<span class="i">FileName</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>) ??
                                                            <span class="r333 r">entry</span>.<span class="i">FileName</span>;
                            <b>if</b> (<span class="r334 r">resolvedEntryFileName</span>.<span class="i">Equals</span>(<span class="r332 r">resolvedFileName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <span class="r331 r">isAlreadyLoaded</span> = <b>true</b>;
                                <b>break</b>;
                            }
                        }
 
                        <b>if</b> (!<span class="r331 r">isAlreadyLoaded</span>)
                        {
                            <span class="r314 r">iss</span>.<a href="../InitialSessionState.cs.html#0f0c3a5adb4b1776" class="i property">Types</a>.<a href="../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <a href="../InitialSessionState.cs.html#6607e0d8b4d498c7" class="t constructor">SessionStateTypeEntry</a>(<span class="r329 r">fileName</span>));
                            <span class="r315 r">doBind</span> = <b>true</b>;
                        }
                    }
                }
            }
 
            <span class="c">// Set up to load any format files that have been specified...</span>
            <b>if</b> (!<a href="#97a01907bee1ce21" class="i method">GetListOfFilesFromData</a>(
                <span class="r220 r">data</span>,
                <span class="r218 r">moduleManifestPath</span>,
                <span class="r325 r">key</span>: <span class="s">&quot;FormatsToProcess&quot;</span>,
                <span class="r222 r">manifestProcessingFlags</span>,
                <span class="r233 r">moduleBase</span>,
                <span class="r326 r">extension</span>: <span class="s">&quot;.ps1xml&quot;</span>,
                <span class="r327 r">verifyFilesExist</span>: <b>true</b>,
                <b>out</b> <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r335 rd" class="r335 r">exportedFormatFiles</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b>
            {
                <b>if</b> ((<span class="r335 r">exportedFormatFiles</span> != <b>null</b>) &amp;&amp; <span class="r231 r">importingModule</span>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r336 rd" class="r336 r">fileName</span> <b>in</b> <span class="r335 r">exportedFormatFiles</span>)
                    {
                        <b>string</b> <span id="r337 rd" class="r337 r">loadMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">LoadingFile</span>, <span class="s">&quot;FormatsToProcess&quot;</span>, <span class="r336 r">fileName</span>);
                        <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r337 r">loadMessage</span>);
 
                        <b>bool</b> <span id="r338 rd" class="r338 r">isAlreadyLoaded</span> = <b>false</b>;
                        <b>foreach</b> (<b>var</b> <span id="r339 rd" class="r339 r">entry</span> <b>in</b> <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#4e7657f066102cad" class="i property">Formats</a>)
                        {
                            <b>if</b> (<span class="r339 r">entry</span>.<span class="i">FileName</span> == <b>null</b>)
                            {
                                <b>continue</b>;
                            }
 
                            <b>if</b> (<span class="r339 r">entry</span>.<span class="i">FileName</span>.<span class="i">Equals</span>(<span class="r336 r">fileName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <span class="r338 r">isAlreadyLoaded</span> = <b>true</b>;
                                <b>break</b>;
                            }
                        }
 
                        <b>if</b> (!<span class="r338 r">isAlreadyLoaded</span>)
                        {
                            <span class="r314 r">iss</span>.<a href="../InitialSessionState.cs.html#4e7657f066102cad" class="i property">Formats</a>.<a href="../InitialSessionState.cs.html#048e6fba5da66395" class="i method">Add</a>(<b>new</b> <a href="../InitialSessionState.cs.html#96ae628367065642" class="t constructor">SessionStateFormatEntry</a>(<span class="r336 r">fileName</span>));
                            <span class="r315 r">doBind</span> = <b>true</b>;
                        }
                    }
                }
            }
 
            <span class="c">// scripts to process</span>
            <b>if</b> (!<a href="#97a01907bee1ce21" class="i method">GetListOfFilesFromData</a>(
                <span class="r220 r">data</span>,
                <span class="r218 r">moduleManifestPath</span>,
                <span class="r325 r">key</span>: <span class="s">&quot;ScriptsToProcess&quot;</span>,
                <span class="r222 r">manifestProcessingFlags</span>,
                <span class="r233 r">moduleBase</span>,
                <span class="r326 r">extension</span>: <span class="s">&quot;.ps1&quot;</span>,
                <span class="r327 r">verifyFilesExist</span>: <b>true</b>,
                <b>out</b> <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r340 rd" class="r340 r">scriptsToProcess</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
            <b>else</b>
            {
                <b>if</b> ((<span class="r340 r">scriptsToProcess</span> != <b>null</b>) &amp;&amp; <span class="r231 r">importingModule</span>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r341 rd" class="r341 r">scriptFile</span> <b>in</b> <span class="r340 r">scriptsToProcess</span>)
                    {
                        <b>if</b> (!<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r341 r">scriptFile</span>).<span class="i">Equals</span>(<span class="s">&quot;.ps1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>string</b> <span id="r342 rd" class="r342 r">errorMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ScriptsToProcessIncorrectExtension</span>,
                                <span class="r341 r">scriptFile</span>);
                            <span class="i">InvalidOperationException</span> <span id="r343 rd" class="r343 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r342 r">errorMessage</span>);
                            <span class="i">WriteInvalidManifestMemberError</span>(<a href="#0479f5f00c7dafc1" class="k">this</a>, <span class="s">&quot;ScriptsToProcess&quot;</span>, <span class="r218 r">moduleManifestPath</span>, <span class="r343 r">ioe</span>,
                                <span class="r222 r">manifestProcessingFlags</span>);
 
                            <span class="r228 r">containedErrors</span> = <b>true</b>;
                            <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
                        }
                    }
                }
            }
 
            <span class="c">// Now add the metadata to the module info object for the manifest...</span>
            <b>string</b> <span id="r344 rd" class="r344 r">description</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>if</b> (<span class="r220 r">data</span>.<span class="i">Contains</span>(<span class="s">&quot;Description&quot;</span>))
            {
                <b>if</b> (<span class="r221 r">localizedData</span> != <b>null</b> &amp;&amp; <span class="r221 r">localizedData</span>.<span class="i">Contains</span>(<span class="s">&quot;Description&quot;</span>))
                {
                    <span class="r344 r">description</span> = (<b>string</b>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r221 r">localizedData</span>[<span class="s">&quot;Description&quot;</span>],
                        <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r344 r">description</span>))
                {
                    <span class="r344 r">description</span> = (<b>string</b>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r220 r">data</span>[<span class="s">&quot;Description&quot;</span>],
                        <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                }
            }
 
            <span class="c">// Process &quot;FileList&quot;</span>
            <b>if</b> (!<span class="i">GetListOfFilesFromData</span>(
                <span class="r220 r">data</span>,
                <span class="r218 r">moduleManifestPath</span>,
                <span class="i">key</span>: <span class="s">&quot;FileList&quot;</span>,
                <span class="r222 r">manifestProcessingFlags</span>,
                <span class="r233 r">moduleBase</span>,
                <span class="i">extension</span>: <b>string</b>.<span class="i">Empty</span>,
                <span class="c">// Don&#39;t check file existence - don&#39;t want to change current behavior without feature team discussion.</span>
                <span class="i">verifyFilesExist</span>: <b>false</b>,
                <b>out</b> <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r345 rd" class="r345 r">fileList</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="c">// Process &quot;ModuleList</span>
            <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r346 rd" class="r346 r">moduleList</span>;
            <b>if</b> (
                !<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[]&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;ModuleList&quot;</span>,
                    <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r346 r">moduleList</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="c">// Process &quot;CompatiblePSEditions&quot;</span>
            <b>string</b>[] <span id="r347 rd" class="r347 r">compatiblePSEditions</span>;
            <b>if</b> (
                !<a href="#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<b>string</b>[]&gt;(<span class="r220 r">data</span>, <span class="r218 r">moduleManifestPath</span>, <span class="s">&quot;CompatiblePSEditions&quot;</span>,
                    <span class="r222 r">manifestProcessingFlags</span>, <b>out</b> <span class="r347 r">compatiblePSEditions</span>))
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r230 r">bailOnFirstError</span>) <b>return</b> <b>null</b>;
            }
 
            <span class="c">// On Windows, we want to include any modules under %WINDIR%\System32\WindowsPowerShell\v1.0\Modules</span>
            <span class="c">// that have declared compatibility with PS Core (or if the check is skipped)</span>
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r348 rd" class="r348 r">inferredCompatiblePSEditions</span> = <span class="r347 r">compatiblePSEditions</span> ?? <a href="#48104017c026183b" class="i property">DefaultCompatiblePSEditions</a>;
            <b>bool</b> <span id="r349 rd" class="r349 r">isConsideredCompatible</span> = <a href="ModuleUtils.cs.html#623e3612c4173093" class="t t">ModuleUtils</a>.<a href="ModuleUtils.cs.html#7fd62a209e00d8b7" class="i method">IsPSEditionCompatible</a>(<span class="r218 r">moduleManifestPath</span>, <span class="r348 r">inferredCompatiblePSEditions</span>);
            <b>if</b> (!<a href="#c870fc509e9d03a5" class="i property">BaseSkipEditionCheck</a> &amp;&amp; !<span class="r349 r">isConsideredCompatible</span>)
            {
                <b>if</b> (<a href="../PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="../PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="../PSConfiguration.cs.html#036f416f18662a20" class="i method">IsImplicitWinCompatEnabled</a>())
                {
                    <b>if</b> (<span class="r231 r">importingModule</span>)
                    {
                        <span class="i">IList</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r350 rd" class="r350 r">moduleProxies</span> = <span class="i">ImportModulesUsingWinCompat</span>(<b>new</b> <b>string</b>[] { <span class="r218 r">moduleManifestPath</span> }, <b>null</b>, <span class="r227 r">options</span>);
 
                        <span class="c">// we are loading by a single ManifestPath so expect max of 1</span>
                        <b>if</b> (<span class="r350 r">moduleProxies</span>.<span class="i">Count</span> &gt; 0)
                        {
                            <b>return</b> <span class="r350 r">moduleProxies</span>[0];
                        }
                        <b>else</b>
                        {
                            <b>return</b> <b>null</b>;
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="r228 r">containedErrors</span> = <b>true</b>;
                    <b>if</b> (<span class="r232 r">writingErrors</span>)
                    {
                        <span class="r229 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                            <span class="i">Modules</span>.<span class="i">ImplicitWinCompatDisabled</span>,
                            <span class="r218 r">moduleManifestPath</span>,
                            <b>string</b>.<span class="i">Join</span>(<span class="s">&#39;,&#39;</span>, <span class="r348 r">inferredCompatiblePSEditions</span>));
 
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r351 rd" class="r351 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                            <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r229 r">message</span>),
                            <b>nameof</b>(<span class="i">Modules</span>) + <span class="s">&quot;_&quot;</span> + <b>nameof</b>(<span class="i">Modules</span>.<span class="i">ImplicitWinCompatDisabled</span>),
                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>,
                            <span class="r218 r">moduleManifestPath</span>);
 
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r351 r">er</span>);
                    }
 
                    <b>if</b> (<span class="r230 r">bailOnFirstError</span>)
                    {
                        <span class="c">// If we&#39;re trying to load the module, return null so that caches</span>
                        <span class="c">// are not polluted</span>
                        <b>if</b> (<span class="r231 r">importingModule</span>)
                        {
                            <b>return</b> <b>null</b>;
                        }
 
                        <span class="c">// If we return null with Get-Module, a fake module info will be created. Since</span>
                        <span class="c">// we want to suppress output of the module, we need to do that here.</span>
                        <b>return</b> <b>new</b> <a href="PSModuleInfo.cs.html#59ece63f8f427775" class="t constructor">PSModuleInfo</a>(<span class="r218 r">moduleManifestPath</span>, <span class="r183 r">context</span>: <b>null</b>, <span class="r184 r">sessionState</span>: <b>null</b>)
                        {
                            <a href="PSModuleInfo.cs.html#e160146a2d150faf" class="i property">HadErrorsLoading</a> = <b>true</b>,
                            <a href="PSModuleInfo.cs.html#49109b84a960dd4e" class="i property">IsConsideredEditionCompatible</a> = <b>false</b>,
                        };
                    }
                }
            }
 
            <span class="c">// Process format.ps1xml / types.ps1.xml / RequiredAssemblies</span>
            <span class="c">// as late as possible, but before ModuleToProcess, ScriptToProcess, NestedModules</span>
            <b>if</b> (<span class="r231 r">importingModule</span>)
            {
                <span class="c">// Do the InitialSessionState binding...</span>
                <b>if</b> (<span class="r315 r">doBind</span>)
                {
                    <b>try</b>
                    {
                        <span class="r314 r">iss</span>.<a href="../InitialSessionState.cs.html#760b053de3dbd6be" class="i method">Bind</a>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r352 r">updateOnly</span>: <b>true</b>, <span class="r353 r">module</span>: <b>null</b>, <span class="r354 r">noClobber</span>: <b>false</b>, <span class="r355 r">local</span>: <b>false</b>, <span class="r356 r">setLocation</span>: <b>false</b>);
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r357 rd" class="r357 r">e</span>)
                    {
                        <a href="#0479f5f00c7dafc1" class="k">this</a>.<span class="i">RemoveTypesAndFormatting</span>(<span class="r335 r">exportedFormatFiles</span>, <span class="r328 r">exportedTypeFiles</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r358 rd" class="r358 r">er</span> = <b>new</b> <a href="../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r357 r">e</span>, <span class="s">&quot;FormatXmlUpdateException&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>,
                            <b>null</b>);
                        <b>if</b> (<span class="r230 r">bailOnFirstError</span>)
                        {
                            <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r358 r">er</span>);
                        }
                        <b>else</b> <b>if</b> (<span class="r232 r">writingErrors</span>)
                        {
                            <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r358 r">er</span>);
                        }
                    }
                }
            }
 
            <span class="c">// Create a PSModuleInfo for psd1 file or take one from ModuleToProcess manifest field</span>
            <span class="c">// SessionState is created for psd1 file or taken from ModuleToProcess module (unless it is a binary module)</span>
            <span class="c">// If we&#39;re loading the manifest, allocate a session state object for it...</span>
            <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="k">var</a> <span id="r359 rd" class="r359 r">ss</span> = <span class="r231 r">importingModule</span> ? <b>new</b> <a href="../SessionStatePublic.cs.html#b5c2a459b4a3ca3e" class="t constructor">SessionState</a>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <b>true</b>, <b>true</b>) : <b>null</b>;
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="k">var</a> <span id="r360 rd" class="r360 r">manifestInfo</span> = <b>new</b> <a href="PSModuleInfo.cs.html#59ece63f8f427775" class="t constructor">PSModuleInfo</a>(<span class="r218 r">moduleManifestPath</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r359 r">ss</span>);
 
            <span class="c">// Default to a Manifest module type...</span>
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#0f2bfb43459788ea" class="i field">Manifest</a>);
 
            <b>if</b> (<span class="r231 r">importingModule</span>)
            {
                <a href="#180d2b67fc813ae6" class="i method">SetModuleLoggingInformation</a>(<span class="r360 r">manifestInfo</span>);
            }
 
            <b>if</b> (<span class="r284 r">requiredModulesSpecifiedInModuleManifest</span> != <b>null</b> &amp;&amp; <span class="r284 r">requiredModulesSpecifiedInModuleManifest</span>.<span class="i">Count</span> &gt; 0)
            {
                <b>foreach</b> (<b>var</b> <span id="r361 rd" class="r361 r">module</span> <b>in</b> <span class="r284 r">requiredModulesSpecifiedInModuleManifest</span>)
                {
                    <span class="r360 r">manifestInfo</span>.<span class="i">AddRequiredModule</span>(<span class="r361 r">module</span>);
                }
            }
 
            <span class="c">// If there is a session state, set up to import/export commands and variables</span>
            <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
            {
                <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<span class="i">SetVariable</span>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>, <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r218 r">moduleManifestPath</span>),
                    <b>true</b>, <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>);
                <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateVariableAPIs.cs.html#b40287193f838b0a" class="i method">SetVariable</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>, <span class="r218 r">moduleManifestPath</span>, <b>true</b>,
                    <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>);
                <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> = <span class="r360 r">manifestInfo</span>;
 
                <span class="c">// without ModuleToProcess a manifest will export everything by default</span>
                <span class="c">// (otherwise we want to honour exports from ModuleToProcess)</span>
                <b>if</b> (<span class="r309 r">exportedFunctions</span> == <b>null</b>)
                {
                    <span class="r309 r">exportedFunctions</span> = <a href="#3442415c65548b8f" class="i property">MatchAll</a>;
                }
 
                <b>if</b> (<span class="r312 r">exportedCmdlets</span> == <b>null</b>)
                {
                    <span class="r312 r">exportedCmdlets</span> = <a href="#3442415c65548b8f" class="i property">MatchAll</a>;
                }
 
                <b>if</b> (<span class="r310 r">exportedVariables</span> == <b>null</b>)
                {
                    <span class="r310 r">exportedVariables</span> = <a href="#3442415c65548b8f" class="i property">MatchAll</a>;
                }
 
                <b>if</b> (<span class="r311 r">exportedAliases</span> == <b>null</b>)
                {
                    <span class="r311 r">exportedAliases</span> = <a href="#3442415c65548b8f" class="i property">MatchAll</a>;
                }
 
                <b>if</b> (<span class="r313 r">exportedDscResources</span> == <b>null</b>)
                {
                    <span class="r313 r">exportedDscResources</span> = <a href="#3442415c65548b8f" class="i property">MatchAll</a>;
                }
            }
 
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#9b617cc3f69baa1e" class="i property">Description</a> = <span class="r344 r">description</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#964f6cf27d5eeb00" class="i property">PrivateData</a> = <span class="r296 r">privateData</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#87f1728ba7490f93" class="i method">SetExportedTypeFiles</a>(<b>new</b> <span class="i">ReadOnlyCollection</span>&lt;<b>string</b>&gt;(<span class="r328 r">exportedTypeFiles</span> ?? <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;()));
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#1d33b07765cb3293" class="i method">SetExportedFormatFiles</a>(<b>new</b> <span class="i">ReadOnlyCollection</span>&lt;<b>string</b>&gt;(<span class="r335 r">exportedFormatFiles</span> ?? <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;()));
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#86de19074268f803" class="i method">SetVersion</a>(<span class="r250 r">moduleVersion</span>);
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#5575df040d9e83ad" class="i property">Author</a> = <span class="r246 r">author</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#5712d91db996f4b9" class="i property">CompanyName</a> = <span class="r247 r">companyName</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#f874db839f072c87" class="i property">Copyright</a> = <span class="r248 r">copyright</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#b02be56548e4c3c7" class="i property">DotNetFrameworkVersion</a> = <span class="r281 r">requestedDotNetFrameworkVersion</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#9102cf9f060d4060" class="i property">ClrVersion</a> = <span class="r280 r">requestedClrVersion</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#4225b887eec850c2" class="i property">PowerShellHostName</a> = <span class="r267 r">requestedHostName</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#8461cce8296d3118" class="i property">PowerShellHostVersion</a> = <span class="r271 r">requestedHostVersion</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#6d8cd807d9d4d3ed" class="i property">PowerShellVersion</a> = <span class="r263 r">powerShellVersion</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#72fb99b54c9a7f07" class="i property">ProcessorArchitecture</a> = <span class="r276 r">requiredProcessorArchitecture</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#50046b8fca919b99" class="i property">Prefix</a> = <span class="r240 r">resolvedCommandPrefix</span>;
 
            <span class="c">// A module is considered compatible if it&#39;s not on the System32 module path, or</span>
            <span class="c">// if it is and declared &quot;Core&quot; as a compatible PSEdition.</span>
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#49109b84a960dd4e" class="i property">IsConsideredEditionCompatible</a> = <span class="r349 r">isConsideredCompatible</span>;
 
            <b>if</b> (<span class="r297 r">expFeatureList</span> != <b>null</b>)
            {
                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#b2a843972231de0a" class="i property">ExperimentalFeatures</a> = <b>new</b> <span class="i">ReadOnlyCollection</span>&lt;<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>&gt;(<span class="r297 r">expFeatureList</span>);
            }
 
            <b>if</b> (<span class="r317 r">assemblyList</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r362 rd" class="r362 r">a</span> <b>in</b> <span class="r317 r">assemblyList</span>)
                {
                    <span class="r360 r">manifestInfo</span>.<span class="i">AddRequiredAssembly</span>(<span class="r362 r">a</span>);
                }
            }
 
            <b>if</b> (<span class="r345 r">fileList</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r363 rd" class="r363 r">f</span> <b>in</b> <span class="r345 r">fileList</span>)
                {
                    <b>string</b> <span id="r364 rd" class="r364 r">absoluteFilePath</span> = <span class="i">GetAbsolutePath</span>(<span class="r233 r">moduleBase</span>, <span class="r363 r">f</span>);
                    <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#52b424e50f8f0086" class="i method">AddToFileList</a>(<span class="r364 r">absoluteFilePath</span>);
                }
            }
 
            <b>if</b> (<span class="r346 r">moduleList</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="k">var</a> <span id="r365 rd" class="r365 r">m</span> <b>in</b> <span class="r346 r">moduleList</span>)
                {
                    <span class="r365 r">m</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> = <a href="#c656b417b182388e" class="i method">GetAbsolutePath</a>(<span class="r233 r">moduleBase</span>, <span class="r365 r">m</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                    <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#8c37262071a4bb09" class="i method">AddToModuleList</a>(<span class="r365 r">m</span>);
                }
            }
 
            <b>if</b> (<span class="r347 r">compatiblePSEditions</span> != <b>null</b>)
            {
                <span class="r360 r">manifestInfo</span>.<span class="i">AddToCompatiblePSEditions</span>(<span class="r347 r">compatiblePSEditions</span>);
            }
 
            <b>if</b> (<span class="r340 r">scriptsToProcess</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r366 rd" class="r366 r">s</span> <b>in</b> <span class="r340 r">scriptsToProcess</span>)
                {
                    <span class="r360 r">manifestInfo</span>.<span class="i">AddScript</span>(<span class="r366 r">s</span>);
                }
            }
 
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> = <span class="r238 r">actualRootModule</span>;
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a> = <span class="r238 r">actualRootModule</span>;
            <b>if</b> (<span class="r249 r">manifestGuid</span> != <b>null</b>)
            {
                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#4b6e2a1b9b5b92c2" class="i method">SetGuid</a>((<span class="i">Guid</span>)<span class="r249 r">manifestGuid</span>);
            }
 
            <b>if</b> (<span class="r282 r">helpInfoUri</span> != <b>null</b>)
            {
                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#c345165f675110e2" class="i method">SetHelpInfoUri</a>(<span class="r282 r">helpInfoUri</span>);
            }
 
            <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r367 rd" class="r367 r">module</span> <b>in</b> <span class="r283 r">requiredModulesLoaded</span>)
            {
                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#57a95e451ee3143b" class="i method">AddRequiredModule</a>(<span class="r367 r">module</span>);
            }
 
            <b>if</b> (<span class="r285 r">requiredModules</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r368 rd" class="r368 r">moduleSpecification</span> <b>in</b> <span class="r285 r">requiredModules</span>)
                {
                    <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#ae1ef9e0dfb6b521" class="i method">AddRequiredModuleSpecification</a>(<span class="r368 r">moduleSpecification</span>);
                }
            }
 
            <span class="c">// Populate the RepositorySourceLocation property from PSGetModuleInfo.xml file if it is available under the module base folder.</span>
            <b>var</b> <span id="r369 rd" class="r369 r">psgetItemInfoXml</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r233 r">moduleBase</span>, <span class="s">&quot;PSGetModuleInfo.xml&quot;</span>);
            <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r369 r">psgetItemInfoXml</span>))
            {
                <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">PopulatingRepositorySourceLocation</span>, <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>));
                <b>try</b>
                {
                    <b>using</b> (<span class="i">TextReader</span> <span id="r370 rd" class="r370 r">reader</span> = <span class="i">File</span>.<span class="i">OpenText</span>(<span class="r369 r">psgetItemInfoXml</span>))
                    {
                        <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r371 rd" class="r371 r">xml</span> = <a href="../serialization.cs.html#9342c13ff4bbe3fb" class="t t">PSSerializer</a>.<span class="i">Deserialize</span>(<span class="r370 r">reader</span>.<span class="i">ReadToEnd</span>()) <b>as</b> <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>;
                        <b>if</b> (<span class="r371 r">xml</span> != <b>null</b> &amp;&amp; <span class="r371 r">xml</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;RepositorySourceLocation&quot;</span>] != <b>null</b>)
                        {
                            <b>var</b> <span id="r372 rd" class="r372 r">repositorySourceLocation</span> = <span class="r371 r">xml</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;RepositorySourceLocation&quot;</span>].<a href="../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>.<span class="i">ToString</span>();
                            <span class="i">Uri</span> <span id="r373 rd" class="r373 r">repositorySourceLocationUri</span>;
 
                            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r372 r">repositorySourceLocation</span>) &amp;&amp;
                                <span class="i">Uri</span>.<span class="i">TryCreate</span>(<span class="r372 r">repositorySourceLocation</span>, <span class="i">UriKind</span>.<span class="i">RelativeOrAbsolute</span>,
                                    <b>out</b> <span class="r373 r">repositorySourceLocationUri</span>))
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#b0cc1fefc6f988f8" class="i property">RepositorySourceLocation</a> = <span class="r373 r">repositorySourceLocationUri</span>;
                            }
                        }
                    }
                }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span>)
                {
                }
                <b>catch</b> (<span class="i">ArgumentException</span>)
                {
                }
                <b>catch</b> (<span class="i">PathTooLongException</span>)
                {
                }
                <b>catch</b> (<span class="i">NotSupportedException</span>)
                {
                }
                <b>catch</b> (<span class="i">InvalidOperationException</span>)
                {
                }
                <b>catch</b> (<span class="i n">System</span>.<span class="i">Xml</span>.<span class="i">XmlException</span>)
                {
                }
            }
 
            <span class="c">// If there are any wildcards, or any of the exported* are empty,</span>
            <span class="c">// we need to do static analysis.</span>
            <b>if</b> (!<span class="r231 r">importingModule</span>)
            {
                <b>bool</b> <span id="r374 rd" class="r374 r">usedWildcard</span> = <b>false</b>;
                <b>bool</b> <span id="r375 rd" class="r375 r">sawExportedFunctions</span> = <b>false</b>;
                <b>bool</b> <span id="r376 rd" class="r376 r">sawExportedCmdlets</span> = <b>false</b>;
                <b>bool</b> <span id="r377 rd" class="r377 r">sawExportedAliases</span> = <b>false</b>;
 
                <b>if</b> (<span class="r309 r">exportedFunctions</span> != <b>null</b>)
                {
                    <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
                    <b>if</b> (<span class="r309 r">exportedFunctions</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r378 rd" class="r378 r">p</span> <b>in</b> <span class="r309 r">exportedFunctions</span>)
                        {
                            <b>string</b> <span id="r379 rd" class="r379 r">name</span> = <span class="r378 r">p</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>;
                            <b>if</b> (!<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r379 r">name</span>))
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a>.<span class="i">Add</span>(<a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r379 r">name</span>, <span class="r239 r">defaultCommandPrefix</span>));
                            }
                            <b>else</b>
                            {
                                <span class="r374 r">usedWildcard</span> = <b>true</b>;
                            }
                        }
 
                        <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a>.<span class="i">Count</span> == 0)
                        {
                            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a> = <b>null</b>;
                        }
                    }
 
                    <span class="r375 r">sawExportedFunctions</span> = <b>true</b>;
                }
 
                <b>if</b> (<span class="r312 r">exportedCmdlets</span> != <b>null</b>)
                {
                    <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
                    <b>if</b> (<span class="r312 r">exportedCmdlets</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r380 rd" class="r380 r">p</span> <b>in</b> <span class="r312 r">exportedCmdlets</span>)
                        {
                            <b>string</b> <span id="r381 rd" class="r381 r">name</span> = <span class="r380 r">p</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>;
                            <b>if</b> (!<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r381 r">name</span>))
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a>.<span class="i">Add</span>(<a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r381 r">name</span>, <span class="r239 r">defaultCommandPrefix</span>));
                            }
                            <b>else</b>
                            {
                                <span class="r374 r">usedWildcard</span> = <b>true</b>;
                            }
                        }
 
                        <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a>.<span class="i">Count</span> == 0)
                        {
                            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a> = <b>null</b>;
                        }
                    }
 
                    <span class="r376 r">sawExportedCmdlets</span> = <b>true</b>;
                }
 
                <b>if</b> (<span class="r311 r">exportedAliases</span> != <b>null</b>)
                {
                    <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
                    <b>if</b> (<span class="r311 r">exportedAliases</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r382 rd" class="r382 r">p</span> <b>in</b> <span class="r311 r">exportedAliases</span>)
                        {
                            <b>string</b> <span id="r383 rd" class="r383 r">name</span> = <span class="r382 r">p</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>;
                            <b>if</b> (!<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r383 r">name</span>))
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a>.<span class="i">Add</span>(<a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r383 r">name</span>, <span class="r239 r">defaultCommandPrefix</span>));
                            }
                            <b>else</b>
                            {
                                <span class="r374 r">usedWildcard</span> = <b>true</b>;
                            }
                        }
 
                        <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a>.<span class="i">Count</span> == 0)
                        {
                            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a> = <b>null</b>;
                        }
                    }
 
                    <span class="r377 r">sawExportedAliases</span> = <b>true</b>;
                }
 
                <b>if</b> (<span class="r310 r">exportedVariables</span> != <b>null</b>)
                {
                    <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
                    <b>if</b> (<span class="r310 r">exportedVariables</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r384 rd" class="r384 r">p</span> <b>in</b> <span class="r310 r">exportedVariables</span>)
                        {
                            <b>string</b> <span id="r385 rd" class="r385 r">name</span> = <span class="r384 r">p</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>;
                            <b>if</b> (!<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r385 r">name</span>))
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a>.<span class="i">Add</span>(<span class="r385 r">name</span>);
                            }
                        }
 
                        <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a>.<span class="i">Count</span> == 0)
                        {
                            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a> = <b>null</b>;
                        }
                    }
                }
 
                <span class="c">// We have to further analyze the module if any wildcard characters are used.</span>
                <b>bool</b> <span id="r386 rd" class="r386 r">needToAnalyzeScriptModules</span> = <span class="r374 r">usedWildcard</span>;
 
                <span class="c">// We can skip further analysis if &#39;FunctionsToExport&#39;, &#39;CmdletsToExport&#39; and &#39;AliasesToExport&#39;</span>
                <span class="c">// are all declared and no wildcard character is used for them. But if any of &#39;FunctionsToExport&#39;,</span>
                <span class="c">// &#39;CmdletsToExport&#39; or &#39;AliasesToExport&#39; were not given, we must check to see if more analysis is needed.</span>
                <b>if</b> (!<span class="r386 r">needToAnalyzeScriptModules</span> &amp;&amp; (!<span class="r376 r">sawExportedCmdlets</span> || !<span class="r375 r">sawExportedFunctions</span> || !<span class="r377 r">sawExportedAliases</span>))
                {
                    <b>foreach</b> (<b>var</b> <span id="r387 rd" class="r387 r">nestedModule</span> <b>in</b> <span class="r293 r">nestedModules</span>)
                    {
                        <b>if</b> (<a href="AnalysisCache.cs.html#e469d7c6575d3464" class="t t">AnalysisCache</a>.<span class="i">ModuleAnalysisViaGetModuleRequired</span>(
                                <span class="r387 r">nestedModule</span>, <span class="r376 r">sawExportedCmdlets</span>, <span class="r375 r">sawExportedFunctions</span>, <span class="r377 r">sawExportedAliases</span>))
                        {
                            <span class="r386 r">needToAnalyzeScriptModules</span> = <b>true</b>;
                            <b>break</b>;
                        }
                    }
 
                    <b>if</b> (!<span class="r386 r">needToAnalyzeScriptModules</span>)
                    {
                        <span class="r386 r">needToAnalyzeScriptModules</span> = <a href="AnalysisCache.cs.html#e469d7c6575d3464" class="t t">AnalysisCache</a>.<a href="AnalysisCache.cs.html#11e4b6d6acdb0084" class="i method">ModuleAnalysisViaGetModuleRequired</a>(
                            <span class="r238 r">actualRootModule</span>, <span class="r376 r">sawExportedCmdlets</span>, <span class="r375 r">sawExportedFunctions</span>, <span class="r377 r">sawExportedAliases</span>);
                    }
                }
 
                <b>bool</b> <span id="r388 rd" class="r388 r">etwEnabled</span> = <a href="../CommandDiscovery.cs.html#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="../CommandDiscovery.cs.html#346fae28f2d8e441" class="i field">Log</a>.<span class="i">IsEnabled</span>();
                <b>if</b> (<span class="r388 r">etwEnabled</span>)
                {
                    <a href="../CommandDiscovery.cs.html#3c16c3656953a50c" class="t t">CommandDiscoveryEventSource</a>.<a href="../CommandDiscovery.cs.html#346fae28f2d8e441" class="i field">Log</a>.<span class="i">ModuleManifestAnalysisResult</span>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, !<span class="r386 r">needToAnalyzeScriptModules</span>);
                }
 
                <b>if</b> (!<span class="r386 r">needToAnalyzeScriptModules</span>)
                {
                    <span class="c">// Add nested modules to the manifestInfo when no more analysis needs to be done</span>
                    <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r389 rd" class="r389 r">fakeNestedModuleInfo</span> <b>in</b> <span class="i">CreateFakeModuleObject</span>(<span class="r293 r">nestedModules</span>))
                    {
                        <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#f6de469f9f30a6ec" class="i method">AddNestedModule</a>(<span class="r389 r">fakeNestedModuleInfo</span>);
                    }
 
                    <b>return</b> <span class="r360 r">manifestInfo</span>;
                }
            }
 
            <b>if</b> (<span class="r340 r">scriptsToProcess</span> != <b>null</b>)
            {
                <span class="i">Version</span> <span id="r390 rd" class="r390 r">savedBaseMinimumVersion</span> = <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>;
                <span class="i">Version</span> <span id="r391 rd" class="r391 r">savedBaseMaximumVersion</span> = <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>;
                <span class="i">Version</span> <span id="r392 rd" class="r392 r">savedBaseRequiredVersion</span> = <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>;
                <span class="i">Guid</span>? <span id="r393 rd" class="r393 r">savedBaseGuid</span> = <a href="#d3b88fd228891169" class="i property">BaseGuid</a>;
 
                <b>try</b>
                {
                    <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> = <b>null</b>;
                    <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <b>null</b>;
                    <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> = <b>null</b>;
                    <a href="#d3b88fd228891169" class="i property">BaseGuid</a> = <b>null</b>;
 
                    <b>foreach</b> (<b>string</b> <span id="r394 rd" class="r394 r">scriptFile</span> <b>in</b> <span class="r340 r">scriptsToProcess</span>)
                    {
                        <b>bool</b> <span id="r395 rd" class="r395 r">found</span> = <b>false</b>;
                        <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r396 rd" class="r396 r">module</span> = <span class="i">LoadModule</span>(<span class="r394 r">scriptFile</span>,
                            <span class="r233 r">moduleBase</span>,
                            <b>string</b>.<span class="i">Empty</span>, <span class="c">// prefix (-Prefix shouldn&#39;t be applied to dot sourced scripts)</span>
                            <b>null</b>,
                            <b>ref</b> <span class="r227 r">options</span>,
                            <span class="r222 r">manifestProcessingFlags</span>,
                            <b>out</b> <span class="r395 r">found</span>);
 
                        <span class="c">// If we&#39;re in analysis, add the detected exports to this module&#39;s</span>
                        <span class="c">// exports</span>
                        <b>if</b> (<span class="r395 r">found</span> &amp;&amp; (<span class="r359 r">ss</span> == <b>null</b>))
                        {
                            <b>foreach</b> (<b>string</b> <span id="r397 rd" class="r397 r">detectedCmdlet</span> <b>in</b> <span class="r396 r">module</span>.<a href="PSModuleInfo.cs.html#7afed1303b45c0b4" class="i property">ExportedCmdlets</a>.<span class="i">Keys</span>)
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#7b16924d44edf912" class="i method">AddDetectedCmdletExport</a>(<span class="r397 r">detectedCmdlet</span>);
                            }
 
                            <b>foreach</b> (<b>string</b> <span id="r398 rd" class="r398 r">detectedFunction</span> <b>in</b> <span class="r396 r">module</span>.<a href="PSModuleInfo.cs.html#2faddd301cf044c5" class="i property">ExportedFunctions</a>.<span class="i">Keys</span>)
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#da6b3bbed9e6a774" class="i method">AddDetectedFunctionExport</a>(<span class="r398 r">detectedFunction</span>);
                            }
 
                            <b>foreach</b> (<b>string</b> <span id="r399 rd" class="r399 r">detectedAlias</span> <b>in</b> <span class="r396 r">module</span>.<a href="PSModuleInfo.cs.html#992cd7d7155ed907" class="i property">ExportedAliases</a>.<span class="i">Keys</span>)
                            {
                                <span class="r360 r">manifestInfo</span>.<span class="i">AddDetectedAliasExport</span>(<span class="r399 r">detectedAlias</span>,
                                    <span class="r396 r">module</span>.<a href="PSModuleInfo.cs.html#992cd7d7155ed907" class="i property">ExportedAliases</a>[<span class="r399 r">detectedAlias</span>].<span class="i">Definition</span>);
                            }
                        }
                    }
                }
                <b>finally</b>
                {
                    <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> = <span class="r390 r">savedBaseMinimumVersion</span>;
                    <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <span class="r391 r">savedBaseMaximumVersion</span>;
                    <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> = <span class="r392 r">savedBaseRequiredVersion</span>;
                    <a href="#d3b88fd228891169" class="i property">BaseGuid</a> = <span class="r393 r">savedBaseGuid</span>;
                }
            }
 
            <span class="c">// Process nested modules</span>
 
            <span class="c">// If we have no session state and are loading a module, return an error</span>
            <b>if</b> ((<span class="r359 r">ss</span> == <b>null</b>) &amp;&amp; <span class="r231 r">importingModule</span>)
            {
                <span class="r228 r">containedErrors</span> = <b>true</b>;
                <b>if</b> (<span class="r232 r">writingErrors</span>)
                {
                    <b>string</b> <span id="r400 rd" class="r400 r">errorMessage</span> =
                        <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleManifestNestedModulesCantGoWithModuleToProcess</span>,
                            <span class="r218 r">moduleManifestPath</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r401 rd" class="r401 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                        <b>new</b> <span class="i">ArgumentException</span>(<span class="r400 r">errorMessage</span>),
                        <span class="s">&quot;Modules_BinaryModuleAndNestedModules&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                        <span class="r218 r">moduleManifestPath</span>);
                    <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r401 r">errorRecord</span>);
                }
            }
 
            <span class="c">// We have a session state, or are in module analysis</span>
 
            <span class="c">// Save the various base cmdlet parameters so that we can import</span>
            <span class="c">// all of the exported members from each nested module into this module...</span>
            <b>bool</b> <span id="r402 rd" class="r402 r">oldPassThru</span> = <a href="#da53dea574e86fa3" class="i property">BasePassThru</a>;
            <a href="#da53dea574e86fa3" class="i property">BasePassThru</a> = <b>false</b>;
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r403 rd" class="r403 r">oldVariablePatterns</span> = <a href="#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a>;
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r404 rd" class="r404 r">oldFunctionPatterns</span> = <a href="#e9585290a055b001" class="i property">BaseFunctionPatterns</a>;
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r405 rd" class="r405 r">oldAliasPatterns</span> = <a href="#6f55985943d4e435" class="i property">BaseAliasPatterns</a>;
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r406 rd" class="r406 r">oldCmdletPatterns</span> = <a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a>;
            <a href="#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a> = <a href="#e9585290a055b001" class="i property">BaseFunctionPatterns</a> = <a href="#6f55985943d4e435" class="i property">BaseAliasPatterns</a> = <a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a> = <a href="#3442415c65548b8f" class="i property">MatchAll</a>;
            <b>bool</b> <span id="r407 rd" class="r407 r">oldBaseDisableNameChecking</span> = <a href="#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a>;
            <a href="#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a> = <b>true</b>;
 
            <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r408 rd" class="r408 r">oldSessionState</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            <b>var</b> <span id="r409 rd" class="r409 r">exportedFunctionsContainsWildcards</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#e89055652ef36b54" class="i method">PatternContainsWildcard</a>(<span class="r309 r">exportedFunctions</span>);
            <b>try</b>
            {
                <b>if</b> (<span class="r231 r">importingModule</span>)
                {
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r359 r">ss</span> != <b>null</b>, <span class="s">&quot;ss should not be null&quot;</span>);
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a> != <b>null</b>, <span class="s">&quot;ss.Internal should not be null&quot;</span>);
                }
 
                <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
                {
                    <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#a2d08f2e57242ca4" class="i property">ManifestWithExplicitFunctionExport</a> = !<span class="r409 r">exportedFunctionsContainsWildcards</span>;
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>;
                }
 
                <span class="c">// Load all of the nested modules, which may have relative or absolute paths...</span>
 
                <span class="c">// For nested modules, we need to set importmoduleoptions to false as they should not use the options set for parent module</span>
                <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r410 rd" class="r410 r">nestedModuleOptions</span> = <b>new</b> <span class="t">ImportModuleOptions</span>();
 
                <span class="c">// If the nested manifest explicitly (no wildcards) specifies functions to be exported then allow all functions to be exported</span>
                <span class="c">// into the session state function table (regardless of language boundaries), because the manifest will filter them later to the</span>
                <span class="c">// specified function list.</span>
                <span class="r410 r">nestedModuleOptions</span>.<a href="#c4cfb75775763c63" class="i field">AllowNestedModuleFunctionsToExport</a> = ((<span class="r309 r">exportedFunctions</span> != <b>null</b>) &amp;&amp; !<span class="r409 r">exportedFunctionsContainsWildcards</span>);
 
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r411 rd" class="r411 r">nestedModuleSpecification</span> <b>in</b> <span class="r293 r">nestedModules</span>)
                {
                    <b>bool</b> <span id="r412 rd" class="r412 r">found</span> = <b>false</b>;
                    <span class="c">// Never load nested modules to the global scope.</span>
                    <b>bool</b> <span id="r413 rd" class="r413 r">oldGlobal</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#05a013615daefcfa" class="i property">BaseGlobal</a>;
                    <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#05a013615daefcfa" class="i property">BaseGlobal</a> = <b>false</b>;
 
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r414 rd" class="r414 r">nestedModule</span> = <span class="i">LoadModuleNamedInManifest</span>(
                            <span class="i">parentModule</span>: <span class="r360 r">manifestInfo</span>,
                            <span class="i">moduleSpecification</span>: <span class="r411 r">nestedModuleSpecification</span>,
                            <span class="i">moduleBase</span>: <span class="r233 r">moduleBase</span>,
                            <span class="i">searchModulePath</span>: <b>true</b>,
                            <span class="i">prefix</span>: <b>string</b>.<span class="i">Empty</span>,
                            <span class="i">ss</span>: <b>null</b>,
                            <span class="i">options</span>: <span class="r410 r">nestedModuleOptions</span>,
                            <span class="i">manifestProcessingFlags</span>: <span class="r222 r">manifestProcessingFlags</span>,
                            <span class="i">loadTypes</span>: <b>true</b>,
                            <span class="i">loadFormats</span>: <b>true</b>,
                            <span class="i">privateData</span>: <span class="r296 r">privateData</span>,
                            <span class="i">found</span>: <b>out</b> <span class="r412 r">found</span>,
                            <span class="i">shortModuleName</span>: <b>null</b>,
                            <span class="i">manifestLanguageMode</span>: ((<span class="r219 r">manifestScriptInfo</span> != <b>null</b>) ? <span class="r219 r">manifestScriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a>.<span class="i">GetValueOrDefault</span>() : (<a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>?)<b>null</b>));
 
                    <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#05a013615daefcfa" class="i property">BaseGlobal</a> = <span class="r413 r">oldGlobal</span>;
 
                    <span class="c">// If found, add it to the parent&#39;s list of NestedModules</span>
                    <b>if</b> (<span class="r412 r">found</span>)
                    {
                        <span class="c">// If we&#39;re in analysis, add the detected exports to this module&#39;s</span>
                        <span class="c">// exports</span>
                        <b>if</b> ((<span class="r359 r">ss</span> == <b>null</b>) &amp;&amp; (<span class="r414 r">nestedModule</span> != <b>null</b>))
                        {
                            <b>foreach</b> (<b>string</b> <span id="r415 rd" class="r415 r">detectedCmdlet</span> <b>in</b> <span class="r414 r">nestedModule</span>.<a href="PSModuleInfo.cs.html#7afed1303b45c0b4" class="i property">ExportedCmdlets</a>.<span class="i">Keys</span>)
                            {
                                <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#7b16924d44edf912" class="i method">AddDetectedCmdletExport</a>(<span class="r415 r">detectedCmdlet</span>);
                            }
 
                            <b>foreach</b> (<b>var</b> <span id="r416 rd" class="r416 r">detectedFunction</span> <b>in</b> <span class="r414 r">nestedModule</span>.<a href="PSModuleInfo.cs.html#2faddd301cf044c5" class="i property">ExportedFunctions</a>.<span class="i">Keys</span>)
                            {
                                <span class="r360 r">manifestInfo</span>.<span class="i">AddDetectedFunctionExport</span>(<span class="r416 r">detectedFunction</span>);
                            }
 
                            <b>foreach</b> (<b>string</b> <span id="r417 rd" class="r417 r">detectedAlias</span> <b>in</b> <span class="r414 r">nestedModule</span>.<a href="PSModuleInfo.cs.html#992cd7d7155ed907" class="i property">ExportedAliases</a>.<span class="i">Keys</span>)
                            {
                                <span class="r360 r">manifestInfo</span>.<span class="i">AddDetectedAliasExport</span>(<span class="r417 r">detectedAlias</span>,
                                    <span class="r414 r">nestedModule</span>.<a href="PSModuleInfo.cs.html#992cd7d7155ed907" class="i property">ExportedAliases</a>[<span class="r417 r">detectedAlias</span>].<span class="i">Definition</span>);
                            }
                        }
                        <span class="c">// If the NestedModules was a .ps1 script no module object would have been generated</span>
                        <span class="c">// so there&#39;s nothing to add, otherwise add it to the list.</span>
                        <span class="c">// When we are in analysis mode and we do not analyze the nested module (because the parent module has explicit exports), the nested modules do not get added to the list</span>
                        <b>if</b> (<span class="r414 r">nestedModule</span> != <b>null</b>)
                        {
                            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#f6de469f9f30a6ec" class="i method">AddNestedModule</a>(<span class="r414 r">nestedModule</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r228 r">containedErrors</span> = <b>true</b>;
                        <b>string</b> <span id="r418 rd" class="r418 r">errorMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ManifestMemberNotFound</span>,
                            <span class="r411 r">nestedModuleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="s">&quot;NestedModules&quot;</span>, <span class="r218 r">moduleManifestPath</span>);
                        <span class="i">FileNotFoundException</span> <span id="r419 rd" class="r419 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r418 r">errorMessage</span>);
                        <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r420 rd" class="r420 r">invalidOperation</span> = <b>new</b> <span class="t">PSInvalidOperationException</span>(
                            <span class="r418 r">errorMessage</span>, <span class="r419 r">fnf</span>, <span class="s">&quot;Modules_ModuleFileNotFound&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>,
                            <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r218 r">moduleManifestPath</span>));
                        <b>throw</b> <span class="r420 r">invalidOperation</span>;
                    }
                }
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="c">// Remove the types and format files</span>
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<span class="i">RemoveTypesAndFormatting</span>(<span class="r335 r">exportedFormatFiles</span>, <span class="r328 r">exportedTypeFiles</span>);
                <b>throw</b>;
            }
            <b>finally</b>
            {
                <span class="c">// Restore the old session state object...</span>
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r408 r">oldSessionState</span>;
 
                <span class="c">// Restore the various cmdlet parameters to what the user passed in...</span>
                <a href="#da53dea574e86fa3" class="i property">BasePassThru</a> = <span class="r402 r">oldPassThru</span>;
                <a href="#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a> = <span class="r403 r">oldVariablePatterns</span>;
                <a href="#e9585290a055b001" class="i property">BaseFunctionPatterns</a> = <span class="r404 r">oldFunctionPatterns</span>;
                <a href="#6f55985943d4e435" class="i property">BaseAliasPatterns</a> = <span class="r405 r">oldAliasPatterns</span>;
                <a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a> = <span class="r406 r">oldCmdletPatterns</span>;
                <a href="#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a> = <span class="r407 r">oldBaseDisableNameChecking</span>;
            }
 
            <span class="c">// Now see if the ModuleToProcess field was set. This radically</span>
            <span class="c">// changes how the exports are done.</span>
            <b>if</b> (<span class="r238 r">actualRootModule</span> != <b>null</b>)
            {
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r421 rd" class="r421 r">newManifestInfo</span>;
 
                <span class="c">// do not write out ModuleToProcess inside LoadModuleNamedInManifest</span>
                <span class="c">// - wait until all attributes have been taken from psd1 into PSModuleInfo/manifestInfo</span>
                <span class="c">// and then write out manifestInfo</span>
                <a href="#da53dea574e86fa3" class="i property">BasePassThru</a> = <b>false</b>;
 
                <span class="c">// do not import anything from &quot;ModuleToProcess&quot; at this time</span>
                <span class="c">// below we will call ImportModuleMembers(manifestInfo) after all nested modules have been processed</span>
                <a href="#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <a href="#e9585290a055b001" class="i property">BaseFunctionPatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <a href="#6f55985943d4e435" class="i property">BaseAliasPatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
 
                <b>try</b>
                {
                    <b>bool</b> <span id="r422 rd" class="r422 r">found</span>;
                    <span class="r421 r">newManifestInfo</span> = <span class="i">LoadModuleNamedInManifest</span>(
                        <span class="i">parentModule</span>: <b>null</b>,
                        <span class="i">moduleSpecification</span>: <b>new</b> <a href="ModuleSpecification.cs.html#8bf2c91f2abc8759" class="t constructor">ModuleSpecification</a>(<span class="r238 r">actualRootModule</span>),
                        <span class="i">moduleBase</span>: <span class="r233 r">moduleBase</span>,
                        <span class="i">searchModulePath</span>: <b>false</b>,
                        <span class="i">prefix</span>: <span class="r240 r">resolvedCommandPrefix</span>,
                        <span class="i">ss</span>: <span class="r359 r">ss</span>,
                        <span class="i">options</span>: <span class="r227 r">options</span>,
                        <span class="i">manifestProcessingFlags</span>: <span class="r222 r">manifestProcessingFlags</span>,
                        <span class="i">loadTypes</span>: (<span class="r328 r">exportedTypeFiles</span> == <b>null</b> || <span class="r328 r">exportedTypeFiles</span>.<span class="i">Count</span> == 0),        <span class="c">// If types files already loaded, don&#39;t load snapin files</span>
                        <span class="i">loadFormats</span>: (<span class="r335 r">exportedFormatFiles</span> == <b>null</b> || <span class="r335 r">exportedFormatFiles</span>.<span class="i">Count</span> == 0),   <span class="c">// if format files already loaded, don&#39;t load snapin files</span>
                        <span class="i">privateData</span>: <span class="r296 r">privateData</span>,
                        <span class="i">found</span>: <b>out</b> <span class="r422 r">found</span>,
                        <span class="i">shortModuleName</span>: <b>null</b>,
                        <span class="i">manifestLanguageMode</span>: ((<span class="r219 r">manifestScriptInfo</span> != <b>null</b>) ? <span class="r219 r">manifestScriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a>.<span class="i">GetValueOrDefault</span>() : (<a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>?)<b>null</b>));
 
                    <b>if</b> (!<span class="r422 r">found</span> || (<span class="r421 r">newManifestInfo</span> == <b>null</b>))
                    {
                        <span class="r228 r">containedErrors</span> = <b>true</b>;
                        <b>string</b> <span id="r423 rd" class="r423 r">errorMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ManifestMemberNotFound</span>, <span class="r238 r">actualRootModule</span>,
                            <span class="s">&quot;ModuleToProcess/RootModule&quot;</span>, <span class="r218 r">moduleManifestPath</span>);
                        <span class="i">FileNotFoundException</span> <span id="r424 rd" class="r424 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r423 r">errorMessage</span>);
                        <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r425 rd" class="r425 r">invalidOperation</span> = <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="r423 r">errorMessage</span>, <span class="r424 r">fnf</span>,
                            <span class="s">&quot;Modules_ModuleFileNotFound&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>,
                            <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r218 r">moduleManifestPath</span>));
                        <b>throw</b> <span class="r425 r">invalidOperation</span>;
                    }
 
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r426 rd" class="r426 r">errorRecord</span> = <a href="#7a17ec1abb9ad6a0" class="i method">GetErrorRecordIfUnsupportedRootCdxmlAndNestedModuleScenario</a>(<span class="r220 r">data</span>,
                        <span class="r218 r">moduleManifestPath</span>, <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                    <b>if</b> (<span class="r426 r">errorRecord</span> != <b>null</b>)
                    {
                        <span class="r228 r">containedErrors</span> = <b>true</b>;
                        <a href="#452f85accd76669f" class="i method">RemoveModule</a>(<span class="r421 r">newManifestInfo</span>);
                        <a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r427 rd" class="r427 r">invalidOperation</span> =
                            <b>new</b> <span class="t">PSInvalidOperationException</span>(<span class="r426 r">errorRecord</span>.<a href="../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>.<span class="i">Message</span>, <span class="r426 r">errorRecord</span>.<a href="../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>,
                                <span class="r426 r">errorRecord</span>.<a href="../ErrorPackage.cs.html#80d40f16f77d32bb" class="i property">FullyQualifiedErrorId</a>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r218 r">moduleManifestPath</span>);
                        <b>throw</b> <span class="r427 r">invalidOperation</span>;
                    }
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                    <span class="c">// Remove the types and format files</span>
                    <a href="#0479f5f00c7dafc1" class="k">this</a>.<span class="i">RemoveTypesAndFormatting</span>(<span class="r335 r">exportedFormatFiles</span>, <span class="r328 r">exportedTypeFiles</span>);
                    <b>throw</b>;
                }
                <b>finally</b>
                {
                    <span class="c">// Restore the various cmdlet parameters to what the user passed in...</span>
                    <a href="#da53dea574e86fa3" class="i property">BasePassThru</a> = <span class="r402 r">oldPassThru</span>;
                    <a href="#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a> = <span class="r403 r">oldVariablePatterns</span>;
                    <a href="#e9585290a055b001" class="i property">BaseFunctionPatterns</a> = <span class="r404 r">oldFunctionPatterns</span>;
                    <a href="#6f55985943d4e435" class="i property">BaseAliasPatterns</a> = <span class="r405 r">oldAliasPatterns</span>;
                    <a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a> = <span class="r406 r">oldCmdletPatterns</span>;
                }
 
                <span class="c">// For most cases, &#39;newManifestInfo.SessionState&#39; should be identical to &#39;ss&#39;:</span>
                <span class="c">//  1. when &#39;importingModule == true&#39;, &#39;newManifestInfo&#39; uses the same session state as &#39;ss&#39; because we passed in &#39;ss&#39; when loading the RootModule via &#39;LoadModuleNamedInManifest&#39;.</span>
                <span class="c">//  2. when &#39;importingModule == false&#39;, both session states will be null since we are in module analysis mode (Get-Module -ListAvailable).</span>
                <span class="c">//</span>
                <span class="c">// However, there is one exception when the RootModule is also put in NestedModules in the module manifest (ill-organized module structure).</span>
                <span class="c">// For example, module folder &#39;test&#39; contains two files: &#39;test.psd1&#39; and &#39;test.psm1&#39;, and &#39;test.psd1&#39; has the following content:</span>
                <span class="c">//     &quot;@{ ModuleVersion = &#39;0.0.1&#39;; RootModule = &#39;test&#39;; NestedModules = @(&#39;test&#39;) }&quot;</span>
                <span class="c">//</span>
                <span class="c">// In that case, the nested module will first be loaded with a different session state, and then when trying to load the RootModule via &#39;LoadModuleNamedInManifest&#39;,</span>
                <span class="c">// the same loaded nested module will be reused for the RootModule by &#39;LoadModuleNamedInManifest&#39;.</span>
 
                <span class="c">// Change the module name to match the manifest name, not the original name.</span>
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#5e647bf2ada83d76" class="i method">SetName</a>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
 
                <span class="c">// Copy in any nested modules...</span>
                <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r428 rd" class="r428 r">nm</span> <b>in</b> <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#f6de469f9f30a6ec" class="i method">AddNestedModule</a>(<span class="r428 r">nm</span>);
                }
 
                <span class="c">// Copy the required modules...</span>
                <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r429 rd" class="r429 r">rm</span> <b>in</b> <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#dc1c7049a4d6e347" class="i property">RequiredModules</a>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#57a95e451ee3143b" class="i method">AddRequiredModule</a>(<span class="r429 r">rm</span>);
                }
 
                <span class="c">// Copy in the version number - this over-write anything extracted</span>
                <span class="c">// from the dll in the case of a binary module</span>
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#86de19074268f803" class="i method">SetVersion</a>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>);
 
                <span class="c">// Set the various bits of metadata from the manifest</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#9b617cc3f69baa1e" class="i property">Description</a>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#9b617cc3f69baa1e" class="i property">Description</a> = <span class="r344 r">description</span>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>.<span class="i">Equals</span>(<b>new</b> <span class="i">Version</span>(0, 0)))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#86de19074268f803" class="i method">SetVersion</a>(<span class="r250 r">moduleVersion</span>);
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#474060a313707f03" class="i property">Guid</a>.<span class="i">Equals</span>(<span class="i">Guid</span>.<span class="i">Empty</span>) &amp;&amp; (<span class="r249 r">manifestGuid</span> != <b>null</b>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#4b6e2a1b9b5b92c2" class="i method">SetGuid</a>((<span class="i">Guid</span>)<span class="r249 r">manifestGuid</span>);
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#31f7e13110eb6db0" class="i property">HelpInfoUri</a> == <b>null</b> &amp;&amp; (<span class="r282 r">helpInfoUri</span> != <b>null</b>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#c345165f675110e2" class="i method">SetHelpInfoUri</a>(<span class="r282 r">helpInfoUri</span>);
                }
 
                <b>if</b> (<span class="r285 r">requiredModules</span> != <b>null</b>)
                {
                    <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r430 rd" class="r430 r">moduleSpecification</span> <b>in</b> <span class="r285 r">requiredModules</span>)
                    {
                        <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#ae1ef9e0dfb6b521" class="i method">AddRequiredModuleSpecification</a>(<span class="r430 r">moduleSpecification</span>);
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a>;
                }
                <span class="c">// If may be the case that a script has already set the PrivateData field in the module</span>
                <span class="c">// info object, in which case we won&#39;t overwrite it.</span>
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#964f6cf27d5eeb00" class="i property">PrivateData</a> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#964f6cf27d5eeb00" class="i property">PrivateData</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#964f6cf27d5eeb00" class="i property">PrivateData</a>;
                }
 
                <span class="c">// Assign the PowerShellGet related properties from the module manifest</span>
                <b>foreach</b> (<b>var</b> <span id="r431 rd" class="r431 r">tag</span> <b>in</b> <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#ad3c3cb073f101e1" class="i property">Tags</a>)
                {
                    <span class="r421 r">newManifestInfo</span>.<span class="i">AddToTags</span>(<span class="r431 r">tag</span>);
                }
 
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#bfe7a113afff1c03" class="i property">ReleaseNotes</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#bfe7a113afff1c03" class="i property">ReleaseNotes</a>;
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#747adfc27ee44685" class="i property">ProjectUri</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#747adfc27ee44685" class="i property">ProjectUri</a>;
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#bcf842e072eb8f87" class="i property">LicenseUri</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#bcf842e072eb8f87" class="i property">LicenseUri</a>;
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#f7b5f1b9a36523eb" class="i property">IconUri</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#f7b5f1b9a36523eb" class="i property">IconUri</a>;
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#b0cc1fefc6f988f8" class="i property">RepositorySourceLocation</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#b0cc1fefc6f988f8" class="i property">RepositorySourceLocation</a>;
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#49109b84a960dd4e" class="i property">IsConsideredEditionCompatible</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#49109b84a960dd4e" class="i property">IsConsideredEditionCompatible</a>;
 
                <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#b2a843972231de0a" class="i property">ExperimentalFeatures</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#b2a843972231de0a" class="i property">ExperimentalFeatures</a>;
 
                <span class="c">// If we are in module discovery, then fix the path.</span>
                <b>if</b> (<span class="r359 r">ss</span> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>;
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#5575df040d9e83ad" class="i property">Author</a>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#5575df040d9e83ad" class="i property">Author</a> = <span class="r246 r">author</span>;
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#5712d91db996f4b9" class="i property">CompanyName</a>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#5712d91db996f4b9" class="i property">CompanyName</a> = <span class="r247 r">companyName</span>;
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#f874db839f072c87" class="i property">Copyright</a>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#f874db839f072c87" class="i property">Copyright</a> = <span class="r248 r">copyright</span>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#6d8cd807d9d4d3ed" class="i property">PowerShellVersion</a> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#6d8cd807d9d4d3ed" class="i property">PowerShellVersion</a> = <span class="r263 r">powerShellVersion</span>;
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#4225b887eec850c2" class="i property">PowerShellHostName</a>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#4225b887eec850c2" class="i property">PowerShellHostName</a> = <span class="r267 r">requestedHostName</span>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#8461cce8296d3118" class="i property">PowerShellHostVersion</a> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#8461cce8296d3118" class="i property">PowerShellHostVersion</a> = <span class="r271 r">requestedHostVersion</span>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#b02be56548e4c3c7" class="i property">DotNetFrameworkVersion</a> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#b02be56548e4c3c7" class="i property">DotNetFrameworkVersion</a> = <span class="r281 r">requestedDotNetFrameworkVersion</span>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#9102cf9f060d4060" class="i property">ClrVersion</a> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#9102cf9f060d4060" class="i property">ClrVersion</a> = <span class="r280 r">requestedClrVersion</span>;
                }
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#50046b8fca919b99" class="i property">Prefix</a>))
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#50046b8fca919b99" class="i property">Prefix</a> = <span class="r240 r">resolvedCommandPrefix</span>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#381d211036760344" class="i property">FileList</a> == <b>null</b> || !<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#381d211036760344" class="i property">FileList</a>.<span class="i">Any</span>())
                {
                    <b>if</b> (<span class="r345 r">fileList</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<b>var</b> <span id="r432 rd" class="r432 r">f</span> <b>in</b> <span class="r345 r">fileList</span>)
                        {
                            <span class="r421 r">newManifestInfo</span>.<span class="i">AddToFileList</span>(<span class="r432 r">f</span>);
                        }
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#06a6accd9696335e" class="i property">ModuleList</a> == <b>null</b> || !<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#06a6accd9696335e" class="i property">ModuleList</a>.<span class="i">Any</span>())
                {
                    <b>if</b> (<span class="r346 r">moduleList</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="k">var</a> <span id="r433 rd" class="r433 r">m</span> <b>in</b> <span class="r346 r">moduleList</span>)
                        {
                            <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#8c37262071a4bb09" class="i method">AddToModuleList</a>(<span class="r433 r">m</span>);
                        }
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#b7497b7e6a83b314" class="i property">CompatiblePSEditions</a> == <b>null</b> || !<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#b7497b7e6a83b314" class="i property">CompatiblePSEditions</a>.<span class="i">Any</span>())
                {
                    <b>if</b> (<span class="r347 r">compatiblePSEditions</span> != <b>null</b>)
                    {
                        <span class="r421 r">newManifestInfo</span>.<span class="i">AddToCompatiblePSEditions</span>(<span class="r347 r">compatiblePSEditions</span>);
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#72fb99b54c9a7f07" class="i property">ProcessorArchitecture</a> == <span class="i">ProcessorArchitecture</span>.<span class="i">None</span>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#72fb99b54c9a7f07" class="i property">ProcessorArchitecture</a> = <span class="r276 r">requiredProcessorArchitecture</span>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#85c90ea22293c8e2" class="i property">RequiredAssemblies</a> == <b>null</b> || !<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#85c90ea22293c8e2" class="i property">RequiredAssemblies</a>.<span class="i">Any</span>())
                {
                    <b>if</b> (<span class="r317 r">assemblyList</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<b>var</b> <span id="r434 rd" class="r434 r">a</span> <b>in</b> <span class="r317 r">assemblyList</span>)
                        {
                            <span class="r421 r">newManifestInfo</span>.<span class="i">AddRequiredAssembly</span>(<span class="r434 r">a</span>);
                        }
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#43c076cc90190d20" class="i property">Scripts</a> == <b>null</b> || !<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#43c076cc90190d20" class="i property">Scripts</a>.<span class="i">Any</span>())
                {
                    <b>if</b> (<span class="r340 r">scriptsToProcess</span> != <b>null</b>)
                    {
                        <b>foreach</b> (<b>var</b> <span id="r435 rd" class="r435 r">s</span> <b>in</b> <span class="r340 r">scriptsToProcess</span>)
                        {
                            <span class="r421 r">newManifestInfo</span>.<span class="i">AddScript</span>(<span class="r435 r">s</span>);
                        }
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a> == <b>null</b>)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#47b6cc5327f1b053" class="i property">RootModuleForManifest</a>;
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a> == <b>null</b> || <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a>.<span class="i">Count</span> == 0)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a>;
                }
 
                <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#ce6f9af141ce43ab" class="i field">DetectedCmdletExports</a> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r436 rd" class="r436 r">detectedExport</span> <b>in</b> <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#ce6f9af141ce43ab" class="i field">DetectedCmdletExports</a>)
                    {
                        <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#7b16924d44edf912" class="i method">AddDetectedCmdletExport</a>(<span class="r436 r">detectedExport</span>);
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a> == <b>null</b> ||
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a>.<span class="i">Count</span> == 0)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a>;
                }
 
                <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#65d67455dc852b54" class="i field">DetectedFunctionExports</a> != <b>null</b>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r437 rd" class="r437 r">detectedExport</span> <b>in</b> <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#65d67455dc852b54" class="i field">DetectedFunctionExports</a>)
                    {
                        <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#da6b3bbed9e6a774" class="i method">AddDetectedFunctionExport</a>(<span class="r437 r">detectedExport</span>);
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a> == <b>null</b> || <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a>.<span class="i">Count</span> == 0)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a>;
                }
 
                <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#a3ce3f0c83627aa9" class="i field">DetectedAliasExports</a> != <b>null</b>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r438 rd" class="r438 r">pair</span> <b>in</b> <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#a3ce3f0c83627aa9" class="i field">DetectedAliasExports</a>)
                    {
                        <span class="r421 r">newManifestInfo</span>.<span class="i">AddDetectedAliasExport</span>(<span class="r438 r">pair</span>.<span class="i">Key</span>, <span class="r438 r">pair</span>.<span class="i">Value</span>);
                    }
                }
 
                <b>if</b> (<span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a> == <b>null</b> ||
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a>.<span class="i">Count</span> == 0)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a> = <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a>;
                }
 
                <span class="c">// If there are types/formats entries in the ModuleToProcess use them</span>
                <span class="c">// only if there are no entries from the manifest. The manifest entries</span>
                <span class="c">// completely override the module&#39;s entries.</span>
                <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#8e94a27c925a8382" class="i property">ExportedTypeFiles</a>.<span class="i">Count</span> &gt; 0)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#87f1728ba7490f93" class="i method">SetExportedTypeFiles</a>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#8e94a27c925a8382" class="i property">ExportedTypeFiles</a>);
                }
 
                <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#9255531221898da3" class="i property">ExportedFormatFiles</a>.<span class="i">Count</span> &gt; 0)
                {
                    <span class="r421 r">newManifestInfo</span>.<a href="PSModuleInfo.cs.html#1d33b07765cb3293" class="i method">SetExportedFormatFiles</a>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#9255531221898da3" class="i property">ExportedFormatFiles</a>);
                }
 
                <span class="c">// And switch to using the new manifest info</span>
                <span class="r360 r">manifestInfo</span> = <span class="r421 r">newManifestInfo</span>;
 
                <span class="c">// mark the binary module exports...</span>
                <b>if</b> (<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> == <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#1c66a8819a72670d" class="i field">Binary</a>)
                {
                    <b>if</b> ((<span class="r312 r">exportedCmdlets</span> != <b>null</b>) &amp;&amp; (<span class="r359 r">ss</span> != <b>null</b>))
                    {
                        <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#7afed1303b45c0b4" class="i property">ExportedCmdlets</a>.<span class="i">Clear</span>();
 
                        <span class="c">// Mark stuff for export</span>
                        <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
                        {
                            <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#dbd0e3667f34bf41" class="i method">ExportModuleMembers</a>(
                                <a href="#0479f5f00c7dafc1" class="k">this</a>,
                                <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                                <span class="r309 r">exportedFunctions</span>,
                                <span class="r312 r">exportedCmdlets</span>,
                                <span class="r311 r">exportedAliases</span>,
                                <span class="r310 r">exportedVariables</span>,
                                <span class="r439 r">doNotExportCmdlets</span>: <b>null</b>);
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="c">// If the script didn&#39;t call Export-ModuleMember explicitly, then</span>
                    <span class="c">// implicitly export functions and cmdlets.</span>
                    <b>if</b> ((<span class="r359 r">ss</span> != <b>null</b>) &amp;&amp; (!<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#776ca0b7a2795e58" class="i property">UseExportList</a>))
                    {
                        <span class="c">// For cross language boundaries, implicitly import all functions only if</span>
                        <span class="c">// this manifest *does* exort functions explicitly.</span>
                        <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r440 rd" class="r440 r">fnMatchPattern</span> = (
                                                                (<span class="r219 r">manifestScriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a> == <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>) &amp;&amp;
                                                                (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> != <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>) &amp;&amp;
                                                                (<span class="r309 r">exportedFunctions</span> == <b>null</b>)
                                                                ) ? <b>null</b> : <a href="#3442415c65548b8f" class="i property">MatchAll</a>;
 
                        <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#dbd0e3667f34bf41" class="i method">ExportModuleMembers</a>(<span class="r441 r">cmdlet</span>: <a href="#0479f5f00c7dafc1" class="k">this</a>,
                                                             <span class="r442 r">sessionState</span>: <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                                                             <span class="r443 r">functionPatterns</span>: <span class="r440 r">fnMatchPattern</span>,
                                                             <span class="r444 r">cmdletPatterns</span>: <a href="#3442415c65548b8f" class="i property">MatchAll</a>,
                                                             <span class="r445 r">aliasPatterns</span>: <b>null</b>,
                                                             <span class="r446 r">variablePatterns</span>: <b>null</b>,
                                                             <span class="r439 r">doNotExportCmdlets</span>: <b>null</b>);
                    }
 
                    <span class="c">// Export* fields in .psd1 subset Export-ModuleMember calls from ModuleToProcess=psm1</span>
                    <b>if</b> (<span class="r309 r">exportedFunctions</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
                        {
                            <span class="c">// If module (psm1) functions were not exported because of cross language boundary restrictions,</span>
                            <span class="c">// then implicitly export them here so that they can be filtered by the exportedFunctions list.</span>
                            <span class="c">// Unless exportedFunctions contains the wildcard character that isn&#39;t allowed across language</span>
                            <span class="c">// boundaries.</span>
                            <b>if</b> (!<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#0bfdd00a11d1bfe4" class="i property">FunctionsExported</a> &amp;&amp; !<span class="r409 r">exportedFunctionsContainsWildcards</span>)
                            {
                                <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#dbd0e3667f34bf41" class="i method">ExportModuleMembers</a>(
                                    <span class="r441 r">cmdlet</span>: <a href="#0479f5f00c7dafc1" class="k">this</a>,
                                    <span class="r442 r">sessionState</span>: <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                                    <span class="r443 r">functionPatterns</span>: <a href="#3442415c65548b8f" class="i property">MatchAll</a>,
                                    <span class="r444 r">cmdletPatterns</span>: <b>null</b>,
                                    <span class="r445 r">aliasPatterns</span>: <b>null</b>,
                                    <span class="r446 r">variablePatterns</span>: <b>null</b>,
                                    <span class="r439 r">doNotExportCmdlets</span>: <b>null</b>);
                            }
 
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#1d2490e3ba3a324b" class="i property">ExportedFunctions</a> != <b>null</b>,
                                <span class="s">&quot;ss.Internal.ExportedFunctions should not be null&quot;</span>);
 
                            <span class="c">// Update the exports to only contain things that are also in the manifest export list</span>
                            <a href="#159993f0c45917c8" class="i method">UpdateCommandCollection</a>&lt;<a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a>&gt;(<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#1d2490e3ba3a324b" class="i property">ExportedFunctions</a>, <span class="r309 r">exportedFunctions</span>);
                        }
                        <b>else</b>
                        {
                            <a href="#75b8fdf0f3674db2" class="i method">UpdateCommandCollection</a>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a>, <span class="r309 r">exportedFunctions</span>);
                        }
                    }
 
                    <b>if</b> (<span class="r312 r">exportedCmdlets</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
                        {
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionState.cs.html#51f4f7bc9645d49d" class="i property">ExportedCmdlets</a> != <b>null</b>,
                                <span class="s">&quot;ss.Internal.ExportedCmdlets should not be null&quot;</span>);
 
                            <span class="c">// Update the exports to only contain things that are also in the manifest export list</span>
                            <a href="#159993f0c45917c8" class="i method">UpdateCommandCollection</a>&lt;<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt;(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>, <span class="r312 r">exportedCmdlets</span>);
                        }
                        <b>else</b>
                        {
                            <a href="#75b8fdf0f3674db2" class="i method">UpdateCommandCollection</a>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a>, <span class="r312 r">exportedCmdlets</span>);
                        }
                    }
 
                    <b>if</b> (<span class="r311 r">exportedAliases</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
                        {
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateAliasAPIs.cs.html#c15aa2530ddf93b0" class="i property">ExportedAliases</a> != <b>null</b>,
                                <span class="s">&quot;ss.Internal.ExportedAliases should not be null&quot;</span>);
 
                            <span class="c">// Update the exports to only contain things that are also in the manifest export list</span>
                            <a href="#159993f0c45917c8" class="i method">UpdateCommandCollection</a>&lt;<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a>&gt;(<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateAliasAPIs.cs.html#c15aa2530ddf93b0" class="i property">ExportedAliases</a>, <span class="r311 r">exportedAliases</span>);
                        }
                        <b>else</b>
                        {
                            <a href="#75b8fdf0f3674db2" class="i method">UpdateCommandCollection</a>(<span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a>, <span class="r311 r">exportedAliases</span>);
                        }
                    }
 
                    <b>if</b> (<span class="r310 r">exportedVariables</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
                        {
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateVariableAPIs.cs.html#2410b52a592096c8" class="i property">ExportedVariables</a> != <b>null</b>,
                                       <span class="s">&quot;ss.Internal.ExportedVariables should not be null&quot;</span>);
 
                            <span class="c">// Update the exports to only contain things that are also in the manifest export list</span>
                            <span class="i">List</span>&lt;<a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a>&gt; <span id="r447 rd" class="r447 r">updated</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a>&gt;();
                            <b>foreach</b> (<a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r448 rd" class="r448 r">element</span> <b>in</b> <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateVariableAPIs.cs.html#2410b52a592096c8" class="i property">ExportedVariables</a>)
                            {
                                <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(
                                        <span class="r448 r">element</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>,
                                        <span class="r310 r">exportedVariables</span>,
                                        <span class="i">defaultValue</span>: <b>false</b>))
                                {
                                    <span class="r447 r">updated</span>.<span class="i">Add</span>(<span class="r448 r">element</span>);
                                }
                            }
 
                            <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateVariableAPIs.cs.html#2410b52a592096c8" class="i property">ExportedVariables</a>.<span class="i">Clear</span>();
                            <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateVariableAPIs.cs.html#2410b52a592096c8" class="i property">ExportedVariables</a>.<span class="i">AddRange</span>(<span class="r447 r">updated</span>);
                        }
                    }
                }
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r359 r">ss</span> != <b>null</b>)
                {
                    <span class="c">// In the case where there are only nested modules,</span>
                    <span class="c">// the members of the manifest are canonical...</span>
                    <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#dbd0e3667f34bf41" class="i method">ExportModuleMembers</a>(
                        <a href="#0479f5f00c7dafc1" class="k">this</a>,
                        <span class="r442 r">sessionState</span>: <span class="r359 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                        <span class="r443 r">functionPatterns</span>: <span class="r309 r">exportedFunctions</span>,
                        <span class="r444 r">cmdletPatterns</span>: <span class="r312 r">exportedCmdlets</span>,
                        <span class="r445 r">aliasPatterns</span>: <span class="r311 r">exportedAliases</span>,
                        <span class="r446 r">variablePatterns</span>: <span class="r310 r">exportedVariables</span>,
                        <span class="r439 r">doNotExportCmdlets</span>: <b>null</b>);
                }
            }
 
            <a href="#b3400690c9457e4e" class="i method">PropagateExportedTypesFromNestedModulesToRootModuleScope</a>(<span class="r227 r">options</span>, <span class="r360 r">manifestInfo</span>);
            <a href="#ffe82b2425f2ed0c" class="i method">SetDeclaredDscResources</a>(<span class="r313 r">exportedDscResources</span>, <span class="r360 r">manifestInfo</span>);
 
            <span class="c">// And import the members from this module into the callers context...</span>
            <b>if</b> (<span class="r231 r">importingModule</span>)
            {
                <a href="#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r360 r">manifestInfo</span>, <span class="r240 r">resolvedCommandPrefix</span>, <span class="r227 r">options</span>);
            }
 
            <span class="r360 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a> = (<span class="r219 r">manifestScriptInfo</span> != <b>null</b>) ? <span class="r219 r">manifestScriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a> : (<a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>?)<b>null</b>;
 
            <b>return</b> <span class="r360 r">manifestInfo</span>;
        }
 
        <b>private static void</b> <a id="b3400690c9457e4e" href="../../R/b3400690c9457e4e.html" target="n" data-glyph="76,1" class="i method">PropagateExportedTypesFromNestedModulesToRootModuleScope</a>(<a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r449 rd" class="r449 r">options</span>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r450 rd" class="r450 r">manifestInfo</span>)
        {
            <b>if</b> (<span class="r450 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r450 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> == <b>null</b>)
            {
                <span class="c">// i.e. Get-Module -ListAvailable, there is no state.</span>
                <b>return</b>;
            }
 
            <a href="../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r451 rd" class="r451 r">scope</span> = <span class="r449 r">options</span>.<a href="#7faee609282d78c3" class="i field">Local</a>
                        ? <span class="r450 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>
                        : <span class="r450 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>;
 
            <span class="c">// The last one name wins! It&#39;s the same for command names in nested modules.</span>
            <span class="c">// For rootModule C with Two nested modules (A, B) the order is: A, B, C</span>
            <span class="c">// We re-adding rootModule types to the scope again to override any possible name collision.</span>
            <b>var</b> <span id="r452 rd" class="r452 r">modulesToProcess</span> = <span class="r450 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>.<span class="i">ToList</span>();
            <span class="r452 r">modulesToProcess</span>.<span class="i">Add</span>(<span class="r450 r">manifestInfo</span>);
 
            <b>foreach</b> (<b>var</b> <span id="r453 rd" class="r453 r">nestedModule</span> <b>in</b> <span class="r452 r">modulesToProcess</span>)
            {
                <b>if</b> (<span class="r453 r">nestedModule</span> != <b>null</b>)
                {
                    <b>var</b> <span id="r454 rd" class="r454 r">exportedTypes</span> = <span class="r453 r">nestedModule</span>.<span class="i">GetExportedTypeDefinitions</span>();
                    <b>if</b> (<span class="r454 r">exportedTypes</span> != <b>null</b> &amp;&amp; <span class="r454 r">exportedTypes</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <b>foreach</b> (<b>var</b> <span id="r455 rd" class="r455 r">t</span> <b>in</b> <span class="r454 r">exportedTypes</span>)
                        {
                            <span class="r451 r">scope</span>.<span class="i">AddType</span>(<span class="r455 r">t</span>.<span class="i">Key</span>, <span class="r455 r">t</span>.<span class="i">Value</span>.<span class="i">Type</span>);
                        }
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="ffe82b2425f2ed0c" href="../../R/ffe82b2425f2ed0c.html" target="n" data-glyph="76,1" class="i method">SetDeclaredDscResources</a>(<span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r456 rd" class="r456 r">exportedDscResources</span>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r457 rd" class="r457 r">manifestInfo</span>)
        {
            <b>if</b> (<span class="r456 r">exportedDscResources</span> != <b>null</b>)
            {
                <span class="r457 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
 
                <b>if</b> (<span class="r456 r">exportedDscResources</span>.<span class="i">Count</span> &gt; 0)
                {
                    <b>foreach</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r458 rd" class="r458 r">p</span> <b>in</b> <span class="r456 r">exportedDscResources</span>)
                    {
                        <b>string</b> <span id="r459 rd" class="r459 r">name</span> = <span class="r458 r">p</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>;
                        <b>if</b> (!<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r459 r">name</span>))
                        {
                            <span class="r457 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a>.<span class="i">Add</span>(<span class="r459 r">name</span>);
                        }
                    }
                }
            }
 
            <span class="c">// if it is empty it means there is a wildcard pattern</span>
            <b>if</b> (<span class="r457 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a> != <b>null</b> &amp;&amp; <span class="r457 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a>.<span class="i">Count</span> == 0)
            {
                <b>var</b> <span id="r460 rd" class="r460 r">exportedTypes</span> = <span class="r457 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#7d3f55f45bfcc4cc" class="i method">GetExportedTypeDefinitions</a>();
                <b>var</b> <span id="r461 rd" class="r461 r">exportedClassDscResources</span> = <span class="r460 r">exportedTypes</span>.<span class="i">Values</span>.<span class="i">Where</span>(<span id="r462 rd" class="r462 r">typeAst</span> =&gt;
                {
                    <b>for</b> (<b>int</b> <span id="r463 rd" class="r463 r">i</span> = 0; <span class="r463 r">i</span> &lt; <span class="r462 r">typeAst</span>.<span class="i">Attributes</span>.<span class="i">Count</span>; <span class="r463 r">i</span>++)
                    {
                        <b>var</b> <span id="r464 rd" class="r464 r">a</span> = <span class="r462 r">typeAst</span>.<span class="i">Attributes</span>[<span class="r463 r">i</span>];
                        <b>if</b> (<span class="r464 r">a</span>.<span class="i">TypeName</span>.<span class="i">GetReflectionAttributeType</span>() == <b>typeof</b>(<a href="../Attributes.cs.html#07160ce4e78c3181" class="t t">DscResourceAttribute</a>))
                        {
                            <b>return</b> <b>true</b>;
                        }
                    }
 
                    <b>return</b> <b>false</b>;
                });
                <b>foreach</b> (<b>var</b> <span id="r465 rd" class="r465 r">exportedResource</span> <b>in</b> <span class="r461 r">exportedClassDscResources</span>)
                {
                    <span class="r457 r">manifestInfo</span>.<a href="PSModuleInfo.cs.html#269063d3d879560b" class="i field">_declaredDscResourceExports</a>.<span class="i">Add</span>(<span class="r465 r">exportedResource</span>.<span class="i">Name</span>);
                }
            }
        }
 
        <b>private static void</b> <a id="159993f0c45917c8" href="../../R/159993f0c45917c8.html" target="n" data-glyph="76,1" class="i method">UpdateCommandCollection</a>&lt;<span id="r466 rd t" class="r466 r t">T</span>&gt;(<span class="i">List</span>&lt;<span class="r466 r t">T</span>&gt; <span id="r467 rd" class="r467 r">list</span>, <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r468 rd" class="r468 r">patterns</span>) <b>where</b> <span class="r466 r t">T</span> : <a href="../CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a>
        {
            <span class="i">List</span>&lt;<span class="r466 r t">T</span>&gt; <span id="r469 rd" class="r469 r">updated</span> = <b>new</b> <span class="i">List</span>&lt;<span class="r466 r t">T</span>&gt;();
            <b>foreach</b> (<span class="r466 r t">T</span> <span id="r470 rd" class="r470 r">element</span> <b>in</b> <span class="r467 r">list</span>)
            {
                <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r470 r">element</span>.<span class="i">Name</span>, <span class="r468 r">patterns</span>, <b>false</b>))
                {
                    <span class="r469 r">updated</span>.<span class="i">Add</span>(<span class="r470 r">element</span>);
                }
            }
 
            <span class="r467 r">list</span>.<span class="i">Clear</span>();
            <span class="r467 r">list</span>.<span class="i">AddRange</span>(<span class="r469 r">updated</span>);
        }
 
        <b>private static void</b> <a id="75b8fdf0f3674db2" href="../../R/75b8fdf0f3674db2.html" target="n" data-glyph="76,1" class="i method">UpdateCommandCollection</a>(<span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r471 rd" class="r471 r">list</span>, <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r472 rd" class="r472 r">patterns</span>)
        {
            <b>if</b> (<span class="r471 r">list</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r473 rd" class="r473 r">updated</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
            <span class="c">// Add any patterns that don&#39;t have wildcard characters - they</span>
            <span class="c">// may have been declared but then created in a way that we couldn&#39;t detect</span>
            <span class="c">// them statically</span>
            <b>foreach</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r474 rd" class="r474 r">pattern</span> <b>in</b> <span class="r472 r">patterns</span>)
            {
                <b>if</b> (!<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r474 r">pattern</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>))
                {
                    <b>if</b> (!<span class="r471 r">list</span>.<span class="i">Contains</span>(<span class="r474 r">pattern</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r471 r">list</span>.<span class="i">Add</span>(<span class="r474 r">pattern</span>.<a href="../regex.cs.html#e6587610f807da5a" class="i property">Pattern</a>);
                    }
                }
            }
 
            <b>foreach</b> (<b>string</b> <span id="r475 rd" class="r475 r">element</span> <b>in</b> <span class="r471 r">list</span>)
            {
                <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r475 r">element</span>, <span class="r472 r">patterns</span>, <b>false</b>))
                {
                    <span class="r473 r">updated</span>.<span class="i">Add</span>(<span class="r475 r">element</span>);
                }
            }
 
            <span class="r471 r">list</span>.<span class="i">Clear</span>();
 
            <b>foreach</b> (<b>string</b> <span id="r476 rd" class="r476 r">element</span> <b>in</b> <span class="r473 r">updated</span>)
            {
                <span class="r471 r">list</span>.<span class="i">Add</span>(<span class="r476 r">element</span>);
            }
        }
 
        <b>private static void</b> <a id="4d234a6fa0233244" href="../../R/4d234a6fa0233244.html" target="n" data-glyph="76,1" class="i method">WriteInvalidManifestMemberError</a>(
            <a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r477 rd" class="r477 r">cmdlet</span>,
            <b>string</b> <span id="r478 rd" class="r478 r">manifestElement</span>,
            <b>string</b> <span id="r479 rd" class="r479 r">moduleManifestPath</span>,
            <span class="i">Exception</span> <span id="r480 rd" class="r480 r">e</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r481 rd" class="r481 r">manifestProcessingFlags</span>)
        {
            <b>if</b> ((<span class="r481 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>) != 0)
            {
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r482 rd" class="r482 r">er</span> = <a href="#c362eeb1b8f5bddb" class="i method">GenerateInvalidModuleMemberErrorRecord</a>(<span class="r478 r">manifestElement</span>, <span class="r479 r">moduleManifestPath</span>, <span class="r480 r">e</span>);
                <span class="r477 r">cmdlet</span>.<a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r482 r">er</span>);
            }
        }
 
        <b>private static</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="c362eeb1b8f5bddb" href="../../R/c362eeb1b8f5bddb.html" target="n" data-glyph="76,1" class="i method">GenerateInvalidModuleMemberErrorRecord</a>(<b>string</b> <span id="r483 rd" class="r483 r">manifestElement</span>, <b>string</b> <span id="r484 rd" class="r484 r">moduleManifestPath</span>, <span class="i">Exception</span> <span id="r485 rd" class="r485 r">e</span>)
        {
            <b>string</b> <span id="r486 rd" class="r486 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleManifestInvalidManifestMember</span>, <span class="r483 r">manifestElement</span>, <span class="r485 r">e</span>.<span class="i">Message</span>, <span class="r484 r">moduleManifestPath</span>);
            <span class="i">ArgumentException</span> <span id="r487 rd" class="r487 r">newAe</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="r486 r">message</span>);
            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r488 rd" class="r488 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r487 r">newAe</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r484 r">moduleManifestPath</span>);
            <b>return</b> <span class="r488 r">er</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a module has been loaded.</span>
        <span class="c">///</span><span class="c"> If loadElements is false, we check requireModule for correctness but do</span>
        <span class="c">///</span><span class="c"> not check if the modules are loaded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r489 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Execution Context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r490 r">requiredModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Either a string or a hash of ModuleName, optional Guid, and ModuleVersion.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r491 r">matchFailureReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason the module failed to load, or null on success.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r492 r">loaded</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sets if the module/snapin is already present.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Null if the module is not loaded or loadElements is false, the loaded module otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static object</b> <a id="37ef66b369d3f4c5" href="../../R/37ef66b369d3f4c5.html" target="n" data-glyph="74,1" class="i method">IsModuleLoaded</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r489 rd" class="r489 r">context</span>, <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r490 rd" class="r490 r">requiredModule</span>, <b>out</b> <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r491 rd" class="r491 r">matchFailureReason</span>, <b>out bool</b> <span id="r492 rd" class="r492 r">loaded</span>)
        {
            <span class="r492 r">loaded</span> = <b>false</b>;
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r490 r">requiredModule</span> != <b>null</b>, <span class="s">&quot;Caller should verify requiredModuleSpecification != null&quot;</span>);
 
            <span class="c">// Assume the module is not loaded.</span>
            <b>object</b> <span id="r493 rd" class="r493 r">result</span> = <b>null</b>;
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r490 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> != <b>null</b>, <span class="s">&quot;GetModuleSpecification should guarantee that moduleName != null&quot;</span>);
            <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r494 rd" class="r494 r">matchFailure</span> = <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="ModuleIntrinsics.cs.html#c2056c6983c73cce" class="i field">None</a>;
            <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r495 rd" class="r495 r">module</span> <b>in</b> <span class="r489 r">context</span>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#1c52622ea6eacb86" class="i method">GetModules</a>(<b>new</b> <b>string</b>[] { <span class="s">&quot;*&quot;</span> }, <b>false</b>))
            {
                <span class="c">// Check that the module meets the module constraints give</span>
                <b>if</b> (<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#38b8620192395694" class="i method">IsModuleMatchingModuleSpec</a>(<b>out</b> <span class="r494 r">matchFailure</span>, <span class="r495 r">module</span>, <span class="r490 r">requiredModule</span>))
                {
                    <span class="r493 r">result</span> = <span class="r495 r">module</span>;
                    <span class="r492 r">loaded</span> = <b>true</b>;
                    <b>break</b>;
                }
            }
 
            <span class="c">// If the RequiredModule is one of the Engine modules, then they could have been loaded as snapins (using InitialSessionState.CreateDefault())</span>
            <b>if</b> (<span class="r493 r">result</span> == <b>null</b> &amp;&amp; <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#7c1caf70ca3d20ee" class="i method">IsEngineModule</a>(<span class="r490 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>))
            {
                <span class="r493 r">result</span> = <a href="#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="#a39e43826c9d3348" class="i method">GetEngineSnapIn</a>(<span class="r489 r">context</span>, <span class="r490 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                <b>if</b> (<span class="r493 r">result</span> != <b>null</b>)
                {
                    <span class="r492 r">loaded</span> = <b>true</b>;
                }
            }
 
            <span class="r491 r">matchFailureReason</span> = <span class="r494 r">matchFailure</span>;
            <b>return</b> <span class="r493 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a module has been loaded.</span>
        <span class="c">///</span><span class="c"> If loadElements is false, we check requireModule for correctness but do</span>
        <span class="c">///</span><span class="c"> not check if the modules are loaded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r496 r">currentModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The current module being loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r497 r">requiredModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Either a string or a hash of ModuleName, optional Guid, and ModuleVersion.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r498 r">moduleManifestPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Used for error messages.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r499 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies how to treat errors and whether to load elements.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r500 r">containedErrors</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Set if any errors are found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r501 r">error</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Contains error record information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Null if the module is not loaded or loadElements is false, the loaded module otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="574fb17f9e98939f" href="../../R/574fb17f9e98939f.html" target="n" data-glyph="74,1" class="i method">LoadRequiredModule</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r496 rd" class="r496 r">currentModule</span>, <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r497 rd" class="r497 r">requiredModule</span>, <b>string</b> <span id="r498 rd" class="r498 r">moduleManifestPath</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r499 rd" class="r499 r">manifestProcessingFlags</span>, <b>bool</b> <span id="r500 rd" class="r500 r">containedErrors</span>, <b>out</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r501 rd" class="r501 r">error</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r498 r">moduleManifestPath</span> != <b>null</b>, <span class="s">&quot;Caller should verify moduleManifestPath != null&quot;</span>);
            <span class="r501 r">error</span> = <b>null</b>;
            <b>if</b> (!<span class="r500 r">containedErrors</span>)
            {
                <b>return</b> <a href="#84ec0a960d4f808b" class="i method">LoadRequiredModule</a>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r496 r">currentModule</span>, <span class="r497 r">requiredModule</span>, <span class="r498 r">moduleManifestPath</span>, <span class="r499 r">manifestProcessingFlags</span>, <b>out</b> <span class="r501 r">error</span>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a module has been loaded.</span>
        <span class="c">///</span><span class="c"> If loadElements is false, we check requireModule for correctness but do</span>
        <span class="c">///</span><span class="c"> not check if the modules are loaded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r502 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Execution Context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r503 r">currentModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The current module being loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r504 r">requiredModuleSpecification</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Either a string or a hash of ModuleName, optional Guid, and ModuleVersion.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r505 r">moduleManifestPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Used for error messages.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r506 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies how to treat errors and whether to load elements.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r507 r">error</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Contains error record information.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Null if the module is not loaded or loadElements is false, the loaded module otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="84ec0a960d4f808b" href="../../R/84ec0a960d4f808b.html" target="n" data-glyph="74,1" class="i method">LoadRequiredModule</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r502 rd" class="r502 r">context</span>,
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r503 rd" class="r503 r">currentModule</span>,
            <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r504 rd" class="r504 r">requiredModuleSpecification</span>,
            <b>string</b> <span id="r505 rd" class="r505 r">moduleManifestPath</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r506 rd" class="r506 r">manifestProcessingFlags</span>,
            <b>out</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r507 rd" class="r507 r">error</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>((<span class="r506 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>) != 0, <span class="s">&quot;LoadRequiredModule / RequiredModules checks should only be done when actually loading a module&quot;</span>);
 
            <span class="r507 r">error</span> = <b>null</b>;
 
            <b>string</b> <span id="r508 rd" class="r508 r">moduleName</span> = <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>;
            <span class="i">Guid</span>? <span id="r509 rd" class="r509 r">moduleGuid</span> = <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>;
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r510 rd" class="r510 r">result</span> = <b>null</b>;
 
            <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r511 rd" class="r511 r">loadFailureReason</span> = <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="ModuleIntrinsics.cs.html#c2056c6983c73cce" class="i field">None</a>;
            <b>bool</b> <span id="r512 rd" class="r512 r">loaded</span> = <b>false</b>;
            <b>object</b> <span id="r513 rd" class="r513 r">loadedModule</span> = <a href="#37ef66b369d3f4c5" class="i method">IsModuleLoaded</a>(<span class="r502 r">context</span>, <span class="r504 r">requiredModuleSpecification</span>, <b>out</b> <span class="r511 r">loadFailureReason</span>, <b>out</b> <span class="r512 r">loaded</span>);
 
            <b>if</b> (<span class="r513 r">loadedModule</span> == <b>null</b>)
            {
                <span class="c">// Load the module</span>
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r514 rd" class="r514 r">requiredModuleInfo</span> = <b>null</b>;
                <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r515 rd" class="r515 r">moduleInfo</span> = <a href="#b9b9dc933360a626" class="i method">GetModuleIfAvailable</a>(<span class="r504 r">requiredModuleSpecification</span>);
 
                <b>if</b> (<span class="r515 r">moduleInfo</span> != <b>null</b> &amp;&amp; <span class="r515 r">moduleInfo</span>.<span class="i">Count</span> &gt; 0)
                {
                    <span class="r514 r">requiredModuleInfo</span> = <span class="r515 r">moduleInfo</span>[0];
 
                    <span class="c">// Check for cyclic references of RequiredModule</span>
                    <b>bool</b> <span id="r516 rd" class="r516 r">hasRequiredModulesCyclicReference</span> = <b>false</b>;
                    <span class="i">Dictionary</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>, <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;&gt; <span id="r517 rd" class="r517 r">requiredModules</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>, <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;&gt;(<b>new</b> <span class="t">ModuleSpecificationComparer</span>());
                    <b>if</b> (<span class="r503 r">currentModule</span> != <b>null</b>)
                    {
                        <span class="r517 r">requiredModules</span>.<span class="i">Add</span>(<b>new</b> <a href="ModuleSpecification.cs.html#1c04fd1431e4a831" class="t constructor">ModuleSpecification</a>(<span class="r503 r">currentModule</span>), <b>new</b> <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; { <span class="r504 r">requiredModuleSpecification</span> });
                    }
 
                    <b>if</b> (<span class="r504 r">requiredModuleSpecification</span> != <b>null</b>)
                    {
                        <span class="r517 r">requiredModules</span>.<span class="i">Add</span>(<span class="r504 r">requiredModuleSpecification</span>, <b>new</b> <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;(<span class="r514 r">requiredModuleInfo</span>.<a href="PSModuleInfo.cs.html#5328c12b254f3516" class="i property">RequiredModulesSpecification</a>));
                    }
 
                    <span class="c">// We always need to check against the module name and not the file name</span>
                    <span class="r516 r">hasRequiredModulesCyclicReference</span> = <span class="i">HasRequiredModulesCyclicReference</span>(<span class="r504 r">requiredModuleSpecification</span>,
                                                                                          <b>new</b> <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;(<span class="r514 r">requiredModuleInfo</span>.<a href="PSModuleInfo.cs.html#5328c12b254f3516" class="i property">RequiredModulesSpecification</a>),
                                                                                          <b>new</b> <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; { <span class="r514 r">requiredModuleInfo</span> },
                                                                                          <span class="r517 r">requiredModules</span>,
                                                                                          <b>out</b> <span class="r507 r">error</span>);
                    <b>if</b> (!<span class="r516 r">hasRequiredModulesCyclicReference</span>)
                    {
                        <span class="r510 r">result</span> = <a href="#7aec30850bfe4eb7" class="i method">ImportRequiredModule</a>(<span class="r502 r">context</span>, <span class="r504 r">requiredModuleSpecification</span>, <b>out</b> <span class="r507 r">error</span>);
                    }
                    <b>else</b>
                    {
                        <span class="c">// Error Record</span>
                        <b>if</b> (<span class="r505 r">moduleManifestPath</span> != <b>null</b>)
                        {
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r507 r">error</span> != <b>null</b>, <span class="s">&quot;Error message should be populated if there is cyclic dependency&quot;</span>);
                            <span class="i">MissingMemberException</span> <span id="r518 rd" class="r518 r">mm</span> = <b>null</b>;
                            <b>if</b> (<span class="r507 r">error</span> != <b>null</b> &amp;&amp; <span class="r507 r">error</span>.<a href="../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a> != <b>null</b>)
                            {
                                <span class="r518 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r507 r">error</span>.<a href="../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>.<span class="i">Message</span>);
                            }
 
                            <span class="r507 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r518 r">mm</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                                                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r505 r">moduleManifestPath</span>);
                        }
                    }
                }
                <b>else</b>
                {
                    <b>string</b> <span id="r519 rd" class="r519 r">message</span>;
                    <b>if</b> (<span class="r505 r">moduleManifestPath</span> != <b>null</b>)
                    {
                        <b>if</b> ((<span class="r506 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>) != 0)
                        {
                            <b>switch</b> (<span class="r511 r">loadFailureReason</span>)
                            {
                                <b>case</b> <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="ModuleIntrinsics.cs.html#b99682ee062b9abc" class="i field">RequiredVersion</a>:
                                    <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                                        <span class="i">Modules</span>.<span class="i">RequiredModuleNotLoadedWrongVersion</span>,
                                        <span class="r505 r">moduleManifestPath</span>,
                                        <span class="r508 r">moduleName</span>,
                                        <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>);
                                    <b>break</b>;
 
                                <b>case</b> <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="ModuleIntrinsics.cs.html#14ca67728e787bed" class="i field">MinimumVersion</a>:
                                    <span class="c">// If both max and min versions were specified, use a different error message</span>
                                    <b>if</b> (<span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> == <b>null</b>)
                                    {
                                        <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                                            <span class="i">Modules</span>.<span class="i">RequiredModuleNotLoadedWrongVersion</span>,
                                            <span class="r505 r">moduleManifestPath</span>, <span class="r508 r">moduleName</span>,
                                            <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>);
                                    }
                                    <b>else</b>
                                    {
                                        <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                                            <span class="i">Modules</span>.<span class="i">RequiredModuleNotLoadedWrongMinimumVersionAndMaximumVersion</span>,
                                            <span class="r505 r">moduleManifestPath</span>,
                                            <span class="r508 r">moduleName</span>,
                                            <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>,
                                            <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>);
                                    }
 
                                    <b>break</b>;
 
                                <b>case</b> <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="ModuleIntrinsics.cs.html#6f847e08b4b7ffc1" class="i field">MaximumVersion</a>:
                                    <span class="c">// If both max and min versions were specified, use a different error message</span>
                                    <b>if</b> (<span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> == <b>null</b>)
                                    {
                                        <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                                            <span class="i">Modules</span>.<span class="i">RequiredModuleNotLoadedWrongMaximumVersion</span>,
                                            <span class="r505 r">moduleManifestPath</span>,
                                            <span class="r508 r">moduleName</span>,
                                            <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>);
                                    }
                                    <b>else</b>
                                    {
                                        <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                                            <span class="i">Modules</span>.<span class="i">RequiredModuleNotLoadedWrongMinimumVersionAndMaximumVersion</span>,
                                            <span class="r505 r">moduleManifestPath</span>,
                                            <span class="r508 r">moduleName</span>,
                                            <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>,
                                            <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>);
                                    }
 
                                    <b>break</b>;
 
                                <b>case</b> <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="ModuleIntrinsics.cs.html#6b88def2a9764ae8" class="i field">Guid</a>:
                                    <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                                        <span class="i">Modules</span>.<span class="i">RequiredModuleNotLoadedWrongGuid</span>,
                                        <span class="r505 r">moduleManifestPath</span>,
                                        <span class="r508 r">moduleName</span>,
                                        <span class="r509 r">moduleGuid</span>.<span class="i">Value</span>);
                                    <b>break</b>;
 
                                <b>default</b>:
                                    <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(
                                        <span class="i">Modules</span>.<span class="i">RequiredModuleNotLoaded</span>,
                                        <span class="r505 r">moduleManifestPath</span>,
                                        <span class="r508 r">moduleName</span>);
                                    <b>break</b>;
                            }
 
                            <span class="i">MissingMemberException</span> <span id="r520 rd" class="r520 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r519 r">message</span>);
                            <span class="r507 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r520 r">mm</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                                                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r505 r">moduleManifestPath</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="r519 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">RequiredModuleNotFound</span>, <span class="r504 r">requiredModuleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                        <span class="i">MissingMemberException</span> <span id="r521 rd" class="r521 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r519 r">message</span>);
                        <span class="r507 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r521 r">mm</span>, <span class="s">&quot;Modules_RequiredModuleNotFound&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <b>null</b>);
                    }
                }
            }
            <b>else</b>
            {
                <span class="c">// Either module/snapin is already loaded</span>
                <b>if</b> (<span class="r513 r">loadedModule</span> <b>is</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>)
                {
                    <span class="r510 r">result</span> = (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>)<span class="r513 r">loadedModule</span>;
                }
                <b>else</b> <b>if</b> (!<span class="r512 r">loaded</span>)
                {
                    <span class="c">// This should never happen because one of the two should be true</span>
                    <span class="c">// 1) loadedModule should either be PSModuleInfo</span>
                    <span class="c">// 2) loaded = true</span>
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;loadedModule should either be PSModuleInfo or loaded should be true&quot;</span>);
                }
            }
 
            <b>return</b> <span class="r510 r">result</span>;
        }
 
        <b>private static</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="7aec30850bfe4eb7" href="../../R/7aec30850bfe4eb7.html" target="n" data-glyph="76,1" class="i method">ImportRequiredModule</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r522 rd" class="r522 r">context</span>, <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r523 rd" class="r523 r">requiredModule</span>, <b>out</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r524 rd" class="r524 r">error</span>)
        {
            <span class="r524 r">error</span> = <b>null</b>;
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r525 rd" class="r525 r">result</span> = <b>null</b>;
            <b>using</b> (<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r526 rd" class="r526 r">powerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>))
            {
                <span class="r526 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Import-Module&quot;</span>);
                <span class="r526 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
 
                <b>if</b> (<span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> != <b>null</b>)
                {
                    <span class="r526 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;RequiredVersion&quot;</span>, <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>);
                }
                <b>else</b> <b>if</b> (<span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> != <b>null</b>)
                {
                    <span class="r526 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;MaximumVersion&quot;</span>, <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>);
                }
                <b>else</b>
                {
                    <span class="r526 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;Version&quot;</span>, <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>);
                }
 
                <span class="r526 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#184e23c46120523e" class="i method">Invoke</a>();
                <b>if</b> (<span class="r526 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a> != <b>null</b> &amp;&amp; <span class="r526 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>.<a href="../hostifaces/PSDataCollection.cs.html#e7cb43bbebbb4aca" class="i property">Count</a> &gt; 0)
                {
                    <span class="r524 r">error</span> = <span class="r526 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>[0];
                }
                <b>else</b>
                {
                    <span class="c">// Check if the correct module is loaded using Version , Guid Information.</span>
                    <b>string</b> <span id="r527 rd" class="r527 r">moduleNameToCheckAgainst</span> = <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>;
                    <b>string</b> <span id="r528 rd" class="r528 r">manifestPath</span> = <b>string</b>.<span class="i">Empty</span>;
                    <b>if</b> (<span class="r527 r">moduleNameToCheckAgainst</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.psd1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r528 r">manifestPath</span> = <span class="r527 r">moduleNameToCheckAgainst</span>;
                        <span class="r527 r">moduleNameToCheckAgainst</span> = <span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r527 r">moduleNameToCheckAgainst</span>);
                    }
 
                    <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r529 rd" class="r529 r">ms</span> = <b>new</b> <a href="ModuleSpecification.cs.html#8bf2c91f2abc8759" class="t constructor">ModuleSpecification</a>(<span class="r527 r">moduleNameToCheckAgainst</span>);
                    <b>if</b> (<span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a> != <b>null</b>)
                    {
                        <span class="r529 r">ms</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a> = <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>.<span class="i">Value</span>;
                    }
 
                    <b>if</b> (<span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> != <b>null</b>)
                    {
                        <span class="r529 r">ms</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> = <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>;
                    }
 
                    <b>if</b> (<span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> != <b>null</b>)
                    {
                        <span class="r529 r">ms</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> = <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>;
                    }
 
                    <b>if</b> (<span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> != <b>null</b>)
                    {
                        <span class="r529 r">ms</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> = <span class="r523 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>;
                    }
 
                    <a href="ModuleIntrinsics.cs.html#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r530 rd" class="r530 r">loadFailureReason</span>;
                    <b>bool</b> <span id="r531 rd" class="r531 r">loaded</span> = <b>false</b>;
                    <b>object</b> <span id="r532 rd" class="r532 r">r</span> = <a href="#37ef66b369d3f4c5" class="i method">IsModuleLoaded</a>(<span class="r522 r">context</span>, <span class="r529 r">ms</span>, <b>out</b> <span class="r530 r">loadFailureReason</span>, <b>out</b> <span class="r531 r">loaded</span>);
 
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r532 r">r</span> <b>is</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>, <span class="s">&quot;The returned value should be PSModuleInfo&quot;</span>);
 
                    <span class="r525 r">result</span> = <span class="r532 r">r</span> <b>as</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>;
                    <b>if</b> (<span class="r525 r">result</span> == <b>null</b>)
                    {
                        <b>string</b> <span id="r533 rd" class="r533 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">RequiredModuleNotFound</span>, <span class="r527 r">moduleNameToCheckAgainst</span>);
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r528 r">manifestPath</span>))
                        {
                            <span class="i">MissingMemberException</span> <span id="r534 rd" class="r534 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r533 r">message</span>);
                            <span class="r524 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r534 r">mm</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                                                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r528 r">manifestPath</span>);
                        }
                        <b>else</b>
                        {
                            <span class="i">InvalidOperationException</span> <span id="r535 rd" class="r535 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r533 r">message</span>);
                            <span class="r524 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r535 r">ioe</span>, <span class="s">&quot;Modules_RequiredModuleNotLoadedWithoutManifest&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r523 r">requiredModule</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r525 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies if a nested module is available using GetModuleIfAvailable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r536 r">extension</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r537 r">rootedModulePath</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> will be used to create module name for searching.</span>
        <span class="c">///</span><span class="c"> If </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r537 r">rootedModulePath</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null, the name specified in</span>
        <span class="c">///</span><span class="c"> nestedModuleSpec will be used.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r538 r">nestedModuleSpec</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r537 r">rootedModulePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r536 r">extension</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r539 r">nestedModuleInfoIfAvailable</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="66f0393a5df8e099" href="../../R/66f0393a5df8e099.html" target="n" data-glyph="74,1" class="i method">VerifyIfNestedModuleIsAvailable</a>(<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r538 rd" class="r538 r">nestedModuleSpec</span>,
            <b>string</b> <span id="r537 rd" class="r537 r">rootedModulePath</span>,
            <b>string</b> <span id="r536 rd" class="r536 r">extension</span>,
            <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r539 rd" class="r539 r">nestedModuleInfoIfAvailable</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r538 r">nestedModuleSpec</span> != <b>null</b>, <span class="s">&quot;nestedModuleSpec cannot be null.&quot;</span>);
            <span class="r539 r">nestedModuleInfoIfAvailable</span> = <b>null</b>;
            <b>if</b> ((<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a> != <b>null</b>) || (<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> != <b>null</b>) || (<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> != <b>null</b>) || (<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> != <b>null</b>))
            {
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r536 r">extension</span>) &amp;&amp;
                    (!<b>string</b>.<span class="i">Equals</span>(<span class="r536 r">extension</span>, <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>)))
                {
                    <span class="c">// A module can declare its GUID/Version only in the PSD1 file.</span>
                    <b>return</b> <b>false</b>;
                }
 
                <b>string</b> <span id="r540 rd" class="r540 r">tempModuleName</span> = <span class="r537 r">rootedModulePath</span>;
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r536 r">extension</span>))
                {
                    <span class="r540 r">tempModuleName</span> = <span class="r537 r">rootedModulePath</span> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>;
                }
 
                <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r541 rd" class="r541 r">tempSpec</span> = <b>new</b> <a href="ModuleSpecification.cs.html#8bf2c91f2abc8759" class="t constructor">ModuleSpecification</a>(
                    <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r537 r">rootedModulePath</span>) ? <span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> : <span class="r540 r">tempModuleName</span>);
                <b>if</b> (<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>.<span class="i">HasValue</span>)
                {
                    <span class="r541 r">tempSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a> = <span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>.<span class="i">Value</span>;
                }
 
                <b>if</b> (<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> != <b>null</b>)
                {
                    <span class="r541 r">tempSpec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> = <span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>;
                }
 
                <b>if</b> (<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> != <b>null</b>)
                {
                    <span class="r541 r">tempSpec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> = <span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>;
                }
 
                <b>if</b> (<span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> != <b>null</b>)
                {
                    <span class="r541 r">tempSpec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> = <span class="r538 r">nestedModuleSpec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>;
                }
 
                <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r542 rd" class="r542 r">availableModules</span> = <a href="#b9b9dc933360a626" class="i method">GetModuleIfAvailable</a>(<span class="r541 r">tempSpec</span>);
 
                <span class="c">// With Side-b-Side module version support, more than one module will be returned by GetModuleIfAvailable</span>
                <b>if</b> (<span class="r542 r">availableModules</span>.<span class="i">Count</span> &lt; 1)
                {
                    <b>return</b> <b>false</b>;
                }
 
                <span class="c">// First element is the highest available version under a module base folder</span>
                <span class="r539 r">nestedModuleInfoIfAvailable</span> = <span class="r542 r">availableModules</span>[0];
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">// Checks if module is available to be loaded</span>
        <span class="c">// ModuleName ---&gt; checks if module can be loaded using Module loading rules</span>
        <span class="c">// ModuleManifest --&gt; checks if manifest is valid</span>
        <b>internal static</b> <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="b9b9dc933360a626" href="../../R/b9b9dc933360a626.html" target="n" data-glyph="74,1" class="i method">GetModuleIfAvailable</a>(<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r543 rd" class="r543 r">requiredModule</span>,
            <a href="../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r544 rd" class="r544 r">rsToUse</span> = <b>null</b>)
        {
            <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r545 rd" class="r545 r">result</span> = <b>new</b> <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
            <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r546 rd" class="r546 r">tempResult</span> = <b>null</b>;
            <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r547 rd" class="r547 r">powerShell</span> = <b>null</b>;
            <b>if</b> (<span class="r544 r">rsToUse</span> == <b>null</b>)
            {
                <span class="r547 r">powerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>);
            }
            <b>else</b>
            {
                <span class="r547 r">powerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#40345bc4625ff918" class="i method">Create</a>();
                <span class="r547 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#ccf57242c9d46642" class="i property">Runspace</a> = <span class="r544 r">rsToUse</span>;
            }
 
            <b>using</b> (<span class="r547 r">powerShell</span>)
            {
                <b>if</b> (<span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>.<span class="i">EndsWith</span>(<span class="s">&quot;.psd1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r547 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Test-ModuleManifest&quot;</span>);
                    <span class="r547 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Path&quot;</span>, <span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                }
                <b>else</b>
                {
                    <span class="r547 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Get-Module&quot;</span>);
                    <span class="r547 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                    <span class="r547 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#ad181c9dec5e4ffa" class="i method">AddParameter</a>(<span class="s">&quot;ListAvailable&quot;</span>);
                }
 
                <span class="r546 r">tempResult</span> = <span class="r547 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
            }
 
            <span class="c">// Check if the available module is of the correct version and GUID. The name is already checked.</span>
            <span class="c">// GH #8204: The required name here may be the full path, while the module name may be just the module,</span>
            <span class="c">//           so comparing them may fail incorrectly.</span>
            <b>foreach</b> (<b>var</b> <span id="r548 rd" class="r548 r">module</span> <b>in</b> <span class="r546 r">tempResult</span>)
            {
                <b>if</b> (<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<span class="i">IsModuleMatchingConstraints</span>(
                    <span class="r548 r">module</span>,
                    <span class="i">guid</span>: <span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>,
                    <span class="i">requiredVersion</span>: <span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>,
                    <span class="i">minimumVersion</span>: <span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>,
                    <span class="i">maximumVersion</span>: <span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> == <b>null</b> ? <b>null</b> : <a href="#8d9eea57094a20b4" class="i method">GetMaximumVersion</a>(<span class="r543 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>)))
                {
                    <span class="r545 r">result</span>.<span class="i">Add</span>(<span class="r548 r">module</span>);
                }
            }
 
            <b>return</b> <span class="r545 r">result</span>;
        }
 
        <b>private static bool</b> <a id="a81b1bb53280d760" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">HasRequiredModulesCyclicReference</a>(<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r549 rd" class="r549 r">currentModuleSpecification</span>, <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r550 rd" class="r550 r">requiredModules</span>, <span class="i">IEnumerable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r551 rd" class="r551 r">moduleInfoList</span>, <span class="i">Dictionary</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>, <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;&gt; <span id="r552 rd" class="r552 r">nonCyclicRequiredModules</span>, <b>out</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r553 rd" class="r553 r">error</span>)
        {
            <span class="r553 r">error</span> = <b>null</b>;
            <b>if</b> (<span class="r550 r">requiredModules</span> == <b>null</b> || <span class="r550 r">requiredModules</span>.<span class="i">Count</span> == 0 || <span class="r549 r">currentModuleSpecification</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>foreach</b> (<b>var</b> <span id="r554 rd" class="r554 r">requiredModuleSpecification</span> <b>in</b> <span class="r550 r">requiredModules</span>)
            {
                <span class="c">// The dictionary holds the key-value pair with the following convention</span>
                <span class="c">// Key --&gt; Module</span>
                <span class="c">// Values --&gt; RequiredModules</span>
                <span class="c">// If we find that the module we are trying to import is already present in the dictionary, there is a cyclic reference</span>
 
                <span class="c">// No cycle</span>
                <span class="c">// 1----&gt;2------&gt;3--------&gt;4</span>
                <span class="c">//       |--&gt; 5             |--&gt; 5</span>
 
                <span class="c">// Cycle</span>
                <span class="c">// 1 ---&gt;2----&gt;3----&gt;4---&gt; 2</span>
                <b>if</b> (<span class="r552 r">nonCyclicRequiredModules</span>.<span class="i">ContainsKey</span>(<span class="r554 r">requiredModuleSpecification</span>))
                {
                    <span class="c">// Error out saying there is a cyclic reference</span>
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r555 rd" class="r555 r">mo</span> = <b>null</b>;
                    <b>foreach</b> (<b>var</b> <span id="r556 rd" class="r556 r">i</span> <b>in</b> <span class="r551 r">moduleInfoList</span>)
                    {
                        <b>if</b> (<span class="r556 r">i</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="r549 r">currentModuleSpecification</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r555 r">mo</span> = <span class="r556 r">i</span>;
                            <b>break</b>;
                        }
                    }
 
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r555 r">mo</span> != <b>null</b>, <span class="s">&quot;The moduleInfo should be present&quot;</span>);
                    <b>string</b> <span id="r557 rd" class="r557 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">RequiredModulesCyclicDependency</span>, <span class="r549 r">currentModuleSpecification</span>.<a href="ModuleSpecification.cs.html#58661ffe9a4655b1" class="i method">ToString</a>(), <span class="r554 r">requiredModuleSpecification</span>.<span class="i">ToString</span>(), <span class="r555 r">mo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                    <span class="i">MissingMemberException</span> <span id="r558 rd" class="r558 r">mm</span> = <b>new</b> <span class="i">MissingMemberException</span>(<span class="r557 r">message</span>);
                    <span class="r553 r">error</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r558 r">mm</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r555 r">mo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                    <b>return</b> <b>true</b>;
                }
                <b>else</b> <span class="c">// Go for recursive check for the RequiredModules of current requiredModuleSpecification</span>
                {
                    <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r559 rd" class="r559 r">availableModules</span> = <span class="i">GetModuleIfAvailable</span>(<span class="r554 r">requiredModuleSpecification</span>);
                    <b>if</b> (<span class="r559 r">availableModules</span>.<span class="i">Count</span> == 1)
                    {
                        <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r560 rd" class="r560 r">list</span> = <b>new</b> <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt;(<span class="r559 r">availableModules</span>[0].<span class="i">RequiredModulesSpecification</span>);
                        <span class="c">// Only add if this required module has nested required modules (meaning, it could lead to a circular reference)</span>
                        <b>if</b> (<span class="r560 r">list</span>.<span class="i">Count</span> &gt; 0)
                        {
                            <span class="r552 r">nonCyclicRequiredModules</span>.<span class="i">Add</span>(<span class="r554 r">requiredModuleSpecification</span>, <span class="r560 r">list</span>);
                            <span class="c">// We always need to check against the module specification and not the file name</span>
                            <b>if</b> (<span class="i">HasRequiredModulesCyclicReference</span>(<span class="r554 r">requiredModuleSpecification</span>, <span class="r560 r">list</span>, <span class="r559 r">availableModules</span>, <span class="r552 r">nonCyclicRequiredModules</span>, <b>out</b> <span class="r553 r">error</span>))
                            {
                                <b>return</b> <b>true</b>;
                            }
                        }
                    }
                }
            }
 
            <span class="c">// Once nested recursive calls are complete, we should remove the current module from the nonCyclicRequiredModules check list.</span>
            <span class="c">// This prevents non related modules from getting involved in the cycle list.</span>
            <span class="r552 r">nonCyclicRequiredModules</span>.<span class="i">Remove</span>(<span class="r549 r">currentModuleSpecification</span>); <span class="c">// this uses ModuleSpecificationComparer equality comparer</span>
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Search for a localized psd1 manifest file, using the same algorithm</span>
        <span class="c">///</span><span class="c"> as Import-LocalizedData.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static</b> <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <a id="c261b3a6c1d05c37" href="../../R/c261b3a6c1d05c37.html" target="n" data-glyph="76,1" class="i method">FindLocalizedModuleManifest</a>(<b>string</b> <span id="r561 rd" class="r561 r">path</span>)
        {
            <b>string</b> <span id="r562 rd" class="r562 r">dir</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r561 r">path</span>);
            <b>string</b> <span id="r563 rd" class="r563 r">file</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r561 r">path</span>);
            <b>string</b> <span id="r564 rd" class="r564 r">localizedFile</span> = <b>null</b>;
 
            <span class="i">CultureInfo</span> <span id="r565 rd" class="r565 r">culture</span> = <span class="i n">System</span>.<span class="i">Globalization</span>.<span class="i">CultureInfo</span>.<span class="i">CurrentUICulture</span>;
            <span class="i">CultureInfo</span> <span id="r566 rd" class="r566 r">currentCulture</span> = <span class="r565 r">culture</span>;
            <b>while</b> (<span class="r566 r">currentCulture</span> != <b>null</b> &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r566 r">currentCulture</span>.<span class="i">Name</span>))
            {
                <span class="i">StringBuilder</span> <span id="r567 rd" class="r567 r">stringBuilder</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r562 r">dir</span>);
                <span class="r567 r">stringBuilder</span>.<span class="i">Append</span>(<span class="s">&#39;\\&#39;</span>);
                <span class="r567 r">stringBuilder</span>.<span class="i">Append</span>(<span class="r566 r">currentCulture</span>.<span class="i">Name</span>);
                <span class="r567 r">stringBuilder</span>.<span class="i">Append</span>(<span class="s">&#39;\\&#39;</span>);
                <span class="r567 r">stringBuilder</span>.<span class="i">Append</span>(<span class="r563 r">file</span>);
 
                <b>string</b> <span id="r568 rd" class="r568 r">filePath</span> = <span class="r567 r">stringBuilder</span>.<span class="i">ToString</span>();
 
                <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r568 r">filePath</span>))
                {
                    <span class="r564 r">localizedFile</span> = <span class="r568 r">filePath</span>;
                    <b>break</b>;
                }
 
                <span class="r566 r">currentCulture</span> = <span class="r566 r">currentCulture</span>.<span class="i">Parent</span>;
            }
 
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r569 rd" class="r569 r">result</span> = <b>null</b>;
            <b>if</b> (<span class="r564 r">localizedFile</span> != <b>null</b>)
            {
                <span class="r569 r">result</span> = <b>new</b> <span class="t">ExternalScriptInfo</span>(<span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r564 r">localizedFile</span>), <span class="r564 r">localizedFile</span>);
            }
 
            <b>return</b> <span class="r569 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks to see if the module manifest contains the specified key.</span>
        <span class="c">///</span><span class="c"> If it does and it&#39;s valid, it returns true otherwise it returns false.</span>
        <span class="c">///</span><span class="c"> If the key wasn&#39;t there or wasn&#39;t valid, then </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r570 r">list</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">null</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r571 r">data</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The hashtable to look for the key in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r572 r">moduleManifestPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest that generated the hashtable.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r573 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The table key to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r574 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies how to treat errors and whether to load elements.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r570 r">list</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Returns the extracted version.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="8cfdef9fa75e1f79" href="../../R/8cfdef9fa75e1f79.html" target="n" data-glyph="74,1" class="i method">GetListOfStringsFromData</a>(
            <span class="i">Hashtable</span> <span id="r571 rd" class="r571 r">data</span>,
            <b>string</b> <span id="r572 rd" class="r572 r">moduleManifestPath</span>,
            <b>string</b> <span id="r573 rd" class="r573 r">key</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r574 rd" class="r574 r">manifestProcessingFlags</span>,
            <b>out</b> <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r570 rd" class="r570 r">list</span>)
        {
            <span class="r570 r">list</span> = <b>null</b>;
            <b>if</b> (<span class="r571 r">data</span>.<span class="i">Contains</span>(<span class="r573 r">key</span>))
            {
                <b>if</b> (<span class="r571 r">data</span>[<span class="r573 r">key</span>] != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <b>string</b>[] <span id="r575 rd" class="r575 r">stringData</span> = (<b>string</b>[])<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r571 r">data</span>[<span class="r573 r">key</span>], <b>typeof</b>(<b>string</b>[]), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                        <span class="r570 r">list</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;(<span class="r575 r">stringData</span>);
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r576 rd" class="r576 r">e</span>)
                    {
                        <a href="#4d234a6fa0233244" class="i method">WriteInvalidManifestMemberError</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>, <span class="r573 r">key</span>, <span class="r572 r">moduleManifestPath</span>, <span class="r576 r">e</span>, <span class="r574 r">manifestProcessingFlags</span>);
                        <b>return</b> <b>false</b>;
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks to see if the module manifest contains the specified key.</span>
        <span class="c">///</span><span class="c"> If it does and it&#39;s valid, it returns true otherwise it returns false.</span>
        <span class="c">///</span><span class="c"> If the key wasn&#39;t there or wasn&#39;t valid, then </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r577 r">list</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">null</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r578 r">data</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The hashtable to look for the key in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r579 r">moduleManifestPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest that generated the hashtable.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r580 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The table key to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r581 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies how to treat errors and whether to load elements.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r577 r">list</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Returns the extracted version.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="b862ed2850894194" href="../../R/b862ed2850894194.html" target="n" data-glyph="76,1" class="i method">GetListOfWildcardsFromData</a>(
            <span class="i">Hashtable</span> <span id="r578 rd" class="r578 r">data</span>,
            <b>string</b> <span id="r579 rd" class="r579 r">moduleManifestPath</span>,
            <b>string</b> <span id="r580 rd" class="r580 r">key</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r581 rd" class="r581 r">manifestProcessingFlags</span>,
            <b>out</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r577 rd" class="r577 r">list</span>)
        {
            <span class="r577 r">list</span> = <b>null</b>;
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r582 rd" class="r582 r">listOfStrings</span>;
            <b>if</b> (!<a href="#8cfdef9fa75e1f79" class="i method">GetListOfStringsFromData</a>(<span class="r578 r">data</span>, <span class="r579 r">moduleManifestPath</span>, <span class="r580 r">key</span>, <span class="r581 r">manifestProcessingFlags</span>, <b>out</b> <span class="r582 r">listOfStrings</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<span class="r582 r">listOfStrings</span> != <b>null</b>)
            {
                <span class="r577 r">list</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <b>foreach</b> (<b>string</b> <span id="r583 rd" class="r583 r">s</span> <b>in</b> <span class="r582 r">listOfStrings</span>)
                {
                    <span class="c">// Win8: 622263</span>
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r583 r">s</span>))
                    {
                        <b>continue</b>;
                    }
 
                    <b>try</b>
                    {
                        <span class="r577 r">list</span>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r583 r">s</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r584 rd" class="r584 r">e</span>)
                    {
                        <span class="r577 r">list</span> = <b>null</b>;
                        <a href="#4d234a6fa0233244" class="i method">WriteInvalidManifestMemberError</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>, <span class="r580 r">key</span>, <span class="r579 r">moduleManifestPath</span>, <span class="r584 r">e</span>, <span class="r581 r">manifestProcessingFlags</span>);
                        <b>return</b> <b>false</b>;
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks to see if the module manifest contains the specified key.</span>
        <span class="c">///</span><span class="c"> If it does and it&#39;s valid, it returns true otherwise it returns false.</span>
        <span class="c">///</span><span class="c"> If the key wasn&#39;t there or wasn&#39;t valid, then </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r585 r">list</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">null</span><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r586 r">data</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The hashtable to look for the key in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r587 r">moduleManifestPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest that generated the hashtable.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r325 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The table key to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r588 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies how to treat errors and whether to load elements.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r589 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Base directory of a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r326 r">extension</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Expected file extension (added to strings that didn&#39;t have an extension).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r327 r">verifyFilesExist</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> then we want to error out if the specified files don&#39;t exist.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r585 r">list</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Returns the extracted version.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="97a01907bee1ce21" href="../../R/97a01907bee1ce21.html" target="n" data-glyph="76,1" class="i method">GetListOfFilesFromData</a>(
            <span class="i">Hashtable</span> <span id="r586 rd" class="r586 r">data</span>,
            <b>string</b> <span id="r587 rd" class="r587 r">moduleManifestPath</span>,
            <b>string</b> <span id="r325 rd" class="r325 r">key</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r588 rd" class="r588 r">manifestProcessingFlags</span>,
            <b>string</b> <span id="r589 rd" class="r589 r">moduleBase</span>,
            <b>string</b> <span id="r326 rd" class="r326 r">extension</span>,
            <b>bool</b> <span id="r327 rd" class="r327 r">verifyFilesExist</span>,
            <b>out</b> <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r585 rd" class="r585 r">list</span>)
        {
            <span class="r585 r">list</span> = <b>null</b>;
 
            <b>bool</b> <span id="r590 rd" class="r590 r">importingModule</span> = <span class="r588 r">manifestProcessingFlags</span>.<span class="i">HasFlag</span>(<a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>);
            <b>if</b> (!<a href="#8cfdef9fa75e1f79" class="i method">GetListOfStringsFromData</a>(<span class="r586 r">data</span>, <span class="r587 r">moduleManifestPath</span>, <span class="r325 r">key</span>, <span class="r588 r">manifestProcessingFlags</span>, <b>out</b> <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r591 rd" class="r591 r">listOfStrings</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<span class="r591 r">listOfStrings</span> != <b>null</b>)
            {
                <b>var</b> <span id="r592 rd" class="r592 r">psHome</span> = <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>;
                <b>string</b> <span id="r593 rd" class="r593 r">alternateDirToCheck</span> = <b>null</b>;
                <b>if</b> (<span class="r589 r">moduleBase</span>.<span class="i">StartsWith</span>(<span class="r592 r">psHome</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="c">// alternateDirToCheck is an ugly hack for how Microsoft.PowerShell.Diagnostics and</span>
                    <span class="c">// Microsoft.WSMan.Management refer to the ps1xml that was in $PSHOME but removed.</span>
                    <span class="r593 r">alternateDirToCheck</span> = <span class="r589 r">moduleBase</span> + <span class="s">&quot;\\..\\..&quot;</span>;
                }
 
                <span class="r585 r">list</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                <b>foreach</b> (<b>string</b> <span id="r594 rd" class="r594 r">s</span> <b>in</b> <span class="r591 r">listOfStrings</span>)
                {
                    <b>try</b>
                    {
                        <b>string</b> <span id="r595 rd" class="r595 r">fixedFileName</span> = <a href="#e9bd2692fdacdb9e" class="i method">FixupFileName</a>(<span class="r589 r">moduleBase</span>, <span class="r594 r">s</span>, <span class="r326 r">extension</span>, <span class="r590 r">importingModule</span>, <span class="r596 r">skipLoading</span>: <b>true</b>);
                        <b>var</b> <span id="r597 rd" class="r597 r">dir</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r595 r">fixedFileName</span>);
 
                        <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r592 r">psHome</span>, <span class="r597 r">dir</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                            (<span class="r593 r">alternateDirToCheck</span> != <b>null</b> &amp;&amp; <b>string</b>.<span class="i">Equals</span>(<span class="r593 r">alternateDirToCheck</span>, <span class="r597 r">dir</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                        {
                            <span class="c">// The ps1xml file no longer exists in $PSHOME.  Downstream, we expect a resolved path,</span>
                            <span class="c">// which we can&#39;t really do b/c the file doesn&#39;t exist.</span>
                            <span class="r595 r">fixedFileName</span> = <span class="r592 r">psHome</span> + <span class="s">&quot;\\&quot;</span> + <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r594 r">s</span>);
                        }
                        <b>else</b> <b>if</b> (<span class="r327 r">verifyFilesExist</span> &amp;&amp; !<span class="i">File</span>.<span class="i">Exists</span>(<span class="r595 r">fixedFileName</span>))
                        {
                            <b>string</b> <span id="r598 rd" class="r598 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">SessionStateStrings</span>.<span class="i">PathNotFound</span>, <span class="r595 r">fixedFileName</span>);
                            <b>throw</b> <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r598 r">message</span>, <span class="r595 r">fixedFileName</span>);
                        }
 
                        <span class="r585 r">list</span>.<span class="i">Add</span>(<span class="r595 r">fixedFileName</span>);
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r599 rd" class="r599 r">e</span>)
                    {
                        <b>if</b> (<span class="r588 r">manifestProcessingFlags</span>.<span class="i">HasFlag</span>(<a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>))
                        {
                            <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<a href="#c362eeb1b8f5bddb" class="i method">GenerateInvalidModuleMemberErrorRecord</a>(<span class="r325 r">key</span>, <span class="r587 r">moduleManifestPath</span>, <span class="r599 r">e</span>));
                        }
 
                        <span class="r585 r">list</span> = <b>null</b>;
                        <a href="#4d234a6fa0233244" class="i method">WriteInvalidManifestMemberError</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>, <span class="r325 r">key</span>, <span class="r587 r">moduleManifestPath</span>, <span class="r599 r">e</span>, <span class="r588 r">manifestProcessingFlags</span>);
                        <b>return</b> <b>false</b>;
                    }
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        [<span class="i">Flags</span>]
        <b>internal enum</b> <a id="877a32efd6bd0f23" href="../../R/877a32efd6bd0f23.html" target="n" data-glyph="20,1" class="t t"><span id="c2965430172a5f6c">ModuleLoggingGroupPolicyStatus</span></a>
        {
            <a id="a1eb324b392b550f" href="../../R/a1eb324b392b550f.html" target="n" data-glyph="24,2" class="i field">Undefined</a> = 0x00,
            <a id="3a381265e4143f74" href="../../R/3a381265e4143f74.html" target="n" data-glyph="24,2" class="i field">Enabled</a> = 0x01,
            <a id="9bce5592115ac3b4" href="../../R/9bce5592115ac3b4.html" target="n" data-glyph="24,2" class="i field">Disabled</a> = 0x02,
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Enable Module logging based on group policy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="180d2b67fc813ae6" href="../../R/180d2b67fc813ae6.html" target="n" data-glyph="74,1" class="i method">SetModuleLoggingInformation</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r600 rd" class="r600 r">m</span>)
        {
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r601 rd" class="r601 r">moduleNames</span>;
            <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a> <span id="r602 rd" class="r602 r">status</span> = <a href="#85b1c26ca08c7b07" class="i method">GetModuleLoggingInformation</a>(<b>out</b> <span class="r601 r">moduleNames</span>);
            <b>if</b> (<span class="r602 r">status</span> != <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a>.<a href="#a1eb324b392b550f" class="i field">Undefined</a>)
            {
                <a href="#9d6d79ada189f436" class="i method">SetModuleLoggingInformation</a>(<span class="r602 r">status</span>, <span class="r600 r">m</span>, <span class="r601 r">moduleNames</span>);
            }
        }
 
        <b>private static void</b> <a id="9d6d79ada189f436" href="../../R/9d6d79ada189f436.html" target="n" data-glyph="76,1" class="i method">SetModuleLoggingInformation</a>(<a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a> <span id="r603 rd" class="r603 r">status</span>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r604 rd" class="r604 r">m</span>, <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r605 rd" class="r605 r">moduleNames</span>)
        {
            <span class="c">// TODO, insivara : What happens when Enabled but none of the other options (DefaultSystemModules, NonDefaultSystemModule, NonSystemModule, SpecificModules) are set?</span>
            <span class="c">// After input from GP team for this behavior, need to revisit the commented out part</span>
            <span class="c">// if ((status &amp; ModuleLoggingGroupPolicyStatus.Enabled) != 0)</span>
            <span class="c">// {</span>
            <span class="c">// }</span>
            <b>if</b> (((<span class="r603 r">status</span> &amp; <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a>.<a href="#3a381265e4143f74" class="i field">Enabled</a>) != 0) &amp;&amp; <span class="r605 r">moduleNames</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>string</b> <span id="r606 rd" class="r606 r">currentGPModuleName</span> <b>in</b> <span class="r605 r">moduleNames</span>)
                {
                    <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r604 r">m</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r606 r">currentGPModuleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r604 r">m</span>.<a href="PSModuleInfo.cs.html#6fe1eefd0a6636c9" class="i property">LogPipelineExecutionDetails</a> = <b>true</b>;
                    }
                    <b>else</b> <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r606 r">currentGPModuleName</span>))
                    {
                        <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a> <span id="r607 rd" class="r607 r">wildcard</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r606 r">currentGPModuleName</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>);
                        <b>if</b> (<span class="r607 r">wildcard</span>.<a href="../regex.cs.html#02e7d1c913f3c256" class="i method">IsMatch</a>(<span class="r604 r">m</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>))
                        {
                            <span class="r604 r">m</span>.<a href="PSModuleInfo.cs.html#6fe1eefd0a6636c9" class="i property">LogPipelineExecutionDetails</a> = <b>true</b>;
                        }
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get Module Logging information from the group policy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a> <a id="85b1c26ca08c7b07" href="../../R/85b1c26ca08c7b07.html" target="n" data-glyph="74,1" class="i method">GetModuleLoggingInformation</a>(<b>out</b> <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r608 rd" class="r608 r">moduleNames</span>)
        {
            <span class="r608 r">moduleNames</span> = <b>null</b>;
            <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a> <span id="r609 rd" class="r609 r">status</span> = <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a>.<a href="#a1eb324b392b550f" class="i field">Undefined</a>;
 
            <a href="../PSConfiguration.cs.html#6a0db7ae0b44cb93" class="k">var</a> <span id="r610 rd" class="r610 r">moduleLogging</span> = <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#fb031837cf810b13" class="i method">GetPolicySetting</a>&lt;<a href="../PSConfiguration.cs.html#6a0db7ae0b44cb93" class="t t">ModuleLogging</a>&gt;(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#7a2ef29ad39fd97e" class="i field">SystemWideThenCurrentUserConfig</a>);
            <b>if</b> (<span class="r610 r">moduleLogging</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r610 r">moduleLogging</span>.<a href="../PSConfiguration.cs.html#5aefa87f5b75f17f" class="i property">EnableModuleLogging</a> == <b>false</b>)
                {
                    <span class="r609 r">status</span> = <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a>.<a href="#9bce5592115ac3b4" class="i field">Disabled</a>;
                }
                <b>else</b> <b>if</b> (<span class="r610 r">moduleLogging</span>.<a href="../PSConfiguration.cs.html#5aefa87f5b75f17f" class="i property">EnableModuleLogging</a> == <b>true</b>)
                {
                    <span class="r609 r">status</span> = <a href="#877a32efd6bd0f23" class="t t">ModuleLoggingGroupPolicyStatus</a>.<a href="#3a381265e4143f74" class="i field">Enabled</a>;
                    <span class="r608 r">moduleNames</span> = <span class="r610 r">moduleLogging</span>.<a href="../PSConfiguration.cs.html#4370c7dc54327998" class="i property">ModuleNames</a>;
                }
            }
 
            <b>return</b> <span class="r609 r">status</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks to see if the module manifest contains the specified key.</span>
        <span class="c">///</span><span class="c"> If it does and it can be converted to the expected type, then it returns </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and sets </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r611 r">result</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to the value.</span>
        <span class="c">///</span><span class="c"> If the key is missing it returns </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and sets </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r611 r">result</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">default(</span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r612 r t">T</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">)</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> If the key is invalid then it returns </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r613 r">data</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The hashtable to look for the key in.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r614 r">moduleManifestPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest that generated the hashtable.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r615 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The table key to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r616 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies how to treat errors and whether to load elements.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r611 r">result</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Value from the manifest converted to the right type.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">true</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if success; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">false</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if there were errors.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="a28bdc3629cd8300" href="../../R/a28bdc3629cd8300.html" target="n" data-glyph="74,1" class="i method">GetScalarFromData</a>&lt;<span id="r612 rd t" class="r612 r t">T</span>&gt;(
            <span class="i">Hashtable</span> <span id="r613 rd" class="r613 r">data</span>,
            <b>string</b> <span id="r614 rd" class="r614 r">moduleManifestPath</span>,
            <b>string</b> <span id="r615 rd" class="r615 r">key</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r616 rd" class="r616 r">manifestProcessingFlags</span>,
            <b>out</b> <span class="r612 r t">T</span> <span id="r611 rd" class="r611 r">result</span>)
        {
            <b>object</b> <span id="r617 rd" class="r617 r">value</span> = <span class="r613 r">data</span>[<span class="r615 r">key</span>];
            <b>if</b> ((<span class="r617 r">value</span> == <b>null</b>) || (<span class="r617 r">value</span> <b>is string</b> &amp;&amp; <b>string</b>.<span class="i">IsNullOrEmpty</span>((<b>string</b>)<span class="r617 r">value</span>)))
            {
                <span class="r611 r">result</span> = <b>default</b>(<span class="r612 r t">T</span>);
                <b>return</b> <b>true</b>;
            }
 
            <b>try</b>
            {
                <span class="r611 r">result</span> = (<span class="r612 r t">T</span>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r617 r">value</span>, <b>typeof</b>(<span class="r612 r t">T</span>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                <b>return</b> <b>true</b>;
            }
            <b>catch</b> (<a href="../ExtendedTypeSystemException.cs.html#d39d66bdddfa507c" class="t t">PSInvalidCastException</a> <span id="r618 rd" class="r618 r">e</span>)
            {
                <span class="r611 r">result</span> = <b>default</b>(<span class="r612 r t">T</span>);
                <b>if</b> ((<span class="r616 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>) != 0)
                {
                    <b>string</b> <span id="r619 rd" class="r619 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleManifestInvalidValue</span>, <span class="r615 r">key</span>, <span class="r618 r">e</span>.<span class="i">Message</span>, <span class="r614 r">moduleManifestPath</span>);
                    <span class="i">ArgumentException</span> <span id="r620 rd" class="r620 r">newAe</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="r619 r">message</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r621 rd" class="r621 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r620 r">newAe</span>, <span class="s">&quot;Modules_InvalidManifest&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r614 r">moduleManifestPath</span>);
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r621 r">er</span>);
                }
 
                <b>return</b> <b>false</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A utility routine to fix up a file name so it&#39;s rooted and has an extension.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="e9bd2692fdacdb9e" href="../../R/e9bd2692fdacdb9e.html" target="n" data-glyph="74,1" class="i method">FixupFileName</a>(<b>string</b> <span id="r622 rd" class="r622 r">moduleBase</span>, <b>string</b> <span id="r623 rd" class="r623 r">name</span>, <b>string</b> <span id="r624 rd" class="r624 r">extension</span>, <b>bool</b> <span id="r625 rd" class="r625 r">isImportingModule</span>, <b>bool</b> <span id="r596 rd" class="r596 r">skipLoading</span> = <b>false</b>)
        {
            <b>return</b> <a href="#0f3db74aeb9a113d" class="i method">FixupFileName</a>(<span class="r622 r">moduleBase</span>, <span class="r623 r">name</span>, <span class="r624 r">extension</span>, <span class="r625 r">isImportingModule</span>, <span class="r626 r">pathIsResolved</span>: <b>out _</b>, <span class="r596 r">skipLoading</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A utility routine to fix up a file name so it&#39;s rooted and has an extension.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When fixing up an assembly file, this method loads the resovled assembly if it&#39;s in the process of actually loading a module.</span>
        <span class="c">///</span><span class="c"> Read the comments in the method for the detailed information.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r627 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The base path to use if the file is not rooted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r628 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file name to resolve.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r629 r">extension</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The extension to use in case the given name has no extension.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r630 r">isImportingModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Indicate if we are loading a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r626 r">pathIsResolved</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Indicate if the returned path is fully resolved.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r631 r">skipLoading</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Indicate if the resolved module should be loaded.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The resolved file path. Or, the combined path of </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r627 r">moduleBase</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r628 r">name</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> when the file path cannot be resolved.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="0f3db74aeb9a113d" href="../../R/0f3db74aeb9a113d.html" target="n" data-glyph="74,1" class="i method">FixupFileName</a>(<b>string</b> <span id="r627 rd" class="r627 r">moduleBase</span>, <b>string</b> <span id="r628 rd" class="r628 r">name</span>, <b>string</b> <span id="r629 rd" class="r629 r">extension</span>, <b>bool</b> <span id="r630 rd" class="r630 r">isImportingModule</span>, <b>out bool</b> <span id="r626 rd" class="r626 r">pathIsResolved</span>, <b>bool</b> <span id="r631 rd" class="r631 r">skipLoading</span> = <b>false</b>)
        {
            <span class="r626 r">pathIsResolved</span> = <b>false</b>;
            <b>string</b> <span id="r632 rd" class="r632 r">originalName</span> = <span class="r628 r">name</span>;
            <b>string</b> <span id="r633 rd" class="r633 r">originalExt</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r628 r">name</span>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r633 r">originalExt</span>))
            {
                <span class="r628 r">name</span> += <span class="r629 r">extension</span>;
            }
 
            <span class="c">// Try to get the resolved fully qualified path to the file.</span>
            <span class="c">// Note that, the &#39;IsRooted&#39; method also returns true for relative paths, in which case we need to check for &#39;combinedPath&#39; as well.</span>
            <span class="c">//  * For example, the &#39;Microsoft.WSMan.Management.psd1&#39; in Windows PowerShell defines &#39;FormatsToProcess=&quot;..\..\WSMan.format.ps1xml&quot;&#39;.</span>
            <span class="c">//  * For such a module, we will have the following input when reaching this method:</span>
            <span class="c">//     - moduleBase = &#39;C:\Windows\System32\WindowsPowerShell\v1.0\Modules\Microsoft.WSMan.Management&#39;</span>
            <span class="c">//     - name = &#39;..\..\WSMan.format.ps1xml&#39;</span>
            <span class="c">//    Check for combinedPath in this case will get us the normalized rooted path &#39;C:\Windows\System32\WindowsPowerShell\v1.0\WSMan.format.ps1xml&#39;.</span>
            <span class="c">// The &#39;Microsoft.WSMan.Management&#39; module in PowerShell was updated to not use the relative path for &#39;FormatsToProcess&#39; entry,</span>
            <span class="c">// but it&#39;s safer to keep the original behavior to avoid unexpected breaking changes.</span>
            <b>string</b> <span id="r634 rd" class="r634 r">combinedPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r627 r">moduleBase</span>, <span class="r628 r">name</span>);
            <b>string</b> <span id="r635 rd" class="r635 r">resolvedPath</span> = <a href="#c551402094596acc" class="i method">IsRooted</a>(<span class="r628 r">name</span>)
                ? <a href="#9910dbba4c162701" class="i method">ResolveRootedFilePath</a>(<span class="r628 r">name</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>) ?? <a href="#9910dbba4c162701" class="i method">ResolveRootedFilePath</a>(<span class="r634 r">combinedPath</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>)
                : <a href="#9910dbba4c162701" class="i method">ResolveRootedFilePath</a>(<span class="r634 r">combinedPath</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
 
            <span class="c">// Return the path if successfully resolved.</span>
            <b>if</b> (<span class="r635 r">resolvedPath</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r630 r">isImportingModule</span> &amp;&amp; <span class="r635 r">resolvedPath</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.dll&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp; !<span class="r631 r">skipLoading</span>)
                {
                    <span class="c">// If we are fixing up an assembly file path and we are actually loading the module, then we load the resolved assembly file here.</span>
                    <span class="c">// This is because we process type/format ps1xml files before &#39;RootModule&#39; and &#39;NestedModules&#39; entries during the module loading.</span>
                    <span class="c">// A types.ps1xml file could refer to a type defined in the assembly that is specified in the &#39;RootModule&#39; or &#39;NestedModule&#39;, and</span>
                    <span class="c">// in that case, processing the types.ps1xml file would fail because it happens before processing the &#39;RootModule&#39;, which loads</span>
                    <span class="c">// the assembly. We cannot move the processing of types.ps1xml file after processing &#39;RootModule&#39; either, because the &#39;RootModule&#39;</span>
                    <span class="c">// might refer to members defined in the types.ps1xml file. In order to make it work for this paradox, we have to load the resolved</span>
                    <span class="c">// assembly when we are actually loading the module. However, when it&#39;s module analysis, there is no need to load the assembly.</span>
                    <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#1b77723bbe47e4db" class="i method">LoadAssembly</a>(<span class="r636 r">name</span>: <b>null</b>, <span class="r637 r">filename</span>: <span class="r635 r">resolvedPath</span>, <span class="r638 r">error</span>: <b>out _</b>);
                }
 
                <span class="r626 r">pathIsResolved</span> = <b>true</b>;
                <b>return</b> <span class="r635 r">resolvedPath</span>;
            }
 
            <span class="c">// Path resolution failed, use the combined path as default.</span>
            <b>string</b> <span id="r639 rd" class="r639 r">result</span> = <span class="r634 r">combinedPath</span>;
 
            <span class="c">// For dlls, we cannot get the path from the provider.</span>
            <span class="c">// We need to load the assembly and then get the path.</span>
            <span class="c">// If the module is already loaded, this is not expensive since the assembly is already loaded in the AppDomain</span>
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r629 r">extension</span>) &amp;&amp;
                (<span class="r629 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                <span class="r629 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
            {
                <span class="i">Assembly</span> <span id="r640 rd" class="r640 r">assembly</span> = <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#1b77723bbe47e4db" class="i method">LoadAssembly</a>(<span class="r636 r">name</span>: <span class="r632 r">originalName</span>, <span class="r637 r">filename</span>: <b>null</b>, <span class="r638 r">error</span>: <b>out _</b>);
                <b>if</b> (<span class="r640 r">assembly</span> != <b>null</b>)
                {
                    <span class="r626 r">pathIsResolved</span> = <b>true</b>;
                    <span class="r639 r">result</span> = <span class="r640 r">assembly</span>.<span class="i">Location</span>;
                }
            }
 
            <b>return</b> <span class="r639 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A utility routine to fix up a file name, if it is relative path convert it to absolute path combining moduleBase, if it is not a relative path, leave as it is.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r641 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The base path to use if the file is not rooted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r642 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file name to resolve.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="c656b417b182388e" href="../../R/c656b417b182388e.html" target="n" data-glyph="74,1" class="i method">GetAbsolutePath</a>(<b>string</b> <span id="r641 rd" class="r641 r">moduleBase</span>, <b>string</b> <span id="r642 rd" class="r642 r">path</span>)
        {
            <b>if</b> (!<a href="#c551402094596acc" class="i method">IsRooted</a>(<span class="r642 r">path</span>) &amp;&amp; (<span class="r642 r">path</span>.<span class="i">Contains</span>(<span class="s">&#39;/&#39;</span>) || <span class="r642 r">path</span>.<span class="i">Contains</span>(<span class="s">&#39;\\&#39;</span>)))
            {
                <b>return</b> <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r641 r">moduleBase</span>, <span class="r642 r">path</span>);
            }
            <b>else</b>
            {
                <b>return</b> <span class="r642 r">path</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a path is rooted or &quot;relative rooted&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r643 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file path to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the path is rooted, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="c551402094596acc" href="../../R/c551402094596acc.html" target="n" data-glyph="74,1" class="i method">IsRooted</a>(<b>string</b> <span id="r643 rd" class="r643 r">filePath</span>)
        {
            <b>return</b> (<span class="i">Path</span>.<span class="i">IsPathRooted</span>(<span class="r643 r">filePath</span>) ||
                <span class="r643 r">filePath</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;.\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                <span class="r643 r">filePath</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;./&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                <span class="r643 r">filePath</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;..\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                <span class="r643 r">filePath</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;../&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                <span class="r643 r">filePath</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;~/&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                <span class="r643 r">filePath</span>.<span class="i">StartsWith</span>(<span class="s">@&quot;~\&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                <span class="r643 r">filePath</span>.<span class="i">Contains</span>(<span class="s">&#39;:&#39;</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This utility resolves a rooted file name using the provider</span>
        <span class="c">///</span><span class="c"> routines. It will only work if the path exists.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r644 r">filePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The filename to resolve.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r645 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The resolved filename.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="9910dbba4c162701" href="../../R/9910dbba4c162701.html" target="n" data-glyph="74,1" class="i method">ResolveRootedFilePath</a>(<b>string</b> <span id="r644 rd" class="r644 r">filePath</span>, <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r645 rd" class="r645 r">context</span>)
        {
            <span class="c">// If the path is not fully qualified or relative rooted, then</span>
            <span class="c">// we need to do path-based resolution...</span>
            <b>if</b> (!<a href="#c551402094596acc" class="i method">IsRooted</a>(<span class="r644 r">filePath</span>))
            {
                <b>return</b> <b>null</b>;
            }
 
            <a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r646 rd" class="r646 r">provider</span> = <b>null</b>;
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r647 rd" class="r647 r">filePaths</span> = <b>null</b>;
 
            <b>if</b> (<span class="r645 r">context</span>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateProviderAPIs.cs.html#dc359a601ce02a89" class="i method">IsProviderLoaded</a>(<span class="r645 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
            {
                <b>try</b>
                {
                    <span class="r647 r">filePaths</span> =
                        <span class="r645 r">context</span>.<a href="../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../PathInterfaces.cs.html#4931b2e78f6aaef1" class="i method">GetResolvedProviderPathFromPSPath</a>(<span class="r644 r">filePath</span>, <b>out</b> <span class="r646 r">provider</span>);
                }
                <b>catch</b> (<a href="../../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a>)
                {
                    <b>return</b> <b>null</b>;
                }
 
                <span class="c">// Make sure that the path is in the file system - that&#39;s all we can handle currently...</span>
                <b>if</b> (!<span class="r646 r">provider</span>.<a href="../DataStoreAdapterProvider.cs.html#13e2cce7adaad137" class="i method">NameEquals</a>(<span class="r645 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
                {
                    <span class="c">// &quot;The current provider ({0}) cannot open a file&quot;</span>
                    <b>throw</b> <a href="../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(
                        <span class="r644 r">filePath</span>,
                        <b>typeof</b>(<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                        <span class="i">errorPosition</span>: <b>null</b>,
                        <span class="s">&quot;FileOpenError&quot;</span>,
                        <span class="i">ParserStrings</span>.<span class="i">FileOpenError</span>,
                        <span class="r646 r">provider</span>.<a href="../DataStoreAdapterProvider.cs.html#91a8d08ee3ba5a61" class="i property">FullName</a>);
                }
            }
 
            <span class="c">// Make sure at least one file was found...</span>
            <b>if</b> (<span class="r647 r">filePaths</span> == <b>null</b> || <span class="r647 r">filePaths</span>.<span class="i">Count</span> &lt; 1)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>if</b> (<span class="r647 r">filePaths</span>.<span class="i">Count</span> &gt; 1)
            {
                <span class="c">// &quot;The path resolved to more than one file; can only process one file at a time.&quot;</span>
                <b>throw</b> <a href="../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(
                    <span class="r647 r">filePaths</span>,
                    <b>typeof</b>(<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                    <span class="i">errorPosition</span>: <b>null</b>,
                    <span class="s">&quot;AmbiguousPath&quot;</span>,
                    <span class="i">ParserStrings</span>.<span class="i">AmbiguousPath</span>);
            }
 
            <b>return</b> <span class="r647 r">filePaths</span>[0];
        }
 
        <b>internal static string</b> <a id="7c03df577cede1d9" href="../../R/7c03df577cede1d9.html" target="n" data-glyph="74,1" class="i method">GetResolvedPath</a>(<b>string</b> <span id="r648 rd" class="r648 r">filePath</span>, <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r649 rd" class="r649 r">context</span>)
        {
            <a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r650 rd" class="r650 r">provider</span> = <b>null</b>;
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r651 rd" class="r651 r">filePaths</span>;
 
            <b>if</b> (<span class="r649 r">context</span> != <b>null</b> &amp;&amp; <span class="r649 r">context</span>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> != <b>null</b> &amp;&amp; <span class="r649 r">context</span>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateProviderAPIs.cs.html#dc359a601ce02a89" class="i method">IsProviderLoaded</a>(<span class="r649 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
            {
                <b>try</b>
                {
                    <span class="r651 r">filePaths</span> = <span class="r649 r">context</span>.<a href="../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../PathInterfaces.cs.html#7580746f57c42c18" class="i method">GetResolvedProviderPathFromPSPath</a>(<span class="r648 r">filePath</span>, <b>true</b> <span class="c">/* allowNonExistentPaths */</span>, <b>out</b> <span class="r650 r">provider</span>);
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                    <b>return</b> <b>null</b>;
                }
                <span class="c">// Make sure that the path is in the file system - that&#39;s all we can handle currently...</span>
                <b>if</b> ((<span class="r650 r">provider</span> == <b>null</b>) || !<span class="r650 r">provider</span>.<a href="../DataStoreAdapterProvider.cs.html#13e2cce7adaad137" class="i method">NameEquals</a>(<span class="r649 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
                {
                    <b>return</b> <b>null</b>;
                }
            }
            <b>else</b>
            {
                <span class="r651 r">filePaths</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
                <span class="r651 r">filePaths</span>.<span class="i">Add</span>(<span class="r648 r">filePath</span>);
            }
 
            <span class="c">// Make sure at least one file was found...</span>
            <b>if</b> (<span class="r651 r">filePaths</span> == <b>null</b> || <span class="r651 r">filePaths</span>.<span class="i">Count</span> &lt; 1 || <span class="r651 r">filePaths</span>.<span class="i">Count</span> &gt; 1)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r651 r">filePaths</span>[0];
        }
 
        <b>internal static</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="66e94f47496102bb" href="../../R/66e94f47496102bb.html" target="n" data-glyph="74,1" class="i method">GetResolvedPathCollection</a>(<b>string</b> <span id="r652 rd" class="r652 r">filePath</span>, <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r653 rd" class="r653 r">context</span>)
        {
            <a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r654 rd" class="r654 r">provider</span> = <b>null</b>;
 
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r655 rd" class="r655 r">filePaths</span>;
 
            <b>if</b> (<span class="r653 r">context</span> != <b>null</b> &amp;&amp; <span class="r653 r">context</span>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> != <b>null</b> &amp;&amp; <span class="r653 r">context</span>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateProviderAPIs.cs.html#dc359a601ce02a89" class="i method">IsProviderLoaded</a>(<span class="r653 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
            {
                <b>try</b>
                {
                    <span class="r655 r">filePaths</span> = <span class="r653 r">context</span>.<a href="../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../PathInterfaces.cs.html#7580746f57c42c18" class="i method">GetResolvedProviderPathFromPSPath</a>(<span class="r652 r">filePath</span>, <b>true</b> <span class="c">/* allowNonExistentPaths */</span>, <b>out</b> <span class="r654 r">provider</span>);
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                    <b>return</b> <b>null</b>;
                }
                <span class="c">// Make sure that the path is in the file system - that&#39;s all we can handle currently...</span>
                <b>if</b> ((<span class="r654 r">provider</span> == <b>null</b>) || !<span class="r654 r">provider</span>.<a href="../DataStoreAdapterProvider.cs.html#13e2cce7adaad137" class="i method">NameEquals</a>(<span class="r653 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
                {
                    <b>return</b> <b>null</b>;
                }
            }
            <b>else</b>
            {
                <span class="r655 r">filePaths</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
                <span class="r655 r">filePaths</span>.<span class="i">Add</span>(<span class="r652 r">filePath</span>);
            }
 
            <span class="c">// Make sure at least one file was found...</span>
            <b>if</b> (<span class="r655 r">filePaths</span> == <b>null</b> || <span class="r655 r">filePaths</span>.<span class="i">Count</span> &lt; 1)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r655 r">filePaths</span>;
        }
 
        <b>internal static</b> <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <a id="96ffcaa60fd462c5" href="../../R/96ffcaa60fd462c5.html" target="n" data-glyph="74,1" class="i method">GetWindowsPowerShellCompatRemotingSession</a>()
        {
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r656 rd" class="r656 r">result</span> = <b>null</b>;
            <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="k">var</a> <span id="r657 rd" class="r657 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Get-PSSession&quot;</span>, <b>typeof</b>(<a href="../remoting/commands/getrunspacecommand.cs.html#1ffcae79d01ec9a9" class="t t">GetPSSessionCommand</a>));
            <b>using</b> <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r658 rd" class="r658 r">ps</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>);
            <span class="r658 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#cc3df9bf3b89f740" class="i method">AddCommand</a>(<span class="r657 r">commandInfo</span>);
            <span class="r658 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <a href="#980fa20118d9db13" class="i field">WindowsPowerShellCompatRemotingSessionName</a>);
            <span class="r658 r">ps</span>.<span class="i">AddParameter</span>(<span class="s">&quot;ErrorAction&quot;</span>, <a href="../CommandBase.cs.html#18f88a0529e26331" class="t t">ActionPreference</a>.<a href="../CommandBase.cs.html#e7eef70977370b56" class="i field">Ignore</a>);
            <b>var</b> <span id="r659 rd" class="r659 r">results</span> = <span class="r658 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a>&gt;();
            <b>if</b> (<span class="r659 r">results</span>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r656 r">result</span> = <span class="r659 r">results</span>[0];
            }
            <b>return</b> <span class="r656 r">result</span>;
        }
 
        <b>internal static</b> <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <a id="068a38770652843f" href="../../R/068a38770652843f.html" target="n" data-glyph="74,1" class="i method">CreateWindowsPowerShellCompatResources</a>()
        {
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r660 rd" class="r660 r">compatSession</span> = <b>null</b>;
            <b>lock</b> (<a href="#53872d744916ac2d" class="i field">s_WindowsPowerShellCompatSyncObject</a>)
            {
                <span class="r660 r">compatSession</span> = <a href="#96ffcaa60fd462c5" class="i method">GetWindowsPowerShellCompatRemotingSession</a>();
                <b>if</b> (<span class="r660 r">compatSession</span> == <b>null</b>)
                {
                    <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="k">var</a> <span id="r661 rd" class="r661 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;New-PSSession&quot;</span>, <b>typeof</b>(<a href="../remoting/commands/newrunspacecommand.cs.html#04eb0ee815ea8d44" class="t t">NewPSSessionCommand</a>));
                    <b>using</b> <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r662 rd" class="r662 r">ps</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>);
                    <span class="r662 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#cc3df9bf3b89f740" class="i method">AddCommand</a>(<span class="r661 r">commandInfo</span>);
                    <span class="r662 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;UseWindowsPowerShell&quot;</span>, <b>true</b>);
                    <span class="r662 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <a href="#980fa20118d9db13" class="i field">WindowsPowerShellCompatRemotingSessionName</a>);
                    <b>var</b> <span id="r663 rd" class="r663 r">results</span> = <span class="r662 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#11053e110c66cae7" class="i method">Invoke</a>&lt;<a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a>&gt;();
                    <b>if</b> (<span class="r663 r">results</span>.<span class="i">Count</span> &gt; 0)
                    {
                        <span class="r660 r">compatSession</span> = <span class="r663 r">results</span>[0];
                        <span class="i n">System</span>.<span class="i">Threading</span>.<span class="i">Interlocked</span>.<span class="i">Exchange</span>(<b>ref</b> <a href="#7d80f8891e3a90f5" class="i field">s_WindowsPowerShellCompatUsageCounter</a>, 0);
                    }
                }
            }
 
            <b>return</b> <span class="r660 r">compatSession</span>;
        }
 
        <b>internal static void</b> <a id="8cbbd44f9757d7fc" href="../../R/8cbbd44f9757d7fc.html" target="n" data-glyph="74,1" class="i method">CleanupWindowsPowerShellCompatResources</a>(<a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r664 rd" class="r664 r">sessionState</span>)
        {
            <b>lock</b> (<a href="#53872d744916ac2d" class="i field">s_WindowsPowerShellCompatSyncObject</a>)
            {
                <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="k">var</a> <span id="r665 rd" class="r665 r">compatSession</span> = <a href="#96ffcaa60fd462c5" class="i method">GetWindowsPowerShellCompatRemotingSession</a>();
                <b>if</b> (<span class="r665 r">compatSession</span> != <b>null</b>)
                {
                    <b>if</b> (<span class="r664 r">sessionState</span>?.<a href="../SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#6884bea45b32a31e" class="i property">LocationChangedAction</a> != <b>null</b>)
                    {
                        <span class="r664 r">sessionState</span>.<a href="../SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#6884bea45b32a31e" class="i property">LocationChangedAction</a> -= <a href="#8193fa238ac447ca" class="i field">SyncCurrentLocationDelegate</a>;
                    }
 
                    <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="k">var</a> <span id="r666 rd" class="r666 r">commandInfo</span> = <b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Remove-PSSession&quot;</span>, <b>typeof</b>(<a href="../remoting/commands/removerunspacecommand.cs.html#c06ffb3832334309" class="t t">RemovePSSessionCommand</a>));
                    <b>using</b> <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r667 rd" class="r667 r">ps</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>);
                    <span class="r667 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#cc3df9bf3b89f740" class="i method">AddCommand</a>(<span class="r666 r">commandInfo</span>);
                    <span class="r667 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Session&quot;</span>, <span class="r665 r">compatSession</span>);
                    <span class="r667 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#184e23c46120523e" class="i method">Invoke</a>();
                }
            }
        }
 
        <b>internal static void</b> <a id="609f9ff1fc8c51a6" href="../../R/609f9ff1fc8c51a6.html" target="n" data-glyph="74,1" class="i method">SyncCurrentLocationHandler</a>(<b>object</b> <span id="r668 rd" class="r668 r">sender</span>, <a href="../SessionStateLocationAPIs.cs.html#6d473c589e2e35cf" class="t t">LocationChangedEventArgs</a> <span id="r669 rd" class="r669 r">args</span>)
        {
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r670 rd" class="r670 r">compatSession</span> = <a href="#96ffcaa60fd462c5" class="i method">GetWindowsPowerShellCompatRemotingSession</a>();
            <b>if</b> (<span class="r670 r">compatSession</span>?.<a href="../remoting/client/remoterunspaceinfo.cs.html#9c20236793fb308a" class="i property">Runspace</a>.<a href="../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a> == <a href="../hostifaces/Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="../hostifaces/Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
            {
                <b>using</b> <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r671 rd" class="r671 r">ps</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>);
                <span class="r671 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#cc3df9bf3b89f740" class="i method">AddCommand</a>(<b>new</b> <span class="t">CmdletInfo</span>(<span class="s">&quot;Invoke-Command&quot;</span>, <b>typeof</b>(<a href="../remoting/commands/InvokeCommandCommand.cs.html#681287c2a35349b5" class="t t">InvokeCommandCommand</a>)));
                <span class="r671 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Session&quot;</span>, <span class="r670 r">compatSession</span>);
                <span class="r671 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;ScriptBlock&quot;</span>, <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<span class="i">Create</span>(<b>string</b>.<span class="i">Format</span>(<span class="s">&quot;Set-Location -Path &#39;{0}&#39;&quot;</span>, <span class="r669 r">args</span>.<a href="../SessionStateLocationAPIs.cs.html#6654bd2376ac96f4" class="i property">NewPath</a>.<a href="../../namespaces/PathInfo.cs.html#de00cd47bf0cf721" class="i property">Path</a>)));
                <span class="r671 r">ps</span>.<a href="../hostifaces/PowerShell.cs.html#184e23c46120523e" class="i method">Invoke</a>();
            }
        }
 
        <b>internal static</b> <span class="i n">System</span>.<span class="i">EventHandler</span>&lt;<a href="../SessionStateLocationAPIs.cs.html#6d473c589e2e35cf" class="t t">LocationChangedEventArgs</a>&gt; <a id="8193fa238ac447ca" href="../../R/8193fa238ac447ca.html" target="n" data-glyph="44,1" class="i field">SyncCurrentLocationDelegate</a>;
 
        <b>internal virtual</b> <span class="i">IList</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="ee865210bb2f5967" href="../../R/ee865210bb2f5967.html" target="n" data-glyph="74,1" class="i method">ImportModulesUsingWinCompat</a>(<span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r672 rd" class="r672 r">moduleNames</span>, <span class="i">IEnumerable</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r673 rd" class="r673 r">moduleFullyQualifiedNames</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r674 rd" class="r674 r">importModuleOptions</span>) { <b>throw</b> <b>new</b> <span class="i n">System</span>.<span class="i">NotImplementedException</span>(); }
 
        <b>private void</b> <a id="cb85ce94b03adee3" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">RemoveTypesAndFormatting</a>(
            <span class="i">IList</span>&lt;<b>string</b>&gt; <span id="r675 rd" class="r675 r">formatFilesToRemove</span>,
            <span class="i">IList</span>&lt;<b>string</b>&gt; <span id="r676 rd" class="r676 r">typeFilesToRemove</span>)
        {
            <b>try</b>
            {
                <b>if</b> (((<span class="r675 r">formatFilesToRemove</span> != <b>null</b>) &amp;&amp; <span class="r675 r">formatFilesToRemove</span>.<span class="i">Count</span> &gt; 0) ||
                    ((<span class="r676 r">typeFilesToRemove</span> != <b>null</b>) &amp;&amp; <span class="r676 r">typeFilesToRemove</span>.<span class="i">Count</span> &gt; 0))
                {
                    <b>bool</b> <span id="r677 rd" class="r677 r">oldRefreshTypeFormatSetting</span> = <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#97adcb7e4a250b21" class="i field">RefreshTypeAndFormatSetting</a>;
                    <b>try</b>
                    {
                        <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#97adcb7e4a250b21" class="i field">RefreshTypeAndFormatSetting</a> = <b>true</b>;
                        <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#52014912aaa46fe0" class="i method">RemoveTypesAndFormats</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r675 r">formatFilesToRemove</span>, <span class="r676 r">typeFilesToRemove</span>);
                    }
                    <b>finally</b>
                    {
                        <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2a82be710f3773ae" class="i property">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#97adcb7e4a250b21" class="i field">RefreshTypeAndFormatSetting</a> = <span class="r677 r">oldRefreshTypeFormatSetting</span>;
                    }
                }
            }
            <b>catch</b> (<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r678 rd" class="r678 r">rte</span>)
            {
                <b>string</b> <span id="r679 rd" class="r679 r">fullErrorId</span> = <span class="r678 r">rte</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../ErrorPackage.cs.html#80d40f16f77d32bb" class="i property">FullyQualifiedErrorId</a>;
                <b>if</b> (<span class="r679 r">fullErrorId</span>.<span class="i">Equals</span>(<span class="s">&quot;ErrorsUpdatingTypes&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>) ||
                    <span class="r679 r">fullErrorId</span>.<span class="i">Equals</span>(<span class="s">&quot;ErrorsUpdatingFormats&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
                {
                    <b>return</b>;
                }
 
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes a module from the session state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r680 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Module to remove.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="452f85accd76669f" href="../../R/452f85accd76669f.html" target="n" data-glyph="74,1" class="i method">RemoveModule</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r680 rd" class="r680 r">module</span>)
        {
            <a href="#4f55552600b2e634" class="i method">RemoveModule</a>(<span class="r680 r">module</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes a module from the session state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r681 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Module to remove.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r682 r">moduleNameInRemoveModuleCmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Module name specified in the cmdlet.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="4f55552600b2e634" href="../../R/4f55552600b2e634.html" target="n" data-glyph="74,1" class="i method">RemoveModule</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r681 rd" class="r681 r">module</span>, <b>string</b> <span id="r682 rd" class="r682 r">moduleNameInRemoveModuleCmdlet</span>)
        {
            <b>bool</b> <span id="r683 rd" class="r683 r">isTopLevelModule</span> = <b>false</b>;
 
            <span class="c">// if the module path is empty string, means it is a dynamically generated assembly.</span>
            <span class="c">// We have set the module path to be module name as key to make it unique, we need update here as well in case the module can be removed.</span>
            <b>if</b> (<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a> == <b>string</b>.<span class="i">Empty</span>)
            {
                <span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a> = <span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>;
            }
 
            <b>bool</b> <span id="r684 rd" class="r684 r">shouldModuleBeRemoved</span> = <a href="#da2f4be388aed84b" class="i method">ShouldModuleBeRemoved</a>(<span class="r681 r">module</span>, <span class="r682 r">moduleNameInRemoveModuleCmdlet</span>, <b>out</b> <span class="r683 r">isTopLevelModule</span>);
 
            <b>if</b> (<span class="r684 r">shouldModuleBeRemoved</span>)
            {
                <span class="c">// We don&#39;t check for dups in the remove list so it may already be removed</span>
                <b>if</b> (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">ContainsKey</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>))
                {
                    <span class="c">// We should try to run OnRemove as the very first thing</span>
                    <b>if</b> (<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#a91c0dfe9b197014" class="i property">OnRemove</a> != <b>null</b>)
                    {
                        <span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#a91c0dfe9b197014" class="i property">OnRemove</a>.<a href="../lang/scriptblock.cs.html#0b3de91b4076a6c3" class="i method">InvokeUsingCmdlet</a>(
                            <span class="r685 r">contextCmdlet</span>: <a href="#0479f5f00c7dafc1" class="k">this</a>,
                            <span class="r686 r">useLocalScope</span>: <b>true</b>,
                            <span class="r687 r">errorHandlingBehavior</span>: <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../lang/scriptblock.cs.html#5e78734ffe1c6ed3" class="i field">WriteToCurrentErrorPipe</a>,
                            <span class="r688 r">dollarUnder</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                            <span class="r689 r">input</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                            <span class="r690 r">scriptThis</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                            <span class="r691 r">args</span>: <b>new</b> <b>object</b>[] { <span class="r681 r">module</span> });
                    }
 
                    <b>if</b> (<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#7adbb859c851b2e4" class="i property">ImplementingAssembly</a> != <b>null</b> &amp;&amp; !<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#7adbb859c851b2e4" class="i property">ImplementingAssembly</a>.<span class="i">IsDynamic</span>)
                    {
                        <b>var</b> <span id="r692 rd" class="r692 r">exportedTypes</span> = <a href="../InitialSessionState.cs.html#d3c7a3a0a3314c6f" class="t t">PSSnapInHelpers</a>.<a href="../InitialSessionState.cs.html#463ed3c09a8737cd" class="i method">GetAssemblyTypes</a>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#7adbb859c851b2e4" class="i property">ImplementingAssembly</a>, <span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
                        <b>foreach</b> (<b>var</b> <span id="r693 rd" class="r693 r">type</span> <b>in</b> <span class="r692 r">exportedTypes</span>)
                        {
                            <b>if</b> (<b>typeof</b>(<a href="ModuleIntrinsics.cs.html#63e9c3b0ffc59b6e" class="t t">IModuleAssemblyCleanup</a>).<span class="i">IsAssignableFrom</span>(<span class="r693 r">type</span>))
                            {
                                <a href="ModuleIntrinsics.cs.html#63e9c3b0ffc59b6e" class="k">var</a> <span id="r694 rd" class="r694 r">moduleCleanup</span> = (<a href="ModuleIntrinsics.cs.html#63e9c3b0ffc59b6e" class="t t">IModuleAssemblyCleanup</a>)<span class="i">Activator</span>.<span class="i">CreateInstance</span>(<span class="r693 r">type</span>, <b>true</b>);
                                <span class="r694 r">moduleCleanup</span>.<a href="ModuleIntrinsics.cs.html#20e0d802ba0b6a34" class="i method">OnRemove</a>(<span class="r681 r">module</span>);
                            }
                        }
                    }
 
                    <b>if</b> (<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#a7cf8f3895ca3a4a" class="i property">IsWindowsPowerShellCompatModule</a> &amp;&amp; (<span class="i n">System</span>.<span class="i">Threading</span>.<span class="i">Interlocked</span>.<span class="i">Decrement</span>(<b>ref</b> <a href="#7d80f8891e3a90f5" class="i field">s_WindowsPowerShellCompatUsageCounter</a>) == 0))
                    {
                        <a href="#8cbbd44f9757d7fc" class="i method">CleanupWindowsPowerShellCompatResources</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#5078d443148de142" class="i property">SessionState</a>);
                    }
 
                    <span class="c">// First remove cmdlets from the session state</span>
                    <span class="c">// (can&#39;t just go through module.ExportedCmdlets</span>
                    <span class="c">//  because the names of the cmdlets might have been changed by the -Prefix parameter of Import-Module)</span>
                    <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r695 rd" class="r695 r">keysToRemoveFromCmdletCache</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
                    <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt;&gt; <span id="r696 rd" class="r696 r">cmdlet</span> <b>in</b> <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateCmdletAPIs.cs.html#45b521c66dc38967" class="i method">GetCmdletTable</a>())
                    {
                        <span class="i">List</span>&lt;<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt; <span id="r697 rd" class="r697 r">matches</span> = <span class="r696 r">cmdlet</span>.<span class="i">Value</span>;
                        <span class="c">// If the entry&#39;s module name matches, then remove it from the list...</span>
                        <b>for</b> (<b>int</b> <span id="r698 rd" class="r698 r">i</span> = <span class="r697 r">matches</span>.<span class="i">Count</span> - 1; <span class="r698 r">i</span> &gt;= 0; <span class="r698 r">i</span>--)
                        {
                            <b>if</b> (<span class="r697 r">matches</span>[<span class="r698 r">i</span>].<span class="i">Module</span> == <b>null</b>)
                            {
                                <b>continue</b>;
                            }
 
                            <b>if</b> (<span class="r697 r">matches</span>[<span class="r698 r">i</span>].<span class="i">Module</span>.<span class="i">Path</span>.<span class="i">Equals</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <b>string</b> <span id="r699 rd" class="r699 r">name</span> = <span class="r697 r">matches</span>[<span class="r698 r">i</span>].<span class="i">Name</span>;
                                <span class="r697 r">matches</span>.<span class="i">RemoveAt</span>(<span class="r698 r">i</span>);
                                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateCmdletAPIs.cs.html#55d771022d76852e" class="i method">RemoveCmdlet</a>(<span class="r699 r">name</span>, <span class="r698 r">i</span>, <b>true</b>);
                            }
                        }
                        <span class="c">// And finally remove the name from the cache if the list is now empty...</span>
                        <b>if</b> (<span class="r697 r">matches</span>.<span class="i">Count</span> == 0)
                        {
                            <span class="r695 r">keysToRemoveFromCmdletCache</span>.<span class="i">Add</span>(<span class="r696 r">cmdlet</span>.<span class="i">Key</span>);
                        }
                    }
 
                    <b>foreach</b> (<b>string</b> <span id="r700 rd" class="r700 r">keyToRemove</span> <b>in</b> <span class="r695 r">keysToRemoveFromCmdletCache</span>)
                    {
                        <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateCmdletAPIs.cs.html#38fb0ca0069d7f30" class="i method">RemoveCmdletEntry</a>(<span class="r700 r">keyToRemove</span>, <b>true</b>);
                    }
 
                    <span class="c">// Remove any providers imported by this module. Providers are always imported into</span>
                    <span class="c">// the top level session state. Only binary modules can import providers.</span>
                    <b>if</b> (<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> == <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#1c66a8819a72670d" class="i field">Binary</a>)
                    {
                        <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a>&gt;&gt; <span id="r701 rd" class="r701 r">providers</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>.<a href="../SessionStateProviderAPIs.cs.html#12503655514931e1" class="i property">Providers</a>;
                        <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r702 rd" class="r702 r">keysToRemoveFromProviderTable</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
 
                        <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>.<span class="i">List</span>&lt;<a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a>&gt;&gt; <span id="r703 rd" class="r703 r">pl</span> <b>in</b> <span class="r701 r">providers</span>)
                        {
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r703 r">pl</span>.<span class="i">Value</span> != <b>null</b>, <span class="s">&quot;There should never be a null list of entries in the provider table&quot;</span>);
 
                            <span class="c">// For each provider with this name, if it was imported from the module,</span>
                            <span class="c">// remove it from the list.</span>
                            <b>for</b> (<b>int</b> <span id="r704 rd" class="r704 r">i</span> = <span class="r703 r">pl</span>.<span class="i">Value</span>.<span class="i">Count</span> - 1; <span class="r704 r">i</span> &gt;= 0; <span class="r704 r">i</span>--)
                            {
                                <a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r705 rd" class="r705 r">pi</span> = <span class="r703 r">pl</span>.<span class="i">Value</span>[<span class="r704 r">i</span>];
 
                                <span class="c">// If it was implemented by this module, remove it</span>
                                <b>string</b> <span id="r706 rd" class="r706 r">implAssemblyLocation</span> = <span class="r705 r">pi</span>.<a href="../DataStoreAdapterProvider.cs.html#3801e8e136516894" class="i property">ImplementingType</a>.<span class="i">Assembly</span>.<span class="i">Location</span>;
                                <b>if</b> (<span class="r706 r">implAssemblyLocation</span>.<span class="i">Equals</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                                {
                                    <span class="c">// Remove all drives from the top level session state</span>
                                    <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#15f40fcb70b722f7" class="i method">RemoveAllDrivesForProvider</a>(<span class="r705 r">pi</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>);
                                    <span class="c">// Remove all drives from the current module context</span>
                                    <b>if</b> (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> != <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>)
                                        <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#15f40fcb70b722f7" class="i method">RemoveAllDrivesForProvider</a>(<span class="r705 r">pi</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>);
                                    <span class="c">// Remove drives from all other module contexts.</span>
                                    <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r707 rd" class="r707 r">psmi</span> <b>in</b> <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">Values</span>)
                                    {
                                        <b>if</b> (<span class="r707 r">psmi</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> != <b>null</b>)
                                        {
                                            <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r708 rd" class="r708 r">mssi</span> = <span class="r707 r">psmi</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>;
                                            <b>if</b> (<span class="r708 r">mssi</span> != <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a> &amp;&amp;
                                                <span class="r708 r">mssi</span> != <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>)
                                            {
                                                <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#15f40fcb70b722f7" class="i method">RemoveAllDrivesForProvider</a>(<span class="r705 r">pi</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>);
                                            }
                                        }
                                    }
 
                                    <span class="r703 r">pl</span>.<span class="i">Value</span>.<span class="i">RemoveAt</span>(<span class="r704 r">i</span>);
                                }
                            }
 
                            <span class="c">// If there are no providers left with this name, add this key to the list</span>
                            <span class="c">// of entries to remove.</span>
                            <b>if</b> (<span class="r703 r">pl</span>.<span class="i">Value</span>.<span class="i">Count</span> == 0)
                            {
                                <span class="r702 r">keysToRemoveFromProviderTable</span>.<span class="i">Add</span>(<span class="r703 r">pl</span>.<span class="i">Key</span>);
                            }
                        }
 
                        <span class="c">// Finally remove all of the empty table entries.</span>
                        <b>foreach</b> (<b>string</b> <span id="r709 rd" class="r709 r">keyToRemove</span> <b>in</b> <span class="r702 r">keysToRemoveFromProviderTable</span>)
                        {
                            <span class="r701 r">providers</span>.<span class="i">Remove</span>(<span class="r709 r">keyToRemove</span>);
                        }
                    }
 
                    <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r710 rd" class="r710 r">ss</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
 
                    <b>if</b> (<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> != <b>null</b>)
                    {
                        <span class="c">// Remove the imported functions from SessionState...</span>
                        <span class="c">// (can&#39;t just go through module.SessionState.Internal.ExportedFunctions,</span>
                        <span class="c">//  because the names of the functions might have been changed by the -Prefix parameter of Import-Module)</span>
                        <b>foreach</b> ((<b>var</b> <b>_</b>, <a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r711 rd" class="r711 r">functionInfo</span>) <b>in</b> <span class="r710 r">ss</span>.<span class="i">GetFunctionTable</span>())
                        {
                            <b>if</b> (<span class="r711 r">functionInfo</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> == <b>null</b>)
                            {
                                <b>continue</b>;
                            }
 
                            <b>if</b> (<span class="r711 r">functionInfo</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>.<span class="i">Equals</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <b>string</b> <span id="r712 rd" class="r712 r">functionName</span> = <span class="r711 r">functionInfo</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>;
                                <b>try</b>
                                {
                                    <span class="r710 r">ss</span>.<a href="../SessionStateFunctionAPIs.cs.html#59502f64d3a38652" class="i method">RemoveFunction</a>(<span class="r712 r">functionName</span>, <b>true</b>);
 
                                    <b>string</b> <span id="r713 rd" class="r713 r">memberMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">RemovingImportedFunction</span>, <span class="r712 r">functionName</span>);
                                    <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r713 r">memberMessage</span>);
                                }
                                <b>catch</b> (<a href="../../utils/SessionStateExceptions.cs.html#fc882bde4eabbb16" class="t t">SessionStateUnauthorizedAccessException</a> <span id="r714 rd" class="r714 r">e</span>)
                                {
                                    <b>string</b> <span id="r715 rd" class="r715 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">UnableToRemoveModuleMember</span>, <span class="r712 r">functionName</span>, <span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r714 r">e</span>.<span class="i">Message</span>);
                                    <span class="i">InvalidOperationException</span> <span id="r716 rd" class="r716 r">memberNotRemoved</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r715 r">message</span>, <span class="r714 r">e</span>);
                                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r717 rd" class="r717 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r716 r">memberNotRemoved</span>, <span class="s">&quot;Modules_MemberNotRemoved&quot;</span>,
                                                                     <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <span class="r712 r">functionName</span>);
                                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r717 r">er</span>);
                                }
                            }
                        }
 
                        <span class="c">// Remove the imported variables from SessionState...</span>
                        <b>foreach</b> (<a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r718 rd" class="r718 r">mv</span> <b>in</b> <span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateVariableAPIs.cs.html#2410b52a592096c8" class="i property">ExportedVariables</a>)
                        {
                            <a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r719 rd" class="r719 r">sv</span> = <span class="r710 r">ss</span>.<a href="../SessionStateVariableAPIs.cs.html#e8489f28d543d2b6" class="i method">GetVariable</a>(<span class="r718 r">mv</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>);
                            <b>if</b> (<span class="r719 r">sv</span> != <b>null</b> &amp;&amp; <span class="r719 r">sv</span> == <span class="r718 r">mv</span>)
                            {
                                <span class="r710 r">ss</span>.<a href="../SessionStateVariableAPIs.cs.html#9a856a79300aaa3f" class="i method">RemoveVariable</a>(<span class="r719 r">sv</span>, <a href="#f8d5c3639f6e81cd" class="i property">BaseForce</a>);
                                <b>string</b> <span id="r720 rd" class="r720 r">memberMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">RemovingImportedVariable</span>, <span class="r719 r">sv</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>);
                                <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r720 r">memberMessage</span>);
                            }
                        }
 
                        <span class="c">// Remove the imported aliases from SessionState...</span>
                        <span class="c">// (can&#39;t just go through module.SessionState.Internal.ExportedAliases,</span>
                        <span class="c">//  because the names of the aliases might have been changed by the -Prefix parameter of Import-Module)</span>
                        <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a>&gt; <span id="r721 rd" class="r721 r">entry</span> <b>in</b> <span class="r710 r">ss</span>.<a href="../SessionStateAliasAPIs.cs.html#2139e166b1eb6afa" class="i method">GetAliasTable</a>())
                        {
                            <a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r722 rd" class="r722 r">ai</span> = <span class="r721 r">entry</span>.<span class="i">Value</span>;
                            <b>if</b> (<span class="r722 r">ai</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> == <b>null</b>)
                            {
                                <b>continue</b>;
                            }
 
                            <b>if</b> (<span class="r722 r">ai</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>.<span class="i">Equals</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                            {
                                <span class="c">// Remove the alias with force...</span>
                                <span class="r710 r">ss</span>.<a href="../SessionStateAliasAPIs.cs.html#15aea4fb7b0f16f4" class="i method">RemoveAlias</a>(<span class="r722 r">ai</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <b>true</b>);
                                <b>string</b> <span id="r723 rd" class="r723 r">memberMessage</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">RemovingImportedAlias</span>, <span class="r722 r">ai</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                                <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r723 r">memberMessage</span>);
                            }
                        }
                    }
 
                    <a href="#0479f5f00c7dafc1" class="k">this</a>.<span class="i">RemoveTypesAndFormatting</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#9255531221898da3" class="i property">ExportedFormatFiles</a>, <span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#8e94a27c925a8382" class="i property">ExportedTypeFiles</a>);
                    <span class="c">// resetting the help caches. This is needed as the help content cached is cached in process.</span>
                    <span class="c">// When a module is removed there is no need to cache the help content for the commands in</span>
                    <span class="c">// the module. The HelpSystem is not designed to track per module help content...so resetting</span>
                    <span class="c">// all of the cache. HelpSystem knows how to build this cache back when needed.</span>
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a86262768086e411" class="i property">HelpSystem</a>.<a href="../../help/HelpSystem.cs.html#358a8f0e7c914f6b" class="i method">ResetHelpProviders</a>();
 
                    <span class="c">// Remove the module from all session state module tables...</span>
                    <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r724 rd" class="r724 r">e</span> <b>in</b> <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>)
                    {
                        <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r725 rd" class="r725 r">m</span> = <span class="r724 r">e</span>.<span class="i">Value</span>;
                        <b>if</b> (<span class="r725 r">m</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> != <b>null</b>)
                        {
                            <b>if</b> (<span class="r725 r">m</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>.<span class="i">ContainsKey</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>))
                            {
                                <span class="r725 r">m</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>.<span class="i">Remove</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                                <span class="r725 r">m</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionState.cs.html#99191506d80f52d7" class="i field">ModuleTableKeys</a>.<span class="i">Remove</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                            }
                        }
                    }
 
                    <b>if</b> (<span class="r683 r">isTopLevelModule</span>)
                    {
                        <span class="c">// Remove it from the top level session state</span>
                        <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>.<span class="i">Remove</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                        <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>.<a href="../SessionState.cs.html#99191506d80f52d7" class="i field">ModuleTableKeys</a>.<span class="i">Remove</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                    }
                    <span class="c">// And finally from the global module table...</span>
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">Remove</span>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
 
                    <span class="c">// And the appdomain level module path cache.</span>
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>.<a href="PSModuleInfo.cs.html#b8a6b6d87ecc6b04" class="i method">RemoveFromAppDomainLevelCache</a>(<span class="r681 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
                }
            }
        }
 
        <b>private bool</b> <a id="da2f4be388aed84b" href="../../R/da2f4be388aed84b.html" target="n" data-glyph="76,1" class="i method">ShouldModuleBeRemoved</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r726 rd" class="r726 r">module</span>, <b>string</b> <span id="r727 rd" class="r727 r">moduleNameInRemoveModuleCmdlet</span>, <b>out bool</b> <span id="r728 rd" class="r728 r">isTopLevelModule</span>)
        {
            <span class="r728 r">isTopLevelModule</span> = <b>false</b>;
 
            <b>if</b> (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>.<span class="i">ContainsKey</span>(<span class="r726 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>))
            {
                <span class="r728 r">isTopLevelModule</span> = <b>true</b>;
                <span class="c">// This check makes sure that this module is removed only when we do a Remove-Module &lt;moduleName&gt; of this module</span>
                <span class="c">// If this module is a nested module of some other module but is also imported as a top level module, then we should not be removing it.</span>
                <b>if</b> (<span class="r727 r">moduleNameInRemoveModuleCmdlet</span> == <b>null</b> || <span class="r726 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r727 r">moduleNameInRemoveModuleCmdlet</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
            <b>else</b>
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if an already loaded module meets the constraints passed to the module cmdlet by the user.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r729 r">alreadyLoadedModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The already loaded module that matched the name of the module to load.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the pre-loaded module matches all GUID and version constraints provided, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="5ee06f3ee1be0ff1" href="../../R/5ee06f3ee1be0ff1.html" target="n" data-glyph="74,1" class="i method">DoesAlreadyLoadedModuleSatisfyConstraints</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r729 rd" class="r729 r">alreadyLoadedModule</span>)
        {
            <b>return</b> <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#ce2ec20231eefd5b" class="i method">IsModuleMatchingConstraints</a>(
                <span class="r729 r">alreadyLoadedModule</span>,
                <span class="r730 r">guid</span>: <a href="#d3b88fd228891169" class="i property">BaseGuid</a>,
                <span class="r731 r">requiredVersion</span>: <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>,
                <span class="r732 r">minimumVersion</span>: <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>,
                <span class="r733 r">maximumVersion</span>: <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r734 r">modulePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r735 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r736 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns PSModuleInfo of an already loaded module if that module can be simply reimported and there is no need to proceed with a regular import.</span>
        <span class="c">///</span><span class="c"> Returns </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">langword</span><span class="c">=</span><span class="c">&quot;</span><span class="c">null</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if the caller should proceed with a regular import (either because there is no previously loaded module, or because the -Force flag was specified and the previously loaded module has been removed by this method).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="ff219b633fc5b22f" href="../../R/ff219b633fc5b22f.html" target="n" data-glyph="74,1" class="i method">IsModuleImportUnnecessaryBecauseModuleIsAlreadyLoaded</a>(<b>string</b> <span id="r734 rd" class="r734 r">modulePath</span>, <b>string</b> <span id="r735 rd" class="r735 r">prefix</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r736 rd" class="r736 r">options</span>)
        {
            <b>if</b> (<a href="#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r734 r">modulePath</span>, <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r737 rd" class="r737 r">alreadyLoadedModule</span>))
            {
                <b>if</b> (<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#5ee06f3ee1be0ff1" class="i method">DoesAlreadyLoadedModuleSatisfyConstraints</a>(<span class="r737 r">alreadyLoadedModule</span>))
                {
                    <b>if</b> (<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#f8d5c3639f6e81cd" class="i property">BaseForce</a>) <span class="c">// remove the previously imported module + return null (null = please proceed with regular import)</span>
                    {
                        <span class="c">// remove the module</span>
                        <a href="#452f85accd76669f" class="i method">RemoveModule</a>(<span class="r737 r">alreadyLoadedModule</span>);
 
                        <span class="c">// proceed with regular import</span>
                        <b>return</b> <b>null</b>;
                    }
                    <b>else</b> <span class="c">// reimport the module + return alreadyLoadedModule (alreadyLoadedModule = no need to proceed with regular import)</span>
                    {
                        <span class="c">// If the module has already been loaded, then while loading it the second time, we should load it with the DefaultCommandPrefix specified in the module manifest. (If there is no Prefix from command line)</span>
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r735 r">prefix</span>) &amp;&amp; <span class="i">File</span>.<span class="i">Exists</span>(<span class="r737 r">alreadyLoadedModule</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>))
                        {
                            <b>string</b> <span id="r738 rd" class="r738 r">defaultPrefix</span> = <a href="#23d555a7c9125b2d" class="i method">GetDefaultPrefix</a>(<span class="r737 r">alreadyLoadedModule</span>);
                            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r738 r">defaultPrefix</span>))
                            {
                                <span class="r735 r">prefix</span> = <span class="r738 r">defaultPrefix</span>;
                            }
                        }
 
                        <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r737 r">alreadyLoadedModule</span>);
 
                        <span class="c">// Even if the alreadyLoadedModule has been loaded, import the specified members...</span>
                        <a href="#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r737 r">alreadyLoadedModule</span>, <span class="r735 r">prefix</span>, <span class="r736 r">options</span>);
 
                        <b>if</b> (<a href="#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                        {
                            <b>if</b> (<span class="r737 r">alreadyLoadedModule</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> != <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#15536cea81510839" class="i field">Script</a>)
                            {
                                <b>string</b> <span id="r739 rd" class="r739 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">CantUseAsCustomObjectWithBinaryModule</span>, <span class="r737 r">alreadyLoadedModule</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                                <span class="i">InvalidOperationException</span> <span id="r740 rd" class="r740 r">invalidOp</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r739 r">message</span>);
                                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r741 rd" class="r741 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r740 r">invalidOp</span>, <span class="s">&quot;Modules_CantUseAsCustomObjectWithBinaryModule&quot;</span>,
                                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>);
                                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r741 r">er</span>);
                            }
                            <b>else</b>
                            {
                                <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r737 r">alreadyLoadedModule</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                            }
                        }
                        <b>else</b> <b>if</b> (<a href="#da53dea574e86fa3" class="i property">BasePassThru</a>)
                        {
                            <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r737 r">alreadyLoadedModule</span>);
                        }
 
                        <span class="c">// no need to proceed with regular import</span>
                        <b>return</b> <span class="r737 r">alreadyLoadedModule</span>;
                    }
                }
            }
 
            <span class="c">// no previously imported module (or already loaded module has wrong version) - proceed with regular import</span>
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Loads a module file after searching for it using the known extension list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r742 r">parentModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The parent module for which this module is a nested module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r743 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name to use for the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r744 r">fileBaseName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file basename for this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r745 r">extension</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module&#39;s extension.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r746 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module base which comes from the module manifest.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r747 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r748 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The session state instance to use for this module - may be null</span>
        <span class="c">///</span><span class="c"> in which case a session state will be allocated if necessary</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r749 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r750 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The processing flags to use when processing the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r751 r">found</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if a module was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="ffbbd5f81c5a99f9" href="../../R/ffbbd5f81c5a99f9.html" target="n" data-glyph="74,1" class="i method">LoadUsingExtensions</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r742 rd" class="r742 r">parentModule</span>,
            <b>string</b> <span id="r743 rd" class="r743 r">moduleName</span>, <b>string</b> <span id="r744 rd" class="r744 r">fileBaseName</span>, <b>string</b> <span id="r745 rd" class="r745 r">extension</span>, <b>string</b> <span id="r746 rd" class="r746 r">moduleBase</span>,
            <b>string</b> <span id="r747 rd" class="r747 r">prefix</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r748 rd" class="r748 r">ss</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r749 rd" class="r749 r">options</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r750 rd" class="r750 r">manifestProcessingFlags</span>, <b>out bool</b> <span id="r751 rd" class="r751 r">found</span>)
        {
            <b>bool</b> <span id="r752 rd" class="r752 r">throwAwayModuleFileFound</span> = <b>false</b>;
            <b>return</b> <a href="#023c256ff0ced197" class="i method">LoadUsingExtensions</a>(<span class="r742 r">parentModule</span>, <span class="r743 r">moduleName</span>, <span class="r744 r">fileBaseName</span>, <span class="r745 r">extension</span>, <span class="r746 r">moduleBase</span>, <span class="r747 r">prefix</span>, <span class="r748 r">ss</span>,
                                       <span class="r749 r">options</span>, <span class="r750 r">manifestProcessingFlags</span>, <b>out</b> <span class="r751 r">found</span>, <b>out</b> <span class="r752 r">throwAwayModuleFileFound</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Loads a module file after searching for it using the known extension list.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r753 r">parentModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The parent module for which this module is a nested module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r754 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name to use for the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">fileBaseName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The file basename for this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">extension</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module&#39;s extension.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r755 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module base which comes from the module manifest.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r756 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r757 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The session state instance to use for this module - may be null</span>
        <span class="c">///</span><span class="c"> in which case a session state will be allocated if necessary</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r758 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r759 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The processing flags to use when processing the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r760 r">found</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if a module was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r761 r">moduleFileFound</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if a module file was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="023c256ff0ced197" href="../../R/023c256ff0ced197.html" target="n" data-glyph="74,1" class="i method">LoadUsingExtensions</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r753 rd" class="r753 r">parentModule</span>,
            <b>string</b> <span id="r754 rd" class="r754 r">moduleName</span>, <b>string</b> <span id="r99 rd" class="r99 r">fileBaseName</span>, <b>string</b> <span id="r100 rd" class="r100 r">extension</span>, <b>string</b> <span id="r755 rd" class="r755 r">moduleBase</span>,
            <b>string</b> <span id="r756 rd" class="r756 r">prefix</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r757 rd" class="r757 r">ss</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r758 rd" class="r758 r">options</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r759 rd" class="r759 r">manifestProcessingFlags</span>, <b>out bool</b> <span id="r760 rd" class="r760 r">found</span>, <b>out bool</b> <span id="r761 rd" class="r761 r">moduleFileFound</span>)
        {
            <b>string</b>[] <span id="r762 rd" class="r762 r">extensions</span>;
            <span class="r761 r">moduleFileFound</span> = <b>false</b>;
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r100 r">extension</span>))
                <span class="r762 r">extensions</span> = <b>new</b> <b>string</b>[] { <span class="r100 r">extension</span> };
            <b>else</b>
                <span class="r762 r">extensions</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#2f61be99d14256e7" class="i field">PSModuleExtensions</a>;
 
            <b>var</b> <span id="r763 rd" class="r763 r">importingModule</span> = (<span class="r759 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>) != 0;
 
            <span class="c">// &quot;ni.dll&quot; has a higher priority then &quot;.dll&quot; to be loaded.</span>
            <b>for</b> (<b>int</b> <span id="r764 rd" class="r764 r">i</span> = 0; <span class="r764 r">i</span> &lt; <span class="r762 r">extensions</span>.<span class="i">Length</span>; <span class="r764 r">i</span>++)
            {
                <b>string</b> <span id="r765 rd" class="r765 r">ext</span> = <span class="r762 r">extensions</span>[<span class="r764 r">i</span>];
                <b>string</b> <span id="r766 rd" class="r766 r">fileName</span> = <span class="r99 r">fileBaseName</span> + <span class="r765 r">ext</span>;
 
                <span class="c">// Get the resolved file name</span>
                <span class="r766 r">fileName</span> = <a href="#7c03df577cede1d9" class="i method">GetResolvedPath</a>(<span class="r766 r">fileName</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
 
                <b>if</b> (<span class="r766 r">fileName</span> == <b>null</b>)
                    <b>continue</b>;
 
                <span class="c">// If we&#39;ve found ourselves, then skip and move on to the next extension.</span>
                <span class="c">// This will be the case where a scriptmodule foo.psm1 does an &quot;Import-Module foo&quot; intending to get foo.dll.</span>
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>) &amp;&amp;
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>.<span class="i">Equals</span>(<span class="r766 r">fileName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>continue</b>;
                }
 
                <span class="c">// If the module has already been loaded, just emit it and continue...</span>
                <a href="#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r766 r">fileName</span>, <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r767 rd" class="r767 r">module</span>);
                <b>if</b> (!<a href="#f8d5c3639f6e81cd" class="i property">BaseForce</a> &amp;&amp; <span class="r763 r">importingModule</span> &amp;&amp; <a href="#5ee06f3ee1be0ff1" class="i method">DoesAlreadyLoadedModuleSatisfyConstraints</a>(<span class="r767 r">module</span>))
                {
                    <span class="r761 r">moduleFileFound</span> = <b>true</b>;
 
                    <span class="c">// If the module has already been loaded, then while loading it the second time, we should load it with the DefaultCommandPrefix specified in the module manifest. (If there is no Prefix from command line)</span>
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r756 r">prefix</span>))
                    {
                        <b>string</b> <span id="r768 rd" class="r768 r">defaultPrefix</span> = <a href="#23d555a7c9125b2d" class="i method">GetDefaultPrefix</a>(<span class="r767 r">module</span>);
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r768 r">defaultPrefix</span>))
                        {
                            <span class="r756 r">prefix</span> = <span class="r768 r">defaultPrefix</span>;
                        }
                    }
 
                    <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r767 r">module</span>);
 
                    <span class="c">// Even if the module has been loaded, import the specified members...</span>
                    <a href="#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r767 r">module</span>, <span class="r756 r">prefix</span>, <span class="r758 r">options</span>);
 
                    <b>if</b> (<a href="#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                    {
                        <b>if</b> (<span class="r767 r">module</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> != <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#15536cea81510839" class="i field">Script</a>)
                        {
                            <b>string</b> <span id="r769 rd" class="r769 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">CantUseAsCustomObjectWithBinaryModule</span>, <span class="r767 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                            <span class="i">InvalidOperationException</span> <span id="r770 rd" class="r770 r">invalidOp</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r769 r">message</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r771 rd" class="r771 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r770 r">invalidOp</span>, <span class="s">&quot;Modules_CantUseAsCustomObjectWithBinaryModule&quot;</span>,
                                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r771 r">er</span>);
                        }
                        <b>else</b>
                        {
                            <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r767 r">module</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                        }
                    }
                    <b>else</b> <b>if</b> (<a href="#da53dea574e86fa3" class="i property">BasePassThru</a>)
                    {
                        <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r767 r">module</span>);
                    }
 
                    <span class="r760 r">found</span> = <b>true</b>;
                    <b>return</b> <span class="r767 r">module</span>;
                }
                <b>else</b> <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r766 r">fileName</span>))
                {
                    <span class="r761 r">moduleFileFound</span> = <b>true</b>;
                    <span class="c">// Win8: 325243 - Added the version check so that we do not unload modules with the same name but different version</span>
                    <b>if</b> (<a href="#f8d5c3639f6e81cd" class="i property">BaseForce</a> &amp;&amp; <a href="#5ee06f3ee1be0ff1" class="i method">DoesAlreadyLoadedModuleSatisfyConstraints</a>(<span class="r767 r">module</span>))
                    {
                        <a href="#452f85accd76669f" class="i method">RemoveModule</a>(<span class="r767 r">module</span>);
                    }
 
                    <span class="r767 r">module</span> = <a href="#54b090acde25aca6" class="i method">LoadModule</a>(<span class="r753 r">parentModule</span>, <span class="r766 r">fileName</span>, <span class="r755 r">moduleBase</span>, <span class="r756 r">prefix</span>, <span class="r757 r">ss</span>, <b>null</b>, <b>ref</b> <span class="r758 r">options</span>, <span class="r759 r">manifestProcessingFlags</span>, <b>out</b> <span class="r760 r">found</span>, <b>out</b> <span class="r761 r">moduleFileFound</span>);
                    <b>if</b> (<span class="r760 r">found</span>)
                    {
                        <b>return</b> <span class="r767 r">module</span>;
                    }
                }
            }
 
            <span class="r760 r">found</span> = <b>false</b>;
            <b>return</b> <b>null</b>;
        }
 
        <b>internal string</b> <a id="23d555a7c9125b2d" href="../../R/23d555a7c9125b2d.html" target="n" data-glyph="74,1" class="i method">GetDefaultPrefix</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r772 rd" class="r772 r">module</span>)
        {
            <b>string</b> <span id="r773 rd" class="r773 r">prefix</span> = <b>string</b>.<span class="i">Empty</span>;
            <b>string</b> <span id="r774 rd" class="r774 r">extension</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r772 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r774 r">extension</span>) &amp;&amp; <span class="r774 r">extension</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>string</b> <span id="r775 rd" class="r775 r">throwAwayScriptName</span>;
                <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r776 rd" class="r776 r">scriptInfo</span> = <a href="#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r772 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <b>out</b> <span class="r775 r">throwAwayScriptName</span>, <b>true</b>);
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r776 r">scriptInfo</span> != <b>null</b>, <span class="s">&quot;scriptInfo for module (.psd1) can&#39;t be null&quot;</span>);
                <b>bool</b> <span id="r777 rd" class="r777 r">containedErrors</span> = <b>false</b>;
                <span class="i">Hashtable</span> <span id="r778 rd" class="r778 r">data</span> = <b>null</b>;
                <span class="i">Hashtable</span> <span id="r779 rd" class="r779 r">localizedData</span> = <b>null</b>;
 
                <b>if</b> (<a href="#bf907ad98e75e913" class="i method">LoadModuleManifestData</a>(<span class="r776 r">scriptInfo</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#342eb5397fea9175" class="i field">NullOnFirstError</a>, <b>out</b> <span class="r778 r">data</span>, <b>out</b> <span class="r779 r">localizedData</span>, <b>ref</b> <span class="r777 r">containedErrors</span>))
                {
                    <span class="c">// Get Default prefix</span>
                    <b>if</b> (<span class="r778 r">data</span>.<span class="i">Contains</span>(<span class="s">&quot;DefaultCommandPrefix&quot;</span>))
                    {
                        <b>if</b> (<span class="r779 r">localizedData</span> != <b>null</b> &amp;&amp; <span class="r779 r">localizedData</span>.<span class="i">Contains</span>(<span class="s">&quot;DefaultCommandPrefix&quot;</span>))
                        {
                            <span class="r773 r">prefix</span> = (<b>string</b>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r779 r">localizedData</span>[<span class="s">&quot;DefaultCommandPrefix&quot;</span>],
                                <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                        }
 
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r773 r">prefix</span>))
                        {
                            <span class="r773 r">prefix</span> = (<b>string</b>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r778 r">data</span>[<span class="s">&quot;DefaultCommandPrefix&quot;</span>],
                                <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r773 r">prefix</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create an ExternalScriptInfo object from a file path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r780 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the file.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r781 r">scriptName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The base name of the script.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r782 r">checkExecutionPolicy</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Check the current execution policy.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The ExternalScriptInfo object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <a id="477344698fa519b9" href="../../R/477344698fa519b9.html" target="n" data-glyph="74,1" class="i method">GetScriptInfoForFile</a>(<b>string</b> <span id="r780 rd" class="r780 r">fileName</span>, <b>out string</b> <span id="r781 rd" class="r781 r">scriptName</span>, <b>bool</b> <span id="r782 rd" class="r782 r">checkExecutionPolicy</span>)
        {
            <span class="r781 r">scriptName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r780 r">fileName</span>);
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r783 rd" class="r783 r">scriptInfo</span> = <b>new</b> <a href="../ExternalScriptInfo.cs.html#0769c91ec3133070" class="t constructor">ExternalScriptInfo</a>(<span class="r781 r">scriptName</span>, <span class="r780 r">fileName</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
 
            <span class="c">// Skip ShouldRun check for .psd1 files.</span>
            <span class="c">// Use ValidateScriptInfo() for explicitly validating the checkpolicy for psd1 file.</span>
            <b>if</b> (!<span class="r781 r">scriptName</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.psd1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r782 r">checkExecutionPolicy</span>)
                {
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#d04f29dfc80b1390" class="i property">AuthorizationManager</a>.<a href="../SecurityManagerBase.cs.html#c0db5055d86375e7" class="i method">ShouldRunInternal</a>(<span class="r783 r">scriptInfo</span>, <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#66a89eb31c003ba5" class="i field">Runspace</a>,
                        <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>);
                }
                <b>else</b>
                {
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#d04f29dfc80b1390" class="i property">AuthorizationManager</a>.<a href="../SecurityManagerBase.cs.html#c0db5055d86375e7" class="i method">ShouldRunInternal</a>(<span class="r783 r">scriptInfo</span>, <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>,
                        <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>);
                }
 
                <b>if</b> (!<span class="r781 r">scriptName</span>.<span class="i">EndsWith</span>(<span class="s">&quot;.cdxml&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <a href="../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<a href="../CommandDiscovery.cs.html#cc68f1bbdab748e2" class="i method">VerifyScriptRequirements</a>(<span class="r783 r">scriptInfo</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                }
 
                <span class="c">// If we got this far, the check succeeded and we don&#39;t need to check again.</span>
                <span class="r783 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#2075d97e6591a1f9" class="i property">SignatureChecked</a> = <b>true</b>;
            }
 
            <b>return</b> <span class="r783 r">scriptInfo</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load a module from a file...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r784 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The resolved path to load the module from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r785 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module base path to use for this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r786 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r787 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to use for this module - may be null in which case a session state will be allocated if necessary.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r788 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r789 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest processing flags to use when processing the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r790 r">found</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if a module was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module was successfully loaded.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="54ff88ac8ad0f1e9" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">LoadModule</a>(<b>string</b> <span id="r784 rd" class="r784 r">fileName</span>, <b>string</b> <span id="r785 rd" class="r785 r">moduleBase</span>, <b>string</b> <span id="r786 rd" class="r786 r">prefix</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r787 rd" class="r787 r">ss</span>, <b>ref</b> <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r788 rd" class="r788 r">options</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r789 rd" class="r789 r">manifestProcessingFlags</span>, <b>out bool</b> <span id="r790 rd" class="r790 r">found</span>)
        {
            <b>bool</b> <span id="r791 rd" class="r791 r">throwAwayModuleFileFound</span> = <b>false</b>;
            <b>return</b> <a href="#54b090acde25aca6" class="i method">LoadModule</a>(<b>null</b>, <span class="r784 r">fileName</span>, <span class="r785 r">moduleBase</span>, <span class="r786 r">prefix</span>, <span class="r787 r">ss</span>, <b>null</b>, <b>ref</b> <span class="r788 r">options</span>, <span class="r789 r">manifestProcessingFlags</span>, <b>out</b> <span class="r790 r">found</span>, <b>out</b> <span class="r791 r">throwAwayModuleFileFound</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load a module from a file...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r792 r">parentModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The parent module, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r793 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The resolved path to load the module from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r794 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module base path to use for this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r795 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r796 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to use for this module - may be null in which case a session state will be allocated if necessary.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r797 r">privateData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Private Data for the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r798 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r799 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest processing flags to use when processing the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r800 r">found</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if a module was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r801 r">moduleFileFound</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if a module file was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module was successfully loaded.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="54b090acde25aca6" href="../../R/54b090acde25aca6.html" target="n" data-glyph="74,1" class="i method">LoadModule</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r792 rd" class="r792 r">parentModule</span>, <b>string</b> <span id="r793 rd" class="r793 r">fileName</span>, <b>string</b> <span id="r794 rd" class="r794 r">moduleBase</span>, <b>string</b> <span id="r795 rd" class="r795 r">prefix</span>,
            <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r796 rd" class="r796 r">ss</span>, <b>object</b> <span id="r797 rd" class="r797 r">privateData</span>, <b>ref</b> <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r798 rd" class="r798 r">options</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r799 rd" class="r799 r">manifestProcessingFlags</span>, <b>out bool</b> <span id="r800 rd" class="r800 r">found</span>, <b>out bool</b> <span id="r801 rd" class="r801 r">moduleFileFound</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r793 r">fileName</span> != <b>null</b>, <span class="s">&quot;Filename argument to LoadModule() shouldn&#39;t be null&quot;</span>);
 
            <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r793 r">fileName</span>))
            {
                <span class="r800 r">found</span> = <b>false</b>;
                <span class="r801 r">moduleFileFound</span> = <b>false</b>;
                <b>return</b> <b>null</b>;
            }
 
            <b>var</b> <span id="r802 rd" class="r802 r">importingModule</span> = (<span class="r799 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>) != 0;
            <b>var</b> <span id="r803 rd" class="r803 r">writingErrors</span> = (<span class="r799 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#493fa52eb1605135" class="i field">WriteErrors</a>) != 0;
 
            <span class="c">// In case the file is a Ngen Assembly.</span>
            <b>string</b> <span id="r804 rd" class="r804 r">ext</span>;
            <b>if</b> (<span class="r793 r">fileName</span>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r804 r">ext</span> = <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>;
            }
            <b>else</b>
            {
                <span class="r804 r">ext</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r793 r">fileName</span>);
            }
 
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r805 rd" class="r805 r">module</span> = <b>null</b>;
 
            <span class="c">// Block ps1 files from being imported in constrained language.</span>
            <b>if</b> (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a> &amp;&amp; <span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2338784ad03a106f" class="i field">PowerShellScriptFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="i">InvalidOperationException</span> <span id="r806 rd" class="r806 r">invalidOp</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">Modules</span>.<span class="i">ImportPSFileNotAllowedInConstrainedLanguage</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r807 rd" class="r807 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r806 r">invalidOp</span>, <span class="s">&quot;Modules_ImportPSFileNotAllowedInConstrainedLanguage&quot;</span>,
                                                 <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>);
                <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r807 r">er</span>);
            }
 
            <span class="c">// If MinimumVersion/RequiredVersion/MaximumVersion has been specified, then only try to process manifest modules...</span>
            <b>if</b> (<a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> != <b>null</b> || <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> != <b>null</b> || <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> != <b>null</b> || <a href="#d3b88fd228891169" class="i property">BaseGuid</a> != <b>null</b>)
            {
                <span class="c">// If the -Version flag was specified, don&#39;t look for non-manifest modules</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r804 r">ext</span>) || !<span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r800 r">found</span> = <b>false</b>;
                    <span class="r801 r">moduleFileFound</span> = <b>false</b>;
                    <b>return</b> <b>null</b>;
                }
 
                <span class="c">// If the module is in memory and the versions don&#39;t match don&#39;t return it.</span>
                <span class="c">// This will allow the search to continue and load a different version of the module.</span>
                <b>if</b> (<a href="#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r793 r">fileName</span>, <b>out</b> <span class="r805 r">module</span>))
                {
                    <b>if</b> (!<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#21096650e1ba6733" class="i method">IsVersionMatchingConstraints</a>(<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>, <span class="r808 r">minimumVersion</span>: <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>, <span class="r809 r">maximumVersion</span>: <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>))
                    {
                        <span class="r800 r">found</span> = <b>false</b>;
                        <span class="r801 r">moduleFileFound</span> = <b>false</b>;
                        <b>return</b> <b>null</b>;
                    }
                }
            }
 
            <span class="r800 r">found</span> = <b>false</b>;
            <b>string</b> <span id="r810 rd" class="r810 r">scriptName</span>;
 
            <span class="c">//</span>
            <span class="c">// !!NOTE!!</span>
            <span class="c">// If a new module type to load is ever added and if that new module type is based on a script file,</span>
            <span class="c">// such as the existing .psd1 and .psm1 files,</span>
            <span class="c">// then be sure to include the script file LanguageMode in the moduleInfo type created for the loaded module.</span>
            <span class="c">// The PSModuleInfo.LanguageMode property is used to check consistency between the manifest (.psd1) file</span>
            <span class="c">// and all other script (.psm1) file based modules being loaded by that manifest.</span>
            <span class="c">// Use the PSModuleInfo class constructor that takes the PSLanguageMode parameter argument.</span>
            <span class="c">// Look at the LoadModuleNamedInManifest() method to see how the language mode check works.</span>
            <span class="c">// !!NOTE!!</span>
            <span class="c">//</span>
 
            <b>string</b> <span id="r811 rd" class="r811 r">_origModuleBeingProcessed</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>;
            <b>try</b>
            {
                <span class="c">// Set the name of the module currently being processed...</span>
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#0e5d8bea34e7810f" class="i property">PreviousModuleProcessed</a> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>;
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a> = <span class="r793 r">fileName</span>;
 
                <b>string</b> <span id="r812 rd" class="r812 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">LoadingModule</span>, <span class="r793 r">fileName</span>);
                <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r812 r">message</span>);
 
                <span class="r801 r">moduleFileFound</span> = <b>true</b>;
 
                <b>if</b> (<span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>if</b> (!<span class="r802 r">importingModule</span>)
                    {
                        <b>bool</b> <span id="r813 rd" class="r813 r">shouldProcessModule</span> = <a href="#989faa45131da71d" class="i method">ShouldProcessScriptModule</a>(<span class="r792 r">parentModule</span>, <b>ref</b> <span class="r800 r">found</span>);
 
                        <b>if</b> (<span class="r813 r">shouldProcessModule</span>)
                        {
                            <b>bool</b> <span id="r814 rd" class="r814 r">force</span> = (<span class="r799 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#edee4a6de43d8a5c" class="i field">Force</a>) == <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#edee4a6de43d8a5c" class="i field">Force</a>;
                            <span class="r805 r">module</span> = <a href="#d7d5bfeff08b1bc4" class="i method">AnalyzeScriptFile</a>(<span class="r793 r">fileName</span>, <span class="r814 r">force</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                            <span class="r800 r">found</span> = <b>true</b>;
                        }
                    }
                    <b>else</b>
                    {
                        <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="k">var</a> <span id="r815 rd" class="r815 r">psm1ScriptInfo</span> = <a href="#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r793 r">fileName</span>, <b>out</b> <span class="r810 r">scriptName</span>, <b>true</b>);
                        <b>try</b>
                        {
                            <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#e22e8fa7211ed8e7" class="i method">IncrementModuleNestingDepth</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>, <span class="r815 r">psm1ScriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>);
 
                            <span class="c">// Create the module object...</span>
                            <b>try</b>
                            {
                                <span class="r805 r">module</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#3f5fcd253bc92add" class="i method">CreateModule</a>(<span class="r793 r">fileName</span>, <span class="r815 r">psm1ScriptInfo</span>, <a href="../MshCmdlet.cs.html#92387ec2f33e4d8f" class="i property">MyInvocation</a>.<a href="../InvocationInfo.cs.html#36c1c0cc46ab70ad" class="i property">ScriptPosition</a>, <span class="r796 r">ss</span>, <span class="r797 r">privateData</span>, <a href="#e1f617f9af7f631a" class="i property">BaseArgumentList</a>);
                                <span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#9533dfb5c77bd95f" class="i method">SetModuleBase</a>(<span class="r794 r">moduleBase</span>);
 
                                <a href="#180d2b67fc813ae6" class="i method">SetModuleLoggingInformation</a>(<span class="r805 r">module</span>);
 
                                <span class="c">// If the script didn&#39;t call Export-ModuleMember explicitly, then</span>
                                <span class="c">// implicitly export functions and cmdlets.</span>
                                <b>if</b> (!<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#776ca0b7a2795e58" class="i property">UseExportList</a>)
                                {
                                    <span class="c">// For cross language boundaries don&#39;t implicitly export all functions, unless they are allowed nested modules.</span>
                                    <span class="c">// Implict function export is allowed when any of the following is true:</span>
                                    <span class="c">//  - Nested modules are allowed by module manifest</span>
                                    <span class="c">//  - The import context language mode is FullLanguage</span>
                                    <span class="c">//  - This script module not running as trusted (FullLanguage)</span>
                                    <span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#5ee81439d2408c7e" class="i property">ModuleAutoExportsAllFunctions</a> = <span class="r798 r">options</span>.<a href="#c4cfb75775763c63" class="i field">AllowNestedModuleFunctionsToExport</a> ||
                                                                           <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a> ||
                                                                           <span class="r815 r">psm1ScriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a> != <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
 
                                    <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r816 rd" class="r816 r">fnMatchPattern</span> = <span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#5ee81439d2408c7e" class="i property">ModuleAutoExportsAllFunctions</a> ? <a href="#3442415c65548b8f" class="i property">MatchAll</a> : <b>null</b>;
 
                                    <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#dbd0e3667f34bf41" class="i method">ExportModuleMembers</a>(
                                        <span class="r441 r">cmdlet</span>: <a href="#0479f5f00c7dafc1" class="k">this</a>,
                                        <span class="r442 r">sessionState</span>: <span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                                        <span class="r443 r">functionPatterns</span>: <span class="r816 r">fnMatchPattern</span>,
                                        <span class="r444 r">cmdletPatterns</span>: <a href="#3442415c65548b8f" class="i property">MatchAll</a>,
                                        <span class="r445 r">aliasPatterns</span>: <a href="#3442415c65548b8f" class="i property">MatchAll</a>,
                                        <span class="r446 r">variablePatterns</span>: <b>null</b>,
                                        <span class="r439 r">doNotExportCmdlets</span>: <b>null</b>);
                                }
                                <b>else</b> <b>if</b> ((<a href="../../security/wldpNativeMethods.cs.html#6b51558a7a8cde26" class="t t">SystemPolicy</a>.<a href="../../security/wldpNativeMethods.cs.html#2c0da8883146dab2" class="i method">GetSystemLockdownPolicy</a>() == <a href="../../security/wldpNativeMethods.cs.html#9f0915f7b351778e" class="t t">SystemEnforcementMode</a>.<a href="../../security/wldpNativeMethods.cs.html#5d74206001d0b817" class="i field">Enforce</a>) &amp;&amp;
                                         (<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a> == <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>) &amp;&amp;
                                         <span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#08bfefead0b0647d" class="i property">FunctionsExportedWithWildcard</a> &amp;&amp;
                                         !<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#a2d08f2e57242ca4" class="i property">ManifestWithExplicitFunctionExport</a>)
                                {
                                    <span class="c">// When in a constrained environment and functions are being exported from this module using wildcards, make sure</span>
                                    <span class="c">// exported functions only come from this module and not from any imported nested modules.</span>
                                    <span class="c">// Unless there is a parent manifest that explicitly filters all exported functions (no wildcards).</span>
                                    <span class="c">// This prevents unintended public exposure of imported functions running in FullLanguage.</span>
                                    <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#077b2c15cb0576fd" class="i method">RemoveNestedModuleFunctions</a>(<span class="r805 r">module</span>);
                                }
 
                                <a href="#bbf5d70671925a2b" class="i method">CheckForDisallowedDotSourcing</a>(<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>, <span class="r815 r">psm1ScriptInfo</span>, <span class="r798 r">options</span>);
 
                                <span class="c">// Add it to the all module tables</span>
                                <a href="#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r805 r">module</span>, <span class="r795 r">prefix</span>, <span class="r798 r">options</span>);
                                <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r805 r">module</span>);
 
                                <span class="r800 r">found</span> = <b>true</b>;
                                <b>if</b> (<a href="#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                                {
                                    <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                                }
                                <b>else</b>
                                    <span class="c">// If -pass has been specified, emit a module info...</span>
                                    <b>if</b> (<a href="#da53dea574e86fa3" class="i property">BasePassThru</a>)
                                {
                                    <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>);
                                }
                            }
                            <b>catch</b> (<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r817 rd" class="r817 r">e</span>)
                            {
                                <b>if</b> (<span class="r803 r">writingErrors</span>)
                                {
                                    <span class="r817 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../ErrorPackage.cs.html#b119c9996bde5b66" class="i property">PreserveInvocationInfoOnce</a> = <b>true</b>;
                                }
 
                                <b>if</b> (<span class="r817 r">e</span>.<a href="../../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a>)
                                {
                                    <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r817 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>);
                                }
                                <b>else</b>
                                {
                                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r817 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>);
                                }
                            }
                        }
                        <b>finally</b>
                        {
                            <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#04dc5e193949a6d0" class="i method">DecrementModuleNestingCount</a>();
                        }
                    }
                }
                <b>else</b> <b>if</b> (<span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2338784ad03a106f" class="i field">PowerShellScriptFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>if</b> (!<span class="r802 r">importingModule</span>)
                    {
                        <b>bool</b> <span id="r818 rd" class="r818 r">shouldProcessModule</span> = <a href="#989faa45131da71d" class="i method">ShouldProcessScriptModule</a>(<span class="r792 r">parentModule</span>, <b>ref</b> <span class="r800 r">found</span>);
 
                        <b>if</b> (<span class="r818 r">shouldProcessModule</span>)
                        {
                            <b>bool</b> <span id="r819 rd" class="r819 r">force</span> = (<span class="r799 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#edee4a6de43d8a5c" class="i field">Force</a>) == <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#edee4a6de43d8a5c" class="i field">Force</a>;
                            <span class="r805 r">module</span> = <a href="#d7d5bfeff08b1bc4" class="i method">AnalyzeScriptFile</a>(<span class="r793 r">fileName</span>, <span class="r819 r">force</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                            <span class="r800 r">found</span> = <b>true</b>;
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// Create a dummy module info</span>
                        <span class="c">// The module info created for a .ps1 file will not have ExportedCommands populated.</span>
                        <span class="c">// Removing the module will not remove the commands dot-sourced from the .ps1 file.</span>
                        <span class="c">// This module info is created so that we can keep the behavior consistent between scripts imported as modules and other kind of modules(all of them should have a PSModuleInfo).</span>
                        <span class="c">// Auto-loading expects we always have a PSModuleInfo object for any module. This is how this issue was found.</span>
                        <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="k">var</a> <span id="r820 rd" class="r820 r">ps1ScriptInfo</span> = <a href="#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r793 r">fileName</span>, <b>out</b> <span class="r810 r">scriptName</span>, <b>true</b>);
                        <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r820 r">ps1ScriptInfo</span> != <b>null</b>, <span class="s">&quot;Scriptinfo for dotted file can&#39;t be null&quot;</span>);
                        <span class="r805 r">module</span> = <b>new</b> <a href="PSModuleInfo.cs.html#281e3e6d5e6fd712" class="t constructor">PSModuleInfo</a>(<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r793 r">fileName</span>), <span class="r793 r">fileName</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r796 r">ss</span>, <span class="r820 r">ps1ScriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a>);
 
                        <span class="r812 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">DottingScriptFile</span>, <span class="r793 r">fileName</span>);
                        <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r812 r">message</span>);
 
                        <b>try</b>
                        {
                            <span class="r800 r">found</span> = <b>true</b>;
 
                            <a href="../InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r821 rd" class="r821 r">oldInvocationInfo</span> = (<a href="../InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a>)<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#e27d6fa06c233c66" class="i field">MyInvocationVarPath</a>);
                            <b>object</b> <span id="r822 rd" class="r822 r">oldPSScriptRoot</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#a8821ffec06dcc10" class="i field">PSScriptRootVarPath</a>);
                            <b>object</b> <span id="r823 rd" class="r823 r">oldPSCommandPath</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#3a6f9a48ec862dfb" class="i method">GetVariableValue</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#ac811d841f213781" class="i field">PSCommandPathVarPath</a>);
 
                            <b>try</b>
                            {
                                <a href="../InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r824 rd" class="r824 r">invocationInfo</span> = <b>new</b> <a href="../InvocationInfo.cs.html#05f8dff4c341ddae" class="t constructor">InvocationInfo</a>(<span class="r820 r">ps1ScriptInfo</span>, <span class="r820 r">ps1ScriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#7795a39b7e78fc61" class="i property">ScriptBlock</a>.<a href="../runtime/CompiledScriptBlock.cs.html#e028cdfe16daf552" class="i property">Ast</a>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                                <span class="r820 r">ps1ScriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#7795a39b7e78fc61" class="i property">ScriptBlock</a>.<span class="i">InvokeWithPipe</span>(
                                    <span class="i">useLocalScope</span>: <b>false</b>,
                                    <span class="i">errorHandlingBehavior</span>: <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../lang/scriptblock.cs.html#5e78734ffe1c6ed3" class="i field">WriteToCurrentErrorPipe</a>,
                                    <span class="i">dollarUnder</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                                    <span class="i">input</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                                    <span class="i">scriptThis</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                                    <span class="i">outputPipe</span>: ((<a href="../MshCommandRuntime.cs.html#f9ebe6a3b284ab55" class="t t">MshCommandRuntime</a>)<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../cmdlet.cs.html#fa3830ca3ad4b256" class="i property">CommandRuntime</a>).<a href="../MshCommandRuntime.cs.html#b24610eb88ee27e9" class="i property">OutputPipe</a>,
                                    <span class="i">invocationInfo</span>: <span class="r824 r">invocationInfo</span>,
                                    <span class="i">args</span>: <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#e1f617f9af7f631a" class="i property">BaseArgumentList</a> ?? <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;());
                            }
                            <b>finally</b>
                            {
                                <span class="c">// since useLocalScope is set false while calling InvokeWithPipe, we need to</span>
                                <span class="c">// revert the changes made to LocalsTuple</span>
                                <b>if</b> (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a> != <b>null</b>)
                                {
                                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a>.<a href="../runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(
                                        <a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#1c3db3207a8956e8" class="i field">PSScriptRoot</a>, <span class="r822 r">oldPSScriptRoot</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a>.<a href="../runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#b00a55abca04b860" class="i field">PSCommandPath</a>, <span class="r823 r">oldPSCommandPath</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a>.<a href="../runtime/MutableTuple.cs.html#b596dd33aa0e3dbc" class="i method">SetAutomaticVariable</a>(<a href="../SpecialVariables.cs.html#1c6f2efd91287b59" class="t t">AutomaticVariable</a>.<a href="../SpecialVariables.cs.html#80b3b66ce97fc2c9" class="i field">MyInvocation</a>, <span class="r821 r">oldInvocationInfo</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                                }
                            }
 
                            <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r805 r">module</span>);
 
                            <b>if</b> (<a href="#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                            {
                                <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                            }
                            <b>else</b>
                                <span class="c">// If -pass has been specified, emit a module info...</span>
                                <b>if</b> (<a href="#da53dea574e86fa3" class="i property">BasePassThru</a>)
                            {
                                <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>);
                            }
                        }
                        <b>catch</b> (<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r825 rd" class="r825 r">e</span>)
                        {
                            <b>if</b> (<span class="r803 r">writingErrors</span>)
                            {
                                <span class="r825 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../ErrorPackage.cs.html#b119c9996bde5b66" class="i property">PreserveInvocationInfoOnce</a> = <b>true</b>;
                            }
 
                            <b>if</b> (<span class="r825 r">e</span>.<a href="../../utils/RuntimeException.cs.html#07e13566c1a5f36a" class="i property">WasThrownFromThrowStatement</a>)
                            {
                                <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r825 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>);
                            }
                            <b>else</b>
                            {
                                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r825 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>);
                            }
                        }
                        <b>catch</b> (<a href="../lang/parserutils.cs.html#79de2587ceb4dc25" class="t t">ExitException</a> <span id="r826 rd" class="r826 r">ee</span>)
                        {
                            <b>int</b> <span id="r827 rd" class="r827 r">exitCode</span> = (<b>int</b>)<span class="r826 r">ee</span>.<a href="../lang/parserutils.cs.html#d1b0e4525b48e0c9" class="i property">Argument</a>;
                            <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#fe9ae54e56fef582" class="i field">LastExitCodeVarPath</a>, <span class="r827 r">exitCode</span>);
                        }
                    }
                }
                <b>else</b> <b>if</b> (<span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="k">var</a> <span id="r828 rd" class="r828 r">psd1ScriptInfo</span> = <a href="#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r793 r">fileName</span>, <b>out</b> <span class="r810 r">scriptName</span>, <b>true</b>);
                    <span class="r800 r">found</span> = <b>true</b>;
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r828 r">psd1ScriptInfo</span> != <b>null</b>, <span class="s">&quot;Scriptinfo for module manifest (.psd1) can&#39;t be null&quot;</span>);
                    <span class="r805 r">module</span> = <a href="#521cddd2bed306ff" class="i method">LoadModuleManifest</a>(
                        <span class="r828 r">psd1ScriptInfo</span>,
                        <span class="r799 r">manifestProcessingFlags</span>,
                        <a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>,
                        <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>,
                        <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>,
                        <a href="#d3b88fd228891169" class="i property">BaseGuid</a>,
                        <b>ref</b> <span class="r798 r">options</span>);
 
                    <b>if</b> (<span class="r805 r">module</span> != <b>null</b>)
                    {
                        <a href="#bbf5d70671925a2b" class="i method">CheckForDisallowedDotSourcing</a>(<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>, <span class="r828 r">psd1ScriptInfo</span>, <span class="r798 r">options</span>);
 
                        <b>if</b> (<span class="r802 r">importingModule</span>)
                        {
                            <span class="c">// Add it to all the module tables</span>
                            <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r805 r">module</span>);
                        }
 
                        <b>if</b> (<a href="#da53dea574e86fa3" class="i property">BasePassThru</a>)
                        {
                            <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>);
                        }
                    }
                    <b>else</b> <b>if</b> (<a href="#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> != <b>null</b> || <a href="#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> != <b>null</b> || <a href="#d3b88fd228891169" class="i property">BaseGuid</a> != <b>null</b> || <a href="#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> != <b>null</b>)
                    {
                        <span class="r800 r">found</span> = <b>false</b>;
                    }
                }
                <b>else</b> <b>if</b> (<span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                         <span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) ||
                         <span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r805 r">module</span> = <a href="#9d58eed2c872da26" class="i method">LoadBinaryModule</a>(
                        <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r793 r">fileName</span>),
                        <span class="r793 r">fileName</span>,
                        <span class="r829 r">assemblyToLoad</span>: <b>null</b>,
                        <span class="r794 r">moduleBase</span>,
                        <span class="r796 r">ss</span>,
                        <span class="r798 r">options</span>,
                        <span class="r799 r">manifestProcessingFlags</span>,
                        <span class="r795 r">prefix</span>,
                        <span class="r830 r">loadTypes</span>: <b>true</b>,
                        <span class="r831 r">loadFormats</span>: <b>true</b>,
                        <b>out</b> <span class="r800 r">found</span>);
 
                    <b>if</b> (<span class="r800 r">found</span> &amp;&amp; <span class="r805 r">module</span> != <b>null</b>)
                    {
                        <span class="c">// LanguageMode does not apply to binary modules</span>
                        <span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a> = (<a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>?)<b>null</b>;
 
                        <b>if</b> (<span class="r802 r">importingModule</span>)
                        {
                            <span class="c">// Add it to all the module tables</span>
                            <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r805 r">module</span>);
                        }
 
                        <b>if</b> (<a href="#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                        {
                            <span class="r812 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">CantUseAsCustomObjectWithBinaryModule</span>, <span class="r793 r">fileName</span>);
                            <span class="i">InvalidOperationException</span> <span id="r832 rd" class="r832 r">invalidOp</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r812 r">message</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r833 rd" class="r833 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r832 r">invalidOp</span>, <span class="s">&quot;Modules_CantUseAsCustomObjectWithBinaryModule&quot;</span>,
                                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r833 r">er</span>);
                        }
                        <b>else</b> <b>if</b> (<a href="#da53dea574e86fa3" class="i property">BasePassThru</a>)
                        {
                            <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>);
                        }
                    }
                }
                <b>else</b> <b>if</b> (<span class="r804 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8de3ad39fcb348d7" class="i field">PowerShellCmdletizationFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r800 r">found</span> = <b>true</b>;
 
                    <span class="c">// Create the module object...</span>
                    <b>try</b>
                    {
                        <b>string</b> <span id="r834 rd" class="r834 r">moduleName</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r793 r">fileName</span>);
                        <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="k">var</a> <span id="r835 rd" class="r835 r">cdxmlScriptInfo</span> = <a href="#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r793 r">fileName</span>, <b>out</b> <span class="r810 r">scriptName</span>, <b>true</b>);
 
                        <b>try</b>
                        {
                            <span class="c">// generate cmdletization proxies</span>
                            <b>var</b> <span id="r836 rd" class="r836 r">cmdletizationXmlReader</span> = <b>new</b> <span class="i">StringReader</span>(<span class="r835 r">cdxmlScriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#9f9388511bd97894" class="i property">ScriptContents</a>);
                            <b>var</b> <span id="r837 rd" class="r837 r">cmdletizationProxyModuleWriter</span> = <b>new</b> <span class="i">StringWriter</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                            <a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#85d28fff05ca47c3" class="k">var</a> <span id="r838 rd" class="r838 r">scriptWriter</span> = <b>new</b> <span class="t">ScriptWriter</span>(
                                <span class="r836 r">cmdletizationXmlReader</span>,
                                <span class="r834 r">moduleName</span>,
                                <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#4c48c474d18556ef" class="i field">DefaultCmdletAdapter</a>,
                                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../MshCmdlet.cs.html#92387ec2f33e4d8f" class="i property">MyInvocation</a>,
                                <a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#85d28fff05ca47c3" class="t t">ScriptWriter</a>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#881cbfa13f348ccf" class="t t">GenerationOptions</a>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#42cf789515ff4207" class="i field">HelpXml</a>);
 
                            <b>if</b> (!<span class="r802 r">importingModule</span>)
                            {
                                <span class="r805 r">module</span> = <b>new</b> <a href="PSModuleInfo.cs.html#281e3e6d5e6fd712" class="t constructor">PSModuleInfo</a>(<b>null</b>, <span class="r793 r">fileName</span>, <b>null</b>, <b>null</b>, <span class="r835 r">cdxmlScriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a>);
                                <span class="r838 r">scriptWriter</span>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#abf54a5ba53e1968" class="i method">PopulatePSModuleInfo</a>(<span class="r805 r">module</span>);
                                <span class="r838 r">scriptWriter</span>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#5e77c34d16553f4b" class="i method">ReportExportedCommands</a>(<span class="r805 r">module</span>, <span class="r795 r">prefix</span>);
                            }
                            <b>else</b>
                            {
                                <span class="r838 r">scriptWriter</span>.<span class="i">WriteScriptModule</span>(<span class="r837 r">cmdletizationProxyModuleWriter</span>);
                                <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r839 rd" class="r839 r">sb</span> = <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<span class="i">Create</span>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r837 r">cmdletizationProxyModuleWriter</span>.<span class="i">ToString</span>());
 
                                <span class="c">// CDXML doesn&#39;t allow script injection, so it is trusted.</span>
                                <span class="r839 r">sb</span>.<a href="../lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> = <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>;
 
                                <span class="c">// proceed with regular module import</span>
                                <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r840 rd" class="r840 r">results</span>;
                                <span class="r805 r">module</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#52513af7ad379b3d" class="i method">CreateModule</a>(<span class="r834 r">moduleName</span>, <span class="r793 r">fileName</span>, <span class="r839 r">sb</span>, <span class="r796 r">ss</span>, <b>out</b> <span class="r840 r">results</span>, <a href="#e1f617f9af7f631a" class="i property">BaseArgumentList</a>);
                                <span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#9533dfb5c77bd95f" class="i method">SetModuleBase</a>(<span class="r794 r">moduleBase</span>);
                                <span class="r838 r">scriptWriter</span>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#abf54a5ba53e1968" class="i method">PopulatePSModuleInfo</a>(<span class="r805 r">module</span>);
                                <span class="r838 r">scriptWriter</span>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#5e77c34d16553f4b" class="i method">ReportExportedCommands</a>(<span class="r805 r">module</span>, <span class="r795 r">prefix</span>);
 
                                <a href="#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r805 r">module</span>, <span class="r795 r">prefix</span>, <span class="r798 r">options</span>);
 
                                <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r805 r">module</span>);
                            }
                        }
                        <b>catch</b> (<span class="i">Exception</span> <span id="r841 rd" class="r841 r">e</span>)
                        {
                            <b>string</b> <span id="r842 rd" class="r842 r">xmlErrorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="c">// file name is culture agnostic, we want to copy exception message verbatim</span>
                                <span class="i">CmdletizationCoreResources</span>.<span class="i">ExportCimCommand_ErrorInCmdletizationXmlFile</span>,
                                <span class="r793 r">fileName</span>,
                                <span class="r841 r">e</span>.<span class="i">Message</span>);
                            <b>throw</b> <b>new</b> <span class="i">XmlException</span>(<span class="r842 r">xmlErrorMessage</span>, <span class="r841 r">e</span>);
                        }
 
                        <b>if</b> (<a href="#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                        {
                            <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                        }
                        <b>else</b>
                            <span class="c">// If -pass has been specified, emit a module info...</span>
                            <b>if</b> (<a href="#da53dea574e86fa3" class="i property">BasePassThru</a>)
                        {
                            <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r805 r">module</span>);
                        }
                    }
                    <b>catch</b> (<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a> <span id="r843 rd" class="r843 r">e</span>)
                    {
                        <b>if</b> (<span class="r803 r">writingErrors</span>)
                        {
                            <span class="r843 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>.<a href="../ErrorPackage.cs.html#b119c9996bde5b66" class="i property">PreserveInvocationInfoOnce</a> = <b>true</b>;
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r843 r">e</span>.<a href="../../utils/RuntimeException.cs.html#de1b3b901d918614" class="i property">ErrorRecord</a>);
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="r800 r">found</span> = <b>true</b>;
                    <span class="r812 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleExtension</span>, <span class="r804 r">ext</span>, <span class="r793 r">fileName</span>);
                    <span class="i">InvalidOperationException</span> <span id="r844 rd" class="r844 r">invalidOp</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r812 r">message</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r845 rd" class="r845 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r844 r">invalidOp</span>, <span class="s">&quot;Modules_InvalidModuleExtension&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>);
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r845 r">er</span>);
                }
            }
            <b>finally</b>
            {
                <span class="c">// Restore the name of the module being processed...</span>
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a> = <span class="r811 r">_origModuleBeingProcessed</span>;
            }
 
            <span class="c">// If using AppDomain-level module path caching, add this module to the cache. This is only done for</span>
            <span class="c">// the modules loaded with without version info or other qualifiers.</span>
            <b>if</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>.<a href="PSModuleInfo.cs.html#42c3363f19a38c16" class="i property">UseAppDomainLevelModuleCache</a> &amp;&amp; <span class="r805 r">module</span> != <b>null</b> &amp;&amp; <span class="r794 r">moduleBase</span> == <b>null</b> &amp;&amp; <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#172e9b3e1682c172" class="i property">AddToAppDomainLevelCache</a>)
            {
                <span class="c">// Cache using the actual name specified by the user rather than the module basename</span>
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>.<a href="PSModuleInfo.cs.html#c8058e60791a1848" class="i method">AddToAppDomainLevelModuleCache</a>(<span class="r805 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r793 r">fileName</span>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#f8d5c3639f6e81cd" class="i property">BaseForce</a>);
            }
 
            <b>return</b> <span class="r805 r">module</span>;
        }
 
        <b>private void</b> <a id="bbf5d70671925a2b" href="../../R/bbf5d70671925a2b.html" target="n" data-glyph="76,1" class="i method">CheckForDisallowedDotSourcing</a>(
            <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r846 rd" class="r846 r">ss</span>,
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r847 rd" class="r847 r">scriptInfo</span>,
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r848 rd" class="r848 r">options</span>)
        {
            <b>if</b> (<span class="r846 r">ss</span> == <b>null</b> || <span class="r846 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a> == <b>null</b>)
            { <b>return</b>; }
 
            <span class="c">// A manifest with explicit function export is detected through a shared session state or the nested module options, because nested</span>
            <span class="c">// module processing does not use a shared session state.</span>
            <b>var</b> <span id="r849 rd" class="r849 r">manifestWithExplicitFunctionExport</span> = <span class="r846 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#a2d08f2e57242ca4" class="i property">ManifestWithExplicitFunctionExport</a> || <span class="r848 r">options</span>.<a href="#c4cfb75775763c63" class="i field">AllowNestedModuleFunctionsToExport</a>;
 
            <span class="c">// If system is in lock down mode, we disallow trusted modules that use the dotsource operator while simultaneously using</span>
            <span class="c">// wild cards for exporting module functions, unless there is an overriding manifest that explicitly exports functions</span>
            <span class="c">// without wild cards.</span>
            <span class="c">// This is because dotsourcing brings functions into module scope and it is too easy to inadvertently or maliciously</span>
            <span class="c">// expose harmful private functions that run in trusted (FullLanguage) mode.</span>
            <b>if</b> (!<span class="r849 r">manifestWithExplicitFunctionExport</span> &amp;&amp; <span class="r846 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateFunctionAPIs.cs.html#08bfefead0b0647d" class="i property">FunctionsExportedWithWildcard</a> &amp;&amp;
                (<a href="../../security/wldpNativeMethods.cs.html#6b51558a7a8cde26" class="t t">SystemPolicy</a>.<a href="../../security/wldpNativeMethods.cs.html#2c0da8883146dab2" class="i method">GetSystemLockdownPolicy</a>() == <a href="../../security/wldpNativeMethods.cs.html#9f0915f7b351778e" class="t t">SystemEnforcementMode</a>.<a href="../../security/wldpNativeMethods.cs.html#5d74206001d0b817" class="i field">Enforce</a>) &amp;&amp;
                (<span class="r847 r">scriptInfo</span>.<a href="../CommandInfo.cs.html#8677495d43679110" class="i property">DefiningLanguageMode</a> == <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a>))
            {
                <b>var</b> <span id="r850 rd" class="r850 r">dotSourceOperator</span> = <span class="r847 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#64095d3798f7f96a" class="i method">GetScriptBlockAst</a>().<span class="i">FindAll</span>(<span id="r851 rd" class="r851 r">ast</span> =&gt;
                {
                    <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="k">var</a> <span id="r852 rd" class="r852 r">cmdAst</span> = <span class="r851 r">ast</span> <b>as</b> <a href="../parser/ast.cs.html#a310aaa1e0374ddd" class="t t">CommandAst</a>;
                    <b>return</b> (<span class="r852 r">cmdAst</span>?.<a href="../parser/ast.cs.html#16e18484040f8b6f" class="i property">InvocationOperator</a> == <a href="../parser/token.cs.html#a2b5a7fabb06263c" class="t t">TokenKind</a>.<a href="../parser/token.cs.html#a9023444a1ee3a84" class="i field">Dot</a>);
                },
                <span class="i">searchNestedScriptBlocks</span>: <b>true</b>).<span class="i">FirstOrDefault</span>();
 
                <b>if</b> (<span class="r850 r">dotSourceOperator</span> != <b>null</b>)
                {
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r853 rd" class="r853 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                        <b>new</b> <span class="t">PSSecurityException</span>(<span class="i">Modules</span>.<span class="i">CannotUseDotSourceWithWildCardFunctionExport</span>),
                        <span class="s">&quot;Modules_SystemLockDown_CannotUseDotSourceWithWildCardFunctionExport&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#f13302898d557be4" class="i field">SecurityError</a>, <b>null</b>);
                    <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r853 r">errorRecord</span>);
                }
            }
        }
 
        <b>private static bool</b> <a id="989faa45131da71d" href="../../R/989faa45131da71d.html" target="n" data-glyph="76,1" class="i method">ShouldProcessScriptModule</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r854 rd" class="r854 r">parentModule</span>, <b>ref bool</b> <span id="r855 rd" class="r855 r">found</span>)
        {
            <b>bool</b> <span id="r856 rd" class="r856 r">shouldProcessModule</span> = <b>true</b>;
 
            <span class="c">// If we are in module analysis and the parent module declares non-wildcarded exports, then we don&#39;t need to</span>
            <span class="c">// actually process the script module.</span>
            <b>if</b> (<span class="r854 r">parentModule</span> != <b>null</b>)
            {
                <b>if</b> (<span class="r856 r">shouldProcessModule</span> &amp;&amp; (<span class="r854 r">parentModule</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a> != <b>null</b>) &amp;&amp; (<span class="r854 r">parentModule</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a>.<span class="i">Count</span> &gt; 0))
                {
                    <span class="r856 r">shouldProcessModule</span> = <b>false</b>;
 
                    <b>foreach</b> (<b>string</b> <span id="r857 rd" class="r857 r">exportedFunction</span> <b>in</b> <span class="r854 r">parentModule</span>.<a href="PSModuleInfo.cs.html#2faddd301cf044c5" class="i property">ExportedFunctions</a>.<span class="i">Keys</span>)
                    {
                        <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#f9cf207fdd565080" class="i method">ContainsWildcardCharacters</a>(<span class="r857 r">exportedFunction</span>))
                        {
                            <span class="r856 r">shouldProcessModule</span> = <b>true</b>;
                            <b>break</b>;
                        }
                    }
 
                    <span class="r855 r">found</span> = <b>true</b>;
                }
            }
 
            <b>return</b> <span class="r856 r">shouldProcessModule</span>;
        }
 
        <b>private static readonly object</b> <a id="562dc6887a498659" href="../../R/562dc6887a498659.html" target="n" data-glyph="46,1" class="i field">s_lockObject</a> = <b>new</b> <b>object</b>();
 
        <b>private static void</b> <a id="cb596716e0059df7" href="../../R/cb596716e0059df7.html" target="n" data-glyph="76,1" class="i method">ClearAnalysisCaches</a>()
        {
            <b>lock</b> (<a href="#562dc6887a498659" class="i field">s_lockObject</a>)
            {
                <a href="#e4011353a112706e" class="i field">s_binaryAnalysisCache</a>.<span class="i">Clear</span>();
                <a href="#d3167d1471d52545" class="i field">s_scriptAnalysisCache</a>.<span class="i">Clear</span>();
            }
        }
 
        <span class="c">// Analyzes a binary module implementation for its cmdlets.</span>
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Tuple</span>&lt;<a href="#840a95d56ee83b97" class="t t">BinaryAnalysisResult</a>, <span class="i">Version</span>&gt;&gt; <a id="e4011353a112706e" href="../../R/e4011353a112706e.html" target="n" data-glyph="46,1" class="i field">s_binaryAnalysisCache</a> =
            <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <span class="i">Tuple</span>&lt;<a href="#840a95d56ee83b97" class="t t">BinaryAnalysisResult</a>, <span class="i">Version</span>&gt;&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Analyze the module assembly to find out all cmdlets and aliases defined in that assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In CoreCLR, there is only one AppDomain, so we cannot spin up a new AppDomain to load the assembly and do analysis there.</span>
        <span class="c">///</span><span class="c"> So we need to depend on System.Reflection.Metadata (Microsoft.Bcl.Metadata.dll) to analyze the metadata of the assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private static</b> <a href="#840a95d56ee83b97" class="t t">BinaryAnalysisResult</a> <a id="3f13ffd55e93a301" href="../../R/3f13ffd55e93a301.html" target="n" data-glyph="76,1" class="i method">GetCmdletsFromBinaryModuleImplementation</a>(<b>string</b> <span id="r858 rd" class="r858 r">path</span>, <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r859 rd" class="r859 r">manifestProcessingFlags</span>, <b>out</b> <span class="i">Version</span> <span id="r860 rd" class="r860 r">assemblyVersion</span>)
        {
            <span class="i">Tuple</span>&lt;<a href="#840a95d56ee83b97" class="t t">BinaryAnalysisResult</a>, <span class="i">Version</span>&gt; <span id="r861 rd" class="r861 r">tuple</span>;
 
            <b>lock</b> (<a href="#562dc6887a498659" class="i field">s_lockObject</a>)
            {
                <a href="#e4011353a112706e" class="i field">s_binaryAnalysisCache</a>.<span class="i">TryGetValue</span>(<span class="r858 r">path</span>, <b>out</b> <span class="r861 r">tuple</span>);
            }
 
            <b>if</b> (<span class="r861 r">tuple</span> != <b>null</b>)
            {
                <span class="r860 r">assemblyVersion</span> = <span class="r861 r">tuple</span>.<span class="i">Item2</span>;
                <b>return</b> <span class="r861 r">tuple</span>.<span class="i">Item1</span>;
            }
 
            <a href="#840a95d56ee83b97" class="t t">BinaryAnalysisResult</a> <span id="r862 rd" class="r862 r">analysisResult</span> = <a href="../../CoreCLR/CorePsStub.cs.html#f4fb8b5b6704aa5b" class="t t">PowerShellModuleAssemblyAnalyzer</a>.<a href="../../CoreCLR/CorePsStub.cs.html#c02bfbd2b051c153" class="i method">AnalyzeModuleAssembly</a>(<span class="r858 r">path</span>, <b>out</b> <span class="r860 r">assemblyVersion</span>);
            <b>if</b> (<span class="r862 r">analysisResult</span> == <b>null</b> &amp;&amp; <span class="i">Path</span>.<span class="i">IsPathRooted</span>(<span class="r858 r">path</span>))
            {
                <span class="c">// If we couldn&#39;t load it from a file, try finding it in our probing path</span>
                <b>string</b> <span id="r863 rd" class="r863 r">assemblyFilename</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r858 r">path</span>);
                <span class="r862 r">analysisResult</span> = <a href="../../CoreCLR/CorePsStub.cs.html#f4fb8b5b6704aa5b" class="t t">PowerShellModuleAssemblyAnalyzer</a>.<a href="../../CoreCLR/CorePsStub.cs.html#c02bfbd2b051c153" class="i method">AnalyzeModuleAssembly</a>(<span class="r863 r">assemblyFilename</span>, <b>out</b> <span class="r860 r">assemblyVersion</span>);
            }
 
            <b>var</b> <span id="r864 rd" class="r864 r">resultToReturn</span> = <span class="r862 r">analysisResult</span> ?? <b>new</b> <span class="t">BinaryAnalysisResult</span>();
 
            <b>lock</b> (<a href="#562dc6887a498659" class="i field">s_lockObject</a>)
            {
                <a href="#e4011353a112706e" class="i field">s_binaryAnalysisCache</a>[<span class="r858 r">path</span>] = <span class="i">Tuple</span>.<span class="i">Create</span>(<span class="r864 r">resultToReturn</span>, <span class="r860 r">assemblyVersion</span>);
            }
 
            <b>return</b> <span class="r864 r">resultToReturn</span>;
        }
 
        <span class="c">// Analyzes a script module implementation for its exports.</span>
        <b>private static readonly</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="d3167d1471d52545" href="../../R/d3167d1471d52545.html" target="n" data-glyph="46,1" class="i field">s_scriptAnalysisCache</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="d7d5bfeff08b1bc4" href="../../R/d7d5bfeff08b1bc4.html" target="n" data-glyph="76,1" class="i method">AnalyzeScriptFile</a>(<b>string</b> <span id="r865 rd" class="r865 r">filename</span>, <b>bool</b> <span id="r866 rd" class="r866 r">force</span>, <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r867 rd" class="r867 r">context</span>)
        {
            <span class="c">// We need to return a cloned version here.</span>
            <span class="c">// This is because the Get-Module -List -All modifies the returned module info and we do not want the original one changed.</span>
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r868 rd" class="r868 r">module</span> = <b>null</b>;
 
            <b>lock</b> (<a href="#562dc6887a498659" class="i field">s_lockObject</a>)
            {
                <a href="#d3167d1471d52545" class="i field">s_scriptAnalysisCache</a>.<span class="i">TryGetValue</span>(<span class="r865 r">filename</span>, <b>out</b> <span class="r868 r">module</span>);
            }
 
            <b>if</b> (<span class="r868 r">module</span> != <b>null</b>)
                <b>return</b> <span class="r868 r">module</span>.<a href="PSModuleInfo.cs.html#305a7717f767719a" class="i method">Clone</a>();
 
            <span class="c">// fake/empty manifestInfo for processing in (!loadElements) mode</span>
            <span class="r868 r">module</span> = <b>new</b> <a href="PSModuleInfo.cs.html#59ece63f8f427775" class="t constructor">PSModuleInfo</a>(<span class="r865 r">filename</span>, <b>null</b>, <b>null</b>);
 
            <b>if</b> (!<span class="r866 r">force</span>)
            {
                <b>var</b> <span id="r869 rd" class="r869 r">exportedCommands</span> = <a href="AnalysisCache.cs.html#e469d7c6575d3464" class="t t">AnalysisCache</a>.<a href="AnalysisCache.cs.html#c5534fd9817cef4e" class="i method">GetExportedCommands</a>(<span class="r865 r">filename</span>, <b>true</b>, <span class="r867 r">context</span>);
 
                <span class="c">// If we have this info cached, return from the cache.</span>
                <b>if</b> (<span class="r869 r">exportedCommands</span> != <b>null</b>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r870 rd" class="r870 r">pair</span> <b>in</b> <span class="r869 r">exportedCommands</span>)
                    {
                        <b>var</b> <span id="r871 rd" class="r871 r">commandName</span> = <span class="r870 r">pair</span>.<span class="i">Key</span>;
                        <b>var</b> <span id="r872 rd" class="r872 r">commandType</span> = <span class="r870 r">pair</span>.<span class="i">Value</span>;
 
                        <b>if</b> ((<span class="r872 r">commandType</span> &amp; <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#83aa5e1f88cb9bf5" class="i field">Alias</a>) == <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#83aa5e1f88cb9bf5" class="i field">Alias</a>)
                        {
                            <span class="r868 r">module</span>.<span class="i">AddDetectedAliasExport</span>(<span class="r871 r">commandName</span>, <b>null</b>);
                        }
 
                        <b>if</b> ((<span class="r872 r">commandType</span> &amp; <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#8a4bdbbd93f182bf" class="i field">Function</a>) == <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#8a4bdbbd93f182bf" class="i field">Function</a>)
                        {
                            <span class="r868 r">module</span>.<span class="i">AddDetectedFunctionExport</span>(<span class="r871 r">commandName</span>);
                        }
 
                        <b>if</b> ((<span class="r872 r">commandType</span> &amp; <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#e95f2e5deaaf9b93" class="i field">Cmdlet</a>) == <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#e95f2e5deaaf9b93" class="i field">Cmdlet</a>)
                        {
                            <span class="r868 r">module</span>.<span class="i">AddDetectedCmdletExport</span>(<span class="r871 r">commandName</span>);
                        }
 
                        <b>if</b> ((<span class="r872 r">commandType</span> &amp; <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#2a673544a3a7e93f" class="i field">Configuration</a>) == <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#2a673544a3a7e93f" class="i field">Configuration</a>)
                        {
                            <span class="r868 r">module</span>.<span class="i">AddDetectedFunctionExport</span>(<span class="r871 r">commandName</span>);
                        }
                    }
 
                    <b>lock</b> (<a href="#562dc6887a498659" class="i field">s_lockObject</a>)
                    {
                        <a href="#d3167d1471d52545" class="i field">s_scriptAnalysisCache</a>[<span class="r865 r">filename</span>] = <span class="r868 r">module</span>;
                    }
 
                    <b>return</b> <span class="r868 r">module</span>;
                }
            }
 
            <span class="c">// We don&#39;t have this cached, analyze the file.</span>
            <a href="ScriptAnalysis.cs.html#2e6e7c9b1f1971eb" class="k">var</a> <span id="r873 rd" class="r873 r">scriptAnalysis</span> = <a href="ScriptAnalysis.cs.html#2e6e7c9b1f1971eb" class="t t">ScriptAnalysis</a>.<a href="ScriptAnalysis.cs.html#9ff5957af5fe6571" class="i method">Analyze</a>(<span class="r865 r">filename</span>, <span class="r867 r">context</span>);
 
            <b>if</b> (<span class="r873 r">scriptAnalysis</span> == <b>null</b>)
            {
                <b>return</b> <span class="r868 r">module</span>;
            }
 
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r874 rd" class="r874 r">scriptAnalysisPatterns</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
            <b>foreach</b> (<b>string</b> <span id="r875 rd" class="r875 r">discoveredCommandFilter</span> <b>in</b> <span class="r873 r">scriptAnalysis</span>.<a href="ScriptAnalysis.cs.html#e87b5924da0eaa94" class="i property">DiscoveredCommandFilters</a>)
            {
                <span class="r874 r">scriptAnalysisPatterns</span>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r875 r">discoveredCommandFilter</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
            }
 
            <span class="c">// Add any directly discovered exports</span>
            <b>foreach</b> (<b>var</b> <span id="r876 rd" class="r876 r">command</span> <b>in</b> <span class="r873 r">scriptAnalysis</span>.<a href="ScriptAnalysis.cs.html#c38afc1469e4e905" class="i property">DiscoveredExports</a>)
            {
                <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r876 r">command</span>, <span class="r874 r">scriptAnalysisPatterns</span>, <b>true</b>))
                {
                    <b>if</b> (!<span class="i">HasInvalidCharacters</span>(<span class="r876 r">command</span>.<span class="i">Replace</span>(<span class="s">&quot;-&quot;</span>, <b>string</b>.<span class="i">Empty</span>)))
                    {
                        <span class="r868 r">module</span>.<span class="i">AddDetectedFunctionExport</span>(<span class="r876 r">command</span>);
                    }
                }
            }
 
            <span class="c">// Add the discovered aliases</span>
            <b>foreach</b> (<b>var</b> <span id="r877 rd" class="r877 r">pair</span> <b>in</b> <span class="r873 r">scriptAnalysis</span>.<a href="ScriptAnalysis.cs.html#555e98f38c0bdb15" class="i property">DiscoveredAliases</a>)
            {
                <b>var</b> <span id="r878 rd" class="r878 r">commandName</span> = <span class="r877 r">pair</span>.<span class="i">Key</span>;
                <span class="c">// These are already filtered</span>
                <b>if</b> (!<span class="i">HasInvalidCharacters</span>(<span class="r878 r">commandName</span>.<span class="i">Replace</span>(<span class="s">&quot;-&quot;</span>, <b>string</b>.<span class="i">Empty</span>)))
                {
                    <span class="r868 r">module</span>.<span class="i">AddDetectedAliasExport</span>(<span class="r878 r">commandName</span>, <span class="r877 r">pair</span>.<span class="i">Value</span>);
                }
            }
 
            <span class="c">// Add the discovered exported types</span>
            <span class="r868 r">module</span>.<a href="PSModuleInfo.cs.html#2c2bd915b7feab1a" class="i method">AddDetectedTypeExports</a>(<span class="r873 r">scriptAnalysis</span>.<a href="ScriptAnalysis.cs.html#bfad1077264d648a" class="i property">DiscoveredClasses</a>);
 
            <span class="c">// Add any files in PsScriptRoot if it added itself to the path</span>
            <b>if</b> (<span class="r873 r">scriptAnalysis</span>.<a href="ScriptAnalysis.cs.html#8628e703aa25ac68" class="i property">AddsSelfToPath</a>)
            {
                <b>string</b> <span id="r879 rd" class="r879 r">baseDirectory</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r865 r">filename</span>);
 
                <b>try</b>
                {
                    <b>foreach</b> (<b>string</b> <span id="r880 rd" class="r880 r">item</span> <b>in</b> <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<span class="r879 r">baseDirectory</span>, <span class="s">&quot;*.ps1&quot;</span>))
                    {
                        <span class="r868 r">module</span>.<span class="i">AddDetectedFunctionExport</span>(<span class="i">Path</span>.<span class="i">GetFileNameWithoutExtension</span>(<span class="r880 r">item</span>));
                    }
                }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span>)
                {
                    <span class="c">// Consume this exception here</span>
                }
            }
 
            <span class="c">// Process any referenced modules</span>
            <b>foreach</b> (<a href="ScriptAnalysis.cs.html#4338f9d8512eeb59" class="t t">RequiredModuleInfo</a> <span id="r881 rd" class="r881 r">requiredModule</span> <b>in</b> <span class="r873 r">scriptAnalysis</span>.<a href="ScriptAnalysis.cs.html#5fcd03a802c8c8fd" class="i property">DiscoveredModules</a>)
            {
                <b>string</b> <span id="r882 rd" class="r882 r">moduleToProcess</span> = <span class="r881 r">requiredModule</span>.<a href="ScriptAnalysis.cs.html#eccd719226aaf6a1" class="i property">Name</a>;
                <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r883 rd" class="r883 r">processedModules</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
                <span class="c">// If this has an extension, and it&#39;s a relative path,</span>
                <span class="c">// then we need to ensure it&#39;s a fully-qualified path</span>
                <b>if</b> ((<span class="r882 r">moduleToProcess</span>.<span class="i">IndexOfAny</span>(<span class="i">Path</span>.<span class="i">GetInvalidPathChars</span>()) == -1) &amp;&amp;
                    <span class="i">Path</span>.<span class="i">HasExtension</span>(<span class="r882 r">moduleToProcess</span>) &amp;&amp;
                    (!<span class="i">Path</span>.<span class="i">IsPathRooted</span>(<span class="r882 r">moduleToProcess</span>)))
                {
                    <b>string</b> <span id="r884 rd" class="r884 r">moduleDirectory</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r865 r">filename</span>);
                    <span class="r882 r">moduleToProcess</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r884 r">moduleDirectory</span>, <span class="r882 r">moduleToProcess</span>);
 
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r885 rd" class="r885 r">fileBasedModule</span> = <a href="#222659eb1c55fa4e" class="i method">CreateModuleInfoForGetModule</a>(<span class="r882 r">moduleToProcess</span>, <b>true</b>);
                    <b>if</b> (<span class="r885 r">fileBasedModule</span> != <b>null</b>)
                    {
                        <span class="r883 r">processedModules</span>.<span class="i">Add</span>(<span class="r885 r">fileBasedModule</span>);
                    }
                }
                <b>else</b>
                {
                    <span class="c">// This is a named module</span>
                    <span class="r883 r">processedModules</span>.<span class="i">AddRange</span>(<a href="#c18fe484b0438291" class="i method">GetModule</a>(<b>new</b> <b>string</b>[] { <span class="r882 r">moduleToProcess</span> }, <b>false</b>, <b>true</b>));
                }
 
                <b>if</b> ((<span class="r883 r">processedModules</span> == <b>null</b>) || (<span class="r883 r">processedModules</span>.<span class="i">Count</span> == 0))
                {
                    <b>continue</b>;
                }
 
                <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r886 rd" class="r886 r">patterns</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <b>foreach</b> (<b>var</b> <span id="r887 rd" class="r887 r">discoveredCommandFilter</span> <b>in</b> <span class="r881 r">requiredModule</span>.<a href="ScriptAnalysis.cs.html#379dff66ea3e53aa" class="i property">CommandsToPostFilter</a>)
                {
                    <span class="r886 r">patterns</span>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">Get</span>(<span class="r887 r">discoveredCommandFilter</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                }
 
                <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r888 rd" class="r888 r">processedModule</span> <b>in</b> <span class="r883 r">processedModules</span>)
                {
                    <b>foreach</b> (<b>string</b> <span id="r889 rd" class="r889 r">commandName</span> <b>in</b> <span class="r888 r">processedModule</span>.<a href="PSModuleInfo.cs.html#2faddd301cf044c5" class="i property">ExportedFunctions</a>.<span class="i">Keys</span>)
                    {
                        <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r889 r">commandName</span>, <span class="r886 r">patterns</span>, <b>true</b>) &amp;&amp;
                            <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r889 r">commandName</span>, <span class="r874 r">scriptAnalysisPatterns</span>, <b>true</b>))
                        {
                            <b>if</b> (!<span class="i">HasInvalidCharacters</span>(<span class="r889 r">commandName</span>.<span class="i">Replace</span>(<span class="s">&quot;-&quot;</span>, <b>string</b>.<span class="i">Empty</span>)))
                            {
                                <span class="r868 r">module</span>.<a href="PSModuleInfo.cs.html#da6b3bbed9e6a774" class="i method">AddDetectedFunctionExport</a>(<span class="r889 r">commandName</span>);
                            }
                        }
                    }
 
                    <b>foreach</b> (<b>string</b> <span id="r890 rd" class="r890 r">commandName</span> <b>in</b> <span class="r888 r">processedModule</span>.<a href="PSModuleInfo.cs.html#7afed1303b45c0b4" class="i property">ExportedCmdlets</a>.<span class="i">Keys</span>)
                    {
                        <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r890 r">commandName</span>, <span class="r886 r">patterns</span>, <b>true</b>) &amp;&amp;
                            <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r890 r">commandName</span>, <span class="r874 r">scriptAnalysisPatterns</span>, <b>true</b>))
                        {
                            <b>if</b> (!<span class="i">HasInvalidCharacters</span>(<span class="r890 r">commandName</span>.<span class="i">Replace</span>(<span class="s">&quot;-&quot;</span>, <b>string</b>.<span class="i">Empty</span>)))
                            {
                                <span class="r868 r">module</span>.<a href="PSModuleInfo.cs.html#7b16924d44edf912" class="i method">AddDetectedCmdletExport</a>(<span class="r890 r">commandName</span>);
                            }
                        }
                    }
 
                    <b>foreach</b> (<b>var</b> <span id="r891 rd" class="r891 r">pair</span> <b>in</b> <span class="r888 r">processedModule</span>.<a href="PSModuleInfo.cs.html#992cd7d7155ed907" class="i property">ExportedAliases</a>)
                    {
                        <b>string</b> <span id="r892 rd" class="r892 r">commandName</span> = <span class="r891 r">pair</span>.<span class="i">Key</span>;
                        <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r892 r">commandName</span>, <span class="r886 r">patterns</span>, <b>true</b>) &amp;&amp;
                            <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r892 r">commandName</span>, <span class="r874 r">scriptAnalysisPatterns</span>, <b>true</b>))
                        {
                            <span class="r868 r">module</span>.<span class="i">AddDetectedAliasExport</span>(<span class="r892 r">commandName</span>, <span class="r891 r">pair</span>.<span class="i">Value</span>.<span class="i">Definition</span>);
                        }
                    }
                }
            }
 
            <span class="c">// Cache the module&#39;s exported commands</span>
            <b>if</b> (!<span class="r868 r">module</span>.<a href="PSModuleInfo.cs.html#e160146a2d150faf" class="i property">HadErrorsLoading</a>)
            {
                <a href="AnalysisCache.cs.html#e469d7c6575d3464" class="t t">AnalysisCache</a>.<a href="AnalysisCache.cs.html#5d11fb6947296177" class="i method">CacheModuleExports</a>(<span class="r868 r">module</span>, <span class="r867 r">context</span>);
            }
            <b>else</b>
            {
                <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b5fe290216e5c03" class="i field">Tracer</a>.<a href="../../utils/StructuredTraceSource.cs.html#25b8416175e53218" class="i method">WriteLine</a>(<span class="s">&quot;Caching skipped for {0} because it had errors while loading.&quot;</span>, <span class="r868 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
            }
 
            <b>lock</b> (<a href="#562dc6887a498659" class="i field">s_lockObject</a>)
            {
                <a href="#d3167d1471d52545" class="i field">s_scriptAnalysisCache</a>[<span class="r865 r">filename</span>] = <span class="r868 r">module</span>;
            }
 
            <b>return</b> <span class="r868 r">module</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load a binary module. A binary module is an assembly that should contain cmdlets.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r893 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the snapin or assembly to load.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r894 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the assembly to load.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r829 r">assemblyToLoad</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The assembly to load so no lookup need be done.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r895 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module base to use for this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r896 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The session state instance to use for this module. Normally binary modules don&#39;t have a session state</span>
        <span class="c">///</span><span class="c"> instance, however when loaded through a module manifest with nested modules, it will have a session</span>
        <span class="c">///</span><span class="c"> state instance to store the imported functions, aliases and variables.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r897 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r898 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest processing flags to use when processing the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r830 r">loadTypes</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Load the types files mentioned in the snapin registration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r831 r">loadFormats</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Load the formst files mentioned in the snapin registration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r899 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r900 r">found</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sets this to true if an assembly was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">THe module info object that was created...</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="9d58eed2c872da26" href="../../R/9d58eed2c872da26.html" target="n" data-glyph="74,1" class="i method">LoadBinaryModule</a>(
            <b>string</b> <span id="r893 rd" class="r893 r">moduleName</span>,
            <b>string</b> <span id="r894 rd" class="r894 r">fileName</span>,
            <span class="i">Assembly</span> <span id="r829 rd" class="r829 r">assemblyToLoad</span>,
            <b>string</b> <span id="r895 rd" class="r895 r">moduleBase</span>,
            <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r896 rd" class="r896 r">ss</span>,
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r897 rd" class="r897 r">options</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r898 rd" class="r898 r">manifestProcessingFlags</span>,
            <b>string</b> <span id="r899 rd" class="r899 r">prefix</span>,
            <b>bool</b> <span id="r830 rd" class="r830 r">loadTypes</span>,
            <b>bool</b> <span id="r831 rd" class="r831 r">loadFormats</span>,
            <b>out bool</b> <span id="r900 rd" class="r900 r">found</span>)
        {
            <b>return</b> <a href="#7673cdb4a88de68d" class="i method">LoadBinaryModule</a>(
                <span class="r901 r">parentModule</span>: <b>null</b>,
                <span class="r893 r">moduleName</span>,
                <span class="r894 r">fileName</span>,
                <span class="r829 r">assemblyToLoad</span>,
                <span class="r895 r">moduleBase</span>,
                <span class="r896 r">ss</span>,
                <span class="r897 r">options</span>,
                <span class="r898 r">manifestProcessingFlags</span>,
                <span class="r899 r">prefix</span>,
                <span class="r830 r">loadTypes</span>,
                <span class="r831 r">loadFormats</span>,
                <b>out</b> <span class="r900 r">found</span>,
                <span class="r902 r">shortModuleName</span>: <b>null</b>,
                <span class="r114 r">disableFormatUpdates</span>: <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load a binary module. A binary module is an assembly that should contain cmdlets.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r901 r">parentModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The parent module for which this module is a nested module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r903 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the snapin or assembly to load.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">fileName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the assembly to load.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">assemblyToLoad</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The assembly to load so no lookup need be done.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r904 r">moduleBase</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module base to use for this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r905 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The session state instance to use for this module. Normally binary modules don&#39;t have a session state</span>
        <span class="c">///</span><span class="c">   instance, however when loaded through a module manifest with nested modules, it will have a session</span>
        <span class="c">///</span><span class="c">   state instance to store the imported functions, aliases and variables.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r906 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r907 r">manifestProcessingFlags</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The manifest processing flags to use when processing the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r908 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r909 r">loadTypes</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Load the types files mentioned in the snapin registration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r910 r">loadFormats</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Load the formst files mentioned in the snapin registration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r911 r">found</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Sets this to true if an assembly was found.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r902 r">shortModuleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Short name for module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">disableFormatUpdates</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">THe module info object that was created...</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="7673cdb4a88de68d" href="../../R/7673cdb4a88de68d.html" target="n" data-glyph="74,1" class="i method">LoadBinaryModule</a>(
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r901 rd" class="r901 r">parentModule</span>,
            <b>string</b> <span id="r903 rd" class="r903 r">moduleName</span>,
            <b>string</b> <span id="r112 rd" class="r112 r">fileName</span>,
            <span class="i">Assembly</span> <span id="r113 rd" class="r113 r">assemblyToLoad</span>,
            <b>string</b> <span id="r904 rd" class="r904 r">moduleBase</span>,
            <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r905 rd" class="r905 r">ss</span>,
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r906 rd" class="r906 r">options</span>,
            <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a> <span id="r907 rd" class="r907 r">manifestProcessingFlags</span>,
            <b>string</b> <span id="r908 rd" class="r908 r">prefix</span>,
            <b>bool</b> <span id="r909 rd" class="r909 r">loadTypes</span>,
            <b>bool</b> <span id="r910 rd" class="r910 r">loadFormats</span>,
            <b>out bool</b> <span id="r911 rd" class="r911 r">found</span>,
            <b>string</b> <span id="r902 rd" class="r902 r">shortModuleName</span>,
            <b>bool</b> <span id="r114 rd" class="r114 r">disableFormatUpdates</span>)
        {
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r912 rd" class="r912 r">module</span> = <b>null</b>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r903 r">moduleName</span>) &amp;&amp; <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r112 r">fileName</span>) &amp;&amp; <span class="r113 r">assemblyToLoad</span> == <b>null</b>)
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<span class="s">&quot;moduleName,fileName,assemblyToLoad&quot;</span>);
 
            <span class="c">// Load the dll and process any cmdlets it might contain...</span>
            <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r913 rd" class="r913 r">iss</span> = <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#6aee0258f9ef7599" class="i method">Create</a>();
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r914 rd" class="r914 r">detectedCmdlets</span> = <b>null</b>;
            <span class="i">List</span>&lt;<span class="i">Tuple</span>&lt;<b>string</b>, <b>string</b>&gt;&gt; <span id="r915 rd" class="r915 r">detectedAliases</span> = <b>null</b>;
            <span class="i">Assembly</span> <span id="r916 rd" class="r916 r">assembly</span> = <b>null</b>;
            <span class="i">Exception</span> <span id="r917 rd" class="r917 r">error</span> = <b>null</b>;
            <b>string</b> <span id="r918 rd" class="r918 r">modulePath</span> = <b>string</b>.<span class="i">Empty</span>;
            <span class="i">Version</span> <span id="r919 rd" class="r919 r">assemblyVersion</span> = <b>new</b> <span class="i">Version</span>(0, 0, 0, 0);
            <b>var</b> <span id="r920 rd" class="r920 r">importingModule</span> = (<span class="r907 r">manifestProcessingFlags</span> &amp; <a href="#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="#4195724a6acb2c06" class="i field">LoadElements</a>) != 0;
 
            <span class="c">// See if we&#39;re loading a straight assembly...</span>
            <b>if</b> (<span class="r113 r">assemblyToLoad</span> != <b>null</b>)
            {
                <span class="c">// Figure out what to use for a module path...</span>
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r112 r">fileName</span>))
                {
                    <span class="r918 r">modulePath</span> = <span class="r112 r">fileName</span>;
                }
                <b>else</b>
                {
                    <span class="r918 r">modulePath</span> = <span class="r113 r">assemblyToLoad</span>.<span class="i">Location</span>;
                }
 
                <span class="c">// And what to use for a module name...</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r903 r">moduleName</span>))
                {
                    <span class="r903 r">moduleName</span> = <span class="s">&quot;dynamic_code_module_&quot;</span> + <span class="r113 r">assemblyToLoad</span>.<span class="i">GetName</span>();
                }
 
                <b>if</b> (<span class="r920 r">importingModule</span>)
                {
                    <span class="c">// Passing module as a parameter here so that the providers can have the module property populated.</span>
                    <span class="c">// For engine providers, the module should point to top-level module name</span>
                    <span class="c">// For FileSystem, the module is Microsoft.PowerShell.Core and not System.Management.Automation</span>
                    <b>if</b> (<span class="r901 r">parentModule</span> != <b>null</b> &amp;&amp; <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#7c1caf70ca3d20ee" class="i method">IsEngineModule</a>(<span class="r901 r">parentModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>))
                    {
                        <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#16c2d865cbb0f5ba" class="i method">ImportCmdletsFromAssembly</a>(<span class="r113 r">assemblyToLoad</span>, <span class="r901 r">parentModule</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#16c2d865cbb0f5ba" class="i method">ImportCmdletsFromAssembly</a>(<span class="r113 r">assemblyToLoad</span>, <b>null</b>);
                    }
                }
 
                <span class="r919 r">assemblyVersion</span> = <a href="#8fd180a6a7ad9c2c" class="i method">GetAssemblyVersionNumber</a>(<span class="r113 r">assemblyToLoad</span>);
                <span class="r916 r">assembly</span> = <span class="r113 r">assemblyToLoad</span>;
                <span class="c">// If this is an in-memory only assembly, add it directly to the assembly cache if</span>
                <span class="c">// it isn&#39;t already there.</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r916 r">assembly</span>.<span class="i">Location</span>))
                {
                    <b>if</b> (!<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#1d21e5a1ed78a821" class="i property">AssemblyCache</a>.<span class="i">ContainsKey</span>(<span class="r916 r">assembly</span>.<span class="i">FullName</span>))
                    {
                        <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#1d21e5a1ed78a821" class="i property">AssemblyCache</a>.<span class="i">Add</span>(<span class="r916 r">assembly</span>.<span class="i">FullName</span>, <span class="r916 r">assembly</span>);
                    }
                }
            }
            <b>else</b> <b>if</b> (<span class="r920 r">importingModule</span>)
            {
                <span class="r916 r">assembly</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#bc1bafaf5d7b0ca2" class="i method">AddAssembly</a>(<span class="r903 r">moduleName</span>, <span class="r112 r">fileName</span>, <b>out</b> <span class="r917 r">error</span>);
 
                <b>if</b> (<span class="r916 r">assembly</span> == <b>null</b>)
                {
                    <b>if</b> (<span class="r917 r">error</span> != <b>null</b>)
                        <b>throw</b> <span class="r917 r">error</span>;
 
                    <span class="r911 r">found</span> = <b>false</b>;
                    <b>return</b> <b>null</b>;
                }
 
                <span class="r919 r">assemblyVersion</span> = <a href="#8fd180a6a7ad9c2c" class="i method">GetAssemblyVersionNumber</a>(<span class="r916 r">assembly</span>);
 
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r112 r">fileName</span>))
                    <span class="r918 r">modulePath</span> = <span class="r916 r">assembly</span>.<span class="i">Location</span>;
                <b>else</b>
                    <span class="r918 r">modulePath</span> = <span class="r112 r">fileName</span>;
 
                <span class="c">// Passing module as a parameter here so that the providers can have the module property populated.</span>
                <span class="c">// For engine providers, the module should point to top-level module name</span>
                <span class="c">// For FileSystem, the module is Microsoft.PowerShell.Core and not System.Management.Automation</span>
                <b>if</b> (<span class="r901 r">parentModule</span> != <b>null</b> &amp;&amp; <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#7c1caf70ca3d20ee" class="i method">IsEngineModule</a>(<span class="r901 r">parentModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>))
                {
                    <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#16c2d865cbb0f5ba" class="i method">ImportCmdletsFromAssembly</a>(<span class="r916 r">assembly</span>, <span class="r901 r">parentModule</span>);
                }
                <b>else</b>
                {
                    <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#16c2d865cbb0f5ba" class="i method">ImportCmdletsFromAssembly</a>(<span class="r916 r">assembly</span>, <b>null</b>);
                }
            }
            <b>else</b>
            {
                <b>string</b> <span id="r921 rd" class="r921 r">binaryPath</span> = <span class="r112 r">fileName</span>;
                <span class="r918 r">modulePath</span> = <span class="r112 r">fileName</span>;
                <b>if</b> (<span class="r921 r">binaryPath</span> == <b>null</b>)
                {
                    <span class="r921 r">binaryPath</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">Combine</span>(<span class="r904 r">moduleBase</span>, <span class="r903 r">moduleName</span>);
                }
 
                <a href="#840a95d56ee83b97" class="t t">BinaryAnalysisResult</a> <span id="r922 rd" class="r922 r">analysisResult</span> = <a href="#3f13ffd55e93a301" class="i method">GetCmdletsFromBinaryModuleImplementation</a>(<span class="r921 r">binaryPath</span>, <span class="r907 r">manifestProcessingFlags</span>, <b>out</b> <span class="r919 r">assemblyVersion</span>);
                <span class="r914 r">detectedCmdlets</span> = <span class="r922 r">analysisResult</span>.<a href="#3673a7597d9f3d86" class="i property">DetectedCmdlets</a>;
                <span class="r915 r">detectedAliases</span> = <span class="r922 r">analysisResult</span>.<a href="#5f8f17f3134355b2" class="i property">DetectedAliases</a>;
            }
 
            <span class="r911 r">found</span> = <b>true</b>;
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r902 r">shortModuleName</span>))
                <span class="r912 r">module</span> = <b>new</b> <a href="PSModuleInfo.cs.html#82c685f79205f6f4" class="t constructor">PSModuleInfo</a>(<span class="r903 r">moduleName</span>, <span class="r918 r">modulePath</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r905 r">ss</span>);
            <b>else</b>
                <span class="r912 r">module</span> = <b>new</b> <a href="PSModuleInfo.cs.html#82c685f79205f6f4" class="t constructor">PSModuleInfo</a>(<span class="r902 r">shortModuleName</span>, <span class="r918 r">modulePath</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r905 r">ss</span>);
 
            <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#1c66a8819a72670d" class="i field">Binary</a>);
            <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#9533dfb5c77bd95f" class="i method">SetModuleBase</a>(<span class="r904 r">moduleBase</span>);
            <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#86de19074268f803" class="i method">SetVersion</a>(<span class="r919 r">assemblyVersion</span>);
            <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#7adbb859c851b2e4" class="i property">ImplementingAssembly</a> = <span class="r113 r">assemblyToLoad</span> ?? <span class="r916 r">assembly</span>;
 
            <b>if</b> (<span class="r920 r">importingModule</span>)
            {
                <a href="#180d2b67fc813ae6" class="i method">SetModuleLoggingInformation</a>(<span class="r912 r">module</span>);
            }
 
            <span class="c">// Add the types table entries</span>
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r923 rd" class="r923 r">typesFileNames</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <b>foreach</b> (<a href="../InitialSessionState.cs.html#02c5fb84a39526f6" class="t t">SessionStateTypeEntry</a> <span id="r924 rd" class="r924 r">sste</span> <b>in</b> <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#0f0c3a5adb4b1776" class="i property">Types</a>)
            {
                <span class="r923 r">typesFileNames</span>.<span class="i">Add</span>(<span class="r924 r">sste</span>.<a href="../InitialSessionState.cs.html#335a66dec2c02166" class="i property">FileName</a>);
            }
 
            <b>if</b> (<span class="r923 r">typesFileNames</span>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#87f1728ba7490f93" class="i method">SetExportedTypeFiles</a>(<b>new</b> <span class="i">ReadOnlyCollection</span>&lt;<b>string</b>&gt;(<span class="r923 r">typesFileNames</span>));
            }
 
            <span class="c">// Add the format file entries</span>
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r925 rd" class="r925 r">formatsFileNames</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <b>foreach</b> (<a href="../InitialSessionState.cs.html#6166917bdff50809" class="t t">SessionStateFormatEntry</a> <span id="r926 rd" class="r926 r">ssfe</span> <b>in</b> <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#4e7657f066102cad" class="i property">Formats</a>)
            {
                <span class="r925 r">formatsFileNames</span>.<span class="i">Add</span>(<span class="r926 r">ssfe</span>.<a href="../InitialSessionState.cs.html#f6108e84d6fcb004" class="i property">FileName</a>);
            }
 
            <b>if</b> (<span class="r925 r">formatsFileNames</span>.<span class="i">Count</span> &gt; 0)
            {
                <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#1d33b07765cb3293" class="i method">SetExportedFormatFiles</a>(<b>new</b> <span class="i">ReadOnlyCollection</span>&lt;<b>string</b>&gt;(<span class="r925 r">formatsFileNames</span>));
            }
 
            <span class="c">// Add the module info the providers...</span>
            <b>foreach</b> (<a href="../InitialSessionState.cs.html#236a07b6fd3f0e39" class="t t">SessionStateProviderEntry</a> <span id="r927 rd" class="r927 r">sspe</span> <b>in</b> <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#901a2e8b67c4db16" class="i property">Providers</a>)
            {
                <span class="c">// For engine providers, the module should point to top-level module name</span>
                <span class="c">// For FileSystem, the module is Microsoft.PowerShell.Core and not System.Management.Automation</span>
                <b>if</b> (<span class="r901 r">parentModule</span> != <b>null</b> &amp;&amp; <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#7c1caf70ca3d20ee" class="i method">IsEngineModule</a>(<span class="r901 r">parentModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>))
                {
                    <span class="r927 r">sspe</span>.<a href="../InitialSessionState.cs.html#47559105ce54572d" class="i method">SetModule</a>(<span class="r901 r">parentModule</span>);
                }
                <b>else</b>
                {
                    <span class="r927 r">sspe</span>.<a href="../InitialSessionState.cs.html#47559105ce54572d" class="i method">SetModule</a>(<span class="r912 r">module</span>);
                }
            }
 
            <span class="c">// Add all of the exported cmdlets to the module object...</span>
            <b>if</b> (<span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a> != <b>null</b>)
            {
                <b>foreach</b> (<a href="../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a> <span id="r928 rd" class="r928 r">commandEntry</span> <b>in</b> <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>)
                {
                    <span class="r928 r">commandEntry</span>.<a href="../InitialSessionState.cs.html#47559105ce54572d" class="i method">SetModule</a>(<span class="r912 r">module</span>);
 
                    <span class="c">// A binary module can only directly export cmdlets, so cmdletEntry should never be null.</span>
                    <span class="c">// With nested modules in a manifest, there may be a session state attached to</span>
                    <span class="c">// this module in which case we add the exported cmdlets to the existing list.</span>
                    <a href="../InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a> <span id="r929 rd" class="r929 r">cmdletEntry</span> = <span class="r928 r">commandEntry</span> <b>as</b> <a href="../InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a>;
                    <a href="../InitialSessionState.cs.html#3164e16488ced1ed" class="t t">SessionStateAliasEntry</a> <span id="r930 rd" class="r930 r">aliasEntry</span> = <b>null</b>;
                    <b>if</b> (<span class="r929 r">cmdletEntry</span> == <b>null</b>)
                    {
                        <span class="r930 r">aliasEntry</span> = <span class="r928 r">commandEntry</span> <b>as</b> <a href="../InitialSessionState.cs.html#3164e16488ced1ed" class="t t">SessionStateAliasEntry</a>;
                    }
 
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>((<span class="r929 r">cmdletEntry</span> != <b>null</b> || <span class="r930 r">aliasEntry</span> != <b>null</b>), <span class="s">&quot;When importing a binary module, the commands entry should only have cmdlets/aliases in it&quot;</span>);
                    <b>if</b> (<span class="r905 r">ss</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r929 r">cmdletEntry</span> != <b>null</b>)
                        {
                            <span class="r905 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionState.cs.html#51f4f7bc9645d49d" class="i property">ExportedCmdlets</a>.<span class="i">Add</span>(<a href="../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<a href="../CommandDiscovery.cs.html#066a9e2e665e4d8d" class="i method">NewCmdletInfo</a>(<span class="r929 r">cmdletEntry</span>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>));
                        }
                        <b>else</b> <b>if</b> (<span class="r930 r">aliasEntry</span> != <b>null</b>)
                        {
                            <span class="r905 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateAliasAPIs.cs.html#c15aa2530ddf93b0" class="i property">ExportedAliases</a>.<span class="i">Add</span>(<a href="../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<a href="../CommandDiscovery.cs.html#bc7243ca043d311c" class="i method">NewAliasInfo</a>(<span class="r930 r">aliasEntry</span>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>));
                        }
                    }
                    <b>else</b>
                    {
                        <span class="c">// If there is no session state, we need to attach the entry to the module instead</span>
                        <span class="c">// of the session state.</span>
                        <b>if</b> (<span class="r929 r">cmdletEntry</span> != <b>null</b>)
                        {
                            <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#00c08690ec7bebe4" class="i method">AddExportedCmdlet</a>(<a href="../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<a href="../CommandDiscovery.cs.html#066a9e2e665e4d8d" class="i method">NewCmdletInfo</a>(<span class="r929 r">cmdletEntry</span>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>));
                        }
                        <b>else</b> <b>if</b> (<span class="r930 r">aliasEntry</span> != <b>null</b>)
                        {
                            <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#f48a9502454a0a85" class="i method">AddExportedAlias</a>(<a href="../CommandDiscovery.cs.html#04905efdf0510fc2" class="t t">CommandDiscovery</a>.<a href="../CommandDiscovery.cs.html#bc7243ca043d311c" class="i method">NewAliasInfo</a>(<span class="r930 r">aliasEntry</span>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>));
                        }
                    }
                }
            }
 
            <span class="c">// If there were any cmdlets that were detected, add those.</span>
            <b>if</b> (<span class="r914 r">detectedCmdlets</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>string</b> <span id="r931 rd" class="r931 r">detectedCmdlet</span> <b>in</b> <span class="r914 r">detectedCmdlets</span>)
                {
                    <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#7b16924d44edf912" class="i method">AddDetectedCmdletExport</a>(<span class="r931 r">detectedCmdlet</span>);
                }
            }
 
            <span class="c">// If there were any aliases that were detected, add those.</span>
            <b>if</b> (<span class="r915 r">detectedAliases</span> != <b>null</b>)
            {
                <b>foreach</b> (<span class="i">Tuple</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r932 rd" class="r932 r">detectedAlias</span> <b>in</b> <span class="r915 r">detectedAliases</span>)
                {
                    <span class="r912 r">module</span>.<span class="i">AddDetectedAliasExport</span>(<span class="r932 r">detectedAlias</span>.<span class="i">Item1</span>, <span class="r932 r">detectedAlias</span>.<span class="i">Item2</span>);
                }
            }
 
            <span class="c">// If any command patterns where specified, then only import the</span>
            <span class="c">// commands matching the patterns...</span>
            <b>if</b> (<a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a> != <b>null</b>)
            {
                <a href="../InitialSessionState.cs.html#d3dc56d6666ca9c3" class="t t">InitialSessionStateEntryCollection</a>&lt;<a href="../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a>&gt; <span id="r933 rd" class="r933 r">commands</span> = <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>;
                <span class="c">// Remove all of the command entries that aren&#39;t matched by a pattern</span>
                <span class="c">// in the pattern list...</span>
                <b>for</b> (<b>int</b> <span id="r934 rd" class="r934 r">i</span> = <span class="r933 r">commands</span>.<a href="../InitialSessionState.cs.html#c6493cb5fe089abd" class="i property">Count</a> - 1; <span class="r934 r">i</span> &gt;= 0; <span class="r934 r">i</span>--)
                {
                    <a href="../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a> <span id="r935 rd" class="r935 r">e</span> = <span class="r933 r">commands</span><a href="../InitialSessionState.cs.html#3d898a31812ca39e">[</a><span class="r934 r">i</span>];
                    <b>if</b> (<span class="r935 r">e</span> == <b>null</b>)
                        <b>continue</b>;
                    <b>string</b> <span id="r936 rd" class="r936 r">name</span> = <span class="r935 r">e</span>.<a href="../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>;
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r936 r">name</span>))
                        <b>continue</b>;
                    <b>if</b> (!<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r936 r">name</span>, <a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a>, <b>false</b>))
                    {
                        <span class="r933 r">commands</span>.<a href="../InitialSessionState.cs.html#db54cea4d8acd00a" class="i method">RemoveItem</a>(<span class="r934 r">i</span>);
                    }
                }
            }
 
            <span class="c">// use the -Prefix parameter to change the names of imported commands</span>
            <b>foreach</b> (<a href="../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a> <span id="r937 rd" class="r937 r">commandEntry</span> <b>in</b> <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>)
            {
                <span class="r937 r">commandEntry</span>.<a href="../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a> = <a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r937 r">commandEntry</span>.<a href="../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>, <span class="r908 r">prefix</span>);
            }
 
            <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r938 rd" class="r938 r">oldSessionState</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
 
            <b>if</b> (<span class="r920 r">importingModule</span>)
            {
                <b>try</b>
                {
                    <span class="c">// If we have a session state instance, set it to be the engine sessionstate</span>
                    <span class="c">// for the duration of the bind.</span>
                    <b>if</b> (<span class="r905 r">ss</span> != <b>null</b>)
                    {
                        <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r905 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>;
                    }
 
                    <b>if</b> (<span class="r114 r">disableFormatUpdates</span>)
                        <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#d12e46183b35df33" class="i property">DisableFormatUpdates</a> = <b>true</b>;
 
                    <span class="c">// Load the cmdlets and providers, bound to the new module...</span>
                    <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#760b053de3dbd6be" class="i method">Bind</a>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r352 r">updateOnly</span>: <b>true</b>, <span class="r912 r">module</span>, <span class="r906 r">options</span>.<a href="#2c83df2012d40f5a" class="i field">NoClobber</a>, <span class="r906 r">options</span>.<a href="#7faee609282d78c3" class="i field">Local</a>, <span class="r356 r">setLocation</span>: <b>false</b>);
 
                    <span class="c">// Scan all of the types in the assembly to register JobSourceAdapters.</span>
                    <span class="i">IEnumerable</span>&lt;<span class="i">Type</span>&gt; <span id="r939 rd" class="r939 r">allTypes</span> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<span class="i">Type</span>&gt;();
                    <b>if</b> (<span class="r916 r">assembly</span> != <b>null</b>)
                    {
                        <span class="r939 r">allTypes</span> = <span class="r916 r">assembly</span>.<span class="i">ExportedTypes</span>;
                    }
                    <b>else</b> <b>if</b> (<span class="r113 r">assemblyToLoad</span> != <b>null</b>)
                    {
                        <span class="r939 r">allTypes</span> = <span class="r113 r">assemblyToLoad</span>.<span class="i">ExportedTypes</span>;
                    }
 
                    <b>foreach</b> (<span class="i">Type</span> <span id="r940 rd" class="r940 r">type</span> <b>in</b> <span class="r939 r">allTypes</span>)
                    {
                        <span class="c">// If it derives from JobSourceAdapter and it&#39;s not already registered, register it...</span>
                        <span class="c">// Add the second check since SMA could also be loaded via Import-Module</span>
                        <b>if</b> (<b>typeof</b>(<a href="../remoting/client/JobSourceAdapter.cs.html#540459e9925ad48a" class="t t">JobSourceAdapter</a>).<span class="i">IsAssignableFrom</span>(<span class="r940 r">type</span>) &amp;&amp; <b>typeof</b>(<a href="../remoting/client/JobSourceAdapter.cs.html#540459e9925ad48a" class="t t">JobSourceAdapter</a>) != <span class="r940 r">type</span>)
                        {
                            <b>if</b> (!<a href="../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<span class="i">IsRegistered</span>(<span class="r940 r">type</span>.<span class="i">Name</span>))
                            {
                                <a href="../CommandBase.cs.html#902d53f2bbe4f061" class="i property">JobManager</a>.<a href="../remoting/client/JobManager.cs.html#97d70f9245f5fa3d" class="i method">RegisterJobSourceAdapter</a>(<span class="r940 r">type</span>);
                            }
                        }
                    }
                }
                <b>finally</b>
                {
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r938 r">oldSessionState</span>;
                }
            }
 
            <span class="c">// WriteVerbose all of the imported cmdlets ...</span>
            <b>string</b> <span id="r941 rd" class="r941 r">snapInPrefix</span> = <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a> + <span class="s">&quot;\\&quot;</span>;
            <b>bool</b> <span id="r942 rd" class="r942 r">checkVerb</span> = !<a href="#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a>;
            <b>bool</b> <span id="r943 rd" class="r943 r">checkNoun</span> = !<a href="#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a>;
            <b>foreach</b> (<a href="../InitialSessionState.cs.html#480a10ec8ac9df7b" class="t t">SessionStateCommandEntry</a> <span id="r944 rd" class="r944 r">ssce</span> <b>in</b> <span class="r913 r">iss</span>.<a href="../InitialSessionState.cs.html#2d45d0b0db0079ba" class="i property">Commands</a>)
            {
                <b>if</b> (<span class="r944 r">ssce</span>.<a href="../InitialSessionState.cs.html#cc7c5811dcdf0890" class="i field">_isImported</a>)
                {
                    <b>try</b>
                    {
                        <b>if</b> (<span class="r944 r">ssce</span> <b>is</b> <a href="../InitialSessionState.cs.html#0b9bc88597e005fb" class="t t">SessionStateCmdletEntry</a> || <span class="r944 r">ssce</span> <b>is</b> <a href="../InitialSessionState.cs.html#24449f380379f027" class="t t">SessionStateFunctionEntry</a>)
                        {
                            <a href="#058322e7b3a4a67e" class="i method">ValidateCommandName</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>, <span class="r944 r">ssce</span>.<a href="../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>, <span class="r912 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <b>ref</b> <span class="r942 r">checkVerb</span>, <b>ref</b> <span class="r943 r">checkNoun</span>);
                        }
 
                        <span class="c">// Lookup using the module qualified name....</span>
                        <b>string</b> <span id="r945 rd" class="r945 r">name</span> = <span class="r941 r">snapInPrefix</span> + <span class="r944 r">ssce</span>.<a href="../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>;
                        <a href="../MshCmdlet.cs.html#444c098e64ffcf20" class="t t">CommandInvocationIntrinsics</a>.<a href="../MshCmdlet.cs.html#c52b56795d4104f2" class="i method">GetCmdlet</a>(<span class="r945 r">name</span>, <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                    }
                    <b>catch</b> (<a href="../../utils/CommandDiscoveryExceptions.cs.html#d61739861b769224" class="t t">CommandNotFoundException</a> <span id="r946 rd" class="r946 r">cnfe</span>)
                    {
                        <span class="c">// Handle the errors generated by duplicate commands...</span>
                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r946 r">cnfe</span>.<a href="../../utils/CommandDiscoveryExceptions.cs.html#c0a566010e80f61a" class="i property">ErrorRecord</a>);
                    }
 
                    <b>string</b> <span id="r947 rd" class="r947 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="r944 r">ssce</span>.<a href="../InitialSessionState.cs.html#b86d5dd7cdc3f952" class="i property">CommandType</a> == <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#83aa5e1f88cb9bf5" class="i field">Alias</a> ? <span class="i">Modules</span>.<span class="i">ImportingAlias</span> : <span class="i">Modules</span>.<span class="i">ImportingCmdlet</span>, <span class="r944 r">ssce</span>.<a href="../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>);
                    <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r947 r">message</span>);
                }
                <b>else</b>
                {
                    <span class="c">// The verbose output for Import-Module -NoClobber should state which members were skipped due to conflicts with existing names in the caller&#39;s environment.</span>
                    <b>string</b> <span id="r948 rd" class="r948 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportModuleNoClobberForCmdlet</span>, <span class="r944 r">ssce</span>.<a href="../InitialSessionState.cs.html#c5f3f5b848ea98cd" class="i property">Name</a>);
                    <a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r948 r">message</span>);
                }
            }
 
            <span class="c">// Add the module being imported to the list of child modules for the current module</span>
            <span class="c">// if it hasn&#39;t already been added...</span>
            <b>if</b> (<span class="r920 r">importingModule</span>)
            {
                <a href="#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r912 r">module</span>);
            }
 
            <b>return</b> <span class="r912 r">module</span>;
        }
 
        <b>private static</b> <span class="i">Version</span> <a id="8fd180a6a7ad9c2c" href="../../R/8fd180a6a7ad9c2c.html" target="n" data-glyph="76,1" class="i method">GetAssemblyVersionNumber</a>(<span class="i">Assembly</span> <span id="r949 rd" class="r949 r">assemblyToLoad</span>)
        {
            <span class="i">Version</span> <span id="r950 rd" class="r950 r">assemblyVersion</span>;
 
            <span class="c">// Get the assembly version...</span>
            <b>try</b>
            {
                <span class="i">AssemblyName</span> <span id="r951 rd" class="r951 r">asn</span> = <span class="r949 r">assemblyToLoad</span>.<span class="i">GetName</span>();
                <span class="r950 r">assemblyVersion</span> = <span class="r951 r">asn</span>.<span class="i">Version</span>;
            }
            <b>catch</b> (<span class="i">Exception</span>)
            {
                <span class="r950 r">assemblyVersion</span> = <b>new</b> <span class="i">Version</span>(0, 0);
            }
 
            <b>return</b> <span class="r950 r">assemblyVersion</span>;
        }
 
        <b>internal static string</b> <a id="589040fe58a3c16e" href="../../R/589040fe58a3c16e.html" target="n" data-glyph="74,1" class="i method">AddPrefixToCommandName</a>(<b>string</b> <span id="r952 rd" class="r952 r">commandName</span>, <b>string</b> <span id="r953 rd" class="r953 r">prefix</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r952 r">commandName</span> != <b>null</b>, <span class="s">&quot;Caller should verify that commandName argument != null&quot;</span>);
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r953 r">prefix</span>))
                <b>return</b> <span class="r952 r">commandName</span>;
 
            <b>string</b> <span id="r954 rd" class="r954 r">verb</span>;
            <b>string</b> <span id="r955 rd" class="r955 r">noun</span>;
            <b>if</b> (<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>.<a href="../CmdletInfo.cs.html#a59d626fb41db059" class="i method">SplitCmdletName</a>(<span class="r952 r">commandName</span>, <b>out</b> <span class="r954 r">verb</span>, <b>out</b> <span class="r955 r">noun</span>))
            {
                <span class="r952 r">commandName</span> = <span class="r954 r">verb</span> + <span class="s">&quot;-&quot;</span> + <span class="r953 r">prefix</span> + <span class="r955 r">noun</span>;
            }
            <b>else</b>
            {
                <span class="r952 r">commandName</span> = <span class="r953 r">prefix</span> + <span class="r952 r">commandName</span>;
            }
 
            <b>return</b> <span class="r952 r">commandName</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes prefix from a command name and returns the command name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r956 r">commandName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The command name from which the prefix needs to be removed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r957 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The string containing the prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The command name without the prefix.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="1b2f60a53340d1d6" href="../../R/1b2f60a53340d1d6.html" target="n" data-glyph="74,1" class="i method">RemovePrefixFromCommandName</a>(<b>string</b> <span id="r956 rd" class="r956 r">commandName</span>, <b>string</b> <span id="r957 rd" class="r957 r">prefix</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r956 r">commandName</span> != <b>null</b>, <span class="s">&quot;Caller should verify that commandName argument != null&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r957 r">prefix</span> != <b>null</b>, <span class="s">&quot;Caller should verify that prefix argument != null&quot;</span>);
 
            <b>string</b> <span id="r958 rd" class="r958 r">result</span> = <span class="r956 r">commandName</span>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r957 r">prefix</span>))
                <b>return</b> <span class="r958 r">result</span>;
 
            <b>string</b> <span id="r959 rd" class="r959 r">verb</span>;
            <b>string</b> <span id="r960 rd" class="r960 r">noun</span>;
            <b>if</b> (<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>.<a href="../CmdletInfo.cs.html#a59d626fb41db059" class="i method">SplitCmdletName</a>(<span class="r956 r">commandName</span>, <b>out</b> <span class="r959 r">verb</span>, <b>out</b> <span class="r960 r">noun</span>))
            {
                <b>if</b> (<span class="r960 r">noun</span>.<span class="i">StartsWith</span>(<span class="r957 r">prefix</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>string</b> <span id="r961 rd" class="r961 r">originalNoun</span> = <span class="r960 r">noun</span>.<span class="i">Substring</span>(<span class="r957 r">prefix</span>.<span class="i">Length</span>, <span class="r960 r">noun</span>.<span class="i">Length</span> - <span class="r957 r">prefix</span>.<span class="i">Length</span>);
                    <span class="r958 r">result</span> = <span class="r959 r">verb</span> + <span class="s">&quot;-&quot;</span> + <span class="r961 r">originalNoun</span>;
                }
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r956 r">commandName</span>.<span class="i">StartsWith</span>(<span class="r957 r">prefix</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r958 r">result</span> = <span class="r956 r">commandName</span>.<span class="i">Substring</span>(<span class="r957 r">prefix</span>.<span class="i">Length</span>, <span class="r956 r">commandName</span>.<span class="i">Length</span> - <span class="r957 r">prefix</span>.<span class="i">Length</span>);
                }
            }
 
            <b>return</b> <span class="r958 r">result</span>;
        }
 
        <b>internal static bool</b> <a id="a5c7fe2c0cac1ea6" href="../../R/a5c7fe2c0cac1ea6.html" target="n" data-glyph="74,1" class="i method">IsPrefixedCommand</a>(<a href="../CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r962 rd" class="r962 r">commandInfo</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r962 r">commandInfo</span> != <b>null</b>, <span class="s">&quot;Caller should verify that commandInfo is not null&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r962 r">commandInfo</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a>), <span class="s">&quot;Caller should verify that the commandInfo has prefix&quot;</span>);
 
            <b>string</b> <span id="r963 rd" class="r963 r">verb</span>, <span id="r964 rd" class="r964 r">noun</span>;
            <b>bool</b> <span id="r965 rd" class="r965 r">isPrefixed</span> = <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>.<a href="../CmdletInfo.cs.html#a59d626fb41db059" class="i method">SplitCmdletName</a>(<span class="r962 r">commandInfo</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <b>out</b> <span class="r963 r">verb</span>, <b>out</b> <span class="r964 r">noun</span>)
                             ? <span class="r964 r">noun</span>.<span class="i">StartsWith</span>(<span class="r962 r">commandInfo</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                             : <span class="r962 r">commandInfo</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>.<span class="i">StartsWith</span>(<span class="r962 r">commandInfo</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <b>return</b> <span class="r965 r">isPrefixed</span>;
        }
 
        <b>internal static void</b> <a id="fec9578c0eddaf89" href="../../R/fec9578c0eddaf89.html" target="n" data-glyph="74,1" class="i method">AddModuleToModuleTables</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r966 rd" class="r966 r">context</span>, <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r967 rd" class="r967 r">targetSessionState</span>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r968 rd" class="r968 r">module</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r966 r">context</span> != <b>null</b>, <span class="s">&quot;Caller should verify that context != null&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r967 r">targetSessionState</span> != <b>null</b>, <span class="s">&quot;Caller should verify that targetSessionState != null&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r968 r">module</span> != <b>null</b>, <span class="s">&quot;Caller should verify that module != null&quot;</span>);
 
            <span class="c">// if the module path is empty (assembly module in memory), we add the modulename as key</span>
            <b>string</b> <span id="r969 rd" class="r969 r">moduleTableKey</span>;
            <b>if</b> (<span class="r968 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a> != <b>string</b>.<span class="i">Empty</span>)
            {
                <span class="r969 r">moduleTableKey</span> = <span class="r968 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>;
            }
            <b>else</b>
            {
                <span class="r969 r">moduleTableKey</span> = <span class="r968 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>;
            }
 
            <b>if</b> (!<span class="r966 r">context</span>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">ContainsKey</span>(<span class="r969 r">moduleTableKey</span>))
            {
                <span class="r966 r">context</span>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">Add</span>(<span class="r969 r">moduleTableKey</span>, <span class="r968 r">module</span>);
            }
 
            <b>if</b> (<span class="r966 r">context</span>.<a href="../ExecutionContext.cs.html#6fbdd167e636c979" class="i property">previousModuleImported</a>.<span class="i">ContainsKey</span>(<span class="r968 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>))
            {
                <span class="r966 r">context</span>.<a href="../ExecutionContext.cs.html#6fbdd167e636c979" class="i property">previousModuleImported</a>.<span class="i">Remove</span>(<span class="r968 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
            }
 
            <span class="r966 r">context</span>.<a href="../ExecutionContext.cs.html#6fbdd167e636c979" class="i property">previousModuleImported</a>.<span class="i">Add</span>(<span class="r968 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r968 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
 
            <b>if</b> (!<span class="r967 r">targetSessionState</span>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>.<span class="i">ContainsKey</span>(<span class="r969 r">moduleTableKey</span>))
            {
                <span class="r967 r">targetSessionState</span>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>.<span class="i">Add</span>(<span class="r969 r">moduleTableKey</span>, <span class="r968 r">module</span>);
                <span class="r967 r">targetSessionState</span>.<a href="../SessionState.cs.html#99191506d80f52d7" class="i field">ModuleTableKeys</a>.<span class="i">Add</span>(<span class="r969 r">moduleTableKey</span>);
            }
 
            <b>if</b> (<span class="r967 r">targetSessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> != <b>null</b>)
            {
                <span class="r967 r">targetSessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#f6de469f9f30a6ec" class="i method">AddNestedModule</a>(<span class="r968 r">module</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Import the script-level functions from one session state to another, calling</span>
        <span class="c">///</span><span class="c"> WriteVerbose for each imported member...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r970 r">sourceModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to use as the source of the functions.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r971 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected internal void</b> <a id="8adbe5cf513b0527" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">ImportModuleMembers</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r970 rd" class="r970 r">sourceModule</span>, <b>string</b> <span id="r971 rd" class="r971 r">prefix</span>)
        {
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r972 rd" class="r972 r">importModuleOptions</span> = <b>new</b> <span class="t">ImportModuleOptions</span>();
            <a href="#f7b24f5af89ad761" class="i method">ImportModuleMembers</a>(
                <a href="#0479f5f00c7dafc1" class="k">this</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                <span class="r970 r">sourceModule</span>,
                <span class="r971 r">prefix</span>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#e9585290a055b001" class="i property">BaseFunctionPatterns</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#6f55985943d4e435" class="i property">BaseAliasPatterns</a>,
                <span class="r972 r">importModuleOptions</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Import the script-level functions from one session state to another, calling</span>
        <span class="c">///</span><span class="c"> WriteVerbose for each imported member...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r973 r">sourceModule</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to use as the source of the functions.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r974 r">prefix</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command name prefix.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r975 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options that are used while importing a module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected internal void</b> <a id="3ff15922df94f3d9" href="../../R/3ff15922df94f3d9.html" target="n" data-glyph="75,1" class="i method">ImportModuleMembers</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r973 rd" class="r973 r">sourceModule</span>, <b>string</b> <span id="r974 rd" class="r974 r">prefix</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r975 rd" class="r975 r">options</span>)
        {
            <a href="#f7b24f5af89ad761" class="i method">ImportModuleMembers</a>(
                <a href="#0479f5f00c7dafc1" class="k">this</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                <span class="r973 r">sourceModule</span>,
                <span class="r974 r">prefix</span>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#e9585290a055b001" class="i property">BaseFunctionPatterns</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a>,
                <a href="#0479f5f00c7dafc1" class="k">this</a>.<a href="#6f55985943d4e435" class="i property">BaseAliasPatterns</a>,
                <span class="r975 r">options</span>);
        }
 
        <b>internal static void</b> <a id="f7b24f5af89ad761" href="../../R/f7b24f5af89ad761.html" target="n" data-glyph="74,1" class="i method">ImportModuleMembers</a>(
            <a href="#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a> <span id="r976 rd" class="r976 r">cmdlet</span>,
            <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r977 rd" class="r977 r">targetSessionState</span>,
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r978 rd" class="r978 r">sourceModule</span>,
            <b>string</b> <span id="r979 rd" class="r979 r">prefix</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r980 rd" class="r980 r">functionPatterns</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r981 rd" class="r981 r">cmdletPatterns</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r982 rd" class="r982 r">variablePatterns</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r983 rd" class="r983 r">aliasPatterns</span>,
            <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r984 rd" class="r984 r">options</span>)
        {
            <b>if</b> (<span class="r978 r">sourceModule</span> == <b>null</b>)
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r978 r">sourceModule</span>));
 
            <b>bool</b> <span id="r985 rd" class="r985 r">isImportModulePrivate</span> = <span class="r976 r">cmdlet</span>.<a href="../CommandBase.cs.html#1f4a1f38862b466a" class="i property">CommandInfo</a>.<a href="../CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> == <a href="../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a> ||
                <span class="r977 r">targetSessionState</span>.<a href="../SessionState.cs.html#d788418311c2eafb" class="i field">DefaultCommandVisibility</a> == <a href="../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
            <b>bool</b> <span id="r986 rd" class="r986 r">usePrefix</span> = !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r979 r">prefix</span>);
 
            <b>bool</b> <span id="r987 rd" class="r987 r">checkVerb</span> = !<span class="r976 r">cmdlet</span>.<a href="#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a>;
            <b>bool</b> <span id="r988 rd" class="r988 r">checkNoun</span> = !<span class="r976 r">cmdlet</span>.<a href="#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a>;
 
            <span class="c">// Add the module being imported to the list of child modules for the current module</span>
            <span class="c">// if it hasn&#39;t already been added...</span>
            <span class="c">// TODO/FIXME: we should be calling AddModuleToModuleTables here but we can&#39;t</span>
            <span class="c">//             because of the inconsistency with which dynamic modules should</span>
            <span class="c">//             or should not be included in the global modules table</span>
            <b>if</b> (<span class="r977 r">targetSessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> != <b>null</b>)
            {
                <b>bool</b> <span id="r989 rd" class="r989 r">present</span> = <b>false</b>;
                <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r990 rd" class="r990 r">m</span> <b>in</b> <span class="r977 r">targetSessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>)
                {
                    <b>if</b> (<span class="r990 r">m</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>.<span class="i">Equals</span>(<span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        <span class="r989 r">present</span> = <b>true</b>;
                }
 
                <b>if</b> (!<span class="r989 r">present</span>)
                {
                    <span class="r977 r">targetSessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#f6de469f9f30a6ec" class="i method">AddNestedModule</a>(<span class="r978 r">sourceModule</span>);
                }
            }
 
            <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r991 rd" class="r991 r">source</span> = <b>null</b>;
            <b>if</b> (<span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> != <b>null</b>)
            {
                <span class="r991 r">source</span> = <span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>;
            }
 
            <span class="c">// True if none of -function, -cmdlet, -variable or -alias are specified</span>
            <b>bool</b> <span id="r992 rd" class="r992 r">noPatternsSpecified</span> = <span class="r980 r">functionPatterns</span> == <b>null</b> &amp;&amp;
                <span class="r982 r">variablePatterns</span> == <b>null</b> &amp;&amp; <span class="r983 r">aliasPatterns</span> == <b>null</b> &amp;&amp; <span class="r981 r">cmdletPatterns</span> == <b>null</b>;
 
            <span class="c">// mapping from original to prefixed names (prefixed using -Prefix parameter of the cmdlet)</span>
            <span class="c">// used to modify AliasInfo.Definition if necessary</span>
            <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r993 rd" class="r993 r">original2prefixedName</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <span class="c">// We always load the cmdlets even if there is no session state which is</span>
            <span class="c">// the case with a binary module.</span>
            <b>string</b> <span id="r994 rd" class="r994 r">message</span> = <b>null</b>;
            <b>foreach</b> (<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r995 rd" class="r995 r">cmdletToImport</span> <b>in</b> <span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>)
            {
                <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r995 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r981 r">cmdletPatterns</span>, <span class="r992 r">noPatternsSpecified</span>))
                {
                    <b>if</b> (<span class="r984 r">options</span>.<a href="#2c83df2012d40f5a" class="i field">NoClobber</a> &amp;&amp; <a href="#9e9417dca7aca62e" class="i method">CommandFound</a>(<span class="r995 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r977 r">targetSessionState</span>))
                    {
                        <span class="c">// The verbose output for Import-Module -NoClobber should state which members were skipped due to conflicts with existing names in the caller&#39;s environment.</span>
                        <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportModuleNoClobberForCmdlet</span>, <span class="r995 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                        <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                        <b>continue</b>;
                    }
 
                    <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r996 rd" class="r996 r">prefixedCmdlet</span> = <b>new</b> <a href="../CmdletInfo.cs.html#cdd24b9416013a7d" class="t constructor">CmdletInfo</a>(
                        <a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r995 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r979 r">prefix</span>),
                        <span class="r995 r">cmdletToImport</span>.<a href="../CmdletInfo.cs.html#9ba4328ad01dd7c0" class="i property">ImplementingType</a>,
                        <span class="r995 r">cmdletToImport</span>.<a href="../CmdletInfo.cs.html#fc12c9efb2e4abe1" class="i property">HelpFile</a>,
                        <span class="r995 r">cmdletToImport</span>.<a href="../CmdletInfo.cs.html#0720bba6815e5dab" class="i property">PSSnapIn</a>,
                        <span class="r976 r">cmdlet</span>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                    <a href="#455906e2a3d458ee" class="i method">SetCommandVisibility</a>(<span class="r985 r">isImportModulePrivate</span>, <span class="r996 r">prefixedCmdlet</span>);
                    <span class="r996 r">prefixedCmdlet</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r978 r">sourceModule</span>;
                    <b>if</b> (<span class="r986 r">usePrefix</span>)
                    {
                        <span class="r993 r">original2prefixedName</span>.<span class="i">Add</span>(<span class="r995 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r996 r">prefixedCmdlet</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                        <span class="r995 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r979 r">prefix</span>;
                        <span class="r996 r">prefixedCmdlet</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r979 r">prefix</span>;
                    }
 
                    <a href="#058322e7b3a4a67e" class="i method">ValidateCommandName</a>(<span class="r976 r">cmdlet</span>, <span class="r996 r">prefixedCmdlet</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <b>ref</b> <span class="r987 r">checkVerb</span>, <b>ref</b> <span class="r988 r">checkNoun</span>);
 
                    <a href="../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r997 rd" class="r997 r">scope</span> = <span class="r984 r">options</span>.<a href="#7faee609282d78c3" class="i field">Local</a> ? <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> : <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>;
                    <span class="r997 r">scope</span>.<a href="../SessionStateScope.cs.html#3878bfdb52dbb931" class="i method">AddCmdletToCache</a>(<span class="r996 r">prefixedCmdlet</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r996 r">prefixedCmdlet</span>, <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>, <span class="r977 r">targetSessionState</span>.<a href="../SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
                    <span class="r995 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#bf26634b5d5047e5" class="i property">IsImported</a> = <b>true</b>;
 
                    <span class="c">// Write directly into the local cmdlet cache table...</span>
                    <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingCmdlet</span>, <span class="r996 r">prefixedCmdlet</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                    <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                }
            }
 
            <b>foreach</b> (<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r998 rd" class="r998 r">aliasToImport</span> <b>in</b> <span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#aaa486cc66863e15" class="i property">CompiledAliasExports</a>)
            {
                <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r998 r">aliasToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r983 r">aliasPatterns</span>, <span class="r992 r">noPatternsSpecified</span>))
                {
                    <b>string</b> <span id="r999 rd" class="r999 r">prefixedAliasName</span> = <a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r998 r">aliasToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r979 r">prefix</span>);
                    <b>string</b> <span id="r1000 rd" class="r1000 r">prefixedAliasDefinition</span>;
                    <b>if</b> (!<span class="r986 r">usePrefix</span> || !<span class="r993 r">original2prefixedName</span>.<span class="i">TryGetValue</span>(<span class="r998 r">aliasToImport</span>.<a href="../AliasInfo.cs.html#18d5b1486b184b4a" class="i property">Definition</a>, <b>out</b> <span class="r1000 r">prefixedAliasDefinition</span>))
                    {
                        <span class="r1000 r">prefixedAliasDefinition</span> = <span class="r998 r">aliasToImport</span>.<a href="../AliasInfo.cs.html#18d5b1486b184b4a" class="i property">Definition</a>;
                    }
 
                    <b>if</b> (<span class="r984 r">options</span>.<a href="#2c83df2012d40f5a" class="i field">NoClobber</a> &amp;&amp; <a href="#9e9417dca7aca62e" class="i method">CommandFound</a>(<span class="r999 r">prefixedAliasName</span>, <span class="r977 r">targetSessionState</span>))
                    {
                        <span class="c">// The verbose output for Import-Module -NoClobber should state which members were skipped due to conflicts with existing names in the caller&#39;s environment.</span>
                        <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportModuleNoClobberForAlias</span>, <span class="r999 r">prefixedAliasName</span>);
                        <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                        <b>continue</b>;
                    }
 
                    <a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="k">var</a> <span id="r1001 rd" class="r1001 r">prefixedAlias</span> = <b>new</b> <a href="../AliasInfo.cs.html#81b0ee0063948411" class="t constructor">AliasInfo</a>(
                        <span class="r999 r">prefixedAliasName</span>,
                        <span class="r1000 r">prefixedAliasDefinition</span>,
                        <span class="r976 r">cmdlet</span>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                    <a href="#455906e2a3d458ee" class="i method">SetCommandVisibility</a>(<span class="r985 r">isImportModulePrivate</span>, <span class="r1001 r">prefixedAlias</span>);
                    <span class="r1001 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r978 r">sourceModule</span>;
                    <b>if</b> (<span class="r986 r">usePrefix</span>)
                    {
                        <b>if</b> (!<span class="r993 r">original2prefixedName</span>.<span class="i">ContainsKey</span>(<span class="r998 r">aliasToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>))
                        {
                            <span class="r993 r">original2prefixedName</span>.<span class="i">Add</span>(<span class="r998 r">aliasToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r1001 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                        }
 
                        <span class="r998 r">aliasToImport</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r979 r">prefix</span>;
                        <span class="r1001 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r979 r">prefix</span>;
                    }
 
                    <a href="../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r1002 rd" class="r1002 r">scope</span> = <span class="r984 r">options</span>.<a href="#7faee609282d78c3" class="i field">Local</a> ? <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> : <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>;
                    <span class="r1002 r">scope</span>.<a href="../SessionStateScope.cs.html#9d8a2f17f4084053" class="i method">SetAliasItem</a>(<span class="r1001 r">prefixedAlias</span>, <b>false</b>);
 
                    <span class="r998 r">aliasToImport</span>.<a href="../CommandInfo.cs.html#bf26634b5d5047e5" class="i property">IsImported</a> = <b>true</b>;
 
                    <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingAlias</span>, <span class="r1001 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                    <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                }
            }
 
            <span class="c">// Only process functions, variables and aliases if there is a session state</span>
            <span class="c">// associated with the source module.</span>
            <b>if</b> (<span class="r991 r">source</span> != <b>null</b>)
            {
                <b>foreach</b> (<a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r1003 rd" class="r1003 r">func</span> <b>in</b> <span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#2faddd301cf044c5" class="i property">ExportedFunctions</a>.<span class="i">Values</span>)
                {
                    <a href="#0b10860676dc5e2d" class="i method">ImportFunctions</a>(<span class="r1003 r">func</span>, <span class="r977 r">targetSessionState</span>, <span class="r978 r">sourceModule</span>, <span class="r980 r">functionPatterns</span>, <span class="r992 r">noPatternsSpecified</span>, <span class="r979 r">prefix</span>, <span class="r984 r">options</span>, <span class="r986 r">usePrefix</span>, <b>ref</b> <span class="r987 r">checkVerb</span>, <b>ref</b> <span class="r988 r">checkNoun</span>, <span class="r993 r">original2prefixedName</span>, <span class="r976 r">cmdlet</span>, <span class="r985 r">isImportModulePrivate</span>, <span class="r1004 r">isFunction</span>: <b>true</b>);
                }
 
                <span class="c">// Import any exported variables...</span>
                <b>foreach</b> (<a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r1005 rd" class="r1005 r">v</span> <b>in</b> <span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#e1ead588d55d493d" class="i property">ExportedVariables</a>.<span class="i">Values</span>)
                {
                    <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r1005 r">v</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>, <span class="r982 r">variablePatterns</span>, <span class="r992 r">noPatternsSpecified</span>))
                    {
                        <b>if</b> (<span class="r984 r">options</span>.<a href="#2c83df2012d40f5a" class="i field">NoClobber</a> &amp;&amp; (<span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>.<a href="../SessionStateScope.cs.html#300228748927425f" class="i method">GetVariable</a>(<span class="r1005 r">v</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>) != <b>null</b>))
                        {
                            <span class="c">// The verbose output for Import-Module -NoClobber should state which members were skipped due to conflicts with existing names in the caller&#39;s environment.</span>
                            <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportModuleNoClobberForVariable</span>, <span class="r1005 r">v</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>);
                            <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                            <b>continue</b>;
                        }
                        <span class="c">// Set the module on the variable...</span>
                        <span class="r1005 r">v</span>.<a href="../ShellVariable.cs.html#101763309654b5e0" class="i method">SetModule</a>(<span class="r978 r">sourceModule</span>);
 
                        <a href="../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r1006 rd" class="r1006 r">scope</span> = <span class="r984 r">options</span>.<a href="#7faee609282d78c3" class="i field">Local</a> ? <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> : <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>;
                        <a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r1007 rd" class="r1007 r">newVariable</span> = <span class="r1006 r">scope</span>.<a href="../SessionStateScope.cs.html#611f1e7f24ec3360" class="i method">NewVariable</a>(<span class="r1005 r">v</span>, <b>true</b>, <span class="r991 r">source</span>);
 
                        <b>if</b> (<span class="r985 r">isImportModulePrivate</span>)
                        {
                            <span class="r1007 r">newVariable</span>.<a href="../ShellVariable.cs.html#4e70252485bbcc8b" class="i property">Visibility</a> = <a href="../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
                        }
 
                        <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingVariable</span>, <span class="r1005 r">v</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>);
                        <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                    }
                }
 
                <span class="c">// Import any exported aliases...</span>
                <b>foreach</b> (<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r1008 rd" class="r1008 r">ai</span> <b>in</b> <span class="r978 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#992cd7d7155ed907" class="i property">ExportedAliases</a>.<span class="i">Values</span>)
                {
                    <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r1008 r">ai</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r983 r">aliasPatterns</span>, <span class="r992 r">noPatternsSpecified</span>))
                    {
                        <b>string</b> <span id="r1009 rd" class="r1009 r">prefixedAliasName</span> = <a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r1008 r">ai</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r979 r">prefix</span>);
                        <b>string</b> <span id="r1010 rd" class="r1010 r">prefixedAliasDefinition</span>;
                        <b>if</b> (!<span class="r986 r">usePrefix</span> || !<span class="r993 r">original2prefixedName</span>.<span class="i">TryGetValue</span>(<span class="r1008 r">ai</span>.<a href="../AliasInfo.cs.html#18d5b1486b184b4a" class="i property">Definition</a>, <b>out</b> <span class="r1010 r">prefixedAliasDefinition</span>))
                        {
                            <span class="r1010 r">prefixedAliasDefinition</span> = <span class="r1008 r">ai</span>.<a href="../AliasInfo.cs.html#18d5b1486b184b4a" class="i property">Definition</a>;
                        }
 
                        <b>if</b> (<span class="r984 r">options</span>.<a href="#2c83df2012d40f5a" class="i field">NoClobber</a> &amp;&amp; <a href="#9e9417dca7aca62e" class="i method">CommandFound</a>(<span class="r1009 r">prefixedAliasName</span>, <span class="r977 r">targetSessionState</span>))
                        {
                            <span class="c">// The verbose output for Import-Module -NoClobber should state which members were skipped due to conflicts with existing names in the caller&#39;s environment.</span>
                            <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportModuleNoClobberForAlias</span>, <span class="r1009 r">prefixedAliasName</span>);
                            <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                            <b>continue</b>;
                        }
 
                        <a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r1011 rd" class="r1011 r">prefixedAlias</span> = <b>new</b> <a href="../AliasInfo.cs.html#81b0ee0063948411" class="t constructor">AliasInfo</a>(
                            <span class="r1009 r">prefixedAliasName</span>,
                            <span class="r1010 r">prefixedAliasDefinition</span>,
                            <span class="r976 r">cmdlet</span>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                        <a href="#455906e2a3d458ee" class="i method">SetCommandVisibility</a>(<span class="r985 r">isImportModulePrivate</span>, <span class="r1011 r">prefixedAlias</span>);
                        <span class="r1011 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r978 r">sourceModule</span>;
 
                        <b>if</b> (<span class="r986 r">usePrefix</span>)
                        {
                            <b>if</b> (!<span class="r993 r">original2prefixedName</span>.<span class="i">ContainsKey</span>(<span class="r1008 r">ai</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>))
                            {
                                <span class="r993 r">original2prefixedName</span>.<span class="i">Add</span>(<span class="r1008 r">ai</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r1011 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                            }
 
                            <span class="r1008 r">ai</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r979 r">prefix</span>;
                            <span class="r1011 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r979 r">prefix</span>;
                        }
 
                        <a href="../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r1012 rd" class="r1012 r">scope</span> = <span class="r984 r">options</span>.<a href="#7faee609282d78c3" class="i field">Local</a> ? <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> : <span class="r977 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>;
                        <span class="r1012 r">scope</span>.<a href="../SessionStateScope.cs.html#9d8a2f17f4084053" class="i method">SetAliasItem</a>(<span class="r1011 r">prefixedAlias</span>, <b>false</b>, <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>);
 
                        <span class="r1008 r">ai</span>.<a href="../CommandInfo.cs.html#bf26634b5d5047e5" class="i property">IsImported</a> = <b>true</b>;
 
                        <span class="r994 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingAlias</span>, <span class="r1011 r">prefixedAlias</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                        <span class="r976 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r994 r">message</span>);
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="0b10860676dc5e2d" href="../../R/0b10860676dc5e2d.html" target="n" data-glyph="76,1" class="i method">ImportFunctions</a>(<a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r1013 rd" class="r1013 r">func</span>, <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r1014 rd" class="r1014 r">targetSessionState</span>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r1015 rd" class="r1015 r">sourceModule</span>, <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r1016 rd" class="r1016 r">functionPatterns</span>, <b>bool</b> <span id="r1017 rd" class="r1017 r">noPatternsSpecified</span>,
            <b>string</b> <span id="r1018 rd" class="r1018 r">prefix</span>, <a href="#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r1019 rd" class="r1019 r">options</span>, <b>bool</b> <span id="r1020 rd" class="r1020 r">usePrefix</span>, <b>ref bool</b> <span id="r1021 rd" class="r1021 r">checkVerb</span>, <b>ref bool</b> <span id="r1022 rd" class="r1022 r">checkNoun</span>, <span class="i">Dictionary</span>&lt;<b>string</b>, <b>string</b>&gt; <span id="r1023 rd" class="r1023 r">original2prefixedName</span>, <a href="#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a> <span id="r1024 rd" class="r1024 r">cmdlet</span>, <b>bool</b> <span id="r1025 rd" class="r1025 r">isImportModulePrivate</span>, <b>bool</b> <span id="r1004 rd" class="r1004 r">isFunction</span>)
        {
            <b>string</b> <span id="r1026 rd" class="r1026 r">message</span> = <b>null</b>;
            <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r1013 r">func</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r1016 r">functionPatterns</span>, <span class="r1017 r">noPatternsSpecified</span>))
            {
                <b>string</b> <span id="r1027 rd" class="r1027 r">prefixedName</span> = <a href="#589040fe58a3c16e" class="i method">AddPrefixToCommandName</a>(<span class="r1013 r">func</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r1018 r">prefix</span>);
 
                <b>if</b> (<span class="r1019 r">options</span>.<a href="#2c83df2012d40f5a" class="i field">NoClobber</a> &amp;&amp; <a href="#9e9417dca7aca62e" class="i method">CommandFound</a>(<span class="r1027 r">prefixedName</span>, <span class="r1014 r">targetSessionState</span>))
                {
                    <span class="c">// The verbose output for Import-Module -NoClobber should state which members were skipped due to conflicts with existing names in the caller&#39;s environment.</span>
                    <span class="r1026 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportModuleNoClobberForFunction</span>, <span class="r1013 r">func</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                    <span class="r1024 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r1026 r">message</span>);
                    <b>return</b>;
                }
 
                <a href="../SessionStateScope.cs.html#460261155e0163cb" class="k">var</a> <span id="r1028 rd" class="r1028 r">scope</span> = <span class="r1019 r">options</span>.<a href="#7faee609282d78c3" class="i field">Local</a> ? <span class="r1014 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a> : <span class="r1014 r">targetSessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>;
                <span class="c">// Write directly into the function table...</span>
                <a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r1029 rd" class="r1029 r">functionInfo</span> = <span class="r1028 r">scope</span>.<a href="../SessionStateScope.cs.html#6d7966fb86df8d02" class="i method">SetFunction</a>(
                    <span class="r1027 r">prefixedName</span>,
                    <span class="r1013 r">func</span>.<a href="../FunctionInfo.cs.html#aa3a9db104bb0f61" class="i property">ScriptBlock</a>,
                    <span class="r1013 r">func</span>,
                    <b>false</b>,
                    <a href="../SecurityManagerBase.cs.html#a1d5a2ba5cd1b3aa" class="t t">CommandOrigin</a>.<a href="../SecurityManagerBase.cs.html#946d8e7ca02acec6" class="i field">Internal</a>,
                    <span class="r1014 r">targetSessionState</span>.<a href="../SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
                <a href="#455906e2a3d458ee" class="i method">SetCommandVisibility</a>(<span class="r1025 r">isImportModulePrivate</span>, <span class="r1029 r">functionInfo</span>);
                <span class="r1029 r">functionInfo</span>.<a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r1015 r">sourceModule</span>;
 
                <span class="r1013 r">func</span>.<a href="../CommandInfo.cs.html#bf26634b5d5047e5" class="i property">IsImported</a> = <b>true</b>;
                <b>if</b> (<span class="r1020 r">usePrefix</span>)
                {
                    <span class="r1023 r">original2prefixedName</span>.<span class="i">Add</span>(<span class="r1013 r">func</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r1027 r">prefixedName</span>);
                    <span class="r1013 r">func</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r1018 r">prefix</span>;
                    <span class="r1029 r">functionInfo</span>.<a href="../CommandInfo.cs.html#48e9ebf217764505" class="i property">Prefix</a> = <span class="r1018 r">prefix</span>;
                }
 
                <a href="#058322e7b3a4a67e" class="i method">ValidateCommandName</a>(<span class="r1024 r">cmdlet</span>, <span class="r1029 r">functionInfo</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r1015 r">sourceModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <b>ref</b> <span class="r1022 r">checkNoun</span>, <b>ref</b> <span class="r1021 r">checkVerb</span>);
                <span class="r1026 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingFunction</span>, <span class="r1027 r">prefixedName</span>);
                <span class="r1024 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r1026 r">message</span>);
            }
        }
 
        <b>private static void</b> <a id="455906e2a3d458ee" href="../../R/455906e2a3d458ee.html" target="n" data-glyph="76,1" class="i method">SetCommandVisibility</a>(<b>bool</b> <span id="r1030 rd" class="r1030 r">isImportModulePrivate</span>, <a href="../CommandInfo.cs.html#71babe57a99ca852" class="t t">CommandInfo</a> <span id="r1031 rd" class="r1031 r">command</span>)
        {
            <b>if</b> (<span class="r1030 r">isImportModulePrivate</span>)
            {
                <span class="r1031 r">command</span>.<a href="../CommandInfo.cs.html#cb0c02415aeca7d5" class="i property">Visibility</a> = <a href="../SessionStatePublic.cs.html#3acdda74c688180a" class="t t">SessionStateEntryVisibility</a>.<a href="../SessionStatePublic.cs.html#9412d519f56b8001" class="i field">Private</a>;
            }
        }
 
        <b>internal static bool</b> <a id="9e9417dca7aca62e" href="../../R/9e9417dca7aca62e.html" target="n" data-glyph="74,1" class="i method">CommandFound</a>(<b>string</b> <span id="r1032 rd" class="r1032 r">commandName</span>, <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r1033 rd" class="r1033 r">sessionStateInternal</span>)
        {
            <span class="i">EventHandler</span>&lt;<a href="../CommandDiscovery.cs.html#1d8153247a726d6e" class="t t">CommandLookupEventArgs</a>&gt; <span id="r1034 rd" class="r1034 r">oldCommandNotFoundAction</span> =
                <span class="r1033 r">sessionStateInternal</span>.<a href="../SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>.<a href="../EngineIntrinsics.cs.html#9e6ba5466d2a8889" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#225f68e0b7194647" class="i property">CommandNotFoundAction</a>;
            <b>try</b>
            {
                <span class="r1033 r">sessionStateInternal</span>.<a href="../SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>.<a href="../EngineIntrinsics.cs.html#9e6ba5466d2a8889" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#225f68e0b7194647" class="i property">CommandNotFoundAction</a> = <b>null</b>;
                <a href="../CommandSearcher.cs.html#b56d4ddadb4e7cd0" class="t t">CommandSearcher</a> <span id="r1035 rd" class="r1035 r">searcher</span> = <b>new</b> <span class="t">CommandSearcher</span>(
                            <span class="r1032 r">commandName</span>,
                            <a href="../CommandSearcher.cs.html#a5748603008affdc" class="t t">SearchResolutionOptions</a>.<a href="../CommandSearcher.cs.html#038d9150e27f9fdf" class="i field">CommandNameIsPattern</a> | <a href="../CommandSearcher.cs.html#a5748603008affdc" class="t t">SearchResolutionOptions</a>.<a href="../CommandSearcher.cs.html#ad2602de61710376" class="i field">ResolveAliasPatterns</a> | <a href="../CommandSearcher.cs.html#a5748603008affdc" class="t t">SearchResolutionOptions</a>.<a href="../CommandSearcher.cs.html#315f95f2041e0da1" class="i field">ResolveFunctionPatterns</a>,
                            <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#83aa5e1f88cb9bf5" class="i field">Alias</a> | <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#8a4bdbbd93f182bf" class="i field">Function</a> | <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#e95f2e5deaaf9b93" class="i field">Cmdlet</a> | <a href="../CommandInfo.cs.html#3699fe79fa6969b5" class="t t">CommandTypes</a>.<a href="../CommandInfo.cs.html#2a673544a3a7e93f" class="i field">Configuration</a>,
                            <span class="r1033 r">sessionStateInternal</span>.<a href="../SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>);
 
                <b>if</b> (!<span class="r1035 r">searcher</span>.<a href="../CommandSearcher.cs.html#157d1fe83dcb77a7" class="i method">MoveNext</a>())
                {
                    <b>return</b> <b>false</b>;
                }
 
                <b>return</b> <b>true</b>;
            }
            <b>finally</b>
            {
                <span class="r1033 r">sessionStateInternal</span>.<a href="../SessionState.cs.html#3ddff2db6bc01805" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#27c4e82ba7216ff8" class="i property">EngineIntrinsics</a>.<a href="../EngineIntrinsics.cs.html#9e6ba5466d2a8889" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#225f68e0b7194647" class="i property">CommandNotFoundAction</a> = <span class="r1034 r">oldCommandNotFoundAction</span>;
            }
        }
 
        <b>private static bool</b> <a id="8f0a76b9754fbc0e" href="../../R/8f0a76b9754fbc0e.html" target="n" data-glyph="76,1" class="i method">HasInvalidCharacters</a>(<b>string</b> <span id="r1036 rd" class="r1036 r">commandName</span>)
        {
            <b>foreach</b> (<b>char</b> <span id="r1037 rd" class="r1037 r">c</span> <b>in</b> <span class="r1036 r">commandName</span>)
            {
                <b>switch</b> (<span class="r1037 r">c</span>)
                {
                    <b>case</b> <span class="s">&#39;#&#39;</span>:
                    <b>case</b> <span class="s">&#39;,&#39;</span>:
                    <b>case</b> <span class="s">&#39;(&#39;</span>:
                    <b>case</b> <span class="s">&#39;)&#39;</span>:
                    <b>case</b> <span class="s">&#39;{&#39;</span>:
                    <b>case</b> <span class="s">&#39;}&#39;</span>:
                    <b>case</b> <span class="s">&#39;[&#39;</span>:
                    <b>case</b> <span class="s">&#39;]&#39;</span>:
                    <b>case</b> <span class="s">&#39;&amp;&#39;</span>:
                    <b>case</b> <span class="s">&#39;-&#39;</span>:
                    <b>case</b> <span class="s">&#39;/&#39;</span>:
                    <b>case</b> <span class="s">&#39;\\&#39;</span>:
                    <b>case</b> <span class="s">&#39;$&#39;</span>:
                    <b>case</b> <span class="s">&#39;^&#39;</span>:
                    <b>case</b> <span class="s">&#39;;&#39;</span>:
                    <b>case</b> <span class="s">&#39;:&#39;</span>:
                    <b>case</b> <span class="s">&#39;&quot;&#39;</span>:
                    <b>case</b> <span class="s">&#39;\&#39;&#39;</span>:
                    <b>case</b> <span class="s">&#39;&lt;&#39;</span>:
                    <b>case</b> <span class="s">&#39;&gt;&#39;</span>:
                    <b>case</b> <span class="s">&#39;|&#39;</span>:
                    <b>case</b> <span class="s">&#39;?&#39;</span>:
                    <b>case</b> <span class="s">&#39;@&#39;</span>:
                    <b>case</b> <span class="s">&#39;`&#39;</span>:
                    <b>case</b> <span class="s">&#39;*&#39;</span>:
                    <b>case</b> <span class="s">&#39;%&#39;</span>:
                    <b>case</b> <span class="s">&#39;+&#39;</span>:
                    <b>case</b> <span class="s">&#39;=&#39;</span>:
                    <b>case</b> <span class="s">&#39;~&#39;</span>:
                        <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static void</b> <a id="058322e7b3a4a67e" href="../../R/058322e7b3a4a67e.html" target="n" data-glyph="76,1" class="i method">ValidateCommandName</a>(<a href="#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a> <span id="r1038 rd" class="r1038 r">cmdlet</span>,
                                                <b>string</b> <span id="r1039 rd" class="r1039 r">commandName</span>,
                                                <b>string</b> <span id="r1040 rd" class="r1040 r">moduleName</span>,
                                                <b>ref bool</b> <span id="r1041 rd" class="r1041 r">checkVerb</span>,
                                                <b>ref bool</b> <span id="r1042 rd" class="r1042 r">checkNoun</span>)
        {
            <b>string</b> <span id="r1043 rd" class="r1043 r">verb</span>;
            <b>string</b> <span id="r1044 rd" class="r1044 r">noun</span>;
            <b>string</b> <span id="r1045 rd" class="r1045 r">message</span>;
 
            <b>if</b> (!<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>.<a href="../CmdletInfo.cs.html#a59d626fb41db059" class="i method">SplitCmdletName</a>(<span class="r1039 r">commandName</span>, <b>out</b> <span class="r1043 r">verb</span>, <b>out</b> <span class="r1044 r">noun</span>))
                <b>return</b>;
 
            <b>if</b> (!<a href="../../utils/Verbs.cs.html#0893fdf6db5505c1" class="t t">Verbs</a>.<a href="../../utils/Verbs.cs.html#0eaa64e796285c8f" class="i method">IsStandard</a>(<span class="r1043 r">verb</span>))
            {
                <span class="c">// A hack for Sort-Object and Tee-Object as they have non-standard verbs</span>
                <span class="c">// With engine dlls being loaded as modules, introducing the additional check to avoid warning message</span>
                <b>if</b> (!<span class="r1039 r">commandName</span>.<span class="i">Equals</span>(<span class="s">&quot;Sort-Object&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>) &amp;&amp; !<span class="r1039 r">commandName</span>.<span class="i">Equals</span>(<span class="s">&quot;Tee-Object&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>if</b> (<span class="r1041 r">checkVerb</span>)
                    {
                        <span class="r1041 r">checkVerb</span> = <b>false</b>;
                        <span class="r1045 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingNonStandardVerb</span>, <span class="r1040 r">moduleName</span>);
                        <span class="r1038 r">cmdlet</span>.<a href="../cmdlet.cs.html#dda5a07d1a8a6cba" class="i method">WriteWarning</a>(<span class="r1045 r">message</span>);
                    }
 
                    <b>string</b>[] <span id="r1046 rd" class="r1046 r">alternates</span> = <a href="../../utils/Verbs.cs.html#0893fdf6db5505c1" class="t t">Verbs</a>.<a href="../../utils/Verbs.cs.html#10bac61c189e1516" class="i method">SuggestedAlternates</a>(<span class="r1043 r">verb</span>);
                    <b>if</b> (<span class="r1046 r">alternates</span> == <b>null</b>)
                    {
                        <span class="r1045 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingNonStandardVerbVerbose</span>, <span class="r1039 r">commandName</span>, <span class="r1040 r">moduleName</span>);
                        <span class="r1038 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r1045 r">message</span>);
                    }
                    <b>else</b>
                    {
                        <b>var</b> <span id="r1047 rd" class="r1047 r">suggestions</span> = <b>string</b>.<span class="i">Join</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentUICulture</span>.<span class="i">TextInfo</span>.<span class="i">ListSeparator</span>, <span class="r1046 r">alternates</span>);
                        <span class="r1045 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingNonStandardVerbVerboseSuggestion</span>, <span class="r1039 r">commandName</span>, <span class="r1047 r">suggestions</span>, <span class="r1040 r">moduleName</span>);
                        <span class="r1038 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r1045 r">message</span>);
                    }
                }
            }
 
            <b>if</b> (<a href="#8f0a76b9754fbc0e" class="i method">HasInvalidCharacters</a>(<span class="r1044 r">noun</span>))
            {
                <b>if</b> (<span class="r1042 r">checkNoun</span>)
                {
                    <span class="r1045 r">message</span> = <span class="i">Modules</span>.<span class="i">ImportingNonStandardNoun</span>;
                    <span class="r1038 r">cmdlet</span>.<a href="../cmdlet.cs.html#dda5a07d1a8a6cba" class="i method">WriteWarning</a>(<span class="r1045 r">message</span>);
                    <span class="r1042 r">checkNoun</span> = <b>false</b>;
                }
 
                <span class="r1045 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ImportingNonStandardNounVerbose</span>, <span class="r1039 r">commandName</span>, <span class="r1040 r">moduleName</span>);
                <span class="r1038 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r1045 r">message</span>);
                <b>return</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Search a PSSnapin with the specified name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static</b> <a href="../../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a> <a id="a39e43826c9d3348" href="../../R/a39e43826c9d3348.html" target="n" data-glyph="74,1" class="i method">GetEngineSnapIn</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r1048 rd" class="r1048 r">context</span>, <b>string</b> <span id="r1049 rd" class="r1049 r">name</span>)
        {
            <span class="i">HashSet</span>&lt;<a href="../../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a>&gt; <span id="r1050 rd" class="r1050 r">snapinSet</span> = <b>new</b> <span class="i">HashSet</span>&lt;<a href="../../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a>&gt;();
            <span class="i">List</span>&lt;<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt; <span id="r1051 rd" class="r1051 r">cmdlets</span> = <span class="r1048 r">context</span>.<a href="../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#62b767cb492c1922" class="i method">GetCmdlets</a>();
            <b>foreach</b> (<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r1052 rd" class="r1052 r">cmdlet</span> <b>in</b> <span class="r1051 r">cmdlets</span>)
            {
                <a href="../../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a> <span id="r1053 rd" class="r1053 r">snapin</span> = <span class="r1052 r">cmdlet</span>.<a href="../CmdletInfo.cs.html#0720bba6815e5dab" class="i property">PSSnapIn</a>;
                <b>if</b> (<span class="r1053 r">snapin</span> != <b>null</b> &amp;&amp; !<span class="r1050 r">snapinSet</span>.<span class="i">Contains</span>(<span class="r1053 r">snapin</span>))
                    <span class="r1050 r">snapinSet</span>.<span class="i">Add</span>(<span class="r1053 r">snapin</span>);
            }
 
            <b>foreach</b> (<a href="../../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a> <span id="r1054 rd" class="r1054 r">snapin</span> <b>in</b> <span class="r1050 r">snapinSet</span>)
            {
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r1054 r">snapin</span>.<a href="../../singleshell/config/MshSnapinInfo.cs.html#ebdb1944f8049e83" class="i property">Name</a>, <span class="r1049 r">name</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    <b>return</b> <span class="r1054 r">snapin</span>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the context cached ModuleTable module for import only if found and has safe language boundaries while</span>
        <span class="c">///</span><span class="c"> exporting all functions by default.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> This protects cached trusted modules that exported all functions in a trusted context, from being re-used</span>
        <span class="c">///</span><span class="c"> in an untrusted context and thus exposing functions that were meant to be private in that context.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Returning false forces module import to re-import the module from file with the current context and prevent</span>
        <span class="c">///</span><span class="c"> all module functions from being exported by default.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Note that module loading order is important with this check when the system is *locked down with DeviceGuard*.</span>
        <span class="c">///</span><span class="c"> If a submodule that does not explicitly export any functions is imported from the command line, its useless</span>
        <span class="c">///</span><span class="c"> because no functions are exported (default fn export is explictly disallowed on locked down systems).</span>
        <span class="c">///</span><span class="c"> But if a parentmodule that imports the submodule is then imported, it will get the useless version of the</span>
        <span class="c">///</span><span class="c"> module from the ModuleTable and the parent module will not work.</span>
        <span class="c">///</span><span class="c">   $mSub = import-module SubModule  # No functions exported, useless</span>
        <span class="c">///</span><span class="c">   $mParent = import-module ParentModule  # This internally imports SubModule</span>
        <span class="c">///</span><span class="c">   $mParent.DoSomething  # This will likely be broken because SubModule functions are not accessible</span>
        <span class="c">///</span><span class="c"> But this is not a realistic scenario because SubModule is useless with DeviceGuard lock down and must explicitly</span>
        <span class="c">///</span><span class="c"> export its functions to become useful, at which point this check is no longer in effect and there is no issue.</span>
        <span class="c">///</span><span class="c">   $mSub = import-module SubModule  # Explictly exports functions, useful</span>
        <span class="c">///</span><span class="c">   $mParent = import-module ParentModule  # This internally imports SubModule</span>
        <span class="c">///</span><span class="c">   $mParent.DoSomething  # This works because SubModule functions are exported and accessible.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1055 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Key.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1056 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">PSModuleInfo.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1057 r">toRemove</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if module item is to be removed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if module found in table and is safe to use.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="4b44b9c95e0d831e" href="../../R/4b44b9c95e0d831e.html" target="n" data-glyph="74,1" class="i method">TryGetFromModuleTable</a>(<b>string</b> <span id="r1055 rd" class="r1055 r">key</span>, <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r1056 rd" class="r1056 r">moduleInfo</span>, <b>bool</b> <span id="r1057 rd" class="r1057 r">toRemove</span> = <b>false</b>)
        {
            <b>var</b> <span id="r1058 rd" class="r1058 r">foundModule</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">TryGetValue</span>(<span class="r1055 r">key</span>, <b>out</b> <span class="r1056 r">moduleInfo</span>);
 
            <span class="c">// Check for unsafe language modes between module load context and current context.</span>
            <span class="c">// But only for script modules that exported all functions in a trusted (FL) context.</span>
            <b>if</b> (<span class="r1058 r">foundModule</span> &amp;&amp;
                !<span class="r1057 r">toRemove</span> &amp;&amp;
                <span class="r1056 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> == <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#15536cea81510839" class="i field">Script</a> &amp;&amp;
                <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#ebe55e376f6c32fa" class="i property">LanguageMode</a> == <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#9f1205fe78117fc2" class="i field">ConstrainedLanguage</a> &amp;&amp;
                <span class="r1056 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a> == <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>.<a href="../SessionStatePublic.cs.html#eec721eb8c02f156" class="i field">FullLanguage</a> &amp;&amp;
                <span class="r1056 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#5ee81439d2408c7e" class="i property">ModuleAutoExportsAllFunctions</a>)
            {
                <span class="r1056 r">moduleInfo</span> = <b>null</b>;
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <span class="r1058 r">foundModule</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Holds the result of a binary module analysis.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="840a95d56ee83b97" href="../../R/840a95d56ee83b97.html" target="n" data-glyph="2,0" class="t t"><span id="ba1cd3466f86f7a3">BinaryAnalysisResult</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The list of cmdlets detected from the binary.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="3673a7597d9f3d86" href="../../R/3673a7597d9f3d86.html" target="n" data-glyph="104,1" class="i property">DetectedCmdlets</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">// The list of aliases detected from the binary.</span>
        <b>internal</b> <span class="i">List</span>&lt;<span class="i">Tuple</span>&lt;<b>string</b>, <b>string</b>&gt;&gt; <a id="5f8f17f3134355b2" href="../../R/5f8f17f3134355b2.html" target="n" data-glyph="104,1" class="i property">DetectedAliases</a> { <b>get</b>; <b>set</b>; }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> ModuleCmdletBase
}
</pre></td></tr></table></div></body></html>
