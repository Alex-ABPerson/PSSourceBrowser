<!DOCTYPE html>
<html><head><title>TestModuleManifestCommand.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(436);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/Modules/TestModuleManifestCommand.cs" target="_top">engine\Modules\TestModuleManifestCommand.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
 
<span class="c">//</span>
<span class="c">// Now define the set of commands for manipulating modules.</span>
<span class="c">//</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Test-ModuleManifest
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This cmdlet takes a module manifest and validates the contents...</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="../../utils/Verbs.cs.html#98a099bbeb57da8d" class="t t">VerbsDiagnostic</a>.<a href="../../utils/Verbs.cs.html#8ace8f95c3293de9" class="i field">Test</a>, <span class="s">&quot;ModuleManifest&quot;</span>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096900&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>))]
    <b>public sealed class</b> <a id="7bf67b688ccb67b7" href="../../R/7bf67b688ccb67b7.html" target="n" data-glyph="0,0" class="t t">TestModuleManifestCommand</a> : <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates an instance of the Test-ModuleManifest command.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a id="d752b5f75a3d920b" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">TestModuleManifestCommand</a>()
        {
            <span class="c">// Test-ModuleManifest reads a manifest with ModuleCmdletBase.LoadModuleManifest().</span>
            <span class="c">// This will error on an edition-incompatible manifest loaded from the System32 path,</span>
            <span class="c">// unless BaseSkipEditionCheck is true. Since Test-ModuleManifest shouldn&#39;t care about</span>
            <span class="c">// module edition (it just tests manifest validity), we always want to set this rather</span>
            <span class="c">// than provide it as a switch on the cmdlet.</span>
            <a href="ModuleCmdletBase.cs.html#c870fc509e9d03a5" class="i property">BaseSkipEditionCheck</a> = <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The output path for the generated file...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0, <a href="../Attributes.cs.html#aded474eaec9cde8" class="i property">ValueFromPipelineByPropertyName</a> = <b>true</b>)]
        <b>public string</b> <a id="6c4b5948c5911125" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Path</a>
        {
            <b>get</b> { <b>return</b> <a href="#0615484bd27ab020" class="i field">_path</a>; }
 
            <b>set</b> { <a href="#0615484bd27ab020" class="i field">_path</a> = <b>value</b>; }
        }
 
        <b>private string</b> <a id="0615484bd27ab020" href="../../R/0615484bd27ab020.html" target="n" data-glyph="46,1" class="i field">_path</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Implements the record processing for this cmdlet.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="83b998a3c08830dd" href="../../R/83b998a3c08830dd.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r0 rd" class="r0 r">provider</span> = <b>null</b>;
            <span class="i">Collection</span>&lt;<b>string</b>&gt; <span id="r1 rd" class="r1 r">filePaths</span>;
 
            <b>try</b>
            {
                <b>if</b> (<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateProviderAPIs.cs.html#dc359a601ce02a89" class="i method">IsProviderLoaded</a>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
                {
                    <span class="r1 r">filePaths</span> =
                        <a href="../CommandBase.cs.html#5078d443148de142" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../PathInterfaces.cs.html#4931b2e78f6aaef1" class="i method">GetResolvedProviderPathFromPSPath</a>(<a href="#0615484bd27ab020" class="i field">_path</a>, <b>out</b> <span class="r0 r">provider</span>);
                }
                <b>else</b>
                {
                    <span class="r1 r">filePaths</span> = <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
                    <span class="r1 r">filePaths</span>.<span class="i">Add</span>(<a href="#0615484bd27ab020" class="i field">_path</a>);
                }
            }
            <b>catch</b> (<a href="../../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a>)
            {
                <b>string</b> <span id="r2 rd" class="r2 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleNotFound</span>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                <span class="i">FileNotFoundException</span> <span id="r3 rd" class="r3 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r2 r">message</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r4 rd" class="r4 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r3 r">fnf</span>, <span class="s">&quot;Modules_ModuleNotFound&quot;</span>,
                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r4 r">er</span>);
                <b>return</b>;
            }
 
            <span class="c">// Make sure that the path is in the file system - that&#39;s all we can handle currently...</span>
            <b>if</b> (!<span class="r0 r">provider</span>.<a href="../DataStoreAdapterProvider.cs.html#13e2cce7adaad137" class="i method">NameEquals</a>(<a href="#7bf67b688ccb67b7" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
            {
                <span class="c">// &quot;The current provider ({0}) cannot open a file&quot;</span>
                <b>throw</b> <a href="../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<a href="#0615484bd27ab020" class="i field">_path</a>, <b>typeof</b>(<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                    <b>null</b>, <span class="s">&quot;FileOpenError&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">FileOpenError</span>, <span class="r0 r">provider</span>.<a href="../DataStoreAdapterProvider.cs.html#91a8d08ee3ba5a61" class="i property">FullName</a>);
            }
 
            <span class="c">// Make sure at least one file was found...</span>
            <b>if</b> (<span class="r1 r">filePaths</span> == <b>null</b> || <span class="r1 r">filePaths</span>.<span class="i">Count</span> &lt; 1)
            {
                <b>string</b> <span id="r5 rd" class="r5 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleNotFound</span>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                <span class="i">FileNotFoundException</span> <span id="r6 rd" class="r6 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r5 r">message</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r7 rd" class="r7 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r6 r">fnf</span>, <span class="s">&quot;Modules_ModuleNotFound&quot;</span>,
                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r7 r">er</span>);
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r1 r">filePaths</span>.<span class="i">Count</span> &gt; 1)
            {
                <span class="c">// &quot;The path resolved to more than one file; can only process one file at a time.&quot;</span>
                <b>throw</b> <a href="../lang/parserutils.cs.html#c1bdb7faf235a7b7" class="t t">InterpreterError</a>.<span class="i">NewInterpreterException</span>(<span class="r1 r">filePaths</span>, <b>typeof</b>(<a href="../../utils/RuntimeException.cs.html#bd88f263eb295545" class="t t">RuntimeException</a>),
                    <b>null</b>, <span class="s">&quot;AmbiguousPath&quot;</span>, <span class="i">ParserStrings</span>.<span class="i">AmbiguousPath</span>);
            }
 
            <b>string</b> <span id="r8 rd" class="r8 r">filePath</span> = <span class="r1 r">filePaths</span>[0];
            <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r9 rd" class="r9 r">scriptInfo</span> = <b>null</b>;
            <b>string</b> <span id="r10 rd" class="r10 r">ext</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r8 r">filePath</span>);
            <b>if</b> (<span class="r10 r">ext</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// Create a script info for loading the file...</span>
                <b>string</b> <span id="r11 rd" class="r11 r">scriptName</span>;
                <span class="r9 r">scriptInfo</span> = <a href="ModuleCmdletBase.cs.html#477344698fa519b9" class="i method">GetScriptInfoForFile</a>(<span class="r8 r">filePath</span>, <b>out</b> <span class="r11 r">scriptName</span>, <b>false</b>);
 
                <span class="c">// we should reserve the Context.ModuleBeingProcessed unchanged after loadModuleManifest(), otherwise the module won&#39;t be importable next time.</span>
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r12 rd" class="r12 r">module</span>;
                <b>string</b> <span id="r13 rd" class="r13 r">_origModuleBeingProcessed</span> = <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a>;
                <b>try</b>
                {
                    <span class="r12 r">module</span> = <a href="ModuleCmdletBase.cs.html#d19d481f41f2025c" class="i method">LoadModuleManifest</a>(
                    <span class="r9 r">scriptInfo</span>,
                    <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#38787ceda7c6f53b" class="i field">WriteWarnings</a> <span class="c">/* but don&#39;t stop on first error and don&#39;t load elements */</span>,
                    <b>null</b>,
                    <b>null</b>,
                    <b>null</b>,
                    <b>null</b>);
 
                    <b>if</b> (<span class="r12 r">module</span> != <b>null</b>)
                    {
                        <span class="c">// Validate file existence</span>
                        <b>if</b> (<span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#85c90ea22293c8e2" class="i property">RequiredAssemblies</a> != <b>null</b>)
                        {
                            <b>foreach</b> (<b>string</b> <span id="r14 rd" class="r14 r">requiredAssembliespath</span> <b>in</b> <span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#85c90ea22293c8e2" class="i property">RequiredAssemblies</a>)
                            {
                                <b>if</b> (!<a href="#00cf08b2ecfca1f9" class="i method">IsValidFilePath</a>(<span class="r14 r">requiredAssembliespath</span>, <span class="r12 r">module</span>, <b>true</b>) &amp;&amp; !<a href="#cafa4c38dbf50183" class="i method">IsValidGacAssembly</a>(<span class="r14 r">requiredAssembliespath</span>))
                                {
                                    <b>string</b> <span id="r15 rd" class="r15 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidRequiredAssembliesInModuleManifest</span>, <span class="r14 r">requiredAssembliespath</span>, <span class="r8 r">filePath</span>);
                                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r16 rd" class="r16 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">DirectoryNotFoundException</span>(<span class="r15 r">errorMsg</span>), <span class="s">&quot;Modules_InvalidRequiredAssembliesInModuleManifest&quot;</span>,
                                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r16 r">errorRecord</span>);
                                }
                            }
                        }
 
                        <b>if</b> (!<a href="#dee10c29ede86e04" class="i method">HasValidRootModule</a>(<span class="r12 r">module</span>))
                        {
                            <b>string</b> <span id="r17 rd" class="r17 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifest</span>, <span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a>, <span class="r8 r">filePath</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r18 rd" class="r18 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">ArgumentException</span>(<span class="r17 r">errorMsg</span>), <span class="s">&quot;Modules_InvalidRootModuleInModuleManifest&quot;</span>,
                                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r18 r">errorRecord</span>);
                        }
 
                        <span class="i">Hashtable</span> <span id="r19 rd" class="r19 r">data</span> = <b>null</b>;
                        <span class="i">Hashtable</span> <span id="r20 rd" class="r20 r">localizedData</span> = <b>null</b>;
                        <b>bool</b> <span id="r21 rd" class="r21 r">containerErrors</span> = <b>false</b>;
                        <a href="ModuleCmdletBase.cs.html#bf907ad98e75e913" class="i method">LoadModuleManifestData</a>(<span class="r9 r">scriptInfo</span>, <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#38787ceda7c6f53b" class="i field">WriteWarnings</a>, <b>out</b> <span class="r19 r">data</span>, <b>out</b> <span class="r20 r">localizedData</span>, <b>ref</b> <span class="r21 r">containerErrors</span>);
                        <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r22 rd" class="r22 r">nestedModules</span>;
                        <a href="ModuleCmdletBase.cs.html#a28bdc3629cd8300" class="i method">GetScalarFromData</a>(<span class="r19 r">data</span>, <span class="r9 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>, <span class="s">&quot;NestedModules&quot;</span>, <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#38787ceda7c6f53b" class="i field">WriteWarnings</a>, <b>out</b> <span class="r22 r">nestedModules</span>);
                        <b>if</b> (<span class="r22 r">nestedModules</span> != <b>null</b>)
                        {
                            <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r23 rd" class="r23 r">nestedModule</span> <b>in</b> <span class="r22 r">nestedModules</span>)
                            {
                                <b>if</b> (!<a href="#00cf08b2ecfca1f9" class="i method">IsValidFilePath</a>(<span class="r23 r">nestedModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="r12 r">module</span>, <b>true</b>)
                                    &amp;&amp; !<span class="i">IsValidFilePath</span>(<span class="r23 r">nestedModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="r12 r">module</span>, <b>true</b>)
                                    &amp;&amp; !<span class="i">IsValidFilePath</span>(<span class="r23 r">nestedModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>, <span class="r12 r">module</span>, <b>true</b>)
                                    &amp;&amp; !<span class="i">IsValidFilePath</span>(<span class="r23 r">nestedModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>, <span class="r12 r">module</span>, <b>true</b>)
                                    &amp;&amp; !<span class="i">IsValidFilePath</span>(<span class="r23 r">nestedModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>, <span class="r12 r">module</span>, <b>true</b>)
                                    &amp;&amp; !<a href="#cafa4c38dbf50183" class="i method">IsValidGacAssembly</a>(<span class="r23 r">nestedModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>))
                                {
                                    <span class="i">Collection</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r24 rd" class="r24 r">modules</span> = <a href="ModuleCmdletBase.cs.html#b9b9dc933360a626" class="i method">GetModuleIfAvailable</a>(<span class="r23 r">nestedModule</span>);
                                    <b>if</b> (<span class="r24 r">modules</span>.<span class="i">Count</span> == 0)
                                    {
                                        <b>string</b> <span id="r25 rd" class="r25 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidNestedModuleinModuleManifest</span>, <span class="r23 r">nestedModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="r8 r">filePath</span>);
                                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r26 rd" class="r26 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">DirectoryNotFoundException</span>(<span class="r25 r">errorMsg</span>), <span class="s">&quot;Modules_InvalidNestedModuleinModuleManifest&quot;</span>,
                                                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                                        <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r26 r">errorRecord</span>);
                                    }
                                }
                            }
                        }
 
                        <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r27 rd" class="r27 r">requiredModules</span>;
                        <a href="ModuleCmdletBase.cs.html#a28bdc3629cd8300" class="i method">GetScalarFromData</a>(<span class="r19 r">data</span>, <span class="r9 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>, <span class="s">&quot;RequiredModules&quot;</span>, <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#38787ceda7c6f53b" class="i field">WriteWarnings</a>, <b>out</b> <span class="r27 r">requiredModules</span>);
                        <b>if</b> (<span class="r27 r">requiredModules</span> != <b>null</b>)
                        {
                            <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r28 rd" class="r28 r">requiredModule</span> <b>in</b> <span class="r27 r">requiredModules</span>)
                            {
                                <b>var</b> <span id="r29 rd" class="r29 r">modules</span> = <a href="ModuleCmdletBase.cs.html#c18fe484b0438291" class="i method">GetModule</a>(<b>new</b>[] { <span class="r28 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> }, <span class="r30 r">all</span>: <b>false</b>, <span class="r31 r">refresh</span>: <b>true</b>);
                                <b>if</b> (<span class="r29 r">modules</span>.<span class="i">Count</span> == 0)
                                {
                                    <b>string</b> <span id="r32 rd" class="r32 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidRequiredModulesinModuleManifest</span>, <span class="r28 r">requiredModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="r8 r">filePath</span>);
                                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r33 rd" class="r33 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">DirectoryNotFoundException</span>(<span class="r32 r">errorMsg</span>), <span class="s">&quot;Modules_InvalidRequiredModulesinModuleManifest&quot;</span>,
                                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r33 r">errorRecord</span>);
                                }
                            }
                        }
 
                        <b>string</b>[] <span id="r34 rd" class="r34 r">fileListPaths</span>;
                        <a href="ModuleCmdletBase.cs.html#a28bdc3629cd8300" class="i method">GetScalarFromData</a>(<span class="r19 r">data</span>, <span class="r9 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>, <span class="s">&quot;FileList&quot;</span>, <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#38787ceda7c6f53b" class="i field">WriteWarnings</a>, <b>out</b> <span class="r34 r">fileListPaths</span>);
                        <b>if</b> (<span class="r34 r">fileListPaths</span> != <b>null</b>)
                        {
                            <b>foreach</b> (<b>string</b> <span id="r35 rd" class="r35 r">fileListPath</span> <b>in</b> <span class="r34 r">fileListPaths</span>)
                            {
                                <b>if</b> (!<a href="#00cf08b2ecfca1f9" class="i method">IsValidFilePath</a>(<span class="r35 r">fileListPath</span>, <span class="r12 r">module</span>, <b>true</b>))
                                {
                                    <b>string</b> <span id="r36 rd" class="r36 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidFilePathinModuleManifest</span>, <span class="r35 r">fileListPath</span>, <span class="r8 r">filePath</span>);
                                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r37 rd" class="r37 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">DirectoryNotFoundException</span>(<span class="r36 r">errorMsg</span>), <span class="s">&quot;Modules_InvalidFilePathinModuleManifest&quot;</span>,
                                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r37 r">errorRecord</span>);
                                }
                            }
                        }
 
                        <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r38 rd" class="r38 r">moduleListModules</span>;
                        <a href="ModuleCmdletBase.cs.html#a28bdc3629cd8300" class="i method">GetScalarFromData</a>(<span class="r19 r">data</span>, <span class="r9 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#ba1a326ad41ce463" class="i property">Path</a>, <span class="s">&quot;ModuleList&quot;</span>, <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#38787ceda7c6f53b" class="i field">WriteWarnings</a>, <b>out</b> <span class="r38 r">moduleListModules</span>);
                        <b>if</b> (<span class="r38 r">moduleListModules</span> != <b>null</b>)
                        {
                            <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r39 rd" class="r39 r">moduleListModule</span> <b>in</b> <span class="r38 r">moduleListModules</span>)
                            {
                                <b>var</b> <span id="r40 rd" class="r40 r">modules</span> = <a href="ModuleCmdletBase.cs.html#c18fe484b0438291" class="i method">GetModule</a>(<b>new</b>[] { <span class="r39 r">moduleListModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> }, <span class="r30 r">all</span>: <b>false</b>, <span class="r31 r">refresh</span>: <b>true</b>);
                                <b>if</b> (<span class="r40 r">modules</span>.<span class="i">Count</span> == 0)
                                {
                                    <b>string</b> <span id="r41 rd" class="r41 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleListinModuleManifest</span>, <span class="r39 r">moduleListModule</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>, <span class="r8 r">filePath</span>);
                                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r42 rd" class="r42 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">DirectoryNotFoundException</span>(<span class="r41 r">errorMsg</span>), <span class="s">&quot;Modules_InvalidModuleListinModuleManifest&quot;</span>,
                                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#9a72a7d3051ac7c5" class="i field">ObjectNotFound</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r42 r">errorRecord</span>);
                                }
                            }
                        }
 
                        <b>if</b> (<span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#b7497b7e6a83b314" class="i property">CompatiblePSEditions</a>.<span class="i">Any</span>())
                        {
                            <span class="c">// The CompatiblePSEditions module manifest key is supported only on PowerShell version &#39;5.1&#39; or higher.</span>
                            <span class="c">// Ensure that PowerShellVersion module manifest key value is &#39;5.1&#39; or higher.</span>
                            <span class="c">//</span>
                            <b>var</b> <span id="r43 rd" class="r43 r">minimumRequiredPowerShellVersion</span> = <b>new</b> <span class="i">Version</span>(5, 1);
                            <b>if</b> ((<span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#6d8cd807d9d4d3ed" class="i property">PowerShellVersion</a> == <b>null</b>) || <span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#6d8cd807d9d4d3ed" class="i property">PowerShellVersion</a> &lt; <span class="r43 r">minimumRequiredPowerShellVersion</span>)
                            {
                                <b>string</b> <span id="r44 rd" class="r44 r">errorMsg</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidPowerShellVersionInModuleManifest</span>, <span class="r8 r">filePath</span>);
                                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="k">var</a> <span id="r45 rd" class="r45 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<b>new</b> <span class="i">ArgumentException</span>(<span class="r44 r">errorMsg</span>), <span class="s">&quot;Modules_InvalidPowerShellVersionInModuleManifest&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r45 r">errorRecord</span>);
                            }
                        }
                    }
                }
                <b>finally</b>
                {
                    <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#a362f3393ffdf245" class="i property">ModuleBeingProcessed</a> = <span class="r13 r">_origModuleBeingProcessed</span>;
                }
 
                <span class="i">DirectoryInfo</span> <span id="r46 rd" class="r46 r">parent</span> = <b>null</b>;
                <b>try</b>
                {
                    <span class="r46 r">parent</span> = <span class="i">Directory</span>.<span class="i">GetParent</span>(<span class="r8 r">filePath</span>);
                }
                <b>catch</b> (<span class="i">IOException</span>) { }
                <b>catch</b> (<span class="i">UnauthorizedAccessException</span>) { }
                <b>catch</b> (<span class="i">ArgumentException</span>) { }
 
                <span class="i">Version</span> <span id="r47 rd" class="r47 r">version</span>;
                <b>if</b> (<span class="r46 r">parent</span> != <b>null</b> &amp;&amp; <span class="i">Version</span>.<span class="i">TryParse</span>(<span class="r46 r">parent</span>.<span class="i">Name</span>, <b>out</b> <span class="r47 r">version</span>))
                {
                    <b>if</b> (!<span class="r47 r">version</span>.<span class="i">Equals</span>(<span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>))
                    {
                        <b>string</b> <span id="r48 rd" class="r48 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifestVersion</span>, <span class="r8 r">filePath</span>, <span class="r12 r">module</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>.<span class="i">ToString</span>(), <span class="r46 r">parent</span>.<span class="i">FullName</span>);
                        <b>var</b> <span id="r49 rd" class="r49 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r48 r">message</span>);
                        <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r50 rd" class="r50 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r49 r">ioe</span>, <span class="s">&quot;Modules_InvalidModuleManifestVersion&quot;</span>,
                            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                        <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r50 r">er</span>);
                    }
 
                    <span class="i">WriteVerbose</span>(<span class="i">Modules</span>.<span class="i">ModuleVersionEqualsToVersionFolder</span>);
                }
 
                <b>if</b> (<span class="r12 r">module</span> != <b>null</b>)
                {
                    <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r12 r">module</span>);
                }
            }
            <b>else</b>
            {
                <b>string</b> <span id="r51 rd" class="r51 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifestPath</span>, <span class="r8 r">filePath</span>);
                <span class="i">InvalidOperationException</span> <span id="r52 rd" class="r52 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r51 r">message</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r53 rd" class="r53 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r52 r">ioe</span>, <span class="s">&quot;Modules_InvalidModuleManifestPath&quot;</span>,
                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <a href="#0615484bd27ab020" class="i field">_path</a>);
                <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r53 r">er</span>);
            }
        }
 
        <span class="c">// All module extensions except &quot;.psd1&quot; are valid RootModule extensions</span>
        <b>private static readonly</b> <span class="i">IReadOnlyList</span>&lt;<b>string</b>&gt; <a id="b56cf09f0c0d2390" href="../../R/b56cf09f0c0d2390.html" target="n" data-glyph="46,1" class="i field">s_validRootModuleExtensions</a> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#2f61be99d14256e7" class="i field">PSModuleExtensions</a>
            .<span class="i">Where</span>(<b>static</b> <span id="r54 rd" class="r54 r">ext</span> =&gt; !<b>string</b>.<span class="i">Equals</span>(<span class="r54 r">ext</span>, <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            .<span class="i">ToArray</span>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks whether the RootModule field of a module is valid or not.</span>
        <span class="c">///</span><span class="c"> Valid root modules are:</span>
        <span class="c">///</span><span class="c">  - null</span>
        <span class="c">///</span><span class="c">  - Empty string</span>
        <span class="c">///</span><span class="c">  - A valid non-psd1 module file (psm1, cdxml, xaml, dll), as name with extension, name without extension, or path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module for which we want to check the validity of the root module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the root module is valid, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="dee10c29ede86e04" href="../../R/dee10c29ede86e04.html" target="n" data-glyph="76,1" class="i method">HasValidRootModule</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r55 rd" class="r55 r">module</span>)
        {
            <span class="c">// Empty/null root modules are allowed</span>
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r55 r">module</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// GAC assemblies are allowed</span>
            <b>if</b> (<a href="#cafa4c38dbf50183" class="i method">IsValidGacAssembly</a>(<span class="r55 r">module</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// Check for extensions</span>
            <b>string</b> <span id="r56 rd" class="r56 r">rootModuleExt</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r55 r">module</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a>);
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r56 r">rootModuleExt</span>))
            {
                <span class="c">// Check that the root module&#39;s extension is an allowed one</span>
                <b>if</b> (!<a href="#b56cf09f0c0d2390" class="i field">s_validRootModuleExtensions</a>.<span class="i">Contains</span>(<span class="r56 r">rootModuleExt</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <span class="c">// Check the file path of the full root module</span>
                <b>return</b> <a href="#00cf08b2ecfca1f9" class="i method">IsValidFilePath</a>(<span class="r55 r">module</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a>, <span class="r55 r">module</span>, <span class="r57 r">verifyPathScope</span>: <b>true</b>);
            }
 
            <span class="c">// We have no extension, so we need to check all of them</span>
            <b>foreach</b> (<b>string</b> <span id="r58 rd" class="r58 r">extension</span> <b>in</b> <a href="#b56cf09f0c0d2390" class="i field">s_validRootModuleExtensions</a>)
            {
                <b>if</b> (<span class="i">IsValidFilePath</span>(<span class="r55 r">module</span>.<a href="PSModuleInfo.cs.html#1d8575eacaa7f07f" class="i property">RootModule</a> + <span class="r58 r">extension</span>, <span class="r55 r">module</span>, <span class="i">verifyPathScope</span>: <b>true</b>))
                {
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the given path is valid.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">verifyPathScope</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="00cf08b2ecfca1f9" href="../../R/00cf08b2ecfca1f9.html" target="n" data-glyph="76,1" class="i method">IsValidFilePath</a>(<b>string</b> <span id="r59 rd" class="r59 r">path</span>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r60 rd" class="r60 r">module</span>, <b>bool</b> <span id="r57 rd" class="r57 r">verifyPathScope</span>)
        {
            <b>try</b>
            {
                <b>if</b> (!<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">IsPathRooted</span>(<span class="r59 r">path</span>))
                {
                    <span class="c">// we assume the relative path is under module scope, otherwise we will throw error anyway.</span>
                    <span class="r59 r">path</span> = <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetFullPath</span>(<span class="r60 r">module</span>.<a href="PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a> + <span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">DirectorySeparatorChar</span> + <span class="r59 r">path</span>);
                }
 
                <span class="c">// resolve the path so slashes are in the right direction</span>
                <a href="../../namespaces/CoreCommandContext.cs.html#1e83d35d5286e174" class="t t">CmdletProviderContext</a> <span id="r61 rd" class="r61 r">cmdContext</span> = <b>new</b> <a href="../../namespaces/CoreCommandContext.cs.html#ce9b8f5a7a73244f" class="t constructor">CmdletProviderContext</a>(<a href="#7bf67b688ccb67b7" class="k">this</a>);
                <span class="i">Collection</span>&lt;<a href="../../namespaces/PathInfo.cs.html#9504cfb54420cfd7" class="t t">PathInfo</a>&gt; <span id="r62 rd" class="r62 r">pathInfos</span> = <a href="../CommandBase.cs.html#5078d443148de142" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../PathInterfaces.cs.html#8657980b0d09f10c" class="i method">GetResolvedPSPathFromPSPath</a>(<span class="r59 r">path</span>, <span class="r61 r">cmdContext</span>);
                <b>if</b> (<span class="r62 r">pathInfos</span>.<span class="i">Count</span> != 1)
                {
                    <b>string</b> <span id="r63 rd" class="r63 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">InvalidModuleManifestPath</span>, <span class="r59 r">path</span>);
                    <span class="i">InvalidOperationException</span> <span id="r64 rd" class="r64 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r63 r">message</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r65 rd" class="r65 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r64 r">ioe</span>, <span class="s">&quot;Modules_InvalidModuleManifestPath&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>, <span class="r59 r">path</span>);
                    <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r65 r">er</span>);
                }
 
                <span class="r59 r">path</span> = <span class="r62 r">pathInfos</span>[0].<span class="i">Path</span>;
 
                <span class="c">// First, we validate if the path does exist.</span>
                <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="r59 r">path</span>) &amp;&amp; !<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r59 r">path</span>))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <span class="c">// Then, we validate if the path is under module scope</span>
                <b>if</b> (<span class="r57 r">verifyPathScope</span> &amp;&amp; !<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetFullPath</span>(<span class="r59 r">path</span>).<span class="i">StartsWith</span>(<span class="i n">System</span>.<span class="i">IO</span>.<span class="i">Path</span>.<span class="i">GetFullPath</span>(<span class="r60 r">module</span>.<a href="PSModuleInfo.cs.html#3c412fbb7362d7c7" class="i property">ModuleBase</a>), <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <b>false</b>;
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r66 rd" class="r66 r">exception</span>)
            {
                <b>if</b> (<span class="r66 r">exception</span> <b>is</b> <span class="i">ArgumentException</span> || <span class="r66 r">exception</span> <b>is</b> <span class="i">ArgumentNullException</span> || <span class="r66 r">exception</span> <b>is</b> <span class="i">NotSupportedException</span> || <span class="r66 r">exception</span> <b>is</b> <span class="i">PathTooLongException</span> || <span class="r66 r">exception</span> <b>is</b> <a href="../../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a>)
                {
                    <b>return</b> <b>false</b>;
                }
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if the given string is a valid gac assembly.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">assemblyName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static bool</b> <a id="cafa4c38dbf50183" href="../../R/cafa4c38dbf50183.html" target="n" data-glyph="76,1" class="i method">IsValidGacAssembly</a>(<b>string</b> <span id="r67 rd" class="r67 r">assemblyName</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return false;
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>string</b> <span id="r68 rd" class="r68 r">gacPath</span> = <span class="i n">System</span>.<span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="s">&quot;windir&quot;</span>) + <span class="s">&quot;\\Microsoft.NET\\assembly&quot;</span>;
            <b>string</b> <span id="r69 rd" class="r69 r">assemblyFile</span> = <span class="r67 r">assemblyName</span>;
            <b>string</b> <span id="r70 rd" class="r70 r">ngenAssemblyFile</span> = <span class="r67 r">assemblyName</span>;
            <b>if</b> (!<span class="r67 r">assemblyName</span>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r69 r">assemblyFile</span> = <span class="r67 r">assemblyName</span> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>;
                <span class="r70 r">ngenAssemblyFile</span> = <span class="r67 r">assemblyName</span> + <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>;
            }
 
            <b>try</b>
            {
                <b>return</b> <span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<span class="r68 r">gacPath</span>, <span class="r69 r">assemblyFile</span>, <span class="i">SearchOption</span>.<span class="i">AllDirectories</span>).<span class="i">Any</span>()
                    || <span class="i">Directory</span>.<span class="i">EnumerateFiles</span>(<span class="r68 r">gacPath</span>, <span class="r70 r">ngenAssemblyFile</span>, <span class="i">SearchOption</span>.<span class="i">AllDirectories</span>).<span class="i">Any</span>();
            }
            <b>catch</b>
            {
                <b>return</b> <b>false</b>;
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
}
</pre></td></tr></table></div></body></html>
