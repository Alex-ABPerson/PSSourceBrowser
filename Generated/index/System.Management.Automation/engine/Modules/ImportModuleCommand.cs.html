<!DOCTYPE html>
<html><head><title>ImportModuleCommand.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(2128);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/Modules/ImportModuleCommand.cs" target="_top">engine\Modules\ImportModuleCommand.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Security</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Cmdletization</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Telemetry</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
<b>using</b> <span class="t">Parser</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>.<a href="../parser/Parser.cs.html#bbf5e856fb3215c5" class="t t">Parser</a>;
<b>using</b> <span class="t">ScriptBlock</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>;
<b>using</b> <span class="t">Token</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>.<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>;
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">LEGACYTELEMETRY</span>
<span class="e">using Microsoft.PowerShell.Telemetry.Internal;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
<span class="c">//</span>
<span class="c">// Now define the set of commands for manipulating modules.</span>
<span class="c">//</span>
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Implements a cmdlet that loads a module.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<span class="i">Cmdlet</span>(<a href="../../utils/Verbs.cs.html#ced47428947bccb7" class="t t">VerbsData</a>.<a href="../../utils/Verbs.cs.html#7307de9a00fd0115" class="i field">Import</a>, <span class="s">&quot;Module&quot;</span>, <span class="i">DefaultParameterSetName</span> = <a href="#7a9a3981a7e5ceb3" class="i field">ParameterSet_Name</a>, <span class="i">HelpUri</span> = <span class="s">&quot;https://go.microsoft.com/fwlink/?LinkID=2096585&quot;</span>)]
    [<span class="i">OutputType</span>(<b>typeof</b>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>))]
    <b>public sealed class</b> <a id="4a6e75cbbfb65b34" href="../../R/4a6e75cbbfb65b34.html" target="n" data-glyph="0,0" class="t t">ImportModuleCommand</a> : <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>, <span class="i">IDisposable</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Cmdlet parameters
 
        <b>private const string</b> <a id="7a9a3981a7e5ceb3" href="../../R/7a9a3981a7e5ceb3.html" target="n" data-glyph="10,1" class="i field">ParameterSet_Name</a> = <span class="s">&quot;Name&quot;</span>;
        <b>private const string</b> <a id="cef4feb333014677" href="../../R/cef4feb333014677.html" target="n" data-glyph="10,1" class="i field">ParameterSet_FQName</a> = <span class="s">&quot;FullyQualifiedName&quot;</span>;
        <b>private const string</b> <a id="7576fa9d1daaf6fd" href="../../R/7576fa9d1daaf6fd.html" target="n" data-glyph="10,1" class="i field">ParameterSet_ModuleInfo</a> = <span class="s">&quot;ModuleInfo&quot;</span>;
        <b>private const string</b> <a id="443c427b530c8a13" href="../../R/443c427b530c8a13.html" target="n" data-glyph="10,1" class="i field">ParameterSet_Assembly</a> = <span class="s">&quot;Assembly&quot;</span>;
 
        <b>private const string</b> <a id="9f6ec35fe83e178c" href="../../R/9f6ec35fe83e178c.html" target="n" data-glyph="10,1" class="i field">ParameterSet_ViaPsrpSession</a> = <span class="s">&quot;PSSession&quot;</span>;
        <b>private const string</b> <a id="68d6531c3bef4a0b" href="../../R/68d6531c3bef4a0b.html" target="n" data-glyph="10,1" class="i field">ParameterSet_ViaCimSession</a> = <span class="s">&quot;CimSession&quot;</span>;
        <b>private const string</b> <a id="5c2f84755d31896f" href="../../R/5c2f84755d31896f.html" target="n" data-glyph="10,1" class="i field">ParameterSet_FQName_ViaPsrpSession</a> = <span class="s">&quot;FullyQualifiedNameAndPSSession&quot;</span>;
        <b>private const string</b> <a id="033099a5396eebb0" href="../../R/033099a5396eebb0.html" target="n" data-glyph="10,1" class="i field">ParameterSet_ViaWinCompat</a> = <span class="s">&quot;WinCompat&quot;</span>;
        <b>private const string</b> <a id="cb10e849a44c5b2d" href="../../R/cb10e849a44c5b2d.html" target="n" data-glyph="10,1" class="i field">ParameterSet_FQName_ViaWinCompat</a> = <span class="s">&quot;FullyQualifiedNameAndWinCompat&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specifies whether to import to the current session state</span>
        <span class="c">///</span><span class="c"> or to the global / top-level session state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="4c6abfc27d0a33ab" href="../../R/4c6abfc27d0a33ab.html" target="n" data-glyph="102,1" class="i property">Global</a>
        {
            <b>get</b> { <b>return</b> <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="k">base</a>.<a href="ModuleCmdletBase.cs.html#05a013615daefcfa" class="i property">BaseGlobal</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="k">base</a>.<a href="ModuleCmdletBase.cs.html#05a013615daefcfa" class="i property">BaseGlobal</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specified a prefix used to modify names of imported commands.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNull</span>]
        <b>public string</b> <a id="7a8d061c413994be" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Prefix</a>
        {
            <b>get</b> { <b>return</b> <a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter names the module to load.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#7a9a3981a7e5ceb3" class="i field">ParameterSet_Name</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#9f6ec35fe83e178c" class="i field">ParameterSet_ViaPsrpSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#033099a5396eebb0" class="i field">ParameterSet_ViaWinCompat</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">ValidateTrustedData</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public string</b>[] <a id="d6845729919990dc" href="../../R/d6845729919990dc.html" target="n" data-glyph="102,1" class="i property">Name</a> { <b>get</b>; <b>set</b>; } = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specifies the current pipeline object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#cef4feb333014677" class="i field">ParameterSet_FQName</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#5c2f84755d31896f" class="i field">ParameterSet_FQName_ViaPsrpSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#cb10e849a44c5b2d" class="i field">ParameterSet_FQName_ViaWinCompat</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">ValidateTrustedData</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public</b> <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <a id="a8f026e1f662b72e" href="../../R/a8f026e1f662b72e.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedName</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A list of assembly objects to process as modules.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#443c427b530c8a13" class="i field">ParameterSet_Assembly</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">ValidateTrustedData</span>]
        <b>public</b> <span class="i">Assembly</span>[] <a id="67de8a4318ac7531" href="../../R/67de8a4318ac7531.html" target="n" data-glyph="102,1" class="i property">Assembly</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This patterns matching the names of functions to import from the module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNull</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public string</b>[] <a id="9393071885fb794e" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Function</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#ef89e218cce4afaf" class="i field">_functionImportList</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                    <b>return</b>;
                <a href="#ef89e218cce4afaf" class="i field">_functionImportList</a> = <b>value</b>;
                <span class="c">// Create the list of patterns to match at parameter bind time</span>
                <span class="c">// so errors will be reported before loading the module...</span>
                <a href="ModuleCmdletBase.cs.html#e9585290a055b001" class="i property">BaseFunctionPatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <b>foreach</b> (<b>string</b> <span id="r0 rd" class="r0 r">pattern</span> <b>in</b> <a href="#ef89e218cce4afaf" class="i field">_functionImportList</a>)
                {
                    <a href="ModuleCmdletBase.cs.html#e9585290a055b001" class="i property">BaseFunctionPatterns</a>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r0 r">pattern</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                }
            }
        }
 
        <b>private string</b>[] <a id="ef89e218cce4afaf" href="../../R/ef89e218cce4afaf.html" target="n" data-glyph="46,1" class="i field">_functionImportList</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This patterns matching the names of cmdlets to import from the module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNull</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public string</b>[] <a id="2d5882b8dcf8aa9d" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Cmdlet</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#95298890cc6a1776" class="i field">_cmdletImportList</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                    <b>return</b>;
 
                <a href="#95298890cc6a1776" class="i field">_cmdletImportList</a> = <b>value</b>;
                <span class="c">// Create the list of patterns to match at parameter bind time</span>
                <span class="c">// so errors will be reported before loading the module...</span>
                <a href="ModuleCmdletBase.cs.html#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <b>foreach</b> (<b>string</b> <span id="r1 rd" class="r1 r">pattern</span> <b>in</b> <a href="#95298890cc6a1776" class="i field">_cmdletImportList</a>)
                {
                    <a href="ModuleCmdletBase.cs.html#5bcde7efb3a971e1" class="i property">BaseCmdletPatterns</a>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r1 r">pattern</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                }
            }
        }
 
        <b>private string</b>[] <a id="95298890cc6a1776" href="../../R/95298890cc6a1776.html" target="n" data-glyph="46,1" class="i field">_cmdletImportList</a> = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specifies the variables to import from the module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNull</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public string</b>[] <a id="e9600531193819b5" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Variable</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#62929cd78087a9ad" class="i field">_variableExportList</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                    <b>return</b>;
                <a href="#62929cd78087a9ad" class="i field">_variableExportList</a> = <b>value</b>;
                <span class="c">// Create the list of patterns to match at parameter bind time</span>
                <span class="c">// so errors will be reported before loading the module...</span>
                <a href="ModuleCmdletBase.cs.html#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <b>foreach</b> (<b>string</b> <span id="r2 rd" class="r2 r">pattern</span> <b>in</b> <a href="#62929cd78087a9ad" class="i field">_variableExportList</a>)
                {
                    <a href="ModuleCmdletBase.cs.html#1c7ed22590c269bf" class="i property">BaseVariablePatterns</a>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r2 r">pattern</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                }
            }
        }
 
        <b>private string</b>[] <a id="62929cd78087a9ad" href="../../R/62929cd78087a9ad.html" target="n" data-glyph="46,1" class="i field">_variableExportList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specifies the aliases to import from the module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateNotNull</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public string</b>[] <a id="c5a3c2421d5d4baa" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Alias</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#10567e8cfa63be96" class="i field">_aliasExportList</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> == <b>null</b>)
                    <b>return</b>;
 
                <a href="#10567e8cfa63be96" class="i field">_aliasExportList</a> = <b>value</b>;
                <span class="c">// Create the list of patterns to match at parameter bind time</span>
                <span class="c">// so errors will be reported before loading the module...</span>
                <a href="ModuleCmdletBase.cs.html#6f55985943d4e435" class="i property">BaseAliasPatterns</a> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
                <b>foreach</b> (<b>string</b> <span id="r3 rd" class="r3 r">pattern</span> <b>in</b> <a href="#10567e8cfa63be96" class="i field">_aliasExportList</a>)
                {
                    <a href="ModuleCmdletBase.cs.html#6f55985943d4e435" class="i property">BaseAliasPatterns</a>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r3 r">pattern</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                }
            }
        }
 
        <b>private string</b>[] <a id="10567e8cfa63be96" href="../../R/10567e8cfa63be96.html" target="n" data-glyph="46,1" class="i field">_aliasExportList</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter causes a module to be loaded over top of the current one...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="894f065ab1ced877" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">Force</a>
        {
            <b>get</b> { <b>return</b> (<a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>)<a href="ModuleCmdletBase.cs.html#f8d5c3639f6e81cd" class="i property">BaseForce</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#f8d5c3639f6e81cd" class="i property">BaseForce</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Skips the check on CompatiblePSEditions for modules loaded from the System32 module path.</span>
        <span class="c">///</span><span class="c"> This is mutually exclusive with UseWindowsPowerShell parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#7a9a3981a7e5ceb3" class="i field">ParameterSet_Name</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#cef4feb333014677" class="i field">ParameterSet_FQName</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#7576fa9d1daaf6fd" class="i field">ParameterSet_ModuleInfo</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#443c427b530c8a13" class="i field">ParameterSet_Assembly</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#9f6ec35fe83e178c" class="i field">ParameterSet_ViaPsrpSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#5c2f84755d31896f" class="i field">ParameterSet_FQName_ViaPsrpSession</a>)]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="f8be60344c92586e" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">SkipEditionCheck</a>
        {
            <b>get</b> { <b>return</b> (<a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>)<a href="ModuleCmdletBase.cs.html#c870fc509e9d03a5" class="i property">BaseSkipEditionCheck</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#c870fc509e9d03a5" class="i property">BaseSkipEditionCheck</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter causes the session state instance to be written...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="30fa85a6f2531fae" href="../../R/30fa85a6f2531fae.html" target="n" data-glyph="102,1" class="i property">PassThru</a>
        {
            <b>get</b> { <b>return</b> (<a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>)<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter causes the session state instance to be written as a custom object...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="8c3167996d16d793" href="../../R/../../0000000000.html" target="n" data-glyph="102,1" class="i property">AsCustomObject</a>
        {
            <b>get</b> { <b>return</b> (<a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a>)<a href="ModuleCmdletBase.cs.html#1088653af525f6b7" class="i property">BaseAsCustomObject</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#1088653af525f6b7" class="i property">BaseAsCustomObject</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The minimum version of the module to load.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#7a9a3981a7e5ceb3" class="i field">ParameterSet_Name</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#9f6ec35fe83e178c" class="i field">ParameterSet_ViaPsrpSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#033099a5396eebb0" class="i field">ParameterSet_ViaWinCompat</a>)]
        [<span class="i">Alias</span>(<span class="s">&quot;Version&quot;</span>)]
        <b>public</b> <span class="i">Version</span> <a id="685eb1cc54e970ac" href="../../R/685eb1cc54e970ac.html" target="n" data-glyph="102,1" class="i property">MinimumVersion</a>
        {
            <b>get</b> { <b>return</b> <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The maximum version of the module to load.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#7a9a3981a7e5ceb3" class="i field">ParameterSet_Name</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#9f6ec35fe83e178c" class="i field">ParameterSet_ViaPsrpSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#033099a5396eebb0" class="i field">ParameterSet_ViaWinCompat</a>)]
        <b>public string</b> <a id="48978be25763995e" href="../../R/48978be25763995e.html" target="n" data-glyph="102,1" class="i property">MaximumVersion</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> == <b>null</b>)
                    <b>return</b> <b>null</b>;
                <b>else</b>
                    <b>return</b> <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>.<span class="i">ToString</span>();
            }
 
            <b>set</b>
            {
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<b>value</b>))
                {
                    <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <b>null</b>;
                }
                <b>else</b>
                {
                    <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <a href="ModuleCmdletBase.cs.html#8d9eea57094a20b4" class="i method">GetMaximumVersion</a>(<b>value</b>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The version of the module to load.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#7a9a3981a7e5ceb3" class="i field">ParameterSet_Name</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#9f6ec35fe83e178c" class="i field">ParameterSet_ViaPsrpSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#033099a5396eebb0" class="i field">ParameterSet_ViaWinCompat</a>)]
        <b>public</b> <span class="i">Version</span> <a id="00317cebd89fcc39" href="../../R/00317cebd89fcc39.html" target="n" data-glyph="102,1" class="i property">RequiredVersion</a>
        {
            <b>get</b> { <b>return</b> <a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter specifies the current pipeline object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#7576fa9d1daaf6fd" class="i field">ParameterSet_ModuleInfo</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>, <a href="../Attributes.cs.html#4afbf5921ff6e967" class="i property">ValueFromPipeline</a> = <b>true</b>, <a href="../Attributes.cs.html#19ccfeb1cdbdb967" class="i property">Position</a> = 0)]
        [<span class="i">ValidateTrustedData</span>]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>[] <a id="f211e2b5a4eaa87f" href="../../R/f211e2b5a4eaa87f.html" target="n" data-glyph="102,1" class="i property">ModuleInfo</a> { <b>get</b>; <b>set</b>; } = <span class="i">Array</span>.<span class="i">Empty</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The arguments to pass to the module script.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">Alias</span>(<span class="s">&quot;Args&quot;</span>)]
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Performance&quot;</span>, <span class="s">&quot;CA1819:PropertiesShouldNotReturnArrays&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;Cmdlets use arrays for parameters.&quot;</span>)]
        <b>public object</b>[] <a id="bc1722a3e6d61bbd" href="../../R/bc1722a3e6d61bbd.html" target="n" data-glyph="102,1" class="i property">ArgumentList</a>
        {
            <b>get</b> { <b>return</b> <a href="ModuleCmdletBase.cs.html#e1f617f9af7f631a" class="i property">BaseArgumentList</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#e1f617f9af7f631a" class="i property">BaseArgumentList</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Disable warnings on cmdlet and function names that have non-standard verbs</span>
        <span class="c">///</span><span class="c"> or non-standard characters in the noun.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="6ea9ca8c58af00e2" href="../../R/6ea9ca8c58af00e2.html" target="n" data-glyph="102,1" class="i property">DisableNameChecking</a>
        {
            <b>get</b> { <b>return</b> <a href="ModuleCmdletBase.cs.html#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a>; }
 
            <b>set</b> { <a href="ModuleCmdletBase.cs.html#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a> = <b>value</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Does not import a command if a command with same name exists on the target sessionstate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>, <span class="i">Alias</span>(<span class="s">&quot;NoOverwrite&quot;</span>)]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="59ad6c43ee921fcf" href="../../R/59ad6c43ee921fcf.html" target="n" data-glyph="102,1" class="i property">NoClobber</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Imports a command to the scope specified.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>]
        [<span class="i">ValidateSet</span>(<span class="s">&quot;Local&quot;</span>, <span class="s">&quot;Global&quot;</span>)]
        <b>public string</b> <a id="67e079351e28cfca" href="../../R/67e079351e28cfca.html" target="n" data-glyph="102,1" class="i property">Scope</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#967047f13aca71ea" class="i field">_scope</a>;
            }
 
            <b>set</b>
            {
                <a href="#967047f13aca71ea" class="i field">_scope</a> = <b>value</b>;
                <a href="#6afc8acb3434d861" class="i field">_isScopeSpecified</a> = <b>true</b>;
            }
        }
 
        <b>private string</b> <a id="967047f13aca71ea" href="../../R/967047f13aca71ea.html" target="n" data-glyph="46,1" class="i field">_scope</a> = <b>string</b>.<span class="i">Empty</span>;
        <b>private bool</b> <a id="6afc8acb3434d861" href="../../R/6afc8acb3434d861.html" target="n" data-glyph="46,1" class="i field">_isScopeSpecified</a> = <b>false</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If specified, then Import-Module will attempt to import PowerShell modules from a remote computer using the specified session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#9f6ec35fe83e178c" class="i field">ParameterSet_ViaPsrpSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#5c2f84755d31896f" class="i field">ParameterSet_FQName_ViaPsrpSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>)]
        [<span class="i">ValidateNotNull</span>]
        <b>public</b> <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <a id="10f64975c8cbe671" href="../../R/10f64975c8cbe671.html" target="n" data-glyph="102,1" class="i property">PSSession</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> Construct the Import-Module cmdlet object</span>
        <b>public</b> <a id="7162b8a462c04760" href="../../R/7162b8a462c04760.html" target="n" data-glyph="72,1" class="t constructor">ImportModuleCommand</a>()
        {
            <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="k">base</a>.<a href="ModuleCmdletBase.cs.html#b9892a02bdac22ec" class="i property">BaseDisableNameChecking</a> = <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If specified, then Import-Module will attempt to import PS-CIM modules from a remote computer using the specified session.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>)]
        [<span class="i">ValidateNotNull</span>]
        <b>public</b> <span class="i">CimSession</span> <a id="fa85ca0bb2b4091e" href="../../R/fa85ca0bb2b4091e.html" target="n" data-glyph="102,1" class="i property">CimSession</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> For interoperability with 3rd party CIM servers, user can specify custom resource URI.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>false</b>)]
        [<span class="i">ValidateNotNull</span>]
        <b>public</b> <span class="i">Uri</span> <a id="a8af03b875c636c3" href="../../R/a8af03b875c636c3.html" target="n" data-glyph="102,1" class="i property">CimResourceUri</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> For interoperability with 3rd party CIM servers, user can specify custom namespace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>false</b>)]
        [<span class="i">ValidateNotNullOrEmpty</span>]
        <b>public string</b> <a id="74e4b5fd79b3a31e" href="../../R/74e4b5fd79b3a31e.html" target="n" data-glyph="102,1" class="i property">CimNamespace</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter causes a module to be loaded into Windows PowerShell.</span>
        <span class="c">///</span><span class="c"> This is mutually exclusive with SkipEditionCheck parameter.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#033099a5396eebb0" class="i field">ParameterSet_ViaWinCompat</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>)]
        [<span class="i">Parameter</span>(<a href="../Attributes.cs.html#91bee819daab0925" class="i property">ParameterSetName</a> = <a href="#cb10e849a44c5b2d" class="i field">ParameterSet_FQName_ViaWinCompat</a>, <a href="../Attributes.cs.html#d5ad471518092731" class="i property">Mandatory</a> = <b>true</b>)]
        [<span class="i">Alias</span>(<span class="s">&quot;UseWinPS&quot;</span>)]
        <b>public</b> <a href="../MshCmdlet.cs.html#8260026027378f6c" class="t t">SwitchParameter</a> <a id="ca42f6c0d0fd808d" href="../../R/ca42f6c0d0fd808d.html" target="n" data-glyph="102,1" class="i property">UseWindowsPowerShell</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Cmdlet parameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Local import
 
        <b>private void</b> <a id="171d6cf1e2ab8c2f" href="../../R/171d6cf1e2ab8c2f.html" target="n" data-glyph="76,1" class="i method">ImportModule_ViaLocalModuleInfo</a>(<a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r4 rd" class="r4 r">importModuleOptions</span>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r5 rd" class="r5 r">module</span>)
        {
            <b>try</b>
            {
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r6 rd" class="r6 r">alreadyLoadedModule</span> = <b>null</b>;
                <a href="ModuleCmdletBase.cs.html#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r5 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <b>out</b> <span class="r6 r">alreadyLoadedModule</span>);
                <b>if</b> (!<a href="ModuleCmdletBase.cs.html#f8d5c3639f6e81cd" class="i property">BaseForce</a> &amp;&amp; <a href="ModuleCmdletBase.cs.html#5ee06f3ee1be0ff1" class="i method">DoesAlreadyLoadedModuleSatisfyConstraints</a>(<span class="r6 r">alreadyLoadedModule</span>))
                {
                    <a href="ModuleCmdletBase.cs.html#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r6 r">alreadyLoadedModule</span>);
 
                    <span class="c">// Even if the module has been loaded, import the specified members...</span>
                    <a href="ModuleCmdletBase.cs.html#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r6 r">alreadyLoadedModule</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="r4 r">importModuleOptions</span>);
 
                    <b>if</b> (<a href="ModuleCmdletBase.cs.html#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                    {
                        <b>if</b> (<span class="r6 r">alreadyLoadedModule</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> != <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#15536cea81510839" class="i field">Script</a>)
                        {
                            <b>string</b> <span id="r7 rd" class="r7 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">CantUseAsCustomObjectWithBinaryModule</span>, <span class="r6 r">alreadyLoadedModule</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                            <span class="i">InvalidOperationException</span> <span id="r8 rd" class="r8 r">invalidOp</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r7 r">message</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r9 rd" class="r9 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r8 r">invalidOp</span>, <span class="s">&quot;Modules_CantUseAsCustomObjectWithBinaryModule&quot;</span>,
                                                             <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>);
                            <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r9 r">er</span>);
                        }
                        <b>else</b>
                        {
                            <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r6 r">alreadyLoadedModule</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                        }
                    }
                    <b>else</b> <b>if</b> (<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>)
                    {
                        <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r6 r">alreadyLoadedModule</span>);
                    }
                }
                <b>else</b>
                {
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r10 rd" class="r10 r">moduleToRemove</span>;
                    <b>if</b> (<a href="ModuleCmdletBase.cs.html#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r5 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <b>out</b> <span class="r10 r">moduleToRemove</span>, <span class="r11 r">toRemove</span>: <b>true</b>))
                    {
                        <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="ModuleCmdletBase.cs.html#f8d5c3639f6e81cd" class="i property">BaseForce</a>, <span class="s">&quot;We should only remove and reload if -Force was specified&quot;</span>);
                        <a href="ModuleCmdletBase.cs.html#452f85accd76669f" class="i method">RemoveModule</a>(<span class="r10 r">moduleToRemove</span>);
                    }
 
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r12 rd" class="r12 r">moduleToProcess</span> = <span class="r5 r">module</span>;
                    <b>try</b>
                    {
                        <span class="c">// If we&#39;re passing in a dynamic module, then the session state will not be</span>
                        <span class="c">// null and we want to just add the module to the module table. Otherwise, it&#39;s</span>
                        <span class="c">// a module info from Get-Module -list so we need to read the actual module file.</span>
                        <b>if</b> (<span class="r5 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> == <b>null</b>)
                        {
                            <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r5 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>))
                            {
                                <b>bool</b> <span id="r13 rd" class="r13 r">found</span>;
                                <span class="r12 r">moduleToProcess</span> = <span class="i">LoadModule</span>(<span class="r5 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>, <b>null</b>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="c">/*SessionState*/</span> <b>null</b>,
                                                             <b>ref</b> <span class="r4 r">importModuleOptions</span>,
                                                             <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                                                             <b>out</b> <span class="r13 r">found</span>);
                                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r13 r">found</span>, <span class="s">&quot;Module should be found when referenced by its absolute path&quot;</span>);
                            }
                        }
                        <b>else</b> <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r5 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>))
                        {
                            <span class="c">// It has a session state and a name but it&#39;s not in the module</span>
                            <span class="c">// table so it&#39;s ok to add it</span>
 
                            <span class="c">// Add it to the all module tables</span>
                            <a href="ModuleCmdletBase.cs.html#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r12 r">moduleToProcess</span>);
 
                            <b>if</b> (<span class="r12 r">moduleToProcess</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> != <b>null</b>)
                            {
                                <a href="ModuleCmdletBase.cs.html#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r12 r">moduleToProcess</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="r4 r">importModuleOptions</span>);
                            }
 
                            <b>if</b> (<a href="ModuleCmdletBase.cs.html#1088653af525f6b7" class="i property">BaseAsCustomObject</a> &amp;&amp; <span class="r12 r">moduleToProcess</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a> != <b>null</b>)
                            {
                                <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r5 r">module</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                            }
                            <b>else</b> <b>if</b> (<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>)
                            {
                                <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r12 r">moduleToProcess</span>);
                            }
                        }
                    }
                    <b>catch</b> (<span class="i">IOException</span>)
                    {
                    }
                }
            }
            <b>catch</b> (<a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r14 rd" class="r14 r">e</span>)
            {
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r15 rd" class="r15 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r14 r">e</span>.<a href="../../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>, <span class="r14 r">e</span>);
                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r15 r">er</span>);
            }
        }
 
        <b>private void</b> <a id="a4782ff61b36a312" href="../../R/a4782ff61b36a312.html" target="n" data-glyph="76,1" class="i method">ImportModule_ViaAssembly</a>(<a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r16 rd" class="r16 r">importModuleOptions</span>, <span class="i">Assembly</span> <span id="r17 rd" class="r17 r">suppliedAssembly</span>)
        {
            <b>bool</b> <span id="r18 rd" class="r18 r">moduleLoaded</span> = <b>false</b>;
            <span class="c">// Loop through Module Cache to ensure that the module is not already imported.</span>
            <b>if</b> (<span class="r17 r">suppliedAssembly</span> != <b>null</b> &amp;&amp; <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a> != <b>null</b>)
            {
                <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r19 rd" class="r19 r">pair</span> <b>in</b> <a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>)
                {
                    <span class="c">// if the module in the moduleTable is an assembly module without path, the moduleName is the key.</span>
                    <b>string</b> <span id="r20 rd" class="r20 r">moduleName</span> = <span class="s">&quot;dynamic_code_module_&quot;</span> + <span class="r17 r">suppliedAssembly</span>;
                    <b>if</b> (<span class="r19 r">pair</span>.<span class="i">Value</span>.<span class="i">Path</span> == <b>string</b>.<span class="i">Empty</span>)
                    {
                        <b>if</b> (<span class="r19 r">pair</span>.<span class="i">Key</span>.<span class="i">Equals</span>(<span class="r20 r">moduleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <span class="r18 r">moduleLoaded</span> = <b>true</b>;
                            <b>if</b> (<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>)
                            {
                                <span class="i">WriteObject</span>(<span class="r19 r">pair</span>.<span class="i">Value</span>);
                            }
 
                            <b>break</b>;
                        }
                        <b>else</b>
                        {
                            <b>continue</b>;
                        }
                    }
 
                    <b>if</b> (<span class="r19 r">pair</span>.<span class="i">Value</span>.<span class="i">Path</span>.<span class="i">Equals</span>(<span class="r17 r">suppliedAssembly</span>.<span class="i">Location</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r18 r">moduleLoaded</span> = <b>true</b>;
                        <b>if</b> (<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>)
                        {
                            <span class="i">WriteObject</span>(<span class="r19 r">pair</span>.<span class="i">Value</span>);
                        }
 
                        <b>break</b>;
                    }
                }
            }
 
            <b>if</b> (!<span class="r18 r">moduleLoaded</span>)
            {
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r21 rd" class="r21 r">module</span> = <span class="i">LoadBinaryModule</span>(
                    <span class="i">moduleName</span>: <b>null</b>,
                    <span class="i">fileName</span>: <b>null</b>,
                    <span class="r17 r">suppliedAssembly</span>,
                    <span class="i">moduleBase</span>: <b>null</b>,
                    <span class="i">ss</span>: <b>null</b>,
                    <span class="r16 r">importModuleOptions</span>,
                    <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>,
                    <span class="i">loadTypes</span>: <b>false</b>,
                    <span class="i">loadFormats</span>: <b>false</b>,
                    <b>out bool</b> <span id="r22 rd" class="r22 r">found</span>);
 
                <b>if</b> (<span class="r22 r">found</span> &amp;&amp; <span class="r21 r">module</span> != <b>null</b>)
                {
                    <span class="c">// Add it to all module tables ...</span>
                    <a href="ModuleCmdletBase.cs.html#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r21 r">module</span>);
                    <b>if</b> (<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>)
                    {
                        <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r21 r">module</span>);
                    }
                }
            }
        }
 
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="8669affb94648b16" href="../../R/8669affb94648b16.html" target="n" data-glyph="76,1" class="i method">ImportModule_LocallyViaName_WithTelemetry</a>(<a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r23 rd" class="r23 r">importModuleOptions</span>, <b>string</b> <span id="r24 rd" class="r24 r">name</span>)
        {
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r25 rd" class="r25 r">foundModule</span> = <a href="#609fc01b0c9c1b6a" class="i method">ImportModule_LocallyViaName</a>(<span class="r23 r">importModuleOptions</span>, <span class="r24 r">name</span>);
            <b>if</b> (<span class="r25 r">foundModule</span> != <b>null</b>)
            {
                <a href="#899e70d8c6fb65a8" class="i method">SetModuleBaseForEngineModules</a>(<span class="r25 r">foundModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
 
                <span class="c">// report loading of the module in telemetry</span>
                <span class="c">// avoid double reporting for WinCompat modules that go through CommandDiscovery\AutoloadSpecifiedModule</span>
                <b>if</b> (!<span class="r25 r">foundModule</span>.<a href="PSModuleInfo.cs.html#a7cf8f3895ca3a4a" class="i property">IsWindowsPowerShellCompatModule</a>)
                {
                    <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<a href="../../utils/Telemetry.cs.html#a7904dd2d0082ac3" class="i method">SendTelemetryMetric</a>(<a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#f3f3b72577bf44b5" class="i field">ModuleLoad</a>, <span class="r25 r">foundModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">LEGACYTELEMETRY</span>
<span class="e">                    TelemetryAPI.ReportModuleLoad(foundModule);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                }
            }
 
            <b>return</b> <span class="r25 r">foundModule</span>;
        }
 
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="609fc01b0c9c1b6a" href="../../R/609fc01b0c9c1b6a.html" target="n" data-glyph="76,1" class="i method">ImportModule_LocallyViaName</a>(<a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r26 rd" class="r26 r">importModuleOptions</span>, <b>string</b> <span id="r27 rd" class="r27 r">name</span>)
        {
            <b>try</b>
            {
                <b>bool</b> <span id="r28 rd" class="r28 r">found</span> = <b>false</b>;
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r29 rd" class="r29 r">foundModule</span> = <b>null</b>;
 
                <b>string</b> <span id="r30 rd" class="r30 r">cachedPath</span> = <b>null</b>;
                <b>string</b> <span id="r31 rd" class="r31 r">rootedPath</span> = <b>null</b>;
 
                <span class="c">// See if we can use the cached path for the file. If a version number has been specified, then</span>
                <span class="c">// we won&#39;t look in the cache</span>
                <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#685eb1cc54e970ac" class="i property">MinimumVersion</a> == <b>null</b> &amp;&amp; <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#48978be25763995e" class="i property">MaximumVersion</a> == <b>null</b> &amp;&amp; <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#00317cebd89fcc39" class="i property">RequiredVersion</a> == <b>null</b> &amp;&amp; <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>.<a href="PSModuleInfo.cs.html#42c3363f19a38c16" class="i property">UseAppDomainLevelModuleCache</a> &amp;&amp; !<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#f8d5c3639f6e81cd" class="i property">BaseForce</a>)
                {
                    <span class="c">// See if the name is in the appdomain-level module path name cache...</span>
                    <span class="r30 r">cachedPath</span> = <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>.<a href="PSModuleInfo.cs.html#732dea82247c43fc" class="i method">ResolveUsingAppDomainLevelModuleCache</a>(<span class="r27 r">name</span>);
                }
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r30 r">cachedPath</span>))
                {
                    <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r30 r">cachedPath</span>))
                    {
                        <span class="r31 r">rootedPath</span> = <span class="r30 r">cachedPath</span>;
                    }
                    <b>else</b>
                    {
                        <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>.<a href="PSModuleInfo.cs.html#b8a6b6d87ecc6b04" class="i method">RemoveFromAppDomainLevelCache</a>(<span class="r27 r">name</span>);
                    }
                }
 
                <b>if</b> (<span class="r31 r">rootedPath</span> == <b>null</b>)
                {
                    <span class="c">// Check for full-qualified paths - either absolute or relative</span>
                    <span class="r31 r">rootedPath</span> = <a href="ModuleCmdletBase.cs.html#9910dbba4c162701" class="i method">ResolveRootedFilePath</a>(<span class="r27 r">name</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                }
 
                <b>bool</b> <span id="r32 rd" class="r32 r">alreadyLoaded</span> = <b>false</b>;
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r31 r">rootedPath</span>))
                {
                    <span class="c">// TODO/FIXME: use IsModuleAlreadyLoaded to get consistent behavior</span>
                    <span class="c">// TODO/FIXME: (for example checking ModuleType != Manifest below seems incorrect - cdxml modules also declare their own version)</span>
                    <span class="c">// PSModuleInfo alreadyLoadedModule = null;</span>
                    <span class="c">// TryGetFromModuleTable(rootedPath, out alreadyLoadedModule);</span>
                    <span class="c">// if (!BaseForce &amp;&amp; IsModuleAlreadyLoaded(alreadyLoadedModule))</span>
 
                    <span class="c">// If the module has already been loaded, just emit it and continue...</span>
                    <b>if</b> (!<a href="ModuleCmdletBase.cs.html#f8d5c3639f6e81cd" class="i property">BaseForce</a> &amp;&amp; <a href="ModuleCmdletBase.cs.html#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r31 r">rootedPath</span>, <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r33 rd" class="r33 r">module</span>))
                    {
                        <b>if</b> (<span class="r33 r">module</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> != <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#0f2bfb43459788ea" class="i field">Manifest</a>
                            || <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#21096650e1ba6733" class="i method">IsVersionMatchingConstraints</a>(<span class="r33 r">module</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>, <a href="#00317cebd89fcc39" class="i property">RequiredVersion</a>, <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>, <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>))
                        {
                            <span class="r32 r">alreadyLoaded</span> = <b>true</b>;
                            <a href="ModuleCmdletBase.cs.html#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>, <span class="r33 r">module</span>);
                            <a href="ModuleCmdletBase.cs.html#3ff15922df94f3d9" class="i method">ImportModuleMembers</a>(<span class="r33 r">module</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="r26 r">importModuleOptions</span>);
 
                            <b>if</b> (<a href="ModuleCmdletBase.cs.html#1088653af525f6b7" class="i property">BaseAsCustomObject</a>)
                            {
                                <b>if</b> (<span class="r33 r">module</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> != <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#15536cea81510839" class="i field">Script</a>)
                                {
                                    <b>string</b> <span id="r34 rd" class="r34 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">CantUseAsCustomObjectWithBinaryModule</span>, <span class="r33 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>);
                                    <span class="i">InvalidOperationException</span> <span id="r35 rd" class="r35 r">invalidOp</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r34 r">message</span>);
                                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r36 rd" class="r36 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r35 r">invalidOp</span>, <span class="s">&quot;Modules_CantUseAsCustomObjectWithBinaryModule&quot;</span>,
                                                                     <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#26ba13af79d30a75" class="i field">PermissionDenied</a>, <b>null</b>);
                                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r36 r">er</span>);
                                }
                                <b>else</b>
                                {
                                    <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r33 r">module</span>.<a href="PSModuleInfo.cs.html#58e6c17bb914a346" class="i method">AsCustomObject</a>());
                                }
                            }
                            <b>else</b> <b>if</b> (<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>)
                            {
                                <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r33 r">module</span>);
                            }
 
                            <span class="r28 r">found</span> = <b>true</b>;
                            <span class="r29 r">foundModule</span> = <span class="r33 r">module</span>;
                        }
                    }
 
                    <b>if</b> (!<span class="r32 r">alreadyLoaded</span>)
                    {
                        <span class="c">// If the path names a file, load that file...</span>
                        <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r31 r">rootedPath</span>))
                        {
                            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r37 rd" class="r37 r">moduleToRemove</span>;
                            <b>if</b> (<a href="ModuleCmdletBase.cs.html#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r31 r">rootedPath</span>, <b>out</b> <span class="r37 r">moduleToRemove</span>, <span class="r11 r">toRemove</span>: <b>true</b>))
                            {
                                <a href="ModuleCmdletBase.cs.html#452f85accd76669f" class="i method">RemoveModule</a>(<span class="r37 r">moduleToRemove</span>);
                            }
 
                            <span class="r29 r">foundModule</span> = <span class="i">LoadModule</span>(<span class="r31 r">rootedPath</span>, <b>null</b>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <b>null</b>, <b>ref</b> <span class="r26 r">importModuleOptions</span>,
                                                     <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                                                     <b>out</b> <span class="r28 r">found</span>);
                        }
                        <b>else</b> <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r31 r">rootedPath</span>))
                        {
                            <span class="c">// If the path ends with a directory separator, remove it</span>
                            <b>if</b> (<span class="r31 r">rootedPath</span>.<span class="i">EndsWith</span>(<span class="i">Path</span>.<span class="i">DirectorySeparatorChar</span>))
                            {
                                <span class="r31 r">rootedPath</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r31 r">rootedPath</span>);
                            }
 
                            <span class="c">// Load the latest valid version if it is a multi-version module directory</span>
                            <span class="r29 r">foundModule</span> = <span class="i">LoadUsingMultiVersionModuleBase</span>(<span class="r31 r">rootedPath</span>,
                                                                            <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> |
                                                                            <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> |
                                                                            <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                                                                            <span class="r26 r">importModuleOptions</span>, <b>out</b> <span class="r28 r">found</span>);
 
                            <b>if</b> (!<span class="r28 r">found</span>)
                            {
                                <span class="c">// If the path is a directory, double up the end of the string</span>
                                <span class="c">// then try to load that using extensions...</span>
                                <span class="r31 r">rootedPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r31 r">rootedPath</span>, <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r31 r">rootedPath</span>));
                                <span class="r29 r">foundModule</span> = <span class="i">LoadUsingExtensions</span>(<b>null</b>, <span class="r31 r">rootedPath</span>, <span class="r31 r">rootedPath</span>, <b>null</b>, <b>null</b>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="c">/*SessionState*/</span> <b>null</b>,
                                                                  <span class="r26 r">importModuleOptions</span>,
                                                                  <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                                                                  <b>out</b> <span class="r28 r">found</span>);
                            }
                        }
                    }
                }
                <b>else</b>
                {
                    <span class="c">// Check if module could be a snapin. This was the case for PowerShell version 2 engine modules.</span>
                    <b>if</b> (<a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#7c1caf70ca3d20ee" class="i method">IsEngineModule</a>(<span class="r27 r">name</span>))
                    {
                        <a href="../../singleshell/config/MshSnapinInfo.cs.html#571fb5b01a41502f" class="t t">PSSnapInInfo</a> <span id="r38 rd" class="r38 r">snapin</span> = <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="ModuleCmdletBase.cs.html#a39e43826c9d3348" class="i method">GetEngineSnapIn</a>(<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>, <span class="r27 r">name</span>);
 
                        <span class="c">// Return the command if we found a module</span>
                        <b>if</b> (<span class="r38 r">snapin</span> != <b>null</b>)
                        {
                            <span class="c">// warn that this module already exists as a snapin</span>
                            <b>string</b> <span id="r39 rd" class="r39 r">warningMessage</span> = <b>string</b>.<span class="i">Format</span>(
                                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                <span class="i">Modules</span>.<span class="i">ModuleLoadedAsASnapin</span>,
                                <span class="r38 r">snapin</span>.<a href="../../singleshell/config/MshSnapinInfo.cs.html#ebdb1944f8049e83" class="i property">Name</a>);
                            <a href="../cmdlet.cs.html#dda5a07d1a8a6cba" class="i method">WriteWarning</a>(<span class="r39 r">warningMessage</span>);
                            <span class="r28 r">found</span> = <b>true</b>;
                            <b>return</b> <span class="r29 r">foundModule</span>;
                        }
                    }
 
                    <span class="c">// At this point, the name didn&#39;t resolve to an existing file or directory.</span>
                    <span class="c">// It may still be rooted (relative or absolute). If it is, then we&#39;ll only use</span>
                    <span class="c">// the extension search. If it&#39;s not rooted, use a path-based search.</span>
                    <b>if</b> (<a href="ModuleCmdletBase.cs.html#c551402094596acc" class="i method">IsRooted</a>(<span class="r27 r">name</span>))
                    {
                        <span class="c">// If there is no extension, we&#39;ll have to search using the extensions</span>
                        <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r27 r">name</span>)))
                        {
                            <span class="r29 r">foundModule</span> = <span class="i">LoadModule</span>(<span class="r27 r">name</span>, <b>null</b>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <b>null</b>, <b>ref</b> <span class="r26 r">importModuleOptions</span>,
                                                     <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                                                     <b>out</b> <span class="r28 r">found</span>);
                        }
                        <b>else</b>
                        {
                            <span class="r29 r">foundModule</span> = <span class="i">LoadUsingExtensions</span>(<b>null</b>, <span class="r27 r">name</span>, <span class="r27 r">name</span>, <b>null</b>, <b>null</b>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="c">/*SessionState*/</span> <b>null</b>,
                                                              <span class="r26 r">importModuleOptions</span>,
                                                              <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                                                              <b>out</b> <span class="r28 r">found</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r40 rd" class="r40 r">modulePath</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#0f8fb60019d75e2c" class="i method">GetModulePath</a>(<b>false</b>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
 
                        <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#685eb1cc54e970ac" class="i property">MinimumVersion</a> == <b>null</b> &amp;&amp; <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#00317cebd89fcc39" class="i property">RequiredVersion</a> == <b>null</b> &amp;&amp; <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#48978be25763995e" class="i property">MaximumVersion</a> == <b>null</b>)
                        {
                            <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#172e9b3e1682c172" class="i property">AddToAppDomainLevelCache</a> = <b>true</b>;
                        }
 
                        <span class="r28 r">found</span> = <span class="i">LoadUsingModulePath</span>(<span class="r28 r">found</span>, <span class="r40 r">modulePath</span>, <span class="r27 r">name</span>, <span class="c">/* SessionState*/</span> <b>null</b>,
                                                    <span class="r26 r">importModuleOptions</span>,
                                                    <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                                                    <b>out</b> <span class="r29 r">foundModule</span>);
                    }
                }
 
                <b>if</b> (!<span class="r28 r">found</span>)
                {
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r41 rd" class="r41 r">er</span> = <b>null</b>;
                    <b>string</b> <span id="r42 rd" class="r42 r">message</span> = <b>null</b>;
                    <b>if</b> (<a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> != <b>null</b>)
                    {
                        <span class="r42 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleWithVersionNotFound</span>, <span class="r27 r">name</span>, <a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>);
                    }
                    <b>else</b> <b>if</b> (<a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> != <b>null</b> &amp;&amp; <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> != <b>null</b>)
                    {
                        <span class="r42 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">MinimumVersionAndMaximumVersionNotFound</span>, <span class="r27 r">name</span>, <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>, <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>);
                    }
                    <b>else</b> <b>if</b> (<a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> != <b>null</b>)
                    {
                        <span class="r42 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleWithVersionNotFound</span>, <span class="r27 r">name</span>, <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>);
                    }
                    <b>else</b> <b>if</b> (<a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> != <b>null</b>)
                    {
                        <span class="r42 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">MaximumVersionNotFound</span>, <span class="r27 r">name</span>, <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>);
                    }
 
                    <b>if</b> (<a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> != <b>null</b> || <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> != <b>null</b> || <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> != <b>null</b>)
                    {
                        <span class="i">FileNotFoundException</span> <span id="r43 rd" class="r43 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r42 r">message</span>);
                        <span class="r41 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r43 r">fnf</span>, <span class="s">&quot;Modules_ModuleWithVersionNotFound&quot;</span>,
                                             <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r27 r">name</span>);
                    }
                    <b>else</b>
                    {
                        <span class="r42 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleNotFound</span>, <span class="r27 r">name</span>);
                        <span class="i">FileNotFoundException</span> <span id="r44 rd" class="r44 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r42 r">message</span>);
                        <span class="r41 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r44 r">fnf</span>, <span class="s">&quot;Modules_ModuleNotFound&quot;</span>,
                                             <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r27 r">name</span>);
                    }
 
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r41 r">er</span>);
                }
 
                <b>return</b> <span class="r29 r">foundModule</span>;
            }
            <b>catch</b> (<a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a> <span id="r45 rd" class="r45 r">e</span>)
            {
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r46 rd" class="r46 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r45 r">e</span>.<a href="../../utils/MshInvalidOperationException.cs.html#cf42d4181b27e3c1" class="i property">ErrorRecord</a>, <span class="r45 r">e</span>);
                <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r46 r">er</span>);
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="f5bc63af78a7fd5f" href="../../R/f5bc63af78a7fd5f.html" target="n" data-glyph="76,1" class="i method">ImportModule_LocallyViaFQName</a>(<a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r47 rd" class="r47 r">importModuleOptions</span>, <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r48 rd" class="r48 r">modulespec</span>)
        {
            <a href="#00317cebd89fcc39" class="i property">RequiredVersion</a> = <span class="r48 r">modulespec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>;
            <a href="#685eb1cc54e970ac" class="i property">MinimumVersion</a> = <span class="r48 r">modulespec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>;
            <a href="#48978be25763995e" class="i property">MaximumVersion</a> = <span class="r48 r">modulespec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>;
            <a href="ModuleCmdletBase.cs.html#d3b88fd228891169" class="i property">BaseGuid</a> = <span class="r48 r">modulespec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>;
 
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r49 rd" class="r49 r">foundModule</span> = <a href="#609fc01b0c9c1b6a" class="i method">ImportModule_LocallyViaName</a>(<span class="r47 r">importModuleOptions</span>, <span class="r48 r">modulespec</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
 
            <b>if</b> (<span class="r49 r">foundModule</span> != <b>null</b>)
            {
                <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<a href="../../utils/Telemetry.cs.html#a7904dd2d0082ac3" class="i method">SendTelemetryMetric</a>(<a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#f3f3b72577bf44b5" class="i field">ModuleLoad</a>, <span class="r49 r">foundModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
                <a href="#899e70d8c6fb65a8" class="i method">SetModuleBaseForEngineModules</a>(<span class="r49 r">foundModule</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
            }
 
            <b>return</b> <span class="r49 r">foundModule</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Local import
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Remote import
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> PSSession parameterset
 
        <b>private</b> <span class="i">IList</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="49b9b016036b5f89" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ImportModule_RemotelyViaPsrpSession</a>(
            <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r50 rd" class="r50 r">importModuleOptions</span>,
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r51 rd" class="r51 r">moduleNames</span>,
            <span class="i">IEnumerable</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r52 rd" class="r52 r">fullyQualifiedNames</span>,
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r53 rd" class="r53 r">psSession</span>,
            <b>bool</b> <span id="r54 rd" class="r54 r">usingWinCompat</span> = <b>false</b>)
        {
            <b>var</b> <span id="r55 rd" class="r55 r">remotelyImportedModules</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
            <b>if</b> (<span class="r51 r">moduleNames</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>string</b> <span id="r56 rd" class="r56 r">moduleName</span> <b>in</b> <span class="r51 r">moduleNames</span>)
                {
                    <b>var</b> <span id="r57 rd" class="r57 r">tmp</span> = <a href="#3499576fdc327536" class="i method">ImportModule_RemotelyViaPsrpSession</a>(<span class="r50 r">importModuleOptions</span>, <span class="r56 r">moduleName</span>, <b>null</b>, <span class="r53 r">psSession</span>);
                    <span class="r55 r">remotelyImportedModules</span>.<span class="i">AddRange</span>(<span class="r57 r">tmp</span>);
                }
            }
 
            <b>if</b> (<span class="r52 r">fullyQualifiedNames</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r58 rd" class="r58 r">fullyQualifiedName</span> <b>in</b> <span class="r52 r">fullyQualifiedNames</span>)
                {
                    <b>var</b> <span id="r59 rd" class="r59 r">tmp</span> = <span class="i">ImportModule_RemotelyViaPsrpSession</span>(<span class="r50 r">importModuleOptions</span>, <b>null</b>, <span class="r58 r">fullyQualifiedName</span>, <span class="r53 r">psSession</span>);
                    <span class="r55 r">remotelyImportedModules</span>.<span class="i">AddRange</span>(<span class="r59 r">tmp</span>);
                }
            }
 
            <span class="c">// Send telemetry on the imported modules</span>
            <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r60 rd" class="r60 r">moduleInfo</span> <b>in</b> <span class="r55 r">remotelyImportedModules</span>)
            {
                <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<a href="../../utils/Telemetry.cs.html#a7904dd2d0082ac3" class="i method">SendTelemetryMetric</a>(<span class="r54 r">usingWinCompat</span> ? <a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#80e278d1d50e7321" class="i field">WinCompatModuleLoad</a> : <a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#f3f3b72577bf44b5" class="i field">ModuleLoad</a>, <span class="r60 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
            }
 
            <b>return</b> <span class="r55 r">remotelyImportedModules</span>;
        }
 
        <b>private</b> <span class="i">IList</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="3499576fdc327536" href="../../R/3499576fdc327536.html" target="n" data-glyph="76,1" class="i method">ImportModule_RemotelyViaPsrpSession</a>(
            <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r61 rd" class="r61 r">importModuleOptions</span>,
            <b>string</b> <span id="r62 rd" class="r62 r">moduleName</span>,
            <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r63 rd" class="r63 r">fullyQualifiedName</span>,
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r64 rd" class="r64 r">psSession</span>)
        {
            <span class="c">//</span>
            <span class="c">// import the module in the remote session first</span>
            <span class="c">//</span>
            <span class="i">List</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r65 rd" class="r65 r">remotelyImportedModules</span>;
            <b>using</b> (<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r66 rd" class="r66 r">powerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#40345bc4625ff918" class="i method">Create</a>())
            {
                <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#ccf57242c9d46642" class="i property">Runspace</a> = <span class="r64 r">psSession</span>.<a href="../remoting/client/remoterunspaceinfo.cs.html#9c20236793fb308a" class="i property">Runspace</a>;
                <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Import-Module&quot;</span>);
                <span class="r66 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;DisableNameChecking&quot;</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#6ea9ca8c58af00e2" class="i property">DisableNameChecking</a>);
                <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;PassThru&quot;</span>, <b>true</b>);
 
                <b>if</b> (<span class="r63 r">fullyQualifiedName</span> != <b>null</b>)
                {
                    <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;FullyQualifiedName&quot;</span>, <span class="r63 r">fullyQualifiedName</span>);
                }
                <b>else</b>
                {
                    <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Name&quot;</span>, <span class="r62 r">moduleName</span>);
 
                    <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#685eb1cc54e970ac" class="i property">MinimumVersion</a> != <b>null</b>)
                    {
                        <span class="r66 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;Version&quot;</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#685eb1cc54e970ac" class="i property">MinimumVersion</a>);
                    }
 
                    <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#00317cebd89fcc39" class="i property">RequiredVersion</a> != <b>null</b>)
                    {
                        <span class="r66 r">powerShell</span>.<span class="i">AddParameter</span>(<span class="s">&quot;RequiredVersion&quot;</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#00317cebd89fcc39" class="i property">RequiredVersion</a>);
                    }
 
                    <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#48978be25763995e" class="i property">MaximumVersion</a> != <b>null</b>)
                    {
                        <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;MaximumVersion&quot;</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#48978be25763995e" class="i property">MaximumVersion</a>);
                    }
                }
 
                <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#bc1722a3e6d61bbd" class="i property">ArgumentList</a> != <b>null</b>)
                {
                    <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;ArgumentList&quot;</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#bc1722a3e6d61bbd" class="i property">ArgumentList</a>);
                }
 
                <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#f8d5c3639f6e81cd" class="i property">BaseForce</a>)
                {
                    <span class="r66 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Force&quot;</span>, <b>true</b>);
                }
 
                <b>string</b> <span id="r67 rd" class="r67 r">errorMessageTemplate</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">Modules</span>.<span class="i">RemoteDiscoveryRemotePsrpCommandFailed</span>,
                    <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;Import-Module -Name &#39;{0}&#39;&quot;</span>, <span class="r62 r">moduleName</span>));
                <span class="r65 r">remotelyImportedModules</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f394b222fb6b3761" class="i method">InvokePowerShell</a>(
                    <span class="r66 r">powerShell</span>,
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>,
                    <span class="r67 r">errorMessageTemplate</span>,
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#e6d3aa37e7485e0e" class="i property">CancellationToken</a>).<span class="i">ToList</span>();
            }
 
            <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r68 rd" class="r68 r">result</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
            <b>foreach</b> (<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r69 rd" class="r69 r">remotelyImportedModule</span> <b>in</b> <span class="r65 r">remotelyImportedModules</span>)
            {
                <a href="../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r70 rd" class="r70 r">nameProperty</span> = <span class="r69 r">remotelyImportedModule</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;Name&quot;</span>];
                <b>if</b> (<span class="r70 r">nameProperty</span> != <b>null</b>)
                {
                    <b>string</b> <span id="r71 rd" class="r71 r">remoteModuleName</span> = (<b>string</b>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                        <span class="r70 r">nameProperty</span>.<a href="../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>,
                        <b>typeof</b>(<b>string</b>),
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
 
                    <a href="../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r72 rd" class="r72 r">helpInfoProperty</span> = <span class="r69 r">remotelyImportedModule</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;HelpInfoUri&quot;</span>];
                    <b>string</b> <span id="r73 rd" class="r73 r">remoteHelpInfoUri</span> = <b>null</b>;
                    <b>if</b> (<span class="r72 r">helpInfoProperty</span> != <b>null</b>)
                    {
                        <span class="r73 r">remoteHelpInfoUri</span> = (<b>string</b>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(
                            <span class="r72 r">helpInfoProperty</span>.<a href="../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>,
                            <b>typeof</b>(<b>string</b>),
                            <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                    }
 
                    <a href="../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r74 rd" class="r74 r">guidProperty</span> = <span class="r69 r">remotelyImportedModule</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;Guid&quot;</span>];
                    <span class="i">Guid</span> <span id="r75 rd" class="r75 r">remoteModuleGuid</span> = <span class="i">Guid</span>.<span class="i">Empty</span>;
                    <b>if</b> (<span class="r74 r">guidProperty</span> != <b>null</b>)
                    {
                        <a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r74 r">guidProperty</span>.<a href="../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>, <b>out</b> <span class="r75 r">remoteModuleGuid</span>);
                    }
 
                    <a href="../MshMemberInfo.cs.html#13ab3796654e613c" class="t t">PSPropertyInfo</a> <span id="r76 rd" class="r76 r">versionProperty</span> = <span class="r69 r">remotelyImportedModule</span>.<a href="../MshObject.cs.html#59e9cd1ad57ccd34" class="i property">Properties</a><a href="../MshMemberInfo.cs.html#f603b32aa49d3ffa">[</a><span class="s">&quot;Version&quot;</span>];
                    <span class="i">Version</span> <span id="r77 rd" class="r77 r">remoteModuleVersion</span> = <b>null</b>;
                    <b>if</b> (<span class="r76 r">versionProperty</span> != <b>null</b>)
                    {
                        <span class="i">Version</span> <span id="r78 rd" class="r78 r">tmp</span>;
                        <b>if</b> (<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>&lt;<span class="i">Version</span>&gt;(<span class="r76 r">versionProperty</span>.<a href="../MshMemberInfo.cs.html#cd3a9989baedf3dd" class="i property">Value</a>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <b>out</b> <span class="r78 r">tmp</span>))
                        {
                            <span class="r77 r">remoteModuleVersion</span> = <span class="r78 r">tmp</span>;
                        }
                    }
 
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r79 rd" class="r79 r">moduleInfo</span> = <a href="#8e220a24386b543e" class="i method">ImportModule_RemotelyViaPsrpSession_SinglePreimportedModule</a>(
                        <span class="r61 r">importModuleOptions</span>,
                        <span class="r71 r">remoteModuleName</span>,
                        <span class="r77 r">remoteModuleVersion</span>,
                        <span class="r64 r">psSession</span>);
 
                    <span class="c">// Set the HelpInfoUri and Guid as necessary, so that Save-Help can work with this module object</span>
                    <span class="c">// to retrieve help files from the remote site.</span>
                    <b>if</b> (<span class="r79 r">moduleInfo</span> != <b>null</b>)
                    {
                        <span class="c">// set the HelpInfoUri if it&#39;s needed</span>
                        <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r79 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#31f7e13110eb6db0" class="i property">HelpInfoUri</a>) &amp;&amp; !<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r73 r">remoteHelpInfoUri</span>))
                        {
                            <span class="r79 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#c345165f675110e2" class="i method">SetHelpInfoUri</a>(<span class="r73 r">remoteHelpInfoUri</span>);
                        }
 
                        <span class="c">// set the Guid if it&#39;s needed</span>
                        <b>if</b> (<span class="r75 r">remoteModuleGuid</span> != <span class="i">Guid</span>.<span class="i">Empty</span>)
                        {
                            <span class="r79 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#4b6e2a1b9b5b92c2" class="i method">SetGuid</a>(<span class="r75 r">remoteModuleGuid</span>);
                        }
 
                        <span class="r68 r">result</span>.<span class="i">Add</span>(<span class="r79 r">moduleInfo</span>);
                    }
                }
            }
 
            <b>return</b> <span class="r68 r">result</span>;
        }
 
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="8e220a24386b543e" href="../../R/8e220a24386b543e.html" target="n" data-glyph="76,1" class="i method">ImportModule_RemotelyViaPsrpSession_SinglePreimportedModule</a>(
            <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r80 rd" class="r80 r">importModuleOptions</span>,
            <b>string</b> <span id="r81 rd" class="r81 r">remoteModuleName</span>,
            <span class="i">Version</span> <span id="r82 rd" class="r82 r">remoteModuleVersion</span>,
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r83 rd" class="r83 r">psSession</span>)
        {
            <b>string</b> <span id="r84 rd" class="r84 r">temporaryModulePath</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#6d70ded5da8a377d" class="i method">GetModulePath</a>(
                <span class="r81 r">remoteModuleName</span>,
                <span class="r82 r">remoteModuleVersion</span>,
                <span class="r83 r">psSession</span>.<a href="../remoting/client/remoterunspaceinfo.cs.html#4e8388b3861bf08b" class="i property">ComputerName</a>,
                <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>);
            <b>string</b> <span id="r85 rd" class="r85 r">wildcardEscapedPath</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#ec1c8a48d29314f3" class="i method">Escape</a>(<span class="r84 r">temporaryModulePath</span>);
            <b>try</b>
            {
                <span class="c">//</span>
                <span class="c">// avoid importing a module twice</span>
                <span class="c">//</span>
                <b>string</b> <span id="r86 rd" class="r86 r">localPsm1File</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r84 r">temporaryModulePath</span>, <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r84 r">temporaryModulePath</span>) + <span class="s">&quot;.psm1&quot;</span>);
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r87 rd" class="r87 r">alreadyImportedModule</span> = <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#ff219b633fc5b22f" class="i method">IsModuleImportUnnecessaryBecauseModuleIsAlreadyLoaded</a>(
                    <span class="r86 r">localPsm1File</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="r80 r">importModuleOptions</span>);
                <b>if</b> (<span class="r87 r">alreadyImportedModule</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r87 r">alreadyImportedModule</span>;
                }
 
                <span class="c">//</span>
                <span class="c">// create proxy module in a temporary folder</span>
                <span class="c">//</span>
                <b>using</b> (<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="k">var</a> <span id="r88 rd" class="r88 r">powerShell</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a>.<a href="../hostifaces/PowerShell.cs.html#1c6a51d3c837bb4d" class="i method">Create</a>(<a href="../hostifaces/PowerShell.cs.html#c3c0f0e5e0b337ff" class="t t">RunspaceMode</a>.<a href="../hostifaces/PowerShell.cs.html#75d224de5df87e75" class="i field">CurrentRunspace</a>))
                {
                    <span class="r88 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#9cc79c297f6cced9" class="i method">AddCommand</a>(<span class="s">&quot;Export-PSSession&quot;</span>);
                    <span class="r88 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;OutputModule&quot;</span>, <span class="r85 r">wildcardEscapedPath</span>);
                    <b>if</b> (!<span class="r80 r">importModuleOptions</span>.<a href="ModuleCmdletBase.cs.html#e8f222097dc3f4dc" class="i field">NoClobberExportPSSession</a>)
                    {
                        <span class="r88 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;AllowClobber&quot;</span>, <b>true</b>);
                    }
                    <span class="r88 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Module&quot;</span>, <span class="r81 r">remoteModuleName</span>); <span class="c">// remoteModulePath is currently unsupported by Get-Command and implicit remoting</span>
                    <span class="r88 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Force&quot;</span>, <b>true</b>);
                    <span class="r88 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;FormatTypeName&quot;</span>, <span class="s">&quot;*&quot;</span>);
                    <span class="r88 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#40674f99a3618f4b" class="i method">AddParameter</a>(<span class="s">&quot;Session&quot;</span>, <span class="r83 r">psSession</span>);
 
                    <b>string</b> <span id="r89 rd" class="r89 r">errorMessageTemplate</span> = <b>string</b>.<span class="i">Format</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="i">Modules</span>.<span class="i">RemoteDiscoveryFailedToGenerateProxyForRemoteModule</span>,
                        <span class="r81 r">remoteModuleName</span>);
                    <b>if</b> (!<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f394b222fb6b3761" class="i method">InvokePowerShell</a>(<span class="r88 r">powerShell</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>, <span class="r89 r">errorMessageTemplate</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#e6d3aa37e7485e0e" class="i property">CancellationToken</a>).<span class="i">Any</span>())
                    {
                        <b>return</b> <b>null</b>;
                    }
                }
 
                <span class="c">//</span>
                <span class="c">// rename the psd1 file</span>
                <span class="c">//</span>
                <b>string</b> <span id="r90 rd" class="r90 r">localPsd1File</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r84 r">temporaryModulePath</span>, <span class="r81 r">remoteModuleName</span> + <span class="s">&quot;.psd1&quot;</span>);
                <b>if</b> (<span class="i">File</span>.<span class="i">Exists</span>(<span class="r90 r">localPsd1File</span>))
                {
                    <span class="i">File</span>.<span class="i">Delete</span>(<span class="r90 r">localPsd1File</span>);
                }
 
                <span class="i">File</span>.<span class="i">Move</span>(
                    <span class="i">sourceFileName</span>: <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r84 r">temporaryModulePath</span>, <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r84 r">temporaryModulePath</span>) + <span class="s">&quot;.psd1&quot;</span>),
                    <span class="i">destFileName</span>: <span class="r90 r">localPsd1File</span>);
                <b>string</b> <span id="r91 rd" class="r91 r">wildcardEscapedPsd1Path</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#ec1c8a48d29314f3" class="i method">Escape</a>(<span class="r90 r">localPsd1File</span>);
 
                <span class="c">//</span>
                <span class="c">// import the proxy module just as any other local module</span>
                <span class="c">//</span>
                <b>object</b>[] <span id="r92 rd" class="r92 r">oldArgumentList</span> = <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#bc1722a3e6d61bbd" class="i property">ArgumentList</a>;
                <span class="i">Version</span> <span id="r93 rd" class="r93 r">originalBaseMinimumVersion</span> = <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>;
                <span class="i">Version</span> <span id="r94 rd" class="r94 r">originalBaseMaximumVersion</span> = <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>;
                <span class="i">Version</span> <span id="r95 rd" class="r95 r">originalBaseRequiredVersion</span> = <a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>;
                <b>try</b>
                {
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#bc1722a3e6d61bbd" class="i property">ArgumentList</a> = <b>new</b> <b>object</b>[] { <span class="r83 r">psSession</span> };
 
                    <span class="c">// The correct module version has already been imported from the remote session and created locally.</span>
                    <span class="c">// The locally created module always has a version of 1.0 regardless of the actual module version</span>
                    <span class="c">// imported from the remote session, and version checking is no longer needed and will not work while</span>
                    <span class="c">// importing this created local module.</span>
                    <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> = <b>null</b>;
                    <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <b>null</b>;
                    <a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> = <b>null</b>;
                    <a href="#609fc01b0c9c1b6a" class="i method">ImportModule_LocallyViaName</a>(<span class="r80 r">importModuleOptions</span>, <span class="r91 r">wildcardEscapedPsd1Path</span>);
                }
                <b>finally</b>
                {
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#bc1722a3e6d61bbd" class="i property">ArgumentList</a> = <span class="r92 r">oldArgumentList</span>;
                    <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> = <span class="r93 r">originalBaseMinimumVersion</span>;
                    <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> = <span class="r94 r">originalBaseMaximumVersion</span>;
                    <a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a> = <span class="r95 r">originalBaseRequiredVersion</span>;
                }
 
                <span class="c">//</span>
                <span class="c">// make sure the temporary folder gets removed when the module is removed</span>
                <span class="c">//</span>
                <b>string</b> <span id="r96 rd" class="r96 r">psm1Path</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r84 r">temporaryModulePath</span>, <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r84 r">temporaryModulePath</span>) + <span class="s">&quot;.psm1&quot;</span>);
                <b>if</b> (!<a href="ModuleCmdletBase.cs.html#4b44b9c95e0d831e" class="i method">TryGetFromModuleTable</a>(<span class="r96 r">psm1Path</span>, <b>out</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r97 rd" class="r97 r">moduleInfo</span>, <span class="r11 r">toRemove</span>: <b>true</b>))
                {
                    <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r84 r">temporaryModulePath</span>))
                    {
                        <span class="i">Directory</span>.<span class="i">Delete</span>(<span class="r84 r">temporaryModulePath</span>, <span class="i">recursive</span>: <b>true</b>);
                    }
 
                    <b>return</b> <b>null</b>;
                }
 
                <b>const string</b> <span id="r98 rd" class="r98 r">onRemoveScriptBody</span> = <span class="s">@&quot;
                    Microsoft.PowerShell.Management\Remove-Item `
                        -LiteralPath $temporaryModulePath `
                        -Force `
                        -Recurse `
                        -ErrorAction SilentlyContinue
 
                    if ($null -ne $previousOnRemoveScript)
                    {
                        &amp; $previousOnRemoveScript $args
                    }
                    &quot;</span>;
                <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r99 rd" class="r99 r">onRemoveScriptBlock</span> = <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#7b897dde7067af78" class="i property">Engine</a>.<a href="../AutomationEngine.cs.html#7f45ac65575c22af" class="i method">ParseScriptBlock</a>(<span class="r98 r">onRemoveScriptBody</span>, <b>false</b>);
                <span class="r99 r">onRemoveScriptBlock</span> = <span class="r99 r">onRemoveScriptBlock</span>.<a href="../lang/scriptblock.cs.html#6f3bdb602b7bca08" class="i method">GetNewClosure</a>(); <span class="c">// create a separate scope for variables set below</span>
                <span class="r99 r">onRemoveScriptBlock</span>.<a href="../lang/scriptblock.cs.html#da67b7d69aadb962" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#0198da5eba13cb75" class="i property">PSVariable</a>.<a href="../VariableInterfaces.cs.html#f2dafcc3a1a096b4" class="i method">Set</a>(<span class="s">&quot;temporaryModulePath&quot;</span>, <span class="r84 r">temporaryModulePath</span>);
                <span class="r99 r">onRemoveScriptBlock</span>.<a href="../lang/scriptblock.cs.html#da67b7d69aadb962" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#0198da5eba13cb75" class="i property">PSVariable</a>.<a href="../VariableInterfaces.cs.html#f2dafcc3a1a096b4" class="i method">Set</a>(<span class="s">&quot;previousOnRemoveScript&quot;</span>, <span class="r97 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#a91c0dfe9b197014" class="i property">OnRemove</a>);
                <span class="r97 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#a91c0dfe9b197014" class="i property">OnRemove</a> = <span class="r99 r">onRemoveScriptBlock</span>;
 
                <b>return</b> <span class="r97 r">moduleInfo</span>;
            }
            <b>catch</b>
            {
                <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r84 r">temporaryModulePath</span>))
                {
                    <span class="i">Directory</span>.<span class="i">Delete</span>(<span class="r84 r">temporaryModulePath</span>, <span class="i">recursive</span>: <b>true</b>);
                }
 
                <b>throw</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> PSSession parameterset
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> CimSession parameterset
 
        <b>private static bool</b> <a id="11692198d8d637b4" href="../../R/11692198d8d637b4.html" target="n" data-glyph="76,1" class="i method">IsNonEmptyManifestField</a>(<span class="i">Hashtable</span> <span id="r100 rd" class="r100 r">manifestData</span>, <b>string</b> <span id="r101 rd" class="r101 r">key</span>)
        {
            <b>object</b> <span id="r102 rd" class="r102 r">value</span> = <span class="r100 r">manifestData</span>[<span class="r101 r">key</span>];
            <b>if</b> (<span class="r102 r">value</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>object</b>[] <span id="r103 rd" class="r103 r">array</span>;
            <b>if</b> (<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r102 r">value</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <b>out</b> <span class="r103 r">array</span>))
            {
                <b>return</b> <span class="r103 r">array</span>.<span class="i">Length</span> != 0;
            }
            <b>else</b>
            {
                <b>return</b> <b>true</b>;
            }
        }
 
        <b>private bool</b> <a id="0c605fd7aa9686fb" href="../../R/0c605fd7aa9686fb.html" target="n" data-glyph="76,1" class="i method">IsMixedModePsCimModule</a>(<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#b5270f565e4adb8f" class="t t">CimModule</a> <span id="r104 rd" class="r104 r">cimModule</span>)
        {
            <b>string</b> <span id="r105 rd" class="r105 r">temporaryModuleManifestPath</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<span class="i">GetModulePath</span>(<span class="r104 r">cimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a>, <b>null</b>, <b>string</b>.<span class="i">Empty</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>);
            <b>bool</b> <span id="r106 rd" class="r106 r">containedErrors</span> = <b>false</b>;
            <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r107 rd" class="r107 r">mainManifestFile</span> = <span class="r104 r">cimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#ce5161a2a2d89c39" class="i property">MainManifest</a>;
            <b>if</b> (<span class="r107 r">mainManifestFile</span> == <b>null</b>)
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="i">Hashtable</span> <span id="r108 rd" class="r108 r">manifestData</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#2108befa6ee79738" class="i method">ConvertCimModuleFileToManifestHashtable</a>(
                    <span class="r107 r">mainManifestFile</span>,
                    <span class="r105 r">temporaryModuleManifestPath</span>,
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>,
                    <b>ref</b> <span class="r106 r">containedErrors</span>);
 
            <b>if</b> (<span class="r106 r">containedErrors</span> || <span class="r108 r">manifestData</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>if</b> (<a href="#11692198d8d637b4" class="i method">IsNonEmptyManifestField</a>(<span class="r108 r">manifestData</span>, <span class="s">&quot;ScriptsToProcess&quot;</span>) ||
                <a href="#11692198d8d637b4" class="i method">IsNonEmptyManifestField</a>(<span class="r108 r">manifestData</span>, <span class="s">&quot;RequiredAssemblies&quot;</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>int</b> <span id="r109 rd" class="r109 r">numberOfSubmodules</span> = 0;
 
            <b>string</b>[] <span id="r110 rd" class="r110 r">nestedModules</span> = <b>null</b>;
            <b>if</b> (<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r108 r">manifestData</span>[<span class="s">&quot;NestedModules&quot;</span>], <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <b>out</b> <span class="r110 r">nestedModules</span>))
            {
                <b>if</b> (<span class="r110 r">nestedModules</span> != <b>null</b>)
                {
                    <span class="r109 r">numberOfSubmodules</span> += <span class="r110 r">nestedModules</span>.<span class="i">Length</span>;
                }
            }
 
            <b>object</b> <span id="r111 rd" class="r111 r">rootModuleValue</span> = <span class="r108 r">manifestData</span>[<span class="s">&quot;RootModule&quot;</span>];
            <b>if</b> (<span class="r111 r">rootModuleValue</span> != <b>null</b>)
            {
                <b>string</b> <span id="r112 rd" class="r112 r">rootModule</span>;
                <b>if</b> (<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r111 r">rootModuleValue</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <b>out</b> <span class="r112 r">rootModule</span>))
                {
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r112 r">rootModule</span>))
                    {
                        <span class="r109 r">numberOfSubmodules</span> += 1;
                    }
                }
            }
            <b>else</b>
            {
                <b>object</b> <span id="r113 rd" class="r113 r">moduleToProcessValue</span> = <span class="r108 r">manifestData</span>[<span class="s">&quot;ModuleToProcess&quot;</span>];
                <b>string</b> <span id="r114 rd" class="r114 r">moduleToProcess</span>;
                <b>if</b> (<span class="r113 r">moduleToProcessValue</span> != <b>null</b> &amp;&amp; <a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r113 r">moduleToProcessValue</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <b>out</b> <span class="r114 r">moduleToProcess</span>))
                {
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r114 r">moduleToProcess</span>))
                    {
                        <span class="r109 r">numberOfSubmodules</span> += 1;
                    }
                }
            }
 
            <b>int</b> <span id="r115 rd" class="r115 r">numberOfCmdletizationFiles</span> = 0;
            <b>foreach</b> (<b>var</b> <span id="r116 rd" class="r116 r">moduleFile</span> <b>in</b> <span class="r104 r">cimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#ae0083ee9392c666" class="i property">ModuleFiles</a>)
            {
                <b>if</b> (<span class="r116 r">moduleFile</span>.<span class="i">FileCode</span> == <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#8c583ae4f2412782" class="i field">CmdletizationV1</a>)
                    <span class="r115 r">numberOfCmdletizationFiles</span>++;
            }
 
            <b>bool</b> <span id="r117 rd" class="r117 r">isMixedModePsCimModule</span> = <span class="r109 r">numberOfSubmodules</span> &gt; <span class="r115 r">numberOfCmdletizationFiles</span>;
            <b>return</b> <span class="r117 r">isMixedModePsCimModule</span>;
        }
 
        <b>private void</b> <a id="0f45fbcf8d98dbe6" href="../../R/0f45fbcf8d98dbe6.html" target="n" data-glyph="76,1" class="i method">ImportModule_RemotelyViaCimSession</a>(
            <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r118 rd" class="r118 r">importModuleOptions</span>,
            <b>string</b>[] <span id="r119 rd" class="r119 r">moduleNames</span>,
            <span class="i">CimSession</span> <span id="r120 rd" class="r120 r">cimSession</span>,
            <span class="i">Uri</span> <span id="r121 rd" class="r121 r">resourceUri</span>,
            <b>string</b> <span id="r122 rd" class="r122 r">cimNamespace</span>)
        {
            <span class="c">//</span>
            <span class="c">// find all remote PS-CIM modules</span>
            <span class="c">//</span>
            <span class="i">IEnumerable</span>&lt;<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#b5270f565e4adb8f" class="t t">CimModule</a>&gt; <span id="r123 rd" class="r123 r">remoteModules</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<span class="i">GetCimModules</span>(
                <span class="r120 r">cimSession</span>,
                <span class="r121 r">resourceUri</span>,
                <span class="r122 r">cimNamespace</span>,
                <span class="r119 r">moduleNames</span>,
                <b>false</b> <span class="c">/* onlyManifests */</span>,
                <a href="#4a6e75cbbfb65b34" class="k">this</a>,
                <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#e6d3aa37e7485e0e" class="i property">CancellationToken</a>).<span class="i">ToList</span>();
 
            <span class="i">IEnumerable</span>&lt;<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#b5270f565e4adb8f" class="t t">CimModule</a>&gt; <span id="r124 rd" class="r124 r">remotePsCimModules</span> = <span class="r123 r">remoteModules</span>.<span class="i">Where</span>(<b>static</b> <span id="r125 rd" class="r125 r">cimModule</span> =&gt; <span class="r125 r">cimModule</span>.<span class="i">IsPsCimModule</span>);
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r126 rd" class="r126 r">remotePsrpModuleNames</span> = <span class="r123 r">remoteModules</span>.<span class="i">Where</span>(<b>static</b> <span id="r127 rd" class="r127 r">cimModule</span> =&gt; !<span class="r127 r">cimModule</span>.<span class="i">IsPsCimModule</span>).<span class="i">Select</span>(<b>static</b> <span id="r128 rd" class="r128 r">cimModule</span> =&gt; <span class="r128 r">cimModule</span>.<span class="i">ModuleName</span>);
            <b>foreach</b> (<b>string</b> <span id="r129 rd" class="r129 r">psrpModuleName</span> <b>in</b> <span class="r126 r">remotePsrpModuleNames</span>)
            {
                <b>string</b> <span id="r130 rd" class="r130 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">Modules</span>.<span class="i">PsModuleOverCimSessionError</span>,
                    <span class="r129 r">psrpModuleName</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r131 rd" class="r131 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                    <b>new</b> <span class="i">ArgumentException</span>(<span class="r130 r">errorMessage</span>),
                    <span class="s">&quot;PsModuleOverCimSessionError&quot;</span>,
                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#846d2b572f2c4820" class="i field">InvalidArgument</a>,
                    <span class="r129 r">psrpModuleName</span>);
                <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r131 r">errorRecord</span>);
            }
 
            <span class="c">//</span>
            <span class="c">// report an error if some modules were not found</span>
            <span class="c">//</span>
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r132 rd" class="r132 r">allFoundModuleNames</span> = <span class="r123 r">remoteModules</span>.<span class="i">Select</span>(<b>static</b> <span id="r133 rd" class="r133 r">cimModule</span> =&gt; <span class="r133 r">cimModule</span>.<span class="i">ModuleName</span>).<span class="i">ToList</span>();
            <b>foreach</b> (<b>string</b> <span id="r134 rd" class="r134 r">requestedModuleName</span> <b>in</b> <span class="r119 r">moduleNames</span>)
            {
                <a href="../regex.cs.html#d450e739ff28e660" class="k">var</a> <span id="r135 rd" class="r135 r">wildcardPattern</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r134 r">requestedModuleName</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a>);
                <b>bool</b> <span id="r136 rd" class="r136 r">requestedModuleWasFound</span> = <span class="r132 r">allFoundModuleNames</span>.<span class="i">Any</span>(<span id="r137 rd" class="r137 r">foundModuleName</span> =&gt; <span class="r135 r">wildcardPattern</span>.<span class="i">IsMatch</span>(<span class="r137 r">foundModuleName</span>));
                <b>if</b> (!<span class="r136 r">requestedModuleWasFound</span>)
                {
                    <b>string</b> <span id="r138 rd" class="r138 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleNotFound</span>, <span class="r134 r">requestedModuleName</span>);
                    <span class="i">FileNotFoundException</span> <span id="r139 rd" class="r139 r">fnf</span> = <b>new</b> <span class="i">FileNotFoundException</span>(<span class="r138 r">message</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r140 rd" class="r140 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r139 r">fnf</span>, <span class="s">&quot;Modules_ModuleNotFound&quot;</span>,
                        <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r134 r">requestedModuleName</span>);
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r140 r">er</span>);
                }
            }
 
            <span class="c">//</span>
            <span class="c">// import the PS-CIM modules</span>
            <span class="c">//</span>
            <b>foreach</b> (<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#b5270f565e4adb8f" class="t t">CimModule</a> <span id="r141 rd" class="r141 r">remoteCimModule</span> <b>in</b> <span class="r124 r">remotePsCimModules</span>)
            {
                <a href="#c429c293c6c55686" class="i method">ImportModule_RemotelyViaCimModuleData</a>(<span class="r118 r">importModuleOptions</span>, <span class="r141 r">remoteCimModule</span>, <span class="r120 r">cimSession</span>);
                <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<a href="../../utils/Telemetry.cs.html#a7904dd2d0082ac3" class="i method">SendTelemetryMetric</a>(<a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#f3f3b72577bf44b5" class="i field">ModuleLoad</a>, <span class="r141 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a>);
            }
        }
 
        <b>private bool</b> <a id="b16963c626a768e2" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsPs1xmlFileHelper_IsPresentInEntries</a>(<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r142 rd" class="r142 r">cimModuleFile</span>, <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r143 rd" class="r143 r">manifestEntries</span>)
        {
            <b>if</b> (<span class="r143 r">manifestEntries</span>.<span class="i">Any</span>(<span id="r144 rd" class="r144 r">s</span> =&gt; <span class="r144 r">s</span>.<span class="i">EndsWith</span>(<span class="r142 r">cimModuleFile</span>.<a href="RemoteDiscoveryHelper.cs.html#f18c0cb08ecbfe74" class="i property">FileName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>if</b> (<span class="r143 r">manifestEntries</span>.<span class="i">Any</span>(<span id="r145 rd" class="r145 r">s</span> =&gt; <span class="i">FixupFileName</span>(<b>string</b>.<span class="i">Empty</span>, <span class="r145 r">s</span>, <span class="s">&quot;.ps1xml&quot;</span>, <span class="i">isImportingModule</span>: <b>true</b>).<span class="i">EndsWith</span>(<span class="r142 r">cimModuleFile</span>.<a href="RemoteDiscoveryHelper.cs.html#f18c0cb08ecbfe74" class="i property">FileName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
            {
                <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private bool</b> <a id="1392cbdc56deb5bd" href="../../R/1392cbdc56deb5bd.html" target="n" data-glyph="76,1" class="i method">IsPs1xmlFileHelper</a>(<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r146 rd" class="r146 r">cimModuleFile</span>, <span class="i">Hashtable</span> <span id="r147 rd" class="r147 r">manifestData</span>, <b>string</b> <span id="r148 rd" class="r148 r">goodKey</span>, <b>string</b> <span id="r149 rd" class="r149 r">badKey</span>)
        {
            <b>if</b> (!<span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r146 r">cimModuleFile</span>.<a href="RemoteDiscoveryHelper.cs.html#f18c0cb08ecbfe74" class="i property">FileName</a>).<span class="i">Equals</span>(<span class="s">&quot;.ps1xml&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r150 rd" class="r150 r">goodEntries</span>;
            <b>if</b> (!<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#8cfdef9fa75e1f79" class="i method">GetListOfStringsFromData</a>(<span class="r147 r">manifestData</span>, <b>null</b>, <span class="r148 r">goodKey</span>, 0, <b>out</b> <span class="r150 r">goodEntries</span>))
            {
                <span class="r150 r">goodEntries</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            }
 
            <b>if</b> (<span class="r150 r">goodEntries</span> == <b>null</b>)
            {
                <span class="r150 r">goodEntries</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            }
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r151 rd" class="r151 r">badEntries</span>;
            <b>if</b> (!<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#8cfdef9fa75e1f79" class="i method">GetListOfStringsFromData</a>(<span class="r147 r">manifestData</span>, <b>null</b>, <span class="r149 r">badKey</span>, 0, <b>out</b> <span class="r151 r">badEntries</span>))
            {
                <span class="r151 r">badEntries</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            }
 
            <b>if</b> (<span class="r151 r">badEntries</span> == <b>null</b>)
            {
                <span class="r151 r">badEntries</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            }
 
            <b>bool</b> <span id="r152 rd" class="r152 r">presentInGoodEntries</span> = <span class="i">IsPs1xmlFileHelper_IsPresentInEntries</span>(<span class="r146 r">cimModuleFile</span>, <span class="r150 r">goodEntries</span>);
            <b>bool</b> <span id="r153 rd" class="r153 r">presentInBadEntries</span> = <span class="i">IsPs1xmlFileHelper_IsPresentInEntries</span>(<span class="r146 r">cimModuleFile</span>, <span class="r151 r">badEntries</span>);
            <b>return</b> <span class="r152 r">presentInGoodEntries</span> &amp;&amp; !<span class="r153 r">presentInBadEntries</span>;
        }
 
        <b>private bool</b> <a id="11ffb024cf777bd5" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsTypesPs1XmlFile</a>(<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r154 rd" class="r154 r">cimModuleFile</span>, <span class="i">Hashtable</span> <span id="r155 rd" class="r155 r">manifestData</span>)
        {
            <b>return</b> <a href="#1392cbdc56deb5bd" class="i method">IsPs1xmlFileHelper</a>(<span class="r154 r">cimModuleFile</span>, <span class="r155 r">manifestData</span>, <span class="r148 r">goodKey</span>: <span class="s">&quot;TypesToProcess&quot;</span>, <span class="r149 r">badKey</span>: <span class="s">&quot;FormatsToProcess&quot;</span>);
        }
 
        <b>private bool</b> <a id="fe3e6e1eab965b09" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsFormatPs1XmlFile</a>(<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r156 rd" class="r156 r">cimModuleFile</span>, <span class="i">Hashtable</span> <span id="r157 rd" class="r157 r">manifestData</span>)
        {
            <b>return</b> <a href="#1392cbdc56deb5bd" class="i method">IsPs1xmlFileHelper</a>(<span class="r156 r">cimModuleFile</span>, <span class="r157 r">manifestData</span>, <span class="r148 r">goodKey</span>: <span class="s">&quot;FormatsToProcess&quot;</span>, <span class="r149 r">badKey</span>: <span class="s">&quot;TypesToProcess&quot;</span>);
        }
 
        <b>private static bool</b> <a id="8b17d6fbe00241ed" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">IsCmdletizationFile</a>(<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r158 rd" class="r158 r">cimModuleFile</span>)
        {
            <b>return</b> <span class="r158 r">cimModuleFile</span>.<a href="RemoteDiscoveryHelper.cs.html#9109df2064141e83" class="i property">FileCode</a> == <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#8c583ae4f2412782" class="i field">CmdletizationV1</a>;
        }
 
        <b>private static</b> <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <a id="821e60a208ba2adb" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateCimModuleFiles</a>(
            <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#b5270f565e4adb8f" class="t t">CimModule</a> <span id="r159 rd" class="r159 r">remoteCimModule</span>,
            <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a> <span id="r160 rd" class="r160 r">fileCode</span>,
            <span class="i">Func</span>&lt;<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a>, <b>bool</b>&gt; <span id="r161 rd" class="r161 r">filesFilter</span>,
            <b>string</b> <span id="r162 rd" class="r162 r">temporaryModuleDirectory</span>)
        {
            <b>string</b> <span id="r163 rd" class="r163 r">fileNameTemplate</span> = <b>null</b>;
            <b>switch</b> (<span class="r160 r">fileCode</span>)
            {
                <b>case</b> <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#8c583ae4f2412782" class="i field">CmdletizationV1</a>:
                    <span class="r163 r">fileNameTemplate</span> = <span class="s">&quot;{0}_{1}.cdxml&quot;</span>;
                    <b>break</b>;
                <b>case</b> <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#6e703c46dd5149fd" class="i field">TypesV1</a>:
                    <span class="r163 r">fileNameTemplate</span> = <span class="s">&quot;{0}_{1}.types.ps1xml&quot;</span>;
                    <b>break</b>;
                <b>case</b> <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#a345de8d241059c4" class="i field">FormatV1</a>:
                    <span class="r163 r">fileNameTemplate</span> = <span class="s">&quot;{0}_{1}.format.ps1xml&quot;</span>;
                    <b>break</b>;
                <b>default</b>:
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Unrecognized file code&quot;</span>);
                    <b>break</b>;
            }
 
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r164 rd" class="r164 r">relativePathsToCreatedFiles</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <b>foreach</b> (<a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r165 rd" class="r165 r">file</span> <b>in</b> <span class="r159 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#ae0083ee9392c666" class="i property">ModuleFiles</a>)
            {
                <b>if</b> (!<span class="r161 r">filesFilter</span>(<span class="r165 r">file</span>))
                {
                    <b>continue</b>;
                }
 
                <b>string</b> <span id="r166 rd" class="r166 r">originalFileName</span> = <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r165 r">file</span>.<a href="RemoteDiscoveryHelper.cs.html#f18c0cb08ecbfe74" class="i property">FileName</a>);
                <b>string</b> <span id="r167 rd" class="r167 r">fileName</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="r163 r">fileNameTemplate</span>,
                    <span class="r166 r">originalFileName</span>.<span class="i">Substring</span>(0, <span class="i">Math</span>.<span class="i">Min</span>(<span class="r166 r">originalFileName</span>.<span class="i">Length</span>, 20)),
                    <span class="i">Path</span>.<span class="i">GetRandomFileName</span>());
                <span class="r164 r">relativePathsToCreatedFiles</span>.<span class="i">Add</span>(<span class="r167 r">fileName</span>);
 
                <b>string</b> <span id="r168 rd" class="r168 r">fullPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r162 r">temporaryModuleDirectory</span>, <span class="r167 r">fileName</span>);
                <span class="i">File</span>.<span class="i">WriteAllBytes</span>(
                    <span class="r168 r">fullPath</span>,
                    <span class="r165 r">file</span>.<a href="RemoteDiscoveryHelper.cs.html#5596dc2b05423db8" class="i property">RawFileData</a>);
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                <a href="../../namespaces/FileSystemProvider.cs.html#28276e8c322107d7" class="t t">AlternateDataStreamUtilities</a>.<span class="i">SetZoneOfOrigin</span>(<span class="r168 r">fullPath</span>, <span class="i">SecurityZone</span>.<span class="i">Intranet</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
 
            <b>return</b> <span class="r164 r">relativePathsToCreatedFiles</span>;
        }
 
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="c429c293c6c55686" href="../../R/c429c293c6c55686.html" target="n" data-glyph="76,1" class="i method">ImportModule_RemotelyViaCimModuleData</a>(
            <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r169 rd" class="r169 r">importModuleOptions</span>,
            <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#b5270f565e4adb8f" class="t t">CimModule</a> <span id="r170 rd" class="r170 r">remoteCimModule</span>,
            <span class="i">CimSession</span> <span id="r171 rd" class="r171 r">cimSession</span>)
        {
            <b>try</b>
            {
                <b>if</b> (<span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#ce5161a2a2d89c39" class="i property">MainManifest</a> == <b>null</b>)
                {
                    <b>string</b> <span id="r172 rd" class="r172 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                        <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                        <span class="i">Modules</span>.<span class="i">EmptyModuleManifest</span>,
                        <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a> + <span class="s">&quot;.psd1&quot;</span>);
                    <span class="i">ArgumentException</span> <span id="r173 rd" class="r173 r">argumentException</span> = <b>new</b> <span class="i">ArgumentException</span>(<span class="r172 r">errorMessage</span>);
                    <b>throw</b> <span class="r173 r">argumentException</span>;
                }
 
                <b>bool</b> <span id="r174 rd" class="r174 r">containedErrors</span> = <b>false</b>;
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r175 rd" class="r175 r">moduleInfo</span> = <b>null</b>;
 
                <span class="c">//</span>
                <span class="c">// read the original manifest</span>
                <span class="c">//</span>
                <b>string</b> <span id="r176 rd" class="r176 r">temporaryModuleDirectory</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<span class="i">GetModulePath</span>(
                    <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a>,
                    <b>null</b>,
                    <span class="r171 r">cimSession</span>.<span class="i">ComputerName</span>,
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>);
                <b>string</b> <span id="r177 rd" class="r177 r">temporaryModuleManifestPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(
                    <span class="r176 r">temporaryModuleDirectory</span>,
                    <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a> + <span class="s">&quot;.psd1&quot;</span>);
 
                <span class="i">Hashtable</span> <span id="r178 rd" class="r178 r">data</span> = <b>null</b>;
                <span class="i">Hashtable</span> <span id="r179 rd" class="r179 r">localizedData</span> = <b>null</b>;
                {
                    <a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a> <span id="r180 rd" class="r180 r">scriptBlockAst</span> = <b>null</b>;
                    <a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[] <span id="r181 rd" class="r181 r">throwAwayTokens</span>;
                    <a href="../parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <span id="r182 rd" class="r182 r">parseErrors</span>;
                    <span class="r180 r">scriptBlockAst</span> = <a href="../parser/Parser.cs.html#bbf5e856fb3215c5" class="t t">Parser</a>.<a href="../parser/Parser.cs.html#4f8e15f3d9557f8e" class="i method">ParseInput</a>(
                        <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#ce5161a2a2d89c39" class="i property">MainManifest</a>.<a href="RemoteDiscoveryHelper.cs.html#40166c7ea776ab2b" class="i property">FileData</a>,
                        <span class="r177 r">temporaryModuleManifestPath</span>,
                        <b>out</b> <span class="r181 r">throwAwayTokens</span>,
                        <b>out</b> <span class="r182 r">parseErrors</span>);
                    <b>if</b> ((<span class="r180 r">scriptBlockAst</span> == <b>null</b>) ||
                        (<span class="r182 r">parseErrors</span> != <b>null</b> &amp;&amp; <span class="r182 r">parseErrors</span>.<span class="i">Length</span> &gt; 0))
                    {
                        <b>throw</b> <b>new</b> <a href="../../utils/ParserException.cs.html#62f3ee5b65dd2bdb" class="t constructor">ParseException</a>(<span class="r182 r">parseErrors</span>);
                    }
 
                    <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r183 rd" class="r183 r">scriptBlock</span> = <b>new</b> <a href="../runtime/CompiledScriptBlock.cs.html#7c5e468d9c460238" class="t constructor">ScriptBlock</a>(<span class="r180 r">scriptBlockAst</span>, <span class="r184 r">isFilter</span>: <b>false</b>);
                    <span class="r178 r">data</span> = <a href="ModuleCmdletBase.cs.html#0923f881497e8310" class="i method">LoadModuleManifestData</a>(
                        <span class="r177 r">temporaryModuleManifestPath</span>,
                        <span class="r183 r">scriptBlock</span>,
                        <a href="ModuleCmdletBase.cs.html#df56551ee1dbbfb1" class="i field">ModuleManifestMembers</a>,
                        <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a>, <span class="c">/* - don&#39;t load elements */</span>
                        <b>ref</b> <span class="r174 r">containedErrors</span>);
 
                    <b>if</b> ((<span class="r178 r">data</span> == <b>null</b>) || <span class="r174 r">containedErrors</span>)
                    {
                        <b>return</b> <b>null</b>;
                    }
 
                    <span class="r179 r">localizedData</span> = <span class="r178 r">data</span>;
                }
 
                <span class="c">//</span>
                <span class="c">// flatten module contents and rewrite the manifest to point to the flattened file hierarchy</span>
                <span class="c">//</span>
 
                <span class="c">// recalculate module path, taking into account the module version fetched above</span>
                <span class="i">Version</span> <span id="r185 rd" class="r185 r">moduleVersion</span>;
                <b>if</b> (!<a href="ModuleCmdletBase.cs.html#a28bdc3629cd8300" class="i method">GetScalarFromData</a>&lt;<span class="i">Version</span>&gt;(<span class="r178 r">data</span>, <b>null</b>, <span class="s">&quot;ModuleVersion&quot;</span>, 0, <b>out</b> <span class="r185 r">moduleVersion</span>))
                {
                    <span class="r185 r">moduleVersion</span> = <b>null</b>;
                }
 
                <span class="r176 r">temporaryModuleDirectory</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<span class="i">GetModulePath</span>(
                    <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a>,
                    <span class="r185 r">moduleVersion</span>,
                    <span class="r171 r">cimSession</span>.<span class="i">ComputerName</span>,
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#98ee84b98c4d109b" class="i property">CurrentRunspace</a>);
                <span class="r177 r">temporaryModuleManifestPath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(
                    <span class="r176 r">temporaryModuleDirectory</span>,
                    <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a> + <span class="s">&quot;.psd1&quot;</span>);
                <span class="c">// avoid loading an already loaded module</span>
                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r186 rd" class="r186 r">alreadyImportedModule</span> = <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#ff219b633fc5b22f" class="i method">IsModuleImportUnnecessaryBecauseModuleIsAlreadyLoaded</a>(
                    <span class="r177 r">temporaryModuleManifestPath</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#2ce2c96ea123be27" class="i property">BasePrefix</a>, <span class="r169 r">importModuleOptions</span>);
                <b>if</b> (<span class="r186 r">alreadyImportedModule</span> != <b>null</b>)
                {
                    <b>return</b> <span class="r186 r">alreadyImportedModule</span>;
                }
 
                <b>try</b>
                {
                    <span class="i">Directory</span>.<span class="i">CreateDirectory</span>(<span class="r176 r">temporaryModuleDirectory</span>);
 
                    <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r187 rd" class="r187 r">typesToProcess</span> = <span class="i">CreateCimModuleFiles</span>(
                        <span class="r170 r">remoteCimModule</span>,
                        <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#6e703c46dd5149fd" class="i field">TypesV1</a>,
                        <span id="r188 rd" class="r188 r">cimModuleFile</span> =&gt; <span class="i">IsTypesPs1XmlFile</span>(<span class="r188 r">cimModuleFile</span>, <span class="r178 r">data</span>),
                        <span class="r176 r">temporaryModuleDirectory</span>);
                    <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r189 rd" class="r189 r">formatsToProcess</span> = <span class="i">CreateCimModuleFiles</span>(
                        <span class="r170 r">remoteCimModule</span>,
                        <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#a345de8d241059c4" class="i field">FormatV1</a>,
                        <span id="r190 rd" class="r190 r">cimModuleFile</span> =&gt; <span class="i">IsFormatPs1XmlFile</span>(<span class="r190 r">cimModuleFile</span>, <span class="r178 r">data</span>),
                        <span class="r176 r">temporaryModuleDirectory</span>);
                    <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r191 rd" class="r191 r">nestedModules</span> = <span class="i">CreateCimModuleFiles</span>(
                        <span class="r170 r">remoteCimModule</span>,
                        <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="RemoteDiscoveryHelper.cs.html#8c583ae4f2412782" class="i field">CmdletizationV1</a>,
                        <span class="i">IsCmdletizationFile</span>,
                        <span class="r176 r">temporaryModuleDirectory</span>);
                    <span class="r178 r">data</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#eadd55cbae80c03c" class="i method">RewriteManifest</a>(
                        <span class="r178 r">data</span>,
                        <span class="r192 r">nestedModules</span>: <span class="r191 r">nestedModules</span>,
                        <span class="r193 r">typesToProcess</span>: <span class="r187 r">typesToProcess</span>,
                        <span class="r194 r">formatsToProcess</span>: <span class="r189 r">formatsToProcess</span>);
                    <span class="r179 r">localizedData</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#02a819e4e7e3bbed" class="i method">RewriteManifest</a>(<span class="r179 r">localizedData</span>);
 
                    <span class="c">//</span>
                    <span class="c">// import the module</span>
                    <span class="c">// (from memory - this avoids the authenticode signature problems</span>
                    <span class="c">// that would be introduced by rewriting the contents of the manifest)</span>
                    <span class="c">//</span>
                    <span class="r175 r">moduleInfo</span> = <span class="i">LoadModuleManifest</span>(
                        <span class="r177 r">temporaryModuleManifestPath</span>,
                        <b>null</b>, <span class="c">// scriptInfo</span>
                        <span class="r178 r">data</span>,
                        <span class="r179 r">localizedData</span>,
                        <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#4195724a6acb2c06" class="i field">LoadElements</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#493fa52eb1605135" class="i field">WriteErrors</a> | <a href="ModuleCmdletBase.cs.html#2144bdbe01665ed8" class="t t">ManifestProcessingFlags</a>.<a href="ModuleCmdletBase.cs.html#342eb5397fea9175" class="i field">NullOnFirstError</a>,
                        <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>,
                        <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>,
                        <a href="ModuleCmdletBase.cs.html#c4cac778c669ec13" class="i property">BaseRequiredVersion</a>,
                        <a href="ModuleCmdletBase.cs.html#d3b88fd228891169" class="i property">BaseGuid</a>,
                        <b>ref</b> <span class="r169 r">importModuleOptions</span>,
                        <b>ref</b> <span class="r174 r">containedErrors</span>);
                    <b>if</b> (<span class="r175 r">moduleInfo</span> == <b>null</b>)
                    {
                        <b>return</b> <b>null</b>;
                    }
 
                    <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r195 rd" class="r195 r">nestedModule</span> <b>in</b> <span class="r175 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>)
                    {
                        <span class="i">Type</span> <span id="r196 rd" class="r196 r">cmdletAdapter</span>;
                        <b>bool</b> <span id="r197 rd" class="r197 r">gotCmdletAdapter</span> = <a href="../serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a>.<span class="i">TryPathGet</span>(
                            <span class="r195 r">nestedModule</span>.<a href="PSModuleInfo.cs.html#964f6cf27d5eeb00" class="i property">PrivateData</a> <b>as</b> <span class="i">IDictionary</span>,
                            <b>out</b> <span class="r196 r">cmdletAdapter</span>,
                            <span class="s">&quot;CmdletsOverObjects&quot;</span>,
                            <span class="s">&quot;CmdletAdapter&quot;</span>);
                        <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r197 r">gotCmdletAdapter</span>, <span class="s">&quot;PrivateData from cdxml should always include cmdlet adapter&quot;</span>);
                        <b>if</b> (!<span class="r196 r">cmdletAdapter</span>.<span class="i">AssemblyQualifiedName</span>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#4c48c474d18556ef" class="i field">DefaultCmdletAdapter</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                        {
                            <b>string</b> <span id="r198 rd" class="r198 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                                <span class="i">CmdletizationCoreResources</span>.<span class="i">ImportModule_UnsupportedCmdletAdapter</span>,
                                <span class="r196 r">cmdletAdapter</span>.<span class="i">FullName</span>);
                            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r199 rd" class="r199 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(
                                <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r198 r">errorMessage</span>),
                                <span class="s">&quot;UnsupportedCmdletAdapter&quot;</span>,
                                <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#c855a7c43559f12f" class="i field">InvalidData</a>,
                                <span class="r196 r">cmdletAdapter</span>);
                            <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r199 r">errorRecord</span>);
                        }
                    }
 
                    <b>if</b> (<a href="#0c605fd7aa9686fb" class="i method">IsMixedModePsCimModule</a>(<span class="r170 r">remoteCimModule</span>))
                    {
                        <span class="c">// warn that some commands have not been imported</span>
                        <b>string</b> <span id="r200 rd" class="r200 r">warningMessage</span> = <b>string</b>.<span class="i">Format</span>(
                            <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                            <span class="i">Modules</span>.<span class="i">MixedModuleOverCimSessionWarning</span>,
                            <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a>);
                        <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../cmdlet.cs.html#dda5a07d1a8a6cba" class="i method">WriteWarning</a>(<span class="r200 r">warningMessage</span>);
                    }
 
                    <span class="c">//</span>
                    <span class="c">// store the default session</span>
                    <span class="c">//</span>
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r175 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#67b7b84826910a13" class="i property">ModuleType</a> == <a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>.<a href="PSModuleInfo.cs.html#0f2bfb43459788ea" class="i field">Manifest</a>, <span class="s">&quot;Remote discovery should always produce a &#39;manifest&#39; module&quot;</span>);
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r175 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a> != <b>null</b>, <span class="s">&quot;Remote discovery should always produce a &#39;manifest&#39; module with nested modules entry&quot;</span>);
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r175 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>.<span class="i">Count</span> &gt; 0, <span class="s">&quot;Remote discovery should always produce a &#39;manifest&#39; module with some nested modules&quot;</span>);
                    <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r201 rd" class="r201 r">nestedModule</span> <b>in</b> <span class="r175 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#f1459faf08e930a8" class="i property">NestedModules</a>)
                    {
                        <span class="i">IDictionary</span> <span id="r202 rd" class="r202 r">cmdletsOverObjectsPrivateData</span>;
                        <b>bool</b> <span id="r203 rd" class="r203 r">cmdletsOverObjectsPrivateDataWasFound</span> = <a href="../serialization.cs.html#04756020c00714fe" class="t t">PSPrimitiveDictionary</a>.<a href="../serialization.cs.html#dc33bcdf01531533" class="i method">TryPathGet</a>&lt;<span class="i">IDictionary</span>&gt;(
                            <span class="r201 r">nestedModule</span>.<a href="PSModuleInfo.cs.html#964f6cf27d5eeb00" class="i property">PrivateData</a> <b>as</b> <span class="i">IDictionary</span>,
                            <b>out</b> <span class="r202 r">cmdletsOverObjectsPrivateData</span>,
                            <a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#85d28fff05ca47c3" class="t t">ScriptWriter</a>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#f465f77185ecbe1d" class="i field">PrivateDataKey_CmdletsOverObjects</a>);
                        <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r203 r">cmdletsOverObjectsPrivateDataWasFound</span>, <span class="s">&quot;Cmdletization should always set the PrivateData properly&quot;</span>);
                        <span class="r202 r">cmdletsOverObjectsPrivateData</span>[<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#85d28fff05ca47c3" class="t t">ScriptWriter</a>.<a href="../../cimSupport/cmdletization/ScriptWriter.cs.html#8aefeed3920995e8" class="i field">PrivateDataKey_DefaultSession</a>] = <span class="r171 r">cimSession</span>;
                    }
 
                    <span class="c">//</span>
                    <span class="c">// make sure the temporary folder gets removed when the module is removed</span>
                    <span class="c">//</span>
                    <b>const string</b> <span id="r204 rd" class="r204 r">onRemoveScriptBody</span> =
                        <span class="s">@&quot;
                        Microsoft.PowerShell.Management\Remove-Item `
                            -LiteralPath $temporaryModulePath `
                            -Force `
                            -Recurse `
                            -ErrorAction SilentlyContinue
 
                        if ($null -ne $previousOnRemoveScript)
                        {
                            &amp; $previousOnRemoveScript $args
                        }
                        &quot;</span>;
                    <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r205 rd" class="r205 r">onRemoveScriptBlock</span> = <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>.<a href="../ExecutionContext.cs.html#7b897dde7067af78" class="i property">Engine</a>.<a href="../AutomationEngine.cs.html#7f45ac65575c22af" class="i method">ParseScriptBlock</a>(<span class="r204 r">onRemoveScriptBody</span>, <b>false</b>);
                    <span class="r205 r">onRemoveScriptBlock</span> = <span class="r205 r">onRemoveScriptBlock</span>.<a href="../lang/scriptblock.cs.html#6f3bdb602b7bca08" class="i method">GetNewClosure</a>();
                    <span class="c">// create a separate scope for variables set below</span>
                    <span class="r205 r">onRemoveScriptBlock</span>.<a href="../lang/scriptblock.cs.html#da67b7d69aadb962" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#0198da5eba13cb75" class="i property">PSVariable</a>.<a href="../VariableInterfaces.cs.html#f2dafcc3a1a096b4" class="i method">Set</a>(<span class="s">&quot;temporaryModulePath&quot;</span>, <span class="r176 r">temporaryModuleDirectory</span>);
                    <span class="r205 r">onRemoveScriptBlock</span>.<a href="../lang/scriptblock.cs.html#da67b7d69aadb962" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#0198da5eba13cb75" class="i property">PSVariable</a>.<a href="../VariableInterfaces.cs.html#f2dafcc3a1a096b4" class="i method">Set</a>(<span class="s">&quot;previousOnRemoveScript&quot;</span>, <span class="r175 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#a91c0dfe9b197014" class="i property">OnRemove</a>);
                    <span class="r175 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#a91c0dfe9b197014" class="i property">OnRemove</a> = <span class="r205 r">onRemoveScriptBlock</span>;
 
                    <span class="c">//</span>
                    <span class="c">// Some processing common for local and remote modules</span>
                    <span class="c">//</span>
                    <a href="ModuleCmdletBase.cs.html#fec9578c0eddaf89" class="i method">AddModuleToModuleTables</a>(
                        <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>,
                        <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="ModuleCmdletBase.cs.html#0b3e15d1f51882da" class="i property">TargetSessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>,
                        <span class="r175 r">moduleInfo</span>);
                    <b>if</b> (<a href="ModuleCmdletBase.cs.html#da53dea574e86fa3" class="i property">BasePassThru</a>)
                    {
                        <a href="../cmdlet.cs.html#d3cfb6f38afe5ee0" class="i method">WriteObject</a>(<span class="r175 r">moduleInfo</span>);
                    }
 
                    <b>return</b> <span class="r175 r">moduleInfo</span>;
                }
                <b>catch</b>
                {
                    <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r176 r">temporaryModuleDirectory</span>))
                    {
                        <span class="i">Directory</span>.<span class="i">Delete</span>(<span class="r176 r">temporaryModuleDirectory</span>, <span class="i">recursive</span>: <b>true</b>);
                    }
 
                    <b>throw</b>;
                }
                <b>finally</b>
                {
                    <b>if</b> (<span class="r175 r">moduleInfo</span> == <b>null</b>)
                    {
                        <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r176 r">temporaryModuleDirectory</span>))
                        {
                            <span class="i">Directory</span>.<span class="i">Delete</span>(<span class="r176 r">temporaryModuleDirectory</span>, <span class="i">recursive</span>: <b>true</b>);
                        }
                    }
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r206 rd" class="r206 r">e</span>)
            {
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r207 rd" class="r207 r">errorRecord</span> = <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="RemoteDiscoveryHelper.cs.html#fb063eb9b792dbb8" class="i method">GetErrorRecordForProcessingOfCimModule</a>(<span class="r206 r">e</span>, <span class="r170 r">remoteCimModule</span>.<a href="RemoteDiscoveryHelper.cs.html#b1ff4be69e452ccc" class="i property">ModuleName</a>);
                <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r207 r">errorRecord</span>);
                <b>return</b> <b>null</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> CimSession parameterset
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Remote import
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Cancellation support
 
        <b>private readonly</b> <span class="i">CancellationTokenSource</span> <a id="7ead299172aec36b" href="../../R/7ead299172aec36b.html" target="n" data-glyph="46,1" class="i field">_cancellationTokenSource</a> = <b>new</b> <span class="i">CancellationTokenSource</span>();
 
        <b>private</b> <span class="i">CancellationToken</span> <a id="e6d3aa37e7485e0e" href="../../R/e6d3aa37e7485e0e.html" target="n" data-glyph="106,1" class="i property">CancellationToken</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#7ead299172aec36b" class="i field">_cancellationTokenSource</a>.<span class="i">Token</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When overridden in the derived class, interrupts currently</span>
        <span class="c">///</span><span class="c"> running code within the command. It should interrupt BeginProcessing,</span>
        <span class="c">///</span><span class="c"> ProcessRecord, and EndProcessing.</span>
        <span class="c">///</span><span class="c"> Default implementation in the base class just returns.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="3f81b780bec07717" href="../../R/3f81b780bec07717.html" target="n" data-glyph="75,1" class="i method">StopProcessing</a>()
        {
            <a href="#7ead299172aec36b" class="i field">_cancellationTokenSource</a>.<span class="i">Cancel</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable Members
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Releases resources associated with this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="87b3cdf6897f2cd2" href="../../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#904c2605e9fbf563" class="i method">Dispose</a>(<b>true</b>);
            <span class="i">GC</span>.<span class="i">SuppressFinalize</span>(<a href="#4a6e75cbbfb65b34" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Releases resources associated with this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="904c2605e9fbf563" href="../../R/904c2605e9fbf563.html" target="n" data-glyph="76,1" class="i method">Dispose</a>(<b>bool</b> <span id="r208 rd" class="r208 r">disposing</span>)
        {
            <b>if</b> (<a href="#66da97424eb618f1" class="i field">_disposed</a>)
            {
                <b>return</b>;
            }
 
            <b>if</b> (<span class="r208 r">disposing</span>)
            {
                <a href="#7ead299172aec36b" class="i field">_cancellationTokenSource</a>.<span class="i">Dispose</span>();
            }
 
            <a href="#66da97424eb618f1" class="i field">_disposed</a> = <b>true</b>;
        }
 
        <b>private bool</b> <a id="66da97424eb618f1" href="../../R/66da97424eb618f1.html" target="n" data-glyph="46,1" class="i field">_disposed</a>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> BeginProcessing override.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="865fb8be9273b91b" href="../../R/865fb8be9273b91b.html" target="n" data-glyph="75,1" class="i method">BeginProcessing</a>()
        {
            <span class="c">// Make sure that only one of (Global | Scope) is specified</span>
            <b>if</b> (<a href="#4c6abfc27d0a33ab" class="i property">Global</a>.<a href="../MshCmdlet.cs.html#e9c777a85700d3da" class="i property">IsPresent</a> &amp;&amp; <a href="#6afc8acb3434d861" class="i field">_isScopeSpecified</a>)
            {
                <span class="i">InvalidOperationException</span> <span id="r209 rd" class="r209 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="i">Modules</span>.<span class="i">GlobalAndScopeParameterCannotBeSpecifiedTogether</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r210 rd" class="r210 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r209 r">ioe</span>, <span class="s">&quot;Modules_GlobalAndScopeParameterCannotBeSpecifiedTogether&quot;</span>,
                                                 <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <b>null</b>);
                <a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r210 r">er</span>);
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#67e079351e28cfca" class="i property">Scope</a>) &amp;&amp; <a href="#67e079351e28cfca" class="i property">Scope</a>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#76950d3d9588bb8a" class="i field">Global</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="k">base</a>.<a href="ModuleCmdletBase.cs.html#05a013615daefcfa" class="i property">BaseGlobal</a> = <b>true</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Load the specified modules...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Examples:</span>
        <span class="c">///</span><span class="c">     c:\temp\mdir\mdir.psm1  # load absolute path</span>
        <span class="c">///</span><span class="c">     ./mdir.psm1             # load relative path</span>
        <span class="c">///</span><span class="c">     c:\temp\mdir\mdir       # resolve by using extensions. mdir is a directory, mdir.xxx is a file.</span>
        <span class="c">///</span><span class="c">     c:\temp\mdir            # load default module if mdir is directory</span>
        <span class="c">///</span><span class="c">     module                  # $PSScriptRoot/module/module.psd1 (ps1,psm1,dll)</span>
        <span class="c">///</span><span class="c">     module/examplemodule.psm1      # $PSScriptRoot/module/module.psm1</span>
        <span class="c">///</span><span class="c">     module/examplemodule           # $PSScriptRoot/module/examplemodule.XXX if examplemodule is not a directory...</span>
        <span class="c">///</span><span class="c">     module/examplemodule           # $PSScriptRoot/module/examplemodule is a directory and $PSScriptRoot/module/examplemodule/examplemodule.XXX exists</span>
        <span class="c">///</span><span class="c">     module/examplemodule/examplemodule.XXX</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="1bdd2613682250fe" href="../../R/1bdd2613682250fe.html" target="n" data-glyph="75,1" class="i method">ProcessRecord</a>()
        {
            <b>if</b> (<a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> != <b>null</b> &amp;&amp; <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a> != <b>null</b> &amp;&amp; <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a> &lt; <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>)
            {
                <b>string</b> <span id="r211 rd" class="r211 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">MinimumVersionAndMaximumVersionInvalidRange</span>, <a href="ModuleCmdletBase.cs.html#a3007191d0abebfa" class="i property">BaseMinimumVersion</a>, <a href="ModuleCmdletBase.cs.html#e9f6992e3534b73f" class="i property">BaseMaximumVersion</a>);
                <b>throw</b> <b>new</b> <a href="../../utils/MshArgumentOutOfRangeException.cs.html#057b6b4ddef010f3" class="t constructor">PSArgumentOutOfRangeException</a>(<span class="r211 r">message</span>);
            }
 
            <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r212 rd" class="r212 r">importModuleOptions</span> = <b>new</b> <span class="t">ImportModuleOptions</span>();
            <span class="r212 r">importModuleOptions</span>.<a href="ModuleCmdletBase.cs.html#2c83df2012d40f5a" class="i field">NoClobber</a> = <a href="#59ad6c43ee921fcf" class="i property">NoClobber</a>;
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="#67e079351e28cfca" class="i property">Scope</a>) &amp;&amp; <a href="#67e079351e28cfca" class="i property">Scope</a>.<span class="i">Equals</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#17a9ff531b8319f7" class="i field">Local</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r212 r">importModuleOptions</span>.<a href="ModuleCmdletBase.cs.html#7faee609282d78c3" class="i field">Local</a> = <b>true</b>;
            }
 
            <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#7576fa9d1daaf6fd" class="i field">ParameterSet_ModuleInfo</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// Process all of the specified PSModuleInfo objects. These would typically be coming in as a result</span>
                <span class="c">// of doing Get-Module -list</span>
                <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r213 rd" class="r213 r">module</span> <b>in</b> <a href="#f211e2b5a4eaa87f" class="i property">ModuleInfo</a>)
                {
                    <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<a href="../../utils/Telemetry.cs.html#a7904dd2d0082ac3" class="i method">SendTelemetryMetric</a>(<a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#f3f3b72577bf44b5" class="i field">ModuleLoad</a>, <span class="r213 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>);
                    <a href="RemoteDiscoveryHelper.cs.html#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<span class="i">DispatchModuleInfoProcessing</span>(
                        <span class="r213 r">module</span>,
                        <span class="i">localAction</span>: () =&gt;
                        {
                            <a href="#171d6cf1e2ab8c2f" class="i method">ImportModule_ViaLocalModuleInfo</a>(<span class="r212 r">importModuleOptions</span>, <span class="r213 r">module</span>);
                            <a href="#899e70d8c6fb65a8" class="i method">SetModuleBaseForEngineModules</a>(<span class="r213 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#a41a765d70fc9c9d" class="i property">Context</a>);
                        },
 
                        <span class="i">cimSessionAction</span>: (<span id="r214 rd" class="r214 r">cimSession</span>, <span id="r215 rd" class="r215 r">resourceUri</span>, <span id="r216 rd" class="r216 r">cimNamespace</span>) =&gt; <span class="i">ImportModule_RemotelyViaCimSession</span>(
                            <span class="r212 r">importModuleOptions</span>,
                            <b>new</b> <b>string</b>[] { <span class="r213 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a> },
                            <span class="r214 r">cimSession</span>,
                            <span class="r215 r">resourceUri</span>,
                            <span class="r216 r">cimNamespace</span>),
 
                        <span class="i">psSessionAction</span>: <span id="r217 rd" class="r217 r">psSession</span> =&gt; <span class="i">ImportModule_RemotelyViaPsrpSession</span>(
                            <span class="r212 r">importModuleOptions</span>,
                            <b>new</b> <b>string</b>[] { <span class="r213 r">module</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a> },
                            <b>null</b>,
                            <span class="r217 r">psSession</span>));
                }
            }
            <b>else</b> <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#443c427b530c8a13" class="i field">ParameterSet_Assembly</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="c">// Now load all of the supplied assemblies...</span>
                <b>if</b> (<a href="#67de8a4318ac7531" class="i property">Assembly</a> != <b>null</b>)
                {
                    <b>foreach</b> (<span class="i">Assembly</span> <span id="r218 rd" class="r218 r">suppliedAssembly</span> <b>in</b> <a href="#67de8a4318ac7531" class="i property">Assembly</a>)
                    {
                        <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<span class="i">SendTelemetryMetric</span>(<a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#f3f3b72577bf44b5" class="i field">ModuleLoad</a>, <span class="r218 r">suppliedAssembly</span>.<span class="i">GetName</span>().<span class="i">Name</span>);
                        <a href="#a4782ff61b36a312" class="i method">ImportModule_ViaAssembly</a>(<span class="r212 r">importModuleOptions</span>, <span class="r218 r">suppliedAssembly</span>);
                    }
                }
            }
            <b>else</b> <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#7a9a3981a7e5ceb3" class="i field">ParameterSet_Name</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>foreach</b> (<b>string</b> <span id="r219 rd" class="r219 r">name</span> <b>in</b> <a href="#d6845729919990dc" class="i property">Name</a>)
                {
                    <a href="#8669affb94648b16" class="i method">ImportModule_LocallyViaName_WithTelemetry</a>(<span class="r212 r">importModuleOptions</span>, <span class="r219 r">name</span>);
                }
            }
            <b>else</b> <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#9f6ec35fe83e178c" class="i field">ParameterSet_ViaPsrpSession</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="i">ImportModule_RemotelyViaPsrpSession</span>(<span class="r212 r">importModuleOptions</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#d6845729919990dc" class="i property">Name</a>, <b>null</b>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#10f64975c8cbe671" class="i property">PSSession</a>);
            }
            <b>else</b> <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#68d6531c3bef4a0b" class="i field">ParameterSet_ViaCimSession</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <a href="#0f45fbcf8d98dbe6" class="i method">ImportModule_RemotelyViaCimSession</a>(<span class="r212 r">importModuleOptions</span>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#d6845729919990dc" class="i property">Name</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#fa85ca0bb2b4091e" class="i property">CimSession</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#a8af03b875c636c3" class="i property">CimResourceUri</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#74e4b5fd79b3a31e" class="i property">CimNamespace</a>);
            }
            <b>else</b> <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#cef4feb333014677" class="i field">ParameterSet_FQName</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="k">var</a> <span id="r220 rd" class="r220 r">modulespec</span> <b>in</b> <a href="#a8f026e1f662b72e" class="i property">FullyQualifiedName</a>)
                {
                    <a href="#f5bc63af78a7fd5f" class="i method">ImportModule_LocallyViaFQName</a>(<span class="r212 r">importModuleOptions</span>, <span class="r220 r">modulespec</span>);
                }
            }
            <b>else</b> <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#5c2f84755d31896f" class="i field">ParameterSet_FQName_ViaPsrpSession</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="i">ImportModule_RemotelyViaPsrpSession</span>(<span class="r212 r">importModuleOptions</span>, <b>null</b>, <a href="#a8f026e1f662b72e" class="i property">FullyQualifiedName</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#10f64975c8cbe671" class="i property">PSSession</a>);
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r221 rd" class="r221 r">modulespec</span> <b>in</b> <a href="#a8f026e1f662b72e" class="i property">FullyQualifiedName</a>)
                {
                    <a href="../../utils/Telemetry.cs.html#9832071d08aec551" class="t t">ApplicationInsightsTelemetry</a>.<a href="../../utils/Telemetry.cs.html#a7904dd2d0082ac3" class="i method">SendTelemetryMetric</a>(<a href="../../utils/Telemetry.cs.html#3951f46d9ee8c91d" class="t t">TelemetryType</a>.<a href="../../utils/Telemetry.cs.html#f3f3b72577bf44b5" class="i field">ModuleLoad</a>, <span class="r221 r">modulespec</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
                }
            }
            <b>else</b> <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#033099a5396eebb0" class="i field">ParameterSet_ViaWinCompat</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                  || <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../MshCmdlet.cs.html#f1ecb7c30328d049" class="i property">ParameterSetName</a>.<span class="i">Equals</span>(<a href="#cb10e849a44c5b2d" class="i field">ParameterSet_FQName_ViaWinCompat</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#ca42f6c0d0fd808d" class="i property">UseWindowsPowerShell</a>)
                {
                    <span class="i">ImportModulesUsingWinCompat</span>(<a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#d6845729919990dc" class="i property">Name</a>, <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="#a8f026e1f662b72e" class="i property">FullyQualifiedName</a>, <span class="r212 r">importModuleOptions</span>);
                }
            }
            <b>else</b>
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Unrecognized parameter set&quot;</span>);
            }
        }
 
        <b>private bool</b> <a id="b592944076a9894a" href="../../R/b592944076a9894a.html" target="n" data-glyph="76,1" class="i method">IsModuleInDenyList</a>(<b>string</b>[] <span id="r222 rd" class="r222 r">moduleDenyList</span>, <b>string</b> <span id="r223 rd" class="r223 r">moduleName</span>, <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r224 rd" class="r224 r">moduleSpec</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r223 r">moduleName</span>) ^ (<span class="r224 r">moduleSpec</span> == <b>null</b>), <span class="s">&quot;Either moduleName or moduleSpec must be specified&quot;</span>);
 
            <span class="c">// moduleName can be just a module name and it also can be a full path to psd1 from which we need to extract the module name</span>
            <b>string</b> <span id="r225 rd" class="r225 r">exactModuleName</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r224 r">moduleSpec</span> == <b>null</b> ? <span class="r223 r">moduleName</span> : <span class="r224 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
            <b>bool</b> <span id="r226 rd" class="r226 r">match</span> = <b>false</b>;
 
            <b>foreach</b> (<b>var</b> <span id="r227 rd" class="r227 r">deniedModuleName</span> <b>in</b> <span class="r222 r">moduleDenyList</span>)
            {
                <span class="c">// use case-insensitive module name comparison</span>
                <span class="r226 r">match</span> = <span class="r225 r">exactModuleName</span>.<span class="i">Equals</span>(<span class="r227 r">deniedModuleName</span>, <span class="i">StringComparison</span>.<span class="i">InvariantCultureIgnoreCase</span>);
                <b>if</b> (<span class="r226 r">match</span>)
                {
                    <b>string</b> <span id="r228 rd" class="r228 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="i">Modules</span>.<span class="i">WinCompatModuleInDenyList</span>, <span class="r225 r">exactModuleName</span>);
                    <span class="i">InvalidOperationException</span> <span id="r229 rd" class="r229 r">exception</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r228 r">errorMessage</span>);
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r230 rd" class="r230 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r229 r">exception</span>, <span class="s">&quot;Modules_ModuleInWinCompatDenyList&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#cb0471032395958b" class="i field">ResourceUnavailable</a>, <span class="r225 r">exactModuleName</span>);
                    <a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r230 r">er</span>);
                    <b>break</b>;
                }
            }
 
            <b>return</b> <span class="r226 r">match</span>;
        }
 
        <b>private</b> <span class="i">List</span>&lt;<span class="r231 r t">T</span>&gt; <a id="51d316ec78c961a8" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FilterModuleCollection</a>&lt;<span id="r231 rd t" class="r231 r t">T</span>&gt;(<span class="i">IEnumerable</span>&lt;<span class="r231 r t">T</span>&gt; <span id="r232 rd" class="r232 r">moduleCollection</span>)
        {
            <span class="i">List</span>&lt;<span class="r231 r t">T</span>&gt; <span id="r233 rd" class="r233 r">filteredModuleCollection</span> = <b>null</b>;
            <b>if</b> (<span class="r232 r">moduleCollection</span> != <b>null</b>)
            {
                <span class="c">// the ModuleDeny list is cached in PowerShellConfig object</span>
                <b>string</b>[] <span id="r234 rd" class="r234 r">moduleDenyList</span> = <a href="../PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="../PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="../PSConfiguration.cs.html#d81d38452a5eea56" class="i method">GetWindowsPowerShellCompatibilityModuleDenyList</a>();
                <b>if</b> (<span class="r234 r">moduleDenyList</span>?.<span class="i">Any</span>() != <b>true</b>)
                {
                    <span class="r233 r">filteredModuleCollection</span> = <b>new</b> <span class="i">List</span>&lt;<span class="r231 r t">T</span>&gt;(<span class="r232 r">moduleCollection</span>);
                }
                <b>else</b>
                {
                    <span class="r233 r">filteredModuleCollection</span> = <b>new</b> <span class="i">List</span>&lt;<span class="r231 r t">T</span>&gt;();
                    <b>foreach</b> (<b>var</b> <span id="r235 rd" class="r235 r">module</span> <b>in</b> <span class="r232 r">moduleCollection</span>)
                    {
                        <b>if</b> (!<a href="#b592944076a9894a" class="i method">IsModuleInDenyList</a>(<span class="r234 r">moduleDenyList</span>, <span class="r235 r">module</span> <b>as string</b>, <span class="r235 r">module</span> <b>as</b> <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>))
                        {
                            <span class="r233 r">filteredModuleCollection</span>.<span class="i">Add</span>(<span class="r235 r">module</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r233 r">filteredModuleCollection</span>;
        }
 
        <b>private void</b> <a id="2aed7deede797411" href="../../R/2aed7deede797411.html" target="n" data-glyph="76,1" class="i method">PrepareNoClobberWinCompatModuleImport</a>(<b>string</b> <span id="r236 rd" class="r236 r">moduleName</span>, <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r237 rd" class="r237 r">moduleSpec</span>, <b>ref</b> <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r238 rd" class="r238 r">importModuleOptions</span>)
        {
            <span class="i">Debug</span>.<span class="i">Assert</span>(<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r236 r">moduleName</span>) ^ (<span class="r237 r">moduleSpec</span> == <b>null</b>), <span class="s">&quot;Either moduleName or moduleSpec must be specified&quot;</span>);
 
            <span class="c">// moduleName can be just a module name and it also can be a full path to psd1 from which we need to extract the module name</span>
            <b>string</b> <span id="r239 rd" class="r239 r">coreModuleToLoad</span> = <a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r237 r">moduleSpec</span> == <b>null</b> ? <span class="r236 r">moduleName</span> : <span class="r237 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>);
 
            <b>var</b> <span id="r240 rd" class="r240 r">isModuleToLoadEngineModule</span> = <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#7c1caf70ca3d20ee" class="i method">IsEngineModule</a>(<span class="r239 r">coreModuleToLoad</span>);
            <b>string</b>[] <span id="r241 rd" class="r241 r">noClobberModuleList</span> = <a href="../PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="../PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="../PSConfiguration.cs.html#d958ca6ae3445874" class="i method">GetWindowsPowerShellCompatibilityNoClobberModuleList</a>();
            <b>if</b> (<span class="r240 r">isModuleToLoadEngineModule</span> || ((<span class="r241 r">noClobberModuleList</span> != <b>null</b>) &amp;&amp; <span class="r241 r">noClobberModuleList</span>.<span class="i">Contains</span>(<span class="r239 r">coreModuleToLoad</span>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>)))
            {
                <span class="c">// if it is one of engine modules - first try to load it from $PSHOME\Modules</span>
                <span class="c">// otherwise rely on $env:PSModulePath (in which WinPS module location has to go after CorePS module location)</span>
                <b>if</b> (<span class="r240 r">isModuleToLoadEngineModule</span>)
                {
                    <b>string</b> <span id="r242 rd" class="r242 r">expectedCoreModulePath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<a href="ModuleIntrinsics.cs.html#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="ModuleIntrinsics.cs.html#f7332eb7c199d50c" class="i method">GetPSHomeModulePath</a>(), <span class="r239 r">coreModuleToLoad</span>);
                    <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r242 r">expectedCoreModulePath</span>))
                    {
                        <span class="r239 r">coreModuleToLoad</span> = <span class="r242 r">expectedCoreModulePath</span>;
                    }
                }
 
                <b>if</b> (<span class="r237 r">moduleSpec</span> == <b>null</b>)
                {
                    <a href="#8669affb94648b16" class="i method">ImportModule_LocallyViaName_WithTelemetry</a>(<span class="r238 r">importModuleOptions</span>, <span class="r239 r">coreModuleToLoad</span>);
                }
                <b>else</b>
                {
                    <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r243 rd" class="r243 r">tmpModuleSpec</span> = <b>new</b> <a href="ModuleSpecification.cs.html#a06529b49cc6cb36" class="t constructor">ModuleSpecification</a>()
                    {
                        <a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a> = <span class="r237 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>,
                        <a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> = <span class="r237 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>,
                        <a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a> = <span class="r237 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>,
                        <a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a> = <span class="r237 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>,
                        <a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a> = <span class="r239 r">coreModuleToLoad</span>
                    };
                    <a href="#f5bc63af78a7fd5f" class="i method">ImportModule_LocallyViaFQName</a>(<span class="r238 r">importModuleOptions</span>, <span class="r243 r">tmpModuleSpec</span>);
                }
 
                <span class="r238 r">importModuleOptions</span>.<a href="ModuleCmdletBase.cs.html#e8f222097dc3f4dc" class="i field">NoClobberExportPSSession</a> = <b>true</b>;
            }
        }
 
        <b>internal override</b> <span class="i">IList</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="891c24437f813066" href="../../R/891c24437f813066.html" target="n" data-glyph="74,1" class="i method">ImportModulesUsingWinCompat</a>(<span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r244 rd" class="r244 r">moduleNames</span>, <span class="i">IEnumerable</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r245 rd" class="r245 r">moduleFullyQualifiedNames</span>, <a href="ModuleCmdletBase.cs.html#2b4569e86558d3e1" class="t t">ImportModuleOptions</a> <span id="r246 rd" class="r246 r">importModuleOptions</span>)
        {
            <span class="i">IList</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r247 rd" class="r247 r">moduleProxyList</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <span class="c">// one of the two parameters can be passed: either ModuleNames (most of the time) or ModuleSpecifications (they are used in different parameter sets)</span>
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r248 rd" class="r248 r">filteredModuleNames</span> = <span class="i">FilterModuleCollection</span>(<span class="r244 r">moduleNames</span>);
            <span class="i">List</span>&lt;<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>&gt; <span id="r249 rd" class="r249 r">filteredModuleFullyQualifiedNames</span> = <span class="i">FilterModuleCollection</span>(<span class="r245 r">moduleFullyQualifiedNames</span>);
 
            <span class="c">// do not setup WinCompat resources if we have no modules to import</span>
            <b>if</b> ((<span class="r248 r">filteredModuleNames</span>?.<span class="i">Any</span>() != <b>true</b>) &amp;&amp; (<span class="r249 r">filteredModuleFullyQualifiedNames</span>?.<span class="i">Any</span>() != <b>true</b>))
            {
                <b>return</b> <span class="r247 r">moduleProxyList</span>;
            }
 
            <b>var</b> <span id="r250 rd" class="r250 r">winPSVersionString</span> = <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#e409259aca008667" class="i method">GetWindowsPowerShellVersionFromRegistry</a>();
            <b>if</b> (!<span class="r250 r">winPSVersionString</span>.<span class="i">StartsWith</span>(<span class="s">&quot;5.1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>string</b> <span id="r251 rd" class="r251 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="i">Modules</span>.<span class="i">WinCompatRequredVersionError</span>, <span class="r250 r">winPSVersionString</span>);
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r251 r">errorMessage</span>);
            }
 
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r252 rd" class="r252 r">WindowsPowerShellCompatRemotingSession</span> = <a href="ModuleCmdletBase.cs.html#068a38770652843f" class="i method">CreateWindowsPowerShellCompatResources</a>();
            <b>if</b> (<span class="r252 r">WindowsPowerShellCompatRemotingSession</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
            }
 
            <span class="c">// perform necessary preparations if module has to be imported with NoClobber mode</span>
            <b>if</b> (<span class="r248 r">filteredModuleNames</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>string</b> <span id="r253 rd" class="r253 r">moduleName</span> <b>in</b> <span class="r248 r">filteredModuleNames</span>)
                {
                    <a href="#2aed7deede797411" class="i method">PrepareNoClobberWinCompatModuleImport</a>(<span class="r253 r">moduleName</span>, <b>null</b>, <b>ref</b> <span class="r246 r">importModuleOptions</span>);
                }
            }
 
            <b>if</b> (<span class="r249 r">filteredModuleFullyQualifiedNames</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r254 rd" class="r254 r">moduleSpec</span> <b>in</b> <span class="r249 r">filteredModuleFullyQualifiedNames</span>)
                {
                    <span class="i">PrepareNoClobberWinCompatModuleImport</span>(<b>null</b>, <span class="r254 r">moduleSpec</span>, <b>ref</b> <span class="r246 r">importModuleOptions</span>);
                }
            }
 
            <span class="c">// perform the module import / proxy generation</span>
            <span class="r247 r">moduleProxyList</span> = <span class="i">ImportModule_RemotelyViaPsrpSession</span>(<span class="r246 r">importModuleOptions</span>, <span class="r248 r">filteredModuleNames</span>, <span class="r249 r">filteredModuleFullyQualifiedNames</span>, <span class="r252 r">WindowsPowerShellCompatRemotingSession</span>, <span class="i">usingWinCompat</span>: <b>true</b>);
 
            <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r255 rd" class="r255 r">moduleProxy</span> <b>in</b> <span class="r247 r">moduleProxyList</span>)
            {
                <span class="r255 r">moduleProxy</span>.<a href="PSModuleInfo.cs.html#a7cf8f3895ca3a4a" class="i property">IsWindowsPowerShellCompatModule</a> = <b>true</b>;
                <span class="i n">System</span>.<span class="i">Threading</span>.<span class="i">Interlocked</span>.<span class="i">Increment</span>(<b>ref</b> <a href="ModuleCmdletBase.cs.html#7d80f8891e3a90f5" class="i field">s_WindowsPowerShellCompatUsageCounter</a>);
 
                <b>string</b> <span id="r256 rd" class="r256 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">WinCompatModuleWarning</span>, <span class="r255 r">moduleProxy</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r252 r">WindowsPowerShellCompatRemotingSession</span>.<a href="../remoting/client/remoterunspaceinfo.cs.html#dcc034e330dc7781" class="i property">Name</a>);
                <a href="../cmdlet.cs.html#dda5a07d1a8a6cba" class="i method">WriteWarning</a>(<span class="r256 r">message</span>);
            }
 
            <span class="c">// register LocationChanged handler so that $PWD in Windows PS process mirrors local $PWD changes</span>
            <b>if</b> (<span class="r247 r">moduleProxyList</span>.<span class="i">Count</span> &gt; 0)
            {
                <span class="c">// make sure that we add registration only once to a multicast delegate</span>
                <a href="ModuleCmdletBase.cs.html#8193fa238ac447ca" class="i field">SyncCurrentLocationDelegate</a> ??= <span class="i">SyncCurrentLocationHandler</span>;
                <b>var</b> <span id="r257 rd" class="r257 r">alreadyregistered</span> = <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#5078d443148de142" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#6884bea45b32a31e" class="i property">LocationChangedAction</a>?.<span class="i">GetInvocationList</span>().<span class="i">Contains</span>(<a href="ModuleCmdletBase.cs.html#8193fa238ac447ca" class="i field">SyncCurrentLocationDelegate</a>);
 
                <b>if</b> (!<span class="r257 r">alreadyregistered</span> ?? <b>true</b>)
                {
                    <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#5078d443148de142" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#236f6ceba41f8f3e" class="i property">InvokeCommand</a>.<a href="../MshCmdlet.cs.html#6884bea45b32a31e" class="i property">LocationChangedAction</a> += <a href="ModuleCmdletBase.cs.html#8193fa238ac447ca" class="i field">SyncCurrentLocationDelegate</a>;
 
                    <span class="c">// first sync has to be triggered manually</span>
                    <a href="ModuleCmdletBase.cs.html#609f9ff1fc8c51a6" class="i method">SyncCurrentLocationHandler</a>(<span class="r258 r">sender</span>: <a href="#4a6e75cbbfb65b34" class="k">this</a>, <span class="r259 r">args</span>: <b>new</b> <a href="../SessionStateLocationAPIs.cs.html#28eb1a8d2193b05f" class="t constructor">LocationChangedEventArgs</a>(<span class="r260 r">sessionState</span>: <b>null</b>, <span class="r261 r">oldPath</span>: <b>null</b>, <span class="r262 r">newPath</span>: <a href="#4a6e75cbbfb65b34" class="k">this</a>.<a href="../CommandBase.cs.html#5078d443148de142" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../PathInterfaces.cs.html#91ffa5f8fc6b1308" class="i property">CurrentLocation</a>));
                }
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>return</b> <span class="r247 r">moduleProxyList</span>;
        }
 
        <b>private static void</b> <a id="899e70d8c6fb65a8" href="../../R/899e70d8c6fb65a8.html" target="n" data-glyph="76,1" class="i method">SetModuleBaseForEngineModules</a>(<b>string</b> <span id="r263 rd" class="r263 r">moduleName</span>, <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r264 rd" class="r264 r">context</span>)
        {
            <span class="c">// Set modulebase of engine modules to point to $pshome</span>
            <span class="c">// This is so that Get-Help can load the correct help.</span>
            <b>if</b> (<a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#7c1caf70ca3d20ee" class="i method">IsEngineModule</a>(<span class="r263 r">moduleName</span>))
            {
                <b>foreach</b> (<b>var</b> <span id="r265 rd" class="r265 r">m</span> <b>in</b> <span class="r264 r">context</span>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>.<span class="i">Values</span>)
                {
                    <b>if</b> (<span class="r265 r">m</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="r263 r">moduleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r265 r">m</span>.<span class="i">SetModuleBase</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>);
                        <span class="c">// Also set  ModuleBase for nested modules of Engine modules</span>
                        <b>foreach</b> (<b>var</b> <span id="r266 rd" class="r266 r">nestedModule</span> <b>in</b> <span class="r265 r">m</span>.<span class="i">NestedModules</span>)
                        {
                            <span class="r266 r">nestedModule</span>.<span class="i">SetModuleBase</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>);
                        }
                    }
                }
 
                <b>foreach</b> (<b>var</b> <span id="r267 rd" class="r267 r">m</span> <b>in</b> <span class="r264 r">context</span>.<a href="../ExecutionContext.cs.html#2d3edf63c7afa4b2" class="i property">Modules</a>.<a href="ModuleIntrinsics.cs.html#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">Values</span>)
                {
                    <b>if</b> (<span class="r267 r">m</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="r263 r">moduleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <span class="r267 r">m</span>.<span class="i">SetModuleBase</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>);
                        <span class="c">// Also set  ModuleBase for nested modules of Engine modules</span>
                        <b>foreach</b> (<b>var</b> <span id="r268 rd" class="r268 r">nestedModule</span> <b>in</b> <span class="r267 r">m</span>.<span class="i">NestedModules</span>)
                        {
                            <span class="r268 r">nestedModule</span>.<span class="i">SetModuleBase</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>);
                        }
                    }
                }
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
