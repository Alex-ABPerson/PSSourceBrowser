<!DOCTYPE html>
<html><head><title>RemoteDiscoveryHelper.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1106);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/Modules/RemoteDiscoveryHelper.cs" target="_top">engine\Modules\RemoteDiscoveryHelper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Net</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>.<span class="i">RegularExpressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Xml</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Management</span>.<span class="i">Infrastructure</span>.<span class="i">Options</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <b>internal static class</b> <a id="83e28a85267ced48" href="../../R/83e28a85267ced48.html" target="n" data-glyph="2,0" class="t t">RemoteDiscoveryHelper</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> PSRP
 
        <b>private static</b> <span class="i">Collection</span>&lt;<b>string</b>&gt; <a id="0619c09e653be2e0" href="../../R/0619c09e653be2e0.html" target="n" data-glyph="76,1" class="i method">RehydrateHashtableKeys</a>(<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r0 rd" class="r0 r">pso</span>, <b>string</b> <span id="r1 rd" class="r1 r">propertyName</span>)
        {
            <b>const</b> <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#1056e690af85447d" class="t t">RehydrationFlags</a> <span id="r2 rd" class="r2 r">rehydrationFlags</span> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#1056e690af85447d" class="t t">RehydrationFlags</a>.<a href="../serialization.cs.html#57368bb545aac544" class="i field">NullValueOk</a> |
                                   <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#1056e690af85447d" class="t t">RehydrationFlags</a>.<a href="../serialization.cs.html#7004b900d60ba66b" class="i field">MissingPropertyOk</a>;
            <span class="i">Hashtable</span> <span id="r3 rd" class="r3 r">hashtable</span> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Hashtable</span>&gt;(<span class="r0 r">pso</span>, <span class="r1 r">propertyName</span>, <span class="r2 r">rehydrationFlags</span>);
            <b>if</b> (<span class="r3 r">hashtable</span> == <b>null</b>)
            {
                <b>return</b> <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;();
            }
            <b>else</b>
            {
                <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r4 rd" class="r4 r">list</span> = <span class="r3 r">hashtable</span>
                    .<span class="i">Keys</span>
                    .<span class="i">Cast</span>&lt;<b>object</b>&gt;()
                    .<span class="i">Where</span>(<b>static</b> <span id="r5 rd" class="r5 r">k</span> =&gt; <span class="r5 r">k</span> != <b>null</b>)
                    .<span class="i">Select</span>(<b>static</b> <span id="r6 rd" class="r6 r">k</span> =&gt; <span class="r6 r">k</span>.<span class="i">ToString</span>())
                    .<span class="i">Where</span>(<b>static</b> <span id="r7 rd" class="r7 r">s</span> =&gt; <span class="r7 r">s</span> != <b>null</b>)
                    .<span class="i">ToList</span>();
                <b>return</b> <b>new</b> <span class="i">Collection</span>&lt;<b>string</b>&gt;(<span class="r4 r">list</span>);
            }
        }
 
        <b>internal static</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="50249f257fc7acf7" href="../../R/50249f257fc7acf7.html" target="n" data-glyph="74,1" class="i method">RehydratePSModuleInfo</a>(<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r8 rd" class="r8 r">deserializedModuleInfo</span>)
        {
            <b>const</b> <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#1056e690af85447d" class="t t">RehydrationFlags</a> <span id="r9 rd" class="r9 r">rehydrationFlags</span> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#1056e690af85447d" class="t t">RehydrationFlags</a>.<a href="../serialization.cs.html#57368bb545aac544" class="i field">NullValueOk</a> |
                                   <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#1056e690af85447d" class="t t">RehydrationFlags</a>.<a href="../serialization.cs.html#7004b900d60ba66b" class="i field">MissingPropertyOk</a>;
            <b>string</b> <span id="r10 rd" class="r10 r">name</span> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Name&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <b>string</b> <span id="r11 rd" class="r11 r">path</span> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Path&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r12 rd" class="r12 r">moduleInfo</span> = <b>new</b> <a href="PSModuleInfo.cs.html#82c685f79205f6f4" class="t constructor">PSModuleInfo</a>(<span class="r10 r">name</span>, <span class="r11 r">path</span>, <span class="r13 r">context</span>: <b>null</b>, <span class="r14 r">sessionState</span>: <b>null</b>);
 
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#4b6e2a1b9b5b92c2" class="i method">SetGuid</a>(<a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Guid</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Guid&quot;</span>, <span class="r9 r">rehydrationFlags</span>));
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#1f023afba84f0181" class="i method">SetModuleType</a>(<a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<a href="PSModuleInfo.cs.html#c7db608d3be6a241" class="t t">ModuleType</a>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ModuleType&quot;</span>, <span class="r9 r">rehydrationFlags</span>));
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#86de19074268f803" class="i method">SetVersion</a>(<a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Version</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Version&quot;</span>, <span class="r9 r">rehydrationFlags</span>));
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#c345165f675110e2" class="i method">SetHelpInfoUri</a>(<a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;HelpInfoUri&quot;</span>, <span class="r9 r">rehydrationFlags</span>));
 
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#09ac44907d839e91" class="i property">AccessMode</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<a href="PSModuleInfo.cs.html#7988bbf518356b24" class="t t">ModuleAccessMode</a>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;AccessMode&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#5575df040d9e83ad" class="i property">Author</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Author&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#9102cf9f060d4060" class="i property">ClrVersion</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Version</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ClrVersion&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#5712d91db996f4b9" class="i property">CompanyName</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;CompanyName&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#f874db839f072c87" class="i property">Copyright</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Copyright&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#9b617cc3f69baa1e" class="i property">Description</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Description&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#b02be56548e4c3c7" class="i property">DotNetFrameworkVersion</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Version</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;DotNetFrameworkVersion&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#4225b887eec850c2" class="i property">PowerShellHostName</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;PowerShellHostName&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#8461cce8296d3118" class="i property">PowerShellHostVersion</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Version</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;PowerShellHostVersion&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#6d8cd807d9d4d3ed" class="i property">PowerShellVersion</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Version</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;PowerShellVersion&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#72fb99b54c9a7f07" class="i property">ProcessorArchitecture</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Reflection</span>.<span class="i">ProcessorArchitecture</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ProcessorArchitecture&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
 
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#73ffedf722a35065" class="i field">DeclaredAliasExports</a> = <a href="#0619c09e653be2e0" class="i method">RehydrateHashtableKeys</a>(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ExportedAliases&quot;</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#3c033ee6fd121e5a" class="i field">DeclaredCmdletExports</a> = <a href="#0619c09e653be2e0" class="i method">RehydrateHashtableKeys</a>(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ExportedCmdlets&quot;</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#563d276b2d63feda" class="i field">DeclaredFunctionExports</a> = <a href="#0619c09e653be2e0" class="i method">RehydrateHashtableKeys</a>(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ExportedFunctions&quot;</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#73b386e1f1d9f46c" class="i field">DeclaredVariableExports</a> = <a href="#0619c09e653be2e0" class="i method">RehydrateHashtableKeys</a>(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ExportedVariables&quot;</span>);
 
            <b>var</b> <span id="r15 rd" class="r15 r">compatiblePSEditions</span> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>[]&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;CompatiblePSEditions&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <b>if</b> (<span class="r15 r">compatiblePSEditions</span> != <b>null</b> &amp;&amp; <span class="r15 r">compatiblePSEditions</span>.<span class="i">Length</span> &gt; 0)
            {
                <b>foreach</b> (<b>var</b> <span id="r16 rd" class="r16 r">edition</span> <b>in</b> <span class="r15 r">compatiblePSEditions</span>)
                {
                    <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#9fd61d133adc06df" class="i method">AddToCompatiblePSEditions</a>(<span class="r16 r">edition</span>);
                }
            }
 
            <span class="c">// PowerShellGet related properties</span>
            <b>var</b> <span id="r17 rd" class="r17 r">tags</span> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>[]&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;Tags&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <b>if</b> (<span class="r17 r">tags</span> != <b>null</b> &amp;&amp; <span class="r17 r">tags</span>.<span class="i">Length</span> &gt; 0)
            {
                <b>foreach</b> (<b>var</b> <span id="r18 rd" class="r18 r">tag</span> <b>in</b> <span class="r17 r">tags</span>)
                {
                    <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#9e1a25f8d663174c" class="i method">AddToTags</a>(<span class="r18 r">tag</span>);
                }
            }
 
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#bfe7a113afff1c03" class="i property">ReleaseNotes</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<b>string</b>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ReleaseNotes&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#747adfc27ee44685" class="i property">ProjectUri</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Uri</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;ProjectUri&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#bcf842e072eb8f87" class="i property">LicenseUri</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Uri</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;LicenseUri&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#f7b5f1b9a36523eb" class="i property">IconUri</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Uri</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;IconUri&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
            <span class="r12 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#b0cc1fefc6f988f8" class="i property">RepositorySourceLocation</a> = <a href="../serialization.cs.html#ddbcb5ecc947a806" class="t t">DeserializingTypeConverter</a>.<a href="../serialization.cs.html#4e995a3c8b04ebcc" class="i method">GetPropertyValue</a>&lt;<span class="i">Uri</span>&gt;(<span class="r8 r">deserializedModuleInfo</span>, <span class="s">&quot;RepositorySourceLocation&quot;</span>, <span class="r9 r">rehydrationFlags</span>);
 
            <b>return</b> <span class="r12 r">moduleInfo</span>;
        }
 
        <b>private static</b> <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <a id="3a03ce0d1dfd72e9" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetStreamForwarder</a>&lt;<span id="r19 rd t" class="r19 r t">T</span>&gt;(<span class="i">Action</span>&lt;<span class="r19 r t">T</span>&gt; <span id="r20 rd" class="r20 r">forwardingAction</span>, <b>bool</b> <span id="r21 rd" class="r21 r">swallowInvalidOperationExceptions</span> = <b>false</b>)
        {
            <span class="c">// TODO/FIXME: ETW event for extended semantics streams</span>
            <b>return</b> (<b>object</b> <span id="r22 rd" class="r22 r">sender</span>, <a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a> <span id="r23 rd" class="r23 r">eventArgs</span>) =&gt;
            {
                <a href="../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="k">var</a> <span id="r24 rd" class="r24 r">psDataCollection</span> = (<a href="../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="t t">PSDataCollection</a>&lt;<span class="r19 r t">T</span>&gt;)<span class="r22 r">sender</span>;
                <b>foreach</b> (<span class="r19 r t">T</span> <span id="r25 rd" class="r25 r">t</span> <b>in</b> <span class="r24 r">psDataCollection</span>.<a href="../hostifaces/PSDataCollection.cs.html#403be942120e2d89" class="i method">ReadAll</a>())
                {
                    <b>try</b>
                    {
                        <span class="r20 r">forwardingAction</span>(<span class="r25 r">t</span>);
                    }
                    <b>catch</b> (<span class="i">InvalidOperationException</span>)
                    {
                        <b>if</b> (!<span class="r21 r">swallowInvalidOperationExceptions</span>)
                        {
                            <b>throw</b>;
                        }
                    }
                }
            };
        }
 
        <span class="c">// This is a static field (instead of a constant) to make it possible to set through tests (and/or by customers if needed for a workaround)</span>
        <b>private static readonly int</b> <a id="15c23aee8fd50909" href="../../R/15c23aee8fd50909.html" target="n" data-glyph="46,1" class="i field">s_blockingCollectionCapacity</a> = 1000;
 
        <b>private static</b> <span class="i">IEnumerable</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="cf3148a6866ea025" href="../../R/cf3148a6866ea025.html" target="n" data-glyph="76,1" class="i method">InvokeTopLevelPowerShell</a>(
            <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r26 rd" class="r26 r">powerShell</span>,
            <a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r27 rd" class="r27 r">cmdlet</span>,
            <a href="../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r28 rd" class="r28 r">invocationSettings</span>,
            <b>string</b> <span id="r29 rd" class="r29 r">errorMessageTemplate</span>,
            <span class="i">CancellationToken</span> <span id="r30 rd" class="r30 r">cancellationToken</span>)
        {
            <b>using</b> (<b>var</b> <span id="r31 rd" class="r31 r">mergedOutput</span> = <b>new</b> <span class="i">BlockingCollection</span>&lt;<span class="i">Func</span>&lt;<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a>, <span class="i">IEnumerable</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt;&gt;(<a href="#15c23aee8fd50909" class="i field">s_blockingCollectionCapacity</a>))
            {
                <a href="../hostifaces/PSDataCollection.cs.html#52e2b209c10ec0a4" class="k">var</a> <span id="r32 rd" class="r32 r">asyncOutput</span> = <b>new</b> <a href="../hostifaces/PSDataCollection.cs.html#ee85ce3306fe4e5b" class="t constructor">PSDataCollection</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <span id="r33 rd" class="r33 r">outputHandler</span> = <span class="i">GetStreamForwarder</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(
                    <span id="r34 rd" class="r34 r">output</span> =&gt; <span class="r31 r">mergedOutput</span>.<span class="i">Add</span>(<span id="r35 rd" class="r35 r">_</span> =&gt; <b>new</b>[] { <span class="r34 r">output</span> }),
                    <span class="i">swallowInvalidOperationExceptions</span>: <b>true</b>);
 
                <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <span id="r36 rd" class="r36 r">errorHandler</span> = <span class="i">GetStreamForwarder</span>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;(
                    <span id="r37 rd" class="r37 r">errorRecord</span> =&gt; <span class="r31 r">mergedOutput</span>.<span class="i">Add</span>(
                        (<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r38 rd" class="r38 r">c</span>) =&gt;
                        {
                            <span class="r37 r">errorRecord</span> = <span class="i">GetErrorRecordForRemotePipelineInvocation</span>(<span class="r37 r">errorRecord</span>, <span class="r29 r">errorMessageTemplate</span>);
                            <span class="i">HandleErrorFromPipeline</span>(<span class="r38 r">c</span>, <span class="r37 r">errorRecord</span>, <span class="r26 r">powerShell</span>);
                            <b>return</b> <span class="i">Enumerable</span>.<span class="i">Empty</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                        }),
                     <span class="i">swallowInvalidOperationExceptions</span>: <b>true</b>);
 
                <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <span id="r39 rd" class="r39 r">warningHandler</span> = <span class="i">GetStreamForwarder</span>&lt;<a href="../hostifaces/InformationalRecord.cs.html#59cd69dde48b9557" class="t t">WarningRecord</a>&gt;(
                    <span id="r40 rd" class="r40 r">warningRecord</span> =&gt; <span class="r31 r">mergedOutput</span>.<span class="i">Add</span>(
                        (<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r41 rd" class="r41 r">c</span>) =&gt;
                        {
                            <span class="r41 r">c</span>.<span class="i">WriteWarning</span>(<span class="r40 r">warningRecord</span>.<span class="i">Message</span>);
                            <b>return</b> <span class="i">Enumerable</span>.<span class="i">Empty</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                        }),
                     <span class="i">swallowInvalidOperationExceptions</span>: <b>true</b>);
 
                <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <span id="r42 rd" class="r42 r">verboseHandler</span> = <span class="i">GetStreamForwarder</span>&lt;<a href="../hostifaces/InformationalRecord.cs.html#5d56339940b0040b" class="t t">VerboseRecord</a>&gt;(
                    <span id="r43 rd" class="r43 r">verboseRecord</span> =&gt; <span class="r31 r">mergedOutput</span>.<span class="i">Add</span>(
                        (<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r44 rd" class="r44 r">c</span>) =&gt;
                        {
                            <span class="r44 r">c</span>.<span class="i">WriteVerbose</span>(<span class="r43 r">verboseRecord</span>.<span class="i">Message</span>);
                            <b>return</b> <span class="i">Enumerable</span>.<span class="i">Empty</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                        }),
                     <span class="i">swallowInvalidOperationExceptions</span>: <b>true</b>);
 
                <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <span id="r45 rd" class="r45 r">debugHandler</span> = <span class="i">GetStreamForwarder</span>&lt;<a href="../hostifaces/InformationalRecord.cs.html#8954d4e40287d3de" class="t t">DebugRecord</a>&gt;(
                    <span id="r46 rd" class="r46 r">debugRecord</span> =&gt; <span class="r31 r">mergedOutput</span>.<span class="i">Add</span>(
                        (<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r47 rd" class="r47 r">c</span>) =&gt;
                        {
                            <span class="r47 r">c</span>.<span class="i">WriteDebug</span>(<span class="r46 r">debugRecord</span>.<span class="i">Message</span>);
                            <b>return</b> <span class="i">Enumerable</span>.<span class="i">Empty</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                        }),
                     <span class="i">swallowInvalidOperationExceptions</span>: <b>true</b>);
 
                <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <span id="r48 rd" class="r48 r">informationHandler</span> = <span class="i">GetStreamForwarder</span>&lt;<a href="../InformationRecord.cs.html#508a9dbac37ec093" class="t t">InformationRecord</a>&gt;(
                    <span id="r49 rd" class="r49 r">informationRecord</span> =&gt; <span class="r31 r">mergedOutput</span>.<span class="i">Add</span>(
                        (<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r50 rd" class="r50 r">c</span>) =&gt;
                        {
                            <span class="r50 r">c</span>.<span class="i">WriteInformation</span>(<span class="r49 r">informationRecord</span>);
                            <b>return</b> <span class="i">Enumerable</span>.<span class="i">Empty</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
                        }),
                     <span class="i">swallowInvalidOperationExceptions</span>: <b>true</b>);
 
                <span class="r32 r">asyncOutput</span>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += <span class="r33 r">outputHandler</span>;
                <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += <span class="r36 r">errorHandler</span>;
                <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#a0a7066f9b712955" class="i property">Warning</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += <span class="r39 r">warningHandler</span>;
                <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#8e878317a3e80c79" class="i property">Verbose</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += <span class="r42 r">verboseHandler</span>;
                <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#96bfebc26e0f381d" class="i property">Debug</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += <span class="r45 r">debugHandler</span>;
                <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#afec31161428f7a7" class="i property">Information</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += <span class="r48 r">informationHandler</span>;
 
                <b>try</b>
                {
                    <span class="c">// TODO/FIXME: ETW event for PowerShell invocation</span>
 
                    <b>var</b> <span id="r51 rd" class="r51 r">asyncResult</span> = <span class="r26 r">powerShell</span>.<span class="i">BeginInvoke</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>, <a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(
                        <span class="i">input</span>: <b>null</b>,
                        <span class="i">output</span>: <span class="r32 r">asyncOutput</span>,
                        <span class="i">settings</span>: <span class="r28 r">invocationSettings</span>,
                        <span class="i">callback</span>: <b>delegate</b>
                                  {
                                      <b>try</b>
                                      {
                                          <span class="r31 r">mergedOutput</span>.<span class="i">CompleteAdding</span>();
                                      }
                                      <b>catch</b> (<span class="i">InvalidOperationException</span>)
                                      <span class="c">// ignore exceptions thrown because mergedOutput.CompleteAdding was called</span>
                                      {
                                      }
                                  },
                        <span class="i">state</span>: <b>null</b>);
 
                    <b>using</b> (<span class="r30 r">cancellationToken</span>.<span class="i">Register</span>(<span class="r26 r">powerShell</span>.<span class="i">Stop</span>))
                    {
                        <b>try</b>
                        {
                            <b>foreach</b> (<span class="i">Func</span>&lt;<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a>, <span class="i">IEnumerable</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;&gt; <span id="r52 rd" class="r52 r">mergedOutputItem</span> <b>in</b> <span class="r31 r">mergedOutput</span>.<span class="i">GetConsumingEnumerable</span>())
                            {
                                <b>foreach</b> (<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r53 rd" class="r53 r">outputObject</span> <b>in</b> <span class="r52 r">mergedOutputItem</span>(<span class="r27 r">cmdlet</span>))
                                {
                                    <b>yield</b> <b>return</b> <span class="r53 r">outputObject</span>;
                                }
                            }
                        }
                        <b>finally</b>
                        {
                            <span class="r31 r">mergedOutput</span>.<span class="i">CompleteAdding</span>();
                            <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#e6f659e0f52c6eca" class="i method">EndInvoke</a>(<span class="r51 r">asyncResult</span>);
                        }
                    }
                }
                <b>finally</b>
                {
                    <span class="r32 r">asyncOutput</span>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> -= <span class="r33 r">outputHandler</span>;
                    <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> -= <span class="r36 r">errorHandler</span>;
                    <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#a0a7066f9b712955" class="i property">Warning</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> -= <span class="r39 r">warningHandler</span>;
                    <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#8e878317a3e80c79" class="i property">Verbose</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> -= <span class="r42 r">verboseHandler</span>;
                    <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#96bfebc26e0f381d" class="i property">Debug</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> -= <span class="r45 r">debugHandler</span>;
                    <span class="r26 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#afec31161428f7a7" class="i property">Information</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> -= <span class="r48 r">informationHandler</span>;
                }
            }
        }
 
        <b>private static</b> <span class="i">IEnumerable</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="73c9c4104bc73eb0" href="../../R/73c9c4104bc73eb0.html" target="n" data-glyph="76,1" class="i method">InvokeNestedPowerShell</a>(
            <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r54 rd" class="r54 r">powerShell</span>,
            <a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r55 rd" class="r55 r">cmdlet</span>,
            <a href="../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="t t">PSInvocationSettings</a> <span id="r56 rd" class="r56 r">invocationSettings</span>,
            <b>string</b> <span id="r57 rd" class="r57 r">errorMessageTemplate</span>,
            <span class="i">CancellationToken</span> <span id="r58 rd" class="r58 r">cancellationToken</span>)
        {
            <span class="i">EventHandler</span>&lt;<a href="../hostifaces/PSDataCollection.cs.html#7044b5d8986ab72f" class="t t">DataAddedEventArgs</a>&gt; <span id="r59 rd" class="r59 r">errorHandler</span> = <span class="i">GetStreamForwarder</span>&lt;<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a>&gt;(
                (<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r60 rd" class="r60 r">errorRecord</span>) =&gt;
                {
                    <span class="r60 r">errorRecord</span> = <a href="#eaf77f1c3c83e5ef" class="i method">GetErrorRecordForRemotePipelineInvocation</a>(<span class="r60 r">errorRecord</span>, <span class="r57 r">errorMessageTemplate</span>);
                    <a href="#b0caafc50af5cb8b" class="i method">HandleErrorFromPipeline</a>(<span class="r55 r">cmdlet</span>, <span class="r60 r">errorRecord</span>, <span class="r54 r">powerShell</span>);
                });
            <span class="r54 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> += <span class="r59 r">errorHandler</span>;
 
            <b>try</b>
            {
                <b>using</b> (<span class="r58 r">cancellationToken</span>.<span class="i">Register</span>(<span class="r54 r">powerShell</span>.<span class="i">Stop</span>))
                {
                    <span class="c">// TODO/FIXME: ETW event for PowerShell invocation</span>
 
                    <b>foreach</b> (<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a> <span id="r61 rd" class="r61 r">outputObject</span> <b>in</b> <span class="r54 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#bd533bb108571423" class="i method">Invoke</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;(<b>null</b>, <span class="r56 r">invocationSettings</span>))
                    {
                        <b>yield</b> <b>return</b> <span class="r61 r">outputObject</span>;
                    }
                }
            }
            <b>finally</b>
            {
                <span class="r54 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#622ebeade9b6ada7" class="i property">Streams</a>.<a href="../hostifaces/PowerShell.cs.html#ae04a604c26c6f7d" class="i property">Error</a>.<a href="../hostifaces/PSDataCollection.cs.html#de98d172ff9dac86" class="i">DataAdded</a> -= <span class="r59 r">errorHandler</span>;
            }
        }
 
        <b>private static void</b> <a id="5df15dfe033c1042" href="../../R/5df15dfe033c1042.html" target="n" data-glyph="76,1" class="i method">CopyParameterFromCmdletToPowerShell</a>(<a href="../cmdlet.cs.html#b0d421ff1d7581f9" class="t t">Cmdlet</a> <span id="r62 rd" class="r62 r">cmdlet</span>, <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r63 rd" class="r63 r">powerShell</span>, <b>string</b> <span id="r64 rd" class="r64 r">parameterName</span>)
        {
            <b>object</b> <span id="r65 rd" class="r65 r">parameterValue</span>;
            <b>if</b> (!<span class="r62 r">cmdlet</span>.<a href="../CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="../InvocationInfo.cs.html#1927782a0117ff76" class="i property">BoundParameters</a>.<span class="i">TryGetValue</span>(<span class="r64 r">parameterName</span>, <b>out</b> <span class="r65 r">parameterValue</span>))
            {
                <b>return</b>;
            }
 
            <a href="../hostifaces/Parameter.cs.html#4ce3ff8da8a0f8d9" class="k">var</a> <span id="r66 rd" class="r66 r">commandParameter</span> = <b>new</b> <a href="../hostifaces/Parameter.cs.html#2cdbc5f4adc8e89b" class="t constructor">CommandParameter</a>(<span class="r64 r">parameterName</span>, <span class="r65 r">parameterValue</span>);
            <b>foreach</b> (<b>var</b> <span id="r67 rd" class="r67 r">command</span> <b>in</b> <span class="r63 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#7bde27452e045465" class="i property">Commands</a>.<a href="../hostifaces/PSCommand.cs.html#cc9b22e4391a9870" class="i property">Commands</a>)
            {
                <b>if</b> (<span class="r67 r">command</span>.<span class="i">Parameters</span>.<span class="i">Any</span>(<span id="r68 rd" class="r68 r">existingParameter</span> =&gt; <span class="r68 r">existingParameter</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<span class="r64 r">parameterName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                {
                    <b>continue</b>;
                }
 
                <span class="r67 r">command</span>.<span class="i">Parameters</span>.<span class="i">Add</span>(<span class="r66 r">commandParameter</span>);
            }
        }
 
        <b>internal static</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="fb063eb9b792dbb8" href="../../R/fb063eb9b792dbb8.html" target="n" data-glyph="74,1" class="i method">GetErrorRecordForProcessingOfCimModule</a>(<span class="i">Exception</span> <span id="r69 rd" class="r69 r">innerException</span>, <b>string</b> <span id="r70 rd" class="r70 r">moduleName</span>)
        {
            <b>string</b> <span id="r71 rd" class="r71 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="i">Modules</span>.<span class="i">RemoteDiscoveryFailedToProcessRemoteModule</span>,
                <span class="r70 r">moduleName</span>,
                <span class="r69 r">innerException</span>.<span class="i">Message</span>);
 
            <span class="i">Exception</span> <span id="r72 rd" class="r72 r">outerException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r71 r">errorMessage</span>, <span class="r69 r">innerException</span>);
            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r73 rd" class="r73 r">errorRecord</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r72 r">outerException</span>, <span class="r69 r">innerException</span>.<span class="i">GetType</span>().<span class="i">Name</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <span class="r70 r">moduleName</span>);
            <b>return</b> <span class="r73 r">errorRecord</span>;
        }
 
        <b>private const string</b> <a id="bf7e082691fbb61a" href="../../R/bf7e082691fbb61a.html" target="n" data-glyph="10,1" class="i field">DiscoveryProviderNotFoundErrorId</a> = <span class="s">&quot;DiscoveryProviderNotFound&quot;</span>;
 
        <b>private static</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="357fc61a5e7b8366" href="../../R/357fc61a5e7b8366.html" target="n" data-glyph="76,1" class="i method">GetErrorRecordForRemoteDiscoveryProvider</a>(<span class="i">Exception</span> <span id="r74 rd" class="r74 r">innerException</span>)
        {
            <span class="i">CimException</span> <span id="r75 rd" class="r75 r">cimException</span> = <span class="r74 r">innerException</span> <b>as</b> <span class="i">CimException</span>;
            <b>if</b> ((<span class="r75 r">cimException</span> != <b>null</b>) &amp;&amp;
                ((<span class="r75 r">cimException</span>.<span class="i">NativeErrorCode</span> == <span class="i">NativeErrorCode</span>.<span class="i">InvalidNamespace</span>) ||
                 (<span class="r75 r">cimException</span>.<span class="i">NativeErrorCode</span> == <span class="i">NativeErrorCode</span>.<span class="i">InvalidClass</span>) ||
                 (<span class="r75 r">cimException</span>.<span class="i">NativeErrorCode</span> == <span class="i">NativeErrorCode</span>.<span class="i">MethodNotFound</span>) ||
                 (<span class="r75 r">cimException</span>.<span class="i">NativeErrorCode</span> == <span class="i">NativeErrorCode</span>.<span class="i">MethodNotAvailable</span>)))
            {
                <b>string</b> <span id="r76 rd" class="r76 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">Modules</span>.<span class="i">RemoteDiscoveryProviderNotFound</span>,
                    <span class="r74 r">innerException</span>.<span class="i">Message</span>);
                <span class="i">Exception</span> <span id="r77 rd" class="r77 r">outerException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r76 r">errorMessage</span>, <span class="r74 r">innerException</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r78 rd" class="r78 r">errorRecord</span> = <b>new</b> <a href="../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r77 r">outerException</span>, <a href="#bf7e082691fbb61a" class="i field">DiscoveryProviderNotFoundErrorId</a>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#8088845be39ec60c" class="i field">NotImplemented</a>, <b>null</b>);
                <b>return</b> <span class="r78 r">errorRecord</span>;
            }
            <b>else</b>
            {
                <b>string</b> <span id="r79 rd" class="r79 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                    <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                    <span class="i">Modules</span>.<span class="i">RemoteDiscoveryFailureFromDiscoveryProvider</span>,
                    <span class="r74 r">innerException</span>.<span class="i">Message</span>);
                <span class="i">Exception</span> <span id="r80 rd" class="r80 r">outerException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r79 r">errorMessage</span>, <span class="r74 r">innerException</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r81 rd" class="r81 r">errorRecord</span> = <b>new</b> <a href="../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r80 r">outerException</span>, <span class="s">&quot;DiscoveryProviderFailure&quot;</span>, <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>, <b>null</b>);
                <b>return</b> <span class="r81 r">errorRecord</span>;
            }
        }
 
        <b>private static</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="d799741cc141a082" href="../../R/d799741cc141a082.html" target="n" data-glyph="76,1" class="i method">GetErrorRecordForRemotePipelineInvocation</a>(<span class="i">Exception</span> <span id="r82 rd" class="r82 r">innerException</span>, <b>string</b> <span id="r83 rd" class="r83 r">errorMessageTemplate</span>)
        {
            <b>string</b> <span id="r84 rd" class="r84 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="r83 r">errorMessageTemplate</span>,
                <span class="r82 r">innerException</span>.<span class="i">Message</span>);
            <span class="i">Exception</span> <span id="r85 rd" class="r85 r">outerException</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r84 r">errorMessage</span>, <span class="r82 r">innerException</span>);
 
            <a href="../NativeCommandProcessor.cs.html#d56edc1842249736" class="t t">RemoteException</a> <span id="r86 rd" class="r86 r">remoteException</span> = <span class="r82 r">innerException</span> <b>as</b> <a href="../NativeCommandProcessor.cs.html#d56edc1842249736" class="t t">RemoteException</a>;
            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r87 rd" class="r87 r">remoteErrorRecord</span> = <span class="r86 r">remoteException</span>?.<a href="../NativeCommandProcessor.cs.html#ae7bb0007ca4088a" class="i property">ErrorRecord</a>;
            <b>string</b> <span id="r88 rd" class="r88 r">errorId</span> = <span class="r87 r">remoteErrorRecord</span> != <b>null</b> ? <span class="r87 r">remoteErrorRecord</span>.<a href="../ErrorPackage.cs.html#80d40f16f77d32bb" class="i property">FullyQualifiedErrorId</a> : <span class="r82 r">innerException</span>.<span class="i">GetType</span>().<span class="i">Name</span>;
            <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a> <span id="r89 rd" class="r89 r">errorCategory</span> = <span class="r87 r">remoteErrorRecord</span> != <b>null</b> ? <span class="r87 r">remoteErrorRecord</span>.<a href="../ErrorPackage.cs.html#ad21d23bc150cd3b" class="i property">CategoryInfo</a>.<a href="../ErrorPackage.cs.html#f4073b5e554619ca" class="i property">Category</a> : <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#707bbec7a1bb5ead" class="i field">NotSpecified</a>;
            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r90 rd" class="r90 r">errorRecord</span> = <b>new</b> <a href="../ErrorPackage.cs.html#e9334565e5136f43" class="t constructor">ErrorRecord</a>(<span class="r85 r">outerException</span>, <span class="r88 r">errorId</span>, <span class="r89 r">errorCategory</span>, <b>null</b>);
 
            <b>return</b> <span class="r90 r">errorRecord</span>;
        }
 
        <b>private static</b> <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <a id="eaf77f1c3c83e5ef" href="../../R/eaf77f1c3c83e5ef.html" target="n" data-glyph="76,1" class="i method">GetErrorRecordForRemotePipelineInvocation</a>(<a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r91 rd" class="r91 r">innerErrorRecord</span>, <b>string</b> <span id="r92 rd" class="r92 r">errorMessageTemplate</span>)
        {
            <b>string</b> <span id="r93 rd" class="r93 r">innerErrorMessage</span>;
            <b>if</b> (<span class="r91 r">innerErrorRecord</span>.<a href="../ErrorPackage.cs.html#4e9df045b6372ce0" class="i property">ErrorDetails</a> != <b>null</b> &amp;&amp; <span class="r91 r">innerErrorRecord</span>.<a href="../ErrorPackage.cs.html#4e9df045b6372ce0" class="i property">ErrorDetails</a>.<a href="../ErrorPackage.cs.html#589bef4648ccf37a" class="i property">Message</a> != <b>null</b>)
            {
                <span class="r93 r">innerErrorMessage</span> = <span class="r91 r">innerErrorRecord</span>.<a href="../ErrorPackage.cs.html#4e9df045b6372ce0" class="i property">ErrorDetails</a>.<a href="../ErrorPackage.cs.html#589bef4648ccf37a" class="i property">Message</a>;
            }
            <b>else</b> <b>if</b> (<span class="r91 r">innerErrorRecord</span>.<a href="../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a> != <b>null</b> &amp;&amp; <span class="r91 r">innerErrorRecord</span>.<a href="../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>.<span class="i">Message</span> != <b>null</b>)
            {
                <span class="r93 r">innerErrorMessage</span> = <span class="r91 r">innerErrorRecord</span>.<a href="../ErrorPackage.cs.html#2c2498db91e737eb" class="i property">Exception</a>.<span class="i">Message</span>;
            }
            <b>else</b>
            {
                <span class="r93 r">innerErrorMessage</span> = <span class="r91 r">innerErrorRecord</span>.<a href="../ErrorPackage.cs.html#cab659be098926dd" class="i method">ToString</a>();
            }
 
            <b>string</b> <span id="r94 rd" class="r94 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="r92 r">errorMessageTemplate</span>,
                <span class="r93 r">innerErrorMessage</span>);
 
            <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r95 rd" class="r95 r">outerErrorRecord</span> = <b>new</b> <a href="../ErrorPackage.cs.html#9d778b0f7802757e" class="t constructor">ErrorRecord</a>(<span class="r91 r">innerErrorRecord</span>, <b>null</b> <span class="c">/* null means: do not replace the exception */</span>);
            <a href="../ErrorPackage.cs.html#d882fa1d2308673f" class="t t">ErrorDetails</a> <span id="r96 rd" class="r96 r">outerErrorDetails</span> = <b>new</b> <a href="../ErrorPackage.cs.html#908615d662085fc6" class="t constructor">ErrorDetails</a>(<span class="r94 r">errorMessage</span>);
            <span class="r95 r">outerErrorRecord</span>.<a href="../ErrorPackage.cs.html#4e9df045b6372ce0" class="i property">ErrorDetails</a> = <span class="r96 r">outerErrorDetails</span>;
 
            <b>return</b> <span class="r95 r">outerErrorRecord</span>;
        }
 
        <b>private static</b> <span class="i">IEnumerable</span>&lt;<span class="r97 r t">T</span>&gt; <a id="c0f7cfdce96973fd" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">EnumerateWithCatch</a>&lt;<span id="r97 rd t" class="r97 r t">T</span>&gt;(<span class="i">IEnumerable</span>&lt;<span class="r97 r t">T</span>&gt; <span id="r98 rd" class="r98 r">enumerable</span>, <span class="i">Action</span>&lt;<span class="i">Exception</span>&gt; <span id="r99 rd" class="r99 r">exceptionHandler</span>)
        {
            <span class="i">IEnumerator</span>&lt;<span class="r97 r t">T</span>&gt; <span id="r100 rd" class="r100 r">enumerator</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r100 r">enumerator</span> = <span class="r98 r">enumerable</span>.<span class="i">GetEnumerator</span>();
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r101 rd" class="r101 r">e</span>)
            {
                <span class="r99 r">exceptionHandler</span>(<span class="r101 r">e</span>);
            }
 
            <b>if</b> (<span class="r100 r">enumerator</span> != <b>null</b>)
                <b>using</b> (<span class="r100 r">enumerator</span>)
                {
                    <b>bool</b> <span id="r102 rd" class="r102 r">gotResults</span> = <b>false</b>;
                    <b>do</b>
                    {
                        <b>try</b>
                        {
                            <span class="r102 r">gotResults</span> = <b>false</b>;
                            <span class="r102 r">gotResults</span> = <span class="r100 r">enumerator</span>.<span class="i">MoveNext</span>();
                        }
                        <b>catch</b> (<span class="i">Exception</span> <span id="r103 rd" class="r103 r">e</span>)
                        {
                            <span class="r99 r">exceptionHandler</span>(<span class="r103 r">e</span>);
                        }
 
                        <b>if</b> (<span class="r102 r">gotResults</span>)
                        {
                            <span class="r97 r t">T</span> <span id="r104 rd" class="r104 r">currentItem</span> = <b>default</b>(<span class="r97 r t">T</span>);
                            <b>bool</b> <span id="r105 rd" class="r105 r">gotCurrentItem</span> = <b>false</b>;
                            <b>try</b>
                            {
                                <span class="r104 r">currentItem</span> = <span class="r100 r">enumerator</span>.<span class="i">Current</span>;
                                <span class="r105 r">gotCurrentItem</span> = <b>true</b>;
                            }
                            <b>catch</b> (<span class="i">Exception</span> <span id="r106 rd" class="r106 r">e</span>)
                            {
                                <span class="r99 r">exceptionHandler</span>(<span class="r106 r">e</span>);
                            }
 
                            <b>if</b> (<span class="r105 r">gotCurrentItem</span>)
                            {
                                <b>yield</b> <b>return</b> <span class="r104 r">currentItem</span>;
                            }
                            <b>else</b>
                            {
                                <b>yield</b> <b>break</b>;
                            }
                        }
                    } <b>while</b> (<span class="r102 r">gotResults</span>);
                }
        }
 
        <b>private static void</b> <a id="b0caafc50af5cb8b" href="../../R/b0caafc50af5cb8b.html" target="n" data-glyph="76,1" class="i method">HandleErrorFromPipeline</a>(<a href="../cmdlet.cs.html#b0d421ff1d7581f9" class="t t">Cmdlet</a> <span id="r107 rd" class="r107 r">cmdlet</span>, <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r108 rd" class="r108 r">errorRecord</span>, <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r109 rd" class="r109 r">powerShell</span>)
        {
            <b>if</b> (!<span class="r107 r">cmdlet</span>.<a href="../CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="../InvocationInfo.cs.html#9a1646f37a942067" class="i property">ExpectingInput</a>)
            {
                <b>if</b> (((<span class="r109 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#ccf57242c9d46642" class="i property">Runspace</a> != <b>null</b>) &amp;&amp; (<span class="r109 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#ccf57242c9d46642" class="i property">Runspace</a>.<a href="../hostifaces/Connection.cs.html#01b12fbdab6c561a" class="i property">RunspaceStateInfo</a>.<a href="../hostifaces/Connection.cs.html#41627f067662d11c" class="i property">State</a> != <a href="../hostifaces/Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="../hostifaces/Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)) ||
                    ((<span class="r109 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#04184898f9307df6" class="i property">RunspacePool</a> != <b>null</b>) &amp;&amp; (<span class="r109 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#04184898f9307df6" class="i property">RunspacePool</a>.<a href="../hostifaces/RunspacePool.cs.html#a7f9e215f0cbb1ce" class="i property">RunspacePoolStateInfo</a>.<a href="../remoting/common/RunspacePoolStateInfo.cs.html#1260ebc06dcda58e" class="i property">State</a> != <a href="../hostifaces/RunspacePool.cs.html#b51dd15975151fb4" class="t t">RunspacePoolState</a>.<a href="../hostifaces/RunspacePool.cs.html#13cbf83371c004e0" class="i field">Opened</a>)))
                {
                    <span class="r107 r">cmdlet</span>.<a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r108 r">errorRecord</span>);
                }
            }
 
            <span class="r107 r">cmdlet</span>.<a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r108 r">errorRecord</span>);
        }
 
        <b>internal static</b> <span class="i">IEnumerable</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="f394b222fb6b3761" href="../../R/f394b222fb6b3761.html" target="n" data-glyph="74,1" class="i method">InvokePowerShell</a>(
            <a href="../hostifaces/PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <span id="r110 rd" class="r110 r">powerShell</span>,
            <a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r111 rd" class="r111 r">cmdlet</span>,
            <b>string</b> <span id="r112 rd" class="r112 r">errorMessageTemplate</span>,
            <span class="i">CancellationToken</span> <span id="r113 rd" class="r113 r">cancellationToken</span>)
        {
            <a href="#5df15dfe033c1042" class="i method">CopyParameterFromCmdletToPowerShell</a>(<span class="r111 r">cmdlet</span>, <span class="r110 r">powerShell</span>, <span class="s">&quot;ErrorAction&quot;</span>);
            <a href="#5df15dfe033c1042" class="i method">CopyParameterFromCmdletToPowerShell</a>(<span class="r111 r">cmdlet</span>, <span class="r110 r">powerShell</span>, <span class="s">&quot;WarningAction&quot;</span>);
            <a href="#5df15dfe033c1042" class="i method">CopyParameterFromCmdletToPowerShell</a>(<span class="r111 r">cmdlet</span>, <span class="r110 r">powerShell</span>, <span class="s">&quot;InformationAction&quot;</span>);
            <a href="#5df15dfe033c1042" class="i method">CopyParameterFromCmdletToPowerShell</a>(<span class="r111 r">cmdlet</span>, <span class="r110 r">powerShell</span>, <span class="s">&quot;Verbose&quot;</span>);
            <a href="#5df15dfe033c1042" class="i method">CopyParameterFromCmdletToPowerShell</a>(<span class="r111 r">cmdlet</span>, <span class="r110 r">powerShell</span>, <span class="s">&quot;Debug&quot;</span>);
 
            <a href="../hostifaces/PowerShell.cs.html#ce65c0834aa6f0ea" class="k">var</a> <span id="r114 rd" class="r114 r">invocationSettings</span> = <b>new</b> <a href="../hostifaces/PowerShell.cs.html#3f472392b2d45c15" class="t constructor">PSInvocationSettings</a> { <a href="../hostifaces/PowerShell.cs.html#2088d9ba09399d1e" class="i property">Host</a> = <span class="r111 r">cmdlet</span>.<a href="../CommandBase.cs.html#01105ebe2065fe1b" class="i property">Host</a> };
 
            <span class="c">// TODO/FIXME: ETW events for the output stream</span>
            <span class="i">IEnumerable</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <span id="r115 rd" class="r115 r">outputStream</span> = <span class="r110 r">powerShell</span>.<a href="../hostifaces/PowerShell.cs.html#32c156c0cba25702" class="i property">IsNested</a>
                ? <a href="#73c9c4104bc73eb0" class="i method">InvokeNestedPowerShell</a>(<span class="r110 r">powerShell</span>, <span class="r111 r">cmdlet</span>, <span class="r114 r">invocationSettings</span>, <span class="r112 r">errorMessageTemplate</span>, <span class="r113 r">cancellationToken</span>)
                : <a href="#cf3148a6866ea025" class="i method">InvokeTopLevelPowerShell</a>(<span class="r110 r">powerShell</span>, <span class="r111 r">cmdlet</span>, <span class="r114 r">invocationSettings</span>, <span class="r112 r">errorMessageTemplate</span>, <span class="r113 r">cancellationToken</span>);
 
            <b>return</b> <span class="i">EnumerateWithCatch</span>(
                <span class="r115 r">outputStream</span>,
                (<span class="i">Exception</span> <span id="r116 rd" class="r116 r">exception</span>) =&gt;
                {
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r117 rd" class="r117 r">errorRecord</span> = <a href="#d799741cc141a082" class="i method">GetErrorRecordForRemotePipelineInvocation</a>(<span class="r116 r">exception</span>, <span class="r112 r">errorMessageTemplate</span>);
                    <a href="#b0caafc50af5cb8b" class="i method">HandleErrorFromPipeline</a>(<span class="r111 r">cmdlet</span>, <span class="r117 r">errorRecord</span>, <span class="r110 r">powerShell</span>);
                });
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> PSRP
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> CIM
 
        <b>private const string</b> <a id="4b031d9c001caa3b" href="../../R/4b031d9c001caa3b.html" target="n" data-glyph="10,1" class="i field">DiscoveryProviderNamespace</a> = <span class="s">&quot;root/Microsoft/Windows/Powershellv3&quot;</span>;
        <b>private const string</b> <a id="1ecedc9c93876c71" href="../../R/1ecedc9c93876c71.html" target="n" data-glyph="10,1" class="i field">DiscoveryProviderModuleClass</a> = <span class="s">&quot;PS_Module&quot;</span>;
        <b>private const string</b> <a id="a3e8545ca08c9f4f" href="../../R/a3e8545ca08c9f4f.html" target="n" data-glyph="10,1" class="i field">DiscoveryProviderFileClass</a> = <span class="s">&quot;PS_ModuleFile&quot;</span>;
        <b>private const string</b> <a id="2a58a5f5bf226a09" href="../../R/2a58a5f5bf226a09.html" target="n" data-glyph="10,1" class="i field">DiscoveryProviderAssociationClass</a> = <span class="s">&quot;PS_ModuleToModuleFile&quot;</span>;
 
        <b>private static</b> <span class="r118 r t">T</span> <a id="916f4a6fdcff9853" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetPropertyValue</a>&lt;<span id="r118 rd t" class="r118 r t">T</span>&gt;(<span class="i">CimInstance</span> <span id="r119 rd" class="r119 r">cimInstance</span>, <b>string</b> <span id="r120 rd" class="r120 r">propertyName</span>, <span class="r118 r t">T</span> <span id="r121 rd" class="r121 r">defaultValue</span>)
        {
            <span class="i">CimProperty</span> <span id="r122 rd" class="r122 r">cimProperty</span> = <span class="r119 r">cimInstance</span>.<span class="i">CimInstanceProperties</span>[<span class="r120 r">propertyName</span>];
            <b>if</b> (<span class="r122 r">cimProperty</span> == <b>null</b>)
            {
                <b>return</b> <span class="r121 r">defaultValue</span>;
            }
 
            <b>object</b> <span id="r123 rd" class="r123 r">propertyValue</span> = <span class="r122 r">cimProperty</span>.<span class="i">Value</span>;
            <b>if</b> (<span class="r123 r">propertyValue</span> <b>is</b> <span class="r118 r t">T</span>)
            {
                <b>return</b> (<span class="r118 r t">T</span>)<span class="r123 r">propertyValue</span>;
            }
 
            <b>if</b> (<span class="r123 r">propertyValue</span> <b>is string</b>)
            {
                <b>string</b> <span id="r124 rd" class="r124 r">stringValue</span> = (<b>string</b>)<span class="r123 r">propertyValue</span>;
                <b>try</b>
                {
                    <b>if</b> (<b>typeof</b>(<span class="r118 r t">T</span>) == <b>typeof</b>(<b>bool</b>))
                    {
                        <b>return</b> (<span class="r118 r t">T</span>)(<b>object</b>)<span class="i">XmlConvert</span>.<span class="i">ToBoolean</span>(<span class="r124 r">stringValue</span>);
                    }
                    <b>else</b> <b>if</b> (<b>typeof</b>(<span class="r118 r t">T</span>) == <b>typeof</b>(<span class="i">UInt16</span>))
                    {
                        <b>return</b> (<span class="r118 r t">T</span>)(<b>object</b>)<span class="i">UInt16</span>.<span class="i">Parse</span>(<span class="r124 r">stringValue</span>, <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                    }
                    <b>else</b> <b>if</b> (<b>typeof</b>(<span class="r118 r t">T</span>) == <b>typeof</b>(<b>byte</b>[]))
                    {
                        <b>byte</b>[] <span id="r125 rd" class="r125 r">contentBytes</span> = <span class="i">Convert</span>.<span class="i">FromBase64String</span>(<span class="r124 r">stringValue</span>);
                        <b>byte</b>[] <span id="r126 rd" class="r126 r">lengthBytes</span> = <span class="i">BitConverter</span>.<span class="i">GetBytes</span>(<span class="r125 r">contentBytes</span>.<span class="i">Length</span> + 4);
                        <b>if</b> (<span class="i">BitConverter</span>.<span class="i">IsLittleEndian</span>)
                        {
                            <span class="i">Array</span>.<span class="i">Reverse</span>(<span class="r126 r">lengthBytes</span>);
                        }
 
                        <b>return</b> (<span class="r118 r t">T</span>)(<b>object</b>)(<span class="r126 r">lengthBytes</span>.<span class="i">Concat</span>(<span class="r125 r">contentBytes</span>).<span class="i">ToArray</span>());
                    }
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                    <b>return</b> <span class="r121 r">defaultValue</span>;
                }
            }
 
            <b>return</b> <span class="r121 r">defaultValue</span>;
        }
 
        <b>internal enum</b> <a id="f81902c09fdd4562" href="../../R/f81902c09fdd4562.html" target="n" data-glyph="20,1" class="t t"><span id="0d3931585f206e89">CimFileCode</span></a>
        {
            <a id="18fcef994e2ff1e8" href="../../R/18fcef994e2ff1e8.html" target="n" data-glyph="24,2" class="i field">Unknown</a> = 0,
            <a id="9da8e73d1e00b066" href="../../R/9da8e73d1e00b066.html" target="n" data-glyph="24,2" class="i field">PsdV1</a>,
            <a id="6e703c46dd5149fd" href="../../R/6e703c46dd5149fd.html" target="n" data-glyph="24,2" class="i field">TypesV1</a>,
            <a id="a345de8d241059c4" href="../../R/a345de8d241059c4.html" target="n" data-glyph="24,2" class="i field">FormatV1</a>,
            <a id="8c583ae4f2412782" href="../../R/8c583ae4f2412782.html" target="n" data-glyph="24,2" class="i field">CmdletizationV1</a>,
        }
 
        <b>internal abstract class</b> <a id="50fcbb8879b7a032" href="../../R/50fcbb8879b7a032.html" target="n" data-glyph="2,1" class="t t"><span id="981e179744f38b12">CimModuleFile</span></a>
        {
            <b>public</b> <a href="#f81902c09fdd4562" class="t t">CimFileCode</a> <a id="9109df2064141e83" href="../../R/9109df2064141e83.html" target="n" data-glyph="102,2" class="i property">FileCode</a>
            {
                <b>get</b>
                {
                    <b>if</b> (<a href="#50fcbb8879b7a032" class="k">this</a>.<a href="#f18c0cb08ecbfe74" class="i property">FileName</a>.<span class="i">EndsWith</span>(<span class="s">&quot;.psd1&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>return</b> <a href="#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="#9da8e73d1e00b066" class="i field">PsdV1</a>;
                    }
 
                    <b>if</b> (<a href="#50fcbb8879b7a032" class="k">this</a>.<a href="#f18c0cb08ecbfe74" class="i property">FileName</a>.<span class="i">EndsWith</span>(<span class="s">&quot;.cdxml&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>return</b> <a href="#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="#8c583ae4f2412782" class="i field">CmdletizationV1</a>;
                    }
 
                    <b>if</b> (<a href="#50fcbb8879b7a032" class="k">this</a>.<a href="#f18c0cb08ecbfe74" class="i property">FileName</a>.<span class="i">EndsWith</span>(<span class="s">&quot;.types.ps1xml&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>return</b> <a href="#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="#6e703c46dd5149fd" class="i field">TypesV1</a>;
                    }
 
                    <b>if</b> (<a href="#50fcbb8879b7a032" class="k">this</a>.<a href="#f18c0cb08ecbfe74" class="i property">FileName</a>.<span class="i">EndsWith</span>(<span class="s">&quot;.format.ps1xml&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    {
                        <b>return</b> <a href="#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="#a345de8d241059c4" class="i field">FormatV1</a>;
                    }
 
                    <b>return</b> <a href="#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="#18fcef994e2ff1e8" class="i field">Unknown</a>;
                }
            }
 
            <b>public abstract string</b> <a id="f18c0cb08ecbfe74" href="../../R/f18c0cb08ecbfe74.html" target="n" data-glyph="102,2" class="i property">FileName</a> { <b>get</b>; }
 
            <b>internal abstract byte</b>[] <a id="361b4539dae63348" href="../../R/361b4539dae63348.html" target="n" data-glyph="104,2" class="i property">RawFileDataCore</a> { <b>get</b>; }
 
            <b>public byte</b>[] <a id="5596dc2b05423db8" href="../../R/5596dc2b05423db8.html" target="n" data-glyph="102,2" class="i property">RawFileData</a>
            {
                <b>get</b> { <b>return</b> <a href="#50fcbb8879b7a032" class="k">this</a>.<a href="#361b4539dae63348" class="i property">RawFileDataCore</a>.<span class="i">Skip</span>(4).<span class="i">ToArray</span>(); }
            }
 
            <b>public string</b> <a id="40166c7ea776ab2b" href="../../R/40166c7ea776ab2b.html" target="n" data-glyph="102,2" class="i property">FileData</a>
            {
                <b>get</b>
                {
                    <b>if</b> (<a href="#c4cb5cfef546eec6" class="i field">_fileData</a> == <b>null</b>)
                    {
                        <b>using</b> (<b>var</b> <span id="r127 rd" class="r127 r">ms</span> = <b>new</b> <span class="i">MemoryStream</span>(<a href="#50fcbb8879b7a032" class="k">this</a>.<a href="#5596dc2b05423db8" class="i property">RawFileData</a>))
                        <b>using</b> (<b>var</b> <span id="r128 rd" class="r128 r">sr</span> = <b>new</b> <span class="i">StreamReader</span>(<span class="r127 r">ms</span>, <span class="i">detectEncodingFromByteOrderMarks</span>: <b>true</b>))
                        {
                            <a href="#c4cb5cfef546eec6" class="i field">_fileData</a> = <span class="r128 r">sr</span>.<span class="i">ReadToEnd</span>();
                        }
                    }
 
                    <b>return</b> <a href="#c4cb5cfef546eec6" class="i field">_fileData</a>;
                }
            }
 
            <b>private string</b> <a id="c4cb5cfef546eec6" href="../../R/c4cb5cfef546eec6.html" target="n" data-glyph="46,2" class="i field">_fileData</a>;
        }
 
        <b>internal class</b> <a id="b5270f565e4adb8f" href="../../R/b5270f565e4adb8f.html" target="n" data-glyph="2,1" class="t t">CimModule</a>
        {
            <b>private readonly</b> <span class="i">CimInstance</span> <a id="c2e851fdc5aac067" href="../../R/c2e851fdc5aac067.html" target="n" data-glyph="46,2" class="i field">_baseObject</a>;
 
            <b>internal</b> <a id="f71e081ad196ec29" href="../../R/../../0000000000.html" target="n" data-glyph="74,2" class="t constructor">CimModule</a>(<span class="i">CimInstance</span> <span id="r129 rd" class="r129 r">baseObject</span>)
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r129 r">baseObject</span> != <b>null</b>, <span class="s">&quot;Caller should make sure baseObject != null&quot;</span>);
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(
                    <span class="r129 r">baseObject</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>.<span class="i">Equals</span>(<a href="#1ecedc9c93876c71" class="i field">DiscoveryProviderModuleClass</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>),
                    <span class="s">&quot;Caller should make sure baseObject is an instance of the right CIM class&quot;</span>);
 
                <a href="#c2e851fdc5aac067" class="i field">_baseObject</a> = <span class="r129 r">baseObject</span>;
            }
 
            <b>public string</b> <a id="b1ff4be69e452ccc" href="../../R/b1ff4be69e452ccc.html" target="n" data-glyph="102,2" class="i property">ModuleName</a>
            {
                <b>get</b>
                {
                    <b>var</b> <span id="r130 rd" class="r130 r">rawModuleName</span> = <span class="i">GetPropertyValue</span>&lt;<b>string</b>&gt;(<a href="#c2e851fdc5aac067" class="i field">_baseObject</a>, <span class="s">&quot;ModuleName&quot;</span>, <b>string</b>.<span class="i">Empty</span>);
                    <b>return</b> <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r130 r">rawModuleName</span>);
                }
            }
 
            <b>private enum</b> <a id="9d4f3a8a8c0bf0a1" href="../../R/9d4f3a8a8c0bf0a1.html" target="n" data-glyph="22,2" class="t t"><span id="af3ebe444eeedb4b">DiscoveredModuleType</span></a> : <b>ushort</b>
            {
                <a id="598ef868df47c1cf" href="../../R/../../0000000000.html" target="n" data-glyph="24,3" class="i field">Unknown</a> = 0,
                <a id="5a290a6da8b3fdcc" href="../../R/5a290a6da8b3fdcc.html" target="n" data-glyph="24,3" class="i field">Cim</a> = 1,
            }
 
            <b>public bool</b> <a id="b16bfcd89c8acdfe" href="../../R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">IsPsCimModule</a>
            {
                <b>get</b>
                {
                    <span class="i">UInt16</span> <span id="r131 rd" class="r131 r">moduleTypeInt</span> = <span class="i">GetPropertyValue</span>&lt;<span class="i">UInt16</span>&gt;(<a href="#c2e851fdc5aac067" class="i field">_baseObject</a>, <span class="s">&quot;ModuleType&quot;</span>, 0);
                    <a href="#9d4f3a8a8c0bf0a1" class="t t">DiscoveredModuleType</a> <span id="r132 rd" class="r132 r">moduleType</span> = (<a href="#9d4f3a8a8c0bf0a1" class="t t">DiscoveredModuleType</a>)<span class="r131 r">moduleTypeInt</span>;
                    <b>bool</b> <span id="r133 rd" class="r133 r">isPsCimModule</span> = (<span class="r132 r">moduleType</span> == <a href="#9d4f3a8a8c0bf0a1" class="t t">DiscoveredModuleType</a>.<a href="#5a290a6da8b3fdcc" class="i field">Cim</a>);
                    <b>return</b> <span class="r133 r">isPsCimModule</span>;
                }
            }
 
            <b>public</b> <a href="#50fcbb8879b7a032" class="t t">CimModuleFile</a> <a id="ce5161a2a2d89c39" href="../../R/ce5161a2a2d89c39.html" target="n" data-glyph="102,2" class="i property">MainManifest</a>
            {
                <b>get</b>
                {
                    <b>byte</b>[] <span id="r134 rd" class="r134 r">rawFileData</span> = <span class="i">GetPropertyValue</span>&lt;<b>byte</b>[]&gt;(<a href="#c2e851fdc5aac067" class="i field">_baseObject</a>, <span class="s">&quot;moduleManifestFileData&quot;</span>, <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>byte</b>&gt;());
                    <b>return</b> <b>new</b> <span class="t">CimModuleManifestFile</span>(<a href="#b5270f565e4adb8f" class="k">this</a>.<a href="#b1ff4be69e452ccc" class="i property">ModuleName</a> + <span class="s">&quot;.psd1&quot;</span>, <span class="r134 r">rawFileData</span>);
                }
            }
 
            <b>public</b> <span class="i">IEnumerable</span>&lt;<a href="#50fcbb8879b7a032" class="t t">CimModuleFile</a>&gt; <a id="ae0083ee9392c666" href="../../R/ae0083ee9392c666.html" target="n" data-glyph="102,2" class="i property">ModuleFiles</a>
            {
                <b>get</b> { <b>return</b> <a href="#24b51ebd6264e22e" class="i field">_moduleFiles</a>; }
            }
 
            <b>internal void</b> <a id="22e0207839874dba" href="../../R/22e0207839874dba.html" target="n" data-glyph="74,2" class="i method">FetchAllModuleFiles</a>(<span class="i">CimSession</span> <span id="r135 rd" class="r135 r">cimSession</span>, <b>string</b> <span id="r136 rd" class="r136 r">cimNamespace</span>, <span class="i">CimOperationOptions</span> <span id="r137 rd" class="r137 r">operationOptions</span>)
            {
                <span class="i">IEnumerable</span>&lt;<span class="i">CimInstance</span>&gt; <span id="r138 rd" class="r138 r">associatedInstances</span> = <span class="r135 r">cimSession</span>.<span class="i">EnumerateAssociatedInstances</span>(
                    <span class="r136 r">cimNamespace</span>,
                    <a href="#c2e851fdc5aac067" class="i field">_baseObject</a>,
                    <a href="#2a58a5f5bf226a09" class="i field">DiscoveryProviderAssociationClass</a>,
                    <a href="#a3e8545ca08c9f4f" class="i field">DiscoveryProviderFileClass</a>,
                    <span class="s">&quot;Antecedent&quot;</span>,
                    <span class="s">&quot;Dependent&quot;</span>,
                    <span class="r137 r">operationOptions</span>);
 
                <span class="i">IEnumerable</span>&lt;<a href="#50fcbb8879b7a032" class="t t">CimModuleFile</a>&gt; <span id="r139 rd" class="r139 r">associatedFiles</span> = <span class="r138 r">associatedInstances</span>.<span class="i">Select</span>(<b>static</b> <span id="r140 rd" class="r140 r">i</span> =&gt; <b>new</b> <span class="t">CimModuleImplementationFile</span>(<span class="r140 r">i</span>));
                <a href="#24b51ebd6264e22e" class="i field">_moduleFiles</a> = <span class="r139 r">associatedFiles</span>.<span class="i">ToList</span>();
            }
 
            <b>private</b> <span class="i">List</span>&lt;<a href="#50fcbb8879b7a032" class="t t">CimModuleFile</a>&gt; <a id="24b51ebd6264e22e" href="../../R/24b51ebd6264e22e.html" target="n" data-glyph="46,2" class="i field">_moduleFiles</a>;
 
            <b>private sealed class</b> <a id="f44b6d800f1ec802" href="../../R/../../0000000000.html" target="n" data-glyph="4,2" class="t t">CimModuleManifestFile</a> : <a href="#50fcbb8879b7a032" class="t t">CimModuleFile</a>
            {
                <b>internal</b> <a id="40772c945dd7ffea" href="../../R/../../0000000000.html" target="n" data-glyph="74,3" class="t constructor">CimModuleManifestFile</a>(<b>string</b> <span id="r141 rd" class="r141 r">fileName</span>, <b>byte</b>[] <span id="r142 rd" class="r142 r">rawFileData</span>)
                {
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r141 r">fileName</span> != <b>null</b>, <span class="s">&quot;Caller should make sure fileName != null&quot;</span>);
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r142 r">rawFileData</span> != <b>null</b>, <span class="s">&quot;Caller should make sure rawFileData != null&quot;</span>);
 
                    <a href="#de96401942fb6e63" class="i property">FileName</a> = <span class="r141 r">fileName</span>;
                    <a href="#d3d309930e8b5200" class="i property">RawFileDataCore</a> = <span class="r142 r">rawFileData</span>;
                }
 
                <b>public override string</b> <a id="de96401942fb6e63" href="../../R/de96401942fb6e63.html" target="n" data-glyph="102,3" class="i property">FileName</a> { <b>get</b>; }
 
                <b>internal override byte</b>[] <a id="d3d309930e8b5200" href="../../R/d3d309930e8b5200.html" target="n" data-glyph="104,3" class="i property">RawFileDataCore</a> { <b>get</b>; }
            }
 
            <b>private sealed class</b> <a id="82a2754af56517a7" href="../../R/../../0000000000.html" target="n" data-glyph="4,2" class="t t">CimModuleImplementationFile</a> : <a href="#50fcbb8879b7a032" class="t t">CimModuleFile</a>
            {
                <b>private readonly</b> <span class="i">CimInstance</span> <a id="6f994c0487478696" href="../../R/6f994c0487478696.html" target="n" data-glyph="46,3" class="i field">_baseObject</a>;
 
                <b>internal</b> <a id="34aae1afa2757b23" href="../../R/../../0000000000.html" target="n" data-glyph="74,3" class="t constructor">CimModuleImplementationFile</a>(<span class="i">CimInstance</span> <span id="r143 rd" class="r143 r">baseObject</span>)
                {
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r143 r">baseObject</span> != <b>null</b>, <span class="s">&quot;Caller should make sure baseObject != null&quot;</span>);
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<span class="i">Assert</span>(
                        <span class="r143 r">baseObject</span>.<span class="i">CimSystemProperties</span>.<span class="i">ClassName</span>.<span class="i">Equals</span>(<a href="#a3e8545ca08c9f4f" class="i field">DiscoveryProviderFileClass</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>),
                        <span class="s">&quot;Caller should make sure baseObject is an instance of the right CIM class&quot;</span>);
 
                    <a href="#6f994c0487478696" class="i field">_baseObject</a> = <span class="r143 r">baseObject</span>;
                }
 
                <b>public override string</b> <a id="72f7ae05b63286ea" href="../../R/72f7ae05b63286ea.html" target="n" data-glyph="102,3" class="i property">FileName</a>
                {
                    <b>get</b>
                    {
                        <b>string</b> <span id="r144 rd" class="r144 r">rawFileName</span> = <span class="i">GetPropertyValue</span>&lt;<b>string</b>&gt;(<a href="#6f994c0487478696" class="i field">_baseObject</a>, <span class="s">&quot;FileName&quot;</span>, <b>string</b>.<span class="i">Empty</span>);
                        <b>return</b> <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r144 r">rawFileName</span>);
                    }
                }
 
                <b>internal override byte</b>[] <a id="18b53c68b3b71819" href="../../R/18b53c68b3b71819.html" target="n" data-glyph="104,3" class="i property">RawFileDataCore</a>
                {
                    <b>get</b> { <b>return</b> <span class="i">GetPropertyValue</span>&lt;<b>byte</b>[]&gt;(<a href="#6f994c0487478696" class="i field">_baseObject</a>, <span class="s">&quot;FileData&quot;</span>, <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>byte</b>&gt;()); }
                }
            }
        }
 
        <b>internal static</b> <span class="i">IEnumerable</span>&lt;<a href="#b5270f565e4adb8f" class="t t">CimModule</a>&gt; <a id="b74aa1f011faf71c" href="../../R/b74aa1f011faf71c.html" target="n" data-glyph="74,1" class="i method">GetCimModules</a>(
            <span class="i">CimSession</span> <span id="r145 rd" class="r145 r">cimSession</span>,
            <span class="i">Uri</span> <span id="r146 rd" class="r146 r">resourceUri</span>,
            <b>string</b> <span id="r147 rd" class="r147 r">cimNamespace</span>,
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r148 rd" class="r148 r">moduleNamePatterns</span>,
            <b>bool</b> <span id="r149 rd" class="r149 r">onlyManifests</span>,
            <a href="../cmdlet.cs.html#b0d421ff1d7581f9" class="t t">Cmdlet</a> <span id="r150 rd" class="r150 r">cmdlet</span>,
            <span class="i">CancellationToken</span> <span id="r151 rd" class="r151 r">cancellationToken</span>)
        {
            <span class="r148 r">moduleNamePatterns</span> ??= <b>new</b>[] { <span class="s">&quot;*&quot;</span> };
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r152 rd" class="r152 r">alreadyEmittedNamesOfCimModules</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <span class="i">IEnumerable</span>&lt;<a href="#b5270f565e4adb8f" class="t t">CimModule</a>&gt; <span id="r153 rd" class="r153 r">remoteModules</span> = <span class="r148 r">moduleNamePatterns</span>
                .<span class="i">SelectMany</span>(<span id="r154 rd" class="r154 r">moduleNamePattern</span> =&gt;
                    <a href="#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<span class="i">GetCimModules</span>(<span class="r145 r">cimSession</span>, <span class="r146 r">resourceUri</span>, <span class="r147 r">cimNamespace</span>, <span class="r154 r">moduleNamePattern</span>, <span class="r149 r">onlyManifests</span>, <span class="r150 r">cmdlet</span>, <span class="r151 r">cancellationToken</span>));
            <b>foreach</b> (<a href="#b5270f565e4adb8f" class="t t">CimModule</a> <span id="r155 rd" class="r155 r">remoteModule</span> <b>in</b> <span class="r153 r">remoteModules</span>)
            {
                <b>if</b> (!<span class="r152 r">alreadyEmittedNamesOfCimModules</span>.<span class="i">Contains</span>(<span class="r155 r">remoteModule</span>.<a href="#b1ff4be69e452ccc" class="i property">ModuleName</a>))
                {
                    <span class="r152 r">alreadyEmittedNamesOfCimModules</span>.<span class="i">Add</span>(<span class="r155 r">remoteModule</span>.<a href="#b1ff4be69e452ccc" class="i property">ModuleName</a>);
                    <b>yield</b> <b>return</b> <span class="r155 r">remoteModule</span>;
                }
            }
        }
 
        <b>private static</b> <span class="i">IEnumerable</span>&lt;<a href="#b5270f565e4adb8f" class="t t">CimModule</a>&gt; <a id="1aab0adfccd5241a" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetCimModules</a>(
            <span class="i">CimSession</span> <span id="r156 rd" class="r156 r">cimSession</span>,
            <span class="i">Uri</span> <span id="r157 rd" class="r157 r">resourceUri</span>,
            <b>string</b> <span id="r158 rd" class="r158 r">cimNamespace</span>,
            <b>string</b> <span id="r159 rd" class="r159 r">moduleNamePattern</span>,
            <b>bool</b> <span id="r160 rd" class="r160 r">onlyManifests</span>,
            <a href="../cmdlet.cs.html#b0d421ff1d7581f9" class="t t">Cmdlet</a> <span id="r161 rd" class="r161 r">cmdlet</span>,
            <span class="i">CancellationToken</span> <span id="r162 rd" class="r162 r">cancellationToken</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r156 r">cimSession</span> != <b>null</b>, <span class="s">&quot;Caller should verify cimSession != null&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r159 r">moduleNamePattern</span> != <b>null</b>, <span class="s">&quot;Caller should verify that moduleNamePattern != null&quot;</span>);
 
            <b>const</b> <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a> <span id="r163 rd" class="r163 r">wildcardOptions</span> = <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a> | <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#c83c96a47a1cc99d" class="i field">CultureInvariant</a>;
            <a href="../regex.cs.html#d450e739ff28e660" class="k">var</a> <span id="r164 rd" class="r164 r">wildcardPattern</span> = <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r159 r">moduleNamePattern</span>, <span class="r163 r">wildcardOptions</span>);
            <b>string</b> <span id="r165 rd" class="r165 r">dosWildcard</span> = <a href="../regex.cs.html#1e3c0c28f2a9f6ef" class="t t">WildcardPatternToDosWildcardParser</a>.<a href="../regex.cs.html#142c5727b4b25b38" class="i method">Parse</a>(<span class="r164 r">wildcardPattern</span>);
 
            <b>var</b> <span id="r166 rd" class="r166 r">options</span> = <b>new</b> <span class="i">CimOperationOptions</span> { <span class="i">CancellationToken</span> = <span class="r162 r">cancellationToken</span> };
            <span class="r166 r">options</span>.<span class="i">SetCustomOption</span>(<span class="s">&quot;PS_ModuleNamePattern&quot;</span>, <span class="r165 r">dosWildcard</span>, <span class="i">mustComply</span>: <b>false</b>);
            <b>if</b> (<span class="r157 r">resourceUri</span> != <b>null</b>)
            {
                <span class="r166 r">options</span>.<span class="i">ResourceUri</span> = <span class="r157 r">resourceUri</span>;
            }
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r158 r">cimNamespace</span>) &amp;&amp; (<span class="r157 r">resourceUri</span> == <b>null</b>))
            {
                <span class="r158 r">cimNamespace</span> = <a href="#4b031d9c001caa3b" class="i field">DiscoveryProviderNamespace</a>;
            }
 
            <span class="c">// TODO/FIXME: ETW for method invocation</span>
            <span class="i">IEnumerable</span>&lt;<span class="i">CimInstance</span>&gt; <span id="r167 rd" class="r167 r">syncResults</span> = <span class="r156 r">cimSession</span>.<span class="i">EnumerateInstances</span>(
                <span class="r158 r">cimNamespace</span>,
                <a href="#1ecedc9c93876c71" class="i field">DiscoveryProviderModuleClass</a>,
                <span class="r166 r">options</span>);
            <span class="c">// TODO/FIXME: ETW for method results</span>
            <span class="i">IEnumerable</span>&lt;<a href="#b5270f565e4adb8f" class="t t">CimModule</a>&gt; <span id="r168 rd" class="r168 r">cimModules</span> = <span class="r167 r">syncResults</span>
                .<span class="i">Select</span>(<b>static</b> <span id="r169 rd" class="r169 r">cimInstance</span> =&gt; <b>new</b> <span class="t">CimModule</span>(<span class="r169 r">cimInstance</span>))
                .<span class="i">Where</span>(<span id="r170 rd" class="r170 r">cimModule</span> =&gt; <span class="r164 r">wildcardPattern</span>.<span class="i">IsMatch</span>(<span class="r170 r">cimModule</span>.<span class="i">ModuleName</span>));
 
            <b>if</b> (!<span class="r160 r">onlyManifests</span>)
            {
                <span class="r168 r">cimModules</span> = <span class="r168 r">cimModules</span>.<span class="i">Select</span>(
                    (<a href="#b5270f565e4adb8f" class="t t">CimModule</a> <span id="r171 rd" class="r171 r">cimModule</span>) =&gt;
                    {
                        <span class="r171 r">cimModule</span>.<a href="#22e0207839874dba" class="i method">FetchAllModuleFiles</a>(<span class="r156 r">cimSession</span>, <span class="r158 r">cimNamespace</span>, <span class="r166 r">options</span>);
                        <b>return</b> <span class="r171 r">cimModule</span>;
                    });
            }
 
            <b>return</b> <span class="i">EnumerateWithCatch</span>(
                <span class="r168 r">cimModules</span>,
                (<span class="i">Exception</span> <span id="r172 rd" class="r172 r">exception</span>) =&gt;
                {
                    <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r173 rd" class="r173 r">errorRecord</span> = <a href="#357fc61a5e7b8366" class="i method">GetErrorRecordForRemoteDiscoveryProvider</a>(<span class="r172 r">exception</span>);
                    <b>if</b> (!<span class="r161 r">cmdlet</span>.<a href="../CommandBase.cs.html#f81679c755698e2e" class="i property">MyInvocation</a>.<a href="../InvocationInfo.cs.html#9a1646f37a942067" class="i property">ExpectingInput</a>)
                    {
                        <b>if</b> (<span class="r173 r">errorRecord</span>.<a href="../ErrorPackage.cs.html#80d40f16f77d32bb" class="i property">FullyQualifiedErrorId</a>.<span class="i">Contains</span>(<a href="#bf7e082691fbb61a" class="i field">DiscoveryProviderNotFoundErrorId</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                            || <span class="r162 r">cancellationToken</span>.<span class="i">IsCancellationRequested</span>
                            || <span class="r172 r">exception</span> <b>is</b> <span class="i">OperationCanceledException</span>
                            || !<span class="r156 r">cimSession</span>.<span class="i">TestConnection</span>())
                        {
                            <span class="r161 r">cmdlet</span>.<a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r173 r">errorRecord</span>);
                        }
                    }
 
                    <span class="r161 r">cmdlet</span>.<a href="../cmdlet.cs.html#7746d1a8f41a36d5" class="i method">WriteError</a>(<span class="r173 r">errorRecord</span>);
                });
        }
 
        <b>internal static</b> <span class="i">Hashtable</span> <a id="02a819e4e7e3bbed" href="../../R/02a819e4e7e3bbed.html" target="n" data-glyph="74,1" class="i method">RewriteManifest</a>(<span class="i">Hashtable</span> <span id="r174 rd" class="r174 r">originalManifest</span>)
        {
            <b>return</b> <a href="#eadd55cbae80c03c" class="i method">RewriteManifest</a>(<span class="r174 r">originalManifest</span>, <b>null</b>, <b>null</b>, <b>null</b>);
        }
 
        <b>private static readonly string</b>[] <a id="339ab77a438c1af2" href="../../R/339ab77a438c1af2.html" target="n" data-glyph="46,1" class="i field">s_manifestEntriesToKeepAsString</a> = <b>new</b>[] {
            <span class="s">&quot;GUID&quot;</span>,
            <span class="s">&quot;Author&quot;</span>,
            <span class="s">&quot;CompanyName&quot;</span>,
            <span class="s">&quot;Copyright&quot;</span>,
            <span class="s">&quot;ModuleVersion&quot;</span>,
            <span class="s">&quot;Description&quot;</span>,
            <span class="s">&quot;HelpInfoURI&quot;</span>,
        };
 
        <b>private static readonly string</b>[] <a id="e18911d927e7ef05" href="../../R/e18911d927e7ef05.html" target="n" data-glyph="46,1" class="i field">s_manifestEntriesToKeepAsStringArray</a> = <b>new</b>[] {
            <span class="s">&quot;FunctionsToExport&quot;</span>,
            <span class="s">&quot;VariablesToExport&quot;</span>,
            <span class="s">&quot;AliasesToExport&quot;</span>,
            <span class="s">&quot;CmdletsToExport&quot;</span>,
        };
 
        <b>internal static</b> <span class="i">Hashtable</span> <a id="eadd55cbae80c03c" href="../../R/eadd55cbae80c03c.html" target="n" data-glyph="74,1" class="i method">RewriteManifest</a>(
            <span class="i">Hashtable</span> <span id="r175 rd" class="r175 r">originalManifest</span>,
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r176 rd" class="r176 r">nestedModules</span>,
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r177 rd" class="r177 r">typesToProcess</span>,
            <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r178 rd" class="r178 r">formatsToProcess</span>)
        {
            <span class="r176 r">nestedModules</span> ??= <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
            <span class="r177 r">typesToProcess</span> ??= <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
            <span class="r178 r">formatsToProcess</span> ??= <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>string</b>&gt;();
 
            <b>var</b> <span id="r179 rd" class="r179 r">newManifest</span> = <b>new</b> <span class="i">Hashtable</span>(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
            <span class="r179 r">newManifest</span>[<span class="s">&quot;NestedModules&quot;</span>] = <span class="r176 r">nestedModules</span>;
            <span class="r179 r">newManifest</span>[<span class="s">&quot;TypesToProcess&quot;</span>] = <span class="r177 r">typesToProcess</span>;
            <span class="r179 r">newManifest</span>[<span class="s">&quot;FormatsToProcess&quot;</span>] = <span class="r178 r">formatsToProcess</span>;
            <span class="r179 r">newManifest</span>[<span class="s">&quot;PrivateData&quot;</span>] = <span class="r175 r">originalManifest</span>[<span class="s">&quot;PrivateData&quot;</span>];
 
            <b>foreach</b> (<span class="i">DictionaryEntry</span> <span id="r180 rd" class="r180 r">entry</span> <b>in</b> <span class="r175 r">originalManifest</span>)
            {
                <b>if</b> (<a href="#339ab77a438c1af2" class="i field">s_manifestEntriesToKeepAsString</a>.<span class="i">Contains</span>(<span class="r180 r">entry</span>.<span class="i">Key</span> <b>as string</b>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>var</b> <span id="r181 rd" class="r181 r">value</span> = (<b>string</b>)<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r180 r">entry</span>.<span class="i">Value</span>, <b>typeof</b>(<b>string</b>), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                    <span class="r179 r">newManifest</span>[<span class="r180 r">entry</span>.<span class="i">Key</span>] = <span class="r181 r">value</span>;
                }
                <b>else</b> <b>if</b> (<a href="#e18911d927e7ef05" class="i field">s_manifestEntriesToKeepAsStringArray</a>.<span class="i">Contains</span>(<span class="r180 r">entry</span>.<span class="i">Key</span> <b>as string</b>, <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>var</b> <span id="r182 rd" class="r182 r">values</span> = (<b>string</b>[])<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">ConvertTo</span>(<span class="r180 r">entry</span>.<span class="i">Value</span>, <b>typeof</b>(<b>string</b>[]), <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>);
                    <span class="r179 r">newManifest</span>[<span class="r180 r">entry</span>.<span class="i">Key</span>] = <span class="r182 r">values</span>;
                }
            }
 
            <b>return</b> <span class="r179 r">newManifest</span>;
        }
 
        <b>private static</b> <span class="i">CimCredential</span> <a id="20225abeedd1d48a" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetCimCredentials</a>(<span class="i">PasswordAuthenticationMechanism</span> <span id="r183 rd" class="r183 r">authenticationMechanism</span>, <a href="../Credential.cs.html#6245dc122e2f1916" class="t t">PSCredential</a> <span id="r184 rd" class="r184 r">credential</span>)
        {
            <span class="i">NetworkCredential</span> <span id="r185 rd" class="r185 r">networkCredential</span> = <span class="r184 r">credential</span>.<a href="../Credential.cs.html#ebb6efe250209ca7" class="i method">GetNetworkCredential</a>();
            <b>return</b> <b>new</b> <span class="i">CimCredential</span>(<span class="r183 r">authenticationMechanism</span>, <span class="r185 r">networkCredential</span>.<span class="i">Domain</span>, <span class="r185 r">networkCredential</span>.<span class="i">UserName</span>, <span class="r184 r">credential</span>.<a href="../Credential.cs.html#828d5fa008f1755c" class="i property">Password</a>);
        }
 
        <b>private static</b> <span class="i">Exception</span> <a id="221ea8e147dd66cc" href="../../R/221ea8e147dd66cc.html" target="n" data-glyph="76,1" class="i method">GetExceptionWhenAuthenticationRequiresCredential</a>(<b>string</b> <span id="r186 rd" class="r186 r">authentication</span>)
        {
            <b>string</b> <span id="r187 rd" class="r187 r">errorMessage</span> = <b>string</b>.<span class="i">Format</span>(
                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="i">RemotingErrorIdStrings</span>.<span class="i">AuthenticationMechanismRequiresCredential</span>,
                <span class="r186 r">authentication</span>);
            <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<span class="r187 r">errorMessage</span>);
        }
 
        <b>private static</b> <span class="i">CimCredential</span> <a id="1d47c54b4b013c1b" href="../../R/1d47c54b4b013c1b.html" target="n" data-glyph="76,1" class="i method">GetCimCredentials</a>(<b>string</b> <span id="r188 rd" class="r188 r">authentication</span>, <a href="../Credential.cs.html#6245dc122e2f1916" class="t t">PSCredential</a> <span id="r189 rd" class="r189 r">credential</span>)
        {
            <b>if</b> (<span class="r188 r">authentication</span> == <b>null</b> || (<span class="r188 r">authentication</span>.<span class="i">Equals</span>(<span class="s">&quot;Default&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
            {
                <b>if</b> (<span class="r189 r">credential</span> == <b>null</b>)
                {
                    <b>return</b> <b>null</b>;
                }
                <b>else</b>
                {
                    <b>return</b> <span class="i">GetCimCredentials</span>(<span class="i">PasswordAuthenticationMechanism</span>.<span class="i">Default</span>, <span class="r189 r">credential</span>);
                }
            }
 
            <b>if</b> (<span class="r188 r">authentication</span>.<span class="i">Equals</span>(<span class="s">&quot;Basic&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r189 r">credential</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="#221ea8e147dd66cc" class="i method">GetExceptionWhenAuthenticationRequiresCredential</a>(<span class="r188 r">authentication</span>);
                }
                <b>else</b>
                {
                    <b>return</b> <span class="i">GetCimCredentials</span>(<span class="i">PasswordAuthenticationMechanism</span>.<span class="i">Basic</span>, <span class="r189 r">credential</span>);
                }
            }
 
            <b>if</b> (<span class="r188 r">authentication</span>.<span class="i">Equals</span>(<span class="s">&quot;Negotiate&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r189 r">credential</span> == <b>null</b>)
                {
                    <b>return</b> <b>new</b> <span class="i">CimCredential</span>(<span class="i">ImpersonatedAuthenticationMechanism</span>.<span class="i">Negotiate</span>);
                }
                <b>else</b>
                {
                    <b>return</b> <span class="i">GetCimCredentials</span>(<span class="i">PasswordAuthenticationMechanism</span>.<span class="i">Negotiate</span>, <span class="r189 r">credential</span>);
                }
            }
 
            <b>if</b> (<span class="r188 r">authentication</span>.<span class="i">Equals</span>(<span class="s">&quot;CredSSP&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r189 r">credential</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="#221ea8e147dd66cc" class="i method">GetExceptionWhenAuthenticationRequiresCredential</a>(<span class="r188 r">authentication</span>);
                }
                <b>else</b>
                {
                    <b>return</b> <span class="i">GetCimCredentials</span>(<span class="i">PasswordAuthenticationMechanism</span>.<span class="i">CredSsp</span>, <span class="r189 r">credential</span>);
                }
            }
 
            <b>if</b> (<span class="r188 r">authentication</span>.<span class="i">Equals</span>(<span class="s">&quot;Digest&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r189 r">credential</span> == <b>null</b>)
                {
                    <b>throw</b> <a href="#221ea8e147dd66cc" class="i method">GetExceptionWhenAuthenticationRequiresCredential</a>(<span class="r188 r">authentication</span>);
                }
                <b>else</b>
                {
                    <b>return</b> <span class="i">GetCimCredentials</span>(<span class="i">PasswordAuthenticationMechanism</span>.<span class="i">Digest</span>, <span class="r189 r">credential</span>);
                }
            }
 
            <b>if</b> (<span class="r188 r">authentication</span>.<span class="i">Equals</span>(<span class="s">&quot;Kerberos&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <b>if</b> (<span class="r189 r">credential</span> == <b>null</b>)
                {
                    <b>return</b> <b>new</b> <span class="i">CimCredential</span>(<span class="i">ImpersonatedAuthenticationMechanism</span>.<span class="i">Kerberos</span>);
                }
                <b>else</b>
                {
                    <b>return</b> <span class="i">GetCimCredentials</span>(<span class="i">PasswordAuthenticationMechanism</span>.<span class="i">Kerberos</span>, <span class="r189 r">credential</span>);
                }
            }
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;Unrecognized authentication mechanism [ValidateSet should prevent that from happening]&quot;</span>);
            <b>throw</b> <b>new</b> <span class="i">ArgumentOutOfRangeException</span>(<b>nameof</b>(<span class="r188 r">authentication</span>));
        }
 
        <b>internal static</b> <span class="i">CimSession</span> <a id="638d184c7324abd7" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">CreateCimSession</a>(
            <b>string</b> <span id="r190 rd" class="r190 r">computerName</span>,
            <a href="../Credential.cs.html#6245dc122e2f1916" class="t t">PSCredential</a> <span id="r191 rd" class="r191 r">credential</span>,
            <b>string</b> <span id="r192 rd" class="r192 r">authentication</span>,
            <b>bool</b> <span id="r193 rd" class="r193 r">isLocalHost</span>,
            <a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r194 rd" class="r194 r">cmdlet</span>,
            <span class="i">CancellationToken</span> <span id="r195 rd" class="r195 r">cancellationToken</span>)
        {
            <b>if</b> (<span class="r193 r">isLocalHost</span>)
            {
                <b>return</b> <span class="i">CimSession</span>.<span class="i">Create</span>(<b>null</b>);
            }
 
            <b>var</b> <span id="r196 rd" class="r196 r">sessionOptions</span> = <b>new</b> <span class="i">CimSessionOptions</span>();
 
            <span class="i">CimCredential</span> <span id="r197 rd" class="r197 r">cimCredentials</span> = <a href="#1d47c54b4b013c1b" class="i method">GetCimCredentials</a>(<span class="r192 r">authentication</span>, <span class="r191 r">credential</span>);
            <b>if</b> (<span class="r197 r">cimCredentials</span> != <b>null</b>)
            {
                <span class="r196 r">sessionOptions</span>.<span class="i">AddDestinationCredentials</span>(<span class="r197 r">cimCredentials</span>);
            }
 
            <span class="i">CimSession</span> <span id="r198 rd" class="r198 r">cimSession</span> = <span class="i">CimSession</span>.<span class="i">Create</span>(<span class="r190 r">computerName</span>, <span class="r196 r">sessionOptions</span>);
            <b>return</b> <span class="r198 r">cimSession</span>;
        }
 
        <b>internal static</b> <span class="i">Hashtable</span> <a id="2108befa6ee79738" href="../../R/2108befa6ee79738.html" target="n" data-glyph="74,1" class="i method">ConvertCimModuleFileToManifestHashtable</a>(<a href="#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="#50fcbb8879b7a032" class="t t">CimModuleFile</a> <span id="r199 rd" class="r199 r">cimModuleFile</span>, <b>string</b> <span id="r200 rd" class="r200 r">temporaryModuleManifestPath</span>, <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a> <span id="r201 rd" class="r201 r">cmdlet</span>, <b>ref bool</b> <span id="r202 rd" class="r202 r">containedErrors</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r199 r">cimModuleFile</span>.<a href="#9109df2064141e83" class="i property">FileCode</a> == <a href="#83e28a85267ced48" class="t t">RemoteDiscoveryHelper</a>.<a href="#f81902c09fdd4562" class="t t">CimFileCode</a>.<a href="#9da8e73d1e00b066" class="i field">PsdV1</a>, <span class="s">&quot;Caller should verify the file is of the right type&quot;</span>);
 
            <a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a> <span id="r203 rd" class="r203 r">scriptBlockAst</span> = <b>null</b>;
            <b>if</b> (!<span class="r202 r">containedErrors</span>)
            {
                <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>.<a href="../parser/token.cs.html#ec5d9ac6a36d920c" class="t t">Token</a>[] <span id="r204 rd" class="r204 r">throwAwayTokens</span>;
                <a href="../parser/Parser.cs.html#3b2ee49e322daa35" class="t t">ParseError</a>[] <span id="r205 rd" class="r205 r">parseErrors</span>;
                <span class="r203 r">scriptBlockAst</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>.<a href="../parser/Parser.cs.html#bbf5e856fb3215c5" class="t t">Parser</a>.<a href="../parser/Parser.cs.html#4f8e15f3d9557f8e" class="i method">ParseInput</a>(<span class="r199 r">cimModuleFile</span>.<a href="#40166c7ea776ab2b" class="i property">FileData</a>, <span class="r200 r">temporaryModuleManifestPath</span>, <b>out</b> <span class="r204 r">throwAwayTokens</span>, <b>out</b> <span class="r205 r">parseErrors</span>);
                <b>if</b> ((<span class="r203 r">scriptBlockAst</span> == <b>null</b>) || (<span class="r205 r">parseErrors</span> != <b>null</b> &amp;&amp; <span class="r205 r">parseErrors</span>.<span class="i">Length</span> &gt; 0))
                {
                    <span class="r202 r">containedErrors</span> = <b>true</b>;
                }
            }
 
            <span class="i">Hashtable</span> <span id="r206 rd" class="r206 r">data</span> = <b>null</b>;
            <b>if</b> (!<span class="r202 r">containedErrors</span>)
            {
                <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r207 rd" class="r207 r">scriptBlock</span> = <b>new</b> <a href="../runtime/CompiledScriptBlock.cs.html#7c5e468d9c460238" class="t constructor">ScriptBlock</a>(<span class="r203 r">scriptBlockAst</span>, <span class="r208 r">isFilter</span>: <b>false</b>);
                <span class="r206 r">data</span> = <span class="r201 r">cmdlet</span>.<a href="ModuleCmdletBase.cs.html#0923f881497e8310" class="i method">LoadModuleManifestData</a>(
                    <span class="r200 r">temporaryModuleManifestPath</span>,
                    <span class="r207 r">scriptBlock</span>,
                    <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="ModuleCmdletBase.cs.html#df56551ee1dbbfb1" class="i field">ModuleManifestMembers</a>,
                    0 <span class="c">/* - don&#39;t write errors, don&#39;t load elements, don&#39;t return null on first error */</span>,
                    <b>ref</b> <span class="r202 r">containedErrors</span>);
            }
 
            <b>return</b> <span class="r206 r">data</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> CIM
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Protocol/transport agnostic functionality
 
        <b>internal static string</b> <a id="6d70ded5da8a377d" href="../../R/6d70ded5da8a377d.html" target="n" data-glyph="74,1" class="i method">GetModulePath</a>(<b>string</b> <span id="r209 rd" class="r209 r">remoteModuleName</span>, <span class="i">Version</span> <span id="r210 rd" class="r210 r">remoteModuleVersion</span>, <b>string</b> <span id="r211 rd" class="r211 r">computerName</span>, <a href="../hostifaces/Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r212 rd" class="r212 r">localRunspace</span>)
        {
            <span class="r211 r">computerName</span> ??= <b>string</b>.<span class="i">Empty</span>;
 
            <b>string</b> <span id="r213 rd" class="r213 r">sanitizedRemoteModuleName</span> = <span class="i">Regex</span>.<span class="i">Replace</span>(<span class="r209 r">remoteModuleName</span>, <span class="s">&quot;[^a-zA-Z0-9]&quot;</span>, <b>string</b>.<span class="i">Empty</span>);
            <b>string</b> <span id="r214 rd" class="r214 r">sanitizedComputerName</span> = <span class="i">Regex</span>.<span class="i">Replace</span>(<span class="r211 r">computerName</span>, <span class="s">&quot;[^a-zA-Z0-9]&quot;</span>, <b>string</b>.<span class="i">Empty</span>);
            <b>string</b> <span id="r215 rd" class="r215 r">moduleName</span> = <b>string</b>.<span class="i">Format</span>(
                <span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>,
                <span class="s">&quot;remoteIpMoProxy_{0}_{1}_{2}_{3}&quot;</span>,
                <span class="r213 r">sanitizedRemoteModuleName</span>.<span class="i">Substring</span>(0, <span class="i">Math</span>.<span class="i">Min</span>(<span class="r213 r">sanitizedRemoteModuleName</span>.<span class="i">Length</span>, 100)),
                <span class="r210 r">remoteModuleVersion</span>,
                <span class="r214 r">sanitizedComputerName</span>.<span class="i">Substring</span>(0, <span class="i">Math</span>.<span class="i">Min</span>(<span class="r214 r">sanitizedComputerName</span>.<span class="i">Length</span>, 100)),
                <span class="r212 r">localRunspace</span>.<a href="../hostifaces/Connection.cs.html#af7b715fe8b1bee2" class="i property">InstanceId</a>);
            <b>string</b> <span id="r216 rd" class="r216 r">modulePath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="i">Path</span>.<span class="i">GetTempPath</span>(), <span class="r215 r">moduleName</span>);
            <b>return</b> <span class="r216 r">modulePath</span>;
        }
 
        <b>internal static void</b> <a id="2e7e30e27a6c26be" href="../../R/2e7e30e27a6c26be.html" target="n" data-glyph="74,1" class="i method">AssociatePSModuleInfoWithSession</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r217 rd" class="r217 r">moduleInfo</span>, <span class="i">CimSession</span> <span id="r218 rd" class="r218 r">cimSession</span>, <span class="i">Uri</span> <span id="r219 rd" class="r219 r">resourceUri</span>, <b>string</b> <span id="r220 rd" class="r220 r">cimNamespace</span>)
        {
            <a href="#7e9933bb3e162b5c" class="i method">AssociatePSModuleInfoWithSession</a>(<span class="r217 r">moduleInfo</span>, (<b>object</b>)<b>new</b> <span class="i">Tuple</span>&lt;<span class="i">CimSession</span>, <span class="i">Uri</span>, <b>string</b>&gt;(<span class="r218 r">cimSession</span>, <span class="r219 r">resourceUri</span>, <span class="r220 r">cimNamespace</span>));
        }
 
        <b>internal static void</b> <a id="7b616eadea52e1f0" href="../../R/7b616eadea52e1f0.html" target="n" data-glyph="74,1" class="i method">AssociatePSModuleInfoWithSession</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r221 rd" class="r221 r">moduleInfo</span>, <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r222 rd" class="r222 r">psSession</span>)
        {
            <a href="#7e9933bb3e162b5c" class="i method">AssociatePSModuleInfoWithSession</a>(<span class="r221 r">moduleInfo</span>, (<b>object</b>)<span class="r222 r">psSession</span>);
        }
 
        <b>private static void</b> <a id="7e9933bb3e162b5c" href="../../R/7e9933bb3e162b5c.html" target="n" data-glyph="76,1" class="i method">AssociatePSModuleInfoWithSession</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r223 rd" class="r223 r">moduleInfo</span>, <b>object</b> <span id="r224 rd" class="r224 r">weaklyTypedSession</span>)
        {
            <a href="#bd824a9ee19992bb" class="i field">s_moduleInfoToSession</a>.<span class="i">Add</span>(<span class="r223 r">moduleInfo</span>, <span class="r224 r">weaklyTypedSession</span>);
        }
 
        <b>private static readonly</b> <span class="i">ConditionalWeakTable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>, <b>object</b>&gt; <a id="bd824a9ee19992bb" href="../../R/bd824a9ee19992bb.html" target="n" data-glyph="46,1" class="i field">s_moduleInfoToSession</a> = <b>new</b> <span class="i">ConditionalWeakTable</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>, <b>object</b>&gt;();
 
        <b>internal static void</b> <a id="3f9628750ee069e7" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">DispatchModuleInfoProcessing</a>(
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r225 rd" class="r225 r">moduleInfo</span>,
            <span class="i">Action</span> <span id="r226 rd" class="r226 r">localAction</span>,
            <span class="i">Action</span>&lt;<span class="i">CimSession</span>, <span class="i">Uri</span>, <b>string</b>&gt; <span id="r227 rd" class="r227 r">cimSessionAction</span>,
            <span class="i">Action</span>&lt;<a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a>&gt; <span id="r228 rd" class="r228 r">psSessionAction</span>)
        {
            <b>object</b> <span id="r229 rd" class="r229 r">weaklyTypeSession</span>;
            <b>if</b> (!<a href="#bd824a9ee19992bb" class="i field">s_moduleInfoToSession</a>.<span class="i">TryGetValue</span>(<span class="r225 r">moduleInfo</span>, <b>out</b> <span class="r229 r">weaklyTypeSession</span>))
            {
                <span class="r226 r">localAction</span>();
                <b>return</b>;
            }
 
            <span class="i">Tuple</span>&lt;<span class="i">CimSession</span>, <span class="i">Uri</span>, <b>string</b>&gt; <span id="r230 rd" class="r230 r">cimSessionInfo</span> = <span class="r229 r">weaklyTypeSession</span> <b>as</b> <span class="i">Tuple</span>&lt;<span class="i">CimSession</span>, <span class="i">Uri</span>, <b>string</b>&gt;;
            <b>if</b> (<span class="r230 r">cimSessionInfo</span> != <b>null</b>)
            {
                <span class="r227 r">cimSessionAction</span>(<span class="r230 r">cimSessionInfo</span>.<span class="i">Item1</span>, <span class="r230 r">cimSessionInfo</span>.<span class="i">Item2</span>, <span class="r230 r">cimSessionInfo</span>.<span class="i">Item3</span>);
                <b>return</b>;
            }
 
            <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a> <span id="r231 rd" class="r231 r">psSession</span> = <span class="r229 r">weaklyTypeSession</span> <b>as</b> <a href="../remoting/client/remoterunspaceinfo.cs.html#84e3d9c13d0f2efc" class="t t">PSSession</a>;
            <b>if</b> (<span class="r231 r">psSession</span> != <b>null</b>)
            {
                <span class="r228 r">psSessionAction</span>(<span class="r231 r">psSession</span>);
                <b>return</b>;
            }
 
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>false</b>, <span class="s">&quot;PSModuleInfo was associated with an unrecognized session type&quot;</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
