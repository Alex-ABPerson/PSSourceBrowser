<!DOCTYPE html>
<html><head><title>ModuleIntrinsics.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1721);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/Modules/ModuleIntrinsics.cs" target="_top">engine\Modules\ModuleIntrinsics.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Configuration</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Language</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">PowerShell</span>.<span class="i n">Commands</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Win32</span>;
 
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>
{
    <b>internal static class</b> <a id="ed7549e40b469e9f" href="../../R/ed7549e40b469e9f.html" target="n" data-glyph="2,0" class="t t">Constants</a>
    {
        <b>public const string</b> <a id="21c1e0b05c7ef699" href="../../R/21c1e0b05c7ef699.html" target="n" data-glyph="6,1" class="i field">PSModulePathEnvVar</a> = <span class="s">&quot;PSModulePath&quot;</span>;
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Encapsulates the basic module operations for a PowerShell engine instance...</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="1693bdfaeab6548d" href="../../R/1693bdfaeab6548d.html" target="n" data-glyph="0,0" class="t t">ModuleIntrinsics</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Tracer for module analysis.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">TraceSource</span>(<span class="s">&quot;Modules&quot;</span>, <span class="s">&quot;Module loading and analysis&quot;</span>)]
        <b>internal static readonly</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a> <a id="3b5fe290216e5c03" href="../../R/3b5fe290216e5c03.html" target="n" data-glyph="44,1" class="i field">Tracer</a> = <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#697b06ec70e3c537" class="i method">GetTracer</a>(<span class="s">&quot;Modules&quot;</span>, <span class="s">&quot;Module loading and analysis&quot;</span>);
 
        <span class="c">// The %WINDIR%\System32\WindowsPowerShell\v1.0\Modules module path,</span>
        <span class="c">// to load forward compatible Windows PowerShell modules from</span>
        <b>private static readonly string</b> <a id="8a7e75c5da14ed07" href="../../R/8a7e75c5da14ed07.html" target="n" data-glyph="46,1" class="i field">s_windowsPowerShellPSHomeModulePath</a> =
            <span class="i">Path</span>.<span class="i">Combine</span>(<span class="i n">System</span>.<span class="i">Environment</span>.<span class="i">SystemDirectory</span>, <span class="s">&quot;WindowsPowerShell&quot;</span>, <span class="s">&quot;v1.0&quot;</span>, <span class="s">&quot;Modules&quot;</span>);
 
        <b>internal</b> <a id="cd66803a2ce9edb7" href="../../R/cd66803a2ce9edb7.html" target="n" data-glyph="74,1" class="t constructor">ModuleIntrinsics</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r0 rd" class="r0 r">context</span>)
        {
            <a href="#2b704e7eb1bc0548" class="i field">_context</a> = <span class="r0 r">context</span>;
 
            <span class="c">// And initialize the module path...</span>
            <a href="#c6daade75c475a71" class="i method">SetModulePath</a>();
        }
 
        <b>private readonly</b> <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <a id="2b704e7eb1bc0548" href="../../R/2b704e7eb1bc0548.html" target="n" data-glyph="46,1" class="i field">_context</a>;
 
        <span class="c">// Holds the module collection...</span>
        <b>internal</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="8fc099ef41b05ce8" href="../../R/8fc099ef41b05ce8.html" target="n" data-glyph="104,1" class="i property">ModuleTable</a> { <b>get</b>; } = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
        <b>private const int</b> <a id="b06e3d2010d2b4b4" href="../../R/b06e3d2010d2b4b4.html" target="n" data-glyph="10,1" class="i field">MaxModuleNestingDepth</a> = 10;
 
        <b>internal void</b> <a id="e22e8fa7211ed8e7" href="../../R/e22e8fa7211ed8e7.html" target="n" data-glyph="74,1" class="i method">IncrementModuleNestingDepth</a>(<a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r1 rd" class="r1 r">cmdlet</span>, <b>string</b> <span id="r2 rd" class="r2 r">path</span>)
        {
            <b>if</b> (++<a href="#c701a39b0ced94c6" class="i property">ModuleNestingDepth</a> &gt; <a href="#b06e3d2010d2b4b4" class="i field">MaxModuleNestingDepth</a>)
            {
                <b>string</b> <span id="r3 rd" class="r3 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ModuleTooDeeplyNested</span>, <span class="r2 r">path</span>, <a href="#b06e3d2010d2b4b4" class="i field">MaxModuleNestingDepth</a>);
                <span class="i">InvalidOperationException</span> <span id="r4 rd" class="r4 r">ioe</span> = <b>new</b> <span class="i">InvalidOperationException</span>(<span class="r3 r">message</span>);
                <a href="../ErrorPackage.cs.html#fe2b46733a081db9" class="t t">ErrorRecord</a> <span id="r5 rd" class="r5 r">er</span> = <b>new</b> <span class="t">ErrorRecord</span>(<span class="r4 r">ioe</span>, <span class="s">&quot;Modules_ModuleTooDeeplyNested&quot;</span>,
                    <a href="../ErrorPackage.cs.html#0e80a9653d75dd2a" class="t t">ErrorCategory</a>.<a href="../ErrorPackage.cs.html#b5cba3d51f976bb3" class="i field">InvalidOperation</a>, <span class="r2 r">path</span>);
                <span class="c">// NOTE: this call will throw</span>
                <span class="r1 r">cmdlet</span>.<a href="../cmdlet.cs.html#e3346d70990a1763" class="i method">ThrowTerminatingError</a>(<span class="r5 r">er</span>);
            }
        }
 
        <b>internal void</b> <a id="04dc5e193949a6d0" href="../../R/04dc5e193949a6d0.html" target="n" data-glyph="74,1" class="i method">DecrementModuleNestingCount</a>()
        {
            --<a href="#c701a39b0ced94c6" class="i property">ModuleNestingDepth</a>;
        }
 
        <b>internal int</b> <a id="c701a39b0ced94c6" href="../../R/c701a39b0ced94c6.html" target="n" data-glyph="104,1" class="i property">ModuleNestingDepth</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a new module object from a scriptblock specifying the path to set for the module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path where the module is rooted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">scriptBlock</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ScriptBlock that is executed to initialize the module...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">arguments</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The arguments to pass to the scriptblock used to initialize the module</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to use for this module - may be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">results</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The results produced from evaluating the scriptblock.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The newly created module info object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="52513af7ad379b3d" href="../../R/52513af7ad379b3d.html" target="n" data-glyph="74,1" class="i method">CreateModule</a>(<b>string</b> <span id="r6 rd" class="r6 r">name</span>, <b>string</b> <span id="r7 rd" class="r7 r">path</span>, <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r8 rd" class="r8 r">scriptBlock</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r10 rd" class="r10 r">ss</span>, <b>out</b> <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r11 rd" class="r11 r">results</span>, <b>params object</b>[] <span id="r9 rd" class="r9 r">arguments</span>)
        {
            <b>return</b> <a href="#c5579ca545982877" class="i method">CreateModuleImplementation</a>(<span class="r6 r">name</span>, <span class="r7 r">path</span>, <span class="r8 r">scriptBlock</span>, <b>null</b>, <span class="r10 r">ss</span>, <b>null</b>, <b>out</b> <span class="r11 r">results</span>, <span class="r9 r">arguments</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a new module object from a ScriptInfo object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path where the module is rooted.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">scriptInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The script info to use to create the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">scriptPosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The position for the command that loaded this module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">arguments</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Optional arguments to pass to the script while executing.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to use for this module - may be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">privateData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The private data to use for this module - may be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The constructed module object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="3f5fcd253bc92add" href="../../R/3f5fcd253bc92add.html" target="n" data-glyph="74,1" class="i method">CreateModule</a>(<b>string</b> <span id="r12 rd" class="r12 r">path</span>, <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r13 rd" class="r13 r">scriptInfo</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r14 rd" class="r14 r">scriptPosition</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r16 rd" class="r16 r">ss</span>, <b>object</b> <span id="r17 rd" class="r17 r">privateData</span>, <b>params object</b>[] <span id="r15 rd" class="r15 r">arguments</span>)
        {
            <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r18 rd" class="r18 r">result</span>;
            <b>return</b> <a href="#c5579ca545982877" class="i method">CreateModuleImplementation</a>(<a href="#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r12 r">path</span>), <span class="r12 r">path</span>, <span class="r13 r">scriptInfo</span>, <span class="r14 r">scriptPosition</span>, <span class="r16 r">ss</span>, <span class="r17 r">privateData</span>, <b>out</b> <span class="r18 r">result</span>, <span class="r15 r">arguments</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a new module object from code specifying the path to set for the module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to use for the module root.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">moduleCode</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The code to use to create the module. This can be one of ScriptBlock, string</span>
        <span class="c">///</span><span class="c"> or ExternalScriptInfo</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">arguments</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Arguments to pass to the module scriptblock during evaluation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">result</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The results of the evaluation of the scriptblock.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">scriptPosition</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The position of the caller of this function so you can tell where the call</span>
        <span class="c">///</span><span class="c"> to Import-Module (or whatever) occurred. This can be null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">ss</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to use for this module - may be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">privateData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The private data to use for this module - may be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The created module.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private</b> <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="c5579ca545982877" href="../../R/c5579ca545982877.html" target="n" data-glyph="76,1" class="i method">CreateModuleImplementation</a>(<b>string</b> <span id="r19 rd" class="r19 r">name</span>, <b>string</b> <span id="r20 rd" class="r20 r">path</span>, <b>object</b> <span id="r21 rd" class="r21 r">moduleCode</span>, <a href="../parser/Position.cs.html#bbc751d075344454" class="t t">IScriptExtent</a> <span id="r24 rd" class="r24 r">scriptPosition</span>, <a href="../SessionStatePublic.cs.html#0a202aa6b2d52930" class="t t">SessionState</a> <span id="r25 rd" class="r25 r">ss</span>, <b>object</b> <span id="r26 rd" class="r26 r">privateData</span>, <b>out</b> <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r23 rd" class="r23 r">result</span>, <b>params object</b>[] <span id="r22 rd" class="r22 r">arguments</span>)
        {
            <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r27 rd" class="r27 r">sb</span>;
 
            <span class="c">// By default the top-level scope in a session state object is the global scope for the instance.</span>
            <span class="c">// For modules, we need to set its global scope to be another scope object and, chain the top</span>
            <span class="c">// level scope for this sessionstate instance to be the parent. The top level scope for this ss is the</span>
            <span class="c">// script scope for the ss.</span>
 
            <span class="c">// Allocate the session state instance for this module.</span>
            <b>if</b> (<span class="r25 r">ss</span> == <b>null</b>)
            {
                <span class="r25 r">ss</span> = <b>new</b> <a href="../SessionStatePublic.cs.html#b5c2a459b4a3ca3e" class="t constructor">SessionState</a>(<a href="#2b704e7eb1bc0548" class="i field">_context</a>, <b>true</b>, <b>true</b>);
            }
 
            <span class="c">// Now set up the module&#39;s session state to be the current session state</span>
            <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r28 rd" class="r28 r">oldSessionState</span> = <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>;
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r29 rd" class="r29 r">module</span> = <b>new</b> <a href="PSModuleInfo.cs.html#82c685f79205f6f4" class="t constructor">PSModuleInfo</a>(<span class="r19 r">name</span>, <span class="r20 r">path</span>, <a href="#2b704e7eb1bc0548" class="i field">_context</a>, <span class="r25 r">ss</span>);
            <span class="r25 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> = <span class="r29 r">module</span>;
            <span class="r29 r">module</span>.<a href="PSModuleInfo.cs.html#964f6cf27d5eeb00" class="i property">PrivateData</a> = <span class="r26 r">privateData</span>;
 
            <b>bool</b> <span id="r30 rd" class="r30 r">setExitCode</span> = <b>false</b>;
            <b>int</b> <span id="r31 rd" class="r31 r">exitCode</span> = 0;
 
            <b>try</b>
            {
                <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r25 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>;
 
                <span class="c">// Build the scriptblock at this point so the references to the module</span>
                <span class="c">// context are correct...</span>
                <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a> <span id="r32 rd" class="r32 r">scriptInfo</span> = <span class="r21 r">moduleCode</span> <b>as</b> <a href="../ExternalScriptInfo.cs.html#7806ac40f903221c" class="t t">ExternalScriptInfo</a>;
                <b>if</b> (<span class="r32 r">scriptInfo</span> != <b>null</b>)
                {
                    <span class="r27 r">sb</span> = <span class="r32 r">scriptInfo</span>.<a href="../ExternalScriptInfo.cs.html#7795a39b7e78fc61" class="i property">ScriptBlock</a>;
 
                    <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#3e56b2d709de0d80" class="i property">Debugger</a>.<a href="../debugger/debugger.cs.html#938d448a012b94dd" class="i method">RegisterScriptFile</a>(<span class="r32 r">scriptInfo</span>);
                }
                <b>else</b>
                {
                    <span class="r27 r">sb</span> = <span class="r21 r">moduleCode</span> <b>as</b> <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>;
                    <b>if</b> (<span class="r27 r">sb</span> != <b>null</b>)
                    {
                        <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a>? <span id="r33 rd" class="r33 r">moduleLanguageMode</span> = <span class="r27 r">sb</span>.<a href="../lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a>;
                        <span class="r27 r">sb</span> = <span class="r27 r">sb</span>.<a href="../runtime/CompiledScriptBlock.cs.html#13c9ab07535d8eb6" class="i method">Clone</a>();
                        <span class="r27 r">sb</span>.<a href="../lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a> = <span class="r33 r">moduleLanguageMode</span>;
 
                        <span class="r27 r">sb</span>.<a href="../lang/scriptblock.cs.html#6359018e5b4473dd" class="i property">SessionState</a> = <span class="r25 r">ss</span>;
                    }
                    <b>else</b>
                    {
                        <b>var</b> <span id="r34 rd" class="r34 r">sbText</span> = <span class="r21 r">moduleCode</span> <b>as string</b>;
                        <b>if</b> (<span class="r34 r">sbText</span> != <b>null</b>)
                            <span class="r27 r">sb</span> = <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../lang/scriptblock.cs.html#7001f03560eb84f2" class="i method">Create</a>(<a href="#2b704e7eb1bc0548" class="i field">_context</a>, <span class="r34 r">sbText</span>);
                    }
                }
 
                <b>if</b> (<span class="r27 r">sb</span> == <b>null</b>)
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#4f3f8175dd33a015" class="i method">NewInvalidOperationException</a>();
 
                <span class="r27 r">sb</span>.<a href="../lang/scriptblock.cs.html#d25a345294fd74f0" class="i property">SessionStateInternal</a> = <span class="r25 r">ss</span>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>;
                <span class="r29 r">module</span>.<a href="PSModuleInfo.cs.html#8c5e251e6d3f0c67" class="i property">LanguageMode</a> = <span class="r27 r">sb</span>.<a href="../lang/scriptblock.cs.html#5e76a9fb0d1a7f12" class="i property">LanguageMode</a>;
 
                <a href="../InvocationInfo.cs.html#407d6c7d1ecbc8cc" class="t t">InvocationInfo</a> <span id="r35 rd" class="r35 r">invocationInfo</span> = <b>new</b> <a href="../InvocationInfo.cs.html#73425a3cbc3397ab" class="t constructor">InvocationInfo</a>(<span class="r32 r">scriptInfo</span>, <span class="r24 r">scriptPosition</span>);
 
                <span class="c">// Save the module string</span>
                <span class="r29 r">module</span>.<a href="PSModuleInfo.cs.html#388f5c7e062e76df" class="i field">_definitionExtent</a> = <span class="r27 r">sb</span>.<a href="../runtime/CompiledScriptBlock.cs.html#e028cdfe16daf552" class="i property">Ast</a>.<a href="../parser/ast.cs.html#d9d5cd324ee61136" class="i property">Extent</a>;
                <a href="../parser/ast.cs.html#d47621d83efd14de" class="k">var</a> <span id="r36 rd" class="r36 r">ast</span> = <span class="r27 r">sb</span>.<a href="../runtime/CompiledScriptBlock.cs.html#e028cdfe16daf552" class="i property">Ast</a>;
                <b>while</b> (<span class="r36 r">ast</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a> != <b>null</b>)
                {
                    <span class="r36 r">ast</span> = <span class="r36 r">ast</span>.<a href="../parser/ast.cs.html#faf9ad7a55f1cc57" class="i property">Parent</a>;
                }
 
                <span class="c">// The variables set in the interpreted case get set by InvokeWithPipe in the compiled case.</span>
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>.<a href="../SessionStateScopeAPIs.cs.html#224987ad36a90f88" class="i property">CurrentScope</a>.<a href="../SessionStateScope.cs.html#d10101bbc5961e39" class="i property">LocalsTuple</a> == <b>null</b>,
                                    <span class="s">&quot;No locals tuple should have been created yet.&quot;</span>);
 
                <span class="i">List</span>&lt;<b>object</b>&gt; <span id="r37 rd" class="r37 r">resultList</span> = <b>new</b> <span class="i">List</span>&lt;<b>object</b>&gt;();
 
                <b>try</b>
                {
                    <a href="../Pipe.cs.html#59f1a03e60a5aa51" class="t t">Pipe</a> <span id="r38 rd" class="r38 r">outputPipe</span> = <b>new</b> <a href="../Pipe.cs.html#99288ee09b9642bb" class="t constructor">Pipe</a>(<span class="r37 r">resultList</span>);
 
                    <span class="c">// And run the scriptblock...</span>
                    <span class="r27 r">sb</span>.<span class="i">InvokeWithPipe</span>(
                        <span class="i">useLocalScope</span>: <b>false</b>,
                        <span class="i">errorHandlingBehavior</span>: <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a>.<a href="../lang/scriptblock.cs.html#10c045824f712272" class="t t">ErrorHandlingBehavior</a>.<a href="../lang/scriptblock.cs.html#5e78734ffe1c6ed3" class="i field">WriteToCurrentErrorPipe</a>,
                        <span class="i">dollarUnder</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                        <span class="i">input</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                        <span class="i">scriptThis</span>: <a href="../AutomationNull.cs.html#681fbea4c40e4af1" class="t t">AutomationNull</a>.<a href="../AutomationNull.cs.html#1cf7e193da582896" class="i property">Value</a>,
                        <span class="i">outputPipe</span>: <span class="r38 r">outputPipe</span>,
                        <span class="i">invocationInfo</span>: <span class="r35 r">invocationInfo</span>,
                        <span class="i">args</span>: <span class="r22 r">arguments</span> ?? <span class="i">Array</span>.<span class="i">Empty</span>&lt;<b>object</b>&gt;());
                }
                <b>catch</b> (<a href="../lang/parserutils.cs.html#79de2587ceb4dc25" class="t t">ExitException</a> <span id="r39 rd" class="r39 r">ee</span>)
                {
                    <span class="r31 r">exitCode</span> = (<b>int</b>)<span class="r39 r">ee</span>.<a href="../lang/parserutils.cs.html#d1b0e4525b48e0c9" class="i property">Argument</a>;
                    <span class="r30 r">setExitCode</span> = <b>true</b>;
                }
 
                <span class="r23 r">result</span> = <span class="r37 r">resultList</span>;
            }
            <b>finally</b>
            {
                <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> = <span class="r28 r">oldSessionState</span>;
            }
 
            <b>if</b> (<span class="r30 r">setExitCode</span>)
            {
                <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#fa7f7322f772be22" class="i method">SetVariable</a>(<a href="../SpecialVariables.cs.html#07948374b47849e8" class="t t">SpecialVariables</a>.<a href="../SpecialVariables.cs.html#fe9ae54e56fef582" class="i field">LastExitCodeVarPath</a>, <span class="r31 r">exitCode</span>);
            }
 
            <span class="r29 r">module</span>.<a href="PSModuleInfo.cs.html#7adbb859c851b2e4" class="i property">ImplementingAssembly</a> = <span class="r27 r">sb</span>.<a href="../runtime/CompiledScriptBlock.cs.html#37830aab9aece092" class="i property">AssemblyDefiningPSTypes</a>;
            <span class="c">// We force re-population of ExportedTypeDefinitions, now with the actual RuntimeTypes, created above.</span>
            <span class="r29 r">module</span>.<a href="PSModuleInfo.cs.html#2a76bc9a1c530a4a" class="i method">CreateExportedTypeDefinitions</a>(<span class="r27 r">sb</span>.<a href="../runtime/CompiledScriptBlock.cs.html#e028cdfe16daf552" class="i property">Ast</a> <b>as</b> <a href="../parser/ast.cs.html#6f963589327835a4" class="t t">ScriptBlockAst</a>);
 
            <b>return</b> <span class="r29 r">module</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Allocate a new dynamic module then return a new scriptblock</span>
        <span class="c">///</span><span class="c"> bound to the module instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Context to use to create bounded script.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">sb</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The scriptblock to bind.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">linkToGlobal</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether it should be linked to the global session state or not.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A new scriptblock.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <a id="f12a42e3f8d60d63" href="../../R/f12a42e3f8d60d63.html" target="n" data-glyph="74,1" class="i method">CreateBoundScriptBlock</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r40 rd" class="r40 r">context</span>, <a href="../../P/eea83b421baeaca4.html#eea83b421baeaca4" class="t t">ScriptBlock</a> <span id="r41 rd" class="r41 r">sb</span>, <b>bool</b> <span id="r42 rd" class="r42 r">linkToGlobal</span>)
        {
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r43 rd" class="r43 r">module</span> = <b>new</b> <a href="PSModuleInfo.cs.html#e14c13371b49cb57" class="t constructor">PSModuleInfo</a>(<span class="r40 r">context</span>, <span class="r42 r">linkToGlobal</span>);
            <b>return</b> <span class="r43 r">module</span>.<a href="PSModuleInfo.cs.html#a341eb9bedb02d6b" class="i method">NewBoundScriptBlock</a>(<span class="r41 r">sb</span>, <span class="r40 r">context</span>);
        }
 
        <b>internal</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="1c52622ea6eacb86" href="../../R/1c52622ea6eacb86.html" target="n" data-glyph="74,1" class="i method">GetModules</a>(<b>string</b>[] <span id="r44 rd" class="r44 r">patterns</span>, <b>bool</b> <span id="r45 rd" class="r45 r">all</span>)
        {
            <b>return</b> <a href="#a8caef4e3106367e" class="i method">GetModuleCore</a>(<span class="r44 r">patterns</span>, <span class="r45 r">all</span>, <b>false</b>);
        }
 
        <b>internal</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="e8fff0ab8e8777cc" href="../../R/e8fff0ab8e8777cc.html" target="n" data-glyph="74,1" class="i method">GetExactMatchModules</a>(<b>string</b> <span id="r46 rd" class="r46 r">moduleName</span>, <b>bool</b> <span id="r47 rd" class="r47 r">all</span>, <b>bool</b> <span id="r48 rd" class="r48 r">exactMatch</span>)
        {
            <b>if</b> (<span class="r46 r">moduleName</span> == <b>null</b>) { <span class="r46 r">moduleName</span> = <b>string</b>.<span class="i">Empty</span>; }
 
            <b>return</b> <a href="#a8caef4e3106367e" class="i method">GetModuleCore</a>(<b>new</b> <b>string</b>[] { <span class="r46 r">moduleName</span> }, <span class="r47 r">all</span>, <span class="r48 r">exactMatch</span>);
        }
 
        <b>private</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="a8caef4e3106367e" href="../../R/a8caef4e3106367e.html" target="n" data-glyph="76,1" class="i method">GetModuleCore</a>(<b>string</b>[] <span id="r49 rd" class="r49 r">patterns</span>, <b>bool</b> <span id="r50 rd" class="r50 r">all</span>, <b>bool</b> <span id="r51 rd" class="r51 r">exactMatch</span>)
        {
            <b>string</b> <span id="r52 rd" class="r52 r">targetModuleName</span> = <b>null</b>;
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r53 rd" class="r53 r">wcpList</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt;();
 
            <b>if</b> (<span class="r51 r">exactMatch</span>)
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r49 r">patterns</span>.<span class="i">Length</span> == 1, <span class="s">&quot;The &#39;patterns&#39; should only contain one element when it is for an exact match&quot;</span>);
                <span class="r52 r">targetModuleName</span> = <span class="r49 r">patterns</span>[0];
            }
            <b>else</b>
            {
                <b>if</b> (<span class="r49 r">patterns</span> == <b>null</b>)
                {
                    <span class="r49 r">patterns</span> = <b>new</b> <b>string</b>[] { <span class="s">&quot;*&quot;</span> };
                }
 
                <b>foreach</b> (<b>string</b> <span id="r54 rd" class="r54 r">pattern</span> <b>in</b> <span class="r49 r">patterns</span>)
                {
                    <span class="r53 r">wcpList</span>.<span class="i">Add</span>(<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#03cc3ceece086129" class="i method">Get</a>(<span class="r54 r">pattern</span>, <a href="../regex.cs.html#4e788ab2470b3632" class="t t">WildcardOptions</a>.<a href="../regex.cs.html#2d0521a6986208d3" class="i field">IgnoreCase</a>));
                }
            }
 
            <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r55 rd" class="r55 r">modulesMatched</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
            <b>if</b> (<span class="r50 r">all</span>)
            {
                <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r56 rd" class="r56 r">module</span> <b>in</b> <a href="#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">Values</span>)
                {
                    <span class="c">// See if this is the requested module...</span>
                    <b>if</b> ((<span class="r51 r">exactMatch</span> &amp;&amp; <span class="r56 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r52 r">targetModuleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)) ||
                        (!<span class="r51 r">exactMatch</span> &amp;&amp; <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r56 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r53 r">wcpList</span>, <b>false</b>)))
                    {
                        <span class="r55 r">modulesMatched</span>.<span class="i">Add</span>(<span class="r56 r">module</span>);
                    }
                }
            }
            <b>else</b>
            {
                <span class="c">// Create a joint list of local and global modules. Only report a module once.</span>
                <span class="c">// Local modules are reported before global modules...</span>
                <span class="i">Dictionary</span>&lt;<b>string</b>, <b>bool</b>&gt; <span id="r57 rd" class="r57 r">found</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>bool</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                <b>foreach</b> (<b>var</b> <span id="r58 rd" class="r58 r">pair</span> <b>in</b> <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>)
                {
                    <b>string</b> <span id="r59 rd" class="r59 r">path</span> = <span class="r58 r">pair</span>.<span class="i">Key</span>;
                    <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r60 rd" class="r60 r">module</span> = <span class="r58 r">pair</span>.<span class="i">Value</span>;
                    <span class="c">// See if this is the requested module...</span>
                    <b>if</b> ((<span class="r51 r">exactMatch</span> &amp;&amp; <span class="r60 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r52 r">targetModuleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)) ||
                        (!<span class="r51 r">exactMatch</span> &amp;&amp; <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r60 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r53 r">wcpList</span>, <b>false</b>)))
                    {
                        <span class="r55 r">modulesMatched</span>.<span class="i">Add</span>(<span class="r60 r">module</span>);
                        <span class="r57 r">found</span>[<span class="r59 r">path</span>] = <b>true</b>;
                    }
                }
 
                <b>if</b> (<a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> != <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>)
                {
                    <b>foreach</b> (<b>var</b> <span id="r61 rd" class="r61 r">pair</span> <b>in</b> <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>)
                    {
                        <b>string</b> <span id="r62 rd" class="r62 r">path</span> = <span class="r61 r">pair</span>.<span class="i">Key</span>;
                        <b>if</b> (!<span class="r57 r">found</span>.<span class="i">ContainsKey</span>(<span class="r62 r">path</span>))
                        {
                            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r63 rd" class="r63 r">module</span> = <span class="r61 r">pair</span>.<span class="i">Value</span>;
                            <span class="c">// See if this is the requested module...</span>
                            <b>if</b> ((<span class="r51 r">exactMatch</span> &amp;&amp; <span class="r63 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r52 r">targetModuleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)) ||
                                (!<span class="r51 r">exactMatch</span> &amp;&amp; <a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r63 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>, <span class="r53 r">wcpList</span>, <b>false</b>)))
                            {
                                <span class="r55 r">modulesMatched</span>.<span class="i">Add</span>(<span class="r63 r">module</span>);
                            }
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r55 r">modulesMatched</span>.<span class="i">OrderBy</span>(<b>static</b> <span id="r64 rd" class="r64 r">m</span> =&gt; <span class="r64 r">m</span>.<span class="i">Name</span>).<span class="i">ToList</span>();
        }
 
        <b>internal</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <a id="d05a036ceb288706" href="../../R/d05a036ceb288706.html" target="n" data-glyph="74,1" class="i method">GetModules</a>(<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a>[] <span id="r65 rd" class="r65 r">fullyQualifiedName</span>, <b>bool</b> <span id="r66 rd" class="r66 r">all</span>)
        {
            <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt; <span id="r67 rd" class="r67 r">modulesMatched</span> = <b>new</b> <span class="i">List</span>&lt;<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>&gt;();
 
            <b>if</b> (<span class="r66 r">all</span>)
            {
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="k">var</a> <span id="r68 rd" class="r68 r">moduleSpec</span> <b>in</b> <span class="r65 r">fullyQualifiedName</span>)
                {
                    <b>foreach</b> (<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r69 rd" class="r69 r">module</span> <b>in</b> <a href="#8fc099ef41b05ce8" class="i property">ModuleTable</a>.<span class="i">Values</span>)
                    {
                        <span class="c">// See if this is the requested module...</span>
                        <b>if</b> (<a href="#d23a7b8d60e511ec" class="i method">IsModuleMatchingModuleSpec</a>(<span class="r69 r">module</span>, <span class="r68 r">moduleSpec</span>))
                        {
                            <span class="r67 r">modulesMatched</span>.<span class="i">Add</span>(<span class="r69 r">module</span>);
                        }
                    }
                }
            }
            <b>else</b>
            {
                <b>foreach</b> (<a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="k">var</a> <span id="r70 rd" class="r70 r">moduleSpec</span> <b>in</b> <span class="r65 r">fullyQualifiedName</span>)
                {
                    <span class="c">// Create a joint list of local and global modules. Only report a module once.</span>
                    <span class="c">// Local modules are reported before global modules...</span>
                    <span class="i">Dictionary</span>&lt;<b>string</b>, <b>bool</b>&gt; <span id="r71 rd" class="r71 r">found</span> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <b>bool</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
                    <b>foreach</b> (<b>var</b> <span id="r72 rd" class="r72 r">pair</span> <b>in</b> <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>)
                    {
                        <b>string</b> <span id="r73 rd" class="r73 r">path</span> = <span class="r72 r">pair</span>.<span class="i">Key</span>;
                        <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r74 rd" class="r74 r">module</span> = <span class="r72 r">pair</span>.<span class="i">Value</span>;
                        <span class="c">// See if this is the requested module...</span>
                        <b>if</b> (<a href="#d23a7b8d60e511ec" class="i method">IsModuleMatchingModuleSpec</a>(<span class="r74 r">module</span>, <span class="r70 r">moduleSpec</span>))
                        {
                            <span class="r67 r">modulesMatched</span>.<span class="i">Add</span>(<span class="r74 r">module</span>);
                            <span class="r71 r">found</span>[<span class="r73 r">path</span>] = <b>true</b>;
                        }
                    }
 
                    <b>if</b> (<a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a> != <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>)
                    {
                        <b>foreach</b> (<b>var</b> <span id="r75 rd" class="r75 r">pair</span> <b>in</b> <a href="#2b704e7eb1bc0548" class="i field">_context</a>.<a href="../ExecutionContext.cs.html#95bc6698d12886ee" class="i property">TopLevelSessionState</a>.<a href="../SessionState.cs.html#5f2e915b732790bb" class="i property">ModuleTable</a>)
                        {
                            <b>string</b> <span id="r76 rd" class="r76 r">path</span> = <span class="r75 r">pair</span>.<span class="i">Key</span>;
                            <b>if</b> (!<span class="r71 r">found</span>.<span class="i">ContainsKey</span>(<span class="r76 r">path</span>))
                            {
                                <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r77 rd" class="r77 r">module</span> = <span class="r75 r">pair</span>.<span class="i">Value</span>;
                                <span class="c">// See if this is the requested module...</span>
                                <b>if</b> (<a href="#d23a7b8d60e511ec" class="i method">IsModuleMatchingModuleSpec</a>(<span class="r77 r">module</span>, <span class="r70 r">moduleSpec</span>))
                                {
                                    <span class="r67 r">modulesMatched</span>.<span class="i">Add</span>(<span class="r77 r">module</span>);
                                }
                            }
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r67 r">modulesMatched</span>.<span class="i">OrderBy</span>(<b>static</b> <span id="r78 rd" class="r78 r">m</span> =&gt; <span class="r78 r">m</span>.<span class="i">Name</span>).<span class="i">ToList</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a given module info object matches a given module specification.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module info object to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">moduleSpec</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module specification to match the module info object against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">skipNameCheck</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if we should skip the name check on the module specification.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module info object meets all the constraints on the module specification, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="d23a7b8d60e511ec" href="../../R/d23a7b8d60e511ec.html" target="n" data-glyph="74,1" class="i method">IsModuleMatchingModuleSpec</a>(
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r79 rd" class="r79 r">moduleInfo</span>,
            <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r80 rd" class="r80 r">moduleSpec</span>,
            <b>bool</b> <span id="r81 rd" class="r81 r">skipNameCheck</span> = <b>false</b>)
        {
            <b>return</b> <a href="#38b8620192395694" class="i method">IsModuleMatchingModuleSpec</a>(<b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r82 rd" class="r82 r">matchFailureReason</span>, <span class="r79 r">moduleInfo</span>, <span class="r80 r">moduleSpec</span>, <span class="r81 r">skipNameCheck</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a given module info object matches a given module specification.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">matchFailureReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The constraint that caused the match failure, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module info object to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r85 r">moduleSpec</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module specification to match the module info object against.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">skipNameCheck</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if we should skip the name check on the module specification.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module info object meets all the constraints on the module specification, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="38b8620192395694" href="../../R/38b8620192395694.html" target="n" data-glyph="74,1" class="i method">IsModuleMatchingModuleSpec</a>(
            <b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r83 rd" class="r83 r">matchFailureReason</span>,
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r84 rd" class="r84 r">moduleInfo</span>,
            <a href="ModuleSpecification.cs.html#1fd961b021940b6a" class="t t">ModuleSpecification</a> <span id="r85 rd" class="r85 r">moduleSpec</span>,
            <b>bool</b> <span id="r86 rd" class="r86 r">skipNameCheck</span> = <b>false</b>)
        {
            <b>if</b> (<span class="r85 r">moduleSpec</span> == <b>null</b>)
            {
                <span class="r83 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#924dae0e2c66cca9" class="i field">NullModuleSpecification</a>;
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <a href="#d8f114396faf3ece" class="i method">IsModuleMatchingConstraints</a>(
                <b>out</b> <span class="r83 r">matchFailureReason</span>,
                <span class="r84 r">moduleInfo</span>,
                <span class="r86 r">skipNameCheck</span> ? <b>null</b> : <span class="r85 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#148bbf163788664b" class="i property">Name</a>,
                <span class="r85 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#062a45e81a3542d6" class="i property">Guid</a>,
                <span class="r85 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#ad460cb887264b84" class="i property">RequiredVersion</a>,
                <span class="r85 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#b7b161dc81e4fbe9" class="i property">Version</a>,
                <span class="r85 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a> == <b>null</b> ? <b>null</b> : <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="ModuleCmdletBase.cs.html#8d9eea57094a20b4" class="i method">GetMaximumVersion</a>(<span class="r85 r">moduleSpec</span>.<a href="ModuleSpecification.cs.html#7d051126154e5fa1" class="i property">MaximumVersion</a>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a given module info object matches the given constraints.</span>
        <span class="c">///</span><span class="c"> Constraints given as null are ignored.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module info object to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r88 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name or normalized absolute path of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r89 r">guid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The guid of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r90 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The required version of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">minimumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum required version of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">maximumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum required version of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module info object matches all given constraints, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="ce2ec20231eefd5b" href="../../R/ce2ec20231eefd5b.html" target="n" data-glyph="74,1" class="i method">IsModuleMatchingConstraints</a>(
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r87 rd" class="r87 r">moduleInfo</span>,
            <b>string</b> <span id="r88 rd" class="r88 r">name</span> = <b>null</b>,
            <span class="i">Guid</span>? <span id="r89 rd" class="r89 r">guid</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r90 rd" class="r90 r">requiredVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r91 rd" class="r91 r">minimumVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r92 rd" class="r92 r">maximumVersion</span> = <b>null</b>)
        {
            <b>return</b> <a href="#d8f114396faf3ece" class="i method">IsModuleMatchingConstraints</a>(
                <b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r93 rd" class="r93 r">matchFailureReason</span>,
                <span class="r87 r">moduleInfo</span>,
                <span class="r88 r">name</span>,
                <span class="r89 r">guid</span>,
                <span class="r90 r">requiredVersion</span>,
                <span class="r91 r">minimumVersion</span>,
                <span class="r92 r">maximumVersion</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a given module info object matches the given constraints.</span>
        <span class="c">///</span><span class="c"> Constraints given as null are ignored.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">matchFailureReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason for the module constraint match failing.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">moduleInfo</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module info object to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name or normalized absolute path of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">guid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The guid of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r98 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The required version of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">minimumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum required version of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">maximumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum required version of the expected module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module info object matches all given constraints, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="d8f114396faf3ece" href="../../R/d8f114396faf3ece.html" target="n" data-glyph="74,1" class="i method">IsModuleMatchingConstraints</a>(
            <b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r94 rd" class="r94 r">matchFailureReason</span>,
            <a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r95 rd" class="r95 r">moduleInfo</span>,
            <b>string</b> <span id="r96 rd" class="r96 r">name</span>,
            <span class="i">Guid</span>? <span id="r97 rd" class="r97 r">guid</span>,
            <span class="i">Version</span> <span id="r98 rd" class="r98 r">requiredVersion</span>,
            <span class="i">Version</span> <span id="r99 rd" class="r99 r">minimumVersion</span>,
            <span class="i">Version</span> <span id="r100 rd" class="r100 r">maximumVersion</span>)
        {
            <span class="c">// Define that a null module does not meet any constraints</span>
            <b>if</b> (<span class="r95 r">moduleInfo</span> == <b>null</b>)
            {
                <span class="r94 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#fc769a0baf21c1ad" class="i field">NullModule</a>;
                <b>return</b> <b>false</b>;
            }
 
            <b>return</b> <span class="i">AreModuleFieldsMatchingConstraints</span>(
                <b>out</b> <span class="r94 r">matchFailureReason</span>,
                <span class="r95 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>,
                <span class="r95 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#82fc7c994af5e4ca" class="i property">Path</a>,
                <span class="r95 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#474060a313707f03" class="i property">Guid</a>,
                <span class="r95 r">moduleInfo</span>.<a href="PSModuleInfo.cs.html#bb592ab5243224bb" class="i property">Version</a>,
                <span class="r96 r">name</span>,
                <span class="r97 r">guid</span>,
                <span class="r98 r">requiredVersion</span>,
                <span class="r99 r">minimumVersion</span>,
                <span class="r100 r">maximumVersion</span>
            );
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check that given module fields meet any given constraints.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">modulePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">moduleGuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The GUID of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">moduleVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">requiredName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name or normalized absolute path the module must have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">requiredGuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The GUID the module must have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The exact version the module must have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">minimumRequiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum version the module may have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">maximumRequiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum version the module may have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module parameters match all given constraints, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="57239b4bb91959b3" href="../../R/57239b4bb91959b3.html" target="n" data-glyph="74,1" class="i method">AreModuleFieldsMatchingConstraints</a>(
            <b>string</b> <span id="r101 rd" class="r101 r">moduleName</span> = <b>null</b>,
            <b>string</b> <span id="r102 rd" class="r102 r">modulePath</span> = <b>null</b>,
            <span class="i">Guid</span>? <span id="r103 rd" class="r103 r">moduleGuid</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r104 rd" class="r104 r">moduleVersion</span> = <b>null</b>,
            <b>string</b> <span id="r105 rd" class="r105 r">requiredName</span> = <b>null</b>,
            <span class="i">Guid</span>? <span id="r106 rd" class="r106 r">requiredGuid</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r107 rd" class="r107 r">requiredVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r108 rd" class="r108 r">minimumRequiredVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r109 rd" class="r109 r">maximumRequiredVersion</span> = <b>null</b>)
        {
            <b>return</b> <a href="#861c56af2688503a" class="i method">AreModuleFieldsMatchingConstraints</a>(
                <b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r110 rd" class="r110 r">matchFailureReason</span>,
                <span class="r101 r">moduleName</span>,
                <span class="r102 r">modulePath</span>,
                <span class="r103 r">moduleGuid</span>,
                <span class="r104 r">moduleVersion</span>,
                <span class="r105 r">requiredName</span>,
                <span class="r106 r">requiredGuid</span>,
                <span class="r107 r">requiredVersion</span>,
                <span class="r108 r">minimumRequiredVersion</span>,
                <span class="r109 r">maximumRequiredVersion</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check that given module fields meet any given constraints.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">matchFailureReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason the match failed, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">modulePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">moduleGuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The GUID of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r115 r">moduleVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version of the module to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r116 r">requiredName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name or normalized absolute path the module must have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r117 r">requiredGuid</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The GUID the module must have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r118 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The exact version the module must have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r119 r">minimumRequiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum version the module may have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r120 r">maximumRequiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum version the module may have, if any.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module parameters match all given constraints, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="861c56af2688503a" href="../../R/861c56af2688503a.html" target="n" data-glyph="74,1" class="i method">AreModuleFieldsMatchingConstraints</a>(
            <b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r111 rd" class="r111 r">matchFailureReason</span>,
            <b>string</b> <span id="r112 rd" class="r112 r">moduleName</span>,
            <b>string</b> <span id="r113 rd" class="r113 r">modulePath</span>,
            <span class="i">Guid</span>? <span id="r114 rd" class="r114 r">moduleGuid</span>,
            <span class="i">Version</span> <span id="r115 rd" class="r115 r">moduleVersion</span>,
            <b>string</b> <span id="r116 rd" class="r116 r">requiredName</span>,
            <span class="i">Guid</span>? <span id="r117 rd" class="r117 r">requiredGuid</span>,
            <span class="i">Version</span> <span id="r118 rd" class="r118 r">requiredVersion</span>,
            <span class="i">Version</span> <span id="r119 rd" class="r119 r">minimumRequiredVersion</span>,
            <span class="i">Version</span> <span id="r120 rd" class="r120 r">maximumRequiredVersion</span>)
        {
            <span class="c">// If a name is required, check that it matches.</span>
            <span class="c">// A required module name may also be an absolute path, so check it against the given module&#39;s path as well.</span>
            <b>if</b> (<span class="r116 r">requiredName</span> != <b>null</b>
                &amp;&amp; !<span class="r116 r">requiredName</span>.<span class="i">Equals</span>(<span class="r112 r">moduleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)
                &amp;&amp; !<a href="#bf797e0df851f35e" class="i method">MatchesModulePath</a>(<span class="r113 r">modulePath</span>, <span class="r116 r">requiredName</span>))
            {
                <span class="r111 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#30b08e827428de5d" class="i field">Name</a>;
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// If a GUID is required, check it matches</span>
            <b>if</b> (<span class="r117 r">requiredGuid</span> != <b>null</b> &amp;&amp; !<span class="r117 r">requiredGuid</span>.<span class="i">Equals</span>(<span class="r114 r">moduleGuid</span>))
            {
                <span class="r111 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#6b88def2a9764ae8" class="i field">Guid</a>;
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// Check the versions</span>
            <b>return</b> <a href="#e1ccca4e87fbc0c1" class="i method">IsVersionMatchingConstraints</a>(<b>out</b> <span class="r111 r">matchFailureReason</span>, <span class="r115 r">moduleVersion</span>, <span class="r118 r">requiredVersion</span>, <span class="r119 r">minimumRequiredVersion</span>, <span class="r120 r">maximumRequiredVersion</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check that a given module version matches the required or minimum/maximum version constraints.</span>
        <span class="c">///</span><span class="c"> Null constraints are not checked.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">version</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module version to check. Must not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version that the given version must be, if not null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r123 r">minimumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum version that the given version must be greater than or equal to, if not null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">maximumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum version that the given version must be less then or equal to, if not null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the version matches the required version, or if it is absent, is between the minimum and maximum versions, and false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="21096650e1ba6733" href="../../R/21096650e1ba6733.html" target="n" data-glyph="74,1" class="i method">IsVersionMatchingConstraints</a>(
            <span class="i">Version</span> <span id="r121 rd" class="r121 r">version</span>,
            <span class="i">Version</span> <span id="r122 rd" class="r122 r">requiredVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r123 rd" class="r123 r">minimumVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r124 rd" class="r124 r">maximumVersion</span> = <b>null</b>)
        {
            <b>return</b> <a href="#e1ccca4e87fbc0c1" class="i method">IsVersionMatchingConstraints</a>(<b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r125 rd" class="r125 r">matchFailureReason</span>, <span class="r121 r">version</span>, <span class="r122 r">requiredVersion</span>, <span class="r123 r">minimumVersion</span>, <span class="r124 r">maximumVersion</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check that a given module version matches the required or minimum/maximum version constraints.</span>
        <span class="c">///</span><span class="c"> Null constraints are not checked.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r126 r">matchFailureReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason why the match failed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r127 r">version</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module version to check. Must not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r128 r">requiredVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The version that the given version must be, if not null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r129 r">minimumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The minimum version that the given version must be greater than or equal to, if not null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r130 r">maximumVersion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum version that the given version must be less then or equal to, if not null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> True if the version matches the required version, or if it is absent, is between the minimum and maximum versions, and false otherwise.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="e1ccca4e87fbc0c1" href="../../R/e1ccca4e87fbc0c1.html" target="n" data-glyph="74,1" class="i method">IsVersionMatchingConstraints</a>(
            <b>out</b> <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a> <span id="r126 rd" class="r126 r">matchFailureReason</span>,
            <span class="i">Version</span> <span id="r127 rd" class="r127 r">version</span>,
            <span class="i">Version</span> <span id="r128 rd" class="r128 r">requiredVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r129 rd" class="r129 r">minimumVersion</span> = <b>null</b>,
            <span class="i">Version</span> <span id="r130 rd" class="r130 r">maximumVersion</span> = <b>null</b>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r127 r">version</span> != <b>null</b>, <span class="s">$&quot;</span><span class="s">Caller to verify that </span>{<b>nameof</b>(<span class="r127 r">version</span>)}<span class="s"> is not null</span><span class="s">&quot;</span>);
 
            <span class="c">// If a RequiredVersion is given it overrides other version settings</span>
            <b>if</b> (<span class="r128 r">requiredVersion</span> != <b>null</b>)
            {
                <span class="r126 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#b99682ee062b9abc" class="i field">RequiredVersion</a>;
                <b>return</b> <span class="r128 r">requiredVersion</span>.<span class="i">Equals</span>(<span class="r127 r">version</span>);
            }
 
            <span class="c">// Check the version is at least the minimum version</span>
            <b>if</b> (<span class="r129 r">minimumVersion</span> != <b>null</b> &amp;&amp; <span class="r127 r">version</span> &lt; <span class="r129 r">minimumVersion</span>)
            {
                <span class="r126 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#14ca67728e787bed" class="i field">MinimumVersion</a>;
                <b>return</b> <b>false</b>;
            }
 
            <span class="c">// Check the version is at most the maximum version</span>
            <b>if</b> (<span class="r130 r">maximumVersion</span> != <b>null</b> &amp;&amp; <span class="r127 r">version</span> &gt; <span class="r130 r">maximumVersion</span>)
            {
                <span class="r126 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#6f847e08b4b7ffc1" class="i field">MaximumVersion</a>;
                <b>return</b> <b>false</b>;
            }
 
            <span class="r126 r">matchFailureReason</span> = <a href="#8041ca95655b1733" class="t t">ModuleMatchFailure</a>.<a href="#c2056c6983c73cce" class="i field">None</a>;
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks whether a given module path is the same as</span>
        <span class="c">///</span><span class="c"> a required path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r131 r">modulePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path of the module whose path to check. This must be the path to the module file (.psd1, .psm1, .dll, etc).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r132 r">requiredPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path of the required module. This may be the module directory path or the file path. Only normalized absolute paths will work for this.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module path matches the required path, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="bf797e0df851f35e" href="../../R/bf797e0df851f35e.html" target="n" data-glyph="74,1" class="i method">MatchesModulePath</a>(<b>string</b> <span id="r131 rd" class="r131 r">modulePath</span>, <b>string</b> <span id="r132 rd" class="r132 r">requiredPath</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r132 r">requiredPath</span> != <b>null</b>, <span class="s">$&quot;</span><span class="s">Caller to verify that </span>{<b>nameof</b>(<span class="r132 r">requiredPath</span>)}<span class="s"> is not null</span><span class="s">&quot;</span>);
 
            <b>if</b> (<span class="r131 r">modulePath</span> == <b>null</b>)
            {
                <b>return</b> <b>false</b>;
            }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            const StringComparison strcmp = StringComparison.Ordinal;
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>const</b> <span class="i">StringComparison</span> <span id="r133 rd" class="r133 r">strcmp</span> = <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
            <span class="c">// We must check modulePath (e.g. /path/to/module/module.psd1) against several possibilities:</span>
            <span class="c">// 1. &quot;/path/to/module&quot;                 - Module dir path</span>
            <span class="c">// 2. &quot;/path/to/module/module.psd1&quot;     - Module root file path</span>
            <span class="c">// 3. &quot;/path/to/module/2.1/module.psd1&quot; - Versioned module path</span>
 
            <span class="c">// If the required module just matches the module path (case 1), we are done</span>
            <b>if</b> (<span class="r131 r">modulePath</span>.<span class="i">Equals</span>(<span class="r132 r">requiredPath</span>, <span class="r133 r">strcmp</span>))
            {
                <b>return</b> <b>true</b>;
            }
 
            <span class="c">// At this point we are looking for the module directory (case 2 or 3).</span>
            <span class="c">// We can some allocations here if module path doesn&#39;t sit under the required path</span>
            <span class="c">// (the required path may still refer to some nested module though)</span>
            <b>if</b> (!<span class="r131 r">modulePath</span>.<span class="i">StartsWith</span>(<span class="r132 r">requiredPath</span>, <span class="r133 r">strcmp</span>))
            {
                <b>return</b> <b>false</b>;
            }
 
            <b>string</b> <span id="r134 rd" class="r134 r">moduleDirPath</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r131 r">modulePath</span>);
 
            <span class="c">// The module itself may be in a versioned directory (case 3)</span>
            <b>if</b> (<span class="i">Version</span>.<span class="i">TryParse</span>(<span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r134 r">moduleDirPath</span>), <b>out</b> <span class="i">Version</span> <span id="r135 rd" class="r135 r">unused</span>))
            {
                <span class="r134 r">moduleDirPath</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r134 r">moduleDirPath</span>);
            }
 
            <b>return</b> <span class="r134 r">moduleDirPath</span>.<span class="i">Equals</span>(<span class="r132 r">requiredPath</span>, <span class="r133 r">strcmp</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Takes the name of a module as used in a module specification</span>
        <span class="c">///</span><span class="c"> and either returns it as a simple name (if it was a simple name)</span>
        <span class="c">///</span><span class="c"> or a fully qualified, PowerShell-resolved path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r136 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name or path of the module from the specification.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r137 r">basePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to base relative paths off.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r138 r">executionContext</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The current execution context.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The simple module name if the given one was simple,</span>
        <span class="c">///</span><span class="c"> otherwise a fully resolved, absolute path to the module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 2018-11-09 rjmholt:</span>
        <span class="c">///</span><span class="c"> There are several, possibly inconsistent, path handling mechanisms</span>
        <span class="c">///</span><span class="c"> in the module cmdlets. After looking through all of them and seeing</span>
        <span class="c">///</span><span class="c"> they all make some assumptions about their caller I wrote this method.</span>
        <span class="c">///</span><span class="c"> Hopefully we can find a standard path resolution API to settle on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="0845d92b463a8787" href="../../R/0845d92b463a8787.html" target="n" data-glyph="74,1" class="i method">NormalizeModuleName</a>(
            <b>string</b> <span id="r136 rd" class="r136 r">moduleName</span>,
            <b>string</b> <span id="r137 rd" class="r137 r">basePath</span>,
            <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r138 rd" class="r138 r">executionContext</span>)
        {
            <b>if</b> (<span class="r136 r">moduleName</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="c">// Check whether the module is a path -- if not, it is a simple name and we just return it.</span>
            <b>if</b> (!<a href="#b8546e22fc601f09" class="i method">IsModuleNamePath</a>(<span class="r136 r">moduleName</span>))
            {
                <b>return</b> <span class="r136 r">moduleName</span>;
            }
 
            <span class="c">// Standardize directory separators -- Path.IsPathRooted() will return false for &quot;\path\here&quot; on *nix and for &quot;/path/there&quot; on Windows</span>
            <span class="r136 r">moduleName</span> = <span class="r136 r">moduleName</span>.<span class="i">Replace</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>, <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
            <span class="c">// Note: Path.IsFullyQualified(&quot;\default\root&quot;) is false on Windows, but Path.IsPathRooted returns true</span>
            <b>if</b> (!<span class="i">Path</span>.<span class="i">IsPathRooted</span>(<span class="r136 r">moduleName</span>))
            {
                <span class="r136 r">moduleName</span> = <span class="i">Path</span>.<span class="i">Join</span>(<span class="r137 r">basePath</span>, <span class="r136 r">moduleName</span>);
            }
 
            <span class="c">// Use the PowerShell filesystem provider to fully resolve the path</span>
            <span class="c">// If there is a problem, null could be returned -- so default back to the pre-normalized path</span>
            <b>string</b> <span id="r139 rd" class="r139 r">normalizedPath</span> = <a href="ModuleCmdletBase.cs.html#0479f5f00c7dafc1" class="t t">ModuleCmdletBase</a>.<a href="ModuleCmdletBase.cs.html#7c03df577cede1d9" class="i method">GetResolvedPath</a>(<span class="r136 r">moduleName</span>, <span class="r138 r">executionContext</span>)?.<span class="i">TrimEnd</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>);
 
            <span class="c">// ModuleCmdletBase.GetResolvePath will return null in the unlikely event that it failed.</span>
            <span class="c">// If it does, we return the fully qualified path generated before.</span>
            <b>return</b> <span class="r139 r">normalizedPath</span> ?? <span class="i">Path</span>.<span class="i">GetFullPath</span>(<span class="r136 r">moduleName</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if a given module name is a path to a module rather than a simple name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r140 r">moduleName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The module name to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the module name is a path, false otherwise.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="b8546e22fc601f09" href="../../R/b8546e22fc601f09.html" target="n" data-glyph="74,1" class="i method">IsModuleNamePath</a>(<b>string</b> <span id="r140 rd" class="r140 r">moduleName</span>)
        {
            <b>return</b> <span class="r140 r">moduleName</span>.<span class="i">Contains</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#88fdd102fa325178" class="i field">DefaultPathSeparator</a>)
                || <span class="r140 r">moduleName</span>.<span class="i">Contains</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#f2548f0f61690656" class="i field">AlternatePathSeparator</a>)
                || <span class="r140 r">moduleName</span>.<span class="i">Equals</span>(<span class="s">&quot;..&quot;</span>)
                || <span class="r140 r">moduleName</span>.<span class="i">Equals</span>(<span class="s">&quot;.&quot;</span>);
        }
 
        <b>internal static</b> <span class="i">Version</span> <a id="038de7273b66a98e" href="../../R/038de7273b66a98e.html" target="n" data-glyph="74,1" class="i method">GetManifestModuleVersion</a>(<b>string</b> <span id="r141 rd" class="r141 r">manifestPath</span>)
        {
            <b>try</b>
            {
                <span class="i">Hashtable</span> <span id="r142 rd" class="r142 r">dataFileSetting</span> =
                    <a href="../../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../../utils/PsUtils.cs.html#7c4997ce508c858f" class="i method">GetModuleManifestProperties</a>(
                        <span class="r141 r">manifestPath</span>,
                        <a href="../../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../../utils/PsUtils.cs.html#6d92135ec8cdd0a6" class="i field">ManifestModuleVersionPropertyName</a>);
 
                <b>object</b> <span id="r143 rd" class="r143 r">versionValue</span> = <span class="r142 r">dataFileSetting</span>[<span class="s">&quot;ModuleVersion&quot;</span>];
                <b>if</b> (<span class="r143 r">versionValue</span> != <b>null</b>)
                {
                    <span class="i">Version</span> <span id="r144 rd" class="r144 r">moduleVersion</span>;
                    <b>if</b> (<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r143 r">versionValue</span>, <b>out</b> <span class="r144 r">moduleVersion</span>))
                    {
                        <b>return</b> <span class="r144 r">moduleVersion</span>;
                    }
                }
            }
            <b>catch</b> (<a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a>) { }
 
            <b>return</b> <b>new</b> <span class="i">Version</span>(0, 0);
        }
 
        <b>internal static</b> <span class="i">Guid</span> <a id="f342a9737d67f863" href="../../R/f342a9737d67f863.html" target="n" data-glyph="74,1" class="i method">GetManifestGuid</a>(<b>string</b> <span id="r145 rd" class="r145 r">manifestPath</span>)
        {
            <b>try</b>
            {
                <span class="i">Hashtable</span> <span id="r146 rd" class="r146 r">dataFileSetting</span> =
                    <a href="../../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../../utils/PsUtils.cs.html#7c4997ce508c858f" class="i method">GetModuleManifestProperties</a>(
                        <span class="r145 r">manifestPath</span>,
                        <a href="../../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../../utils/PsUtils.cs.html#1a985949987e36b7" class="i field">ManifestGuidPropertyName</a>);
 
                <b>object</b> <span id="r147 rd" class="r147 r">guidValue</span> = <span class="r146 r">dataFileSetting</span>[<span class="s">&quot;GUID&quot;</span>];
                <b>if</b> (<span class="r147 r">guidValue</span> != <b>null</b>)
                {
                    <span class="i">Guid</span> <span id="r148 rd" class="r148 r">guidID</span>;
                    <b>if</b> (<a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<span class="i">TryConvertTo</span>(<span class="r147 r">guidValue</span>, <b>out</b> <span class="r148 r">guidID</span>))
                    {
                        <b>return</b> <span class="r148 r">guidID</span>;
                    }
                }
            }
            <b>catch</b> (<a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a>) { }
 
            <b>return</b> <b>new</b> <span class="i">Guid</span>();
        }
 
        <b>internal static</b> <a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>[] <a id="975b161317b14773" href="../../R/975b161317b14773.html" target="n" data-glyph="74,1" class="i method">GetExperimentalFeature</a>(<b>string</b> <span id="r149 rd" class="r149 r">manifestPath</span>)
        {
            <b>try</b>
            {
                <span class="i">Hashtable</span> <span id="r150 rd" class="r150 r">dataFileSetting</span> =
                    <a href="../../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../../utils/PsUtils.cs.html#7c4997ce508c858f" class="i method">GetModuleManifestProperties</a>(
                        <span class="r149 r">manifestPath</span>,
                        <a href="../../utils/PsUtils.cs.html#2010e19f156f8c91" class="t t">PsUtils</a>.<a href="../../utils/PsUtils.cs.html#eb70ac5f7f493afd" class="i field">ManifestPrivateDataPropertyName</a>);
 
                <b>object</b> <span id="r151 rd" class="r151 r">privateData</span> = <span class="r150 r">dataFileSetting</span>[<span class="s">&quot;PrivateData&quot;</span>];
                <b>if</b> (<span class="r151 r">privateData</span> <b>is</b> <span class="i">Hashtable</span> <span id="r152 rd" class="r152 r">hashData</span> &amp;&amp; <span class="r152 r">hashData</span>[<span class="s">&quot;PSData&quot;</span>] <b>is</b> <span class="i">Hashtable</span> <span id="r153 rd" class="r153 r">psData</span>)
                {
                    <b>object</b> <span id="r154 rd" class="r154 r">expFeatureValue</span> = <span class="r153 r">psData</span>[<span class="s">&quot;ExperimentalFeatures&quot;</span>];
                    <b>if</b> (<span class="r154 r">expFeatureValue</span> != <b>null</b> &amp;&amp;
                        <a href="../LanguagePrimitives.cs.html#6dac09d64da9900c" class="t t">LanguagePrimitives</a>.<a href="../LanguagePrimitives.cs.html#0ba3f8cd03b35aee" class="i method">TryConvertTo</a>(<span class="r154 r">expFeatureValue</span>, <b>out</b> <span class="i">Hashtable</span>[] <span id="r155 rd" class="r155 r">features</span>) &amp;&amp;
                        <span class="r155 r">features</span>.<span class="i">Length</span> &gt; 0)
                    {
                        <b>string</b> <span id="r156 rd" class="r156 r">moduleName</span> = <a href="#1693bdfaeab6548d" class="t t">ModuleIntrinsics</a>.<a href="#3b1c534a2c3e41b0" class="i method">GetModuleName</a>(<span class="r149 r">manifestPath</span>);
                        <b>var</b> <span id="r157 rd" class="r157 r">expFeatureList</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>&gt;();
                        <b>foreach</b> (<span class="i">Hashtable</span> <span id="r158 rd" class="r158 r">feature</span> <b>in</b> <span class="r155 r">features</span>)
                        {
                            <b>string</b> <span id="r159 rd" class="r159 r">featureName</span> = <span class="r158 r">feature</span>[<span class="s">&quot;Name&quot;</span>] <b>as string</b>;
                            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r159 r">featureName</span>)) { <b>continue</b>; }
 
                            <b>if</b> (<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>.<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#078a2c141e5be6d1" class="i method">IsModuleFeatureName</a>(<span class="r159 r">featureName</span>, <span class="r156 r">moduleName</span>))
                            {
                                <b>string</b> <span id="r160 rd" class="r160 r">featureDescription</span> = <span class="r158 r">feature</span>[<span class="s">&quot;Description&quot;</span>] <b>as string</b>;
                                <span class="r157 r">expFeatureList</span>.<span class="i">Add</span>(<b>new</b> <a href="../ExperimentalFeature/ExperimentalFeature.cs.html#76cb8e09a7250dd9" class="t constructor">ExperimentalFeature</a>(<span class="r159 r">featureName</span>, <span class="r160 r">featureDescription</span>, <span class="r149 r">manifestPath</span>,
                                                                           <a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>.<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#e292001e34f610da" class="i method">IsEnabled</a>(<span class="r159 r">featureName</span>)));
                            }
                        }
 
                        <b>return</b> <span class="r157 r">expFeatureList</span>.<span class="i">ToArray</span>();
                    }
                }
            }
            <b>catch</b> (<a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a>) { }
 
            <b>return</b> <span class="i">Array</span>.<span class="i">Empty</span>&lt;<a href="../ExperimentalFeature/ExperimentalFeature.cs.html#6626da1ebcb2b206" class="t t">ExperimentalFeature</a>&gt;();
        }
 
        <span class="c">// The extensions of all of the files that can be processed with Import-Module, put the ni.dll in front of .dll to have higher priority to be loaded.</span>
        <b>internal static readonly string</b>[] <a id="9aabe876534eafbf" href="../../R/9aabe876534eafbf.html" target="n" data-glyph="44,1" class="i field">PSModuleProcessableExtensions</a> = <b>new</b> <b>string</b>[] {
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2338784ad03a106f" class="i field">PowerShellScriptFileExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8de3ad39fcb348d7" class="i field">PowerShellCmdletizationFileExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>,
                        };
 
        <span class="c">// A list of the extensions to check for implicit module loading and discovery, put the ni.dll in front of .dll to have higher priority to be loaded.</span>
        <b>internal static readonly string</b>[] <a id="2f61be99d14256e7" href="../../R/2f61be99d14256e7.html" target="n" data-glyph="44,1" class="i field">PSModuleExtensions</a> = <b>new</b> <b>string</b>[] {
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#35afed2e7cb8ba9d" class="i field">PowerShellDataFileExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#d3eec386d080fd52" class="i field">PowerShellModuleFileExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8de3ad39fcb348d7" class="i field">PowerShellCmdletizationFileExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#8b7b1c77a80f7bf4" class="i field">PowerShellILAssemblyExtension</a>,
                            <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#b12271d4e9d97dc9" class="i field">PowerShellILExecutableExtension</a>,
                        };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns true if the extension is one of the module extensions...</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r161 r">extension</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The extension to check.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if it was a module extension...</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="15ae80b6bdf925b0" href="../../R/15ae80b6bdf925b0.html" target="n" data-glyph="74,1" class="i method">IsPowerShellModuleExtension</a>(<b>string</b> <span id="r161 rd" class="r161 r">extension</span>)
        {
            <b>foreach</b> (<b>string</b> <span id="r162 rd" class="r162 r">ext</span> <b>in</b> <a href="#9aabe876534eafbf" class="i field">PSModuleProcessableExtensions</a>)
            {
                <b>if</b> (<span class="r161 r">extension</span>.<span class="i">Equals</span>(<span class="r162 r">ext</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                    <b>return</b> <b>true</b>;
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the module name from module path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r163 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path to the module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The module name.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="3b1c534a2c3e41b0" href="../../R/3b1c534a2c3e41b0.html" target="n" data-glyph="74,1" class="i method">GetModuleName</a>(<b>string</b> <span id="r163 rd" class="r163 r">path</span>)
        {
            <b>string</b> <span id="r164 rd" class="r164 r">fileName</span> = <span class="r163 r">path</span> == <b>null</b> ? <b>string</b>.<span class="i">Empty</span> : <span class="i">Path</span>.<span class="i">GetFileName</span>(<span class="r163 r">path</span>);
            <b>string</b> <span id="r165 rd" class="r165 r">ext</span>;
            <b>if</b> (<span class="r164 r">fileName</span>.<span class="i">EndsWith</span>(<a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
            {
                <span class="r165 r">ext</span> = <a href="../SessionStateStrings.cs.html#55ee11e42c7cf459" class="t t">StringLiterals</a>.<a href="../SessionStateStrings.cs.html#2e404a9d6d45ec4c" class="i field">PowerShellNgenAssemblyExtension</a>;
            }
            <b>else</b>
            {
                <span class="r165 r">ext</span> = <span class="i">Path</span>.<span class="i">GetExtension</span>(<span class="r164 r">fileName</span>);
            }
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r165 r">ext</span>) &amp;&amp; <a href="#15ae80b6bdf925b0" class="i method">IsPowerShellModuleExtension</a>(<span class="r165 r">ext</span>))
            {
                <b>return</b> <span class="r164 r">fileName</span>.<span class="i">Substring</span>(0, <span class="r164 r">fileName</span>.<span class="i">Length</span> - <span class="r165 r">ext</span>.<span class="i">Length</span>);
            }
            <b>else</b>
            {
                <b>return</b> <span class="r164 r">fileName</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the personal module path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Personal module path.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="f3c6b789edf3cc5c" href="../../R/f3c6b789edf3cc5c.html" target="n" data-glyph="74,1" class="i method">GetPersonalModulePath</a>()
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return Platform.SelectProductNameForDirectory(Platform.XDG_Type.USER_MODULES);
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>return</b> <span class="i">Path</span>.<span class="i">Combine</span>(<span class="i">Environment</span>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">MyDocuments</span>), <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#95980f521347c6c4" class="i field">ModuleDirectory</a>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the PSHome module path, as known as the &quot;system wide module path&quot; in windows powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The PSHome module path.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="f7332eb7c199d50c" href="../../R/f7332eb7c199d50c.html" target="n" data-glyph="74,1" class="i method">GetPSHomeModulePath</a>()
        {
            <b>if</b> (<a href="#80a9ec2c3dbee067" class="i field">s_psHomeModulePath</a> != <b>null</b>)
            {
                <b>return</b> <a href="#80a9ec2c3dbee067" class="i field">s_psHomeModulePath</a>;
            }
 
            <b>try</b>
            {
                <b>string</b> <span id="r166 rd" class="r166 r">psHome</span> = <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#c677cc800603f8f5" class="i property">DefaultPowerShellAppBase</a>;
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r166 r">psHome</span>))
                {
                    <span class="c">// Win8: 584267 Powershell Modules are listed twice in x86, and cannot be removed</span>
                    <span class="c">// This happens because ModuleTable uses Path as the key and CBS installer</span>
                    <span class="c">// expands the path to include &quot;SysWOW64&quot; (for</span>
                    <span class="c">// HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\PowerShell\3\PowerShellEngine ApplicationBase).</span>
                    <span class="c">// Because of this, the module that is getting loaded during startup (through LocalRunspace)</span>
                    <span class="c">// is using &quot;SysWow64&quot; in the key. Later, when Import-Module is called, it loads the</span>
                    <span class="c">// module using &quot;&quot;System32&quot; in the key.</span>
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
                    <span class="r166 r">psHome</span> = <span class="r166 r">psHome</span>.<span class="i">ToLowerInvariant</span>().<span class="i">Replace</span>(<span class="s">&quot;\\syswow64\\&quot;</span>, <span class="s">&quot;\\system32\\&quot;</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
                    <span class="i">Interlocked</span>.<span class="i">CompareExchange</span>(<b>ref</b> <a href="#80a9ec2c3dbee067" class="i field">s_psHomeModulePath</a>, <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r166 r">psHome</span>, <span class="s">&quot;Modules&quot;</span>), <b>null</b>);
                }
            }
            <b>catch</b> (<span class="i n">System</span>.<span class="i">Security</span>.<span class="i">SecurityException</span>)
            {
            }
 
            <b>return</b> <a href="#80a9ec2c3dbee067" class="i field">s_psHomeModulePath</a>;
        }
 
        <b>private static string</b> <a id="80a9ec2c3dbee067" href="../../R/80a9ec2c3dbee067.html" target="n" data-glyph="46,1" class="i field">s_psHomeModulePath</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the module path that is shared among different users.</span>
        <span class="c">///</span><span class="c"> It&#39;s known as &quot;Program Files&quot; module path in windows powershell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="59de05c9fc665c64" href="../../R/59de05c9fc665c64.html" target="n" data-glyph="74,1" class="i method">GetSharedModulePath</a>()
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">UNIX</span>
<span class="e">            return Platform.SelectProductNameForDirectory(Platform.XDG_Type.SHARED_MODULES);
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <b>string</b> <span id="r167 rd" class="r167 r">sharedModulePath</span> = <span class="i">Environment</span>.<span class="i">GetFolderPath</span>(<span class="i">Environment</span>.<span class="i">SpecialFolder</span>.<span class="i">ProgramFiles</span>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r167 r">sharedModulePath</span>))
            {
                <span class="r167 r">sharedModulePath</span> = <span class="i">Path</span>.<span class="i">Combine</span>(<span class="r167 r">sharedModulePath</span>, <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#95980f521347c6c4" class="i field">ModuleDirectory</a>);
            }
 
            <b>return</b> <span class="r167 r">sharedModulePath</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the path to the Windows PowerShell module directory under the</span>
        <span class="c">///</span><span class="c"> System32 directory on Windows (the Windows PowerShell $PSHOME).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The path of the Windows PowerShell system module directory.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="9e6ec7a131c8fddd" href="../../R/9e6ec7a131c8fddd.html" target="n" data-glyph="74,1" class="i method">GetWindowsPowerShellPSHomeModulePath</a>()
        {
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<a href="../Utils.cs.html#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="../Utils.cs.html#b8dcd5e111afc295" class="i field">TestWindowsPowerShellPSHomeLocation</a>))
            {
                <b>return</b> <a href="../Utils.cs.html#f365eaa75311eda0" class="t t">InternalTestHooks</a>.<a href="../Utils.cs.html#b8dcd5e111afc295" class="i field">TestWindowsPowerShellPSHomeLocation</a>;
            }
 
            <b>return</b> <a href="#8a7e75c5da14ed07" class="i field">s_windowsPowerShellPSHomeModulePath</a>;
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Combine the PS system-wide module path and the DSC module path</span>
        <span class="c">///</span><span class="c"> to get the system module paths.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="96faab271fc5c38f" href="../../R/96faab271fc5c38f.html" target="n" data-glyph="76,1" class="i method">CombineSystemModulePaths</a>()
        {
            <b>string</b> <span id="r168 rd" class="r168 r">psHomeModulePath</span> = <a href="#f7332eb7c199d50c" class="i method">GetPSHomeModulePath</a>();
            <b>string</b> <span id="r169 rd" class="r169 r">sharedModulePath</span> = <a href="#59de05c9fc665c64" class="i method">GetSharedModulePath</a>();
 
            <b>bool</b> <span id="r170 rd" class="r170 r">isPSHomePathNullOrEmpty</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r168 r">psHomeModulePath</span>);
            <b>bool</b> <span id="r171 rd" class="r171 r">isSharedPathNullOrEmpty</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r169 r">sharedModulePath</span>);
 
            <b>if</b> (!<span class="r170 r">isPSHomePathNullOrEmpty</span> &amp;&amp; !<span class="r171 r">isSharedPathNullOrEmpty</span>)
            {
                <b>return</b> (<span class="r169 r">sharedModulePath</span> + <span class="i">Path</span>.<span class="i">PathSeparator</span> + <span class="r168 r">psHomeModulePath</span>);
            }
 
            <b>if</b> (!<span class="r170 r">isPSHomePathNullOrEmpty</span> || !<span class="r171 r">isSharedPathNullOrEmpty</span>)
            {
                <b>return</b> <span class="r170 r">isPSHomePathNullOrEmpty</span> ? <span class="r169 r">sharedModulePath</span> : <span class="r168 r">psHomeModulePath</span>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <b>internal static string</b> <a id="2069a9077d0ca926" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetExpandedEnvironmentVariable</a>(<b>string</b> <span id="r172 rd" class="r172 r">name</span>, <span class="i">EnvironmentVariableTarget</span> <span id="r173 rd" class="r173 r">target</span>)
        {
            <b>string</b> <span id="r174 rd" class="r174 r">result</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<span class="r172 r">name</span>, <span class="r173 r">target</span>);
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r174 r">result</span>))
            {
                <span class="r174 r">result</span> = <span class="i">Environment</span>.<span class="i">ExpandEnvironmentVariables</span>(<span class="r174 r">result</span>);
            }
 
            <b>return</b> <span class="r174 r">result</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if a particular string (path) is a member of &#39;combined path&#39; string (like %Path% or %PSModulePath%)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">pathToScan</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&#39;Combined path&#39; string to analyze; can not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">pathToLookFor</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Path to search for; can not be another &#39;combined path&#39; (semicolon-separated); can not be null.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Index of pathToLookFor in pathToScan; -1 if not found.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static int</b> <a id="09ccf6d89108a7f8" href="../../R/09ccf6d89108a7f8.html" target="n" data-glyph="76,1" class="i method">PathContainsSubstring</a>(<b>string</b> <span id="r175 rd" class="r175 r">pathToScan</span>, <b>string</b> <span id="r176 rd" class="r176 r">pathToLookFor</span>)
        {
            <span class="c">// we don&#39;t support if any of the args are null - parent function should ensure this; empty values are ok</span>
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r175 r">pathToScan</span> != <b>null</b>, <span class="s">&quot;pathToScan should not be null according to contract of the function&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r176 r">pathToLookFor</span> != <b>null</b>, <span class="s">&quot;pathToLookFor should not be null according to contract of the function&quot;</span>);
 
            <b>int</b> <span id="r177 rd" class="r177 r">pos</span> = 0; <span class="c">// position of the current substring in pathToScan</span>
            <b>string</b>[] <span id="r178 rd" class="r178 r">substrings</span> = <span class="r175 r">pathToScan</span>.<span class="i">Split</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#016bc808c2acadd4" class="i field">PathSeparator</a>, <span class="i">StringSplitOptions</span>.<span class="i">None</span>); <span class="c">// we want to process empty entries</span>
            <b>string</b> <span id="r179 rd" class="r179 r">goodPathToLookFor</span> = <span class="r176 r">pathToLookFor</span>.<span class="i">Trim</span>().<span class="i">TrimEnd</span>(<span class="i">Path</span>.<span class="i">DirectorySeparatorChar</span>); <span class="c">// trailing backslashes and white-spaces will mess up equality comparison</span>
            <b>foreach</b> (<b>string</b> <span id="r180 rd" class="r180 r">substring</span> <b>in</b> <span class="r178 r">substrings</span>)
            {
                <b>string</b> <span id="r181 rd" class="r181 r">goodSubstring</span> = <span class="r180 r">substring</span>.<span class="i">Trim</span>().<span class="i">TrimEnd</span>(<span class="i">Path</span>.<span class="i">DirectorySeparatorChar</span>);  <span class="c">// trailing backslashes and white-spaces will mess up equality comparison</span>
 
                <span class="c">// We have to use equality comparison on individual substrings (as opposed to simple &#39;string.IndexOf&#39; or &#39;string.Contains&#39;)</span>
                <span class="c">// because of cases like { pathToScan=&quot;C:\Temp\MyDir\MyModuleDir&quot;, pathToLookFor=&quot;C:\Temp&quot; }</span>
 
                <b>if</b> (<b>string</b>.<span class="i">Equals</span>(<span class="r181 r">goodSubstring</span>, <span class="r179 r">goodPathToLookFor</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <b>return</b> <span class="r177 r">pos</span>; <span class="c">// match found - return index of it in the &#39;pathToScan&#39; string</span>
                }
                <b>else</b>
                {
                    <span class="r177 r">pos</span> += <span class="r180 r">substring</span>.<span class="i">Length</span> + 1; <span class="c">// &#39;1&#39; is for trailing semicolon</span>
                }
            }
            <span class="c">// if we are here, that means a match was not found</span>
            <b>return</b> -1;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds paths to a &#39;combined path&#39; string (like %Path% or %PSModulePath%) if they are not already there.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r182 r">basePath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Path string (like %Path% or %PSModulePath%).</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r183 r">pathToAdd</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Collection of individual paths to add.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r184 r">insertPosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">-1 to append to the end; 0 to insert in the beginning of the string; etc...</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Result string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="3455eaa935869a4a" href="../../R/3455eaa935869a4a.html" target="n" data-glyph="76,1" class="i method">AddToPath</a>(<b>string</b> <span id="r182 rd" class="r182 r">basePath</span>, <b>string</b> <span id="r183 rd" class="r183 r">pathToAdd</span>, <b>int</b> <span id="r184 rd" class="r184 r">insertPosition</span>)
        {
            <span class="c">// we don&#39;t support if any of the args are null - parent function should ensure this; empty values are ok</span>
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r182 r">basePath</span> != <b>null</b>, <span class="s">&quot;basePath should not be null according to contract of the function&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r183 r">pathToAdd</span> != <b>null</b>, <span class="s">&quot;pathToAdd should not be null according to contract of the function&quot;</span>);
 
            <span class="i">StringBuilder</span> <span id="r185 rd" class="r185 r">result</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r182 r">basePath</span>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r183 r">pathToAdd</span>)) <span class="c">// we don&#39;t want to append empty paths</span>
            {
                <b>foreach</b> (<b>string</b> <span id="r186 rd" class="r186 r">subPathToAdd</span> <b>in</b> <span class="r183 r">pathToAdd</span>.<span class="i">Split</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#016bc808c2acadd4" class="i field">PathSeparator</a>, <span class="i">StringSplitOptions</span>.<span class="i">RemoveEmptyEntries</span>)) <span class="c">// in case pathToAdd is a &#39;combined path&#39; (semicolon-separated)</span>
                {
                    <b>int</b> <span id="r187 rd" class="r187 r">position</span> = <span class="i">PathContainsSubstring</span>(<span class="r185 r">result</span>.<span class="i">ToString</span>(), <span class="r186 r">subPathToAdd</span>); <span class="c">// searching in effective &#39;result&#39; value ensures that possible duplicates in pathsToAdd are handled correctly</span>
                    <b>if</b> (<span class="r187 r">position</span> == -1) <span class="c">// subPathToAdd not found - add it</span>
                    {
                        <b>if</b> (<span class="r184 r">insertPosition</span> == -1) <span class="c">// append subPathToAdd to the end</span>
                        {
                            <b>bool</b> <span id="r188 rd" class="r188 r">endsWithPathSeparator</span> = <b>false</b>;
                            <b>if</b> (<span class="r185 r">result</span>.<span class="i">Length</span> &gt; 0) <span class="r188 r">endsWithPathSeparator</span> = (<span class="r185 r">result</span>[<span class="r185 r">result</span>.<span class="i">Length</span> - 1] == <span class="i">Path</span>.<span class="i">PathSeparator</span>);
 
                            <b>if</b> (<span class="r188 r">endsWithPathSeparator</span>)
                                <span class="r185 r">result</span>.<span class="i">Append</span>(<span class="r186 r">subPathToAdd</span>);
                            <b>else</b>
                                <span class="r185 r">result</span>.<span class="i">Append</span>(<span class="i">Path</span>.<span class="i">PathSeparator</span> + <span class="r186 r">subPathToAdd</span>);
                        }
                        <b>else</b> <b>if</b> (<span class="r184 r">insertPosition</span> &gt; <span class="r185 r">result</span>.<span class="i">Length</span>)
                        {
                            <span class="c">// handle case where path is a singleton with no path seperator already</span>
                            <span class="r185 r">result</span>.<span class="i">Append</span>(<span class="i">Path</span>.<span class="i">PathSeparator</span>).<span class="i">Append</span>(<span class="r186 r">subPathToAdd</span>);
                        }
                        <b>else</b> <span class="c">// insert at the requested location (this is used by DSC (&lt;Program Files&gt; location) and by &#39;user-specific location&#39; (SpecialFolder.MyDocuments or EVT.User))</span>
                        {
                            <span class="r185 r">result</span>.<span class="i">Insert</span>(<span class="r184 r">insertPosition</span>, <span class="r186 r">subPathToAdd</span> + <span class="i">Path</span>.<span class="i">PathSeparator</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <span class="r185 r">result</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks the various PSModulePath environment string and returns PSModulePath string as appropriate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="d82cbef887ba01a2" href="../../R/d82cbef887ba01a2.html" target="n" data-glyph="72,1" class="i method">GetModulePath</a>(<b>string</b> <span id="r189 rd" class="r189 r">currentProcessModulePath</span>, <b>string</b> <span id="r190 rd" class="r190 r">hklmMachineModulePath</span>, <b>string</b> <span id="r191 rd" class="r191 r">hkcuUserModulePath</span>)
        {
            <b>string</b> <span id="r192 rd" class="r192 r">personalModulePath</span> = <a href="#f3c6b789edf3cc5c" class="i method">GetPersonalModulePath</a>();
            <b>string</b> <span id="r193 rd" class="r193 r">sharedModulePath</span> = <a href="#59de05c9fc665c64" class="i method">GetSharedModulePath</a>(); <span class="c">// aka &lt;Program Files&gt; location</span>
            <b>string</b> <span id="r194 rd" class="r194 r">psHomeModulePath</span> = <a href="#f7332eb7c199d50c" class="i method">GetPSHomeModulePath</a>(); <span class="c">// $PSHome\Modules location</span>
 
            <span class="c">// If the variable isn&#39;t set, then set it to the default value</span>
            <b>if</b> (<span class="r189 r">currentProcessModulePath</span> == <b>null</b>)  <span class="c">// EVT.Process does Not exist - really corner case</span>
            {
                <span class="c">// Handle the default case...</span>
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r191 r">hkcuUserModulePath</span>)) <span class="c">// EVT.User does Not exist -&gt; set to &lt;SpecialFolder.MyDocuments&gt; location</span>
                {
                    <span class="r189 r">currentProcessModulePath</span> = <span class="r192 r">personalModulePath</span>; <span class="c">// = SpecialFolder.MyDocuments + Utils.ProductNameForDirectory + Utils.ModuleDirectory</span>
                }
                <b>else</b> <span class="c">// EVT.User exists -&gt; set to EVT.User</span>
                {
                    <span class="r189 r">currentProcessModulePath</span> = <span class="r191 r">hkcuUserModulePath</span>; <span class="c">// = EVT.User</span>
                }
 
                <span class="r189 r">currentProcessModulePath</span> += <span class="i">Path</span>.<span class="i">PathSeparator</span>;
                <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r190 r">hklmMachineModulePath</span>)) <span class="c">// EVT.Machine does Not exist</span>
                {
                    <span class="r189 r">currentProcessModulePath</span> += <a href="#96faab271fc5c38f" class="i method">CombineSystemModulePaths</a>(); <span class="c">// += (SharedModulePath + $PSHome\Modules)</span>
                }
                <b>else</b>
                {
                    <span class="r189 r">currentProcessModulePath</span> += <span class="r190 r">hklmMachineModulePath</span>; <span class="c">// += EVT.Machine</span>
                }
            }
            <span class="c">// EVT.Process exists</span>
            <span class="c">// Now handle the case where the environment variable is already set.</span>
            <b>else</b>
            {
                <b>string</b> <span id="r195 rd" class="r195 r">personalModulePathToUse</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r191 r">hkcuUserModulePath</span>) ? <span class="r192 r">personalModulePath</span> : <span class="r191 r">hkcuUserModulePath</span>;
                <b>string</b> <span id="r196 rd" class="r196 r">systemModulePathToUse</span> = <b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r190 r">hklmMachineModulePath</span>) ? <span class="r194 r">psHomeModulePath</span> : <span class="r190 r">hklmMachineModulePath</span>;
 
                <span class="c">// Maintain order of the paths, but ahead of any existing paths:</span>
                <span class="c">// personalModulePath</span>
                <span class="c">// sharedModulePath</span>
                <span class="c">// systemModulePath</span>
                <span class="r189 r">currentProcessModulePath</span> = <a href="#3455eaa935869a4a" class="i method">AddToPath</a>(<span class="r189 r">currentProcessModulePath</span>, <span class="r195 r">personalModulePathToUse</span>, 0);
                <b>int</b> <span id="r197 rd" class="r197 r">insertIndex</span> = <a href="#09ccf6d89108a7f8" class="i method">PathContainsSubstring</a>(<span class="r189 r">currentProcessModulePath</span>, <span class="r195 r">personalModulePathToUse</span>) + <span class="r195 r">personalModulePathToUse</span>.<span class="i">Length</span> + 1;
                <span class="r189 r">currentProcessModulePath</span> = <a href="#3455eaa935869a4a" class="i method">AddToPath</a>(<span class="r189 r">currentProcessModulePath</span>, <span class="r193 r">sharedModulePath</span>, <span class="r197 r">insertIndex</span>);
                <span class="r197 r">insertIndex</span> = <a href="#09ccf6d89108a7f8" class="i method">PathContainsSubstring</a>(<span class="r189 r">currentProcessModulePath</span>, <span class="r193 r">sharedModulePath</span>) + <span class="r193 r">sharedModulePath</span>.<span class="i">Length</span> + 1;
                <span class="r189 r">currentProcessModulePath</span> = <a href="#3455eaa935869a4a" class="i method">AddToPath</a>(<span class="r189 r">currentProcessModulePath</span>, <span class="r196 r">systemModulePathToUse</span>, <span class="r197 r">insertIndex</span>);
            }
 
            <b>return</b> <span class="r189 r">currentProcessModulePath</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if $env:PSModulePath is not set and sets it as appropriate. Note - because these</span>
        <span class="c">///</span><span class="c"> strings go through the provider, we need to escape any wildcards before passing them</span>
        <span class="c">///</span><span class="c"> along.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="e115fa8139f74585" href="../../R/e115fa8139f74585.html" target="n" data-glyph="74,1" class="i method">GetModulePath</a>()
        {
            <b>string</b> <span id="r198 rd" class="r198 r">currentModulePath</span> = <span class="i">GetExpandedEnvironmentVariable</span>(<a href="#ed7549e40b469e9f" class="t t">Constants</a>.<a href="#21c1e0b05c7ef699" class="i field">PSModulePathEnvVar</a>, <span class="i">EnvironmentVariableTarget</span>.<span class="i">Process</span>);
            <b>return</b> <span class="r198 r">currentModulePath</span>;
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a PSModulePath suiteable for Windows PowerShell by removing PowerShell&#39;s specific</span>
        <span class="c">///</span><span class="c"> paths from current PSModulePath.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns appropriate PSModulePath for Windows PowerShell.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="8aad16e2b6c26ef3" href="../../R/8aad16e2b6c26ef3.html" target="n" data-glyph="74,1" class="i method">GetWindowsPowerShellModulePath</a>()
        {
            <b>string</b> <span id="r199 rd" class="r199 r">currentModulePath</span> = <a href="#e115fa8139f74585" class="i method">GetModulePath</a>();
 
            <b>if</b> (<span class="r199 r">currentModulePath</span> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <span class="c">// PowerShell specific paths including if set in powershell.config.json file we want to exclude</span>
            <b>var</b> <span id="r200 rd" class="r200 r">excludeModulePaths</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>) {
                <a href="#f3c6b789edf3cc5c" class="i method">GetPersonalModulePath</a>(),
                <a href="#59de05c9fc665c64" class="i method">GetSharedModulePath</a>(),
                <a href="#f7332eb7c199d50c" class="i method">GetPSHomeModulePath</a>(),
                <a href="../PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="../PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="../PSConfiguration.cs.html#bdbbbcbc10c32338" class="i method">GetModulePath</a>(<a href="../PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="../PSConfiguration.cs.html#378339620026a80d" class="i field">AllUsers</a>),
                <a href="../PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="../PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="../PSConfiguration.cs.html#bdbbbcbc10c32338" class="i method">GetModulePath</a>(<a href="../PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="../PSConfiguration.cs.html#2486a7ab834532b3" class="i field">CurrentUser</a>)
            };
 
            <b>var</b> <span id="r201 rd" class="r201 r">modulePathList</span> = <b>new</b> <span class="i">List</span>&lt;<b>string</b>&gt;();
            <b>foreach</b> (<b>var</b> <span id="r202 rd" class="r202 r">path</span> <b>in</b> <span class="r199 r">currentModulePath</span>.<span class="i">Split</span>(<span class="s">&#39;;&#39;</span>))
            {
                <b>var</b> <span id="r203 rd" class="r203 r">trimmedPath</span> = <span class="r202 r">path</span>.<span class="i">Trim</span>();
                <b>if</b> (!<span class="r200 r">excludeModulePaths</span>.<span class="i">Contains</span>(<span class="r203 r">trimmedPath</span>))
                {
                    <span class="c">// make sure this module path is Not part of other PS Core installation</span>
                    <b>var</b> <span id="r204 rd" class="r204 r">possiblePwshDir</span> = <span class="i">Path</span>.<span class="i">GetDirectoryName</span>(<span class="r203 r">trimmedPath</span>);
 
                    <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r204 r">possiblePwshDir</span>))
                    {
                        <span class="c">// i.e. module dir is in the drive root</span>
                        <span class="r201 r">modulePathList</span>.<span class="i">Add</span>(<span class="r203 r">trimmedPath</span>);
                    }
                    <b>else</b>
                    {
                        <b>if</b> (!<span class="i">File</span>.<span class="i">Exists</span>(<span class="i">Path</span>.<span class="i">Combine</span>(<span class="r204 r">possiblePwshDir</span>, <span class="s">&quot;pwsh.dll&quot;</span>)))
                        {
                            <span class="r201 r">modulePathList</span>.<span class="i">Add</span>(<span class="r203 r">trimmedPath</span>);
                        }
                    }
                }
            }
 
            <b>return</b> <b>string</b>.<span class="i">Join</span>(<span class="i">Path</span>.<span class="i">PathSeparator</span>, <span class="r201 r">modulePathList</span>);
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks if $env:PSModulePath is not set and sets it as appropriate. Note - because these</span>
        <span class="c">///</span><span class="c"> strings go through the provider, we need to escape any wildcards before passing them</span>
        <span class="c">///</span><span class="c"> along.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="c6daade75c475a71" href="../../R/c6daade75c475a71.html" target="n" data-glyph="76,1" class="i method">SetModulePath</a>()
        {
            <b>string</b> <span id="r205 rd" class="r205 r">currentModulePath</span> = <span class="i">GetExpandedEnvironmentVariable</span>(<a href="#ed7549e40b469e9f" class="t t">Constants</a>.<a href="#21c1e0b05c7ef699" class="i field">PSModulePathEnvVar</a>, <span class="i">EnvironmentVariableTarget</span>.<span class="i">Process</span>);
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">UNIX</span>
            <span class="c">// if the current process and user env vars are the same, it means we need to append the machine one as it&#39;s incomplete</span>
            <span class="c">// otherwise, the user modified it and we should use the process one</span>
            <b>if</b> (<b>string</b>.<span class="i">CompareOrdinal</span>(<span class="i">GetExpandedEnvironmentVariable</span>(<a href="#ed7549e40b469e9f" class="t t">Constants</a>.<a href="#21c1e0b05c7ef699" class="i field">PSModulePathEnvVar</a>, <span class="i">EnvironmentVariableTarget</span>.<span class="i">User</span>), <span class="r205 r">currentModulePath</span>) == 0)
            {
                <span class="r205 r">currentModulePath</span> = <span class="r205 r">currentModulePath</span> + <span class="i">Path</span>.<span class="i">PathSeparator</span> + <span class="i">GetExpandedEnvironmentVariable</span>(<a href="#ed7549e40b469e9f" class="t t">Constants</a>.<a href="#21c1e0b05c7ef699" class="i field">PSModulePathEnvVar</a>, <span class="i">EnvironmentVariableTarget</span>.<span class="i">Machine</span>);
            }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>string</b> <span id="r206 rd" class="r206 r">allUsersModulePath</span> = <a href="../PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="../PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="../PSConfiguration.cs.html#bdbbbcbc10c32338" class="i method">GetModulePath</a>(<a href="../PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="../PSConfiguration.cs.html#378339620026a80d" class="i field">AllUsers</a>);
            <b>string</b> <span id="r207 rd" class="r207 r">personalModulePath</span> = <a href="../PSConfiguration.cs.html#9641e95401c2a85d" class="t t">PowerShellConfig</a>.<a href="../PSConfiguration.cs.html#e4c913e160567f04" class="i field">Instance</a>.<a href="../PSConfiguration.cs.html#bdbbbcbc10c32338" class="i method">GetModulePath</a>(<a href="../PSConfiguration.cs.html#377f34beb5e362cf" class="t t">ConfigScope</a>.<a href="../PSConfiguration.cs.html#2486a7ab834532b3" class="i field">CurrentUser</a>);
            <b>string</b> <span id="r208 rd" class="r208 r">newModulePathString</span> = <a href="#d82cbef887ba01a2" class="i method">GetModulePath</a>(<span class="r205 r">currentModulePath</span>, <span class="r206 r">allUsersModulePath</span>, <span class="r207 r">personalModulePath</span>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r208 r">newModulePathString</span>))
            {
                <span class="i">Environment</span>.<span class="i">SetEnvironmentVariable</span>(<a href="#ed7549e40b469e9f" class="t t">Constants</a>.<a href="#21c1e0b05c7ef699" class="i field">PSModulePathEnvVar</a>, <span class="r208 r">newModulePathString</span>);
            }
 
            <b>return</b> <span class="r208 r">newModulePathString</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the current module path setting.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r209 r">includeSystemModulePath</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Include The system wide module path ($PSHOME\Modules) even if it&#39;s not in PSModulePath.</span>
        <span class="c">///</span><span class="c"> In V3-V5, we prepended this path during module auto-discovery which incorrectly preferred</span>
        <span class="c">///</span><span class="c"> $PSHOME\Modules over user installed modules that might have a command that overrides</span>
        <span class="c">///</span><span class="c"> a product-supplied command.</span>
        <span class="c">///</span><span class="c"> For 5.1, we append $PSHOME\Modules in this case to avoid the rare case where PSModulePath</span>
        <span class="c">///</span><span class="c"> does not contain the path, but a script depends on previous behavior.</span>
        <span class="c">///</span><span class="c"> Note that appending is still a potential breaking change, but necessary to update in-box</span>
        <span class="c">///</span><span class="c"> modules long term - e.g. when open sourcing a module and installing from the gallery.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r210 r">context</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The module path as an array of strings.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static</b> <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <a id="0f8fb60019d75e2c" href="../../R/0f8fb60019d75e2c.html" target="n" data-glyph="74,1" class="i method">GetModulePath</a>(<b>bool</b> <span id="r209 rd" class="r209 r">includeSystemModulePath</span>, <a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r210 rd" class="r210 r">context</span>)
        {
            <b>string</b> <span id="r211 rd" class="r211 r">modulePathString</span> = <span class="i">Environment</span>.<span class="i">GetEnvironmentVariable</span>(<a href="#ed7549e40b469e9f" class="t t">Constants</a>.<a href="#21c1e0b05c7ef699" class="i field">PSModulePathEnvVar</a>) ?? <a href="#c6daade75c475a71" class="i method">SetModulePath</a>();
 
            <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r212 rd" class="r212 r">processedPathSet</span> = <b>new</b> <span class="i">HashSet</span>&lt;<b>string</b>&gt;(<span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>);
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r211 r">modulePathString</span>))
            {
                <b>foreach</b> (<b>string</b> <span id="r213 rd" class="r213 r">envPath</span> <b>in</b> <span class="r211 r">modulePathString</span>.<span class="i">Split</span>(<a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#6fd6d3492cb91f87" class="t t">Separators</a>.<a href="../Utils.cs.html#016bc808c2acadd4" class="i field">PathSeparator</a>, <span class="i">StringSplitOptions</span>.<span class="i">RemoveEmptyEntries</span>))
                {
                    <b>var</b> <span id="r214 rd" class="r214 r">processedPath</span> = <a href="#ae3cc8d79984025a" class="i method">ProcessOneModulePath</a>(<span class="r210 r">context</span>, <span class="r213 r">envPath</span>, <span class="r212 r">processedPathSet</span>);
                    <b>if</b> (<span class="r214 r">processedPath</span> != <b>null</b>)
                        <b>yield</b> <b>return</b> <span class="r214 r">processedPath</span>;
                }
            }
 
            <b>if</b> (<span class="r209 r">includeSystemModulePath</span>)
            {
                <b>var</b> <span id="r215 rd" class="r215 r">processedPath</span> = <a href="#ae3cc8d79984025a" class="i method">ProcessOneModulePath</a>(<span class="r210 r">context</span>, <a href="#f7332eb7c199d50c" class="i method">GetPSHomeModulePath</a>(), <span class="r212 r">processedPathSet</span>);
                <b>if</b> (<span class="r215 r">processedPath</span> != <b>null</b>)
                    <b>yield</b> <b>return</b> <span class="r215 r">processedPath</span>;
            }
        }
 
        <b>private static string</b> <a id="ae3cc8d79984025a" href="../../R/ae3cc8d79984025a.html" target="n" data-glyph="76,1" class="i method">ProcessOneModulePath</a>(<a href="../ExecutionContext.cs.html#130bda5418e8559c" class="t t">ExecutionContext</a> <span id="r216 rd" class="r216 r">context</span>, <b>string</b> <span id="r217 rd" class="r217 r">envPath</span>, <span class="i">HashSet</span>&lt;<b>string</b>&gt; <span id="r218 rd" class="r218 r">processedPathSet</span>)
        {
            <b>string</b> <span id="r219 rd" class="r219 r">trimmedenvPath</span> = <span class="r217 r">envPath</span>.<span class="i">Trim</span>();
 
            <b>bool</b> <span id="r220 rd" class="r220 r">isUnc</span> = <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#035be1ae91f35c16" class="i method">PathIsUnc</a>(<span class="r219 r">trimmedenvPath</span>);
            <b>if</b> (!<span class="r220 r">isUnc</span>)
            {
                <span class="c">// if the path start with &quot;filesystem::&quot;, remove it so we can test for URI and</span>
                <span class="c">// also Directory.Exists (if the file system provider isn&#39;t actually loaded.)</span>
                <b>if</b> (<span class="r219 r">trimmedenvPath</span>.<span class="i">StartsWith</span>(<span class="s">&quot;filesystem::&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>))
                {
                    <span class="r219 r">trimmedenvPath</span> = <span class="r219 r">trimmedenvPath</span>.<span class="i">Remove</span>(0, 12 <span class="c">/*&quot;filesystem::&quot;.Length*/</span>);
                }
 
                <span class="r220 r">isUnc</span> = <a href="../Utils.cs.html#9185d6ecbaebbec0" class="t t">Utils</a>.<a href="../Utils.cs.html#035be1ae91f35c16" class="i method">PathIsUnc</a>(<span class="r219 r">trimmedenvPath</span>);
            }
 
            <span class="c">// If we have an unc, just return the value as resolving the path is expensive.</span>
            <b>if</b> (<span class="r220 r">isUnc</span>)
            {
                <b>return</b> <span class="r219 r">trimmedenvPath</span>;
            }
 
            <span class="c">// We prefer using the file system provider to resolve paths so callers can avoid processing</span>
            <span class="c">// duplicates, e.g. the following are all the same:</span>
            <span class="c">//     a\b</span>
            <span class="c">//     a\.\b</span>
            <span class="c">//     a\b\</span>
            <span class="c">// But if the file system provider isn&#39;t loaded, we will just check if the directory exists.</span>
            <b>if</b> (<span class="r216 r">context</span>.<a href="../ExecutionContext.cs.html#07982205e4a6a726" class="i property">EngineSessionState</a>.<a href="../SessionStateProviderAPIs.cs.html#dc359a601ce02a89" class="i method">IsProviderLoaded</a>(<span class="r216 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
            {
                <a href="../DataStoreAdapterProvider.cs.html#dd4e1f2f8e73a1dd" class="t t">ProviderInfo</a> <span id="r221 rd" class="r221 r">provider</span> = <b>null</b>;
                <span class="i">IEnumerable</span>&lt;<b>string</b>&gt; <span id="r222 rd" class="r222 r">resolvedPaths</span> = <b>null</b>;
                <b>try</b>
                {
                    <span class="r222 r">resolvedPaths</span> = <span class="r216 r">context</span>.<a href="../ExecutionContext.cs.html#4502619a6e4808ee" class="i property">SessionState</a>.<a href="../SessionStatePublic.cs.html#3390cfbbdcffb036" class="i property">Path</a>.<a href="../PathInterfaces.cs.html#4931b2e78f6aaef1" class="i method">GetResolvedProviderPathFromPSPath</a>(
                        <a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<a href="../regex.cs.html#ec1c8a48d29314f3" class="i method">Escape</a>(<span class="r219 r">trimmedenvPath</span>), <b>out</b> <span class="r221 r">provider</span>);
                }
                <b>catch</b> (<a href="../../utils/SessionStateExceptions.cs.html#9ed59df3c4c15193" class="t t">ItemNotFoundException</a>)
                {
                    <span class="c">// silently skip directories that are not found</span>
                }
                <b>catch</b> (<a href="../../utils/SessionStateExceptions.cs.html#09140e6dc875019b" class="t t">DriveNotFoundException</a>)
                {
                    <span class="c">// silently skip drives that are not found</span>
                }
                <b>catch</b> (<span class="i">NotSupportedException</span>)
                {
                    <span class="c">// silently skip invalid path</span>
                    <span class="c">// NotSupportedException is thrown if path contains a colon (&quot;:&quot;) that is not part of a</span>
                    <span class="c">// volume identifier (for example, &quot;c:\&quot; is Supported but not &quot;c:\temp\Z:\invalidPath&quot;)</span>
                }
 
                <b>if</b> (<span class="r221 r">provider</span> != <b>null</b> &amp;&amp; <span class="r222 r">resolvedPaths</span> != <b>null</b> &amp;&amp; <span class="r221 r">provider</span>.<a href="../DataStoreAdapterProvider.cs.html#13e2cce7adaad137" class="i method">NameEquals</a>(<span class="r216 r">context</span>.<a href="../ExecutionContext.cs.html#733af3e5592e5947" class="i property">ProviderNames</a>.<a href="../ProviderNames.cs.html#07509539bc35966f" class="i property">FileSystem</a>))
                {
                    <b>var</b> <span id="r223 rd" class="r223 r">result</span> = <span class="r222 r">resolvedPaths</span>.<span class="i">FirstOrDefault</span>();
                    <b>if</b> (<span class="r218 r">processedPathSet</span>.<span class="i">Add</span>(<span class="r223 r">result</span>))
                    {
                        <b>return</b> <span class="r223 r">result</span>;
                    }
                }
            }
            <b>else</b> <b>if</b> (<span class="i">Directory</span>.<span class="i">Exists</span>(<span class="r219 r">trimmedenvPath</span>))
            {
                <b>return</b> <span class="r219 r">trimmedenvPath</span>;
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes all functions not belonging to the parent module.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r224 r">module</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Parent module.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="077b2c15cb0576fd" href="../../R/077b2c15cb0576fd.html" target="n" data-glyph="74,1" class="i method">RemoveNestedModuleFunctions</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r224 rd" class="r224 r">module</span>)
        {
            <b>var</b> <span id="r225 rd" class="r225 r">input</span> = <span class="r224 r">module</span>.<a href="PSModuleInfo.cs.html#a04dda42fbcbc013" class="i property">SessionState</a>?.<a href="../SessionStatePublic.cs.html#9be0303086619111" class="i property">Internal</a>?.<a href="../SessionStateFunctionAPIs.cs.html#1d2490e3ba3a324b" class="i property">ExportedFunctions</a>;
            <b>if</b> ((<span class="r225 r">input</span> == <b>null</b>) || (<span class="r225 r">input</span>.<span class="i">Count</span> == 0))
            { <b>return</b>; }
 
            <span class="r225 r">input</span>.<span class="i">RemoveAll</span>(<span id="r226 rd" class="r226 r">fnInfo</span> =&gt; !<span class="r224 r">module</span>.<a href="PSModuleInfo.cs.html#19beded88c944eb9" class="i property">Name</a>.<span class="i">Equals</span>(<span class="r226 r">fnInfo</span>.<span class="i">ModuleName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>));
        }
 
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">enable</span>
        <b>private static void</b> <a id="4ecf8e5ce7e9bec1" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SortAndRemoveDuplicates</a>&lt;<span id="r227 rd t" class="r227 r t">T</span>&gt;(<span class="i">List</span>&lt;<span class="r227 r t">T</span>&gt; <span id="r228 rd" class="r228 r">input</span>, <span class="i">Func</span>&lt;<span class="r227 r t">T</span>, <b>string</b>&gt; <span id="r229 rd" class="r229 r">keyGetter</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r228 r">input</span> <b>is not null</b>, <span class="s">&quot;Caller should verify that input != null&quot;</span>);
 
            <span class="r228 r">input</span>.<span class="i">Sort</span>(
                (<span class="r227 r t">T</span> <span id="r230 rd" class="r230 r">x</span>, <span class="r227 r t">T</span> <span id="r231 rd" class="r231 r">y</span>) =&gt;
                {
                    <b>string</b> <span id="r232 rd" class="r232 r">kx</span> = <span class="r229 r">keyGetter</span>(<span class="r230 r">x</span>);
                    <b>string</b> <span id="r233 rd" class="r233 r">ky</span> = <span class="r229 r">keyGetter</span>(<span class="r231 r">y</span>);
                    <b>return</b> <b>string</b>.<span class="i">Compare</span>(<span class="r232 r">kx</span>, <span class="r233 r">ky</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
                }
            );
 
            <b>string</b>? <span id="r234 rd" class="r234 r">previousKey</span> = <b>null</b>;
            <span class="r228 r">input</span>.<span class="i">RemoveAll</span>(<span class="i">ShouldRemove</span>);
 
            <b>bool</b> <a id="5b7a3bd5f993cd3a" href="../../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">ShouldRemove</a>(<span class="r227 r t">T</span> <span id="r235 rd" class="r235 r">item</span>)
            {
                <b>string</b> <span id="r236 rd" class="r236 r">currentKey</span> = <span class="r229 r">keyGetter</span>(<span class="r235 r">item</span>);
                <b>bool</b> <span id="r237 rd" class="r237 r">match</span> = <span class="r234 r">previousKey</span> <b>is not null</b>
                    &amp;&amp; <span class="r236 r">currentKey</span>.<span class="i">Equals</span>(<span class="r234 r">previousKey</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>);
                <span class="r234 r">previousKey</span> = <span class="r236 r">currentKey</span>;
                <b>return</b> <span class="r237 r">match</span>;
            }
        }
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">restore</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Mark stuff to be exported from the current environment using the various patterns.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r238 r">cmdlet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The cmdlet calling this method.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r239 r">sessionState</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session state instance to do the exports on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r240 r">functionPatterns</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Patterns describing the functions to export.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r241 r">cmdletPatterns</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Patterns describing the cmdlets to export.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r242 r">aliasPatterns</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Patterns describing the aliases to export.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r243 r">variablePatterns</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Patterns describing the variables to export.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r244 r">doNotExportCmdlets</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">List of Cmdlets that will not be exported, even if they match in cmdletPatterns.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="dbd0e3667f34bf41" href="../../R/dbd0e3667f34bf41.html" target="n" data-glyph="74,1" class="i method">ExportModuleMembers</a>(
            <a href="../../P/30543a6971fed1fc.html#30543a6971fed1fc" class="t t">PSCmdlet</a> <span id="r238 rd" class="r238 r">cmdlet</span>,
            <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r239 rd" class="r239 r">sessionState</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r240 rd" class="r240 r">functionPatterns</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r241 rd" class="r241 r">cmdletPatterns</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r242 rd" class="r242 r">aliasPatterns</span>,
            <span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r243 rd" class="r243 r">variablePatterns</span>,
            <span class="i">List</span>&lt;<b>string</b>&gt; <span id="r244 rd" class="r244 r">doNotExportCmdlets</span>)
        {
            <span class="c">// If this cmdlet is called, then mark that the export list should be used for exporting</span>
            <span class="c">// module members...</span>
 
            <span class="r239 r">sessionState</span>.<a href="../SessionStateFunctionAPIs.cs.html#776ca0b7a2795e58" class="i property">UseExportList</a> = <b>true</b>;
 
            <b>if</b> (<span class="r240 r">functionPatterns</span> != <b>null</b>)
            {
                <span class="r239 r">sessionState</span>.<a href="../SessionStateFunctionAPIs.cs.html#0bfdd00a11d1bfe4" class="i property">FunctionsExported</a> = <b>true</b>;
                <b>if</b> (<a href="#e89055652ef36b54" class="i method">PatternContainsWildcard</a>(<span class="r240 r">functionPatterns</span>))
                {
                    <span class="r239 r">sessionState</span>.<a href="../SessionStateFunctionAPIs.cs.html#08bfefead0b0647d" class="i property">FunctionsExportedWithWildcard</a> = <b>true</b>;
                }
 
                <span class="i">IDictionary</span>&lt;<b>string</b>, <a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a>&gt; <span id="r245 rd" class="r245 r">ft</span> = <span class="r239 r">sessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>.<a href="../SessionStateScope.cs.html#0cb72e1b3b779c82" class="i property">FunctionTable</a>;
 
                <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a>&gt; <span id="r246 rd" class="r246 r">entry</span> <b>in</b> <span class="r245 r">ft</span>)
                {
                    <span class="c">// Skip AllScope functions</span>
                    <b>if</b> ((<span class="r246 r">entry</span>.<span class="i">Value</span>.<span class="i">Options</span> &amp; <a href="../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>.<a href="../ShellVariable.cs.html#6cfa31306085b107" class="i field">AllScope</a>) != 0)
                    {
                        <b>continue</b>;
                    }
 
                    <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r246 r">entry</span>.<span class="i">Key</span>, <span class="r240 r">functionPatterns</span>, <b>false</b>))
                    {
                        <span class="r239 r">sessionState</span>.<a href="../SessionStateFunctionAPIs.cs.html#1d2490e3ba3a324b" class="i property">ExportedFunctions</a>.<span class="i">Add</span>(<span class="r246 r">entry</span>.<span class="i">Value</span>);
                        <b>string</b> <span id="r247 rd" class="r247 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ExportingFunction</span>, <span class="r246 r">entry</span>.<span class="i">Key</span>);
                        <span class="r238 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r247 r">message</span>);
                    }
                }
 
                <span class="i">SortAndRemoveDuplicates</span>(<span class="r239 r">sessionState</span>.<a href="../SessionStateFunctionAPIs.cs.html#1d2490e3ba3a324b" class="i property">ExportedFunctions</a>, <b>static</b> (<a href="../FunctionInfo.cs.html#e37ab42bb144c43b" class="t t">FunctionInfo</a> <span id="r248 rd" class="r248 r">ci</span>) =&gt; <span class="r248 r">ci</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
            }
 
            <b>if</b> (<span class="r241 r">cmdletPatterns</span> != <b>null</b>)
            {
                <span class="i">IDictionary</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt;&gt; <span id="r249 rd" class="r249 r">ft</span> = <span class="r239 r">sessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>.<a href="../SessionStateScope.cs.html#bedca0fe0b1b3026" class="i property">CmdletTable</a>;
 
                <span class="c">// Subset the existing cmdlet exports if there are any. This will be the case</span>
                <span class="c">// if we&#39;re using ModuleToProcess to import a binary module which has nested modules.</span>
                <b>if</b> (<span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>[] <span id="r250 rd" class="r250 r">copy</span> = <span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>.<span class="i">ToArray</span>();
                    <span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>.<span class="i">Clear</span>();
 
                    <b>foreach</b> (<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r251 rd" class="r251 r">element</span> <b>in</b> <span class="r250 r">copy</span>)
                    {
                        <b>if</b> (<span class="r244 r">doNotExportCmdlets</span> == <b>null</b>
                            || !<span class="r244 r">doNotExportCmdlets</span>.<span class="i">Exists</span>(<span id="r252 rd" class="r252 r">cmdletName</span> =&gt; <b>string</b>.<span class="i">Equals</span>(<span class="r251 r">element</span>.<a href="../CmdletInfo.cs.html#7faf4081836f8538" class="i property">FullName</a>, <span class="r252 r">cmdletName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                        {
                            <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r251 r">element</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r241 r">cmdletPatterns</span>, <b>false</b>))
                            {
                                <b>string</b> <span id="r253 rd" class="r253 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ExportingCmdlet</span>, <span class="r251 r">element</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                                <span class="r238 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r253 r">message</span>);
                                <span class="c">// Copy the cmdlet info, changing the module association to be the current module...</span>
                                <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r254 rd" class="r254 r">exportedCmdlet</span> = <b>new</b> <a href="../CmdletInfo.cs.html#cdd24b9416013a7d" class="t constructor">CmdletInfo</a>(<span class="r251 r">element</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r251 r">element</span>.<a href="../CmdletInfo.cs.html#9ba4328ad01dd7c0" class="i property">ImplementingType</a>,
                                    <span class="r251 r">element</span>.<a href="../CmdletInfo.cs.html#fc12c9efb2e4abe1" class="i property">HelpFile</a>, <b>null</b>, <span class="r251 r">element</span>.<a href="../CommandInfo.cs.html#a17100165b2aaab8" class="i property">Context</a>)
                                { <a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> };
                                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> != <b>null</b>, <span class="s">&quot;sessionState.Module should not be null by the time we&#39;re exporting cmdlets&quot;</span>);
                                <span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>.<span class="i">Add</span>(<span class="r254 r">exportedCmdlet</span>);
                            }
                        }
                    }
                }
 
                <span class="c">// And copy in any cmdlets imported from the nested modules...</span>
                <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <span class="i">List</span>&lt;<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a>&gt;&gt; <span id="r255 rd" class="r255 r">entry</span> <b>in</b> <span class="r249 r">ft</span>)
                {
                    <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r256 rd" class="r256 r">cmdletToImport</span> = <span class="r255 r">entry</span>.<span class="i">Value</span>[0];
                    <b>if</b> (<span class="r244 r">doNotExportCmdlets</span> == <b>null</b>
                        || !<span class="r244 r">doNotExportCmdlets</span>.<span class="i">Exists</span>(<span id="r257 rd" class="r257 r">cmdletName</span> =&gt; <b>string</b>.<span class="i">Equals</span>(<span class="r256 r">cmdletToImport</span>.<a href="../CmdletInfo.cs.html#7faf4081836f8538" class="i property">FullName</a>, <span class="r257 r">cmdletName</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)))
                    {
                        <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r255 r">entry</span>.<span class="i">Key</span>, <span class="r241 r">cmdletPatterns</span>, <b>false</b>))
                        {
                            <b>string</b> <span id="r258 rd" class="r258 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ExportingCmdlet</span>, <span class="r255 r">entry</span>.<span class="i">Key</span>);
                            <span class="r238 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r258 r">message</span>);
                            <span class="c">// Copy the cmdlet info, changing the module association to be the current module...</span>
                            <a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r259 rd" class="r259 r">exportedCmdlet</span> = <b>new</b> <a href="../CmdletInfo.cs.html#cdd24b9416013a7d" class="t constructor">CmdletInfo</a>(<span class="r256 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r256 r">cmdletToImport</span>.<a href="../CmdletInfo.cs.html#9ba4328ad01dd7c0" class="i property">ImplementingType</a>,
                                <span class="r256 r">cmdletToImport</span>.<a href="../CmdletInfo.cs.html#fc12c9efb2e4abe1" class="i property">HelpFile</a>, <b>null</b>, <span class="r256 r">cmdletToImport</span>.<a href="../CommandInfo.cs.html#a17100165b2aaab8" class="i property">Context</a>)
                            { <a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> };
                            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> != <b>null</b>, <span class="s">&quot;sessionState.Module should not be null by the time we&#39;re exporting cmdlets&quot;</span>);
                            <span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>.<span class="i">Add</span>(<span class="r259 r">exportedCmdlet</span>);
                        }
                    }
                }
 
                <span class="i">SortAndRemoveDuplicates</span>(<span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#efe3e67f5284ef89" class="i property">CompiledExports</a>, <b>static</b> (<a href="../CmdletInfo.cs.html#9492ffc9968f644d" class="t t">CmdletInfo</a> <span id="r260 rd" class="r260 r">ci</span>) =&gt; <span class="r260 r">ci</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
            }
 
            <b>if</b> (<span class="r243 r">variablePatterns</span> != <b>null</b>)
            {
                <span class="i">IDictionary</span>&lt;<b>string</b>, <a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a>&gt; <span id="r261 rd" class="r261 r">vt</span> = <span class="r239 r">sessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>.<a href="../SessionStateScope.cs.html#f3f7c22a2d29d233" class="i property">Variables</a>;
 
                <b>foreach</b> (<span class="i">KeyValuePair</span>&lt;<b>string</b>, <a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a>&gt; <span id="r262 rd" class="r262 r">entry</span> <b>in</b> <span class="r261 r">vt</span>)
                {
                    <span class="c">// The magic variables are always private as are all-scope variables...</span>
                    <b>if</b> (<span class="r262 r">entry</span>.<span class="i">Value</span>.<span class="i">IsAllScope</span> || <span class="i">Array</span>.<span class="i">IndexOf</span>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a>.<a href="PSModuleInfo.cs.html#10376745e0533336" class="i field">_builtinVariables</a>, <span class="r262 r">entry</span>.<span class="i">Key</span>) != -1)
                    {
                        <b>continue</b>;
                    }
 
                    <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r262 r">entry</span>.<span class="i">Key</span>, <span class="r243 r">variablePatterns</span>, <b>false</b>))
                    {
                        <b>string</b> <span id="r263 rd" class="r263 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ExportingVariable</span>, <span class="r262 r">entry</span>.<span class="i">Key</span>);
                        <span class="r238 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r263 r">message</span>);
                        <span class="r239 r">sessionState</span>.<a href="../SessionStateVariableAPIs.cs.html#2410b52a592096c8" class="i property">ExportedVariables</a>.<span class="i">Add</span>(<span class="r262 r">entry</span>.<span class="i">Value</span>);
                    }
                }
 
                <span class="i">SortAndRemoveDuplicates</span>(<span class="r239 r">sessionState</span>.<a href="../SessionStateVariableAPIs.cs.html#2410b52a592096c8" class="i property">ExportedVariables</a>, <b>static</b> (<a href="../ShellVariable.cs.html#5bd16fef1f858b3d" class="t t">PSVariable</a> <span id="r264 rd" class="r264 r">v</span>) =&gt; <span class="r264 r">v</span>.<a href="../ShellVariable.cs.html#fedaff61e8100bc1" class="i property">Name</a>);
            }
 
            <b>if</b> (<span class="r242 r">aliasPatterns</span> != <b>null</b>)
            {
                <span class="i">IEnumerable</span>&lt;<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a>&gt; <span id="r265 rd" class="r265 r">mai</span> = <span class="r239 r">sessionState</span>.<a href="../SessionStateScopeAPIs.cs.html#59eeece84e54dc1f" class="i property">ModuleScope</a>.<a href="../SessionStateScope.cs.html#004230f64a4526c0" class="i property">AliasTable</a>;
 
                <span class="c">// Subset the existing alias exports if there are any. This will be the case</span>
                <span class="c">// if we&#39;re using ModuleToProcess to import a binary module which has nested modules.</span>
                <b>if</b> (<span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#aaa486cc66863e15" class="i property">CompiledAliasExports</a>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a>[] <span id="r266 rd" class="r266 r">copy</span> = <span class="r239 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>.<a href="PSModuleInfo.cs.html#aaa486cc66863e15" class="i property">CompiledAliasExports</a>.<span class="i">ToArray</span>();
 
                    <b>foreach</b> (<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="k">var</a> <span id="r267 rd" class="r267 r">element</span> <b>in</b> <span class="r266 r">copy</span>)
                    {
                        <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r267 r">element</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r242 r">aliasPatterns</span>, <b>false</b>))
                        {
                            <b>string</b> <span id="r268 rd" class="r268 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ExportingAlias</span>, <span class="r267 r">element</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                            <span class="r238 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r268 r">message</span>);
                            <span class="r239 r">sessionState</span>.<a href="../SessionStateAliasAPIs.cs.html#c15aa2530ddf93b0" class="i property">ExportedAliases</a>.<span class="i">Add</span>(<a href="#7694de9f51a6ef46" class="i method">NewAliasInfo</a>(<span class="r267 r">element</span>, <span class="r239 r">sessionState</span>));
                        }
                    }
                }
 
                <b>foreach</b> (<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r269 rd" class="r269 r">entry</span> <b>in</b> <span class="r265 r">mai</span>)
                {
                    <span class="c">// Skip allscope items...</span>
                    <b>if</b> ((<span class="r269 r">entry</span>.<a href="../AliasInfo.cs.html#4efeb840e82b2f90" class="i property">Options</a> &amp; <a href="../ShellVariable.cs.html#8d6fb934c02e4185" class="t t">ScopedItemOptions</a>.<a href="../ShellVariable.cs.html#6cfa31306085b107" class="i field">AllScope</a>) != 0)
                    {
                        <b>continue</b>;
                    }
 
                    <b>if</b> (<a href="../SessionStateUtils.cs.html#a64f812795996898" class="t t">SessionStateUtilities</a>.<span class="i">MatchesAnyWildcardPattern</span>(<span class="r269 r">entry</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r242 r">aliasPatterns</span>, <b>false</b>))
                    {
                        <b>string</b> <span id="r270 rd" class="r270 r">message</span> = <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">Modules</span>.<span class="i">ExportingAlias</span>, <span class="r269 r">entry</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
                        <span class="r238 r">cmdlet</span>.<a href="../cmdlet.cs.html#377660744c64cd7e" class="i method">WriteVerbose</a>(<span class="r270 r">message</span>);
                        <span class="r239 r">sessionState</span>.<a href="../SessionStateAliasAPIs.cs.html#c15aa2530ddf93b0" class="i property">ExportedAliases</a>.<span class="i">Add</span>(<a href="#7694de9f51a6ef46" class="i method">NewAliasInfo</a>(<span class="r269 r">entry</span>, <span class="r239 r">sessionState</span>));
                    }
                }
 
                <span class="i">SortAndRemoveDuplicates</span>(<span class="r239 r">sessionState</span>.<a href="../SessionStateAliasAPIs.cs.html#c15aa2530ddf93b0" class="i property">ExportedAliases</a>, <b>static</b> (<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r271 rd" class="r271 r">ci</span>) =&gt; <span class="r271 r">ci</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Checks pattern list for wildcard characters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r272 r">list</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Pattern list.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if pattern contains &#39;*&#39;.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static bool</b> <a id="e89055652ef36b54" href="../../R/e89055652ef36b54.html" target="n" data-glyph="74,1" class="i method">PatternContainsWildcard</a>(<span class="i">List</span>&lt;<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>&gt; <span id="r272 rd" class="r272 r">list</span>)
        {
            <b>if</b> (<span class="r272 r">list</span> != <b>null</b>)
            {
                <b>foreach</b> (<b>var</b> <span id="r273 rd" class="r273 r">item</span> <b>in</b> <span class="r272 r">list</span>)
                {
                    <b>if</b> (<a href="../regex.cs.html#d450e739ff28e660" class="t t">WildcardPattern</a>.<span class="i">ContainsWildcardCharacters</span>(<span class="r273 r">item</span>.<span class="i">Pattern</span>))
                    {
                        <b>return</b> <b>true</b>;
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>private static</b> <a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <a id="7694de9f51a6ef46" href="../../R/7694de9f51a6ef46.html" target="n" data-glyph="76,1" class="i method">NewAliasInfo</a>(<a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="t t">AliasInfo</a> <span id="r274 rd" class="r274 r">alias</span>, <a href="../../P/2dc1bd90a8299178.html#2dc1bd90a8299178" class="t t">SessionStateInternal</a> <span id="r275 rd" class="r275 r">sessionState</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r274 r">alias</span> != <b>null</b>, <span class="s">&quot;alias should not be null&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r275 r">sessionState</span> != <b>null</b>, <span class="s">&quot;sessionState should not be null&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r275 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a> != <b>null</b>, <span class="s">&quot;sessionState.Module should not be null by the time we&#39;re exporting aliases&quot;</span>);
 
            <span class="c">// Copy the alias info, changing the module association to be the current module...</span>
            <a href="../AliasInfo.cs.html#cf27095b0a2fb6ea" class="k">var</a> <span id="r276 rd" class="r276 r">aliasCopy</span> = <b>new</b> <a href="../AliasInfo.cs.html#908ec52506619a99" class="t constructor">AliasInfo</a>(<span class="r274 r">alias</span>.<a href="../CommandInfo.cs.html#02e11b521c500195" class="i property">Name</a>, <span class="r274 r">alias</span>.<a href="../AliasInfo.cs.html#18d5b1486b184b4a" class="i property">Definition</a>, <span class="r274 r">alias</span>.<a href="../CommandInfo.cs.html#a17100165b2aaab8" class="i property">Context</a>, <span class="r274 r">alias</span>.<a href="../AliasInfo.cs.html#4efeb840e82b2f90" class="i property">Options</a>)
            {
                <a href="../CommandInfo.cs.html#600591313a158d6c" class="i property">Module</a> = <span class="r275 r">sessionState</span>.<a href="../SessionState.cs.html#1900efdc2f293d5a" class="i property">Module</a>
            };
            <b>return</b> <span class="r276 r">aliasCopy</span>;
        }
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Enumeration of reasons for a failure to match a module by constraints.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal enum</b> <a id="8041ca95655b1733" href="../../R/8041ca95655b1733.html" target="n" data-glyph="20,0" class="t t"><span id="ac7fe45b988104d5">ModuleMatchFailure</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Match did not fail.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="c2056c6983c73cce" href="../../R/c2056c6983c73cce.html" target="n" data-glyph="24,1" class="i field">None</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Match failed because the module was null.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="fc769a0baf21c1ad" href="../../R/fc769a0baf21c1ad.html" target="n" data-glyph="24,1" class="i field">NullModule</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Module name did not match.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="30b08e827428de5d" href="../../R/30b08e827428de5d.html" target="n" data-glyph="24,1" class="i field">Name</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Module GUID did not match.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="6b88def2a9764ae8" href="../../R/6b88def2a9764ae8.html" target="n" data-glyph="24,1" class="i field">Guid</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Module version did not match the required version.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="b99682ee062b9abc" href="../../R/b99682ee062b9abc.html" target="n" data-glyph="24,1" class="i field">RequiredVersion</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Module version was lower than the minimum version.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="14ca67728e787bed" href="../../R/14ca67728e787bed.html" target="n" data-glyph="24,1" class="i field">MinimumVersion</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Module version was greater than the maximum version.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="6f847e08b4b7ffc1" href="../../R/6f847e08b4b7ffc1.html" target="n" data-glyph="24,1" class="i field">MaximumVersion</a>,
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The module specifcation passed in was null.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <a id="924dae0e2c66cca9" href="../../R/924dae0e2c66cca9.html" target="n" data-glyph="24,1" class="i field">NullModuleSpecification</a>,
    }
 
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">enable</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Used by Modules/Snapins to provide a hook to the engine for startup initialization</span>
    <span class="c">///</span><span class="c"> w.r.t compiled assembly loading.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">enable</span>
    <b>public interface</b> <a id="fd32613ca83d5545" href="../../R/fd32613ca83d5545.html" target="n" data-glyph="48,0" class="t t">IModuleAssemblyInitializer</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets called when assembly is loaded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>void</b> <a id="0cf97ea117954e42" href="../../R/0cf97ea117954e42.html" target="n" data-glyph="72,1" class="i method">OnImport</a>();
    }
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Used by modules to provide a hook to the engine for cleanup on removal</span>
    <span class="c">///</span><span class="c"> w.r.t. compiled assembly being removed.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public interface</b> <a id="63e9c3b0ffc59b6e" href="../../R/63e9c3b0ffc59b6e.html" target="n" data-glyph="48,0" class="t t">IModuleAssemblyCleanup</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets called when the binary module is unloaded.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>void</b> <a id="20e0d802ba0b6a34" href="../../R/20e0d802ba0b6a34.html" target="n" data-glyph="72,1" class="i method">OnRemove</a>(<a href="PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <span id="r277 rd" class="r277 r">psModuleInfo</span>);
    }
}
</pre></td></tr></table></div></body></html>
