<!DOCTYPE html>
<html><head><title>ConnectionBase.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1583);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/hostifaces/ConnectionBase.cs" target="_top">engine\hostifaces\ConnectionBase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
<b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">LEGACYTELEMETRY</span>
<span class="e">using Microsoft.PowerShell.Telemetry.Internal;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
<b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 1634, 1691 <span class="c">// Stops compiler from warning about unknown warnings</span>
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Runspaces is base class for different kind of Runspaces.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">There should be a class derived from it for each type of</span>
    <span class="c">///</span><span class="c"> Runspace. Types of Runspace which we support are Local, X-AppDomain,</span>
    <span class="c">///</span><span class="c"> X-Process and X-Machine.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <b>internal abstract class</b> <a id="b5efaa6cd9653c05" href="../../R/b5efaa6cd9653c05.html" target="n" data-glyph="2,0" class="t t">RunspaceBase</a> : <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Construct an instance of an Runspace using a custom</span>
        <span class="c">///</span><span class="c"> implementation of PSHost.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">host</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The explicit PSHost implementation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Host is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> host is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>protected</b> <a id="f966387fa8a4d019" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">RunspaceBase</a>(<a href="MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r0 rd" class="r0 r">host</span>)
        {
            <b>if</b> (<span class="r0 r">host</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r0 r">host</span>));
            }
 
            <a href="#2a0ffffea51b8a28" class="i property">InitialSessionState</a> = <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a>.<a href="../InitialSessionState.cs.html#212e45c73accc163" class="i method">CreateDefault</a>();
            <a href="#1a671b0dab484cdd" class="i property">Host</a> = <span class="r0 r">host</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Construct an instance of an Runspace using a custom</span>
        <span class="c">///</span><span class="c"> implementation of PSHost.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">host</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The explicit PSHost implementation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Host is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> host is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">initialSessionState</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> configuration information for this runspace instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2214:DoNotCallOverridableMethodsInConstructors&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;OK to call ThreadOptions&quot;</span>)]
        <b>protected</b> <a id="648f75eecd4bad03" href="../../R/648f75eecd4bad03.html" target="n" data-glyph="75,1" class="t constructor">RunspaceBase</a>(<a href="MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r1 rd" class="r1 r">host</span>, <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r2 rd" class="r2 r">initialSessionState</span>)
        {
            <b>if</b> (<span class="r1 r">host</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r1 r">host</span>));
            }
 
            <b>if</b> (<span class="r2 r">initialSessionState</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r2 r">initialSessionState</span>));
            }
 
            <a href="#1a671b0dab484cdd" class="i property">Host</a> = <span class="r1 r">host</span>;
            <a href="#2a0ffffea51b8a28" class="i property">InitialSessionState</a> = <span class="r2 r">initialSessionState</span>.<a href="../InitialSessionState.cs.html#9976cba0f7f0ac54" class="i method">Clone</a>();
            <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="Connection.cs.html#bd7dc249cd7abc4e" class="i property">ThreadOptions</a> = <span class="r2 r">initialSessionState</span>.<a href="../InitialSessionState.cs.html#2496a3df8744996f" class="i property">ThreadOptions</a>;
            <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="Connection.cs.html#7483ec8556438ee9" class="i property">ApartmentState</a> = <span class="r2 r">initialSessionState</span>.<a href="../InitialSessionState.cs.html#640e70a6a98fabbf" class="i property">ApartmentState</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Construct an instance of an Runspace using a custom</span>
        <span class="c">///</span><span class="c"> implementation of PSHost.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">host</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The explicit PSHost implementation</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">initialSessionState</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> configuration information for this runspace instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">suppressClone</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, don&#39;t make a copy of the initial session state object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Host is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> host is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i">CodeAnalysis</span>.<span class="i">SuppressMessage</span>(<span class="s">&quot;Microsoft.Usage&quot;</span>, <span class="s">&quot;CA2214:DoNotCallOverridableMethodsInConstructors&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;OK to call ThreadOptions&quot;</span>)]
        <b>protected</b> <a id="5a0ce75010f2effa" href="../../R/5a0ce75010f2effa.html" target="n" data-glyph="75,1" class="t constructor">RunspaceBase</a>(<a href="MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <span id="r3 rd" class="r3 r">host</span>, <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <span id="r4 rd" class="r4 r">initialSessionState</span>, <b>bool</b> <span id="r5 rd" class="r5 r">suppressClone</span>)
        {
            <b>if</b> (<span class="r3 r">host</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r3 r">host</span>));
            }
 
            <b>if</b> (<span class="r4 r">initialSessionState</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r4 r">initialSessionState</span>));
            }
 
            <a href="#1a671b0dab484cdd" class="i property">Host</a> = <span class="r3 r">host</span>;
            <b>if</b> (<span class="r5 r">suppressClone</span>)
            {
                <a href="#2a0ffffea51b8a28" class="i property">InitialSessionState</a> = <span class="r4 r">initialSessionState</span>;
            }
            <b>else</b>
            {
                <a href="#2a0ffffea51b8a28" class="i property">InitialSessionState</a> = <span class="r4 r">initialSessionState</span>.<a href="../InitialSessionState.cs.html#9976cba0f7f0ac54" class="i method">Clone</a>();
            }
 
            <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="Connection.cs.html#bd7dc249cd7abc4e" class="i property">ThreadOptions</a> = <span class="r4 r">initialSessionState</span>.<a href="../InitialSessionState.cs.html#2496a3df8744996f" class="i property">ThreadOptions</a>;
            <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="Connection.cs.html#7483ec8556438ee9" class="i property">ApartmentState</a> = <span class="r4 r">initialSessionState</span>.<a href="../InitialSessionState.cs.html#640e70a6a98fabbf" class="i property">ApartmentState</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The host implemented PSHost interface.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="MshHost.cs.html#7b79cd90e035740e" class="t t">PSHost</a> <a id="1a671b0dab484cdd" href="../../R/1a671b0dab484cdd.html" target="n" data-glyph="105,1" class="i property">Host</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> InitialSessionState information for this runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../InitialSessionState.cs.html#b17f88d4755d5fd7" class="t t">InitialSessionState</a> <a id="2a0ffffea51b8a28" href="../../R/2a0ffffea51b8a28.html" target="n" data-glyph="102,1" class="i property">InitialSessionState</a> { <b>get</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> constructors
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return version of this runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">Version</span> <a id="ae9f82911c8d8629" href="../../R/ae9f82911c8d8629.html" target="n" data-glyph="102,1" class="i property">Version</a> { <b>get</b>; } = <a href="../PSVersionInfo.cs.html#be287f9ea52b8d2f" class="t t">PSVersionInfo</a>.<a href="../PSVersionInfo.cs.html#ad63365ac7690eeb" class="i property">PSVersion</a>;
 
        <b>private</b> <a href="Connection.cs.html#0cb1ed33bb1d35e3" class="t t">RunspaceStateInfo</a> <a id="e3cce0d70da693d3" href="../../R/e3cce0d70da693d3.html" target="n" data-glyph="46,1" class="i field">_runspaceStateInfo</a> = <b>new</b> <a href="Connection.cs.html#e093e4ce616b2fff" class="t constructor">RunspaceStateInfo</a>(<a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#4e82723df10b13f6" class="i field">BeforeOpen</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve information about current state of the runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Connection.cs.html#0cb1ed33bb1d35e3" class="t t">RunspaceStateInfo</a> <a id="c834af2e09f636e6" href="../../R/c834af2e09f636e6.html" target="n" data-glyph="102,1" class="i property">RunspaceStateInfo</a>
        {
            <b>get</b>
            {
                <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                {
                    <span class="c">// Do not return internal state.</span>
                    <b>return</b> <a href="#e3cce0d70da693d3" class="i field">_runspaceStateInfo</a>.<a href="Connection.cs.html#d8101f7e931fd53a" class="i method">Clone</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the current availability of the Runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="5fb1b63f82030563" href="../../R/5fb1b63f82030563.html" target="n" data-glyph="102,1" class="i property">RunspaceAvailability</a>
        {
            <b>get</b> { <b>return</b> <a href="#8580a82de2c31b63" class="i field">_runspaceAvailability</a>; }
 
            <b>protected set</b> { <a href="#8580a82de2c31b63" class="i field">_runspaceAvailability</a> = <b>value</b>; }
        }
 
        <b>private</b> <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="8580a82de2c31b63" href="../../R/8580a82de2c31b63.html" target="n" data-glyph="46,1" class="i field">_runspaceAvailability</a> = <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a>.<a href="Connection.cs.html#a5172055c7a11352" class="i field">None</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object used for synchronization.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected internal object</b> <a id="491abdf8e72c9d24" href="../../R/491abdf8e72c9d24.html" target="n" data-glyph="105,1" class="i property">SyncRoot</a> { <b>get</b>; } = <b>new</b> <b>object</b>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Information about the computer where this runspace is created.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../remoting/common/RunspaceConnectionInfo.cs.html#e07ed56a8a1da829" class="t t">RunspaceConnectionInfo</a> <a id="84b2d8f584b489cd" href="../../R/84b2d8f584b489cd.html" target="n" data-glyph="102,1" class="i property">ConnectionInfo</a>
        {
            <b>get</b>
            {
                <span class="c">// null refers to local case for path</span>
                <b>return</b> <b>null</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Original Connection Info that the user passed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../remoting/common/RunspaceConnectionInfo.cs.html#e07ed56a8a1da829" class="t t">RunspaceConnectionInfo</a> <a id="bf361cebd797758f" href="../../R/bf361cebd797758f.html" target="n" data-glyph="102,1" class="i property">OriginalConnectionInfo</a>
        {
            <b>get</b> { <b>return</b> <b>null</b>; }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Open
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Open the runspace synchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceState is not BeforeOpen</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="468fe3cd4a0b8131" href="../../R/468fe3cd4a0b8131.html" target="n" data-glyph="72,1" class="i method">Open</a>()
        {
            <a href="#fd7c401701d4b36b" class="i method">CoreOpen</a>(<b>true</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Open the runspace Asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceState is not BeforeOpen</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="0811afc0da823de2" href="../../R/0811afc0da823de2.html" target="n" data-glyph="72,1" class="i method">OpenAsync</a>()
        {
            <a href="#fd7c401701d4b36b" class="i method">CoreOpen</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Opens the runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true runspace is opened synchronously</span>
        <span class="c">///</span><span class="c"> else runspaces is opened asynchronously</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceState is not BeforeOpen</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="fd7c401701d4b36b" href="../../R/fd7c401701d4b36b.html" target="n" data-glyph="76,1" class="i method">CoreOpen</a>(<b>bool</b> <span id="r6 rd" class="r6 r">syncCall</span>)
        {
            <b>bool</b> <span id="r7 rd" class="r7 r">etwEnabled</span> = <a href="../InitialSessionState.cs.html#81385ea1ee2efc81" class="t t">RunspaceEventSource</a>.<a href="../InitialSessionState.cs.html#d10c972f303cf36c" class="i field">Log</a>.<span class="i">IsEnabled</span>();
            <b>if</b> (<span class="r7 r">etwEnabled</span>) <a href="../InitialSessionState.cs.html#81385ea1ee2efc81" class="t t">RunspaceEventSource</a>.<a href="../InitialSessionState.cs.html#d10c972f303cf36c" class="i field">Log</a>.<a href="../InitialSessionState.cs.html#5ee60f647311846c" class="i method">OpenRunspaceStart</a>();
            <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
            {
                <span class="c">// Call fails if RunspaceState is not BeforeOpen.</span>
                <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#4e82723df10b13f6" class="i field">BeforeOpen</a>)
                {
                    <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r8 rd" class="r8 r">e</span> =
                        <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                        (
                            <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">CannotOpenAgain</span>, <b>new</b> <b>object</b>[] { <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>.<span class="i">ToString</span>() }),
                            <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>,
                            <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#4e82723df10b13f6" class="i field">BeforeOpen</a>
                        );
                    <b>throw</b> <span class="r8 r">e</span>;
                }
 
                <a href="#1969aad254a8771d" class="i method">SetRunspaceState</a>(<a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#3990ad8b3e3feec7" class="i field">Opening</a>);
            }
 
            <span class="c">// Raise event outside the lock</span>
            <a href="#9452499818eb542a" class="i method">RaiseRunspaceStateEvents</a>();
 
            <a href="#b09dd8aa3f68bdf2" class="i method">OpenHelper</a>(<span class="r6 r">syncCall</span>);
            <b>if</b> (<span class="r7 r">etwEnabled</span>) <a href="../InitialSessionState.cs.html#81385ea1ee2efc81" class="t t">RunspaceEventSource</a>.<a href="../InitialSessionState.cs.html#d10c972f303cf36c" class="i field">Log</a>.<a href="../InitialSessionState.cs.html#c339058f0194bee8" class="i method">OpenRunspaceStop</a>();
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">LEGACYTELEMETRY</span>
<span class="e">            // We report startup telementry when opening the runspace - because this is the first time
            // we are really using PowerShell. This isn&#39;t the cleanest place though, because
            // sometimes there are many runspaces created - the callee ensures telemetry is only
            // reported once. Note that if the host implements IHostProvidesTelemetryData, we rely
            // on the host calling ReportStartupTelemetry.
            if (this.Host is not IHostProvidesTelemetryData)
            {
                TelemetryAPI.ReportStartupTelemetry(null);
            }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Derived class&#39;s open implementation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract void</b> <a id="b09dd8aa3f68bdf2" href="../../R/b09dd8aa3f68bdf2.html" target="n" data-glyph="75,1" class="i method">OpenHelper</a>(<b>bool</b> <span id="r9 rd" class="r9 r">syncCall</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> open
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> close
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Close the runspace synchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Attempts to execute pipelines after a call to close will fail.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceState is BeforeOpen or Opening</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="97d9164987267191" href="../../R/97d9164987267191.html" target="n" data-glyph="72,1" class="i method">Close</a>()
        {
            <a href="#1ee98713965e6299" class="i method">CoreClose</a>(<b>true</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Close the runspace Asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Attempts to execute pipelines after a call to</span>
        <span class="c">///</span><span class="c"> close will fail.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceState is BeforeOpen or Opening</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="316dda22459b4805" href="../../R/316dda22459b4805.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>()
        {
            <a href="#1ee98713965e6299" class="i method">CoreClose</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Close the runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true runspace is closed synchronously</span>
        <span class="c">///</span><span class="c"> else runspaces is closed asynchronously</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceState is BeforeOpen or Opening</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If SessionStateProxy has some method call in progress</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="1ee98713965e6299" href="../../R/1ee98713965e6299.html" target="n" data-glyph="76,1" class="i method">CoreClose</a>(<b>bool</b> <span id="r10 rd" class="r10 r">syncCall</span>)
        {
            <b>bool</b> <span id="r11 rd" class="r11 r">alreadyClosing</span> = <b>false</b>;
 
            <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
            {
                <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> == <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#45de84b67ba18f3f" class="i field">Closed</a> ||
                    <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> == <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#e4c76740d99e58bd" class="i field">Broken</a>)
                {
                    <b>return</b>;
                }
                <b>else</b> <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> == <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#4e82723df10b13f6" class="i field">BeforeOpen</a>)
                {
                    <a href="#6d5ca0399cfba6cf" class="i method">SetRunspaceState</a>(<a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#fb276cb28f922b8e" class="i field">Closing</a>, <b>null</b>);
                    <a href="#6d5ca0399cfba6cf" class="i method">SetRunspaceState</a>(<a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#45de84b67ba18f3f" class="i field">Closed</a>, <b>null</b>);
 
                    <a href="#9452499818eb542a" class="i method">RaiseRunspaceStateEvents</a>();
 
                    <b>return</b>;
                }
                <b>else</b> <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> == <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#3990ad8b3e3feec7" class="i field">Opening</a>)
                {
                    <span class="c">// Wait till the runspace is opened - This is set in DoOpenHelper()</span>
                    <span class="c">// Release the lock before we wait</span>
                    <span class="i">Monitor</span>.<span class="i">Exit</span>(<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>);
                    <b>try</b>
                    {
                        <a href="#4089f070bdd11cf3" class="i field">RunspaceOpening</a>.<span class="i">Wait</span>();
                    }
                    <b>finally</b>
                    {
                        <span class="c">// Acquire the lock before we carry on with the rest operations</span>
                        <span class="i">Monitor</span>.<span class="i">Enter</span>(<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>);
                    }
                }
 
                <b>if</b> (<a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceCloseInvalidWhileSessionStateProxy</span>);
                }
 
                <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> == <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#fb276cb28f922b8e" class="i field">Closing</a>)
                {
                    <span class="r11 r">alreadyClosing</span> = <b>true</b>;
                }
                <b>else</b>
                {
                    <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                    {
                        <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r12 rd" class="r12 r">e</span> =
                            <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                            (
                                <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotInOpenedState</span>, <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>.<span class="i">ToString</span>()),
                                <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>,
                                <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                            );
                        <b>throw</b> <span class="r12 r">e</span>;
                    }
 
                    <a href="#1969aad254a8771d" class="i method">SetRunspaceState</a>(<a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#fb276cb28f922b8e" class="i field">Closing</a>);
                }
            }
 
            <b>if</b> (<span class="r11 r">alreadyClosing</span>)
            {
                <span class="c">// Already closing is set to true if Runspace is already</span>
                <span class="c">// in closing. In this case wait for runspace to close.</span>
                <span class="c">// This can happen in two scenarios:</span>
                <span class="c">// 1) User calls Runspace.Close from two threads.</span>
                <span class="c">// 2) In remoting, some error from data structure handler layer can start</span>
                <span class="c">// runspace closure. At the same time, user can call</span>
                <span class="c">// remove runspace.</span>
                <span class="c">//</span>
 
                <b>if</b> (<span class="r10 r">syncCall</span>)
                {
                    <a href="#968ec129d12bb71a" class="i method">WaitForFinishofPipelines</a>();
                }
 
                <b>return</b>;
            }
 
            <span class="c">// Raise Event outside the lock</span>
            <a href="#9452499818eb542a" class="i method">RaiseRunspaceStateEvents</a>();
 
            <span class="c">// Call the derived class implementation to do the actual work</span>
            <a href="#3e5d2c1ebd4bb1f9" class="i method">CloseHelper</a>(<span class="r10 r">syncCall</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Derived class&#39;s close implementation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true runspace is closed synchronously</span>
        <span class="c">///</span><span class="c"> else runspaces is closed asynchronously</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected abstract void</b> <a id="3e5d2c1ebd4bb1f9" href="../../R/3e5d2c1ebd4bb1f9.html" target="n" data-glyph="75,1" class="i method">CloseHelper</a>(<b>bool</b> <span id="r13 rd" class="r13 r">syncCall</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> close
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Disconnect-Connect
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Disconnects the runspace synchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="a568da0af751c9bd" href="../../R/a568da0af751c9bd.html" target="n" data-glyph="72,1" class="i method">Disconnect</a>()
        {
            <span class="c">//</span>
            <span class="c">// Disconnect operation is not supported on local runspaces.</span>
            <span class="c">//</span>
            <b>throw</b> <b>new</b> <span class="t">InvalidRunspaceStateException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">DisconnectNotSupported</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Disconnects the runspace asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="fde1f739e5218f0d" href="../../R/fde1f739e5218f0d.html" target="n" data-glyph="72,1" class="i method">DisconnectAsync</a>()
        {
            <span class="c">//</span>
            <span class="c">// Disconnect operation is not supported on local runspaces.</span>
            <span class="c">//</span>
            <b>throw</b> <b>new</b> <span class="t">InvalidRunspaceStateException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">DisconnectNotSupported</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Connects a runspace to its remote counterpart synchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="70ce6fcb57a848a5" href="../../R/70ce6fcb57a848a5.html" target="n" data-glyph="72,1" class="i method">Connect</a>()
        {
            <span class="c">//</span>
            <span class="c">// Connect operation is not supported on local runspaces.</span>
            <span class="c">//</span>
            <b>throw</b> <b>new</b> <span class="t">InvalidRunspaceStateException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">ConnectNotSupported</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Connects a runspace to its remote counterpart asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="841894d4556a46ba" href="../../R/841894d4556a46ba.html" target="n" data-glyph="72,1" class="i method">ConnectAsync</a>()
        {
            <span class="c">//</span>
            <span class="c">// Connect operation is not supported on local runspaces.</span>
            <span class="c">//</span>
            <b>throw</b> <b>new</b> <span class="t">InvalidRunspaceStateException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">ConnectNotSupported</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a pipeline object in the Disconnected state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Pipeline.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="e05e9ea54aabd0ea" href="../../R/e05e9ea54aabd0ea.html" target="n" data-glyph="72,1" class="i method">CreateDisconnectedPipeline</a>()
        {
            <span class="c">//</span>
            <span class="c">// Disconnect-Connect is not supported on local runspaces.</span>
            <span class="c">//</span>
            <b>throw</b> <b>new</b> <span class="t">InvalidRunspaceStateException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">DisconnectConnectNotSupported</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a powershell object in the Disconnected state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">PowerShell.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="PowerShell.cs.html#3d1b346df3be574c" class="t t">PowerShell</a> <a id="64baeca1c78d0a30" href="../../R/64baeca1c78d0a30.html" target="n" data-glyph="72,1" class="i method">CreateDisconnectedPowerShell</a>()
        {
            <span class="c">//</span>
            <span class="c">// Disconnect-Connect is not supported on local runspaces.</span>
            <span class="c">//</span>
            <b>throw</b> <b>new</b> <span class="t">InvalidRunspaceStateException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">DisconnectConnectNotSupported</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns Runspace capabilities.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">RunspaceCapability.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Connection.cs.html#381534d5ae10528e" class="t t">RunspaceCapability</a> <a id="943464d5fe4e103c" href="../../R/943464d5fe4e103c.html" target="n" data-glyph="72,1" class="i method">GetCapabilities</a>()
        {
            <b>return</b> <a href="Connection.cs.html#381534d5ae10528e" class="t t">RunspaceCapability</a>.<a href="Connection.cs.html#9ed1c376ca1193e2" class="i field">Default</a>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> CreatePipeline
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create an empty pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An empty pipeline.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="9bff355adf75caa8" href="../../R/9bff355adf75caa8.html" target="n" data-glyph="72,1" class="i method">CreatePipeline</a>()
        {
            <b>return</b> <a href="#a8ca13c4c98b3907" class="i method">CoreCreatePipeline</a>(<b>null</b>, <b>false</b>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a pipeline from a command string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A valid command string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A pipeline pre-filled with Commands specified in commandString.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> command is null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="49dbcb9fbb1b1a96" href="../../R/49dbcb9fbb1b1a96.html" target="n" data-glyph="72,1" class="i method">CreatePipeline</a>(<b>string</b> <span id="r14 rd" class="r14 r">command</span>)
        {
            <b>if</b> (<span class="r14 r">command</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r14 r">command</span>));
            }
 
            <b>return</b> <a href="#a8ca13c4c98b3907" class="i method">CoreCreatePipeline</a>(<span class="r14 r">command</span>, <b>false</b>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a pipeline from a command string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A valid command string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true command is added to history.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A pipeline pre-filled with Commands specified in commandString.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> command is null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="b597cd9d7c15080f" href="../../R/b597cd9d7c15080f.html" target="n" data-glyph="72,1" class="i method">CreatePipeline</a>(<b>string</b> <span id="r15 rd" class="r15 r">command</span>, <b>bool</b> <span id="r16 rd" class="r16 r">addToHistory</span>)
        {
            <b>if</b> (<span class="r15 r">command</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r15 r">command</span>));
            }
 
            <b>return</b> <a href="#a8ca13c4c98b3907" class="i method">CoreCreatePipeline</a>(<span class="r15 r">command</span>, <span class="r16 r">addToHistory</span>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a nested pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Nested pipelines are needed for nested prompt scenario. Nested</span>
        <span class="c">///</span><span class="c"> prompt requires that we execute new pipelines( child pipelines)</span>
        <span class="c">///</span><span class="c"> while current pipeline (lets call it parent pipeline) is blocked.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="518c1cd8de40a013" href="../../R/518c1cd8de40a013.html" target="n" data-glyph="72,1" class="i method">CreateNestedPipeline</a>()
        {
            <b>return</b> <a href="#a8ca13c4c98b3907" class="i method">CoreCreatePipeline</a>(<b>null</b>, <b>false</b>, <b>true</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a nested pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A valid command string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true command is added to history.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A pipeline pre-filled with Commands specified in commandString.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> command is null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="9b518bef92f48caa" href="../../R/9b518bef92f48caa.html" target="n" data-glyph="72,1" class="i method">CreateNestedPipeline</a>(<b>string</b> <span id="r17 rd" class="r17 r">command</span>, <b>bool</b> <span id="r18 rd" class="r18 r">addToHistory</span>)
        {
            <b>if</b> (<span class="r17 r">command</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r17 r">command</span>));
            }
 
            <b>return</b> <a href="#a8ca13c4c98b3907" class="i method">CoreCreatePipeline</a>(<span class="r17 r">command</span>, <span class="r18 r">addToHistory</span>, <b>true</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a pipeline from a command string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A valid command string or string.Empty.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true command is added to history.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True for nested pipeline.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A pipeline pre-filled with Commands specified in commandString.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="a8ca13c4c98b3907" href="../../R/a8ca13c4c98b3907.html" target="n" data-glyph="75,1" class="i method">CoreCreatePipeline</a>(<b>string</b> <span id="r19 rd" class="r19 r">command</span>, <b>bool</b> <span id="r20 rd" class="r20 r">addToHistory</span>, <b>bool</b> <span id="r21 rd" class="r21 r">isNested</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> CreatePipeline
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> state change event
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Event raised when RunspaceState changes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override event</b> <span class="i">EventHandler</span>&lt;<a href="Connection.cs.html#24ce8f9c69bf1c4a" class="t t">RunspaceStateEventArgs</a>&gt; <a id="be5d8ac741d6e357" href="../../R/be5d8ac741d6e357.html" target="n" data-glyph="30,1" class="i">StateChanged</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Event raised when the availability of the Runspace changes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override event</b> <span class="i">EventHandler</span>&lt;<a href="Connection.cs.html#cb349d0617c35bc7" class="t t">RunspaceAvailabilityEventArgs</a>&gt; <a id="2d944a2ac9ef9656" href="../../R/2d944a2ac9ef9656.html" target="n" data-glyph="30,1" class="i">AvailabilityChanged</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns true if there are any subscribers to the AvailabilityChanged event.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override bool</b> <a id="a5eead2c47271740" href="../../R/a5eead2c47271740.html" target="n" data-glyph="104,1" class="i property">HasAvailabilityChangedSubscribers</a>
        {
            <b>get</b> { <b>return</b> <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="#2d944a2ac9ef9656" class="i">AvailabilityChanged</a> != <b>null</b>; }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Raises the AvailabilityChanged event.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected override void</b> <a id="7d6abe8a696f23c4" href="../../R/7d6abe8a696f23c4.html" target="n" data-glyph="75,1" class="i method">OnAvailabilityChanged</a>(<a href="Connection.cs.html#cb349d0617c35bc7" class="t t">RunspaceAvailabilityEventArgs</a> <span id="r22 rd" class="r22 r">e</span>)
        {
            <span class="i">EventHandler</span>&lt;<a href="Connection.cs.html#cb349d0617c35bc7" class="t t">RunspaceAvailabilityEventArgs</a>&gt; <span id="r23 rd" class="r23 r">eh</span> = <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="#2d944a2ac9ef9656" class="i">AvailabilityChanged</a>;
 
            <b>if</b> (<span class="r23 r">eh</span> != <b>null</b>)
            {
                <b>try</b>
                {
                    <span class="r23 r">eh</span>(<a href="#b5efaa6cd9653c05" class="k">this</a>, <span class="r22 r">e</span>);
                }
                <b>catch</b> (<span class="i">Exception</span>)
                {
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieve the current state of the runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a> <a id="9c5a4b0e5adfa9af" href="../../R/9c5a4b0e5adfa9af.html" target="n" data-glyph="105,1" class="i property">RunspaceState</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#e3cce0d70da693d3" class="i field">_runspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is queue of all the state change event which have occured for</span>
        <span class="c">///</span><span class="c"> this runspace. RaiseRunspaceStateEvents raises event for each</span>
        <span class="c">///</span><span class="c"> item in this queue. We don&#39;t raise events from with SetRunspaceState</span>
        <span class="c">///</span><span class="c"> because SetRunspaceState is often called from with in the a lock.</span>
        <span class="c">///</span><span class="c"> Raising event with in a lock introduces chances of deadlock in GUI</span>
        <span class="c">///</span><span class="c"> applications.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Queue</span>&lt;<a href="#0eb5f3f3001a9ad9" class="t t">RunspaceEventQueueItem</a>&gt; <a id="1ebd40e6845d3400" href="../../R/1ebd40e6845d3400.html" target="n" data-glyph="46,1" class="i field">_runspaceEventQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#0eb5f3f3001a9ad9" class="t t">RunspaceEventQueueItem</a>&gt;();
 
        <b>private sealed class</b> <a id="0eb5f3f3001a9ad9" href="../../R/0eb5f3f3001a9ad9.html" target="n" data-glyph="4,1" class="t t">RunspaceEventQueueItem</a>
        {
            <b>public</b> <a id="4b8d6d0be7c79af2" href="../../R/4b8d6d0be7c79af2.html" target="n" data-glyph="72,2" class="t constructor">RunspaceEventQueueItem</a>(<a href="Connection.cs.html#0cb1ed33bb1d35e3" class="t t">RunspaceStateInfo</a> <span id="r24 rd" class="r24 r">runspaceStateInfo</span>, <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r25 rd" class="r25 r">currentAvailability</span>, <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r26 rd" class="r26 r">newAvailability</span>)
            {
                <a href="#0eb5f3f3001a9ad9" class="k">this</a>.<a href="#07ab7f21b15f90a1" class="i field">RunspaceStateInfo</a> = <span class="r24 r">runspaceStateInfo</span>;
                <a href="#0eb5f3f3001a9ad9" class="k">this</a>.<a href="#ef141367e58f3504" class="i field">CurrentRunspaceAvailability</a> = <span class="r25 r">currentAvailability</span>;
                <a href="#0eb5f3f3001a9ad9" class="k">this</a>.<a href="#a84988e2df013438" class="i field">NewRunspaceAvailability</a> = <span class="r26 r">newAvailability</span>;
            }
 
            <b>public</b> <a href="Connection.cs.html#0cb1ed33bb1d35e3" class="t t">RunspaceStateInfo</a> <a id="07ab7f21b15f90a1" href="../../R/07ab7f21b15f90a1.html" target="n" data-glyph="42,2" class="i field">RunspaceStateInfo</a>;
            <b>public</b> <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="ef141367e58f3504" href="../../R/ef141367e58f3504.html" target="n" data-glyph="42,2" class="i field">CurrentRunspaceAvailability</a>;
            <b>public</b> <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="a84988e2df013438" href="../../R/a84988e2df013438.html" target="n" data-glyph="42,2" class="i field">NewRunspaceAvailability</a>;
        }
 
        <span class="c">// This is to notify once runspace has been opened (RunspaceState.Opened)</span>
        <b>internal</b> <span class="i">ManualResetEventSlim</span> <a id="4089f070bdd11cf3" href="../../R/4089f070bdd11cf3.html" target="n" data-glyph="44,1" class="i field">RunspaceOpening</a> = <b>new</b> <span class="i">ManualResetEventSlim</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the new runspace state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">reason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An exception indicating the state change is the</span>
        <span class="c">///</span><span class="c"> result of an error, otherwise; null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the internal runspace state information member variable. It also</span>
        <span class="c">///</span><span class="c"> adds RunspaceStateInfo to a queue.</span>
        <span class="c">///</span><span class="c"> RaiseRunspaceStateEvents raises event for each item in this queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="6d5ca0399cfba6cf" href="../../R/6d5ca0399cfba6cf.html" target="n" data-glyph="75,1" class="i method">SetRunspaceState</a>(<a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a> <span id="r27 rd" class="r27 r">state</span>, <span class="i">Exception</span> <span id="r28 rd" class="r28 r">reason</span>)
        {
            <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
            {
                <b>if</b> (<span class="r27 r">state</span> != <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>)
                {
                    <a href="#e3cce0d70da693d3" class="i field">_runspaceStateInfo</a> = <b>new</b> <a href="Connection.cs.html#80f3eb369399a1aa" class="t constructor">RunspaceStateInfo</a>(<span class="r27 r">state</span>, <span class="r28 r">reason</span>);
 
                    <span class="c">// Add _runspaceStateInfo to _runspaceEventQueue.</span>
                    <span class="c">// RaiseRunspaceStateEvents will raise event for each item</span>
                    <span class="c">// in this queue.</span>
                    <span class="c">// Note:We are doing clone here instead of passing the member</span>
                    <span class="c">// _runspaceStateInfo because we donot want outside</span>
                    <span class="c">// to change our runspace state.</span>
                    <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r29 rd" class="r29 r">previousAvailability</span> = <a href="#8580a82de2c31b63" class="i field">_runspaceAvailability</a>;
 
                    <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="Connection.cs.html#0c1c7b064191c408" class="i method">UpdateRunspaceAvailability</a>(<a href="#e3cce0d70da693d3" class="i field">_runspaceStateInfo</a>.<a href="Connection.cs.html#41627f067662d11c" class="i property">State</a>, <b>false</b>);
 
                    <a href="#1ebd40e6845d3400" class="i field">_runspaceEventQueue</a>.<span class="i">Enqueue</span>(
                        <b>new</b> <a href="#4b8d6d0be7c79af2" class="t constructor">RunspaceEventQueueItem</a>(
                            <a href="#e3cce0d70da693d3" class="i field">_runspaceStateInfo</a>.<a href="Connection.cs.html#d8101f7e931fd53a" class="i method">Clone</a>(),
                            <span class="r29 r">previousAvailability</span>,
                            <a href="#8580a82de2c31b63" class="i field">_runspaceAvailability</a>));
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the current runspace state - no error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="1969aad254a8771d" href="../../R/1969aad254a8771d.html" target="n" data-glyph="75,1" class="i method">SetRunspaceState</a>(<a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a> <span id="r30 rd" class="r30 r">state</span>)
        {
            <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="#6d5ca0399cfba6cf" class="i method">SetRunspaceState</a>(<span class="r30 r">state</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Raises events for changes in runspace state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="9452499818eb542a" href="../../R/9452499818eb542a.html" target="n" data-glyph="75,1" class="i method">RaiseRunspaceStateEvents</a>()
        {
            <span class="i">Queue</span>&lt;<a href="#0eb5f3f3001a9ad9" class="t t">RunspaceEventQueueItem</a>&gt; <span id="r31 rd" class="r31 r">tempEventQueue</span> = <b>null</b>;
            <span class="i">EventHandler</span>&lt;<a href="Connection.cs.html#24ce8f9c69bf1c4a" class="t t">RunspaceStateEventArgs</a>&gt; <span id="r32 rd" class="r32 r">stateChanged</span> = <b>null</b>;
            <b>bool</b> <span id="r33 rd" class="r33 r">hasAvailabilityChangedSubscribers</span> = <b>false</b>;
 
            <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
            {
                <span class="r32 r">stateChanged</span> = <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="#be5d8ac741d6e357" class="i">StateChanged</a>;
                <span class="r33 r">hasAvailabilityChangedSubscribers</span> = <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="#a5eead2c47271740" class="i property">HasAvailabilityChangedSubscribers</a>;
 
                <b>if</b> (<span class="r32 r">stateChanged</span> != <b>null</b> || <span class="r33 r">hasAvailabilityChangedSubscribers</span>)
                {
                    <span class="r31 r">tempEventQueue</span> = <a href="#1ebd40e6845d3400" class="i field">_runspaceEventQueue</a>;
                    <a href="#1ebd40e6845d3400" class="i field">_runspaceEventQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#0eb5f3f3001a9ad9" class="t t">RunspaceEventQueueItem</a>&gt;();
                }
                <b>else</b>
                {
                    <span class="c">// Clear the events if there are no EventHandlers. This</span>
                    <span class="c">// ensures that events do not get called for state</span>
                    <span class="c">// changes prior to their registration.</span>
                    <a href="#1ebd40e6845d3400" class="i field">_runspaceEventQueue</a>.<span class="i">Clear</span>();
                }
            }
 
            <b>if</b> (<span class="r31 r">tempEventQueue</span> != <b>null</b>)
            {
                <b>while</b> (<span class="r31 r">tempEventQueue</span>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="#0eb5f3f3001a9ad9" class="t t">RunspaceEventQueueItem</a> <span id="r34 rd" class="r34 r">queueItem</span> = <span class="r31 r">tempEventQueue</span>.<span class="i">Dequeue</span>();
 
                    <b>if</b> (<span class="r33 r">hasAvailabilityChangedSubscribers</span> &amp;&amp; <span class="r34 r">queueItem</span>.<a href="#a84988e2df013438" class="i field">NewRunspaceAvailability</a> != <span class="r34 r">queueItem</span>.<a href="#ef141367e58f3504" class="i field">CurrentRunspaceAvailability</a>)
                    {
                        <a href="#b5efaa6cd9653c05" class="k">this</a>.<a href="#7d6abe8a696f23c4" class="i method">OnAvailabilityChanged</a>(<b>new</b> <a href="Connection.cs.html#38ab95beeaebfcf6" class="t constructor">RunspaceAvailabilityEventArgs</a>(<span class="r34 r">queueItem</span>.<a href="#a84988e2df013438" class="i field">NewRunspaceAvailability</a>));
                    }
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56500
                    <span class="c">// Exception raised by events are not error condition for runspace</span>
                    <span class="c">// object.</span>
                    <b>if</b> (<span class="r32 r">stateChanged</span> != <b>null</b>)
                    {
                        <b>try</b>
                        {
                            <span class="r32 r">stateChanged</span>(<a href="#b5efaa6cd9653c05" class="k">this</a>, <b>new</b> <a href="Connection.cs.html#6e0b792adcfea770" class="t constructor">RunspaceStateEventArgs</a>(<span class="r34 r">queueItem</span>.<a href="#07ab7f21b15f90a1" class="i field">RunspaceStateInfo</a>));
                        }
                        <b>catch</b> (<span class="i">Exception</span>)
                        {
                        }
                    }
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> 56500
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> state change event
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> running pipeline management
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In RemoteRunspace, it is required to invoke pipeline</span>
        <span class="c">///</span><span class="c"> as part of open call (i.e. while state is Opening).</span>
        <span class="c">///</span><span class="c"> If this property is true, runspace state check is</span>
        <span class="c">///</span><span class="c"> not performed in AddToRunningPipelineList call.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="c93fad3a92afb0a6" href="../../R/c93fad3a92afb0a6.html" target="n" data-glyph="105,1" class="i property">ByPassRunspaceStateCheck</a> { <b>get</b>; <b>set</b>; }
 
        <b>private readonly object</b> <a id="b641c63dcebd6e53" href="../../R/b641c63dcebd6e53.html" target="n" data-glyph="46,1" class="i field">_pipelineListLock</a> = <b>new</b> <b>object</b>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List of pipeline which are currently executing in this runspace.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <span class="i">List</span>&lt;<a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>&gt; <a id="cba250429c45b6cd" href="../../R/cba250429c45b6cd.html" target="n" data-glyph="105,1" class="i property">RunningPipelines</a> { <b>get</b>; } = <b>new</b> <span class="i">List</span>&lt;<a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add the pipeline to list of pipelines in execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">pipeline</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Pipeline to add to the</span>
        <span class="c">///</span><span class="c"> list of pipelines in execution</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Thrown if the runspace is not in the Opened state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Thrown if</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">pipeline</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="a1238e9392b32ed3" href="../../R/a1238e9392b32ed3.html" target="n" data-glyph="74,1" class="i method">AddToRunningPipelineList</a>(<a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a> <span id="r35 rd" class="r35 r">pipeline</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r35 r">pipeline</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <b>lock</b> (<a href="#b641c63dcebd6e53" class="i field">_pipelineListLock</a>)
            {
                <b>if</b> (!<a href="#c93fad3a92afb0a6" class="i property">ByPassRunspaceStateCheck</a> &amp;&amp; <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                {
                    <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r36 rd" class="r36 r">e</span> =
                        <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                        (
                            <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotOpenForPipeline</span>, <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>.<span class="i">ToString</span>()),
                            <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>,
                            <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                        );
                    <b>throw</b> <span class="r36 r">e</span>;
                }
 
                <span class="c">// Add the pipeline to list of Executing pipeline.</span>
                <span class="c">// Note:_runningPipelines is always accessed with the lock so</span>
                <span class="c">// there is no need to create a synchronized version of list</span>
                <a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Add</span>(<span class="r35 r">pipeline</span>);
                <a href="#3dc13244ca47f2c2" class="i field">_currentlyRunningPipeline</a> = <span class="r35 r">pipeline</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Remove the pipeline from list of pipelines in execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">pipeline</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Pipeline to remove from the</span>
        <span class="c">///</span><span class="c"> list of pipelines in execution</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Thrown if </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">pipeline</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="283a9dade350d2b6" href="../../R/283a9dade350d2b6.html" target="n" data-glyph="74,1" class="i method">RemoveFromRunningPipelineList</a>(<a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a> <span id="r37 rd" class="r37 r">pipeline</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r37 r">pipeline</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
 
            <b>lock</b> (<a href="#b641c63dcebd6e53" class="i field">_pipelineListLock</a>)
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#4e82723df10b13f6" class="i field">BeforeOpen</a>,
                             <span class="s">&quot;Runspace should not be before open when pipeline is running&quot;</span>);
 
                <span class="c">// Remove the pipeline to list of Executing pipeline.</span>
                <span class="c">// Note:_runningPipelines is always accessed with the lock so</span>
                <span class="c">// there is no need to create a synchronized version of list</span>
                <a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Remove</span>(<span class="r37 r">pipeline</span>);
 
                <span class="c">// Update the running pipeline</span>
                <b>if</b> (<a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Count</span> == 0)
                {
                    <a href="#3dc13244ca47f2c2" class="i field">_currentlyRunningPipeline</a> = <b>null</b>;
                }
                <b>else</b>
                {
                    <a href="#3dc13244ca47f2c2" class="i field">_currentlyRunningPipeline</a> = <a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>[<a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Count</span> - 1];
                }
 
                <span class="r37 r">pipeline</span>.<a href="pipelinebase.cs.html#97fb4c9ad3fda68a" class="i property">PipelineFinishedEvent</a>.<span class="i">Set</span>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Waits till all the pipelines running in the runspace have</span>
        <span class="c">///</span><span class="c"> finished execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="968ec129d12bb71a" href="../../R/968ec129d12bb71a.html" target="n" data-glyph="74,1" class="i method">WaitForFinishofPipelines</a>()
        {
            <span class="c">// Take a snapshot of list of active pipelines.</span>
            <span class="c">// Note:Before we enter to this CloseHelper routine</span>
            <span class="c">// CoreClose has already set the state of Runspace</span>
            <span class="c">// to closing. So no new pipelines can be executed on this</span>
            <span class="c">// runspace and so no new pipelines will be added to</span>
            <span class="c">// _runningPipelines. However we still need to lock because</span>
            <span class="c">// running pipelines can be removed from this.</span>
            <a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a>[] <span id="r38 rd" class="r38 r">runningPipelines</span>;
 
            <b>lock</b> (<a href="#b641c63dcebd6e53" class="i field">_pipelineListLock</a>)
            {
                <span class="r38 r">runningPipelines</span> = <a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Cast</span>&lt;<a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a>&gt;().<span class="i">ToArray</span>();
            }
 
            <b>if</b> (<span class="r38 r">runningPipelines</span>.<span class="i">Length</span> &gt; 0)
            {
                <span class="i">WaitHandle</span>[] <span id="r39 rd" class="r39 r">waitHandles</span> = <b>new</b> <span class="i">WaitHandle</span>[<span class="r38 r">runningPipelines</span>.<span class="i">Length</span>];
 
                <b>for</b> (<b>int</b> <span id="r40 rd" class="r40 r">i</span> = 0; <span class="r40 r">i</span> &lt; <span class="r38 r">runningPipelines</span>.<span class="i">Length</span>; <span class="r40 r">i</span>++)
                {
                    <span class="r39 r">waitHandles</span>[<span class="r40 r">i</span>] = <span class="r38 r">runningPipelines</span>[<span class="r40 r">i</span>].<a href="pipelinebase.cs.html#97fb4c9ad3fda68a" class="i property">PipelineFinishedEvent</a>;
                }
 
                <span class="c">// WaitAll for multiple handles on a STA (single-thread apartment) thread is not supported as WaitAll will prevent the message pump to run</span>
                <b>if</b> (<span class="r38 r">runningPipelines</span>.<span class="i">Length</span> &gt; 1 &amp;&amp; <span class="i">Thread</span>.<span class="i">CurrentThread</span>.<span class="i">GetApartmentState</span>() == <a href="Connection.cs.html#7483ec8556438ee9" class="i property">ApartmentState</a>.<span class="i">STA</span>)
                {
                    <span class="c">// We use a worker thread to wait for all handles, and the STA thread can just wait on the worker thread -- the worker</span>
                    <span class="c">// threads from the ThreadPool are MTA.</span>
                    <b>using</b> (<span class="i">ManualResetEvent</span> <span id="r41 rd" class="r41 r">waitAllIsDone</span> = <b>new</b> <span class="i">ManualResetEvent</span>(<b>false</b>))
                    {
                        <span class="i">Tuple</span>&lt;<span class="i">WaitHandle</span>[], <span class="i">ManualResetEvent</span>&gt; <span id="r42 rd" class="r42 r">stateInfo</span> = <b>new</b> <span class="i">Tuple</span>&lt;<span class="i">WaitHandle</span>[], <span class="i">ManualResetEvent</span>&gt;(<span class="r39 r">waitHandles</span>, <span class="r41 r">waitAllIsDone</span>);
 
                        <span class="i">ThreadPool</span>.<span class="i">QueueUserWorkItem</span>(<b>new</b> <span class="i">WaitCallback</span>(
                            (<b>object</b> <span id="r43 rd" class="r43 r">state</span>) =&gt;
                            {
                                <b>var</b> <span id="r44 rd" class="r44 r">tuple</span> = (<span class="i">Tuple</span>&lt;<span class="i">WaitHandle</span>[], <span class="i">ManualResetEvent</span>&gt;)<span class="r43 r">state</span>;
                                <span class="i">WaitHandle</span>.<span class="i">WaitAll</span>(<span class="r44 r">tuple</span>.<span class="i">Item1</span>);
                                <span class="r44 r">tuple</span>.<span class="i">Item2</span>.<span class="i">Set</span>();
                            }),
                            <span class="r42 r">stateInfo</span>);
                        <b>return</b> <span class="r41 r">waitAllIsDone</span>.<span class="i">WaitOne</span>();
                    }
                }
 
                <b>return</b> <span class="i">WaitHandle</span>.<span class="i">WaitAll</span>(<span class="r39 r">waitHandles</span>);
            }
            <b>else</b>
            {
                <b>return</b> <b>true</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stops all the running pipelines.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="7a721f04d8d2361e" href="../../R/7a721f04d8d2361e.html" target="n" data-glyph="75,1" class="i method">StopPipelines</a>()
        {
            <a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a>[] <span id="r45 rd" class="r45 r">runningPipelines</span>;
 
            <b>lock</b> (<a href="#b641c63dcebd6e53" class="i field">_pipelineListLock</a>)
            {
                <span class="r45 r">runningPipelines</span> = <a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Cast</span>&lt;<a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a>&gt;().<span class="i">ToArray</span>();
            }
 
            <b>if</b> (<span class="r45 r">runningPipelines</span>.<span class="i">Length</span> &gt; 0)
            {
                <span class="c">// Start from the most recent pipeline.</span>
                <b>for</b> (<b>int</b> <span id="r46 rd" class="r46 r">i</span> = <span class="r45 r">runningPipelines</span>.<span class="i">Length</span> - 1; <span class="r46 r">i</span> &gt;= 0; <span class="r46 r">i</span>--)
                {
                    <span class="r45 r">runningPipelines</span>[<span class="r46 r">i</span>].<a href="pipelinebase.cs.html#df999d984d1cda4d" class="i method">Stop</a>();
                }
            }
        }
 
        <b>internal bool</b> <a id="f2f3a7f1885fe7ea" href="../../R/f2f3a7f1885fe7ea.html" target="n" data-glyph="74,1" class="i method">CanRunActionInCurrentPipeline</a>()
        {
            <b>lock</b> (<a href="#b641c63dcebd6e53" class="i field">_pipelineListLock</a>)
            {
                <span class="c">// If we have no running pipeline, or if the currently running pipeline is</span>
                <span class="c">// the same as the current thread, then execute the action.</span>
                <a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="k">var</a> <span id="r47 rd" class="r47 r">pipelineRunning</span> = <a href="#3dc13244ca47f2c2" class="i field">_currentlyRunningPipeline</a> <b>as</b> <a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a>;
                <b>return</b> <span class="r47 r">pipelineRunning</span> == <b>null</b> ||
                    <span class="i">Thread</span>.<span class="i">CurrentThread</span> == <span class="r47 r">pipelineRunning</span>.<a href="pipelinebase.cs.html#a5df166266e2f408" class="i property">NestedPipelineExecutionThread</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the currently executing pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Internal because it is needed by invoke-history</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal override</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="2039b1cbfe257822" href="../../R/2039b1cbfe257822.html" target="n" data-glyph="74,1" class="i method">GetCurrentlyRunningPipeline</a>()
        {
            <b>return</b> <a href="#3dc13244ca47f2c2" class="i field">_currentlyRunningPipeline</a>;
        }
 
        <b>private</b> <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <a id="3dc13244ca47f2c2" href="../../R/3dc13244ca47f2c2.html" target="n" data-glyph="46,1" class="i field">_currentlyRunningPipeline</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method stops all the pipelines which are nested</span>
        <span class="c">///</span><span class="c"> under specified pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">pipeline</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="988ca57d12a6e742" href="../../R/988ca57d12a6e742.html" target="n" data-glyph="74,1" class="i method">StopNestedPipelines</a>(<a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <span id="r48 rd" class="r48 r">pipeline</span>)
        {
            <span class="i">List</span>&lt;<a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>&gt; <span id="r49 rd" class="r49 r">nestedPipelines</span> = <b>null</b>;
 
            <b>lock</b> (<a href="#b641c63dcebd6e53" class="i field">_pipelineListLock</a>)
            {
                <span class="c">// first check if this pipeline is in the list of running</span>
                <span class="c">// pipelines. It is possible that pipeline has already</span>
                <span class="c">// completed.</span>
                <b>if</b> (!<a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Contains</span>(<span class="r48 r">pipeline</span>))
                {
                    <b>return</b>;
                }
 
                <span class="c">// If this pipeline is currently running pipeline,</span>
                <span class="c">// then it does not have nested pipelines</span>
                <b>if</b> (<a href="#2039b1cbfe257822" class="i method">GetCurrentlyRunningPipeline</a>() == <span class="r48 r">pipeline</span>)
                {
                    <b>return</b>;
                }
 
                <span class="c">// Build list of nested pipelines</span>
                <span class="r49 r">nestedPipelines</span> = <b>new</b> <span class="i">List</span>&lt;<a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>&gt;();
                <b>for</b> (<b>int</b> <span id="r50 rd" class="r50 r">i</span> = <a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>.<span class="i">Count</span> - 1; <span class="r50 r">i</span> &gt;= 0; <span class="r50 r">i</span>--)
                {
                    <b>if</b> (<a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>[<span class="r50 r">i</span>] == <span class="r48 r">pipeline</span>)
                        <b>break</b>;
                    <span class="r49 r">nestedPipelines</span>.<span class="i">Add</span>(<a href="#cba250429c45b6cd" class="i property">RunningPipelines</a>[<span class="r50 r">i</span>]);
                }
            }
 
            <b>foreach</b> (<a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <span id="r51 rd" class="r51 r">np</span> <b>in</b> <span class="r49 r">nestedPipelines</span>)
            {
                <b>try</b>
                {
                    <span class="r51 r">np</span>.<a href="Pipeline.cs.html#f53d09a89971ab39" class="i method">Stop</a>();
                }
                <b>catch</b> (<a href="Pipeline.cs.html#37e03f100f9d822e" class="t t">InvalidPipelineStateException</a>)
                {
                }
            }
        }
 
        <b>internal
        void</b>
        <a id="5b379d23340dd402" href="../../R/5b379d23340dd402.html" target="n" data-glyph="74,1" class="i method">DoConcurrentCheckAndAddToRunningPipelines</a>(<a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a> <span id="r52 rd" class="r52 r">pipeline</span>, <b>bool</b> <span id="r53 rd" class="r53 r">syncCall</span>)
        {
            <span class="c">// Concurrency check should be done under runspace lock</span>
            <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
            {
                <b>if</b> (<a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">RunspaceStrings</span>.<span class="i">NoPipelineWhenSessionStateProxyInProgress</span>);
                }
 
                <span class="c">// Delegate to pipeline to do check if it is fine to invoke if another</span>
                <span class="c">// pipeline is running.</span>
                <span class="r52 r">pipeline</span>.<a href="pipelinebase.cs.html#995bbdbfad3b8259" class="i method">DoConcurrentCheck</a>(<span class="r53 r">syncCall</span>, <a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>, <b>true</b>);
                <span class="c">// Finally add to the list of running pipelines.</span>
                <a href="#a1238e9392b32ed3" class="i method">AddToRunningPipelineList</a>(<span class="r52 r">pipeline</span>);
            }
        }
 
        <span class="c">// PowerShell support for async notifications happen through the</span>
        <span class="c">// CheckForInterrupts() method on ParseTreeNode. These are only called when</span>
        <span class="c">// the engine is active (and processing,) so the Pulse() method</span>
        <span class="c">// executes the equivalent of a NOP so that async events</span>
        <span class="c">// can be processed when the engine is idle.</span>
        <b>internal void</b> <a id="a4907a23ecb3e997" href="../../R/a4907a23ecb3e997.html" target="n" data-glyph="74,1" class="i method">Pulse</a>()
        {
            <span class="c">// If we don&#39;t already have a pipeline running, pulse the engine.</span>
            <b>bool</b> <span id="r54 rd" class="r54 r">pipelineCreated</span> = <b>false</b>;
            <b>if</b> (<a href="#2039b1cbfe257822" class="i method">GetCurrentlyRunningPipeline</a>() == <b>null</b>)
            {
                <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                {
                    <b>if</b> (<a href="#2039b1cbfe257822" class="i method">GetCurrentlyRunningPipeline</a>() == <b>null</b>)
                    {
                        <span class="c">// This is a pipeline that does the least amount possible.</span>
                        <span class="c">// It evaluates a constant, and results in the execution of only two parse tree nodes.</span>
                        <span class="c">// We don&#39;t need to void it, as we aren&#39;t using the results. In addition, voiding</span>
                        <span class="c">// (as opposed to ignoring) is 1.6x slower.</span>
                        <b>try</b>
                        {
                            <a href="#5970aa4db61a1c2c" class="i property">PulsePipeline</a> = (<a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a>)<a href="#49dbcb9fbb1b1a96" class="i method">CreatePipeline</a>(<span class="s">&quot;0&quot;</span>);
                            <a href="#5970aa4db61a1c2c" class="i property">PulsePipeline</a>.<a href="pipelinebase.cs.html#e53a5e2c123c3c37" class="i property">IsPulsePipeline</a> = <b>true</b>;
                            <span class="r54 r">pipelineCreated</span> = <b>true</b>;
                        }
                        <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                        {
                            <span class="c">// Ignore. The runspace is closing. The event was not processed,</span>
                            <span class="c">// but this should not crash PowerShell.</span>
                        }
                    }
                }
            }
 
            <span class="c">// Invoke pipeline outside the runspace lock.</span>
            <span class="c">// A concurrency check will be made on the runspace before this</span>
            <span class="c">// pipeline is invoked.</span>
            <b>if</b> (<span class="r54 r">pipelineCreated</span>)
            {
                <b>try</b>
                {
                    <a href="#5970aa4db61a1c2c" class="i property">PulsePipeline</a>.<a href="Pipeline.cs.html#f211da0a5b795e94" class="i method">Invoke</a>();
                }
                <b>catch</b> (<a href="../../utils/MshInvalidOperationException.cs.html#259a38c8b594783c" class="t t">PSInvalidOperationException</a>)
                {
                    <span class="c">// Ignore. A pipeline was created between the time</span>
                    <span class="c">// we checked for it, and when we invoked the pipeline.</span>
                    <span class="c">// This is unlikely, but taking a lock on the runspace</span>
                    <span class="c">// means that OUR invoke will not be able to run.</span>
                }
                <b>catch</b> (<a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a>)
                {
                    <span class="c">// Ignore. The runspace is closing. The event was not processed,</span>
                    <span class="c">// but this should not crash PowerShell.</span>
                }
                <b>catch</b> (<span class="i">ObjectDisposedException</span>)
                {
                    <span class="c">// Ignore. The runspace is closing. The event was not processed,</span>
                    <span class="c">// but this should not crash PowerShell.</span>
                }
            }
        }
 
        <b>internal</b> <a href="pipelinebase.cs.html#5ad91ced3ee4f37f" class="t t">PipelineBase</a> <a id="5970aa4db61a1c2c" href="../../R/5970aa4db61a1c2c.html" target="n" data-glyph="104,1" class="i property">PulsePipeline</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> running pipeline management
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> session state proxy
 
        <span class="c">// Note: When SessionStateProxy calls are in progress,</span>
        <span class="c">// pipeline cannot be invoked. Also when pipeline is in</span>
        <span class="c">// progress, SessionStateProxy calls cannot be made.</span>
        <b>private bool</b> <a id="f42bcc03172670e6" href="../../R/f42bcc03172670e6.html" target="n" data-glyph="46,1" class="i field">_bSessionStateProxyCallInProgress</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method ensures that SessionStateProxy call is allowed and if</span>
        <span class="c">///</span><span class="c"> allowed it sets a variable to disallow further SessionStateProxy or</span>
        <span class="c">///</span><span class="c"> pipeline calls.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="3374b3b362039e61" href="../../R/3374b3b362039e61.html" target="n" data-glyph="76,1" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>()
        {
            <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
            {
                <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                {
                    <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r55 rd" class="r55 r">e</span> =
                        <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                        (
                            <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotInOpenedState</span>, <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>.<span class="i">ToString</span>()),
                            <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>,
                            <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                        );
                    <b>throw</b> <span class="r55 r">e</span>;
                }
 
                <b>if</b> (<a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">RunspaceStrings</span>.<span class="i">AnotherSessionStateProxyInProgress</span>);
                }
 
                <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a> <span id="r56 rd" class="r56 r">runningPipeline</span> = <a href="#2039b1cbfe257822" class="i method">GetCurrentlyRunningPipeline</a>();
                <b>if</b> (<span class="r56 r">runningPipeline</span> != <b>null</b>)
                {
                    <span class="c">// Detect if we&#39;re running an engine pulse, or we&#39;re running a nested pipeline</span>
                    <span class="c">// from an engine pulse</span>
                    <b>if</b> (<span class="r56 r">runningPipeline</span> == <a href="#5970aa4db61a1c2c" class="i property">PulsePipeline</a> ||
                        (<span class="r56 r">runningPipeline</span>.<a href="Pipeline.cs.html#cabd7078d1f05403" class="i property">IsNested</a> &amp;&amp; <a href="#5970aa4db61a1c2c" class="i property">PulsePipeline</a> != <b>null</b>))
                    {
                        <span class="c">// If so, wait and try again</span>
                        <span class="c">// Release the lock before we wait for the pulse pipelines</span>
                        <span class="i">Monitor</span>.<span class="i">Exit</span>(<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>);
 
                        <b>try</b>
                        {
                            <a href="#968ec129d12bb71a" class="i method">WaitForFinishofPipelines</a>();
                        }
                        <b>finally</b>
                        {
                            <span class="c">// Acquire the lock before we carry on with the rest operations</span>
                            <span class="i">Monitor</span>.<span class="i">Enter</span>(<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>);
                        }
 
                        <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                        <b>return</b>;
                    }
                    <b>else</b>
                    {
                        <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(<span class="i">RunspaceStrings</span>.<span class="i">NoSessionStateProxyWhenPipelineInProgress</span>);
                    }
                }
 
                <span class="c">// Now we can invoke session state proxy</span>
                <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>true</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> SetVariable implementation. This class does the necessary checks to ensure</span>
        <span class="c">///</span><span class="c"> that no pipeline or other SessionStateProxy calls are in progress.</span>
        <span class="c">///</span><span class="c"> It delegates to derived class worker method for actual operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="29070ac2e154913a" href="../../R/29070ac2e154913a.html" target="n" data-glyph="74,1" class="i method">SetVariable</a>(<b>string</b> <span id="r57 rd" class="r57 r">name</span>, <b>object</b> <span id="r58 rd" class="r58 r">value</span>)
        {
            <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
            <b>try</b>
            {
                <a href="#4030e4504e6ad163" class="i method">DoSetVariable</a>(<span class="r57 r">name</span>, <span class="r58 r">value</span>);
            }
            <b>finally</b>
            {
                <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                {
                    <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> GetVariable implementation. This class does the necessary checks to ensure</span>
        <span class="c">///</span><span class="c"> that no pipeline or other SessionStateProxy calls are in progress.</span>
        <span class="c">///</span><span class="c"> It delegates to derived class worker method for actual operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal object</b> <a id="9ac34d62c60b0a93" href="../../R/9ac34d62c60b0a93.html" target="n" data-glyph="74,1" class="i method">GetVariable</a>(<b>string</b> <span id="r59 rd" class="r59 r">name</span>)
        {
            <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
            <b>try</b>
            {
                <b>return</b> <a href="#2aeba9b56c9178df" class="i method">DoGetVariable</a>(<span class="r59 r">name</span>);
            }
            <b>finally</b>
            {
                <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                {
                    <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Applications implementation. This class does the necessary checks to ensure</span>
        <span class="c">///</span><span class="c"> that no pipeline or other SessionStateProxy calls are in progress.</span>
        <span class="c">///</span><span class="c"> It delegates to derived class worker method for actual operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="41f7f36dc9b4f5ce" href="../../R/41f7f36dc9b4f5ce.html" target="n" data-glyph="104,1" class="i property">Applications</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#cf8df3567253c9d3" class="i property">DoApplications</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Scripts implementation. This class does the necessary checks to ensure</span>
        <span class="c">///</span><span class="c"> that no pipeline or other SessionStateProxy calls are in progress.</span>
        <span class="c">///</span><span class="c"> It delegates to derived class worker method for actual operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="fceca1d7d0e9aadb" href="../../R/fceca1d7d0e9aadb.html" target="n" data-glyph="104,1" class="i property">Scripts</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#4baea956c3a00aea" class="i property">DoScripts</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../DriveInterfaces.cs.html#af7db3a0f716ab5e" class="t t">DriveManagementIntrinsics</a> <a id="975dc2cbb34f3346" href="../../R/975dc2cbb34f3346.html" target="n" data-glyph="104,1" class="i property">Drive</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#2955c8275f092282" class="i property">DoDrive</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a> <a id="3e01efb312e1de02" href="../../R/3e01efb312e1de02.html" target="n" data-glyph="102,1" class="i property">LanguageMode</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                {
                    <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r60 rd" class="r60 r">e</span> =
                        <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                        (
                            <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotInOpenedState</span>, <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>.<span class="i">ToString</span>()),
                            <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>,
                            <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                        );
                    <b>throw</b> <span class="r60 r">e</span>;
                }
 
                <b>return</b> <a href="#71db422ea55b272a" class="i property">DoLanguageMode</a>;
            }
 
            <b>set</b>
            {
                <b>if</b> (<a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a> != <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>)
                {
                    <a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a> <span id="r61 rd" class="r61 r">e</span> =
                        <b>new</b> <a href="Connection.cs.html#ff1c45fc227fc3d7" class="t constructor">InvalidRunspaceStateException</a>
                        (
                            <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">RunspaceNotInOpenedState</span>, <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>.<span class="i">ToString</span>()),
                            <a href="#9c5a4b0e5adfa9af" class="i property">RunspaceState</a>,
                            <a href="Connection.cs.html#5da9dc65e996a685" class="t t">RunspaceState</a>.<a href="Connection.cs.html#9a99efb0eaa3c3db" class="i field">Opened</a>
                        );
                    <b>throw</b> <span class="r61 r">e</span>;
                }
 
                <a href="#71db422ea55b272a" class="i property">DoLanguageMode</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="3c0917b36b459b23" href="../../R/3c0917b36b459b23.html" target="n" data-glyph="104,1" class="i property">Module</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#60ad7a851df744e8" class="i property">DoModule</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../PathInterfaces.cs.html#2a45e8d71562122c" class="t t">PathIntrinsics</a> <a id="21dfc834a9d0c791" href="../../R/21dfc834a9d0c791.html" target="n" data-glyph="104,1" class="i property">PathIntrinsics</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#513900ec77564f26" class="i property">DoPath</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../ProviderInterfaces.cs.html#5df802574bbd2fbe" class="t t">CmdletProviderManagementIntrinsics</a> <a id="c9a00561e34ae8f4" href="../../R/c9a00561e34ae8f4.html" target="n" data-glyph="104,1" class="i property">Provider</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#6ad421ae7791778e" class="i property">DoProvider</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../VariableInterfaces.cs.html#a66e215a6e6c92d5" class="t t">PSVariableIntrinsics</a> <a id="bd66404c3b59d900" href="../../R/bd66404c3b59d900.html" target="n" data-glyph="104,1" class="i property">PSVariable</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#4e94e8b305d62de8" class="i property">DoPSVariable</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../MshCmdlet.cs.html#444c098e64ffcf20" class="t t">CommandInvocationIntrinsics</a> <a id="9e67e5f19e3f3d5d" href="../../R/9e67e5f19e3f3d5d.html" target="n" data-glyph="104,1" class="i property">InvokeCommand</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#3fbc3dd9bb8f9b45" class="i property">DoInvokeCommand</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../CmdletFamilyProviderInterfaces.cs.html#7e7c55aa110a0320" class="t t">ProviderIntrinsics</a> <a id="4d23d466c01a6b9c" href="../../R/4d23d466c01a6b9c.html" target="n" data-glyph="104,1" class="i property">InvokeProvider</a>
        {
            <b>get</b>
            {
                <a href="#3374b3b362039e61" class="i method">DoConcurrentCheckAndMarkSessionStateProxyCallInProgress</a>();
                <b>try</b>
                {
                    <b>return</b> <a href="#4972a84d79e7f4a4" class="i property">DoInvokeProvider</a>;
                }
                <b>finally</b>
                {
                    <b>lock</b> (<a href="#491abdf8e72c9d24" class="i property">SyncRoot</a>)
                    {
                        <a href="#f42bcc03172670e6" class="i field">_bSessionStateProxyCallInProgress</a> = <b>false</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of setting variable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Name of the variable to set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The value to set it to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected abstract void</b> <a id="4030e4504e6ad163" href="../../R/4030e4504e6ad163.html" target="n" data-glyph="75,1" class="i method">DoSetVariable</a>(<b>string</b> <span id="r62 rd" class="r62 r">name</span>, <b>object</b> <span id="r63 rd" class="r63 r">value</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting variable.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r64 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected abstract object</b> <a id="2aeba9b56c9178df" href="../../R/2aeba9b56c9178df.html" target="n" data-glyph="75,1" class="i method">DoGetVariable</a>(<b>string</b> <span id="r64 rd" class="r64 r">name</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting applications.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="cf8df3567253c9d3" href="../../R/cf8df3567253c9d3.html" target="n" data-glyph="105,1" class="i property">DoApplications</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <span class="i">List</span>&lt;<b>string</b>&gt; <a id="4baea956c3a00aea" href="../../R/4baea956c3a00aea.html" target="n" data-glyph="105,1" class="i property">DoScripts</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../DriveInterfaces.cs.html#af7db3a0f716ab5e" class="t t">DriveManagementIntrinsics</a> <a id="2955c8275f092282" href="../../R/2955c8275f092282.html" target="n" data-glyph="105,1" class="i property">DoDrive</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../SessionStatePublic.cs.html#450052824aba2e3f" class="t t">PSLanguageMode</a> <a id="71db422ea55b272a" href="../../R/71db422ea55b272a.html" target="n" data-glyph="105,1" class="i property">DoLanguageMode</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../Modules/PSModuleInfo.cs.html#4885a82159eebf7b" class="t t">PSModuleInfo</a> <a id="60ad7a851df744e8" href="../../R/60ad7a851df744e8.html" target="n" data-glyph="105,1" class="i property">DoModule</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../PathInterfaces.cs.html#2a45e8d71562122c" class="t t">PathIntrinsics</a> <a id="513900ec77564f26" href="../../R/513900ec77564f26.html" target="n" data-glyph="105,1" class="i property">DoPath</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../ProviderInterfaces.cs.html#5df802574bbd2fbe" class="t t">CmdletProviderManagementIntrinsics</a> <a id="6ad421ae7791778e" href="../../R/6ad421ae7791778e.html" target="n" data-glyph="105,1" class="i property">DoProvider</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../VariableInterfaces.cs.html#a66e215a6e6c92d5" class="t t">PSVariableIntrinsics</a> <a id="4e94e8b305d62de8" href="../../R/4e94e8b305d62de8.html" target="n" data-glyph="105,1" class="i property">DoPSVariable</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../MshCmdlet.cs.html#444c098e64ffcf20" class="t t">CommandInvocationIntrinsics</a> <a id="3fbc3dd9bb8f9b45" href="../../R/3fbc3dd9bb8f9b45.html" target="n" data-glyph="105,1" class="i property">DoInvokeCommand</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected methods to be implemented by derived class.</span>
        <span class="c">///</span><span class="c"> This does the actual work of getting scripts.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract</b> <a href="../CmdletFamilyProviderInterfaces.cs.html#7e7c55aa110a0320" class="t t">ProviderIntrinsics</a> <a id="4972a84d79e7f4a4" href="../../R/4972a84d79e7f4a4.html" target="n" data-glyph="105,1" class="i property">DoInvokeProvider</a> { <b>get</b>; }
 
        <b>private</b> <a href="Connection.cs.html#6d877a4c99871852" class="t t">SessionStateProxy</a> <a id="6799283a70e42d08" href="../../R/6799283a70e42d08.html" target="n" data-glyph="46,1" class="i field">_sessionStateProxy</a>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns SessionState proxy object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal override</b> <a href="Connection.cs.html#6d877a4c99871852" class="t t">SessionStateProxy</a> <a id="e9ab9153efaaa8a6" href="../../R/e9ab9153efaaa8a6.html" target="n" data-glyph="74,1" class="i method">GetSessionStateProxy</a>()
        {
            <b>return</b> <a href="#6799283a70e42d08" class="i field">_sessionStateProxy</a> ??= <b>new</b> <a href="Connection.cs.html#ee2dd6f050844b6e" class="t constructor">SessionStateProxy</a>(<a href="#b5efaa6cd9653c05" class="k">this</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> session state proxy
    }
}
</pre></td></tr></table></div></body></html>
