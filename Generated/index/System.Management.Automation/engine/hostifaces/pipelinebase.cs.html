<!DOCTYPE html>
<html><head><title>pipelinebase.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(1073);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#System.Management.Automation/engine/hostifaces/pipelinebase.cs" target="_top">engine\hostifaces\pipelinebase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#System.Management.Automation" target="_top">src\System.Management.Automation\System.Management.Automation.csproj</a> (System.Management.Automation)</td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>namespace</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Runspaces</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i">Collections</span>.<span class="i">ObjectModel</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i">Threading</span>;
    <b>using</b> <span class="t">Dbg</span> = <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Diagnostics</a>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Management</span>.<span class="i n">Automation</span>.<span class="i n">Internal</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 1634, 1691 <span class="c">// Stops compiler from warning about unknown warnings</span>
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This class has common base implementation for Pipeline class.</span>
    <span class="c">///</span><span class="c"> LocalPipeline and RemotePipeline classes derives from it.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal abstract class</b> <a id="5ad91ced3ee4f37f" href="../../R/5ad91ced3ee4f37f.html" target="n" data-glyph="2,0" class="t t">PipelineBase</a> : <a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> constructors
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a pipeline initialized with a command string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The associated Runspace/&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Command string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true, add pipeline to history.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True for nested pipeline.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Command is null and add to history is true</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>protected</b> <a id="29ffbedefa72a7a3" href="../../R/29ffbedefa72a7a3.html" target="n" data-glyph="75,1" class="t constructor">PipelineBase</a>(<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r0 rd" class="r0 r">runspace</span>, <b>string</b> <span id="r1 rd" class="r1 r">command</span>, <b>bool</b> <span id="r2 rd" class="r2 r">addToHistory</span>, <b>bool</b> <span id="r3 rd" class="r3 r">isNested</span>)
            : <a href="Pipeline.cs.html#51363ffeaeaae9e3" class="k">base</a>(<span class="r0 r">runspace</span>)
        {
            <a href="#20e67828d0e7194d" class="i method">Initialize</a>(<span class="r0 r">runspace</span>, <span class="r1 r">command</span>, <span class="r2 r">addToHistory</span>, <span class="r3 r">isNested</span>);
 
            <span class="c">// Initialize streams</span>
            <a href="#855cc30a2e94a28e" class="i property">InputStream</a> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#9f848b3587e1f797" class="t constructor">ObjectStream</a>();
            <a href="#b54ef8003e78247b" class="i property">OutputStream</a> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#9f848b3587e1f797" class="t constructor">ObjectStream</a>();
            <a href="#ff21065a942f05b4" class="i property">ErrorStream</a> = <b>new</b> <a href="../../utils/ObjectStream.cs.html#9f848b3587e1f797" class="t constructor">ObjectStream</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a Pipeline with an existing command string.</span>
        <span class="c">///</span><span class="c"> Caller should validate all the parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The LocalRunspace to associate with this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The command to invoke.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, add the command to history.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, mark this pipeline as a nested pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">inputStream</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stream to use for reading input objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">errorStream</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stream to use for writing error objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">outputStream</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stream to use for writing output objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">infoBuffers</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Buffers used to write progress, verbose, debug, warning, information</span>
        <span class="c">///</span><span class="c"> information of an invocation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Command is null and add to history is true</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. InformationalBuffers is null</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>protected</b> <a id="a89b269c3a0cfb45" href="../../R/a89b269c3a0cfb45.html" target="n" data-glyph="75,1" class="t constructor">PipelineBase</a>(<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r4 rd" class="r4 r">runspace</span>,
            <a href="Command.cs.html#8276f51c05ad2fa1" class="t t">CommandCollection</a> <span id="r5 rd" class="r5 r">command</span>,
            <b>bool</b> <span id="r6 rd" class="r6 r">addToHistory</span>,
            <b>bool</b> <span id="r7 rd" class="r7 r">isNested</span>,
            <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r8 rd" class="r8 r">inputStream</span>,
            <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r10 rd" class="r10 r">outputStream</span>,
            <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <span id="r9 rd" class="r9 r">errorStream</span>,
            <a href="PSDataCollection.cs.html#b80567add938623b" class="t t">PSInformationalBuffers</a> <span id="r11 rd" class="r11 r">infoBuffers</span>)
            : <a href="Pipeline.cs.html#d4c461de002049eb" class="k">base</a>(<span class="r4 r">runspace</span>, <span class="r5 r">command</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r8 r">inputStream</span> != <b>null</b>, <span class="s">&quot;Caller Should validate inputstream parameter&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r10 r">outputStream</span> != <b>null</b>, <span class="s">&quot;Caller Should validate outputStream parameter&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r9 r">errorStream</span> != <b>null</b>, <span class="s">&quot;Caller Should validate errorStream parameter&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r11 r">infoBuffers</span> != <b>null</b>, <span class="s">&quot;Caller Should validate informationalBuffers parameter&quot;</span>);
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r5 r">command</span> != <b>null</b>, <span class="s">&quot;Command cannot be null&quot;</span>);
 
            <span class="c">// Since we are constructing this pipeline using a commandcollection we dont need</span>
            <span class="c">// to add cmd to CommandCollection again (Initialize does this).. because of this</span>
            <span class="c">// I am handling history here..</span>
            <a href="#20e67828d0e7194d" class="i method">Initialize</a>(<span class="r4 r">runspace</span>, <b>null</b>, <b>false</b>, <span class="r7 r">isNested</span>);
            <b>if</b> (<span class="r6 r">addToHistory</span>)
            {
                <span class="c">// get command text for history..</span>
                <b>string</b> <span id="r12 rd" class="r12 r">cmdText</span> = <span class="r5 r">command</span>.<a href="Command.cs.html#2f29888d02182b59" class="i method">GetCommandStringForHistory</a>();
                <a href="#5ed10764070043c2" class="i property">HistoryString</a> = <span class="r12 r">cmdText</span>;
                <a href="#7bfe2846e98bfb41" class="i property">AddToHistory</a> = <span class="r6 r">addToHistory</span>;
            }
 
            <span class="c">// Initialize streams</span>
            <a href="#855cc30a2e94a28e" class="i property">InputStream</a> = <span class="r8 r">inputStream</span>;
            <a href="#b54ef8003e78247b" class="i property">OutputStream</a> = <span class="r10 r">outputStream</span>;
            <a href="#ff21065a942f05b4" class="i property">ErrorStream</a> = <span class="r9 r">errorStream</span>;
            <a href="#d6c26e5d4383fd21" class="i property">InformationalBuffers</a> = <span class="r11 r">infoBuffers</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Copy constructor to support cloning.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">pipeline</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The source pipeline.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The copy constructor&#39;s intent is to support the scenario</span>
        <span class="c">///</span><span class="c"> where a host needs to run the same set of commands multiple</span>
        <span class="c">///</span><span class="c"> times.  This is accomplished via creating a master pipeline</span>
        <span class="c">///</span><span class="c"> then cloning it and executing the cloned copy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected</b> <a id="0d90edf38cbca49e" href="../../R/0d90edf38cbca49e.html" target="n" data-glyph="75,1" class="t constructor">PipelineBase</a>(<a href="#5ad91ced3ee4f37f" class="t t">PipelineBase</a> <span id="r13 rd" class="r13 r">pipeline</span>)
            : <a href="#29ffbedefa72a7a3" class="k">this</a>(<span class="r13 r">pipeline</span>.<a href="#32c8316e2a0e6851" class="i property">Runspace</a>, <b>null</b>, <b>false</b>, <span class="r13 r">pipeline</span>.<a href="#a2e1e19ecdbddde8" class="i property">IsNested</a>)
        {
            <span class="c">// NTRAID#Windows Out Of Band Releases-915851-2005/09/13</span>
            <b>if</b> (<span class="r13 r">pipeline</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r13 r">pipeline</span>));
            }
 
            <b>if</b> (<span class="r13 r">pipeline</span>.<a href="#2290c52e219fca9a" class="i field">_disposed</a>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;pipeline&quot;</span>);
            }
 
            <a href="#7bfe2846e98bfb41" class="i property">AddToHistory</a> = <span class="r13 r">pipeline</span>.<a href="#7bfe2846e98bfb41" class="i property">AddToHistory</a>;
            <a href="#5ed10764070043c2" class="i property">HistoryString</a> = <span class="r13 r">pipeline</span>.<a href="#5ed10764070043c2" class="i property">HistoryString</a>;
            <b>foreach</b> (<a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r14 rd" class="r14 r">command</span> <b>in</b> <span class="r13 r">pipeline</span>.<a href="Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>)
            {
                <a href="Command.cs.html#b55b68a3bf75e612" class="t t">Command</a> <span id="r15 rd" class="r15 r">clone</span> = <span class="r14 r">command</span>.<a href="Command.cs.html#66d065d201023e25" class="i method">Clone</a>();
 
                <span class="c">// Attach the cloned Command to this pipeline.</span>
                <a href="Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>.<span class="i">Add</span>(<span class="r15 r">clone</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> constructors
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> properties
 
        <b>private</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="d498f4010afa3c44" href="../../R/d498f4010afa3c44.html" target="n" data-glyph="46,1" class="i field">_runspace</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the runspace this pipeline is created on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="32c8316e2a0e6851" href="../../R/32c8316e2a0e6851.html" target="n" data-glyph="102,1" class="i property">Runspace</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#d498f4010afa3c44" class="i field">_runspace</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This internal method doesn&#39;t do the _disposed check.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal</b> <a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <a id="9ed2c544be4ced11" href="../../R/../../0000000000.html" target="n" data-glyph="74,1" class="i method">GetRunspace</a>()
        {
            <b>return</b> <a href="#d498f4010afa3c44" class="i field">_runspace</a>;
        }
 
        <b>private bool</b> <a id="a3f88e6236a10c8c" href="../../R/a3f88e6236a10c8c.html" target="n" data-glyph="46,1" class="i field">_isNested</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is this pipeline nested.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override bool</b> <a id="a2e1e19ecdbddde8" href="../../R/a2e1e19ecdbddde8.html" target="n" data-glyph="102,1" class="i property">IsNested</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a3f88e6236a10c8c" class="i field">_isNested</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is this a pulse pipeline (created by the EventManager)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="e53a5e2c123c3c37" href="../../R/e53a5e2c123c3c37.html" target="n" data-glyph="104,1" class="i property">IsPulsePipeline</a> { <b>get</b>; <b>set</b>; }
 
        <b>private</b> <a href="Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <a id="a403b331f04f1317" href="../../R/a403b331f04f1317.html" target="n" data-glyph="46,1" class="i field">_pipelineStateInfo</a> = <b>new</b> <a href="Pipeline.cs.html#6c6987102e594a17" class="t constructor">PipelineStateInfo</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Info about current state of the pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This value indicates the state of the pipeline after the change.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override</b> <a href="Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <a id="8850b1e97732b3d3" href="../../R/8850b1e97732b3d3.html" target="n" data-glyph="102,1" class="i property">PipelineStateInfo</a>
        {
            <b>get</b>
            {
                <b>lock</b> (<a href="#859500b6b2a8113d" class="i property">SyncRoot</a>)
                {
                    <span class="c">// Note:We do not return internal state.</span>
                    <b>return</b> <a href="#a403b331f04f1317" class="i field">_pipelineStateInfo</a>.<a href="Pipeline.cs.html#7d0ccb2943705d92" class="i method">Clone</a>();
                }
            }
        }
 
        <span class="c">// 913921-2005/07/08 ObjectWriter can be retrieved on a closed stream</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the input writer for this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../utils/IObjectWriter.cs.html#37301df630b2ae9a" class="t t">PipelineWriter</a> <a id="974af971c783a3b3" href="../../R/974af971c783a3b3.html" target="n" data-glyph="102,1" class="i property">Input</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#855cc30a2e94a28e" class="i property">InputStream</a>.<a href="../../utils/ObjectStream.cs.html#3cd6a8df464ccd7a" class="i property">ObjectWriter</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the output reader for this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../utils/IObjectReader.cs.html#6b2221741902f9bd" class="t t">PipelineReader</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="e33fe206001fc1c0" href="../../R/e33fe206001fc1c0.html" target="n" data-glyph="102,1" class="i property">Output</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#b54ef8003e78247b" class="i property">OutputStream</a>.<a href="../../utils/ObjectStream.cs.html#c28528f67f6c96bb" class="i property">PSObjectReader</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Access the error output reader for this pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the non-terminating error stream from the command.</span>
        <span class="c">///</span><span class="c"> In this release, the objects read from this PipelineReader</span>
        <span class="c">///</span><span class="c"> are PSObjects wrapping ErrorRecords.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../../utils/IObjectReader.cs.html#6b2221741902f9bd" class="t t">PipelineReader</a>&lt;<b>object</b>&gt; <a id="6b0e2437e4eb0e61" href="../../R/6b0e2437e4eb0e61.html" target="n" data-glyph="102,1" class="i property">Error</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#8771ad521b2dd45b" class="i field">_errorStream</a>.<a href="../../utils/ObjectStream.cs.html#8ea6b41cfdf95aa1" class="i property">ObjectReader</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Is this pipeline a child pipeline?</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> IsChild flag makes it possible for the pipeline to differentiate between</span>
        <span class="c">///</span><span class="c"> a true v1 nested pipeline and the cmdlets calling cmdlets case. See bug</span>
        <span class="c">///</span><span class="c"> 211462.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override bool</b> <a id="d786f6d0575d2335" href="../../R/d786f6d0575d2335.html" target="n" data-glyph="104,1" class="i property">IsChild</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> properties
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> stop
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Synchronous call to stop the running pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="df999d984d1cda4d" href="../../R/df999d984d1cda4d.html" target="n" data-glyph="72,1" class="i method">Stop</a>()
        {
            <a href="#e6529dfb71e690cd" class="i method">CoreStop</a>(<b>true</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Asynchronous call to stop the running pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="9333e9f258868701" href="../../R/9333e9f258868701.html" target="n" data-glyph="72,1" class="i method">StopAsync</a>()
        {
            <a href="#e6529dfb71e690cd" class="i method">CoreStop</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop the running pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If true pipeline is stoped synchronously</span>
        <span class="c">///</span><span class="c"> else asynchronously.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="e6529dfb71e690cd" href="../../R/e6529dfb71e690cd.html" target="n" data-glyph="76,1" class="i method">CoreStop</a>(<b>bool</b> <span id="r16 rd" class="r16 r">syncCall</span>)
        {
            <span class="c">// Is pipeline already in stopping state.</span>
            <b>bool</b> <span id="r17 rd" class="r17 r">alreadyStopping</span> = <b>false</b>;
            <b>lock</b> (<a href="#859500b6b2a8113d" class="i property">SyncRoot</a>)
            {
                <b>switch</b> (<a href="#66f015a50deda997" class="i property">PipelineState</a>)
                {
                    <b>case</b> <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>:
                        <a href="#91ff12e689eb2de5" class="i method">SetPipelineState</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>);
                        <a href="#91ff12e689eb2de5" class="i method">SetPipelineState</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>);
                        <b>break</b>;
 
                    <span class="c">// If pipeline execution has failed or completed or</span>
                    <span class="c">// stoped, return silently.</span>
                    <b>case</b> <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>:
                    <b>case</b> <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#f5734941de01b098" class="i field">Completed</a>:
                    <b>case</b> <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a>:
                        <b>return</b>;
                    <span class="c">// If pipeline is in Stopping state, ignore the second</span>
                    <span class="c">// stop.</span>
                    <b>case</b> <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>:
                        <span class="r17 r">alreadyStopping</span> = <b>true</b>;
                        <b>break</b>;
 
                    <b>case</b> <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#d0f3cf00cd5762f1" class="i field">Running</a>:
                        <a href="#91ff12e689eb2de5" class="i method">SetPipelineState</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#17a7706ccaf63f5c" class="i field">Stopping</a>);
                        <b>break</b>;
                }
            }
 
            <span class="c">// If pipeline is already in stopping state. Wait for pipeline</span>
            <span class="c">// to finish. We do need to raise any events here as no</span>
            <span class="c">// change of state has occurred.</span>
            <b>if</b> (<span class="r17 r">alreadyStopping</span>)
            {
                <b>if</b> (<span class="r16 r">syncCall</span>)
                {
                    <a href="#97fb4c9ad3fda68a" class="i property">PipelineFinishedEvent</a>.<span class="i">WaitOne</span>();
                }
 
                <b>return</b>;
            }
 
            <span class="c">// Raise the event outside the lock</span>
            <a href="#dcf5e5e1da73798c" class="i method">RaisePipelineStateEvents</a>();
 
            <span class="c">// A pipeline can be stoped before it is started. See NotStarted</span>
            <span class="c">// case in above switch statement. This is done to allow stoping a pipeline</span>
            <span class="c">// in another thread before it has been started.</span>
            <b>lock</b> (<a href="#859500b6b2a8113d" class="i property">SyncRoot</a>)
            {
                <b>if</b> (<a href="#66f015a50deda997" class="i property">PipelineState</a> == <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>)
                {
                    <span class="c">// Note:if we have reached here, Stopped state was set</span>
                    <span class="c">// in PipelineState.NotStarted case above. Only other</span>
                    <span class="c">// way Stopped can be set when this method calls</span>
                    <span class="c">// StopHelper below</span>
                    <b>return</b>;
                }
            }
 
            <span class="c">// Start stop operation in derived class</span>
            <a href="#39ef903ba5113b1c" class="i method">ImplementStop</a>(<span class="r16 r">syncCall</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stop execution of pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If false, call is asynchronous.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected abstract void</b> <a id="39ef903ba5113b1c" href="../../R/39ef903ba5113b1c.html" target="n" data-glyph="75,1" class="i method">ImplementStop</a>(<b>bool</b> <span id="r18 rd" class="r18 r">syncCall</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> stop
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> invoke
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the pipeline, synchronously, returning the results as an</span>
        <span class="c">///</span><span class="c"> array of objects.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">an array of input objects to pass to the pipeline.</span>
        <span class="c">///</span><span class="c"> Array may be empty but may not be null</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An array of zero or more result objects.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Caller of synchronous exectute should not close</span>
        <span class="c">///</span><span class="c"> input objectWriter. Synchronous invoke will always close the input</span>
        <span class="c">///</span><span class="c"> objectWriter.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> On Synchronous Invoke if output is throttled and no one is reading from</span>
        <span class="c">///</span><span class="c"> output pipe, Execution will block after buffer is full.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="9869016be1479418" href="../../R/9869016be1479418.html" target="n" data-glyph="72,1" class="i method">Invoke</a>(<span class="i">IEnumerable</span> <span id="r19 rd" class="r19 r">input</span>)
        {
            <span class="c">// NTRAID#Windows Out Of Band Releases-915851-2005/09/13</span>
            <b>if</b> (<a href="#2290c52e219fca9a" class="i field">_disposed</a>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;pipeline&quot;</span>);
            }
 
            <a href="#965d77b3c9226b13" class="i method">CoreInvoke</a>(<span class="r19 r">input</span>, <b>true</b>);
 
            <span class="c">// Wait for pipeline to finish execution</span>
            <a href="#97fb4c9ad3fda68a" class="i property">PipelineFinishedEvent</a>.<span class="i">WaitOne</span>();
 
            <b>if</b> (<a href="#705ab740e87d816f" class="i property">SyncInvokeCall</a>)
            {
                <span class="c">// Raise the pipeline completion events. These events are set in</span>
                <span class="c">// pipeline execution thread. However for Synchronous execution</span>
                <span class="c">// we raise the event in the main thread.</span>
                <a href="#dcf5e5e1da73798c" class="i method">RaisePipelineStateEvents</a>();
            }
 
            <b>if</b> (<a href="#8850b1e97732b3d3" class="i property">PipelineStateInfo</a>.<a href="Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> == <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>)
            {
                <b>return</b> <b>new</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;();
            }
            <b>else</b> <b>if</b> (<a href="#8850b1e97732b3d3" class="i property">PipelineStateInfo</a>.<a href="Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a> == <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a> &amp;&amp; <a href="#8850b1e97732b3d3" class="i property">PipelineStateInfo</a>.<a href="Pipeline.cs.html#abf480477d10c9b4" class="i property">Reason</a> != <b>null</b>)
            {
                <span class="c">// If this is an error pipe for a hosting applicationand we are logging,</span>
                <span class="c">// then log the error.</span>
                <b>if</b> (<a href="#5ad91ced3ee4f37f" class="k">this</a>.<a href="#32c8316e2a0e6851" class="i property">Runspace</a>.<a href="Connection.cs.html#ade98325afa63ad9" class="i property">GetExecutionContext</a>.<a href="../ExecutionContext.cs.html#24a4a46de18d1004" class="i property">EngineHostInterface</a>.<a href="InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<a href="MshHostUserInterface.cs.html#6694b338e46fdead" class="i property">IsTranscribing</a>)
                {
                    <a href="#5ad91ced3ee4f37f" class="k">this</a>.<a href="#32c8316e2a0e6851" class="i property">Runspace</a>.<a href="Connection.cs.html#3a36e24a88649363" class="i property">ExecutionContext</a>.<a href="../ExecutionContext.cs.html#ad328d08127401c1" class="i property">InternalHost</a>.<a href="InternalHost.cs.html#d35ea6d8b175fa76" class="i property">UI</a>.<span class="i">TranscribeResult</span>(<a href="#5ad91ced3ee4f37f" class="k">this</a>.<a href="#32c8316e2a0e6851" class="i property">Runspace</a>, <a href="#8850b1e97732b3d3" class="i property">PipelineStateInfo</a>.<a href="Pipeline.cs.html#abf480477d10c9b4" class="i property">Reason</a>.<span class="i">Message</span>);
                }
 
                <b>throw</b> <a href="#8850b1e97732b3d3" class="i property">PipelineStateInfo</a>.<a href="Pipeline.cs.html#abf480477d10c9b4" class="i property">Reason</a>;
            }
 
            <span class="c">// Execution completed successfully</span>
            <span class="c">// 2004/06/30-JonN was ReadAll() which was non-blocking</span>
            <b>return</b> <a href="#e33fe206001fc1c0" class="i property">Output</a>.<span class="i">NonBlockingRead</span>(<span class="i">Int32</span>.<span class="i">MaxValue</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the pipeline asynchronously.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Results are returned through the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>.<a href="Pipeline.cs.html#e61d6d76ceba7ad2" class="i property">Output</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> reader.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="5e104d6328d2be78" href="../../R/5e104d6328d2be78.html" target="n" data-glyph="72,1" class="i method">InvokeAsync</a>()
        {
            <a href="#965d77b3c9226b13" class="i method">CoreInvoke</a>(<b>null</b>, <b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This parameter is true if Invoke is called.</span>
        <span class="c">///</span><span class="c"> It is false if InvokeAsync is called.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="705ab740e87d816f" href="../../R/705ab740e87d816f.html" target="n" data-glyph="105,1" class="i property">SyncInvokeCall</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invoke the pipeline asynchronously with input.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">input</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">input to provide to pipeline. Input is</span>
        <span class="c">///</span><span class="c"> used only for synchronous execution</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if this method is called from</span>
        <span class="c">///</span><span class="c"> synchronous invoke else false</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Results are returned through the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Pipeline.cs.html#c607964c20793ea5" class="t t">Pipeline</a>.<a href="Pipeline.cs.html#e61d6d76ceba7ad2" class="i property">Output</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> reader.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> No command is added to pipeline</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Pipeline.cs.html#37e03f100f9d822e" class="t t">InvalidPipelineStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> PipelineState is not NotStarted.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1) A pipeline is already executing. Pipeline cannot execute</span>
        <span class="c">///</span><span class="c"> concurrently.</span>
        <span class="c">///</span><span class="c"> 2) InvokeAsync is called on nested pipeline. Nested pipeline</span>
        <span class="c">///</span><span class="c"> cannot be executed Asynchronously.</span>
        <span class="c">///</span><span class="c"> 3) Attempt is made to invoke a nested pipeline directly. Nested</span>
        <span class="c">///</span><span class="c"> pipeline must be invoked from a running pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Connection.cs.html#340ccbbd1c6e8b87" class="t t">InvalidRunspaceStateException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> RunspaceState is not Open</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ObjectDisposedException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Pipeline already disposed</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="965d77b3c9226b13" href="../../R/965d77b3c9226b13.html" target="n" data-glyph="76,1" class="i method">CoreInvoke</a>(<span class="i">IEnumerable</span> <span id="r20 rd" class="r20 r">input</span>, <b>bool</b> <span id="r21 rd" class="r21 r">syncCall</span>)
        {
            <b>lock</b> (<a href="#859500b6b2a8113d" class="i property">SyncRoot</a>)
            {
                <span class="c">// NTRAID#Windows Out Of Band Releases-915851-2005/09/13</span>
                <b>if</b> (<a href="#2290c52e219fca9a" class="i field">_disposed</a>)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#02739f4db42486af" class="i method">NewObjectDisposedException</a>(<span class="s">&quot;pipeline&quot;</span>);
                }
 
                <b>if</b> (<a href="Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a> == <b>null</b> || <a href="Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>.<span class="i">Count</span> == 0)
                {
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">NoCommandInPipeline</span>);
                }
 
                <b>if</b> (<a href="#66f015a50deda997" class="i property">PipelineState</a> != <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>)
                {
                    <a href="Pipeline.cs.html#37e03f100f9d822e" class="t t">InvalidPipelineStateException</a> <span id="r22 rd" class="r22 r">e</span> =
                        <b>new</b> <a href="Pipeline.cs.html#23cc74950974177d" class="t constructor">InvalidPipelineStateException</a>
                        (
                            <a href="../../utils/StringUtil.cs.html#9499fba345e707ac" class="t t">StringUtil</a>.<span class="i">Format</span>(<span class="i">RunspaceStrings</span>.<span class="i">PipelineReInvokeNotAllowed</span>),
                            <a href="#66f015a50deda997" class="i property">PipelineState</a>,
                            <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#efb1d511bf65892d" class="i field">NotStarted</a>
                        );
                    <b>throw</b> <span class="r22 r">e</span>;
                }
 
                <b>if</b> (<span class="r21 r">syncCall</span>
                    &amp;&amp; <a href="#855cc30a2e94a28e" class="i property">InputStream</a> <b>is not</b> <a href="../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt;
                    &amp;&amp; <a href="#855cc30a2e94a28e" class="i property">InputStream</a> <b>is not</b> <a href="../../utils/ObjectStream.cs.html#7277ae0921f30c7a" class="t t">PSDataCollectionStream</a>&lt;<b>object</b>&gt;)
                {
                    <span class="c">// Method is called from synchronous invoke.</span>
                    <b>if</b> (<span class="r20 r">input</span> != <b>null</b>)
                    {
                        <span class="c">// TO-DO-Add a test make sure that ObjectDisposed</span>
                        <span class="c">// exception is thrown</span>
                        <span class="c">// Write input data in to inputStream and close the input</span>
                        <span class="c">// pipe. If Input stream is already closed an</span>
                        <span class="c">// ObjectDisposed exception will be thrown</span>
                        <b>foreach</b> (<b>object</b> <span id="r23 rd" class="r23 r">temp</span> <b>in</b> <span class="r20 r">input</span>)
                        {
                            <a href="#855cc30a2e94a28e" class="i property">InputStream</a>.<a href="../../utils/ObjectStream.cs.html#c3e6a49bad4b1dfe" class="i method">Write</a>(<span class="r23 r">temp</span>);
                        }
                    }
 
                    <a href="#855cc30a2e94a28e" class="i property">InputStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
                }
 
                <a href="#705ab740e87d816f" class="i property">SyncInvokeCall</a> = <span class="r21 r">syncCall</span>;
 
                <span class="c">// Create event which will be signalled when pipeline execution</span>
                <span class="c">// is completed/failed/stoped.</span>
                <span class="c">// Note:Runspace.Close waits for all the running pipeline</span>
                <span class="c">// to finish.  This Event must be created before pipeline is</span>
                <span class="c">// added to list of running pipelines. This avoids the race condition</span>
                <span class="c">// where Close is called after pipeline is added to list of</span>
                <span class="c">// running pipeline but before event is created.</span>
                <a href="#97fb4c9ad3fda68a" class="i property">PipelineFinishedEvent</a> = <b>new</b> <span class="i">ManualResetEvent</span>(<b>false</b>);
 
                <span class="c">// 1) Do the check to ensure that pipeline no other</span>
                <span class="c">// pipeline is running.</span>
                <span class="c">// 2) Runspace object maintains a list of pipelines in</span>
                <span class="c">// execution. Add this pipeline to the list.</span>
                <a href="#fe38e207e779c065" class="i property">RunspaceBase</a>.<a href="ConnectionBase.cs.html#5b379d23340dd402" class="i method">DoConcurrentCheckAndAddToRunningPipelines</a>(<a href="#5ad91ced3ee4f37f" class="k">this</a>, <span class="r21 r">syncCall</span>);
 
                <span class="c">// Note: Set PipelineState to Running only after adding pipeline to list</span>
                <span class="c">// of pipelines in execution. AddForExecution checks that runspace is in</span>
                <span class="c">// state where pipeline can be run.</span>
                <span class="c">// StartPipelineExecution raises this event. See Windows Bug 1160481 for</span>
                <span class="c">// more details.</span>
                <a href="#91ff12e689eb2de5" class="i method">SetPipelineState</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#d0f3cf00cd5762f1" class="i field">Running</a>);
            }
 
            <b>try</b>
            {
                <span class="c">// Let the derived class start the pipeline execution.</span>
                <a href="#f452bcc4058da9c8" class="i method">StartPipelineExecution</a>();
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r24 rd" class="r24 r">exception</span>)
            {
                <span class="c">// If we fail in any of the above three steps, set the correct states.</span>
                <a href="#fe38e207e779c065" class="i property">RunspaceBase</a>.<a href="ConnectionBase.cs.html#283a9dade350d2b6" class="i method">RemoveFromRunningPipelineList</a>(<a href="#5ad91ced3ee4f37f" class="k">this</a>);
                <a href="#0e6ce7f8688840ec" class="i method">SetPipelineState</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a>, <span class="r24 r">exception</span>);
 
                <span class="c">// Note: we are not raising the events in this case. However this is</span>
                <span class="c">// fine as user is getting the exception.</span>
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Invokes a remote command and immediately disconnects if</span>
        <span class="c">///</span><span class="c"> transport layer supports it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal override void</b> <a id="b6d63fe272c0b37a" href="../../R/b6d63fe272c0b37a.html" target="n" data-glyph="74,1" class="i method">InvokeAsyncAndDisconnect</a>()
        {
            <b>throw</b> <b>new</b> <span class="i">NotSupportedException</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Starts execution of pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected abstract void</b> <a id="f452bcc4058da9c8" href="../../R/f452bcc4058da9c8.html" target="n" data-glyph="75,1" class="i method">StartPipelineExecution</a>();
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> concurrent pipeline check
 
        <b>private bool</b> <a id="715f9322d6a0b6da" href="../../R/715f9322d6a0b6da.html" target="n" data-glyph="46,1" class="i field">_performNestedCheck</a> = <b>true</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> For nested pipeline, system checks that Execute is called from</span>
        <span class="c">///</span><span class="c"> currently executing pipeline.</span>
        <span class="c">///</span><span class="c"> If PerformNestedCheck is false, this check is bypassed. This</span>
        <span class="c">///</span><span class="c"> is set to true by remote provider. In remote provider case all</span>
        <span class="c">///</span><span class="c"> the checks are done by the client proxy.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="c69278b4d5cb485b" href="../../R/../../0000000000.html" target="n" data-glyph="104,1" class="i property">PerformNestedCheck</a>
        {
            <b>set</b>
            {
                <a href="#715f9322d6a0b6da" class="i field">_performNestedCheck</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is the thread on which NestedPipeline can be executed.</span>
        <span class="c">///</span><span class="c"> In case of LocalPipeline, this is the thread of execution</span>
        <span class="c">///</span><span class="c"> of LocalPipeline. In case of RemotePipeline, this is thread</span>
        <span class="c">///</span><span class="c"> on which EnterNestedPrompt is called.</span>
        <span class="c">///</span><span class="c"> RemotePipeline proxy should set it on at the beginning of</span>
        <span class="c">///</span><span class="c"> EnterNestedPrompt and clear it on return.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Thread</span> <a id="a5df166266e2f408" href="../../R/a5df166266e2f408.html" target="n" data-glyph="104,1" class="i property">NestedPipelineExecutionThread</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check if anyother pipeline is executing.</span>
        <span class="c">///</span><span class="c"> In case of nested pipeline, checks that it is called</span>
        <span class="c">///</span><span class="c"> from currently executing pipeline&#39;s thread.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">syncCall</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if method is called from Invoke, false</span>
        <span class="c">///</span><span class="c"> if called from InvokeAsync</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">syncObject</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sync object on which the lock is acquired.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">isInLock</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if the method is invoked in a critical section.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">InvalidOperationException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1) A pipeline is already executing. Pipeline cannot execute</span>
        <span class="c">///</span><span class="c"> concurrently.</span>
        <span class="c">///</span><span class="c"> 2) InvokeAsync is called on nested pipeline. Nested pipeline</span>
        <span class="c">///</span><span class="c"> cannot be executed Asynchronously.</span>
        <span class="c">///</span><span class="c"> 3) Attempt is made to invoke a nested pipeline directly. Nested</span>
        <span class="c">///</span><span class="c"> pipeline must be invoked from a running pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="995bbdbfad3b8259" href="../../R/995bbdbfad3b8259.html" target="n" data-glyph="74,1" class="i method">DoConcurrentCheck</a>(<b>bool</b> <span id="r25 rd" class="r25 r">syncCall</span>, <b>object</b> <span id="r26 rd" class="r26 r">syncObject</span>, <b>bool</b> <span id="r27 rd" class="r27 r">isInLock</span>)
        {
            <a href="#5ad91ced3ee4f37f" class="t t">PipelineBase</a> <span id="r28 rd" class="r28 r">currentPipeline</span> = (<a href="#5ad91ced3ee4f37f" class="t t">PipelineBase</a>)<a href="#fe38e207e779c065" class="i property">RunspaceBase</a>.<a href="ConnectionBase.cs.html#2039b1cbfe257822" class="i method">GetCurrentlyRunningPipeline</a>();
 
            <b>if</b> (!<a href="#a2e1e19ecdbddde8" class="i property">IsNested</a>)
            {
                <b>if</b> (<span class="r28 r">currentPipeline</span> == <b>null</b>)
                {
                    <b>return</b>;
                }
                <b>else</b>
                {
                    <span class="c">// Detect if we&#39;re running a pulse pipeline, or we&#39;re running a nested pipeline</span>
                    <span class="c">// in a pulse pipeline</span>
                    <b>if</b> (<span class="r28 r">currentPipeline</span> == <a href="#fe38e207e779c065" class="i property">RunspaceBase</a>.<a href="ConnectionBase.cs.html#5970aa4db61a1c2c" class="i property">PulsePipeline</a> ||
                        (<span class="r28 r">currentPipeline</span>.<a href="#a2e1e19ecdbddde8" class="i property">IsNested</a> &amp;&amp; <a href="#fe38e207e779c065" class="i property">RunspaceBase</a>.<a href="ConnectionBase.cs.html#5970aa4db61a1c2c" class="i property">PulsePipeline</a> != <b>null</b>))
                    {
                        <span class="c">// If so, wait and try again</span>
                        <b>if</b> (<span class="r27 r">isInLock</span>)
                        {
                            <span class="c">// If the method is invoked in the lock statement, release the</span>
                            <span class="c">// lock before wait on the pulse pipeline</span>
                            <span class="i">Monitor</span>.<span class="i">Exit</span>(<span class="r26 r">syncObject</span>);
                        }
 
                        <b>try</b>
                        {
                            <a href="#fe38e207e779c065" class="i property">RunspaceBase</a>.<a href="ConnectionBase.cs.html#968ec129d12bb71a" class="i method">WaitForFinishofPipelines</a>();
                        }
                        <b>finally</b>
                        {
                            <b>if</b> (<span class="r27 r">isInLock</span>)
                            {
                                <span class="c">// If the method is invoked in the lock statement, acquire the</span>
                                <span class="c">// lock before we carry on with the rest operations</span>
                                <span class="i">Monitor</span>.<span class="i">Enter</span>(<span class="r26 r">syncObject</span>);
                            }
                        }
 
                        <a href="#995bbdbfad3b8259" class="i method">DoConcurrentCheck</a>(<span class="r25 r">syncCall</span>, <span class="r26 r">syncObject</span>, <span class="r27 r">isInLock</span>);
                        <b>return</b>;
                    }
 
                    <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                            <span class="i">RunspaceStrings</span>.<span class="i">ConcurrentInvokeNotAllowed</span>);
                }
            }
            <b>else</b>
            {
                <b>if</b> (<a href="#715f9322d6a0b6da" class="i field">_performNestedCheck</a>)
                {
                    <b>if</b> (!<span class="r25 r">syncCall</span>)
                    {
                        <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">RunspaceStrings</span>.<span class="i">NestedPipelineInvokeAsync</span>);
                    }
 
                    <b>if</b> (<span class="r28 r">currentPipeline</span> == <b>null</b>)
                    {
                        <b>if</b> (<a href="#5ad91ced3ee4f37f" class="k">this</a>.<a href="#d786f6d0575d2335" class="i property">IsChild</a>)
                        {
                            <span class="c">// OK it&#39;s not really a nested pipeline but a call with RunspaceMode=UseCurrentRunspace</span>
                            <span class="c">// This shouldn&#39;t fail so we&#39;ll clear the IsNested and IsChild flags and then return</span>
                            <span class="c">// That way executions proceeds but everything gets clean up at the end when the pipeline completes</span>
                            <a href="#5ad91ced3ee4f37f" class="k">this</a>.<a href="#d786f6d0575d2335" class="i property">IsChild</a> = <b>false</b>;
                            <a href="#a3f88e6236a10c8c" class="i field">_isNested</a> = <b>false</b>;
                            <b>return</b>;
                        }
 
                        <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">RunspaceStrings</span>.<span class="i">NestedPipelineNoParentPipeline</span>);
                    }
 
                    <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r28 r">currentPipeline</span>.<a href="#a5df166266e2f408" class="i property">NestedPipelineExecutionThread</a> != <b>null</b>, <span class="s">&quot;Current pipeline should always have NestedPipelineExecutionThread set&quot;</span>);
                    <span class="i">Thread</span> <span id="r29 rd" class="r29 r">th</span> = <span class="i">Thread</span>.<span class="i">CurrentThread</span>;
 
                    <b>if</b> (!<span class="r28 r">currentPipeline</span>.<a href="#a5df166266e2f408" class="i property">NestedPipelineExecutionThread</a>.<span class="i">Equals</span>(<span class="r29 r">th</span>))
                    {
                        <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewInvalidOperationException</span>(
                                <span class="i">RunspaceStrings</span>.<span class="i">NestedPipelineNoParentPipeline</span>);
                    }
                }
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> concurrent pipeline check
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> invoke
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Connect
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Connects synchronously to a running command on a remote server.</span>
        <span class="c">///</span><span class="c"> The pipeline object must be in the disconnected state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A collection of result objects.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <span class="i">Collection</span>&lt;<a href="../MshObject.cs.html#a3c2513aa3da07fa" class="t t">PSObject</a>&gt; <a id="443bca105d758075" href="../../R/443bca105d758075.html" target="n" data-glyph="72,1" class="i method">Connect</a>()
        {
            <span class="c">// Connect semantics not supported on local (non-remoting) pipelines.</span>
            <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>(<span class="i">PipelineStrings</span>.<span class="i">ConnectNotSupported</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Connects asynchronously to a running command on a remote server.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override void</b> <a id="0dfe3300cf817ba1" href="../../R/0dfe3300cf817ba1.html" target="n" data-glyph="72,1" class="i method">ConnectAsync</a>()
        {
            <span class="c">// Connect semantics not supported on local (non-remoting) pipelines.</span>
            <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<span class="i">NewNotSupportedException</span>(<span class="i">PipelineStrings</span>.<span class="i">ConnectNotSupported</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> state change event
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Event raised when Pipeline&#39;s state changes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public override event</b> <span class="i">EventHandler</span>&lt;<a href="Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a>&gt; <a id="e04ac3468ab51683" href="../../R/e04ac3468ab51683.html" target="n" data-glyph="30,1" class="i">StateChanged</a> = <b>null</b>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Current state of the pipeline.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This value indicates the state of the pipeline after the change.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected</b> <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a> <a id="66f015a50deda997" href="../../R/66f015a50deda997.html" target="n" data-glyph="105,1" class="i property">PipelineState</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#a403b331f04f1317" class="i field">_pipelineStateInfo</a>.<a href="Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This returns true if pipeline state is Completed, Failed or Stopped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected bool</b> <a id="71ac0a42a641926b" href="../../R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">IsPipelineFinished</a>()
        {
            <b>return</b> (<a href="#66f015a50deda997" class="i property">PipelineState</a> == <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#f5734941de01b098" class="i field">Completed</a> ||
                    <a href="#66f015a50deda997" class="i property">PipelineState</a> == <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#425f1d8027f15e68" class="i field">Failed</a> ||
                    <a href="#66f015a50deda997" class="i property">PipelineState</a> == <a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a>.<a href="Pipeline.cs.html#76cf7f3120e4f94d" class="i field">Stopped</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is queue of all the state change event which have occured for</span>
        <span class="c">///</span><span class="c"> this pipeline. RaisePipelineStateEvents raises event for each</span>
        <span class="c">///</span><span class="c"> item in this queue. We don&#39;t raise the event with in SetPipelineState</span>
        <span class="c">///</span><span class="c"> because often SetPipelineState is called with in a lock.</span>
        <span class="c">///</span><span class="c"> Raising event in lock introduces chances of deadlock in GUI applications.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <span class="i">Queue</span>&lt;<a href="#bb0e15e2f8759fa9" class="t t">ExecutionEventQueueItem</a>&gt; <a id="806b3aeb3c0ededa" href="../../R/806b3aeb3c0ededa.html" target="n" data-glyph="46,1" class="i field">_executionEventQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#bb0e15e2f8759fa9" class="t t">ExecutionEventQueueItem</a>&gt;();
 
        <b>private sealed class</b> <a id="bb0e15e2f8759fa9" href="../../R/bb0e15e2f8759fa9.html" target="n" data-glyph="4,1" class="t t">ExecutionEventQueueItem</a>
        {
            <b>public</b> <a id="dd913d5df91f0638" href="../../R/dd913d5df91f0638.html" target="n" data-glyph="72,2" class="t constructor">ExecutionEventQueueItem</a>(<a href="Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <span id="r30 rd" class="r30 r">pipelineStateInfo</span>, <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r31 rd" class="r31 r">currentAvailability</span>, <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r32 rd" class="r32 r">newAvailability</span>)
            {
                <a href="#bb0e15e2f8759fa9" class="k">this</a>.<a href="#7af58182d28c700f" class="i field">PipelineStateInfo</a> = <span class="r30 r">pipelineStateInfo</span>;
                <a href="#bb0e15e2f8759fa9" class="k">this</a>.<a href="#63f73b8eb646e227" class="i field">CurrentRunspaceAvailability</a> = <span class="r31 r">currentAvailability</span>;
                <a href="#bb0e15e2f8759fa9" class="k">this</a>.<a href="#61dcfbe4f801adf9" class="i field">NewRunspaceAvailability</a> = <span class="r32 r">newAvailability</span>;
            }
 
            <b>public</b> <a href="Pipeline.cs.html#62fb09153673bbf3" class="t t">PipelineStateInfo</a> <a id="7af58182d28c700f" href="../../R/7af58182d28c700f.html" target="n" data-glyph="42,2" class="i field">PipelineStateInfo</a>;
            <b>public</b> <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="63f73b8eb646e227" href="../../R/63f73b8eb646e227.html" target="n" data-glyph="42,2" class="i field">CurrentRunspaceAvailability</a>;
            <b>public</b> <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <a id="61dcfbe4f801adf9" href="../../R/61dcfbe4f801adf9.html" target="n" data-glyph="42,2" class="i field">NewRunspaceAvailability</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the new execution state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">reason</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An exception indicating that state change is the result of an error,</span>
        <span class="c">///</span><span class="c"> otherwise; null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the internal execution state information member variable. It</span>
        <span class="c">///</span><span class="c"> also adds PipelineStateInfo to a queue. RaisePipelineStateEvents</span>
        <span class="c">///</span><span class="c"> raises event for each item in this queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="0e6ce7f8688840ec" href="../../R/0e6ce7f8688840ec.html" target="n" data-glyph="75,1" class="i method">SetPipelineState</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a> <span id="r33 rd" class="r33 r">state</span>, <span class="i">Exception</span> <span id="r34 rd" class="r34 r">reason</span>)
        {
            <b>lock</b> (<a href="#859500b6b2a8113d" class="i property">SyncRoot</a>)
            {
                <b>if</b> (<span class="r33 r">state</span> != <a href="#66f015a50deda997" class="i property">PipelineState</a>)
                {
                    <a href="#a403b331f04f1317" class="i field">_pipelineStateInfo</a> = <b>new</b> <a href="Pipeline.cs.html#8a80e8d270916577" class="t constructor">PipelineStateInfo</a>(<span class="r33 r">state</span>, <span class="r34 r">reason</span>);
 
                    <span class="c">// Add _pipelineStateInfo to _executionEventQueue.</span>
                    <span class="c">// RaisePipelineStateEvents will raise event for each item</span>
                    <span class="c">// in this queue.</span>
                    <span class="c">// Note:We are doing clone here instead of passing the member</span>
                    <span class="c">// _pipelineStateInfo because we donot want outside</span>
                    <span class="c">// to change pipeline state.</span>
                    <a href="Connection.cs.html#bd6944cab8dcc583" class="t t">RunspaceAvailability</a> <span id="r35 rd" class="r35 r">previousAvailability</span> = <a href="#d498f4010afa3c44" class="i field">_runspace</a>.<a href="Connection.cs.html#c8bea13c75bd3198" class="i property">RunspaceAvailability</a>;
 
                    <a href="#d498f4010afa3c44" class="i field">_runspace</a>.<a href="Connection.cs.html#245028b8feaec094" class="i method">UpdateRunspaceAvailability</a>(<a href="#a403b331f04f1317" class="i field">_pipelineStateInfo</a>.<a href="Pipeline.cs.html#2589f8c7203969a0" class="i property">State</a>, <b>false</b>);
 
                    <a href="#806b3aeb3c0ededa" class="i field">_executionEventQueue</a>.<span class="i">Enqueue</span>(
                        <b>new</b> <a href="#dd913d5df91f0638" class="t constructor">ExecutionEventQueueItem</a>(
                            <a href="#a403b331f04f1317" class="i field">_pipelineStateInfo</a>.<a href="Pipeline.cs.html#7d0ccb2943705d92" class="i method">Clone</a>(),
                            <span class="r35 r">previousAvailability</span>,
                            <a href="#d498f4010afa3c44" class="i field">_runspace</a>.<a href="Connection.cs.html#c8bea13c75bd3198" class="i property">RunspaceAvailability</a>));
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set the new execution state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">state</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new state.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="91ff12e689eb2de5" href="../../R/91ff12e689eb2de5.html" target="n" data-glyph="75,1" class="i method">SetPipelineState</a>(<a href="Pipeline.cs.html#03704abc5975cfc4" class="t t">PipelineState</a> <span id="r36 rd" class="r36 r">state</span>)
        {
            <a href="#0e6ce7f8688840ec" class="i method">SetPipelineState</a>(<span class="r36 r">state</span>, <b>null</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Raises events for changes in execution state.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected void</b> <a id="dcf5e5e1da73798c" href="../../R/dcf5e5e1da73798c.html" target="n" data-glyph="75,1" class="i method">RaisePipelineStateEvents</a>()
        {
            <span class="i">Queue</span>&lt;<a href="#bb0e15e2f8759fa9" class="t t">ExecutionEventQueueItem</a>&gt; <span id="r37 rd" class="r37 r">tempEventQueue</span> = <b>null</b>;
            <span class="i">EventHandler</span>&lt;<a href="Pipeline.cs.html#f088a79047187694" class="t t">PipelineStateEventArgs</a>&gt; <span id="r38 rd" class="r38 r">stateChanged</span> = <b>null</b>;
            <b>bool</b> <span id="r39 rd" class="r39 r">runspaceHasAvailabilityChangedSubscribers</span> = <b>false</b>;
 
            <b>lock</b> (<a href="#859500b6b2a8113d" class="i property">SyncRoot</a>)
            {
                <span class="r38 r">stateChanged</span> = <a href="#5ad91ced3ee4f37f" class="k">this</a>.<a href="#e04ac3468ab51683" class="i">StateChanged</a>;
                <span class="r39 r">runspaceHasAvailabilityChangedSubscribers</span> = <a href="#d498f4010afa3c44" class="i field">_runspace</a>.<a href="Connection.cs.html#d6a5f8848cdbcae5" class="i property">HasAvailabilityChangedSubscribers</a>;
 
                <b>if</b> (<span class="r38 r">stateChanged</span> != <b>null</b> || <span class="r39 r">runspaceHasAvailabilityChangedSubscribers</span>)
                {
                    <span class="r37 r">tempEventQueue</span> = <a href="#806b3aeb3c0ededa" class="i field">_executionEventQueue</a>;
                    <a href="#806b3aeb3c0ededa" class="i field">_executionEventQueue</a> = <b>new</b> <span class="i">Queue</span>&lt;<a href="#bb0e15e2f8759fa9" class="t t">ExecutionEventQueueItem</a>&gt;();
                }
                <b>else</b>
                {
                    <span class="c">// Clear the events if there are no EventHandlers. This</span>
                    <span class="c">// ensures that events do not get called for state</span>
                    <span class="c">// changes prior to their registration.</span>
                    <a href="#806b3aeb3c0ededa" class="i field">_executionEventQueue</a>.<span class="i">Clear</span>();
                }
            }
 
            <b>if</b> (<span class="r37 r">tempEventQueue</span> != <b>null</b>)
            {
                <b>while</b> (<span class="r37 r">tempEventQueue</span>.<span class="i">Count</span> &gt; 0)
                {
                    <a href="#bb0e15e2f8759fa9" class="t t">ExecutionEventQueueItem</a> <span id="r40 rd" class="r40 r">queueItem</span> = <span class="r37 r">tempEventQueue</span>.<span class="i">Dequeue</span>();
 
                    <b>if</b> (<span class="r39 r">runspaceHasAvailabilityChangedSubscribers</span> &amp;&amp; <span class="r40 r">queueItem</span>.<a href="#61dcfbe4f801adf9" class="i field">NewRunspaceAvailability</a> != <span class="r40 r">queueItem</span>.<a href="#63f73b8eb646e227" class="i field">CurrentRunspaceAvailability</a>)
                    {
                        <a href="#d498f4010afa3c44" class="i field">_runspace</a>.<a href="Connection.cs.html#d34adcc77325cd0e" class="i method">RaiseAvailabilityChangedEvent</a>(<span class="r40 r">queueItem</span>.<a href="#61dcfbe4f801adf9" class="i field">NewRunspaceAvailability</a>);
                    }
 
                    <span class="c">// this is shipped as part of V1. So disabling the warning here.</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 56500
                    <span class="c">// Exception raised in the eventhandler are not error in pipeline.</span>
                    <span class="c">// silently ignore them.</span>
                    <b>if</b> (<span class="r38 r">stateChanged</span> != <b>null</b>)
                    {
                        <b>try</b>
                        {
                            <span class="r38 r">stateChanged</span>(<a href="#5ad91ced3ee4f37f" class="k">this</a>, <b>new</b> <a href="Pipeline.cs.html#30728553fbee21a5" class="t constructor">PipelineStateEventArgs</a>(<span class="r40 r">queueItem</span>.<a href="#7af58182d28c700f" class="i field">PipelineStateInfo</a>));
                        }
                        <b>catch</b> (<span class="i">Exception</span>)
                        {
                        }
                    }
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> 56500
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ManualResetEvent which is signaled when pipeline execution is</span>
        <span class="c">///</span><span class="c"> completed/failed/stoped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">ManualResetEvent</span> <a id="97fb4c9ad3fda68a" href="../../R/97fb4c9ad3fda68a.html" target="n" data-glyph="104,1" class="i property">PipelineFinishedEvent</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> streams
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> OutputStream from PipelineProcessor. Host will read on</span>
        <span class="c">///</span><span class="c"> ObjectReader of this stream. PipelineProcessor will write to</span>
        <span class="c">///</span><span class="c"> ObjectWriter of this stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="b54ef8003e78247b" href="../../R/b54ef8003e78247b.html" target="n" data-glyph="105,1" class="i property">OutputStream</a> { <b>get</b>; }
 
        <b>private</b> <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="8771ad521b2dd45b" href="../../R/8771ad521b2dd45b.html" target="n" data-glyph="46,1" class="i field">_errorStream</a>;
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> ErrorStream from PipelineProcessor. Host will read on</span>
        <span class="c">///</span><span class="c"> ObjectReader of this stream. PipelineProcessor will write to</span>
        <span class="c">///</span><span class="c"> ObjectWriter of this stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="ff21065a942f05b4" href="../../R/ff21065a942f05b4.html" target="n" data-glyph="105,1" class="i property">ErrorStream</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#8771ad521b2dd45b" class="i field">_errorStream</a>;
            }
 
            <b>private set</b>
            {
                <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<b>value</b> != <b>null</b>, <span class="s">&quot;ErrorStream cannot be null&quot;</span>);
                <a href="#8771ad521b2dd45b" class="i field">_errorStream</a> = <b>value</b>;
                <a href="#8771ad521b2dd45b" class="i field">_errorStream</a>.<a href="../../utils/ObjectStream.cs.html#16ab48f9b8a043bb" class="i">DataReady</a> += <span class="i">OnErrorStreamDataReady</span>;
            }
        }
 
        <span class="c">// Winblue: 26115. This handler is used to populate Pipeline.HadErrors.</span>
        <b>private void</b> <a id="19d6a399d6a10b32" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OnErrorStreamDataReady</a>(<b>object</b> <span id="r41 rd" class="r41 r">sender</span>, <span class="i">EventArgs</span> <span id="r42 rd" class="r42 r">e</span>)
        {
            <b>if</b> (<a href="#8771ad521b2dd45b" class="i field">_errorStream</a>.<a href="../../utils/ObjectStream.cs.html#01c58f66ddc41629" class="i property">Count</a> &gt; 0)
            {
                <span class="c">// unsubscribe from further event notifications as</span>
                <span class="c">// this notification is suffice to say there is an</span>
                <span class="c">// error.</span>
                <a href="#8771ad521b2dd45b" class="i field">_errorStream</a>.<a href="../../utils/ObjectStream.cs.html#16ab48f9b8a043bb" class="i">DataReady</a> -= <span class="i">OnErrorStreamDataReady</span>;
                <a href="Pipeline.cs.html#66aa53c508225fd9" class="i method">SetHadErrors</a>(<b>true</b>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Informational Buffers that represent verbose, debug, progress,</span>
        <span class="c">///</span><span class="c"> warning emanating from the command execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Informational buffers are introduced after 1.0. This can be</span>
        <span class="c">///</span><span class="c"> null if executing command as part of 1.0 hosting interfaces.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>protected</b> <a href="PSDataCollection.cs.html#b80567add938623b" class="t t">PSInformationalBuffers</a> <a id="d6c26e5d4383fd21" href="../../R/d6c26e5d4383fd21.html" target="n" data-glyph="105,1" class="i property">InformationalBuffers</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Stream for providing input to PipelineProcessor. Host will write on</span>
        <span class="c">///</span><span class="c"> ObjectWriter of this stream. PipelineProcessor will read from</span>
        <span class="c">///</span><span class="c"> ObjectReader of this stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a href="../../utils/ObjectStream.cs.html#27e9349816faeecb" class="t t">ObjectStreamBase</a> <a id="855cc30a2e94a28e" href="../../R/855cc30a2e94a28e.html" target="n" data-glyph="105,1" class="i property">InputStream</a> { <b>get</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> streams
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> history
 
        <span class="c">// History information is internal so that Pipeline serialization code</span>
        <span class="c">// can access it.</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If true, this pipeline is added in history.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="7bfe2846e98bfb41" href="../../R/7bfe2846e98bfb41.html" target="n" data-glyph="104,1" class="i property">AddToHistory</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> String which is added in the history.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">This needs to be internal so that it can be replaced</span>
        <span class="c">///</span><span class="c"> by invoke-cmd to place correct string in history.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="5ed10764070043c2" href="../../R/5ed10764070043c2.html" target="n" data-glyph="104,1" class="i property">HistoryString</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> history
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> misc
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialized the current pipeline instance with the supplied data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">runspace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">command</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">addToHistory</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">isNested</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentNullException</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> 1. addToHistory is true and command is null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private void</b> <a id="20e67828d0e7194d" href="../../R/20e67828d0e7194d.html" target="n" data-glyph="76,1" class="i method">Initialize</a>(<a href="Connection.cs.html#7e5b8eab1aa16fd7" class="t t">Runspace</a> <span id="r43 rd" class="r43 r">runspace</span>, <b>string</b> <span id="r44 rd" class="r44 r">command</span>, <b>bool</b> <span id="r45 rd" class="r45 r">addToHistory</span>, <b>bool</b> <span id="r46 rd" class="r46 r">isNested</span>)
        {
            <a href="../../utils/assert.cs.html#c04955255430d32f" class="t t">Dbg</a>.<a href="../../utils/assert.cs.html#703dade50a6809cd" class="i method">Assert</a>(<span class="r43 r">runspace</span> != <b>null</b>, <span class="s">&quot;caller should validate the parameter&quot;</span>);
            <a href="#d498f4010afa3c44" class="i field">_runspace</a> = <span class="r43 r">runspace</span>;
 
            <a href="#a3f88e6236a10c8c" class="i field">_isNested</a> = <span class="r46 r">isNested</span>;
 
            <b>if</b> (<span class="r45 r">addToHistory</span> &amp;&amp; <span class="r44 r">command</span> == <b>null</b>)
            {
                <b>throw</b> <a href="../../P/6de812d1f374e1ae.html#6de812d1f374e1ae" class="t t">PSTraceSource</a>.<a href="../../utils/MshTraceSource.cs.html#fbe67220ad7522a0" class="i method">NewArgumentNullException</a>(<b>nameof</b>(<span class="r44 r">command</span>));
            }
 
            <b>if</b> (<span class="r44 r">command</span> != <b>null</b>)
            {
                <a href="Pipeline.cs.html#55623b34b6a2a65a" class="i property">Commands</a>.<span class="i">Add</span>(<b>new</b> <a href="Command.cs.html#7daa1db0ede574c4" class="t constructor">Command</a>(<span class="r44 r">command</span>, <b>true</b>, <b>false</b>));
            }
 
            <a href="#7bfe2846e98bfb41" class="i property">AddToHistory</a> = <span class="r45 r">addToHistory</span>;
            <b>if</b> (<a href="#7bfe2846e98bfb41" class="i property">AddToHistory</a>)
            {
                <a href="#5ed10764070043c2" class="i property">HistoryString</a> = <span class="r44 r">command</span>;
            }
        }
 
        <b>private</b> <a href="ConnectionBase.cs.html#b5efaa6cd9653c05" class="t t">RunspaceBase</a> <a id="fe38e207e779c065" href="../../R/fe38e207e779c065.html" target="n" data-glyph="106,1" class="i property">RunspaceBase</a>
        {
            <b>get</b>
            {
                <b>return</b> (<a href="ConnectionBase.cs.html#b5efaa6cd9653c05" class="t t">RunspaceBase</a>)<a href="#32c8316e2a0e6851" class="i property">Runspace</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Object used for synchronization.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected internal object</b> <a id="859500b6b2a8113d" href="../../R/859500b6b2a8113d.html" target="n" data-glyph="105,1" class="i property">SyncRoot</a> { <b>get</b>; } = <b>new</b> <b>object</b>();
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> misc
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> IDisposable Members
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Set to true when object is disposed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="2290c52e219fca9a" href="../../R/2290c52e219fca9a.html" target="n" data-glyph="46,1" class="i field">_disposed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Protected dispose which can be overridden by derived classes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r47 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected override
        void</b>
        <a id="3e560b904f04328a" href="../../R/3e560b904f04328a.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r47 rd" class="r47 r">disposing</span>)
        {
            <b>try</b>
            {
                <b>if</b> (!<a href="#2290c52e219fca9a" class="i field">_disposed</a>)
                {
                    <a href="#2290c52e219fca9a" class="i field">_disposed</a> = <b>true</b>;
                    <b>if</b> (<span class="r47 r">disposing</span>)
                    {
                        <a href="#855cc30a2e94a28e" class="i property">InputStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
                        <a href="#b54ef8003e78247b" class="i property">OutputStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
 
                        <a href="#8771ad521b2dd45b" class="i field">_errorStream</a>.<a href="../../utils/ObjectStream.cs.html#16ab48f9b8a043bb" class="i">DataReady</a> -= <span class="i">OnErrorStreamDataReady</span>;
                        <a href="#8771ad521b2dd45b" class="i field">_errorStream</a>.<a href="../../utils/ObjectStream.cs.html#2bbebf10cbee9e83" class="i method">Close</a>();
 
                        <a href="#806b3aeb3c0ededa" class="i field">_executionEventQueue</a>.<span class="i">Clear</span>();
                    }
                }
            }
            <b>finally</b>
            {
                <a href="Pipeline.cs.html#c607964c20793ea5" class="k">base</a>.<a href="Pipeline.cs.html#a3ed04f9600b5bd2" class="i method">Dispose</a>(<span class="r47 r">disposing</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> IDisposable Members
    }
}
</pre></td></tr></table></div></body></html>
